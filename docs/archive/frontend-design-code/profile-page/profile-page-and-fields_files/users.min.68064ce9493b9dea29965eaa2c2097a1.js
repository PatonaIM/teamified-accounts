var Users={config:{currMode:"",addUserInstances:{},currentSortType:{default:"2_0"},toggleAGPforAdd:!0,toggleAGPforBulkConvDir:!0,loginErec:null,userFilterParams:{searchByLoc:null,searchByDept:null,searchByRole:null,userStatus:null,searchByEmpStatus:null},nonuserFilterParams:{searchByLoc:null,searchByDept:null,searchByRole:null,userStatus:null},isMigrateUser:!1,isAddUserDirectlyAllowed:!1,usersLeft:-1,usersAdded:-1,nonusersLeft:-1,nonusersAdded:-1,otherAppLicense:-1,userDomains:[],directRows:0,scrollLimit:25,formId:-1,viewId:-1,isNotificationEnabled:!1,addUserRedirectionalUrl:"",isOnboarding:!1,usersLoadedSet:new Set,nonusersLoadedSet:new Set,fromOtherPage:!1,otherPageParams:{},bodyModalContainer:$("body #modal_Container"),syncConsentCallbackFn:null,adminPanelAppsPageUrl:""},common:{init:function(){var currentLoaded,currentLoadedSet,filterParams,currentPage=settingsPage;"employeeprofile"===Users.config.currMode?(filterParams=Users.config.nonuserFilterParams,currentLoadedSet=Users.config.nonusersLoadedSet,filterParams.userType="3",currentLoaded=currentLoadedSet.has(settingsPage.mainWrapId)):(filterParams=Users.config.userFilterParams,currentLoaded=(currentLoadedSet=Users.config.usersLoadedSet).has(settingsPage.mainWrapId));var extraParams=Users.common.getExtraParams();if(currentLoaded)if(Users.config.fromOtherPage)Users.operations.add.handleMenu();else{csrfToken,Users.config.currentSortType.default;Users.common.setFilterParams(filterParams),Users.operations.view.submitFilter(extraParams,!1)}else{currentPage.container.find("div#scrollContent").empty();var getAddParams={mode:Users.config.currMode,needAllDtls:!0,fetchFormComp:!0};ZPeople.Request.send("/users/getAddUserPage",getAddParams,function(data,p,extraParams){Users.common.initConfig(data,p),currentLoadedSet.add(settingsPage.mainWrapId),Users.config.fromOtherPage?Users.operations.add.initUserMenu():(currentPage.container.append(ZPeople.LOADING_HTML),Users.common.setFilterParams(filterParams),Users.common.initPage(data,p,extraParams))},extraParams),new FireScrollBack(Users.common.scrollCallback,currentPage.container,Users.common.getCurrentPageId())}},initOld:function(){var currentPage,constructCallback,currentLoaded;currentPage=settingsPage,constructCallback=Users.operations.view.constructList,"nonusers"==settingsUrlProps.niceUrl.split("/")[3]?(Users.config.currMode="employeeprofile",currentLoaded=Users.config.nonusersLoaded,filterParams=Users.config.nonuserFilterParams):(Users.config.currMode="user",currentLoaded=Users.config.usersLoaded,filterParams=Users.config.userFilterParams);var extraParams=Users.common.getExtraParams();if(currentLoaded)Users.operations.view.submitFilter(extraParams,!1);else{var params={conreqcsr:csrfToken,sortByType:Users.config.currentSortType.default,isAjax:!1};"employeeprofile"===Users.config.currMode&&(params.userType="3"),params.userStatus=Users.common.getCurrentStatus(),"user"==Users.config.currMode?Object.assign(Users.config.userFilterParams,params):Object.assign(Users.config.nonuserFilterParams,params),currentPage.container.find("div#scrollContent").empty(),currentPage.container.append(ZPeople.LOADING_HTML);var getAddParams={mode:Users.config.currMode,needAllDtls:!0,fetchFormComp:!0};ZPeople.Request.send("/users/getAddUserPage",getAddParams,function(data,p,extraParams){Users.common.initConfig(data,p);let pageId=Users.common.getCurrentPageId();"user"===Users.config.currMode&&0===$(settingsPage.mainWrapId).find("#addUserMenu").length&&pageId==Users.common.getDefaultTab()&&Users.operations.add.initUserMenu(data,p),"employeeprofile"===Users.config.currMode&&0===$(settingsPage.mainWrapId).find("#addNonUserMenu").length&&pageId==Users.common.getDefaultTab()&&Users.operations.add.initNonUsersMenu(data,p),extraParams.useFilterParams=!0,extraParams.isScroll=!1,Users.operations.view.submitFilter(extraParams,constructCallback)},extraParams),"user"===Users.config.currMode?Users.config.usersLoaded=!0:Users.config.nonusersLoaded=!0;new FireScrollBack(Users.common.scrollCallback,currentPage.container,Users.common.getCurrentPageId())}},initUsersCallback:function(){Users.config.usersLoadedSet.delete(settingsPage.mainWrapId)},usersCallback:function(){Users.config.currMode="user",Users.config.fromOtherPage=!1,Users.common.init()},otherUsersCallback:function(params){Users.config.currMode="user",Users.config.fromOtherPage=!0,Users.config.otherPageParams=params,Users.common.init()},initNonusersCallback:function(){Users.config.usersLoadedSet.delete(settingsPage.mainWrapId)},nonusersCallback:function(){Users.config.currMode="employeeprofile",Users.config.fromOtherPage=!1,Users.common.init()},scrollCallback:function(){var extraParams=Users.common.getExtraParams();extraParams.useFilterParams=!1,extraParams.isScroll=!0,Users.operations.view.submitFilter(extraParams)},getDefaultTab:function(){return"user"!=Users.config.currMode?"settings-service-accountsetup-nonusers-nall":"settings-service-accountsetup-users-all"},getCurrentStatus:function(){var status=settingsPage.tabId.split("-")[4],currentStatus="All Status";return"enabled"===status?currentStatus="1":"disabled"===status?currentStatus="0":"invited"===status?currentStatus="2":"downgraded"===status?currentStatus="-1":"nactive"===status?currentStatus="-2":"ninactive"===status?currentStatus="-33":"ndowngraded"===status&&(currentStatus="-4"),currentStatus},getCurrentPageId:function(){return settingsPage.container.attr("id")},initPage:function(data,p,extraParams){extraParams.useFilterParams=!0,extraParams.isScroll=!1,Users.operations.view.submitFilter(extraParams,Users.operations.view.constructList)},initAddMenu:function(){var pageId=Users.common.getCurrentPageId();"user"!==Users.config.currMode||0!==$(settingsPage.mainWrapId).find("#addUserMenu").length||pageId!=Users.common.getDefaultTab()&&!Users.config.fromOtherPage||Users.operations.add.initUserMenu(),"employeeprofile"!==Users.config.currMode||0!==$(settingsPage.mainWrapId).find("#addNonUserMenu").length||pageId!=Users.common.getDefaultTab()&&!Users.config.fromOtherPage||Users.operations.add.initNonUsersMenu()},initConfig:function(data,params){var empidComp,empfnameComp,emplnameComp,empmailComp,emplocComp;data&&(Users.config.isAddUserDirectlyAllowed="1"==data.pageStatus,Users.config.ALLOW_MOBILEUSER_ADDITION=data.ALLOW_MOBILEUSER_ADDITION,Users.config.userDomains=data.userDomains&&!ZPSetupCommon.isEmpty(data.userDomains)?data.userDomains:[],Users.config.pwdPol=data.pwdPolicy,Users.operations.add.updateLicense(data,params),data.selectedComponent&&(empidComp=data.selectedComponent.EMPLOYEEID,empfnameComp=data.selectedComponent.EMPLOYEEFIRSTNAME,emplnameComp=data.selectedComponent.EMPLOYEELASTNAME,empmailComp=data.selectedComponent.EMPLOYEEMAILALIAS,emplocComp=data.selectedComponent.LOCATION),Users.config.empidLength="100",Users.config.fnameLength="100",Users.config.lnameLength="100",Users.config.mailLength="100",Users.config.fnameUnique="false",Users.config.lnameUnique="false",Users.config.isAutoGenPwd=!0,Users.config.empidDispName=empidComp?ZSEC.Encoder.encodeForHTML(empidComp.dispName):ZPI18N.getString("zp.empid"),Users.config.fnameDispName=empfnameComp?ZSEC.Encoder.encodeForHTML(empfnameComp.dispName):ZPI18N.getString("zp.fname"),Users.config.lnameDispName=emplnameComp?ZSEC.Encoder.encodeForHTML(emplnameComp.dispName):ZPI18N.getString("zp.lname"),Users.config.emailDispName=empmailComp?ZSEC.Encoder.encodeForHTML(empmailComp.dispName):ZPI18N.getString("zp.emailid"),Users.config.locationDispName=emplocComp?ZSEC.Encoder.encodeForHTML(emplocComp.dispName):ZPI18N.getString("zp.location"),Users.config.isLastNameMand=data.isLastNameMand,Users.config.locAdminDetails=data.modAdminLocDetails,Users.config.isNotificationEnabled=data.isNotificationEnabled,Users.config.addUserRedirectionalUrl=data.addUserRedirectionalUrl?data.addUserRedirectionalUrl:"",Users.config.isOnboarding=data.isOnboarding)},setConfigurations:function(data,paramsObj,extraParams){Users.config.viewId=data.viewID,Users.config.loginErec=data.loginErec,Users.config.lastEmployeeId=data.lastEmployeeId,Users.config.totalUsersCount=Object.keys(data.usersDtls).length,Users.config.formId=data.formId,extraParams.isScroll||(NewZPOnboarding.isOnboarding=data.isOnboarding)},setFilterParams:function(filterParams){var params={conreqcsr:csrfToken,sortByType:Users.config.currentSortType.default,isAjax:!1};params.userStatus=Users.common.getCurrentStatus(),Object.assign(filterParams,params)},getSlider:function(id,isBodyContainer){var container=isBodyContainer?$("body #modal_Container"):$(settingsPage.mainWrapId);return id.indexOf("#")>-1?container.find(id):container.find("#"+id)},refreshSlider:function(slider){slider.footerDiv.html(slider.footerContent),slider.headerDiv.html(slider.headerContent)},toggleSlider:function(id,isBodyContainer){Users.common.getSlider(id,isBodyContainer).toggleClass("zpl_mopen")},openSlider:function(id,isBodyContainer){Users.common.getSlider(id,isBodyContainer).addClass("zpl_mopen")},closeSlider:function(id,isBodyContainer){Users.common.getSlider(id,isBodyContainer).removeClass("zpl_mopen")},removeSlider:function(slider){slider.remove()},changeSliderTitle:function(id,headerValue,isBodyContainer){Users.common.getSlider(id,isBodyContainer).find(".zpl_mhder h4").html(headerValue)},changeSliderHeader:function(id,headerValue,callback,mode,isBodyContainer){if(Users.common.changeSliderTitle(id,headerValue,isBodyContainer),Users.common.getSlider(id,isBodyContainer).find(".zpl_mhder #otherOptions").remove(),"employeeprofile"!==Users.config.currMode&&headerValue!==ZPI18N.getString("zp.addgroupusers")){var otherOptions=Users.components.otherOptionsButton(callback,mode);$(otherOptions).insertBefore(Users.common.getSlider(id).find(".zpl_mhder #sliderCls"))}},changeSliderFooter:function(id,footerHtml,isBodyContainer){footerHtml?(Users.common.getSlider(id,isBodyContainer).find(".zpl_minr .zpl_mfoter").remove(),Users.common.getSlider(id,isBodyContainer).find(".zpl_minr").append(footerHtml)):Users.common.getSlider(id,isBodyContainer).find(".zpl_mfoter").remove()},toggleRadioButton:function(id,ele,currentForm){$(settingsPage.mainWrapId).find(currentForm+" #"+id).find("input").removeAttr("checked"),$(ele).find("input").attr("checked","checked"),"directEnable"!==$(ele).find("input").attr("id")&&"directDisable"!==$(ele).find("input").attr("id")||($(settingsPage.mainWrapId).find(currentForm).find("#agpToggleSection, #userPasswordSection").toggleClass("DN"),$(settingsPage.mainWrapId).find(currentForm).find("#inviteEmail, #directEmail").toggleClass("DN"),"true"==$(settingsPage.mainWrapId).find("button#convertNonusers").attr("isInvite")?$(settingsPage.mainWrapId).find("button#convertNonusers").attr("isInvite",!1):$(settingsPage.mainWrapId).find("button#convertNonusers").attr("isInvite",!0))},toggleActive:function(mode,showEle,html){var id="Summary";"changeLogin"==mode?id=mode+id:"convert"==mode?id=mode+id:"directImport"==mode?id=mode+id:"Office365"!=mode&&"GApps"!=mode||(id=mode+"Import"+id);var baseEle=html?$(html):$("#"+id);baseEle.find("li").removeClass("zpl_act"),baseEle.find("#"+showEle+"Header").addClass("zpl_act"),baseEle.find(".summaryBody").hide(),baseEle.find("div#"+showEle+"Body").show()},toggleMobile:function(e){if(Users.config.ALLOW_MOBILEUSER_ADDITION){var pageContent=$(settingsPage.mainWrapId).find("#inviteUserForm"),emailtxt=pageContent.find("#userEmailSection #userEmail").val().trim();Users.common.validation("number",emailtxt)&&emailtxt.length>2?(pageContent.find("#mobMail > select").removeClass("DN"),pageContent.find("#mobMail > div").removeClass("DN"),Users.config.isMobile=!0):(pageContent.find("#mobMail > select").addClass("DN"),pageContent.find("#mobMail > div").addClass("DN"),Users.config.isMobile=!1)}},getDialCodes:function(){ZPeople.Request.sendAsyncPost("/users/getDialCodes",{},function(data){ZPComponents.dialCode.dialCodes=data.mobDtls,ZPComponents.dialCode.cc=data.cc})},getExtraParams:function(){return{pageId:Users.common.getCurrentPageId(),pageContent:settingsPage.container}},uncheckCheckBoxes:function(pageContent,pageId){$(pageContent).find("table#userListTable tbody").find("input[name='userRowCheck']").prop("checked",!1),pageContent.find(`input#${pageId+"-massCheckBox"}`).prop("checked",!1),settingsPage.container.find(".actn_ovrly").removeClass("opn"),settingsPage.container.find(".zpl_rgt").show(),pageContent.find("#resendInviteButton,#triggerOnboardingButton").addClass("DN"),$("div#dispUserCntTitle,div#licenseDtlsRow").removeClass("DN")},validation:function(mode,str){if("mailId"==mode){if(!str)return!1;var objRegExp=new XRegExp("^[\\p{L}\\p{N}\\p{M}\\_]([\\p{L}\\p{N}\\p{M}\\_\\+\\-\\.\\'\\&]*)@(?=.{4,256}$)(([\\p{L}\\p{N}\\p{M}]+)(([\\-\\_]*[\\p{L}\\p{N}\\p{M}])*)[\\.])+[\\p{L}\\p{M}]{2,22}$","i");return XRegExp.test(str.trim(),objRegExp)}if("userName"==mode){if(!str)return!1;objRegExp=new XRegExp("^[\\p{L}\\p{N}\\p{M}\\_\\.]+$","i");return XRegExp.test(str.trim(),objRegExp)}return"phoneNumber"==mode?!!str&&(str=str.replace(/[+ \[\]\(\)\-\.\,]/g,""),(objRegExp=/^([0-9]{5,14})$/).test(str)):"number"==mode?!!str&&(str=str.replace(/[+ \[\]\(\)\-\.\,]/g,""),(objRegExp=/^[0-9]*$/).test(str)):void 0},initTooltip:function(){$(".tooltip-js").ztooltip({margin:{top:5,right:5,bottom:5,left:5}})}}};Users.components={listViewMenu:function(currentPageId){var totalCount=`<div class="PT5"> <span>${ZPI18N.getString("zp.counttotal")} : <a onclick="Users.operations.add.toggleTotalCount()" id=${currentPageId+"-hashTotalCount"}>#</a><b id=${currentPageId+"-totalCount"} class="DN">0</b></span> </div>`,multiSelectMenuHtml=`<div class="actn_ovrly"> <div> <button id=${currentPageId+"-changeLoginButton"} class="zlabel zlabel--blue zlabel--outline zlabel--medium drpmenu-js undefined zbutton--menu zbutton zbutton--medium zbutton--normal" type="button"> <span class="zbutton__text">${ZPI18N.getString("zp.changeaccountstatus")}</span> <i class="zbutton__icon zh-floatright"><svg class="zbutton__svg zbutton__menuarrow" focusable="false"> <use xlink:href="#zc__svg--downarrow"></use> </svg></i> </button> <button id="resendInviteButton" class="zlabel zlabel--blue zlabel--outline zlabel--medium DN" onclick="Users.operations.edit.bulkResendInvitation($(this))">${ZPI18N.getString("zp.resendinv")}</button> <button id="triggerOnboardingButton" class="zlabel zlabel--blue zlabel--outline zlabel--medium DN" onclick="NewZPOnboarding.usersPageBulkTriggerOnboarding();">${ZPI18N.getString("zp.triggeronboadring")}</button> <button id="convertButton" class="zlabel zlabel--blue zlabel--outline zlabel--medium" onclick="Users.operations.edit.bulkChangesConsentPopup('convertToNonUser',Users.operations.edit.convertUsersAndNonusers,'user')">${ZPI18N.getString("zp.converttononuser")}<i class="PI_pending blu ML5 DIB rotate-animate DN" id="migrateusersLoader"></i></button> <div id=${currentPageId+"-changeLoginMenu"} data-type="list" class="zpl_drpdwn"> <ul> <li id="enableLoginOption" onclick="Users.operations.edit.bulkChangeLoginStatus('enable')">${ZPI18N.getString("zp.enableLogin")}</li> <li id="disableLoginOption" onclick="Users.operations.edit.bulkChangeLoginStatus('disable')">${ZPI18N.getString("zp.disableLogin")}</li> </ul> </div> </div> <i id="closeMultiSelectMenu" class="PI_cls" onclick="Users.operations.view.closeMultiSelectMenu()"></i> </div>`,menuHtml=`<div class="zpl_rgt"> ${currentPageId==Users.common.getDefaultTab()?`<button class="zlabel zlabel--blue zlabel--medium" id="addOptnbtn" onclick="Users.operations.add.handleMenu()">${ZPI18N.getString("zp.settaddUsers")}</button> <button id=${currentPageId+"-importButtonId"} class="drpmenu-js zbutton zbutton--medium zbutton--normal undefined zbutton--menu" tabindex="0" role="button" type="button"> <span class="zbutton__text"> ${ZPI18N.getString("zp.import")} </span> <i class="zbutton__icon zh-floatright"> <svg class="zbutton__svg zbutton__menuarrow" focusable="false"> <use xlink:href="#zc__svg--downarrow"></use> </svg> </i> </button> <div id=${currentPageId+"-importMenuId"} data-type="list" class="zpl_drpdwn"> <ul> <li onclick="Users.operations.add.showImportPopup()">${ZPI18N.getString("zp.lms.member.importcsv")}</li> ${Users.config.isAddUserDirectlyAllowed?`<li onclick="Users.operations.add.showDirectImportPopup()">${ZPI18N.getString("zp.importusersdirectly")}</li>`:""} </ul> </div>`:""} <i class="zpl_ibg PI_fltr" title="${ZPI18N.getString("zp.filter")}" onclick="Users.operations.view.toggleFilters('${"#"+currentPageId+"-searchVal"}')"></i> <i class="zpl_ibg PI_exprt" title="${ZPI18N.getString("zp.export")}" onclick="Users.operations.add.showExportPopup()"></i> </div>`;return"user"!=Users.config.currMode&&(multiSelectMenuHtml=`<div class="actn_ovrly"> <div> <button id=${currentPageId+"-convertToUserButton"} class="zlabel zlabel--blue zlabel--outline zlabel--medium drpmenu-js undefined zbutton--menu zbutton zbutton--medium zbutton--normal" type="button"> <span class="zbutton__text">${ZPI18N.getString("zp.converttouser")}</span> <i class="zbutton__icon zh-floatright"><svg class="zbutton__svg zbutton__menuarrow" focusable="false"> <use xlink:href="#zc__svg--downarrow"></use> </svg></i> <i class="PI_pending blu ML5 DIB rotate-animate DN" id="migrateNonusersLoader"></i></button> <div id=${currentPageId+"-convertToUserMenu"} class="zpl_drpdwn" data-type="list" > <ul> <li onclick="Users.operations.edit.convertUsersAndNonusers('convertInvite')">${ZPI18N.getString("zp.inviteuser")}</li> <li onclick="Users.operations.edit.convertUsersAndNonusers('convertDirect')">${ZPI18N.getString("zp.convertdirectly")}</li> </ul> </div>  </div> <i id="closeMultiSelectMenu" class="PI_cls" onclick="Users.operations.view.closeMultiSelectMenu()"></i> </div>`,menuHtml=`<div class="zpl_rgt"> ${currentPageId==Users.common.getDefaultTab()?`<button class="zlabel zlabel--blue zlabel--medium" id="addOptnbtn" onclick="Users.operations.add.handleMenu()">${ZPI18N.getString("zp.addnonusers")}</button> <button class="zlabel zlabel--outline zlabel--medium" id="importNonuser" onclick="Users.operations.add.showImportPopup()">${ZPI18N.getString("zp.import")}</button>`:""} <i class="zpl_ibg PI_fltr" title="${ZPI18N.getString("zp.filter")}" onclick="Users.operations.view.toggleFilters('${"#"+currentPageId+"-searchVal"}')"></i> <i class="zpl_ibg PI_exprt" title="${ZPI18N.getString("zp.export")}" onclick="Users.operations.add.showExportPopup()"></i> </div>`),menuHtml=totalCount+multiSelectMenuHtml+menuHtml},listViewMenuInit:function(currentPageId){"user"===Users.config.currMode?(ZPeopleComponents.menu(`#${currentPageId}-importMenuId`,{forElement:`#${currentPageId}-importButtonId`}),$("#"+currentPageId).find(`#${currentPageId}-importButtonId`).on("click",function(){ZPeopleComponents.menu(`#${currentPageId}-importMenuId`).show()}),ZPeopleComponents.menu(`#${currentPageId}-changeLoginMenu`,{forElement:`#${currentPageId}-changeLoginButton`}),$("#"+currentPageId).find(`#${currentPageId}-changeLoginButton`).on("click",function(){ZPeopleComponents.menu(`#${currentPageId}-changeLoginMenu`).show()})):(ZPeopleComponents.menu(`#${currentPageId}-convertToUserMenu`,{forElement:`#${currentPageId}-convertToUserButton`}),$("#"+currentPageId).find(`#${currentPageId}-convertToUserButton`).on("click",function(){ZPeopleComponents.menu(`#${currentPageId}-convertToUserMenu`).show()}))},listViewTableHeader:function(resultData,paramsObj,currentPageId){var containerHtml=`<div class="zpl_rgtcnt"> <div class="zpl_tblres"> <table class="zpl_tbl" id="userListTable" formId="${resultData.formId}"></table> </div> </div>`;containerHtml=$(containerHtml)[0];var thead=`<thead> <tr> <th width="30"> <div class="zcheckbox"> <input id=${currentPageId+"-massCheckBox"} type="checkbox" class="zcheckbox__helper" onchange='Users.operations.edit.handleUserSelect(this)' name='headerRowCheck'> <label for=${currentPageId+"-massCheckBox"} class="zcheckbox__label"></label> </div> </th> <th style="text-align:left;">${ZPI18N.getString("zp.basicinfo")} <div id=${currentPageId+"-nameSort"} class="zpl_icncnt" onclick="Users.operations.view.clickSort(this,'name')"> <i id=${currentPageId+"-nameSortIcon"} class="PI_sort"></i> </div> <div id=${currentPageId+"-nameSortMenuId"} displayType="callout" data-type="list" data-content-type="icon-text" class="DN zpl_drpdwn"> <ul> <li onclick="Users.operations.view.sortRecords('0_1', '${currentPageId+"-nameSortIcon"}')" data-icon-class="PI_down">Asc Order</li> <li onclick="Users.operations.view.sortRecords('0_0', '${currentPageId+"-nameSortIcon"}')" data-icon-class="PI_up">Desc Order</li> </ul> </div> </th> <th style="min-width: 130px;">${ZPI18N.getString("zp.local.Dateofjoining")} <div id=${currentPageId+"-dojSort"} class="zpl_icncnt" onclick="Users.operations.view.clickSort(this,'doj')"> <i id=${currentPageId+"-dojSortIcon"} class="PI_sort"></i> </div> <div id=${currentPageId+"-dojSortMenuId"} displayType="callout" data-type="list" data-content-type="icon-text" class="zpl_drpdwn DN"> <ul> <li onclick="Users.operations.view.sortRecords('3_1', '${currentPageId+"-dojSortIcon"}')"  data-icon-class="PI_down">Asc Order</li> <li onclick="Users.operations.view.sortRecords('3_0', '${currentPageId+"-dojSortIcon"}')"  data-icon-class="PI_up">Desc Order</li> </ul> </div> </th> <th style="min-width: 130px;">${ZPI18N.getString("zp.roles")}</th> <th style="min-width: 100px;">${Users.config.locationDispName}</th> <th>${ZPI18N.getString("zp.local.Employeestatus")}</th> ${3!=paramsObj.userType?`<th style="min-width: 130px;">${ZPI18N.getString("zp.useraccountStatus")}</th>`:""} <th>${ZPI18N.getString("zp.actions")}</th><th style="min-width:80px;width: 80px;"></th> </tr> </thead>`;return thead=$(thead)[0],containerHtml.querySelector("#userListTable").appendChild(thead),containerHtml},listViewTableBody:function(data,paramsObj,extraParams){var currentPageId=extraParams.pageId,dataObj=data.usersDtls,usersListRowObj="<tbody><\tbody>";usersListRowObj=$(usersListRowObj)[0];var superAdminErecNo=data.superAdminErecNo,usersStatus=data.userStatus;return"0"!==usersStatus&&"-3"!==usersStatus||!0,0!==dataObj.length&&$.each(data.usersDtls,function(key,userDtls){var usersListRow="",zuId=userDtls.ZUID?userDtls.ZUID:"",isZohoOne=data.isZohoOne,isPeoplePlus=data.isPeoplePlus,loginStatus=ZSEC.Encoder.encodeForHTML(userDtls.LOGINSTATUS);let employeeName=ZSEC.Encoder.encodeForHTML(userDtls.EMPLOYEENAME),employeeId=ZSEC.Encoder.encodeForHTML(userDtls.EMPLOYEEID);var mailAlias=ZPSetupCommon.isEmpty(userDtls.EMPLOYEEMAILALIAS)?"":ZSEC.Encoder.encodeForHTML(userDtls.EMPLOYEEMAILALIAS),dataOfJoining=(userDtls.DATEOFEXIT,userDtls.DATEOFJOINING);ZPSetupCommon.isEmpty(dataOfJoining)&&(dataOfJoining="");var erecNo=userDtls.ERECNO,locName=ZPSetupCommon.isEmpty(userDtls.LOCATION)?"":ZSEC.Encoder.encodeForHTML(userDtls.LOCATION),roleName=ZPSetupCommon.isEmpty(userDtls.ROLENAME)?"":ZSEC.Encoder.encodeForHTML(userDtls.ROLENAME),empStatus=ZPSetupCommon.isEmpty(userDtls.EMPLOYEESTATUS)?"":ZSEC.Encoder.encodeForHTML(userDtls.EMPLOYEESTATUS),empLoginStatus=3==data.empType?"":"0"==loginStatus?ZPI18N.getString("zp.inactiveusers"):"1"==loginStatus?ZPI18N.getString("zp.orgusers"):"2"==loginStatus?ZPI18N.getString("zp.pendingusers"):"-1"==loginStatus?ZPI18N.getString("zp.downgraded"):"",statusIcon="",migrateIcon="",deleteIcon="",isEnabled=!1,isNonUser=!1;if(data.superAdminErecNo!==erecNo){if("1"===loginStatus&&Users.config.loginErec!=erecNo)statusIcon=`<label class="btnactive MB0" title="${ZPI18N.getString("zp.disableLogin")}"><div class="zpl_tgl"><input class="togbuttondis-js" id="${erecNo+"_togglestatus"}" changeStatus="0" /></div></label>`,isEnabled=!0;else if(isPeoplePlus&&"2"===loginStatus)statusIcon=`<i class='PI_invtusr tooltip-js' title='${ZPI18N.getString("zp.resendinv")}' onclick="Users.operations.edit.resentInvitationForPeoplePlus('${mailAlias}')"></i>`;else if(isZohoOne||"2"!==loginStatus)if("0"===loginStatus||"-1"===loginStatus)statusIcon=`<label class="btnactive MB0" title="${ZPI18N.getString("zp.enableLogin")}"><div class="zpl_tgl"><input class="togbuttondis-js" id="${erecNo+"_togglestatus"}" changeStatus="1" /></div></label>`,isEnabled=!1;else if("-3"===loginStatus){statusIcon=`<i class='ZPtitle PI_usr tooltip-js' title='${ZPI18N.getString("zp.enableNonUser")}' changeStatus='1' onclick=Users.operations.edit.changeLoginStatus(this,'Non-user')></i>`,isNonUser=!0}else"-2"!==loginStatus&&"-6"!==loginStatus||(statusIcon=`<i class='ZPtitle PI_rvrt_emp tooltip-js' title='${ZPI18N.getString("zp.migraToEmp")}' onclick='Users.operations.edit.populateDataForConversion(this)' status='Non-user'></i>`,isNonUser=!0);else statusIcon=`<i class='PI_invtusr tooltip-js' title='${ZPI18N.getString("zp.resendinv")}' onclick="Users.operations.edit.resentInvitation('${erecNo}')"></i>`;Users.config.loginErec!=erecNo&&(deleteIcon="<i class='PI_delete tooltip-js' title='"+ZPI18N.getString("zp.delete")+" ' onclick=Users.operations.del.initialConfirm(this,'"+data.formId+"')></i>","user"===Users.config.currMode&&(migrateIcon="<i class='ZPtitle ML10 PI_cnvrt_emp tooltip-js' title='"+ZPI18N.getString("zp.convertcandtoempprofile")+"' changestatus='0' onclick='Users.operations.edit.changeLoginStatus(this,\"MakeNonUser\")'></i>"))}usersListRow+=`<tr emperecno=${erecNo} status=${loginStatus} zuid="${zuId}">`,usersListRow+=`<td class="actions-td"><div class="zcheckbox"><input id=${currentPageId+"-"+erecNo} type="checkbox" class="zcheckbox__helper" onchange='Users.operations.edit.handleUserSelect(this)' name='userRowCheck' loginstatus=${loginStatus}><label for=${currentPageId+"-"+erecNo} class="zcheckbox__label user-action"></label></div></td>`,usersListRow+=`<td><div class="zpl_em"><div elem="profilePhoto" empid = ${erecNo} class="zpl_emimg"><img src=${userDtls.EMPLOYEEPHOTO}></div><div class="zpl_emdts text-left"><div><em>${employeeId} - </em><b>${employeeName}</b></div><em>${mailAlias}</em></div></div></td>`,usersListRow+=`<td><span>${dataOfJoining}</span></td>`,usersListRow+=`<td><span>${roleName}</span>${erecNo==superAdminErecNo?'<i class="PI_crown">':""}</i></td>`,usersListRow+=`<td><span>${locName}</span></td>`,usersListRow+=`<td><span>${empStatus}</span></td>`,"user"==Users.config.currMode&&(usersListRow+=`<td><span>${empLoginStatus}</span></td>`),usersListRow+=`<td class="actions-td"><div class="zpl_hvr zpl_hvrsw zpl_btncenter">${statusIcon}${migrateIcon}</div></div></td>`,usersListRow+=`<td class="actions-td" style="min-width:80px;width: 80px;"><div><div class="zpl_hvr">${deleteIcon}</div></div></td>`,usersListRow+="</tr>",usersListRow=$(usersListRow)[0],isNonUser&&$(usersListRow).data({employeeId:userDtls.EMPLOYEEID,empMailAlias:userDtls.EMPLOYEEMAILALIAS,empFname:userDtls.EMPLOYEEFIRSTNAME,empLname:userDtls.EMPLOYEELASTNAME}),$(usersListRow).on("click",function(event){Users.operations.view.singleRecord(erecNo,"VIEW",event)}),ZPeopleComponents.toggleswitch($(usersListRow).find("#"+erecNo+"_togglestatus"),{on:isEnabled,change:Users.operations.edit.changeLoginStatus}),usersListRowObj.append(usersListRow)}),usersListRowObj},filterBreadcrumb:function(pageid){return`<div id="${pageid}-filterBreadcrumb" class="zpl_fltrvw DN"> <div id="${pageid}-filterBreadcrumbWrapper"> <ul id="${pageid}-filterBreadcrumbList" class="zpl_fltrvwlst"></ul> </div> <div id='${pageid}-breadcrumbClearAll' class="d-flexcap MLauto"><a class="zpl_link" onclick="Users.operations.view.removeBreadcrumbFromView('${pageid}')">${ZPI18N.getString("zp.reset")}</a> </div> </div>`},addFilterBreadcrumb:function(pageid,label,value,type){return`<li id="${pageid}-${type}-breadcrumbItem"><label>${label} :</label><span>${ZSEC.Encoder.encodeForHTML(value)}</span><a class="PI_cls" onclick="Users.operations.view.removeBreadcrumb('${pageid}','${type}')"></a></li>`},addMoreFilterBreadcrumb:function(pageid,label,value,type){return"<label>"+label+"&nbsp;:&nbsp;</label><span>"+ZSEC.Encoder.encodeForHTML(value)+'</span><a class="PI_cls" onclick="Users.operations.view.removeBreadcrumb(\''+pageid+"','"+type+"')\"></a>"},filterBreadcrumbBtn:function(pageid){return`<li id="${pageid}-breadcrumbDropdownBtn" data-menu-id="zplfltrvwmre1" class="zpl_mre zpl_drpdwn-js"><i class="PI_more d-flex"></i></li>`},filter:function(resultData,paramsObj,extraParams){var currentPageId=extraParams.pageId,userFilters=["role","location","employeestatus"],searchFields=[{label:ZPI18N.getString("zp.allfields"),value:0},{label:ZPI18N.getString("zp.fname"),value:1},{label:ZPI18N.getString("zp.lname"),value:2},{label:ZPI18N.getString("zp.empid"),value:5},{label:ZPI18N.getString("zp.email"),value:6}],searchText=ZPI18N.getString("zp.searchUser");"user"==Users.config.currMode?userFilters.push("Onboarding"):searchText=ZPI18N.getString("zp.searchnonuser");var html=`<div id=${currentPageId+"-filter"} class="zpl_fltr"> <div> <div class="zpl_fltrhd"> <h5>${ZPI18N.getString("zp.filter")}</h5> <i class="PI_cls" onclick="Users.operations.view.toggleFilters()"></i> </div> </div> <div class="zpl_fltrcnt"> <div> <div class="zpl_fltclps fltopn"> <div class="zpl_fltrlst"> <div class="zpl_secn"> <div class="zpl_fgrp"> <div><label>${ZPI18N.getString("zp.search")}</label></div> <div><select id='${currentPageId+"-searchType"}'></select></div> <div class="ztokenfield"><input id='${currentPageId+"-searchVal"}' class="ztokenfield__textbox wd100_per" placeholder="${searchText}" type="text"></div> </div> </div> </div> </div> </div> </div> <div> <div id="usrListSubmit"> <button id="usrListSubmit1" class="zlabel zlabel--blue zlabel--medium" onclick='Users.operations.view.submitFilter({"isFromFilter":true});Users.operations.view.toggleFilters();'>${ZPI18N.getString("zp.apply")}</button> <button class="zlabel zlabel--outline zlabel--medium" onclick='Users.operations.view.resetFilter()'>${ZPI18N.getString("zp.reset")}</button> </div> </div> </div>`;html=$(html)[0];var searchType=currentPageId+"-searchType",options={change:Users.operations.view.changeSearchPlaceholder};return Users.components.initSelect($(html).find("#"+searchType),options,searchFields,searchFields[0].value),userFilters.filter(field=>Users.components.filterFields(resultData,html,field,currentPageId)),html},filterFields:function(resultData,filterHtml,field,currentPageId){var fieldId=currentPageId+"-"+field+"Filter",fieldHtml=`\n\t\t\t\t<div class="zpl_secn">\n\t\t\t\t<div><label>${ZPI18N.getString("zp."+field)}</label></div>\n\t\t\t\t<div><select id="${fieldId}"></select></div>\n\t\t\t\t</div>\n\t\t\t\t`,skipFilter=!1,data=[],optionLabel="label",optionValue="value",defaultValue=0;if("department"==field)optionLabel="DEPARTMENTNAME",optionValue="DEPARTMENTID",Users.operations.view.decodeText(optionLabel,resultData.deptDtls),(data=resultData.deptDtls).unshift({DEPARTMENTNAME:ZPI18N.getString("zp.alldepartment"),DEPARTMENTID:0});else if("role"==field)optionLabel="roleName",optionValue="roleId",(data=resultData.rolesDtls).unshift({roleName:ZPI18N.getString("zp.allroles"),roleId:0});else if("location"==field)optionLabel="LOCATIONNAME",optionValue="LOCATIONID",Users.operations.view.decodeText(optionLabel,resultData.locationsDtls),(data=resultData.locationsDtls).unshift({LOCATIONNAME:ZPI18N.getString("zp.alllocaction"),LOCATIONID:0});else if("employeestatus"==field){defaultValue="All Status",optionLabel="label",optionValue="empStatus";var statusArr=resultData.empStatusDtls;data.push({label:ZPI18N.getString("zp.allstatus"),empStatus:defaultValue}),statusArr.filter(status=>{data.push({label:status,empStatus:status})})}else"accountStatus"==field?(defaultValue="All Status",data.push({label:ZPI18N.getString("zp.allstatus"),value:"All Status"}),data.push({label:ZPI18N.getString("zp.nonuseractive"),value:"-2"}),data.push({label:ZPI18N.getString("zp.exnonusers"),value:"-33"}),data.push({label:ZPI18N.getString("zp.downgraded"),value:"-4"})):"Onboarding"==field&&(void 0!=typeof resultData.isOnboarding?(defaultValue="-1",data.push({label:ZPI18N.getString("zp.allstatus"),value:"-1"}),data.push({label:ZPI18N.getString("zp.nottriggered"),value:"0"}),data.push({label:ZPI18N.getString("zp.triggered"),value:"1"})):skipFilter=!0);if(!skipFilter){$(filterHtml).find(".zpl_fltrlst").append(fieldHtml);var options={dataMapping:{label:optionLabel,text:optionLabel,value:optionValue}};Users.components.initSelect($(filterHtml).find("#"+fieldId),options,data,defaultValue)}},noRecordsPage:function(msg){var html=`<div id="emptPage" class="zpl_crd zpl_nodata"> <div class="zpl_crdcnt"> <div class="zpl_Emptydata"> <div> <div class="zpl_emptimg zp_nd_empprfl"></div> <h4>${msg||ZPI18N.getString("zp.nofilterrecord")}</h4> <p></p> </div> </div> </div> </div>`;return $(html)[0]},noRecordForFilterPage:function(){var html=`<div id="emptPage" class="zpl_crd zpl_nodata"> <div class="zpl_crdcnt"> <div class="zpl_Emptydata"> <div> <div class="zpl_emptimg zp_nd_nodata"></div> <h4>${ZPI18N.getString("zp.searchnodata",[`${"user"==Users.config.currMode?ZPI18N.getString("zp.users"):ZPI18N.getString("zp.employeeProfiles")}`])}</h4> <p></p> </div> </div> </div> </div>`;return $(html)[0]},addUserMenuOptions:function(){var addUserOptionsHtml=`\n\t\t\t\t<div class="zpl_addusr">\n\t\t\t\t\t<div id="directAdd" onclick="Users.operations.add.createDirectForm()">\n\t\t\t\t\t\t<div><i class="PI_mail"></i><label>${ZPI18N.getString("zp.domainemail")}</label></div>\n\t\t\t\t\t\t<p>${ZPI18N.getString("zp.adduserdirectlyInfo")}</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id="invite" onclick="Users.operations.add.createInviteForm()">\n\t\t\t\t\t\t<div><i class="PI_invtusr"></i><label>${ZPI18N.getString("zp.invitation")}</label></div>\n\t\t\t\t\t\t<p>${ZPI18N.getString("zp.inviteuserInfo")}</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id="importZMail" onclick="Users.operations.add.createSyncForm(this,'Zoho')">\n\t\t\t\t\t\t<div><i class="PI_zmail"> <i class="path1"></i> <i class="path2"></i> </i><label>Zoho Mail</label></div>\n\t\t\t\t\t\t<p>${ZPI18N.getString("zp.syncfromzohoInfo")}</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id="importGApps" onclick="Users.operations.add.createSyncForm(this,'GApps')">\n\t\t\t\t\t\t<div><i class="PI_gglsync"> <i class="path1"></i> <i class="path2"></i> <i class="path3"></i> <i class="path4"></i> </i><label>Google Workspace</label></div>\n\t\t\t\t\t\t<p>${ZPI18N.getString("zp.syncfromgappsInfo")}</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id="importOffice365" onclick="Users.operations.add.createSyncForm(this,'Office365')">\n\t\t\t\t\t\t<div><i class="PI_msofc"></i><label>Microsoft 365</label></div>\n\t\t\t\t\t\t<p>${ZPI18N.getString("zp.syncfromoffice365Info")}</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;return addUserOptionsHtml=$(addUserOptionsHtml)[0],Users.config.isAddUserDirectlyAllowed||$(addUserOptionsHtml).find("#directAdd").remove(),addUserOptionsHtml},notificationConfirmationPopup:function(){return`<div data-modal-box="alrtinfo" id="notificationConfirmaionPopup" class="zpl_mdl zpl_malrtmsg zpl_mopen">\n            \t<div class="zpl_minr">\n                \t<a class="_cls PI_cls" id="notificationPopupClose"></a>\n                \t<div class="zpl_mcnt">\n\n                    \t<div class="alert_contain">\n                        \t<i class="ico info"></i>\n                        \t<div class="cont">\n                         \t   <h3>${ZPI18N.getString("zp.orgnotifytitle")}</h3>\n                        \t    <p>${ZPI18N.getString("zp.neworgnotifyalertmsg")}</p>\n                        \t</div>\n                    \t</div>\n                \t</div>\n                \t<div class="zpl_mfoter">\n                  \t  <button id="notificationPopupOk" type="button" class="zlabel zlabel--yellow zlabel--medium MR10">${ZPI18N.getString("zp.ok")}</button>\n                \t</div>\n            \t</div>\n        \t</div>`},addUserMenu:function(){return`${Users.components.licenseRow()} <form id="addUserMenuForm"> <div class="zpl_crd"> <div class="zpl_crdcnt"><div class="zpl_addusr">${$(Users.components.addUserMenuOptions()).html()}</div></div> </div> </form>`},inviteForm:function(config){let empIdGenButton=config.isPermAllowedForEmpId?"<button "+(ZPeople.EmployeeIDGenEnabled?"":'style="cursor: default;"')+` elem="empIdGenButton" type="button" class="zlabel zlabel--medium zlabel--outline">${ZPI18N.getString("zp.gen")}</button>`:"";var html=`<form id="inviteUserForm"> <div class="zpl_crd"> <div class="zpl_crdcnt"> <div class="zpl_hdcnt zpl_DNI"> <ul class="zpl_tabpane"> <li id="singleInviteTab" class="zpl_act" onclick="Users.operations.add.toggleSingleMultipleInterface('invite')"> <a>${ZPI18N.getString("zp.singleinvite")}</a> </li> <li id="multipleInviteTab" onclick="Users.operations.add.toggleSingleMultipleInterface('invite')"> <a>${ZPI18N.getString("zp.multipleinvite")}</a> </li> </ul> </div> <div class="zpl_secn"> <div> <div id="singleInviteInfo" class="zpl_info"><em>${ZPI18N.getString("zp.inviteusernotes")}</em></div> <div id="multipleInviteInfo" class="zpl_info DN"><em>${ZPI18N.getString("zp.invitemultinotes")}</em> </div> </div> </div> <div class="zpl_tabcnt"> <div id="singleInvite"> <div id="userIdSection" class="zpl_secn"> <div><label class="zpl_mtry">${config.empidDispName}</label></div> <div class="ztextbox--group zh-alignright zpl_flexaligngap3"><input type="text" id="userId" class="ztextbox">${empIdGenButton} </div><span class="tagtxt">${ZPI18N.getString("zp.lastemployeeid")} ${config.lastEmployeeId}</span> </div> <div id="userFirstnameSection" class="zpl_secn"> <div><label class="zpl_mtry">${config.fnameDispName}</label></div> <div><input type="text" id="userFirstname" class="ztextbox"></div> </div> <div id="userLastnameSection" class="zpl_secn"> <div><label ${Users.config.isLastNameMand?'class="zpl_mtry"':""}>${config.lnameDispName}</label></div> <div><input type="text" id="userLastname" class="ztextbox"></div> </div> <div id="userEmailSection" class="zpl_secn"> <div><label class="zpl_mtry">${config.emailDispName}</label></div> <div> <div id="mobMail" class="zpl_flglst"><input type="text" id="userEmail" class="ztextbox"> </div> </div> </div> <div id="inviteUserForm-single-userLocationSection" class="zpl_secn DN"> <div><label class="zpl_mtry">${config.locationDispName}</label></div> <div><select id="inviteUserForm-single-userLocation" class="select-js"></select> </div> </div> </div> <div id="multipleInvite" class="DN"> <div id="multipleInvite-userLocationSection" class="zpl_secn DN"> <div><label class="zpl_mtry">${config.locationDispName}</label></div> <div><select id="multipleInvite-userLocation" class="select-js"></select> </div> </div> <div class="zpl_secn"> <div> <textarea id="userEmails" rows="10" class="ztextbox" placeholder="Example: michael@zillium.com, sarah@zillium.com, . . ."></textarea> </div> </div> </div> </div> </div> </div> </form>`;return html=$(html)[0],$(html).attr("mode","single"),config.isOnboarding||$(html).find("#userOnboardingSection").addClass("DN"),Users.components.addUser.initLocation(html,"#inviteUserForm-single-userLocation",config),Users.components.addUser.initLocation(html,"#multipleInvite-userLocation",config),html},addNonuserForm:function(){let empIdGenButton=Users.config.isPermAllowedForEmpId?"<button "+(ZPeople.EmployeeIDGenEnabled?"":'style="cursor: default;"')+` elem="empIdGenButton" type="button" class="zlabel zlabel--medium zlabel--outline">${ZPI18N.getString("zp.gen")}</button>`:"";var html=`<form id="addNonuserForm"> <div class="zpl_crd"> <div class="zpl_crdcnt"> <div class="zpl_secn"> <div> <div class="zpl_info"><em>${ZPI18N.getString("zp.addnonusernotes")}</em></div> </div> </div> <div class="zpl_tabcnt"> <div id="singleInvite"> <div id="userIdSection" class="zpl_secn"> <div><label class="zpl_mtry">${Users.config.empidDispName}</label></div> <div class="ztextbox--group zh-alignright zpl_flexaligngap3"><input type="text" id="userId" class="ztextbox">${empIdGenButton}</div><span class="tagtxt">${ZPI18N.getString("zp.lastemployeeid")} ${Users.config.lastEmployeeId}</span> </div> <div id="userFirstnameSection" class="zpl_secn"> <div><label class="zpl_mtry">${Users.config.fnameDispName}</label></div> <div><input type="text" id="userFirstname" class="ztextbox"></div> </div> <div id="userLastnameSection" class="zpl_secn"> <div><label ${Users.config.isLastNameMand?'class="zpl_mtry"':""}>${Users.config.lnameDispName}</label></div> <div><input type="text" id="userLastname" class="ztextbox"></div> </div> <div id="userEmailSection" class="zpl_secn"> <div><label>${Users.config.emailDispName}</label></div> <div><input type="text" id="userEmail" class="ztextbox"></div> </div> <div id="addNonuserForm-single-userLocationSection" class="zpl_secn DN"> <div><label class="zpl_mtry">${Users.config.locationDispName}</label></div> <div><select id="addNonuserForm-single-userLocation" class="select-js"></select> </div> </div> </div> </div> </div> </div> </form>`;return html=$(html)[0],Users.config.locAdminDetails&&Users.components.initLocation(html,"#addNonuserForm-single-userLocation"),html},convertNonuserForm:function(){var html=`<form id="convertNonuserForm"> <div class="zpl_crd"> <div class="zpl_crdcnt"> <div class="zpl_secn"> <div> <div class="zpl_info"><em>${ZPI18N.getString("zp.inviteusernotes")}<em></div> </div> </div> <div id="agpToggleSection" class="zpl_secn DN"> <div> <div class="zpl_tgsprt"> <h5 class="zpl_tgl"><input id="agpPassword" class="togbutton-js"> Auto-Generated Password </h5> <p>This auto-generated password will be send to your email address</p> </div> </div> </div> <div class="zpl_tabcnt"> <div id="singleConvert"> <div id="userIdSection" class="zpl_secn"> <div><label class="zpl_mtry">${Users.config.empidDispName}</label></div> <div><input type="text" id="userId" class="ztextbox"></div> </div> <div id="userFirstnameSection" class="zpl_secn"> <div><label class="zpl_mtry">${Users.config.fnameDispName}</label></div> <div><input type="text" id="userFirstname" class="ztextbox"></div> </div> <div id="userLastnameSection" class="zpl_secn"> <div><label ${Users.config.isLastNameMand?'class="zpl_mtry"':""}>${Users.config.lnameDispName}</label></div> <div><input type="text" id="userLastname" class="ztextbox"></div> </div> <div id="inviteDirectToggleSection" class="zpl_secn DN"> <div> <h5>${ZPI18N.getString("zp.addusers")}</h5> </div> <div> <div class="zradiobutton zradiobutton--horizontal" onclick="Users.common.toggleRadioButton('inviteDirectToggleSection',this, '#convertNonuserForm')"> <input type="radio" id="directEnable" class="zradiobutton__helper"> <label class="zradiobutton__label"><span class="zradiobutton__text">${ZPI18N.getString("zp.yes")}</span></label> </div> <div class="zradiobutton zradiobutton--horizontal" onclick="Users.common.toggleRadioButton('inviteDirectToggleSection',this, '#convertNonuserForm')"> <input type="radio" id="directDisable" class="zradiobutton__helper" checked="checked"> <label class="zradiobutton__label"><span class="zradiobutton__text">${ZPI18N.getString("zp.no")}</span></label> </div> </div> </div> <div id="userEmailSection" class="zpl_secn"> <div id ="userEmailSectionLabel"><label class="zpl_mtry">${Users.config.emailDispName}</label></div> <div id="inviteEmail"><input type="text" id="userEmail" class="ztextbox"></div> <div id="directEmail" class="DN"><input type="text" id="userUsername" class="ztextbox" style="width:57%"> @ <select id="userConvertDomain" class="select-js" style="width:40%"></select> </div> </div> <div id="userPasswordSection" class="zpl_secn DN"> <div id="manualPassword" class="DN"> <div><label class="zpl_mtry">${ZPI18N.getString("zp.passwd")}</label></div> <input id="userPassword" type="password" class="ztextbox mt10" placeholder="Enter Password"> </div> </div> <div id="convertNonuserForm-single-userLocationSection" class="zpl_secn DN"> <div><label class="zpl_mtry">${Users.config.locationDispName}</label></div> <div><select id="convertNonuserForm-single-userLocation" class="select-js"></select> </div> </div> </div> </div> </div> </div> </form>`;html=$(html)[0],ZPeopleComponents.toggleswitch($(html).find("#agpToggleSection #agpPassword"),{on:!0,change:Users.operations.add.toggleSinglePassword}),Users.config.locAdminDetails&&Users.components.initLocation(html,"#convertNonuserForm-single-userLocation");return Users.config.userDomains.length>0&&Users.components.initSelect($(html).find("#singleConvert #userConvertDomain"),{dataMapping:{label:"ORG_DOMAIN",text:"ORG_DOMAIN",value:"ORG_DOMAIN"}},Users.config.userDomains,Users.config.userDomains[0].ORG_DOMAIN),$(html)[0]},syncUserForm:function(mode){var html=`<form id=${"sync"+mode+"UserForm"}> </form>`;return $(html)[0]},syncUserFormTableHtml(mode){var id="sync"+mode+"UserForm";return $(`<div class="zpl_crd"> <div class="zpl_crdhdr zpl_crdhdrcnt"> <div> <div class="zpl_idiv"> <div class="zpl_search zpl_srchsml w300"> <input id="${id}-search" placeholder="${ZPI18N.getString("zp.search")}" class="ztextbox" onkeyup = "Users.operations.add.searchSync(this, '${mode}')"><i class="PI_lens"></i></div> </div> </div> <div class="zpl_posnon"> <div class="zpl_idiv"><span>Total User</span> <b id="${id}-count"><i></i></b></div> </div> </div> <div class="zpl_crdcnt"> <div class="zpl_tblres"> <table class="zpl_tbl"> <thead> <tr> <th width="5%"> <div class="zcheckbox" onclick="Users.operations.add.handleSyncCheckbox(this,this.id,'${mode}')"> <input id="massChecked" type="checkbox" name="userListCheckBox" class="zcheckbox__helper"> <label class="zcheckbox__label"></label> </div> </th> <th width="95%">${ZPI18N.getString("zp.basicinfo")}</th> </tr> </thead> <tbody> </tbody> </table> </div> </div> </div>`)},summary:function(mode){var id="Summary",title="";"changeLogin"==mode?(id=mode+id,title=ZPI18N.getString("zp.loginsummary")):"convert"==mode?(id=mode+id,title=ZPI18N.getString("zp.convertionreport")):"directImport"==mode?(id=mode+id,title=ZPI18N.getString("zp.directimportsummary")):"Office365"!=mode&&"GApps"!=mode||(id=mode+"Import"+id,title=ZPI18N.getString("zp.importuserssummary"));var html=`<div id="${id}" class="zpl_mdl zpl_mopen"> <div class="zpl_minr"> <div class="zpl_mhder"> <div> <h4>${title}</h4> </div> <a class="_cls PI_cls" onclick="Users.common.closeSlider('${id}')"></a> </div> <div class="zpl_mcnt zpl_fm"> <div class="zpl_btnmnu"> <div class=""> <ul class="zpl_grpmnu"> <li id="successHeader" class="zpl_act" onclick='Users.common.toggleActive("${mode}", "success");'>${ZPI18N.getString("zp.successrecords")} : <b></b></li> <li id="errorHeader" onclick='Users.common.toggleActive("${mode}", "error");'>${ZPI18N.getString("zp.errorrecords")} : <b></b></li> <li id="skippedHeader" onclick='Users.common.toggleActive("${mode}", "skipped");'>${ZPI18N.getString("zp.skippedrecords")} : <b></b></li> </ul> </div> </div> <div id="successBody" class="summaryBody" class="DN"> <div class="zpl_rgtcnt"> <div class="zpl_tblres"> <table class="zpl_tbl"> <thead> <tr> <th>${Users.config.empidDispName}</th> <th>${Users.config.emailDispName}</th> <th>${ZPI18N.getString("zp.message")}</th> </tr> </thead> <tbody> </tbody> </table> </div> </div> </div> <div id="errorBody" class="summaryBody" style="display: none;"> <div class="zpl_rgtcnt"> <div class="zpl_tblres"> <table class="zpl_tbl"> <thead> <tr> <th>${Users.config.empidDispName}</th> <th>${Users.config.emailDispName}</th> <th>${ZPI18N.getString("zp.message")}</th> </tr> </thead> <tbody> </tbody> </table> </div> </div> </div> <div id="skippedBody" class="summaryBody" style="display: none;"> <div class="zpl_rgtcnt"> <div class="zpl_tblres"> <table class="zpl_tbl"> <thead> <tr> <th>${Users.config.empidDispName}</th> <th>${Users.config.emailDispName}</th> <th>${ZPI18N.getString("zp.message")}</th> </tr> </thead> <tbody> </tbody> </table> </div> </div> </div> </div> <div class="zpl_mfoter"> <button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="Users.common.closeSlider('${id}')">${ZPI18N.getString("zp.close")}</button> </div> </div> </div>`;return"directImport"==mode?html=`<div id="${id}" class="zpl_mdl zpl_mopen"> <div class="zpl_minr"> <div class="zpl_mhder"> <div> <h4>${title}</h4> </div> <a class="_cls PI_cls" onclick="Users.common.closeSlider('${id}')"></a> </div> <div class="zpl_mcnt zpl_fm"> <div class="zpl_btnmnu"> <div> <ul class="zpl_grpmnu"> <li id="successHeader" class="zpl_act" onclick='Users.common.toggleActive("${mode}", "success");'>${ZPI18N.getString("zp.successrecords")} : <b class="blu"></b></li> <li id="warningHeader" onclick='Users.common.toggleActive("${mode}", "warning");'>Warning records : <b class="blu"></b></li> <li id="errorHeader" onclick='Users.common.toggleActive("${mode}", "error");'>${ZPI18N.getString("zp.errorrecords")} : <b class="blu"></b></li> </ul> </div> </div> <div id="successBody" class="summaryBody" style="display: none;"> <div class="zpl_rgtcnt"> <div class="zpl_tblres"> <table class="zpl_tbl"> <thead> <tr> <th>${ZPI18N.getString("zp.email")}</th> <th>${ZPI18N.getString("zp.message")}</th> </tr> </thead> <tbody> </tbody> </table> </div> </div> </div> <div id="warningBody" class="summaryBody" style="display: none;"> <div class="zpl_rgtcnt"> <div class="zpl_tblres"> <table class="zpl_tbl"> <thead> <tr> <th>${Users.config.emailDispName}</th> <th>${ZPI18N.getString("zp.message")}</th> </tr> </thead> <tbody> </tbody> </table> </div> </div> </div> <div id="errorBody" class="summaryBody" style="display: none;"> <div class="zpl_rgtcnt"> <div class="zpl_tblres"> <table class="zpl_tbl"> <thead> <tr> <th>Row no.</th> <th>${ZPI18N.getString("zp.message")}</th> </tr> </thead> <tbody> </tbody> </table> </div> </div> </div> </div> <div class="zpl_mfoter"> <button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="Users.common.closeSlider('${id}')">${ZPI18N.getString("zp.close")}</button> </div> </div> </div>`:"Office365"!=mode&&"GApps"!=mode||(html=`<div id="${id}" class="zpl_mdl zpl_mopen"> <div class="zpl_minr"> <div class="zpl_mhder"> <div> <h4>${title}</h4> </div> <a class="_cls PI_cls" onclick="Users.common.closeSlider('${id}')"></a> </div> <div class="zpl_mcnt zpl_fm"> <div class="zpl_btnmnu"> <div class=""> <ul class="zpl_grpmnu"> <li id="successHeader" class="zpl_act" onclick='Users.common.toggleActive("${mode}", "success");'>${ZPI18N.getString("zp.successrecords")} : <b></b></li> <li id="errorHeader" onclick='Users.common.toggleActive("${mode}", "error");'>${ZPI18N.getString("zp.errorrecords")} : <b></b></li>  </ul> </div> </div> <div id="successBody" class="summaryBody" style="display: none;"> <div class="zpl_rgtcnt"> <div class="zpl_tblres"> <table class="zpl_tbl"> <thead> <tr> <th>${Users.config.emailDispName}</th> <th>${ZPI18N.getString("zp.message")}</th> </tr> </thead> <tbody> </tbody> </table> </div> </div> </div> <div id="errorBody" class="summaryBody" style="display: none;"> <div class="zpl_rgtcnt"> <div class="zpl_tblres"> <table class="zpl_tbl"> <thead> <tr> <th>${Users.config.emailDispName}</th> <th>${ZPI18N.getString("zp.message")}</th> </tr> </thead> <tbody> </tbody> </table> </div> </div> </div>  </div> <div class="zpl_mfoter"> <button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="Users.common.closeSlider('${id}')">${ZPI18N.getString("zp.close")}</button> </div> </div> </div>`),$(html)[0]},directImportPopup:function(){var html=`<div id="directImportPopup" class="zpl_mdl zpl_mmd zpl_mopen"> <div class="zpl_minr"> <div class="zpl_mhder"> <div> <h4>Import Users Directly</h4> </div> <a class="_cls PI_cls" onclick="Users.common.closeSlider('directImportPopup')"></a> </div> <div class="zpl_mcnt"> ${Users.components.licenseRow()} <form method="post" action="users/quickImport" role="form" enctype="multipart/form-data" target="importIframe" id="quickImportForm"> <input type="hidden" value="${csrfToken}" name="conreqcsr"> <input type="hidden" id="method" value="import" name="method" /> <input type="hidden" id="domainName" value="" name="DomainSelect" /> <input type="hidden" id="autoGenPassword" value="" name="autoGenPassword" /> <input type="hidden" id="LocID" value="" name="locid" /> <input type="hidden" id="version" value="5" name="version" /> <div id="importFileSection" class="zpl_crd"> <div id="import1" class="zpl_crdcnt"> <div class="zpl_secn zpl_idivingrp"> <div> <div> <label id="userImportDomainLabel">Applicable Domain:</label> <label id="directImport-userLocationLabel" style="display: none;">${ZPI18N.getString("zp.location")}</label> </div> </div> <div> <div> <select id="userImportDomain" class="select-js"></select> <select id="directImport-userLocation" class="select-js DN"></select> </div> </div> </div> <div class="zpl_secn"> <div> <div class="zpl_upld"> \x3c!-- File upload --\x3e <div class="zpl_fldrp"> <i class="PI_imprt S22 MB8" id="importIc"></i> <p class="MB20 DN" id="importloadedFileName"><em></em> <span class="PI_tick2_fil ML5 filetck"></span></p> <p><b>${ZPI18N.getString("zp.fileimported")}</b></p> <p> <small>${ZPI18N.getString("zp.fomtsupportxlscsv")}</small> <small>${ZPI18N.getString("zp.maxfilesize")}</small> </p> <input id="uploadFileInput" type="file" name="theFile" style="display:none" accept=".xls,.xlsx,.csv" onchange="Users.operations.add.directImportPreview(this)"> <button id="uploadFileButton" type="button" class="zlabel zlabel--blue zlabel--medium" onclick="$('#uploadFileInput').click();">${ZPI18N.getString("zp.uploadfile")}</button> <p><a onclick="Users.operations.add.downloadDirectImportTemplate()"><b>${ZPI18N.getString("zp.shiftmapping.sampleFileImport")}</b></a></p> </div> </div> </div> </div> <div class="zpl_secn"> <div> <div class="zpl_tgsprt"> <h5 class="zpl_tgl"><input id="agpPassword" class="togbutton-js"> ${ZPI18N.getString("zp.autoGenPassword")} </h5> <p>${ZPI18N.getString("zp.autoGenPwdSendToEMail")}</p> </div> </div> </div> <div id="directImportTableSection" class="zpl_secn zpl_tblres"> <table class="zpl_tbl wd100_per"> <thead> <tr> <th>${ZPI18N.getString("zp.username")}</th> <th class="directImportTemplate-password DN">${ZPI18N.getString("zp.passwd")}</th> <th>${Users.config.empidDispName}</th> <th>${Users.config.fnameDispName}</th> <th>${Users.config.lnameDispName}</th> </tr> </thead> <tbody> <tr> <td>${ZPI18N.getString("zp.user1")}</td> <td class="directImportTemplate-password DN">${ZPI18N.getString("zp.password123")}</td> <td>${ZPI18N.getString("zp.emp1")}</td> <td>${ZPI18N.getString("zp.zillum")}</td> <td>${ZPI18N.getString("zp.john")}</td> </tr> <tr> <td>${ZPI18N.getString("zp.user2")}</td> <td class="directImportTemplate-password DN">${ZPI18N.getString("zp.passwordTest")}</td> <td>${ZPI18N.getString("zp.emp2")}</td> <td>${ZPI18N.getString("zp.sarah")}</td> <td>${ZPI18N.getString("zp.christ")}</td> </tr> </tbody> </table> </div> </div> </div> </form> </div> <div class="zpl_mfoter"> <button type="button" id="#import2-js" class="zlabel zlabel--outline zlabel--medium" onclick="Users.common.closeSlider('directImportPopup')">Cancel</button> <button type="button" id="importButton" class="zlabel zlabel--blue zlabel--medium DN" onclick="Users.operations.add.directImportSubmit()" disabled>Import</button> </div> </div> </div>`;html=$(html)[0],Users.components.initLocation(html,"#directImport-userLocation"),ZPeopleComponents.toggleswitch($(html).find("#agpPassword"),{on:!0,change:Users.operations.add.toggleImportPassword});return Users.config.userDomains.length>0&&Users.components.initSelect($(html).find("#userImportDomain"),{dataMapping:{label:"ORG_DOMAIN",text:"ORG_DOMAIN",value:"ORG_DOMAIN"}},Users.config.userDomains,Users.config.userDomains[0].ORG_DOMAIN),html},convertPasswordPopup:function(){var html=`<div id="convertPasswordPopup" class="zpl_mdl zpl_malrtmsg zpl_mopen"> <div class="zpl_minr"> <div class="zpl_mcnt"> <div class="alert_contain"> <i class="ico info"></i> <div class="zpl_secn"> <div> <h3 class="d-flexM">${ZPI18N.getString("zp.bulkconvheader")}</h3> <p class="d-flexM">Selected profiles will be converted to Users</p> <div class="zpl_tgsprt"><h5 class="zpl_tgl d-flexM"><input id="agpPassword" class="togbutton-js"> ${ZPI18N.getString("zp.autoGenPassword")} </h5></div> </div> </div> <div class="zpl_secn wd50_per"> <div id="manualPassword" class="DN"> <div><label class="zpl_mtry">Password</label></div> <div class="mt10"><input id="userPassword" type="password" class="ztextbox" placeholder="Enter Password"> <div class="ztextbox--error__label"></div> </div> </div> </div> </div> </div> <div class="zpl_mfoter"> <button id="directConvertSubmit" class="zlabel zlabel--yellow zlabel--medium MR10">${ZPI18N.getString("zp.submit")}</button> <button id="directConvertCancel" class="zlabel zlabel--outline zlabel--medium" onclick="Users.common.closeSlider('convertPasswordPopup')">${ZPI18N.getString("zp.cancel")}</button> </div> </div> </div>`;return html=$(html)[0],ZPeopleComponents.toggleswitch($(html).find("#agpPassword"),{on:!0,change:Users.operations.edit.togglePopupPassword}),html},initLocation:function(html,id){if(Users.config.locAdminDetails){$(html).find(id+"Section").removeClass("DN"),id.indexOf("Import")>0&&($(html).find(id+"Label").show(),$(html).find(id).removeClass("DN"));for(var locs=[],i=0;i<Users.config.locAdminDetails.length;i++){var loc={},locDetail=Users.config.locAdminDetails[i];loc.value=Object.keys(locDetail)[0],loc.label=locDetail[loc.value],locs.push(loc)}Users.components.initSelect($(html).find(id),{},locs,locs[0].value)}},summaryRow:function(empId,email,message,mode){var rowHtml=`<tr> <td><span>${empId}</span></td> <td><span>${email}</span></td> <td><span>${message}</span></td> </tr>`;return"directImport"==mode?rowHtml=`<tr> <td><span>${empId}</span></td> <td><span>${message}</span></td> </tr>`:"Office365"!=mode&&"GApps"!=mode||(rowHtml=`<tr> <td><span>${email}</span></td> ${null!=message?"<td><span>"+message+"</span></td>":""} </tr>`),rowHtml},directAddRow:function(){var html=`<tr> <td><input type="text" id="userUsername-${Users.config.directRows}" class="ztextbox" style=" width: 100%; "></td> <td><select id="userDomain-${Users.config.directRows}" class="select-js"></select></td> <td class="manualPasswordTd DN"><input type="text" id="userPassword-${Users.config.directRows}" class="ztextbox" placeholder="Enter Password"></td> <td class="locationTd DN"><select id="userLocation-${Users.config.directRows}" class="select-js"></select></td> <td onclick="Users.operations.add.deleteDirectRow(this)"><i class="PI_delete"></i></td> </tr>`;html=$(html)[0];return Users.config.userDomains.length>0&&Users.components.initSelect($(html).find("#userDomain-"+Users.config.directRows),{dataMapping:{label:"ORG_DOMAIN",text:"ORG_DOMAIN",value:"ORG_DOMAIN"}},Users.config.userDomains,Users.config.userDomains[0].ORG_DOMAIN),html},syncUserRow:function(dispName,emailId,photo,mode){return`<tr> <td> <div class="zcheckbox" onclick="Users.operations.add.handleSyncCheckbox(this,this.id,'${mode}')"> <input type="checkbox" name="${dispName}" value=${emailId} class="zcheckbox__helper"> <label class="zcheckbox__label"></label> </div> </td> <td> <div class="zpl_em"> <div class="zpl_emimg"><img src="${photo}"></div> <div class="zpl_emdts"> <div><em>${dispName} - </em><b>${emailId}</b></div> </div> </div> </td> </tr>`},syncTableFooter:function(callback){var html=$(`<tfoot id="showMoreDiv"> <tr> <td class="text-center" colspan="3"><a id="showMore" class="d-flexM">${ZPI18N.getString("zp.showmore")}</a></td> </tr> </tfoot>`);return html.on("click",callback),html},licenseRow:function(){var html=`<div class="zpl_btnmnu">\n\t\t\t\t                  <div>\n\t\t\t\t                    <ul class="zpl_grpmnulnelst" id="user-licenseRow">\n\t\t\t\t                        <li>${ZPI18N.getString("zp.totallicense")} <b class="ylw" id="user-licenseTotal">${Users.config.usersMax}</b>\n\t\t\t\t                        <li>${ZPI18N.getString("zp.usersadded")} <b class="ylw" id="user-licenseAdded">${Users.config.usersAdded}</b></li>`;if((Layout.isZohoOne||Layout.isPeoplePlus)&&0!=Users.config.otherAppLicense&&-1!=Users.config.otherAppLicense){var bundleName=Layout.isPeoplePlus?"People Plus":"Zoho One";html+=`<li>${ZPI18N.getString("zp.otherappsusage",[bundleName])} <b class="ylw" id="user-otherappsusage"><a href="${Users.config.adminPanelAppsPageUrl}" target="_blank">${Users.config.otherAppLicense}</a></b></li>`}html+=`<li>${ZPI18N.getString("zp.remaining")}: <b class="ylw" id="user-licenseLeft">${Users.config.usersLeft}</b></li>                       \n\t\t\t\t                    </ul>\n\t\t\t\t                    <ul class="zpl_grpmnulnelst" id="employeeprofile-licenseRow">\n\t\t\t\t                        <li>${ZPI18N.getString("zp.totallicense")} <b class="ylw" id="employeeprofile-licenseTotal">${Users.config.nonusersMax}</b>\n\t\t\t\t                        <li>${ZPI18N.getString("zp.employeeprofilesadded")} <b class="ylw" id="employeeprofile-licenseAdded">${Users.config.nonusersAdded}</b></li>\n\t\t\t\t                        <li>${ZPI18N.getString("zp.remaining")}: <b class="ylw" id="employeeprofile-licenseLeft">${Users.config.nonusersLeft}</b></li>                       \n\t\t\t\t                    </ul>\n\t\t\t\t                  </div>\n\t\t\t\t            </div>`;var mode=Users.config.currMode;return html=$(html),"user"==mode?html.find("#employeeprofile-licenseRow").hide():html.find("#user-licenseRow").hide(),html[0].outerHTML},sliderHeader:function(name,id){return`<div><h4>${name}</h4> </div> <a id="closeSlider" class="_cls PI_cls" onclick="Users.common.toggleSlider('${id}')"></a>`},otherOptionsButton:function(callback,mode){var html=$(`<button id="otherOptions" class="zlabel zlabel--blue zlabel--outline zlabel--medium" style="margin-right:20px">${ZPI18N.getString("zp.otheroptions")}</button>`);return html.on("click",callback),mode&&html.attr("mode",mode),html[0]},inviteUserFooter:function(){var html=`<div class="zpl_mfoter"> <button type="button" id="inviteUsers" class="zlabel zlabel--blue zlabel--medium" onclick="Users.operations.add.submit(this,true,false)">${ZPI18N.getString("zp.invite")}</button> <button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="Users.common.closeSlider('addUserMenu')">${ZPI18N.getString("zp.cancel")}</button> </div>`;return $(html)[0]},directUserFooter:function(){var html=`<div class="zpl_mfoter"> <button type="button" id="addUsers" class="zlabel zlabel--blue zlabel--medium" onclick="Users.operations.add.submit(this,false,false)">${ZPI18N.getString("zp.add")}</button> <button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="Users.common.closeSlider('addUserMenu')>${ZPI18N.getString("zp.cancel")}</button> </div>`;return $(html)[0]},addNonuserFooter:function(){var html=`<div class="zpl_mfoter"> <button type="button" id="addNonusers" class="zlabel zlabel--blue zlabel--medium" onclick="Users.operations.add.submit(this,false,false)">${ZPI18N.getString("zp.add")}</button> <button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="Users.operations.add.closeAddNonuserForm();">${ZPI18N.getString("zp.cancel")}</button> </div>`;return $(html)[0]},convertNonuserFooter:function(erecno){var html=`<div class="zpl_mfoter"> <button type="button" id="convertNonusers" isInvite="true" class="zlabel zlabel--blue zlabel--medium" onclick="Users.operations.add.submit(this,this.getAttribute('isInvite'),true,'${erecno}')">${ZPI18N.getString("zp.invite")}</button> <button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="Users.operations.add.closeConvertNonuserForm()">${ZPI18N.getString("zp.cancel")}</button> </div>`;return $(html)[0]},syncUserFooter:function(mode){var html=`<div class="zpl_mfoter"> <button type="button" id="syncZohoUsers" class="zlabel zlabel--blue zlabel--medium disabled" onclick="Users.operations.add.submitSyncZoho('${mode}')">${ZPI18N.getString("zp.add")}</button> <button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="Users.common.closeSlider('addUserMenu')">${ZPI18N.getString("zp.cancel")}</button> </div>`;return $(html)[0]},deletePopup:function(id,title,content){var html=`<div id=${id} class="zpl_mdl zpl_malrtmsg zpl_mopen"> <div class="zpl_minr"> <a class="_cls PI_cls"></a> <div class="zpl_mcnt"> <div class="alert_contain"> <i class="ico delete"></i> <div class="cont"> <h3>${title}</h3> <p>${content}</p> </div> </div> </div> <div class="zpl_mfoter"> <button type="button" id="confirmButton" class="zlabel zlabel--red zlabel--medium MR10">${ZPI18N.getString("zp.confirm")}</button> <button type="button" id="cancelButton" class="zlabel zlabel--outline zlabel--medium">${ZPI18N.getString("zp.cancel")}</button> </div> </div> </div>`;return $(html)[0]},confirm:function(id,title,content){var html=`<div id=${id} class="zpl_mdl zpl_malrtmsg zpl_mopen"> <div class="zpl_minr"> <a class="_cls PI_cls"></a> <div class="zpl_mcnt"> <div class="alert_contain"> <i class="ico success"></i> <div class="cont"> <h3>${title}</h3> <p>${content}</p> </div> </div> </div> <div class="zpl_mfoter"> <button type="button" id="confirmButton" class="zlabel zlabel--blue zlabel--medium MR10">${ZPI18N.getString("zp.confirm")}</button> <button type="button" id="cancelButton" class="zlabel zlabel--outline zlabel--medium">${ZPI18N.getString("zp.cancel")}</button> </div> </div> </div>`;return $(html)[0]},initSelect:function(ele,selectParams,selectOptions,defaultValue){if(selectOptions&&selectOptions.length>7){var searchParams={};searchParams.by=selectParams&&selectParams.dataMapping?selectParams.dataMapping.text:"label",selectParams.search=searchParams,selectParams.showSearchField=!0}selectParams.dropdownList={fitForElement:!0};var selectComponent=ZPeopleComponents.select(ele,selectParams);selectOptions&&selectOptions.length>0&&selectComponent.addOption(selectOptions),selectComponent.setValue(defaultValue)},getConsentPopup:function(data,isBodyHtml){return`<div id="usersConsentPopup" class="zpl_mdl zpl_malrtmsg zpl_mopen"><div class="zpl_minr"><a id="alrtCls" class="_cls PI_cls"></a><div class="zpl_mcnt"><div class="alert_contain"><i class="ico info"></i><div class="cont"><h3>${data.header}</h3>${isBodyHtml?data.body:`<p class="">${data.body}</p>`}</div><div class="zpl_secn DN "><div id="centrHt"></div></div></div></div><div class="zpl_mfoter"><button id="yesBtn" type="button" class="zlabel zlabel--yellow zlabel--medium">${data.submitBtn}</button><button id="cnlBtn" type="button" class="zlabel zlabel--outline zlabel--medium">${data.cancelBtn}</button></div></div></div>`}},Users.components.addUser={addUserOuterModal:function(id){return`<div data-modal-box="${id}" id="${id}" class="zpl_mdl zpl_mfull zpl_mdltopnav">\n\t\t\t<div class="zpl_minr">\n\t\t\t  <div class="zpl_mhder">\n\t\t\t\t<div>\n\t\t\t\t  <a class="clsArw zpl_DNI" id="${id+"-previousBtn"}"><i class="PI_back"></i></a>\n\t\t\t\t  <h4>${ZPI18N.getString("zp.settaddUsers")}</h4>\n\t\t\t\t</div>\n\t\t\t\t<a class="_cls PI_cls" id="${id+"-closeBtn"}"></a>\n\t\t\t  </div>\n\t\t  \n\t\t\t  <div class="zpl_mcnt">\n\t\t\t\t<div class="zpl_mmnu">\n\t\t\t\t  <div class="zpl_mmnulft">\n\t\t\t\t\t<ul id="${id+"-progressBar"}">\n\t\t\t\t\t</ul>\n\t\t\t\t  </div>\n\t\t\t\t  <div class="zpl_mmnurgt" id="${id+"-contWrap"}">\n\t\t\t\t  </div>\n\t\t\t\t</div>\n\t\t\t  </div>\n\t\t  \n\t\t\t  <div class="zpl_mfoter zpl_btnsplt" id="${id+"-footer"}">\n\t\t\t  </div>\n\t\t  \n\t\t\t</div>\n\t\t  </div>`},constructPostAddActionsForm:function(toggleCallback){let postAddActionCard=$('<div id="postAddActionCard"></div>'),onboardingCard=$(`\n\t\t\t\t\t<div class="zpl_crd" id="userOnboardingSection">\n\t\t\t\t\t\t<div class="zpl_crdhdr">\n                        \t<div>\n                            \t<h5>${ZPI18N.getString("zp.triggeronboadring")}</h5>\n                        \t</div>\n                    \t</div>\n\t\t\t\t\t\t<div class="zpl_crdcnt">\n\t\t\t\t\t\t\t<div class="zpl_secn"> \n\t\t\t\t\t\t\t\t<div> \n\t\t\t\t\t\t\t\t\t<p>${ZPI18N.getString("zp.onbwillbetriggered")}</p>\n\t\t\t\t\t\t\t\t</div> \n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<div class="zradiobutton zradiobutton--horizontal"> \n\t\t\t\t\t\t\t\t\t\t<input type="radio" id="userOnboardingEnable" class="zradiobutton__helper"> \n\t\t\t\t\t\t\t\t\t\t<label class="zradiobutton__label"><span class="zradiobutton__text">Yes</span></label> \n\t\t\t\t\t\t\t\t\t</div> \n\t\t\t\t\t\t\t\t\t<div class="zradiobutton zradiobutton--horizontal"> \n\t\t\t\t\t\t\t\t\t\t<input type="radio" id="userOnboardingDisable" class="zradiobutton__helper" checked="checked"> \n\t\t\t\t\t\t\t\t\t\t<label class="zradiobutton__label"><span class="zradiobutton__text">No</span></label> \n\t\t\t\t\t\t\t\t\t</div> \n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`);onboardingCard.find(".zradiobutton").on("click",function(){toggleCallback("#userOnboardingSection",$(this))}),Users.config.isOnboarding&&postAddActionCard.append(onboardingCard);let workflowCard=$(`\n\t\t\t\t\t<div class="zpl_crd" id="userWorkflowSection">\n\t\t\t\t\t<div class="zpl_crdhdr">\n                        <div>\n                            <h5>${ZPI18N.getString("zp.adduser.initiateworkflow")}</h5>\n                        </div>\n                        <span class="zpl_flex zpl_items-end"><a class="zpl_link" id="manageWorkflow">${ZPI18N.getString("zp.adduser.manageworkflows")}</a></span>\n                    \t</div>\n\t\t\t\t\t\t<div class="zpl_crdcnt">\n\t\t\t\t\t\t\t<div class="zpl_secn"> \n\t\t\t\t\t\t\t\t<div> \n\t\t\t\t\t\t\t\t\t<p>${ZPI18N.getString("zp.adduser.allworkflowwillbetriggered")}</p>\n\t\t\t\t\t\t\t\t</div> \n\t\t\t\t\t\t\t\t<div> \n\t\t\t\t\t\t\t\t\t<div class="zradiobutton zradiobutton--horizontal"> \n\t\t\t\t\t\t\t\t\t\t<input type="radio" id="userWorkflowEnable" class="zradiobutton__helper" checked="checked"> \n\t\t\t\t\t\t\t\t\t\t<label class="zradiobutton__label"><span class="zradiobutton__text">Yes</span></label> \n\t\t\t\t\t\t\t\t\t</div> \n\t\t\t\t\t\t\t\t\t<div class="zradiobutton zradiobutton--horizontal"> \n\t\t\t\t\t\t\t\t\t\t<input type="radio" id="userWorkflowDisable" class="zradiobutton__helper"> \n\t\t\t\t\t\t\t\t\t\t<label class="zradiobutton__label"><span class="zradiobutton__text">No</span></label> \n\t\t\t\t\t\t\t\t\t</div> \n\t\t\t\t\t\t\t\t</div> \n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`);return workflowCard.find(".zradiobutton").on("click",function(){toggleCallback("#userWorkflowSection",$(this))}),workflowCard.find("#manageWorkflow").on("click",function(){let manageWorkflowUrl=new URL(window.location.href);manageWorkflowUrl.hash="#settings/service/organization/workflow-formid:"+Users.config.formId,window.open(manageWorkflowUrl.href,"_blank")}),postAddActionCard.append(workflowCard),postAddActionCard},userLicenseRow:function(config){var html=`<div class="zpl_crd BGT">\n                <div class="zpl_btnmnu BGT P0I mhauto">\n                    <div class="zpl_nowrap">\n                        <ul class="zpl_grpmnulnelst">\n                            <li>${ZPI18N.getString("zp.totallicense")} <b class="ylw"> ${config.usersMax}</b></li>\n                            <li>${ZPI18N.getString("zp.usersadded")} <b class="ylw"> ${config.usersAdded}</b></li> `;if((Layout.isZohoOne||Layout.isPeoplePlus)&&void 0!=config.otherAppLicense&&0!=config.otherAppLicense&&-1!=config.otherAppLicense){var bundleName=Layout.isPeoplePlus?"People Plus":"Zoho One";html+=` <li>${ZPI18N.getString("zp.otherappsusage",[bundleName])} <b class="ylw"><a href="${config.adminPanelAppsPageUrl}" target="_blank"> ${config.otherAppLicense}</a></b></li> `}return html+=` <li>${ZPI18N.getString("zp.remaining")}: <b class="ylw"> ${config.usersLeft}</b> `,html+="</li>                       \n                        </ul>\n                    </div>\n                </div>\n                </div>",(html=$(html))[0].outerHTML},initLocation:function(html,id,config){if(config.locAdminDetails){$(html).find(id+"Section").removeClass("DN"),id.indexOf("Import")>0&&($(html).find(id+"Label").show(),$(html).find(id).removeClass("DN"));for(var locs=[],i=0;i<config.locAdminDetails.length;i++){var loc={},locDetail=config.locAdminDetails[i];loc.value=Object.keys(locDetail)[0],loc.label=locDetail[loc.value],locs.push(loc)}Users.components.initSelect($(html).find(id),{},locs,locs[0].value)}},directAddForm:function(config,instance){let empIdGenButton=config.isPermAllowedForEmpId?"<button "+(ZPeople.EmployeeIDGenEnabled?"":'style="cursor: default;"')+` elem="empIdGenButton" type="button" class="zlabel zlabel--medium zlabel--outline">${ZPI18N.getString("zp.gen")}</button>`:"";var html=`<form id="directUserForm"> <div id="directUserSection" class="zpl_crd"> <div class="zpl_crdcnt"> <div class="zpl_hdcnt zpl_DNI"> <ul class="zpl_tabpane"> <li id="singleDirectTab" class="zpl_act" onclick="Users.operations.add.toggleSingleMultipleInterface('direct')"> <a>${ZPI18N.getString("zp.singleadd")}</a></li> <li id="multipleDirectTab" onclick="Users.operations.add.toggleSingleMultipleInterface('direct')"> <a>${ZPI18N.getString("zp.multipleadd")}</a></li> </ul> </div> <div class="zpl_secn"> <div> <div id="singleDirectInfo" class="zpl_info"><em>${ZPI18N.getString("zp.addempnotes")}</em></div> <div id="multipleDirectInfo" class="zpl_info DN"> <em>${ZPI18N.getString("zp.addmultiusersnotes")}</em></div> </div> </div> <div class="zpl_secn"> <div> <div class="zpl_tgsprt"> <h5 class="zpl_tgl"><input id="agpPassword" class="togbutton-js"> Auto-Generated Password </h5> <p>This auto-generated password will be send to your email address</p> </div> </div> </div> <div class="zpl_secn zpl_tabcnt"> <div id="singleDirect"> <div id="userIdSection" class="zpl_secn"> <div><label class="zpl_mtry">${config.empidDispName}</label></div> <div class="ztextbox--group zh-alignright zpl_flexaligngap3"><input type="text" id="userId" class="ztextbox">${empIdGenButton}</div><span class="tagtxt">${ZPI18N.getString("zp.lastemployeeid")} ${Users.config.lastEmployeeId}</span> </div> <div id="userFirstnameSection" class="zpl_secn"> <div><label class="zpl_mtry">${config.fnameDispName}</label></div> <div><input type="text" id="userFirstname" class="ztextbox"></div> </div> <div id="userLastnameSection" class="zpl_secn"> <div><label ${Users.config.isLastNameMand?'class="zpl_mtry"':""}>${config.lnameDispName}</label></div> <div><input type="text" id="userLastname" class="ztextbox"></div> </div> <div id="userEmailSection" class="zpl_secn"> <div><label class="zpl_mtry">${config.emailDispName}</label></div> <div> <input type="text" id="userUsername" class="ztextbox" style="width:57%"> @ <select id="userDomain" class="select-js" style="width:40%"></select> </div> </div> <div id="userPasswordSection" class="zpl_secn"> <div id="manualPassword" class="DN"> <div><label class="zpl_mtry">${ZPI18N.getString("zp.passwd")}</label></div> <input id="userPassword" type="password" class="ztextbox mt10" placeholder="Enter Password"> </div> </div> <div id="directUserForm-single-userLocationSection" class="zpl_secn DN"> <div><label class="zpl_mtry">${config.locationDispName}</label></div> <div><select id="directUserForm-single-userLocation" class="select-js"></select></div> </div> </div> </div> <div id="multipleDirect" class="zpl_secn DN"> <div class="zpl_tblres"> <table class="zpl_tbl"> <thead> <tr> <th style="width: 100%;">${ZPI18N.getString("zp.username")}</th> <th>${ZPI18N.getString("zp.domain")}</th> <th class="manualPasswordTd DN">${ZPI18N.getString("zp.passwd")}</th> <th class="locationTd DN">${config.locationDispName}</th> </tr> </thead> <tbody> </tbody> </table> <div class="zpl_idiv"> <a id = "addNewBtn" class="zpl_lnkbg"><i class="PI_plus"></i>${ZPI18N.getString("zp.addnew")}</a> </div> </div> </div> </div> </div> </div> </form>`;html=$(html)[0],$(html).find("#addNewBtn").on("click",ele=>{instance.constructDirectRow()}),config.locAdminDetails&&(Users.components.initLocation(html,"#directUserForm-single-userLocation"),$(html).find(".locationTd").removeClass("DN")),config.isOnboarding||$(html).find("#userOnboardingSection").addClass("DN"),ZPeopleComponents.toggleswitch($(html).find("#directUserSection #agpPassword"),{on:!0,change:event=>{instance.toggleSinglePassword(event)}});return config.userDomains.length>0&&Users.components.initSelect($(html).find("#singleDirect #userDomain"),{dataMapping:{label:"ORG_DOMAIN",text:"ORG_DOMAIN",value:"ORG_DOMAIN"}},config.userDomains,config.userDomains[0].ORG_DOMAIN),html},directAddRow:function(directRows,config){var html=`<tr> <td><input type="text" id="userUsername-${directRows}" class="ztextbox" style=" width: 100%; "></td> <td><select id="userDomain-${directRows}" class="select-js"></select></td> <td class="manualPasswordTd DN"><input type="text" id="userPassword-${directRows}" class="ztextbox" placeholder="Enter Password"></td> <td class="locationTd DN"><select id="userLocation-${directRows}" class="select-js"></select></td> <td onclick="Users.operations.add.deleteDirectRow(this)"><i class="PI_delete"></i></td> </tr>`;html=$(html)[0];return config.userDomains.length>0&&Users.components.initSelect($(html).find("#userDomain-"+directRows),{dataMapping:{label:"ORG_DOMAIN",text:"ORG_DOMAIN",value:"ORG_DOMAIN"}},config.userDomains,config.userDomains[0].ORG_DOMAIN),html},notificationConfirmation(toggleFn){let ele=$(`<div class="zpl_crd">\n\t\t\t\t<div class="zpl_crdcnt">\n\t\t\t\t\t<div class="zpl_secn">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<h5>Do you want to notify employees by mail</h5>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class="zradiobutton zradiobutton--horizontal">\n\t\t\t\t\t\t\t\t<input type="radio" value="yes" class="zradiobutton__helper" checked="">\n\t\t\t\t\t\t\t\t<label class="zradiobutton__label">\n\t\t\t\t\t\t\t\t\t<span class="zradiobutton__text">${ZPI18N.getString("zp.yes")}</span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="zradiobutton zradiobutton--horizontal">\n\t\t\t\t\t\t\t\t<input type="radio" value="no" class="zradiobutton__helper">\n\t\t\t\t\t\t\t\t<label class="zradiobutton__label">\n\t\t\t\t\t\t\t\t\t<span class="zradiobutton__text">${ZPI18N.getString("zp.no")}</span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="zpl_secn">\n\t\t\t\t\t\t<div class="zpl_info">\n\t\t\t\t\t\t<em>${ZPI18N.getString("zp.notifyUsersByMail")}</em>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`);return ele.find(".zradiobutton").on("click",function(){toggleFn($(this))}),ele},basicInfoDummyHtml:function(){return'<div class="zpl_crd"><div class="zpl_crdhdr"><div><h4>Basics Info</h4></div></div><div class="zpl_crdcnt"><div class="zpl_frmclm zpl_frmclmlst"><div><div class="zpl_secn"><div>\t<label class="zpl_mtry">EmployeeID</label></div><div><input type="text" class="ztextbox ztextbox__error" value="3001"><span class="ztextbox--error__label">EmployeeID is required.</span><div class="zpl_hvr"><i class="PI_plus" data-popup-open="quickadd"></i></div></div></div><div class="zpl_secn"><div>\t<label class="zpl_mtry">Decision Box</label></div><div><div class="zcheckbox mt10"><input type="checkbox" class="zcheckbox__helper" checked=""><label class="zcheckbox__label"><span class="zcheckbox__text"></span></label></div></div></div><div class="zpl_secn"><div>\t<label>Email ID</label></div><div>\t<input type="text" class="ztextbox" value="Augustemployee@gmail.com"></div></div><div class="zpl_secn"><div>\t<label>First Name</label></div><div>\t<input type="text" class="ztextbox" value="Kim"></div></div><div class="zpl_secn"><div>\t<label>Last Name</label></div><div>\t<input type="text" class="ztextbox" value="Woo Bin"></div></div><div class="zpl_secn zpl_addlds"><div><label>Address</label></div><div class="d-flexclmcap"><div class="zcheckbox"><input type="checkbox" class="zcheckbox__helper" checked=""><label class="zcheckbox__label">\t<span class="zcheckbox__text">Same as Present Address</span></label></div><div><input readonly="" placeholder="Address 1" class="ztextbox"></div><div><input readonly="" placeholder="Address 2" class="ztextbox"></div><div class="zpl_ilnegap"><div><input readonly="" placeholder="City" class="ztextbox"></div><div>\t<select class="zselectbox select-js" style="display: none;">\t<option value="0" data-zitemid="zselect-zselect-21329795-listbox-option-0">State</option>\t<option value="1" data-zitemid="zselect-zselect-21329795-listbox-option-1"></option>\t</select><div aria-disabled="false" aria-haspopup="listbox" aria-owns="zselect-21329795-listbox" aria-required="false" id="zselect-21329795-container" role="listbox" tabindex="0" aria-activedescendant="zselect-zselect-21329795-listbox-option-0" title="" class="zselectbox select-js">\x3c!----\x3e<div class="zselectbox__selected"> \x3c!----\x3e\x3c!----\x3e \x3c!----\x3e \x3c!----\x3e \x3c!----\x3e<span class="zselectbox__text">\x3c!----\x3eState\x3c!----\x3e</span>\x3c!----\x3e </div> \x3c!----\x3e \x3c!----\x3e<i class="zselectbox__icon zselectbox__arrowicon"> \x3c!----\x3e<svg class="zselectbox__arrow" focusable="false"> <use xlink:href="#zc__svg--downarrow"></use></svg>  </i>\x3c!----\x3e\x3c!----\x3e</div></div></div><div class="zpl_ilnegap"><select class="zselectbox select-js" style="display: none;"><option value="0" data-zitemid="zselect-zselect-33769644-listbox-option-0">Country</option><option value="1" data-zitemid="zselect-zselect-33769644-listbox-option-1"></option></select><div aria-disabled="false" aria-haspopup="listbox" aria-owns="zselect-33769644-listbox" aria-required="false" id="zselect-33769644-container" role="listbox" tabindex="0" aria-activedescendant="zselect-zselect-33769644-listbox-option-0" title="" class="zselectbox select-js">\x3c!----\x3e<div class="zselectbox__selected"> \x3c!----\x3e\x3c!----\x3e \x3c!----\x3e \x3c!----\x3e \x3c!----\x3e<span class="zselectbox__text">\x3c!----\x3eCountry\x3c!----\x3e</span>\x3c!----\x3e </div> \x3c!----\x3e \x3c!----\x3e<i class="zselectbox__icon zselectbox__arrowicon"> \x3c!----\x3e<svg class="zselectbox__arrow" focusable="false"> <use xlink:href="#zc__svg--downarrow"></use></svg>  </i>\x3c!----\x3e\x3c!----\x3e</div><input readonly="" placeholder="Postal Code" class="ztextbox"></div></div></div></div><div><div class="zpl_secn"><div>\t<label>Date of joining</label></div><div>\t<input class="datepicker-js" data-placeholder-type="date-format-in-lower" data-format="dd-MM-yyyy" data-picker="true" data-calendar-icon="true" data-clear-button="none" data-spin-buttons="none" style="display: none;"><div tabindex="-1" role="spinbutton" id="zdatefield-84068947-container" class="zinputfield--withcalendaricon zinputfield zdatetimefield zinputfield--spinbtnnone" aria-owns="zdatefield-84068947-container-picker" aria-expanded="false">\x3c!----\x3e\x3c!----\x3e \x3c!----\x3e<input class="zinputfield__textbox" tabindex="0" placeholder="dd-mm-yyyy"> \x3c!----\x3e \x3c!----\x3e\x3c!----\x3e<div class="zdatetimefield__iconlabel">\x3c!----\x3e<i class="zdatetimefield__icon"> \x3c!----\x3e<svg class="zbutton__svg" focusable="false"> <use xlink:href="#zc__svg--calendaricon"></use></svg>  </i>\x3c!----\x3e</div>\x3c!----\x3e \x3c!----\x3e \x3c!----\x3e\x3c!----\x3e\x3c!----\x3e</div></div></div><div class="zpl_secn"><div>\t<label>Department (Read Only)</label></div><div>\t<input type="text" readonly="" class="ztextbox" value="Marketting"></div></div><div class="zpl_secn"><div>\t<label>Location</label></div><div>\t<input type="text" class="ztextbox" value="Mumbai"></div></div><div class="zpl_secn"><div>\t<label>Mail Alias</label></div><div>\t<input type="text" class="ztextbox" value=""></div></div></div>  </div></div></div>'},syncUserRow:function(dispName,emailId,photo){return`<tr> <td> <div class="zcheckbox"> <input type="checkbox" name="${dispName}" value=${emailId} class="zcheckbox__helper"> <label class="zcheckbox__label"></label> </div> </td> <td> <div class="zpl_em">  ${photo?`<div class="zpl_emimg"><img src="${photo}"></div>`:""} <div class="zpl_emdts"> <div class="zpl_w-100"><em>${dispName} - </em><b>${emailId}</b></div> </div> </div> </td> </tr>`},syncUserFormTableHtml(mode,fn){var id="sync"+mode+"UserForm";let html=$(`<div class="zpl_crd"> <div class="zpl_crdhdr zpl_crdhdrcnt"> <div> <div class="zpl_idiv"> <div class="zpl_search zpl_srchsml w300"> <input id="${id}-search" placeholder="Search" class="ztextbox" onkeyup = "Users.operations.add.searchSync(this, '${mode}')"><i class="PI_lens"></i></div> </div> </div> <div class="zpl_posnon"> <div class="zpl_idiv"><span>Total User</span> <b id="${id}-count"><i></i></b></div> </div> </div> <div class="zpl_crdcnt"> <div class="zpl_secn"> <div> <div class="zpl_tblres"> <table class="zpl_tbl zpl_w-100"> <thead> <tr> <th width="5%"> <div class="zcheckbox"> <input id="massChecked" type="checkbox" name="userListCheckBox" class="zcheckbox__helper"> <label class="zcheckbox__label"></label> </div> </th> <th width="95%">Basic Information</th> </tr> </thead> <tbody> </tbody> </table> </div> </div> </div> </div> </div>`);return html.find(".zcheckbox").on("click",function(){fn($(this),$(this).attr("id"))}),html},syncSummary:function(toggleFn){let ele=$(`<div class="zpl_crd">\n\t\t\t<div class="zpl_crdhdr">\n\t\t\t\t<h4>${ZPI18N.getString("zp.importuserssummary")}</h4>\n\t\t\t</div>\n\t\t\t<div class="zpl_crdcnt zpl_fm">\n\t\t\n\t\t\t\t<div class="zpl_btnmnu">\n\t\t\t\t\t<div class="">\n\t\t\t\t\t\t<ul class="zpl_grpmnu">\n\t\t\t\t\t\t\t<li id="successHeader">${ZPI18N.getString("zp.successrecords")} </li>\n\t\t\t\t\t\t\t<li id="errorHeader">${ZPI18N.getString("zp.errorrecords")} </li>\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div id="successBody" class="summaryBody zpl_DNI">\n\t\t\t\t\t<div class="zpl_rgtcnt">\n\t\t\t\t\t\t<div class="zpl_tblres">\n\t\t\t\t\t\t\t<table class="zpl_tbl zpl_w-100">\n\t\t\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<th>${ZPI18N.getString("zp.email")}</th>\n\t\t\t\t\t\t\t\t\t\t<th>${ZPI18N.getString("zp.message")}</th>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div id="errorBody" class="summaryBody zpl_DNI">\n\t\t\t\t\t<div class="zpl_rgtcnt">\n\t\t\t\t\t\t<div class="zpl_tblres">\n\t\t\t\t\t\t\t<table class="zpl_tbl zpl_w-100">\n\t\t\t\t\t\t\t\t<thead>\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<th>${ZPI18N.getString("zp.email")}</th>\n\t\t\t\t\t\t\t\t\t\t<th>${ZPI18N.getString("zp.message")}</th>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</thead>\n\t\t\t\t\t\t\t\t<tbody> \n\t\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>`);return ele.find("#successHeader , #errorHeader").on("click",function(){toggleFn($(this))}),ele},UserAdditionMenu:function(callbackFn){let html=`<div class="zpl_crd">  \n\t\t\t\t<div class="zpl_crdcnt">\n\t\t\t\t\t<div class="zpl_addusr">\n\t\t\t\t\t\t${Users.operations.add.isBundleRedirectionAllowed()&&!Layout.isPeoplePlus?`<div mode="bundle">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<i class="${Layout.isZohoOne?"zpl_zohoone":Layout.isPeoplePlus?"zpl_ppluslogo":"PI_invtusr"}"></i>\n\t\t\t\t\t\t\t\t<label>${Layout.isZohoOne?ZPI18N.getString("zp.zohoOne"):Layout.isPeoplePlus?ZPI18N.getString("zp.peoplePlus"):ZPI18N.getString("zp.invitation")}</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<p>${Layout.isZohoOne?ZPI18N.getString("zp.addusersfrombundle",[ZPI18N.getString("zp.zohoOne")]):Layout.isPeoplePlus?ZPI18N.getString("zp.addusersfrombundle",[ZPI18N.getString("zp.peoplePlus")]):ZPI18N.getString("zp.inviteuserInfo")}</p>\n\t\t\t\t\t\t\t</div>`:`<div mode="invite">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<i class="PI_invtusr"></i>\n\t\t\t\t\t\t\t\t<label>${ZPI18N.getString("zp.invitation")}</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<p>${ZPI18N.getString("zp.inviteuserInfo")}</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t${Users.config.isAddUserDirectlyAllowed?`\n\t\t\t\t\t\t\t<div mode="direct">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<i class="PI_mail"></i>\n\t\t\t\t\t\t\t\t\t<label>${ZPI18N.getString("zp.domainemail")}</label>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<p>${ZPI18N.getString("zp.adduserdirectlyInfo")}</p>\n\t\t\t\t\t\t\t</div>`:""}`}\n\t\t\t\t\t\t\t<div mode = "Zoho">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<i class="PI_zmail">\n\t\t\t\t\t\t\t\t\t\t<i class="path1"></i>\n\t\t\t\t\t\t\t\t\t\t<i class="path2"></i>\n\t\t\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t\t\t\t<label>${ZPI18N.getString("zp.tyex.mail")}</label>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<p>${ZPI18N.getString("zp.syncfromzohoInfo")}</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div mode="GApps">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<i class="PI_gglsync">\n\t\t\t\t\t\t\t\t\t\t<i class="path1"></i>\n\t\t\t\t\t\t\t\t\t\t<i class="path2"></i>\n\t\t\t\t\t\t\t\t\t\t<i class="path3"></i>\n\t\t\t\t\t\t\t\t\t\t<i class="path4"></i>\n\t\t\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t\t\t\t<label>${ZPI18N.getString("zp.googleworkspace")}</label>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<p>${ZPI18N.getString("zp.syncfromgappsInfo")}</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div mode="Office365">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<i class="PI_msofc"></i>\n\t\t\t\t\t\t\t\t\t<label>${ZPI18N.getString("zp.ms.title")}</label>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<p>${ZPI18N.getString("zp.syncfromoffice365Info")}</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`;return(html=$(html)).on("click","[mode]",function(){callbackFn($(this),$(this).attr("mode"))}),html}},Users.operations={view:{constructList:function(resultData,paramsObj,extraParams){var currentPageId=extraParams.pageId;$("#"+currentPageId).find("div#zp_page_loading").remove(),Users.operations.view.constructMenu(resultData,paramsObj,extraParams),Users.operations.view.constructTable(resultData,paramsObj,extraParams),Users.operations.view.constructFilters(resultData,paramsObj,extraParams)},constructMenu:function(resultData,paramsObj,extraParams){var currentPageId=extraParams.pageId,html=Users.components.listViewMenu(currentPageId),menuDiv=$('<div id="topSettMenu" class="zpl_btnmnu"></div>').prependTo($("#"+currentPageId));menuDiv.html(""),menuDiv.removeClass("zp_dyn"),menuDiv.append(html),Users.components.listViewMenuInit(currentPageId);var filterBreadcrumbHtml=Users.components.filterBreadcrumb(currentPageId);menuDiv.after(filterBreadcrumbHtml)},constructTable:function(resultData,paramsObj,extraParams){Users.operations.view.constructTableHeader(resultData,paramsObj,extraParams),Users.operations.view.constructTableBody(resultData,paramsObj,extraParams)},constructFilters:function(resultData,paramsObj,extraParams){var currentPageId=extraParams.pageId,html=Users.components.filter(resultData,paramsObj,extraParams);$("#"+currentPageId).append(html);let searchValueBox=$("#"+currentPageId).find("#"+currentPageId+"-searchVal");searchValueBox.on("focus",()=>{searchValueBox.parent().addClass("is-active")}),searchValueBox.on("blur",()=>{searchValueBox.parent().removeClass("is-active")})},constructTableHeader:function(resultData,paramsObj,extraParams){var currentPageId=extraParams.pageId,html=Users.components.listViewTableHeader(resultData,paramsObj,currentPageId);$("#"+currentPageId).find("#"+currentPageId+"-filterBreadcrumb").after(html),$("#"+currentPageId).addClass("zpl_tblfxd zpl_tbllftfxd lft2")},constructTableBody:function(data,paramsObj,extraParams){var currentPageId=extraParams.pageId,isScroll=!!extraParams&&extraParams.isScroll;Users.common.setConfigurations(data,paramsObj,extraParams);var usersListRowObj=Users.components.listViewTableBody(data,paramsObj,extraParams),isEmpty=!1;0!==data.usersDtls.length||isScroll?$("#"+currentPageId).find("table#userListTable thead").removeClass("DN"):($("#"+currentPageId).find("table#userListTable thead").addClass("DN"),isEmpty=!0),isScroll||$("#"+currentPageId).find("#userListTable tbody").remove(),$("#"+currentPageId).find("#userListTable").append(usersListRowObj),isEmpty?($("#"+currentPageId).find("#userListTable").hide(),0!=$("#"+currentPageId).find(".zpl_tblres #emptPage").length&&$("#"+currentPageId).find(".zpl_tblres #emptPage").remove(),extraParams.isFromFilter?$("#"+currentPageId).find(".zpl_tblres").append(Users.components.noRecordForFilterPage()):$("#"+currentPageId).find(".zpl_tblres").append(Users.components.noRecordsPage())):($("#"+currentPageId).find("#userListTable").show(),$("#"+currentPageId).find(".zpl_tblres #emptPage").remove()),$("#"+currentPageId).find("table#userListTable").data({startInd:data.startInd}),data.usersDtls.length==Users.config.scrollLimit&&settingsPage.fireScrollObj[Users.common.getCurrentPageId()].reset()},toggleFilters:function(fieldId){settingsPage.container.toggleClass("zpl_fltr_flt"),settingsPage.container.hasClass("zpl_fltr_flt")&&Users.operations.view.togggleFilterFeilds(fieldId)},togggleFilterFeilds:function(fieldId){fieldId&&(-1!=fieldId.indexOf("searchVal")?document.querySelector(fieldId).focus():ZPeopleComponents.select(document.querySelector(fieldId)).open())},closeFilters:function(){settingsPage.container.removeClass("zpl_fltr_flt")},resetFilter:function(){var pageid=Users.common.getCurrentPageId();["searchType","searchVal","roleFilter","locationFilter","employeestatusFilter","OnboardingFilter"].filter(id=>{id=`#${pageid}-${id}`;var filterData=settingsPage.container.find(id);0!=filterData.length&&(id===`#${pageid}-searchVal`?filterData.val(""):id===`#${pageid}-employeestatusFilter`?ZPeopleComponents.select(filterData).setValue("All Status"):id===`#${pageid}-OnboardingFilter`?ZPeopleComponents.select(filterData).setValue("-1"):ZPeopleComponents.select(filterData).setValue("0"))})},changeSearchPlaceholder:function(event){var pageId=Users.common.getCurrentPageId(),searchText=ZPI18N.getString("zp.searchUser");if("user"!=Users.config.currMode&&(searchText=ZPI18N.getString("zp.searchnonuser")),event.target.val()>0){var label=settingsPage.container.find("#"+event.target[0].id+" :selected")[0].optData.label;settingsPage.container.find(`input#${pageId}-searchVal`).attr("placeholder",searchText+" "+label)}},getParamsFromFilter:function(isScroll,currentPageId){var pageContent=$("#"+currentPageId),params={};if(params.searchByDept=pageContent.find(`#${currentPageId}-departmentFilter`).val(),params.searchByRole=pageContent.find(`#${currentPageId}-roleFilter`).val(),params.searchByLoc=pageContent.find(`#${currentPageId}-locationFilter`).val(),params.searchByEmpStatus=pageContent.find(`#${currentPageId}-employeestatusFilter`).val(),params.searchByOnbStatus=pageContent.find(`#${currentPageId}-OnboardingFilter`).val(),params.userStatus=Users.common.getCurrentStatus(),params.sortByType=Users.config.currentSortType.hasOwnProperty(currentPageId)?Users.config.currentSortType[currentPageId]:Users.config.currentSortType.default,!(isScroll&&(params.startInd=pageContent.find("table#userListTable").data("startInd"),params.startInd%Users.config.scrollLimit>1))){var searchVal=pageContent.find(`#${currentPageId}-searchVal`).val(),searchType=pageContent.find(`#${currentPageId}-searchType`).val();return ZPSetupCommon.isEmpty(searchVal)||(params.searchval=searchVal,params.searchType=searchType),params.isAjax=!0,"employeeprofile"===Users.config.currMode&&(params.userType=3),params}},submitFilter:function(extraParams,callback){var params={};extraParams||(extraParams={}),extraParams.pageId||(extraParams.pageId=Users.common.getCurrentPageId()),callback=callback||Users.operations.view.handleSubmitFilterResponse;var currentPageId=extraParams.pageId;if(extraParams.isScroll||($("#"+currentPageId).find(`a#${currentPageId}-hashTotalCount`).removeClass("DN"),$("#"+currentPageId).find(`b#${currentPageId}-totalCount`).addClass("DN")),extraParams.useFilterParams){var filterParams="employeeprofile"===Users.config.currMode?Users.config.nonuserFilterParams:Users.config.userFilterParams;params={},Object.assign(params,filterParams)}else(params=Users.operations.view.getParamsFromFilter(extraParams.isScroll,currentPageId)).searchval&&(params.searchval=encodeURIComponent(params.searchval));params&&!$.isEmptyObject(params)&&ZPeople.Request.send("/users/getUsersListing",params,callback,extraParams)},handleSubmitFilterResponse:function(data,resultParams,extraParams){Users.operations.view.constructTableBody(data,resultParams,extraParams),extraParams&&extraParams.isScroll||Users.operations.view.addFilterInView(extraParams)},addFilterInView:function(extraParams){var currentPageId=extraParams.pageId,params=Users.operations.view.getParamsFromFilter(!1,currentPageId),pageContent=settingsPage.container,currMode=Users.config.currMode,searchval=params.hasOwnProperty("searchval")?params.searchval:"",searchType=params.hasOwnProperty("searchType")?params.searchType:"0",filterBreadcrumb=$(pageContent).find("#"+currentPageId+"-filterBreadcrumb").find("#"+currentPageId+"-filterBreadcrumbList");filterBreadcrumb.empty();var breadcrumbParams={};let label=[];"0"!=searchType&&(label=["Search Type",value=pageContent.find(`#${currentPageId}-searchType :selected`)[0].optData.label],breadcrumbParams.searchType=label);if(""!=searchval&&(label=["user"==currMode?ZPI18N.getString("zp.searchUser"):ZPI18N.getString("zp.searchnonuser"),searchval],breadcrumbParams.searchVal=label),"0"!=params.searchByRole){var value=pageContent.find(`#${currentPageId}-roleFilter :selected`)[0].optData.label;label=[ZPI18N.getString("zp.role"),value],breadcrumbParams.roleFilter=label}if("0"!=params.searchByLoc){value=pageContent.find(`#${currentPageId}-locationFilter :selected`)[0].optData.label;label=[ZPI18N.getString("zp.location"),value],breadcrumbParams.locationFilter=label}if("All Status"!=params.searchByEmpStatus){value=pageContent.find(`#${currentPageId}-employeestatusFilter :selected`)[0].optData.label;label=[ZPI18N.getString("zp.employeestatus"),value],breadcrumbParams.employeestatusFilter=label}if("employeeprofile"!=currMode&&"-1"!=params.searchByOnbStatus){value=pageContent.find(`#${currentPageId}-OnboardingFilter :selected`)[0].optData.label;label=[ZPI18N.getString("zp.Onboarding"),value],breadcrumbParams.OnboardingFilter=label}if(Object.keys(breadcrumbParams).length>0){$("#"+currentPageId).addClass("zpl_fltrvwfxd"),$(settingsPage.container).find("#"+currentPageId+"-filterBreadcrumb").removeClass("DN");var resultHtml="",clearAllWidth=$("#"+currentPageId+"-breadcrumbClearAll").width(),breadcrumbBtnHtml=Users.components.filterBreadcrumbBtn(currentPageId);filterBreadcrumb.append(breadcrumbBtnHtml);var breadcrumbBtn=$(pageContent).find("#"+currentPageId+"-breadcrumbDropdownBtn"),breadcrumbBtnWidth=breadcrumbBtn.outerWidth(!0)+20;breadcrumbBtn=breadcrumbBtn.remove();var breadcrumbWrapperWidth=Math.floor($("#"+currentPageId+"-filterBreadcrumbWrapper").outerWidth(!0)+breadcrumbBtnWidth),filterBreadcrumbWidth=Math.floor($("#"+currentPageId+"-filterBreadcrumb").width()-clearAllWidth);let addMore=!1,filterCount=0;$.each(breadcrumbParams,function(key,value){!addMore&&breadcrumbWrapperWidth<=filterBreadcrumbWidth&&++filterCount<=4?((resultHtml=$(Users.components.addFilterBreadcrumb(currentPageId,value[0],value[1],key))).on("click",event=>{let fieldId="#"+currentPageId+"-"+key;settingsPage.container.hasClass("zpl_fltr_flt")?(Users.operations.view.togggleFilterFeilds(fieldId),settingsPage.container.removeClass("zpl_fltrvwfxd")):Users.operations.view.toggleFilters(fieldId)}),filterBreadcrumb.append(resultHtml),(breadcrumbWrapperWidth=Math.floor($("#"+currentPageId+"-filterBreadcrumbWrapper").outerWidth(!0)+breadcrumbBtnWidth))>=filterBreadcrumbWidth&&(filterBreadcrumb.find("li").last().remove(),addMore=!0)):addMore=!0}),addMore&&(filterBreadcrumb.append(breadcrumbBtn),$(pageContent).find("#"+currentPageId+"-breadcrumbDropdownBtn").on("click",()=>{Users.operations.view.toggleFilters()}))}else $(settingsPage.container).find("#"+currentPageId+"-filterBreadcrumb").addClass("DN"),$(settingsPage.container).removeClass("zpl_fltrvwfxd")},removeBreadcrumb:function(pageid,type){id=`#${pageid}-${type}`;var filterData=settingsPage.container.find(id);if(0!=filterData.length){if(id===`#${pageid}-searchVal`?filterData.val(""):id===`#${pageid}-employeestatusFilter`?ZPeopleComponents.select(filterData).setValue("All Status"):id===`#${pageid}-OnboardingFilter`?ZPeopleComponents.select(filterData).setValue("-1"):ZPeopleComponents.select(filterData).setValue("0"),settingsPage.container.find(id+"-breadcrumbItem").remove(),settingsPage.container.find("#"+pageid+"-filterBreadcrumbList").find("li").length<=0)return void Users.operations.view.removeBreadcrumbFromView(pageid);Users.operations.view.submitFilter({isFromFilter:!0})}},removeBreadcrumbFromView:function(pageid){settingsPage.container.find("#"+pageid+"-filterBreadcrumb").addClass("DN"),$("#"+pageid).removeClass("zpl_fltrvwfxd"),Users.operations.view.resetFilter(),Users.operations.view.submitFilter()},closeMultiSelectMenu:function(){Users.common.uncheckCheckBoxes(settingsPage.container,Users.common.getCurrentPageId())},clickSort:function(ele,type){var currentPageId=Users.common.getCurrentPageId();"name"===type?(ZPeopleComponents.menu("#"+currentPageId+"-nameSortMenuId",{forElement:ele}),ZPeopleComponents.menu("#"+currentPageId+"-nameSortMenuId").show()):(ZPeopleComponents.menu("#"+currentPageId+"-dojSortMenuId",{forElement:ele}),ZPeopleComponents.menu("#"+currentPageId+"-dojSortMenuId").show())},sortRecords:function(sortType,id){var currentPageId=Users.common.getCurrentPageId();3==sortType.split("_")[0]?$("#"+currentPageId+"-nameSortIcon").removeClass("asc").removeClass("desc"):$("#"+currentPageId+"-dojSortIcon").removeClass("asc").removeClass("desc"),1==sortType.split("_")[1]?(settingsPage.container.find("#"+id).addClass("asc"),settingsPage.container.find("#"+id).removeClass("desc")):(settingsPage.container.find("#"+id).addClass("desc"),settingsPage.container.find("#"+id).removeClass("asc")),Users.config.currentSortType[Users.common.getCurrentPageId()]=sortType,Users.operations.view.submitFilter(Users.common.getExtraParams())},filterByField:function(recId,membersCnt){var currPage=settingsPage.tabId.split("-")[2];membersCnt>0?("roles"===currPage?Users.config.userFilterParams.searchByRole=recId:"departments"===currPage?Users.config.userFilterParams.searchByDept=recId:Users.config.userFilterParams.searchByLoc=recId,window.location.href="#settings/service/accountsetup/users/all"):ZPeople.Message.warning(ZPI18N.getString("zp.norecfound"))},singleRecord:function(recId,mode,event){if($(event.target).is("td")||!$(event.target).closest("td").hasClass("actions-td")){var paramsObj={formId:Users.config.formId,recordId:recId,disableUrlTrack:!0,formMode:mode,modalCloseCallback:()=>{Users.operations.view.submitFilter(Users.common.getExtraParams())},notifycallback:()=>{Users.operations.view.submitFilter(Users.common.getExtraParams())}};ZP5Form.load(paramsObj)}},decodeText:function(label,object){for(var i in object)null==label?object[i]=ZPeople.decodeTxt(object[i]):object[i][label]=ZPeople.decodeTxt(object[i][label])}},add:{offlineWidgetPopup:void 0,sliderContainer:function(){return $("body #modal_Container")},checkLicense:function(mode,callback){var params={needAllDtls:!0,mode:mode};ZPeople.Request.send("/users/getAddUserPage",params,Users.operations.add.updateLicense,callback)},updateLicense:function(result,params,callback){var max,used,left;mode=params.mode,"user"==mode?(Users.config.isAllowToAddUser=result.isAllowToAddEmployee,Users.config.usersLeft=result.licenseCountLeft,Users.config.usersAdded=result.employeesAdded,Users.config.usersMax=result.totalLicenseCount,used=Users.config.usersAdded,left=Users.config.usersLeft,max=Users.config.usersMax,Users.config.isOnboarding=result.isOnboarding,Users.config.otherAppLicense=result.otherappLicense,Users.config.adminPanelAppsPageUrl=result.adminPanelAppsPageUrl):(Users.config.isAllowToAddNonuser=result.isAllowToAddEmployee,Users.config.nonusersLeft=result.licenseCountLeft,Users.config.nonusersAdded=result.employeesAdded,Users.config.nonusersMax=result.totalLicenseCount,used=Users.config.nonusersAdded,left=Users.config.nonusersLeft,max=Users.config.nonusersMax),Users.config.lastEmployeeId=result.lastEmployeeId,Users.operations.add.sliderContainer().find(`#${mode}-licenseRow #${mode}-licenseTotal`).text(`${max}`),Users.operations.add.sliderContainer().find(`#${mode}-licenseRow #${mode}-licenseAdded`).text(`${used}`),Users.operations.add.sliderContainer().find(`#${mode}-licenseRow #${mode}-licenseLeft`).text(`${left}`),Users.config.isPermAllowedForEmpId=result.isPermAllowedForEmpId,callback&&callback(result,params)},handleMenu:function(isConvert,mode){mode=Users.config.currMode;"user"!==(mode=isConvert?"user":mode)||isConvert?Users.operations.add.checkLicense(mode,Users.operations.add.toggleNonuserMenu):Users.operations.add.checkLicense(mode,Users.operations.add.toggleUserMenu)},isRedirectedToBundle:function(){return ZPUnifieduiUtil.isLoadedInOneZohoIFrame?(ZPUnifieduiUtil.addUser(),!0):""!=Users.config.addUserRedirectionalUrl&&(window.open(Users.config.addUserRedirectionalUrl,"_blank"),!0)},isBundleRedirectionAllowed:function(){return ZPUnifieduiUtil.isLoadedInOneZohoIFrame||""!=Users.config.addUserRedirectionalUrl},toggleUserMenu:function(result,params,mode){Users.config.isAllowToAddUser?Users.operations.add.initUserMenu(mode):Users.operations.add.handleNoLicense(result,params)},toggleNonuserMenu:function(result,params){params&&"user"===params.mode?Users.config.isAllowToAddUser?Users.operations.add.createConvertNonUserForm(result,params):Users.operations.add.handleNoLicense(result,params):Users.config.isAllowToAddNonuser?Users.operations.add.createNonUserForm(result,params):Users.operations.add.handleNoLicense(result,params)},closeofflineWidget:function(){ZPeopleComponents.select(document.getElementById("select_offline")).destroy(),Users.operations.add.offlineWidgetPopup.remove(),Users.operations.add.offlineWidgetPopup=void 0},showOfflineWidget:function(type){var allowedCount,params={zsoid:_LOGGEDIN_ACCZSOID,type:type,mode:"getcount"};ZPeople.Request.send("/users/updateOfflineUsers",params,function(resultData){if((allowedCount=resultData.count)<=0){var paymentErrKey=type==Subscription.userWidget?"zp.useraddmoresupport":"zp.employeeprofileaddmoresupport",paymentErrMsg=ZPI18N.getString(paymentErrKey,[ZPeople.peopleSupportEmail]);ZPeople.Message.showFailureMsg(paymentErrMsg)}else{var tab=new Tab;tab.id="offline_Popup",tab.cardId="offline_Cards",tab.setValidate(function(){var count=ZPeopleComponents.select(document.getElementById("select_offline")).getValue(),params={zsoid:_LOGGEDIN_ACCZSOID,type:type,count:count,mode:"update"};ZPeople.Request.send("/users/updateOfflineUsers",params,function(data){"Success"==data.msg?ZPeople.Message.success(ZPI18N.getString("zp.licenseupgraded")):People.Message.failure(ZPI18N.getString("zp.sorryservererror"))}),Users.operations.add.closeofflineWidget()});var title=type==Subscription.userWidget?ZPI18N.getString("zp.userupgradetitle"):ZPI18N.getString("zp.nonuserupgradetitle");Users.operations.add.offlineWidgetPopup=new popupModal(title,tab),Users.operations.add.offlineWidgetPopup.setCloseCallback(Users.operations.add.closeofflineWidget),Users.operations.add.offlineWidgetPopup.save=ZPI18N.getString("zp.purchase"),Users.operations.add.offlineWidgetPopup.construct();var popupCard=$("#"+tab.id).find("#"+tab.cardId);if(type==Subscription.userWidget){var offlineElm='<div class="zpl_crd">';offlineElm+='<div class="zpl_crdcnt"><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.offlineUserLicenseUpdinfo")+"<label></div></div>",offlineElm+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.userupgradelabel")+'</label></div><div><select data-width="400" id="select_offline" class="zselectbox"></select></div></div><div class="zpl_secn"><div><div class="zpl_info"><em>'+ZPI18N.getString("zp.offlinewidgetnote")+"</em></div></div></div>",offlineElm+="</div></div>"}else if(type==Subscription.nonUserWidget){offlineElm='<div class="zpl_crd">';offlineElm+='<div class="zpl_crdcnt"><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.offlineNULicenseUpdinfo")+"<label></div></div>",offlineElm+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.nonuserupgradelabel")+'</label></div><div><select data-width="400" id="select_offline" class="zselectbox"></select></div></div><div class="zpl_secn"><div><div class="zpl_info"><em>'+ZPI18N.getString("zp.offlinewidgetnote")+"</em></div></div></div>",offlineElm+="</div></div>"}popupCard.append(offlineElm);var list=[];for(i=0;i<allowedCount;i++)list[i]={},list[i].label=list[i].value=i+1;ZPeopleComponents.select(document.getElementById("select_offline")).addOption(list)}})},handleNoLicense:function(result,params){var currPage=params.mode;if(Subscription.restrictWidgetPlan.includes(ZPeople.PLANID)||"false"!=ZPeople.ISTRIALUSER){paymentErrMsg="user"===currPage?ZPI18N.getString("zp.paymenterr",new Array(paymentUrl)):ZPI18N.getString("zp.employeeprofilepaymenterr",new Array(paymentUrl));ZPeople.Message.failure(paymentErrMsg)}else if(result.offlinePaymentMode)if("user"===currPage)Users.operations.add.showOfflineWidget(Subscription.userWidget);else if("employeeprofile"==currPage&&Subscription.user_plan.includes(ZPeople.PLANID))Users.operations.add.showOfflineWidget(Subscription.nonUserWidget);else if(Subscription.static_plan.includes(ZPeople.PLANID)){var paymentErrMsg=0==result.totalLicenseCount?ZPI18N.getString("zp.employeeprofileaddsupport"):ZPI18N.getString("zp.employeeprofileaddmoresupport");ZPeople.Message.failure(paymentErrMsg)}else{var paymentErrMsg=ZPI18N.getString("zp.employeeprofilepaymenterr",new Array(paymentUrl));ZPeople.Message.failure(paymentErrMsg)}else if("user"===currPage)Subscription.getPaymentsWidget(Subscription.userWidget,result.totalLicenseCount);else if(Subscription.user_plan.includes(ZPeople.PLANID))Subscription.getPaymentsWidget(Subscription.nonUserWidget,result.totalLicenseCount);else if(Subscription.static_plan.includes(ZPeople.PLANID)){paymentErrMsg=0==result.totalLicenseCount?ZPI18N.getString("zp.employeeprofileaddsupport"):ZPI18N.getString("zp.employeeprofileaddmoresupport");ZPeople.Message.failure(paymentErrMsg)}else{paymentErrMsg=ZPI18N.getString("zp.employeeprofilepaymenterr",new Array(paymentUrl));ZPeople.Message.failure(paymentErrMsg)}},initUserMenu:function(){if(Layout.isKalvi&&Users.operations.add.isRedirectedToBundle())return;let config=Users.operations.add.getConfig(),closeCallback=Users.operations.add.closeCallback;Users.config.fromOtherPage&&void 0!==Users.config.otherPageParams&&Users.config.otherPageParams.hasOwnProperty("closeCallback")&&(closeCallback=Users.config.otherPageParams.closeCallback),UserManager.getInstance("adduser_fullpage_popup",{wrapperContainer:Users.operations.add.sliderContainer(),config:config},closeCallback,Users.operations.add.customCallback).showPopup()},closeCallback:function(isChanged){isChanged&&Users.operations.view.submitFilter()},customCallback:function(data){let newConfig=Users.operations.add.getConfig(data,!0);UserManager.getInstance("adduser_fullpage_popup").reconstruct(newConfig)},getConfig:function(data,isReconstruct){let mode,config=[];mode=data&&data.mode?data.mode:Users.operations.add.isBundleRedirectionAllowed()?"bundle":"invite";let addUserMenuParams=Users.operations.add.getUserMenuParams(mode,isReconstruct);switch(config.push(addUserMenuParams),mode){case"invite":case"direct":config.push(Users.operations.add.getAddUserParams(mode)),config.push(Users.operations.add.userBasicInfoParams()),config.push(Users.operations.add.getPostAddActionsHandlerParams());break;case"Zoho":case"Office365":case"GApps":config.push(Users.operations.add.syncConfig(mode,data)),"Office365"==mode&&Users.config.isNotificationEnabled&&config.push(Users.operations.add.notificationConfirmationConfig()),config.push(Users.operations.add.syncSummaryConfig())}return config},initNonUsersMenu:function(){if(!(Users.operations.add.sliderContainer().find("#addNonUserMenu").length>0)){var sliderConfig={id:"addNonUserMenu",cardId:"addNonUserMenuBody",hdrName:ZPI18N.getString("zp.addnonusers"),callback:Users.operations.add.constructNonUsersMenu},slider=new sliderModal(ZPI18N.getString("zp.addgroupusers"),sliderConfig);slider.footerContent="",slider.setContainerAsBody(!0),slider.construct()}},constructMenu:function(ele){Users.operations.add.constructMenuForm(ele.sliderDiv)},constructNonUsersMenu:function(ele){Users.operations.add.constructLicenseRow(ele.sliderDiv),Users.operations.add.constructAddNonuserForm(ele.sliderDiv)},constructMenuForm:function(sliderDiv){var html=Users.components.addUserMenu();sliderDiv.find("#addUserMenuBody").html("").append(html)},constructDirectForm:function(){var html=Users.components.directAddForm();Users.operations.add.constructDirectRow($(html).find("#multipleDirect tbody")),Users.operations.add.sliderContainer().find("#addUserMenu").find("#addUserMenuBody").append(html),Users.common.initTooltip()},constructInviteForm:function(){var html=Users.components.inviteForm();if(html=$(html),Users.config.isAddUserDirectlyAllowed&&Users.config.ALLOW_MOBILEUSER_ADDITION){if(html.find("#userEmailSection").find("label").text(ZPI18N.getString("zp.emailormob")),0==html.find("#mobDialCode").length){ZPI18N.getString("zp.emailormob"),Users.common.getDialCodes();var mobHtml=ZPComponents.v2.dialCode();html.find("#mobMail").prepend(mobHtml),html.find("#mobMail #userEmail").on("keyup",Users.common.toggleMobile)}html.find("#mobMail > select").addClass("DN"),html.find("#mobMail > div").addClass("DN")}Users.operations.add.sliderContainer().find("#addUserMenu").find("#addUserMenuBody").append(html[0]),Users.common.initTooltip()},constructLicenseRow:function(sliderDiv){var html=Users.components.licenseRow();sliderDiv.find("#addNonUserMenuBody").append(html)},constructAddNonuserForm:function(sliderDiv){var html=Users.components.addNonuserForm();sliderDiv.find("#addNonUserMenuBody").append(html),Users.common.initTooltip()},constructConvertNonuserForm:function(sliderDiv){var html=Users.components.convertNonuserForm();sliderDiv.find("#addNonUserMenuBody").append(html),Users.common.initTooltip()},constructSyncForm:function(mode,url,param){var html=Users.components.syncUserForm(mode),containerDiv=Users.operations.add.sliderContainer().find("#addUserMenu");containerDiv.find("#addUserMenuBody").append(html),containerDiv.find("#sync"+mode+"UserForm").append(ZPeople.LOADING_HTML),Users.operations.add.toggleSyncForm(mode),ZPeople.Request.send(url,param,(resultDataObject,requestParams)=>{if(Users.operations.add.constructSyncTable(resultDataObject,mode,Users.components.syncUserFormTableHtml(mode)))Users.operations.add.toggleSyncForm(mode),containerDiv.find("#sync"+mode+"UserForm").remove();else{var usersCount="Zoho"==mode?Object.keys(resultDataObject.zohoUsers).length:Object.keys(resultDataObject.SUCCESS).length;$(html).find("#sync"+mode+"UserForm-count i").html(usersCount)}}),Users.common.initTooltip()},toggleDirectForm:function(ele){Users.operations.add.sliderContainer().find("#addUserMenu #addUserMenuForm").toggleClass("DN"),Users.operations.add.sliderContainer().find("#addUserMenu #directUserForm").toggleClass("DN"),Users.operations.add.sliderContainer().find("#addUserMenu #directUserForm").is(":visible")?(Users.common.changeSliderHeader("#addUserMenu",ZPI18N.getString("zp.addusers"),Users.operations.add.toggleDirectForm),Users.common.changeSliderFooter("#addUserMenu",Users.components.directUserFooter())):(Users.common.changeSliderHeader("#addUserMenu",ZPI18N.getString("zp.addgroupusers")),Users.common.changeSliderFooter("#addUserMenu"))},toggleInviteForm:function(){Users.operations.add.sliderContainer().find("#addUserMenu #addUserMenuForm").toggleClass("DN"),Users.operations.add.sliderContainer().find("#addUserMenu #inviteUserForm").toggleClass("DN"),Users.operations.add.sliderContainer().find("#addUserMenu #inviteUserForm").is(":visible")?(Users.common.changeSliderHeader("#addUserMenu",ZPI18N.getString("zp.addinviteusers"),Users.operations.add.toggleInviteForm),Users.common.changeSliderFooter("#addUserMenu",Users.components.inviteUserFooter())):(Users.common.changeSliderHeader("#addUserMenu",ZPI18N.getString("zp.addgroupusers")),Users.common.changeSliderFooter("#addUserMenu"))},openAddNonuserForm:function(){var bodyModalContainer=Users.operations.add.sliderContainer();bodyModalContainer.find("#addNonUserMenu #addNonuserForm").siblings().addClass("DN"),bodyModalContainer.find("#addNonUserMenu").find("#addNonUserMenuBody #addNonuserForm").remove(),Users.operations.add.constructAddNonuserForm(bodyModalContainer.find("#addNonUserMenu")),bodyModalContainer.find("#addNonUserMenu").find("#addNonUserMenuBody #addNonuserForm").removeClass("DN"),Users.common.changeSliderHeader("#addNonUserMenu",ZPI18N.getString("zp.addnonusers"),!0),Users.common.changeSliderFooter("#addNonUserMenu",Users.components.addNonuserFooter(),!0),bodyModalContainer.find("#addNonUserMenu #sliderCls").off().on("click",Users.operations.add.closeAddNonuserForm),Users.common.openSlider("#addNonUserMenu",!0)},closeAddNonuserForm:function(){Users.operations.add.sliderContainer().find("#addNonUserMenu #addUserMenuForm").removeClass("DN"),Users.operations.add.sliderContainer().find("#addNonUserMenu #addNonuserForm").addClass("DN"),Users.common.changeSliderTitle("#addNonUserMenu",ZPI18N.getString("zp.addgroupusers")),Users.common.changeSliderFooter("#addNonUserMenu"),Users.common.closeSlider("#addNonUserMenu")},toggleAddNonuserForm:function(event){Users.operations.add.sliderContainer().find("#addNonUserMenu #addUserMenuForm").toggleClass("DN"),Users.operations.add.sliderContainer().find("#addNonUserMenu #addNonuserForm").toggleClass("DN"),Users.operations.add.sliderContainer().find("#addNonUserMenu #addNonuserForm").is(":visible")?(Users.common.changeSliderTitle("#addNonUserMenu",ZPI18N.getString("zp.addnonusers")),Users.common.changeSliderFooter("#addNonUserMenu",Users.components.addNonuserFooter())):(Users.common.changeSliderTitle("#addNonUserMenu",ZPI18N.getString("zp.addgroupusers")),Users.common.changeSliderFooter("#addNonUserMenu"),Users.common.toggleSlider("#addNonUserMenu"))},openConvertNonuserForm:function(){Users.operations.add.sliderContainer().find("#addNonUserMenu #convertNonuserForm").siblings().addClass("DN"),Users.operations.add.sliderContainer().find("#addNonUserMenu #convertNonuserForm").removeClass("DN"),Users.common.changeSliderHeader("#addNonUserMenu",ZPI18N.getString("zp.converttouser")),Users.operations.add.sliderContainer().find("#addNonUserMenu #sliderCls").off().on("click",Users.operations.add.closeConvertNonuserForm),Users.common.openSlider("#addNonUserMenu")},closeConvertNonuserForm:function(){Users.operations.add.sliderContainer().find("#addNonUserMenu #addUserMenuForm").removeClass("DN"),Users.operations.add.sliderContainer().find("#addNonUserMenu #convertNonuserForm").addClass("DN"),Users.common.changeSliderTitle("#addNonUserMenu",ZPI18N.getString("zp.addgroupusers")),Users.common.changeSliderFooter("#addNonUserMenu"),Users.common.toggleSlider("#addNonUserMenu")},toggleConvertNonuserForm:function(){Users.operations.add.sliderContainer().find("#addNonUserMenu #addUserMenuForm").toggleClass("DN"),Users.operations.add.sliderContainer().find("#addNonUserMenu #convertNonuserForm").toggleClass("DN"),Users.operations.add.sliderContainer().find("#addNonUserMenu #convertNonuserForm").is(":visible")?(Users.common.changeSliderTitle("#addNonUserMenu",ZPI18N.getString("zp.converttouser")),Users.common.changeSliderFooter("#addNonUserMenu",Users.components.convertNonuserFooter())):(Users.common.changeSliderTitle("#addNonUserMenu",ZPI18N.getString("zp.addgroupusers")),Users.common.changeSliderFooter("#addNonUserMenu"),Users.common.toggleSlider("#addNonUserMenu"))},toggleSyncForm:function(mode){var id="#sync"+mode+"UserForm";if(0===Users.operations.add.sliderContainer().find("#addUserMenu "+id).length)Users.operations.add.initSync(mode);else{var name=ZPI18N.getString("zp.importfromzmail");"GApps"==mode?name=ZPI18N.getString("zp.importfromgapps"):"Office365"==mode&&(name=ZPI18N.getString("zp.importfromMS")),Users.operations.add.sliderContainer().find("#addUserMenu #addUserMenuForm").toggleClass("DN"),Users.operations.add.sliderContainer().find("#addUserMenu "+id).toggleClass("DN"),Users.operations.add.sliderContainer().find("#addUserMenu "+id).is(":visible")?(Users.common.changeSliderHeader("#addUserMenu",name,Users.operations.add.toggleSyncEvent,mode),Users.common.changeSliderFooter("#addUserMenu",Users.components.syncUserFooter(mode))):(Users.common.changeSliderHeader("#addUserMenu",ZPI18N.getString("zp.addgroupusers")),Users.common.changeSliderFooter("#addUserMenu"))}},toggleSyncEvent:function(e){var mode=$(e.target).attr("mode");Users.operations.add.toggleSyncForm(mode)},initSync:function(mode){"Zoho"===mode?Users.operations.add.constructSyncForm("Zoho","/users/getZohoMailUsers",{method:"getZohoUsersNewUI"}):"GApps"===mode?Users.operations.add.constructSyncForm("GApps","/users/getGAppsUsers",{method:"getGAppsUsersNewUI"}):"Office365"===mode&&Users.operations.add.constructSyncForm("Office365","/getOffice365Actions.zp",{mode:"userlisting"})},searchSync:function(thisObj,mode){var formid="#sync"+mode+"UserForm",pageContent=$(thisObj).closest(formid),shwMore=$("#showMoreDiv");$(thisObj).on("keyup",function(){""!=this.value&&null!=this.value?shwMore.hide():shwMore.show(),pageContent.find(".zpl_tblres #emptPage").remove(),pageContent.find("table").show();var rowsOfSearchList=pageContent.find("table tbody tr").filter(":contains('"+this.value+"')"),tableObj=pageContent.find("table tbody");rowsOfSearchList=pageContent.find("table tbody tr").filter(":contains('"+this.value+"')"),tableObj.find("tr").addClass("hide"),0!==rowsOfSearchList.length?pageContent.find(rowsOfSearchList).removeClass("hide"):(pageContent.find("table").hide(),pageContent.find(".zpl_tblres").append(Users.components.noRecordsPage())),pageContent.find(formid+"-count i").html(rowsOfSearchList.length)})},constructSyncTable:function(resultDataObject,mode,syncUserFormHtml){var pageContent=Users.operations.add.sliderContainer().find("#addUserMenu");if($(syncUserFormHtml).find("tbody").find("tr").remove(),pageContent.find("#importUsrs").removeClass("disabled"),$("#showMoreDiv").remove(),hasErrors=!1,resultDataObject.ERROR)ZPeople.Message.failure(resultDataObject.ERROR),hasErrors=!0;else{var syncUsersObj=resultDataObject.zohoUsers;"Office365"!=mode&&"GApps"!=mode||(syncUsersObj=resultDataObject.SUCCESS,Users.config.officeNextLink=resultDataObject.nextLink);var syncUsersCnt=Object.keys(syncUsersObj).length,zohoRowListElm="";pageContent.find("#syncUserForm thead");if(pageContent.find("div#no_recfound_img").remove(),0===syncUsersCnt)$(syncUserFormHtml).find("table").hide(),0==$(syncUserFormHtml).find(".zpl_tblres #emptPage").length&&($(syncUserFormHtml).find(".zpl_tblres").append(Users.components.noRecordsPage()),$(syncUserFormHtml).find(".zpl_crd .zpl_crdhdr").hide());else{$(syncUserFormHtml).find(".zpl_crd .zpl_crdhdr").show(),$(syncUserFormHtml).find("#userListTable").show(),$(syncUserFormHtml).find(".zpl_tblres #emptPage").remove(),pageContent.find("input#massChecked").prop("checked",!1),"Zoho"==mode?$.each(syncUsersObj,function(zuids,userDtls){zohoRowListElm+=Users.components.syncUserRow(userDtls.dispName,userDtls.mailId,userDtls.photo,mode)}):($.each(syncUsersObj,function(zuids,userDtls){zohoRowListElm+=Users.components.syncUserRow(userDtls.user,userDtls.emailId,null,mode)}),null!=Users.config.officeNextLink&&void 0!=!Users.config.officeNextLink&&$(syncUserFormHtml).find("table").append(Users.components.syncTableFooter(mode)));let form=$(syncUserFormHtml);form.find("tbody").append(zohoRowListElm),form.find("tbody").attr("balanceUser",resultDataObject.balanceUser),pageContent.find("#sync"+mode+"UserForm").empty(),pageContent.find("#sync"+mode+"UserForm").append(form)}}return hasErrors},getMoreSyncRecords:function(mode){var formid="#sync"+mode+"UserForm",pageContent=Users.operations.add.sliderContainer().find(formid);pageContent.find("input#massChecked").prop("checked",!1),null!=Users.config.officeNextLink&&void 0!=Users.config.officeNextLink||pageContent.find("#showMoreDiv").remove(),ZPeople.Request.send("/getOffice365Actions.zp",{mode:"userlisting",nextLink:Users.config.officeNextLink},Users.operations.add.constructSyncTableRows,mode),pageContent.find("#importUsrs").addClass("disabled")},constructSyncTableRows:function(result,params,mode){result.nextLink?Users.config.officeNextLink=result.nextLink:(Users.config.officeNextLink=null,pageContent.find("#showMoreDiv").remove());var rows="";$.each(result.SUCCESS,function(zuids,userDtls){rows+=Users.components.syncUserRow(userDtls.user,userDtls.emailId,null,mode)});var formid="#sync"+mode+"UserForm",pageContent=Users.operations.add.sliderContainer().find(formid);pageContent.find("tbody").append(rows)},constructDirectRow:function(element){element||(element=Users.operations.add.sliderContainer().find("#directUserForm #multipleDirect tbody"));var html=Users.components.directAddRow();0==element.find("tr").length?$(html).find(".PI_delete").parent().remove():element.find(".manualPasswordTd").is(":visible")&&$(html).find(".manualPasswordTd").removeClass("DN"),Users.config.locAdminDetails&&(Users.components.initLocation(html,"#"+$(html).find("td.locationTd select").attr("id")),$(html).find(".locationTd").removeClass("DN")),element.append(html),Users.config.directRows++},deleteDirectRow:function(ele){$(ele).parent().find("select").each(function(index){ZPeopleComponents.select(this)&&ZPeopleComponents.select(this).destroy()}),$(ele).parent().remove()},handleSyncCheckbox:function(obj,id,mode){var formid="#sync"+mode+"UserForm",inputObj=$(obj).find("input");id=$(inputObj).attr("id");var zohoMailUserListTableObj,pageId=Users.operations.add.sliderContainer().find("#addUserMenu");if(zohoMailUserListTableObj=pageId.find(`${formid} tbody`),$(inputObj).attr("checked")?$(inputObj).removeAttr("checked"):$(inputObj).attr("checked",""),"massChecked"===id){var checkBox=zohoMailUserListTableObj.find("input[type=checkbox]:visible");$(inputObj).attr("checked")?checkBox.attr("checked",""):checkBox.removeAttr("checked")}else{0===zohoMailUserListTableObj.find("input[type=checkbox]:not(:checked)").length?pageId.find("#massChecked").attr("checked",""):pageId.find("#massChecked").removeAttr("checked")}var selectedItemsCnt=zohoMailUserListTableObj.find("input[type=checkbox]:checked").length;zohoMailUserListTableObj.find("input[type=checkbox]:checked").closest("tr").addClass("active"),zohoMailUserListTableObj.find("input[type=checkbox]:not(:checked)").closest("tr").removeClass("active"),pageId.find("div#selected_userscnt").removeClass("DN").find("span").text(selectedItemsCnt),selectedItemsCnt>0?(pageId.find("div#total_userscnt").addClass("DN"),pageId.find(".zpl_mfoter #syncZohoUsers").removeClass("disabled")):(pageId.find("div#total_userscnt,div#selected_userscnt").toggleClass("DN"),pageId.find(".zpl_mfoter #syncZohoUsers").addClass("disabled"))},submit:function(element,isInviteUser,isMigrate,userErecno){$(element).attr("disabled",!0),"true"==isInviteUser?isInvitedUser=!0:"false"==isInviteUser&&(isInviteUser=!1);var currentForm=isInviteUser?"#inviteUserForm":"#directUserForm";"employeeprofile"===Users.config.currMode&&(currentForm="#addNonuserForm"),"multiple"===Users.operations.add.sliderContainer().find(currentForm).attr("mode")?isInviteUser?Users.operations.add.submitMultiple($(element)):Users.operations.add.submitMultipleDirect($(element)):Users.operations.add.submitSingle($(element),isInviteUser,isMigrate,userErecno)},submitSingle:function(button,isInviteUser,isMigrate,userErecno){var emailId,type,convertType,erecNo,locid,pageContent=Users.operations.add.sliderContainer(),isNonuser="employeeprofile"===Users.config.currMode,currentForm=isNonuser?"#addNonuserForm":"#inviteUserForm",isAGP=!0,password="";if(isNonuser?isMigrate?(currentForm="#convertNonuserForm",emailId=isInviteUser?pageContent.find(currentForm+" input#userEmail").val().trim():pageContent.find(currentForm+" input#userUsername").val().trim()+"@"+pageContent.find("#userDomain").val()):(currentForm="#addNonuserForm",emailId=pageContent.find(currentForm+" input#userEmail").val().trim()):isInviteUser?(emailId=pageContent.find(currentForm+" input#userEmail").val().trim(),locid=pageContent.find("#singleInvite-userLocation").val()):(currentForm="#directUserForm",emailId=pageContent.find(currentForm+" input#userUsername").val().trim()+"@"+pageContent.find("#userDomain").val(),locid=pageContent.find("#directUserForm-userLocation").val()),pageContent.find(currentForm+" #agpPassword").length>0&&(isAGP=ZPeopleComponents.toggleswitch(pageContent.find(currentForm+" #agpPassword")).getState(),password=pageContent.find(currentForm+" input#userPassword").val()),Users.config.isMigrateUser=isMigrate,Users.operations.add.isValid(currentForm)){isNonuser?Users.config.isMigrateUser?(type="0",convertType=isInviteUser?"2":"4",erecNo=userErecno):type="-2":type=isInviteUser?"2":"1";var params={};if(Users.config.isMobile){type="8";var c_code=pageContent.find(currentForm+" #mobDialCode").val();emailId=ZPeopleComponents.select(pageContent.find(currentForm+" #mobDialCode")).getAttribute("options").filter(e=>e.c_code===c_code)[0].d_code+"-"+emailId,params.dialCode=c_code}params=isInviteUser?{empId:pageContent.find(currentForm+" input#userId").val(),empFname:pageContent.find(currentForm+" input#userFirstname").val(),empLname:pageContent.find(currentForm+" input#userLastname").val(),empMail:emailId,type:type,erecno:erecNo,password:password,method:"addUser"}:{empId:pageContent.find(currentForm+" input#userId").val(),empFname:pageContent.find(currentForm+" input#userFirstname").val(),empLname:pageContent.find(currentForm+" input#userLastname").val(),empMail:emailId,type:type,erecno:erecNo,password:password,method:"addUser",autoGenPwd:isAGP},Users.config.locAdminDetails&&locid&&(params.locid=locid),Users.config.isMigrateUser&&(params.convertType=convertType),pageContent.find(currentForm+" #userOnboardingSection").is(":visible")&&(params.obEnable=pageContent.find(currentForm+" #userOnboardingEnable").is(":checked"));let extraParams=Users.common.getExtraParams();extraParams.ele=button,ZPeople.Request.send("/users/addUsers",params,Users.operations.add.handleResponse,extraParams),pageContent.find(currentForm+" div.ztextbox--error__label").remove(),pageContent.find(currentForm+" input").removeClass("ztextbox__error")}else button.removeAttr("disabled")},submitMultiple:function(button){var pageId=Users.operations.add.sliderContainer();pageId.find("#inviteUserForm #inviteUsers").addClass("disabled");var bulkEmailIdBoxElm=pageId.find("#inviteUserForm textarea#userEmails"),locid=pageId.find("#multipleInvite-userLocation").val(),bulkMailIds=bulkEmailIdBoxElm.val(),bulkEmailIdparentElm=bulkEmailIdBoxElm.parent();if(pageId.find("#inviteUserForm div.ztextbox--error__label").remove(),bulkEmailIdBoxElm.removeClass("ztextbox__error"),ZPSetupCommon.isEmpty(bulkMailIds.trim()))button.removeAttr("disabled"),ZPSetupCommon.showErr(ZPI18N.getString("zp.specifyemailids"),bulkEmailIdparentElm,"ztextbox--error__label"),bulkEmailIdBoxElm.addClass("ztextbox__error"),pageId.find("#inviteUserForm #inviteUsers").removeClass("disabled");else{var mailIdList=bulkMailIds.split(","),errorList=[],validMailIdsList=[];if(0===mailIdList.length)button.removeAttr("disabled"),ZPSetupCommon.showErr(ZPI18N.getString("zp.validemail"),bulkEmailIdparentElm,"ztextbox--error__label"),bulkEmailIdBoxElm.addClass("ztextbox__error");else if($.each(mailIdList,function(index,mailId){mailId=mailId.trim(),ZPSetupCommon.isEmpty(mailId)||(CompanySettings.isValidEmail(mailId)?-1!==validMailIdsList.indexOf(mailId)?(ZPSetupCommon.showErr(mailId+" - "+ZPI18N.getString("zp.duplicatmailid"),bulkEmailIdparentElm,"ztextbox--error__label","bulkInv"+index),bulkEmailIdBoxElm.addClass("ztextbox__error"),errorList.push(mailId)):validMailIdsList.push(mailId):(ZPSetupCommon.showErr(ZSEC.Encoder.encodeForHTML(mailId)+" - "+ZPI18N.getString("zp.invalidemail"),bulkEmailIdparentElm,"ztextbox--error__label","bulkInv"+index),bulkEmailIdBoxElm.addClass("ztextbox__error"),errorList.push(mailId)))}),0===errorList.length){var params={multiEmailIds:JSON.stringify(validMailIdsList),method:"bulkInviteUser"};pageId.find("#inviteUserForm #userOnboardingSection").is(":visible")&&(params.obEnable=pageId.find("#inviteUserForm #userOnboardingEnable").is(":checked")),Users.config.locAdminDetails&&locid&&(params.locid=locid);let extraParams=Users.common.getExtraParams();extraParams.ele=button,ZPeople.Request.send("/users/bulkInviteUsers",params,Users.operations.add.handleResponseMultiple,extraParams)}else button.removeAttr("disabled"),pageId.find("#inviteUserForm #inviteUsers").removeClass("disabled")}},submitMultipleDirect:function(button){var emailIdsPasswd={},emailIdsLoc={},error=!1,emailIdList=[],mailIdsLength=0,rows=Users.operations.add.sliderContainer().find("#directUserForm #multipleDirect tbody tr"),isAGP=ZPeopleComponents.toggleswitch(Users.operations.add.sliderContainer().find("#directUserForm #agpPassword")).getState();if(Users.operations.add.sliderContainer().find("#directUserForm").find("#directUsers").removeClass("disabled"),$.each(rows,function(index,ele){var usernameEle=$(ele).find("input[id*=userUsername]"),username=usernameEle.val(),emailId=username+"@"+$(ele).find("select[id*=userDomain]").val(),location=$(ele).find("select[id*=userLocation]").val();if(mailIdsLength+=emailId.length,usernameEle.attr("emailId",emailId),ZPSetupCommon.isEmpty(username)||!CompanySettings.isValidEmail(emailId)?(usernameEle.addClass("ztextbox__error"),error=!0,ZPSetupCommon.showErr(ZPI18N.getString("zp.entervalforfield",[ZPI18N.getString("zp.emailid")]),usernameEle.parent(),"ztextbox--error__label")):!ZPSetupCommon.isEmpty(username)&&CompanySettings.isValidEmail(emailId)&&(-1!==emailIdList.indexOf(emailId)?(error=!0,ZPSetupCommon.showErr(ZPI18N.getString("zp.duplicatmailid"),usernameEle.parent(),"ztextbox--error__label")):(error=!1,usernameEle.parent().find(".ztextbox--error__label").remove(),usernameEle.removeClass("ztextbox__error"),emailId=encodeURI(emailId),emailIdList.push(emailId))),!isAGP){var passEle=$(ele).find("input[id*=userPassword]"),pass=passEle.val();passEle.parent().find(".ztextbox--error__label").remove(),ZPSetupCommon.isEmpty(pass)?(error=!0,passEle.addClass("ztextbox__error"),ZPSetupCommon.showErr(ZPI18N.getString("zp.entervalforfield",[ZPI18N.getString("zp.passwd")]),passEle.parent(),"ztextbox--error__label")):ZPSetupCommon.isEmpty(pass)||(pass.length<8?(error=!0,passEle.addClass("ztextbox__error"),ZPSetupCommon.showErr(ZPI18N.getString("zp.passwordlengshort"),passEle.parent(),"ztextbox--error__label")):Users.operations.add.validatePwdPolicy(pass)?(error=!0,passEle.addClass("ztextbox__error"),ZPSetupCommon.showErr(ZPI18N.getString("zp.passwordpolicy"),passEle.parent(),"ztextbox--error__label"),$("#multiUPwd").mouseover(),setTimeout(function(){$("#multiUPwd").popover("hide")},3e3)):(passEle.find(".ztextbox--error__label").parent().remove(),passEle.removeClass("ztextbox__error")))}error||(emailIdsPasswd[emailId]=isAGP?null:pass,null!=location&&(emailIdsLoc[emailId]=location))}),error)button.removeAttr("disabled");else if(mailIdsLength<=1e3){var params={multiEmailIds:JSON.stringify(emailIdsPasswd),method:"addMultiUsers",autoGenPwdMulti:isAGP};Users.config.locAdminDetails&&!$.isEmptyObject(emailIdsLoc)&&(params.locids=JSON.stringify(emailIdsLoc)),Users.operations.add.sliderContainer().find("#directUserForm #userOnboardingSection").is(":visible")&&(params.obEnable=Users.operations.add.sliderContainer().find("#directUserForm #userOnboardingEnable").is(":checked")),Users.operations.add.sliderContainer().find("#directUserForm").find("#directUsers").addClass("disabled");var extraParams=Users.common.getExtraParams();extraParams.ele=button,ZPeople.Request.send("/users/addMultiUser",params,Users.operations.add.handleResponseMultipleDirect,extraParams)}else ZPeople.Message.failure(ZPI18N.getString("zp.maildidlengthexceeded"))},submitSyncZoho:function(mode){let isEnabledNotify=Users.config.isNotificationEnabled;var pageId=Users.operations.add.sliderContainer(),zohoMailUsersListObj=pageId.find(`#sync${mode}UserForm tbody`),isMicrosoftUsers="Office365"===mode,isGAppsUsers="GApps"===mode;if(zohoMailUsersListObj.find("input[type=checkbox]:checked").length>parseInt(zohoMailUsersListObj.attr("balanceUser")))ZPeople.Message.failure(ZPI18N.getString("zp.paymenterr"));else{var mailIds=zohoMailUsersListObj.find("input:checked").map(function(){return this.value}).get().join(","),displayName=zohoMailUsersListObj.find("input:checked").map(function(){return this.name}).get().join(","),mailArrList=[],nameArrList=[];if(isMicrosoftUsers){var mailSplit=mailIds.split(","),dispNameSplit=displayName.split(",");$.each(mailSplit,function(index,value){mailArrList.push(value)}),$.each(dispNameSplit,function(index,value){nameArrList.push(value)})}if(0!==mailIds.length){var url=isMicrosoftUsers?"importOffice365Users.zp":isGAppsUsers?"/users/importGAppsUsers":"/users/importZohoUsers",params=isMicrosoftUsers?{mode:"importOfficeUser"}:isGAppsUsers?{method:"getImportGAppsUsersNewUI"}:{method:"importZohoUsers"};if(params.mailIds=isMicrosoftUsers?JSON.stringify(mailArrList):mailIds,isMicrosoftUsers)if(params.dispName=JSON.stringify(nameArrList),isEnabledNotify){var alertInfo=new InfoAlertMessage(ZPI18N.getString("zp.confirmDialog"),"Do you want to notify employees by mail?");alertInfo.setCallback(function(){params.mailToNotifyUsers=!0,ZPeople.Request.send(url,params,Users.operations.add.handleSyncResponse,Users.common.getExtraParams())}),alertInfo.setCloseCallback(function(){params.mailToNotifyUsers=!1,ZPeople.Request.send(url,params,Users.operations.add.handleSyncResponse,Users.common.getExtraParams())}),alertInfo.show()}else ZPeople.Request.send(url,params,Users.operations.add.handleSyncResponse,Users.common.getExtraParams());else ZPeople.Request.send(url,params,Users.operations.add.handleSyncResponse,Users.common.getExtraParams());pageId.find("#addUserMenu #syncZohoUsers").addClass("disabled")}}},isValid:function(currentForm){var pageId=Users.operations.add.sliderContainer(),empId=pageId.find(currentForm+" input#userId").val(),firstName=pageId.find(currentForm+" input#userFirstname").val(),lastName=pageId.find(currentForm+" input#userLastname").val(),userName=pageId.find(currentForm+" input#userUsername").val(),emailId="#directUserForm"===currentForm?userName+"@"+pageId.find(currentForm+" #userDomain").val():pageId.find(currentForm+" input#userEmail").val(),isLastNameMandatory=(Users.config.currMode,pageId.find(currentForm+" #userLastnameSection label").hasClass("zpl_mtry")),isEmailIdMandatory=pageId.find(currentForm+" #userEmailSection label").hasClass("zpl_mtry"),empIdErr="",isValid=!0,isAGP=!0,password="",isDirect=!1,isMobile="#inviteUserForm"===currentForm&&Users.config.isMobile;if(pageId.find(currentForm+" div.ztextbox--error__label").remove(),pageId.find(currentForm+" input").removeClass("ztextbox__error"),pageId.find(currentForm+" #agpPassword").length>0&&ZPeopleComponents.toggleswitch(pageId.find(currentForm+" #agpPassword")).container.is(":visible")){isAGP=ZPeopleComponents.toggleswitch(pageId.find(currentForm+" #agpPassword")).getState(),password=pageId.find(currentForm+" input#userPassword").val();isDirect=!0}if(ZPSetupCommon.isEmpty(empId)||empId===Users.config.lastEmployeeId&&!Users.config.isMigrateUser){ZPSetupCommon.isEmpty(empId)?(empIdErr=ZPI18N.getString("zp.entervalforfield",[Users.config.empidDispName]),"empEmptyId"):(empIdErr=ZPI18N.getString("zp.DuplicateMsgInAdduser",[Users.config.empidDispName]),"empDuplicateId");var errorKeptElm=pageId.find(currentForm+" input#userId");ZPSetupCommon.showErr(empIdErr,errorKeptElm.parent(),"ztextbox--error__label"),errorKeptElm.addClass("ztextbox__error"),isValid=!1}if(ZPSetupCommon.isEmpty(firstName)){errorKeptElm=pageId.find(currentForm+" input#userFirstname");ZPSetupCommon.showErr(ZPI18N.getString("zp.entervalforfield",[Users.config.fnameDispName]),errorKeptElm.parent(),"ztextbox--error__label"),errorKeptElm.addClass("ztextbox__error"),isValid=!1}if(isLastNameMandatory&&ZPSetupCommon.isEmpty(lastName)){errorKeptElm=pageId.find(currentForm+" input#userLastname");ZPSetupCommon.showErr(ZPI18N.getString("zp.entervalforfield",[Users.config.lnameDispName]),errorKeptElm.parent(),"ztextbox--error__label"),errorKeptElm.addClass("ztextbox__error"),isValid=!1}if(isDirect&&!isAGP){errorKeptElm=pageId.find(currentForm+" input#userPassword");ZPSetupCommon.isEmpty(password)?(ZPSetupCommon.showErr(ZPI18N.getString("zp.entervalforfield",[ZPI18N.getString("zp.passwd")]),errorKeptElm.parent(),"ztextbox--error__label"),errorKeptElm.addClass("ztextbox__error"),isValid=!1):ZPSetupCommon.isEmpty(password)||(password.length<8?(error=!0,ZPSetupCommon.showErr(ZPI18N.getString("zp.passwordlengshort"),errorKeptElm.parent(),"ztextbox--error__label"),errorKeptElm.addClass("ztextbox__error")):Users.operations.add.validatePwdPolicy(password)&&(error=!0,ZPSetupCommon.showErr(ZPI18N.getString("zp.passwordpolicy"),errorKeptElm.parent(),"ztextbox--error__label"),errorKeptElm.addClass("ztextbox__error"),$("#multiUPwd").mouseover(),setTimeout(function(){$("#multiUPwd").popover("hide")},3e3)))}if(!isMobile&&(ZPSetupCommon.isEmpty(emailId)&&isEmailIdMandatory||!ZPSetupCommon.isEmpty(emailId)&&!CompanySettings.isValidEmail(emailId))){var errorElmParent;errorKeptElm="";errorKeptElm=isDirect?pageId.find(currentForm+" input#userUsername"):pageId.find(currentForm+" input#userEmail"),errorElmParent="inviteUserForm"===currentForm?errorKeptElm.parent().parent():errorKeptElm.parent(),ZPSetupCommon.showErr(ZPI18N.getString("zp.entermailid"),errorElmParent,"ztextbox--error__label"),errorKeptElm.addClass("ztextbox__error"),isValid=!1}if(isMobile){var countryCode=null==pageId.find(currentForm+" #mobDialCode").val()?"":pageId.find(currentForm+" #mobDialCode").val();if(ZPSetupCommon.isEmpty(countryCode)||!ZPComponents.dialCode.isValidCountryCode(countryCode.trim())){errorKeptElm=pageId.find(currentForm+" input#userEmail");ZPSetupCommon.showErr(ZPI18N.getString("zp.countryemptymsg"),errorKeptElm.parent().parent(),"ztextbox--error__label"),errorKeptElm.addClass("ztextbox__error"),isValid=!1}if(ZPSetupCommon.isEmpty(emailId)&&"true"===isEmailIdMandatory||!ZPSetupCommon.isEmpty(emailId)&&!CompanySettings.isValidMobile(emailId)){errorKeptElm=pageId.find(currentForm+" input#userEmail");ZPSetupCommon.showErr(ZPI18N.getString("zp.mobusrvaldn"),errorKeptElm.parent().parent(),"ztextbox--error__label"),errorKeptElm.addClass("ztextbox__error"),isValid=!1}}return isValid},handleResponse:function(dataObj,paramsObj,extraParams){extraParams.hasOwnProperty("ele")&&extraParams.ele.removeAttr("disabled");var pageId=Users.operations.add.sliderContainer(),errorMessage="",type=paramsObj.type,currentForm=1==type?"#directUserForm":"#inviteUserForm",toggleFormFunction="";"employeeprofile"===Users.config.currMode&&(Users.config.isMigrateUser?(currentForm="#convertNonuserForm",toggleFormFunction=Users.operations.add.closeConvertNonuserForm):(currentForm="#addNonuserForm",toggleFormFunction=Users.operations.add.closeAddNonuserForm));Layout.Page.currentmode.indexOf("onboarding/reports/employee");dataObj.success?null!=dataObj.usersDtls&&void 0!=dataObj.usersDtls&&(ZPeople.ISUNCONFIRMEDACC?ZPeople.Message.warning(ZPI18N.getString("zp.inviteuncnfrmd")):ZPSetupCommon.isEmpty(dataObj.success)||ZPeople.Message.success(dataObj.success),Users.operations.view.submitFilter(extraParams),-1!=currentForm.indexOf("direct")?(Users.operations.add.toggleDirectForm(),pageId.find("#directUserForm").find("input").val(""),pageId.find("#directUserForm").find("#addUsers").removeClass("disabled")):-1!=currentForm.indexOf("Nonuser")?toggleFormFunction():("settings/service/accountsetup/users/invited"!==settingsUrlProps.niceUrl?window.location.href="#settings/service/accountsetup/users/invited":Users.operations.view.submitFilter(extraParams),pageId.find("#inviteUserForm").find("input, textarea").val(""),pageId.find("#inviteUserForm").find("#inviteUsers").removeClass("disabled"),Users.operations.add.toggleInviteForm()),Users.config.isMigrateUser&&(window.location.href="#settings/service/accountsetup/users/all",Users.config.isMigrateUser=!1),null==dataObj.addedUserErecNo&&""==dataObj.addedUserErecNo||Users.operations.edit.confirmFormEdit(dataObj.addedUserErecNo)):(dataObj.exception?errorMessage=dataObj.exception:dataObj.paymentErr?errorMessage=dataObj.paymentErr:dataObj.noOrgAdmin?errorMessage=dataObj.noOrgAdmin:dataObj.error?$.each(dataObj.error,function(key,errMsg){if("emailIdParentElm"===key){var errorDiv=1!=type?pageId.find(currentForm+" input#userEmail"):pageId.find(currentForm+" input#userUsername");pageId.find(currentForm+" input#userEmail").addClass("ztextbox__error"),ZPSetupCommon.showErr(errMsg,errorDiv.parent(),"ztextbox--error__label")}else if("empIdErr"===key){errorDiv=pageId.find(currentForm+" input#userId");pageId.find(currentForm+" input#userId").addClass("ztextbox__error"),ZPSetupCommon.showErr(errMsg,errorDiv.parent(),"ztextbox--error__label")}else errorMessage=dataObj.error[key]}):$.each(dataObj,function(emailId,errorObj){if("isErrorFound"!==emailId){var getErrorObj=dataObj[emailId],parentObj=pageId.find(currentForm+" input[emailId='"+emailId+"']").parent();parentObj.addClass("ztextbox__error"),ZPSetupCommon.showErr(getErrorObj.emailIdParentElm,parentObj,"ztextbox--error__label"),pageId.find(currentForm+" input[emailId='"+emailId+"']").attr("emailErr","true")}}),ZPSetupCommon.isEmpty(errorMessage)||ZPeople.Message.failure(errorMessage))},handleResponseMultiple:function(data,params,extraParams){extraParams.hasOwnProperty("ele")&&extraParams.ele.removeAttr("disabled");var pageId=Users.operations.add.sliderContainer();pageId.find("#inviteUserForm").find("#inviteUsers").addClass("disabled");var bulkEmailIdBoxElm=pageId.find("#inviteUserForm textarea#userEmails"),bulkEmailIdparentElm=bulkEmailIdBoxElm.parent(),idCount=0;if(data.noOrgAdmin)ZPeople.Message.failure(data.noOrgAdmin);else if(data.error){if(data.error.userAddError){var allValues=data.error.userAddError;$.each(allValues,function(index,errObj){idCount++,"Z112"==errObj.errorMsg?ZPSetupCommon.showErr(errObj.errorMailIds+" - "+ZPI18N.getString("zp.dcinviteerror")+"<br>",bulkEmailIdparentElm,"ztextbox--error__label","duplicate"+idCount):ZPSetupCommon.showErr(errObj.errorMailIds+" - "+ZPI18N.getString("zp.userAdd.exceptionMsg")+"<br>",bulkEmailIdparentElm,"ztextbox--error__label","duplicate"+idCount)})}else data.error.hasOwnProperty("paymentError")?(idCount++,ZPSetupCommon.showErr(data.error.paymentError+"<br>",bulkEmailIdparentElm,"ztextbox--error__label","duplicate"+idCount)):$.each(data.error,function(mailId,error){idCount++,ZPSetupCommon.showErr(mailId+" - "+error+"<br>",bulkEmailIdparentElm,"ztextbox--error__label","duplicate"+idCount)});bulkEmailIdBoxElm.addClass("ztextbox__error"),pageId.find("#inviteUserForm").find("#inviteUsers").removeClass("disabled")}else ZPSetupCommon.isEmpty(data.result)||(ZPeople.ISUNCONFIRMEDACC?ZPeople.Message.warning(ZPI18N.getString("zp.inviteuncnfrmd")):ZPeople.Message.success(data.result),"settings/service/accountsetup/users/invited"!==settingsUrlProps.niceUrl?window.location.href="#settings/service/accountsetup/users/invited":Users.operations.view.submitFilter(extraParams),Users.operations.add.toggleInviteForm(),Users.common.closeSlider("#addUserMenu"),Users.common.closeSlider("#addNonUserMenu"),pageId.find("#inviteUserForm").find("#inviteUsers").removeClass("disabled"),pageId.find("#inviteUserForm").find("input, textarea").val(""))},handleResponseMultipleDirect:function(data,params,extraParams){extraParams.hasOwnProperty("ele")&&extraParams.ele.removeAttr("disabled");var saveElement=extraParams.thisObj,pageId=Users.operations.add.sliderContainer();pageId.find("#directUserForm").find("#directUsers").removeClass("disabled");data.isZohoUserMsg;if($(saveElement).prop("disabled",!1),"success"===data.result)ZPeople.Message.success(ZPI18N.getString("zp.usersdaddedsuccessfully")),Users.operations.add.toggleDirectForm(),Users.common.toggleSlider("#addUserMenu"),pageId.find("#directUserForm").find("#directUsers").removeClass("disabled"),pageId.find("#directUserForm").find("input").val(""),Users.operations.view.submitFilter(extraParams);else if("duplicate"===data.result)$.each(data,function(mailId,errObj){var errkeptElm=pageId.find("#directUserForm #multipleDirect").find("input[emailId='"+mailId+"']"),errorValue=null;errObj&&(errObj.emailIdParentElm&&(errorValue=errObj.emailIdParentElm),errObj.empLocAuthErr&&(errorValue=null!=errorValue?errorValue+","+errObj.empLocAuthErr:errObj.empLocAuthErr)),ZPSetupCommon.showErr(errorValue,errkeptElm.parent(),"ztextbox--error__label")});else if(ZPSetupCommon.isEmpty(data.userAddError))ZPeople.Message.failure(data.error);else{var allValues=data.userAddError;$.each(allValues,function(index,errObj){var errkeptElm=pageId.find("#directUserForm #multipleDirect").find("input[emailId='"+errObj.errorMailIds+"']");"Z112"==errObj.errorMsg?ZPSetupCommon.showErr(ZPI18N.getString("zp.dcinviteerror"),errkeptElm.parent(),"ztextbox--error__label"):ZPSetupCommon.showErr(ZPI18N.getString("zp.userAdd.exceptionMsg"),errkeptElm.parent(),"ztextbox--error__label")})}},handleSyncResponse:function(resultObject,params,extraParams){var mode="Zoho";params.hasOwnProperty("method")&&params.method.indexOf("GApps")>-1||params.hasOwnProperty("mode")&&params.mode.indexOf("GApps")>-1?mode="GApps":(params.hasOwnProperty("method")&&params.method.indexOf("Office365")>-1||params.hasOwnProperty("mode")&&params.mode.indexOf("importOfficeUser")>-1)&&(mode="Office365");var id="#sync"+mode+"UserForm";if(Users.operations.add.sliderContainer().find(`#addUserMenu ${id}`).removeClass("disabled"),resultObject.hasOwnProperty("ERROR")&&!ZPSetupCommon.isEmpty(resultObject.ERROR.userAddError)){var unknownErrorMsgToBeDisplayed="",dcErrorMsgToBeDisplayed="";"UNKNOWN_ERROR"==resultObject.ERROR.userAddError[0].errorMsg?unknownErrorMsgToBeDisplayed=ZPI18N.getString("zp.userAdd.exceptionMsg")+"-":"Z112"==resultObject.ERROR.userAddError[0].errorMsg&&(dcErrorMsgToBeDisplayed=ZPI18N.getString("zp.dcinviteerror")+"-"),$.each(resultObject.ERROR.userAddError,function(index,value){"Z112"==value.errorMsg?dcErrorMsgToBeDisplayed+=value.errorMailIds+" ":"UNKNOWN_ERROR"==value.errorMsg&&(unknownErrorMsgToBeDisplayed+=value.errorMailIds+" ")}),ZPeople.Message.failure(unknownErrorMsgToBeDisplayed+dcErrorMsgToBeDisplayed)}else if(ZPSetupCommon.isEmpty(resultObject.ERROR))if("Office365"==mode||"GApps"==mode){if(resultObject.hasOwnProperty("paymentErrInit"))ZPeople.Message.failure(resultObject.paymentErrInit);else{var html=Users.components.summary(mode),successMailIds=JSON.parse(params.mailIds);$("#"+mode+"ImportSummary").remove(),resultObject.hasOwnProperty("Errors")?(Users.common.toggleActive(mode,"error",html),$.each(resultObject.Errors,function(index,value){var email=value.hasOwnProperty("mailId")?value.mailId:"",message=value.Message;$(html).find("#errorBody tbody").append(Users.components.summaryRow(null,email,message,mode)),successMailIds.splice($.inArray(email,successMailIds),1)}),$(html).find("li#errorHeader b").html(resultObject.Errors.length)):$(html).find("li#errorHeader").hide(),successMailIds.length>0&&resultObject.hasOwnProperty("SuccessMsg")?(Users.common.toggleActive(mode,"success",html),$.each(successMailIds,function(index,value){$(html).find("#successBody tbody").append(Users.components.summaryRow(null,value,resultObject.SuccessMsg,mode))}),$(html).find("li#successHeader b").html(successMailIds.length)):$(html).find("li#successHeader").hide()}Users.operations.view.submitFilter(extraParams),Users.operations.add.toggleSyncForm(mode),Users.operations.add.sliderContainer().find(`#addUserMenu ${id}`).remove(),Users.common.toggleSlider("#addUserMenu"),Users.operations.add.sliderContainer().append(html)}else Users.operations.add.toggleSyncForm("Zoho"),Users.operations.add.sliderContainer().find(`#addUserMenu ${id}`).remove(),Users.common.toggleSlider("#addUserMenu"),Users.operations.view.submitFilter(extraParams);else ZPeople.Message.failure(resultObject.ERROR)},toggleSingleMultipleInterface:function(type){var formId="#"+type+"UserForm",singleEleId="#single"+(type=type[0].toUpperCase()+type.slice(1).toLowerCase()),multpleEleId="#multiple"+type;Users.operations.add.sliderContainer().find(formId).find(singleEleId).toggleClass("DN"),Users.operations.add.sliderContainer().find(formId).find(singleEleId+"Tab").toggleClass("zpl_act"),Users.operations.add.sliderContainer().find(formId).find(multpleEleId).toggleClass("DN"),Users.operations.add.sliderContainer().find(formId).find(multpleEleId+"Tab").toggleClass("zpl_act"),Users.operations.add.sliderContainer().find(formId).find(singleEleId+"Info").toggleClass("DN"),Users.operations.add.sliderContainer().find(formId).find(multpleEleId+"Info").toggleClass("DN"),Users.operations.add.sliderContainer().find(formId).find(singleEleId).hasClass("DN")?Users.operations.add.sliderContainer().find(formId).attr("mode","multiple"):Users.operations.add.sliderContainer().find(formId).attr("mode","single")},toggleSinglePassword:function(event){var formId=event.target.closest("form").attr("id");Users.operations.add.sliderContainer().find("#"+formId+" #manualPassword").toggleClass("DN"),Users.operations.add.sliderContainer().find(".manualPasswordTd").toggleClass("DN"),Users.config.toggleAGPforAdd=!Users.config.toggleAGPforAdd},toggleImportPassword:function(){$("#directImportPopup .directImportTemplate-password").toggleClass("DN")},showDirectImportPopup:function(){if($(settingsPage.mainWrapId).find("#directImportPopup").length>0)Users.common.openSlider("directImportPopup");else{var html=Users.components.directImportPopup();$(settingsPage.mainWrapId).append(html)}},showImportPopup:function(isQuickImport,resultObj){ZP5Import.init("user"===Users.config.currMode?ZP5Import.HANDLER_MODE.USERS:ZP5Import.HANDLER_MODE.PROFILE)},showExportPopup:function(){ZP5Export.init("user"===Users.config.currMode?"users":"profile")},directImportPreview:function(file){var pageId=$(settingsPage.mainWrapId),uploadMainDiv=pageId.find("div#importFileSection");$("button#importButton").prop("disabled",!1),uploadMainDiv.find("i#importIc").removeClass("PI_imprt S22 MB8 DIB blu"),uploadMainDiv.find("i#importIc").addClass("IC-docs imtIcn DIB blu"),uploadMainDiv.find("p#notes").addClass("DN"),pageId.find("p#importloadedFileName").removeClass("DN"),pageId.find("p#importloadedFileName").find("em").text($(file).val()),uploadMainDiv.find("#uploadFileButton").text(ZPI18N.getString("zp.removeandnew")),pageId.find("button#importButton").text(ZPI18N.getString("zp.import")).show()},directImportSubmit:function(){var pageId=$(settingsPage.mainWrapId).find("#directImportPopup"),inputFile=pageId.find("input#uploadFileInput").val(),location=(pageId.find("input#uploadFileInput")[0].files[0].size,pageId.find("select#directImport-userLocation").val()),domainName=pageId.find("select#userImportDomain").val();pageId.find("form input#method").val("");var isAGP=ZPeopleComponents.toggleswitch(pageId.find("#agpPassword")).getState();!ZPSetupCommon.isEmpty(inputFile)&&(CompanySettings.endsWith(inputFile,"xls")||CompanySettings.endsWith(inputFile,"xlsx")||CompanySettings.endsWith(inputFile,"csv"))?ZPSetupCommon.isEmpty(domainName)?ZPeople.Message.failure(ZPI18N.getString("zp.selvalfordomain")):(pageId.find("form input#domainName").val(domainName),pageId.find("form input#autoGenPassword").val(isAGP),Users.config.locAdminDetails&&null!=location&&void 0!=location&&pageId.find("input#LocID").val(location),pageId.find("form#quickImportForm").submit(),pageId.find("button#importButton").prop("disabled",!0)):ZPeople.Message.failure(ZPI18N.getString("zp.notSupportedFileFormat"))},directImportResponse:function({successes:successes,errors:errors,warnings:warnings}){var pageId=$(settingsPage.mainWrapId);Users.common.closeSlider("directImportPopup"),pageId.find("#directImportSummary").remove();var html=Users.components.summary("directImport"),isSummaryNeeded=!1,isRefreshNeeded=!1,isSuccess=!1;if(errors.length>0)if(ZPSetupCommon.isEmpty(errors[0].details))pageId.find("button#importButton").prop("disabled",!1),ZPeople.Message.failure(errors[0]);else{isSummaryNeeded=!0;var tables=$(html).find("#errorBody tbody");$(html).find("li#warningHeader").hide(),Users.common.toggleActive("directImport","error",html);var errCount=0;$.each(errors,function(key,val){var rowNo=val["row no"];if(rowNo){var rowHtml=Users.components.summaryRow(rowNo,"",val.details.replace(/[[\]]/g,"").replace(",","<br>"),"directImport");tables.append(rowHtml),errCount++}else 1==errors.length&&ZPeople.Message.failure(errors[key])}),$(html).find("li#errorHeader b").html(errCount),pageId.find("button#importButton").prop("disabled",!1)}else isRefreshNeeded=!0,$(html).find("li#errorHeader").hide();if(warnings&&warnings.length>0){isSummaryNeeded=!0;var message=ZPI18N.getString("zp.existingzohouser");tables=$(html).find("#warningBody tbody");$(html).find("li#warningHeader").show(),Users.common.toggleActive("directImport","warning",html),$.each(warnings,function(key,val){var rowHtml=Users.components.summaryRow(val,"",message,"directImport");tables.append(rowHtml)}),$(html).find("li#warningHeader b").html(warnings.length),pageId.find("button#importButton").prop("disabled",!1)}else isRefreshNeeded=!0,$(html).find("li#warningHeader").hide();if(successes&&successes.length>0){isSummaryNeeded=!0;message=ZPI18N.getString("zp.quickimportsucccess"),tables=$(html).find("#successBody tbody");$(html).find("li#successHeader").show(),Users.common.toggleActive("directImport","success",html),$.each(successes,function(key,val){var rowHtml=Users.components.summaryRow(val,"",message,"directImport");tables.append(rowHtml)}),$(html).find("li#successHeader b").html(successes.length),pageId.find("button#importButton").prop("disabled",!1),isSuccess=!0}else isRefreshNeeded=!0,$(html).find("li#successHeader").hide();isSummaryNeeded&&pageId.append(html),isRefreshNeeded&&Users.operations.view.submitFilter(Users.common.getExtraParams()),isSuccess&&ZPeople.Message.success(ZPI18N.getString("zp.quickimportsucccess"))},validatePwdPolicy:function(passwd){if($(".dvShwRectcon1").length>0){var pwdKeys=Users.config.pwdPol;if(pwdKeys.hasOwnProperty("minPwdLen")&&passwd.length<=pwdKeys.minPwdLen)return!0;if(pwdKeys.hasOwnProperty("mixedCase")){var smallC=!1,bigC=!1;if(null!=passwd.match(/[a-z]/g)&&passwd.match(/[a-z]/g).length>=1&&(smallC=!0),null!=passwd.match(/[A-Z]/g)&&passwd.match(/[A-Z]/g).length>=1&&(bigC=!0),!smallC||!bigC)return!0}if(pwdKeys.hasOwnProperty("minSplChar")){var allFoundSplCharacters=passwd.match(/[@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/g);if(null==allFoundSplCharacters)return!0;if(!(allFoundSplCharacters.length>=pwdKeys.minSplChar))return!0}if(pwdKeys.hasOwnProperty("minNumChar")){var allFoundNumCharacters=passwd.match(/[\d]/g);if(null==allFoundNumCharacters)return!0;if(!(allFoundNumCharacters.length>=pwdKeys.minNumChar))return!0}}},downloadDirectImportTemplate:function(){var pageId=$(settingsPage.mainWrapId).find("#directImportPopup"),isAGP=ZPeopleComponents.toggleswitch(pageId.find("#agpPassword")).getState();pageId.find("form#quickImportForm");pageId.find("form input#autoGenPassword").val(isAGP),pageId.find("form input#method").val("template"),pageId.find("form#quickImportForm").submit()},toggleTotalCount:function(){var pageContent=settingsPage.container,pageid=Users.common.getCurrentPageId(),hash=$(pageContent).find(`a#${pageid}-hashTotalCount`),params=Users.operations.view.getParamsFromFilter(!1,pageid);params.mode="count",ZPeople.Request.send("/users/getUsersListing",params,function(data,p){hash.html("#"),hash.addClass("DN");var totalCount=$(pageContent).find(`b#${pageid}-totalCount`);totalCount.text(`${data.totalUserCount}`),totalCount.removeClass("DN")})},addSyncLoading:function(ele){$(ele).addClass("disabled"),$(ele).append(ZPeople.LOADING_HTML)},removeSyncLoading:function(ele){$(ele).removeClass("disabled"),$(ele).find("#zp_page_loading").remove()}},edit:{handleUserSelect:function(obj){var pageContent=settingsPage.container,currentPageId=Users.common.getCurrentPageId();obj.id===`${currentPageId+"-massCheckBox"}`&&($(obj).is(":checked")?$(pageContent).find("table#userListTable tbody").find("input[name='userRowCheck']").prop("checked",!0):Users.common.uncheckCheckBoxes(pageContent,currentPageId));if(0!==pageContent.find("table#userListTable tbody tr").find("input[name='userRowCheck']:checked").length?(settingsPage.container.find(".actn_ovrly").addClass("opn"),settingsPage.container.find(".zpl_rgt").hide()):Users.common.uncheckCheckBoxes(pageContent,currentPageId),0===pageContent.find("table#userListTable tbody").find("input[name='userRowCheck']").not(":checked").length?pageContent.find(`input#${currentPageId+"-massCheckBox"}`).prop("checked",!0):pageContent.find(`input#${currentPageId+"-massCheckBox"}`).prop("checked",!1),settingsPage.container.find(".actn_ovrly").hasClass("opn")){pageContent.find("div#licenseDtlsRow").addClass("DN"),pageContent.find("div#dispUserCntTitle").addClass("DN"),NewZPOnboarding.isOnboarding&&pageContent.find("button#triggerOnboardingButton").removeClass("DN"),0===pageContent.find("table#userListTable tbody").find("input[loginstatus='2']:checked").length||Layout.isPeoplePlus||Layout.isZohoOne?pageContent.find("button#resendInviteButton").hide():pageContent.find("button#resendInviteButton").fadeIn();var enabledCheckedCount=pageContent.find("table#userListTable tbody").find("input[loginstatus='1']:checked").length,disabledCheckedCount=pageContent.find("table#userListTable tbody").find("input[loginstatus='0']:checked, input[loginstatus='-1']:checked").length;enabledCheckedCount+disabledCheckedCount==0?pageContent.find(`#${currentPageId}-changeLoginButton`).hide():(pageContent.find(`#${currentPageId}-changeLoginButton`).fadeIn(),disabledCheckedCount>0?$(`#${currentPageId}-changeLoginMenu`).find("#enableLoginOption").show():$(`#${currentPageId}-changeLoginMenu`).find("#enableLoginOption").hide(),enabledCheckedCount>0?$(`#${currentPageId}-changeLoginMenu`).find("#disableLoginOption").show():$(`#${currentPageId}-changeLoginMenu`).find("#disableLoginOption").hide()),Users.operations.view.closeFilters()}},changeLoginStatus:function(obj,mode){var ele=obj;obj instanceof $.Event&&(ele=obj.target);var parentTr=$(ele).closest("tr"),erecNO=$(parentTr).attr("emperecno"),extraParams=Users.common.getExtraParams();if(extraParams.thisObj=ele,"Non-user"===mode){var params={erecno:erecNO,method:"enableDowngradedNonUser"};ZPeople.Request.send("/users/enableDowngradedNonUser",params,Users.operations.edit.handleChangeLoginResponse,extraParams)}else if("MakeNonUser"===mode)Users.operations.edit.canConvertToNonUsers(erecNO,parentTr);else{params={erecno:erecNO,changeStatus:$(ele).attr("changeStatus")};ZPeople.Request.send("users/UpgradeUsers",params,Users.operations.edit.handleChangeLoginResponse,extraParams)}},bulkChangesConsentPopup:function(mode,callback,param){let pageId="#"+Users.common.getCurrentPageId(),popup=$(Users.components.getConsentPopup(Users.operations.edit.getConsentHeaderAndBody(mode)));var closeConsentModal=function(event){"keydown"===event.type&&"Escape"!==event.key||($(document).off("keydown",closeConsentModal),$(pageId).find("#usersConsentPopup").remove())};popup.find("#alrtCls,#cnlBtn").on("click",closeConsentModal),$(document).on("keydown",closeConsentModal),popup.find("#yesBtn").on("click",()=>{$(pageId).find("#usersConsentPopup").remove(),callback(param)}),$(pageId).append(popup)},getConsentHeaderAndBody:function(mode){let result;switch(mode){case"convertToNonUser":result={header:"",body:ZPI18N.getString("zp.bulknonusernoadmperm"),submitBtn:ZPI18N.getString("zp.yes"),cancelBtn:ZPI18N.getString("zp.cancel")};break;case"AddUserFullPagePopup":result={header:"",body:"<p>"+ZPI18N.getString("zp.useraddnotcompleted")+"</p><p> "+ZPI18N.getString("zp.liketoproceed")+"</p>",submitBtn:ZPI18N.getString("zp.yes"),cancelBtn:ZPI18N.getString("zp.cancel")};break;case"resendReject":result={header:"",body:"<p>"+ZPI18N.getString("zp.invrejConf")+"</p>",submitBtn:ZPI18N.getString("zp.yes"),cancelBtn:ZPI18N.getString("zp.cancel")}}return result},bulkChangeLoginStatus:function(mode){var pageId=settingsPage.container,erecNo=[],count=0;if(userTableElm=pageId.find("table#userListTable"),$.each(userTableElm.find("input[name='userRowCheck']:checked"),function(index,obj){erecNo[index]=$(obj).closest("tr").attr("emperecno"),count++}),count>0&&count<=50){if(erecNo.length>0){var params={erecNos:JSON.stringify(erecNo),method:"enable"==mode?"bulkEnableLoginStatus":"bulkDisableLoginStatus"};ZPeople.Request.send("/users/changeLoginStatus",params,Users.operations.edit.handleBulkChangeLoginResponse,Users.common.getExtraParams())}}else ZPeople.Message.failure(ZPI18N.getString("zp.bulkChangeLoginLimit"))},convertDirectly:function(erecNos){var params={erecNos:erecNos,type:1},popup=$(settingsPage.mainWrapId).find("#convertPasswordPopup");if(popup.find(".ztextbox--error__label").hide(),Users.config.toggleAGPforBulkConvDir)params.autoGenPwdBulk=Users.config.toggleAGPforBulkConvDir;else{var password=popup.find("input#userPassword").val();if(ZPSetupCommon.isEmpty(password))return popup.find(".ztextbox--error__label").text(ZPI18N.getString("zp.enterpasswd")),void popup.find(".ztextbox--error__label").show();if(!ZPSetupCommon.isEmpty(password)&&password.length<8)return popup.find(".ztextbox--error__label").text(ZPI18N.getString("zp.passwordlengshort")),void popup.find(".ztextbox--error__label").show();if(Users.operations.add.validatePwdPolicy(password))return popup.find(".ztextbox--error__label").text(ZPI18N.getString("zp.passwordpolicy")),void popup.find(".ztextbox--error__label").show();params.password=password.trim()}popup.find("#directConvertSubmit").html(ZPI18N.getString("zp.pleasewaitmsg")),popup.find("#directConvertSubmit").addClass("disabled"),popup.find("#directConvertCancel").addClass("disabled"),ZPeople.Request.send("/users/convertNonusersToUsers",params,Users.operations.edit.handleBulkChangeLoginResponse,Users.common.getExtraParams())},convertUsersAndNonusers:function(target){var pageId=settingsPage.container,erecNo=[],maxCount=0;if($("#changeLoginSummary").remove(),userTableElm=pageId.find("table#userListTable"),$.each(userTableElm.find("input[name='userRowCheck']:checked"),function(index,obj){erecNo[index]=$(obj).closest("tr").attr("emperecno"),maxCount++}),maxCount>0)if(erecNo.length>0){var erecNos=JSON.stringify(erecNo);"convertInvite"==target?($("#migrateNonusersLoader").show(),ZPeople.Request.send("/users/convertNonusersToUsers",{erecNos:erecNos,type:2},Users.operations.edit.handleBulkChangeLoginResponse,Users.common.getExtraParams())):"user"==target?($("#migrateusersLoader").show(),ZPeople.Request.send("/users/convertUsersToNonUsers",{erecNos:erecNos},Users.operations.edit.handleBulkChangeLoginResponse,Users.common.getExtraParams())):"convertDirect"==target&&($("#migrateNonusersLoader").show(),ZPeople.Request.send("/users/getDomainNonUsersForBulkConversion",{method:"getDomainNonUsersForBulkConversion",erecNos:erecNos},Users.operations.edit.showConvertPasswordPopup,Users.common.getExtraParams()))}else ZPeople.Message.failure(ZPI18N.getString("zp.lookup.norecfound"))},bulkResendInvitation:async function(ele){ele.addClass("disabled");let pageContent=settingsPage.container,erecNos=[];$.each(pageContent.find("table#userListTable tbody").find("tr[status='2'] input[name='userRowCheck']:checked"),function(index,elm){var empErecNo=$(elm).closest("tr").attr("emperecno");erecNos.push(empErecNo)});let result=await ZPeople.Request.sendRequestAsPromise("/users/resendInvitation",{conreqcsr:csrfToken,erecNos:JSON.stringify(erecNos)},{}).then(([response,params,otherdata])=>response).catch(([error,params,otherdata])=>error.responseJSON);ele.removeClass("disabled"),Users.common.uncheckCheckBoxes(pageContent,Users.common.getCurrentPageId());let successRecords=[],errorRecords=[];if(result.error)return void ZPeople.Message.failure(result.message);result.hasOwnProperty("success")&&(successRecords=result.successRecords,errorRecords=result.errorRecords);let summary=new sliderModal(ZPI18N.getString("zp.invsum"),new Tab("bulkResendInvitation",slider=>{let cardiv=slider.tab.cardIdDiv;cardiv.empty();let btnMenu=$(`<div class="zpl_btnmnu"> <div class=""> <ul class="zpl_grpmnu"> <li id="successHdr">Success Records : <b>${successRecords.length}</b></li> <li id="errorHdr">Error Records : <b>${errorRecords.length}</b></li> </ul> </div> </div>`),successBody=$(`<div id="successBody" class="summaryBody zpl_DNI" style=""> <div class="zpl_rgtcnt"> <div class="zpl_tblres"> <table class="zpl_tbl"> <thead> <tr> <th class="wd50_per">${Users.config.emailDispName}</th> <th>${ZPI18N.getString("zp.message")}</th> </tr> </thead> <tbody> </tbody> </table> </div> </div> </div>`),errorBody=$(`<div id="errorBody" class="summaryBody zpl_DNI" style=""> <div class="zpl_rgtcnt"> <div class="zpl_tblres"> <table class="zpl_tbl"> <thead> <tr> <th class="wd50_per">${Users.config.emailDispName}</th> <th>${ZPI18N.getString("zp.message")}</th> </tr> </thead> <tbody> </tbody> </table> </div> </div> </div>`);successRecords.length>0?successRecords.forEach(record=>{successBody.find("tbody").append(`<tr erecno="${record.erecno}"> <td><span>${record.emailId}</span></td> <td><span>${record.message}</span></td> </tr>`)}):btnMenu.find("#successHdr").remove(),errorRecords.length>0?errorRecords.forEach(record=>{let isRejected=!!record.code&&202==record.code;errorBody.find("tbody").append(`<tr erecno="${record.erecno}"> <td><span>${record.emailId}</span></td> <td><span>${isRejected?ZPI18N.getString("zp.blkrejectedinv",[`Users.operations.edit.resentInvitation('${record.erecno}',true)`]):record.message}</span></td> </tr>`)}):btnMenu.find("#errorHdr").remove(),successRecords.length>0?(btnMenu.find("li#successHdr").addClass("zpl_act"),successBody.removeClass("zpl_DNI")):(btnMenu.find("li#errorHdr").addClass("zpl_act"),errorBody.removeClass("zpl_DNI")),btnMenu.find("li").on("click",function(){let ele=$(this);ele.parent().children().removeClass("zpl_act"),ele.addClass("zpl_act"),"successHdr"===ele.attr("id")?(successBody.removeClass("zpl_DNI"),errorBody.addClass("zpl_DNI")):(errorBody.removeClass("zpl_DNI"),successBody.addClass("zpl_DNI"))}),cardiv.append(btnMenu),cardiv.append(successBody),cardiv.append(errorBody)}));summary.setContainerAsBody(!1),summary.setCloseCallback(slider=>{slider.remove()}),summary.construct(void 0,`<button id="sliderCancel" type="button" class="zlabel zlabel--outline zlabel--medium">${ZPI18N.getString("zp.close")}</button>`)},handleChangeLoginResponse:function(data,obj,extraParams){var classNm,thisObj=extraParams.thisObj,pageId=settingsPage.container,tableObj=pageId.find("table#userListTable"),empStatus=pageId.find("table#userListTable").attr("status"),isChangeLoginStatus="enableDowngradedNonUser"!==obj.method,column=$(thisObj).closest("td");if(!ZPSetupCommon.isEmpty(data.SUCCESS)){if(isChangeLoginStatus)if("0"===obj.changeStatus)$(thisObj).attr("changeStatus","1"),column.find("label").attr("title",ZPI18N.getString("zp.enableLogin")),column.prev().text(ZPI18N.getString("zp.inactiveusers")),column.prevObject[0].checked=!1;else if(data.isInvitedUser){var statusIcon="";column.find("label.btnactive.MB0").remove(),column.prev().text(ZPI18N.getString("zp.invited")),Layout.isPeoplePlus?statusIcon="<a title='' class='ZPtitle' data-original-title='"+ZPI18N.getString("zp.resendinv")+"' onclick=Users.operations.edit.resentInvitationForPeoplePlus('"+data.email+"')><span class='PI_mail btnmail'></span></a>":Layout.isZohoOne||(statusIcon="<a title='' class='ZPtitle' data-original-title='"+ZPI18N.getString("zp.resendinv")+"' onclick=Users.operations.edit.resentInvitation('"+obj.erecNo+"')><span class='PI_mail btnmail'></span></a>"),column.find(".dvlist-action.MT4").prepend(statusIcon)}else $(thisObj).attr("changeStatus","0"),column.find("label").attr("title",ZPI18N.getString("zp.disableLogin")),column.prev().text(ZPI18N.getString("zp.orgusers")),column.prevObject[0].checked=!0;else classNm="act_mignonuser btnmail btnMigemp",$(thisObj).attr("data-original-title",ZPI18N.getString("zp.migraToEmp"));isNaN(empStatus)?$(thisObj).find("i").attr("class",classNm):($(thisObj).closest("tr").remove(),0===tableObj.find("tbody tr").length?(tableObj.find("thead").addClass("DN"),tableObj.find("tbody").append(jQuery("<tr />",{id:"noRowsOfOrg"}).append(jQuery("<td />",{class:"text-center",colspan:"7",text:ZPI18N.getString("zp.norecfound")})))):tableObj.find("thead").removeClass("DN")),ZPeople.Message.success(data.SUCCESS),Users.operations.view.submitFilter(extraParams)}if(ZPSetupCommon.isEmpty(data.SUCCESS)){if(isChangeLoginStatus){var status="0"===obj.changeStatus;column.prevObject[0].checked=status,ZPeopleComponents.toggleswitch(column.prevObject[0]).setAttribute("on",status)}ZPeople.Message.failure(data.ERROR)}},showConvertPasswordPopup:function(result,params,extraParams){$("#migrateNonusersLoader").hide();var popup=$(settingsPage.mainWrapId).find("#convertPasswordPopup");if(result.hasOwnProperty("success")){if(Users.config.toggleAGPforBulkConvDir=!0,popup.length>0)popup.find("#directConvertSubmit").html(ZPI18N.getString("zp.submit")),popup.find("#directConvertSubmit").removeClass("disabled"),popup.find("#directConvertCancel").removeClass("disabled"),Users.common.openSlider("convertPasswordPopup");else{var html=Users.components.convertPasswordPopup();$(settingsPage.mainWrapId).append(html),popup=$(settingsPage.mainWrapId).find("#convertPasswordPopup")}popup.find("#userPassword").val(""),popup.find("#directConvertSubmit").off().on("click",function(){Users.operations.edit.convertDirectly(params.erecNos)})}result.hasOwnProperty("Error")&&ZPeople.Request.send("/users/convertNonusersToUsers",{erecNos:params.erecNos,type:1},Users.operations.edit.handleBulkChangeLoginResponse,Users.common.getExtraParams())},handleBulkChangeLoginResponse:function(result,params,extraParams){var pageContent=settingsPage.container,html=(result.modal,""),mode=result.hasOwnProperty("mode")&&"Login Status"==result.mode?"changeLogin":"convert";if(result.hasOwnProperty("mode")&&"Login Status"==result.mode)html=Users.components.summary("changeLogin");else{html=Users.components.summary("convert");$("#migrateusersLoader").hide(),$("#migrateNonusersLoader").hide()}$("#"+mode+"Summary").remove(),Users.common.closeSlider("convertPasswordPopup");var isActive=!1;result.hasOwnProperty("paymentErrInit")?ZPeople.Message.failure(result.paymentErrInit):result.hasOwnProperty("Limitexceeded")&&ZPeople.Message.failure(result.Limitexceeded),result.hasOwnProperty("SuccessMsg")&&ZPeople.Message.success(result.SuccessMsg),result.hasOwnProperty("Success")?(Users.common.toggleActive(mode,"success",html),isActive=!0,$.each(result.Success,function(key,ele){var empId=ele.hasOwnProperty("EmployeeId")?ele.EmployeeId:"",email=ele.hasOwnProperty("mailId")?ele.mailId:"",message=ele.Message;$(html).find("#successBody tbody").append(Users.components.summaryRow(empId,email,message,mode))}),$(html).find("li#successHeader b").html(result.Success.length)):$(html).find("li#successHeader").hide(),result.hasOwnProperty("Errors")?(isActive||Users.common.toggleActive(mode,"error",html),isActive=!0,$.each(result.Errors,function(key,ele){var empId=ele.hasOwnProperty("EmployeeId")?ele.EmployeeId:"",email=ele.hasOwnProperty("mailId")?ele.mailId:"",message=ele.Message;$(html).find("#errorBody tbody").append(Users.components.summaryRow(empId,email,message,mode))}),$(html).find("li#errorHeader b").html(result.Errors.length)):$(html).find("li#errorHeader").hide(),result.hasOwnProperty("Skipped")?(isActive||Users.common.toggleActive(mode,"skipped",html),isActive=!0,$.each(result.Skipped,function(key,ele){var empId=ele.hasOwnProperty("EmployeeId")?ele.EmployeeId:"",email=ele.hasOwnProperty("mailId")?ele.mailId:"",message=ele.Message;$(html).find("#skippedBody tbody").append(Users.components.summaryRow(empId,email,message,mode))}),$(html).find("li#skippedHeader b").html(result.Skipped.length)):$(html).find("li#skippedHeader").hide(),result.hasOwnProperty("ERROR")?ZPeople.Message.failure(result.ERROR):isActive&&$(settingsPage.mainWrapId).append(html),(result.hasOwnProperty("SuccessMsg")||result.hasOwnProperty("Success"))&&Users.operations.view.submitFilter(extraParams),result.hasOwnProperty("Limitexceeded")||Users.common.uncheckCheckBoxes(pageContent,Users.common.getCurrentPageId())},handleResendResponse:function(data,paramsObj,extraParams){var pageContent=extraParams.pageContent,pageId=extraParams.pageId,isBulkResend=extraParams.isBulkResend;if(isBulkResend&&extraParams.bulkResendBtn.removeClass("disabled"),ZPSetupCommon.isEmpty(data.failedRecords)){if("Unconfirmed"==data||"UnConfirmed"==data.result)return void ZPeople.unconfirmedErr();if(!isBulkResend)return"Failure"===data&&ZPeople.Message.failure(ZPI18N.getString("zp.invfailed")),void("failure1"==data.result?ZPeople.Message.failure(ZPI18N.getString("zp.invcase1")):"failure2"==data.result?ZPeople.Message.failure(ZPI18N.getString("zp.invcase2")):"failure3"==data.result?ZPeople.Message.warning(ZPI18N.getString("zp.shorttextunconfirmed",["ZPeople.sendIAMConfirmation()"])):"failure"==data.result?ZPeople.Message.failure(ZPI18N.getString("zp.invcase3")):(ZPeople.Message.success(ZPI18N.getString("zp.invitationsent")),Users.common.uncheckCheckBoxes(pageContent,pageId)));"success"===data.result?(Users.common.uncheckCheckBoxes(pageContent,pageId),ZPeople.Message.success(ZPI18N.getString("zp.invitationsent"))):ZPeople.Message.failure(ZPI18N.getString("zp.invfailed"))}else $.each(data.failedRecords,function(index,erecNo){pageContent.find("table#userListTable tbody tr[emperecno='"+erecNo+"'] input[name='userRowCheck']").prop("checked",!0),ZPeople.Message.failure(ZPI18N.getString("zp.failedinvforselectedrec"))})},canConvertToNonUsers:function(erec,parentTr){var params={erecno:erec},shwMsg="";ZPeople.Request.send("/users/canConvert",params,function(resltObj){if(resltObj.hasOwnProperty("isAllowedToConvert")&&!resltObj.isAllowedToConvert)shwMsg=ZPI18N.getString("zp.paymenterrnonusers",new Array(paymentUrl)),ZPeople.Message.failure(shwMsg);else{shwMsg=resltObj.hasOwnProperty("hasAdminPermission")&&resltObj.hasAdminPermission?ZPI18N.getString("zp.nonuseradmperm"):ZPI18N.getString("zp.nonusernoadmperm");var infoAlert=new InfoAlertMessage("",shwMsg);infoAlert.show();var alertDiv=infoAlert.alertDiv;alertDiv.find("#yesBtn").off(),alertDiv.find("#yesBtn").on("click",function(){Users.operations.edit.proceedToUserConversion(erec,parentTr),alertDiv.find("#cnlBtn").click()})}})},proceedToUserConversion:function(erec,parentTr){var params={erecno:erec};ZPeople.Request.send("/users/userConvert",params,function(resltObj){resltObj.isConverted?(parentTr.remove(),ZPeople.Message.success(ZPI18N.getString("zp.usernonusersuccess")),Users.config.nonuserFilterParams.userStatus=resltObj.filterStatus):resltObj.hasOwnProperty("code")?ZPeople.Message.failure(resltObj.message):ZPeople.Message.failure(ZPI18N.getString("zp.usernonuserfail"))})},getUserConversionRecordData:function(){let ele=Users.config.convertRecordEle,data={zuid:$(ele).closest("tr").attr("zuid"),employeeId:$(ele).closest("tr").data("employeeId"),empMailAlias:$(ele).closest("tr").data("empMailAlias"),empFname:$(ele).closest("tr").data("empFname"),empLname:$(ele).closest("tr").data("empLname"),erecno:$(ele).closest("tr").attr("emperecno")};return Users.config.convertRecordEle={},data},populateDataForConversion:function(ele){Users.config.convertRecordEle=ele,Users.operations.add.handleMenu(!0)},populateDataForConversionOld:function(ele){var pageId=$(settingsPage.mainWrapId);Users.operations.add.handleMenu(!0),Users.common.changeSliderFooter("#addNonUserMenu",Users.components.convertNonuserFooter($(ele).closest("tr").attr("emperecno")));var zuid=$(ele).closest("tr").attr("zuid");pageId.find("#addNonUserMenu #convertNonuserForm #userEmailSectionLabel i").remove(),zuid&&-1!=zuid&&""!=zuid?(pageId.find("#addNonUserMenu #convertNonuserForm input#userEmail").addClass("disabled"),pageId.find("#addNonUserMenu #convertNonuserForm #userEmailSectionLabel").append("<i class='PI_info' title='"+ZPI18N.getString("zp.canteditusercovertedempemailid")+"'></i>")):pageId.find("#addNonUserMenu #convertNonuserForm input#userEmail").removeClass("disabled"),pageId.find("#addNonUserMenu #convertNonuserForm #userLastnameSection label").addClass("zpl_mtry"),pageId.find("#addNonUserMenu #convertNonuserForm #userEmailSection label").addClass("zpl_mtry"),pageId.find("#addNonUserMenu #convertNonuserForm input#userId").val($(ele).closest("tr").data("employeeId")),pageId.find("#addNonUserMenu #convertNonuserForm input#userEmail").val($(ele).closest("tr").data("empMailAlias")),pageId.find("#addNonUserMenu #convertNonuserForm input#userFirstname").val($(ele).closest("tr").data("empFname")),pageId.find("#addNonUserMenu #convertNonuserForm input#userLastname").val($(ele).closest("tr").data("empLname")),pageId.find("#addNonUserMenu #convertNonuserForm input#userUsername").val($(ele).closest("tr").data("empMailAlias").split("@")[0]),pageId.find("#addNonUserMenu #convertNonuserForm input").removeClass("ztextbox__error"),pageId.find("#addNonUserMenu #convertNonuserForm div.ztextbox--error__label").remove()},togglePopupPassword:function(){$(".zpl_mdl #manualPassword").toggleClass("DN"),Users.config.toggleAGPforBulkConvDir=!Users.config.toggleAGPforBulkConvDir},resentInvitation:async function(erecNot,resendReject){let erecArray=[erecNot],params={erecNos:JSON.stringify(erecArray)};resendReject&&(params.resendReject=resendReject);let result=await ZPeople.Request.sendRequestAsPromise("/users/resendInvitation",params,{}).then(([response,params,otherdata])=>response).catch(([error,params,otherdata])=>error.responseJSON);if(result.error)ZPeople.Message.failure(result.message);else if(result.hasOwnProperty("success"))if(result.success){let successRecord=result.successRecords[0];ZPeople.Message.success(successRecord.message)}else{let errorRecord=result.errorRecords[0],code=errorRecord.code,message=errorRecord.message;202==code?Users.operations.edit.bulkChangesConsentPopup("resendReject",()=>{Users.operations.edit.resentInvitation(erecNot,!0)}):ZPeople.Message.failure(message)}},resentInvitationForPeoplePlus:function(mailAlias){var extraParams=Users.common.getExtraParams();extraParams.isBulkResend=!1,ZPeople.Request.send("/pplus/resendInvitation",{action:"resendInvitation",mailAlias:mailAlias},Users.operations.edit.handleResendResponse,extraParams)},confirmFormEdit:function(erecno){var id="confirmEditUserForm",html=Users.components.confirm(id,"","Do you want to update more employee details?");$(html).find("#confirmButton").on("click",function(){Users.operations.edit.formEdit(erecno)}),$(html).find("._cls, button.zlabel--outline").on("click",function(){$(`${"#"+id}`).remove()}),$(settingsPage.mainWrapId).append(html)},formEdit:function(erecno){$(settingsPage.mainWrapId).find("#confirmEditUserForm").remove(),"user"==Users.config.currMode?Users.common.toggleSlider("#addUserMenu"):Users.common.toggleSlider("#addNonUserMenu"),Users.operations.edit.singleRecord(erecno)},singleRecord:function(recId){var url=`#operations/organization/employee/edit-recordId:${recId}`;window.open(url,"_blank")}},del:{initialConfirm:function(thisObj,empFormId){var ele=$(thisObj).closest("tr"),title=ZPI18N.getString("zp.deleteconfirm"),content=ZPI18N.getString("zp.userconfirmmsg"),id="initialConfirmDelete",html=Users.components.deletePopup(id,title,content);$(html).find("#confirmButton").on("click",function(){Users.operations.del.finalConfirm(ele,empFormId)}),$(html).find("._cls, button.zlabel--outline").on("click",function(){$(`${"#"+id}`).remove()}),$(settingsPage.mainWrapId).append(html)},finalConfirm:function(ele,empFormId){var id="finalConfirmDelete",title=ZPI18N.getString("zp.deleteconfirm"),content=ZPI18N.getString("zp.recordsdeleteconfirmmsg",[1]),html=Users.components.deletePopup(id,title,content);$(html).find("#confirmButton").text(ZPI18N.getString("zp.yes")+", "+ZPI18N.getString("zp.proceed")),$(html).find("#confirmButton").on("click",function(){Users.operations.del.submit(ele,empFormId)}),$(html).find("._cls, button.zlabel--outline").on("click",function(){$(`${"#"+id}`).remove()}),$("#initialConfirmDelete").remove(),$(settingsPage.mainWrapId).append(html)},submit:function(obj,empFormId){settingsPage.container;var params={mode:"deleteRecords",formId:empFormId,recordIds:$(obj).attr("emperecno"),conreqcsr:csrfToken};$.post("/formAction.zp",params,function(data){if($("#finalConfirmDelete").remove(),7e3===data.code){let message=ZPI18N.getString("zp.recorddeletedsuccessfully"),isSuccess=!0;data.partialdelection&&(message=ZPI18N.getString("zp.payroll.fewuserdel"),isSuccess=!1),isSuccess?(ZPeople.Message.success(message),Users.operations.view.submitFilter()):ZPeople.Message.failure(message)}else void 0!==data.message?ZPeople.Message.failure(data.message):7500===data.code?ZPeople.Message.failure(ZPI18N.getString("zp.payroll.usercantdel")):ZPeople.Message.failure(ZPI18N.getString("zp.sorryservererror"))})}}},Users.operations.add.createNonUserForm=function(result,params){if(Users.config.isAllowToAddNonuser){let config=[];config.push(Users.operations.add.getAddUserParams("nonuser")),config.push(Users.operations.add.userBasicInfoParams()),UserManager.getInstance("addnonuser_popup",{wrapperContainer:Users.operations.add.sliderContainer(),config:config},(isChanged,isCompleted)=>{isChanged&&Users.operations.view.submitFilter(),isCompleted&&UserManager.removeInstance("addnonuser_popup")}).showPopup()}else Users.operations.add.handleNoLicense(result,params)},Users.operations.add.createConvertNonUserForm=function(result,params){if(Users.config.isAllowToAddUser){let config=[];config.push(Users.operations.add.getAddUserParams("convert")),config.push(Users.operations.add.userBasicInfoParams()),UserManager.getInstance("convertnonuser_popup",{wrapperContainer:Users.operations.add.sliderContainer(),config:config},(isChanged,isCompleted)=>{isChanged&&Users.operations.view.submitFilter()}).showPopup()}else Users.operations.add.handleNoLicense(result,params)},Users.operations.add.getAddUserParams=function(mode){return{id:"account_creation",dispName:ZPI18N.getString("zp.createuseracc"),containerClass:UserNonuserAdder,footerSubmitText:ZPI18N.getString("zp.create"),ALLOW_MOBILEUSER_ADDITION:Users.config.ALLOW_MOBILEUSER_ADDITION,isAddUserDirectlyAllowed:Users.config.isAddUserDirectlyAllowed,form:Users.operations.add.getFormParams(),license:Users.operations.add.getUsersLicenseParams(mode),addParams:Users.operations.add.addParams(mode),isSequential:!0,hideClose:"nonuser"!=mode&&"convert"!=mode,footerCancelTxt:ZPI18N.getString("zp.cancel")}},Users.operations.add.addParams=function(mode){switch(mode){case"invite":return{formId:"#inviteUserForm",isNonuser:!1,isDirect:!1,isMigrate:!1,isMobile:!1};case"direct":return{formId:"#directUserForm",isNonuser:!1,isDirect:!0,isMigrate:!1,isMobile:!1,isAGP:!0};case"nonuser":return{formId:"#addNonuserForm",isNonuser:!0,isDirect:!1,isMigrate:!1,isMobile:!1};case"convert":return{formId:"#convertNonuserForm",isNonuser:!1,isDirect:!1,isMigrate:!0,isMobile:!1,recordData:Users.operations.edit.getUserConversionRecordData()}}},Users.operations.add.getUsersLicenseParams=function(mode){return"nonuser"==mode?{usersMax:Users.config.nonusersMax,usersAdded:Users.config.nonusersAdded,usersLeft:Users.config.nonusersLeft}:{usersMax:Users.config.usersMax,usersAdded:Users.config.usersAdded,usersLeft:Users.config.usersLeft,otherAppLicense:Users.config.otherAppLicense,adminPanelAppsPageUrl:Users.config.adminPanelAppsPageUrl}},Users.operations.add.getFormParams=function(){return{empidDispName:Users.config.empidDispName,lastEmployeeId:Users.config.lastEmployeeId,fnameDispName:Users.config.fnameDispName,lnameDispName:Users.config.lnameDispName,emailDispName:Users.config.emailDispName,locationDispName:Users.config.locationDispName,isOnboarding:Users.config.isOnboarding,locAdminDetails:Users.config.locAdminDetails,userDomains:Users.config.userDomains,pwdPol:Users.config.pwdPol,isPermAllowedForEmpId:Users.config.isPermAllowedForEmpId,directRows:0}},Users.operations.add.getUserMenuParams=function(mode,isReconstruct){return{id:"user_addition_menu",dispName:ZPI18N.getString("zp.selection"),footerSubmitText:ZPI18N.getString("zp.next"),containerClass:UserAdditionMenu,isSequential:!0,license:Users.operations.add.getUsersLicenseParams(),mode:mode,init:!isReconstruct}},Users.operations.add.userBasicInfoParams=function(){return{id:"add_user_data",dispName:ZPI18N.getString("zp.adduserdata"),isSkipRequired:!0,footerSubmitText:ZPI18N.getString("zp.update"),footerSkipText:ZPI18N.getString("zp.skip"),footerCancelTxt:ZPI18N.getString("zp.cancel"),isSequential:!0,containerClass:BasicInfoHandler,isAsync:!1}},Users.operations.add.getPostAddActionsHandlerParams=function(){return{id:"Post_Add_Actions",dispName:ZPI18N.getString("zp.alerts"),isSkipRequired:!0,footerSubmitText:"Trigger",footerSkipText:ZPI18N.getString("zp.skip"),footerCancelTxt:ZPI18N.getString("zp.cancel"),containerClass:PostAddActionsHandler}};const UserManager=function(){return{getInstance:(name,props,closeCallback,customCallback)=>Users.config.addUserInstances[name]?Users.config.addUserInstances[name]:(Users.config.addUserInstances[name]=new class{constructor(name,props,closeCallback,customCallback){this.name=name,this.initVariables(),this.modalContainer=$(Users.components.addUser.addUserOuterModal(name)),this.wrapperContainer=props.wrapperContainer,this.config=props.config,this.closeCallback=closeCallback,this.customCallback=customCallback,this.wrapperContainer.append(this.modalContainer),this.init()}initVariables(){this._wrapperElements={},this._progressBarInstances=[],this._containerInstances=[],this._footerInstances=[],this.nonSkippableEle=[],this._activeProgressBarInstance=null,this._activeContainerInstance=null,this._activeFooterInstance=null,this.commonData={},this.isChanged=!1,this.isCompleted=!1}init(){this.getWrapperElements(),this.createProgressBars(),this.createContainers(),this.createFooters(),this.setActiveInstance(1)}getWrapperElements(){this.modalContainer.data("closeCallback",()=>{this.closePopup()}),this._wrapperElements.modalId=this.modalContainer.attr("id"),this._wrapperElements.previousBtn=this._wrapperElements.modalId+"-previousBtn",this._wrapperElements.closeBtn=this._wrapperElements.modalId+"-closeBtn",this._wrapperElements.progressBar=this._wrapperElements.modalId+"-progressBar",this._wrapperElements.contWrap=this._wrapperElements.modalId+"-contWrap",this._wrapperElements.footer=this._wrapperElements.modalId+"-footer",this.modalContainer.find("#"+this._wrapperElements.closeBtn).off("click").on("click",()=>{this.closePopup()}),this.modalContainer.find("#"+this._wrapperElements.previousBtn).off("click").on("click",()=>{this.progressBarActionCallback("previous",this._activeProgressBarInstance)})}createProgressBars(){this.config.forEach((data,index)=>{const instance=new UserAdditionProgressBar(index+1,data,(type,instance)=>{this.progressBarActionCallback(type,instance)});!instance.isSkipped&&instance.isSequential&&this.nonSkippableEle.push(instance),this._progressBarInstances.push(instance),1!==this.config.length&&this.modalContainer.find("#"+this._wrapperElements.progressBar).append(instance.listItem)})}createContainers(){this.config.forEach((data,index)=>{data.setCommonData=((key,value)=>{this.setCommonData(key,value)}),data.getCommonData=(()=>this.getCommonData()),"function"==typeof this.customCallback&&(data.customCallback=(data=>{this.customCallback(data)})),this.modalContainer.find("#"+this._wrapperElements.contWrap).append(`<div id="${this._wrapperElements.modalId}-contWrap-${data.id}"></div>`);const instance=new data.containerClass(data,this.modalContainer.find(`#${this._wrapperElements.contWrap} #${this._wrapperElements.modalId}-contWrap-${data.id}`));this._containerInstances.push(instance)})}createFooters(){this.config.forEach((data,index)=>{index==this.config.length-1&&(data.isLastItem=!0),this.modalContainer.find("#"+this._wrapperElements.footer).append(`<div id="${this._wrapperElements.modalId}-footer-${data.id}" class="zpl_DNI"></div>`);const wrapper=this.modalContainer.find(`#${this._wrapperElements.footer} #${this._wrapperElements.modalId}-footer-${data.id}`),instance=new AddUserFullPagePopupFooter(wrapper,this._progressBarInstances[index],this._containerInstances[index],data,()=>{this.closePopup()});this._footerInstances.push(instance)})}showPopup(){this.wrapperContainer.find("#"+this._wrapperElements.modalId).addClass("zpl_mopen")}closePopup(){this.closeCallback(this.isChanged),this.removePageRestrictions(),this.destructor()}progressBarActionCallback(type,progressBarInstance){if("completed"==type)this.markAsCompleted(progressBarInstance),this.progressBarActionCallback("next",progressBarInstance);else if("skipped"==type||"next"==type){const nextProgress=this._progressBarInstances[progressBarInstance.order];nextProgress&&this.progressBarActionCallback("toggle",nextProgress)}else if("toggle"==type){if(progressBarInstance.order==this._activeProgressBarInstance.order)return;if(progressBarInstance.isCompleted||1==progressBarInstance.order)this.setActiveInstance(progressBarInstance.order);else{const notCompletedInstanceOrder=this.nonSkippableEle[0]?this.nonSkippableEle[0].order:this._progressBarInstances.length+1;progressBarInstance.order<=notCompletedInstanceOrder&&this.setActiveInstance(progressBarInstance.order)}}else"previous"==type&&this.progressBarActionCallback("toggle",this._progressBarInstances[progressBarInstance.order-2])}markAsCompleted(pInstance){this.nonSkippableEle=this.nonSkippableEle.filter(obj=>obj.order!==pInstance.order),"function"==typeof this._containerInstances[pInstance.order-1].setDisabled&&this._containerInstances[pInstance.order-1].setDisabled(),pInstance.hideClose&&(this.hideCloseBtn(),window.addEventListener("beforeunload",this.preventPageReload)),this.isChanged=!0}preventPageReload(event){event.preventDefault(),alert("Please complete the process to close the window")}removePageRestrictions(){window.removeEventListener("beforeunload",this.preventPageReload)}setActiveInstance(order){this._activeProgressBarInstance=this._progressBarInstances[order-1],this._activeContainerInstance=this._containerInstances[order-1],this._activeFooterInstance=this._footerInstances[order-1],this.togglePreviousBtn(order),this.toggleActiveState(),this.deactivateOthers(order)}toggleActiveState(){this._activeProgressBarInstance.setActive(),this._activeContainerInstance.setActive(),this._activeFooterInstance.setActive()}deactivateOthers(activeStage){for(let i=0;i<=this._progressBarInstances.length-1;i++)i!==activeStage-1&&(this._progressBarInstances[i].removeActive(),this._containerInstances[i].removeActive(),this._footerInstances[i].removeActive())}togglePreviousBtn(order){order>1?this.wrapperContainer.find("#"+this._wrapperElements.previousBtn).removeClass("zpl_DNI"):this.wrapperContainer.find("#"+this._wrapperElements.previousBtn).addClass("zpl_DNI")}setCommonData(key,value){this.commonData[key]=value}getCommonData(){return this.commonData}destructor(){this.destructInnerClasses(),this.modalContainer.remove(),UserManager.removeInstance(this.name)}destructInnerClasses(){this._containerInstances.forEach((instance,index)=>{"function"==typeof instance.destructor&&instance.destructor()})}hideCloseBtn(){this.modalContainer.find("#"+this._wrapperElements.closeBtn).addClass("zpl_DNI")}showCloseBtn(){this.modalContainer.find("#"+this._wrapperElements.closeBtn).removeClass("zpl_DNI")}reconstruct(config){this.destructInnerClasses(),this.modalContainer.find("#"+this._wrapperElements.progressBar).empty(),this.modalContainer.find("#"+this._wrapperElements.contWrap).empty(),this.modalContainer.find("#"+this._wrapperElements.footer).empty(),this.initVariables(),config&&(this.config=config),this.init()}}(name,props,closeCallback,customCallback),Users.config.addUserInstances[name]),removeInstance(name){delete Users.config.addUserInstances[name]},hasInstance:name=>Users.config.addUserInstances.hasOwnProperty(name)}}();class UserAdditionProgressBar{constructor(order,data,actionCallback){this.isCompleted=!1,this.isDisabled=!1,this.isSkipped=!!data.hasOwnProperty("isSkipRequired")&&data.isSkipRequired,this.isSequential=void 0===data.isSequential||data.isSequential,this.hideClose=data.hasOwnProperty("hideClose")&&data.hideClose,this.order=order,this.tabId=data.id,this.dispName=data.dispName,this.actionCallback=actionCallback,this.listItem=$(`<li id="${this.tabId}"><b>${order}</b><a>${data.dispName}</a></li>`).on("click",()=>{actionCallback("toggle",this)})}setActive(){this.listItem.addClass("zpl_act")}removeActive(){this.listItem.removeClass("zpl_act")}setCompleted(){this.isCompleted=!0,this.actionCallback("completed",this)}nextProgress(){this.actionCallback("next",this)}skipProgress(){this.nextProgress()}}class AddUserFullPagePopupFooter{constructor(wrapper,progressBarInstance,containerInstance,config,closeCallback){this.wrapper=wrapper,this.containerInstance=containerInstance,this.progressBarInstance=progressBarInstance,this.config=config,this.isAsync=void 0===this.config.isAsync||this.config.isAsync,this.closeCallback=closeCallback,this.setContSubmitAction(),this.constructFooter()}constructFooter(){if(this.config.isLastItem)return void this.setFinish();let submitBtn=`<button type="button" id="${this.config.id}-footer-submit" class="zlabel zlabel--blue zlabel--medium">${this.config.footerSubmitText}</button>`,skipBtn=this.config.isSkipRequired?`<button id="${this.config.id}-footer-skip" class="zlabel zlabel--outline zlabel--medium">${this.config.footerSkipText}</button>`:"";this.wrapper.append(submitBtn+skipBtn),this.wrapper.find("#"+this.config.id+"-footer-submit").on("click",()=>{this.isAsync?this.asyncSubmitCallback():this.submitCallback()}),this.wrapper.find("#"+this.config.id+"-footer-skip").on("click",()=>{this.skipCallBack()})}setActive(){this.wrapper.removeClass("zpl_DNI"),this.containerInstance.hasOwnProperty("isDisabled")&&this.containerInstance.isDisabled&&this.setNext()}setDisabled(){this.wrapper.find("#"+this.config.id+"-footer-submit , #"+this.config.id+"-footer-skip ,#"+this.config.id+"-footer-finish").addClass("disabled")}removeActive(){this.wrapper.addClass("zpl_DNI")}removeDisabled(){this.wrapper.find("#"+this.config.id+"-footer-submit , #"+this.config.id+"-footer-skip ,#"+this.config.id+"-footer-finish").removeClass("disabled")}async asyncSubmitCallback(){this.setDisabled();let response=await this.containerInstance.submitForm();this.callback(response)}submitCallback(){this.setDisabled(),this.containerInstance.submitForm(data=>{this.callback(data)})}callback(response){response&&response.hasOwnProperty("success")?this.config.isLastItem?this.closeCallback():this.config.hasOwnProperty("isSequential")&&!this.config.isSequential||this.progressBarInstance.isSkipped?(this.progressBarInstance.nextProgress(),this.removeDisabled()):(this.setNext(),this.progressBarInstance.setCompleted(),this.removeDisabled()):this.removeDisabled()}setNext(){if(this.wrapper.find("#"+this.config.id+"-footer-submit , #"+this.config.id+"-footer-cancel , #"+this.config.id+"-footer-skip").remove(),0==this.wrapper.find(`#${this.config.id}-footer-next`).length){let nextBtn=$(`<button type="button" id="${this.config.id}-footer-next" class="zlabel zlabel--blue zlabel--medium">${ZPI18N.getString("zp.next")}</button>`);nextBtn.on("click",()=>{this.progressBarInstance.nextProgress()}),this.wrapper.prepend(nextBtn)}}skipCallBack(){this.progressBarInstance.skipProgress()}setFinish(){if(0==this.wrapper.find(`#${this.config.id}-footer-finish`).length){let finishBtn=$(`<button type="button" id="${this.config.id}-footer-finish" class="zlabel zlabel--blue zlabel--medium">Finish</button>`);finishBtn.on("click",()=>{this.isAsync?this.asyncSubmitCallback():this.submitCallback()}),this.wrapper.append(finishBtn)}}setContSubmitAction(){this.containerInstance.footerSubmit=(()=>{this.isAsync?this.asyncSubmitCallback():this.submitCallback()})}}class PostAddActionsHandler{constructor(config,container){this.isDisabled=!1,this.config=config,this.wrapperContainer=container,this.constructTriggerOnbForm()}constructTriggerOnbForm(){this.wrapperContainer.append(Users.components.addUser.constructPostAddActionsForm((id,ele)=>{this.toggleRadioBtn(id,ele)}))}async submitForm(){try{var triggerOnb=!1;let triggerWorkFlow=!1;this.wrapperContainer.find("#postAddActionCard #userOnboardingSection").is(":visible")&&(triggerOnb=this.wrapperContainer.find("#postAddActionCard #userOnboardingEnable").is(":checked")),this.wrapperContainer.find("#postAddActionCard #userWorkflowSection").is(":visible")&&(triggerWorkFlow=this.wrapperContainer.find("#postAddActionCard #userWorkflowEnable").is(":checked")),await this.submitWorkFlowForm(triggerWorkFlow),Users.config.isOnboarding&&triggerOnb&&await this.submitTriggerOnbForm()}catch(e){}finally{return{success:"success"}}}async submitWorkFlowForm(triggerUserAddWorkFlow){let data=this.config.getCommonData();if(data.hasOwnProperty("addUser")&&"addUser"==data.addUser.param.method&&data.addUser.param.type){let addedUserErecNo=data.addUser.result.addedUserErecNo,result=await new Promise((resolve,reject)=>{ZPeople.Request.send("users/triggerUserAddWorkFlow",{erecno:addedUserErecNo,triggerUserAddWorkFlow:triggerUserAddWorkFlow},data=>{resolve(data)},{},error=>{resolve()})});Users.config.isOnboarding||"success"!=result.status||ZPeople.Message.success(ZPI18N.getString("zp.adduser.workflowtriggered"))}}async submitTriggerOnbForm(){let data=this.config.getCommonData();if(data.hasOwnProperty("addUser")&&"addUser"==data.addUser.param.method&&data.addUser.param.type){let dataObj,erecnoobj=JSON.stringify([data.addUser.result.addedUserErecNo]),params={};if(params.erecnoobj=erecnoobj,await new Promise((resolve,reject)=>{ZPeople.Request.send("/onboarding/reports/bulkTrigger",params,result=>{dataObj=result,resolve()})}),dataObj.Success)return ZPeople.Message.success(ZPI18N.getString("zp.onboardingtriggeredsuccess")),{success:ZPI18N.getString("zp.onboardingtriggeredsuccess")};dataObj.hasOwnProperty("onbtriggeredalready")||dataObj.hasOwnProperty("invaliduser")||dataObj.hasOwnProperty("onbdoesntexist")||dataObj.hasOwnProperty("adminusers")?$.each(dataObj,function(index1,msgobj){"Success"!=index1&&("onbtriggeredalready"==index1?ZPeople.Message.failure(ZPI18N.getString("zp.onbalreadytriggered")):"invaliduser"==index1?html+=ZPI18N.getString("zp.notvailduser"):"onbdoesntexist"==index1?html+=ZPI18N.getString("zp.nomatchonbflow"):"adminusers"==index1&&(html+=ZPI18N.getString("zp.noonbforadmin")))}):void 0!=dataObj.msg?ZPeople.Message.failure(dataObj.msg):ZPeople.Message.warning(ZPI18N.getString("zp.sorryservererror"))}}toggleRadioBtn(parendId,ele){this.wrapperContainer.find(parendId).find("input").removeAttr("checked"),$(ele).find("input").attr("checked","checked")}removeActive(){this.wrapperContainer.removeClass("zpl_act")}setActive(){this.wrapperContainer.addClass("zpl_act");let data=this.config.getCommonData();data.hasOwnProperty("addUser")&&"bulkInviteUser"==data.addUser.param.method&&this.setDisabled(),data.hasOwnProperty("addUser")&&"addMultiUsers"==data.addUser.param.method&&this.setDisabled()}setDisabled(){this.isDisabled=!0,this.wrapperContainer.find("#postAddActionCard").addClass("disabled")}}class BasicInfoHandler{constructor(data,wrapper){this.isDisabled=!1,this.isInitializeCompleted=!1,this.wrapperContainer=wrapper,this.config=data,this.callback=null}submitForm(callback){this.callback=callback,this.formInstance&&this.formInstance.submitBtn()}submitCallback(data){"function"==typeof this.callback&&this.callback(data)}constructBasicInfo(){let data=this.config.getCommonData();if(data.hasOwnProperty("addUser")&&"addUser"==data.addUser.param.method){var params={formId:ZPeople.EMP_FORMID,userSuccessCallback:data=>{this.submitCallback({success:"added successfully"})},userFailureCallback:()=>{this.submitCallback({error:"error while submit"})},recordId:data.addUser.result.addedUserErecNo,disableUrlTrack:!0,moduleKey:"P_User_Addition",formMode:"EDIT"};this.formInstance=ZP5Form._toForm(params),this.formInstance.setFormContainer(this.wrapperContainer),this.formInstance.setFormModel(ZP5Form.MODEL.NO_MODEL),this.formInstance.skipFooter(!0),this.formInstance.skipHeader(!0),this.formInstance.setOuterHeaderSkip(!0),this.formInstance.setIsFormForFieldLayout(),this.formInstance.init()}else this.wrapperContainer.append(Users.components.addUser.basicInfoDummyHtml()),this.setDisabled()}removeActive(){this.wrapperContainer.removeClass("zpl_act")}setActive(){this.wrapperContainer.addClass("zpl_act"),this.isInitializeCompleted||(this.isInitializeCompleted=!0,this.constructBasicInfo())}setDisabled(){this.isDisabled=!0,this.wrapperContainer.addClass("disabled")}destructor(){this.formInstance&&this.formInstance.layoutRevertChanges(this.formInstance)}}class UserAdditionMenu{constructor(data,wrapper){this.isDisabled=!1,this.isInitializeCompleted=!1,this.wrapperContainer=wrapper,this.config=data,this.callback=null,this.mode=this.config.mode,this.init=this.config.init}constructMenu(){this.isInitializeCompleted=!0,this.wrapperContainer.append(Users.components.addUser.userLicenseRow(this.config.license)),this.wrapperContainer.append(Users.components.addUser.UserAdditionMenu(async(ele,mode)=>await this.action(ele,mode))),!this.init&&this.mode&&"function"==typeof this.footerSubmit&&this.footerSubmit()}async action(ele,mode){let otherData={};if(otherData.mode=mode,"bundle"==mode||Layout.isPeoplePlus&&("invite"==mode||"direct"==mode)&&"operations"!=Layout.HashConfigUtil.getPageMode(Layout.HashUtil.getCurrentHashConfig()))return void(Users.operations.add.isRedirectedToBundle()&&this.footerSubmit());if(this.mode==mode)return void this.footerSubmit();let oldMode=this.mode;if(this.mode=mode,"Zoho"==mode||"Office365"==mode||"GApps"==mode){let dataObj;Users.operations.add.addSyncLoading(ele);let url="Zoho"==mode?"/users/getZohoMailUsers":"GApps"==mode?"/users/getGAppsUsers":"Office365"==mode?"/getOffice365Actions.zp":"",listingParams="Zoho"==mode?{method:"getZohoUsersNewUI"}:"GApps"==mode?{method:"getGAppsUsersNewUI"}:"Office365"==mode?{mode:"userlisting"}:{};await new Promise((resolve,reject)=>{ZPeople.Request.send(url,listingParams,data=>{dataObj=data,resolve()})}),Users.operations.add.removeSyncLoading(ele);let hasErrors=!1;if(dataObj.ERROR)ZPeople.Message.failure(dataObj.ERROR,"",3e4),hasErrors=!0;else{var syncUsersObj=dataObj.zohoUsers;"Office365"!=mode&&"GApps"!=mode||(syncUsersObj=dataObj.SUCCESS,otherData.isEnabledNotify=dataObj.isEnabledNotify,Users.config.isNotificationEnabled=dataObj.isEnabledNotify,otherData.officeNextLink=dataObj.nextLink),otherData.syncUsersCnt=Object.keys(syncUsersObj).length;var zohoRowListElm="";"Zoho"==mode?$.each(syncUsersObj,function(zuids,userDtls){zohoRowListElm+=Users.components.addUser.syncUserRow(userDtls.dispName,userDtls.mailId,userDtls.photo,mode)}):$.each(syncUsersObj,function(zuids,userDtls){zohoRowListElm+=Users.components.addUser.syncUserRow(userDtls.user,userDtls.emailId,null,mode)}),otherData.rowsHtml=$(zohoRowListElm),otherData.balanceUser=dataObj.balanceUser}if(hasErrors)return this.mode=oldMode,!1}this.mode==mode&&this.config.customCallback(otherData)}getScopeConsent(url,clickedEle,mode){Users.config.syncConsentCallbackFn=(()=>{this.action(clickedEle,mode)});var width=.7*screen.width,height=.7*screen.height,left=(screen.width-width)/2,top=(screen.height-.8*screen.height)/2;window.open(url,"AuthFromZP","width="+width+",height="+height+",left="+left+",top="+top+",screenX="+left+",screenY="+top)}submitForm(){return{success:"success"}}setActive(){this.wrapperContainer.addClass("zpl_act"),!this.isInitializeCompleted&&this.constructMenu()}setDisabled(){this.isDisabled=!0,this.wrapperContainer.addClass("disabled")}removeActive(){this.wrapperContainer.removeClass("zpl_act")}}class SyncUserAccCreationHandler{constructor(config,wrapperContainer){this.isDisabled=!1,this.config=config,this.wrapperContainer=wrapperContainer,this.constructSyncForm()}constructSyncForm(){this.wrapperContainer.append(Users.components.addUser.userLicenseRow(this.config.license)),this.formId="sync"+this.config.mode+"UserForm";var html=Users.components.syncUserForm(this.config.mode);this.wrapperContainer.append(html);let table=Users.components.addUser.syncUserFormTableHtml(this.config.mode,(ele,id)=>{this.handleSyncCheckbox(ele,id)});var checkBoxFn=(ele,id)=>{this.handleSyncCheckbox(ele,id)};this.config.rowsHtml.find(".zcheckbox").on("click",function(){checkBoxFn($(this),$(this).attr("id"))}),0===this.config.syncUsersCnt?(table.find("table").hide(),0==table.find(".zpl_tblres #emptPage").length&&(table.find(".zpl_tblres").append(Users.components.noRecordsPage()),table.find(".zpl_crdhdr").addClass("zpl_DNI"),this.wrapperContainer.find("#"+this.formId).append(table))):(table.find(".zpl_crd .zpl_crdhdr").show(),table.find("#userListTable").show(),table.find(".zpl_tblres #emptPage").remove(),this.wrapperContainer.find("input#massChecked").prop("checked",!1),"Office365"==this.config.mode&&null!=this.config.officeNextLink&&void 0!=!this.config.officeNextLink&&table.find("table").append(Users.components.syncTableFooter(async()=>{await this.getMoreSyncRecords()})),table.find("tbody").append(this.config.rowsHtml),table.find("tbody").attr("balanceUser",this.config.balanceUser),this.wrapperContainer.find("#"+this.formId).empty(),this.wrapperContainer.find("#"+this.formId).append(table),this.wrapperContainer.find("#"+this.formId+"-count i").html(this.config.syncUsersCnt)),Users.common.initTooltip()}async getMoreSyncRecords(){var pageContent=this.wrapperContainer.find("#"+this.formId);let result;pageContent.find("input#massChecked").prop("checked",!1),null!=this.config.officeNextLink&&void 0!=this.config.officeNextLink||pageContent.find("#showMoreDiv").remove(),await new Promise((resolve,reject)=>{ZPeople.Request.send("/getOffice365Actions.zp",{mode:"userlisting",nextLink:this.config.officeNextLink},data=>{result=data,resolve()})}),result.nextLink?this.config.officeNextLink=result.nextLink:(this.config.officeNextLink=null,pageContent.find("#showMoreDiv").remove());let rows="",mode=this.config.mode;$.each(result.SUCCESS,function(zuids,userDtls){rows+=Users.components.addUser.syncUserRow(userDtls.user,userDtls.emailId,null,mode)});var checkBoxFn=(ele,id)=>{this.handleSyncCheckbox(ele,id)};(rows=$(rows)).find(".zcheckbox").on("click",function(){checkBoxFn($(this),$(this).attr("id"))}),pageContent.find("tbody").append(rows)}async submitForm(){var zohoMailUsersListObj=this.wrapperContainer.find(`#sync${this.config.mode}UserForm tbody`),selectedUsrCount=zohoMailUsersListObj.find("input[type=checkbox]:checked").length,isMicrosoftUsers="Office365"===this.config.mode,isGAppsUsers="GApps"===this.config.mode;if(selectedUsrCount>parseInt(zohoMailUsersListObj.attr("balanceUser")))ZPeople.Message.failure(ZPI18N.getString("zp.paymenterr"));else{var mailIds=this.getMailIds(zohoMailUsersListObj);if(0!==mailIds.length){var url=isMicrosoftUsers?"importOffice365Users.zp":isGAppsUsers?"/users/importGAppsUsers":"/users/importZohoUsers",params=this.getSubmitParams(isMicrosoftUsers,isGAppsUsers);let dataObj;if(params.mailIds=mailIds,isMicrosoftUsers&&(params=this.getMicrosoftParams(),Users.config.isNotificationEnabled))return this.config.setCommonData("Office365",{url:url,params:params}),{success:""};try{await new Promise((resolve,reject)=>{ZPeople.Request.send(url,params,result=>{dataObj=result,resolve()},{},data=>{reject(new Error(data.error))})})}catch(error){return ZPeople.Message.failure(error),null}let response=Users.operations.add.handleNewSyncResponse(dataObj,params);return this.config.setCommonData("syncSummary",response),{success:ZPI18N.getString("zp.usersdaddedsuccessfully")}}}}getMailIds(obj){return obj.find("input:checked").map(function(){return this.value}).get().join(",")}getSubmitParams(isMicrosoftUsers,isGAppsUsers){return isMicrosoftUsers?{mode:"importOfficeUser"}:isGAppsUsers?{method:"getImportGAppsUsersNewUI"}:{method:"importZohoUsers"}}getDispName(obj){return obj.find("input:checked").map(function(){return this.name}).get().join(",")}getMicrosoftParams(){let params=this.getSubmitParams(!0,!1);var zohoMailUsersListObj=this.wrapperContainer.find(`#sync${this.config.mode}UserForm tbody`);let mailIds=this.getMailIds(zohoMailUsersListObj),dispName=this.getDispName(zohoMailUsersListObj),mailArrList=[],nameArrList=[];var mailSplit=mailIds.split(","),dispNameSplit=dispName.split(",");return $.each(mailSplit,function(index,value){mailArrList.push(value)}),$.each(dispNameSplit,function(index,value){nameArrList.push(value)}),params.dispName=JSON.stringify(nameArrList),params.mailIds=JSON.stringify(mailArrList),params.mailToNotifyUsers=Users.config.isNotificationEnabled,params}handleSyncCheckbox(obj,id){var inputObj=$(obj).find("input");id=$(inputObj).attr("id");var zohoMailUserListTableObj,pageId=this.wrapperContainer;if(zohoMailUserListTableObj=pageId.find(`#${this.formId} tbody`),$(inputObj).attr("checked")?$(inputObj).removeAttr("checked"):$(inputObj).attr("checked",""),"massChecked"===id){var checkBox=zohoMailUserListTableObj.find("input[type=checkbox]:visible");$(inputObj).attr("checked")?checkBox.attr("checked",""):checkBox.removeAttr("checked")}else{0===zohoMailUserListTableObj.find("input[type=checkbox]:not(:checked)").length?pageId.find("#massChecked").attr("checked",""):pageId.find("#massChecked").removeAttr("checked")}var selectedItemsCnt=zohoMailUserListTableObj.find("input[type=checkbox]:checked").length;zohoMailUserListTableObj.find("input[type=checkbox]:checked").closest("tr").addClass("active"),zohoMailUserListTableObj.find("input[type=checkbox]:not(:checked)").closest("tr").removeClass("active"),pageId.find("div#selected_userscnt").removeClass("DN").find("span").text(selectedItemsCnt),selectedItemsCnt>0?(pageId.find("div#total_userscnt").addClass("DN"),pageId.find(".zpl_mfoter #syncZohoUsers").removeClass("disabled")):(pageId.find("div#total_userscnt,div#selected_userscnt").toggleClass("DN"),pageId.find(".zpl_mfoter #syncZohoUsers").addClass("disabled"))}removeActive(){if(this.wrapperContainer.removeClass("zpl_act"),"Office365"==this.config.mode){let params=this.getMicrosoftParams();this.config.setCommonData("Office365",{url:"importOffice365Users.zp",params:params})}}setActive(){if(this.wrapperContainer.addClass("zpl_act"),"Office365"==this.config.mode){let cmnData=this.config.getCommonData();cmnData.hasOwnProperty("seqential_Office365")&&cmnData.seqential_Office365.hasOwnProperty("isCompleted")&&cmnData.seqential_Office365.isCompleted&&this.setDisabled()}}setDisabled(){this.isDisabled=!0,this.wrapperContainer.find("#"+this.formId).addClass("disabled")}}class NotificationConfirmaion{constructor(config,wrapperContainer){this.isDisabled=!1,this.config=config,this.wrapperContainer=wrapperContainer,this.constructNotificationConfirmation()}constructNotificationConfirmation(){this.wrapperContainer.append(Users.components.addUser.notificationConfirmation(ele=>{this.toggleRadioBtn(ele)}))}async submitForm(){let commonData=this.config.getCommonData();if(commonData.hasOwnProperty("Office365")){let dataObj,url=commonData.Office365.url,params=commonData.Office365.params;params.mailToNotifyUsers=this.wrapperContainer.find("input[value=yes]").is(":checked");try{await new Promise((resolve,reject)=>{ZPeople.Request.send(url,params,result=>{dataObj=result,resolve()},{},data=>{reject(new Error(data.error))})});let rslt=Users.operations.add.handleNewSyncResponse(dataObj,params);return this.config.setCommonData("seqential_Office365",{isCompleted:!0}),this.config.setCommonData("syncSummary",rslt),{success:ZPI18N.getString("zp.usersdaddedsuccessfully")}}catch(error){return ZPeople.Message.failure(error),null}}}toggleRadioBtn(ele){this.wrapperContainer.find("input").removeAttr("checked"),$(ele).find("input").attr("checked","checked")}removeActive(){this.wrapperContainer.removeClass("zpl_act")}setActive(){this.wrapperContainer.addClass("zpl_act")}setDisabled(){this.isDisabled=!0,this.wrapperContainer.addClass("disabled")}}class SyncSummary{constructor(config,wrapperContainer){this.isDisabled=!1,this.config=config,this.wrapperContainer=wrapperContainer,this.isConstructionCompleted=!1}constructSummary(){this.isConstructionCompleted=!0;let data=this.config.getCommonData()?this.config.getCommonData().syncSummary:void 0;if(!data)return;this.wrapperContainer.append(Users.components.addUser.syncSummary(ele=>{this.toggleSummary(ele)})),0==data.errorMapArr.length?(this.wrapperContainer.find("#errorHeader").addClass("zpl_DNI"),this.toggleSummary(this.wrapperContainer.find("#successHeader"))):0==data.successMailIds.length?(this.wrapperContainer.find("#successHeader").addClass("zpl_DNI"),this.toggleSummary(this.wrapperContainer.find("#errorHeader"))):this.toggleSummary(this.wrapperContainer.find("#successHeader"));let errRow="";data.errorMapArr.forEach(err=>{errRow+=this.summaryRow(err.email,err.msg)}),this.wrapperContainer.find("#errorBody tbody").append(errRow);let successRows="";data.successMailIds.forEach(email=>{successRows+=this.summaryRow(email,ZPI18N.getString("zp.usersdaddedsuccessfully"))}),this.wrapperContainer.find("#successBody tbody").append(successRows)}summaryRow(email,message){return`<tr> <td><span>${email}</span></td> ${null!=message?"<td><span>"+message+"</span></td>":""} </tr>`}toggleSummary(ele){this.wrapperContainer.find("#successHeader , #errorHeader").removeClass("zpl_act"),this.wrapperContainer.find(".summaryBody").addClass("zpl_DNI"),ele.addClass("zpl_act"),("successHeader"==ele.attr("id")?this.wrapperContainer.find("#successBody"):this.wrapperContainer.find("#errorBody")).removeClass("zpl_DNI")}submitForm(){return{success:ZPI18N.getString("zp.usersdaddedsuccessfully")}}removeActive(){this.wrapperContainer.removeClass("zpl_act")}setActive(){this.wrapperContainer.addClass("zpl_act"),!this.isConstructionCompleted&&this.constructSummary()}}Users.operations.add.syncConfig=function(mode,otherData){let params={id:"accountCreation",dispName:ZPI18N.getString("zp.syncfrom")+" "+mode,order:1,containerClass:SyncUserAccCreationHandler,footerSubmitText:Users.config.isNotificationEnabled&&"Office365"==mode?ZPI18N.getString("zp.proceed"):ZPI18N.getString("zp.submit"),url:"Zoho"==mode?"/users/getZohoMailUsers":"GApps"==mode?"/users/getGAppsUsers":"Office365"==mode?"/getOffice365Actions.zp":"",listingParams:"Zoho"==mode?{method:"getZohoUsersNewUI"}:"GApps"==mode?{method:"getGAppsUsersNewUI"}:"Office365"==mode?{mode:"userlisting"}:{},mode:mode,license:Users.operations.add.getUsersLicenseParams()};return"Office365"==mode&&Users.config.isNotificationEnabled&&(params.isSequential=!1),otherData&&(void 0!==otherData.rowsHtml&&(params.rowsHtml=otherData.rowsHtml),void 0!==otherData.balanceUser&&(params.balanceUser=otherData.balanceUser),void 0!==otherData.syncUsersCnt&&(params.syncUsersCnt=otherData.syncUsersCnt),void 0!==otherData.officeNextLink&&(params.officeNextLink=otherData.officeNextLink)),params},Users.operations.add.notificationConfirmationConfig=function(){return{id:"notification_conformation",dispName:ZPI18N.getString("zp.notifyusers"),containerClass:NotificationConfirmaion,footerSubmitText:ZPI18N.getString("zp.submit")}},Users.operations.add.syncSummaryConfig=function(){return{id:"syncSummary",dispName:ZPI18N.getString("zp.summary"),containerClass:SyncSummary,footerSubmitText:ZPI18N.getString("zp.submit"),isSkipRequired:!0}},Users.operations.add.handleNewSyncResponse=function(resultObject,params){var mode="Zoho";params.hasOwnProperty("method")&&params.method.indexOf("GApps")>-1||params.hasOwnProperty("mode")&&params.mode.indexOf("GApps")>-1?mode="GApps":(params.hasOwnProperty("method")&&params.method.indexOf("Office365")>-1||params.hasOwnProperty("mode")&&params.mode.indexOf("importOfficeUser")>-1)&&(mode="Office365");let errorMapArr=[],errorMsg="",isAllError=!1,successMailIds=[];if(resultObject.hasOwnProperty("ERROR")&&!ZPSetupCommon.isEmpty(resultObject.ERROR.userAddError)){var unknownErrorMsgToBeDisplayed="",dcErrorMsgToBeDisplayed="";"UNKNOWN_ERROR"==resultObject.ERROR.userAddError[0].errorMsg?unknownErrorMsgToBeDisplayed=ZPI18N.getString("zp.userAdd.exceptionMsg")+"-":"Z112"==resultObject.ERROR.userAddError[0].errorMsg&&(dcErrorMsgToBeDisplayed=ZPI18N.getString("zp.dcinviteerror")+"-"),$.each(resultObject.ERROR.userAddError,function(index,value){"Z112"==value.errorMsg?(dcErrorMsgToBeDisplayed+=value.errorMailIds+" ",errorMapArr.push({email:value.errorMailIds,msg:ZPI18N.getString("zp.dcinviteerror",[ZPeople.peopleSupportEmail])})):"UNKNOWN_ERROR"==value.errorMsg&&(unknownErrorMsgToBeDisplayed+=value.errorMailIds+" ",errorMapArr.push({email:value.errorMailIds,msg:ZPI18N.getString("zp.userAdd.exceptionMsg",[ZPeople.peopleSupportEmail])}))}),ZPeople.Message.failure(unknownErrorMsgToBeDisplayed+dcErrorMsgToBeDisplayed),successMailIds="Office365"==mode?JSON.parse(params.mailIds):params.mailIds.split(",");const errEmailIds=new Set(errorMapArr.map(obj=>obj.email));successMailIds=successMailIds.filter(elem=>!errEmailIds.has(elem))}else ZPSetupCommon.isEmpty(resultObject.ERROR)?"Office365"==mode||"GApps"==mode?resultObject.hasOwnProperty("paymentErrInit")?(ZPeople.Message.failure(resultObject.paymentErrInit),isAllError=!0,errorMsg=resultObject.paymentErrInit):(successMailIds="Office365"==mode?JSON.parse(params.mailIds):params.mailIds.split(","),resultObject.hasOwnProperty("Errors")&&$.each(resultObject.Errors,function(index,value){var email=value.hasOwnProperty("mailId")?value.mailId:"",message=value.Message;errorMapArr.push({email:email,msg:message}),successMailIds.splice($.inArray(email,successMailIds),1)}),ZPeople.Message.success(ZPI18N.getString("zp.usersdaddedsuccessfully"))):successMailIds=params.mailIds.split(","):(ZPeople.Message.failure(resultObject.ERROR),isAllError=!0,errorMsg=resultObject.ERROR);if(isAllError){let emailIdArr=successMailIds="Office365"==mode||"GApps"==mode?JSON.parse(params.mailIds):params.mailIds.split(",");errorMapArr=emailIdArr.map((val,idx)=>({email:val,msg:errorMsg}))}return{errorMapArr:errorMapArr,successMailIds:successMailIds}},Users.components.getFields=(_this=>{return{pageContent:_this.wrapperContainer,currentForm:_this.config.addParams.formId,EMP_ID:{fieldName:"EMP_ID",getFieldConfig:()=>({id:"input#userId",name:Users.config.empidDispName,isOptional:!1,isNeeded:_this.isSingle()}),validate:field=>{let fieldValue=field.val();if(!_this.config.addParams.isMigrate&&fieldValue===Users.config.lastEmployeeId){let errMsg=ZPI18N.getString("zp.DuplicateMsgInAdduser",[Users.config.empidDispName]);return _this.fields._paintTextFieldError(field,errMsg),!1}return!0}},FIRST_NAME:{fieldName:"FIRST_NAME",getFieldConfig:()=>({id:"input#userFirstname",name:Users.config.fnameDispName,isOptional:!1,isNeeded:_this.isSingle()})},LAST_NAME:{fieldName:"LAST_NAME",getFieldConfig:()=>({id:"input#userLastname",name:Users.config.lnameDispName,isOptional:!Users.config.isLastNameMand,isNeeded:_this.isSingle()})},EMAIL:{fieldName:"EMAIL",getFieldConfig:()=>({id:"input#userEmail",name:Users.config.emailDispName,isOptional:_this.config.addParams.isNonuser,isNeeded:_this.isSingle()&&!_this.config.addParams.isDirect}),validate:(isDirect,isMobile)=>{let emailField=_this.fields.getEmailField(isDirect),emailValue=_this.fields.getEmailValue(isDirect,!1),isValidValue=isMobile?CompanySettings.isValidMobile(emailValue):CompanySettings.isValidEmail(emailValue),errMsg=isMobile?ZPI18N.getString("zp.mobusrvaldn"):ZPI18N.getString("zp.entermailid");return!!isValidValue||(_this.fields._paintTextFieldError(emailField,errMsg),!1)}},DOMAIN:{fieldName:"DOMAIN",getFieldConfig:()=>({id:"#userDomain",name:ZPI18N.getString("zp.domain"),isOptional:!1,isNeeded:_this.isSingle()&&_this.config.addParams.isDirect}),destroy:()=>{if(_this.config.form.userDomains.length>0){let thisField=_this.fields._getField("DOMAIN");ZPeopleComponents.select(thisField)&&ZPeopleComponents.select(thisField).destroy()}}},USER_NAME:{fieldName:"USER_NAME",getFieldConfig:()=>({id:"input#userUsername",name:Users.config.emailDispName,isOptional:!1,isNeeded:_this.isSingle()&&_this.config.addParams.isDirect})},PASSWORD:{fieldName:"PASSWORD",getFieldConfig:()=>({id:"input#userPassword",name:ZPI18N.getString("zp.passwd"),isOptional:!1,isNeeded:_this.isSingle()&&_this.config.addParams.isDirect&&!_this.config.addParams.isAGP}),validate:field=>{let password=field.val(),errMsg="",isValid=!0;return password.length<8?(isValid=!1,errMsg=ZPI18N.getString("zp.passwordlengshort")):Users.operations.add.validatePwdPolicy(password)&&(isValid=!1,errMsg=ZPI18N.getString("zp.passwordpolicy")),!isValid&&_this.fields._paintTextFieldError(field,errMsg),isValid}},AGP:{fieldName:"AGP",getFieldConfig:()=>({id:"#agpPassword",name:"AGP",isOptional:!0,isNeeded:_this.isSingle()&&_this.config.addParams.isDirect})},DIAL_CODE:{fieldName:"DIAL_CODE",getFieldConfig:()=>({id:"#mobDialCode",name:"DIALCODE",isOptional:!1,isNeeded:_this.isSingle()&&_this.config.addParams.isMobile}),destroy:()=>{let thisField=_this.fields._getField("DIAL_CODE");ZPeopleComponents.select(thisField)&&ZPeopleComponents.select(thisField).destroy()}},ONBOARDING:{fieldName:"ONBOARDING",getFieldConfig:()=>({id:"#userOnboardingEnable",name:"ONBOARDING",isOptional:!0,isNeeded:_this.isSingle()&&!_this.config.addParams.isNonuser})},LOCATION:{fieldName:"LOCATION",getFieldConfig:()=>({id:_this.fields.LOCATION.getId(),name:Users.config.locationDispName,isOptional:!1,isNeeded:_this.isSingle()&&void 0!=_this.config.form.locAdminDetails}),destroy:()=>{if(_this.config.form.locAdminDetails){let thisField=_this.fields._getField("LOCATION");ZPeopleComponents.select(thisField)&&ZPeopleComponents.select(thisField).destroy()}},getId:()=>{var addMode=_this.isSingle()?"single":"multiple";return`${_this.fields.currentForm}-${addMode}-userLocation`}},EMAILS__TEXTAREA:{fieldName:"EMAILS__TEXTAREA",getFieldConfig:()=>({id:"textarea#userEmails",name:Users.config.emailDispName,isOptional:!1,isNeeded:_this.isMultiple()}),validate:field=>{var bulkMailIds=field.val(),bulkEmailIdparentElm=field.parent(),mailIdList=bulkMailIds.split(","),errorList=[],validMailIdsList=[];if(0!==mailIdList.length){if($.each(mailIdList,function(index,mailId){mailId=mailId.trim(),ZPSetupCommon.isEmpty(mailId)||(CompanySettings.isValidEmail(mailId)?-1!==validMailIdsList.indexOf(mailId)?(ZPSetupCommon.showErr(mailId+" - "+ZPI18N.getString("zp.duplicatmailid"),bulkEmailIdparentElm,"ztextbox--error__label","bulkInv"+index),field.addClass("ztextbox__error"),errorList.push(mailId)):validMailIdsList.push(mailId):(ZPSetupCommon.showErr(ZSEC.Encoder.encodeForHTML(mailId)+" - "+ZPI18N.getString("zp.invalidemail"),bulkEmailIdparentElm,"ztextbox--error__label","bulkInv"+index),field.addClass("ztextbox__error"),errorList.push(mailId)))}),0===errorList.length)return validMailIdsList}else t_thisaddInputErrorMsg(ZPI18N.getString("zp.validemail"),bulkEmailIdparentElm,bulkEmailIdBoxElm,"ztextbox--error__label","ztextbox__error")}},getAll:()=>{return[_this.fields.EMP_ID,_this.fields.FIRST_NAME,_this.fields.LAST_NAME,_this.fields.EMAIL,_this.fields.DOMAIN,_this.fields.USER_NAME,_this.fields.PASSWORD,_this.fields.AGP,_this.fields.DIAL_CODE,_this.fields.ONBOARDING,_this.fields.LOCATION,_this.fields.EMAILS__TEXTAREA]},_getField:fieldName=>{let id=_this.fields[fieldName].getFieldConfig().id;return _this.fields._getFieldFromId(id)},_getFieldFromId:id=>_this.fields.pageContent.find(_this.fields.currentForm+` ${id}`),_getFieldValue:fieldName=>{let val=_this.fields._getField(fieldName).val();return val=val?val.trim():val},getEmailField:isDirect=>{let f=_this.fields,emailField=f._getField("EMAIL");return _this.isMultiple()?emailField=f._getField("EMAILS__TEXTAREA"):isDirect&&(emailField=f._getField("USER_NAME")),emailField},getEmailValue:(isDirect,isMobile)=>{let f=_this.fields,fieldValue=f.getEmailField(isDirect).val();if(fieldValue=fieldValue?fieldValue.trim():fieldValue,isDirect){fieldValue=fieldValue+"@"+f._getField("DOMAIN").val()}else if(isMobile){let dialCodeField=f._getField("DIAL_CODE"),c_code=dialCodeField.val();fieldValue=ZPeopleComponents.select(dialCodeField).getAttribute("options").filter(e=>e.c_code===c_code)[0].d_code+"-"+fieldValue}return fieldValue.trim()},_paintTextFieldError:(field,errMsg)=>{let parentDiv=field.parent();if("userEmail"===field.attr("id"))for(;!parentDiv.parent().hasClass("zpl_secn");)parentDiv=parentDiv.parent();ZPSetupCommon.showErr(errMsg,parentDiv,"ztextbox--error__label"),field.addClass("ztextbox__error")},_removeErrorPaint:field=>{let parentDiv=field.parent();if("userEmail"===field.attr("id"))for(;!parentDiv.parent().hasClass("zpl_secn");)parentDiv=parentDiv.parent();parentDiv.find("div.ztextbox--error__label").remove(),field.removeClass("ztextbox__error")}}});class UserNonuserAdder{constructor(config,wrapperContainer){this.isDisabled=!1,this.config=config,this.wrapperContainer=wrapperContainer,this.fields=Users.components.getFields(this),this.construct()}async submitForm(){return this.isMultiple()?await this.submitMultiple():await this.submitSingle()}setActive(){this.wrapperContainer.addClass("zpl_act")}removeActive(){this.wrapperContainer.removeClass("zpl_act")}setDisabled(){this.isDisabled=!0,this.wrapperContainer.find(this.config.addParams.formId).addClass("disabled")}destructor(){this.config.addParams.isDirect?this.destructDirectForm():this.config.addParams.isMigrate?this.destructConvertForm():this.config.addParams.isNonuser?this.destructNonUserForm():this.destructInviteForm()}destructConvertForm(){this.config.form.userDomains.length>0&&ZPeopleComponents.select(this.wrapperContainer.find("#singleConvert #userConvertDomain"))&&ZPeopleComponents.select(this.wrapperContainer.find("#singleConvert #userConvertDomain")).destroy(),this.config.form.locAdminDetails&&ZPeopleComponents.select(this.wrapperContainer.find("#convertNonuserForm-single-userLocation"))&&ZPeopleComponents.select(this.wrapperContainer.find("#convertNonuserForm-single-userLocation")).destroy()}destructDirectForm(){if(this.config.form.userDomains.length>0&&ZPeopleComponents.select(this.wrapperContainer.find("#singleDirect #userDomain"))&&ZPeopleComponents.select(this.wrapperContainer.find("#singleDirect #userDomain")).destroy(),this.config.form.directRows>0)for(let i=0;i<=this.config.form.directRows;i++)ZPeopleComponents.select(this.wrapperContainer.find("#userDomain-"+i))&&ZPeopleComponents.select(this.wrapperContainer.find("#userDomain-"+i)).destroy(),ZPeopleComponents.select(this.wrapperContainer.find("#userLocation-"+i))&&ZPeopleComponents.select(this.wrapperContainer.find("#userLocation-"+i)).destroy();else ZPeopleComponents.select(this.wrapperContainer.find("#userDomain-0"))&&ZPeopleComponents.select(this.wrapperContainer.find("#userDomain-0")).destroy();this.config.form.locAdminDetails&&ZPeopleComponents.select(this.wrapperContainer.find("#directUserForm-single-userLocation"))&&ZPeopleComponents.select(this.wrapperContainer.find("#directUserForm-single-userLocation")).destroy()}destructInviteForm(){ZPeopleComponents.select(this.wrapperContainer.find("#mobDialCode"))&&ZPeopleComponents.select(this.wrapperContainer.find("#mobDialCode")).destroy(),this.config.form.locAdminDetails&&(ZPeopleComponents.select(this.wrapperContainer.find("#inviteUserForm-single-userLocation"))&&ZPeopleComponents.select(this.wrapperContainer.find("#inviteUserForm-single-userLocation")).destroy(),ZPeopleComponents.select(this.wrapperContainer.find("#multipleInvite-userLocation"))&&ZPeopleComponents.select(this.wrapperContainer.find("#multipleInvite-userLocation")).destroy())}destructNonUserForm(){this.config.form.locAdminDetails&&ZPeopleComponents.select(this.wrapperContainer.find("#addNonuserForm-single-userLocation"))&&ZPeopleComponents.select(this.wrapperContainer.find("#addNonuserForm-single-userLocation")).destroy()}construct(){this.config.addParams.isNonuser?this.constructAddNonuserForm():this.config.addParams.isMigrate?this.constructConvertForm():this.config.addParams.isDirect?this.constructDirectUserForm():this.constructInviteUserForm()}constructAddNonuserForm(){this.wrapperContainer.append(Users.components.addUser.userLicenseRow(this.config.license));var html=Users.components.addNonuserForm();this.wrapperContainer.append(html),Layout.PageUtil.loadFiles(["framework.settings.organization.min.js"],()=>{ZPeople.EmployeeIDGenEnabled?this.wrapperContainer.find("[elem=empIdGenButton]").off("click").on("click",null,{mode:"userAdd",refClassObj:this},EmpIDGenerationSlider.init):this.wrapperContainer.find("[elem=empIdGenButton]").attr("title",ZPI18N.getString("zp.employeeidfeatureneedstobeenabled"))}),Users.common.initTooltip()}constructConvertForm(){this.wrapperContainer.append(Users.components.addUser.userLicenseRow(this.config.license));var html=Users.components.convertNonuserForm();html=$(html);var recordData=this.config.addParams.recordData;html.find("input#userEmail").val(recordData.empMailAlias),recordData.zuid&&-1!=recordData.zuid&&""!=recordData.zuid&&(html.find("input#userEmail").addClass("disabled"),html.find("#userEmailSectionLabel").append("<i class='PI_info' title='"+ZPI18N.getString("zp.canteditusercovertedempemailid")+"'></i>")),html.find("input#userId").val(recordData.employeeId),html.find("input#userFirstname").val(recordData.empFname),html.find("input#userLastname").val(recordData.empLname),this.wrapperContainer.append(html[0]),Users.common.initTooltip()}constructDirectUserForm(){this.wrapperContainer.append(Users.components.addUser.userLicenseRow(this.config.license));var html=Users.components.addUser.directAddForm(this.config.form,this);this.constructDirectRow($(html).find("#multipleDirect tbody")),this.wrapperContainer.append(html),Layout.PageUtil.loadFiles(["framework.settings.organization.min.js"],()=>{ZPeople.EmployeeIDGenEnabled?this.wrapperContainer.find("[elem=empIdGenButton]").off("click").on("click",null,{mode:"userAdd",refClassObj:this},EmpIDGenerationSlider.init):this.wrapperContainer.find("[elem=empIdGenButton]").attr("title",ZPI18N.getString("zp.employeeidfeatureneedstobeenabled"))}),Users.common.initTooltip()}constructInviteUserForm(){this.wrapperContainer.append(Users.components.addUser.userLicenseRow(this.config.license));var html=Users.components.inviteForm(this.config.form);if(html=$(html),this.config.isAddUserDirectlyAllowed&&this.config.ALLOW_MOBILEUSER_ADDITION){if(html.find("#userEmailSection").find("label").text(ZPI18N.getString("zp.emailormob")),0==html.find("#mobDialCode").length){ZPI18N.getString("zp.emailormob"),Users.common.getDialCodes();var mobHtml=ZPComponents.v2.dialCode();html.find("#mobMail").prepend(mobHtml),html.find("#mobMail #userEmail").on("keyup",()=>{this.toggleMobile()})}html.find("#mobMail > select").addClass("DN"),html.find("#mobMail > div").addClass("DN")}this.wrapperContainer.append(html[0]),Layout.PageUtil.loadFiles(["framework.settings.organization.min.js"],()=>{ZPeople.EmployeeIDGenEnabled?this.wrapperContainer.find("[elem=empIdGenButton]").off("click").on("click",null,{mode:"userAdd",refClassObj:this},EmpIDGenerationSlider.init):this.wrapperContainer.find("[elem=empIdGenButton]").attr("title",ZPI18N.getString("zp.employeeidfeatureneedstobeenabled"))}),Users.common.initTooltip()}setParam(params,key,value){ZPSetupCommon.isEmpty(value)||(params[key]=value)}setPassword(params,isDirect){if(isDirect){let agpField=this.fields._getField("AGP"),isAGP=ZPeopleComponents.toggleswitch(agpField).getState();this.setParam(params,"autoGenPwd",isAGP),isAGP||this.setParam(params,"password",this.fields._getFieldValue("PASSWORD"))}}setType(params,isNonuser,isMigrate,isDirect,isMobile){params.type=isMigrate?"0":isNonuser?"-2":isDirect?"1":isMobile?"8":"2"}setConvertType(params,isNonuser,isMigrate,isDirect){isMigrate&&(params.convertType=isDirect?"4":"2")}isValid(){let neededFields=this.fields.getAll().filter(field=>field.getFieldConfig().isNeeded),isValid=!0;for(var i=0;i<neededFields.length;i++){let currentFieldObj=neededFields[i],currentFieldConfig=currentFieldObj.getFieldConfig(),id=currentFieldConfig.id,isOptional=currentFieldConfig.isOptional,currentField=this.fields._getFieldFromId(id),currentFieldValue=currentField.val();this.fields._removeErrorPaint(currentField);let isFieldEmpty=ZPSetupCommon.isEmpty(currentFieldValue);id==this.fields.EMP_ID.getFieldConfig().id&&"true"==currentField.attr("isGenFromRule")&&(isOptional=!0);let isFieldValid=isOptional||!isFieldEmpty;if(isFieldEmpty){if(!isFieldValid){let errMsg=ZPI18N.getString("zp.entervalforfield",[currentFieldConfig.name]);this.fields._paintTextFieldError(currentField,errMsg)}isValid=isValid&&isFieldValid}else{if(id===this.fields.USER_NAME.getFieldConfig().id||id===this.fields.EMAIL.getFieldConfig().id)isFieldValid=this.fields.EMAIL.validate(this.config.addParams.isDirect,this.config.addParams.isMobile);else if(id===this.fields.EMAILS__TEXTAREA.getFieldConfig().id){let validEmails=currentFieldObj.validate(currentField);validEmails?(this.config.addParams.validEmails=validEmails,isFieldValid=!0):isFieldValid=!1}else currentFieldObj.validate&&(isFieldValid=currentFieldObj.validate(currentField));isValid=isValid&&isFieldValid}}return isValid}async submitSingle(){if(this.isValid()){let dataObj,params={method:"addUser"},f=this.fields,isDirect=this.config.addParams.isDirect,isMobile=this.config.addParams.isMobile,isNonuser=this.config.addParams.isNonuser,isMigrate=this.config.addParams.isMigrate,erecno=this.config.addParams.recordData?this.config.addParams.recordData.erecno:void 0,empId=f._getFieldValue("EMP_ID");return this.setParam(params,"empId",empId),"true"==this.fields.pageContent.find("#userId").attr("isGenFromRule")&&EmpIDGenerationSlider.empIdDtls&&(this.setParam(params,"empIdFields",EmpIDGenerationSlider.empIdDtls.empIdFields),this.setParam(params,"empGenRuleId",EmpIDGenerationSlider.empIdDtls.empGenRuleId),this.setParam(params,"isFromRule","true")),this.setParam(params,"empFname",f._getFieldValue("FIRST_NAME")),this.setParam(params,"empLname",f._getFieldValue("LAST_NAME")),this.setParam(params,"empMail",f.getEmailValue(isDirect,isMobile)),this.setParam(params,"locid",f._getFieldValue("LOCATION")),isMobile&&this.setParam(params,"dialCode",f._getFieldValue("DIAL_CODE")),erecno&&this.setParam(params,"erecno",erecno),this.setPassword(params,isDirect),this.setType(params,isNonuser,isMigrate,isDirect,isMobile),!isNonuser&&!isMigrate&&this.setParam(params,"triggerWorkFlow",!1),this.setConvertType(params,isNonuser,isMigrate,isDirect),await new Promise((resolve,reject)=>{ZPeople.Request.send("/users/addUsers",params,data=>{(dataObj=data).success&&dataObj.ruleId&&(EmpIDGenerationSlider.handle.setLastGeneratedId(dataObj.ruleId,dataObj.lastEmployeeId),delete EmpIDGenerationSlider.empIdDtls),resolve()})}),this.handleSingleResponse(dataObj,params)}}async submitMultiple(){return this.config.addParams.isDirect?this.submitMultipleDirect():this.submitMultipleInvite()}async submitMultipleInvite(){if(this.isValid()){let validEmails=this.config.addParams.validEmails,params={};var data;return params.method="bulkInviteUser",this.setParam(params,"multiEmailIds",JSON.stringify(validEmails)),this.setParam(params,"locid",this.fields._getFieldValue("LOCATION")),await new Promise((resolve,reject)=>{ZPeople.Request.send("/users/bulkInviteUsers",params,result=>{data=result,resolve()})}),this.handleMultipleInviteResponse(data,params)}}handleSingleResponse(dataObj,params){let pageId=this.wrapperContainer,currentForm=this.config.addParams.formId;var errorMessage="",type=params.type;if(dataObj.success){if(null!=dataObj.usersDtls&&void 0!=dataObj.usersDtls)return ZPeople.ISUNCONFIRMEDACC?ZPeople.Message.warning(ZPI18N.getString("zp.inviteuncnfrmd")):ZPSetupCommon.isEmpty(dataObj.success)||ZPeople.Message.success(dataObj.success),this.config.setCommonData("addUser",{result:dataObj,param:params}),{success:dataObj.success}}else dataObj.exception?errorMessage=dataObj.exception:dataObj.paymentErr?errorMessage=dataObj.paymentErr:dataObj.noOrgAdmin?errorMessage=dataObj.noOrgAdmin:dataObj.error?Object.keys(dataObj.error).map(key=>{let errMsg=dataObj.error[key];if("emailIdParentElm"===key){let isDirect="1"===type,emailField=this.fields.getEmailField(isDirect);this.fields._paintTextFieldError(emailField,errMsg)}else if("empIdErr"===key){let empIdField=this.fields._getField("EMP_ID");this.fields._paintTextFieldError(empIdField,errMsg)}else errorMessage=dataObj.error[key]}):Object.keys(dataObj).map(emailId=>{dataObj.error[emailId];if("isErrorFound"!==emailId){var getErrorObj=dataObj[emailId],parentObj=pageId.find(currentForm+" input[emailId='"+emailId+"']").parent();parentObj.addClass("ztextbox__error"),ZPSetupCommon.showErr(getErrorObj.emailIdParentElm,parentObj,"ztextbox--error__label"),pageId.find(currentForm+" input[emailId='"+emailId+"']").attr("emailErr","true")}}),ZPSetupCommon.isEmpty(errorMessage)||ZPeople.Message.failure(errorMessage)}handleMultipleInviteResponse(data,params){var bulkEmailIdBoxElm=this.wrapperContainer.find("#inviteUserForm textarea#userEmails"),bulkEmailIdparentElm=bulkEmailIdBoxElm.parent(),idCount=0;if(data.noOrgAdmin)ZPeople.Message.failure(data.noOrgAdmin);else if(data.error){if(data.error.userAddError){var allValues=data.error.userAddError;$.each(allValues,function(index,errObj){idCount++,"Z112"==errObj.errorMsg?ZPSetupCommon.showErr(errObj.errorMailIds+" - "+ZPI18N.getString("zp.dcinviteerror")+"<br>",bulkEmailIdparentElm,"ztextbox--error__label","duplicate"+idCount):ZPSetupCommon.showErr(errObj.errorMailIds+" - "+ZPI18N.getString("zp.userAdd.exceptionMsg")+"<br>",bulkEmailIdparentElm,"ztextbox--error__label","duplicate"+idCount)})}else data.error.hasOwnProperty("paymentError")?(idCount++,ZPSetupCommon.showErr(data.error.paymentError+"<br>",bulkEmailIdparentElm,"ztextbox--error__label","duplicate"+idCount)):$.each(data.error,function(mailId,error){idCount++,ZPSetupCommon.showErr(mailId+" - "+error+"<br>",bulkEmailIdparentElm,"ztextbox--error__label","duplicate"+idCount)});bulkEmailIdBoxElm.addClass("ztextbox__error")}else if(!ZPSetupCommon.isEmpty(data.result))return ZPeople.ISUNCONFIRMEDACC?ZPeople.Message.warning(ZPI18N.getString("zp.inviteuncnfrmd")):ZPeople.Message.success(data.result),this.config.setCommonData("addUser",{result:data,param:params}),{success:data.result}}constructDirectRow(element){element||(element=this.wrapperContainer.find("#directUserForm #multipleDirect tbody"));var html=Users.components.addUser.directAddRow(this.config.form.directRows,this.config.form);0==element.find("tr").length?$(html).find(".PI_delete").parent().remove():element.find(".manualPasswordTd").is(":visible")&&$(html).find(".manualPasswordTd").removeClass("DN"),this.config.form.locAdminDetails&&(Users.components.initLocation(html,"#"+$(html).find("td.locationTd select").attr("id")),$(html).find(".locationTd").removeClass("DN")),element.append(html),this.config.form.directRows++}toggleSinglePassword(event){event.target.closest("form").attr("id");this.wrapperContainer.find("#manualPassword").toggleClass("DN"),this.wrapperContainer.find(".manualPasswordTd").toggleClass("DN"),this.config.addParams.isAGP=!this.config.addParams.isAGP}toggleMobile(){if(this.config.ALLOW_MOBILEUSER_ADDITION){var pageContent=this.wrapperContainer.find("#inviteUserForm"),emailtxt=pageContent.find("#userEmailSection #userEmail").val().trim();Users.common.validation("number",emailtxt)&&emailtxt.length>2?(pageContent.find("#mobMail > select").removeClass("DN"),pageContent.find("#mobMail > div").removeClass("DN"),this.config.addParams.isMobile=!0):(pageContent.find("#mobMail > select").addClass("DN"),pageContent.find("#mobMail > div").addClass("DN"),this.config.addParams.isMobile=!1)}}toggleSingleMultipleInterface(type){var pageContent=this.wrapperContainer,formId="#"+type+"UserForm",singleEleId="#single"+(type=type[0].toUpperCase()+type.slice(1).toLowerCase()),multpleEleId="#multiple"+type;pageContent.find(formId).find(singleEleId).toggleClass("DN"),pageContent.find(formId).find(singleEleId+"Tab").toggleClass("zpl_act"),pageContent.find(formId).find(multpleEleId).toggleClass("DN"),pageContent.find(formId).find(multpleEleId+"Tab").toggleClass("zpl_act"),pageContent.find(formId).find(multpleEleId+"Info").toggleClass("DN"),pageContent.find(formId).find(singleEleId+"Info").toggleClass("DN"),pageContent.find(formId).find(singleEleId).hasClass("DN")?pageContent.find(formId).attr("mode","multiple"):pageContent.find(formId).attr("mode","single")}isSingle(){return!this.isMultiple()}isMultiple(){return"multiple"===this.wrapperContainer.find(this.config.addParams.formId).attr("mode")}async submitMultipleDirect(){let validRslt=this.validateMultipleDirect();if(validRslt){if(validRslt.mailIdsLength<=1e3){var data,params={multiEmailIds:JSON.stringify(validRslt.emailIdsPasswd),method:"addMultiUsers",autoGenPwdMulti:validRslt.isAGP};return this.config.form.locAdminDetails&&!$.isEmptyObject(validRslt.emailIdsLoc)&&(params.locids=JSON.stringify(validRslt.emailIdsLoc)),await new Promise((resolve,reject)=>{ZPeople.Request.send("/users/addMultiUser",params,result=>{data=result,resolve()})}),this.handleResponseMultipleDirect(data,params)}ZPeople.Message.failure(ZPI18N.getString("zp.maildidlengthexceeded"))}}validateMultipleDirect(){var emailIdsPasswd={},emailIdsLoc={},error=!1,emailIdList=[],mailIdsLength=0,rows=this.wrapperContainer.find("#directUserForm #multipleDirect tbody tr"),isAGP=ZPeopleComponents.toggleswitch(this.wrapperContainer.find("#directUserForm #agpPassword")).getState();return this.wrapperContainer.find("#directUserForm").find("#directUsers").removeClass("disabled"),$.each(rows,function(index,ele){var usernameEle=$(ele).find("input[id*=userUsername]"),username=usernameEle.val(),emailId=username+"@"+$(ele).find("select[id*=userDomain]").val(),location=$(ele).find("select[id*=userLocation]").val();if(mailIdsLength+=emailId.length,usernameEle.attr("emailId",emailId),ZPSetupCommon.isEmpty(username)||!CompanySettings.isValidEmail(emailId)?(usernameEle.addClass("ztextbox__error"),error=!0,ZPSetupCommon.showErr(ZPI18N.getString("zp.entervalforfield",[ZPI18N.getString("zp.emailid")]),usernameEle.parent(),"ztextbox--error__label")):!ZPSetupCommon.isEmpty(username)&&CompanySettings.isValidEmail(emailId)&&(-1!==emailIdList.indexOf(emailId)?(error=!0,ZPSetupCommon.showErr(ZPI18N.getString("zp.duplicatmailid"),usernameEle.parent(),"ztextbox--error__label")):(error=!1,usernameEle.parent().find(".ztextbox--error__label").remove(),usernameEle.removeClass("ztextbox__error"),emailId=encodeURI(emailId),emailIdList.push(emailId))),!isAGP){var passEle=$(ele).find("input[id*=userPassword]"),pass=passEle.val();passEle.parent().find(".ztextbox--error__label").remove(),ZPSetupCommon.isEmpty(pass)?(error=!0,passEle.addClass("ztextbox__error"),ZPSetupCommon.showErr(ZPI18N.getString("zp.entervalforfield",[ZPI18N.getString("zp.passwd")]),passEle.parent(),"ztextbox--error__label")):ZPSetupCommon.isEmpty(pass)||(pass.length<8?(error=!0,passEle.addClass("ztextbox__error"),ZPSetupCommon.showErr(ZPI18N.getString("zp.passwordlengshort"),passEle.parent(),"ztextbox--error__label")):Users.operations.add.validatePwdPolicy(pass)?(error=!0,passEle.addClass("ztextbox__error"),ZPSetupCommon.showErr(ZPI18N.getString("zp.passwordpolicy"),passEle.parent(),"ztextbox--error__label"),$("#multiUPwd").mouseover(),setTimeout(function(){$("#multiUPwd").popover("hide")},3e3)):(passEle.find(".ztextbox--error__label").parent().remove(),passEle.removeClass("ztextbox__error")))}error||(emailIdsPasswd[emailId]=isAGP?null:pass,null!=location&&(emailIdsLoc[emailId]=location))}),error?void 0:{emailIdsLoc:emailIdsLoc,emailIdList:emailIdList,isAGP:isAGP,emailIdsPasswd:emailIdsPasswd,mailIdsLength:mailIdsLength}}handleResponseMultipleDirect(data,params){var pageId=this.wrapperContainer;pageId.find("#directUserForm").find("#directUsers").removeClass("disabled");data.isZohoUserMsg;if("success"===data.result)return ZPeople.Message.success(ZPI18N.getString("zp.usersdaddedsuccessfully")),this.config.setCommonData("addUser",{result:dataObj,param:params}),{success:dataObj.success};if("duplicate"===data.result)$.each(data,function(mailId,errObj){var errkeptElm=pageId.find("#directUserForm #multipleDirect").find("input[emailId='"+mailId+"']"),errorValue=null;errObj&&(errObj.emailIdParentElm&&(errorValue=errObj.emailIdParentElm),errObj.empLocAuthErr&&(errorValue=null!=errorValue?errorValue+","+errObj.empLocAuthErr:errObj.empLocAuthErr)),ZPSetupCommon.showErr(errorValue,errkeptElm.parent(),"ztextbox--error__label")});else if(ZPSetupCommon.isEmpty(data.userAddError))ZPeople.Message.failure(data.error);else{var allValues=data.userAddError;$.each(allValues,function(index,errObj){var errkeptElm=pageId.find("#directUserForm #multipleDirect").find("input[emailId='"+errObj.errorMailIds+"']");"Z112"==errObj.errorMsg?ZPSetupCommon.showErr(ZPI18N.getString("zp.dcinviteerror"),errkeptElm.parent(),"ztextbox--error__label"):ZPSetupCommon.showErr(ZPI18N.getString("zp.userAdd.exceptionMsg"),errkeptElm.parent(),"ztextbox--error__label")})}}}