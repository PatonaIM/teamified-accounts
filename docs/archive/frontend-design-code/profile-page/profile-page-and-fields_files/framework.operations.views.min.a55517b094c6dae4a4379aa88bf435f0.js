var ZP5Views={formsCommonUrl:"/zpformscommon",url:"/viewAction.zp",viewPageurl:"/newViewPage.zp",ALL_OPTIONS:[],FILTER_OPTIONS:[],CURR_VIEWPARAMS:{},isTabChanged:!1,HTML:void 0,IMPORT_HTML:void 0,currViewObj:void 0,currViewModuleHandler:void 0,currViewRecObj:void 0,viewFormClassObj:{},zp5formgetFormsOp:void 0,filterObject:{},entity:void 0,unit:void 0,division:void 0,department:void 0,locid:void 0,orgTag:void 0,URL_FILTER_OPTIONS:{},currViewFilterModuleHandler:void 0,transferV2SingleRecordCallBack:e=>{TransferListView.singleRecordCallBack(e,!0)},removeStaticHeaderClasses:e=>{$(e).removeClass("lft1"),$(e).removeClass("lft2"),$(e).removeClass("lft3"),$(e).removeClass("lft5"),$(e).removeClass("lft2_chkbx"),$(e).removeClass("lft5_chkbx"),$(e).removeClass("zpl_tbllftfxd")},closeCurrentViewFilter:()=>{ZP5Views.currViewObj&&(ZP5Views.closeViewFilter(ZP5Views.currViewObj.viewId),ZP5Views.currViewObj.isFilterResultsAvailable()&&(ZP5Views.currViewObj.container.find("#filterResultsHeader").addClass("DN"),ZP5Views.currViewObj.container.removeClass("zpl_fltrvwfxd")))},closeViewFilter:e=>{if(null!=e){let t=ZP5Views.checkfilterKey(e);null!=ZP5Views.filterObject[t]&&ZP5Views.filterObject[t].getFilterOpenStatus()&&ZP5Views.filterObject[t].handleFilterOperation()}},mouseEnterFunction:e=>{let t=event.target;e&&(t=$(t).find("span")),event.target.offsetWidth<event.target.scrollWidth&&!$(t).attr("title")&&($(t).addClass("tooltip-js"),$(t).attr("title",$(event.target).text()),$(t).attr("data-title-position","auto"),$(t).attr("data-title-display-type","box")),t.removeAttribute("onmouseover")},mouseOver:()=>{let e=$(event.target);e.attr("title",e.attr("class").includes("zpl_act")?ZPI18N.getString("zp.exitfullscreen",["View"]):ZPI18N.getString("zp.fullscreen",["View"]))},getCurrViewObj:()=>ZP5Views.currViewObj,getAllSelectedRecIds:()=>ZP5Views.currViewObj.SELECT_RECIDS};ZP5Views.getInfoToolTipObj=()=>(null==this.infoToolTipObj&&(this.infoToolTipObj=new InfoToolTip),this.infoToolTipObj),ZP5Views.getSelectedRecIds=()=>{let e=new Array;return e=e.concat(ZP5Views.currViewObj.DELETE_RECIDS),e},ZP5Views.setSortAndGroupByToContainer=(e,t,i)=>{let r=$(e).data();r||(r={}),r[t]=i,$(e).data=r},ZP5Views.setViewObjToContainer=(e,t)=>{let i=$(e).data();i||(i={}),i[t.viewId]=t,$(e).data=i},ZP5Views.setModuleFilterValuesTOcontainer=(e,t,i)=>{null==i||0==Object.keys(i).length?delete e.data()[t]:ZP5Views.setSortAndGroupByToContainer(e,t,i)},ZP5Views.setModuleFilterStateTOcontainer=(e,t,i)=>{i?ZP5Views.setSortAndGroupByToContainer(e,t,i):delete e.data()[t]},ZP5Views.getViewObjFromContainer=(e,t)=>$(e).data()[t],ZP5Views.getCurrViewParams=e=>ZP5Views.CURR_VIEWPARAMS?ZP5Views.CURR_VIEWPARAMS[e]:void 0,ZP5Views.setCurrViewParams=e=>{(e={...ZP5Views.CURR_VIEWPARAMS,...e}).isrelatedform||(ZP5Views.CURR_VIEWPARAMS=e)},ZP5Views.isPageDataChanged=(e,t,i,r)=>{let s=e.split("/"),a=s[s.length-2],n=s[0],o=s[1],l=t.split("/"),d=l[l.length-2],p=l[0],m=l[1];a==d&&n==p&&o==m||(ZP5Views.restSystemFilterZC(),ZP5Views.resetRecordPerPage(),ZP5Views.restViewPage(),ZP5Views.getInfoToolTipObj().destroyTooltips(),r&&r(i))},ZP5Views.restSystemFilterZC=()=>{ZP5Views.lastContainer.removeClass("zpl_fltr_flt");let e=ZP5Views.lastContainer.find("#systemFilterContainer"),t=e.find("#employeeSearchList");ZPeopleComponents.isComponent(t)&&ZPeopleComponents.tokenfield(t).destroy(),$.each([e.find("#employeeStatusList"),e.find("#approvalList"),e.find("#approverList"),e.find("#entityList"),e.find("#unitList"),e.find("#divisionList"),e.find("#departmentList"),e.find("#locationList"),e.find("#employeeorgTagList")],((e,t)=>{ZPeopleComponents.isComponent(t)&&t.zselect("destroy")}))},ZP5Views.resetRecordPerPage=()=>{let e=ZP5Views.lastContainer.find("#viewFooter #recordsPerPage");ZPeopleComponents.isComponent(e)&&e.zselect("destroy")},ZP5Views.restViewPage=()=>{ZP5Views.lastContainer&&ZP5Views.lastContainer.html(""),ZP5Views.isTabChanged=!0,ZP5Views.currViewModuleHandler=void 0},ZP5Views.callback=()=>{ZP5Views.HTML?ZP5Views.constructView():ZP5Views.initialCallback()},ZP5Views.importInitialCallback=e=>{ZP5Views.IMPORT_HTML?ZP5Views.constructView(e):ZPeople.Request.send(ZP5Views.formsCommonUrl+ZP5Views.viewPageurl,{isImportSummary:!0},(t=>{ZP5Views.IMPORT_HTML=t,ZP5Views.importInitialCallback(e)}))},ZP5Views.setCurrentViewModuleHandler=e=>{ZP5Views.currViewModuleHandler=ZP5ViewsCommon.getViewsModuleHandler(e)},ZP5Views.setCurrentFilterModuleHandler=e=>{ZP5Views.currViewFilterModuleHandler=e},ZP5Views.getCurrentViewModuleHandler=()=>ZP5Views.currViewModuleHandler,ZP5Views.initialCallback=()=>{null==ZP5Views.HTML?(common._load(0,settingsPage.container),ZPeople.Request.send(ZP5Views.formsCommonUrl+ZP5Views.viewPageurl,{},(e=>{ZP5Views.HTML=e,ZP5Views.initialCallback()}))):(common._load(0,settingsPage.container),ZP5Views.callback())},ZP5Views.getModuleData=()=>ZPeople.Module.getData(),ZP5Views.isSystemView=e=>{if(void 0===e&&(e=void 0!==settingsUrlProps.urlParamsArr&&void 0!==settingsUrlProps.urlParamsArr.viewId?settingsUrlProps.urlParamsArr.viewId:e),void 0===e)return!0;let t=ZP5Views.getSelectedView(e);return null!=t&&(null!=t.isCustomView&&!t.isCustomView)},ZP5Views.isApproverView=e=>{if(void 0===e&&(e=void 0!==settingsUrlProps.urlParamsArr&&void 0!==settingsUrlProps.urlParamsArr.viewId?settingsUrlProps.urlParamsArr.viewId:e),void 0===e)return!1;let t=ZP5Views.getSelectedView(e);return null!=t&&2==t.viewType},ZP5Views.getSelectedView=e=>{let t=ZPeople.Module.getData().viewDetails.message;for(let i=0;i<t.length;i++)if(t[i].viewId==e)return t[i];if("systemView"==e){let t={};return t.viewId=e,t.isCustomView=!1,t.isDefaultView=!0,t}},ZP5Views.viewSelectOnChange=(e,t)=>{let i=$(e.target),r=$(i).attr("formid"),s=$(i).zselect("getValue");ZP5Views.removeStaticHeaderClasses(t),ZP5Views.closeCurrentViewFilter();let a=ZP5Views.getSelectedView(s);window.location.href="#"+ZP5Views.getViewModifiedUrl(r,a,t,!0)},ZP5Views.loadLatestView=e=>{window.location.href="#"+ZP5Views.getLatestFormViewUrl(e)},ZP5Views.getLatestFormViewUrl=(e,t)=>{let i="";for(let e=0;e<settingsUrlProps.niceUrlArr.length-1;e++)0!=e&&(i+="/"),i+=settingsUrlProps.niceUrlArr[e];if(t||(i+="/listview"),ZP5Views.currViewObj){let t=ZP5Views.getSelectedView(ZP5Views.currViewObj.getViewId());null==t&&e!=ZP5Views.currViewObj.formId&&ZP5Views.currViewObj.isrelatedform&&(t=ZP5Views.getSelectedView(ZP5Views.currViewObj.parentCurrentViewId));let r=ZP5Views.getViewFilterParams(t);""!=r.trim()&&(i=i+"-"+r)}return i},ZP5Views.getLoadedKeyBasedOnUrl=()=>{let e="loaded";return ZPUtil.isV5SettingsUrl()?e="newloaded":Layout.Page.hashDtl.homeEmpKey&&(e=Layout.Page.hashDtl.homeEmpKey),e},ZP5Views.mapconstruction=e=>{new Promise((t=>{ZPMaps.loadStatic(),t(e)})).then((e=>{let t=e.currentTarget;var i=$(t).attr("lat"),r=$(t).attr("lon");ZPeople.stopEvents(e),$("[id=viewMap]").remove(),$("[role=tooltip]").remove();var s="<div class='showMap open' id='viewMap' onclick=ZPeople.stopEvents(event)>";s+="<div style='overflow:hidden;width:280px;height:280px;resize:none;max-width:100%;'>",s+="<div id='display-google-map' style='height:100%; width:100%;max-width:100%;'>",s+="<div id='"+Layout.Page.pageId+"_map' style='height:450px;width:100%;border:0;'></div></div>",s+="</div></div>",$("body").append(s),ZPMaps.loadMap(i,r,!1,Layout.Page.pageId+"_map",null,null,!0),ZPeopleComponents.popover($("[id=viewMap]"),{forElement:e.currentTarget,position:"bottom-center",displayType:"box"}),ZPeopleComponents.popover($("[id=viewMap]")).open()}))},ZP5Views.redirectToOperations=()=>{if(ZP5Views.currViewModuleHandler.getOperationsHash){let e=ZP5Views.currViewModuleHandler.getOperationsHash();if(ZP5Views.currViewObj){let t=ZP5Views.getSelectedView(ZP5Views.currViewObj.getViewId()),i=ZP5Views.getViewFilterParams(t);""!=i.trim()&&(e=e+"-"+i)}window.location.href="#"+e}},ZP5Views.constructViews=e=>{let t=isWebForm?void 0:ZPeople.Module.getData().viewDetails,i=!1,r=!1;if(t&&7e3===t.code&&!t[ZP5Views.getLoadedKeyBasedOnUrl()]||ZP5Views.isTabChanged||e.isrelatedform||e.isImportSummary||(t&&7e3===t.code&&!t[ZP5Views.getLoadedKeyBasedOnUrl()]||(i=!0),r=!0),r)return e.isImportSummary||e.isrelatedform||(ZP5ViewActions.viewSelect.initActions(e.container,e.viewId),e.container.addClass("zpl_colmaxwd")),i;if(e.isImportSummary||e.isrelatedform)e.container.html(ZP5Views.IMPORT_HTML);else{e.container.html(ZP5Views.HTML),e.container.addClass("zpl_tblfxd"),e.container.addClass("zpl_colmaxwd"),e.container.siblings().length>0&&e.container.siblings().removeClass("zpl_fltr_flt"),"systemView"==e.viewId&&(isModuleSystemView=!0);let t=e.container.find("#viewType").parent();if(isadmin&&"main"==Layout.Page.currentpagemode){let e='<a id="gotooperations" onclick="ZP5Views.redirectToOperations()">'+ZPI18N.getString("zp.viewAllData")+"</a>";t.prepend(e)}ZP5ViewActions.viewSelect.init(e.container.find("#viewActionsContainer").find("#viewList"),e.formId,e.viewId,e.container),ZP5ViewActions.viewSelect.initActions(e.container,e.viewId)}return t&&(t[ZP5Views.getLoadedKeyBasedOnUrl()]=!(e.isrelatedform||e.isImportSummary)),ZP5Views.currViewObj=void 0,!1},ZP5Views.constructView=e=>{let t={container:settingsPage.container,isImportSummary:!1,isrelatedform:!1};null!=e&&((e.hasOwnProperty("importId")||e.hasOwnProperty("importUniqueId"))&&(t.isImportSummary=!0,t.viewActionsNotRequired=!0,t.formId=e.formId,t.viewId=e.hasOwnProperty("viewId")?e.viewId:e.summaryViewId,t.container=e.container,e.hasOwnProperty("importId")?t.importId=e.importId:t.importUniqueId=e.importUniqueId,t.impSummaryType=e.impSummaryType,t.paginationContainer=e.paginationContainer,t.showHidePagination=e.showHidePagination),e.isrelatedform&&(t.container=e.container,t.formId=e.formId,t.viewId=e.viewId,t.linkedFcid=e.linkedFcid,t.isOnload=!0,t.startInd=1,t.employeeStatus="all",t.isrelatedform=!0,t.relfcid=e.relfcid,t.relformconfigformid=e.relformconfigformid,t.relformrecid=e.relformrecid,t.viewActionsNotRequired=!0,t.isfromreltabs=e.isfromreltabs,ZP5Views.currViewObj&&(t.parentCurrentViewId=ZP5Views.currViewObj.isrelatedform?ZP5Views.currViewObj.parentCurrentViewId:ZP5Views.currViewObj.getViewId(),ZP5Views.currViewObj.formId!=e.formId&&(ZP5Views.currViewObj=void 0))),e.formId&&(t.formId=e.formId),e.tableName&&(t.mode=e.tableName)),ZP5Views.setCurrViewParams(t),t.isImportSummary?ZP5Views.setCurrentViewModuleHandler():t.isrelatedform?ZP5Views.setCurrentViewModuleHandler(e.tableName):(t.mode?ZP5Views.setCurrentViewModuleHandler(t.mode):ZP5Views.setCurrentViewModuleHandler(),ZP5Views.getCurrentViewModuleHandler().setModuleProps(t,e),ZP5Views.setFormIdViewId(t),ZP5Views.setCurrViewParams(t)),ZP5Views.setCurrentFilterModuleHandler(ZP5Views.currViewModuleHandler.getViewFilterModuleHandler());let i=ZP5Views.getCurrentViewModuleHandler().constructModuleViewAction?ZP5Views.getCurrentViewModuleHandler().constructModuleViewAction(t):ZP5Views.constructViews(t);ZP5Views.isTabChanged&&(ZP5Views.isTabChanged=!1);let r=!1;if("systemView"==t.viewId&&(r=!0),ZP5Views.getCurrentViewModuleHandler().onchangeCallback&&ZP5Views.getCurrentViewModuleHandler().onchangeCallback(r),ZP5Views.lastContainer=t.container,ZP5Views.getCurrentViewModuleHandler().getIsModuleForm()&&r)ZPUtil.Validation.isFunction(ZP5Views.getCurrentViewModuleHandler().dataCallback)&&ZP5Views.getCurrentViewModuleHandler().dataCallback();else{let e=!0;ZP5Views.currViewObj?ZP5Views.currViewObj.urlParamsArr={...ZP5Views.currViewObj.urlParamsArr,...t.urlParamsArr}:(e=!1,ZP5Views.updateNonUrlProps(t),ZP5Views.currViewObj=new views(t)),void 0!==ZP5Views.viewFormClassObj[t.formId]&&(ZP5Views.zp5formgetFormsOp=ZP5Views.viewFormClassObj[t.formId]),ZP5Views.currViewObj.constructView(e,i)}},ZP5Views.updateNonUrlProps=e=>{let t=ZP5Views.getViewObjFromContainer(e.container,e.viewId);t&&(e.sortGroupDetails=t)},ZP5Views.setFilterObject=e=>{if(!e.isImportSummary&&!e.isrelatedform&&!ZP5Views.serverErrorCheck(ZP5Views.currViewRecObj)){let t={viewObj:ZP5Views.getCurrViewObj(),container:e.container,filterButtonId:"filterButton",className:"zpl_fltr_flt",filterCloseButtonId:"filterCloseButton",isSystemFilter:!0,applyButtonId:"applyButton",resetButtonId:"resetButton"},i=ZP5Views.checkfilterKey(e.viewId);ZP5Views.filterObject[i]=new viewFilter(t),ZP5Views.filterObject[i].initializeViewPage()}},ZP5Views.checkfilterKey=e=>-1!=e?e.concat(ZPUtil.isV5SettingsUrl()?"_settings":Layout.Page.hashDtl.homeEmpKey?"_"+Layout.Page.hashDtl.homeEmpKey:"_other"):void 0,ZP5Views.getkey=(e,t)=>e+"_"+t,ZP5Views.setFormIdViewId=e=>{let t=e.hasOwnProperty("formId")?e.formId:-1,i=e.hasOwnProperty("viewId")?e.viewId:-1;if(null==settingsUrlProps.urlParamsArr||jQuery.isEmptyObject(settingsUrlProps.urlParamsArr)||(e.urlParamsArr=settingsUrlProps.urlParamsArr,e.urlParamsArr.hasOwnProperty("searchBy")&&(e.urlParamsArr.searchBy=decodeURIComponent(e.urlParamsArr.searchBy)),e.urlParamsArr.hasOwnProperty("orgStructureFilter")&&(e.urlParamsArr.orgStructureFilter=decodeURIComponent(e.urlParamsArr.orgStructureFilter)),e.urlParamsArr.hasOwnProperty("empstatus")&&(e.urlParamsArr.empstatus=decodeURIComponent(e.urlParamsArr.empstatus)),e.urlParamsArr.hasOwnProperty("searchUserId")&&(e.urlParamsArr.searchUserId=decodeURIComponent(e.urlParamsArr.searchUserId)),null!=settingsUrlProps.urlParamsArr.formId&&(t=settingsUrlProps.urlParamsArr.formId),null!=settingsUrlProps.urlParamsArr.viewId&&(i=settingsUrlProps.urlParamsArr.viewId)),-1==t&&"healthstatus"==settingsUrlProps.serviceName){let e=urlFormConf.formLabelMap.hasOwnProperty(ZP5Views.formLabelName)?urlFormConf.formLabelMap[ZP5Views.formLabelName]:ZP5Views.formLabelName;t=ZP5ServicesCommon.getDefaultFormAndViewId("organization",e).formId}if(-1==t&&"performance"==settingsUrlProps.serviceName){let e=urlFormConf.formLabelMap.hasOwnProperty(ZP5Views.formLabelName)?urlFormConf.formLabelMap[ZP5Views.formLabelName]:ZP5Views.formLabelName;t=ZP5ServicesCommon.getDefaultFormAndViewId("performance",e).formId}if(-1==i){let e=ZPeople.Module.getData();$.each(e.viewDetails.message,(function(e,t){if(t.isDefaultView)return i=t.viewId,!1}))}-1!=t&&-1!=i||(-1==t&&(t=ZP5Views.currViewModuleHandler.getFormId()),-1==i&&(i="systemView")),e.formId=t,e.viewId=i},ZP5Views.getViewFilterParams=e=>{let t="",i=-1;e&&(i=e.viewId,"systemView"==i||e.isDefaultView||(t=t+"viewId:"+i));let r=ZP5Views.filterObject[ZP5Views.checkfilterKey(i)],s=null!=r?r.viewObject:void 0;if(s&&null!=s.urlParamsArr){let e=Object.keys(s.urlParamsArr);for(let i=0;i<e.length;i++)"formId"!=e[i]&&"viewId"!=e[i]&&"id"!=e[i]&&(""!=t.trim()&&(t+="/"),t=t+e[i]+":"+encodeURIComponent(s.urlParamsArr[e[i]]))}if(ZP5ViewsCommon.ApproverView.isApproverView(e)){let e=s?s.urlParamsArr:void 0,i=ZP5ViewsCommon.ApproverView.appendDefaultFilter(e);i&&(t=t+"/"+i)}return t},ZP5Views.getViewModifiedUrl=(e,t,i,r)=>{let s=settingsUrlProps.niceUrl;if(null==e){e=ZPeople.Module.getData().formDetailsMap.formId}let a=ZP5Views.getViewFilterParams(t),n=ZP5Views.currViewModuleHandler.getViewModuleAdditionalParam();return a+=""!=a.trim()?""!=n.trim()?"/"+n:"":n,""!=a.trim()&&(s=s+"-"+a),r&&(ZP5Views.currViewObj=void 0),s},ZP5Views.setUpOptionsForMenu=(e,t)=>{e.type||(e.type="list"),e.displayType||(e.displayType="callout");let i='<div id="'+e.id+'" data-type="'+e.type+'" data-display-type="'+e.displayType+'" data-content-type="'+e.contentType+'" '+(null!=e.fcid?'fcid="'+e.fcid+'"':"")+"><ul>";for(let e=0;e<t.length;e++){let r=t[e];i=i+'<li id="'+r.id+'" ',null!=r.type&&(i=i+'data-item-type="'+r.type+'"'),null!=r.iconClass&&(i+=' data-icon-class="'+r.iconClass+'" '),null!=r.groupname&&(i=i+'name="'+r.groupname+'"'),null!=r.checked&&r.checked&&(i+="checked"),i=i+">"+r.text+"</li>"}i+="</ul>",$("body").append(i)},ZP5Views.getMenuObject=(e,t)=>{switch(e){case"importExport":return{id:"formViewMenuListMenu",type:"list",displayType:"callout",contentType:"icon-text"};case"orderByGroupBy":return{id:"viewSortingMenu",type:"list",displayType:"callout",contentType:"icon-text"};case"viewApproval":return{id:"viewApproval"+t,type:"list",displayType:"callout",contentType:"icon-text"};case"recordSpecificAction":return{id:"recordSpecificActionMenu",type:"list",displayType:"callout",contentType:"text"}}},ZP5Views.getFieldDetails=(e,t,i,r)=>{for(let s=0;s<e.length;s++){let a=e[s];if("id"==t&&null==a.parentField&&a.formComponentId==i)return a;if("labelName"==t&&a.labelName==i)return a;if("parentfield"==t&&a.parentField==i&&a.formComponentId==r)return a}},ZP5Views.refreshAllViews=(e,t,i)=>{if(null==e||e!=ZPeople.v2TransferFormId){if(null!=ZP5Views.viewFormClassObj[e]&&delete ZP5Views.viewFormClassObj[e],t){let e=ZP5Views.currViewObj.viewId;delete ZP5Views.filterObject[e.concat("_settings")],delete ZP5Views.filterObject[e.concat("_other")],delete ZP5Views.filterObject[e.concat("_homeOrgEmp")],ZP5Views.currViewObj.sortGroupDetails={},delete ZP5Views.currViewObj.container.data()[e]}i&&(ZP5Views.currViewObj=void 0)}else ZPViewsHolder.refreshAllViews()},ZP5Views.refreshview=e=>{ZP5Views.currViewObj.reloadView(!0,e)},ZP5Views.getOptionsForFilterCriteria=e=>{let t=[];if(e==FormConstants.Criteria.OPERATORS.ONLY_PARTICULAR_MONTH)for(let e=0;e<FormConstants.MONTH.FULL.length;e++)t.push({id:e,value:FormConstants.MONTH.FULL[e]});return t},ZP5Views.relatedFieldDisplayname=(e,t)=>{if(-1!=t.indexOf(".")){return e+"("+t.split(".")[0]+")"}return e},ZP5Views.serverErrorCheck=e=>7e3!=e.code&&7024!=e.code,ZP5Views.noDataCheck=e=>7024==e.code,ZP5Views.getRecordDetails=e=>{if(ZP5Views.serverErrorCheck(ZP5Views.currViewRecObj))return;if(ZP5Views.noDataCheck(ZP5Views.currViewRecObj))return;let t=ZP5Views.currViewRecObj.message;if(null==t.groupedHeaderList)return t=t.recordDetails,ZP5Views.getSingleRecordDetails(t,e);{let i=t.groupedHeaderList.length;if(void 0!==i&&i>0)for(let r=0;r<i;r++){let i=t.recordDetails[r],s=ZP5Views.getSingleRecordDetails(i,e);if(null!=s)return s}}},ZP5Views.getSingleRecordDetails=(e,t)=>{for(let i=0;i<e.length;i++){let r=e[i];if(r.recordId==t)return r}},ZP5Views.getViewParams=e=>ZP5Views.getCurrViewObj().getAllParams(e),ZP5Views.getOrgStructureFieldDisplayName=(e,t)=>{let i=ZPI18N.getString("zp.addlegalentity");return ZPeople.orgStructureDispNameMap.hasOwnProperty("entity")&&(i=ZPeople.orgStructureDispNameMap.entity),t||(i=ZPI18N.getString("zp.AllOrgStructureElements",[i])),"unit"==e?(i=ZPI18N.getString("zp.addbusinessunit"),ZPeople.orgStructureDispNameMap.hasOwnProperty("unit")&&(i=ZPeople.orgStructureDispNameMap.unit),t||(i=ZPI18N.getString("zp.AllOrgStructureElements",[i]))):"division"==e?(i=ZPI18N.getString("zp.adddivision"),ZPeople.orgStructureDispNameMap.hasOwnProperty("division")&&(i=ZPeople.orgStructureDispNameMap.division),t||(i=ZPI18N.getString("zp.AllOrgStructureElements",[i]))):"department"==e?(i=ZPI18N.getString("zp.employeedepartment"),ZPeople.orgStructureDispNameMap.hasOwnProperty("department")&&(i=ZPeople.orgStructureDispNameMap.department),t||(i=ZPI18N.getString("zp.AllOrgStructureElements",[i]))):"locid"==e?(i=ZPI18N.getString("zp.location"),t||(i=ZPI18N.getString("zp.alllocaction"))):"orgTag"==e&&(i=""!==ZPeople.orgTagDisplayName?ZPeople.orgTagDisplayName:ZPI18N.getString("zp.orgTag"),t||(i=ZPI18N.getString("zp.AllOrgStructureElements",[i]))),i=ZPeople.decodeTxt(i),i},ZP5Views.multilineMouseEnterFunction=()=>{let e=event.currentTarget,t=$(e),i=t.attr("id");if(t.removeAttr("onmouseenter"),!this.infoToolTipObj._popoverIds.includes(i)&&e.offsetWidth<e.scrollWidth&&!t.attr("title")){let e=ZSEC.Encoder.encodeForHTML(t.text().trim());this.infoToolTipObj.addPopoverId(i),this.infoToolTipObj.getContainer().append(`<div id="${i}_content"><div class="zpl_w300 zpl_maxhgt300 zpl_oya "><p>${e.replaceAll("\n","<br>")}</p></div></div>`),ComponentsCommon.popover.init($("#"+i+"_content"),{forElement:t,position:"bottom",animation:{open:{name:"fadeIn"},close:{name:"fadeOut"}},displayType:"box"},"mouseenter","mouseleave"),t.trigger("mouseenter")}};class views{constructor(e){this.formId=e.formId,this.viewId=e.viewId,this.isImportSummary=!1,e.isImportSummary&&(this.isImportSummary=!0,e.hasOwnProperty("importId")?this.importId=e.importId:this.importUniqueId=e.importUniqueId,this.impSummaryType=e.impSummaryType,this.paginationContainer=e.paginationContainer,this.showHidePagination=e.showHidePagination),this.viewActionsNotRequired=e.viewActionsNotRequired,this.container=e.container,this.isFilterOpen=!1,this.urlParamsArr=null!=e.urlParamsArr?e.urlParamsArr:{},this.refresh=!1,this.sortGroupDetails=null!=e.sortGroupDetails?e.sortGroupDetails:{},this.totalRecordCount=-1,this.updateCount=-1,this.startIndex=1,this.typeOfView=null!=e.typeOfView?e.typeOfView:-1,this.viewHeaders={},this.isSystemView=null!=e.isSystemView&&e.isSystemView,this.hideMoreAction=!1,this.mask=!0,this.maskAllowed=void 0,e.isrelatedform&&(this.isrelatedform=e.isrelatedform,this.linkedFcid=e.linkedFcid,this.relformfcid=e.relfcid,this.relformconfigformid=e.relformconfigformid,this.relformrecid=e.relformrecid,this.refresh=!0,this.isfromreltabs=e.isfromreltabs,this.parentCurrentViewId=e.parentCurrentViewId),this.isNonModuleForm="forms"==ZP5Views.getCurrentViewModuleHandler().getModuleName(),this.DELETE_RECIDS=new Array,this.SELECT_RECIDS=[]}getFormId(){return this.formId}getViewId(){return this.viewId}getViewDetailsObj(){return 7e3==ZP5Views.currViewRecObj.code?ZP5Views.currViewRecObj.message:ZP5Views.currViewRecObj}getViewKey(){let e="";return this.isImportSummary&&(e+="imp_"+(null!=this.importId?this.importId:this.importUniqueId)+"_"+this.impSummaryType+"_"),e+=this.getViewId(),e}getRecordLimit(){return this.getViewDetailsObj().recordsLimit}getRecordCount(){return this.getViewDetailsObj().recordCount}hasNext(){return!this.getViewDetailsObj().isLastPage}getTypeOfView(){return this.getViewDetailsObj().typeOfView}getViewType(){return ZP5Views.currViewRecObj.viewType}isAdmin(){return"dataadmin"==this.getTypeOfView()&&ZP5Views.zp5formgetFormsOp.isOperationalRoleAdmin()||!ZP5Views.zp5formgetFormsOp.isOperationalRoleAdmin()&&ZP5Views.zp5formgetFormsOp.isAdmin()}isApproverViewType(){return 2==this.getViewType()}getFormProperty(e){return ZP5Views.zp5formgetFormsOp.getFormsDetailsMap()[e]}getViewSearchAllowedFields(){return null==this.searchAllowedFields&&(this.searchAllowedFields=this.getSearchAllowedFields()),this.searchAllowedFields}updateCurrViewObjAndRefresh(){let e=ZP5Views.getSelectedView(this.getViewId());window.location.href="#"+ZP5Views.getViewModifiedUrl(this.getFormId(),e,this.container,!0)}getSpecificActionRequired(e){let t=!this.viewActionsNotRequired;return t||null==e||(t=this.specificActionOnlyRequired[e]),t}getSearchAllowedFields(){let e=[],t=[];for(let i=0;i<this.getViewDetailsObj().fieldHeaders.length;i++){let r=this.getViewDetailsObj().fieldHeaders[i];t.push(r.formComponentId),e.push(r)}for(let i=0;i<this.getViewDetailsObj().searchEnabledFields.length;i++){let r=this.getViewDetailsObj().searchEnabledFields[i];-1==$.inArray(r.formComponentId,t)&&e.push(r)}return e}getRecordDetails(e){let t=this.getViewDetailsObj();if(null==t.groupedHeaderList)return t=t.recordDetails,this.getSingleRecordDetails(t,e);{let i=t.groupedHeaderList.length;if(void 0!==i&&i>0)for(let r=0;r<i;r++){let i=t.recordDetails[r],s=this.getSingleRecordDetails(i,e);if(null!=s)return s}}}getSingleRecordDetails(e,t){for(let i=0;i<e.length;i++){let r=e[i];if(r.recordId==t)return r}}getViewProperty(e){return this.getViewDetailsObj()[e]}getSortGroupDetails(){return jQuery.isEmptyObject(this.sortGroupDetails)&&(null!=this.getViewProperty("sortBy")&&(this.sortGroupDetails.sortBy=this.getViewProperty("sortBy")),null!=this.getViewProperty("groupBy")&&(this.sortGroupDetails.groupBy=this.getViewProperty("groupBy"))),this.sortGroupDetails}getAllParams(e){let t,i={formId:this.formId,viewId:this.viewId,isOnload:!1,startInd:1};if(e&&(this.getDynamicParams(i),this.getModuleFilterpsrams(i)),-1!=this.getTypeOfView()==!0)t=this.getTypeOfView();else t=null!=this.urlParamsArr?this.urlParamsArr.typeOfView:void 0,!t&&ZP5Views.currViewModuleHandler.getViewTypeBasedOnPage&&(t=ZP5Views.currViewModuleHandler.getViewTypeBasedOnPage());return t&&(i.typeOfView=t),i=this.getModuleExtraPrams(i),i}isMaskAllowed(){if(void 0===this.maskAllowed){this.maskAllowed=!1;let e=this.getViewDetailsObj().fieldHeaders.length;for(let t=0;t<e;t++){this.maskAllowed=this.getViewDetailsObj().fieldHeaders[t].isMask;break}}return this.maskAllowed}isHRMSAdmin(){return ZP5Views.zp5formgetFormsOp.isAdmin()&&!ZP5Views.zp5formgetFormsOp.isOperationalRoleAdmin()}isBulkTransferAllowed(){return ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().isTransferAllowed&&(this.isHRMSAdmin()||"team"==ZP5Views.getCurrentViewModuleHandler().getPageType())}constructViewOnload(){this.constructView()}constructView(e,t){this.getData(e,t)}constructViewNew(e,t){e||(this.container.find("#viewsContainer").find("#fieldHeader").html(""),this.userFormCompList=void 0,this.constructHeaders(),this.viewActionsNotRequired?this.isImportSummary||(this.container.find("#viewActionsContainer").html(""),this.container.find("#viewFooter").remove(),this.container.find("#filterContainer").remove()):this.initializeViewActions()),this.container.find("#viewsContainer").find("tbody").remove(),this.container.find("#viewsContainer").find("thead[id=ghead]").remove(),this.getViewProperty("isCustomActionEnable")&&(ZPA_CusActOper[this.getViewId()]=ZP5Views.currViewRecObj.message.customActions),ZP5Views.getInfoToolTipObj().destroyTooltips(),this.constructRecord(),this.viewActionsNotRequired||(this.footerHandling(),this.initializeRecordActions(),this.showSearchParams()),this.isImportSummary&&this.paginationHandling(),this.refresh=!1,this.updateCount=-1,this.container.find("#viewsContainer").find("[id=viewsMap]").on("click",(e=>{ZP5Views.mapconstruction(e)}))}checkAndShowRecordCountOnLoad(){if(null==ZP5Views.currViewRecObj||ZP5Views.serverErrorCheck(ZP5Views.currViewRecObj)||ZP5Views.noDataCheck(ZP5Views.currViewRecObj)||1!=this.startIndex)this.totalRecordCount=-1;else{let e=ZP5Views.currViewRecObj.message,t=e.recordCount,i=e.recordsLimit;this.totalRecordCount=t<i?t:-1}}footerHandling(){let e=this.container.find("#viewFooter").find("#view_recordcount");e.off(),this.checkAndShowRecordCountOnLoad(),-1==this.totalRecordCount?(e.html("#"),e.removeClass("CPD"),e.parent().removeAttr("aria-label"),e.parent().removeAttr("tabindex"),e.attr("aria-label",ZPI18N.getString("zp.totalrecordcountloader")),e.attr("tabindex","0"),e.on("click",(t=>{e.off(),$(t.target).html('<div class="loader-inner line-scale FR ML5"><div></div><div></div><div></div></div>'),this.handleTotalRecordCount()}))):(e.addClass("CPD"),e.html(this.totalRecordCount),e.removeAttr("tabindex","0"),e.removeAttr("aria-label"),e.parent().attr("tabindex","0"),e.parent().attr("aria-label",ZPI18N.getString("zp.totalrecordcountforfooter",[this.totalRecordCount]))),ZP5Views.getCurrentViewModuleHandler().modulePerPageHandling?ZP5Views.getCurrentViewModuleHandler().modulePerPageHandling(this.container.find("#viewFooter").find("#recordsPerPage")):(ZPeopleComponents.select(this.container.find("#viewFooter").find("#recordsPerPage")).destroy(),ZPeopleComponents.select(this.container.find("#viewFooter").find("#recordsPerPage"),{selectedValue:this.getRecordLimit(),dropdownListLazyLoading:!0,change:e=>{let t=$(e.target),i=$(t).zselect("getValue");this.updateCount=i,this.refresh=!0,this.startIndex=1,this.constructView(!0)}})),this.paginationHandling()}paginationHandling(){let e=this.getRecordLimit();this.getRecordCount()<e&&(e=this.getRecordCount());let t=this.container.find("#viewFooter").find("#viewPagination"),i=t.find("#nextPage"),r=t.find("#previousPage"),s=t.find("#viewPageCount");this.isImportSummary&&(t=this.paginationContainer,i=t.find('[elem="'+this.impSummaryType+'_nextPaginationButton"]'),r=t.find('[elem="'+this.impSummaryType+'_prevPaginationButton"]'),s=t.find('[elem="'+this.impSummaryType+'_paginationCount"]')),s.html("<b>"+this.startIndex+"&nbsp;-&nbsp;"+(e+this.startIndex-1)+"</b>"),s.attr("aria-label",ZPI18N.getString("zp.recountforpage",[this.startIndex,e+this.startIndex-1])),i.off(),this.hasNext()?(i.on("click",(()=>{this.startIndex=this.startIndex+this.getRecordLimit(),this.refresh=!0,i.off(),this.constructView(!0)})),i.removeClass("gry").addClass("blu CP"),i.attr("tabindex","0")):(i.removeClass("blu CP").addClass("gry"),i.removeAttr("tabindex")),r.off(),this.startIndex>1?(r.removeClass("gry").addClass("blu CP"),r.attr("tabindex","0"),r.on("click",(()=>{this.startIndex=this.startIndex-this.getRecordLimit(),this.refresh=!0,r.off(),this.constructView(!0)}))):(r.removeClass("blu CP").addClass("gry"),r.removeAttr("tabindex"))}initializeRecordActions(){this.container.find("#viewsContainer").find("[id=recordActions] input").off(),null==this.getViewDetailsObj().message&&this.container.find("#viewsContainer").find("[id=recordActions] input").on("change",(e=>{this.isFilterOpen&&this.container.find("#viewActionsContainer").find("#filterButton").trigger("click"),this.recordSelectActions(e),this.container.find("#recActDiv").focus()})),this.container.find("#viewActionsContainer").find("#recordActionsContainer").removeClass("opn"),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordActionClose").off(),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordActionClose").on("click",(e=>{this.showRecordActions(!1),this.container.find("#recordActions").focus()})),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordDelete").off(),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordDelete").on("click",(e=>{this.deleteRecordsConfirmation()})),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordMassUpdate").off("click"),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordMassUpdate").on("click",(e=>{zp5MassUpdate.massUpdateFields(this.getFormId(),ZP5Views.zp5formgetFormsOp.getTableName())})),this.container.find("[id=showProfilePic]").off("click").on("click",(e=>{e.stopPropagation(),ZP5ProfilePicture.init(this.container,$(e.target).attr("empid"),"empview")})),this.container.find("[id=recordSpecificAction]").off(),this.container.find("[id=recordSpecificAction]").on("click",(e=>{0==$("body").find("#recordSpecificActionMenu").length&&ZP5Views.setUpOptionsForMenu(ZP5Views.getMenuObject("recordSpecificAction"),this.getViewActionsList("recordSpecificAction"));let t=e.target,i=$(t).parent().parent().parent().attr("id"),r=this.getRecordDetails(i),s=this.getPermissionOfRecord(r),a=[];ZP5Views.getCurrentViewModuleHandler().hideItemForRecordSAction?a=ZP5Views.getCurrentViewModuleHandler().hideItemForRecordSAction(["#editrecord","#deleterecord","#addTask","#restoreRecord"]):(s.editPerm&&"P_EmployeeHealthData"!=ZP5Views.zp5formgetFormsOp.getTableName()&&"P_VaccinationStatus"!=ZP5Views.zp5formgetFormsOp.getTableName()&&!ZP5Views.currViewModuleHandler.isEditRestricted()||a.push("#editrecord"),s.deletePerm&&"P_EmployeeHealthData"!=ZP5Views.zp5formgetFormsOp.getTableName()||a.push("#deleterecord"),ZP5ViewsCommon.RelatedTask.isTaskAvailable()&&!ZP5Views.currViewModuleHandler.isAddTaskRestricted()||a.push("#addTask"),a.push("#restoreRecord")),ZPeopleComponents.menu("#recordSpecificActionMenu").destroy(),ZPeopleComponents.menu("#recordSpecificActionMenu",{forElement:t,className:"zpl_drpdwn zh-radiustopright",itemclick:e=>{this.handleRecordSpecificAction(e,i)},beforehide:e=>{this.container.find("[id=recordSpecificAction]").parent().removeClass("zpl_hvrsw")}}).hideMenuItems(a),$(t).parent().addClass("zpl_hvrsw"),ZPeopleComponents.menu("#recordSpecificActionMenu").show()}))}getTypeOfViewHtml(){let e="",t=ZP5Views.zp5formgetFormsOp.isAdmin()&&!ZP5Views.zp5formgetFormsOp.isOperationalRoleAdmin(),i=ZP5Views.zp5formgetFormsOp.getViewPerm(),r='<optgroup label="Other Data">',s=ZP5Views.currViewModuleHandler.getIsOnlyReportees(),a=Layout.Page.hashDtl.homeEmpKey;return!s&&ZP5Views.zp5formgetFormsOp.isAdditonalPermView()&&(r+='<option value="other_data">'+ZPI18N.getString("zp.oprroledata")+"</option>"),s&&!ZP5Views.currViewModuleHandler.showAllData()||i!==FormConstants.Permission.VAL.ALL_DATA&&!t||!ZPUtil.isV5SettingsUrl()&&!a&&isadmin||(e='<option value="all">'+ZPI18N.getString("zp.alldata")+"</option>"),s&&!ZP5Views.currViewModuleHandler.showMyTeamData()||a||i!==FormConstants.Permission.VAL.ALL_DATA&&i!==FormConstants.Permission.VAL.TEAM_DATA&&!t||(e+='<option value="mydep">'+ZPI18N.getString("zp.teamdata")+"</option>"),a||i!==FormConstants.Permission.VAL.ALL_DATA&&i!==FormConstants.Permission.VAL.TEAM_DATA&&i!==FormConstants.Permission.VAL.SUB_DATA&&!t||(e+='<option value="sub">'+ZPI18N.getString("zp.subdata")+"</option>",e+='<option value="dirsub">'+ZPI18N.getString("zp.dirsubdata")+"</option>"),s||a||i!==FormConstants.Permission.VAL.ALL_DATA&&i!==FormConstants.Permission.VAL.TEAM_DATA&&i!==FormConstants.Permission.VAL.MY_DATA&&!t||(e+='<option value="self">'+ZPI18N.getString("zp.mydata")+"</option>"),s||a||!ZP5Views.zp5formgetFormsOp.isOperationalRoleAdmin()||(r+='<option value="dataadmin">'+ZPI18N.getString("zp.orgStructuredata")+"</option>"),!s&&"P_EmployeeLeave"==ZP5Views.zp5formgetFormsOp.getTableName()&&ZP5Views.getCurrentViewModuleHandler().isLeaveAdmin()&&(r+='<option value="leaveadmin">'+ZPI18N.getString("zp.leaveadmindata")+"</option>"),!s&&"P_Resignation"==ZP5Views.zp5formgetFormsOp.getTableName()&&ZP5Views.getCurrentViewModuleHandler().isHRPartner()?r+='<option value="offb_hrpartner">'+ZPI18N.getString("zp.hrpartnerview")+"</option>":!s&&ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().isClearanceForm&&ZP5Views.getCurrentViewModuleHandler().isHRPartner()&&(r+='<option value="offb_hrpartner">'+ZPI18N.getString("zp.clearancehrpartnerview")+"</option>"),r+="</optgroup>",$(r).find("option").length>0&&(e+=r),e}checkviewTypeNeedForHomeOrg(e){return!Layout.Page.hashDtl.homeEmpKey||!!ZP5Views.zp5formgetFormsOp.isAdditonalPermView()}initializeViewActions(){if(!this.isImportSummary){if(ZP5Views.currViewModuleHandler.getIsViewTypeNeeded()&&!this.isApproverViewType()){let e=this.getTypeOfViewHtml();this.checkviewTypeNeedForHomeOrg(e)?(this.container.find("#viewActionsContainer").find("#viewType").removeClass("DN"),this.container.find("#viewActionsContainer").find("#viewType").html(e),this.container.find("#viewActionsContainer").find("#viewType").off(),ZPeopleComponents.select(this.container.find("#viewActionsContainer").find("#viewType")).destroy(),ZPeopleComponents.select(this.container.find("#viewActionsContainer").find("#viewType"),{selectedValue:this.getTypeOfView(),dropdownListLazyLoading:!0,randomDropdownListId:!0,change:e=>{let t=$(e.target),i=$(t).zselect("getValue");this.typeOfView=i;let r=null!=this.urlParamsArr?this.urlParamsArr:{};r.typeOfView=this.typeOfView,this.urlParamsArr=r,this.refresh=!0,this.updateCurrViewObjAndRefresh()}})):(this.container.find("#viewActionsContainer").find("#viewType").addClass("DN"),ZPeopleComponents.select(this.container.find("#viewActionsContainer").find("#viewType")).destroy())}else this.container.find("#viewActionsContainer").find("#viewType").addClass("DN"),ZPeopleComponents.select(this.container.find("#viewActionsContainer").find("#viewType")).destroy();(ZP5Views.zp5formgetFormsOp.isExportAllowed()||ZP5Views.zp5formgetFormsOp.isImportAllowed()||ZP5Views.zp5formgetFormsOp.isBulkImportAllowed()||ZP5Views.zp5formgetFormsOp.isPhotoUploadAllowed()||ZP5Views.zp5formgetFormsOp.isOperationalRoleAdmin()||this.isMaskAllowed())&&ZP5Views.getCurrentViewModuleHandler().isExportNeeded()?ZPUtil.Validation.isFunction(ZP5Views.getCurrentViewModuleHandler().importExportConstructionCallback)?ZP5Views.getCurrentViewModuleHandler().importExportConstructionCallback("formViewMenuList"+this.formId,"formsviewmenuicontxt"):(this.container.find("#viewActionsContainer").find("#formsviewmenuicontxt").off(),this.container.find("#viewActionsContainer").find("#formsviewmenuicontxt").on("click",(()=>{0==$("body").find("#formViewMenuListMenu").length&&ZP5Views.setUpOptionsForMenu(ZP5Views.getMenuObject("importExport"),this.getViewActionsList("importExport")),ZPeopleComponents.menu("#formViewMenuListMenu").destroy();let e=this;ZPeopleComponents.menu("#formViewMenuListMenu",{forElement:this.container.find("#viewActionsContainer").find("#formsviewmenuicontxt"),className:"zpl_drpdwn zh-radiustopright",itemclick:e=>{this.handleViewImpExp(e)},beforeshow:()=>{let t=ZPeopleComponents.menu("#formViewMenuListMenu"),i=0!=e.container.find("#viewsContainer").find("[mask^=star]").length;t.setMenuItemsAttribute(["#zp_views_mask"],"hidden",!i),i&&(t.setMenuItemsAttribute(["#zp_views_mask"],"label",e.mask?ZPI18N.getString("zp.dataunmask"):ZPI18N.getString("zp.datamask")),t.setMenuItemsAttribute(["#zp_views_mask"],"iconClassName",e.mask?"PI_eye":"PI_eyecls"))}});let t=[];"P_MultiRater"!==ZP5Views.zp5formgetFormsOp.getTableName()&&"P_MultiRater_Approval"!==ZP5Views.zp5formgetFormsOp.getTableName()&&"P_EmployeeHealthData"!==ZP5Views.zp5formgetFormsOp.getTableName()&&"P_VaccinationStatus"!=ZP5Views.zp5formgetFormsOp.getTableName()&&(ZP5Views.zp5formgetFormsOp.isImportAllowed()||ZP5Views.zp5formgetFormsOp.isOperationalRoleAdmin())||t.push("#zp_views_imp"),"P_Employee"===ZP5Views.zp5formgetFormsOp.getTableName()&&ZP5Views.zp5formgetFormsOp.isPhotoUploadAllowed()||t.push("#zp_views_impphoto"),(!ZP5Views.zp5formgetFormsOp.isExportAllowed()&&!ZP5Views.zp5formgetFormsOp.isOperationalRoleAdmin()||0==ZP5Views.currViewRecObj.isExportOptionAllowed||ZP5Views.noDataCheck(ZP5Views.currViewRecObj))&&t.push("#zp_views_exp"),ZP5Views.zp5formgetFormsOp.isAdmin()&&ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().isAuditHistoryEnabled&&!ZP5Views.noDataCheck(ZP5Views.currViewRecObj)||t.push("#zp_views_history_exp"),!ZP5Views.zp5formgetFormsOp.isPhotoUploadOnlyAllowed()&&ZP5Views.zp5formgetFormsOp.isBulkImportAllowed()||t.push("#zp_views_impbulk"),ZP5ViewsCommon.OtherModulesMenuHAndling.checkHideItem("zp_views_esign")&&t.push("#zp_views_esign"),ZPeopleComponents.menu("#formViewMenuListMenu").hideMenuItems(t),ZPeopleComponents.menu("#formViewMenuListMenu").show()}))):this.container.find("#viewActionsContainer").find("#formsviewmenuicontxt").hide(),this.container.find("[id=viewSorting]").off(),this.container.find("[id=viewSorting]").on("click",(e=>{0==$("body").find("#viewSortingMenu").length&&ZP5Views.setUpOptionsForMenu(ZP5Views.getMenuObject("orderByGroupBy"),this.getViewActionsList("orderByGroupBy"));let t=e.target,i=$(t).parent().parent().attr("labelName"),r=ZP5Views.getFieldDetails(this.getViewSearchAllowedFields(),"labelName",i),s=(r.formComponentId,!1),a=!1;null!=r&&null!=r.selectType&&r.selectType==FormConstants.FieldType.MULTI_SELECT?s=!0:null!=r&&null!=r.fieldType&&r.fieldType==FormConstants.FieldType.FILE_UPLOAD&&(a=!0),ZPeopleComponents.menu("#viewSortingMenu").destroy(),ZPeopleComponents.menu("#viewSortingMenu",{forElement:t,className:"zpl_drpdwn",itemclick:e=>{"search"==e.detail.attrs.id?this.handleFieldSpecificSearch(i):this.handleViewSorting(e,i)}});let n=[];if(s||a)n.push("#sortHeader"),n.push("#groupHeader"),n.push("#sortAsc"),n.push("#sortDesc"),n.push("#groupAsc"),n.push("#groupDesc"),n.push("#searchHeader");else{let e=this.getColumnSortGroup(r.labelName).sortBy,t=this.getColumnSortGroup(r.labelName).groupBy;ZPeopleComponents.menu("#viewSortingMenu").setMenuItemsAttribute(["#sortAsc"],"checked",e),ZPeopleComponents.menu("#viewSortingMenu").setMenuItemsAttribute(["#sortDesc"],"checked",null!=e?!e:e),"PEOPLE.APPROVALTIME"!=r.labelName?(ZPeopleComponents.menu("#viewSortingMenu").setMenuItemsAttribute(["#groupAsc"],"checked",t),ZPeopleComponents.menu("#viewSortingMenu").setMenuItemsAttribute(["#groupDesc"],"checked",null!=t?!t:t)):(n.push("#groupHeader"),n.push("#groupAsc"),n.push("#groupDesc"))}ZPeopleComponents.menu("#viewSortingMenu").hideMenuItems(n),ZPeopleComponents.menu("#viewSortingMenu").show()}))}ZP5Views.currViewModuleHandler.isAddButtonNotNeed()?this.container.find("#addRecordButton").remove():this.container.find("#addRecordButton").text(ZP5Views.currViewModuleHandler.getAddButtonText(ZP5Views.zp5formgetFormsOp.getTableName(),ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().addRecordName)),this.container.find("#addRecordButton").off(),this.container.find("#addRecordButton").on("click",(e=>{ZP5Views.currViewModuleHandler.callAddRecordmethod(ZP5Views.zp5formgetFormsOp.getTableName())})),this.container.find("#viewActionsContainer").find("#fullScreen").off(),this.container.find("#viewActionsContainer").find("#fullScreen").on("click",(e=>{$("body").toggleClass("zpl_newsrcn"),this.container.find("#viewActionsContainer").find("#fullScreen").toggleClass("zpl_act")})),this.container.find("#viewActionsContainer").find("#fullScreenBack").off(),this.container.find("#viewActionsContainer").find("#fullScreenBack").on("click",(e=>{$("body").removeClass("zpl_newsrcn"),this.container.find("#viewActionsContainer").find("#fullScreen").removeClass("zpl_act")})),this.viewCompCustAllowed()?(this.container.find("#viewsContainer").find("#userviewcomp").off(),this.container.find("#viewsContainer").find("#userviewcomp").on("click",(()=>{this.handleUserViewComponents(),Layout.Page.pageContWrapper.find("#userviewcomppopover").focus()}))):this.container.find("#viewsContainer").find("#userviewcomp").hide()}viewCompCustAllowed(){let e=!1;if(!this.viewActionsNotRequired&&ZP5Views.getCurrentViewModuleHandler().isUserViewCompNeeded()){let t=ZP5Views.getSelectedView(this.getViewId()),i=t.isCustomView;(""===t.ownerId||t.ownerId.length<=0)&&(i=!1),i||(e=!0)}return e}getViewHeaderList(){let e=[],t=this.viewHeaders.formCompList;if(t.length>0){let i=ZPUtil.sortByJSONValue(t,"sequenceNo",!0);for(let t=0;t<i.length;t++){let r={};r.name=i[t].displayName,r.id=i[t].formCompID,e.push(r)}}return e}handleTotalRecordCount(){let e=ZP5Views.getCurrentViewModuleHandler().getTotalCountParams(this);-1!=this.getTypeOfView()&&(e.typeOfView=this.getTypeOfView()),this.getDynamicParams(e),this.getModuleFilterpsrams(e),e=this.getModuleExtraPrams(e),ZPeople.Request.send(ZP5Views.getCurrentViewModuleHandler().getTotalCountFetchUrl(),e,(e=>{7e3===e.code&&(this.container.find("#viewFooter").find("#view_recordcount").addClass("CPD"),this.container.find("#viewFooter").find("#view_recordcount").html(e.message.recordCount),this.totalRecordCount=e.message.recordCount,this.container.find("#viewFooter").find("#view_recordcount").removeAttr("tabindex"),this.container.find("#viewFooter").find("#view_recordcount").removeAttr("aria-label"),this.container.find("#viewFooter").find("#view_recordcount").parent().attr("tabindex","0"),this.container.find("#viewFooter").find("#view_recordcount").parent().attr("aria-label",ZPI18N.getString("zp.totalrecordcountforfooter",[this.totalRecordCount])),this.container.find("#viewFooter").find("#view_recordcount").parent().focus())}))}handleViewImpExp(e){let t=e.detail.id;"zp_views_imp"==t?-1==settingsUrlProps.niceUrl.lastIndexOf("/listview")?(e.data={viewObj:this},ZP5Import.init()):window.location.hash=urlFormConf.getUrlFromMode("import")+(settingsUrlProps.urlParams?"-"+settingsUrlProps.urlParams:""):"zp_views_exp"==t?ZP5Export.init():"zp_views_history_exp"==t?ZP5Export.init("auditHistory"):"zp_views_impbulk"==t?-1==settingsUrlProps.niceUrl.lastIndexOf("/listview")?(e.data={viewObj:this},BulkFileUpload.init(e)):window.location.hash=urlFormConf.getUrlFromMode("bulkupload")+(settingsUrlProps.urlParams?"-"+settingsUrlProps.urlParams:""):"zp_views_impphoto"==t?-1==settingsUrlProps.niceUrl.lastIndexOf("/listview")?(e.data={viewObj:this},BulkFileUpload.init(e)):window.location.hash=urlFormConf.getUrlFromMode("photoupload")+(settingsUrlProps.urlParams?"-"+settingsUrlProps.urlParams:""):"zp_views_mask"==t?(this.mask=!this.mask,this.container.find("#viewsContainer").find("[mask^=hdr_], [mask^=group]").each(((e,t)=>{("true"==$(t).attr("masked")&&!this.mask||"false"==$(t).attr("masked")&&this.mask)&&$(t).trigger("click")}))):ZP5ViewsCommon.OtherModulesMenuHAndling.menuInit(t,this)}getViewActionsList(e,t){let i=[];return"importExport"==e?(i.push({id:"zp_views_imp",text:ZPI18N.getString("zp.import"),iconClass:"PI_imprt"}),i.push({id:"zp_views_exp",text:ZPI18N.getString("zp.export"),iconClass:"PI_exprt"}),i.push({id:"zp_views_history_exp",text:ZPI18N.getString("zp.historyexport"),iconClass:"PI_exprt"}),i.push({id:"zp_views_impbulk",text:ZPI18N.getString("zp.bulkupload"),iconClass:"PI_imprt"}),i.push({id:"zp_views_impphoto",text:ZPI18N.getString("zp.profilephotoupload"),iconClass:"PI_imprt"}),i.push({id:"zp_views_esign",text:ZPI18N.getString("zp.esign.wf.Esignature"),iconClass:"PI_sign"}),i.push({id:"zp_views_mask",hidden:!0})):"orderByGroupBy"==e?(i.push({id:"sortHeader",text:ZPI18N.getString("zp.sort"),groupname:"viewsort",type:"itemgroup"}),i.push({id:"sortAsc",text:ZPI18N.getString("zp.asc"),groupname:"viewsort",type:"checkbox"}),i.push({id:"sortDesc",text:ZPI18N.getString("zp.desc"),groupname:"viewsort",type:"checkbox"}),i.push({id:"groupHeader",text:ZPI18N.getString("zp.group"),groupname:"viewgroup",type:"itemgroup"}),i.push({id:"groupAsc",text:ZPI18N.getString("zp.asc"),groupname:"viewgroup",type:"checkbox"}),i.push({id:"groupDesc",text:ZPI18N.getString("zp.desc"),groupname:"viewgroup",type:"checkbox"}),i.push({id:"searchHeader",text:"",type:"separator"}),i.push({id:"search",text:ZPI18N.getString("zp.search"),type:"default"})):"viewApproval"==e?(i.push({id:"all",text:ZPI18N.getString("zp.allrequest"),groupname:"viewapproval",type:"radio"}),i.push({id:"approved",text:ZPI18N.getString("zp.approved"),groupname:"viewapproval",type:"radio"}),i.push({id:"rejected",text:ZPI18N.getString("zp.rejected"),groupname:"viewapproval",type:"radio"}),i.push({id:"pending",text:ZPI18N.getString("zp.pending"),groupname:"viewapproval",type:"radio"}),i.push({id:"notsubmitted",text:ZPI18N.getString("zp.drafts"),groupname:"viewapproval",type:"radio"}),i.push({id:"cancelled",text:ZPI18N.getString("zp.cancelled"),groupname:"viewapproval",type:"radio"})):"recordSpecificAction"==e&&(i.push({id:"editrecord",text:ZPI18N.getString("zp.edit")}),ZP5Views.currViewModuleHandler.isDeleteButtonNeed()&&i.push({id:"deleterecord",text:ZPI18N.getString("zp.delete")}),i.push({id:"addTask",text:ZPI18N.getString("zp.checklistaddnewtask")}),i.push({id:"restoreRecord",text:ZPI18N.getString("zp.restore")})),i}getData(e,t){if(ZP5Views.viewFormClassObj.hasOwnProperty(this.formId)&&e&&!this.refresh)null==ZP5Views.currViewRecObj||ZP5Views.serverErrorCheck(ZP5Views.currViewRecObj)||ZP5Views.noDataCheck(ZP5Views.currViewRecObj)||this.isfromreltabs||$("#page-wrapper").addClass("zpl_btmpgn");else{let i={formId:this.formId,viewId:this.viewId,isOnload:!1};if(ZP5Views.currViewModuleHandler.isModeNeed()&&(i.mode="fetchRecords"),ZP5Views.viewFormClassObj.hasOwnProperty(this.formId)||(i.isOnload=!0),-1!=this.updateCount&&(i.updateCount=this.updateCount),this.isImportSummary&&(i.updateCount=200,null!=this.importId?i.importId=this.importId:i.importUniqueId=this.importUniqueId,i.impSummaryType=this.impSummaryType,i.employeeStatus="all",i.typeOfView="all"),this.isrelatedform?(i.isrelatedform=this.isrelatedform,i.relformconfigformid=this.relformconfigformid,i.relformrecid=this.relformrecid,i.relformfcid=this.relformfcid,i.linkedFcid=this.linkedFcid,i.employeeStatus="all"):(this.getDynamicParams(i),this.getModuleFilterpsrams(i)),i.startInd=this.startIndex,ZP5Views.currViewModuleHandler.needPreHandlings()&&this.prehandling(e,t),!i.typeOfView&&ZP5Views.currViewModuleHandler.getViewTypeBasedOnPage&&!this.isrelatedform){let e=ZP5Views.currViewModuleHandler.getViewTypeBasedOnPage();this.typeOfView=e,e&&(i.typeOfView=e)}i=this.getModuleExtraPrams(i),ZPeople.Request.send(ZP5Views.getCurrentViewModuleHandler().getRecordFetchUrl(),i,((i,r,s)=>{ZP5Views.currViewModuleHandler.responseCallback?ZP5Views.currViewModuleHandler.responseCallback(i,r,e,t):this.postHandling(i,r,e,t)}),{},((e,t,i)=>{ServiceApplicabilityUtil.Error.showPermissionDenied(e,t,i,(()=>{common._load(1,this.container)}).bind(this))}))}}getModuleExtraPrams(e){if(ZP5Views.currViewModuleHandler.getExtraParamForFetch){let t=ZP5Views.currViewModuleHandler.getExtraParamForFetch();null!=t&&(e={...e,...t})}return e}prehandling(e,t){let i=this.container.find("#viewsContainer");e?(this.container.find("#viewsContainer").find("#fieldHeader #recordActions input").removeAttr("checked"),common._load(0,$(i).parent())):(this.container.find("#viewFooter").addClass("DNI"),$(i).find("#fieldHeader").html(""),t||this.container.find("#viewActionsContainer").addClass("DNI"),common._load(0,this.container)),this.container.removeClass("zpl_fltr_flt"),this.container.find("#filterResultsHeader").addClass("DNI"),$(i).find("tbody").remove(),$(i).find("thead[id=ghead]").remove(),$(i).parent().find("#viewEmptPage").remove()}postHandling(e,t,i,r){if(t.isOnload)ZP5Views.viewFormClassObj[t.formId]=ZP5Form.getFormsOperation(this.formId),ZP5Views.viewFormClassObj[t.formId].updateFormConf(e.formDetails),ZP5Views.zp5formgetFormsOp=ZP5Views.viewFormClassObj[t.formId],this.searchAllowedFields=void 0,e.formDetails&&(ZP5Views.entity=null!=e.formDetails.entityFcid?e.formDetails.entityFcid:void 0,ZP5Views.unit=null!=e.formDetails.unitFcid?e.formDetails.unitFcid:void 0,ZP5Views.division=null!=e.formDetails.divisionFcid?e.formDetails.divisionFcid:void 0,ZP5Views.department=null!=e.formDetails.deptFcid?e.formDetails.deptFcid:void 0,ZP5Views.locid=null!=e.formDetails.locFcid?e.formDetails.locFcid:void 0,ZP5Views.orgTag=null!=e.formDetails.orgTag?e.formDetails.orgTag:void 0);else{let e=ZP5Views.zp5formgetFormsOp.getFormsDetailsMap();null==ZP5Views.entity&&(ZP5Views.entity=e?e.entityFcid:void 0),null==ZP5Views.unit&&(ZP5Views.unit=e?e.unitFcid:void 0),null==ZP5Views.division&&(ZP5Views.division=e?e.divisionFcid:void 0)}this.setRecords(e,t,i,r)}setRecords(e,t,i,r){this.container.find("#filterResultsHeader").removeClass("DNI"),this.container.find("#viewActionsContainer").removeClass("DNI");let s=this.container.find("#viewsContainer");if(i?common._load(1,$(s).parent()):common._load(1,this.container),e.recordDetails){if(ZP5Views.currViewRecObj=e.recordDetails,ZP5ViewsCommon.Approval.resetApprovalRecordIds(),this.DELETE_RECIDS=new Array,ZP5Views.FILTER_OPTIONS=[],this.SELECT_RECIDS=[],e.urlFilterSearch){let t=e.urlFilterSearch,i=ZP5Views.checkfilterKey(this.viewId);ZP5Views.URL_FILTER_OPTIONS[i]={};for(let e=0;e<t.length;e++){let r=t[e];ZP5Views.URL_FILTER_OPTIONS[i][r.Id]=[],ZP5Views.URL_FILTER_OPTIONS[i][r.Id].push(r.Value),ZP5Views.URL_FILTER_OPTIONS[i][r.Id].push(r.Image)}}this.checkMoreIconNeed(e.recordDetails.isExportOptionAllowed),this.constructViewNew(i,t.isOnload);let r={};r.isImportSummary=this.isImportSummary,r.isrelatedform=this.isrelatedform,r.isImportSummary&&(this.hasOwnProperty("importId")?r.importId=this.importId:r.importUniqueId=this.importUniqueId,r.impSummaryType=this.impSummaryType,r.paginationContainer=this.paginationContainer),r.viewId=this.viewId,r.container=this.container,ZP5Views.setFilterObject(r)}else{ZP5Views.currViewRecObj=e;let t=this.getNodataHtml(ZP5Views.currViewRecObj.message,ZP5Views.currViewRecObj.descMsg);this.container.html(t)}}checkMoreIconNeed(e){let t=this.container.find("#viewActionsContainer").find("#formsviewmenuicontxt");ZP5Views.getCurrentViewModuleHandler().isExportNeeded()?e?t.show():!(ZP5Views.zp5formgetFormsOp.isImportAllowed()||ZP5Views.zp5formgetFormsOp.isBulkImportAllowed()||ZP5Views.zp5formgetFormsOp.isOperationalRoleAdmin()||!ZP5ViewsCommon.OtherModulesMenuHAndling.checkHideItem("zp_views_esign")||this.isMaskAllowed())&&t.hide():t.hide()}getDynamicParams(e){null==this.urlParamsArr||jQuery.isEmptyObject(this.urlParamsArr)||$.each(this.urlParamsArr,(function(t,i){switch(t){case"searchBy":let t=JSON.parse(i);for(let e=0;e<t.length;e++)for(let i in t[e])if(i.indexOf("_ids")>-1)for(let r=0;r<t[e][i].length;r++)t[e][i][r]=ZPeople.checkHTML(t[e][i][r])?t[e][i][r]:ZPeople.decodeTxt(t[e][i][r]);else-1==i.indexOf("_idFlag")&&(t[e][i]=ZPeople.checkHTML(t[e][i])?t[e][i]:ZPeople.decodeTxt(t[e][i]));e.searchBy=JSON.stringify(t);break;case"orgStructureFilter":let r=JSON.parse(i);$.each(r,(function(e,t){e.endsWith("Ids")||(r[e]=ZPeople.checkHTML(t)?t:ZPeople.decodeTxt(t))})),e.orgStructureFilter=JSON.stringify(r);break;case"approvalStatus":let s=ZPeople.checkHTML(i)?i:ZPeople.decodeTxt(i);e.approvalStatus=s;break;case"approverId":let a=ZPeople.checkHTML(i)?i:ZPeople.decodeTxt(i);e.approverId=a;break;case"empstatus":let n=ZPeople.checkHTML(i)?i:ZPeople.decodeTxt(i);e.employeeStatus=n;break;case"typeOfView":let o=ZPeople.checkHTML(i)?i:ZPeople.decodeTxt(i);e.typeOfView=o;break;case"searchUserId":if(ZP5Views.URL_FILTER_OPTIONS[ZP5Views.checkfilterKey(e.viewId)]){e.filterSearchvalue=!1;let t=ZP5Views.URL_FILTER_OPTIONS[ZP5Views.checkfilterKey(e.viewId)],r=JSON.parse(i);for(let i of r.ids)t[i]||(e.filterSearchvalue=!0)}else e.filterSearchvalue=!0;e.searchUserId=i}})),null!=this.sortGroupDetails.sortBy&&""!=this.sortGroupDetails.sortBy.trim()&&(e.sortBy=this.sortGroupDetails.sortBy),null!=this.sortGroupDetails.groupBy&&""!=this.sortGroupDetails.groupBy.trim()&&(e.groupBy=this.sortGroupDetails.groupBy)}getModuleFilterpsrams(e){let t=ZP5Views.getViewObjFromContainer(this.container,ZP5Views.getkey(this.getViewId(),"MFValue"));null!=t&&0!=Object.keys(t).length&&(ZP5Views.currViewFilterModuleHandler.fetOptionFromSer(t)&&(e.fetchOptionforModule=!0),e.moduleSystemFilter=JSON.stringify(t))}getIsEditPermPresent(){return!ZP5Views.noDataCheck(ZP5Views.currViewRecObj)&&ZP5Views.zp5formgetFormsOp.getEditPerm()>0&&this.getIsAnyEditableRecordPresent()}getIsCustomActionEnabled(){return!ZP5Views.noDataCheck(ZP5Views.currViewRecObj)&&null!=ZP5Views.currViewRecObj.message&&null!=ZP5Views.currViewRecObj.message.customActions&&ZP5Views.currViewRecObj.message.customActions.length>0}checkBoxRecordIterator(e){for(let t=0;t<e.length;t++){let i=e[t];if(this.getPermissionOfRecord(i).editPerm>0)return i.isCheckBoxNeeded=!0,!0;i.isCheckBoxNeeded=!1}return!1}getIsAnyEditableRecordPresent(){let e=ZP5Views.currViewRecObj.message,t=!1;if(null!=this.sortGroupDetails.groupBy&&""!=this.sortGroupDetails.groupBy.trim()||null!=e.groupedHeaderList){let i=e.groupedHeaderList.length;if(void 0!==i&&i>0)for(let r=0;r<i;r++){let i=e.recordDetails[r];if(t=this.checkBoxRecordIterator(i),t)break}}else{let i=e.recordDetails;t=this.checkBoxRecordIterator(i)}return t}getIsCheckBoxHtmlNeeded(){let e=!0;return this.isApproverViewType()||this.isAdmin()||this.isOperationAllowed("",0)||this.getIsEditPermPresent()||this.getIsCustomActionEnabled()||this.isBulkTransferAllowed()||(e=!1),e}constructHeaders(){if(ZP5Views.serverErrorCheck(ZP5Views.currViewRecObj))return;this.isFileAvailable=!1;let e=1,t=ZP5Views.currViewRecObj.message;this.permissionsObject=t.permissionDetails;let i=this.getViewDetailsObj().fieldHeaders;this.populateFields(i);let r=this.getViewDetailsObj().searchEnabledFields;this.populateFields(r),this.getViewSearchAllowedFields();let s="";if(this.isCheckBoxHtmlNeeded=!1,this.headersAdded=0,this.isCheckBoxAdded=!1,(!this.viewActionsNotRequired||this.isrelatedform)&&(!this.isrelatedform&&ZP5Views.currViewModuleHandler.getIsMultiSelectedNeeded()&&(this.headersAdded++,s="<th scope='col' class=w45 aria-colindex='"+e+"' for=userviewcomp><i class=PI_file_apprvl id=userviewcomp title='"+ZPI18N.getString("zp.lookup.userDefFields")+"' data-title-position='auto' data-title-display-type='box'></i></th>",e++,this.isCheckBoxHtmlNeeded=this.getIsCheckBoxHtmlNeeded(),this.isCheckBoxHtmlNeeded&&(this.isCheckBoxAdded=!0,this.headersAdded++,s+="<th scope='col' class=w45 aria-colindex='"+e+"' aria-label='Checkbox'><div class=zcheckbox id=recordActions recordid=all><input type=checkbox name=check class=zcheckbox__helper id='checkIdAll' tabindex='-1'><label class=zcheckbox__label for='checkIdAll'></label></div></th>",e++)),ZP5Form.isApprovalEnabled(this.formId)?(this.headersAdded++,s=s+"<th scope='col' class=w45 aria-colindex='"+e+"'><div><span data-toggle='tooltip' data-placement='bottom' title='"+ZPI18N.getString("zp.approvalstatus")+"'>"+ZPI18N.getString("zp.status")+"</span><div></th>",e++,this.getViewProperty("isApproverDetailsTobeShown")&&(this.headersAdded=this.headersAdded+2,s=s+"<th><div><span>"+ZPI18N.getString("zp.approver")+"</span></div></th>",s=s+"<th><div><span>"+ZPI18N.getString("zp.approvalTime")+"</span></div></th>")):this.isrelatedform||(s+=""),ZP5Views.currViewModuleHandler.neddModuleSpecialField())){let e=ZP5Views.currViewModuleHandler.ConstructModuleSpecialField();for(let t of e)s+=ZP5Views.currViewModuleHandler.getHeaderThHtml(t)}for(let t=0;t<i.length;t++){let r=i[t],a=r.displayName,n=r.labelName;if(this.headersAdded<5?(s=s+"<th scope='col' id = "+r.formComponentId+" aria-colindex='"+e+"'><div labelName="+n+"><span onmouseover='ZP5Views.mouseEnterFunction()'>"+a+"</span>",e++):(s=s+"<th scope='col' id = "+r.formComponentId+" aria-colindex='"+e+"'><div labelName="+n+"><span>"+a+"</span>",e++),this.isFileAvailable||r.fieldType!=FormConstants.FieldType.FILE_UPLOAD&&r.fieldType!=FormConstants.FieldType.IMAGE||(this.isFileAvailable=!0),r.isMask&&(s+=`<div class='zpl_tblinfo'><i class="CP ${this.mask?"PI_eye":"PI_eyecls"}"  masked=${this.mask} mask="hdr_${t}" role="button" aria-label="${ZSEC.Encoder.encodeForHTMLAttribute(a)} masking" ></i></div>`),!this.viewActionsNotRequired&&r.fieldType!==FormConstants.FieldType.IMAGE){let e=a+" Sorting";s=s+"<div class=zpl_icncnt><i aria-label='"+ZSEC.Encoder.encodeForHTMLAttribute(e)+"' class=PI_sort id=viewSorting role=menu></i></div>"}this.headersAdded++,s+="</div></th>"}this.isImportSummary?(ZP5Views.removeStaticHeaderClasses(this.container),this.container.find("#viewsContainer").addClass("zpl_nocrsor")):this.checkAndAddStaticHeaders(),this.container.find("#viewsContainer").attr("aria-colcount",i.length+2),this.container.find("#viewsContainer").find("#fieldHeader").append(s),ZP5Form.gridDataMask(this.container.find("#viewsContainer"),!0)}checkAndAddStaticHeaders(){ZP5Views.removeStaticHeaderClasses(this.container);let e=1;if(this.isCheckBoxAdded&&e++,ZP5Form.isApprovalEnabled(this.formId)&&e++,this.headersAdded>5)if(this.getViewProperty("isApproverDetailsTobeShown"))if(this.isCheckBoxAdded){let t="lft"+e;this.container.addClass("zpl_tbllftfxd "+t)}else this.isrelatedform||this.container.addClass("zpl_tbllftfxd lft2_chkbx");else this.isCheckBoxAdded?this.container.addClass("zpl_tbllftfxd lft5"):this.isrelatedform||this.container.addClass("zpl_tbllftfxd lft5_chkbx")}populateFields(e){null==this.fieldDetails&&(this.fieldDetails={});for(let t=0;t<e.length;t++)null==this.fieldDetails[e[t].formComponentId]&&(this.fieldDetails[e[t].formComponentId]=e[t])}handleViewSorting(e,t){let i=e.target,r=e.detail,s="viewsort"==r.attrs.name.trim(),a=r.attrs.id.trim().indexOf("Asc")>-1,n=t+":"+a,o=!1;if(s){let e="";if(null==this.sortGroupDetails.sortBy)e=n;else{e=this.sortGroupDetails.sortBy;let r=e.indexOf(n);-1===r||0!==r&&"."===e.charAt(r-1)||(o=!0);let s=["#sortAsc"];a&&(s=["#sortDesc"]),ZPeopleComponents.menu(i).setMenuItemsAttribute(s,"checked",!1),e=this.getCustomizedColumnsValue(e,n,o,t)}this.sortGroupDetails.sortBy=e}else{let e="";if(null==this.sortGroupDetails.groupBy)e=n;else{e=this.sortGroupDetails.groupBy,-1!==e.indexOf(n)&&(o=!0);let r=["#groupAsc"];a&&(r=["#groupDesc"]),ZPeopleComponents.menu(i).setMenuItemsAttribute(r,"checked",!1),e=this.getCustomizedColumnsValue(e,n,o,t)}this.sortGroupDetails.groupBy=e}ZP5Views.setSortAndGroupByToContainer(this.container,this.viewId,this.sortGroupDetails),this.refresh=!0,this.constructView(!0)}handleFieldSpecificSearch(e){let t=ZP5Views.getFieldDetails(this.getViewSearchAllowedFields(),"labelName",e),i=ZP5Views.filterObject[ZP5Views.checkfilterKey(this.viewId)],r=i.escapingSpecialChar(t.labelName),s=$(this.container).find("#fieldFilterContainer"),a=s.find("[id=filterfields][labelname="+r+"]");$(s.find("#fieldList").children()[0]).before(a);let n=a.find("label");i.showFieldFilterOptions(void 0,!0,n),i.getFilterOpenStatus()||i.handleFilterOperation(),(null==i.getUrlParams()||null==i.getUrlParams().searchBy)&&a[0].scrollIntoView({behavior:"smooth"}),i.restNeed=!0}getCustomizedColumnsValue(e,t,r,s){let a="",n=e.split(";"),o=!1;for(i=0;i<n.length;i++)!r||t===n[i]&&n[i].split(":")[0]===s?r||(n[i].split(":")[0]===s?(a+=t,o=!0):a+=n[i]):a+=n[i],""!==a.trim()&&a.lastIndexOf(";")!==a.length-1&&(a+=";");return r||o||(a+=t+";"),a}getNodataHtml(e,t,i){i=i||"zp_nd_nodata",t=t||"";let r='<div id="viewEmptPage" class="'+ZP5Views.getCurrentViewModuleHandler().getNODataClass()+'"> <div><div class="zpl_emptimg '+i+'"></div>  <h4>'+e+"</h4> <p>"+t+"</p> </div></div>";return this.isrelatedform&&(r='<div class="zpl_frmclm zpl_frmclmview"><div class="zpl_Emptydata mt10"><div><p>'+e+"</p></div></div></div>"),r}constructRecord(){let e=this.container.find("#viewsContainer");if(e.show(),ZP5Views.serverErrorCheck(ZP5Views.currViewRecObj)){let t=this.getNodataHtml(ZP5Views.currViewRecObj.message);e.attr("aria-rowcount","1"),this.container.html(t)}else if(ZP5Views.noDataCheck(ZP5Views.currViewRecObj)){if(0==e.parent().find("#viewEmptPage").length){let t=this.getNodataHtml(ZP5Views.getCurrentViewModuleHandler().getNodataMsg(),ZP5Views.currViewRecObj.descMsg,ZP5Views.currViewRecObj.icon);e.parent().append(t)}e.find("#fieldHeader #recordActions").addClass("disabled"),this.container.find("#viewFooter").addClass("DNI"),this.isImportSummary&&this.showHidePagination&&this.showHidePagination(!1),e.attr("aria-rowcount","1")}else{let i;e.find("#fieldHeader #recordActions").removeClass("disabled"),e.parent().find("#viewEmptPage").remove(),this.isfromreltabs||$("#page-wrapper").addClass("zpl_btmpgn"),this.container.find("#viewFooter").removeClass("DNI"),this.isImportSummary&&this.showHidePagination&&this.showHidePagination(!0);let r=ZP5Views.currViewRecObj.message,s=r.fieldHeaders,a=r.sumRowArray;r.showSumRow;let n=!1,o=r.recordDetails;if(null!=this.sortGroupDetails.groupBy&&""!=this.sortGroupDetails.groupBy.trim()||null!=r.groupedHeaderList){let t=r.groupedHeaderList.length;if(void 0!==t&&t>0){a=r.sumRowsArray;let l=e.find("#fieldHeader").children().length;for(let d=0;d<t;d++){let t,p=r.groupedHeaderList[d],m='<div><span onmouseover=FrameworkCommon.mouseEnterFunction() mask="value" class="zpl_ellipsis w300">'+p+"</span></div>";if(void 0!==r.groupedMaskedList){let e=r.groupedMaskedList[d];m=this.mask?'<div><span class="zpl_ellipsis w300" mask="star">'+e+'</span><span onmouseover=FrameworkCommon.mouseEnterFunction() mask="value" class="zpl_ellipsis w300 zpl_DNI">'+p+'</span><div class="zpl_tblinfo"><i class="PI_eye CP" masked=true mask="group"></i></div></div>':'<div><span class="zpl_ellipsis w300 zpl_DNI" mask="star">'+e+'</span><span onmouseover=FrameworkCommon.mouseEnterFunction() mask="value" class="zpl_ellipsis w300">'+p+'</span><div class="zpl_tblinfo"><i class="PI_eyecls CP" masked=false mask="group"></i></div></div>'}e.append('<thead class="zpl_tblgrph" id="ghead"><tr><th colspan="'+l+'">'+m+"</th></tr></thead>"),o=r.recordDetails[d],void 0!==a&&d<=a.length&&(t=a[d]),i=this.getRecordHtml(o,s,!0,t),n=n||i.totselectbox,e.append(i.recHtml)}}}else i=this.getRecordHtml(o,s,!0,a),n=n||i.totselectbox,e.append(i.recHtml);if(n||e.find("#fieldHeader #recordActions").addClass("disabled"),ZP5Form.getFormClassObj()?ZP5Form.getFormClassObj().isFormMasked()||this.container.find("#viewsContainer").find("[mask^=hdr_]").trigger("click"):(this.container.find("#viewsContainer").find("[mask^=hdr_]").each((function(){"true"==$(this).attr("masked")?$(this).closest("th").find("#viewSorting").addClass("zpl_DNI"):$(this).closest("th").find("#viewSorting").removeClass("zpl_DNI")})),this.container.find("#viewsContainer").find("[mask^=group]").on("click",(function(){let e="true"==$(this).attr("masked");$(this).attr("masked",!e).toggleClass("PI_eye",!e).toggleClass("PI_eyecls",e);let t=$(this).closest("#ghead");t.find("[mask=value]").toggleClass("zpl_DNI",!e),t.find("[mask=star]").toggleClass("zpl_DNI",e),t.next().find("[mask^=value_]").toggleClass("zpl_DNI",!e),t.next().find("[mask^=star_]").toggleClass("zpl_DNI",e)}))),this.getViewProperty("isCustomActionEnable")&&ZP5ViewsCommon.CustomAction.registerElementCallBack(this.container),!this.viewActionsNotRequired&&ZP5Views.getCurrentViewModuleHandler().IsSinglerecViewNeed()||this.isrelatedform){var t=this;e.find("[id=recordContainer]").find("tr").on("click",(function(e){$(e.target).parents("td").find("#recordActions").length||$(e.target).parents("td").find("#recordSpecificAction").length||(ZP5Views.getCurrentViewModuleHandler().singleRecordViewCallBack?ZP5Views.getCurrentViewModuleHandler().singleRecordViewCallBack($(this).attr("id")):t.getFormPage("VIEW",$(this).attr("id"),$(e.target)))}))}}}getApprovalDetails(e){let t=e.approverDtls,i="",r="",s="",a="";return t&&(i='<div class="zpl_em">',t.isAutoApproved?e.approvalStatus==zpconst.ApprovalStatus.Approved?(r='<img src="'+ZPeople.getResourceURL(imageUrl+"auto-app.jpg")+'" imgtype="thumb">',s=ZPI18N.getString("zp.systemapproved"),a=t.apprComplTime):e.approvalStatus==zpconst.ApprovalStatus.Rejected?(r='<img src="'+ZPeople.getResourceURL(imageUrl+"auto-app.jpg")+'" imgtype="thumb">',s=ZPI18N.getString("zp.systemrejected"),a=t.apprComplTime):e.approvalStatus==zpconst.ApprovalStatus.Pending?(r='<img src="'+ZPeople.getResourceURL(imageUrl+"auto-app.jpg")+'" imgtype="thumb">',s=ZPI18N.getString("zp.pending")):e.approvalStatus==zpconst.ApprovalStatus.CancellationPending&&(r='<img src="'+ZPeople.getResourceURL(imageUrl+"auto-app.jpg")+'" imgtype="thumb">',s=ZPI18N.getString("zp.cancellationpending")):t.approvers[0]&&(s=t.approvers[0].dispName,t.approvers[0].photopath&&(r='<img src="'+t.approvers[0].photopath+'" imgtype="thumb">'),a=t.approvers[0].time),""!=r&&(i=i+'<div class="zpl_emimg">'+r+"</div>",i=i+'<div class="zpl_emdts zpl_ellipsis"><div>'+s+"</div></div>"),i="<td>"+i+"</td>",i=i+"<td id=approvaltime>"+a+"</td>"),i}getRecordHtml(e,t,i,r){let s='<tbody id="recordContainer">',a=!1,n=1;for(let i=0;i<e.length;i++){let r=1,o=e[i],l="<tr id="+o.recordId+" >",d=0;if(!this.viewActionsNotRequired||this.isrelatedform){if(!this.isrelatedform&&ZP5Views.currViewModuleHandler.getIsMultiSelectedNeeded()){l="<tr id="+o.recordId+" aria-rowindex="+n+' scope="row">',n++,l+="<td aria-colindex="+r+++">";let e=this.getPermissionOfRecord(o),t=ZP5Views.zp5formgetFormsOp.getTableName(),i="P_MultiRater"!=t&&"P_MultiRater_Approval"!=t&&e.editPerm&&("P_EmployeeHealthData"!=t||"P_VaccinationStatus"!=t),s=e.deletePerm&&"P_EmployeeHealthData"!=t;if(l+=i||s?'<div class="zpl_hvr zpl_icnszmore"><i class="PI_more" id="recordSpecificAction"></i></div></td>':"</td>",d++,this.isCheckBoxHtmlNeeded){let e=!!(this.isApproverViewType()||this.isBulkTransferAllowed()||this.getIsCustomActionEnabled())||(i||s&&this.isAdmin());d++,l+=e?"<td iseditable="+Boolean(i)+" aria-colindex="+r+++'><div class="zcheckbox" id="recordActions" recordid='+o.recordId+'><input type="checkbox" id="checkId_'+o.recordId+'" name="check" value="" class="zcheckbox__helper" tabindex="-1"><label class="zcheckbox__label" for="checkId_'+o.recordId+'"></label></div></td>':"<td></td>",a=e||a}}if((ZP5Form.isApprovalEnabled(this.formId)||ZP5Views.zp5formgetFormsOp.isGoalsheetApprovalenabled)&&(d++,l=l+"<td id=approvalStatusInfo class=text-center aria-colindex="+r+++">"+OPApprovals.getApprovalIcon(o.approvalStatus,ZP5Form.isApprovalEnabled(this.formId),ZP5Views.zp5formgetFormsOp.getTableName())+"</td>",this.getViewProperty("isApproverDetailsTobeShown")&&(l+=this.getApprovalDetails(o))),ZP5Views.currViewModuleHandler.neddModuleSpecialField()){let e=ZP5Views.currViewModuleHandler.ConstructModuleSpecialField();for(let t of e)l+=ZP5Views.currViewModuleHandler.getSingleFieldData(t.key,o)}}let p=o.fieldDetails;for(let e=0;e<t.length;e++){let s=t[e],a=p[e];l=l+"<td aria-colindex="+r+++">",d++;let n;s.fieldType;if(n=s.fieldType!==FormConstants.FieldType.IMAGE&&s.fieldType!==FormConstants.FieldType.FILE_UPLOAD||!ZP5Views.currViewModuleHandler.getTextForImageOrFileUpload?this.getFieldHtmlText(s,a,o):ZP5Views.currViewModuleHandler.getTextForImageOrFileUpload(s,a),null!=n&&""!=n.trim())if(s.fieldType===FormConstants.FieldType.IMAGE)l+=ZP5Views.currViewModuleHandler.getImageHTML(n);else if(s.fieldType===FormConstants.FieldType.TEXT_AREA){let r=`<span class="zpl_db zpl_ellipsis" id="${"multiLinepopover_"+s.formComponentId+"_"+i}" onmouseenter= ZP5Views.multilineMouseEnterFunction() >${n}</span>`;"AddedLOC"==t[e].labelName&&null!=o.createdLatitude&&null!=o.createdLongitude&&""!=o.createdLatitude&&""!=o.createdLongitude?l+='<span class="zpl_adsfld"><i class="PI_location tooltip-js" id="viewsMap" lat="'+o.createdLatitude+'"lon="'+o.createdLongitude+'"data-title-display-type="callout" title="'+ZPI18N.getString("zp.viewmap")+'" ></i>'+r+"</span>":"ModifiedLOC"==t[e].labelName&&null!=o.modifiedLatitude&&null!=o.modifiedLongitude&&""!=o.modifiedLatitude&&""!=o.modifiedLongitude?l+='<span class="zpl_adsfld"><i class="PI_location tooltip-js" id="viewsMap" lat="'+o.modifiedLatitude+'"lon="'+o.modifiedLongitude+'"data-title-display-type="callout" title="'+ZPI18N.getString("zp.viewmap")+'" ></i>'+r+"</span>":l+=r}else if(s.fieldType===FormConstants.FieldType.ADDRESS)l=l+'<span class="tooltip-js" data-title-position="auto" data-title-display-type="box" title="'+n+'">'+n+"</span>";else{let t="true"==this.container.find("#viewsContainer").find(`[mask=hdr_${e}]`).attr("masked")?"":"zpl_DNI",i=""==t?"zpl_DNI":"";l=l+(s.isMask?'<span mask="star_'+e+'" class='+t+">"+FormConstants.MASK.PLACEHOLDER+"</span>":"")+"<span onmouseover=ZP5Views.mouseEnterFunction() "+(s.isMask?'mask="value_'+e+'"':"")+' class="zpl_db zpl_ellipsis '+(s.isMask?i:"")+'">'+n+"</span>"}else{let t="true"==this.container.find("#viewsContainer").find(`[mask=hdr_${e}]`).attr("masked")?"":"zpl_DNI",i=""==t?"zpl_DNI":"";l=l+(s.isMask?'<span mask="star_'+e+'" class='+t+">"+FormConstants.MASK.PLACEHOLDER+"</span>":"")+"<span "+(s.isMask?'mask="value_'+e+'" class='+i:"")+"></span>"}l+="</td>"}l+="</tr>",s+=l}if(i&&void 0!==r){let e='<tr id="sum_row"><td class=DN></td><td class=DN></td><td class=DN></td>';if((!this.viewActionsNotRequired||this.isrelatedform)&&(e=this.isrelatedform?'<tr id="sum_row">':'<tr id="sum_row"><td></td>',this.isCheckBoxHtmlNeeded&&(e+="<td></td>"),(ZP5Form.isApprovalEnabled(this.formId)||ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().isGoalsheetApprovalenabled)&&(e+="<td></td>",this.getViewProperty("isApproverDetailsTobeShown")&&(e+="<td></td>",e+="<td></td>")),ZP5Views.currViewModuleHandler.neddModuleSpecialField())){ZP5Views.currViewModuleHandler.ConstructModuleSpecialField().forEach((()=>{e+="<td></td>"}))}let i=t.length;for(let s=0;s<r.length;s++){r[s].colSpan>1&&(e+='<td colspan="'+(r[s].colSpan-1)+'"></td>'),i-=r[s].colSpan;let a=t.findIndex((e=>e.isMask&&e.formComponentId===r[s].formCompId));if(a){let t="true"==this.container.find("#viewsContainer").find(`[mask=hdr_${a}]`).attr("masked");e+=`<td><span mask="star_${a}" class="${t?"":"zpl_DNI"}">${FormConstants.MASK.PLACEHOLDER}</span><span mask="value_${a}" class="${t?"zpl_DNI":""}"> ${r[s].sumValue}</span></td>`}else e+="<td><div>"+r[s].sumValue+"</div></td>"}i>0&&(e+='<td colspan="'+i+'"></td>'),s+=e}return this.container.find("#viewsContainer").attr("aria-rowcount",e.length+1),{recHtml:s+="</tbody>",totselectbox:a}}getPermissionOfRecord(e){let t=!1;4==e.approvalStatus&&(t=!0);let i=t||e.approvalStatus!=zpconst.ApprovalStatus.Cancelled&&e.approvalStatus!=zpconst.ApprovalStatus.CancellationPending&&e.approvalStatus!=zpconst.ApprovalStatus.Revoked&&(this.isAdmin()||ZP5Views.zp5formgetFormsOp.isOperationalRoleAdmin()&&"dataadmin"==this.getTypeOfView()||(!ZP5Form.isApprovalEnabled(this.fromId)||ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().approvalSettingsDetails.isEditAllow||e.approvalStatus!=zpconst.ApprovalStatus.Approved&&e.approvalStatus!=zpconst.ApprovalStatus.Rejected&&e.approvalStatus!=zpconst.ApprovalStatus.Pending)&&(ZP5Form.Permission.checkisAllowedWithoutAdminPerm(e.ownerID,ZP5Views.zp5formgetFormsOp.getEditPerm())||this.isOperationAllowed(e.ownerID,0))),r=t||this.isAdmin()||ZP5Views.zp5formgetFormsOp.isOperationalRoleAdmin()&&"dataadmin"==this.getTypeOfView()||ZP5Form.Permission.checkisAllowedWithoutAdminPerm(e.ownerID,ZP5Views.zp5formgetFormsOp.getDeletePerm())||this.isOperationAllowed(e.ownerID,1);"P_EmployeeLeave"===ZP5Views.zp5formgetFormsOp.getTableName()&&(11===e.approvalStatus&&(i=!1),Leave.Util.isCurPageAdmin()||(i=r=!1));let s={};return s.editPerm=i,s.deletePerm=r,s}getFormPage(e,t,i){if(ZP5Views.recid=t,"EDIT"===e)void 0!==ZP5Views.getCurrViewParams("recEditCallback")&&"function"==typeof ZP5Views.getCurrViewParams("recEditCallback")?ZP5Views.getCurrViewParams("recEditCallback")(ZP5Views.getCurrViewParams("formId"),t,"EDIT",ZP5Views.getCurrViewParams("isFromSelfService")):void 0===t||isNaN(t)||ZP5Form.showForm("edit",this.formId,t);else if("VIEW"===e)if(void 0!==ZP5Views.getCurrViewParams("recViewCallback")&&"function"==typeof ZP5Views.getCurrViewParams("recViewCallback"))ZP5Views.getCurrViewParams("recViewCallback")(ZP5Views.getCurrViewParams("formId"),t,"VIEW",ZP5Views.getCurrViewParams("isFromSelfService"));else if(void 0!==t&&!isNaN(t))if(this.isrelatedform){var r=$(i).closest('div[id^="zp_dash_rfdata_"]').siblings(".label-head").find("a"),s=$(r).attr("formid");$(r).attr("fcid");ZP5Views.recid=t;var a={formId:this.formId,formMode:"VIEW",recordId:t};s==Task.taskformid&&(a.isCustomLayout=!0);let e=ZP5Form._toForm(a);null!=ZP5Form.getFormClassObj()&&(null!=ZP5Form.getFormClassObj().getFormsProperties().getFormContainer()&&e.setFormContainer(ZP5Form.getFormClassObj().getFormsProperties().getFormContainer()),e.setBaseFormDOMId(ZP5Form.getLayout().attr("id"))),this.isfromreltabs&&e.setIsfromrelTabs(!0,{relformId:this.relformconfigformid,relRecordId:this.relformrecid,container:$(i).closest(`[id^="relatedTabList_${this.relformrecid}"]`)}),e.setRelfieldsingelrecview(!0).setRelfcid(this.relformfcid).init()}else ZP5Form.showForm("view",this.formId,t)}getFieldHtmlText(e,t,i){let r,s=e.labelName,a=e.fieldType,n=e.formComponentId,o=this.getFormId();void 0!==e.refFormId&&(o=e.refFormId);let l=t,d="",p={},m=0;if(a!==FormConstants.FieldType.IMAGE&&a!==FormConstants.FieldType.FILE_UPLOAD||(l=t.value,d=t.filePath,p={fcId:n,recordId:t.recordId,formId:o,original:"false"},l?(p.original="true",r=ZP5Form.constructDownloadLink(p)):t.isEmpPhoto?(l=t.downloadUrl?t.downloadUrl:"",r=l):"1"==t.uploadSource?(r=t.filePath,r=workDriveThumbnailUrl+"/thumbnail/WD/"+r.substr(r.lastIndexOf("/")+1)+"?size=m",l=t.filePath):null!=t.downloadUrl&&(t.downloadUrl.indexOf(workDriveUrl)>-1||t.downloadUrl.indexOf(writerUrl)>-1||this.downloadUrl.indexOf(sheetUrl)>-1||t.downloadUrl.indexOf(showUrl)>-1)?(r=t.downloadUrl,r=workDriveThumbnailUrl+"/thumbnail/WD/"+r.substr(r.lastIndexOf("/")+1)+"?size=m",l=t.downloadUrl):(r=ZP5Form.constructDownloadLink(p),l=t.recordId?r:"")),!ZPUtil.Validation.isEmpty(l))if(a===FormConstants.FieldType.IMAGE)l=t.isEmpPhoto&&"Photo"==s?'<img id="showProfilePic" elem="profilePhoto" src="'+t.downloadUrl+'"  imgtype="thumb" empid="'+i.recordId+'">':'<img src="'+r+'">';else if(a===FormConstants.FieldType.EMAIL_ADDRESS)l='<a href="mailto:'+l+'" tabindex="-1">'+ZSEC.Encoder.encodeForHTMLAttribute(l)+"</a>";else if(a===FormConstants.FieldType.DATE_TIME)l=Calendar.convertTo12Hours(l);else if(a===FormConstants.FieldType.URL){let e="";l.length>0&&""!=l&&(e=i.urlvalue[m]),l='<a rel="noreferrer" href="'+e+'"  target="_blank">'+l+"</a>",m++}else if(a===FormConstants.FieldType.FILE_UPLOAD)if(ZP5Views.zp5formgetFormsOp.getTableName()===Timetracker.constants.JOB_TABLE&&"Attachment"===e.labelName)l=Timetracker.views.handleJobAttachment(t);else{var c,u="";-1!=l.lastIndexOf(".")&&(u=(u=l.substr(l.lastIndexOf(".")+1,l.length)).toLowerCase()),c=1==isPreviewAllowed&&null!=u&&null!=u&&""!=u&&-1!=ZP5Form.PreviewSupportedFileTypes.indexOf(u)?"ZP5Form.FILEUPLOAD_IMAGES.showPreview(this,'"+encodeURIComponent(JSON.stringify(p))+"')":"window.open('"+ZP5Form.constructDownloadLink(p)+"');",l="1"==t.uploadSource||null!=d&&(d.indexOf(workDriveUrl)>-1||d.indexOf(writerUrl)>-1||d.indexOf(sheetUrl)>-1||d.indexOf(showUrl)>-1)?'<a filePath="'+d+'" filename="'+l+'" rel="noreferrer" onclick="ZPeople.stopEvents(event);window.open(\''+d+'\')" href="javascript:;">'+l+"</a>":'<a filePath="'+d+'" filename="'+l+'" rel="noreferrer" onclick="ZPeople.stopEvents(event);'+c+'" href="javascript:;">'+l+"</a>"}else"P_TimesheetJob"===ZP5Views.zp5formgetFormsOp.getTableName()&&a===FormConstants.FieldType.NUMBER&&"Hours"===e.labelName&&(l=Calendar.minstohrs(l));return l}getAllSelectedRecordIds(){let e=[];return e=e.concat(ZP5Views.currViewObj.SELECT_RECIDS),e}recordSelectActions(e){let t=$(e.target);if("recordActions"==t.attr("id"))return;t=t.parent();let i=t.attr("recordid"),r="all"==i,s=0,a=t.find("input").prop("checked"),n=!1;if(r)a?this.container.find("#viewsContainer").find("[id=recordActions]").each(((e,t)=>{let i=$(t).attr("recordid");n||(n=$(t).parent().attr("iseditable")),!isNaN(i)&&this.isApproverViewType()&&-1==ApprovalList.APPROVE_RECIDS.indexOf(i)&&ApprovalList.APPROVE_RECIDS.push(i),!isNaN(i)&&this.isAdmin()&&-1==this.DELETE_RECIDS.indexOf(i)&&this.DELETE_RECIDS.push(i),!isNaN(i)&&-1==this.SELECT_RECIDS.indexOf(i)&&this.SELECT_RECIDS.push(i),$(t).find("input").prop("checked",!0)})):(ZP5ViewsCommon.Approval.resetApprovalRecordIds(),this.DELETE_RECIDS=new Array,this.SELECT_RECIDS=[],this.container.find("#viewsContainer").find("[id=recordActions]").each(((e,t)=>{$(t).find("input").prop("checked",!1)})));else if(!isNaN(i)){var o;if(this.isAdmin())if(a)-1==this.DELETE_RECIDS.indexOf(i)&&this.DELETE_RECIDS.push(i);else-1!==(o=this.DELETE_RECIDS.indexOf(i))&&this.DELETE_RECIDS.splice(o,1);if(this.isApproverViewType())if(a)-1==ApprovalList.APPROVE_RECIDS.indexOf(i)&&ApprovalList.APPROVE_RECIDS.push(i);else-1!==(o=ApprovalList.APPROVE_RECIDS.indexOf(i))&&ApprovalList.APPROVE_RECIDS.splice(o,1);let e=this.SELECT_RECIDS.indexOf(i);a?-1==e&&this.SELECT_RECIDS.push(i):-1!==e&&this.SELECT_RECIDS.splice(e,1);var l=this.getRecordCount();let t=this.container.find("#viewsContainer").find("[id=recordActions][recordid=all]");s=this.container.find("#viewsContainer").find("[id=recordActions][recordid!=all] input:checked").length,l===s?t.find("input").prop("checked",!0):t.find("input").is(":checked")&&t.find("input").prop("checked",!1),n=this.isRecordEditable(this.container.find("#viewsContainer"),this.SELECT_RECIDS)}a||0!=s&&(null==n||"false"==n)?this.showRecordActions(!0,n):!(0!=this.DELETE_RECIDS.length||this.isApproverViewType()&&0!=ApprovalList.APPROVE_RECIDS.length||0!=s)&&this.showRecordActions(!1)}showRecordActions(e,t){e?(this.container.find("#viewActionsContainer").find("#recordActionsContainer").addClass("opn"),this.container.find("#viewActionsContainer").find("#recordActionClose").removeClass("DN"),null!=t&&"true"==t?this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordMassUpdate").removeClass("DN"):this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordMassUpdate").addClass("DN"),this.DELETE_RECIDS.length<=0?this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordDelete").addClass("DN"):this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordDelete").removeClass("DN"),ZP5ViewsCommon.registerRecordSelectActionCallBack(),ZPUtil.Validation.isFunction(ZP5Views.getCurrentViewModuleHandler().selActionHTML)&&ZP5Views.getCurrentViewModuleHandler().selActionHTML(this)):(this.container.find("#viewsContainer").find("[id=recordActions]").each(((e,t)=>{$(t).find("input").prop("checked",!1)})),this.container.find("#viewActionsContainer").find("#recordActionsContainer").removeClass("opn"),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordMassUpdate").addClass("DN"),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordMailMerge").addClass("DN"),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordTaskComplete").addClass("DN"),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordApprove").addClass("zpl_DNI"),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordReject").addClass("zpl_DNI"),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordTriggerOnboarding").addClass("DN"),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordEmpTriggerOnboarding").addClass("DN"),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#convertcandtoemp").addClass("DN"),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordAdobeSign").addClass("DN"),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordDocSign").addClass("DN"),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordZohoSign").addClass("DN"),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#customAction").addClass("DN"),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordDelete").addClass("DN"),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#zp_hr_process_initiate").addClass("DN"),this.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordActionClose").addClass("DN"),this.DELETE_RECIDS=new Array,this.SELECT_RECIDS=[],ZP5ViewsCommon.Approval.resetApprovalRecordIds())}isRecordEditable(e,t){for(let i of t){let t=e.find("#recordActions[recordid='"+i+"']").parent().attr("iseditable");if("true"==t)return t}}isFilterResultsAvailable(){return null!=this.urlParamsArr&&(null!=this.urlParamsArr.orgStructureFilter||null!=this.urlParamsArr.searchBy||null!=this.urlParamsArr.approvalStatus||null!=this.urlParamsArr.searchUserId)}isValueAvailableInMFS(){let e=ZP5Views.getViewObjFromContainer(this.container,ZP5Views.getkey(this.getViewId(),"MFValue"));return ZP5Views.currViewFilterModuleHandler.needModuleSystemFilter()&&null!=e&&0!=Object.keys(e).length}showSearchParams(){let e=this.container.find("#filterResultsHeader").find("#filterResults");if(!ZP5Views.serverErrorCheck(ZP5Views.currViewRecObj))if(this.isFilterResultsAvailable()||this.isValueAvailableInMFS()){this.container.find("#filterResultsHeader").removeClass("DN"),this.container.addClass("zpl_fltrvwfxd");let t=$('<ul id="filterullist" class="zpl_fltrvwlst"></ul>'),i="";if(this.urlParamsArr.searchUserId){let e=JSON.parse(this.urlParamsArr.searchUserId),r=ZP5Views.URL_FILTER_OPTIONS[ZP5Views.checkfilterKey(this.viewId)];if(null!=r&&0!=Object.keys(r).length){i=$('<li id="searchClickId" filterno="searchUserId" filterIndex="0"><label aria-hidden="0">'+ZPI18N.getString("zp.employee")+':&nbsp;&nbsp;&nbsp;</label><span class="zpl_fltrvwimg" id="imageSpan" aria-hidden="0"></span><span id="textSpan" onmouseover="ZP5Views.mouseEnterFunction()" aria-hidden="0"></span><a class="PI_cls" id="viewFilterResultsClose" aria-label="'+ZPI18N.getString("zp.closebutton")+'" role="button"></a></li>');for(let t=0;t<e.ids.length;t++){if(0!=t){i.find("#textSpan").after("<sub id='showSearchElementInPop' class='zpl_drpdwn-js' tabindex='0'>+ "+(e.ids.length-1)+"</sub>");break}i.find("#imageSpan").append("<img src="+r[e.ids[t]][1]+">"),i.find("#textSpan").text(r[e.ids[t]][0]),i.attr("aria-label",ZPI18N.getString("zp.employee")+" is "+ZSEC.Encoder.encodeForHTMLAttribute(r[e.ids[t]][0]))}t.append(i)}}if(null!=this.urlParamsArr.orgStructureFilter){let e=JSON.parse(this.urlParamsArr.orgStructureFilter),r=Object.keys(e);$.each(r,(function(t,i){i.endsWith("Ids")||(e[i]=ZPeople.checkHTML(e[i])?e[i]:ZPeople.decodeTxt(e[i]))}));let s=e.entityIds;if(null!=s&&""!=s.trim()){let r=e.entityValues,s=ZPI18N.getString("zp.addlegalentity");ZPeople.orgStructureDispNameMap.hasOwnProperty("entity")&&(s=ZPeople.orgStructureDispNameMap.entity);let a=s+" "+FormConstants.Criteria.OPERATORSNAME[18];i=$('<li id="searchClickId" filterno="entity" aria-label="'+a+" "+ZSEC.Encoder.encodeForHTMLAttribute(r)+'"><label>'+a+'</label><span onmouseover="ZP5Views.mouseEnterFunction()"></span><a class="PI_cls" id="viewFilterResultsClose" aria-label="'+ZPI18N.getString("zp.closebutton")+'"></a></li>'),i.find("span").text(r),t.append(i)}let a=e.unitIds;if(null!=a&&""!=a.trim()){let r=e.unitValues,s=ZPI18N.getString("zp.addbusinessunit");ZPeople.orgStructureDispNameMap.hasOwnProperty("unit")&&(s=ZPeople.orgStructureDispNameMap.unit);let a=s+" "+FormConstants.Criteria.OPERATORSNAME[18];i=$('<li id="searchClickId" filterno="unit" aria-label="'+a+" "+ZSEC.Encoder.encodeForHTMLAttribute(r)+'"><label aria-hidden="0">'+a+'</label><span onmouseover="ZP5Views.mouseEnterFunction()" aria-hidden="0"></span><a class="PI_cls" id="viewFilterResultsClose" aria-label="'+ZPI18N.getString("zp.closebutton")+'" role="button"></a></li>'),i.find("span").text(r),t.append(i)}let n=e.divisionIds;if(null!=n&&""!=n.trim()){let r=e.divisionValues,s=ZPI18N.getString("zp.adddivision");ZPeople.orgStructureDispNameMap.hasOwnProperty("division")&&(s=ZPeople.orgStructureDispNameMap.division);let a=s+" "+FormConstants.Criteria.OPERATORSNAME[18];i=$('<li id="searchClickId" filterno="division" aria-label="'+a+" "+ZSEC.Encoder.encodeForHTMLAttribute(r)+'"><label aria-hidden="0">'+a+'</label><span onmouseover="ZP5Views.mouseEnterFunction()" aria-hidden="0"></span><a class="PI_cls" id="viewFilterResultsClose" aria-label="'+ZPI18N.getString("zp.closebutton")+'" role="button"></a></li>'),i.find("span").text(r),t.append(i)}let o=e.deptIds;if(null!=o&&""!=o.trim()){let r=e.deptValues,s=ZPI18N.getString("zp.employeedepartment");ZPeople.orgStructureDispNameMap.hasOwnProperty("department")&&(s=ZPeople.orgStructureDispNameMap.department);let a=s+" "+FormConstants.Criteria.OPERATORSNAME[18];i=$('<li id="searchClickId" filterno="department" aria-label="'+a+" "+ZSEC.Encoder.encodeForHTMLAttribute(r)+'"><label aria-hidden="0">'+a+'</label><span onmouseover="ZP5Views.mouseEnterFunction()" aria-hidden="0"></span><a class="PI_cls" id="viewFilterResultsClose" aria-label="'+ZPI18N.getString("zp.closebutton")+'" role="button"></a></li>'),i.find("span").text(r),t.append(i)}let l=e.locIds;if(null!=l&&""!=l.trim()){let r=e.locValues,s=ZPI18N.getString("zp.location")+" "+FormConstants.Criteria.OPERATORSNAME[18];i=$('<li id="searchClickId" filterno="locid" aria-label="'+s+" "+ZSEC.Encoder.encodeForHTMLAttribute(r)+'"><label aria-hidden="0">'+s+'</label><span onmouseover="ZP5Views.mouseEnterFunction()" aria-hidden="0"></span><a class="PI_cls" id="viewFilterResultsClose" aria-label="'+ZPI18N.getString("zp.closebutton")+'" role="button"></a></li>'),i.find("span").text(r),t.append(i)}let d=e.orgTag;if(null!=d&&""!=d.trim()){let r=e.orgTagValues,s=(""!==ZPeople.orgTagDisplayName?ZPeople.orgTagDisplayName:ZPI18N.getString("zp.organizationTag"))+" "+FormConstants.Criteria.OPERATORSNAME[18];i=$('<li id="searchClickId" filterno="orgTag" aria-label="'+s+" "+ZSEC.Encoder.encodeForHTMLAttribute(r)+'"><label aria-hidden="0">'+s+'</label><span onmouseover="ZP5Views.mouseEnterFunction()" aria-hidden="0"></span><a class="PI_cls" id="viewFilterResultsClose" aria-label="'+ZPI18N.getString("zp.closebutton")+'" role="button"></a></li>'),i.find("span").text(ZPeople.checkHTML(r)?r:ZPeople.decodeTxt(r)),t.append(i)}}if(null!=this.urlParamsArr.searchBy){let e=JSON.parse(this.urlParamsArr.searchBy);for(let r=0;r<e.length;r++){let s=e[r],a="",n=0,o="",l=Object.keys(s);for(let e=0;e<l.length;e++){let t=l[e];t.indexOf("_op")>-1?n=s[t]:-1==t.indexOf("_ids")&&-1==t.indexOf("_idFlag")&&(a=t,o=s[t])}if(n==FormConstants.Criteria.OPERATORS.ONLY_PARTICULAR_MONTH)o=FormConstants.MONTH.FULL[o];else if(ZP5Views.currViewModuleHandler.getIsSpecialHandlingForFilter(a)){let e=ZP5Views.getCurrentViewModuleHandler().showSearchParamsFromModules(a,o,n);Object.keys(e).length>0&&(o=e.value,n=e.operType)}let d=ZP5Views.getFieldDetails(this.getViewSearchAllowedFields(),"labelName",a),p=ZP5Views.relatedFieldDisplayname(d.displayName,d.labelName),m=ZPeople.checkHTML(o)?o:ZPeople.decodeTxt(o),c=p+" "+FormConstants.Criteria.OPERATORSNAME[n];i=$('<li id="searchClickId" labelname="'+a+'" filterno="'+r+'" filterIndex="0" aria-label="'+c+" "+ZSEC.Encoder.encodeForHTMLAttribute(m)+'"><label aria-hidden="0">'+c+'</label><span onmouseover="ZP5Views.mouseEnterFunction()" aria-hidden="0"></span><a class="PI_cls" id="viewFilterResultsClose" aria-label="'+ZPI18N.getString("zp.closebutton")+'" role="button"></a></li>');let u=i.find("span"),g=null!=d.refTableName&&-1==d.labelName.indexOf(".");if(d.fieldType!=FormConstants.FieldType.PICKLIST&&d.fieldType!=FormConstants.FieldType.LOOKUP&&!g||FormConstants.Criteria.OPERATORS.EQUAL!=n&&FormConstants.Criteria.OPERATORS.NOT_EQUAL!=n&&FormConstants.Criteria.OPERATORS.CONTAINS!=n)u.text(m);else{let e=m.split(";");e.length>1?(u.text(e[0]),u.after("<sub id='showSearchElementInPop' class='zpl_drpdwn-js' tabindex='0'>+ "+(e.length-1)+"</sub>")):u.text(m)}t.append(i)}}if(null!=this.urlParamsArr.approvalStatus){let e=ZPeople.decodeTxt(this.urlParamsArr.approvalStatus),r=ZPI18N.getString("zp.approvalstatus")+" "+FormConstants.Criteria.OPERATORSNAME[18];i=$('<li id="searchClickId" filterno="approvalstat" aria-label="'+r+'"><label aria-hidden="0">'+r+'</label><span onmouseover="ZP5Views.mouseEnterFunction()" aria-hidden="0"></span><a class="PI_cls" id="viewFilterResultsClose" aria-label="'+ZPI18N.getString("zp.closebutton")+'" role="button"></a></li>'),i.find("span").text(ZP5ViewsCommon.ApproverView.getApprovalStatus(this,e)),this.isApproverViewType()&&"pending"==e&&i.find("#viewFilterResultsClose").addClass("disabled"),t.append(i)}if(this.isValueAvailableInMFS()){let e=ZP5Views.getViewObjFromContainer(this.container,ZP5Views.getkey(this.getViewId(),"MFValue"));i="";for(let t in e)i+='<li id="searchClickId" filterno="modField" labelname='+t+' tabindex="0">',i+=ZP5Views.currViewFilterModuleHandler.getBreadCrumbsHTML(t,e[t]),i+="</li>";t.append(i)}i=$('<li id="filterresultsmore" class="zpl_mre zpl_drpdwn-js DNI"><i id="showsearch"class="PI_more d-flex" role="button"></i></li><div id="zplfltrvwmre1" class="zpl_popovr zpl_fltrvw-popovr" data-type="list" data-content-type="icon-text" role="menu"></div>'),t.append(i),e.html(t[0]),this.moreIcon(e),$(window).on("resize",(()=>{$.each(e.find("#filterullist").find('div[id="zplfltrvwmre1"]').find("li"),((t,i)=>{e.find("#filterullist").find("#filterresultsmore").before(i)})),ZPeopleComponents.popover("#zplfltrvwmre1").close(),this.moreIcon(e)})),e.find("[id=viewFilterResultsClose]").on("click",(e=>{e.stopPropagation(),this.removeFilter(e)})),this.container.find("#filterResultsHeader").find("#clearFilterResults").off(),this.container.find("#filterResultsHeader").find("#clearFilterResults").on("click",(e=>{this.removeFilterFully(e)})),e.find("[id=showSearchElementInPop]").off().on("click",(e=>{e.stopPropagation(),this.constructShowSearchParamPopOver(e)})),e.find("[id=searchClickId]").off().on("click",(e=>{let t=ZP5Views.filterObject[ZP5Views.checkfilterKey(this.viewId)];t.handleFilterOperation();let i=$(e.currentTarget).attr("labelname");if(i)t.container.find("#filterContainer").find("[labelname="+i+"]")[0].scrollIntoView({behavior:"smooth"});else{let r={searchUserId:"employeeSearchFilter",entity:"entityFilter",unit:"unitFilter",division:"divisionFilter",department:"departmentFilter",locid:"locationFilter",orgTag:"employee_org_Tag",approvalstat:"approvalFilter"};i=$(e.currentTarget).attr("filterno"),t.container.find("#filterContainer").find("[id="+r[i]+"]")[0].scrollIntoView({behavior:"smooth"})}}))}else e.html(""),this.container.find("#filterResultsHeader").addClass("DN"),this.container.removeClass("zpl_fltrvwfxd")}constructShowSearchParamPopOver(e){0==$("body").find("#showSearchPopId").length&&$("body").append($('<div id="showSearchPopId" class="zpl_popovr zpl_fltrvw-popovr" data-type="list" data-content-type="icon-text" role="menu" tabindex="0" aria-hidden="true"></div>'));let t=$($(e.currentTarget).parent()).attr("filterno"),i=$('<ul data-body="true" class="zpl_fltrvwlst" />');if("searchUserId"==t){let e=JSON.parse(this.urlParamsArr.searchUserId),t=ZP5Views.URL_FILTER_OPTIONS[ZP5Views.checkfilterKey(this.viewId)];null!=t&&0!=Object.keys(t).length&&$.each(e,((e,r)=>{for(let e=1;e<r.length;e++){let s=$('<li filterno="searchUserId" filterIndex='+e+'><span class="zpl_fltrvwimg" id="imageSpan"></span><span id="textSpan" onmouseover="ZP5Views.mouseEnterFunction()"></span><a class="PI_cls" id="viewFilterResultsClose"></a></li>');s.find("#imageSpan").append("<img src="+t[r[e]][1]+">"),s.find("#textSpan").text(t[r[e]][0]),i.append(s)}}))}else{let e=JSON.parse(this.urlParamsArr.searchBy)[t],r="",s="",a="";$.each(e,((e,t)=>{e.indexOf("_op")>-1?s=t:-1==e.indexOf("_ids")&&-1==e.indexOf("_idFlag")&&(r=e,a=ZPeople.checkHTML(t)?t:ZPeople.decodeTxt(t))})),$.each(a.split(";"),((e,r)=>{if(0!=e){let s=$('<li filterno="'+t+'" filterIndex='+e+'><span onmouseover="ZP5Views.mouseEnterFunction()"></span><a class="PI_cls" id="viewFilterResultsClose"></a></li>');s.find("Span").text(r),i.append(s)}}))}ZPeopleComponents.popover($("body").find("#showSearchPopId")).destroy(),$("body").find("#showSearchPopId").html(i),ZPeopleComponents.popover($("body").find("#showSearchPopId"),{forElement:$(e.currentTarget),position:"bottom",displayType:"box"}),ZPeopleComponents.popover($("body").find("#showSearchPopId")).open(),$("body").find("#showSearchPopId").find("[id=viewFilterResultsClose]").attr("aria-label",ZPI18N.getString("zp.closebutton")),$("body").find("#showSearchPopId").find("[id=viewFilterResultsClose]").on("click",(e=>{this.removeFilter(e)}))}moreIcon(e){let t=this.container.find("#filterResultsHeader").outerWidth(),i=this.container.find("#filterResults").outerWidth(),r=t-(this.container.find("#clearFilterResults").parent().outerWidth()+25),s=this.container.find("#zplfltrvwmre1"),a=e.find("#filterresultsmore");r<i?(a.removeClass("DNI"),s.removeClass("DNI"),ZPeopleComponents.popover(s).destroy(),this.appendSearchPopover(e.find('ul[class="zpl_fltrvwlst"]').find("li"),s,r),ZPeopleComponents.popover(s,{forElement:a,position:"bottom-left",displayType:"box"}),a.off(),a.on("click",(()=>{ZPeopleComponents.popover(s).open()}))):(s.addClass("DNI"),a.addClass("DNI"))}appendSearchPopover(e,t,i){let r=$('<ul data-body="true" class="zpl_fltrvwlst"/>'),s=208+5*(e.length-2);$.each(e,((e,t)=>{s+=$(t).outerWidth(),s>=i&&"filterresultsmore"!=$(t).attr("id")&&r.append(t)})),t.append(r)}removeFilter(e){let t=$(e.currentTarget).parent(),i=$(t).attr("filterno"),r=this.urlParamsArr;if("entity"==i||"unit"==i||"division"==i||"department"==i||"locid"==i||"orgTag"==i){let e=JSON.parse(r.orgStructureFilter);"entity"==i?(delete e.entityIds,delete e.entityValues):"unit"==i?(delete e.unitIds,delete e.unitValues):"division"==i?(delete e.divisionIds,delete e.divisionValues):"department"==i?(delete e.deptIds,delete e.deptValues):"locid"==i?(delete e.locIds,delete e.locValues):"orgTag"==i&&(delete e.orgTag,delete e.orgTagValues),Object.keys(e).length>0?r.orgStructureFilter=JSON.stringify(e):delete r.orgStructureFilter}else if("approvalstat"==i)delete r.approvalStatus;else if("searchUserId"==i){let e=$(t).attr("filterIndex");if(0!=e){ZPeopleComponents.popover($("body").find("#showSearchPopId")).close();let t=JSON.parse(r.searchUserId);t.ids.splice(e,1),t.ids.length>0?r.searchUserId=JSON.stringify(t):delete r.searchUserId}else delete r.searchUserId}else{if("modField"==i){let e=t.attr("labelname"),i=ZP5Views.getViewObjFromContainer(this.container,ZP5Views.getkey(this.getViewId(),"MFValue"));for(let t in i)if(t==e){delete i[t];break}return ZP5Views.setModuleFilterValuesTOcontainer(this.container,ZP5Views.getkey(this.getViewId(),"MFValue"),i),void this.reloadView(!0,!0)}{let e=JSON.parse(r.searchBy),s=$(t).attr("filterIndex");if(0!=s){ZPeopleComponents.popover($("body").find("#showSearchPopId")).close();let t=e[i];$.each(t,((e,i)=>{if(-1==e.indexOf("_op")&&-1==e.indexOf("_ids")&&-1==e.indexOf("_idFlag")){let r=i.split(";");r.splice(s,1),t[e]=r.join(";"),t[e+"_ids"].splice(s,1),t[e+"_idFlag"]&&t[e+"_idFlag"].splice(s,1)}}))}else e.splice(i,1);e.length>0?r.searchBy=JSON.stringify(e):delete r.searchBy}}ZP5Views.currViewModuleHandler.isUrlRefresh()?this.reloadView():this.reloadView(!0,!0)}removeFilterFully(){delete this.urlParamsArr.searchBy,delete this.urlParamsArr.orgStructureFilter,delete this.urlParamsArr.approvalStatus,delete this.urlParamsArr.searchUserId,this.removeFullyMSystemF(),ZP5Views.currViewModuleHandler.isUrlRefresh()?this.reloadView():this.reloadView(!0,!0)}removeFullyMSystemF(){let e=ZP5Views.getkey(this.getViewId(),"MFValue"),t=ZP5Views.getkey(this.getViewId(),"FState"),i=ZP5Views.getViewObjFromContainer(this.container,e);null!=i&&0!=Object.keys(i).length?(ZP5Views.setModuleFilterValuesTOcontainer(this.container,e),ZP5Views.setModuleFilterStateTOcontainer(this.container,t,!0)):ZP5Views.setModuleFilterStateTOcontainer(this.container,t,!1)}checkReloadNeedForMSF(e){e==settingsUrlProps.url&&ZP5Views.getViewObjFromContainer(this.container,ZP5Views.getkey(this.getViewId(),"FState"))?(ZP5Views.setModuleFilterStateTOcontainer(this.container,ZP5Views.getkey(this.getViewId(),"FState"),!1),this.reloadView(!0,!0)):window.location.href="#"+e}reloadView(e,t){if(this.refresh=!0,e)this.constructView(t);else{let e=ZP5Views.getSelectedView(this.getViewId());this.checkReloadNeedForMSF(ZP5Views.getViewModifiedUrl(this.getFormId(),e,this.container))}}deleteRecordsConfirmation(){ZP5Views.getCurrentViewModuleHandler().recDeleteCallback?ZP5Views.getCurrentViewModuleHandler().recDeleteCallback(this,this.getDeleteRecIds()):FrameworkCommon.showDoubleDeleteAlert(ZPI18N.getString("zp.delete"),ZPI18N.getString("zp.recordsdeleteconfirmmsg",[this.DELETE_RECIDS.length]),{callback:this.deleteRecord.bind(this)})}deleteRecord(){var e=this.getDeleteRecIds();if(ZP5Views.getCurrentViewModuleHandler().getIsModuleForm()&&!ZP5Views.getCurrentViewModuleHandler().isFormActionAllowed("DELETE"))ZPComponents.SystemView.deleteRecords(e);else{var t=this.getFormId();ZP5Form.isFormPage()&&(t=Layout.Page.urlparam.formId);var i={mode:"deleteRecords",recordIds:e,formId:t};void 0!==e&&""!==e.trim()&&ZPeople.Request.send(ZP5Form.URL,i,((e,t)=>{this.deleteRecResponse(e,t)}))}}deleteRecResponse(e,t){if(7e3===e.code){let i=ZPI18N.getString("zp.recorddeletedsuccessfully"),r=!0;e.partialdelection&&(i=ZPI18N.getString("zp.payroll.fewuserdel"),r=!1),ZP5Views.zp5formgetFormsOp.isUndoAllowed()?ZP5Form.undo.showAlert(i,t.formId,this.DELETE_RECIDS,{isSuccess:r,successCallBack:()=>{ZP5Views.isTabChanged||null==ZP5Views.getCurrViewObj()||t.formId!=ZP5Views.getCurrViewObj().getFormId()||this.reloadView(!0,!0)}}):r?ZPeople.Message.success(i):ZPeople.Message.failure(i),"P_Employee"!==ZP5Views.zp5formgetFormsOp.getTableName()&&ZP5Form.updateLookUpRefreshOpt(t.formId),this.DELETE_RECIDS.length!=ZP5Views.currViewRecObj.message.recordCount||this.hasNext()||(this.startIndex>1&&this.startIndex>this.getRecordLimit()?this.startIndex=this.startIndex-this.getRecordLimit():this.startIndex=1),this.DELETE_RECIDS.forEach((e=>ZP5Form.clearRecordCache(this.getFormId(),e))),this.showRecordActions(!1),this.reloadView(!0,!0)}else void 0!==e.message?ZPeople.Message.failure(e.message):7500===e.code?ZPeople.Message.failure(ZPI18N.getString("zp.payroll.usercantdel")):ZPeople.Message.failure(ZPI18N.getString("zp.sorryservererror"))}getDeleteRecIds(){var e="";for(i=0;i<this.DELETE_RECIDS.length;i++){var t=this.DELETE_RECIDS[i];0==i?e+=t:e+=","+t}return e}isOperationAllowed(e,t){let i=!1;return null==this.permissionsObject||(""==e&&$.each(this.permissionsObject,(function(e,r){return i=r[t],!i})),null!=this.permissionsObject[e]&&(i=this.permissionsObject[e][t])),i}handleRecordSpecificAction(e,t){let i=e.detail.id;"viewrecord"==i?ZP5Form.showForm("view",this.formId,t):"editrecord"==i?ZP5Form.showForm("edit",this.formId,t):"deleterecord"==i?(this.DELETE_RECIDS=[],this.DELETE_RECIDS.push(t),this.deleteRecordsConfirmation()):"addTask"==i?TaskCommon.createNewTask(this.formId,t):"restoreRecord"==i&&RecycleBin.FormView.restoreRecords([t])}getColumnSortGroup(e){let t=this.getSortGroupDetails(),i={};return void 0!==t.sortBy&&""!==t.sortBy.trim()&&(i.sortBy=this.getColumnAscOrDesc(t.sortBy,e)),void 0!==t.groupBy&&""!==t.groupBy.trim()&&(i.groupBy=this.getColumnAscOrDesc(t.groupBy,e)),i}getColumnAscOrDesc(e,t){for(var i=e.split(";"),r=0;r<i.length;r++){var s=i[r];if(void 0!==s&&s.split(":")[0]===t)return-1===s.indexOf("false")}}handleUserViewComponents(){let e=this.getViewId();if(null==this.userFormCompList){let t=this.getFormId();ZPeople.Request.send("/createViewAction.zp",{mode:"getUserCustomViewColumns",formID:t,viewID:e,conreqcsr:csrfToken},(t=>{void 0===t.error?(this.userFormCompList=t.formCompList,this.selectedCustomizedColumn=t.customizedColumns,this.originalColumns=t.originalColumns,this.divConstruction(e),this.construction(),ZPeopleComponents.popover(Layout.Page.pageContWrapper.find("#userviewcomppopover")).open()):ZPeople.Message.failure(t.error.message)}),{},(e=>{ServiceApplicabilityUtil.Error.showWarningMessage(e)||ZPeople.Message.warning(ZPI18N.getString("zp.rebranderrinaction"))}))}else{let t=Layout.Page.pageContWrapper.find("#userviewcomppopover"),i=t.attr("vId"),r=e.concat(ZPUtil.isV5SettingsUrl()?"_settings":"_other");i!=r?(t.attr("vId",r),this.construction()):this.checkneedToCheck()&&this.construction(),this.userviewComp=void 0,ZPeopleComponents.popover(Layout.Page.pageContWrapper.find("#userviewcomppopover")).open()}}checkneedToCheck(){Object.keys(this.selectedCustomizedColumn);return null!=this.userviewComp}construction(){ZPeopleComponents.popover(Layout.Page.pageContWrapper.find("#userviewcomppopover")).destroy(),this.constructCustomizeList(),ZPeopleComponents.popover(Layout.Page.pageContWrapper.find("#userviewcomppopover"),{forElement:$(this.container).find("#viewsContainer").find("#userviewcomp").parent(),displayType:"box",position:"bottom-left",offsetToParent:!0}),Layout.Page.pageContWrapper.find("#userviewcomppopover").find("#userviewcompsearch").on("keyup",(e=>{let t=$(e.target),i=$(t).val();i=""!=i.trim()?i.toUpperCase():"",this.handleUserViewComponentsSearch(i)})),Layout.Page.pageContWrapper.find("#userviewcomppopover").find("#userviewcomplistcancel").on("click",(()=>{ZPeopleComponents.popover(Layout.Page.pageContWrapper.find("#userviewcomppopover")).close(),Layout.Page.pageContWrapper.find("#userviewcomppopover").find("#userviewcompsearch").val("").keyup(),this.container.find("#viewsContainer").focus()})),Layout.Page.pageContWrapper.find("#userviewcomppopover").find("#userviewcomplistsave").on("click",(()=>{this.handleviewcompsave(),ZPeopleComponents.popover(Layout.Page.pageContWrapper.find("#userviewcomppopover")).close(),this.container.find("#viewsContainer").focus()})),Layout.Page.pageContWrapper.find("#userviewcomppopover").find("#userviewcomplist").find("[name=eachuserviewcomp]").on("click",(e=>{let t=$(e.target);$(e.target).parents("li").length>0&&(t=$(e.target).parents("li")),t=$(t).find("#eachuserviewcomplabel"),this.handleuserviewcompactions(t)}))}divConstruction(e){let t=e.concat(ZPUtil.isV5SettingsUrl()?"_settings":Layout.Page.hashDtl.homeEmpKey?"_"+Layout.Page.hashDtl.homeEmpKey:"_other"),i=Layout.Page.pageContWrapper.find("#userviewcomppopover");if(0==i.length){let e='<div id="userviewcomppopover" aria-label="'+ZPI18N.getString("zp.userviewcomppop")+'" vId="'+t+'"class="zpl_popovr AJdrp w300" rel="totpop" style="top: 45px; left: 0; z-index: 999;"></div>';Layout.Page.pageContWrapper.append(e)}else i.attr("vId")!=t&&i.attr("vId",t)}constructCustomizeList(){if(0!=Layout.Page.pageContWrapper.find("#userviewcomppopover").length){let e=ZPUtil.sortByJSONValue(this.userFormCompList,"sequenceNo",!0),t='<div class="zpl_tbvrt"><div class="zpl_rgtlst"><div class="zpl_tbpne zpl_act"><div class="zpl_popsrch"><div class="zpl_search zpl_srchsml"><input placeholder="'+ZPI18N.getString("zp.search")+'" class="ztextbox" id="userviewcompsearch"><i class="PI_lens"></i></div></div><ul class="zpl_lstgrp" id="userviewcomplist">';$.each(e,((e,i)=>{let r=i.formCompID,s=i.displayName,a=!1;void 0!==this.selectedCustomizedColumn[r]&&(a=!0),t+="<li id = "+r+' name="eachuserviewcomp"><div><div class="zcheckbox"><input type="checkbox" name="check" value="" '+(a?"checked":"")+' class="zcheckbox__helper" aria-label="'+s+'"><label class="zcheckbox__label" id="eachuserviewcomplabel"></label></div><span onmouseover="ZP5Views.mouseEnterFunction()">'+s+"</span></div></li>"})),t=t+'</ul><div class="zpl_list_btm"><button type="button" class="zlabel zlabel--blue zlabel--small" id="userviewcomplistsave">'+ZPI18N.getString("zp.save")+'</button><button type="button" class="zlabel zlabel--outline zlabel--small" id="userviewcomplistcancel">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div></div>",Layout.Page.pageContWrapper.find("#userviewcomppopover").html(t),this.userFormCompList.length<=0&&Layout.Page.pageContWrapper.find("#userviewcomppopover").find("#userviewcomplist").append("<li id=norec><div class='zpl_secn'><span class='zpl_Emptydata'>"+ZPI18N.getString("zp.norec")+"<span></div></li>")}}handleUserViewComponentsSearch(e){let t=ZPUtil.sortByJSONValue(this.userFormCompList,"sequenceNo",!0),i=t.length;Layout.Page.pageContWrapper.find("#userviewcomppopover").find("#userviewcomplist").find("li[id=norec]").remove(),$.each(t,((t,r)=>{let s=r.formCompID;-1==r.displayName.toUpperCase().indexOf(e)?(Layout.Page.pageContWrapper.find("#userviewcomppopover").find("#userviewcomplist").find("#"+s).hide(),i--):Layout.Page.pageContWrapper.find("#userviewcomppopover").find("#userviewcomplist").find("#"+s).show()})),i<=0&&Layout.Page.pageContWrapper.find("#userviewcomppopover").find("#userviewcomplist").append("<li id=norec><div class='zpl_secn'><span class='zpl_Emptydata'>"+ZPI18N.getString("zp.norec")+"<span></div></li>")}handleuserviewcompactions(e){this.userviewComp=[];let t=$(e).parents("li").attr("id");this.userviewComp.push(t),!(null!=$(e).parent().find("input").attr("checked"))?$(e).parent().find("input").attr("checked",""):$(e).parent().find("input").removeAttr("checked")}handleviewcompsave(){let e=Layout.Page.pageContWrapper.find("#userviewcomppopover").find("#userviewcomplistsave");e.attr("disabled",!0);let t=[];if(Layout.Page.pageContWrapper.find("#userviewcomppopover").find("#userviewcomplist").find("[id=eachuserviewcomplabel]").each(((e,i)=>{let r=$(i).parent().parent().parent().attr("id");if($(i).parent().find("input").attr("checked"))t.push(r);else{let e=ZP5Views.getFieldDetails(this.getViewSearchAllowedFields(),"id",r);if(e){let t=e.labelName;if(null!=this.getColumnSortGroup(t)){if(null!=this.getColumnSortGroup(t).sortBy){let e=this.sortGroupDetails.sortBy,i=t+":"+this.getColumnSortGroup(t).sortBy;e=this.getCustomizedColumnsValue(e,i,!0,t),this.sortGroupDetails.sortBy=e}if(null!=this.getColumnSortGroup(t).groupBy){let e=this.sortGroupDetails.groupBy,i=t+":"+this.getColumnSortGroup(t).groupBy;e=this.getCustomizedColumnsValue(e,i,!0,t),this.sortGroupDetails.groupBy=e}}}}})),Object.keys(this.selectedCustomizedColumn).length==t.length)return t=[],void e.attr("disabled",!1);this.userFormCompList.length==t.length&&(t=[]),ZPeople.Request.send("/createViewAction.zp",{mode:"saveUserCustomViewColumns",viewID:this.getViewId(),selectedList:t.toString()},((e,t)=>{this.userFormCompList=void 0,this.userviewComp=void 0,this.reloadView(!0,!1)}),{},(e=>{ServiceApplicabilityUtil.Error.showWarningMessage(e)||ZPeople.Message.warning(ZPI18N.getString("zp.rebranderrinaction"))}))}}class viewFilter{constructor(e){this.viewObject=e.viewObj,this.container=e.container,this.filterButtonId=e.filterButtonId,this.filterOpenCloseClassName=e.className,this.filterCloseButtonId=e.filterCloseButtonId,this.isSystemFilter=e.isSystemFilter,this.applyButtonId=e.applyButtonId,this.resetButtonId=e.resetButtonId,this.isOpen=!1,this.defaultEmpStatus="activeemprecord",this.defaultApprovalStatus="all",this.defaultOrgStrucureStatus=null!=e.defaultOrgStrucureStatus?e.defaultOrgStrucureStatus:"all",this.fieldOptions={},this.urlParams=e.urlParams,this.urlParamsData={},this.restNeed=!1,this.isEmpTree=null!=e.isEmpTree&&e.isEmpTree}getFilterOpenStatus(){return this.isOpen}setFilterOpenStatus(e){this.isOpen=e,this.getViewClassObj().isFilterOpen=e}getViewClassObj(){return this.viewObject}getViewClassViewObj(){return 7e3==ZP5Views.currViewRecObj.code?ZP5Views.currViewRecObj.message:ZP5Views.currViewRecObj}getViewType(){return this.getViewClassViewObj().typeOfView}getUrlParams(){return null!=this.urlParams?this.urlParams:this.getViewClassObj().urlParamsArr}getViewFormId(){return this.getViewClassObj().formId}getFormProperty(e){return ZP5Views.zp5formgetFormsOp.getFormsDetailsMap()[e]}getViewSearchAllowedFields(){return this.getViewClassObj().searchAllowedFields}initializeViewPage(){this.container.find("#filterContainer").is(":visible")&&this.container.find("#filterContainer").parent().removeClass(this.filterOpenCloseClassName),this.setFilterOpenStatus(!1),this.isSystemFilterNeeded()?(this.container.find("#filterContainer").find("#systemFilterContainer").removeClass("DN"),this.handleSystemFilters()):this.container.find("#filterContainer").find("#systemFilterContainer").addClass("DN"),this.handleFieldFilters(),this.handleFieldFilterActions(),this.container.find("#"+this.filterButtonId).off(),this.container.find("#"+this.filterButtonId).on("click",(()=>{this.handleFilterOperation(),this.container.find("#filterContainer").focus()})),this.container.find("#"+this.filterCloseButtonId).off(),this.container.find("#"+this.filterCloseButtonId).on("click",(()=>{this.handleFilterOperation(),this.container.find("#filterButton").focus()})),this.container.find("#"+this.resetButtonId).off(),this.container.find("#"+this.resetButtonId).on("click",(()=>{this.resetFilter(),this.container.find("#filterContainer").focus()})),this.container.find("#systemFilterHeader").off(),this.container.find("#systemFilterHeader").on("click",(()=>{this.container.find("#systemFilterContainer").toggleClass("fltopn")})),this.container.find("#filterFieldSearch").off(),this.container.find("#filterFieldSearch").on("keyup",(e=>{this.handleFilterSearch(e)})),this.container.find("#"+this.applyButtonId).off(),this.container.find("#"+this.applyButtonId).on("click",(()=>{this.reconstructUrl(),this.container.find("#filterButton").focus()})),this.container.find("#fieldFilterHeader").off(),this.container.find("#fieldFilterHeader").on("click",(()=>{this.container.find("#fieldFilterContainer").toggleClass("fltopn")}))}reconstructUrl(){let e=[],t=[],i=[];if(this.constructFilterParams(e,t,i),0==i.length)if(!(e.indexOf("orgStructureFilter")>-1)&&delete this.getViewClassObj().urlParamsArr.orgStructureFilter,this.isApprovalFilterNeeded()&&!(e.indexOf("approvalStatus")>-1)&&delete this.getViewClassObj().urlParamsArr.approvalStatus,!(e.indexOf("searchBy")>-1)&&delete this.getViewClassObj().urlParamsArr.searchBy,!(e.indexOf("searchUserId")>-1)&&delete this.getViewClassObj().urlParamsArr.searchUserId,this.restNeed=!1,this.handleFilterOperation(),this.getViewClassObj().refresh=!0,this.getViewClassObj().startIndex=1,this.getSearchModifiedUrl(e,t),ZP5Views.currViewModuleHandler.isUrlRefresh()){let e=ZP5Views.getSelectedView(this.getViewClassObj().viewId),t=ZP5Views.getViewModifiedUrl(this.getViewFormId(),e,this.container);this.viewObject.checkReloadNeedForMSF(t)}else ZP5Views.getCurrViewObj().reloadView(!0,!0)}handleFilterOperation(){if(this.restNeed&&(this.isSystemFilterNeeded()&&this.handleSystemFilters(),this.handleFieldFilters(),this.handleFieldFilterActions(),this.restNeed=!1),this.getFilterOpenStatus())(this.getViewClassObj().isFilterResultsAvailable()||this.getViewClassObj().isValueAvailableInMFS())&&(this.container.find("#filterResultsHeader").removeClass("DN"),this.container.addClass("zpl_fltrvwfxd")),this.setFilterOpenStatus(!1),this.container.find("#filterContainer").parent().removeClass(this.filterOpenCloseClassName);else{this.setFilterOpenStatus(!0);let e=this.container.find("#filterFieldSearch");this.container.find("#filterContainer").parent().addClass(this.filterOpenCloseClassName),""!=$(e).val().trim()&&($(e).val(""),$(e).trigger({type:"keyup",which:13,keyCode:13})),this.container.find("#filterResultsHeader").addClass("DN"),this.container.removeClass("zpl_fltrvwfxd"),this.setUpFilterValues()}}isSystemFilterNeeded(){return!!ZP5Views.currViewModuleHandler.isSystemFiltersNeeded()&&!(!this.isEmployeeGroupFilterNeeded()&&!this.isApprovalFilterNeeded()&&"P_Employee"!=ZP5Views.zp5formgetFormsOp.getTableName())}isEmployeeStatusFilterNeeded(){return"P_Employee"!=ZP5Views.zp5formgetFormsOp.getTableName()&&"sub"!=this.getViewType()&&"mydep"!=this.getViewType()&&"dirsub"!=this.getViewType()}isEmployeeLookupPresent(){let e=!1;return void 0!==ZP5Views.zp5formgetFormsOp&&void 0!==this.getFormProperty("isEmployeeLookupPresent")&&"P_Employee"!==ZP5Views.zp5formgetFormsOp.getTableName()&&(e=this.getFormProperty("isEmployeeLookupPresent")),e}isEmployeeGroupFilterNeeded(){return!(!this.isEmployeeLookupPresent()&&"P_Employee"!=ZP5Views.zp5formgetFormsOp.getTableName()||"self"==this.getViewType())}isOrgstructureFilterRestricted(){return ZPeople.isOrgstructureFilterRestricted}isApprovalFilterNeeded(){return!!ZP5Form.isApprovalEnabled(this.getViewFormId())}getOptionForEmployeeFilter(e){let t=[],i=ZP5Views.URL_FILTER_OPTIONS[ZP5Views.checkfilterKey(this.getViewClassObj().viewId)];return null==i||0===Object.keys(i).length||$.each(e,((e,r)=>{for(let e=0;e<r.length;e++)t.push({Id:r[e],Value:i[r[e]][0],Image:i[r[e]][1]})})),t}handleSystemFilters(){if(this.container.find("#systemFilterContainer").removeClass("DN"),this.container.find("#systemFilterContainer").addClass("fltopn"),this.isEmployeeGroupFilterNeeded()){if(this.isEmployeeStatusFilterNeeded()){this.container.find("#systemFilterContainer").find("#employeeStatusFilter").removeClass("DN");let e=ZP5Views.currViewFilterModuleHandler.getDefaultEmpStatus();null!=this.getUrlParams()&&null!=this.getUrlParams().empstatus&&(e=this.getUrlParams().empstatus),this.container.find("#systemFilterContainer").find("#employeeStatusFilter #employeeStatusList").zselect("destroy"),ZPeopleComponents.select(this.container.find("#systemFilterContainer").find("#employeeStatusFilter").find("#employeeStatusList"),{dropdownListLazyLoading:!0,selectedValue:e})}else this.container.find("#systemFilterContainer").find("#employeeStatusFilter").addClass("DN");if(this.container.find("#systemFilterContainer").find("#employeeSearchFilter")){let e={viewType:this.isEmpTree?null:this.getViewType(),initOptions:[]};null!=this.getUrlParams()&&null!=this.getUrlParams().searchUserId&&(e.initOptions=this.getOptionForEmployeeFilter(JSON.parse(this.getUrlParams().searchUserId))),this.container.find("#systemFilterContainer").find("#employeeSearchFilter").removeClass("DN"),this.employeeFilterConstruction(this.container.find("#systemFilterContainer").find("#employeeSearchFilter").find("#employeeSearchList"),e)}this.handleSystemOrgStructureFilters()}else this.container.find("#systemFilterContainer").find("#employeeStatusFilter").addClass("DN"),this.container.find("#systemFilterContainer").find("#entityFilter").addClass("DN"),this.container.find("#systemFilterContainer").find("#unitFilter").addClass("DN"),this.container.find("#systemFilterContainer").find("#divisionFilter").addClass("DN"),this.container.find("#systemFilterContainer").find("#departmentFilter").addClass("DN"),this.container.find("#systemFilterContainer").find("#locationFilter").addClass("DN"),this.container.find("#systemFilterContainer").find("#employeeSearchFilter").addClass("DN"),this.container.find("#systemFilterContainer").find("#employee_org_Tag").addClass("DN"),this.container.find("#systemFilterContainer").addClass("DN");if(this.isApprovalFilterNeeded()){this.container.find("#systemFilterContainer").removeClass("DN");let e=this.defaultApprovalStatus;null!=this.getUrlParams()&&null!=this.getUrlParams().approvalStatus&&(e=this.getUrlParams().approvalStatus),this.container.find("#systemFilterContainer").find("#approvalFilter").removeClass("DN"),ZP5ViewsCommon.ApproverView.updateApproverViewFilter(this),this.container.find("#systemFilterContainer").find("#approvalFilter").find("#approvalList").zselect("destroy"),ZPeopleComponents.select(this.container.find("#systemFilterContainer").find("#approvalFilter").find("#approvalList"),{dropdownListLazyLoading:!0,selectedValue:e,change:OPApprovals.Filter.showApprovers}),OPApprovals.Filter.showApprovers()}else this.container.find("#systemFilterContainer").find("#approvalFilter").addClass("DN"),this.container.find("#systemFilterContainer").find("#approverFilter").addClass("DN");if(ZP5Views.currViewFilterModuleHandler.needModuleSystemFilter()){let e=ZP5Views.currViewFilterModuleHandler.getModuleSystemFilter();for(let t of e){let e=t.label,i=this.container.find("#systemFilterContainer").find(".zpl_fltrlst").find("[labelname="+e+"]");if(0==i.length){let r=this.constructMouleSyatemfilter(t);r.append(t.element),this.container.find("#systemFilterContainer").find(".zpl_fltrlst").append(r),i=this.container.find("#systemFilterContainer").find(".zpl_fltrlst").find("[labelname="+e+"]")}ZP5Views.currViewFilterModuleHandler.ModuleFiltercallback(i,ZP5Views.getViewObjFromContainer(this.container,ZP5Views.getkey(this.viewObject.getViewId(),"MFValue")))}}}constructMouleSyatemfilter({label:e}){let t=$('<div class="zpl_secn" id="moduleId"></div>');return t.attr("labelname",e),t}handleOrgStructureFilters(e,t,i,r,s){let a={},n=[];this.isOrgstructureFilterRestricted()||(!ZPeople.orgStructureTagMap.hasOwnProperty("entity")||!ZPeople.orgStructureTagMap.entity||i&&1!=r.entity||($(e.entity).removeClass("DN"),a={},n=[],null!=s&&null!=s.entityIds?(n.push({Value:s.entityValues,Id:s.entityIds}),this.setAllOptions("entity",s.entityValues,s.entityIds)):n.push({Value:ZP5Views.getOrgStructureFieldDisplayName("entity"),Id:this.defaultOrgStrucureStatus}),a.Options=n,a.isOrgStructureFilter=!0,a.lazyLoading=!0,a.viewPerPage=200,a.commonFilter=!0,a.name="entity",this.isEmpTree&&(a.isEmpTree=!0),$(e.entity).find("select[name=entity]").zselect("destroy"),this.getSelectComponent($(e.entity).find("select[name=entity]"),a)),!ZPeople.orgStructureTagMap.hasOwnProperty("unit")||!ZPeople.orgStructureTagMap.unit||i&&1!=r.unit||(a={},n=[],null!=s&&null!=s.unitIds?(n.push({Value:s.unitValues,Id:s.unitIds}),this.setAllOptions("unit",s.unitValues,s.unitIds)):n.push({Value:ZP5Views.getOrgStructureFieldDisplayName("unit"),Id:this.defaultOrgStrucureStatus}),a.Options=n,$(e.unit).removeClass("DN"),a.isOrgStructureFilter=!0,a.lazyLoading=!0,a.viewPerPage=200,a.commonFilter=!0,a.name="unit",this.isEmpTree&&(a.isEmpTree=!0),$(e.unit).find("select[name=unit]").zselect("destroy"),this.getSelectComponent($(e.unit).find("select[name=unit]"),a)),!ZPeople.orgStructureTagMap.hasOwnProperty("division")||!ZPeople.orgStructureTagMap.division||i&&1!=r.division||(a={},n=[],null!=s&&null!=s.divisionIds?(n.push({Value:s.divisionValues,Id:s.divisionIds}),this.setAllOptions("division",s.divisionValues,s.divisionIds)):n.push({Value:ZP5Views.getOrgStructureFieldDisplayName("division"),Id:this.defaultOrgStrucureStatus}),a.Options=n,$(e.division).removeClass("DN"),a.isOrgStructureFilter=!0,a.lazyLoading=!0,a.viewPerPage=200,a.commonFilter=!0,a.name="division",this.isEmpTree&&(a.isEmpTree=!0),$(e.division).find("select[name=division]").zselect("destroy"),this.getSelectComponent($(e.division).find("select[name=division]"),a)),isOrgStructureEnabled&&(!ZPeople.orgStructureTagMap.hasOwnProperty("department")||i&&1!=r.department)||(a={},n=[],null!=s&&null!=s.deptIds?(n.push({Value:s.deptValues,Id:s.deptIds}),this.setAllOptions("department",s.deptValues,s.deptIds)):n.push({Value:ZP5Views.getOrgStructureFieldDisplayName("department"),Id:this.defaultOrgStrucureStatus}),a.Options=n,$(e.department).removeClass("DN"),a.isOrgStructureFilter=!0,a.lazyLoading=!0,a.viewPerPage=200,a.commonFilter=!0,a.name="department",this.isEmpTree&&(a.isEmpTree=!0),$(e.department).find("select[name=department]").zselect("destroy"),this.getSelectComponent($(e.department).find("select[name=department]"),a)),t&&(a={},n=[],null!=s&&null!=s.locIds?(n.push({Value:s.locValues,Id:s.locIds}),this.setAllOptions("locid",s.locValues,s.locIds)):n.push({Value:ZP5Views.getOrgStructureFieldDisplayName("locid"),Id:this.defaultOrgStrucureStatus}),a.Options=n,a.lazyLoading=!0,a.viewPerPage=200,a.commonFilter=!0,a.name="locid",this.isEmpTree&&(a.isEmpTree=!0),$(e.location).removeClass("DN"),$(e.location).find("select[name=locid]").zselect("destroy"),this.getSelectComponent($(e.location).find("select[name=locid]"),a))),ZP5Views.orgTag&&e.organizationTag&&(a={},n=[],null!=s&&null!=s.orgTag?(n.push({Value:s.orgTagValues,Id:s.orgTag}),this.setAllOptions("orgTag",s.orgTagValues,s.orgTag)):n.push({Value:ZP5Views.getOrgStructureFieldDisplayName("orgTag"),Id:this.defaultOrgStrucureStatus}),a.Options=n,a.lazyLoading=!0,a.viewPerPage=200,a.commonFilter=!0,a.name="orgTag",this.isEmpTree&&(a.isEmpTree=!0),e.organizationTag.removeClass("DN"),e.organizationTag.find("select[name=orgTag]").zselect("destroy"),this.getSelectComponent(e.organizationTag.find("select[name=orgTag"),a))}setAllOptions(e,t,i){ZP5Views.ALL_OPTIONS.hasOwnProperty(e)||(ZP5Views.ALL_OPTIONS[e]={},ZP5Views.ALL_OPTIONS[e][""+i]=t)}handleSystemOrgStructureFilters(){let e={};if(null!=this.getUrlParams().orgStructureFilter){e=JSON.parse(this.getUrlParams().orgStructureFilter);let t=Object.keys(e);$.each(t,(function(t,i){i.endsWith("Ids")||(e[i]=ZPeople.checkHTML(e[i])?e[i]:ZPeople.decodeTxt(e[i]))}))}let t={};this.isOrgstructureFilterRestricted()||(t.entity=this.container.find("#systemFilterContainer").find("#entityFilter"),t.unit=this.container.find("#systemFilterContainer").find("#unitFilter"),t.division=this.container.find("#systemFilterContainer").find("#divisionFilter"),t.department=this.container.find("#systemFilterContainer").find("#departmentFilter"),t.location=this.container.find("#systemFilterContainer").find("#locationFilter")),t.organizationTag=this.container.find("#systemFilterContainer").find("#employee_org_Tag"),this.handleOrgStructureFilters(t,!0,!1,void 0,e)}getSelectComponent(e,t){ZPeopleComponents.select(e,{dataSource:{search:r=>new Promise(((s,a)=>{let n={},o={},l=r.query,d=r.pages,p=[],m="";m=t.commonFilter?t.name:$(e).attr("fcid");let c=m,u="";if(u=t.commonFilter?t.name:$(e).attr("name"),t.isOrgStructureFilter&&(c=this.getKeyForFilter(c,u,o)),null==ZP5Views.FILTER_OPTIONS[c]&&(ZP5Views.FILTER_OPTIONS[c]={}),1==d&&""==l&&p.push({Value:ZP5Views.getOrgStructureFieldDisplayName(u),Id:this.defaultOrgStrucureStatus}),ZP5Views.FILTER_OPTIONS[c][l]&&ZP5Views.FILTER_OPTIONS[c][l].length>0&&ZP5Views.FILTER_OPTIONS[c][l].length>200*(d-1)){for(i=200*(d-1);i<200*d&&i<ZP5Views.FILTER_OPTIONS[c][l].length;i++)-1==$.inArray(ZP5Views.FILTER_OPTIONS[c][l][i],p)&&p.push(ZP5Views.FILTER_OPTIONS[c][l][i]);n={results:p,more:!1},s(n)}else if(ZP5Views.FILTER_OPTIONS[c][l]&&0==ZP5Views.FILTER_OPTIONS[c][l].length)n={results:p,more:!1},s(n);else{o.mode="fetchOrgStructureLookupOptions",o.searchtxt=r.query,o.startInd=r.pages,o.conreqcsr=csrfToken;let e=!0;if(t.isEmpTree)o.name=t.name;else{let i=[ZP5Views[m]];o.luFcIds=JSON.stringify(i),o.isfilternotneeded=!0,o.isRelatedLookup=!1,o.formId=this.getViewFormId(),o.typeofview=this.getViewType(),t.commonFilter&&("dataadmin"!=this.getViewType()&&"other_data"!=this.getViewType()||(e=!1),o.name=t.name)}o.isPermBasedListNotNeeded=e,ZPeople.Request.send("/formAction.zp",o,(e=>{if(null==ZP5Views.FILTER_OPTIONS[c][l]&&(ZP5Views.FILTER_OPTIONS[c][l]=[]),null==ZP5Views.ALL_OPTIONS[m]&&(ZP5Views.ALL_OPTIONS[m]={}),"7000"==e.code){let i=t.commonFilter?t.isEmpTree?e.message:e.message[ZP5Views[m]]:e.message[m];for(let e=0;e<i.length;e++){let t=i[e];t.Value=ZPeople.checkHTML(t.Value)?t.Value:ZPeople.decodeTxt(t.Value),ZP5Views.FILTER_OPTIONS[c][l].push(t),ZP5Views.ALL_OPTIONS[m][""+t.Id]=t.Value,p.push(t)}}else ZP5Views.FILTER_OPTIONS[c][l]=[];n={results:p,more:!1},s(n)}))}})),paginated:!0},options:t.Options,dataMapping:{label:"Value",value:"Id",id:"Id"},serverSearch:!0,cacheData:!1,dropdownListLazyLoading:!0,dropdownList:{fitForElement:!0,width:150,height:250},viewPerPage:null!=t.viewPerPage?t.viewPerPage:10,randomDropdownListId:!0,change:e=>{if(t.isOrgStructureFilter){let t=$(e.target).attr("name");"department"!=t&&"locid"!=t&&this.resetOrgStructureFilter(e)}}})}employeeFilterConstruction(e,t){let i={dataSource:{search:e=>new Promise((function(i,r){let s={},a=[],n={};s.mode="fetchOrgStructureLookupOptions",s.searchtxt=e.query,s.startInd=e.pages,s.conreqcsr=csrfToken,s.name="employee",s.isPermBasedListNotNeeded=!0,s.typeofview=t.viewType,ZPeople.Request.send("/formAction.zp",s,(e=>{if("7000"==e.code){let t=e.message;for(let e=0;e<t.length;e++){let i=t[e];a.push(i)}}n={results:a,more:!1},i(n)}))})),paginated:!0},dropdownList:{contentType:"image-text",sortResults:!0,fitForElement:!0},dataMapping:{id:"Id",value:"Id",text:"Value",image:"Image"},placeholder:ZPI18N.getString("zp.employee"),serverSearch:!0,lazyLoading:!0,sortBy:"Id",tokens:{contentType:"image-text"},viewPerPage:20,maxAllowedValues:5,randomDropdownListId:!0,search:{minKeywordLength:0,highlightKeyword:!0,delay:20,showNoResultsMessage:!0},messages:{noResults:ZPI18N.getString("zp.noresults"),remove:ZPI18N.getString("zp.remove")},values:t.initOptions};ZPeopleComponents.isComponent(e)&&ZPeopleComponents.tokenfield(e).destroy(),ZPeopleComponents.tokenfield(e,i)}resetOrgStructureFilter(e){if(""!=e.detail.selectedValue.trim()){let t=$(e.detail.element).attr("name"),i=this.getChild(t);do{if(ZPeople.orgStructureTagMap.hasOwnProperty(i)&&ZPeople.orgStructureTagMap[i])break;i=this.getChild(i)}while("department"!=i);("division"!=t||ZPeople.orgStructureTagMap.hasOwnProperty("department")&&ZPeople.orgStructureTagMap.department)&&$(this.container).find("select[name="+i+"]").zselect("setValue",{Value:ZP5Views.getOrgStructureFieldDisplayName(i),Id:this.defaultOrgStrucureStatus})}}resetOrgStructureFilterNonView(){ZPeople.orgStructureTagMap.hasOwnProperty("entity")&&ZPeople.orgStructureTagMap.entity&&$(this.container.find("select[name=entity]")).zselect("setValue",{Value:ZP5Views.getOrgStructureFieldDisplayName("entity"),Id:this.defaultOrgStrucureStatus}),ZPeople.orgStructureTagMap.hasOwnProperty("unit")&&ZPeople.orgStructureTagMap.unit&&$(this.container.find("select[name=unit]")).zselect("setValue",{Value:ZP5Views.getOrgStructureFieldDisplayName("unit"),Id:this.defaultOrgStrucureStatus}),ZPeople.orgStructureTagMap.hasOwnProperty("division")&&ZPeople.orgStructureTagMap.division&&$(this.container.find("select[name=division]")).zselect("setValue",{Value:ZP5Views.getOrgStructureFieldDisplayName("division"),Id:this.defaultOrgStrucureStatus}),ZPeople.orgStructureTagMap.hasOwnProperty("department")&&ZPeople.orgStructureTagMap.department&&$(this.container.find("select[name=department]")).zselect("setValue",{Value:ZP5Views.getOrgStructureFieldDisplayName("department"),Id:this.defaultOrgStrucureStatus}),$(this.container.find("select[name=locid]")).zselect("setValue",{Value:ZP5Views.getOrgStructureFieldDisplayName("locid"),Id:this.defaultOrgStrucureStatus})}resetNeedOrNOt(e){const t=["searchBy","orgStructureFilter","approvalStatus","empstatus"];for(let i=0;i<e.length;i++)if(t.includes(e[i]))return!0;return!1}resetFilter(){let e=this.container.find("#systemFilterContainer");this.isEmployeeGroupFilterNeeded()&&(this.isEmployeeStatusFilterNeeded()&&e.find("#employeeStatusFilter").find("#employeeStatusList").zselect("setValue",ZP5Views.currViewFilterModuleHandler.getDefaultEmpStatus()),e.find("#employeeSearchFilter")&&ZPeopleComponents.tokenfield(e.find("#employeeSearchFilter").find("#employeeSearchList")).removeAllTokens(),ZPeople.orgStructureTagMap.hasOwnProperty("entity")&&ZPeople.orgStructureTagMap.entity&&e.find("#entityList").zselect("setValue",{Value:ZP5Views.getOrgStructureFieldDisplayName("entity"),Id:this.defaultOrgStrucureStatus}),ZPeople.orgStructureTagMap.hasOwnProperty("unit")&&ZPeople.orgStructureTagMap.unit&&e.find("#unitList").zselect("setValue",{Value:ZP5Views.getOrgStructureFieldDisplayName("unit"),Id:this.defaultOrgStrucureStatus}),ZPeople.orgStructureTagMap.hasOwnProperty("division")&&ZPeople.orgStructureTagMap.division&&e.find("#divisionList").zselect("setValue",{Value:ZP5Views.getOrgStructureFieldDisplayName("division"),Id:this.defaultOrgStrucureStatus}),e.find("#departmentList").zselect("setValue",{Value:ZP5Views.getOrgStructureFieldDisplayName("department"),Id:this.defaultOrgStrucureStatus}),e.find("#locationList").zselect("setValue",{Value:ZP5Views.getOrgStructureFieldDisplayName("locid"),Id:this.defaultOrgStrucureStatus}),e.find("#employee_org_Tag")&&e.find("#employeeorgTagList").zselect("setValue",{Value:ZP5Views.getOrgStructureFieldDisplayName("orgTag"),Id:this.defaultOrgStrucureStatus})),this.isApprovalFilterNeeded()&&(e.find("#approvalFilter").find("#approvalList").zselect("setValue",this.defaultApprovalStatus),e.find("#approverFilter").addClass("DN")),ZP5Views.currViewFilterModuleHandler.needModuleSystemFilter()&&ZP5Views.currViewFilterModuleHandler.restModuleField(e),this.resetFieldFilters(),this.restNeed=!0,$(this.container.find("#filterContainer").children()[1]).scrollTop(0)}getChild(e){let t=["entity","unit","division","department"];return t[t.indexOf(e)+1]}getKeyForFilter(e,t,i){if("locid"!==t&&("department"!=t||ZPeople.orgStructureTagMap.hasOwnProperty("department")&&ZPeople.orgStructureTagMap.department)&&"entity"!=t){if(ZPeople.orgStructureTagMap.hasOwnProperty("entity")&&ZPeople.orgStructureTagMap.entity){let t=$(this.container).find("select[name=entity]").zselect("getValue");""!=t.trim()&&t.trim()!=this.defaultOrgStrucureStatus?(i.entity=JSON.stringify([t]),e=e+"_"+t):e=e+"_"+this.defaultOrgStrucureStatus}if("unit"!=t){if(ZPeople.orgStructureTagMap.hasOwnProperty("unit")&&ZPeople.orgStructureTagMap.unit){let t=$(this.container).find("select[name=unit]").zselect("getValue");""!=t.trim()&&t.trim()!=this.defaultOrgStrucureStatus?(i.unit=JSON.stringify([t]),e=e+"_"+t):e=e+"_"+this.defaultOrgStrucureStatus}if("division"!=t&&ZPeople.orgStructureTagMap.hasOwnProperty("division")&&ZPeople.orgStructureTagMap.division){let t=$(this.container).find("select[name=division]").zselect("getValue");""!=t.trim()&&t.trim()!=this.defaultOrgStrucureStatus?(i.division=JSON.stringify([t]),e=e+"_"+t):e=e+"_"+this.defaultOrgStrucureStatus}}}return e}handleFieldFilters(){$(this.container).find("#fieldFilterContainer").addClass("fltopn");let e=this.getViewSearchAllowedFields();null==e&&(this.getViewClassObj().getViewSearchAllowedFields(),e=this.getViewSearchAllowedFields());let t,i=[],r="";if(this.urlParamsData={},null!=this.getUrlParams()&&null!=this.getUrlParams().searchBy){let e=JSON.parse(this.getUrlParams().searchBy);for(let s=0;s<e.length;s++){let a=e[s],n="",o=Object.keys(a),l={};for(let l=0;l<o.length;l++){let d=o[l];if(d.indexOf("_ids")>-1)for(let t=0;t<e[s][d].length;t++)e[s][d][t]=ZPeople.checkHTML(e[s][d][t])?e[s][d][t]:ZPeople.decodeTxt(e[s][d][t]);else-1==d.indexOf("_idFlag")&&(e[s][d]=ZPeople.checkHTML(e[s][d])?e[s][d]:ZPeople.decodeTxt(e[s][d]));if(-1==d.indexOf("_op")&&-1==d.indexOf("_ids")&&-1==d.indexOf("_idFlag")){n=d;let e=ZP5Views.getFieldDetails(this.getViewSearchAllowedFields(),"labelName",n);if(20!==e.fieldType){this.checkAndDestroyComponent(e.labelName);let t=ZP5Views.relatedFieldDisplayname(e.displayName,e.labelName);e.hasOwnProperty("parentField")?(r+='<div class="zcheckbox" id="filterfields" labelname="'+e.labelName+'"><input id="input_'+e.formComponentId+'" fcid="'+e.formComponentId+'" parentfield="'+e.parentField+'" type="checkbox" name="check" value="" class="zcheckbox__helper" aria-label="'+t+'"><label for="'+e.formComponentId+'" class="zcheckbox__label">'+t+"</label>",r+='<div class="zpl_fgrp DN" id="filterOptions"><select class="zselectbox select-js" labelname="'+e.labelName+'" id="select_'+e.formComponentId+"_"+e.parentField+'" fcid="'+e.formComponentId+'" tabindex="0"></select><textarea  id="tokenfieldId'+e.formComponentId+"_"+e.parentField+'"></textarea><input type="text" class="ztextbox" id="inputfieldId'+e.formComponentId+"_"+e.parentField+'" tabindex="0"/></div></div>'):(r+='<div class="zcheckbox" id="filterfields" labelname="'+e.labelName+'"><input id="input_'+e.formComponentId+'" fcid="'+e.formComponentId+'" type="checkbox" name="check" value="" class="zcheckbox__helper" aria-label="'+t+'" tabindex="-1"><label for="'+e.formComponentId+'" class="zcheckbox__label" tabindex="0">'+t+"</label>",r+='<div class="zpl_fgrp DN" id="filterOptions"><select class="zselectbox select-js" labelname="'+e.labelName+'" id="select_'+e.formComponentId+'" fcid="'+e.formComponentId+'" tabindex="0"></select><textarea id="tokenfieldId'+e.formComponentId+'"></textarea><input type="text" class="ztextbox" id="inputfieldId'+e.formComponentId+'"  tabindex="0"/></div></div>')}t=e.hasOwnProperty("parentField")?e.formComponentId+"_"+e.parentField:e.formComponentId,i.push(t),this.urlParamsData[n]=a}}jQuery.isEmptyObject(l)||(this.urlParamsData[n]=l)}}for(let t=0;t<e.length;t++){let s=e[t],a=s.hasOwnProperty("parentField")?s.formComponentId+"_"+s.parentField:s.formComponentId;if(20!==s.fieldType&&-1==$.inArray(a,i)){this.checkAndDestroyComponent(s.labelName);let e=ZP5Views.relatedFieldDisplayname(s.displayName,s.labelName);s.hasOwnProperty("parentField")?(r+='<div class="zcheckbox" id="filterfields" labelname="'+s.labelName+'"><input id="input_'+s.formComponentId+'" fcid="'+s.formComponentId+'"  parentfield="'+s.parentField+'" type="checkbox" name="check" value="" class="zcheckbox__helper" aria-label="'+e+'"><label for="'+s.formComponentId+'" class="zcheckbox__label">'+e+"</label>",r+='<div class="zpl_fgrp DN" id="filterOptions"><select class="zselectbox select-js" labelname="'+s.labelName+'" id="select_'+s.formComponentId+"_"+s.parentField+'" fcid="'+s.formComponentId+'" tabindex="0"></select><textarea  id="tokenfieldId'+s.formComponentId+"_"+s.parentField+'"></textarea><input type="text" class="ztextbox" id="inputfieldId'+s.formComponentId+"_"+s.parentField+'" tabindex="0"/></div></div>'):(r+='<div class="zcheckbox" id="filterfields" labelname="'+s.labelName+'"><input id="input_'+s.formComponentId+'" fcid="'+s.formComponentId+'" type="checkbox" name="check" value="" class="zcheckbox__helper" aria-label="'+e+'" tabindex="-1"><label for="'+s.formComponentId+'" class="zcheckbox__label" tabindex="0">'+e+"</label>",r+='<div class="zpl_fgrp DN" id="filterOptions"><select class="zselectbox select-js" labelname="'+s.labelName+'" id="select_'+s.formComponentId+'" fcid="'+s.formComponentId+'" tabindex="0"></select><textarea id="tokenfieldId'+s.formComponentId+'"></textarea><input type="text" class="ztextbox" id="inputfieldId'+s.formComponentId+'" tabindex="0"/></div></div>')}}$(this.container).find("#fieldFilterContainer").find("#fieldList").html(r)}checkAndDestroyComponent(e){$(this.container).find("#fieldFilterContainer").find("#fieldList").find("[id=filterfields][labelname='"+e+"']").length>0&&$(this.container).find("#fieldFilterContainer").find("#fieldList").find("[id=filterfields][labelname='"+e+"']").find("#filterOptions").children().each(((e,t)=>{ZPeopleComponents.isComponent($(t))&&ZPeopleComponents[jQuery($(t)).data("componentName").replace("z","")]($(t)).destroy()}))}escapingSpecialChar(e){return e.replace(".","\\.")}setUpFilterValues(){if(null!=this.getUrlParams()&&null!=this.getUrlParams().searchBy){let e=Object.keys(this.urlParamsData),t="";for(let i=0;i<e.length;i++){let r=e[i];0==i&&(t=this.escapingSpecialChar(r));let s=this.urlParamsData[r],a=this.escapingSpecialChar(r),n=$(this.container).find("#fieldFilterContainer").find("[id=filterfields][labelname="+a+"]").find("label"),o=ZP5Views.currViewModuleHandler.getIsSpecialHandlingForFilter(r)?ZP5Views.currViewModuleHandler.getfilterParamFromModule(r,s):s[r+"_op"];this.showFieldFilterOptions(void 0,!0,n,o)}$(this.container).find("#fieldFilterContainer").find("[id=filterfields]")[0].scrollIntoView({behavior:"smooth"})}else $($(this.container).find("#filterContainer").children()[1]).scrollTop(0,{behavior:"smooth"})}handleFieldFilterActions(){this.container.find("#fieldFilterContainer").find("[id=filterfields]").find("label").off(),this.container.find("#fieldFilterContainer").find("[id=filterfields]").find("label").on("click",(e=>{this.showFieldFilterOptions(e)}))}showFieldFilterOptions(e,t,i,r){let s=t?i:e.currentTarget;if($(s).parent().find("input[type=checkbox]").is(":checked"))t?$(s).parent().find("#filterOptions").slideDown():($(s).parent().find("input[type=checkbox]").removeAttr("checked"),$(s).parent().find("#filterOptions").slideUp());else{$(s).parent().find("input[type=checkbox]").attr("checked","");let e,t=$(s).parent().find("input[type=checkbox]").attr("parentfield"),i=$(s).attr("for");e=null==t||null==t?ZP5Views.getFieldDetails(this.getViewSearchAllowedFields(),"id",i):ZP5Views.getFieldDetails(this.getViewSearchAllowedFields(),"parentfield",t,i);let a=this.getFieldFilterOptions(e),n=a.searchList;null==r&&(r=a.operType),ZPeopleComponents.select(null!=t?$(s).parent().find("#filterOptions").find("select[id='select_"+i+"_"+t+"']"):$(s).parent().find("#filterOptions").find("select[id='select_"+i+"']"),{options:n,dataMapping:{label:"name",value:"id",optgroupLabel:"group"},dropdownListLazyLoading:!0,change:e=>{this.handleFilterCriteriaChange(e,r)},randomDropdownListId:!0}),$(s).parent().find("#filterOptions").slideDown(),null==t||null==t?(ZPeopleComponents.select($(s).parent().find("#filterOptions").find("select[id='select_"+i+"']")).deselectAllOptions(),ZPeopleComponents.select($(s).parent().find("#filterOptions").find("select[id='select_"+i+"']")).setValue(r)):(ZPeopleComponents.select($(s).parent().find("#filterOptions").find("select[id='select_"+i+"_"+t+"']")).deselectAllOptions(),ZPeopleComponents.select($(s).parent().find("#filterOptions").find("select[id='select_"+i+"_"+t+"']")).setValue(r))}}handleFilterCriteriaChange(e,t){let r,s=$(e.target),a=ZPeopleComponents.select($(s)).getValue(),n=this.isDisable(a),o=$(s).attr("labelname"),l=ZP5Views.getFieldDetails(this.getViewSearchAllowedFields(),"labelName",o),d=l.formComponentId,p=l.parentField,m=!1,c=!1,u=l.fieldType;if(r=null!=p||null!=p?d+"_"+p:d,null!=l.refTableName&&(-1==l.labelName.indexOf(".")?m=!0:null!=l.isRelatedCol&&l.isRelatedCol&&(c=!0)),ZPeopleComponents.isComponent($(s).parent().find("#inputfieldId"+r))&&ZPeopleComponents[jQuery($(s).parent().find("#inputfieldId"+r)).data("componentName").replace("z","")]($(s).parent().find("#inputfieldId"+r)).destroy(),ZPeopleComponents.isComponent($(s).parent().find("#tokenfieldId"+r))&&ZPeopleComponents[jQuery($(s).parent().find("#tokenfieldId"+r)).data("componentName").replace("z","")]($(s).parent().find("#tokenfieldId"+r)).destroy(),ZPeopleComponents.isComponent($(s).parent().find("#betweenId"+r))&&ZPeopleComponents[jQuery($(s).parent().find("#betweenId"+r)).data("componentName").replace("z","")]($(s).parent().find("#betweenId"+r)).destroy(),$(s).parent().find("#searchError").remove(),a==FormConstants.Criteria.OPERATORS.BETWEEN?$(s).parent().append('<input type="text" class="ztextbox" id="betweenId'+r+'"/>'):$(s).parent().find("#betweenId"+r).remove(),u==FormConstants.FieldType.PICKLIST||m||c)if(a!=FormConstants.Criteria.OPERATORS.EQUAL&&a!=FormConstants.Criteria.OPERATORS.NOT_EQUAL&&a!=FormConstants.Criteria.OPERATORS.CONTAINS)$(s).parent().find("#tokenfieldId"+r).hide(),$(s).parent().find("#inputfieldId"+r).show(),$(s).parent().find("#inputfieldId"+r).val("");else{$(s).parent().find("#inputfieldId"+r).hide();let e={},n=[];if(u!=FormConstants.FieldType.PICKLIST){if(e.value="Id",e.text="Value",e.id="Id",this.urlParamsData.hasOwnProperty(o)&&a==t){let e=this.urlParamsData[o],t=e[o].split(";");for(let i=0;i<e[o+"_ids"].length;i++){let r={Value:t[i].trim(),Id:e[o+"_ids"][i]};n.push(r)}}}else if(e={value:"ID",text:"DISPVALUE",id:"ID"},this.urlParamsData.hasOwnProperty(l.labelName)&&a==t){let e=this.urlParamsData[o],t=e[o].split(";");for(let i=0;i<e[o+"_ids"].length;i++){let r={DISPVALUE:t[i].trim(),ID:e[o+"_ids"][i]};n.push(r)}}ZPeopleComponents.isComponent($(s).parent().find("#tokenfieldId"+r))&&ZPeopleComponents.tokenfield($(s).parent().find("#tokenfieldId"+r)).destroy();let p=ZPeopleComponents.tokenfield($(s).parent().find("#tokenfieldId"+r),{dataSource:{search:e=>new Promise(((t,r)=>{let s={};if(u==FormConstants.FieldType.PICKLIST){let e=[];for(let t=0;t<l.options.length;t++){let i={...l.options[t]};i.DISPVALUE=ZPeople.checkHTML(i.DISPVALUE)?i.DISPVALUE:ZPeople.decodeTxt(i.DISPVALUE),i.VALUE=ZPeople.checkHTML(i.VALUE)?i.VALUE:ZPeople.decodeTxt(i.VALUE),e.push(i)}s={results:e,more:!1},t(s)}else{let r={},a=e.query,n=e.pages,l=[],p=d;if(null==ZP5Views.FILTER_OPTIONS[p]&&(ZP5Views.FILTER_OPTIONS[p]={}),ZP5Views.FILTER_OPTIONS[p][a]&&ZP5Views.FILTER_OPTIONS[p][a].length>0&&ZP5Views.FILTER_OPTIONS[p][a].length>200*(n-1)){for(i=200*(n-1);i<200*n&&i<ZP5Views.FILTER_OPTIONS[p][a].length;i++)-1==$.inArray(ZP5Views.FILTER_OPTIONS[p][a][i],l)&&l.push(ZP5Views.FILTER_OPTIONS[p][a][i]);s={results:l,more:l.length>=200},t(s)}else if(ZP5Views.FILTER_OPTIONS[p][a]&&0==ZP5Views.FILTER_OPTIONS[p][a].length)s={results:l,more:!1},t(s);else{r.mode="fetchFormLookupOtions",r.searchtxt=e.query,r.startInd=200*(e.pages-1)+1,r.conreqcsr=csrfToken;let i=[d];r.luFcIds=JSON.stringify(i),r.formId=this.getViewFormId(),r.isPermBasedListNotNeeded=!0,r.isfilternotneeded=!0,r.isRelatedLookup=!1;let n=ZP5Views.getFieldDetails(this.getViewSearchAllowedFields(),"labelName",o);null!=n&&null!=n.refTableName&&null!=n.isRelatedCol&&n.isRelatedCol&&(r.formId=n.refFormId,r.isRelatedLookup=!0,r.parentField=n.parentField),ZPeople.Request.send("/formAction.zp",r,(e=>{if(null==ZP5Views.FILTER_OPTIONS[p][a]&&(ZP5Views.FILTER_OPTIONS[p][a]=[]),null==ZP5Views.ALL_OPTIONS[d]&&(ZP5Views.ALL_OPTIONS[d]={}),"7000"==e.code)for(let t=0;t<e.message[d].length;t++){let i=e.message[d][t];i.Value=ZPeople.checkHTML(i.Value)?i.Value:ZPeople.decodeTxt(i.Value),ZP5Views.FILTER_OPTIONS[p][a].push(i),ZP5Views.ALL_OPTIONS[d][""+i.Id]=i.Value,l.push(i)}else ZP5Views.FILTER_OPTIONS[p][a]=[];s={results:l,more:l.length>=200},t(s)}))}}})),paginated:!0},dataMapping:e,search:{by:e.text,showNoResultsMessage:!0,highlightKeyword:!0},sort:!1,acceptNewValues:a==FormConstants.Criteria.OPERATORS.CONTAINS,serverSearch:u!=FormConstants.FieldType.PICKLIST,cacheData:!1,values:n,randomDropdownListId:!0,dropdownList:{fitForElement:!0},viewPerPage:200,messages:{noResults:a==FormConstants.Criteria.OPERATORS.CONTAINS?"#query#":ZPI18N.getString("zp.noresults")}});a==FormConstants.Criteria.OPERATORS.CONTAINS&&p._menu.children()[1].addEventListener("click",(e=>{p._enterKeyHandler(e)}))}else $(s).parent().find("#tokenfieldId"+r).hide(),$(s).parent().find("#inputfieldId"+r).show(),$(s).parent().find("#inputfieldId"+r).val("");if(n&&a!=FormConstants.Criteria.OPERATORS.ONLY_PARTICULAR_MONTH)$(s).parent().find("#inputfieldId"+r).attr("disabled",!0);else{if($(s).parent().find("#inputfieldId"+r).attr("disabled",!1),u==FormConstants.FieldType.DATE&&(!m||[FormConstants.Criteria.OPERATORS.BETWEEN,FormConstants.Criteria.OPERATORS.ONLY_PARTICULAR_MONTH].indexOf(parseInt(a))>-1))a==FormConstants.Criteria.OPERATORS.ONLY_PARTICULAR_MONTH?ZPeopleComponents.select($(s).parent().find("#inputfieldId"+r),{options:ZP5Views.getOptionsForFilterCriteria(FormConstants.Criteria.OPERATORS.ONLY_PARTICULAR_MONTH),dataMapping:{value:"id",label:"value"},search:{by:"value"},sort:!1}):(ZPeopleComponents.datefield($(s).parent().find("#inputfieldId"+r),{calendarIcon:!0,picker:!0,format:dateFmt}),ZPeopleComponents.datefield($(s).parent().find("#betweenId"+r),{calendarIcon:!0,picker:!0,format:dateFmt}));else if(u===FormConstants.FieldType.DATE_TIME&&(!m||a==FormConstants.Criteria.OPERATORS.BETWEEN)){let e=timeFormat.replace("a","tt");Calendar.is12HrFormat()||(e=timeFormat+":ss"),e=dateFmt+" "+e,ZPeopleComponents.datetimefield($(s).parent().find("#inputfieldId"+r),{calendarIcon:!0,picker:!0,format:e}),ZPeopleComponents.datetimefield($(s).parent().find("#betweenId"+r),{calendarIcon:!0,picker:!0,format:e})}if(this.urlParamsData.hasOwnProperty(l.labelName)&&a==t){let e=this.urlParamsData[l.labelName],t=e[o].split(";");u==FormConstants.FieldType.DATE&&(!m||[FormConstants.Criteria.OPERATORS.BETWEEN,FormConstants.Criteria.OPERATORS.ONLY_PARTICULAR_MONTH].indexOf(parseInt(a))>-1)?a==FormConstants.Criteria.OPERATORS.ONLY_PARTICULAR_MONTH?ZPeopleComponents.select($(s).parent().find("#inputfieldId"+r)).setValue(t[0]):(ZPeopleComponents.datefield($(s).parent().find("#inputfieldId"+r)).setValue(t[0]),a==FormConstants.Criteria.OPERATORS.BETWEEN&&ZPeopleComponents.datefield($(s).parent().find("#betweenId"+r)).setValue(t[1])):u!==FormConstants.FieldType.DATE_TIME||m&&a!=FormConstants.Criteria.OPERATORS.BETWEEN?a==FormConstants.Criteria.OPERATORS.BETWEEN?($(s).parent().find("#inputfieldId"+r).val(t[0]),$(s).parent().find("#betweenId"+r).val(t[1])):$(s).parent().find("#inputfieldId"+r).val(e[o]):(ZPeopleComponents.datetimefield($(s).parent().find("#inputfieldId"+r)).setValue(t[0]),a==FormConstants.Criteria.OPERATORS.BETWEEN&&ZPeopleComponents.datetimefield($(s).parent().find("#betweenId"+r)).setValue(t[1]))}else $(s).parent().find("#inputfieldId"+r).val("")}}isDisable(e){return e!=FormConstants.Criteria.OPERATORS.EQUAL&&e!=FormConstants.Criteria.OPERATORS.NOT_EQUAL&&e!=FormConstants.Criteria.OPERATORS.STARTS_WITH&&e!=FormConstants.Criteria.OPERATORS.ENDS_WITH&&e!=FormConstants.Criteria.OPERATORS.CONTAINS&&e!=FormConstants.Criteria.OPERATORS.NOT_CONTAINS&&e!=FormConstants.Criteria.OPERATORS.LIKE&&e!=FormConstants.Criteria.OPERATORS.BETWEEN&&e!=FormConstants.Criteria.OPERATORS.LESS_THAN&&e!=FormConstants.Criteria.OPERATORS.GREATER_THAN&&e!=FormConstants.Criteria.OPERATORS.LESS_EQUAL&&e!=FormConstants.Criteria.OPERATORS.GREATER_EQUAL}getFieldFilterOptions(e){let t,i=e.labelName,r=!1,s=[],a=!1,n=e.fieldType;if(null!=e.refTableName&&(-1==i.indexOf(".")?r=!0:null!=e.isRelatedCol&&e.isRelatedCol&&(a=!0)),r||n!=FormConstants.FieldType.SCRIPT||(n=e.formulaDtype),"P_Employee"!=ZP5Views.zp5formgetFormsOp.getTableName()&&"P_Employee"!=e.refTableName||"AGE"!=e.columnName&&"EXPERIENCE"!=e.columnName||(n=FormConstants.FieldType.NUMBER),20!==n)if(e.isEncrypted)this.addJsonObjectToList(s,FormConstants.Criteria.OPERLIST.ENCRYPTED,n);else if(n!==FormConstants.FieldType.CHECK_BOX)if(ZP5Views.currViewModuleHandler.getIsSpecialHandlingForFilter(i)){let e=ZP5Views.currViewModuleHandler.getFieldFilterOptionFromModules(i);t=ZP5Views.currViewModuleHandler.getFieldFilterDefaultOperator(i),this.addJsonObjectToList(s,e,n)}else n===ZP5Form.Field.TIME?this.addJsonObjectToList(s,FormConstants.Criteria.OPERLIST.TIME,n):n===FormConstants.FieldType.FILE_UPLOAD?this.addJsonObjectToList(s,FormConstants.Criteria.OPERLIST.DEFAULT,n):(n!==FormConstants.FieldType.AUTONUMBER?(this.addJsonObjectToList(s,FormConstants.Criteria.OPERLIST.SEARCHABLE,n),this.addJsonObjectToList(s,FormConstants.Criteria.OPERLIST.DEFAULT,n)):this.addJsonObjectToList(s,FormConstants.Criteria.OPERLIST.AUTO_NUMBER,n),n!==FormConstants.FieldType.DATE&&n!==FormConstants.FieldType.FORMULA_DATE&&n!==FormConstants.FieldType.DATE_TIME||(this.addJsonObjectToList(s,FormConstants.Criteria.OPERLIST.DAYS,n,ZPI18N.getString("zp.cday",[""])),this.addJsonObjectToList(s,FormConstants.Criteria.OPERLIST.YEAR,n,ZPI18N.getString("zp.year",[""]))),n===FormConstants.FieldType.DATE||n===FormConstants.FieldType.FORMULA_DATE?this.addJsonObjectToList(s,FormConstants.Criteria.OPERLIST.MONTH_WITH_ONLY,n,ZPI18N.getString("zp.month",[""])):n===FormConstants.FieldType.DATE_TIME||n===FormConstants.FieldType.FORMULA_DATE?this.addJsonObjectToList(s,FormConstants.Criteria.OPERLIST.MONTH,n,ZPI18N.getString("zp.month",[""])):n!==FormConstants.FieldType.NUMBER&&n!==FormConstants.FieldType.DECIMAL&&n!==FormConstants.FieldType.CURRENCY||this.addJsonObjectToList(s,FormConstants.Criteria.OPERLIST.NUMERIC,n));else this.addJsonObjectToList(s,FormConstants.Criteria.OPERLIST.BOOLEAN,n);return{searchList:s,operType:t||this.getDefaultOperType(e)}}getDefaultOperType(e){let t=FormConstants.Criteria.OPERATORS.CONTAINS;return(e.fieldType===FormConstants.FieldType.NUMBER||e.fieldType===FormConstants.FieldType.DECIMAL||e.fieldType===FormConstants.FieldType.CURRENCY||e.fieldType===FormConstants.FieldType.DATE||e.fieldType===FormConstants.FieldType.DATE_TIME||e.fieldType===ZP5Form.Field.TIME||e.fieldType===FormConstants.FieldType.FORMULA_DATE||e.fieldType===FormConstants.FieldType.AUTONUMBER||e.fieldType===FormConstants.FieldType.SCRIPT||e.isEncrypted)&&(t=FormConstants.Criteria.OPERATORS.EQUAL),e.fieldType===FormConstants.FieldType.CHECK_BOX&&(t=FormConstants.Criteria.OPERATORS.TRUE),e.fieldType===FormConstants.FieldType.FILE_UPLOAD&&(t=FormConstants.Criteria.OPERATORS.EMPTY),t}addJsonObjectToList(e,t,i,r){let s=!1;i!==FormConstants.FieldType.NUMBER&&i!==FormConstants.FieldType.DECIMAL&&i!==FormConstants.FieldType.CURRENCY&&i!==FormConstants.FieldType.DATE&&i!==FormConstants.FieldType.DATE_TIME&&i!==ZP5Form.Field.TIME&&i!==FormConstants.FieldType.FORMULA_DATE&&i!==FormConstants.FieldType.AUTONUMBER||(s=!0);for(let a in t){if(a==FormConstants.Criteria.OPERATORS.BETWEEN&&!s||(a==FormConstants.Criteria.OPERATORS.STARTS_WITH||a==FormConstants.Criteria.OPERATORS.ENDS_WITH||a==FormConstants.Criteria.OPERATORS.CONTAINS||a==FormConstants.Criteria.OPERATORS.NOT_CONTAINS||a==FormConstants.Criteria.OPERATORS.LIKE)&&s&&i!=FormConstants.FieldType.AUTONUMBER)continue;if("69"===a&&i===FormConstants.FieldType.FORMULA_DATE)continue;let n={};n.id=a,n.name=ZPI18N.getString(t[a],[""]),null!=r&&(n.group=r),e.push(n)}}constructFilterParams(e,t,i){this.isSystemFilterNeeded()&&this.constructSystemFilterParams(e,t),this.constructFieldFilterParams(e,t,i)}constructSystemFilterParams(e,t){if(this.isEmployeeGroupFilterNeeded()){if(this.isEmployeeStatusFilterNeeded()){let i=$(this.container.find("#systemFilterContainer").find("#employeeStatusFilter").find("#employeeStatusList")).zselect("getValue");e.push("empstatus"),t.push(i)}let i=this.container.find("#systemFilterContainer").find("#employeeSearchFilter");if(i){let r=ZPeopleComponents.tokenfield(i.find("#employeeSearchList")).getAllValues();if(r.length>0){let i={ids:[]},s=ZP5Views.checkfilterKey(this.getViewClassObj().viewId);ZP5Views.URL_FILTER_OPTIONS[s]={},r.forEach(((e,t)=>{i.ids.push(e.Id),ZP5Views.URL_FILTER_OPTIONS[s][e.Id]=[],ZP5Views.URL_FILTER_OPTIONS[s][e.Id].push(e.Value),ZP5Views.URL_FILTER_OPTIONS[s][e.Id].push(e.Image)})),e.push("searchUserId"),t.push(JSON.stringify(i))}}let r={};if(!this.isOrgstructureFilterRestricted()){if(ZPeople.orgStructureTagMap.hasOwnProperty("entity")&&ZPeople.orgStructureTagMap.entity){let e=this.container.find("#filterContainer [id='systemFilterContainer']").find("select[name=entity]").zselect("getValue");e.trim()!=this.defaultOrgStrucureStatus&&""!=e.trim()&&(r.entityIds=e,r.entityValues=this.getOptionTextFromList("entity",e))}if(ZPeople.orgStructureTagMap.hasOwnProperty("unit")&&ZPeople.orgStructureTagMap.unit){let e=this.container.find("#filterContainer [id='systemFilterContainer']").find("select[name=unit]").zselect("getValue");e.trim()!=this.defaultOrgStrucureStatus&&""!=e.trim()&&(r.unitIds=e,r.unitValues=this.getOptionTextFromList("unit",e))}if(ZPeople.orgStructureTagMap.hasOwnProperty("division")&&ZPeople.orgStructureTagMap.division){let e=this.container.find("#filterContainer [id='systemFilterContainer']").find("select[name=division]").zselect("getValue");e.trim()!=this.defaultOrgStrucureStatus&&""!=e.trim()&&(r.divisionIds=e,r.divisionValues=this.getOptionTextFromList("division",e))}if(!isOrgStructureEnabled||ZPeople.orgStructureTagMap.hasOwnProperty("department")){let e=this.container.find("#filterContainer [id='systemFilterContainer']").find("select[name=department]").zselect("getValue");e.trim()!=this.defaultOrgStrucureStatus&&""!=e.trim()&&(r.deptIds=e,r.deptValues=this.getOptionTextFromList("department",e))}let e=this.container.find("#filterContainer [id='systemFilterContainer']").find("select[name=locid]").zselect("getValue");e.trim()!=this.defaultOrgStrucureStatus&&""!=e.trim()&&(r.locIds=e,r.locValues=this.getOptionTextFromList("locid",e))}let s=this.container.find("#filterContainer [id='systemFilterContainer']").find("select[name=orgTag]");if(s){let e=s.zselect("getValue");ZP5Views.orgTag&&null!=e&&e.trim()!=this.defaultOrgStrucureStatus&&""!=e.trim()&&(r.orgTag=e,r.orgTagValues=this.getOptionTextFromList("orgTag",e))}let a=Object.keys(r);a.length>0&&($.each(a,(function(e,t){t.endsWith("Ids")||(r[t]=ZPeople.escapeHtml(r[t]))})),e.push("orgStructureFilter"),t.push(JSON.stringify(r)))}if(this.isApprovalFilterNeeded()){let i=$(this.container.find("#systemFilterContainer").find("#approvalFilter").find("#approvalList")).zselect("getValue");if(i.trim()!=this.defaultOrgStrucureStatus&&""!=i.trim()&&(e.push("approvalStatus"),t.push(i)),"otherspending"==i){let i=$(this.container.find("#systemFilterContainer").find("#approverFilter").find("#approverList")).zselect("getValue");""!=i.trim()&&(e.push("approverId"),t.push(i))}}if(ZP5Views.currViewFilterModuleHandler.needModuleSystemFilter()){let e=ZP5Views.currViewFilterModuleHandler.setModuleFilterValues(this.container.find("#systemFilterContainer")),t=ZP5Views.getkey(this.viewObject.getViewId(),"MFValue"),i=ZP5Views.getViewObjFromContainer(this.container,t);null==i&&0!=Object.keys(e).length||null!=i&&(Object.keys(e).length!=Object.keys(i).length||this.checkValuesHaschange(e,i))?ZP5Views.setModuleFilterStateTOcontainer(this.container,ZP5Views.getkey(this.viewObject.getViewId(),"FState"),!0):ZP5Views.setModuleFilterStateTOcontainer(this.container,ZP5Views.getkey(this.viewObject.getViewId(),"FState"),!1),ZP5Views.setModuleFilterValuesTOcontainer(this.container,t,{...e})}}checkValuesHaschange(e,t){let i;for(let r in t){i=!1;for(let s in e)if(r==s&&(i=!0,t[r].toString()!=e[s].toString()))return!0;if(!i)return!0}return!1}constructFieldFilterParams(e,t,i){let r,s=[];$(this.container).find("#fieldFilterContainer").find("[id=filterfields]").find("input[type=checkbox]").each(((e,t)=>{if($(t).is(":checked")){let e=this.getSearchValueForFields(t);$(t).parent().find("#filterOptions").find("#searchError").length>0?null==r&&(r=$(t).parent()):s.push(e)}})),null!=r?($(r)[0].scrollIntoView({behavior:"smooth"}),i.push("error")):s.length>0&&(e.push("searchBy"),t.push(JSON.stringify(s)))}getSearchValueForFields(e,t){let i,r=$(e).attr("parentfield"),s=$(e).attr("fcid");null!=r||null!=r?(i=ZP5Views.getFieldDetails(this.getViewSearchAllowedFields(),"parentfield",r,s),s=i.formComponentId+"_"+r):i=ZP5Views.getFieldDetails(this.getViewSearchAllowedFields(),"id",s);let a=!1,n=!1,o=i.fieldType;null!=i.refTableName&&(-1==i.labelName.indexOf(".")?a=!0:null!=i.isRelatedCol&&i.isRelatedCol&&(n=!0));let l,d=ZPeopleComponents.select($(e).parent().find("#filterOptions").find("select")).getValue(),p=this.isDisable(d),m=i.labelName,c=ZPeople.escapeHtml($(e).parent().find("#filterOptions").find("#inputfieldId"+s).val());if(d==FormConstants.Criteria.OPERATORS.ONLY_PARTICULAR_MONTH&&(c=ZPeopleComponents.select($(e).parent().find("#filterOptions").find("#inputfieldId"+s)).getValue()),ZP5Views.currViewModuleHandler.getIsSpecialHandlingForFilter(m)){p=!0;var u=ZP5Views.currViewModuleHandler.getSearchValueForFieldsFromModules(m,d);c=u.value,d=u.operator}let g={};if(!p)if(o!=FormConstants.FieldType.PICKLIST&&!a&&!n||d!=FormConstants.Criteria.OPERATORS.EQUAL&&d!=FormConstants.Criteria.OPERATORS.NOT_EQUAL&&d!=FormConstants.Criteria.OPERATORS.CONTAINS)o==FormConstants.FieldType.DATE?d==FormConstants.Criteria.OPERATORS.ONLY_PARTICULAR_MONTH?c=ZPeopleComponents.select($(e).parent().find("#filterOptions").find("#inputfieldId"+s)).getValue():(c=ZPeopleComponents.datefield($(e).parent().find("#filterOptions").find("#inputfieldId"+s)).getValue().dateString,d==FormConstants.Criteria.OPERATORS.BETWEEN&&(l=ZPeopleComponents.datefield($(e).parent().find("#filterOptions").find("#betweenId"+s)).getValue().dateString)):o==FormConstants.FieldType.DATE_TIME?(c=ZPeopleComponents.datetimefield($(e).parent().find("#filterOptions").find("#inputfieldId"+s)).getValue().dateString,d==FormConstants.Criteria.OPERATORS.BETWEEN&&(l=ZPeopleComponents.datetimefield($(e).parent().find("#filterOptions").find("#betweenId"+s)).getValue().dateString)):d==FormConstants.Criteria.OPERATORS.BETWEEN&&(l=$(e).parent().find("#filterOptions").find("#betweenId"+s).val());else{c="";let t=[],i=[],r="ID",a="DISPVALUE";o!=FormConstants.FieldType.PICKLIST&&(r="Id",a="Value");let n=ZPeopleComponents.tokenfield($(e).parent().find("#filterOptions").find("#tokenfieldId"+s)).getAllValues();if(n.length>0){for(let e=0;e<n.length;e++)""!=c.trim()&&(c+=";"),t.push(ZPeople.escapeHtml(n[e][r])),c+=ZPeople.escapeHtml(n[e][a]),d==FormConstants.Criteria.OPERATORS.CONTAINS&&(n[e][r]==n[e][a]?i.push(0):i.push(1));g[m+"_ids"]=t,d==FormConstants.Criteria.OPERATORS.CONTAINS&&(g[m+"_idFlag"]=i)}}if((t||p||null!=c&&""!=c.trim())&&(d!=FormConstants.Criteria.OPERATORS.BETWEEN||null!=l&&""!=l.trim())){let r=!0;if(p||t||a&&-1!=[FormConstants.Criteria.OPERATORS.EQUAL,FormConstants.Criteria.OPERATORS.NOT_EQUAL].indexOf(parseInt(d))||(r=this.validateValuesForFilter(o,c,l,$(e).parent().find("#filterOptions"),i)),r)return c=null!=l?c+";"+l:c,$(e).parent().find("#filterOptions").find("#searchError").remove(),g[m]=c,g[m+"_op"]=d,g}else{let t=ZPI18N.getString("zp.searchvaluescannotbeempty");this.errorMsg($(e).parent().find("#filterOptions"),t)}}validateValuesForFilter(e,t,i,r,s){let a=!0,n=ZPI18N.getString("zp.entervalidinput");if(e==FormConstants.FieldType.NUMBER)ZPUtil.Validation.isNumber(t)&&(null==i||ZPUtil.Validation.isNumber(i))||(a=!1,this.errorMsg(r,n));else if(e==FormConstants.FieldType.DATE)ZPUtil.Validation.isDate(t)&&(null==i||ZPUtil.Validation.isDate(i))||(a=!1,this.errorMsg(r,n));else if(e==FormConstants.FieldType.DATE_TIME)ZPUtil.Validation.isDateTime(t)&&(null==i||ZPUtil.Validation.isDateTime(i))||(a=!1,this.errorMsg(r,n));else if(e==FormConstants.FieldType.DECIMAL||e==FormConstants.FieldType.CURRENCY){let e=new Array;e[0]=t,null!=i&&(e[1]=i),$.each(e,((e,t)=>{var i=ZPUtil.Validation.isDecimalForView(t);i&&void 0===i.errorCode||(a=!1)})),a||this.errorMsg(r,n)}else if(e==FormConstants.FieldType.SCRIPT){let e=s.formulaDtype;if(e==FormConstants.FieldType.NUMBER)ZPUtil.Validation.isNumber(t)&&(null==i||ZPUtil.Validation.isNumber(i))||(a=!1,this.errorMsg(r,n));else if(e==FormConstants.FieldType.DECIMAL){let e=new Array;e[0]=t,null!=i&&(e[1]=i),$.each(e,((e,t)=>{var i=ZPUtil.Validation.isDecimalForView(t);i&&void 0===i.errorCode||(a=!1)})),a||this.errorMsg(r,n)}}return a}errorMsg(e,t){$(e).parent().find("#filterOptions").find("#searchError").remove(),0==$(e).find("#searchError").length&&$(e).append('<span class="ztextbox--error__label" id = "searchError">'+t+"</span>")}getOptionTextFromList(e,t){return ZP5Views.ALL_OPTIONS[e][t]}getOptionText(e,t){for(let i=0;i<t.length;i++)if(e==t[i].value)return t[i].label}getSearchModifiedUrl(e,t){let i={};if(e.length>0)for(let r=0;r<e.length;r++)i[e[r]]=t[r];this.getViewClassObj().urlParamsArr={...this.getViewClassObj().urlParamsArr,...i}}handleFilterSearch(e){let t=$(e.target),i=$(t).val();if(this.container.find("#filterContainer").find("div[id=norec]").remove(),null!=i){i=""!=i.trim()?i.toUpperCase():"";let e=this.handleSystemFilterSearch(i);e?this.container.find("#systemFilterContainer").removeClass("DN"):this.container.find("#systemFilterContainer").addClass("DN");let t=this.handleFieldFilterSearch(i);t?this.container.find("#fieldFilterContainer").removeClass("DN"):this.container.find("#fieldFilterContainer").addClass("DN"),e||t||this.container.find("#systemFilterContainer").parent().before("<div id=norec class='zpl_Emptydata'><div class='zpl_secn'><p>"+ZPI18N.getString("zp.norec")+"</p></div></div>")}}handleSystemFilterSearch(e){let t=!1;if(this.isSystemFilterNeeded()){let i="";if(this.isEmployeeGroupFilterNeeded()){this.isEmployeeStatusFilterNeeded()&&(i=ZPI18N.getString("zp.employeestatus").toUpperCase(),i.indexOf(e)>-1?(t=!0,this.container.find("#systemFilterContainer").find("#employeeStatusFilter").removeClass("DN")):this.container.find("#systemFilterContainer").find("#employeeStatusFilter").addClass("DN"));let r=this.container.find("#systemFilterContainer").find("#employeeSearchFilter");if(r)if(i=ZPI18N.getString("zp.employee").toUpperCase(),i.indexOf(e)>-1==!0)t=!0,r.removeClass("DN");else r.addClass("DN");this.isOrgstructureFilterRestricted()||(ZPeople.orgStructureTagMap.hasOwnProperty("entity")&&ZPeople.orgStructureTagMap.entity&&(i=ZP5Views.getOrgStructureFieldDisplayName("entity",!0).toUpperCase(),i.indexOf(e)>-1?(t=!0,this.container.find("#systemFilterContainer").find("#entityFilter").removeClass("DN")):this.container.find("#systemFilterContainer").find("#entityFilter").addClass("DN")),ZPeople.orgStructureTagMap.hasOwnProperty("unit")&&ZPeople.orgStructureTagMap.unit&&(i=ZP5Views.getOrgStructureFieldDisplayName("unit",!0).toUpperCase(),i.indexOf(e)>-1?(t=!0,this.container.find("#systemFilterContainer").find("#unitFilter").removeClass("DN")):this.container.find("#systemFilterContainer").find("#unitFilter").addClass("DN")),ZPeople.orgStructureTagMap.hasOwnProperty("division")&&ZPeople.orgStructureTagMap.division&&(i=ZP5Views.getOrgStructureFieldDisplayName("division",!0).toUpperCase(),i.indexOf(e)>-1?(t=!0,this.container.find("#systemFilterContainer").find("#divisionFilter").removeClass("DN")):this.container.find("#systemFilterContainer").find("#divisionFilter").addClass("DN")),(!isOrgStructureEnabled||ZPeople.orgStructureTagMap.hasOwnProperty("department")&&ZPeople.orgStructureTagMap.department)&&(i=ZP5Views.getOrgStructureFieldDisplayName("department",!0).toUpperCase(),i.indexOf(e)>-1?(t=!0,this.container.find("#systemFilterContainer").find("#departmentFilter").removeClass("DN")):this.container.find("#systemFilterContainer").find("#departmentFilter").addClass("DN")),i=ZP5Views.getOrgStructureFieldDisplayName("locid",!0).toUpperCase(),i.indexOf(e)>-1?(t=!0,this.container.find("#systemFilterContainer").find("#locationFilter").removeClass("DN")):this.container.find("#systemFilterContainer").find("#locationFilter").addClass("DN"));let s=this.container.find("#systemFilterContainer").find("#employee_org_Tag");if(s&&ZP5Views.orgTag)if(i=ZP5Views.getOrgStructureFieldDisplayName("orgTag",!0).toUpperCase(),i.indexOf(e)>-1==!0)t=!0,s.removeClass("DN");else s.addClass("DN")}if(this.isApprovalFilterNeeded()&&(i=ZPI18N.getString("zp.approvalstatus").toUpperCase(),i.indexOf(e)>-1?(t=!0,this.container.find("#systemFilterContainer").find("#approvalFilter").removeClass("DN")):(this.container.find("#systemFilterContainer").find("#approvalFilter").addClass("DN"),this.container.find("#systemFilterContainer").find("#approverFilter").addClass("DN"))),ZP5Views.currViewFilterModuleHandler.needModuleSystemFilter()){let i=this.container.find("#systemFilterContainer").find("[id=moduleId]");for(let r of i){$(r).find("label").text().toUpperCase().indexOf(e)>-1?(t=!0,$(r).removeClass("DN")):$(r).addClass("DN")}}}return t}handleFieldFilterSearch(e){let t=!1,i=this.getViewSearchAllowedFields();for(let r=0;r<i.length;r++){let s=i[r].displayName.toUpperCase();s=ZPeople.checkHTML(s)?s:ZPeople.decodeTxt(s);let a=i[r].labelName;if(s.indexOf(e)>-1)t=!0,$(this.container).find("#fieldFilterContainer").find("[id=filterfields][labelname='"+a+"']").removeClass("DN");else{if($(this.container).find("#fieldFilterContainer").find("[id=filterfields][labelname='"+a+"']").find("input[type=checkbox]").is(":checked")){let e=$(this.container).find("#fieldFilterContainer").find("[id=filterfields][labelname='"+a+"']").find("input[type=checkbox]"),t=this.getSearchValueForFields(e,!0);null!=t[a]&&""!=t[a].trim()||this.isDisable(t[a+"_op"])||this.resetSpecificFieldFilter(e)}$(this.container).find("#fieldFilterContainer").find("[id=filterfields][labelname='"+a+"']").addClass("DN")}}return t}resetFieldFilters(){$(this.container).find("#fieldFilterContainer").find("[id=filterfields]").find("input[type=checkbox]").each(((e,t)=>{$(t).is(":checked")&&this.resetSpecificFieldFilter(t)}))}resetSpecificFieldFilter(e){let t=$(e).parent().attr("labelname"),i=ZP5Views.getFieldDetails(this.getViewSearchAllowedFields(),"labelName",t),r=i.fieldType;r==FormConstants.FieldType.SCRIPT&&(r=i.formulaDtype),"P_Employee"!=ZP5Views.zp5formgetFormsOp.getTableName()&&"P_Employee"!=i.refTableName||"AGE"!=i.columnName&&"EXPERIENCE"!=i.columnName||(r=FormConstants.FieldType.NUMBER);let s=this.getDefaultOperType(r);ZPeopleComponents.select($(e).parent().find("#filterOptions").find("select")).setValue(s),$(e).parent().find("input[type=checkbox]").removeAttr("checked"),$(e).parent().find("#filterOptions").slideToggle()}}if(showNewTab)var ZPView={formsAndViewsCallback:()=>{if(Layout.UrlConf.isModuleForm())ZP5Views.setCurrentViewModuleHandler(),ZP5Views.currViewModuleHandler.checkAndCallOldCallBack();else if(Layout.UrlConf.isFormActionURL("bulkupload")||Layout.UrlConf.isFormActionURL("import")||Layout.UrlConf.isFormActionURL("photoupload")){var e={data:{viewObj:ZP5Views.getCurrViewObj()}};Layout.UrlConf.isFormActionURL("import")?ZP5Import.init():BulkFileUpload.init(e)}else if(Layout.UrlConf.isFormActionURL("add")||Layout.UrlConf.isFormActionURL("edit")||Layout.UrlConf.isFormActionURL("view")){let e={formId:Layout.Page.urlparam.formId,formMode:"ADD"};-1!==Layout.Page.hash.indexOf("/edit")?(e.formMode="EDIT",e.recordId=Layout.Page.childUrlParam.recordId):-1!==Layout.Page.hash.indexOf("/view")&&(e.formMode="VIEW",e.recordId=Layout.Page.childUrlParam.recordId),ZPForm.load(e)}else ZP5Views.callback()},init:e=>{ZP5Views.callback()},constructViews:()=>{ZP5Views.callback()},handleTablePosition:()=>{},mapConstruction:(e,t)=>{ZP5Views.mapconstruction(t)}};class ViewsModuleHandler{constructor(e){if(new.target===ViewsModuleHandler)throw new Error("Views Module Handler is an abstract class and it cannot be instantiated");let t=e.moduleName,i=!e.isCustomForm||e.isCustomForm,r=e.tableName,s=!!e.isModuleForm&&e.isModuleForm;this.getIsCustomForm=()=>i,this.getModuleName=()=>t,this.getTableName=()=>r,this.getIsModuleForm=()=>s}getIsSpecialHandlingForFilter(e){return!1}getIsModuleForm(){return UrlProps.isModuleForm()}getIsMultiSelectedNeeded(){return!0}onchangeCallback(){}initialCallBack(){}getPageType(){return settingsUrlProps.niceUrlArr[1]}getViewTypeBasedOnPage(){if(!ZPUtil.isV5SettingsUrl()){let e=ZPeople.Module.getData();switch(this.getPageType()){case"team":return"dirsub";case"mydata":return"self";case"organization":return 3==e.formDetailsMap.viewPerm?"all":"other_data";default:return isadmin?"mydep":FormConstants.Permission.VIEW_SELECT_VALUE[e.formDetailsMap.viewPerm]}}}getIsOnlyReportees(){let e=!1;return ZPUtil.isV5SettingsUrl()||"team"!=settingsUrlProps.niceUrlArr[1]||(e=!0),e}showMyTeamData(){return!1}showAllData(){return!1}getIsViewTypeNeeded(){let e=!0;return ZPUtil.isV5SettingsUrl()||"mydata"!=settingsUrlProps.niceUrlArr[1]||(e=!1),e}isDeleteButtonNeed(){return!0}isAddButtonNotNeed(){return!ZP5Views.zp5formgetFormsOp.isOperationalRoleAdmin()&&(0===ZP5Views.zp5formgetFormsOp.getAddPerm()||4===ZP5Views.zp5formgetFormsOp.getAddPerm()&&0===ZPeople.getSubUsers().length)&&(null==ZP5Views.zp5formgetFormsOp.isAdditonalPermAdd()||!ZP5Views.zp5formgetFormsOp.isAdditonalPermAdd())||"P_EmployeeLeave"==ZP5Views.zp5formgetFormsOp.getTableName()||"P_Goals"==ZP5Views.zp5formgetFormsOp.getTableName()||"P_MultiRater"==ZP5Views.zp5formgetFormsOp.getTableName()||"P_MultiRater_Approval"==ZP5Views.zp5formgetFormsOp.getTableName()||"P_EmployeeHealthData"==ZP5Views.zp5formgetFormsOp.getTableName()||"P_VaccinationStatus"==ZP5Views.zp5formgetFormsOp.getTableName()||"P_Employee"==ZP5Views.zp5formgetFormsOp.getTableName()&&!ZPUtil.isV5SettingsUrl()}getAddButtonText(e,t){switch(e){case"P_Department":return ZPI18N.getString("zp.manageadddept");case"P_Designation":return ZPI18N.getString("zp.adddesg");case"P_Employee":return ZPI18N.getString("zp.addemployee(s)");default:return t||ZPI18N.getString("zp.addrecord")}}isFormActionAllowed(e){return!1}getFieldFilterDefaultOperator(e){}getfilterParamFromModule(e,t){return t[e+"_op"]}getNODataClass(){return"zpl_Emptydata zpl_crd zpl_Empdatafxd"}getViewModuleAdditionalParam(){return""}isCreateViewAllowed(){return!0}isSystemFiltersNeeded(){return!0}callAddRecordmethod(e){if("P_Employee"===e)Users.common.otherUsersCallback({closeCallback:e=>{e&&ZP5Views.refreshview(!0)}});else ZP5Form.showForm("add")}needPreHandlings(){return!0}getViewFilterModuleHandler(){return new defaultFilterModuleHandler}neddModuleSpecialField(){return!1}getNodataMsg(){return ZP5Views.currViewRecObj.message}getHeaderThHtml(e){return"<th id="+e.key+"><div><span>"+e.text+"</span></div></th>"}isEditRestricted(){return!1}isAddTaskRestricted(){return!1}getModuleHandlerFiles(){return[]}loadModuleHandlerFiles(){let e=this.getModuleHandlerFiles();e.length>0&&Layout.PageUtil.loadFiles(e,(()=>{}))}setModuleProps(e,t){return e}getRecordFetchUrl(){return ZP5Views.url}isExportNeeded(){return!0}isUserViewCompNeeded(){return!0}IsSinglerecViewNeed(){return!0}getTotalCountParams(e){return{mode:"getRecordCount",formId:e.getFormId(),viewId:e.getViewId()}}isUrlRefresh(){return!0}getImageHTML(e){return'<div class="zpl_em"><div class="zpl_emimg">'+e+"</div></div>"}getTotalCountFetchUrl(){return ZP5Views.url}isModeNeed(){return!0}}class NonModuleFormsViewHandler extends ViewsModuleHandler{constructor(e){super(e={...e,moduleName:"forms"})}getFormId(){return ZP5Views.getCurrViewObj().formId}getOperationsHash(){let e=Layout.Page.hashDtl.hashArr,t=e.length,i=e[t-2];Layout.Page.hashDtl.formLabelName&&(i=Layout.Page.hashDtl.formLabelName);let r=e[t-3];return Layout.Page.hashDtl.tabAliasName&&(r=Layout.Page.hashDtl.tabAliasName),"operations/"+r+"/"+i+"/listview"}}var ZPViewsHolder={empSearchDetails:{},systemFilterResults:{},FILTER_OPTIONS:{},viewFormClassMap:{},currViewHandler:void 0,setCurrViewHandler:e=>(ZPViewsHolder.currViewHandler=e,ZPViewsHolder.currViewHandler),getCurrViewHandler:()=>ZPViewsHolder.currViewHandler,resetCurrentViewHandler:()=>{ZPViewsHolder.currViewHandler=void 0},isOnLoad:e=>!ZPViewsHolder.viewFormClassMap.hasOwnProperty(e),filterClassObjMap:{},getFieldFilterOptions:(e,t,i,r)=>{let s=e.labelName,a=!1,n=[],o=!1,l=e.fieldType;return null!=e.refTableName&&(-1==s.indexOf(".")?a=!0:null!=e.isRelatedCol&&e.isRelatedCol&&(o=!0)),a||l!=FormConstants.FieldType.SCRIPT||(l=e.formulaDtype),"P_Employee"!=t&&"P_Employee"!=e.refTableName||"AGE"!=e.columnName&&"EXPERIENCE"!=e.columnName||(l=FormConstants.FieldType.NUMBER),20!==l&&(e.isEncrypted?ZPViewsHolder.addJsonObjectToList(n,FormConstants.Criteria.OPERLIST.ENCRYPTED,l):l!==FormConstants.FieldType.CHECK_BOX?i?ZPViewsHolder.addJsonObjectToList(n,r,l):l===ZP5Form.Field.TIME?ZPViewsHolder.addJsonObjectToList(n,FormConstants.Criteria.OPERLIST.TIME,l):l===FormConstants.FieldType.FILE_UPLOAD?ZPViewsHolder.addJsonObjectToList(n,FormConstants.Criteria.OPERLIST.DEFAULT,l):(l!==FormConstants.FieldType.AUTONUMBER?(ZPViewsHolder.addJsonObjectToList(n,FormConstants.Criteria.OPERLIST.SEARCHABLE,l),ZPViewsHolder.addJsonObjectToList(n,FormConstants.Criteria.OPERLIST.DEFAULT,l)):ZPViewsHolder.addJsonObjectToList(n,FormConstants.Criteria.OPERLIST.AUTO_NUMBER,l),l!==FormConstants.FieldType.DATE&&l!==FormConstants.FieldType.FORMULA_DATE&&l!==FormConstants.FieldType.DATE_TIME||(ZPViewsHolder.addJsonObjectToList(n,FormConstants.Criteria.OPERLIST.DAYS,l,ZPI18N.getString("zp.cday",[""])),ZPViewsHolder.addJsonObjectToList(n,FormConstants.Criteria.OPERLIST.YEAR,l,ZPI18N.getString("zp.year",[""]))),l===FormConstants.FieldType.DATE||l===FormConstants.FieldType.FORMULA_DATE?ZPViewsHolder.addJsonObjectToList(n,FormConstants.Criteria.OPERLIST.MONTH_WITH_ONLY,l,ZPI18N.getString("zp.month",[""])):l===FormConstants.FieldType.DATE_TIME||l===FormConstants.FieldType.FORMULA_DATE?ZPViewsHolder.addJsonObjectToList(n,FormConstants.Criteria.OPERLIST.MONTH,l,ZPI18N.getString("zp.month",[""])):l!==FormConstants.FieldType.NUMBER&&l!==FormConstants.FieldType.DECIMAL&&l!==FormConstants.FieldType.CURRENCY||ZPViewsHolder.addJsonObjectToList(n,FormConstants.Criteria.OPERLIST.NUMERIC,l)):ZPViewsHolder.addJsonObjectToList(n,FormConstants.Criteria.OPERLIST.BOOLEAN,l)),{options:n}},getDefaultOperType:e=>{let t=FormConstants.Criteria.OPERATORS.CONTAINS;return(e.fieldType===FormConstants.FieldType.NUMBER||e.fieldType===FormConstants.FieldType.DECIMAL||e.fieldType===FormConstants.FieldType.CURRENCY||e.fieldType===FormConstants.FieldType.DATE||e.fieldType===FormConstants.FieldType.DATE_TIME||e.fieldType===ZP5Form.Field.TIME||e.fieldType===FormConstants.FieldType.FORMULA_DATE||e.fieldType===FormConstants.FieldType.AUTONUMBER||e.fieldType===FormConstants.FieldType.SCRIPT||e.isEncrypted)&&(t=FormConstants.Criteria.OPERATORS.EQUAL),e.fieldType===FormConstants.FieldType.CHECK_BOX&&(t=FormConstants.Criteria.OPERATORS.TRUE),e.fieldType===FormConstants.FieldType.FILE_UPLOAD&&(t=FormConstants.Criteria.OPERATORS.EMPTY),t},addJsonObjectToList:(e,t,i,r)=>{let s=!1;i!==FormConstants.FieldType.NUMBER&&i!==FormConstants.FieldType.DECIMAL&&i!==FormConstants.FieldType.CURRENCY&&i!==FormConstants.FieldType.DATE&&i!==FormConstants.FieldType.DATE_TIME&&i!==ZP5Form.Field.TIME&&i!==FormConstants.FieldType.FORMULA_DATE&&i!==FormConstants.FieldType.AUTONUMBER||(s=!0);for(let a in t){if(a==FormConstants.Criteria.OPERATORS.BETWEEN&&!s||(a==FormConstants.Criteria.OPERATORS.STARTS_WITH||a==FormConstants.Criteria.OPERATORS.ENDS_WITH||a==FormConstants.Criteria.OPERATORS.CONTAINS||a==FormConstants.Criteria.OPERATORS.NOT_CONTAINS||a==FormConstants.Criteria.OPERATORS.LIKE)&&s&&i!=FormConstants.FieldType.AUTONUMBER)continue;if("69"===a&&i===FormConstants.FieldType.FORMULA_DATE)continue;let n={};n.id=a,n.name=ZPI18N.getString(t[a],[""]),null!=r&&(n.group=r),e.push(n)}},isFilterOperDisable:e=>e!=FormConstants.Criteria.OPERATORS.EQUAL&&e!=FormConstants.Criteria.OPERATORS.NOT_EQUAL&&e!=FormConstants.Criteria.OPERATORS.STARTS_WITH&&e!=FormConstants.Criteria.OPERATORS.ENDS_WITH&&e!=FormConstants.Criteria.OPERATORS.CONTAINS&&e!=FormConstants.Criteria.OPERATORS.NOT_CONTAINS&&e!=FormConstants.Criteria.OPERATORS.LIKE&&e!=FormConstants.Criteria.OPERATORS.BETWEEN&&e!=FormConstants.Criteria.OPERATORS.LESS_THAN&&e!=FormConstants.Criteria.OPERATORS.GREATER_THAN&&e!=FormConstants.Criteria.OPERATORS.LESS_EQUAL&&e!=FormConstants.Criteria.OPERATORS.GREATER_EQUAL&&e!=FormConstants.Criteria.OPERATORS.ONLY_PARTICULAR_MONTH,isPageDataChanged:(e,t,i,r)=>{let s=e.split("/"),a=s[s.length-2],n=s[0],o=s[1],l=t.split("/"),d=l[l.length-2],p=l[0],m=l[1];a==d&&n==p&&o==m||ZPViewsHolder.getCurrViewHandler().resetPage()},getFilterClassObj:(e,t)=>(!ZPViewsHolder.filterClassObjMap.hasOwnProperty(e)&&t&&(ZPViewsHolder.filterClassObjMap[e]=ZPViewsHolder.getCurrViewHandler().getFilterObj()),ZPViewsHolder.filterClassObjMap[e]),getViewTypeBasedOnPage:e=>{if(!ZPUtil.isV5SettingsUrl()){let t=settingsUrlProps.niceUrlArr[1];if("team"==t)return e?"sub":"dirsub";if("mydata"==t||"myspace"==t)return"self";if(isadmin)return"mydep";{let e=ZPeople.Module.getData().formDetailsMap.viewPerm;if(FormConstants.Permission.VIEW_SELECT_VALUE[e])return FormConstants.Permission.VIEW_SELECT_VALUE[e]}}},refreshAllViews:()=>{ZPViewsHolder.currViewHandler.refreshViewFromOutSide(!0)},checkIsViewAlreadyLoaded:()=>{let e=ZPeople.Module.getData();return!!e[Layout.Page.pageId]||(e[Layout.Page.pageId]=!0,!1)},setEmpSearchDet:e=>{e.filter((e=>!ZPViewsHolder.empSearchDetails.hasOwnProperty(e.Id))).map((e=>{ZPViewsHolder.empSearchDetails[e.Id]={name:e.Value,image:e.Image}}))},checkIfUserDataNeeded:e=>e.filter((e=>!ZPViewsHolder.empSearchDetails.hasOwnProperty(e))).length>0,getOptionsForEmpFilter:e=>e.map((e=>ZPViewsHolder.empSearchDetails[e])),getLatestFormViewUrl:e=>{let t="";for(let e=0;e<settingsUrlProps.niceUrlArr.length-1;e++)0!=e&&(t+="/"),t+=settingsUrlProps.niceUrlArr[e];if(e||(t+="/listview"),ZPViewsHolder.currViewHandler){let e=ZPViewsHolder.currViewHandler.getViewFilterParams();""!=e.trim()&&(t=t+"-"+e)}return t}};class viewFilterModuleHandler{constructor(e){if(new.target===viewFilterModuleHandler)throw new Error("ViewFilter Module Handler is an abstract class and it cannot be instantiated")}needModuleSystemFilter(){return!1}getModuleSystemFilter(){return[]}ModuleFiltercallback(e){return""}setModuleFilterValues(e){return""}fetOptionFromSer(e){return!1}getBreadCrumbsHTML(e){return""}getDefaultEmpStatus(){return"activeemprecord"}}class defaultFilterModuleHandler extends viewFilterModuleHandler{constructor(e){super(e)}}var ZP5ViewsCommon={getViewsModuleHandler:e=>{let t;if(null!=e)t=e;else{t="custom";let e=ZPeople.Module.getData();if(e&&e.formDetailsMap&&e.formDetailsMap.tableName&&(t=e.formDetailsMap.tableName),e&&e.formDetailsMap&&4==e.formDetailsMap.formType)return ViewsModuleHandlerObject.getClearanceFormViewHandler();if(e&&e.formDetailsMap&&5==e.formDetailsMap.formType)return ViewsModuleHandlerObject.getInterviewFormViewHandler()}let i=ZP5ViewsCommon.getSpecificModuleHandler(t);return i.loadModuleHandlerFiles(),i},getSpecificModuleHandler:e=>{switch(e){case"P_TimesheetJob":return ViewsModuleHandlerObject.getTimeTrackerJobsFormViewHandler();case"P_TimesheetJobsList":return ViewsModuleHandlerObject.getTimeTrackerProjectsFormViewHandler();case"P_ClientDetails":return ViewsModuleHandlerObject.getTimeTrackerClientsFormViewHandler();case"P_EmployeeLeave":return ViewsModuleHandlerObject.getLeaveApplicationFormViewHandler();case"P_EmployeeSalaryTemplate":return ViewsModuleHandlerObject.getCompensationSalaryFormViewHandler();case"P_SalaryRevision":return ViewsModuleHandlerObject.getCompensationSalaryRevisionFormViewHandler();case"P_EmployeeSalary":return ViewsModuleHandlerObject.getPerformanceSalaryFormViewHandler();case"P_Task":return ViewsModuleHandlerObject.getTaskOperationFormViewHandler();case"P_Candidate":return ViewsModuleHandlerObject.getCandidateFormViewHandler();case"P_Workplace_Readiness":return ViewsModuleHandlerObject.getWorkplaceReadinessFormViewHandler();case"P_Visitor":return ViewsModuleHandlerObject.getVisitorFormViewHandler();case"P_OfficeBuildings":return ViewsModuleHandlerObject.getPremisesFormViewHandler();case"P_MultiRaterFeedback":return ViewsModuleHandlerObject.getMRFeedbackViewHandler();case"P_Goals":return ViewsModuleHandlerObject.getGoalViewHandler();case"P_MultiRater":return ViewsModuleHandlerObject.getMultiRaterViewHandler();case"P_Resignation":return ViewsModuleHandlerObject.getResignationFormViewHandler();case"P_Termination":return ViewsModuleHandlerObject.getTerminationFormViewHandler();case"P_Deceased":return ViewsModuleHandlerObject.getDeceasedFormViewHandler();case"P_Employee":return ViewsModuleHandlerObject.getEmployeeViewHandler();case"RecycleBin":return ViewsModuleHandlerObject.getRecycleBinViewHandler();case"P_OfferLetter":return ViewsModuleHandlerObject.getOfferLetterViewHandler();case"P_AppointmentLetter":return ViewsModuleHandlerObject.getAppointmentLetterViewHandler();default:return ViewsModuleHandlerObject.getNonModuleFormViewHandler()}}};class ModuleFormsViewsHandler extends ViewsModuleHandler{constructor(e){if(new.target===ModuleFormsViewsHandler)throw new Error("Module Forms Views Handler is an abstract class and it cannot be instantiated");super(e={...e,isModuleForm:!0})}getPageType(){return super.getPageType()}}class TimeTrackerFormsViewHandler extends ModuleFormsViewsHandler{constructor(e){if(new.target===TimeTrackerFormsViewHandler)throw new Error("TimeTracker Module Handler is an abstract class and it cannot be instantiated");super(e={...e,moduleName:"timeTracker"}),this.initBaseCallBack()}initBaseCallBack(){Timetracker.initSetup(),Timetracker.forms.setFormDisplayName(),TimetrackerOperations.init(),Timetracker.permissionCheckForOperPages()&&(Timetracker.jobs.pageLayout=settingsPage.container,Timetracker.jobs.isFromOperations=!0)}onchangeCallback(e){Timetracker.views.customViewActions(e)}importExportConstructionCallback(){Timetracker.ImportExport.constructImportExportContainer()}checkAndCallOldCallBack(){ZPView.init()}getIsSpecialHandlingForFilter(e){var t=ZP5Views.zp5formgetFormsOp.getTableName();return Timetracker.views.isTimetrackerSpecialFields(t,e)}getFieldFilterOptionFromModules(e){return Timetracker.views.getOperType(e)}getSearchValueForFieldsFromModules(e,t){return Timetracker.views.getValueForField(e,t)}showSearchParamsFromModules(e,t,i){if("Attachment"==e)return{operType:i=i||"30",value:""};var r=Timetracker.views.getOperType(e);return{operType:"18",value:ZPI18N.getString(r[t])}}getFieldFilterDefaultOperator(e){return"Attachment"==e?"29":"Status"===e||"IsCompleted"===e||"BillableStatus"===e||"Billing_Method"===e?"0":void 0}getfilterParamFromModule(e,t){return"Attachment"==e?t[e+"_op"]:t[e]}isSystemFiltersNeeded(){return!1}getExtraParamForFetch(){return{employeeStatus:"all"}}showMyTeamData(){return!0}showAllData(){return Timetracker.generalSettings.isShowFormsAllData()}}class TimeTrackerJobsFormViewHandler extends TimeTrackerFormsViewHandler{constructor(e){super(e),this.systemViewName=ZPeople.decodeTxt(Timetracker.util.jobDispName)}getFormId(){return Timetracker.jobs.formDetails.formId}dataCallback(){Timetracker.jobs.Listing.initSchedule()}getAddButtonText(){return ZPI18N.getString("zp.addcomponents",[ZPeople.decodeTxt(Timetracker.util.getJobDisplayName(!0))])}recDeleteCallback(e,t){Timetracker.views.multiSelectActions.deleteBulkWarning(e,t,"P_TimesheetJob")}isFormActionAllowed(){return!1}getViewModuleAdditionalParam(){return Timetracker.Page.isSelectedUser()?"userId:"+Timetracker.Team.getSelectedUser():""}getOperationsHash(){return"operations/timetracker/jobs/listview"}}class TimeTrackerProjectsFormViewHandler extends TimeTrackerFormsViewHandler{constructor(e){super(e),this.systemViewName=ZPeople.decodeTxt(Timetracker.util.projectDispName)}getFormId(){return Timetracker.projects.formDetails.formId}dataCallback(){Timetracker.projects.Listing.initProjectList()}getAddButtonText(){return ZPI18N.getString("zp.addcomponents",[ZPeople.decodeTxt(Timetracker.util.getProjectDisplayName(!0))])}recDeleteCallback(e,t){Timetracker.views.multiSelectActions.deleteBulkWarning(e,t,"P_TimesheetJobsList")}isFormActionAllowed(){return!0}getViewModuleAdditionalParam(){return Timetracker.Page.isSelectedUser()?"userId:"+Timetracker.Team.getSelectedUser():""}getOperationsHash(){return"operations/timetracker/projects/listview"}}class TimeTrackerClientFormViewHandler extends TimeTrackerFormsViewHandler{constructor(e){super(e),this.systemViewName=ZPeople.decodeTxt(Timetracker.util.clientDispName)}getFormId(){return Timetracker.clients.formDetails.formId}dataCallback(){Timetracker.clients.initClientList()}getAddButtonText(){return ZPI18N.getString("zp.addcomponents",[ZPeople.decodeTxt(Timetracker.util.getClientDisplayName(!0))])}recDeleteCallback(e,t){Timetracker.views.multiSelectActions.deleteBulkWarning(e,t,"P_ClientDetails")}isFormActionAllowed(){return!0}getViewModuleAdditionalParam(){return Timetracker.Page.isSelectedUser()?"userId:"+Timetracker.Team.getSelectedUser():""}getOperationsHash(){return"operations/timetracker/clients/listview"}}class LeaveApplicationFormViewHandler extends ModuleFormsViewsHandler{constructor(e){super(e={...e,moduleName:"leaveTracker",onChangeCallBack:LeaveApplicationListing.prepareView}),this.initBaseCallBack(),this.systemViewName=ZPeople.decodeTxt(ZPeople.Module.MODULE_DATA.leavetracker.formDisplayName)}getFormId(){return ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.formid}initBaseCallBack(){LeaveAdminOpers.initComponents()}dataCallback(){(null==LeaveApplications.refresh||LeaveApplications.refresh)&&(!settingsPage.container.data("isreg")&&LeaveAdminOpers.initComponents(),LeaveApplications.View.get())}onchangeCallback(e){LeaveApplicationListing.prepareView(e)}recDeleteCallback(e,t){LeaveApplicationListing.deleteBulkWarning(e,t)}isLeaveAdmin(){var e="leavetracker",t=ZPeople.Module.MODULE_DATA[e];if(void 0!==t)return(t=t.leave_filterops).isSPOCLvViewEnabled}getSystemViewOptHTMLObj(){var e={},t=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops;if(null!=t){var i="<option value='"+t.viewId+"'>"+t.formdisplayName+"</option>";e.sysViewOptHTML=i,e.viewId=t.viewId}return e}getFormId(){return ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.formid}checkAndCallOldCallBack(){if(LeaveAdminOpers.Router.isRecordView())(e=new LeaveForm).recordId=Layout.Page.childUrlParam.recordId,e.view(Layout.Page.childUrlParam.recordId);else if(LeaveAdminOpers.Router.isRecordEdit()){var e;(e=new LeaveForm).edit(Layout.Page.childUrlParam.recordId)}else ZPView.init()}getOperationsHash(){return"operations/leavetracker/applications"}getViewModuleAdditionalParam(){var e="";return(LVUtil.Tab.isUserPage()||LVUtil.Tab.isOpersUserPage())&&(e="id:"+LVUtil.Team.SELECTED_USER),e}getExtraParamForFetch(){var e={};return(LVUtil.Tab.isUserPage()||LVUtil.Tab.isOpersUserPage())&&(e.searchUserId=JSON.stringify({ids:[LVUtil.Team.SELECTED_USER]})),e}showAllData(){return LVUtil.showAllDataForNonAdmin()}}class CompensationFormsViewHandler extends ModuleFormsViewsHandler{constructor(e){super(e={...e,moduleName:"compensation"})}}class CompensationSalaryFormsViewHandler extends CompensationFormsViewHandler{constructor(e){super(e),this.isFromOpr=e.isFromOpr,this.initBaseCallBack(),this.systemViewName=Compensation.Salary.Operations.formDetails.formDispName,this.salaryViewObj=void 0}initBaseCallBack(){Compensation.Config.getConfiguration_asSync(!1),Compensation.Salary.Operations.init(),this.getSalaryViewObj()}getFormId(){return ZPeople.Module.MODULE_DATA["salarydetails-salary-listview"].formDetailsMap.formId}getSalaryViewObj(){if(null==this.salaryViewObj){let e={selMode:"All"};e.isFromOpr=this.isFromOpr;const t=this.isFromOpr?Compensation.CONSTANTS.VIEWTYPE.OPER:Compensation.CONSTANTS.VIEWTYPE.OTHERS;e.viewType=t,this.salaryViewObj=Compensation.Salary.Operations.getViewObj(t,e)}return this.salaryViewObj}getViewTypeBasedOnPage(){let e="all";return ZPUtil.isV5SettingsUrl()?e="servadmin":settingsUrlProps.niceUrl.includes("employeesalary")&&(e="servuser"),e}onchangeCallback(e){this.getSalaryViewObj().onViewSwitchCallback(e)}dataCallback(){this.getSalaryViewObj().constructView()}importExportConstructionCallback(){this.getSalaryViewObj().constructImpExp("empSalMOpts","formsviewmenuicontxt")}getIsViewTypeNeeded(){return!1}getIsMultiSelectedNeeded(){return!1}checkAndCallOldCallBack(){ZPView.init()}}class CompensationSalaryRevisionFormsViewHandler extends CompensationFormsViewHandler{constructor(e){super(e),this.isFromOpr=e.isFromOpr,this.initBaseCallBack(),this.systemViewName=Compensation.SalRevision.Operations.formDetails.formDispName,this.salaryRevisionViewObj=void 0}initBaseCallBack(){Compensation.SalRevision.Operations.init(),this.getSalaryRevisionViewObj()}getFormId(){return Compensation.SalRevision.Operations.formDetails.formId}getViewTypeBasedOnPage(){let e="all";return ZPUtil.isV5SettingsUrl()?e="servadmin":settingsUrlProps.niceUrl.includes("employeesalary")&&(e="servuser"),e}getSalaryRevisionViewObj(){if(null==this.salaryRevisionViewObj){let e={selMode:"All",isFromOpr:!0};const t=this.isFromOpr?Compensation.CONSTANTS.VIEWTYPE.OPER:Compensation.CONSTANTS.VIEWTYPE.OTHERS;e.viewType=t,this.salaryRevisionViewObj=Compensation.SalRevision.Operations.getViewObj(t,e),Compensation.SalRevision.Operations.currViewObj=this.salaryRevisionViewObj}return this.salaryRevisionViewObj}onchangeCallback(e){this.getSalaryRevisionViewObj().onViewSwitchCallback(e)}dataCallback(){this.getSalaryRevisionViewObj().constructSalRevView()}importExportConstructionCallback(){this.getSalaryRevisionViewObj().constructImpExp("salRevMOpts","formsviewmenuicontxt")}getIsViewTypeNeeded(){return!1}getIsMultiSelectedNeeded(){return!1}getIsSpecialHandlingForFilter(e){return Compensation.Utils.isCompensationForm()&&Compensation.FormHandler.isSpecialField("P_SalaryRevision",e)}getFieldFilterOptionFromModules(e){return Compensation.SalRevision.Operations[e]}getSearchValueForFieldsFromModules(e,t){return Compensation.FormHandler.getValueForField(e,t)}showSearchParamsFromModules(e,t){let i={};return i.value=Compensation.FormHandler.SPECIAL_FIELDS[ZP5Views.zp5formgetFormsOp.getTableName()][e][t],i.operType=Compensation.FormHandler.getValueForField(e,t).operator,i}}class PerformanceSalaryFormViewHandler extends ModuleFormsViewsHandler{constructor(e){super(e={...e,module:"performance"}),this.initBaseCallBack(),this.systemViewName=EmployeeSalary.formDetails.formDispName}initBaseCallBack(){EmployeeSalary.init()}getFormId(){return EmployeeSalary.formDetails.formId}dataCallback(){EmployeeSalary.salaryConstructStart()}getAddButtonText(){return ZPI18N.getString("zp.addrecord")}recDeleteCallback(e,t){EmployeeSalary.deleteConfirmPopup(t,e)}selActionHTML(e){EmployeeSalary.getMultiSelectHtml(e)}onchangeCallback(e){EmployeeSalary.prepareView(e)}getIsViewTypeNeeded(){return!1}importExportConstructionCallback(e,t){let i=[];EmployeeSalary.formDetails.isImportAllowed&&i.push({id:"zp_views_imp",name:ZPI18N.getString("zp.import"),iClass:"PI_imprt"}),i.push({id:"zp_views_exp",name:ZPI18N.getString("zp.export"),iClass:"PI_exprt"}),EmployeeSalary.constructMoreOption(i,"formViewMenuListMenu","formsviewmenuicontxt")}getIsMultiSelectedNeeded(){return"#operations-performance-employeesalary"===settingsPage.tabId}isAddButtonNotNeed(){return"#operations-performance-employeesalary"!==settingsPage.tabId}isDeleteButtonNeed(){return"#operations-performance-employeesalary"===settingsPage.tabId}isCreateViewAllowed(){return"#operations-performance-employeesalary"===settingsPage.tabId}singleRecordViewCallBack(e){"#performance-employeesalary"===settingsPage.tabId?window.location.href="#performance/employeesalary/view-recordId:"+e:window.location.href="#operations/performance/employeesalary/view-recordId:"+e}}class GoalViewHandler extends ModuleFormsViewsHandler{constructor(e){super(e),this.initBaseCallBack()}initBaseCallBack(){Layout.PageUtil.loadFiles(["pms.mod.min.js","pms.util.min.js","pms.commonMod.min.js"],(()=>Goals.Systemview.init()))}getFormId(){return AppraisalConfig.formUtil.goalFormDtl.formId}getAddButtonText(){return ZPI18N.getString("zp.tag.module",new Array(ZPeople.decodeTxt(AppraisalConfig.formUtil.goalFormDtl.formDispname)))}isAddButtonNotNeed(){return!1}callAddRecordmethod(){TVP.tagActions.addGoalForm()}getOperationsHash(){return"operations/performance/oprgoals/listview"}isFormActionAllowed(e){return"DELETE"===e}}class MultiRaterViewHandler extends ModuleFormsViewsHandler{constructor(e){super(e),this.initBaseCallBack()}initBaseCallBack(){Layout.PageUtil.loadFiles(["pms.mod.min.js","pms.util.min.js","pms.commonMod.min.js"],(()=>AppraisalConfig.formUtil.getformDetails("multirater")))}getFormId(){return AppraisalConfig.formUtil.multiraterDtl.formId}isEditRestricted(){return!0}isAddTaskRestricted(){return!0}isFormActionAllowed(e){return"DELETE"===e}}class TaskOperationFormViewHandler extends ModuleFormsViewsHandler{constructor(e){super(e)}getFormId(){return TaskCommon.getTaskFormId()}getOperationsHash(){return"operations/task/taskadminview/listview"}getAddButtonText(){return ZPI18N.getString("zp.addtask")}isFormActionAllowed(){return!0}}class CandidateFormViewHandler extends NonModuleFormsViewHandler{constructor(e){super(e)}getAddButtonText(){return ZPI18N.getString("zp.addcandidate")}}class WorkplaceReadinessFormViewHandler extends NonModuleFormsViewHandler{constructor(e){super(e)}getAddButtonText(){return ZPI18N.getString("zp.addrequests")}}class VisitorFormViewHandler extends NonModuleFormsViewHandler{constructor(e){super(e)}getAddButtonText(){return ZPI18N.getString("zp.addrequests")}}class PremisesFormViewHandler extends NonModuleFormsViewHandler{constructor(e){super(e)}getAddButtonText(){return ZPI18N.getString("zp.addrequests")}getNODataClass(){return"zpl_Emptydata zpl_crd zpl_nodata"}}class ClearanceFormViewHandler extends ModuleFormsViewsHandler{constructor(e){super(e)}getFormId(){return OffboardingUtil.getFormViewModuleParams().formId}isClearanceView(){return 3==ZP5Views.currViewRecObj.viewType}isDeleteButtonNeed(){return!1}isAddButtonNotNeed(){return!0}getIsViewTypeNeeded(){return!this.isClearanceView()}importExportConstructionCallback(e,t){ZP5Views.getCurrViewObj().container.find("#"+t).remove()}getViewFilterModuleHandler(){return new ClearanceMFHandler}neddModuleSpecialField(){return!0}ConstructModuleSpecialField(){return this.isClearanceView()?[{key:"clearanceStatus",text:"Clearance Status",width:"80"},{key:"clearanceTime",text:"Clearance Time",width:"100"}]:[]}getHeaderThHtml(e){return"<th id="+e.key+' width="'+e.width+'"><div><span>'+e.text+"</span></div></th>"}getSingleFieldData(e,t){let i="";if("clearanceStatus"==e){if(t.clearanceDtls){const e=t.clearanceDtls.clearanceStatus;e==OffboardingConstants.STATUS.INPROGRESS?i='<i class="PI_ap_pending" data-toggle="tooltip" data-placement="top" title="'+ZPI18N.getString("zp.inprogress")+'"></i>':e==OffboardingConstants.STATUS.COMPLETED?i='<i class="PI_ap_approved" data-toggle="tooltip" data-placement="top" title="'+ZPI18N.getString("zp.completed")+'"></i>':21==e&&(i='<i class="PI_fil_revoke PI_oldversion blu" data-toggle="tooltip" data-placement="top" title="'+ZPI18N.getString("zp.revoked")+'"></i>')}return"<td class=text-center>"+i+"</td>"}if("clearanceTime"==e)return t.clearanceDtls&&(i="<span>"+t.clearanceDtls.time+"</span>"),"<td>"+i+"</td>"}getNodataMsg(){return ZPI18N.getString("zp.ofbclearancelistemptypagemsg")}isHRPartner(){var e=ZPeople.Module.getData(ZPeople.Module.getModuleKey());return!!e&&e.isHRPartner}}class ClearanceMFHandler extends viewFilterModuleHandler{constructor(e){super(e),this.valObj={}}needModuleSystemFilter(){return!0}getModuleSystemFilter(){let e=[];return e.push({label:"clearanceStatus",element:this.getClearanceStatusOptions()}),e}getClearanceStatusOptions(){let e="<div><label>"+ZPI18N.getString("zp.clearancestatus")+"</label></div>";return e+='<div><select class="zselectbox select-js" id="clearanceStatus_List" >',e+='<option value="all">'+ZPI18N.getString("zp.all")+"</option>",e+='<option value="inprogress">'+ZPI18N.getString("zp.inprogress")+"</option>",e+='<option value="completed">'+ZPI18N.getString("zp.completed")+"</option>",e}ModuleFiltercallback(e,t){let i=e.attr("labelname");if(null!=t&&t[i]&&(val=t[i][0]),"clearanceStatus"===i)e.find("#clearanceStatus_List").zselect("destroy"),ZPeopleComponents.select(e.find("#clearanceStatus_List"),{dropdownListLazyLoading:!0,selectedValue:"all"})}setModuleFilterValues(e){let t=e.find("#clearanceStatus_List").zselect("getValue");return this.valObj.clearanceStatus=[t],this.valObj}fetOptionFromSer(e){return!1}restModuleField(e){e.find("#clearanceStatus_List").zselect("setValue","all"),this.valObj={}}getBreadCrumbsHTML(e,t){return"<label>"+e+"&nbsp;&nbsp;&nbsp;"+FormConstants.Criteria.OPERATORSNAME[18]+'</label><span onmouseover="ZP5Views.mouseEnterFunction()">'+t[0]+'</span><a class="PI_cls" id="viewFilterResultsClose"></a>'}isClearanceView(){return 3==ZP5Views.currViewRecObj.viewType}getDefaultEmpStatus(){return this.isClearanceView()?"all":super.getDefaultEmpStatus()}}class OffboardingFilterModuleHandler extends viewFilterModuleHandler{getDefaultEmpStatus(){return"all"}}class OffboardingFormViewHandler extends ModuleFormsViewsHandler{getFormId(){return OffboardingUtil.getFormViewModuleParams().formId}isAddButtonNotNeed(){return!0}isDeleteButtonNeed(){return!1}getIsMultiSelectedNeeded(){return!1}singleRecordViewCallBack(e){Offboarding.ListView.PREV_URL=Layout.Page.hash,window.location.href="#operations/zp_offboarding/view-recordId:"+e}getIsSpecialHandlingForFilter(e){if("Replacement_required"===e)return!0}getFieldFilterOptionFromModules(e){if("Replacement_required"===e)return this.getReplacementOptions()}getReplacementOptions(){return{1:"zp.yes",0:"zp.no","-1":"zp.decidelater"}}getSearchValueForFieldsFromModules(e,t){if("Replacement_required"===e)return{value:t,operator:"18"}}getFieldFilterDefaultOperator(e){if("Replacement_required"===e)return"0"}showSearchParamsFromModules(e,t,i){if("Replacement_required"===e){const e=this.getReplacementOptions();return{operType:"18",value:ZPI18N.getString(e[t])}}}getfilterParamFromModule(e,t){if("Replacement_required"==e)return t[e]}getViewFilterModuleHandler(){return new OffboardingFilterModuleHandler}}class ResignationFormViewHandler extends OffboardingFormViewHandler{isHRPartner(){var e=ZPeople.Module.getData(ZPeople.Module.getModuleKey());return!!e&&e.isHRPartner}}class TerminationFormViewHandler extends OffboardingFormViewHandler{}class DeceasedFormViewHandler extends OffboardingFormViewHandler{}class InterviewFormViewHandler extends ModuleFormsViewsHandler{constructor(e){super(e)}getFormId(){return OffboardingUtil.getFormViewModuleParams().formId}isDeleteButtonNeed(){return!1}isAddButtonNotNeed(){return!0}importExportConstructionCallback(e,t){ZP5Views.getCurrViewObj().container.find("#"+t).remove()}}class RecycleBinViewHandler extends NonModuleFormsViewHandler{constructor(e){super(e)}getIsViewTypeNeeded(){return!1}isDeleteButtonNeed(){return!1}isAddButtonNotNeed(){return!0}isCreateViewAllowed(){return!0}isUserViewCompNeeded(){return!1}getExtraParamForFetch(){return RecycleBin.FormView.getListViewParams()}getRecordFetchUrl(){return RecycleBin.getRecycleBinUrl(RecycleBin.MODE.LOAD_FORM)}getTotalCountFetchUrl(){return RecycleBin.getRecycleBinUrl(RecycleBin.MODE.GET_RECORDS_COUNT)}setModuleProps(e,t){e.container=t.container,e.formId=t.formId,e.viewId=t.viewId}constructModuleViewAction(e){let t=e.container.find("#viewActionsContainer").find("#viewList");return t.attr("data-width",300),ZPeopleComponents.select(t,RecycleBin.FormView.getFormListOptions()),ZP5Views.currViewObj=void 0,!1}IsSinglerecViewNeed(){return!1}isExportNeeded(){return!1}hideItemForRecordSAction(e){let t=[];for(let i of e)if("#restoreRecord"===i);else t.push(i);return t}isSystemFiltersNeeded(){return!1}constructRecordActionButtons(e){e.find("#recActDiv").html(`<button id="restoreRecords" class="zlabel zlabel--blue zlabel--outline zlabel--medium">${ZPI18N.getString("zp.restore")}</button>`),e.find("#restoreRecords").on("click",(function(){RecycleBin.FormView.restoreRecords(ZP5Views.getSelectedRecIds())}))}getTotalCountParams(){return RecycleBin.FormView.getListViewParams(RecycleBin.MODE.GET_RECORDS_COUNT)}modulePerPageHandling(e){e.remove()}isUrlRefresh(){return!1}getTextForImageOrFileUpload(e,t){return t.value}getImageHTML(e){return"<span>"+e+"</span>"}isModeNeed(){return!1}}class OfferLetterViewHandler extends NonModuleFormsViewHandler{constructor(e){super(e),this.initBaseCallBack()}initBaseCallBack(){OfferLetter.Operations.init()}isAddButtonNotNeed(){return!0}onchangeCallback(){OfferLetter.Operations.onChangeCallback()}singleRecordViewCallBack(e){OfferLetter.editOfferLetter(e)}}class AppointmentLetterViewHandler extends ModuleFormsViewsHandler{constructor(e){super(e={...e,moduleName:"appointmentletter"}),this.initBaseCallBack(),this.systemViewName=ZPeople.decodeTxt(this.getModuleData.formDetailsMap.formdisplayName)}initBaseCallBack(){ApptLtr.Operations.init()}getIsViewTypeNeeded(){return!1}get getModuleData(){return ZPeople.Module.MODULE_DATA["appointmentletter-listview"]}getFormId(){return ZP5Views.CURR_VIEWPARAMS.formId||this.getModuleData.formId}getAddButtonText(){return"Generate"}isCreateViewAllowed(){return!1}onchangeCallback(e){ApptLtr.Operations.onChangeCallback.call(ApptLtr.Operations,e)}dataCallback(){ApptLtr.Operations.getViewHandler().init()}singleRecordViewCallBack(e){window.location.hash=ApptLtr.Util.getActionUrl(ApptLtr.MODE.VIEW,e)}isUserViewCompNeeded(){return!1}isEditRestricted(){return!0}isAddTaskRestricted(){return!0}constructRecordActionButtons(e){e.find("#recActDiv").find("button:not(#recordDelete)").remove();let t=$(`<button id='sendToCandidate' class="zlabel zlabel--blue zlabel--outline zlabel--medium">${ZPI18N.getString("zp.appt.sendToCandidate")}</button>`);t.on("click",ApptLtr.Operations.sendBulkToCandidate),e.find("#recActDiv").prepend(t)}callAddRecordmethod(e){ApptLtr.Operations.addRecordCallback()}importExportConstructionCallback(e,t){ApptLtr.Import.constructImpExp(t)}isFormActionAllowed(e){return"DELETE"===e}}class EmployeeFormViewHandler extends NonModuleFormsViewHandler{getModuleHandlerFiles(){return["transfer.configuration.min.js","transfer_initiateProcess.min.js"]}}var ViewsModuleHandlerObject={nonModuleFormViewHandler:void 0,timeTrackerJobsFormViewHandler:void 0,timeTrackerProjectsFormViewHandler:void 0,timeTrackerClientsFormViewHandler:void 0,leaveApplicationFormViewHandler:void 0,performanceSalaryFormViewHandler:void 0,compensationSalaryFormViewHandler:void 0,compensationSalaryRevisionFormViewHandler:void 0,taskOperationFormViewHandler:void 0,candidateFormViewHandler:void 0,workplaceReadinessFormViewHandler:void 0,visitorFormViewHandler:void 0,premisesFormViewHandler:void 0,mrFeedbackViewHandler:void 0,clearanceFormViewHandler:void 0,resignationFormViewHandler:void 0,terminationFormViewHandler:void 0,deceasedFormViewHandler:void 0,interviewFormViewHandler:void 0,goalViewHandler:void 0,employeeFormViewHandler:void 0,recycleBinViewHandler:void 0,offerLetterViewHandler:void 0,getNonModuleFormViewHandler:()=>(null==ViewsModuleHandlerObject.nonModuleFormViewHandler&&(ViewsModuleHandlerObject.nonModuleFormViewHandler=new NonModuleFormsViewHandler),ViewsModuleHandlerObject.nonModuleFormViewHandler),getTimeTrackerJobsFormViewHandler:()=>(null==ViewsModuleHandlerObject.timeTrackerJobsFormViewHandler&&(ViewsModuleHandlerObject.timeTrackerJobsFormViewHandler=new TimeTrackerJobsFormViewHandler),ViewsModuleHandlerObject.timeTrackerJobsFormViewHandler),getTimeTrackerProjectsFormViewHandler:()=>(null==ViewsModuleHandlerObject.timeTrackerProjectsFormViewHandler&&(ViewsModuleHandlerObject.timeTrackerProjectsFormViewHandler=new TimeTrackerProjectsFormViewHandler),ViewsModuleHandlerObject.timeTrackerProjectsFormViewHandler),getTimeTrackerClientsFormViewHandler:()=>(null==ViewsModuleHandlerObject.timeTrackerClientsFormViewHandler&&(ViewsModuleHandlerObject.timeTrackerClientsFormViewHandler=new TimeTrackerClientFormViewHandler),ViewsModuleHandlerObject.timeTrackerClientsFormViewHandler),getLeaveApplicationFormViewHandler:()=>(null==ViewsModuleHandlerObject.leaveApplicationFormViewHandler&&(ViewsModuleHandlerObject.leaveApplicationFormViewHandler=new LeaveApplicationFormViewHandler),ViewsModuleHandlerObject.leaveApplicationFormViewHandler),getCompensationSalaryFormViewHandler(){var e={isFromOpr:ZPUtil.isV5SettingsUrl()};return ViewsModuleHandlerObject.compensationSalaryFormViewHandler=new CompensationSalaryFormsViewHandler(e),ViewsModuleHandlerObject.compensationSalaryFormViewHandler},getCompensationSalaryRevisionFormViewHandler(){var e={isFromOpr:ZPUtil.isV5SettingsUrl()};return ViewsModuleHandlerObject.compensationSalaryRevisionFormViewHandler=new CompensationSalaryRevisionFormsViewHandler(e),ViewsModuleHandlerObject.compensationSalaryRevisionFormViewHandler},getPerformanceSalaryFormViewHandler:()=>(null==ViewsModuleHandlerObject.performanceSalaryFormViewHandler&&(ViewsModuleHandlerObject.performanceSalaryFormViewHandler=new PerformanceSalaryFormViewHandler),ViewsModuleHandlerObject.performanceSalaryFormViewHandler),getMRFeedbackViewHandler:()=>(null==ViewsModuleHandlerObject.mrFeedbackViewHandler&&(ViewsModuleHandlerObject.mrFeedbackViewHandler=new MRFeedbackViewHandler),ViewsModuleHandlerObject.mrFeedbackViewHandler),getGoalViewHandler:()=>(null==ViewsModuleHandlerObject.goalViewHandler&&(ViewsModuleHandlerObject.goalViewHandler=new GoalViewHandler),ViewsModuleHandlerObject.goalViewHandler),getMultiRaterViewHandler:()=>(null==ViewsModuleHandlerObject.multiRaterViewHandler&&(ViewsModuleHandlerObject.multiRaterViewHandler=new MultiRaterViewHandler),ViewsModuleHandlerObject.multiRaterViewHandler),getTaskOperationFormViewHandler:()=>(null==ViewsModuleHandlerObject.taskOperationFormViewHandler&&(ViewsModuleHandlerObject.taskOperationFormViewHandler=new TaskOperationFormViewHandler),ViewsModuleHandlerObject.taskOperationFormViewHandler),getCandidateFormViewHandler:()=>(null==ViewsModuleHandlerObject.candidateFormViewHandler&&(ViewsModuleHandlerObject.candidateFormViewHandler=new CandidateFormViewHandler),ViewsModuleHandlerObject.candidateFormViewHandler),getWorkplaceReadinessFormViewHandler:()=>(null==ViewsModuleHandlerObject.workplaceReadinessFormViewHandler&&(ViewsModuleHandlerObject.workplaceReadinessFormViewHandler=new WorkplaceReadinessFormViewHandler),ViewsModuleHandlerObject.workplaceReadinessFormViewHandler),getVisitorFormViewHandler:()=>(null==ViewsModuleHandlerObject.visitorFormViewHandler&&(ViewsModuleHandlerObject.visitorFormViewHandler=new VisitorFormViewHandler),ViewsModuleHandlerObject.visitorFormViewHandler),getClearanceFormViewHandler:()=>(null==ViewsModuleHandlerObject.clearanceFormViewHandler&&(ViewsModuleHandlerObject.clearanceFormViewHandler=new ClearanceFormViewHandler),ViewsModuleHandlerObject.clearanceFormViewHandler),getResignationFormViewHandler:()=>(null==ViewsModuleHandlerObject.resignationFormViewHandler&&(ViewsModuleHandlerObject.resignationFormViewHandler=new ResignationFormViewHandler),ViewsModuleHandlerObject.resignationFormViewHandler),getTerminationFormViewHandler:()=>(null==ViewsModuleHandlerObject.terminationFormViewHandler&&(ViewsModuleHandlerObject.terminationFormViewHandler=new TerminationFormViewHandler),ViewsModuleHandlerObject.terminationFormViewHandler),getDeceasedFormViewHandler:()=>(null==ViewsModuleHandlerObject.deceasedFormViewHandler&&(ViewsModuleHandlerObject.deceasedFormViewHandler=new DeceasedFormViewHandler),ViewsModuleHandlerObject.deceasedFormViewHandler),getInterviewFormViewHandler:()=>(null==ViewsModuleHandlerObject.interviewFormViewHandler&&(ViewsModuleHandlerObject.interviewFormViewHandler=new InterviewFormViewHandler),ViewsModuleHandlerObject.interviewFormViewHandler),getPremisesFormViewHandler:()=>(null==ViewsModuleHandlerObject.premisesFormViewHandler&&(ViewsModuleHandlerObject.premisesFormViewHandler=new PremisesFormViewHandler),ViewsModuleHandlerObject.premisesFormViewHandler),getEmployeeViewHandler:()=>(null==ViewsModuleHandlerObject.employeeFormViewHandler&&(ViewsModuleHandlerObject.employeeFormViewHandler=new EmployeeFormViewHandler),ViewsModuleHandlerObject.employeeFormViewHandler),getRecycleBinViewHandler:()=>(null==ViewsModuleHandlerObject.recycleBinViewHandler&&(ViewsModuleHandlerObject.recycleBinViewHandler=new RecycleBinViewHandler),ViewsModuleHandlerObject.recycleBinViewHandler),getOfferLetterViewHandler:()=>(null==ViewsModuleHandlerObject.offerLetterViewHandler&&(ViewsModuleHandlerObject.offerLetterViewHandler=new OfferLetterViewHandler),ViewsModuleHandlerObject.offerLetterViewHandler),getAppointmentLetterViewHandler:()=>(null==ViewsModuleHandlerObject.appointmentLetterViewHandler&&(ViewsModuleHandlerObject.appointmentLetterViewHandler=new AppointmentLetterViewHandler),ViewsModuleHandlerObject.appointmentLetterViewHandler)};ZP5ViewsCommon.registerRecordSelectActionCallBack=()=>{let e=ZP5Views.getCurrViewObj(),t=e.container.find("#viewActionsContainer").find("#recordActionsContainer");if(t.find("#recordAdobeSign").addClass("DN"),t.find("#recordDocSign").addClass("DN"),t.find("#recordZohoSign").addClass("DN"),isadmin||e.isAdmin()){var i=e.formId,r=ZP5Views.getSelectedRecIds();0==ZP5Views.viewFormClassObj[ZP5Form.getFormsOperation().formId].getFormsDetailsMap().isSignRestricted&&(ZP5Views.viewFormClassObj[ZP5Form.getFormsOperation().formId].getFormsDetailsMap().isAdobeConfig?t.find("#recordAdobeSign").removeClass("DN").off().on("click",(function(){Zsign.ESIGN_FORMS_RECORD_IDS=r,Zsign.sendForSignDocs(i,r)})):ZP5Views.viewFormClassObj[ZP5Form.getFormsOperation().formId].getFormsDetailsMap().isDocuConfig?t.find("#recordDocSign").removeClass("DN").off().on("click",(function(){Zsign.ESIGN_FORMS_RECORD_IDS=r,Zsign.sendForSignDocs(i,r)})):ZP5Views.viewFormClassObj[ZP5Form.getFormsOperation().formId].getFormsDetailsMap().isZSConfig&&t.find("#recordZohoSign").removeClass("DN").off().on("click",(function(){Zsign.ESIGN_FORMS_RECORD_IDS=r,Zsign.sendForSignDocs(i,r)})))}if("P_Candidate"==ZP5Form.getFormsOperation(e.formId).getFormsDetailsMap().tableName&&(isadmin||ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().iscandaddallowed?t.find("#recordTriggerOnboarding").removeClass("DN"):t.find("#recordTriggerOnboarding").addClass("DN"),isadmin||ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().isempaddallowed?t.find("#convertcandtoemp").removeClass("DN"):t.find("#convertcandtoemp").addClass("DN")),"P_Employee"==ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().tableName&&(isadmin||ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().iscandaddallowed)&&ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().isEmpOBPresent&&ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().isOnboarding?t.find("#recordEmpTriggerOnboarding").removeClass("DN"):t.find("#recordEmpTriggerOnboarding").addClass("DN"),e.isApproverViewType()?(t.find("#recordApprove").removeClass("zpl_DNI"),t.find("#recordReject").removeClass("zpl_DNI"),t.find("#recordMailMerge").addClass("DN"),ZP5ViewsCommon.ApproverView.registerRecordSelectActionCallBack(e,t),(ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().editPerm<=0||!ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().isSingleFieldEditAllow)&&t.find("#recordMassUpdate").addClass("DN")):(t.find("#recordMailMerge").removeClass("DN"),t.find("#recordApprove").addClass("zpl_DNI"),t.find("#recordReject").addClass("zpl_DNI")),ZPeopleComponents.isComponent("#recordActionsContainer [name=custAct_Li_Btn]")&&(ZPeopleComponents.splitbutton("#recordActionsContainer [name=custAct_Li_Btn]").destroy(),t.find("[name=custActMenu]").remove(),t.find("[name=custAct_Li_Btn]").remove()),e.getViewProperty("isCustomActionEnable")&&settingsPage.container.find("#recActDiv #custAct_"+e.getViewId()).length<=0&&ZP5ViewsCommon.CustomAction.registerRecordSelectActionCallBack({viewId:e.getViewId(),deleteRecIds:e.getDeleteRecIds()}),"P_Task"===ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().formName?t.find("#recordTaskComplete").removeClass("DN"):t.find("#recordTaskComplete").addClass("DN"),ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().isSingleFieldEditAllow&&"P_EmployeeLeave"!==ZP5Views.zp5formgetFormsOp.getTableName()&&"P_Task"!==ZP5Views.zp5formgetFormsOp.getTableName()&&"P_MultiRater"!=ZP5Views.zp5formgetFormsOp.getTableName()&&"P_MultiRater_Approval"!=ZP5Views.zp5formgetFormsOp.getTableName()&&"P_EmployeeHealthData"!=ZP5Views.zp5formgetFormsOp.getTableName()&&"P_VaccinationStatus"!=ZP5Views.zp5formgetFormsOp.getTableName()&&"P_ClientDetails"!=ZP5Views.zp5formgetFormsOp.getTableName()||(t.find("#recordMassUpdate").addClass("DN"),"P_MultiRater"!=ZP5Views.zp5formgetFormsOp.getTableName()&&"P_MultiRater_Approval"!=ZP5Views.zp5formgetFormsOp.getTableName()&&"P_ClientDetails"!=ZP5Views.zp5formgetFormsOp.getTableName()||t.find("#recordMailMerge").addClass("DN"),"P_EmployeeHealthData"!=ZP5Views.zp5formgetFormsOp.getTableName()&&"P_VaccinationStatus"!=ZP5Views.zp5formgetFormsOp.getTableName()||t.find("#recordDelete").addClass("DN")),ZP5Views.currViewModuleHandler.isDeleteButtonNeed()||t.find("#recordDelete").addClass("DN"),"P_TimesheetJob"===ZP5Views.zp5formgetFormsOp.getTableName()||"P_TimesheetJobsList"===ZP5Views.zp5formgetFormsOp.getTableName()||"P_ClientDetails"===ZP5Views.zp5formgetFormsOp.getTableName()){var s=Timetracker.views.multiSelectActions.getMultiSelectHtml(ZP5Views.zp5formgetFormsOp.getTableName());t.html(s)}(isadmin||e.isAdmin()&&isManageAutoAdmin)&&ZP5Views.viewFormClassObj[ZP5Form.getFormsOperation().formId].getFormsDetailsMap().hasMMTForm?t.find("#recordMailMerge").removeClass("DN"):t.find("#recordMailMerge").addClass("DN"),ZP5Views.currViewModuleHandler.constructRecordActionButtons&&ZP5Views.currViewModuleHandler.constructRecordActionButtons(t),"P_Employee"===ZP5Views.zp5formgetFormsOp.getTableName()&&ZPeople.isTransferV2Enabled&&(t.find("#zp_hr_process_initiate").addClass("DN"),ZComponents.button("#zp_hr_process_initiate").destroy(),ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().isTransferAllowed&&(e.isHRMSAdmin()||"team"==ZP5Views.currViewModuleHandler.getPageType())&&(t.find("#zp_hr_process_initiate").removeClass("DN"),ZComponents.button("#zp_hr_process_initiate",{progressIndicator:{type:"circular",position:"left"},click:()=>{let t=e.getTypeOfView();"dirsub"==t&&(t="sub");let i=e.getAllSelectedRecordIds();ZPHRProcess.employeeSelection.initProcess(i,t)}})))},ZP5ViewsCommon.CustomAction={constructCustomButtonForRecord:(e,t)=>ZPA_CusActOper.constructCBListInViewForRecs(ZPA_CusActOper[e],t),registerElementCallBack(e){let t=ZP5Views.getCurrViewObj();1==ZPA_CusActOper[t.getViewId()].length?ZPeopleComponents.button(e.find("#viewsContainer #recordContainer").find('button[name="custAct_Li_Btn"]'),{size:"large",click:function(e,t){e.stopPropagation();var i=$(this).attr("recordid"),r=$(this).attr("custactid"),s=$(this).attr("custacttype");ZPA_CusActOper.triggerCustomAction(r,i,s,!1)}}):ZPeopleComponents.splitbutton(e.find("#viewsContainer #recordContainer").find('button[name="custAct_Li_Btn"]'),{change:function(e){e.stopPropagation();var t=$(e.detail.selectedItem[0]),i=t.attr("recordid"),r=t.attr("custactid"),s=t.attr("custacttype");ZPA_CusActOper.triggerCustomAction(r,i,s,!1)},buttonclick:function(e){e.stopPropagation()},click:function(e){if(e.stopPropagation(),!e.detail.isMenuButton){var t=e.detail.selectedItem[0];if(null!=t.itemData){var i=t.itemData.attrs,r=i.recordid,s=i.custactid,a=i.custacttype;ZPA_CusActOper.triggerCustomAction(s,r,a,!1)}else{r=$(t).attr("recordid"),s=$(t).attr("custactid"),a=$(t).attr("custacttype");ZPA_CusActOper.triggerCustomAction(s,r,a,!1)}}}})},registerRecordSelectActionCallBack(e){var t=ZPA_CusActOper[e.viewId];settingsPage.container.find("#recordActionsContainer #recActDiv #customAction").after(ZPA_CusActOper.constructCBListView(t,ZP5Views.getAllSelectedRecIds(),!0,e.viewId)),1==t.length?ZPeopleComponents.button(settingsPage.container.find("#recordActionsContainer #custAct_"+e.viewId),{size:"large",click:function(e,t){e.stopPropagation();var i=ZP5Views.getAllSelectedRecIds(),r=$(this).attr("custactid"),s=$(this).attr("custacttype");ZPA_CusActOper.triggerCustomAction(r,i,s,!0)}}):ZPeopleComponents.splitbutton(settingsPage.container.find("#recordActionsContainer #custAct_"+e.viewId),{change:e=>{e.stopPropagation();var t=$(e.detail.selectedItem[0]),i=ZP5Views.getAllSelectedRecIds(),r=t.attr("custactid"),s=t.attr("custacttype");ZPA_CusActOper.triggerCustomAction(r,i,s,!0)},buttonclick:e=>{e.stopPropagation()},click:e=>{if(e.stopPropagation(),!e.detail.isMenuButton){var t=e.detail.selectedItem[0];if(null!=t.itemData){var i=t.itemData.attrs,r=ZP5Views.getAllSelectedRecIds(),s=i.custactid,a=i.custacttype;ZPA_CusActOper.triggerCustomAction(s,r,a,!0)}else{r=ZP5Views.getAllSelectedRecIds(),s=$(t).attr("custactid"),a=$(t).attr("custacttype");ZPA_CusActOper.triggerCustomAction(s,r,a,!0)}}}})}},ZP5ViewsCommon.ApproverView={isApproverView:e=>e&&2==e.viewType,appendDefaultFilter:e=>{let t="";return e||(t="approvalStatus:pending"),t},updateApproverViewFilter:e=>{e.getViewClassObj().isApproverViewType()?(e.container.find("#systemFilterContainer").find("#approvalFilter").find("#approvalList option[value='notsubmitted']").remove(),e.container.find("#systemFilterContainer").find("#approvalFilter").find("#approvalList option[value='cancelled']").remove(),e.container.find("#systemFilterContainer").find("#approvalFilter").find("#approvalList option[value='all']").replaceWith('<option value="all">'+ZPI18N.getString("zp.allapprovalrequest")+"</option>"),e.container.find("#systemFilterContainer").find("#approvalFilter").find("#approvalList option[value='pending']").replaceWith('<option value="pending">'+ZPI18N.getString("zp.mypending")+"</option>"),e.container.find("#systemFilterContainer").find("#approvalFilter").find("#approvalList option[value='otherspending']").length<=0?e.container.find("#systemFilterContainer").find("#approvalFilter").find("#approvalList").append('<option value="otherspending">'+ZPI18N.getString("zp.otherspending")+"</option>"):e.container.find("#systemFilterContainer").find("#approverFilter").addClass("DN")):(e.container.find("#systemFilterContainer").find("#approvalFilter").find("#approvalList option[value='otherspending']").remove(),e.container.find("#systemFilterContainer").find("#approvalFilter").find("#approvalList option[value='all']").replaceWith('<option value="all">'+ZPI18N.getString("zp.allrequest")+"</option>"),e.container.find("#systemFilterContainer").find("#approvalFilter").find("#approvalList option[value='pending']").replaceWith('<option value="pending">'+ZPI18N.getString("zp.pending")+"</option>"),e.container.find("#systemFilterContainer").find("#approvalFilter").find("#approvalList option[value='notsubmitted']").length<=0&&(e.container.find("#systemFilterContainer").find("#approvalFilter").find("#approvalList").append('<option value="notsubmitted">'+ZPI18N.getString("zp.drafts")+"</option>"),e.container.find("#systemFilterContainer").find("#approvalFilter").find("#approvalList").append('<option value="cancelled">'+ZPI18N.getString("zp.cancelled")+"</option>")))},getApprovalStatus:(e,t)=>{let i="";switch(t){case"pending":i=e.isApproverViewType()?ZPI18N.getString("zp.mypending"):ZPI18N.getString("zp.pending");break;case"otherspending":i=ZPI18N.getString("zp.otherspending");break;case"approved":i=ZPI18N.getString("zp.approved");break;case"rejected":i=ZPI18N.getString("zp.rejected");break;case"notsubmitted":i=ZPI18N.getString("zp.drafts");break;case"cancelled":i=ZPI18N.getString("zp.cancelled")}return i},registerRecordSelectActionCallBack(e,t){t.find("#recordApprove").off("click").on("click",(function(){ApprovalList.MySpace.showPopup(this,!0,ZP5Views.CURR_VIEWPARAMS.formId)})),t.find("#recordReject").off("click").on("click",(function(){ApprovalList.MySpace.showPopup(this,!0,ZP5Views.CURR_VIEWPARAMS.formId)}));var i=e.isAdmin();"pending"==e.urlParamsArr.approvalStatus||"otherspending"==e.urlParamsArr.approvalStatus&&i||(t.find("#recordApprove").addClass("zpl_DNI"),t.find("#recordReject").addClass("zpl_DNI"))}},ZP5ViewsCommon.Task={bulkComplete:function(){$.post("/bulkComplete.zp",{conreqcsr:csrfToken,method:"bulkComplete",taskids:JSON.stringify(ZP5Views.getAllSelectedRecIds())},(function(e){ZP5ViewsCommon.Task.selectedRecIds=[],ZP5Views.refreshview(!0),ZPeople.Message.showSuccessMsg(e.Status)}))}},ZP5ViewsCommon.Checklist={addChecklistIcon:function(e){if(ZP5Form.getCurrFormsOperation().getFormsDetailsMap().isCheckListEnabled){e.find("#zp_form_header .zpl_mhderrgt #headerTaskBtn").remove();var t='<a onclick="ZPA_ChecklistActivity.getChecklistsForRecord()" id="headerTaskBtn" class="PI_s_checklist zpl_servcicn zpl_btnicn tooltip-js" title="'+ZPI18N.getString("zp.checklist")+'"></a>';e.find("#zp_form_header .zpl_mhderrgt a:first").before(t)}}},ZP5ViewsCommon.RelatedTask={isTaskAvailable:e=>{var t=!1;return ZPUtil.Validation.isEmpty(e)&&(e=ZP5Form.getCurrFormsOperation().getTableName()),-1===["P_PerfAppraisal","P_Location","P_Streams","P_EmployeeHealthData","P_VaccinationStatus","P_OfficeBuildings","P_LeaveType","P_EmployeeLeave","P_AppraisalConfiguration","P_KRA","P_KRA_User","P_Rating","P_EmployeeJobs","P_Holiday","P_EmpBradfordScore","P_Bradford","P_Goals","P_TimesheetJob","P_TimesheetJobsList","P_Timesheet","P_TimesheetList","P_TimesheetBudget","P_TimeJobSchedule","P_ClientDetails"].indexOf(e)&&$.each(ZPTabs.TAB_JSON,(function(e,i){"Task"===i.name&&(t=!0)})),t},construct:e=>{var t=e.container;delete e.container,e.mode="fetchRecords",ZPeople.Request.send(ZP5Views.url,e,((e,i,r)=>{ZP5ViewsCommon.RelatedTask.getRelTaskListHtml(t,e.recordDetails.message)}))},getRelTaskListHtml:(e,t)=>{TaskPermission.get(),TaskStatus.getOptionValues();for(var i="<div class='zpl_rgtcnt tskptch' id='relTaskList'>",r=0;r<t.length;r++){let e=t[r];i+=ZP5ViewsCommon.RelatedTask.getTaskRow(e)}i+="</div>",e.append(i)},getDueDateHTML:e=>{let t='<div class="mw200  zpl_flex-a-c">';return e.iscompleted?t+="<div name='duedate'>"+e.dispCompletedTime+"</div>":null==e.endtime?t+="<div name='duedate'>"+ZPI18N.getString("zp.noduedate")+"</div>":e.isoverdue?t+="<div name='duedate' class='red'>"+e.endtime+"</div>":t+="<div name='duedate'>"+e.endtime+"</div>",t+="</div>",t},getTaskStatusIconHTML:e=>{let t=e.iscompleted?"PI_tick2_fil":"PI_tick2",i=e.statusSysValue==TaskStatus.NA_SYSVALUE?"zpl_disabl-pe":"",r=e.statusSysValue==TaskStatus.NA_SYSVALUE?"":e.iscompleted?ZPI18N.getString("zp.open"):ZPI18N.getString("zp.complete"),s="<div>";return(isadmin||e.istaskowner||ZP5Form.Permission.isAllowed([e.taskowner],TaskPermission.EDIT))&&(s+=`<i class="${t} ${i} zpl_tckchng zpl_act mw50" onclick="TaskCommon.changeStatus(this, '`+e.id+'\')" title="'+r+'"></i>'),s+="</div>",s},getTaskNameHTML:e=>'<div class="zpl_tsklstnme zpl_ellipsis">\n                    <div class="zpl_em zpl_ellipsis">\n                        <div class="zpl_emdts zpl_ellipsis">\n                            <div title="'+e.name+'"><b>'+e.name+"</b></div>\n                        </div>\n                    </div>\n       \t\t\t </div>",getTaskOwnerHTML:(e,t)=>{let i='<div class="mw150">';if(null==e.taskownerdetail)i+='<div name="pickBtn" class="PI_usr"  onclick="TaskCommon.pickTaskConfirmation(this)" rcdlist="true"></div>';else{let r="";r=t?ZPeople.getUserDetailsById(e.taskownerdetail.taskownererecno).avatar:e.taskownerdetail.employeePhoto,i+='<div class="zpl_em">\n\t                          \t<div class="zpl_emimg"><img src="'+r+'"></div>\n\t                       \t</div>'}return i+="</div>",i},getTaskStatusHTML:e=>{let t='<div class="mw150 zpl_flex-a-c">';return t+=`<div class="zpl_em">\n\t                          \t<div name="tStatus" class="${TaskCommon.getStatusColor(e.statusSysValue)}">${e.status}</div>\n\t                       \t</div>`,t+="</div>",t},getDeleteHTML:(e,t)=>{let i="";return(t||e.isDeletable&&!e.isDraft)&&(i+='<div class="mw150 zpl_tskaction"><div class="zpl_hvr" taskid="'+e.id+'"><i class="PI_delete" onclick="TaskCommon.deleteTaskConfirmation(this)" title="'+ZPI18N.getString("zp.delete")+'"></i></div></div>'),i},getTaskRow:(e,t)=>'<div class="zpl_crdlst" taskid="'+e.id+'" onclick="TaskCommon.openViewTask(\''+e.id+'\', true)" >\n                    <div class="zpl_catlst">\n                        '+ZP5ViewsCommon.RelatedTask.getTaskStatusIconHTML(e)+"\n                        "+ZP5ViewsCommon.RelatedTask.getTaskNameHTML(e)+"\n\t\t                "+ZP5ViewsCommon.RelatedTask.getTaskOwnerHTML(e,t)+"\n\t\t                "+ZP5ViewsCommon.RelatedTask.getTaskStatusHTML(e)+"\n\t\t                "+ZP5ViewsCommon.RelatedTask.getDueDateHTML(e)+"\n\t\t                "+ZP5ViewsCommon.RelatedTask.getDeleteHTML(e,t)+"\n                    </div>\n               </div>",addPopup:(e,t,i,r)=>{var s=$("#"+e);if(TaskPermission.ADD!=zpconst.Permission.NO_DATA&&TaskPermission.ADD!=zpconst.Permission.MY_DATA){var a=new Tab;a.id="quicktask_Popup",a.cardId="quicktask_Cards",a.validate=function(){ZP5ViewsCommon.RelatedTask.addQuickTask(s,t,i,r)};var n=new popupModal(ZPI18N.getString("zp.addtask"),a);n.setContainerAsBody(!0),n.construct(),n.setCloseCallback((function(){ZP5ViewsCommon.RelatedTask.closePopup(),n.remove()})),$("#quicktask_Popup").find("#"+a.cardId).append(ZP5ViewsCommon.RelatedTask.getQuickTaskhtml()),ZPeopleComponents.select("#quiktask_owner",ZP5ViewsCommon.RelatedTask.getTaskownerParam()),ZPeopleComponents.datefield("#quiktask_duedate")}},closePopup:function(){ZPeopleComponents.datefield("#quiktask_duedate").destroy(),ZPeopleComponents.select("#quiktask_owner").destroy()},getTaskownerParam:()=>{var e={dataMapping:{label:"displayName",value:"id"},dropdownList:{}};e.dropdownList.isTextEncoded=!0,e.dropdownList.contentType="text";var t=EmployeeSearch.getEmpList("","emp","TASKS");return options=t,e.dataMapping={value:"id",label:"value"},e.showSearchField=!0,e.isLabelHTMLEncoded=!0,e.dropdownList={fitForElement:!0,moveOnScroll:!0,isTextHTMLEncoded:!0},e.dataSource={search:e=>new Promise((function(t,i){t({delay:20,results:EmployeeSearch.getEmpList(e.query,"emp","TASKS"),selectedIndex:erecno,more:!1})})),paginated:!0},e.serverSearch=!0,e.cacheData=!0,e.contentType="text",e.search={by:["value","email"]},e},getQuickTaskhtml:()=>{var e='<div class="zpl_crd">';return e+='<div class="zpl_crdcnt"><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.taskname")+'</label></div><div><input id="quicktaskname" type="text" class="ztextbox"></div></div>',e+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.taskowner")+'</label></div><div><select type="text" id="quiktask_owner" class="ztextbox" value=""></select></div></div>',e+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.duedate")+'</label></div><div><div name="errDiv"><input id="quiktask_duedate" data-picker="true" data-format="'+dateFmt+'" data-calendar-icon="true" data-spin-buttons="none" )"></div></div></div>',e+="</div></div>"},addQuickTask:(e,t,i,r)=>{let s=$("#quicktask_Popup");ZPA_Common.disableSaveBtn(s);let a={};var n={};if(n.zp_formId=ZPUtil.Validation.isEmpty(i)?ZP5Form.getFormClassObj().getParams().formId:i,n.zp_recordId=ZPUtil.Validation.isEmpty(t)?ZP5Form.getFormClassObj().getParams().recordId:t,n.conreqcsr=csrfToken,n.taskname=s.find("#quicktaskname").val(),n.dueDate=ZPeopleComponents.datefield("#quiktask_duedate").getValue().dateString,n.taskowner=ZPeopleComponents.select(s.find("#quiktask_owner")).getValue(),n.method="addQuickTask",""===n.taskname)return void ZPA_Common.appendErrorDiv(s.find("#quicktaskname"),ZPI18N.getString("zp.tasknameerromsg"));a.name=n.taskname,a.taskownerdetail={taskownererecno:n.taskowner};let o=Calendar.getCurrentDate(!0);if(null==n.dueDate||""===n.dueDate)a.endtime=ZPI18N.getString("zp.today"),n.dueDate=o;else{let[e,t,i]=n.dueDate.split("-");n.dueDate<o&&(a.isoverdue=!0),a.endtime=i==Calendar.curYear?`${e} ${t}`:n.dueDate}let l=TaskStatus.getSysStatusList();a.statusSysValue=l[0].SYSVALUE,a.status=ZPeople.decodeTxt(l[0].VALUE),$.post("/addQuickTask.zp",n,(function(t){if(void 0===t.taskid||null===t.taskid||""===t.taskid){ZPA_Common.enableSaveBtn(s);let e=t.message||t.errors&&(t.errors.message||t.errors);return e&&"object"==typeof e&&(e=e.error&&e.error.message?e.error.message:Object.values(e)),void ZPeople.Message.failure(e)}ZP5ViewsCommon.RelatedTask.closePopup(),$("#quicktask_Popup").remove(),a.id=t.taskid;let i=ZP5ViewsCommon.RelatedTask.getTaskRow(a,!0);e.find("#relTaskList").prepend(i),ZPUtil.Validation.isFunction(r)&&r(t,n)}))}},ZP5ViewsCommon.Approval={resetApprovalRecordIds:()=>{ZP5Views.getCurrViewObj().isApproverViewType()&&(ApprovalList.APPROVE_RECIDS=[])}},ZP5ViewsCommon.OtherModulesMenuHAndling={checkHideItem:e=>{var t=!0;if("zp_views_esign"==e){t=!0;(ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().isAnySignConfigured||ZP5Views.zp5formgetFormsOp.getFormsDetailsMap().hasAgreementMapping)&&(ZP5Views.zp5formgetFormsOp.isAdmin()||ZP5Views.zp5formgetFormsOp.isOperationalRoleAdmin())&&(t=!1)}return t},menuInit:(e,t)=>{"zp_views_esign"==e&&Zsign.Forms.init()}},ZP5ViewsCommon.getdataForOtherModule={getresponse:(e,t)=>{ZP5Views.setCurrentViewModuleHandler(t),new views(e).getData()}};var ZP5ViewActions={url:"/createViewAction.zp",VIEWID:void 0,FORMID:void 0,container:{},viewSelect:{getObj:()=>(ZP5Views.getCurrViewObj()?ZP5Views.getCurrViewObj().container:settingsPage.container).find("#viewActionsContainer").find("#viewList"),init:(e,t,i,r)=>{e.attr("formid",t),ZPeopleComponents.select(e,{dataMapping:{value:"value",label:"label",title:"label",groupLabel:"optgroupLabel"},selectedValue:i,showSearchField:!0,randomDropdownListId:!0,options:ZP5ViewActions.viewSelect.getOptions(),dropdownList:{height:335,fitForElement:!0,closeOnScroll:!0},beforedropdownlistopen:e=>{let t=$(e.target);return ZP5ViewActions.viewSelect.refresh($(t)),!0},change:e=>{let t=$(e.target);FrameworkCommon.hide($(t).parents("#viewActionsContainer").find("[elem=editViewButton],[elem=viewActSeparator],[elem=deleteViewButton]")),$(t).parents("#viewActionsContainer").find("[elem=editViewButton],[elem=viewActSeparator],[elem=deleteViewButton]").off(),ZP5Views.viewSelectOnChange(e,r)},dropdownListLazyLoading:!0,isFooter:!0})},initActions:(e,t)=>{FrameworkCommon.hide(e.find("#viewActionsContainer").find("[elem=editViewButton],[elem=viewActSeparator],[elem=deleteViewButton]")),e.find("#viewActionsContainer").find("[elem=editViewButton],[elem=viewActSeparator],[elem=deleteViewButton]").off();let i=ZP5Views.getSelectedView(t),r=null==i||(null==i.isCustomView||i.isCustomView),s=null!=i&&(null!=i.isDefaultView&&i.isDefaultView);if(t!=ZPeopleComponents.select(e.find("#viewActionsContainer").find("#viewList")).getValue()&&ZPeopleComponents.select(e.find("#viewActionsContainer").find("#viewList")).setValue(t),urlFormConf.isModuleForm()&&!r&&s)return;let a=null!=i&&(null!=i.isSharedView&&(!!i.isSharedView&&!(i.ownerId===erecno)));i&&(""===i.ownerId||i.ownerId.length<=0)&&(r=!1),a&&!isSuperAdmin||(r?(FrameworkCommon.show(e.find("#viewActionsContainer").find("[elem=editViewButton]")),e.find("#viewActionsContainer").find("[elem=editViewButton]").off().on("click",null,{parentContainer:e},ZP5ViewActions.editView),FrameworkCommon.show(e.find("#viewActionsContainer").find("[elem=viewActSeparator]")),FrameworkCommon.show(e.find("#viewActionsContainer").find("[elem=deleteViewButton]")),e.find("#viewActionsContainer").find("[elem=deleteViewButton]").off().on("click",null,{parentContainer:e},ZP5ViewActions.deleteView)):(ZPeople.Module.getData().isAdmin||-1!=Layout.Page.hash.indexOf("operations/leavetracker/applications")&&ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isdataadmin)&&(FrameworkCommon.show(e.find("#viewActionsContainer").find("[elem=editViewButton]")),e.find("#viewActionsContainer").find("[elem=editViewButton]").off().on("click",null,{parentContainer:e},ZP5ViewActions.editView)))},getFooterOption:()=>({isFooter:!0,innerHTML:'<button elem="createViewButton" class="zlabel zlabel--blue zlabel--outline zlabel--medium zpl_btncnt" onclick="ZP5ViewActions.createView(event)">'+ZPI18N.getString("zp.createview")+"</button>"}),refresh:e=>{if(ZPeopleComponents.isComponent(e)&&"true"==e.attr("isChange")){let t=ZPeopleComponents.select(e).getValue();ZPeopleComponents.select(e).setAttribute("options",ZP5ViewActions.viewSelect.getOptions()),ZPeopleComponents.select(e).setAttribute("value",t),ZPeopleComponents.select(e).refresh(),e.removeAttr("isChange")}},getOptions:()=>{let e=ZPeople.Module.getData().viewDetails.message,t={},i=ZP5Views.getCurrentViewModuleHandler().systemViewName;null!=i&&(t[FormConstants.VIEW_OWNER_TYPE.PUBLIC]=[],t[FormConstants.VIEW_OWNER_TYPE.PUBLIC].push({label:i,value:"systemView",optgroupLabel:ZP5ViewActions.getOptGroupLabel(FormConstants.VIEW_OWNER_TYPE.PUBLIC)}));for(let i=0;i<e.length;i++){let r={label:ZPeople.decodeTxt(e[i].displayName+""),value:e[i].viewId+"",optgroupLabel:ZP5ViewActions.getOptGroupLabel(e[i].viewOwnerType)};t.hasOwnProperty(e[i].viewOwnerType+"")||(t[e[i].viewOwnerType+""]=[]),t[e[i].viewOwnerType+""].push(r)}let r=[];return $.each(FormConstants.VIEW_OWNER_TYPE,((e,i)=>{let s=t.hasOwnProperty(i)?t[i]:[];r.push({label:ZP5ViewActions.getOptGroupLabel(i),value:i,optgroupLabel:ZP5ViewActions.getOptGroupLabel(i),options:s})})),ZP5Views.getCurrentViewModuleHandler().isCreateViewAllowed()&&r.push(ZP5ViewActions.viewSelect.getFooterOption()),r}},init:(e,t,i)=>{e=e||!1,ZP5ViewActions.FORMID=void 0,ZP5ViewActions.VIEWID=void 0,ZP5ViewActions.FORMID=t||ZP5Views.getCurrentViewModuleHandler().getFormId(),i=i||(ZP5Views.getCurrViewObj()?ZP5Views.getCurrViewObj().getViewId():settingsUrlProps.urlParamsArr.hasOwnProperty("viewId")?settingsUrlProps.urlParamsArr.viewId:ZP5ViewActions.VIEWID),e&&(ZP5ViewActions.VIEWID=i),Layout.PageUtil.loadFiles(["tabbedlistbox.min.js"],(()=>{ZP5ViewActions.openSlider(e,ZP5ViewActions.VIEWID,ZP5ViewActions.FORMID)}))},createView:e=>{ZP5ViewActions.init(!1)},editView:e=>{ZP5ViewActions.init(!0)},deleteView:e=>{FrameworkCommon.showDeleteAlert(ZPI18N.getString("zp.delete"),ZPI18N.getString("zp.deleteconfirmmessage"),{callback:()=>{ZPeople.Request.send(ZP5ViewActions.url,{mode:"deleteView",formID:ZP5Views.getCurrViewObj().getFormId(),viewID:ZP5Views.getCurrViewObj().getViewId()},ZP5ViewActions.deleteResponse,{isDeleteView:!0},ZP5ViewActions.failureCallback)}})},failureCallback:(e,t,i)=>{let r,s=!1;(i=i||{}).isDeleteView||(r=()=>{ZP5ViewActions.Modal&&(ZP5ViewActions.Modal.remove(),delete ZP5ViewActions.Modal)}),s=ServiceApplicabilityUtil.Error.showWarningMessage(e,t,i,r),s||ZPeople.Message.warning(ZPI18N.getString("zp.rebranderrinaction"))},deleteResponse:e=>{if(void 0!==e.error)return void ZP5ViewActions.showErrorMessage(e,ZPI18N.getString("zp.errordeleteview"));ZPeople.Message.success(ZPI18N.getString("zp.viewdeletedsuccess")),ZP5ViewActions.VIEWID=e.defaultViewID,Layout.UrlConf.isModuleForm()&&(ZP5ViewActions.VIEWID="systemView");let t=ZP5Views.getSelectedView(e.deletedViewID);if(void 0!==t){let e=ZPeople.Module.getData(),i=e.viewDetails.message.indexOf(t);e.viewDetails.message.splice(i,1)}if(ZP5ViewActions.viewSelect.getObj().length>0){let e=ZPeopleComponents.select(ZP5ViewActions.viewSelect.getObj());ZP5ViewActions.viewSelect.getObj().attr("isChange",!0),e.setValue(ZP5ViewActions.VIEWID)}},openSlider:(e,t)=>{ZP5ViewActions.Modal=new sliderModal(e?ZPI18N.getString("zp.editview"):ZPI18N.getString("zp.createview"),new Tab("CreateEditViewPopup",(function(){if(ZP5ViewActions.container=ZP5ViewActions.Modal.sliderDiv.find("#cardCreateEditViewPopup"),ZP5ViewActions.Modal.sliderDiv.find("#sliderSbt").removeClass("disabled").prop("disabled",!1),0==ZP5ViewActions.Modal.sliderDiv.find("#cardCreateEditViewPopup").children().length){let e='<form><div class="zpl_crd"><div class="zpl_crdcnt" elem="modalBodyContainer">';e+='<div elem="loadingDiv">'+ZPeople.LOADING_HTML+"</div>",ZP5ViewActions.Modal.sharedViewApplicableKeys={employee:ZPI18N.getString("zp.users"),department:ZPI18N.getString("zp.departments"),role:ZPI18N.getString("zp.roles"),location:ZPI18N.getString("zp.locations")},e+=ZP5ViewActions.getSlider(),e+="</div></div></form>",ZP5ViewActions.Modal.sliderDiv.find("#cardCreateEditViewPopup").append(e),ZP5ViewActions.sharedTo.initSharedviewComponents();let t={mode:"newView",formID:ZP5ViewActions.FORMID};ZP5ViewActions.Modal.isEdit&&(t.mode="getViewDetails",t.viewID=ZP5ViewActions.VIEWID),ZPeople.Request.send(ZP5ViewActions.url,t,ZP5ViewActions.loadData,{},ZP5ViewActions.failureCallback)}}),ZP5ViewActions.save)),ZP5ViewActions.Modal.isEdit=e,e&&(ZP5ViewActions.Modal.viewId=t),ZP5ViewActions.Modal.largeSize=!0,ZP5ViewActions.Modal.construct(),FrameworkCommon.madeChanges.init("CreateEditViewPopup",ZP5ViewActions.Modal),ZP5ViewActions.Modal.setCloseCallback(ZP5ViewActions.closeSlider)},showErrorMessage:(e,t)=>{void 0!==e.error&&(void 0!==e.error.message?ZPeople.Message.failure(e.error.message):void 0!==e.error.exception&&ZPeople.Message.failure(t))},closeSlider:()=>{ZP5ViewActions.criteria.fieldOptions={},ZP5ViewActions.criteria.popoverFieldOptions.elem={},!0===ZP5ViewActions.Modal.isSuccClose&&ZP5ViewActions.Modal.isEdit&&ZP5Views.getCurrViewObj()&&(ZP5Views.refreshAllViews(ZP5ViewActions.FORMID,!0),ZP5Views.refreshview()),delete ZP5ViewActions.container,delete ZP5ViewActions.VIEWID,delete ZP5ViewActions.FORMID,ZP5ViewActions.Modal.remove(),delete ZP5ViewActions.Modal},getSlider:()=>{let e="";return e+='<div class="zpl_secn DN" viewactcont="true" elem="viewNameCont"><div><h5><label class="zpl_mtry">'+ZPI18N.getString("zp.specifyviewname")+'</label></h5></div><div><div class="zpl_idiv"><input type="text" elem="viewNameInput" class="ztextbox w300" placeholder="'+ZPI18N.getString("zp.enterviewname")+'"></div></div></div>',e+='<div class="zpl_secn DN" viewactcont="true" elem="viewConfCont"><div>',e+='<div elem="setAsDefaultViewCont" class="zcheckbox zcheckbox--horizontal"><input id="setAsDefaultView" elem="setAsDefaultView" type="checkbox" name="check" class="zcheckbox__helper"><label for="setAsDefaultView" class="zcheckbox__label">'+ZPI18N.getString("zp.setdefaultview")+"</label></div>",e+='<div elem="viewApproverDetailsCont" class="zcheckbox zcheckbox--horizontal"><input id="showApproverDetails" elem="showApproverDetails" type="checkbox" name="check" class="zcheckbox__helper"><label for="showApproverDetails" class="zcheckbox__label">'+ZPI18N.getString("zp.showApproverDetails")+"</label></div>",e+="</div></div>",e+='<div class="zpl_secn DN" viewactcont="true" elem="viewPermCont"><div><h5>'+ZPI18N.getString("zp.viewPerm")+"</h5></div><div>",e+='<div class="zradiobutton"><input elem="viewperm" permtype="self" id="viewperm_self" type="radio" checked="" name="viewperm" class="zradiobutton__helper"><label for="viewperm_self" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.onlytome")+"</span></label></div>",e+='<div class="zradiobutton"><input elem="viewperm" permtype="all" id="viewperm_all" type="radio" name="viewperm" class="zradiobutton__helper"><label for="viewperm_all" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.allowallemployeetoaccess")+"</span></label></div>",e+='<div class="zradiobutton"><input elem="viewperm" permtype="specific" id="viewperm_specific" type="radio" name="viewperm" class="zradiobutton__helper"><label for="viewperm_specific" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.specificuser")+"</span></label></div>",e+="</div></div>",e+='<div class="zpl_secn DN" elem="viewSharedToCont" init="true"><div><h5>'+ZPI18N.getString("zp.sharedto",[""])+"</h5></div>",e+='<div class="zpl_cndor" elem="sharedviewcontainer">',e+=ZP5ViewActions.sharedTo.getAppTypeDiv(),e+="</div>",e+='<div class="zpl_idiv" elem="addnewapptypediv">',e+='<a class="zpl_lnkbg" elem="addnewapptype">'+ZPI18N.getString("zp.addnew")+"</a>",e+="</div>",e+='<span class="ztextbox--error__label DNI" elem="sharedToErrorMsg"></span>',e+="</div>",e+='<div class="zpl_secn DN" viewactcont="true" ><div><div class="zpl_frmmove"><div class="zpl_frmservices" elem="viewLeftColumnsCont">',e+='<div class="zpl_frmhead"><span class="title">'+ZPI18N.getString("zp.selectcolumns")+"</span></div>",e+='<div class="zpl_frmout"><div class="zpl_ssearch DNI"><input type="text" placeholder="'+ZPI18N.getString("zp.search")+'" class="ztextbox"><i class="PI_lens"></i></div>',e+='<div elem="leftFieldContainer"><ul elem="leftFieldsListCont"></ul></div>',e+='<div elem="emptyDivContainer" class="zpl_Emptydata"><div><p>'+ZPI18N.getString("zp.nofieldspresent")+"</p></div></div>",e+="</div></div>",e+='<div class="zpl_ssmove" viewactcont="true" elem="viewCenterButtonCont"><div><button class="zlabel zlabel--outline zlabel--medium" type="button" elem="moveAllToRightButton" title="'+ZPI18N.getString("zp.movealltoright")+'"><i class="PI_dbl_argt  d-flex"></i></button></div>',e+='<div><button class="zlabel zlabel--outline zlabel--medium" type="button" elem="moveSelToRightButton" title="'+ZPI18N.getString("zp.moveselectedtoright")+'"><i class="PI_argt d-flex" ></i></button></div>',e+='<div><button class="zlabel zlabel--outline zlabel--medium" type="button" elem="moveSelToLeftButton" title="'+ZPI18N.getString("zp.moveselectedtoleft")+'"><i class="PI_alft d-flex" ></i></button></div>',e+='<div><button class="zlabel zlabel--outline zlabel--medium" type="button" elem="moveAllToLeftButton" title="'+ZPI18N.getString("zp.movealltoleft")+'"><i class="PI_dbl_alft d-flex" ></i></button></div></div>',e+='<div class="zpl_frmbenefits" viewactcont="true" elem="viewRightColumnsCont"><div class="zpl_frmhead"><span class="title"></span></div><div class="zpl_frmout">',e+='<div elem="rightFieldContainer" class="zpl_frmbenefits1"><ul class="zpl_frmullist PR" elem="rightFieldListCont"></ul></div>',e+='<div elem="emptyDivContainer" class="zpl_Emptydata"><div><p>'+ZPI18N.getString("zp.nofieldspresent")+"</p></div></div>",e+='</div><span elem="rightColErrMsg" class="ztextbox--error__label DNI" ></span></div>',e+="</div></div></div>",e+='<div class="zpl_secn DN" viewactcont="true" elem="criteriaHeaderCont"><div><h5>'+ZPI18N.getString("zp.criteria")+"</h5><p></p></div></div>",e+='<div class="zpl_secn DN" viewactcont="true" elem="criteriaBodyCont"></div>',e},loadData:(e,t,i)=>{if(void 0!==e.error)return ZP5ViewActions.showErrorMessage(e,ZPI18N.getString("zp.erroroccurredloadingpage")),void ZP5ViewActions.Modal.close();e=ZP5ViewActions.Modal.isEdit?e.viewDetails:e,ZP5ViewActions.Modal.ALL_COMPONENTS=e.formDetailsMap,ZP5ViewActions.Modal.FORM_NAME=e.formName,ZP5ViewActions.Modal.isCustomView=!(ZP5ViewActions.Modal.isEdit&&!e.isCustomView),ZP5ViewActions.Modal.hasActiveTranslation=e.shareViewToAll&&e.hasOwnProperty("hasActiveTranslation")&&e.hasActiveTranslation,ZP5ViewActions.Modal.PARENT_COMPONENTS=[],ZP5ViewActions.Modal.CHILD_COMPONENTS=[],$.each(ZP5ViewActions.Modal.ALL_COMPONENTS,(function(e,t){void 0!==t.childComponents&&Object.keys(t.childComponents).length>0&&(ZP5ViewActions.Modal.PARENT_COMPONENTS.push(t.formCompID+""),$.each(t.childComponents,(function(e,i){ZP5ViewActions.Modal.CHILD_COMPONENTS.push(t.formCompID+"_"+i.formCompID)})))})),ZP5ViewActions.Modal.isEdit&&(e.isSetAsDefaultAllowed&&"false"==e.isSetAsDefaultAllowed&&FrameworkCommon.hide(ZP5ViewActions.Modal.sliderDiv.find("[elem=setAsDefaultViewCont]")),ZP5ViewActions.loadSavedData(e)),ZP5Form.isApprovalEnabled(ZP5ViewActions.FORMID)||ZP5ViewActions.container.find("[elem=viewApproverDetailsCont]").remove(),!urlFormConf.isModuleForm()&&ZP5ViewActions.Modal.isCustomView||ZP5ViewActions.container.find("[elem=setAsDefaultViewCont]").remove();let r=ZPeople.Module.getData();null==r||r.isAdmin&&!r.viewDetails.isLocAdmin&&"P_MultiRater"!=ZP5Form.getCurrFormsOperation().getTableName()&&"P_MultiRater_Approval"!=ZP5Form.getCurrFormsOperation().getTableName()&&"P_Goals"!=ZP5Form.getCurrFormsOperation().getTableName()||ZP5ViewActions.container.find("[elem=viewPermCont],[elem=viewSharedToCont]").remove(),ZP5ViewActions.Modal.RIGHT_COMPONENTS=ZP5ViewActions.Modal.isEdit&&0!==Object.keys(e.components).length?e.components:{},ZP5ViewActions.rightColumns.init(),ZP5ViewActions.leftColumns.init(),ZP5ViewActions.Modal.isCustomView&&(ZP5ViewActions.Modal.SAVED_CRITERIA=ZP5ViewActions.Modal.isEdit&&0!==Object.keys(e.criteria).length?e.criteria:{},ZP5ViewActions.criteria.init()),ZP5ViewActions.container.find("[elem=loadingDiv]").remove(),ZP5ViewActions.container.find("[viewactcont=true]").removeClass("DN"),ZP5ViewActions.defaultActions(),ZP5ViewActions.Modal.sliderDiv.find("#sliderSbt").removeClass("disabled").prop("disabled",!1),ZP5ViewActions.Modal.hasActiveTranslation||ZP5ViewActions.container.find("[elem=viewNameCont] [elem=viewNameInput]").focus()},loadSavedData:e=>{ZP5ViewActions.container.find("[elem=viewNameCont] [elem=viewNameInput]").val(e.viewName).attr("savedvalue",e.viewName),ZP5ViewActions.Modal.hasActiveTranslation&&TranslationCommonUtil.disableInput(ZP5ViewActions.container.find("[elem=viewNameCont] [elem=viewNameInput]")),ZP5ViewActions.container.find("[elem=showApproverDetails]").prop("checked",e.show_approver);let t=ZP5Views.getSelectedView(e.viewID);void 0!==t&&(""===t.ownerId||t.ownerId.length<=0)&&(ZP5ViewActions.Modal.isCustomView=!1),ZP5ViewActions.Modal.expressionID=void 0===e.expressionID?0:e.expressionID,ZP5ViewActions.Modal.reportPermissionID=0,ZP5ViewActions.Modal.reportPermissionData={},ZP5ViewActions.Modal.isCustomView?(ZP5ViewActions.container.find("[elem=setAsDefaultView]").prop("checked",!!e.isDefaultView),ZP5ViewActions.container.find("[elem=viewPermCont] [elem=viewperm][permtype=all]").prop("checked",!!e.shareViewToAll),e.shareViewToAll||(void 0!==e.reportPermissionID&&"0"!==e.reportPermissionID?(ZP5ViewActions.Modal.reportPermissionID=e.reportPermissionID,ZP5ViewActions.Modal.reportPermissionData=e.reportPermissionData,ZP5ViewActions.container.find("[elem=viewPermCont] [elem=viewperm][permtype=specific]").prop("checked",!0),ZP5ViewActions.sharedTo.showHide(),ZP5ViewActions.sharedTo.setSharedViewOptionsForEditView()):ZP5ViewActions.container.find("[elem=viewPermCont] [elem=viewperm][permtype=self]").prop("checked",!0))):ZP5ViewActions.container.find("[elem=setAsDefaultViewCont],[elem=viewPermCont],[elem=criteriaHeaderCont],[elem=criteriaBodyCont],[elem=viewSharedToCont]").remove()},defaultActions:()=>{ZP5ViewActions.container.find("[elem=setAsDefaultViewCont] [elem=setAsDefaultView],[elem=viewApproverDetailsCont] [elem=showApproverDetails]").off("change").on("change",(e=>{FrameworkCommon.madeChanges.setOnEvent(e,ZP5ViewActions.Modal)})),ZP5ViewActions.container.find("[elem=viewPermCont] [elem=viewperm]").off("change").on("change",ZP5ViewActions.sharedTo.showHide),ZP5ViewActions.container.find("[elem=viewCenterButtonCont] [elem=moveAllToRightButton]").off("").on("click",null,{isMoveAll:!0},ZP5ViewActions.leftColumns.move),ZP5ViewActions.container.find("[elem=viewCenterButtonCont] [elem=moveSelToRightButton]").off("").on("click",null,{isMoveAll:!1},ZP5ViewActions.leftColumns.move),ZP5ViewActions.container.find("[elem=viewCenterButtonCont] [elem=moveAllToLeftButton]").off("").on("click",null,{isMoveAll:!0},ZP5ViewActions.rightColumns.move),ZP5ViewActions.container.find("[elem=viewCenterButtonCont] [elem=moveSelToLeftButton]").off("").on("click",null,{isMoveAll:!1},ZP5ViewActions.rightColumns.move),ZP5ViewActions.container.find("[elem=viewCenterButtonCont] [elem=moveSelToLeftButton]").off("").on("click",null,{isMoveAll:!1},ZP5ViewActions.rightColumns.move),ZP5ViewActions.container.find("[elem=viewNameCont] [elem=viewNameInput]").off("").on("input",(e=>{FrameworkCommon.removeError($(e.target)),FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0)}))},sharedTo:{isCompAvail:()=>ZP5ViewActions.container.find("[elem=viewSharedToCont]").length>0&&"false"==ZP5ViewActions.container.find("[elem=viewSharedToCont]").attr("init"),initComp:e=>{if(ZP5ViewActions.container.find("[elem=viewSharedToCont]").length>0&&"true"==ZP5ViewActions.container.find("[elem=viewSharedToCont]").attr("init")){let t=new Array,i=new Array,r=new Array,s=new Array;null!=e&&(t=e.hasOwnProperty("empList")&&!ZPUtil.Validation.isEmpty(e.empList)?Object.keys(e.empList):t,i=e.hasOwnProperty("deptList")&&!ZPUtil.Validation.isEmpty(e.deptList)?Object.keys(e.deptList):i,r=e.hasOwnProperty("roleList")&&!ZPUtil.Validation.isEmpty(e.roleList)?Object.keys(e.roleList):r,s=e.hasOwnProperty("locList")&&!ZPUtil.Validation.isEmpty(e.locList)?Object.keys(e.locList):s),ModuleComp.ZPPickList.consAppData({user:t,dept:i,role:r,loc:s},ZP5ViewActions.container),ZP5ViewActions.container.find("[elem=viewSharedToCont]").attr("init",!1)}},showHide:e=>{e&&FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0);let t=ZP5ViewActions.container.find("[elem=viewPermCont] [elem=viewperm][permtype=specific]").prop("checked"),i=ZP5ViewActions.container.find("[elem=viewSharedToCont]");t?i.removeClass("DN"):i.addClass("DN")},initSharedviewComponents:()=>{ZP5ViewActions.sharedTo.initSelectFieldPropsandOnClicks(),ZP5ViewActions.Modal.sliderDiv.find("[elem=addnewapptype]").off("click").on("click",ZP5ViewActions.sharedTo.addNewAppType),$.each(ZP5ViewActions.Modal.sliderDiv.find("[elem=sharedviewdispname]"),((e,t)=>{ZP5ViewActions.sharedTo.setOptionsForSharedViewDispNames(t,!0)})),ZP5ViewActions.sharedTo.initTokenFieldProps(),FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!1)},initSelectFieldPropsandOnClicks:()=>{ZPeopleComponents.select(ZP5ViewActions.Modal.sliderDiv.find("[elem=sharedviewdispname]"),ComponentsCommon.select.getProps({change:ZP5ViewActions.sharedTo.clearTokens,beforedropdownlistopen:ZP5ViewActions.sharedTo.setOptionsForSharedViewDispNames,dataMapping:{value:"Value",label:"Value",title:"Value",id:"Value"},width:"250px"})),ZP5ViewActions.Modal.sliderDiv.find("[elem=deleteapptype]").off("click").on("click",ZP5ViewActions.sharedTo.deleteAppTypeDiv)},setSharedViewOptionsForEditView:()=>{let e=1;$.each(ZP5ViewActions.Modal.reportPermissionData,(function(t,i){if(i&&i.length>0){e>1&&e<=Object.keys(ZP5ViewActions.Modal.reportPermissionData).length&&ZP5ViewActions.sharedTo.addNewAppType(!1);let r=ZP5ViewActions.sharedTo.getValueByKey(t),s=[{key:t,Value:r}],a=$(ZP5ViewActions.Modal.sliderDiv.find("[elem=sharedviewcontainer] [elem=grpContainer]").last()),n=a.find("[elem=sharedviewdispname]");ZPeopleComponents.select(n).addOption(s),ZPeopleComponents.select(n).setValue(r);let o=a.find("[elem=selectedvalues]");"employee"==t?ZPeopleComponents.tokenfield(o).setAttribute("dataMapping",{value:"erecno",text:"nameWithEmpId",informativeText:"mailId",titleText:"nameWithEmpId",id:"erecno"}):ZPeopleComponents.tokenfield(o).setAttribute("dataMapping",{id:"recID",value:"recID",text:"recName",title:"recName"}),ZPeopleComponents.tokenfield(o).setAttribute("data",i),ZPeopleComponents.tokenfield(o).setAttribute("values",i),e++}})),FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!1)},setOptionsForSharedViewDispNames:(e,t)=>{let i=e.target?e.target:e;if("true"==$(i).attr("isresetneed")){let e=[];$.each(ZP5ViewActions.Modal.sliderDiv.find("[elem=sharedviewdispname]"),((t,r)=>{$(i).val()!=$(r).val()&&e.push($(r).val())}));let r=[];$.each(ZP5ViewActions.Modal.sharedViewApplicableKeys,((t,i)=>{if("-1"==e.indexOf(i)){let e={};e.Value=i,e.KeyName=t,r.push(e)}}));let s=$(i).val();ZPeopleComponents.select(i).removeAllOptions(),ZPeopleComponents.select(i).addOption(r),1==t?ZPeopleComponents.select(i).setValue(r[0].Value):ZPeopleComponents.select(i).setValue(s),$(i).removeAttr("isresetneed")}},initTokenFieldProps:()=>{let e=ComponentsCommon.token.getProps({lazyLoading:!1,dataMapping:{id:"recID",value:"recID",text:"recName",title:"recName"},tokenadd:()=>{FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0)},tokenremove:()=>{FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0)},search:{minKeywordLength:0,highlightKeyword:!0,delay:20,showNoResultsMessage:!0},messages:{noResults:ZPI18N.getString("zp.noresults"),remove:ZPI18N.getString("zp.remove")},dropdownList:{contentType:"text-desc",sortResults:!0,fitForElement:!0,height:335},serverSearch:!0,zclassName:"zpl_maxhgt200 zpl_w400"});$.each(ZP5ViewActions.Modal.sliderDiv.find("[elem=selectedvalues]"),((t,i)=>{let r={...e};"Users"==ZPeopleComponents.select($(i).closest("[elem=grpContainer]").find("[elem=sharedviewdispname]")).getValue()&&(r.dataMapping={value:"erecno",text:"nameWithEmpId",informativeText:"mailId",titleText:"nameWithEmpId",image:"photo",id:"erecno"}),r.dataSource={search:function(e){return new Promise((function(t,r){let s={},a=$(i).closest("[elem=grpContainer]").find("[elem=sharedviewdispname]"),n=ZPeopleComponents.select(a).getValue(),o=e.query;s.conreqcsr=csrfToken;let l=ZP5ViewActions.sharedTo.getKeyNameByValue(n);"Users"==n?ZP5ViewActions.sharedTo.userSearch(s,o,t):ZP5ViewActions.sharedTo.otherAppTypeSearch(s,o,l,t)}))}},ZPeopleComponents.tokenfield(i,r)}))},userSearch:(e,t,i)=>{e.mode="SEARCH",""===t.trim()?e.isDef=!0:e.key=t,e.searchMode="SHAREDVIEW_EMP_SEARCH",e.start=1,e.searchType="emp",ZPeople.Request.sendRequest("/commonAction.zp",e,"POST",((e,t,r)=>{let s=[];e.success&&$.each(e.matches,(function(e,t){s.push(FrameworkCommon.getEmpDetailsObj(t))})),respObj={results:s,more:!1},i(respObj)}),{},(()=>{}))},otherAppTypeSearch:(e,t,i,r)=>{e.key=i,e.searchText=t,e.mode="getRecordsByKey",ZPeople.Request.sendRequest("/createViewAction.zp",e,"POST",((e,t,i)=>{let s=[];e&&e[t.key]&&(s=e[t.key]),respObj={results:s,more:!1},r(respObj)}),{},(()=>{}))},addNewAppType:e=>{let t=ZP5ViewActions.sharedTo.getAppTypeDiv(),i=$(ZP5ViewActions.Modal.sliderDiv.find("[elem=sharedviewcontainer] [elem=grpContainer]").last());i.length>0?(i.find("[elem=deleteapptype]").after('<div class="zpl_cndop" elem="contDiv"><span>'+ZPI18N.getString("zp.captialor")+"</span></div>"),i.after(t)):$(ZP5ViewActions.Modal.sliderDiv.find("[elem=sharedviewcontainer]")).append(t),ZP5ViewActions.sharedTo.initSelectFieldPropsandOnClicks();let r=$(ZP5ViewActions.Modal.sliderDiv.find("[elem=sharedviewcontainer] [elem=grpContainer]").last().find("[elem=sharedviewdispname]"));ZP5ViewActions.sharedTo.setOptionsForSharedViewDispNames(r,!0),ZP5ViewActions.sharedTo.initTokenFieldProps(),ZP5ViewActions.Modal.sliderDiv.find("[elem=sharedviewdispname]").length>=Object.keys(ZP5ViewActions.Modal.sharedViewApplicableKeys).length&&FrameworkCommon.hide(ZP5ViewActions.Modal.sliderDiv.find("[elem=addnewapptypediv]")),e&&FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0)},getAppTypeDiv:()=>{let e='<div class="zpl_gbox" elem="grpContainer">';return e+='<div class="zpl_idiv">',e+='<div><select zfctype="select" class="select-js" elem="sharedviewdispname" isresetneed="true">',e+="</select></div>",e+='<div><select zfctype="tokenfield" data-width="400" elem="selectedvalues" class="ztokenfield"></select></div>',e+='<div elem="deleteapptype"><i class="PI_delete"></i></div>',e+="</div>",e+="</div>",'<div class="zpl_gbox" elem="grpContainer"><div class="zpl_idiv"><div><select zfctype="select" class="select-js" elem="sharedviewdispname" isresetneed="true"></select></div><div><select zfctype="tokenfield" data-width="400" elem="selectedvalues" class="ztokenfield"></select></div><div elem="deleteapptype"><i class="PI_delete"></i></div></div></div>'},deleteAppTypeDiv:()=>{$(event.currentTarget).closest("[elem=grpContainer]").remove(),$(ZP5ViewActions.Modal.sliderDiv.find("[elem=sharedviewcontainer] [elem=grpContainer]").last().find("[elem=contDiv]")).remove(),ZP5ViewActions.Modal.sliderDiv.find("[elem=sharedviewdispname]").length<Object.keys(ZP5ViewActions.Modal.sharedViewApplicableKeys).length&&FrameworkCommon.show(ZP5ViewActions.Modal.sliderDiv.find("[elem=addnewapptypediv]")),0==ZP5ViewActions.Modal.sliderDiv.find("[elem=sharedviewdispname]").length&&ZP5ViewActions.sharedTo.addNewAppType(!1),$.each(ZP5ViewActions.Modal.sliderDiv.find("[elem=sharedviewdispname]"),((e,t)=>{$(t).attr("isresetneed","true")})),FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0)},clearTokens:e=>{if($.each(ZP5ViewActions.Modal.sliderDiv.find("[elem=sharedviewdispname]"),((e,t)=>{$(t).attr("isresetneed","true")})),ComponentsCommon.isUIEvent(e)){FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0);let t=$(e.target).closest("[elem=grpContainer]");ZPeopleComponents.tokenfield(t.find("select[elem=selectedvalues]")).removeAllTokens(),ZPeopleComponents.tokenfield(t.find("select[elem=selectedvalues]")).clearCache(),"Users"==ZPeopleComponents.select(t.find("[elem=sharedviewdispname]")).getValue()?ZPeopleComponents.tokenfield(t.find("select[elem=selectedvalues]")).setAttribute("dataMapping",{value:"erecno",text:"nameWithEmpId",informativeText:"mailId",titleText:"nameWithEmpId",id:"erecno"}):ZPeopleComponents.tokenfield(t.find("select[elem=selectedvalues]")).setAttribute("dataMapping",{id:"recID",value:"recID",text:"recName",title:"recName"})}},getKeyNameByValue:e=>{for(let t in ZP5ViewActions.Modal.sharedViewApplicableKeys)if(ZP5ViewActions.Modal.sharedViewApplicableKeys[t]==e)return t;return""},getValueByKey:e=>{for(let t in ZP5ViewActions.Modal.sharedViewApplicableKeys)if(e==t)return ZP5ViewActions.Modal.sharedViewApplicableKeys[t];return""},isAnyApplicabilitySelected:()=>{let e=!1;return $.each(ZP5ViewActions.Modal.sliderDiv.find("[elem=selectedvalues]"),((t,i)=>{if(options=ZPeopleComponents.tokenfield(i).getAllValues(),options.length>0)return e=!0,!1})),e},getSharedViewApplicability:e=>{$.each(ZP5ViewActions.Modal.sliderDiv.find("[elem=sharedviewdispname]"),((t,i)=>{let r=ZPeopleComponents.select(i).getValue(),s=ZP5ViewActions.sharedTo.getKeyNameByValue(r),a=$(i).closest("[elem=grpContainer]").find("[elem=selectedvalues]"),n=[],o=ZPeopleComponents.tokenfield(a).getAllValues();if(o&&o.length>0)if("employee"==s)for(let e=0;e<o.length;e++)n.push(o[e].erecno);else for(let e=0;e<o.length;e++)n.push(o[e].recID);e[s]=n.toString()}))}},components:{getFieldData:e=>void 0!==e?-1!==e.indexOf("_")?ZP5ViewActions.Modal.ALL_COMPONENTS[e.split("_")[0]].childComponents[e.split("_")[1]]:ZP5ViewActions.Modal.ALL_COMPONENTS[e+""]:{},getChildFields:e=>void 0!==e&&"0"!==e&&ZP5ViewActions.components.isParentComponent(e)?ZP5ViewActions.components.getFieldData(e+"").childComponents:{},getAllComponents:()=>ZP5ViewActions.Modal.ALL_COMPONENTS,getParentComponents:()=>ZP5ViewActions.Modal.PARENT_COMPONENTS,isBaseFormComponent:e=>ZP5ViewActions.Modal.ALL_COMPONENTS.hasOwnProperty(e+""),isParentComponent:e=>$.inArray(e+"",ZP5ViewActions.Modal.PARENT_COMPONENTS)>-1,isChildComponent:e=>$.inArray(e+"",ZP5ViewActions.Modal.CHILD_COMPONENTS)>-1,getParentFormCompName:e=>void 0!==e&&"0"!==e?ZP5ViewActions.components.getFieldData(e+"").formCompName:"",getOriginalDispName:e=>void 0!==e?ZP5ViewActions.components.getFieldData(e+"").formCompName:"",getSavedDispName:e=>{if(ZP5ViewActions.Modal.RIGHT_COMPONENTS.hasOwnProperty(e+"")){return ZP5ViewActions.Modal.RIGHT_COMPONENTS[e+""].displayName}}},leftColumns:{init:()=>{ZP5ViewActions.Modal.leftFieldList=[],ZP5ViewActions.leftColumns.getData(ZP5ViewActions.components.getAllComponents()),ZP5ViewActions.leftColumns.format(),ZP5ViewActions.leftColumns.construct()},getData:(e,t)=>{let i;i=t?ZPUtil.sortByJSONValue(e.childComponents,"formCompID",!0):ZPUtil.sortByJSONValue(e,"formCompID",!0),$.each(i,(function(i,r){t?ZP5ViewActions.Modal.leftFieldList.push(e.formCompID+"_"+r.formCompID):ZP5ViewActions.Modal.leftFieldList.push(r.formCompID+""),ZP5ViewActions.components.isParentComponent(r.formCompID)&&ZP5ViewActions.leftColumns.getData(r,!0)}))},getSingleElem:(e,t,i)=>'<li elem="fieldDiv" fieldid="'+e+'" ischild="'+i+'" parentfcid="'+t.parentFCID+'" elemposition="left" ><a>'+ZSEC.Encoder.encodeForHTML(t.formCompName)+"</a></li>",getParentElem:e=>{let t='<li elem="fieldDiv" isparentfield="true" fieldid="'+e.formCompID+'" parentfcid="'+e.parentFCID+'" elemposition="left" ><a elem="leftColToggleIcon"><i class="PI_abtm"></i>'+ZSEC.Encoder.encodeForHTML(e.formCompName)+"</a>";t+='<div><ul parentfcid="'+e.formCompID+'" class="list-group" >';let i=ZPUtil.sortByJSONValue(e.childComponents,"formCompID",!0);return $.each(i,((i,r)=>{ZP5ViewActions.leftColumns.isPresent(e.formCompID+"_"+r.formCompID)&&(t+=ZP5ViewActions.leftColumns.getSingleElem(e.formCompID+"_"+r.formCompID,r,!0))})),t+="</ul></div></li>",t},construct:()=>{let e="",t=ZPUtil.sortByJSONValue(ZP5ViewActions.components.getAllComponents(),"formCompID",!0);$.each(t,((t,i)=>{ZP5ViewActions.leftColumns.isPresent(i.formCompID)&&(ZP5ViewActions.components.isParentComponent(i.formCompID)?e+=ZP5ViewActions.leftColumns.getParentElem(i):e+=ZP5ViewActions.leftColumns.getSingleElem(i.formCompID,i,!1))})),ZP5ViewActions.container.find("[elem=viewLeftColumnsCont] [elem=leftFieldsListCont]").html(e),ZP5ViewActions.leftColumns.defaultActions()},format:()=>{$.each(ZP5ViewActions.Modal.rightFieldList,(function(e,t){if(ZP5ViewActions.leftColumns.isPresent(t)){if(ZP5ViewActions.components.isParentComponent(t))return!0;ZP5ViewActions.leftColumns.splice(t)}})),$.each(ZP5ViewActions.components.getParentComponents(),(function(e,t){let i=!0;$.each(ZP5ViewActions.components.getChildFields(t),(function(e,r){if(ZP5ViewActions.leftColumns.isPresent(t+"_"+r.formCompID))return i=!1,!1})),i&&ZP5ViewActions.leftColumns.splice(t)}))},isPresent:e=>$.inArray(e+"",ZP5ViewActions.Modal.leftFieldList)>-1,splice:e=>{let t=$.inArray(e+"",ZP5ViewActions.Modal.leftFieldList);ZP5ViewActions.Modal.leftFieldList.splice(t,1)},select:e=>{let t=$(e.target).closest("[elem=fieldDiv][elemposition=left]"),i=!0;ZP5ViewActions.components.isParentComponent(t.attr("fieldid"))&&ZP5ViewActions.rightColumns.isPresent(t.attr("fieldid"))&&(i=!1),i?$(e.target).closest("[elem=fieldDiv][elemposition=left]").toggleClass("active"):$(e.target).closest("[elem=fieldDiv][elemposition=left]").removeClass("active"),e.stopPropagation()},dropOpenField:e=>{$(e.target).closest("li[elem=fieldDiv][isparentfield=true]").toggleClass("zpl_drpopen"),e.stopPropagation()},getList:e=>{let t=[],i=ZP5ViewActions.container.find("[elem=leftFieldsListCont] li[elem=fieldDiv][elemposition=left]");return i=e?$(i).not("[ischild=true]"):$(i).filter(".active"),$.each(i,((e,i)=>{t.push($(i).attr("fieldid"))})),t},defaultActions:()=>{ZP5ViewActions.container.find("[elem=viewLeftColumnsCont] [elem=leftFieldsListCont] [elem=leftColToggleIcon]").off().on("click",ZP5ViewActions.leftColumns.dropOpenField),ZP5ViewActions.container.find("[elem=leftFieldsListCont] li[elem=fieldDiv][elemposition=left]").off("").on("click",ZP5ViewActions.leftColumns.select),ZP5ViewActions.leftColumns.emptyCheck(),ZP5ViewActions.disableEnableMoveButtons.rightMoveCheck()},emptyCheck:()=>{0==ZP5ViewActions.container.find("[elem=viewLeftColumnsCont] li[elem=fieldDiv]").length?(FrameworkCommon.hide(ZP5ViewActions.container.find("[elem=viewLeftColumnsCont] [elem=leftFieldContainer]")),FrameworkCommon.show(ZP5ViewActions.container.find("[elem=viewLeftColumnsCont] [elem=emptyDivContainer]"))):(FrameworkCommon.hide(ZP5ViewActions.container.find("[elem=viewLeftColumnsCont] [elem=emptyDivContainer]")),FrameworkCommon.show(ZP5ViewActions.container.find("[elem=viewLeftColumnsCont] [elem=leftFieldContainer]")))},move:e=>{ZP5ViewActions.disableEnableMoveButtons.disableAll(!0);let t=e.data.hasOwnProperty("isMoveAll")&&e.data.isMoveAll,i=ZP5ViewActions.leftColumns.getList(t);if(0==i.length)return void ZP5ViewActions.disableEnableMoveButtons.check();FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0),$.each(i,((e,t)=>{if(ZP5ViewActions.leftColumns.isPresent(t)&&(ZP5ViewActions.components.isParentComponent(t)||ZP5ViewActions.leftColumns.splice(t),!ZP5ViewActions.rightColumns.isPresent(t))){ZP5ViewActions.Modal.rightFieldList.push(t);let e=ZP5ViewActions.components.getFieldData(t);ZP5ViewActions.Modal.rightFieldExtraDets[t+""]={parentFCID:e.parentFCID,refFormID:e.refFormID}}}));let r=ZP5ViewActions.leftColumns.getOpenStateFields();ZP5ViewActions.rightColumns.construct(),ZP5ViewActions.leftColumns.format(),ZP5ViewActions.leftColumns.construct(),ZP5ViewActions.leftColumns.setOpenStateFields(r),ZP5ViewActions.leftColumns.emptyCheck(),ZP5ViewActions.disableEnableMoveButtons.check()},getOpenStateFields:()=>{let e=[];return $.each(ZP5ViewActions.container.find("[elem=leftFieldsListCont] li[elem=fieldDiv][elemposition=left][isparentfield=true]"),((t,i)=>{$(i).hasClass("zpl_drpopen")&&e.push($(i).attr("fieldid"))})),e},setOpenStateFields:e=>{let t=ZP5ViewActions.container.find("[elem=leftFieldsListCont] ");$.each(e,((e,i)=>{t.find("li[elem=fieldDiv][elemposition=left][isparentfield=true][fieldid="+i+"]").addClass("zpl_drpopen")}))}},disableEnableMoveButtons:{disableAll:()=>{let e=ZP5ViewActions.container.find("[elem=viewCenterButtonCont]").find("[elem=moveAllToRightButton],[elem=moveSelToRightButton],[elem=moveAllToLeftButton],[elem=moveSelToLeftButton]");ZP5ViewActions.disableEnableMoveButtons.do(e,!0)},do:(e,t)=>{t?e.addClass("disabled").prop("disabled",!0):e.removeClass("disabled").prop("disabled",!1)},check:()=>{ZP5ViewActions.disableEnableMoveButtons.leftMoveCheck(),ZP5ViewActions.disableEnableMoveButtons.rightMoveCheck()},leftMoveCheck:()=>{ZP5ViewActions.disableEnableMoveButtons.do(ZP5ViewActions.container.find("[elem=viewCenterButtonCont]").find("[elem=moveAllToLeftButton]"),0==ZP5ViewActions.container.find("[elem=viewRightColumnsCont] li[elem=fieldDiv]").length),ZP5ViewActions.disableEnableMoveButtons.do(ZP5ViewActions.container.find("[elem=viewCenterButtonCont]").find("[elem=moveSelToLeftButton]"),0==ZP5ViewActions.container.find("[elem=viewRightColumnsCont] li[elem=fieldDiv]").length)},rightMoveCheck:()=>{ZP5ViewActions.disableEnableMoveButtons.do(ZP5ViewActions.container.find("[elem=viewCenterButtonCont]").find("[elem=moveAllToRightButton]"),0==ZP5ViewActions.leftColumns.getList(!0).length),ZP5ViewActions.disableEnableMoveButtons.do(ZP5ViewActions.container.find("[elem=viewCenterButtonCont]").find("[elem=moveSelToRightButton]"),0==ZP5ViewActions.container.find("[elem=viewLeftColumnsCont] li[elem=fieldDiv]").length)}},rightColumns:{init:()=>{ZP5ViewActions.Modal.rightFieldExtraDets={},ZP5ViewActions.Modal.rightFieldList=[];let e=ZPUtil.sortByJSONValue(ZP5ViewActions.Modal.RIGHT_COMPONENTS,"sequenceNo",!0);ZP5ViewActions.rightColumns.getData(e,!0),ZP5ViewActions.rightColumns.construct()},getData:e=>{null!=e&&$.each(e,(function(e,t){ZP5ViewActions.Modal.rightFieldList.push(t.referredKey+""),ZP5ViewActions.Modal.rightFieldExtraDets[t.referredKey+""]={displayName:t.displayName,parentFCID:t.parentFCID,refFormID:t.refFormID,sumEnabled:t.sumEnabled,sorting:t.sorting,grouping:t.grouping}}))},construct:()=>{let e="";$.each(ZP5ViewActions.Modal.rightFieldList,(function(t,i){e+=ZP5ViewActions.rightColumns.getSingleElem(i,ZP5ViewActions.Modal.rightFieldExtraDets[i])})),ZP5ViewActions.container.find("[elem=viewRightColumnsCont] [elem=rightFieldListCont]").html(e),ZP5ViewActions.rightColumns.sortFields(),ZP5ViewActions.rightColumns.defaultActions()},getSingleElem:(e,t)=>{let i=!1,r="";void 0!==t.parentFCID&&"0"!==t.parentFCID&&(i=!0,r=ZP5ViewActions.components.getParentFormCompName(t.parentFCID));let s=!1,a=t.displayName,n=ZP5ViewActions.components.getOriginalDispName(e);return a&&a!=n||(a=n,s=!0),'<li elem="fieldDiv" fieldid="'+e+'" parentfcid="'+t.parentFCID+'" refformid="'+t.refFormID+'" elemposition="right" ><div><div><i class="PI_drag" elem="dragIcon"></i><span elem="displayName" elemtype="view">'+ZSEC.Encoder.encodeForHTML(a)+'</span><input elem="displayNameInput" elemtype="edit" type="text" class="zpl_inlinput DNI" value="'+ZSEC.Encoder.encodeForHTML(a)+'" savedvalue="'+ZSEC.Encoder.encodeForHTML(a)+'"><div class="zpl_snlact DNI" elemtype="edit"  elem="dispNameChangeActions"><i class="PI_tick" elem="DNC_saveIcon"></i><i class="PI_cls" elem="DNC_closeIcon"></i></div>'+(i?'<span elem="referredFormName" elemtype="view" class="zpl_readonly"><i class="PI_alft"></i>'+ZSEC.Encoder.encodeForHTML(r)+"</span>":"")+ZP5ViewActions.rightColumns.getActionsElem(e,t.sorting,t.grouping,t.sumEnabled)+'</div><div elem="originalDispName" elemtype="view" class="zpl_frmfldname">'+(s?"":ZSEC.Encoder.encodeForHTML(n))+'</div><div elem="errorMessageDiv" elemtype="edit" class="zpl_frmfldname"><span class="ztextbox--error__label"></span></div></div></li>'},getActionsElem:(e,t,i,r)=>{let s=ZP5ViewActions.components.getFieldData(e),a='<div class="zpl_frmnum" elem="actionsButtonDiv" elemtype="view">';if(ZP5ViewActions.Modal.isCustomView&&s&&s.grpRequired){let e=!(void 0===i||!i||i.length>0);a+='<a class="'+(e?"zpl_dsc":"zpl_asc")+'" elem="viewGroupIcon" value="'+e+'">'+ZPI18N.getString("zp.capitalgrp")+' <i elem="viewGroupCloseIcon"></i></a>';let r=!(void 0===t||t.length<=0);a+='<a class="'+(r?"zpl_dsc":"zpl_asc")+'" elem="viewSortIcon" value="'+(r?t?"ASC":"DESC":"")+'">'+(r&&!t?ZPI18N.getString("zp.capitaldesc"):ZPI18N.getString("zp.capitalasc"))+' <i elem="viewSortCloseIcon"></i></a>'}return void 0!==s&&s.sumRequired&&(a+='<a class="'+(1==r?"zpl_dsc":"zpl_asc")+'" elem="viewSumIcon" value="'+r+'">'+ZPI18N.getString("zp.capitalsum")+' <i elem="viewSumCloseIcon"></i></a>'),a+='<div class="zpl_hvr">',a+='<i class="PI_edt" elem="editIcon"></i>',a+='<i class="PI_delete" elem="deleteIcon"></i>',a+="</div></div>",a},isPresent:e=>$.inArray(e+"",ZP5ViewActions.Modal.rightFieldList)>-1,getList:e=>{let t=[],i=ZP5ViewActions.container.find("[elem=rightFieldListCont] li[elem=fieldDiv][elemposition=right]");return e||(i=$(i).filter(".active")),$.each(i,((e,i)=>{t.push($(i).attr("fieldid"))})),t},move:e=>{ZP5ViewActions.disableEnableMoveButtons.disableAll(!0);let t=[];if(e.data.hasOwnProperty("isSingleElem")&&e.data.isSingleElem)e.stopPropagation(),t.push($(e.target).closest("[elem=fieldDiv]").attr("fieldid"));else{let i=e.data.hasOwnProperty("isMoveAll")&&e.data.isMoveAll;t=ZP5ViewActions.rightColumns.getList(i)}0!=t.length?(FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0),$.each(t,((e,t)=>{ZP5ViewActions.rightColumns.isPresent(t)&&(ZP5ViewActions.rightColumns.splice(t),ZP5ViewActions.leftColumns.isPresent(t+"")||ZP5ViewActions.Modal.leftFieldList.push(t+""))})),ZP5ViewActions.rightColumns.construct(),ZP5ViewActions.leftColumns.format(),ZP5ViewActions.leftColumns.construct(),ZP5ViewActions.rightColumns.emptyCheck(),ZP5ViewActions.disableEnableMoveButtons.check()):ZP5ViewActions.disableEnableMoveButtons.check()},splice:e=>{let t=$.inArray(e+"",ZP5ViewActions.Modal.rightFieldList);ZP5ViewActions.Modal.rightFieldList.splice(t,1),delete ZP5ViewActions.Modal.rightFieldExtraDets[e+""]},select:e=>{$(e.target).closest("[elem=fieldDiv][elemposition=right]").toggleClass("active"),e.stopPropagation()},defaultActions:()=>{ZP5ViewActions.rightColumns.emptyCheck(),ZP5ViewActions.disableEnableMoveButtons.leftMoveCheck(),FWComponentsCommon.sortable.refresh(ZP5ViewActions.container.find("[elem=viewRightColumnsCont] [elem=rightFieldListCont]")),ZP5ViewActions.container.find("[elem=rightFieldListCont] li[elem=fieldDiv][elemposition=right]").off("click").on("click",ZP5ViewActions.rightColumns.select),ZP5ViewActions.container.find("[elem=rightFieldListCont] li[elem=fieldDiv][elemposition=right] [elem=deleteIcon]").off("click").on("click",null,{isSingleElem:!0},ZP5ViewActions.rightColumns.move),ZP5ViewActions.rightColumns.editAction.defaultActions(),ZP5ViewActions.rightColumns.sortAction.defaultActions(),ZP5ViewActions.rightColumns.groupAction.defaultActions(),ZP5ViewActions.rightColumns.sumAction.defaultActions()},emptyCheck:()=>{0==ZP5ViewActions.container.find("[elem=viewRightColumnsCont] li[elem=fieldDiv]").length?(FrameworkCommon.hide(ZP5ViewActions.container.find("[elem=viewRightColumnsCont] [elem=rightFieldContainer]")),FrameworkCommon.show(ZP5ViewActions.container.find("[elem=viewRightColumnsCont] [elem=emptyDivContainer]"))):(FrameworkCommon.hide(ZP5ViewActions.container.find("[elem=viewRightColumnsCont] [elem=emptyDivContainer]")),FrameworkCommon.show(ZP5ViewActions.container.find("[elem=viewRightColumnsCont] [elem=rightFieldContainer]")))},sortFields:()=>{let e=ZP5ViewActions.container.find("[elem=viewRightColumnsCont] [elem=rightFieldListCont]");FWComponentsCommon.sortable.init(e,{containment:e,handle:e.find("[elem=dragIcon]"),items:"[elem=fieldDiv][elemposition=right]",update:function(e,t){ZP5ViewActions.Modal.rightFieldList=[],$.each(ZP5ViewActions.container.find("[elem=rightFieldListCont] li[elem=fieldDiv][elemposition=right]"),((e,t)=>{ZP5ViewActions.Modal.rightFieldList.push($(t).attr("fieldid")+"")})),FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0)}})},editAction:{open:e=>{e.stopPropagation();let t=$(e.target).closest("[elem=fieldDiv]");FrameworkCommon.hide($(t).find("[elemtype=view]")),FrameworkCommon.show($(t).find("[elemtype=edit]")),$(t).find("[elem=displayNameInput]").focus()},save:e=>{e.stopPropagation(),FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0);let t=$(e.target).closest("[elem=fieldDiv]"),i=$(t).find("[elem=displayNameInput]").val();if($(t).find("[elem=displayNameInput]").removeClass("ztextbox__error"),$(t).find("[elem=errorMessageDiv] span").html(""),ZPUtil.Validation.isEmpty(i)||i.trim().length>200)return e.preventDefault(),$(t).find("[elem=displayNameInput]").addClass("ztextbox__error"),void $(t).find("[elem=errorMessageDiv] span").html(ZPUtil.Validation.isEmpty(i)?ZPI18N.getString("zp.relformerrmsg"):ZPI18N.getString("zp.displaynamelength",[200]));let r=ZP5ViewActions.components.getOriginalDispName(t.attr("fieldid"));$(t).find("[elem=displayName]").html(ZSEC.Encoder.encodeForHTML(i)),i==r?($(t).find("[elem=originalDispName]").html(""),delete ZP5ViewActions.Modal.rightFieldExtraDets[t.attr("fieldid")+""].displayName):($(t).find("[elem=originalDispName]").html(ZSEC.Encoder.encodeForHTML(r)),ZP5ViewActions.Modal.rightFieldExtraDets[t.attr("fieldid")+""].displayName=i),$(t).find("[elem=displayNameInput]").attr("value",i).attr("savedvalue",i),FrameworkCommon.show($(t).find("[elemtype=view]")),FrameworkCommon.hide($(t).find("[elemtype=edit]"))},close:e=>{e.stopPropagation();let t=$(e.target).closest("[elem=fieldDiv]");$(t).find("[elem=displayNameInput]").removeClass("ztextbox__error"),$(t).find("[elem=errorMessageDiv] span").html("");let i=$(t).find("[elem=displayNameInput]").attr("savedvalue");$(t).find("[elem=displayNameInput]").attr("value",i).attr("savedvalue",i).val(i),FrameworkCommon.show($(t).find("[elemtype=view]")),FrameworkCommon.hide($(t).find("[elemtype=edit]"))},defaultActions:()=>{ZP5ViewActions.container.find("[elem=fieldDiv][elemposition=right] [elem=editIcon]").off("click").on("click",ZP5ViewActions.rightColumns.editAction.open),ZP5ViewActions.container.find("[elem=fieldDiv][elemposition=right] [elem=DNC_saveIcon]").off("mousedown").on("mousedown",ZP5ViewActions.rightColumns.editAction.save),ZP5ViewActions.container.find("[elem=fieldDiv][elemposition=right] [elem=DNC_closeIcon]").off("mousedown").on("mousedown",ZP5ViewActions.rightColumns.editAction.close),ZP5ViewActions.container.find("[elem=fieldDiv][elemposition=right] [elem=displayNameInput]").off("blur").on("blur",ZP5ViewActions.rightColumns.editAction.close)}},sortAction:{set:e=>{e.stopPropagation(),FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0);let t=$(e.target).closest("[elem=fieldDiv]"),i=ZP5ViewActions.components.getFieldData(t.attr("fieldid"));ZP5ViewActions.Modal.isCustomView&&i&&i.grpRequired&&($(t).find("[elem=viewSortIcon]").hasClass("zpl_dsc")?"ASC"==$(t).find("[elem=viewSortIcon]").attr("value")?($(t).find("[elem=viewSortIcon]").attr("value","DESC"),$(t).find("[elem=viewSortIcon]").html(ZPI18N.getString("zp.capitaldesc")+'<i elem="viewSortCloseIcon"></i>'),ZP5ViewActions.Modal.rightFieldExtraDets[t.attr("fieldid")+""].sorting=!1):($(t).find("[elem=viewSortIcon]").attr("value","ASC"),$(t).find("[elem=viewSortIcon]").html(ZPI18N.getString("zp.capitalasc")+'<i elem="viewSortCloseIcon"></i>'),ZP5ViewActions.Modal.rightFieldExtraDets[t.attr("fieldid")+""].sorting=!0):($(t).find("[elem=viewSortIcon]").removeClass("zpl_asc"),$(t).find("[elem=viewSortIcon]").addClass("zpl_dsc"),$(t).find("[elem=viewSortIcon]").attr("value",ZPI18N.getString("zp.capitalasc")),$(t).find("[elem=viewSortIcon]").html(ZPI18N.getString("zp.capitalasc")+'<i elem="viewSortCloseIcon"></i>'),ZP5ViewActions.Modal.rightFieldExtraDets[t.attr("fieldid")+""].sorting=!0),ZP5ViewActions.rightColumns.sortAction.defaultActions())},remove:e=>{e.stopPropagation(),FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0);let t=$(e.target).closest("[elem=fieldDiv]"),i=(ZP5ViewActions.components.getFieldData(t.attr("fieldid")),ZP5ViewActions.Modal.rightFieldExtraDets[t.attr("fieldid")+""]);i.hasOwnProperty("grouping")&&i.grouping||$(t).find("[elem=viewSortIcon]").hasClass("zpl_asc")||($(t).find("[elem=viewSortIcon]").addClass("zpl_asc"),$(t).find("[elem=viewSortIcon]").removeClass("zpl_dsc"),$(t).find("[elem=viewSortIcon]").attr("value",""),$(t).find("[elem=viewSortIcon]").html(ZPI18N.getString("zp.capitalasc")),delete ZP5ViewActions.Modal.rightFieldExtraDets[t.attr("fieldid")+""].sorting)},defaultActions:()=>{ZP5ViewActions.container.find("[elem=fieldDiv][elemposition=right] [elem=viewSortIcon]").off("click").on("click",ZP5ViewActions.rightColumns.sortAction.set),ZP5ViewActions.container.find("[elem=fieldDiv][elemposition=right] [elem=viewSortCloseIcon]").off("click").on("click",ZP5ViewActions.rightColumns.sortAction.remove)}},groupAction:{set:e=>{e.stopPropagation(),FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0);let t=$(e.target).closest("[elem=fieldDiv]"),i=ZP5ViewActions.components.getFieldData(t.attr("fieldid"));ZP5ViewActions.Modal.isCustomView&&i&&i.grpRequired&&!$(t).find("[elem=viewGroupIcon]").hasClass("zpl_dsc")&&($(t).find("[elem=viewGroupIcon]").removeClass("zpl_asc"),$(t).find("[elem=viewGroupIcon]").addClass("zpl_dsc"),$(t).find("[elem=viewGroupIcon]").attr("value",ZPI18N.getString("zp.capitalgrp")),ZP5ViewActions.Modal.rightFieldExtraDets[t.attr("fieldid")+""].grouping=!0,$(t).find("[elem=viewSortIcon]").hasClass("zpl_asc")&&ZP5ViewActions.rightColumns.sortAction.set(e))},remove:e=>{e.stopPropagation(),FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0);let t=$(e.target).closest("[elem=fieldDiv]");ZP5ViewActions.components.getFieldData(t.attr("fieldid"));$(t).find("[elem=viewGroupIcon]").hasClass("zpl_asc")||($(t).find("[elem=viewGroupIcon]").addClass("zpl_asc"),$(t).find("[elem=viewGroupIcon]").removeClass("zpl_dsc"),$(t).find("[elem=viewGroupIcon]").attr("value",""),ZP5ViewActions.Modal.rightFieldExtraDets[t.attr("fieldid")+""].grouping=!1)},defaultActions:()=>{ZP5ViewActions.container.find("[elem=fieldDiv][elemposition=right] [elem=viewGroupIcon]").off("click").on("click",ZP5ViewActions.rightColumns.groupAction.set),ZP5ViewActions.container.find("[elem=fieldDiv][elemposition=right] [elem=viewGroupCloseIcon]").off("click").on("click",ZP5ViewActions.rightColumns.groupAction.remove)}},sumAction:{set:e=>{e.stopPropagation(),FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0);let t=$(e.target).closest("[elem=fieldDiv]"),i=ZP5ViewActions.components.getFieldData(t.attr("fieldid"));void 0!==i&&i.sumRequired&&!$(t).find("[elem=viewSumIcon]").hasClass("zpl_dsc")&&($(t).find("[elem=viewSumIcon]").removeClass("zpl_asc"),$(t).find("[elem=viewSumIcon]").addClass("zpl_dsc"),$(t).find("[elem=viewSumIcon]").attr("value",ZPI18N.getString("zp.capitalsum")),ZP5ViewActions.Modal.rightFieldExtraDets[t.attr("fieldid")+""].sumEnabled=!0)},remove:e=>{e.stopPropagation(),FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0);let t=$(e.target).closest("[elem=fieldDiv]");ZP5ViewActions.components.getFieldData(t.attr("fieldid"));$(t).find("[elem=viewSumIcon]").hasClass("zpl_asc")||($(t).find("[elem=viewSumIcon]").addClass("zpl_asc"),$(t).find("[elem=viewSumIcon]").removeClass("zpl_dsc"),$(t).find("[elem=viewSumIcon]").attr("value",""),ZP5ViewActions.Modal.rightFieldExtraDets[t.attr("fieldid")+""].sumEnabled=!1)},defaultActions:()=>{ZP5ViewActions.container.find("[elem=fieldDiv][elemposition=right] [elem=viewSumIcon]").off("click").on("click",ZP5ViewActions.rightColumns.sumAction.set),ZP5ViewActions.container.find("[elem=fieldDiv][elemposition=right] [elem=viewSumCloseIcon]").off("click").on("click",ZP5ViewActions.rightColumns.sumAction.remove)}}},criteria:{criteriaCnt:0,fieldOptions:{},init:()=>{ZP5ViewActions.criteria.load(),ZP5ViewActions.criteria.defaultActions()},getFieldData:(e,t)=>{let i=e;return t&&"-1"!=t&&(i=t+"_"+e),ZP5ViewActions.components.getFieldData(i)},load:()=>{if(ZP5ViewActions.criteria.criteriaCnt=0,0!==Object.keys(ZP5ViewActions.Modal.SAVED_CRITERIA).length&&$.each(ZP5ViewActions.Modal.SAVED_CRITERIA,(function(e,t){let i=t.formComponentID,r=t.lookupFcId;if(!ZP5ViewActions.components.isBaseFormComponent(i))return!0;fieldObj=ZP5ViewActions.components.getFieldData(i);let s=i,a=-1;if(null!=r&&!t.isBaseForm){if(!fieldObj.childComponents.hasOwnProperty(r+""))return!0;fieldObj=fieldObj.childComponents[r],a=i,s=r}let n=fieldObj.fcType,o=t.Operator,l=t.CrtVal;ZP5ViewActions.container.find("[elem=criteriaBodyCont]").append(ZP5ViewActions.criteria.construct());let d=ZP5ViewActions.container.find("[elem=criteriaBodyCont]").find("[elem=criteriaDiv]:last");0!==ZP5ViewActions.criteria.criteriaCnt&&ZPeopleComponents.select($(d).find("[elem=criteriaConj]")).setValue(t.conjunctiveCondn);let p={fcid:s,parentfcid:a};$(d).find("[elem=criteriaField]").attr(p),ZP5ViewActions.criteria.popoverFieldOptions.init($(d).find("[elem=criteriaField]")),ZP5ViewActions.criteria.popoverFieldOptions.setValues($(d).find("[elem=criteriaField]"),p),ZPeopleComponents.select($(d).find("[elem=criteriaOper]")).setValue(o),ZP5ViewActions.criteria.onOperatorChange($(d).find("[elem=criteriaOper]")),n!=FormConstants.FieldType.LOOKUP&&n!=FormConstants.FieldType.PICKLIST&&n!=FormConstants.FieldType.NEW_GENDER&&n!=FormConstants.FieldType.NEW_BLOODGROUP&&n!=FormConstants.FieldType.NEW_COUNTRY||o!=FormConstants.Criteria.OPERATORS.IN&&o!=FormConstants.Criteria.OPERATORS.NOT_IN?$(d).find("[elem=criteriaValue]").prop("disabled")||(n==FormConstants.FieldType.DATE||n==FormConstants.FieldType.FORMULA_DATE?ZPeopleComponents.datefield($(d).find("[elem=criteriaValue]")).setValue(l):n==FormConstants.FieldType.DATE_TIME?ZPeopleComponents.datetimefield($(d).find("[elem=criteriaValue]")).setValue(l):$(d).find("[elem=criteriaValue]").val(l)):ZP5ViewActions.criteria.initCondValSelect($(d).find("[elem=criteriaValue]"),JSON.parse(l)),$(d).find("[elem=criteriaValue]").prop("disabled")||Timetracker.views.isTimetrackerSpecialFields(fieldObj.tName,fieldObj.labelName)&&ZPeopleComponents.select($(d).find("[elem=criteriaOper]")).setValue(Timetracker.views.getDefaultValueForSearch(fieldObj.labelName,t)),ZP5ViewActions.criteria.criteriaCnt++})),0==ZP5ViewActions.criteria.criteriaCnt){ZP5ViewActions.container.find("[elem=criteriaBodyCont]").append(ZP5ViewActions.criteria.construct());let e=ZP5ViewActions.container.find("[elem=criteriaBodyCont]").find("[elem=criteriaDiv]:last");ZP5ViewActions.criteria.popoverFieldOptions.init($(e).find("[elem=criteriaField]"))}ZP5ViewActions.container.find("[elem=criteriaBodyCont]").append('<div class="zpl_idiv" elem="addNewCriDiv"><a class="zpl_lnkbg" elem="addNewCriteria">'+ZPI18N.getString("zp.addnew")+"</a></div>"),ZP5ViewActions.container.find("[elem=criteriaBodyCont]").find("[elem=addNewCriteria]").off("click").on("click",ZP5ViewActions.criteria.addNew)},construct:()=>{let e='<div class="zpl_idiv" elem="criteriaDiv" criId="" rowno="'+ZP5ViewActions.criteria.criteriaCnt+'">';return e+='<div class="zpl_rwfld zpl_rwnum"><span elem="criteriaCount">'+(ZP5ViewActions.criteria.criteriaCnt+1)+"</span></div>",e+='<div class="zpl_rwfld">',ZP5ViewActions.criteria.criteriaCnt>0&&(e+='<select elem="criteriaConj" class="zselectbox"><option value="AND">'+ZPI18N.getString("zp.captialand")+'</option><option value="OR">'+ZPI18N.getString("zp.captialor")+"</option></select>"),e+="</div>",e+='<div class="zpl_rwfld"><input elem="criteriaField" type="text" class="ztextbox" value="'+ZPI18N.getString("zp.none")+'" fcid="-1" parentfcid="-1" uniqIdVal="'+FormsCriteriaCommon.criUniqIdCnt+'" id="criteriaField_'+FormsCriteriaCommon.criUniqIdCnt+'" targetElemId="criteriaField_popup_'+FormsCriteriaCommon.criUniqIdCnt+'"><div id="criteriaField_popup_'+FormsCriteriaCommon.criUniqIdCnt+'"></div></div>',e+='<div class="zpl_rwfld"><select elem="criteriaOper" class="zselectbox" disabled="true"><option value="-1">'+ZPI18N.getString("zp.none")+"</option></select></div>",e+='<div class="zpl_rwfld" elem="criValInput" inpElemId="criteriaValue_'+FormsCriteriaCommon.criUniqIdCnt+'"><input elem="criteriaValue" type="text" class="ztextbox is-disabled" disabled value="" id="criteriaValue_'+FormsCriteriaCommon.criUniqIdCnt+'" ></div>',e+='<div class="zpl_rwfld zpl_rwicn"><i elem="deleteIcon" class="PI_delete"></i></div>',e+="</div>",FormsCriteriaCommon.criUniqIdCnt++,e},popoverFieldOptions:{elem:{},init:(e,t)=>{let i=e,r=!1;e&&e.target&&(i=e.target,void 0,r=!0);let s=$(i).attr("targetElemId");ZPeopleComponents.isComponent(s)||ZP5ViewActions.criteria.popoverFieldOptions.construct(i),r&&ZPeopleComponents.tabbedlistboxpopup("#"+s).open()},construct:e=>{let t=$(e).attr("fcid"),i=$(e).attr("parentfcid"),r=$(e).attr("uniqIdVal"),s=$(e).attr("id"),a=$(e).attr("targetElemId"),n={select:ZP5ViewActions.criteria.popoverFieldOptions.callback,pointer:!0};if(ZP5ViewActions.criteria.popoverFieldOptions.elem.hasOwnProperty(ZP5ViewActions.FORMID))n=ZP5ViewActions.criteria.popoverFieldOptions.elem[ZP5ViewActions.FORMID];else{let e=[],t={};e.push({label:ZP5ViewActions.Modal.FORM_NAME,value:ZP5ViewActions.FORMID});let i=[];$.each(ZP5ViewActions.components.getAllComponents(),(function(r,s){if((s.fcType!=FormConstants.FieldType.LOOKUP||!s.isMultiSelect)&&("0"!==s.parentFCID||s.fcType===FormConstants.FieldType.IMAGE||"P_EmployeeLeave"===ZP5Form.getCurrFormsOperation().getTableName()&&"ZP_Leave_Unit"==s.labelName||i.push({id:s.formCompID,value:s.formCompID,parentfcid:"-1",fieldtype:s.fcType,dispName:s.formCompName}),ZP5ViewActions.components.isParentComponent(s.formCompID+""))){let i=[];$.each(s.childComponents,(function(e,t){let r=t.tName,a=t.columnName;"P_Rating"==r&&"STARS"==a||t.fcType==FormConstants.FieldType.IMAGE||t.fcType==FormConstants.FieldType.LOOKUP&&t.isMultiSelect||i.push({id:e,value:e,parentfcid:s.formCompID,fieldtype:t.fcType,dispName:t.formCompName})})),i.length>0&&(e.push({label:s.formCompName,value:s.formCompID}),t[s.formCompID]=i)}})),t[ZP5ViewActions.FORMID]=i,n.leftTabContents=e,n.rightTabContents=t,n.listboxOptions=FormsCriteriaCommon.listBoxOptions,ZP5ViewActions.criteria.popoverFieldOptions.elem[ZP5ViewActions.FORMID]=n}let o=[];$.each(n.leftTabContents,(function(e,t){let i={};i.label=t.label,i.panelId=t.value+"_"+r+"_panel",i.id=t.value+"_"+r,i._value=t.value,i.items=n.rightTabContents[t.value],o.push(i)})),n.tabs=o,n.id=a,n.forEleId=s,n.forElement="#"+s,n.appendTo="#tabCreateEditViewPopup",ZPeopleComponents.tabbedlistboxpopup("#"+a,n);let l=-1==i?ZP5ViewActions.FORMID:i,d=-1==t?"":t;ZPUtil.Validation.isEmpty(l)||ZPUtil.Validation.isEmpty(d)||FormsCriteriaCommon.setTabPanelInput(a,n,l,d)},getDisplayName:(e,t)=>{let i=ZP5ViewActions.criteria.getFieldData(e,t).formCompName;return t&&-1!=t&&(i+="("+ZP5ViewActions.components.getParentFormCompName(t)+")"),i},setValues:(e,t)=>{let i=ZP5ViewActions.criteria.popoverFieldOptions.getDisplayName(t.fcid,t.parentfcid);$(e).removeAttr("fcid value parentfcid"),$(e).val(i),$(e).attr(t),ZP5ViewActions.criteria.onFieldChange(e)},callback:(e,t)=>{if(e&&e.detail&&1!=e.detail.fromUI)return;FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0);let i=e.detail.itemData;elem=ZP5ViewActions.container.find("#"+t.forEleId),ZP5ViewActions.criteria.popoverFieldOptions.setValues(elem,{fcid:i.value,parentfcid:i.parentfcid})}},onFieldChange:e=>{let t=e;e&&e.target&&(t=e.target,FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0));let i=$(t).attr("targetElemId"),r=$(t).attr("fcid"),s=$(t).attr("parentfcid"),a=$(t).closest("[elem=criteriaDiv]");if($(a).removeClass("zpl_erorbx"),FrameworkCommon.removeError($(a).find("[elem=criteriaField], [elem=criteriaValue]")),ZP5ViewActions.criteria.changeCriteriaValInpType(a,!0),"-1"===r)return ZP5ViewActions.criteria.destroyAddOperSelect(a,void 0,!0),void $(a).find("[elem=criteriaValue]").addClass("is-disabled").prop("disabled",!0).val("");$(a).find("[elem=criteriaValue]").prop("disabled",!1).removeClass("is-disabled DN").val(""),ZP5ViewActions.criteria.updateOperatorOptions(r,s,a),ZPeopleComponents.tabbedlistboxpopup("#"+i).close()},updateOperatorOptions:(e,t,i)=>{let r,s=ZP5ViewActions.criteria.getFieldData(e,t),a=s.fcType;a==FormConstants.FieldType.SCRIPT&&null!=s.formulaDType&&-1!=s.formulaDType&&(a=s.formulaDType);let n=[],o=a==FormConstants.FieldType.LOOKUP,l=s.isMultiSelect,d=s.tName;if(o&&(d=s.reffTname,a=s.reffcType&&-1!=s.reffcType?s.reffcType:FormConstants.FieldType.TEXT,$.inArray(d,["P_Employee","P_EmployeeN1","P_Department","P_DepartmentN1","P_Legal_Entity","P_Business_Unit","P_Divisions","P_Goals"])>-1))switch(d){case"P_Employee":case"P_EmployeeN1":n.push({label:ZPI18N.getString("zp.loginUser"),value:FormConstants.Criteria.OPERATORS.LOGIN_USER});break;case"P_Department":case"P_DepartmentN1":n.push({label:ZPI18N.getString("zp.loginUsersDept"),value:FormConstants.Criteria.OPERATORS.LOGIN_USERS_DEPT});break;case"P_Legal_Entity":n.push({label:ZPI18N.getString("zp.loginUserEntity"),value:FormConstants.Criteria.OPERATORS.LOGIN_USERS_ENTITY});break;case"P_Business_Unit":n.push({label:ZPI18N.getString("zp.loginUserUnit"),value:FormConstants.Criteria.OPERATORS.LOGIN_USERS_UNIT});break;case"P_Divisions":n.push({label:ZPI18N.getString("zp.loginUserDivision"),value:FormConstants.Criteria.OPERATORS.LOGIN_USERS_DIVISION});break;case"P_Goals":n.push({label:ZPI18N.getString("zp.subordinatesgoals"),value:FormConstants.Criteria.OPERATORS.SUBORDINATES_GOAL})}if(s.isEncrypted&&a!=FormConstants.FieldType.NEW_GENDER&&a!=FormConstants.FieldType.NEW_BLOODGROUP)n=[],n.push({label:ZPI18N.getString("zp.is"),value:FormConstants.Criteria.OPERATORS.EQUAL}),n.push({label:ZPI18N.getString("zp.isnot"),value:FormConstants.Criteria.OPERATORS.NOT_EQUAL}),n.push({label:ZPI18N.getString("zp.isempty"),value:FormConstants.Criteria.OPERATORS.EMPTY}),n.push({label:ZPI18N.getString("zp.isnotempty"),value:FormConstants.Criteria.OPERATORS.NOT_EMPTY});else if(Timetracker.views.isTimetrackerSpecialFields(s.tName,s.labelName,s.reffTname)){var p=Timetracker.views.getOperType(s.labelName);for(let e in p)n.push({label:ZPI18N.getString(p[e]),value:e});defOptn=Timetracker.views.getDefaultValueForSearch(s.labelName)}else $.inArray(a,[FormConstants.FieldType.TEXT,FormConstants.FieldType.EMAIL_ADDRESS,FormConstants.FieldType.PHONE_NUMBER,FormConstants.FieldType.URL,FormConstants.FieldType.TEXT_AREA,FormConstants.FieldType.BLOODGROUP,FormConstants.FieldType.GENDER,FormConstants.FieldType.COUNTRY,FormConstants.FieldType.ADDRESS,FormConstants.FieldType.STATES])>-1?(n.push({label:ZPI18N.getString("zp.is"),value:o?FormConstants.Criteria.OPERATORS.IN:FormConstants.Criteria.OPERATORS.EQUAL}),n.push({label:ZPI18N.getString("zp.isnot"),value:o?FormConstants.Criteria.OPERATORS.NOT_IN:FormConstants.Criteria.OPERATORS.NOT_EQUAL}),n.push({label:ZPI18N.getString("zp.isempty"),value:FormConstants.Criteria.OPERATORS.EMPTY}),n.push({label:ZPI18N.getString("zp.isnotempty"),value:FormConstants.Criteria.OPERATORS.NOT_EMPTY}),n.push({label:ZPI18N.getString("zp.startswith"),value:FormConstants.Criteria.OPERATORS.STARTS_WITH}),n.push({label:ZPI18N.getString("zp.endswith"),value:FormConstants.Criteria.OPERATORS.ENDS_WITH}),n.push({label:ZPI18N.getString("zp.contains"),value:FormConstants.Criteria.OPERATORS.CONTAINS}),n.push({label:ZPI18N.getString("zp.notcontains"),value:FormConstants.Criteria.OPERATORS.NOT_CONTAINS})):a==FormConstants.FieldType.FILE_UPLOAD||a==FormConstants.FieldType.IMAGE?(n.push({label:ZPI18N.getString("zp.isempty"),value:FormConstants.Criteria.OPERATORS.EMPTY}),n.push({label:ZPI18N.getString("zp.isnotempty"),value:FormConstants.Criteria.OPERATORS.NOT_EMPTY})):a==FormConstants.FieldType.DATE||a==FormConstants.FieldType.DATE_TIME||a==FormConstants.FieldType.FORMULA_DATE?(n=FormsCriteriaCommon.getDateTimeFieldOperators(i,o,!1),r=FormConstants.Criteria.OPERATORS.TODAY):a==FormConstants.FieldType.CHECK_BOX?(n.push({label:ZPI18N.getString("zp.yes"),value:FormConstants.Criteria.OPERATORS.TRUE}),n.push({label:ZPI18N.getString("zp.no"),value:FormConstants.Criteria.OPERATORS.FALSE})):a==FormConstants.FieldType.NUMBER||a==FormConstants.FieldType.CURRENCY||a==FormConstants.FieldType.DECIMAL?(n.push({label:ZPI18N.getString("zp.is"),value:o?FormConstants.Criteria.OPERATORS.IN:FormConstants.Criteria.OPERATORS.EQUAL}),n.push({label:ZPI18N.getString("zp.isnot"),value:o?FormConstants.Criteria.OPERATORS.NOT_IN:FormConstants.Criteria.OPERATORS.NOT_EQUAL}),n.push({label:ZPI18N.getString("zp.isempty"),value:FormConstants.Criteria.OPERATORS.EMPTY}),n.push({label:ZPI18N.getString("zp.isnotempty"),value:FormConstants.Criteria.OPERATORS.NOT_EMPTY}),n.push({label:ZPI18N.getString("zp.lesserthan"),value:FormConstants.Criteria.OPERATORS.LESS_THAN}),n.push({label:ZPI18N.getString("zp.greaterthan"),value:FormConstants.Criteria.OPERATORS.GREATER_THAN}),n.push({label:ZPI18N.getString("zp.lesserorequalto"),value:FormConstants.Criteria.OPERATORS.LESS_EQUAL}),n.push({label:ZPI18N.getString("zp.greaterorequalto"),value:FormConstants.Criteria.OPERATORS.GREATER_EQUAL})):a==FormConstants.FieldType.PICKLIST?(l||(n.push({label:ZPI18N.getString("zp.is"),value:FormConstants.Criteria.OPERATORS.IN}),n.push({label:ZPI18N.getString("zp.isnot"),value:FormConstants.Criteria.OPERATORS.NOT_IN})),n.push({label:ZPI18N.getString("zp.isempty"),value:FormConstants.Criteria.OPERATORS.EMPTY}),n.push({label:ZPI18N.getString("zp.isnotempty"),value:FormConstants.Criteria.OPERATORS.NOT_EMPTY}),n.push({label:ZPI18N.getString("zp.contains"),value:FormConstants.Criteria.OPERATORS.CONTAINS}),n.push({label:ZPI18N.getString("zp.notcontains"),value:FormConstants.Criteria.OPERATORS.NOT_CONTAINS})):a==FormConstants.FieldType.NEW_GENDER||a==FormConstants.FieldType.NEW_BLOODGROUP||a==FormConstants.FieldType.NEW_COUNTRY?(n.push({label:ZPI18N.getString("zp.is"),value:FormConstants.Criteria.OPERATORS.IN}),n.push({label:ZPI18N.getString("zp.isnot"),value:FormConstants.Criteria.OPERATORS.NOT_IN}),n.push({label:ZPI18N.getString("zp.isempty"),value:FormConstants.Criteria.OPERATORS.EMPTY}),n.push({label:ZPI18N.getString("zp.isnotempty"),value:FormConstants.Criteria.OPERATORS.NOT_EMPTY})):a==ZP5Form.Field.TIME?(n.push({label:ZPI18N.getString("zp.is"),value:o?FormConstants.Criteria.OPERATORS.IN:FormConstants.Criteria.OPERATORS.EQUAL}),n.push({label:ZPI18N.getString("zp.isnot"),value:o?FormConstants.Criteria.OPERATORS.NOT_IN:FormConstants.Criteria.OPERATORS.NOT_EQUAL}),n.push({label:ZPI18N.getString("zp.isempty"),value:FormConstants.Criteria.OPERATORS.EMPTY}),n.push({label:ZPI18N.getString("zp.isnotempty"),value:FormConstants.Criteria.OPERATORS.NOT_EMPTY}),n.push({label:ZPI18N.getString("zp.before"),value:FormConstants.Criteria.OPERATORS.LESS_THAN}),n.push({label:ZPI18N.getString("zp.after"),value:FormConstants.Criteria.OPERATORS.GREATER_THAN})):l||(o?(n.push({label:ZPI18N.getString("zp.is"),value:FormConstants.Criteria.OPERATORS.IN}),n.push({label:ZPI18N.getString("zp.isnot"),value:FormConstants.Criteria.OPERATORS.NOT_IN})):n.push({label:ZPI18N.getString("zp.is"),value:FormConstants.Criteria.OPERATORS.EQUAL}));ZP5ViewActions.criteria.destroyAddOperSelect(i,n,!1,r),ZP5ViewActions.criteria.onOperatorChange($(i).find("[elem=criteriaOper]"))},destroyAddOperSelect:function(e,t,i,r){$(e).find("[elem=criteriaOper]").removeAttr("disabled"),ComponentsCommon.safeDestroyZComponent("select",$(e).find("[elem=criteriaOper]")),$(e).find("[elem=criteriaOper]").empty(),(i||t&&0==t.length)&&(t=[{label:ZPI18N.getString("zp.none"),value:"-1"}]),ZPeopleComponents.select($(e).find("[elem=criteriaOper]"),ComponentsCommon.select.getProps({showSearchField:!i,disabled:i,options:t,change:ZP5ViewActions.criteria.onOperatorChange})),ZPeopleComponents.select($(e).find("[elem=criteriaOper]")).setValue(null==r?t[0].value:r)},onOperatorChange:e=>{let t=e;if(e&&e.target){if(!0!==e.detail.fromUI)return;FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0),t=e.target}let i=$(t).closest("[elem=criteriaDiv]"),r=ZPeopleComponents.select($(t)).getValue(),s=$(i).find("[elem=criteriaField]").attr("fcid"),a=$(i).find("[elem=criteriaField]").attr("parentfcid"),n=ZP5ViewActions.criteria.getFieldData(s,a);ZP5ViewActions.criteria.changeCriteriaValInpType(i,!0);let o=n.fcType;if(Timetracker.views.isTimetrackerSpecialFields(n.tName,n.labelName))$(i).find("[elem=criteriaValue]").prop("disabled",!0).addClass("is-disabled DN").val("");else if(r==FormConstants.Criteria.OPERATORS.EMPTY||r==FormConstants.Criteria.OPERATORS.NOT_EMPTY||r==FormConstants.Criteria.OPERATORS.TRUE||r==FormConstants.Criteria.OPERATORS.FALSE||r==FormConstants.Criteria.OPERATORS.YESTERDAY||r==FormConstants.Criteria.OPERATORS.TODAY||r==FormConstants.Criteria.OPERATORS.TOMORROW||r==FormConstants.Criteria.OPERATORS.LAST_MONTH||r==FormConstants.Criteria.OPERATORS.THIS_MONTH||r==FormConstants.Criteria.OPERATORS.NEXT_MONTH||r==FormConstants.Criteria.OPERATORS.LAST_YEAR||r==FormConstants.Criteria.OPERATORS.CURRENT_YEAR||r==FormConstants.Criteria.OPERATORS.NEXT_YEAR||r==FormConstants.Criteria.OPERATORS.LOGIN_USER||r==FormConstants.Criteria.OPERATORS.LOGIN_USERS_DEPT||r==FormConstants.Criteria.OPERATORS.THIS_WEEK||r==FormConstants.Criteria.OPERATORS.LAST_WEEK||r==FormConstants.Criteria.OPERATORS.NEXT_WEEK||r==FormConstants.Criteria.OPERATORS.LOGIN_USERS_ENTITY||r==FormConstants.Criteria.OPERATORS.LOGIN_USERS_UNIT||r==FormConstants.Criteria.OPERATORS.LOGIN_USERS_DIVISION||r==FormConstants.Criteria.OPERATORS.SUBORDINATES_GOAL)$(i).find("[elem=criteriaValue]").prop("disabled",!0).addClass("is-disabled DN").val("");else if(r==FormConstants.Criteria.OPERATORS.NOT_IN||r==FormConstants.Criteria.OPERATORS.IN){if(o==FormConstants.FieldType.LOOKUP||o==FormConstants.FieldType.PICKLIST||o==FormConstants.FieldType.NEW_GENDER||o==FormConstants.FieldType.NEW_BLOODGROUP||o==FormConstants.FieldType.NEW_COUNTRY)return void ZP5ViewActions.criteria.changeCriteriaValInpType(i,!1)}else{if(o==FormConstants.FieldType.DATE||o==FormConstants.FieldType.DATE_TIME||o==FormConstants.FieldType.FORMULA_DATE){$(i).find("[elem=criteriaValue]").off("change");let e=ComponentsCommon.getDateProps();e.change=e=>{FrameworkCommon.madeChanges.setOnEvent(e,ZP5ViewActions.Modal)};let t=$(i).find("[elem=criteriaValue]").attr("id")+"-container-picker";o==FormConstants.FieldType.DATE||o==FormConstants.FieldType.FORMULA_DATE?(ComponentsCommon.safeDestroyZComponent("datefield",$(i).find("[elem=criteriaValue]")),$("[id^="+t+"]").remove(),ZPeopleComponents.datefield($(i).find("[elem=criteriaValue]"),e)):o==FormConstants.FieldType.DATE_TIME&&(e.format=components._timeformat(),ComponentsCommon.safeDestroyZComponent("datetimefield",$(i).find("[elem=criteriaValue]")),$("[id^="+t+"]").remove(),ZPeopleComponents.datetimefield($(i).find("[elem=criteriaValue]"),e))}$(i).find("[elem=criteriaValue]").prop("disabled",!1).removeClass("is-disabled DN").val("")}},changeCriteriaValInpType:function(e,t){if(t){let t=$(e).find("[elem=criValInput]").attr("inpElemId");$(e).find("[elem=criValInput]").html('<input elem="criteriaValue" type="text" id="'+t+'" class="ztextbox" value="" >'),$(e).find("[elem=criteriaValue]").off("change").on("change",(e=>{FrameworkCommon.madeChanges.setOnEvent(e,ZP5ViewActions.Modal)}))}else $(e).find("[elem=criValInput]").html('<select elem="criteriaValue" class="zselectbox" value=""></select>'),ZPeopleComponents.select($(e).find("[elem=criteriaValue]")),ZP5ViewActions.criteria.initCondValSelect($(e).find("[elem=criteriaValue]"))},defaultActions:()=>{ZP5ViewActions.container.find("[elem=criteriaBodyCont]").find("[elem=deleteIcon]").off("click").on("click",ZP5ViewActions.criteria.delete),ZP5ViewActions.container.find("[elem=criteriaBodyCont]").find("[elem=criteriaField]").off("click").on("click",ZP5ViewActions.criteria.popoverFieldOptions.init),ZP5ViewActions.container.find("[elem=criteriaBodyCont]").find("[elem=criteriaField]").off("keydown").on("keydown",(e=>{e.preventDefault()})),ZPeopleComponents.select(ZP5ViewActions.container.find("[elem=criteriaBodyCont]").find("[elem=criteriaConj]"),ComponentsCommon.select.getProps()),ZP5ViewActions.container.find("[elem=criteriaBodyCont]").find("[elem=criteriaConj]").off().on("zselectchange",(e=>{FrameworkCommon.madeChanges.setOnEvent(e,ZP5ViewActions.Modal)})),ZPeopleComponents.select(ZP5ViewActions.container.find("[elem=criteriaBodyCont]").find("[elem=criteriaOper]"),ComponentsCommon.select.getProps()),ZPeopleComponents.select(ZP5ViewActions.container.find("[elem=criteriaBodyCont]").find("select[elem=criteriaValue]"),ComponentsCommon.select.getProps())},initCondValSelect:(e,t)=>{let i=$(e).closest("[elem=criteriaDiv]"),r=$(i).find("[elem=criteriaField]").attr("fcid"),s=$(i).find("[elem=criteriaField]").attr("parentfcid"),a=[],n={showSearchField:!0,placeholder:ZPI18N.getString("zp.select"),contentType:"text",multiple:!0,dataMapping:{label:"Value",value:"Id"},width:"278px",dropdownList:{contentType:"text"}},o=ZP5ViewActions.criteria.getFieldData(r,s);n.change=e=>{FrameworkCommon.madeChanges.setOnEvent(e,ZP5ViewActions.Modal)};let l=o.fcType;l==FormConstants.FieldType.LOOKUP?(a=ZP5ViewActions.criteria.getLookupOptions("",r,{value:t}),n.serverSearch=!0,n.cacheData=!0,n.dataSource={search:function(e){return new Promise((function(t,i){t({delay:20,results:ZP5ViewActions.criteria.getLookupOptions(e.query,r),more:!1})}))},paginated:!0}):(ZP5ViewActions.criteria.getPickListOptions(r,l),a=ZP5ViewActions.criteria.fieldOptions[r]),ComponentsCommon.safeDestroyZComponent("select",$(i).find("[elem=criteriaValue]")),ZPeopleComponents.select($(i).find("[elem=criteriaValue]"),ComponentsCommon.select.getProps(n));let d=$.grep(a,(e=>$.inArray(e.Id,t)>-1));a.length>0&&(ZPeopleComponents.select($(i).find("[elem=criteriaValue]")).addOption(a),ZPeopleComponents.select($(i).find("[elem=criteriaValue]")).setValues(d))},getLookupOptions:function(e,t,i){let r=[],s=[],a=e=>!ZPUtil.Validation.isEmpty(e)&&e.value&&""!=e.value&&e.value.length>0,n=(e=null==e?"":e.toLowerCase()).length?e.toLowerCase():t+"_all";a(i)&&(n=t+"_sel"),null==ZP5ViewActions.criteria.fieldOptions[t]&&(ZP5ViewActions.criteria.fieldOptions[t]={});let o=ZP5ViewActions.criteria.fieldOptions[t];if(null!=o[n]){if(r=o[n].options,$.each(r,(function(e,t){let i=null!=t.DISPVALUE?"DISPVALUE":"Value";s.push({Id:t.Id,Value:ZPeople.decodeTxt(t[i])})})),"*"!=e?(r=$.grep(s,(function(t){return t.Value.toLowerCase().indexOf(e.toLowerCase())>-1})),a(i)&&$.merge(r,ZP5ViewActions.criteria.getLookupOptions("",t))):r=s,r.length<=0&&!0!==o[n].noData){let s={key:encodeURIComponent(e),mode:"getLookupList",conreqcsr:csrfToken,selectedLookupType:t,fcType:FormConstants.FieldType.LOOKUP};a(i)&&(s.defValues=JSON.stringify(i.value)),$.ajax({type:"POST",async:!1,url:ZP5ViewActions.url,data:s,success:function(e){ZP5ViewActions.criteria.fieldOptions[t][n]={},ZP5ViewActions.criteria.fieldOptions[t][n].options=e.lookupDetailsList,ZP5ViewActions.criteria.fieldOptions[t][n].noData=e.lookupDetailsList.length<=0}}),r=ZP5ViewActions.criteria.fieldOptions[t][n].options.length>0?ZP5ViewActions.criteria.getLookupOptions(e,t):[]}}else{let s={key:encodeURIComponent(e),mode:"getLookupList",conreqcsr:csrfToken,selectedLookupType:t,fcType:FormConstants.FieldType.LOOKUP};a(i)&&(s.defValues=JSON.stringify(i.value)),$.ajax({type:"POST",async:!1,url:ZP5ViewActions.url,data:s,success:function(e){ZP5ViewActions.criteria.fieldOptions[t][n]={},ZP5ViewActions.criteria.fieldOptions[t][n].options=e.lookupDetailsList,ZP5ViewActions.criteria.fieldOptions[t][n].noData=e.lookupDetailsList.length<=0}}),r=ZP5ViewActions.criteria.getLookupOptions(e,t,i)}return r},getPickListOptions:(e,t)=>{if(void 0===ZP5ViewActions.criteria.fieldOptions[e]){let i={mode:"getLookupList",conreqcsr:csrfToken,selectedLookupType:e,fcType:t};ZPeople.Request.sendAsyncPost(ZP5ViewActions.url,i,(function(t){let i=t.lookupDetailsList,r=(e,t,i,r)=>{e.hasOwnProperty(t)&&(e[i]=r?ZPeople.decodeTxt(e[t]):e[t])};$.each(i,((e,t)=>{r(t,"DISPVALUE","Value",!0),r(t,"VALUE","VAL",!0),r(t,"ID","Id",!1)})),ZP5ViewActions.criteria.fieldOptions[e]=i}))}},addNew:e=>{let t=ZP5ViewActions.container.find("[elem=criteriaBodyCont] [elem=criteriaDiv]:last:visible");t.length>0&&"-1"==$(t).find("[elem=criteriaField]").attr("fcid")?$(t).find("[elem=criteriaField]").focus():(ZP5ViewActions.criteria.criteriaCnt=ZP5ViewActions.container.find("[elem=criteriaDiv]:visible").length,$(ZP5ViewActions.criteria.construct()).insertBefore($(e.target).closest("[elem=addNewCriDiv]")),ZP5ViewActions.criteria.popoverFieldOptions.init(ZP5ViewActions.container.find("[elem=criteriaDiv][rowno="+ZP5ViewActions.criteria.criteriaCnt+"]:visible").find("[elem=criteriaField]")),ZP5ViewActions.criteria.defaultActions(),FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0))},delete:e=>{$(e.target).closest("[elem=criteriaDiv]").remove(),FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0),ZP5ViewActions.container.find("[elem=criteriaBodyCont] [elem=criteriaDiv]:visible").length<=0?(ZP5ViewActions.criteriaCnt=0,ZP5ViewActions.container.find("[elem=criteriaBodyCont]").find("[elem=addNewCriteria]").click()):(ZP5ViewActions.container.find("[elem=criteriaBodyCont] [elem=criteriaDiv]:visible:first").find("[elem=criteriaConj]").parent().empty(),ZP5ViewActions.container.find("[elem=criteriaBodyCont] [elem=criteriaDiv]:visible").each((function(e){$(this).attr("rowno",e),$(this).find("[elem=criteriaCount]").text(e+1)})))},getCriVal:e=>{let t="",i=$(e).find("[elem=criteriaField]").attr("fcid"),r=$(e).find("[elem=criteriaField]").attr("parentfcid"),s=ZP5ViewActions.criteria.getFieldData(i,r).fcType;return s&&(s==FormConstants.FieldType.DATE||s==FormConstants.FieldType.FORMULA_DATE?(t=ZPeopleComponents.datefield($(e).find("[elem=criteriaValue]")).getValue().dateString,ZPUtil.Validation.isEmpty(t)&&(t="")):s==FormConstants.FieldType.DATE_TIME?(t=ZPeopleComponents.datetimefield($(e).find("[elem=criteriaValue]")).getValue().dateString,ZPUtil.Validation.isEmpty(t)?t="":Calendar.is12HrFormat()&&(t=Calendar.convertHourFormat(t))):t=$(e).find("[elem=criteriaValue]").val()),t},validate:()=>{let e={isValid:!0,crtJson:[]},t=ZP5ViewActions.container.find("[elem=criteriaBodyCont] [elem=criteriaDiv]:visible");return $.each(t,(function(t,i){$(i).removeClass("zpl_erorbx"),FrameworkCommon.removeError($(i).find("[elem=criteriaValue]"));let r=!0,s="AND";0!==t&&(s=ZPeopleComponents.select($(i).find("[elem=criteriaConj]")).getValue());let a=$(i).find("[elem=criteriaField]").attr("fcid"),n=$(i).find("[elem=criteriaField]").attr("parentfcid"),o=ZPeopleComponents.select($(i).find("[elem=criteriaOper]")).getValue(),l=$(i).find("[elem=criteriaValue]").is("input");if("-1"!==a&&"-1"!==o){let t=ZP5ViewActions.criteria.getFieldData(a,n),d="",p=l?$(i).find("[elem=criteriaValue]").prop("disabled"):ZPeopleComponents.select($(i).find("[elem=criteriaValue]")).getAttribute("disabled");if(p||(l?d=ZP5ViewActions.criteria.getCriVal(i).trim():(d=ZPeopleComponents.select($(i).find("[elem=criteriaValue]")).getValues(),null!=d&&d.length>0&&(d=d.toString()))),Timetracker.views.isTimetrackerSpecialFields(t.tName,t.labelName)){let e=Timetracker.views.getValueForField(t.labelName,o);d=e.value,o=e.operator}let m=t.fcType,c=t.formulaDType;if(m==FormConstants.FieldType.SCRIPT&&null!=c&&-1!=c&&(m=c),$.inArray(o,[FormConstants.Criteria.OPERATORS.YESTERDAY,FormConstants.Criteria.OPERATORS.TODAY,FormConstants.Criteria.OPERATORS.TOMORROW,FormConstants.Criteria.OPERATORS.EMPTY,FormConstants.Criteria.OPERATORS.THIS_WEEK,FormConstants.Criteria.OPERATORS.LAST_WEEK,FormConstants.Criteria.OPERATORS.NEXT_WEEK,FormConstants.Criteria.OPERATORS.NOT_EMPTY,FormConstants.Criteria.OPERATORS.LAST_YEAR,FormConstants.Criteria.OPERATORS.CURRENT_YEAR,FormConstants.Criteria.OPERATORS.NEXT_YEAR,FormConstants.Criteria.OPERATORS.TRUE,FormConstants.Criteria.OPERATORS.LAST_MONTH,FormConstants.Criteria.OPERATORS.THIS_MONTH,FormConstants.Criteria.OPERATORS.NEXT_MONTH,FormConstants.Criteria.OPERATORS.FALSE,FormConstants.Criteria.OPERATORS.LOGIN_USERS_ENTITY,FormConstants.Criteria.OPERATORS.LOGIN_USERS_UNIT,FormConstants.Criteria.OPERATORS.LOGIN_USERS_DIVISION,FormConstants.Criteria.OPERATORS.LOGIN_USER,FormConstants.Criteria.OPERATORS.LOGIN_USERS_DEPT,FormConstants.Criteria.OPERATORS.LOGIN_USERS_DESIG,FormConstants.Criteria.OPERATORS.SUBORDINATES_GOAL])>=-1||null!=d&&0!=d.length||(FrameworkCommon.showError(ZPI18N.getString("zp.fieldupdate.specifyfield"),$(i).find("[elem=criteriaValue]")),$(i).addClass("zpl_erorbx"),r=!1),m!=FormConstants.FieldType.DATE_TIME&&m!=FormConstants.FieldType.DATE&&m!=FormConstants.FieldType.FORMULA_DATE||o!=FormConstants.Criteria.OPERATORS.EQUAL&&o!=FormConstants.Criteria.OPERATORS.NOT_EQUAL&&o!=FormConstants.Criteria.OPERATORS.GREATER_THAN&&o!=FormConstants.Criteria.OPERATORS.LESS_THAN||ZPUtil.Validation.isEmpty(d)&&(r=!1,FrameworkCommon.showError(ZPI18N.getString("zp.datetimeerr"),$(i).find("[elem=criteriaValue]")),$(i).addClass("zpl_erorbx")),!p){let e=FormsCriteriaCommon.validateCriteriaValue(m,o,d);r&&!e.isValid&&(r=!1,FrameworkCommon.showError(e.key,$(i).find("[elem=criteriaValue]")),$(i).addClass("zpl_erorbx"))}if(r&&t.isEncrypted&&m!=FormConstants.FieldType.NEW_GENDER&&m!=FormConstants.FieldType.NEW_BLOODGROUP&&o!=FormConstants.Criteria.OPERATORS.EMPTY&&o!=FormConstants.Criteria.OPERATORS.NOT_EMPTY&&o!=FormConstants.Criteria.OPERATORS.EQUAL&&o!=FormConstants.Criteria.OPERATORS.NOT_EQUAL&&(FrameworkCommon.showError(ZPI18N.getString("zp.EncryptedCriteriaError"),$(i).find("[elem=criteriaValue]")),$(i).addClass("zpl_erorbx"),r=!1),r){let r={formComponentID:a,Operator:o,CrtVal:d,conjunctiveCondn:s};if(-1!=n?(r.lookupFcId=a,r.formComponentID=n,r.isBaseForm=!1,m==FormConstants.FieldType.LOOKUP&&(r.lookupFcId2=t.lkpFcid)):m==FormConstants.FieldType.LOOKUP&&(r.lookupFcId=t.lkpFcid,r.isBaseForm=!0),!(m!=FormConstants.FieldType.LOOKUP&&m!=FormConstants.FieldType.PICKLIST&&m!=FormConstants.FieldType.NEW_GENDER&&m!=FormConstants.FieldType.NEW_BLOODGROUP&&m!=FormConstants.FieldType.NEW_COUNTRY||o!=FormConstants.Criteria.OPERATORS.NOT_IN&&o!=FormConstants.Criteria.OPERATORS.IN)){let e="";$.each(ZPeopleComponents.select($(i).find("[elem=criteriaValue]")).getAttribute("options"),(function(t,r){$.inArray(r.Id,ZPeopleComponents.select($(i).find("[elem=criteriaValue]")).getValues())>-1&&(e+=r.Value+",")})),e=e.slice(0,-1),r.dispVal=e,r.CrtVal=ZPeopleComponents.select($(i).find("[elem=criteriaValue]")).getValues()}e.crtJson.push(r)}else e.isValid=!1,e.crtJson=[]}})),e}},save:()=>{let e=!0,t=!1;ZP5ViewActions.Modal.sliderDiv.find("#sliderSbt").addClass("disabled").prop("disabled",!0),FrameworkCommon.removeError(ZP5ViewActions.container.find("[elem=viewNameCont] [elem=viewNameInput]")),FrameworkCommon.hide(ZP5ViewActions.container.find("[elem=viewRightColumnsCont] [elem=rightColErrMsg]")),ZP5ViewActions.container.find("[elem=viewSharedToCont] [elem=sharedviewcontainer]").removeClass("ztextbox__error"),FrameworkCommon.hide(ZP5ViewActions.container.find("[elem=viewSharedToCont] [elem=sharedToErrorMsg]"));let i=ZP5ViewActions.container.find("[elem=viewNameCont] [elem=viewNameInput]").val().trim();(0==i.length||i.length>100)&&(FrameworkCommon.showError(0==i.length?ZPI18N.getString("zp.viewempty"):ZPI18N.getString("zp.displaynamelength",[100]),ZP5ViewActions.container.find("[elem=viewNameCont] [elem=viewNameInput]")),ZP5ViewActions.container.find("[elem=viewNameCont] [elem=viewNameInput]")[0].scrollIntoView({behavior:"smooth",block:"start"}),t=!0,e=!1);let r=ZP5ViewActions.container.find("[elem=setAsDefaultView]").prop("checked"),s=ZP5ViewActions.container.find("[elem=showApproverDetails]").prop("checked"),a=ZP5ViewActions.container.find("[elem=viewPermCont] [elem=viewperm][permtype=self]").prop("checked"),n=ZP5ViewActions.container.find("[elem=viewPermCont] [elem=viewperm][permtype=all]").prop("checked"),o=ZP5ViewActions.container.find("[elem=viewPermCont] [elem=viewperm][permtype=specific]").prop("checked"),l=null,d=null;a||(l=n,!l&&o&&(d={},ZP5ViewActions.sharedTo.isAnyApplicabilitySelected()?ZP5ViewActions.sharedTo.getSharedViewApplicability(d):(ZP5ViewActions.container.find("[elem=viewSharedToCont] [elem=sharedToErrorMsg]").html(ZPI18N.getString("zp.selectonecri")),ZP5ViewActions.container.find("[elem=viewSharedToCont] [elem=sharedviewcontainer]").addClass("ztextbox__error"),FrameworkCommon.show(ZP5ViewActions.container.find("[elem=viewSharedToCont] [elem=sharedToErrorMsg]")),e=!1)));let p=!0,m=[];$.each(ZP5ViewActions.Modal.rightFieldList,((e,t)=>{let i=ZP5ViewActions.Modal.rightFieldExtraDets[t+""],r=i.hasOwnProperty("grouping")&&void 0!==i.grouping?i.grouping:null,s=!i.hasOwnProperty("sorting")||void 0===i.sorting||i.sorting.length<=0?null:i.sorting,a=!(!i.hasOwnProperty("sumEnabled")||void 0===i.sumEnabled)&&i.sumEnabled,n=i.hasOwnProperty("displayName")&&void 0!==i.displayName?i.displayName:void 0,o={formCompID:t+"",refFormID:i.refFormID,grouping:r,sorting:s,sumEnabled:a},l=i.parentFCID;null!=l&&"0"!=l?o.parentFcType=ZP5ViewActions.components.getFieldData(l).fcType:p&&(p=!1);let d=ZP5ViewActions.components.getSavedDispName(t),c=ZP5ViewActions.components.getOriginalDispName(t);n?n!==c&&(o.displayName=n):d&&(o.displayName=c),m.push(o)})),(0==ZP5ViewActions.Modal.rightFieldList.length||p)&&(ZP5ViewActions.container.find("[elem=viewRightColumnsCont] [elem=rightColErrMsg]").html(ZPI18N.getString("zp.pleaseselectonecolumn",new Array(ZSEC.Encoder.encodeForHTML(ZP5ViewActions.Modal.FORM_NAME)))),FrameworkCommon.show(ZP5ViewActions.container.find("[elem=viewRightColumnsCont] [elem=rightColErrMsg]")),t||ZP5ViewActions.container.find("[elem=viewRightColumnsCont] [elem=rightColErrMsg]")[0].scrollIntoView({behavior:"smooth",block:"center"}),e=!1);let c=ZP5ViewActions.criteria.validate();if(!e||!c.isValid)return void ZP5ViewActions.Modal.sliderDiv.find("#sliderSbt").removeClass("disabled").prop("disabled",!1);if(!FrameworkCommon.madeChanges.get(ZP5ViewActions.Modal))return ZPeople.Message.warning(ZPI18N.getString("zp.nochangesmade")),void ZP5ViewActions.Modal.close();let u={mode:"saveView",formID:ZP5ViewActions.FORMID,viewID:0,expressionID:0,reportPermissionID:0};u.viewName=i,u.isDefaultView=r,u.show_approver=s,u.shareViewToAll=l,u.specificView=JSON.stringify(d),u.components=JSON.stringify(m),u.crtJson=JSON.stringify(c.crtJson),ZP5ViewActions.Modal.isEdit&&(u.mode="updateView",u.viewID=ZP5ViewActions.VIEWID,u.expressionID=ZP5ViewActions.Modal.expressionID,u.reportPermissionID=ZP5ViewActions.Modal.reportPermissionID,ZP5ViewActions.Modal.hasActiveTranslation&&delete u.viewName),ZPeople.Request.send(ZP5ViewActions.url,u,ZP5ViewActions.handleSaveResponse,{},ZP5ViewActions.failureCallback)},handleSaveResponse:(e,t,i)=>{if(ZP5ViewActions.Modal.sliderDiv.find("#sliderSbt").removeClass("disabled").prop("disabled",!1),void 0!==e.error)return void ZP5ViewActions.showErrorMessage(e,ZPI18N.getString("zp.addmodifyerror"));if(!e.viewDetails.isSuccess){if(e.viewDetails.hasOwnProperty("error")&&e.viewDetails.error.hasOwnProperty("message")&&"DISPLAY_NAME_TRANSLATION_ERROR"==e.viewDetails.error.message)return void DisplayNameLocalizationError.show();if(!e.viewDetails.isValidCriteria)return void ZPeople.Message.failure(ZPI18N.getString("zp.invalidentries"))}ZP5ViewActions.VIEWID=e.viewDetails.viewId;let r=ZPeople.Module.getData(),s=r.viewDetails.message;if(e.viewDetails.isUserDefaultView&&"true"==e.viewDetails.isUserDefaultView&&$.each(s,(function(e,t){ZP5ViewActions.VIEWID!==t.viewId&&(this.isUserDefaultView=!1)})),"ADD"===e.action){let t={displayName:ZSEC.Encoder.encodeForHTML(e.viewDetails.displayName),isUserDefaultView:"true"===e.viewDetails.isUserDefaultView,viewType:e.viewDetails.viewType,isCustomView:"true"===e.viewDetails.isCustomView,viewId:e.viewDetails.viewId,viewName:e.viewName,ownerId:e.viewDetails.ownerId,isSharedView:"true"===e.viewDetails.isSharedView,viewOwnerType:e.viewDetails.viewOwnerType};s.push(t)}else{let t=ZP5Views.getSelectedView(e.viewDetails.viewId);if(void 0!==t){let i=r.viewDetails.message.indexOf(t);r.viewDetails.message.splice(i,1),t.displayName=ZSEC.Encoder.encodeForHTML(e.viewDetails.displayName),t.isUserDefaultView="true"===e.viewDetails.isUserDefaultView,t.isCustomView="true"===e.viewDetails.isCustomView,t.isSharedView="true"===e.viewDetails.isSharedView,t.viewOwnerType=e.viewDetails.viewOwnerType,r.viewDetails.message.push(t)}}if(r.viewDetails.loaded=!1,ZP5ViewActions.viewSelect.getObj().length>0){let t=ZP5ViewActions.viewSelect.getObj();ZPeopleComponents.isComponent(t)&&("ADD"===e.action?(ZPeopleComponents.select(t).addOption([{value:ZP5ViewActions.VIEWID,label:e.viewDetails.displayName}],"append",e.viewDetails.viewOwnerType),ZPeopleComponents.select(t).setValue(ZP5ViewActions.VIEWID)):(ZPeopleComponents.select(t).setOptionAttributes(ZP5ViewActions.VIEWID,{label:e.viewDetails.displayName}),t.attr("isChange",!0)))}ZP5ViewActions.Modal.isSuccClose=!0,FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal),ZP5ViewActions.Modal.close()},getOptGroupLabel:e=>{switch(e){case FormConstants.VIEW_OWNER_TYPE.PUBLIC:return ZPI18N.getString("zp.publicviews");case FormConstants.VIEW_OWNER_TYPE.PRIVATE:return ZPI18N.getString("zp.myviews");case FormConstants.VIEW_OWNER_TYPE.SHARED:return ZPI18N.getString("zp.sharedviews");case FormConstants.VIEW_OWNER_TYPE.OTHERS:return ZPI18N.getString("zp.others")}return ZPI18N.getString("zp.publicviews")}};class ImportV5{constructor(e,t){this.mode=e||"form",this.Handler=ZP5Import.getHandlerInstance(e),this.Handler.setImportInstance(this),this.initInstance(e),this.setInitialValues(t)}static getURL(){return"/Import.zp"}setInitialValues(e){this.currentStep=1,this.uploadFileSubStep=!1,this.initMappings=!1,this.mappingForward=!1,this.refresh=!1,this.isDupShow=!1,this.isImportBasedOn="1",this.fileList="",this.uniqueFieldOptions=[],this.isAlertAutomation=!0,this.MAPPINGS={},this.props=e||{}}initInstance(e){this.UploadFile=ZP5Import.getUploadInstance(e),this.UploadFile.setImportInstance(this),this.getIsBulkFileUpload()||(this.Mappings=ZP5Import.getMappingsInstance(e),this.Mappings.setImportInstance(this)),this.Summary=ZP5Import.getSummaryInstance(e),this.Summary.setImportInstance(this),this.Slider=ZP5Import.getSliderInstance(e),this.Slider.setImportInstance(this)}getMode(){return this.mode}getUploadInstance(){return this.UploadFile}getMappingsInstance(){return this.Mappings}getSummaryInstance(){return this.Summary}getHandler(){return this.Handler}getSliderInstance(){return this.Slider}setSliderModal(e){this.SliderModal=e}getSliderModal(){return this.SliderModal}getCurrentStep(){return this.currentStep}setCurrentStep(e){this.currentStep=e}setUploadFileSubStep(e){this.uploadFileSubStep=e}getUploadFileSubStep(){return this.uploadFileSubStep}getInitMappings(){return this.initMappings}setMappingForward(e){this.mappingForward=e}getMappingForward(){return this.mappingForward}setInitMappings(e){this.initMappings=e}getRefresh(){return this.refresh}setRefresh(e){this.refresh=e}setDupShow(e){this.isDupShow=e}getDupShow(){return this.isDupShow}setIsImportBasedOn(e){this.isImportBasedOn=e}getIsImportBasedOn(){return this.isImportBasedOn}setFileList(e){this.fileList=e}getFileList(){return this.fileList}setUniqueFieldOptions(e){this.uniqueFieldOptions=e}getUniqueFieldOptions(){return this.uniqueFieldOptions}setContainer(e){this.container=e}getContainer(){return this.container}setBaseFormId(e){this.baseFormId=e}getBaseFormId(){return this.baseFormId}setLabelName(e){this.labelName=e}getLabelName(){return this.labelName}setSecArr(e){this.secArr=e}getSecArr(){return this.secArr}setDataChangeForms(e){this.dataChangeForms=e}getDataChangeForms(){return this.dataChangeForms}setCandidateFields(e){this.candidateFields=e}getCandidateFields(){return this.candidateFields}setUniqueFields(e){this.uniqueFields=e}getUniqueFields(){return this.uniqueFields}setTableName(e){this.tableName=e}getTableName(){return this.tableName}setIsWorkFlowAvailable(e){this.isWorkFlowAvailable=this.triggerWorkflow=e}getIsWorkFlowAvailable(){return this.isWorkFlowAvailable}setIsApprovalConfigured(e){this.isApprovalConfigured=this.triggerApproval=e}getIsApprovalConfigured(){return this.isApprovalConfigured}setIsCasesNotifyAvailable(e){this.isCasesNotifyAvailable=this.notifyCases=e}getIsCasesNotifyAvailable(){return this.isCasesNotifyAvailable}setIsCVConfigured(e){this.isCVConfigured=this.triggerCV=e}getIsCVConfigured(){return this.isCVConfigured}setTotalLicenseCount(e){this.totalLicenseCount=e}getTotalLicenseCount(){return this.totalLicenseCount}setEmployeesAdded(e){this.employeesAdded=e}getEmployeesAdded(){return this.employeesAdded}setLicenseCountLeft(e){this.licenseCountLeft=e}getLicenseCountLeft(){return this.licenseCountLeft}setOtherAppLicense(e){this.otherAppLicense=e}getOtherAppLicense(){return this.otherAppLicense}setAdminPanelAppsPageUrl(e){this.adminPanelAppsPageUrl=e}getAdminPanelAppsPageUrl(){return this.adminPanelAppsPageUrl}setImportFormId(e){this.importFormId=e}getImportFormId(){return this.importFormId}setImportUniqueId(e){this.importUniqueId=e}getImportUniqueId(){return this.importUniqueId}setImportId(e){this.importId=e}getImportId(){return this.importId}setIsAlertAutomation(e){this.isAlertAutomation=e}getIsAlertAutomation(){return this.isAlertAutomation}getIsTabularImport(){return this.getBaseFormId()!=this.getImportFormId()}setFileType(e){this.fileType=e}getFileType(){return this.fileType}getMappings(){return this.MAPPINGS}removeMappings(){this.MAPPINGS={}}mapColumn(e,t){this.MAPPINGS[e]=t}getTriggerWorkflow(){return this.triggerWorkflow}setTriggerWorkflow(e){this.triggerWorkflow=e}getTriggerApproval(){return this.triggerApproval}setTriggerApproval(e){this.triggerApproval=e}getNotifyCases(){return this.notifyCases}setNotifyCases(e){this.notifyCases=e}getTriggerCV(){return this.triggerCV}setTriggerCV(e){this.triggerCV=e}setPrevMappings(e){this.prevMappings=e}getPrevMappings(){return this.prevMappings}setTableHeaders(e){this.tableHeaders=e}getTableHeaders(){return this.tableHeaders}setFormDetails(e){this.formDetails=e}getFormDetails(){return this.formDetails}setFName(e){this.fName=e}getFName(){return this.fName}setFileData(e){this.fileData=e}getFileData(){return this.fileData}getIsBulkFileUpload(){return!1}init(){if(this.getHandler().isFormBasedInit()){let e={mode:"init"};e.formId=this.getHandler().getFormId(),this.getHandler().initAdditionalParamsCallback(e),this.getSliderInstance().open(),ZPeople.Request.send(ImportV5.getURL(),e,this.getUploadInstance().init.bind(this.getUploadInstance()),{},this.failCallback.bind(this))}else this.getUploadInstance().init()}failCallback(e,t,i){let r=(e,t,i)=>{this.getSliderModal().close()};ServiceApplicabilityUtil.Error.showWarningMessage(e,t,i,r.bind(this))||(e.responseText.indexOf("IAM_SECURITY_ERROR")>-1?ZPeople.Message.failure(ZPI18N.getString("zp.permissiondenied")):ZPeople.Message.failure(ZPI18N.getString("zp.sorryservererror")),r())}static validateLocation(e,t){let i={isLocationTrackingEnabled:!1};ZP5Import.CURROBJ.getHandler().isLocationTrackingEnabled(e)?(i.isLocationTrackingEnabled=!0,FrameworkCommon.Location.fetch(t,i)):t(i)}showAlertBeforeImportData(){return this.getIsAlertAutomation()&&this.getHandler().showAlertBeforeImportData()}alertBeforeImportData(){let e=new InfoAlertMessage(ZPI18N.getString("zp.doyouwantto"),ZPeople.LOADING_HTML);e.cancelButtonText=ZPI18N.getString("zp.close"),e.needButton=!0,e.handleESC=!0,e.yesButtonText=ZPI18N.getString("zp.proceed"),e.setCallback(function(){this.setTriggerWorkflow(e.alertDiv.find("[elem=importExecuteWorkflowContainer] [name=executeworkflow]").prop("checked")),this.setTriggerApproval(e.alertDiv.find("[elem=importSendforApprovalContainer] [name=sendforapproval]").prop("checked")),this.setNotifyCases(e.alertDiv.find("[elem=importCasesNotifyContainer] [name=casesnotify]").prop("checked")),this.getIsBulkFileUpload()||this.setTriggerCV(e.alertDiv.find("[elem=importTriggerCVContainer] [name=triggerCV]").prop("checked")),this.setIsAlertAutomation(!1),this.getHandler().alertAutomationCallback()}.bind(this)),e.setCloseCallback(function(){this.setIsAlertAutomation(!0)}.bind(this)),e.show(),e.alertDiv.find(".zpl_mcnt .cont").html(this.getHandler().constructAlertModalContent())}}class ImportV5Slider{constructor(){}setImportInstance(e){this.IMPORTV5=e}getImportInstance(){return this.IMPORTV5}getModalHeader(){return this.getImportInstance().getHandler().getModalHeader()}open(){let e=e=>{e.setCallback(this._callback.bind(this)),e.setValidate(this._validate.bind(this))};e.bind(this);let t=this.getImportInstance().getMappingsInstance().getConstructTab(),i=this.getImportInstance().getMappingsInstance().getVerifyTab(),r=this.getImportInstance().getSummaryInstance().getTab();e(t),e(i),e(r),this.getImportInstance().setSliderModal(new fullPageModal(this.getModalHeader(),t,i,r)),this.getImportInstance().getSliderModal()._fullPageModalId="importModal",this.getImportInstance().getSliderModal().topNavigation=!0,this.getImportInstance().getSliderModal()._saveToggle=!1,this.getImportInstance().getSliderModal()._previousToggle=!0,this.getImportInstance().getSliderModal().setCloseCallback(this._close.bind(this)),this.getImportInstance().getSliderModal().construct(0),this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getConstructMappingsTabId()).addClass("disabled"),this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getVerifyMappingsTabId()).addClass("disabled"),this.getImportInstance().getContainer().find("#"+ImportV5Summary.getTabId()).addClass("disabled"),this.handleFooter(),this.getImportInstance().getSliderModal().open()}_callback(e){this.getImportInstance().setContainer(e.mainWrapId.find(`#${e._fullPageModalId}`)),FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=fileDataPaginationFooter]")),e.isCardIntialCallback()&&(e.currentTab.id==ImportV5Mappings.getConstructMappingsTabId()&&(FrameworkCommon.hide(this.getImportInstance().getContainer().find("#tabLeftUl").parents(".zpl_mmnulft")),this.getImportInstance().getContainer().removeClass("zpl_mdltopnav")),this.getImportInstance().getContainer().find("#"+e.currentTab.cardId).html(""),e.currentTab.id==ImportV5Summary.getTabId()&&this.getImportInstance().getContainer().find("#"+e.currentTab.cardId).append(this.getImportInstance().getSummaryInstance().getPage()),FrameworkCommon.addLoading(this.getImportInstance().getContainer().find("#"+e.currentTab.cardId))),e.currentTab.id==ImportV5Mappings.getConstructMappingsTabId()?this.getImportInstance().getInitMappings()||this.getImportInstance().getMappingForward()?this.getImportInstance().setCurrentStep(2):this.getImportInstance().setCurrentStep(1):e.currentTab.id==ImportV5Mappings.getVerifyMappingsTabId()?this.getImportInstance().setCurrentStep(3):e.currentTab.id==ImportV5Summary.getTabId()&&this.getImportInstance().setCurrentStep(4),this.handleFooter()}_validate(e){this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getConstructMappingsTabId()).addClass("disabled"),this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getVerifyMappingsTabId()).addClass("disabled"),this.getImportInstance().getContainer().find("#"+ImportV5Summary.getTabId()).addClass("disabled");let t=this.getImportInstance().getCurrentStep();1==t&&e._stackCallTab.id==ImportV5Mappings.getConstructMappingsTabId()?e._isValidated=!0:2==t?(this.getImportInstance().getInitMappings()?(e._stackCallTab.id==ImportV5Mappings.getConstructMappingsTabId()?e._isValidated=!0:e._stackCallTab.id==ImportV5Mappings.getVerifyMappingsTabId()&&(e._isValidated=this.getImportInstance().getMappingsInstance().forwardToVerification()),this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getVerifyMappingsTabId()).removeClass("disabled")):e._stackCallTab.id==ImportV5Mappings.getVerifyMappingsTabId()?(e._stackCallTab=e.currentTab,e._isValidated=!0):e._isValidated=!1,this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getConstructMappingsTabId()).removeClass("disabled")):3!=t||e._stackCallTab.id!=ImportV5Mappings.getConstructMappingsTabId()&&e._stackCallTab.id!=ImportV5Mappings.getVerifyMappingsTabId()?4==t&&e._stackCallTab.id==ImportV5Summary.getTabId()?(e._isValidated=!0,this.getImportInstance().getContainer().find("#"+e._stackCallTab.id).removeClass("disabled"),this.getImportInstance().getMappingsInstance().emptyFileData(),FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=fileDataPaginationFooter]"))):e._isValidated=!1:(e._isValidated=!0,this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getConstructMappingsTabId()).removeClass("disabled"),this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getVerifyMappingsTabId()).removeClass("disabled")),e._isValidated&&e._stackCallTab&&e.showTab(e._stackCallTab)}prevTab(){FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=fileDataPaginationFooter]")),this.getImportInstance().getSliderModal().previousTab(!0)}handleFooter(){let e=this.getImportInstance().getSliderModal().modalFooter;FrameworkCommon.hide(e.find("#previousButton")),FrameworkCommon.hide(e.find("#nextButton")),e.find("#previousButton").addClass("disabled").prop({disabled:!0}).off("click"),e.find("#nextButton").addClass("disabled").prop({disabled:!0}).off("click");let t=this.getImportInstance().getCurrentStep();1==t?(this.getImportInstance().getUploadFileSubStep()?this.getImportInstance().getDupShow()?e.find("#nextButton").removeClass("disabled").prop({disabled:!1}).on("click",this.getImportInstance().getUploadInstance().toggleSteps.bind(this.getImportInstance().getUploadInstance())):e.find("#nextButton").removeClass("disabled").prop({disabled:!1}).on("click",this.getImportInstance().getUploadInstance().forward.bind(this.getImportInstance().getUploadInstance())):e.find("#nextButton").removeClass("disabled").prop({disabled:!1}).on("click",this.getImportInstance().getUploadInstance().toggleSteps.bind(this.getImportInstance().getUploadInstance())),FrameworkCommon.show(e.find("#nextButton"))):2==t?this.getImportInstance().getInitMappings()&&(e.find("#nextButton").removeClass("disabled").prop({disabled:!1}).on("click",this.getImportInstance().getMappingsInstance().forwardToVerification.bind(this.getImportInstance().getMappingsInstance())),FrameworkCommon.show(e.find("#nextButton"))):3==t?(e.find("#previousButton").removeClass("disabled").prop({disabled:!1}).on("click",this.prevTab.bind(this)),e.find("#nextButton").removeClass("disabled").prop({disabled:!1}).on("click",this.getImportInstance().getHandler().alertAutomationCallback.bind(this.getImportInstance().getHandler())),FrameworkCommon.show(e.find("#previousButton")),FrameworkCommon.show(e.find("#nextButton"))):4==t&&e.find("#cancelButton").text(ZPI18N.getString("zp.close"))}_close(e){e.remove();let t=this.getImportInstance().getHandler().closeCallback();this.getImportInstance().getRefresh()&&this.getImportInstance().getHandler().refreshCallback(),this.getImportInstance().getHandler().hashChangeCallback(t),ZP5Import.destroy()}}class ImportV5UploadFile{constructor(){}setImportInstance(e){this.IMPORTV5=e}getImportInstance(){return this.IMPORTV5}init(e,t,i){if(e.isSuccess){this.getImportInstance().setBaseFormId(e.baseFormId),this.getImportInstance().setLabelName(e.labelName),this.getImportInstance().setSecArr(e.secArr),this.getImportInstance().setDataChangeForms(e.dataChangeForms),this.getImportInstance().setCandidateFields(e.candidateFields),this.getImportInstance().setUniqueFields(e.uniqueFields),this.getImportInstance().setTableName(e.tableName),this.getImportInstance().setIsWorkFlowAvailable(e.isWorkFlowAvailable),this.getImportInstance().setIsApprovalConfigured(e.isApprovalConfigured),this.getImportInstance().setIsCasesNotifyAvailable(e.isCasesNotifyAvailable),this.getImportInstance().setIsCVConfigured(e.isCVAvailable),"P_Employee"===this.getImportInstance().getHandler().getTableName()&&(this.getImportInstance().setTotalLicenseCount(e.totalLicenseCount),this.getImportInstance().setEmployeesAdded(e.employeesAdded),this.getImportInstance().setLicenseCountLeft(e.licenseCountLeft),this.getImportInstance().setOtherAppLicense(e.otherappLicense),this.getImportInstance().setAdminPanelAppsPageUrl(e.adminPanelAppsPageUrl));let t=(e,t)=>{e.isLocationTrackingEnabled&&!t.isPermEnabled?(FrameworkCommon.showInfoAlert("",ZPI18N.getString("zp.requestuserlocation")+" "+ZPI18N.getString("zp.blockedlocation")),this.getImportInstance().getSliderModal().close()):(FrameworkCommon.removeLoading(this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getConstructMappingsCardId())),this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getConstructMappingsCardId()).addClass("zpl_crdwthful zpl_crdfull"),this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getConstructMappingsCardId()).html(this._getPage()),FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=uploadFileContainer]")),this._defaultActions())};t.bind(this),ImportV5.validateLocation(this.getImportInstance().getBaseFormId(),t)}else ZPeople.Message.failure(ZPI18N.getString("zp.sorryservererror")),this.getImportInstance().getSliderModal().close()}_defaultActions(){this.getImportInstance().getContainer().find('[elem="importFileButton"]').off("click").on("click",function(e){this.getImportInstance().setFileList(this.getImportInstance().getContainer().find("[elem=importFile]")[0].files),$(e.target).siblings("[elem=importFile]").trigger("click")}.bind(this)),FrameworkCommon.removeError(this.getImportInstance().getContainer().find("[elem=filesDropContainer]")),FrameworkCommon.initDragDropFiles(this.getImportInstance().getContainer().find('[elem="filesDropContainer"]'),this.getImportInstance().getContainer(),(e=>{if($.inArray(e[0].name.split(".").pop(),["csv","xls","xlsx"])>-1){this.getImportInstance().setFileList(this.getImportInstance().getContainer().find("[elem=importFile]")[0].files);let t=new DataTransfer;t.items.add(e[0]),this.getImportInstance().getContainer().find('[elem="importFile"]')[0].files=t.files,this.getImportInstance().getContainer().find('[elem="importFile"]').trigger("change")}else ZPeople.Message.failure(ZPI18N.getString("zp.formfomtsupportxlscsv"))}).bind(this),1),this.getImportInstance().getContainer().find('[elem="importFile"]').off("change").on("change",this._handleUploadedFile.bind(this)),this.getImportInstance().getContainer().find("[elem=downloadSampleTemplate]").off().on("click",this.getImportInstance().getHandler().downloadTemplate.bind(this.getImportInstance().getHandler())),this._showHideMobileUserHelp(),this.getImportInstance().getHandler().uploadInitialCallback()}_showHideMobileUserHelp(){FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=importMobileUserHelp1],[elem=importMobileUserHelp2],[elem=importMobileUserHelp3]")),"P_Employee"==this.getImportInstance().getHandler().getTableName()&&(this.getImportInstance().getHandler()._allowMobileUsersAddition()?(FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=importMobileUserHelp1]")),FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=importMobileUserHelp2]"))):FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=importMobileUserHelp1],[elem=importMobileUserHelp2]")),FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=importMobileUserHelp3]")),FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=importHelpInfoContainer]")))}_getLicenseCountDiv(){let e="";if("P_Employee"==this.getImportInstance().getHandler().getTableName()){if(e+='<div elem="licenseCountDiv" class=""><div class="zpl_btnmnu"><div><ul class="zpl_grpmnulnelst">',e+="<li>"+ZPI18N.getString("zp.totallicense")+'<b class="ylw" elem="totalLicenseCount">'+this.getImportInstance().getTotalLicenseCount()+"</b></li>",e+="<li>"+ZPI18N.getString(this.getImportInstance().getHandler().is(ZP5Import.HANDLER_MODE.PROFILE)?"zp.employeeprofilesadded":"zp.usersadded")+'<b class="ylw" elem="addedCount">'+this.getImportInstance().getEmployeesAdded()+"</b></li>",(Layout.isZohoOne||Layout.isPeoplePlus)&&null!=this.getImportInstance().getOtherAppLicense()&&0!=this.getImportInstance().getOtherAppLicense()&&-1!=this.getImportInstance().getOtherAppLicense()){var t=Layout.isPeoplePlus?"People Plus":"Zoho One";e+="<li>"+ZPI18N.getString("zp.otherappsusage",[t])+' <b class="ylw" elem="otherappsusage"><a target="_blank" href='+this.getImportInstance().getAdminPanelAppsPageUrl()+" >"+this.getImportInstance().getOtherAppLicense()+"</a></b></li>"}e+="<li>"+ZPI18N.getString("zp.remaining")+':<b class="ylw" elem="remainingCount">'+this.getImportInstance().getLicenseCountLeft()+"</b></li>",e+="</ul></div></div></div>"}return e}_getPage(){let e='<form elem="uploadFileForm">';return e+=this._getLicenseCountDiv(),e+='<div class="zpl_crd" elem="card"><div class="zpl_crdcnt DNI" elem="uploadFileContainer">',e+=this.getImportInstance().getHandler().constructImportDataFor(),e+='<div class="zpl_secn DNI" elem="importHelpInfoContainer"><div><div class="zpl_info" ele="importHelpInfo">',e+='<h6 elem="helpInfoHeader"><b>'+ZPI18N.getString("zp.note")+"</b>:</h6>",e+=this._getHelpContent(),e+="</div></div></div>",e+='<div class="zpl_secn"><div><div class="zpl_upld"><div class="zpl_fldrp" elem="filesDropContainer">',e+='<div class="zpl_mdimprtimg"></div>',e+='<h4 elem="importFileNameCont">'+ZPI18N.getString("zp.draganddropatthere")+"</h4>",e+='<p elem="filehelp">'+ZPI18N.getString("zp.formfomtsupportxlscsv")+"</p>",e+='<input class="DNI" type="file" name="theFile" accept=".xls,.xlsx,.csv" elem="importFile">',e+='<button type="button" class="zlabel zlabel--blue zlabel--medium" elem="importFileButton">'+ZPI18N.getString("zp.uploadfile")+"</button>",e+='<p elem="filehelp">'+ZPI18N.getString("zp.maxfilesize")+"</p>",e+='<p elem="filehelp"><a elem="downloadSampleTemplate"><b>'+ZPI18N.getString("zp.downloadsampletemplate")+"</b></a></p>",e+="</div></div></div></div>",e+='<div class="zpl_crdcnt DNI" elem="uploadFileHandleDiv">',e+='<div class="zpl_Emptydata zpl_txtlft"><div>',e+="</div></div></div>",this.getImportInstance().getHandler().isModuleBasedImport()||(e+='<input type="hidden" value="" name="formId"/>'),e+='<input type="hidden" value="uploadFile" name="mode"/>',e+='<input type="hidden" name="paimpcheck" value=false />',e+='<input type="hidden" name="conreqcsr" value="" />',e+='<input type="hidden" name="importBasedOnValue" value="'+this.getImportInstance().getIsImportBasedOn()+'" />',e+="</form>",e}_getHelpContent(){let e='<ul> <li elem="importHelp" class="DNI"></li>';return e+='<li elem="importDuplHelp" class="DNI"></li>',e+='<li elem="importMobileUserHelp1" class="DNI">'+ZPI18N.getString("zp.importtempForMob1")+"</li>",e+='<li elem="importMobileUserHelp2" class="DNI">'+ZPI18N.getString("zp.importtempForMob2")+"</li>",e+='<li elem="importMobileUserHelp3" class="DNI">'+ZPI18N.getString("zp.importtempForMob3")+"</li><ul>",e}initImportDataFor(){let e=[],t=ComponentsCommon.select.getProps(),r=this.getImportInstance().getSecArr();if(e.push({label:ZPeople.decodeTxt(this.getImportInstance().getLabelName()),value:this.getImportInstance().getBaseFormId()}),r)for(i=0;i<r.length;i++)e.push({label:ZPeople.decodeTxt(r[i].labelName),value:r[i].formId});t.change=this._impFormChange.bind(this),ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importDataFor]"),t),this.setSelectValue(this.getImportInstance().getContainer().find("[elem=importDataFor]"),e)}setSelectValue(e,t){t.length>0&&(ZPeopleComponents.select(e).setAttributes({options:t}),ZPeopleComponents.select(e).setValue(t[0].value))}_setUniqueFields(){let e=this.getImportInstance().getUniqueFields(),t=[];if(e)for(i=0;i<e.length;i++){let r=e[i].formcomponentId;t.push({label:ZPeople.decodeTxt(e[i].displayName),value:r})}this.getImportInstance().setUniqueFieldOptions(t)}_getImportBasedOptions(){let e=[];return $.each(this.getImportInstance().getUniqueFieldOptions(),(function(t,i){e.push(i)})),this.getImportInstance().getHandler().addImportBasedOnOptions(e),e}initImportDataBasedOn(){this._setUniqueFields();let e=ComponentsCommon.select.getProps();e.change=this.showUniqueFieldNote.bind(this),ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importBasedOn]"),e);let t=this._getImportBasedOptions(),i=t.length>0;t.unshift({label:ZPI18N.getString("zp.select"),value:"-2"}),this.setSelectValue(this.getImportInstance().getContainer().find("[elem=importBasedOn]"),t),this._handleImportBasedOn(i)}_handleImportBasedOn(e){this.getImportInstance().getHandler().hideBasedOnSelectDiv(),this.getImportInstance().getHandler().showBasedOnAllowed()&&e&&this.getImportInstance().getHandler().showBasedOnSelectDiv()}_impFormChange(e){if(!ComponentsCommon.isUIEvent(e))return;let t=ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importDataFor]")).getValue(),i=!1,r=[{label:ZPI18N.getString("zp.select"),value:"-2"}];t!=this.getImportInstance().getBaseFormId()&&(i=!0,r=[{label:ZPI18N.getString("zp.zoholinkId"),value:"-1"}]),$.each(this._getImportBasedOptions(),(function(e,t){r[0].value!=t.value&&(i=!0,r.push(t))})),ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importBasedOn]")).removeAllOptions(),ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importBasedOn]")).refresh(),this.setSelectValue(this.getImportInstance().getContainer().find("[elem=importBasedOn]"),r),this._handleImportBasedOn(i),this.showUniqueFieldNote(),"P_Employee"===this.getImportInstance().getHandler().getTableName()&&(t!=this.getImportInstance().getBaseFormId()?this.getImportInstance().getContainer().find("[elem=licenseCountDiv]").addClass("DNI"):this.getImportInstance().getContainer().find("[elem=licenseCountDiv]").removeClass("DNI"))}showUniqueFieldNote(e){if(e&&e.detail&&!0!==e.detail.fromUI)return;this.getImportInstance().setDupShow(!1),FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=importHelpInfoContainer]"));let t=ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importBasedOn]")).getValue(),i=0,r="",s=!1;if(""!=t&&"-2"!=t)if("0"==t.trim())i=this.getImportInstance().getCandidateFields().length,r=this.getImportInstance().getCandidateFields().join(",");else if("-1"==t.trim())i=1,r=ZPI18N.getString("zp.zoholinkId");else{let e=[];$.each(this.getImportInstance().getUniqueFields(),(function(r,a){"Candidate_Key"!=a.labelName&&t==a.formcomponentId&&(i=1,s=null!=a.fcType&&a.fcType==FormConstants.FieldType.AUTONUMBER,e.push(a.displayName))})),r=e.join(",")}if(i>0){let e=ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importDataFor]")).getValue();this.getImportInstance().getBaseFormId()!=e?(FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=importDuplHelp]")),this.getImportInstance().setDupShow(!1),1==i?(this.getImportInstance().getContainer().find("[elem=importHelp]").html(ZPI18N.getString("zp.importUniqueFieldsNoteSingleField",[r])),FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=importHelp]"))):(this.getImportInstance().getContainer().find("[elem=importHelp]").html(ZPI18N.getString("zp.importUniqueFieldsNote",[i,r])),FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=importHelp]")))):("-1"==t||s?(this.getImportInstance().getContainer().find("[elem=importHelp]").html(ZPI18N.getString("zp.importUniqueFieldsNoteSingleField",[r])),FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=importHelp]"))):FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=importHelp]")),this.getImportInstance().getContainer().find("[elem=importDuplHelp]").html(ZPI18N.getString("zp.importDuplicateMessage",[r])),FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=importDuplHelp]")),this.getImportInstance().setDupShow(!0)),FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=importHelpInfoContainer]"))}else"P_Employee"===this.getImportInstance().getHandler().getTableName()?(FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=importHelp]")),FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=importDuplHelp]"))):"P_Resignation"===this.getImportInstance().getHandler().getTableName()&&FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=importHelpInfoContainer]")),this.getImportInstance().setDupShow(!1);this._showHideMobileUserHelp()}toggleSteps(e){$(e.target).addClass("disabled").prop({disabled:!0});let t=this.getImportInstance().getContainer().find('[elem="importFile"]').val(),i=this.getImportInstance().getDupShow();if(null==t||null==t||""==t.trim())this.getImportInstance().getContainer().find("[elem=filesDropContainer]").addClass("fldrp_err"),FrameworkCommon.showError(ZPI18N.getString("zp.uploadfilewarning"),this.getImportInstance().getContainer().find("[elem=filesDropContainer]")),$(e.target).removeClass("disabled").prop({disabled:!1});else if(this.getImportInstance().setCurrentStep(1),this.getImportInstance().setUploadFileSubStep("nextButton"==$(e.target).attr("id")),this.getImportInstance().getUploadFileSubStep())if(i){let e=new InfoAlertMessage(ZPI18N.getString("zp.importBasedOnValue"),ZPeople.LOADING_HTML);e.cancelButtonText=ZPI18N.getString("zp.close"),e.needButton=!0,e.yesButtonText=ZPI18N.getString("zp.proceed"),e.setCloseCallback(function(){FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=uploadFileContainer]"))}.bind(this)),e.setCallback(function(){this.getImportInstance().setIsImportBasedOn(e.alertDiv.find('[elem=importDuplCaseCont] input[name="importBasedOnValue"]:checked').attr("value")),this.forward()}.bind(this));let t='<div class="zpl_secn" elem="importDuplCaseCont" ><h3>'+ZPI18N.getString("zp.importBasedOnValue")+"</h3><br>";t+='<div><div class="zradiobutton zradiobutton--horizontal"><input id="importAddRadio" type="radio" value="0" class="zradiobutton__helper" name="importBasedOnValue" ><label for="importAddRadio" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.add")+"</span></label></div>",t+='<div class="zradiobutton zradiobutton--horizontal"><input id="importUpdateRadio" type="radio" value="2" class="zradiobutton__helper" name="importBasedOnValue"><label for="importUpdateRadio" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.update")+"</span></label></div>",t+='<div class="zradiobutton zradiobutton--horizontal"><input id="importOverwriteradio" type="radio" value="1" class="zradiobutton__helper" name="importBasedOnValue" checked=""><label for="importOverwriteradio" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.both")+"</span></label></div></div></div>",e.show(),e.alertDiv.find(".zpl_mcnt .cont").html(t)}else this.forward();else FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=uploadFileContainer]")),FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=uploadFileHandleDiv]"));this.getImportInstance().getSliderInstance().handleFooter()}_handleUploadedFile(e){let t=this.getImportInstance().getFileList();if(""!=t&&common._empty($(e.target).val())&&(this.getImportInstance().getContainer().find("[elem=importFile]")[0].files=t),this.getImportInstance().getContainer().find("[elem=importFile]")[0].files[0].size/1048576>5)return this.getImportInstance().getContainer().find("[elem=importFile]")[0].files=t,ZPeople.Message.failure(ZPI18N.getString("zp.maxfilesize")),void this.getImportInstance().setFileList("");this.getImportInstance().setFileList(""),$(e.target).siblings("[elem=importFileButton]").text(ZPI18N.getString("zp.removeandnew")),this.getImportInstance().getHandler().isModuleBasedImport()||this.showUniqueFieldNote(),FrameworkCommon.hide(this.getImportInstance().getContainer().find('[elem="filehelp"]'));let i=$(e.target).val();i=i.replace("C:\\fakepath\\",""),$(e.target).parents("[elem=filesDropContainer]").find("[elem=importFileNameCont]").text(i),common._empty(i)?(""!=t&&(this.getImportInstance().getContainer().find("[elem=importFile]")[0].files=t),this.getImportInstance().getContainer().find("[elem=filesDropContainer]").addClass("fldrp_err"),FrameworkCommon.showError(ZPI18N.getString("zp.uploadfilewarning"),this.getImportInstance().getContainer().find("[elem=filesDropContainer]"))):(this.getImportInstance().getContainer().find("[elem=filesDropContainer]").removeClass("fldrp_err"),FrameworkCommon.removeError(this.getImportInstance().getContainer().find("[elem=filesDropContainer]")))}forward(){this.getImportInstance().getSliderModal().modalFooter.find("#nextButton").addClass("disabled").prop({disabled:!0}),FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=uploadFileContainer]")),FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=uploadFileHandleDiv]")),this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getConstructMappingsCardId()).find("form[elem=uploadFileForm]").find("[name="+csrfParamName+"]").val(csrfToken);let e=this.getImportInstance().getContainer().find('[elem="importFile"]').val();if(null==e||null==e||""==e.trim())return ZPeople.Message.failure(ZPI18N.getString("zp.uploadfilewarning")),void this.getImportInstance().getSliderModal().modalFooter.find("#nextButton").removeClass("disabled").prop({disabled:!1});this.getImportInstance().getHandler().uploadFileCallback()}}class ImportV5Mappings{constructor(){this.constructMappingsTab=new Tab(ZPI18N.getString("zp.importmapdetails")),this.constructMappingsTab.id=ImportV5Mappings.getConstructMappingsTabId(),this.constructMappingsTab.cardId=ImportV5Mappings.getConstructMappingsCardId(),this.verifyMappingsTab=new Tab(ZPI18N.getString("zp.verify")),this.verifyMappingsTab.id=ImportV5Mappings.getVerifyMappingsTabId(),this.verifyMappingsTab.cardId=ImportV5Mappings.getVerifyMappingsCardId(),this.setStartIndex(1)}static getConstructMappingsTabId(){return"tabMappingDetails"}static getConstructMappingsCardId(){return"cardMappingDetails"}static getVerifyMappingsTabId(){return"tabVerifyMappings"}static getVerifyMappingsCardId(){return"cardVerifyMappings"}getConstructTab(){return this.constructMappingsTab}getVerifyTab(){return this.verifyMappingsTab}setImportInstance(e){this.IMPORTV5=e}getImportInstance(){return this.IMPORTV5}setStartIndex(e){this.stIndex=e}getStartIndex(){return this.stIndex}setFileData(e){this.fileData||(this.fileData={}),this.fileData[this.getStartIndex().toString()]=e}emptyFileData(){this.fileData={}}getFileData(){return this.hasFileData()?this.fileData[this.getStartIndex().toString()]:{}}hasFileData(){return this.fileData&&this.fileData.hasOwnProperty(this.getStartIndex().toString())}setTotalCount(e){this.totalCount=e}getTotalCount(){return this.totalCount}init(e){if(e.isSuccess){this.getImportInstance().setInitMappings(!0),this.getImportInstance().getHandler().getRecordCount(e)<=0&&(ZPeople.Message.failure(e.errMsg),this.getImportInstance().getSliderModal().close()),this.getImportInstance().setFileType(e.fileType),e.hasOwnProperty("importId")&&this.getImportInstance().setImportId(e.importId),this.getImportInstance().setPrevMappings(e.mappings),this.getImportInstance().setTableHeaders(this.getImportInstance().getHandler().getTableHeaders(e)),this.getImportInstance().setFormDetails({sections:e.sections,dependentFieldMapping:e.dependentFieldMappings}),this.getImportInstance().setFName(e.fName),this.getImportInstance().setFileData(e.data);let t=[];t.push({label:ZPI18N.getString("zp.select"),value:"-1"}),$.each(this.getImportInstance().getTableHeaders(),(function(e,i){t.push({label:ZPeople.decodeTxt(i),value:e+""})})),FrameworkCommon.removeLoading(this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getConstructMappingsCardId())),this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getConstructMappingsCardId()).html(this.getPage()),ComponentsCommon.tooltip.init(this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getConstructMappingsCardId()).find("[zctooltip=true]")),this.getImportInstance().getHandler().constructMappingsCallback();let i=this.getImportInstance().getContainer().find("[elem=collapsiblePanels] [elem=mappingFieldSelectDiv]").length;this.getImportInstance().getContainer().find("[elem=mapToggleDiv]").find("[elem=unmappedCount]").html(i>=10?i:"0"+i),$('<div elem="collapsibleNoData" name="importFieldMapping" class="DNI"></div>').insertAfter(this.getImportInstance().getContainer().find("[elem=collapsiblePanels]")),ZPeopleComponents.collapsiblepanels(this.getImportInstance().getContainer().find("[elem=collapsiblePanels]"),{toggleButtonPosition:"right"});let r=this.getImportInstance().getContainer().find("[elem=enableDisableEmployeeIDFeature]");r&&ZPeopleComponents.toggleswitch(r,{change:this.onClickForToggleDiv.bind(this)}),this.getImportInstance().getContainer().find("[elem=mappingFieldSelectDiv][cname=EMPIDGENRULECODE]")&&FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=mappingFieldSelectDiv][cname=EMPIDGENRULECODE]").parent()),ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=mappingFieldSelectDiv]"),ComponentsCommon.select.getProps({options:t,showSearchField:!0,change:this.changeMapping.bind(this)})),this.getImportInstance().getHandler().isModuleBasedImport()||this.applyPrevMappings(),this.getImportInstance().getHandler().constructMappingsDefaultActionsCallback(),this.getImportInstance().getContainer().find("[elem=mapToggleDiv]").off("click").on("click",this.toggleMapUnmapDiv.bind(this)),this.getImportInstance().getContainer().find("[elem=resetMappingBtn]").off("click").on("click",this.resetMappings.bind(this)),this.getImportInstance().getContainer().find("[elem=autoMappingBtn]").off("click").on("click",this.applyAutoMappings.bind(this)),this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getVerifyMappingsTabId()).removeClass("disabled"),this.getImportInstance().getSliderInstance().handleFooter(),this.updateMappedCount()}else e.errMsg?ZPeople.Message.failure(e.errMsg):ZPeople.Message.failure(ZPI18N.getString("zp.sorryservererror")),this.getImportInstance().getSliderModal().close()}onClickForToggleDiv(e){let t=$(e.target),i=ZPeopleComponents.toggleswitch(t).getState();this.showHideEmployeeIdDiv(i)}showHideEmployeeIdDiv(e){e?(FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=mappingFieldSelectDiv][cname=EMPIDGENRULECODE]").parent()),FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=mappingFieldSelectDiv][cname=EMPLOYEEID]").parent())):(FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=mappingFieldSelectDiv][cname=EMPLOYEEID]").parent()),FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=mappingFieldSelectDiv][cname=EMPIDGENRULECODE]").parent()))}constructSectionDiv(e,t){return e=e||[],t=t||[],this._sectionDiv(e,t)}getPage(){let e='<div class="zpl_btnmnu"><div><ul class="zpl_grpmnu">';return e+=`<li class="zpl_act" elem="mapToggleDiv" elemVal="allfields">${ZPI18N.getString("zp.all")}</li>`,e+=`<li elem="mapToggleDiv" elemVal="mappedfields">${ZPI18N.getString("zp.mapping")} <b elem="mappedCount">00</b></li>`,e+=`<li elem="mapToggleDiv" elemVal="unmappedfields">${ZPI18N.getString("zp.unmapped")} <b elem="unmappedCount"></b></li>`,e+="</ul></div>",e+=`<div class="zpl_rgt"><button elem="resetMappingBtn" class="zlabel zlabel--red zlabel--medium zlabel--outline">${ZPI18N.getString("zp.resetfields")}</button>`,e+=`<button elem="autoMappingBtn" class="zlabel zlabel--blue zlabel--medium zlabel--outline" zctooltip="true" data-title-position="bottom" title="${ZPI18N.getString("zp.automappinginfo")}">${ZPI18N.getString("zp.automapfields")}</button>`,e+="</div></div>",e+='<div class="zpl_rgtcnt zpl_crdwthful"><div class="zpl_crd">',e+='<div class="zpl_crdcnt zpl_colpanls" elem="collapsiblePanels"></div></div></div>',e}_sectionDiv(e,t){let i=e=>{let t="";for(let i=0;i<e.length;i++)t+=this._fieldDiv(e[i]);return t};return'<div class="zpl_secn zpl_twoclum" elem="rowContainer"><div>'+i(e)+"</div><div>"+i(t)+"</div></div>"}_addressFieldSectionDiv(e){let t="",i=e.length;for(let r=0;r<i;r+=2){let s="";i>r&&(s+=this._fieldDiv(e[r])),i>r+1&&(s+=this._fieldDiv(e[r+1]),t+='<div class="zpl_secn zpl_twoclum" elem="rowContainer">'+s+"</div>")}return t}_addressFieldDiv(e){let t='<div elem="addressMappingFieldDiv" style="margin-Top : 20px" class="zpl_gbox wd100_per MT20" isMand="'+e.isMandatory+'" cname="'+e.cname+'" fcid="'+e.id+'"><div><label elem="addressFieldName" '+(e.isMandatory?'class="zpl_mtry"':"")+">"+e.name+'</label></div><div class="d-flexclmcap zpl_secn">';return t+=this._selectChildDiv(e,e.childElements[0]),t+=this._selectChildDiv(e,e.childElements[1]),t+=this._selectChildDiv(e,e.childElements[2]),t+='<div class="zpl_ilnegap">',t+=this._selectChildDiv(e,e.childElements[4]),t+=this._selectChildDiv(e,e.childElements[3]),t+="</div>",t+=this._selectChildDiv(e,e.childElements[5]),t+="</div></div>",t}_combinedFieldsDiv(e){let t="";t=`<div elem="combinedMappingFieldDiv" style="margin-Top : 20px" class="zpl_gbox wd100_per MT20" isMand="${e.isMandatory}" cname="${e.cname}" fcid="${e.id}">`,t+=`<div><label elem="combinedFieldName" ${e.isMandatory?'class="zpl_mtry"':""}>${e.name}</label></div><div class="zpl_secn">`;let i=this;return $.each(e.combinedFields,(function(e,r){let s=r.displayName?r.displayName:r.name;t+=i._selectCombinedDiv(r,s,!1)})),t+="</div></div>",t}_fieldDiv(e){let t="";return"AUTONUM"==e.cname&&this.getImportInstance().getImportUniqueId()!=e.id||(t=void 0!==e.combinedFields?this._combinedFieldsDiv(e):e.c_type==FormConstants.FieldType.ADDRESS?this._addressFieldDiv(e):"EMPLOYEEID"!=e.cname&&"EMPIDGENRULECODE"!=e.cname||"P_Employee"!=this.getImportInstance().getHandler().getTableName()||!ZPeople.EmployeeIDGenEnabled?this._selectDiv(e):this._employeeIDFieldDiv(e)),t}_employeeIDFieldDiv(e){let t="";if("EMPIDGENRULECODE"==e.cname){let i=ZPI18N.getString("zp.empidgeneraion.import.info.added");return"-2"!=this.getImportInstance().getImportUniqueId()&&("2"==this.getImportInstance().getIsImportBasedOn()?i=ZPI18N.getString("zp.empidgeneraion.importinfo.updated"):"1"==this.getImportInstance().getIsImportBasedOn()&&(i=ZPI18N.getString("zp.empidgeneraion.import.info.both"))),t=this._selectDiv(e,i),t}return"1"!=this.getImportInstance().getIsImportBasedOn()&&"2"!=this.getImportInstance().getIsImportBasedOn()||e.id!=this.getImportInstance().getImportUniqueId()?(t+='<div class="zpl_tgl"><input elem="enableDisableEmployeeIDFeature" type="checkbox" >'+ZPI18N.getString("zp.employeeidwillgeneratebasedonrulecode")+"</div>",t+=this._selectDiv(e),t):(t=this._selectDiv(e),t)}_selectDiv(e,t){return`<div elem="mappingFieldDiv" isMand="${e.isMandatory}" cname="${e.cname}" fcid="${e.id}" style="margin-Top : 20px" class="MT20"><label elem="fieldName" ${e.isMandatory?'class="zpl_mtry"':""}>${e.name}<b class="zbadges DNI" elem="mappingColDiv" ></b>${t?'<i class="PI_info" zctooltip="true" data-title-position="auto" title="'+t+'"></i>':""}</label><select elem="mappingFieldSelectDiv" cname="${e.cname}"></select></div>`}_selectChildDiv(e,t){let i=e.isMandatory&&"ADDRESS2"!=t.childColName;return`<div><div elem="mappingFieldDiv" isChildField="true" isMand="${i}" cname="${t.childLabelName}"><label elem="fieldName" ${i?'class="zpl_mtry"':""}>${t.childDispName}<b class="zbadges DNI" elem="mappingColDiv" ></b></label><select elem="mappingFieldSelectDiv" cname="${t.childLabelName}"></select></div></div>`}_selectCombinedDiv(e,t,i){return`<div><div elem="mappingFieldDiv" isCombField="true" isMand="${i}" cname="${e.cname}"><label elem="fieldName" '+${i?'class="zpl_mtry"':""}>${t}<b class="zbadges DNI" elem="mappingColDiv" ></b></label><select elem="mappingFieldSelectDiv" cname="${e.cname}"></select></div></div>`}createMappings(){this.getImportInstance().removeMappings();let e=this;$.each(this.getImportInstance().getContainer().find("[elem=mappingFieldDiv] [elem=mappingFieldSelectDiv]"),(function(t,i){let r=ZPeopleComponents.select(i).getValue(),s=$(i).parents("[elem=mappingFieldDiv]").attr("cname");if(""!=r&&"-1"!=r)if("EMPLOYEEID"==s||"EMPIDGENRULECODE"==s){let t=$(i).parents("[elem=mappingFieldDiv]").parent().find("[elem=enableDisableEmployeeIDFeature]").length>0;(!t&&"EMPLOYEEID"==s||t&&ZPeopleComponents.toggleswitch($(i).parents("[elem=mappingFieldDiv]").parent().find("[elem=enableDisableEmployeeIDFeature]")).getState()&&"EMPIDGENRULECODE"==s||t&&!ZPeopleComponents.toggleswitch($(i).parents("[elem=mappingFieldDiv]").parent().find("[elem=enableDisableEmployeeIDFeature]")).getState()&&"EMPLOYEEID"==s)&&e.getImportInstance().mapColumn(s,r)}else e.getImportInstance().mapColumn(s,r)}))}changeMapping(e){let t=$(e.target),i=ZPeopleComponents.select(t).getValue();null!=i&&"-1"!=i?(t.parents("[elem=mappingFieldDiv]").find("[elem=mappingColDiv]").html("(c:"+i+")"),FrameworkCommon.show(t.parents("[elem=mappingFieldDiv]").find("[elem=mappingColDiv]")),t.parents("[elem=mappingFieldDiv]").attr("mapped",!0)):(t.parents("[elem=mappingFieldDiv]").find("[elem=mappingColDiv]").html(""),FrameworkCommon.hide(t.parents("[elem=mappingFieldDiv]").find("[elem=mappingColDiv]")),t.parents("[elem=mappingFieldDiv]").attr("mapped",!1)),ComponentsCommon.isUIEvent(e)&&(this.updateCombinedFieldAttribute(t),this.updateMappedCount())}updateCombinedFieldAttribute(e){let t=$(e).parents("[elem=combinedMappingFieldDiv]");if(t.length>0){let e=this.getImportInstance().getHandler().updateCombinedFieldMappedStatus(t);t.attr("mapped",e)}}validateConfiguredMappings(){let e=!1;if(FrameworkCommon.removeError(this.getImportInstance().getContainer().find("[elem='mappingFieldSelectDiv']")),FrameworkCommon.removeError(this.getImportInstance().getContainer().find("[elem=combinedMappingFieldDiv]")),this.getImportInstance().getHandler().isMandatoryValidation(this.getImportInstance().getIsImportBasedOn())&&($.each(this.getImportInstance().getContainer().find("[elem=mappingFieldDiv] [elem=mappingFieldSelectDiv]"),(function(t,i){let r=ZPeopleComponents.select(i).getValue();"true"!=$(i).parents("[elem=mappingFieldDiv]").attr("ismand")||""!=r&&"-1"!=r||(FrameworkCommon.showError(ZPI18N.getString("zp.fieldnotmappederror"),i),e=!0)})),$.each(this.getImportInstance().getContainer().find("[elem=combinedMappingFieldDiv]"),(function(t,i){if("true"==$(i).attr("ismand")){var r=!1;$.each($(i).find("[elem=mappingFieldSelectDiv]"),(function(e,t){let i=ZPeopleComponents.select(t).getValue();if(""!=i&&"-1"!=i&&(r=!0),r)return!1})),r||(FrameworkCommon.showError("",$(i).find("[elem=mappingFieldSelectDiv]")),FrameworkCommon.showError(ZPI18N.getString("zp.alteastonefieldmandatory",[$(i).find("[elem=combinedFieldName]").text()]),i),e=!0)}})),e)){let e=ZPeopleComponents.collapsiblepanels(this.getImportInstance().getContainer().find("[elem=collapsiblePanels]"));$.each(this.getImportInstance().getContainer().find('[elem="collapsibleSectionPanel"]'),(function(t,i){$(i).find("[elem=mappingFieldSelectDiv].ztextbox__error").length>0?e.expandPanel($(i).attr("id")):e.collapsePanel($(i).attr("id"))}))}return!e}showHideField(e,t,i){if("unmappedfields"==t||"mappedfields"==t){let r=!0,s=!1;"true"!=$(e).attr("isChildField")&&"true"!=$(e).attr("isCombField")||(e=$(e).parents("[elem=combinedMappingFieldDiv]"),s=!0),$.each($(e).find("[elem=mappingFieldSelectDiv]"),(function(e,t){let i=ZPeopleComponents.select($(t)).getValue();""==i||"-1"==i?(r=!1,$(t).parents("[elem=mappingFieldDiv]").attr("mapped",!1)):$(t).parents("[elem=mappingFieldDiv]").attr("mapped",!0)}));let a=!1;s?($(e).attr("mapped",r),a=r?!("unmappedfields"==t):0!=$(e).find("[elem=mappingFieldDiv][mapped=true]").length||"unmappedfields"==t):a=r&&!("unmappedfields"==t)||!r&&"unmappedfields"==t;let n=$(e).attr("cname");n&&("EMPLOYEEID"==n||"EMPIDGENRULECODE"==n)&&a&&(a=this.handlingForEmployeeIdGeneration(e,a,i,n)),a?FrameworkCommon.show($(e)):FrameworkCommon.hide($(e)),this.showHideRowContainer(e,t)}}handlingForEmployeeIdGeneration(e,t,i,r){return!!(!i&&"EMPLOYEEID"==r||i&&"EMPIDGENRULECODE"==r&&ZPeopleComponents.toggleswitch($(e).parent().find("[elem=enableDisableEmployeeIDFeature]")).getState()||i&&"EMPLOYEEID"==r&&!ZPeopleComponents.toggleswitch($(e).parent().find("[elem=enableDisableEmployeeIDFeature]")).getState())&&(i&&t&&$(e).parent().find("[elem=enableDisableEmployeeIDFeature]").attr("isvisible","true"),!0)}showHideRowContainer(e,t,i){let r=$(e).parents("[elem=rowContainer]");null!=i?$(r).attr("show","true"==$(r).attr("show")||i):this.showHideContainer($(r),t),"true"==$(r).attr("show")?FrameworkCommon.show($(r)):FrameworkCommon.hide($(r))}showHideContainer(e,t){if("unmappedfields"==t||"mappedfields"==t){let i=!1,r=$(e).find("[elem=addressMappingFieldDiv]").length>0;$(e).find("[elem=mappingFieldDiv]").not("[isChildField=true], [isCombField=true]").length>0&&$(e).find("[elem=mappingFieldDiv][mapped="+("mappedfields"==t)+"]").not("[isChildField=true], [isCombField=true]").length>0&&(i=!0),r&&($(e).find("[elem=addressMappingFieldDiv][mapped="+("mappedfields"==t)+"]").length>0&&(i=!0),$(e).find("[elem=addressMappingFieldDiv] [elem=mappingFieldDiv][mapped="+("mappedfields"==t)+"]").length>0&&(i=!0)),$(e).attr("show",i)}}showHideNoData(){let e=this.getImportInstance().getContainer().find("[elem=mapToggleDiv].zpl_act").attr("elemVal");this.getImportInstance().getContainer().find("#zp_page_loading").remove(),FrameworkCommon.hide(this.getImportInstance().getContainer().find('[elem="collapsibleSectionPanel"][show=false]')),0==this.getImportInstance().getContainer().find('[elem="collapsibleSectionPanel"][show=true]').length?("unmappedfields"==e?new EmptyPages("zp_nd_implcmplt",ZPI18N.getString("zp.allFieldsMapped"),"",this.getImportInstance().getContainer().find('[elem="collapsibleNoData"]')).show():new EmptyPages("zp_nd_disbldsgn",ZPI18N.getString("zp.nomappingsfound"),"",this.getImportInstance().getContainer().find('[elem="collapsibleNoData"]')).show(),FrameworkCommon.show(this.getImportInstance().getContainer().find('[elem="collapsibleNoData"]'))):(FrameworkCommon.hide(this.getImportInstance().getContainer().find('[elem="collapsibleNoData"]')),this.getImportInstance().getContainer().find('[elem="collapsibleNoData"]').html("")),FrameworkCommon.show(this.getImportInstance().getContainer().find('[elem="collapsibleSectionPanel"][show=true]'))}toggleMapUnmapDiv(e){let t="mapToggleDiv"==$(e.target).attr("elem")?e.target:$(e.target).closest("[elem=mapToggleDiv]");if(FrameworkCommon.hide(this.getImportInstance().getContainer().find('[elem="collapsibleSectionPanel"]')),FrameworkCommon.hide(this.getImportInstance().getContainer().find('[elem="collapsibleNoData"]')),$(ZPeople.LOADING_HTML).insertAfter(this.getImportInstance().getContainer().find("[elem=collapsiblePanels]")),!$(t).hasClass("zpl_act")){$(t).siblings().removeClass("zpl_act"),$(t).addClass("zpl_act");let e=$(t).attr("elemVal"),i=this.getImportInstance().getContainer().find("[elem=enableDisableEmployeeIDFeature]").length>0;if("allfields"==e){if(this.getImportInstance().getContainer().find('[elem="collapsibleSectionPanel"]').attr("show",!0),FrameworkCommon.show(this.getImportInstance().getContainer().find('[elem="collapsibleSectionPanel"]')),FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=rowContainer]")),FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=combinedMappingFieldDiv]")),FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=mappingFieldDiv]")),FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=addressMappingFieldDiv]")),"P_Employee"==this.getImportInstance().getHandler().getTableName())if(i){let e=this.getImportInstance().getContainer().find("[elem=enableDisableEmployeeIDFeature]");FrameworkCommon.show($(e.parent()));let t=ZPeopleComponents.toggleswitch($(e)).getState();this.showHideEmployeeIdDiv(t)}else FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=mappingFieldSelectDiv][cname=EMPIDGENRULECODE]").parent())}else{let t=this;if("P_Employee"==this.getImportInstance().getHandler().getTableName()&&i&&($(this.getImportInstance().getContainer().find("[elem=enableDisableEmployeeIDFeature]")).attr("isvisible","false"),FrameworkCommon.show($(this.getImportInstance().getContainer().find("[elem=enableDisableEmployeeIDFeature]").parent()))),$.each(this.getImportInstance().getContainer().find('[elem="collapsibleSectionPanel"]'),(function(r,s){$.each($(s).find("[elem=mappingFieldDiv]").not("[isChildField=true],[isCombField=true]"),(function(r,s){t.showHideField(s,e,i)})),t.showHideContainer(s,e)})),this._onShowAddressFields(e),this._onShowCombinedFields(e),"P_Employee"==this.getImportInstance().getHandler().getTableName()&&i&&"false"==this.getImportInstance().getContainer().find("[elem=enableDisableEmployeeIDFeature]").attr("isvisible")){let e=this.getImportInstance().getContainer().find("[elem=enableDisableEmployeeIDFeature]");e&&FrameworkCommon.hide($(e.parent()))}}}this.showHideNoData()}updateMappedCount(){let e={mappedCount:0,unmappedCount:0};this.getImportInstance().getHandler().fieldsMappingCountCallback(e),this.getImportInstance().getHandler().addressFieldsMappingCountCallback(e),this.getImportInstance().getHandler().combinedFieldsMappingCountCallback(e),this.getImportInstance().getContainer().find("[elem=mapToggleDiv] [elem=mappedCount]").html(this._getCountString(e.mappedCount)),this.getImportInstance().getContainer().find("[elem=mapToggleDiv] [elem=unmappedCount]").html(this._getCountString(e.unmappedCount))}_getCountString(e){return 0==e||e>=10?e:"0"+e}showHideOnResetAndMapping(e){if("allfields"!=e){let t=this;$.each(this.getImportInstance().getContainer().find('[elem="collapsibleSectionPanel"]'),(function(i,r){t.showHideContainer(r,e)})),this._onShowAddressFields(e),this._onShowCombinedFields(e),this.showHideNoData()}}resetMappings(){FrameworkCommon.showInfoAlert(ZPI18N.getString("zp.resetfields")+"?",ZPI18N.getString("zp.resetfieldsconfirmation"),{callback:(()=>{let e=this.getImportInstance().getContainer().find("[elem=mapToggleDiv].zpl_act").attr("elemVal"),t=this;$.each(this.getImportInstance().getContainer().find("[elem=mappingFieldDiv]").not("[isdisabled=true]").find("[elem=mappingFieldSelectDiv]"),(function(i,r){ZPeopleComponents.select(r).setValue("-1"),t.showHideField($(r).parents("[elem=mappingFieldDiv]"),e)})),this.getImportInstance().getHandler().resetMappingsCallback(),this.updateMappedCount(),this.showHideOnResetAndMapping(e)}).bind(this),isCancelNeeded:!0,doneBtn:ZPI18N.getString("zp.confirm")})}applyAutoMappings(e){FrameworkCommon.showInfoAlert(ZPI18N.getString("zp.automapfields")+"?",ZPI18N.getString("zp.automapfieldsconfirmation"),{callback:(()=>{let e=this.getImportInstance().getContainer().find("[elem=mapToggleDiv].zpl_act").attr("elemVal"),t=this;$.each(this.getImportInstance().getContainer().find("[elem=mappingFieldDiv]").not("[isdisabled=true]"),(function(i,r){ZPeopleComponents.select($(r).find("[elem=mappingFieldSelectDiv]")).setValue("-1");let s=$(r).find("label[elem=fieldName]").text();$.each(t.getImportInstance().getTableHeaders(),(function(i,a){if(ZPeople.decodeTxt(a).match(new RegExp(t.escapeRegExp(s),"iu"))||s.match(new RegExp(t.escapeRegExp(ZPeople.decodeTxt(a)),"iu")))return ZPeopleComponents.select($(r).find("[elem=mappingFieldSelectDiv]")).setValue(i+""),t.showHideField($(r),e),!1}))})),this.getImportInstance().getHandler().applyAutoMappingsCallback(),this.updateMappedCount(),this.showHideOnResetAndMapping(e)}).bind(this),isCancelNeeded:!0,doneBtn:ZPI18N.getString("zp.confirm")})}escapeRegExp(e){return e.replace(/\s+/g," ").replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}applyPrevMappings(){let e=this.getImportInstance().getPrevMappings(),t=this.getImportInstance().getTableHeaders();$.each(this.getImportInstance().getContainer().find("[elem=mappingFieldDiv]").not("[isdisabled=true], [isChildField=true], [isCombField=true]"),(function(i,r){let s=$(r).find("[elem=mappingFieldSelectDiv]"),a=$(s).attr("cname"),n="-1";null!=e[a]&&e[a].hasOwnProperty("srcLabel")&&e[a].hasOwnProperty("srcCol")&&e[a].srcCol<t.length&&$.each(t,(function(t,i){if(ZPeople.decodeTxt(i).toLowerCase()==e[a].srcLabel.toLowerCase())return n=t,!1})),ZPeopleComponents.select($(s)).setValue(n)})),$.each(this.getImportInstance().getContainer().find("[elem=addressMappingFieldDiv]"),(function(i,r){let s=$(r).attr("cname");$.each($(r).find("[elem=mappingFieldDiv]"),(function(i,r){if(null!=e[s]&&e[s].hasOwnProperty("srcCol")){let a=e[s].srcCol;a="-"==a[0]?a.substring(1,a.length).split("-"):a.split("-");let n="-1";!common._empty(a[i])&&a[i]<t.length&&(n=a[i]),ZPeopleComponents.select($(r).find("[elem=mappingFieldSelectDiv]")).setValue(n)}}))})),$.each(this.getImportInstance().getContainer().find("[elem=combinedMappingFieldDiv]"),(function(i,r){$.each($(r).find("[elem=mappingFieldDiv]"),(function(i,r){let s=$(r).attr("cname");if(null!=e[s]&&e[s].hasOwnProperty("srcCol")){let i=e[s].srcCol,a="-1";!common._empty(i)&&i<t.length&&(a=i),ZPeopleComponents.select($(r).find("[elem=mappingFieldSelectDiv]")).setValue(a)}}))})),this.getImportInstance().getHandler().applyPrevMappingsCallback(),this.updateMappedCount()}forwardToVerification(){if(this.validateConfiguredMappings()){if(this.createMappings(),0!=this.getImportInstance().getMappings().length&&0!=Object.keys(this.getImportInstance().getMappings()).length)return this._validateDepLookupSections()?(this.getImportInstance().setCurrentStep(3),this.getImportInstance().getSliderModal().nextTab(!1),FrameworkCommon.addLoading(this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getVerifyMappingsCardId())),this.setStartIndex(1),this.constructTable(),!0):(this.getImportInstance().getContainer().find("[elem=collapsiblePanels]").find("[elem=errorMsg]")[0].scrollIntoView({behavior:"smooth",block:"center"}),!1);ZPeople.Message.failure(ZPI18N.getString("zp.nomappingconfigured"))}else this.getImportInstance().getContainer().find("[elem=mapToggleDiv][elemVal=unmappedfields]").click(),this.getImportInstance().getContainer().find("[elem=collapsiblePanels]").find("[elem=errorMsg]")[0].scrollIntoView({behavior:"smooth",block:"center"});return!1}_validateDepLookupSections(){let e=this,t=[],i=!0;return $.each(this.getImportInstance().getFormDetails().sections,(function(r,s){null!=s.col1Fields&&(i=i&&e._validateDepLookupFields(s.col1Fields,t)),null!=s.col2Fields&&(i=i&&e._validateDepLookupFields(s.col2Fields,t))})),i}_validateDepLookupFields(e,t){let i=!0,r=this;return $.each(e,(function(e,s){let a=s.id,n=s.cname;if(r._isMappingPresent(n)){if(null!=s.dependentFiledList){let e=s.dependentFiledList;e.length>0&&(t=e)}if(r._getDepFieldMapping(a,t),"P_Employee"==r.getImportInstance().getHandler().getTableName()&&("ENTITYID"==n||"UNITID"==n||"DIVISIONID"==n||"DEPARTMENTNAME"==n&&null!=ZPeople.orgStructureTagMap.department&&ZPeople.orgStructureTagMap.department)&&r._getOrgStructureFields(t),t.length>0){!r._checkAllFieldsSelected(t)&&i&&(i=!1)}}})),i}_getDepFieldMapping(e,t){let i=this.getImportInstance().getFormDetails().dependentFieldMapping[e];if(null==i)return t;{let e=this;$.each(i,(function(r){ZPUtil.checkIsExistInArray(t,i[r])||(t.push(i[r]),e._getDepFieldMapping(i[r],t))}))}}_getOrgStructureFields(e){let t=["entity","unit","division","department"],i=["ENTITYID","UNITID","DIVISIONID","DEPARTMENTNAME"];for(let r=0;r<t.length;r++){let s=t[r];if(null!=ZPeople.orgStructureTagMap[s]&&ZPeople.orgStructureTagMap[s]){let t=this._getFieldsFromFcid(i[r]);t&&!ZPUtil.checkIsExistInArray(e,t.id)&&e.push(t.id)}}}_checkAllFieldsSelected(e){let t=!0,i=(e,t,i,r)=>{null!=t&&$.each(t,(function(t,s){if(s.id==r)return i.cName=s.cname,i.sectionId=e.id,!1}))},r=this;return $.each(e,(function(e,s){let a={cName:"",sectionId:""};if($.each(r.getImportInstance().getFormDetails().sections,(function(e,t){i(t,t.col1Fields,a,s),""==a.cName&&i(t,t.col2Fields,a,s)})),""!=a.cName&&!r._isMappingPresent(a.cName)){t=!1;let e=r.getImportInstance().getContainer().find(`div[fcid=${s}]`).find("[elem=mappingFieldSelectDiv]");FrameworkCommon.showError(ZPI18N.getString("zp.fielddependentnotmapped"),e)}})),t}_getFieldsFromFcid(e){let t=t=>{if(null!=t)for(let i=0;i<t.length;i++){let r=t[i];if(r.cname==e)return r}},i=this.getImportInstance().getFormDetails().sections;for(let e=0;e<i.length;e++){let r=i[e],s=t(r.col1Fields);if(s=s||t(r.col2Fields),s)return s}}_validateAddressFields(){let e=this.getImportInstance().getFormDetails();for(let t=0;t<e.sections.length;t++){let i=e.sections[t];this._checkAddressFieldPresence(i.col1Fields),this._checkAddressFieldPresence(i.col2Fields)}}_checkAddressFieldPresence(e){if(null!=e)for(let t=0;t<e.length;t++){let i=e[t];if(i.c_type==FormConstants.FieldType.ADDRESS){let e=i.childElements;if(null!=e)for(let t=0;t<e.length;t++){let r=e[t];if(this._isMappingPresent(r.childLabelName)){this._evaluateAddressFields(i);break}}}}}_evaluateAddressFields(e){let t="",i=e.lname;for(let r=0;r<FormConstants.AddressField.COLUMNAMEARRAY.length;r++){let s=FormConstants.AddressField.COLUMNAMEARRAY[r]+"_"+i;if(this.getImportInstance().getMappings().hasOwnProperty(s)){t=e.id;break}}this.getImportInstance().mapColumn(e.cname,t)}_onShowCombinedFields(e){let t=this;$.each(this.getImportInstance().getContainer().find('[elem="collapsibleSectionPanel"]'),(function(i,r){let s=!1;$.each($(r).find('[elem="combinedMappingFieldDiv"]'),(function(i,r){let a=t.getImportInstance().getHandler().updateCombinedFieldMappedStatus(r);$(r).attr("mapped",a),FrameworkCommon.hide($(r));let n=!1;if(a)n="mappedfields"==e;else{let i=$(r).find("[elem=mappingFieldDiv][mapped=true]").length;n=t.getImportInstance().getHandler().includePartialMapHandling()&&i>0||"unmappedfields"==e}n&&FrameworkCommon.show($(r)),t.showHideRowContainer(r,e,n),s=s||n})),$(r).attr("show","true"==$(r).attr("show")||s)}))}_onShowAddressFields(e){let t=this;$.each(this.getImportInstance().getContainer().find('[elem="collapsibleSectionPanel"]'),(function(i,r){$.each($(r).find('[elem="addressMappingFieldDiv"]'),(function(t,i){let r=0,s=0;$.each($(i).find("[elem=mappingFieldDiv]"),(function(e,t){let i=ZPeopleComponents.select($(t).find("[elem=mappingFieldSelectDiv]")).getValue();""==i||"-1"==i?r++:s++})),0==r?$(i).attr("mapped",!0):$(i).attr("mapped",!1),FrameworkCommon.show($(i)),("unmappedfields"==e&&0==r||"mappedfields"==e&&0==s)&&FrameworkCommon.hide($(i))})),t.showHideContainer(r,e)}))}getPaginationDiv(){return'<div class="zpl_tblpagination DNI" elem="fileDataPaginationFooter" style="position:static;margin-bottom:2px;"><div elem="totalCountDiv" class="zpl_lftpgn DNI"><label>'+ZPI18N.getString("zp.totalrecordcount")+' : </label><a elem="totalDataCount" class="CPD"></a></div><div class="zpl_rhtpgn"><div class="pagecount"><a class="zpl_prev" elem="fileDataPrevPaginationButton"></a><span elem="fileDataPaginationCount"><b></b></span><a class="zpl_nxt" elem="fileDataNextPaginationButton"></a></div></div></div>'}_constructTableBasedOnStartIndex(){let e=this.getImportInstance().getFileData();this.getImportInstance().getHandler().isFileDataPaginationNeeded()&&(e=this.getFileData());let t='<div class="zpl_rgtcnt"><div class="zpl_tblres zpl_colmaxwd"><table class="zpl_tbl zpl_nocrsor">',i=ImportV5Mappings.constructData(this.getImportInstance().getFormDetails().sections,e,this.getImportInstance().getMappings());t+='<thead elem="tableHeader">'+i[0]+"</thead>",t+='<tbody elem="tableBody">'+i[1]+"</tbody>",t+='</table></div><div elem="emptyDataDiv" class="DNI"></div></div>',FrameworkCommon.removeLoading(this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getVerifyMappingsCardId())),this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getVerifyMappingsCardId()).html(t),this.getImportInstance().getHandler().isFileDataPaginationNeeded()&&(0==this.getImportInstance().getContainer().find("[elem=fileDataPaginationFooter]").length&&$(this.getPaginationDiv()).insertBefore(this.getImportInstance().getSliderModal().modalFooter),this.handlePagination()),0==i[0].length&&(FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=fileDataPaginationFooter]")),new EmptyPages("zp_nd_nodata1",ZPI18N.getString("zp.nomappingsfound"),"",this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getVerifyMappingsCardId()).find("[elem=emptyDataDiv]")).show(),FrameworkCommon.show(this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getVerifyMappingsCardId()).find("[elem=emptyDataDiv]"))),this._handleFooter(!0)}paginationAction(e){this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getVerifyMappingsCardId()).html(""),FrameworkCommon.addLoading(this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getVerifyMappingsCardId())),e?this.setStartIndex(this.getStartIndex()+200):this.setStartIndex(this.getStartIndex()-200),this.constructTable()}handlePagination(){let e=this.getImportInstance().getContainer().find("[elem=fileDataPaginationFooter]");e.find('[elem="fileDataPrevPaginationButton"]').addClass("disabled gry").removeClass("blu CP").off(),e.find('[elem="fileDataNextPaginationButton"]').addClass("disabled gry").removeClass("blu CP").off(),1!=this.getStartIndex()&&e.find('[elem="fileDataPrevPaginationButton"]').removeClass("disabled gry").addClass("blu CP").on("click",this.paginationAction.bind(this,!1));let t=this.getTotalCount()>=this.getStartIndex()+199?this.getStartIndex()+199:this.getTotalCount();e.find("[elem=fileDataPaginationCount] b").html(this.getStartIndex()+"-"+t),this.getTotalCount()>this.getStartIndex()+199&&e.find('[elem="fileDataNextPaginationButton"]').removeClass("disabled gry").addClass("blu CP").on("click",this.paginationAction.bind(this,!0)),this.getTotalCount()&&(e.find("[elem=totalDataCount]").html(this.getTotalCount()),FrameworkCommon.show(e.find("[elem=totalCountDiv]"))),FrameworkCommon.show(e)}_handleFooter(e){e?(this.getImportInstance().getContainer().find("[elem=fileDataPaginationFooter]").find("[elem=fileDataPrevPaginationButton], [elem=fileDataNextPaginationButton]").removeClass("disabled"),this.getImportInstance().getSliderModal().modalFooter.find("#previousButton, #nextButton").removeClass("disabled")):(this.getImportInstance().getContainer().find("[elem=fileDataPaginationFooter]").find("[elem=fileDataPrevPaginationButton], [elem=fileDataNextPaginationButton]").addClass("disabled"),this.getImportInstance().getSliderModal().modalFooter.find("#previousButton, #nextButton").addClass("disabled"))}constructTable(){if(this.getImportInstance().setIsAlertAutomation(!0),this._handleFooter(!1),this.getImportInstance().getHandler().isFileDataPaginationNeeded()){let e=(e,t,i)=>{e&&e.isSuccess&&e.hasOwnProperty("fileData")&&(this.setTotalCount(e.dataCount),this.setFileData(e.fileData),this._constructTableBasedOnStartIndex())};if(this.hasFileData())setTimeout(this._constructTableBasedOnStartIndex.bind(this),500);else{let t={formId:this.getImportInstance().getBaseFormId(),impformId:this.getImportInstance().getImportFormId(),importId:this.getImportInstance().getImportId(),stIndex:this.getStartIndex(),mode:"fileData"};this.getImportInstance().getHandler().setMappingsFileDataExtraParams(t),ZPeople.Request.send("/Import.zp",t,e.bind(this),{},this.getImportInstance().failCallback.bind(this.getImportInstance()))}}else this._constructTableBasedOnStartIndex()}static constructData(e,t,i){let r=!1,s="",a='<th class="zpl_txtcenter" rowspan="2" style="width:100px">'+ZPI18N.getString("zp.rowno")+"</th>",n="";return $.each(t.data,(function(o){let l=$.inArray("ROWNUMBER",t.headers),d=l>-1?t.data[o][l]:"";s+='<tr><td style="width:100px">'+ZPI18N.getString("zp.row")+" "+d+"</td>",$.each(e,(function(e,l){let d=0,p=!1,m="",c=e=>{if(e.hasOwnProperty("combinedFields")||e.hasOwnProperty("childElements"))((e,s)=>{if(null!=e&&0!=e.length)for(let a=0;a<e.length;a++){let l=e[a].hasOwnProperty("cname")?e[a].cname:e[a].childLabelName,c=e[a].hasOwnProperty("childDispName")?e[a].childDispName:e[a].name;if(ImportV5Mappings.isMappingPresent(i,l)){r||(p=!0,n+="<th>"+c+" ("+s+")</th>");let e=ImportV5Mappings.getFieldData(i,t,l,o);m+='<td onmouseover="FrameworkCommon.mouseEnterFunction()"><span>'+e+"</span></td>",d++}}})(e.hasOwnProperty("combinedFields")?e.combinedFields:e.childElements,e.name);else if(ImportV5Mappings.isMappingPresent(i,e.cname)){r||(p=!0,n+="<th>"+e.name+"</th>");let s=ImportV5Mappings.getFieldData(i,t,e.cname,o);m+='<td onmouseover="FrameworkCommon.mouseEnterFunction()"><span>'+s+"</span></td>",d++}};l.col1Fields.forEach(c),l.col2Fields.forEach(c),!r&&p&&(a+='<th class="zpl_txtcenter zpl_tblbrbtm" colspan="'+d+'">'+l.name+"</th>"),""!=m.trim()&&(s+=m)})),s+="</tr>",r=!0})),["<tr>"+a+"</tr><tr>"+n+"</tr>",s]}static isMappingPresent(e,t){return e.hasOwnProperty(t)}static getFieldData(e,t,i,r){let s="";if(ImportV5Mappings.isMappingPresent(e,i)){let a=$.inArray("Hrms_"+e[i],t.headers);s=a>-1?t.data[r][a]:""}return s}validate(){ImportV5.validateLocation(this.getImportInstance().getBaseFormId(),this.submitMappings.bind(this))}submitMappings(e,t){if(e.isLocationTrackingEnabled&&!t.isPermEnabled)return FrameworkCommon.showInfoAlert("",ZPI18N.getString("zp.requestuserlocation")+" "+ZPI18N.getString("zp.blockedlocation")),void this.getImportInstance().getSliderModal().close();this.getImportInstance().getHandler().mappingsValidationCallback()&&(this.getImportInstance().showAlertBeforeImportData()?this.getImportInstance().alertBeforeImportData():(this._validateAddressFields(),this.getImportInstance().getHandler().submitMappingsCallback(e,t)))}_isMappingPresent(e){return ImportV5Mappings.isMappingPresent(this.getImportInstance().getMappings(),e)}getMapping(e){return this.getImportInstance().getMappings()[e]}}class ImportV5Summary{constructor(){this.tab=new Tab(ZPI18N.getString("zp.ImportSummary")),this.tab.id=ImportV5Summary.getTabId(),this.tab.cardId=ImportV5Summary.getCardId(),this.setInitialValues(),this.setInstances()}static getTabId(){return"tabImportSummary"}static getCardId(){return"cardImportSummary"}static getURL(){return"/dataadministration/importSummary"}setInitialValues(){this.isOnlySummary=!1,this.isTabularImport=!1,this.isBulkFileUpload=!1}setInstances(){this.addInstance=new ImportV5SummaryData(ZP5Import.SUMMARY_DATA_TYPE.ADDED),this.addInstance.setSummaryInstance(this),this.updateInstance=new ImportV5SummaryData(ZP5Import.SUMMARY_DATA_TYPE.UPDATED),this.updateInstance.setSummaryInstance(this),this.skipInstance=new ImportV5SummaryData(ZP5Import.SUMMARY_DATA_TYPE.SKIPPED),this.skipInstance.setSummaryInstance(this),this.errorInstance=new ImportV5SummaryData(ZP5Import.SUMMARY_DATA_TYPE.ERROR),this.errorInstance.setSummaryInstance(this)}getDataInstance(e){switch(e){case ZP5Import.SUMMARY_DATA_TYPE.ADDED:return this.addInstance;case ZP5Import.SUMMARY_DATA_TYPE.UPDATED:return this.updateInstance;case ZP5Import.SUMMARY_DATA_TYPE.SKIPPED:return this.skipInstance;case ZP5Import.SUMMARY_DATA_TYPE.ERROR:return this.errorInstance}return this.errorInstance}getTab(){return this.tab}setImportInstance(e){this.IMPORTV5=e}getImportInstance(){return this.IMPORTV5}setIsOnlySummary(e){this.isOnlySummary=e}getIsOnlySummary(){return this.isOnlySummary}setIsBulkFileUpload(e){this.isBulkFileUpload=e}getIsBulkFileUpload(){return this.isBulkFileUpload}setIsTabularImport(e){this.isTabularImport=e}getIsTabularImport(){return this.isTabularImport}setContainer(e){this.container=e}getContainer(){return this.container}setSliderModal(e){this.SliderModal=e}getSliderModal(){return this.SliderModal}setImportId(e){this.importId=e}getImportId(){return this.importId}setFormId(e){this.formId=e}getFormId(){return this.formId}setSummaryViewId(e){this.currViewId=e}getSummaryViewId(){return this.currViewId}setImpSummaryMode(e){this.summaryMode=e}getImpSummaryMode(){return this.summaryMode}getImportFormId(){return this.getImportInstance().getImportFormId()}setSections(e){this.sections=e}setMappings(e){this.mappings=e}getSections(){return this.getIsOnlySummary()?this.sections:this.getImportInstance().getFormDetails().sections}getMappings(){return this.getIsOnlySummary()?this.mappings:this.getImportInstance().getMappings()}init(e,t,i){if(this.setIsOnlySummary(!1),this.setIsTabularImport(this.getImportInstance().getIsTabularImport()),this.setContainer(this.getImportInstance().getContainer()),this.getContainer().find("#"+ImportV5Summary.getTabId()).addClass("zpl_tblfxd"),this.setSliderModal(this.getImportInstance().getSliderModal()),e.isSuccess){if(e.duplicateCheckMap.isSuccess&&!e.duplicateCheckMap.isDbDuplicate&&!e.duplicateCheckMap.isFileDuplicate){let r=e.duplicateCheckMap.importmap;this.setImportId(r.importId),this.setSummaryViewId(r.summaryViewId),this.setFormId(this.getImportInstance().getHandler().getFormId()),this.construct(r,t,i)}}else ZPeople.Message.failure(ZPI18N.getString("zp.sorryservererror")),this.getSliderModal().close()}initOnlySummary(e,t){this.setIsOnlySummary(!0),this.setIsTabularImport(!1),this.setImportId(e),this.setFormId(t),this.createSlider()}createSlider(){let e=this.getTab();e.setCallback(function(e){this.setContainer(e.mainWrapId.find(`#${e._fullPageModalId}`)),this.getContainer().find("#"+ImportV5Summary.getTabId()).addClass("zpl_tblfxd"),this.getSliderModal().modalFooter.html(`<button id="sliderCancel" type="button" class="zlabel zlabel--outline zlabel--medium">${ZPI18N.getString("zp.close")}</button>`),this.getSliderModal().modalFooter.find("#sliderCancel").off().on("click",(()=>{e.close()})),this.getContainer().find("#"+ImportV5Summary.getCardId()).html(this.getPage()),FrameworkCommon.addLoading(this.getContainer().find("#"+ImportV5Summary.getCardId())),FrameworkCommon.hide(this.getContainer().find("#tabLeftUl").parents(".zpl_mmnulft")),this.getContainer().removeClass("zpl_mdltopnav"),this.getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.SKIPPED).setHasMore(!0),this.getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.SKIPPED).setStartIndex(1),this.getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.ERROR).setHasMore(!0),this.getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.ERROR).setStartIndex(1),ZPeople.Request.sendRequestWithVersion(ImportV5Summary.getURL(),{importId:this.getImportId(),stIndex:"1"},"GET",this.construct.bind(this))}.bind(this)),this.setSliderModal(new fullPageModal(ZPI18N.getString("zp.ImportSummary"),e)),this.getSliderModal()._fullPageModalId="importSummaryModal",this.getSliderModal().topNavigation=!1,this.getSliderModal()._saveToggle=!1,this.getSliderModal()._previousToggle=!1,this.getSliderModal().construct(0),this.getSliderModal().open(),this.getSliderModal().setCloseCallback((e=>{e.remove(),this.getIsOnlySummary()||this.getImportInstance().getHandler().closeCallback(),ZP5Import.destroy()}))}construct(e,t,i){if(e.hasOwnProperty("isSuccess")&&e.isSuccess){let r=this.getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.ERROR);this.showRecCountContainer(e),this.setSummaryViewId(e.summaryViewId),this.setImpSummaryMode(e.mode),this.getIsOnlySummary()?e.errorsLen>0&&r.callback(e,t,i):(this.setImpSummaryMode(this.getImportInstance().getHandler().mode),r.setIsInit(!1),r.setHasMore(!1),r.setIsEmpty(0==e.errorsLen),r.setStartIndex(1),r.setRecCount(e.errorsLen),this.constructErrorContainer(e),this.getImportInstance().getHandler().afterSubmitCallback(e,t,i)),FrameworkCommon.removeLoading(this.getContainer().find("#"+ImportV5Summary.getCardId())),this.showRecContainer()}else e.hasOwnProperty("otherErrors")?ZPeople.Message.warning(e.otherErrors):e.hasOwnProperty("isImpSummaryAvailable")&&!e.isImpSummaryAvailable?ZPeople.Message.warning(ZPI18N.getString("zp.importsummarynotavailable")):ZPeople.Message.failure(ZPI18N.getString("zp.sorryservererror")),this.getSliderModal().close()}constructErrorContainer(e){if(e.errorsLen>0){let t='<div class="zpl_rgtcnt"><div class="zpl_tblres"><table class="zpl_tbl zpl_nocrsor" elem="importTable'+ZP5Import.SUMMARY_DATA_TYPE.ERROR+'Rec" actType="'+ZP5Import.SUMMARY_DATA_TYPE.ERROR+'">';t+='<thead elem="tableHeader"><tr><th style="width:10%">'+ZPI18N.getString("zp.rowno")+"</th><th>"+ZPI18N.getString("zp.errorDetails")+"</th></tr></thead>",t+='<tbody elem="tableBody" pageDiv="1">';let i=1;$.each(e.errors,(function(e,r){t+='<tr><td style="width:10%">'+ZPI18N.getString("zp.row")+" "+ZPeople.decodeTxt(e)+"</td><td>"+r.replace(/\n/g,"<br>")+"</td><tr>",i++,i%200==1&&(t+='</tbody><tbody class="DNI" elem="tableBody" pageDiv="'+i+'">')})),t+="</tbody></table></div></div>",this.getContainer().find("[elem=summaryRecContDiv]").find("[elem=importSummary"+ZP5Import.SUMMARY_DATA_TYPE.ERROR+"Cont]").html(t),$(this.getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.ERROR).getPaginationDiv()).insertBefore(this.getSliderModal().modalFooter),this.getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.ERROR).handlePagination()}else{let e=this.getContainer().find("[elem=summaryRecContDiv] [elem=emptyDivContainer] [actType="+ZP5Import.SUMMARY_DATA_TYPE.ERROR+"]");new EmptyPages("zp_nd_nodata1",ZPI18N.getString("zp.nodatafound"),"",e).show()}}getPage(){let e='<div class="zpl_imprtrecordvw DNI" elem="summaryViewRecContDiv">';return e+='<div class="zpl_secn DNI" elem="viewRecordContainer"> <div><em elem="importSuccessMessage"></em></div> </div>',e+='<div class="zpl_secn DNI" elem="errorMsgContainer" ><div><em elem="importErrorMsgLink"></em>',e+="</div></div></div>",e+='<div class="zpl_btnmnu PR DNI"  elem="summaryRecCountContDiv"><div><ul class="zpl_grpmnu" elem="recordCountListDiv">',e+='<li elem="addedRecCont" '+(this.getIsTabularImport()?'class="DNI"':"")+' actType="'+ZP5Import.SUMMARY_DATA_TYPE.ADDED+'">'+ZPI18N.getString("zp.addedrecords")+'<b elem="addedRecordsCount" actType="'+ZP5Import.SUMMARY_DATA_TYPE.ADDED+'"></b></li>',e+='<li elem="updatedRecCont" actType="'+ZP5Import.SUMMARY_DATA_TYPE.UPDATED+'">'+ZPI18N.getString("zp.updatedrecords")+'<b elem="updatedRecordsCount" actType="'+ZP5Import.SUMMARY_DATA_TYPE.UPDATED+'"></b></li>',e+='<li elem="skippedRecCont" actType="'+ZP5Import.SUMMARY_DATA_TYPE.SKIPPED+'">'+ZPI18N.getString("zp.skippedrecords")+'<b elem="skippedRecordsCount" actType="'+ZP5Import.SUMMARY_DATA_TYPE.SKIPPED+'"></b></li>',e+='<li elem="errorCountCont" actType="'+ZP5Import.SUMMARY_DATA_TYPE.ERROR+'">'+ZPI18N.getString("zp.recorderrors")+'<b elem="errorInRecordsCount" actType="'+ZP5Import.SUMMARY_DATA_TYPE.ERROR+'"></b></li>',e+="</ul></div></div>",e+='<div class="zpl_rgtcnt DNI" elem="summaryRecContDiv" id="importSummaryRecordsDiv" ><div class="zpl_tblres" elem="tableContainer">',e+='<div actType="'+ZP5Import.SUMMARY_DATA_TYPE.ADDED+'"  elem="importSummary'+ZP5Import.SUMMARY_DATA_TYPE.ADDED+'Cont"></div>',e+='<div actType="'+ZP5Import.SUMMARY_DATA_TYPE.UPDATED+'" elem="importSummary'+ZP5Import.SUMMARY_DATA_TYPE.UPDATED+'Cont"></div>',e+='<div actType="'+ZP5Import.SUMMARY_DATA_TYPE.SKIPPED+'" elem="importSummary'+ZP5Import.SUMMARY_DATA_TYPE.SKIPPED+'Cont"></div>',e+='<div actType="'+ZP5Import.SUMMARY_DATA_TYPE.ERROR+'" elem="importSummary'+ZP5Import.SUMMARY_DATA_TYPE.ERROR+'Cont"></div>',e+="</div>",e+='<div elem="emptyDivContainer">',e+='<div actType="'+ZP5Import.SUMMARY_DATA_TYPE.ADDED+'"></div>',e+='<div actType="'+ZP5Import.SUMMARY_DATA_TYPE.UPDATED+'"></div>',e+='<div actType="'+ZP5Import.SUMMARY_DATA_TYPE.SKIPPED+'"></div>',e+='<div actType="'+ZP5Import.SUMMARY_DATA_TYPE.ERROR+'"></div></div>',e+="</div>",e}viewRecordsCallback(){this.getSliderModal().close()}showViewRecContainer(e,t,i){let r=this.getContainer().find("[elem=summaryViewRecContDiv]");e?(FrameworkCommon.show(r.find("[elem=viewRecordContainer]")),r.find("[elem=importSuccessMessage]").html(ZPI18N.getString("zp.importedsuccessfully")),this.getIsOnlySummary()||(r.find("[elem=importSuccessMessage]").html(ZPI18N.getString("zp.importedsuccesswithrecordlink")),r.find('[elem="importSuccessMessage"] a').addClass("zpl_cursr").off("click").on("click",this.viewRecordsCallback.bind(this)))):FrameworkCommon.hide(r.find("[elem=viewRecordContainer]")),t&&(FrameworkCommon.show(r.find("[elem=errorMsgContainer]")),r.find("[elem=importErrorMsgLink]").html(ZPI18N.getString("zp.importerrormessage",[i]))),(e||t)&&FrameworkCommon.show(r)}showRecContainer(){this.hideAllPagination();let e=this.getContainer(),t=e.find("[elem=recordCountListDiv] li.zpl_act"),i=this.getDataInstance(t.attr("actType")),r=this.getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.ERROR);FrameworkCommon.hide(e.find("[elem=summaryRecContDiv] [elem=tableContainer]").children()),FrameworkCommon.hide(e.find("[elem=summaryRecContDiv] [elem=emptyDivContainer]").children()),FrameworkCommon.addLoading(e.find("#"+ImportV5Summary.getCardId()).find("[elem=summaryRecContDiv]")),e.find("[elem=summaryRecContDiv] [elem=tableContainer] div[actType="+i.getMode()+"]").children().length>0?(i.showContainer(!1),i.showPagination()):e.find("[elem=summaryRecContDiv] [elem=emptyDivContainer] [actType="+i.getMode()+"]").children().length>0?i.showContainer(!0):t.attr("actType")!=ZP5Import.SUMMARY_DATA_TYPE.ERROR?(i.setIsInit(!0),i.init(!0),this.getIsOnlySummary()&&i.is(ZP5Import.SUMMARY_DATA_TYPE.SKIPPED)&&(r.setIsInit(!1),r.init(!1))):this.getIsOnlySummary()?(r.setIsInit(!0),r.init(!0),r.getAlterInstance().setIsInit(!1),r.getAlterInstance().init(!1)):FrameworkCommon.removeLoading(this.getContainer().find("#"+ImportV5Summary.getCardId()).find("[elem=summaryRecContDiv]"))}showRecCountContainer(e){let t=this.getContainer().find("[elem=summaryRecCountContDiv]"),i=parseInt(e.records_added),r=parseInt(e.records_updated),s=parseInt(e.records_skipped),a=parseInt(e.errorsLen);this.showViewRecContainer(i>0||r>0,!(e.errorsLen<=0),ZP5Form.constructDownloadLink({impId:this.getImportId(),original:!0})),t.find("[elem=addedRecordsCount]").html(i>=10?i:"0"+i),t.find("[elem=updatedRecordsCount]").html(r>=10?r:"0"+r),t.find("[elem=skippedRecordsCount]").html(s>=10?s:"0"+s),t.find("[elem=errorInRecordsCount]").html(a>=10?a:"0"+a),t.find("[elem=recordCountListDiv] li").removeClass("zpl_act").attr("isActive",!1),this.getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.ADDED).setIsEmpty(0==i),this.getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.UPDATED).setIsEmpty(0==r),this.getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.SKIPPED).setIsEmpty(0==s),this.getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.ERROR).setIsEmpty(0==a),this.getIsOnlySummary()||this.getImportInstance().setRefresh(i>0||r>0);let n="";n=i>0&&!this.getIsTabularImport()?t.find("[elem=addedRecCont]"):r>0?t.find("[elem=updatedRecCont]"):s>0?t.find("[elem=skippedRecCont]"):t.find("[elem=errorCountCont]");t.find("[elem=recordCountListDiv] li").off().on("click",(e=>{t.find("[elem=recordCountListDiv] li").removeClass("zpl_act").attr("isActive",!1),t.find('[elem=recordCountListDiv] li[actType="'+$(e.target).attr("actType")+'"]').addClass("zpl_act").attr("isActive",!0),this.showRecContainer()}).bind(this));t.find("[elem=recordCountListDiv] li").removeClass("zpl_act").attr("isActive",!1),n.addClass("zpl_act").attr("isActive",!0),FrameworkCommon.show(t)}hideAllPagination(){FrameworkCommon.hide(this.getContainer().find('[elem="'+ZP5Import.SUMMARY_DATA_TYPE.ADDED+'_paginationFooter"]')),FrameworkCommon.hide(this.getContainer().find('[elem="'+ZP5Import.SUMMARY_DATA_TYPE.UPDATED+'_paginationFooter"]')),FrameworkCommon.hide(this.getContainer().find('[elem="'+ZP5Import.SUMMARY_DATA_TYPE.ERROR+'_paginationFooter"]')),FrameworkCommon.hide(this.getContainer().find('[elem="'+ZP5Import.SUMMARY_DATA_TYPE.SKIPPED+'_paginationFooter"]'))}}class ImportV5SummaryData{constructor(e){this.mode=e,this.setInitialValues()}setInitialValues(){this.isInit=!0,this.isEmpty=!1,this.hasMore=!0,this.recCount=0,this.startIndex=1,this.isLoad=!1}is(e){return this.mode==e}getMode(){return this.mode}getSummaryInstance(){return this.Summary}setSummaryInstance(e){this.Summary=e}getIsEmpty(){return this.isEmpty}setIsEmpty(e){this.isEmpty=e}getStartIndex(){return this.startIndex}setStartIndex(e){this.startIndex=e}getIsLoad(){return this.isLoad}setIsLoad(e){this.isLoad=e}getIsInit(){return this.isInit}setIsInit(e){this.isInit=e}getHasMore(){return this.hasMore}setHasMore(e){this.hasMore=e}getRecCount(){return this.recCount}setRecCount(e){this.recCount=e}getContainer(){return this.getSummaryInstance().getContainer()}getImportId(){return this.getSummaryInstance().getImportId()}getFormId(){return this.getSummaryInstance().getFormId()}getSummaryViewId(){return this.getSummaryInstance().getSummaryViewId()}getImpSummaryMode(){return this.getSummaryInstance().getImpSummaryMode()}static getFieldData(e,t,i,r){let s="";if(e.hasOwnProperty(i)){let a=$.inArray("Hrms_"+e[i].srcCol,t.headers);s=a>-1?t.data[r][a]:""}return s}showHidePagination(e){e&&this.getMode()==this.getContainer().find("[elem=summaryRecCountContDiv] [isActive=true]").attr("actType")?FrameworkCommon.show(this.getContainer().find('[elem="'+this.getMode()+'_paginationFooter"]')):FrameworkCommon.hide(this.getContainer().find('[elem="'+this.getMode()+'_paginationFooter"]'))}init(e){if(this.getIsEmpty()){let t=this.getContainer().find("[elem=summaryRecContDiv] [elem=emptyDivContainer] [actType="+this.getMode()+"]");new EmptyPages("zp_nd_nodata1",ZPI18N.getString("zp.nodatafound"),"",t).show(),this.setHasMore(!1),e&&(FrameworkCommon.show(t),this.showContainer(!0))}else if(this.getIsInit())if(this.setIsInit(!1),this.is(ZP5Import.SUMMARY_DATA_TYPE.ADDED)||this.is(ZP5Import.SUMMARY_DATA_TYPE.UPDATED)){let e=this.getContainer().find("[elem=summaryRecContDiv] [elem=tableContainer] div[actType="+this.getMode()+"]");$(this.getPaginationDiv()).insertBefore(this.getSummaryInstance().getSliderModal().modalFooter),this.getContainer().find('[elem="'+this.getMode()+'_paginationFooter"]').addClass("DNI");let t={container:e,impSummaryType:this.getMode(),paginationContainer:this.getContainer().find('[elem="'+this.getMode()+'_paginationFooter"]')};t.formId=this.getFormId(),t.showHidePagination=this.showHidePagination.bind(this),this.getSummaryInstance().getIsBulkFileUpload()?(t.importUniqueId=this.getSummaryInstance().getImportUniqueId(),t.isBulkImport=!0):(t.importId=this.getImportId(),this.getSummaryInstance().getIsOnlySummary()||this.getImpSummaryMode()!=ZP5Import.HANDLER_MODE.TRANSFER||(t.templateId=this.getSummaryInstance().getImportInstance().getHandler().getTemplateIdOrViewId(),t.viewId=t.templateId)),this.getSummaryViewId()?t.summaryViewId=this.getSummaryViewId():t.summaryViewId=ZP5ServicesCommon.getViewIdFromFormId(t.formId),this.getSummaryInstance().getIsOnlySummary()?(t.mode=this.getImpSummaryMode(),this.is(ZP5Import.SUMMARY_DATA_TYPE.ADDED)?ZP5ImportSummaryCommon.addedRecordsCallback(t):ZP5ImportSummaryCommon.updatedRecordsCallback(t)):ZP5Import.SUMMARY_DATA_TYPE.ADDED?this.getSummaryInstance().getImportInstance().getHandler().addedRecordsCallback(t):this.getSummaryInstance().getImportInstance().getHandler().updatedRecordsCallback(t),this.showContainer(!1,!0)}else{let e=this.getSummaryInstance().getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.SKIPPED),t=this.getSummaryInstance().getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.ERROR);e&&e.setIsInit(!1),this.getSummaryInstance().getIsOnlySummary()&&t.setIsInit(!1),this.getData()}}showContainer(e,t){FrameworkCommon.removeLoading(this.getContainer().find("#"+ImportV5Summary.getCardId()).find("[elem=summaryRecContDiv]")),FrameworkCommon.removeLoading(this.getContainer().find("#"+ImportV5Summary.getCardId())),FrameworkCommon.show(this.getContainer().find("[elem=summaryRecContDiv] [elem="+(e?"emptyDivContainer":"tableContainer")+"] div[actType="+this.getMode()+"]")),t&&(FrameworkCommon.removeLoading(this.getContainer().find("#"+ImportV5Summary.getCardId())),this.getContainer().find("[elem=summaryRecContDiv] [actType="+this.getMode()+"]").append(ZPeople.LOADING_HTML)),FrameworkCommon.show(this.getContainer().find("[elem=summaryRecContDiv]"))}getPaginationDiv(){let e=this.getMode();return'<div class="zpl_tblpagination" elem="'+e+'_paginationFooter" style="position:static;margin-bottom:2px;"><div class="zpl_rhtpgn"><div class="pagecount"><a class="zpl_prev" elem="'+e+'_prevPaginationButton"></a><span elem="'+e+'_paginationCount"><b></b></span><a class="zpl_nxt" elem="'+e+'_nextPaginationButton"></a></div></div></div>'}showPagination(){this.getSummaryInstance().hideAllPagination(),FrameworkCommon.show(this.getContainer().find('[elem="'+this.getMode()+'_paginationFooter"]'))}handlePagination(){let e=this.getMode(),t=this.getContainer().find('[elem="'+e+'_paginationFooter"]');t.find('[elem="'+e+'_prevPaginationButton"]').addClass("disabled gry").removeClass("blu CP").off(),t.find('[elem="'+e+'_nextPaginationButton"]').addClass("disabled gry").removeClass("blu CP").off(),1!=this.getStartIndex()&&t.find('[elem="'+e+'_prevPaginationButton"]').removeClass("disabled gry").addClass("blu CP").on("click",this.paginationAction.bind(this,!1));let i=this.getRecCount()>=this.getStartIndex()+199?this.getStartIndex()+199:this.getRecCount();t.find('[elem="'+e+'_paginationCount"] b').html(this.getStartIndex()+" - "+i),(this.getHasMore()||this.getRecCount()>=this.getStartIndex()+199)&&t.find('[elem="'+e+'_nextPaginationButton"]').removeClass("disabled gry").addClass("blu CP").on("click",this.paginationAction.bind(this,!0))}paginationAction(e){let t=this.getMode(),i=this.getContainer().find("[elem=summaryRecContDiv] [elem=tableContainer] div[actType="+t+"]");if(FrameworkCommon.hide(i.find('[elem="tableBody"]')),FrameworkCommon.hide(this.getContainer().find('[elem="'+t+'_paginationFooter"]')),$(ZPeople.LOADING_HTML).insertAfter(i.find('[elem="tableHeader"]')),e&&(this.getHasMore()||this.getRecCount()>=this.getStartIndex()+199))this.setStartIndex(this.getStartIndex()+200);else{if(e||1==this.getStartIndex())return void(e?this.getContainer().find('[elem="'+t+'_paginationFooter"] [elem="'+t+'_nextPaginationButton"]').addClass("disabled").off():this.getContainer().find('[elem="'+t+'_paginationFooter"] [elem="'+t+'_prevPaginationButton"]').addClass("disabled").off());this.setStartIndex(this.getStartIndex()-200)}0==i.find('[elem="tableBody"][pageDiv="'+this.getStartIndex()+'"]').length?this.getIsLoad()||(this.setIsLoad(!0),this.getData()):(this.handlePagination(),i.find("#zp_page_loading").remove(),FrameworkCommon.show(i.find('[elem="tableBody"][pageDiv="'+this.getStartIndex()+'"]')),this.getContainer().find("[elem="+(this.getSummaryInstance().getIsBulkFileUpload()?"bulkUploadSummaryDiv":"summaryViewRecContDiv")+"]")[0].scrollIntoView({behavior:"smooth",block:"start"}),this.showPagination(),FrameworkCommon.show(this.getContainer().find('[elem="'+t+'_paginationFooter"]')))}getAlterInstance(){return this.is(ZP5Import.SUMMARY_DATA_TYPE.ERROR)?this.getSummaryInstance().getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.SKIPPED):this.getSummaryInstance().getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.ERROR)}constructEmptyDiv(){let e=this.getContainer().find("[elem=summaryRecContDiv] [elem=emptyDivContainer] [actType="+this.getMode()+"]");new EmptyPages("zp_nd_nodata1",ZPI18N.getString("zp.nodatafound"),"",e).show(),FrameworkCommon.show(e),this.setHasMore(!1)}constructTableDiv(e,t){let i='<div class="zpl_rgtcnt"><div class="zpl_tblres zpl_colmaxwd">';i+='<table class="zpl_tbl zpl_nocrsor" elem="importTable'+this.getMode()+'Rec" actType="'+this.getMode()+'">',i+='<thead elem="tableHeader">'+e+"</thead>",i+='<tbody elem="tableBody" pageDiv="1">'+t+"</tbody>",i+="</table></div></div>",this.getContainer().find("[elem=summaryRecContDiv] [elem=tableContainer] div[actType="+this.getMode()+"]").html(i),$(this.getPaginationDiv()).insertBefore(this.getSummaryInstance().getSliderModal().modalFooter),this.handlePagination()}constructMoreTableDiv(e,t){this.handlePagination();let i='<tbody elem="tableBody" pageDiv="'+this.getStartIndex()+'">'+e+"</tbody>";this.getContainer().find("[elem=summaryRecContDiv] [elem=tableContainer] [actType="+this.getMode()+"]").find("#zp_page_loading").remove(),$(i).insertAfter(this.getContainer().find("[elem=summaryRecContDiv] [elem=tableContainer] [actType="+this.getMode()+"] [elem=tableHeader]")),t&&FrameworkCommon.show(this.getContainer().find('[elem="'+this.getMode()+'_paginationFooter"]'))}callback(e,t,i){let r=this.getAlterInstance(),s=this.getSummaryInstance().getIsOnlySummary()&&!this.getSummaryInstance().getIsBulkFileUpload();if(e.isSuccess)if(e.isImpSummaryAvailable){let i,a=1==t.stIndex,n=a?e.data.data.length:this.getRecCount()+e.data.data.length;this.setRecCount(n),this.setHasMore(200==e.data.data.length),s?(r.setRecCount(n),r.setStartIndex(this.getStartIndex()),r.setHasMore(this.getHasMore()),a&&(this.getSummaryInstance().setSections(e.columnMappings.sections),this.getSummaryInstance().setMappings(e.columnMappings.mappings)),i=this.constructTableData(this.getSummaryInstance().getSections(),e.data,this.getSummaryInstance().getMappings())):i=this.getSummaryInstance().getIsBulkFileUpload()?this.constructBulkFileUploadData(e.data):ImportV5Mappings.constructData(this.getSummaryInstance().getSections(),e.data,this.getSummaryInstance().getMappings()),a?this.getIsEmpty()?(this.constructEmptyDiv(),this.showContainer(!0),s&&r.constructEmptyDiv()):(this.constructTableDiv(i[0],i[1]),this.showContainer(!1),s&&r.constructTableDiv(i[2],i[3])):(this.constructMoreTableDiv(i[1],!0),s&&r.constructMoreTableDiv(i[3],!1))}else ZPeople.Message.failure("Import Summary Not Available");else{let t=ZPI18N.getString("zp.sorryservererror");e.hasOwnProperty("error")&&e.error&&(t=e.error),ZPeople.Message.failure(t)}this.setIsLoad(!1)}getData(){let e={};e.importId=this.getSummaryInstance().getImportId(),e.stIndex=this.getStartIndex(),this.getSummaryInstance().getIsBulkFileUpload()&&(e.isBulkImport=!0,e.importId=this.getSummaryInstance().getImportUniqueId()),this.getSummaryInstance().getIsOnlySummary()?ZPeople.Request.sendRequestWithVersion(ImportV5Summary.getURL(),e,"GET",this.callback.bind(this)):(e.formId=this.getSummaryInstance().getFormId(),e.impformId=this.getSummaryInstance().getImportFormId(),e.mode="summary",e.type=this.getMode(),this.getImpSummaryMode()==ZP5Import.HANDLER_MODE.TRANSFER&&(e.templateId=this.getSummaryInstance().getImportInstance().getHandler().getTemplateIdOrViewId()),ZPeople.Request.send(ImportV5.getURL(),e,this.callback.bind(this)))}constructTableData(e,t,i){let r=!1,s='<th class="zpl_txtcenter" rowspan="2" style="width:100px">'+ZPI18N.getString("zp.rowno")+"</th>",a="",n='<tr><th class="zpl_txtcenter" style="width:100px">'+ZPI18N.getString("zp.rowno")+"</th><th>"+ZPI18N.getString("zp.errorDetails")+"</th></tr>",o="",l="";$.each(t.data,(function(n){let d=$.inArray("ROWNUMBER",t.headers),p=d>-1?t.data[n][d]:"",m=$.inArray("ERROR",t.headers),c=m>-1?t.data[n][m]:"";o+='<tr><td style="width:100px">'+ZPI18N.getString("zp.row")+" "+p+"</td>",l+='<tr><td style="width:100px">'+ZPI18N.getString("zp.row")+" "+p+"</td><td>"+c.replace(/\n/g,"<br>")+"</td></tr>",$.each(e,(function(e,l){let d=0,p=!1,m="";$.each(l.fields,(function(e,s){if(i.hasOwnProperty(s.colName)){r||(a+="<th>"+s.dispName+"</th>",p=!0);let e=ImportV5SummaryData.getFieldData(i,t,s.colName,n);m+='<td onmouseover="FrameworkCommon.mouseEnterFunction()"><span>'+e+"</span></td>",d++}})),!r&&p&&(s+='<th class="zpl_txtcenter zpl_tblbrbtm" colspan="'+d+'">'+ZSEC.Encoder.encodeForHTML(l.dispName)+"</th>"),""!=m.trim()&&(o+=m)})),o+="</tr>",r=!0}));let d="<tr>"+s+"</tr><tr>"+a+"</tr>";return this.is(ZP5Import.SUMMARY_DATA_TYPE.SKIPPED)?[d,o,n,l]:[n,l,d,o]}constructBulkFileUploadData(e){let t='<tr><th class="zpl_txtcenter" style="width:100px">'+ZPI18N.getString("zp.filename")+"</th><th>"+ZPI18N.getString("zp.errorDetails")+"</th></tr>",i="";return $.each(e.data,(function(t){let r=$.inArray("FILENAME",e.headers),s=r>-1?e.data[t][r]:"",a=$.inArray("ERROR",e.headers),n=a>-1?e.data[t][a]:"";i+='<tr><td style="width:100px" onmouseover="FrameworkCommon.mouseEnterFunction()">'+s+"</td><td>"+n.replace(/\n/g,"<br>")+"</td></tr>"})),[t,i]}}const ZP5Import={CURROBJ:void 0,CURRSUMMOBJ:void 0,SUMMARY_DATA_TYPE:{ADDED:"ADDED",UPDATED:"UPDATED",SKIPPED:"SKIPPED",ERROR:"ERROR"},HANDLER_MODE:{FORMS:"form",BULKFILEUPLOAD:"bulkfileupload",PHOTOUPLOAD:"photoupload",USERS:"users",PROFILE:"profile",JOB:"job",PROJECT:"project",CLIENT:"client",LEAVE:"leave",APPRAISAL:"appraisal",STREAM:"stream",LOCATION:"location",PAMETHODS:"pamethods",EMPLOYEESALARY:"empsalary",SETTING_DEPARTMENT:"setting_department",SETTING_DESIGNATION:"setting_designation",TRANSFER:"transfer",CASES:"hrcase",CANDIDATE:"candidate",RESIGNATION:"resignation",APPOINTMENT:"appointment"},init:(e,t)=>{ZP5Import.CURROBJ=new ImportV5(e,t),ZP5Import.CURROBJ.init()},initBulkFileUpload:e=>{ZP5Import.CURROBJ=new BulkFileUploadV5(ZP5Import.HANDLER_MODE.BULKFILEUPLOAD,e),ZP5Import.CURROBJ.init()},initPhotoUpload:e=>{ZP5Import.CURROBJ=new BulkFileUploadV5(ZP5Import.HANDLER_MODE.PHOTOUPLOAD,e),ZP5Import.CURROBJ.init()},getUploadInstance:e=>{switch(e){case ZP5Import.HANDLER_MODE.BULKFILEUPLOAD:case ZP5Import.HANDLER_MODE.PHOTOUPLOAD:return new BulkFileUploadV5UploadFile(e);case ZP5Import.HANDLER_MODE.PAMETHODS:return new PAMethodImportV5UploadFile(e)}return new ImportV5UploadFile(e)},getMappingsInstance:e=>new ImportV5Mappings(e),getSummaryInstance:e=>{switch(e){case ZP5Import.HANDLER_MODE.BULKFILEUPLOAD:case ZP5Import.HANDLER_MODE.PHOTOUPLOAD:return new BulkFileUploadV5Summary(e);case ZP5Import.HANDLER_MODE.PAMETHODS:case ZP5Import.HANDLER_MODE.APPRAISAL:return new PAMethodImportV5Summary(e)}return new ImportV5Summary(e)},getHandlerInstance:e=>{switch(e){case ZP5Import.HANDLER_MODE.USERS:case ZP5Import.HANDLER_MODE.PROFILE:return new UsersImportV5Handler(e);case ZP5Import.HANDLER_MODE.JOB:return new TimesheetJobImport(e);case ZP5Import.HANDLER_MODE.PROJECT:return new TimesheetProjectImport(e);case ZP5Import.HANDLER_MODE.CLIENT:return new TimesheetClientImport(e);case ZP5Import.HANDLER_MODE.LEAVE:return new LeaveImportV5Handler(e);case ZP5Import.HANDLER_MODE.APPRAISAL:return new PAImportV5Handler(e);case ZP5Import.HANDLER_MODE.PAMETHODS:return new PAMethodImportV5Handler(e);case ZP5Import.HANDLER_MODE.STREAM:return new StreamImportV5Handler(e);case ZP5Import.HANDLER_MODE.LOCATION:return new LocationImportV5Handler(e);case ZP5Import.HANDLER_MODE.BULKFILEUPLOAD:return new BulkFileUploadV5Handler(e);case ZP5Import.HANDLER_MODE.PHOTOUPLOAD:return new PhotoUploadV5Handler(e);case ZP5Import.HANDLER_MODE.EMPLOYEESALARY:return new CompensationSalaryImport(e);case ZP5Import.HANDLER_MODE.TRANSFER:return new TransferListViewImportHandler(e);case ZP5Import.HANDLER_MODE.SETTING_DEPARTMENT:case ZP5Import.HANDLER_MODE.SETTING_DESIGNATION:return new OrganizationFormsImportV5Handler(e);case ZP5Import.HANDLER_MODE.CASES:return new HRCaseImport(e);case ZP5Import.HANDLER_MODE.CANDIDATE:return new CandidateImportV5Handler(e);case ZP5Import.HANDLER_MODE.RESIGNATION:return new ResignationV5Handler;case ZP5Import.HANDLER_MODE.APPOINTMENT:return new AppointmentImport(e);default:new ImportV5Handler(e)}return new ImportV5Handler(ZP5Import.HANDLER_MODE.FORMS)},getSliderInstance:e=>{switch(e){case ZP5Import.HANDLER_MODE.BULKFILEUPLOAD:return new BulkFileUploadV5Slider(e);case ZP5Import.HANDLER_MODE.PHOTOUPLOAD:return new BulkFileUploadV5Slider(e,!0)}return new ImportV5Slider(e)},initSummary:(e,t)=>{ZP5Import.CURRSUMMOBJ=new ImportV5Summary(ZP5Import.HANDLER_MODE.FORMS),ZP5Import.CURRSUMMOBJ.initOnlySummary(e,t)},initBulkFileUploadSummary:(e,t,i,r)=>{ZP5Import.CURRSUMMOBJ=new BulkFileUploadV5Summary(ZP5Import.HANDLER_MODE.BULKFILEUPLOAD),ZP5Import.CURRSUMMOBJ.initOnlySummary(e,t,i,r)},closeAndDestroy:()=>{ZP5Import.CURROBJ&&ZP5Import.CURROBJ.getSliderModal().close(),ZP5Import.CURRSUMMOBJ&&ZP5Import.CURRSUMMOBJ.getSliderModal().close()},destroy:()=>{ZP5Import.CURROBJ=null,ZP5Import.CURRSUMMOBJ=null}};class ImportV5Handler{constructor(e){this.mode=e}setImportInstance(e){this.IMPORTV5=e}getImportInstance(){return this.IMPORTV5}getURL(){return ImportV5.getURL()}is(e){return this.mode===e}getTableName(){return this.getImportInstance().getTableName()}getFormId(){return this.formId||(ZP5Views.getCurrViewObj()?this.formId=ZP5Views.getCurrViewObj().getFormId():this.formId=FormsCommonLayout.getFormIdFromLabelName()),this.formId}getModalHeader(){return ZPI18N.getString("zp.import")}isModuleBasedImport(){return!1}isFormBasedInit(){return!0}hideDataForSelectDiv(){FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=importDataForCont]")),FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=importDataFor]")),ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importDataFor]")).setAttribute("zclass-name","DNI"),ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importDataFor]")).refresh()}hideBasedOnSelectDiv(){FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=importBasedOnCont]")),FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=importBasedOn]")),ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importBasedOn]")).setAttribute("zclass-name","DNI"),ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importBasedOn]")).refresh()}showDataForSelectDiv(){FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=importDataForCont]")),FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=importDataFor]")),ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importDataFor]")).setAttribute("zclass-name",""),ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importDataFor]")).refresh()}showBasedOnSelectDiv(){FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=importBasedOnCont]")),FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=importBasedOn]")),ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importBasedOn]")).setAttribute("zclass-name",""),ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importBasedOn]")).refresh()}showBasedOnAllowed(){return!0}initAdditionalParamsCallback(e){}uploadInitialCallback(){this.getImportInstance().getUploadInstance().initImportDataFor(),this.getImportInstance().getUploadInstance().initImportDataBasedOn(),this.getImportInstance().getUploadInstance().showUniqueFieldNote(),this.uploadDefActionCallback()}_allowMobileUsersAddition(){return ZPeople.isMobileUsersAllowed||this.allowMobileUsersAddition()}allowMobileUsersAddition(){return!1}uploadDefActionCallback(){}constructImportDataFor(){let e='<div class="zpl_secn zpl_idivingrp '+(this.is(ZP5Import.HANDLER_MODE.PROFILE)?"DNI":"")+' " elem="importForBasedCont" style="width: 500px;" >';return e+='<div><div><label elem="importDataForCont">'+ZPI18N.getString("zp.importDataFor")+'</label><label elem="importBasedOnCont">'+ZPI18N.getString("zp.importBasedOn")+"</label></div></div>",e+='<div><div><select elem="importDataFor" name="impformId"></select><select elem="importBasedOn" name="impUniueId"></select></div></div></div>',e}downloadTemplate(){let e={formId:this.getImportInstance().getBaseFormId()+""};this.getImportInstance().getHandler().isModuleBasedImport()||(e.impformId=ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importDataFor]")).getValue()+"",e.impUniueId=ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importBasedOn]")).getValue()+"");let t=FrameworkCommon.getHTMLFormDataObj("zp_import_form","Import.zp?mode=template","post","exportresp1",e);this.downloadTemplateAdditionalCallback(t),t.submit()}downloadTemplateAdditionalCallback(e){}isFileDataPaginationNeeded(){return!0}uploadFileCallback(){let e=this.getImportInstance().getContainer().find("#cardMappingDetails").find("form[elem=uploadFileForm]");this.uploadSetParamsCallback(e),this.getImportInstance().setImportFormId(e.find("[name=impformId]").val()),this.getImportInstance().setImportUniqueId(e.find("[name=impUniueId]").val()),this.getImportInstance().setCurrentStep(2),this.getImportInstance().setMappingForward(!0),this.getImportInstance().getSliderModal().nextTab(!1),this.getImportInstance().getContainer().addClass("zpl_mdltopnav"),FrameworkCommon.show(this.getImportInstance().getContainer().find("#tabLeftUl").parents(".zpl_mmnulft"));let t=new FormData(e[0]);ZPeople.Request.sendFormData("/ImportUploadFile.zp",t,this.getImportInstance().getMappingsInstance().init.bind(this.getImportInstance().getMappingsInstance()),{},((e,t,i)=>{let r=()=>{this.getImportInstance().getSliderModal().close()};ServiceApplicabilityUtil.Error.showWarningMessage(e,t,i,r.bind(this))||(FrameworkCommon.failureCallback(e),r())})),FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=uploadFileContainer],[elem=uploadFileHandleDiv]")),FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=licenseCountDiv]")),FrameworkCommon.addLoading(this.getImportInstance().getContainer().find("#"+ImportV5Mappings.getConstructMappingsCardId()))}uploadSetParamsFormBasedCallback(e){this.getImportInstance().getHandler().isModuleBasedImport()||(e.find("[name=formId]").val(this.getImportInstance().getBaseFormId()),e.find("[name=impformId]").val(ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importDataFor]")).getValue()),e.find("[name=impUniueId]").val(ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importBasedOn]")).getValue()),e.find("[name=importBasedOnValue]").val(this.getImportInstance().getIsImportBasedOn()))}uploadSetParamsCallback(e){this.uploadSetParamsFormBasedCallback(e)}addImportBasedOnOptions(e){return e}getRecordCount(e){return e.parseResult.recordCount}getTableHeaders(e){return e.parseResult.tableHeaders}constructMappingsCallback(){let e="",t=this;$.each(this.getImportInstance().getFormDetails().sections,(function(i,r){e+='<div class="zpl_collapsepanel" id="importSection_'+r.id+'" show="true" elem="collapsibleSectionPanel"><div><h4>'+r.name+"</h4></div>",e+="<div>"+t.constructSectionDiv(r)+"</div></div>"})),this.getImportInstance().getContainer().find("[elem=collapsiblePanels]").html(e)}constructSectionDiv(e){let t=[],i=[];return $.each(e.col1Fields,(function(e,i){t.push(i)})),$.each(e.col2Fields,(function(e,t){i.push(t)})),this.getImportInstance().getMappingsInstance().constructSectionDiv(t,i)}constructMappingsDefaultActionsCallback(){}updateCombinedFieldMappedStatus(e){let t=$(e).find("[elem=mappingFieldDiv]").length,i=$(e).find("[elem=mappingFieldDiv][mapped=true]").length;return i>0&&i==t}includePartialMapHandling(){return!0}submitMappingsCallback(e,t){if(e.isLocationTrackingEnabled&&!t.isPermEnabled)return ZPeople.Message.failure(ZPI18N.getString("zp.enableaccesstolocation")),!1;this.getImportInstance().setCurrentStep(4),this.getImportInstance().getSliderModal().nextTab(!1);let i=this.getImportInstance().getSummaryInstance();ZPeople.Request.send(this.getURL(),this.setParamsCallback(e,t),i.init.bind(i),{},this.getImportInstance().failCallback.bind(this.getImportInstance()))}setParamsCallback(e,t){let i={mode:"mappings"};return i.formId=this.getImportInstance().getBaseFormId(),i.impformId=this.getImportInstance().getImportFormId(),i.mappings=JSON.stringify(this.getImportInstance().getMappings()),i.fileType=this.getImportInstance().getFileType(),i.filename=this.getImportInstance().getFName(),i.workFlowOn=this.getImportInstance().getTriggerWorkflow(),i.approvalOn=this.getImportInstance().getTriggerApproval(),i.casesNotifyOn=this.getImportInstance().getNotifyCases(),this.getImportInstance().getIsBulkFileUpload()||(i.customValidationOn=this.getImportInstance().getTriggerCV()),this.getImportInstance().getImportId()&&(i.importId=this.getImportInstance().getImportId()),e.isLocationTrackingEnabled&&t.isPermEnabled&&(i.latitude=t.latitude,i.longitude=t.longitude),this.setExtraParamsCallback(i),i}setExtraParamsCallback(e){}setMappingsFileDataExtraParams(e){}refreshCallback(){}hashChangeCallback(e){if(!this.getImportInstance().getHandler().isModuleBasedImport()){if(-1!==settingsUrlProps.niceUrl.lastIndexOf("import"))return void(window.location.hash=urlFormConf.getUrlFromMode("listview")+(settingsUrlProps.urlParams?"-"+settingsUrlProps.urlParams:""))}e&&ZP5Views.callback()}isMandatoryValidation(e){return!1}mappingsValidationCallback(){return!0}resetMappingsCallback(){}applyAutoMappingsCallback(){}applyPrevMappingsCallback(){}_updateCount(e,t){let i=ZPeopleComponents.select($(t).find("[elem=mappingFieldSelectDiv]")).getValue();""==i||"-1"==i?e.unmappedCount++:e.mappedCount++}_updateChildCount(e,t){let i=0;$.each($(t).find("[elem=mappingFieldDiv]"),(function(e,t){let r=ZPeopleComponents.select($(t).find("[elem=mappingFieldSelectDiv]")).getValue();""!=r&&"-1"!=r||i++})),i>0?e.unmappedCount++:e.mappedCount++}fieldsMappingCountCallback(e){let t=this;$.each(this.getImportInstance().getContainer().find("[elem=mappingFieldDiv]").not("[isChildField=true],[isCombField=true]"),(function(i,r){t._updateCount(e,r)}))}addressFieldsMappingCountCallback(e){let t=this;$.each(this.getImportInstance().getContainer().find("[elem=addressMappingFieldDiv]"),(function(i,r){t._updateChildCount(e,r)}))}combinedFieldsMappingCountCallback(e){let t=this;$.each(this.getImportInstance().getContainer().find("[elem=combinedMappingFieldDiv]"),(function(i,r){t._updateChildCount(e,r)}))}alertAutomationCallback(){this.alertModalParamsCallback(),this.getImportInstance().getMappingsInstance().validate()}alertModalParamsCallback(){}showAlertBeforeImportData(){return!!(this.getImportInstance().getTriggerWorkflow()||!this.getImportInstance().getIsBulkFileUpload()&&this.getImportInstance().getTriggerCV()||!this.getImportInstance().getIsTabularImport()&&(this.getImportInstance().getTriggerApproval()||this.getImportInstance().getNotifyCases())||this.showAlertAdditionalCallback())}showAlertAdditionalCallback(){return!1}afterSubmitCallback(e,t,i){}isLocationTrackingEnabled(e){if(ZP5Form.getForm(e)){let t=ZP5Form.getForm(e).getFormDetailsMap();if(null!=t)return t.isLocationTrackingEnabled}return!1}closeCallback(){return!(!ZP5Views.getCurrViewObj()||!ZP5Views.getCurrViewObj().isImportSummary)&&(ZP5Views.restSystemFilterZC(),ZP5Views.restViewPage(),!0)}_defaultRecordsHandlingCallback(e){ZP5Views.importInitialCallback(e)}addedRecordsCallback(e){this._defaultRecordsHandlingCallback(e)}updatedRecordsCallback(e){this._defaultRecordsHandlingCallback(e)}constructAlertModalContent(){let e="<h3>"+ZPI18N.getString("zp.doyouwantto")+"</h3>";return this.getImportInstance().getIsWorkFlowAvailable()&&(e+='<div elem="importExecuteWorkflowContainer" class="zcheckbox"><input name="executeworkflow" id="importExecuteWorkflow" type="checkbox" class="zcheckbox__helper"'+(this.getImportInstance().getTriggerWorkflow()?"checked":"")+'><label for="importExecuteWorkflow" class="zcheckbox__label">'+ZPI18N.getString("zp.executeeworkflow")+"</label></div>"),!this.getImportInstance().getIsBulkFileUpload()&&this.getImportInstance().getIsCVConfigured()&&(e+='<div elem="importTriggerCVContainer" class="zcheckbox"><input name="triggerCV" id="importTriggerCV" type="checkbox" class="zcheckbox__helper"'+(this.getImportInstance().getTriggerCV()?"checked":"")+'><label for="importTriggerCV" class="zcheckbox__label">'+ZPI18N.getString("zp.executecustomvalidation")+"</label></div>"),this.getImportInstance().getIsTabularImport()||(this.getImportInstance().getIsApprovalConfigured()&&(e+='<div elem="importSendforApprovalContainer" class="zcheckbox"><input name="sendforapproval" id="importSendForApproval" type="checkbox" class="zcheckbox__helper"'+(this.getImportInstance().getTriggerApproval()?"checked":"")+'><label for="importSendForApproval" class="zcheckbox__label">'+ZPI18N.getString("zp.sendforapproval")+"</label></div>"),this.getImportInstance().getIsCasesNotifyAvailable()&&(e+='<div elem="importCasesNotifyContainer" class="zcheckbox"><input name="casesnotify" id="importNotifyCases" type="checkbox" class="zcheckbox__helper"'+(this.getImportInstance().getNotifyCases()?"checked":"")+'><label for="importNotifyCases" class="zcheckbox__label">'+ZPI18N.getString("zp.enablecasesnotify")+"</label></div>")),e+=this.constructAdditionalAlertModalContent(),e+="</div></div></div>",e}constructAdditionalAlertModalContent(){return""}}class BulkFileUploadV5Handler extends ImportV5Handler{hashChangeCallback(e){if(!this.getImportInstance().getHandler().isModuleBasedImport()){if(-1!==settingsUrlProps.niceUrl.lastIndexOf("bulkupload"))return void(window.location.hash=urlFormConf.getUrlFromMode("listview")+(settingsUrlProps.urlParams?"-"+settingsUrlProps.urlParams:""))}e&&ZP5Views.callback()}alertAutomationCallback(){this.getImportInstance().getUploadInstance().validate()}showAlertBeforeImportData(){return this.getImportInstance().getTriggerWorkflow()||this.getImportInstance().getTriggerApproval()}}class PhotoUploadV5Handler extends ImportV5Handler{hashChangeCallback(e){if(!this.getImportInstance().getHandler().isModuleBasedImport()){if(-1!==settingsUrlProps.niceUrl.lastIndexOf("photoupload"))return void(window.location.hash=urlFormConf.getUrlFromMode("listview")+(settingsUrlProps.urlParams?"-"+settingsUrlProps.urlParams:""))}e&&ZP5Views.callback()}alertAutomationCallback(){this.getImportInstance().getUploadInstance().validate()}showAlertBeforeImportData(){return this.getImportInstance().getTriggerWorkflow()||this.getImportInstance().getTriggerApproval()}}class UsersImportV5Handler extends ImportV5Handler{constructor(e){super(e)}getURL(){return this.is(ZP5Import.HANDLER_MODE.PROFILE)?"/ImportNonUser.zp":ImportV5.getURL()}initAdditionalParamsCallback(e){this.is(ZP5Import.HANDLER_MODE.PROFILE)&&(e.isDummy="true")}uploadSetParamsCallback(e){this.uploadSetParamsFormBasedCallback(e),0==e.find("input[name=dummy]").length&&e.append('<input type="hidden" value="false" name="dummy"/>'),e.find("input[name=dummy]").val(this.is(ZP5Import.HANDLER_MODE.PROFILE))}getTableName(){return"P_Employee"}allowMobileUsersAddition(){return"undefined"!=typeof User&&User.ALLOW_MOBILEUSER_ADDITION}getModalHeader(){return this.is(ZP5Import.HANDLER_MODE.USERS)?ZPI18N.getString("zp.lms.member.importcsv"):ZPI18N.getString("zp.importnonuser")}getFormId(){return ZPeople.EMP_FORMID}refreshCallback(){Users.operations.view.submitFilter(Users.common.getExtraParams())}isLocationTrackingEnabled(){return!1}}class TimesheetImportV5Handler extends ImportV5Handler{constructor(e){super(e)}addImportBasedOnOptions(e){return e.splice(0,0,{label:ZPI18N.getString("zp.zoholinkId"),value:"-1"}),e}constructMappingsDefaultActionsCallback(){this.updateZohoLinkIdElement()}resetMappingsCallback(){this.updateZohoLinkIdElement()}applyAutoMappingsCallback(){this.updateZohoLinkIdElement()}updateZohoLinkIdElement(){let e=this.getImportInstance().getContainer().find('[elem="mappingFieldDiv"][cname="'+this.getPKColumn()+'"]');e.length>0&&("-1"===this.getImportInstance().getImportUniqueId()?(e.attr("isdisabled",!0),e.attr("data-title-position","bottom").attr("title",ZPI18N.getString("zp.importDefaultColumnForUniqueField",[ZPI18N.getString("zp.zoholinkId")])),e.ztooltip(),ZPeopleComponents.select(e.find("[elem=mappingFieldSelectDiv]:first")).disable(),ZPeopleComponents.select(e.find("[elem=mappingFieldSelectDiv]:first")).setValue("0"),ZPeopleComponents.select(e.find("[elem=mappingFieldSelectDiv]:first")).refresh()):e.remove())}combinedFieldsMappingCountCallback(e){$.each(this.getImportInstance().getContainer().find("[elem=combinedMappingFieldDiv]"),(function(t,i){let r=!1;$.each($(i).find("[elem=mappingFieldDiv]"),(function(e,t){let i=$(t).attr("cname");if(-1===i.indexOf("_HOURS")&&-1===i.indexOf("_RPH")){let e=ZPeopleComponents.select($(t).find("[elem=mappingFieldSelectDiv]")).getValue();if(""!=e&&"-1"!=e)return void(r=!0)}})),r?e.mappedCount++:e.unmappedCount++}))}}class TimesheetJobImport extends TimesheetImportV5Handler{constructor(e){super(e)}getTableName(){return"P_TimesheetJob"}getFormId(){return Timetracker.jobs.formDetails.formId}getPKColumn(){return"JOBID"}applyAutoMappingsCallback(){let e=this.getImportInstance().getContainer(),t=this.getImportInstance().getTableHeaders();$.each(t,(function(t,i){-1!==(i=ZPeople.decodeTxt(i).toLowerCase()).indexOf("assignee")?-1===i.indexOf("hours")&&-1===i.indexOf("rate per hour")?ZPeopleComponents.select(e.find("[elem=mappingFieldSelectDiv][cname=ASSIGNEES]")).setValue(t+""):-1!==i.indexOf("hours")?ZPeopleComponents.select(e.find("[elem=mappingFieldSelectDiv][cname=JOBASSIGNEE_HOURS]")).setValue(t+""):ZPeopleComponents.select(e.find("[elem=mappingFieldSelectDiv][cname=JOBASSIGNEE_RPH]")).setValue(t+""):-1===i.indexOf("project id")&&-1===i.indexOf("project_id")||ZPeopleComponents.select(e.find("[elem=mappingFieldSelectDiv][cname=JOB_PROJECTCOL]")).setValue(t+"")})),super.updateZohoLinkIdElement()}refreshCallback(){Timetracker.Page.isProjectDashboard("jobs")&&Timetracker.projectDashboard.getProjectDtls(Layout.Page.urlparam.id).then((function(e){Timetracker.projectDashboard.DashboardJobs.initDashboardJobs()}))}}class TimesheetProjectImport extends TimesheetImportV5Handler{constructor(e){super(e)}getTableName(){return"P_TimesheetJobsList"}getFormId(){return Timetracker.projects.formDetails.formId}getPKColumn(){return"JOBSLISTID"}applyAutoMappingsCallback(){let e=this.getImportInstance().getContainer(),t=this.getImportInstance().getTableHeaders();$.each(t,(function(t,i){-1!==(i=ZPeople.decodeTxt(i).toLowerCase()).indexOf("head")?-1===i.indexOf("rate per hour")?ZPeopleComponents.select(e.find("[elem=mappingFieldSelectDiv][cname=PROJECTHEAD]")).setValue(t+""):ZPeopleComponents.select(e.find("[elem=mappingFieldSelectDiv][cname=PROJECTHEAD_RPH]")).setValue(t+""):-1!==i.indexOf("manager")?-1===i.indexOf("rate per hour")?ZPeopleComponents.select(e.find("[elem=mappingFieldSelectDiv][cname=PROJECTMANAGERS]")).setValue(t+""):ZPeopleComponents.select(e.find("[elem=mappingFieldSelectDiv][cname=PROJECTMANAGER_RPH]")).setValue(t+""):-1!==i.indexOf("user")&&(-1===i.indexOf("rate per hour")?ZPeopleComponents.select(e.find("[elem=mappingFieldSelectDiv][cname=PROJECTUSERS]")).setValue(t+""):ZPeopleComponents.select(e.find("[elem=mappingFieldSelectDiv][cname=PROJECTUSER_RPH]")).setValue(t+""))})),super.updateZohoLinkIdElement()}}class TimesheetClientImport extends TimesheetImportV5Handler{constructor(e){super(e)}getTableName(){return"P_ClientDetails"}getFormId(){return Timetracker.clients.formDetails.formId}getPKColumn(){return"CLIENTID"}}class LeaveImportV5Handler extends ImportV5Handler{constructor(e){super(e)}getTableName(){return"P_EmployeeLeave"}getFormId(){return ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.formid}uploadDefActionCallback(){this.hideBasedOnSelectDiv()}downloadTemplate(){LeaveForm.loadTemplate()}isMandatoryValidation(){return!0}}class StreamImportV5Handler extends ImportV5Handler{constructor(e){super(e)}getFormId(){return StreamsNew.formId}refreshCallback(){StreamsNew.constructListObj.isResetNeeded=!0,StreamsNew.init()}isLocationTrackingEnabled(){return!1}hashChangeCallback(e){return!1}}class LocationImportV5Handler extends ImportV5Handler{constructor(e){super(e)}getModalHeader(){return ZPI18N.getString("zp.importLocation")}getFormId(){return Locations.NewSetting.locationsFormId}refreshCallback(){Locations.NewSetting.needRefreshLocationsList=!0,Locations.NewSetting.callBack()}isLocationTrackingEnabled(){return!1}hashChangeCallback(e){return!1}}class CompensationSalaryImport extends ImportV5Handler{constructor(e){super(e),this.salaryViewObj=void 0}getSalaryViewObj(){if(null==this.salaryViewObj){let e={selMode:"All"};const t=Compensation.CONSTANTS.VIEWTYPE.OPER;e.viewType=t,this.salaryViewObj=Compensation.Salary.Operations.getViewObj(t,e)}return this.salaryViewObj}getModalHeader(){return this.getSalaryViewObj().getImportHeader()}getTableName(){return"P_SalaryRevision"}getFormId(){return Compensation.Config.configObj.revFormId}isLocationTrackingEnabled(){return!1}uploadDefActionCallback(){this.getSalaryViewObj().constructImpDepFields(this.getImportInstance().getContainer()),this.getImportInstance().getContainer().find("[elem=importForBasedCont]").hide()}setExtraParamsCallback(e){return this.getSalaryViewObj().setImportExtraParam(this.getImportInstance().getContainer(),e)}downloadTemplateAdditionalCallback(e){this.getSalaryViewObj().appendCompImpFields(this.getImportInstance().getContainer(),e)}uploadSetParamsCallback(e){this.uploadSetParamsFormBasedCallback(e),this.getSalaryViewObj().appendCompImpFields(this.getImportInstance().getContainer(),e)}}class AppointmentImport extends ImportV5Handler{constructor(e){super(e)}getModalHeader(){return ZPI18N.getString("zp.import")}getTableName(){return"P_AppointmentLetter"}getFormId(){return ZPeople.Module.MODULE_DATA["appointmentletter-listview"].formId}isLocationTrackingEnabled(){return!1}uploadDefActionCallback(){ApptLtr.Import.constructImpFlds(this.getImportInstance().getContainer()),this.getImportInstance().getContainer().find("[elem=importForBasedCont]").hide()}setExtraParamsCallback(e){return ApptLtr.Import.setImportExtraParam(this.getImportInstance().getContainer(),e)}downloadTemplate(){let e=$("#zp_import_form").html("");e.append('<input type="hidden" value="'+csrfToken+'" name="'+csrfParamName+'"/>'),e.append('<input type="hidden" value="template" name="mode"/>'),e.append('<input type="hidden" value="'+this.getImportInstance().getBaseFormId()+'" name="formId"/>'),e.append('<input type="hidden" value="'+ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importDataFor]")).getValue()+'" name="impformId"/>'),e.append('<input type="hidden" value="'+ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=importBasedOn]")).getValue()+'" name="impUniueId"/>'),ApptLtr.Import.appendCompImpFields(this.getImportInstance().getContainer(),e),e.trigger("submit")}uploadSetParamsCallback(e){this.uploadSetParamsFormBasedCallback(e),ApptLtr.Import.appendCompImpFields(this.getImportInstance().getContainer(),e)}}const ZP5ImportSummaryCommon={loadDependentFiles:e=>{},addedRecordsCallback:e=>e?(ZP5ImportSummaryCommon.loadDependentFiles(e.mode),e.mode,ZP5Views.importInitialCallback(e)):ZP5Views.importInitialCallback(e),updatedRecordsCallback:e=>e?(ZP5ImportSummaryCommon.loadDependentFiles(e.mode),e.mode,ZP5Views.importInitialCallback(e)):ZP5Views.importInitialCallback(e)};class TransferListViewImportHandler extends ImportV5Handler{constructor(e){super(e)}refreshCallback(){ZPViewsHolder.getCurrViewHandler().handlerSpecificReset(),ZP5Views.isTabChanged=!0,TransferListView.initialCallBack()}closeCallback(){return!1}getFormId(){return ZPViewsHolder.getCurrViewHandler().getFormId()}getTemplateIdOrViewId(){return ZPViewsHolder.getCurrViewHandler().getViewId()}uploadDefActionCallback(){this.hideBasedOnSelectDiv()}getModalHeader(){return"Transfer Import"}getTableName(){return"P_EmployeeTransfer"}downloadTemplateAdditionalCallback(e){e.append('<input type="hidden" value="'+this.getTemplateIdOrViewId()+'" name="templateId"/>')}uploadSetParamsCallback(e){this.uploadSetParamsFormBasedCallback(e),0==e.find("input[name=templateId]").length&&e.append('<input type="hidden" value="" name="templateId"/>'),e.find("[name=templateId]").val(this.getTemplateIdOrViewId())}setExtraParamsCallback(e){e.templateId=this.getTemplateIdOrViewId()}isFileDataPaginationNeeded(){return!1}initAdditionalParamsCallback(e){e.templateId=this.getTemplateIdOrViewId()}setMappingsFileDataExtraParams(e){e.templateId=this.getTemplateIdOrViewId()}}class OrganizationFormsImportV5Handler extends ImportV5Handler{constructor(e){super(e)}getFormId(){let e="";switch(this.mode){case"setting_department":e="department";break;case"setting_designation":e="designation"}return orgSetupForms.classObj[e]?orgSetupForms.classObj[e].formId:settingsUrlProps.urlParamsArr.formId}refreshCallback(){orgSetupForms.needRefresh=!0,orgSetupForms.callback()}isLocationTrackingEnabled(){return!1}hashChangeCallback(e){return!1}}class CandidateImportV5Handler extends ImportV5Handler{constructor(e){super(e)}getFormId(){return NewZPPreboarding.candidateFormId}refreshCallback(){OnboardingListing.reloadData()}}var ZP5Export={CURR_EXPO_OBJ:void 0,getCurrExportObj:()=>ZP5Export.CURR_EXPO_OBJ,getCurrContainer:()=>ZP5Export.getCurrExportObj().container,responseHandler:e=>{e.isSuccess&&e.isScheduled?ZPeople.Message.success(ZPI18N.getString("zp.ExportScheduled")):e.UnConfirmedAccount?ZPeople.Message.warning(ZPI18N.getString("zp.shorttextunconfirmed",["ZPeople.sendIAMConfirmation()"])):e.RestrictMobileUser?ZPeople.Message.warning(ZPI18N.getString("zp.mobileUsersInvalidOperation")):!e.isSuccess&&e.hasOwnProperty("message")?ZPeople.Message.failure(e.message):ZPeople.Message.failure(ZPI18N.getString("zp.sorryservererror"))},init:function(e,t){ZP5Export.CURR_EXPO_OBJ=new ExportV5(e,t),ZP5Export.CURR_EXPO_OBJ.init()}};class ExportV5{constructor(e,t){this.mode=e,this.handler=ZP5ExportCommon.getHandler(e),this.props=t,this.submitCallback="",t&&t.submitCallback&&ZPUtil.Validation.isFunction(t.submitCallback)&&(this.submitCallback=t.submitCallback),this.moduleSysViewCallback="",t&&t.moduleSysViewCallback&&(this.moduleSysViewCallback=t.moduleSysViewCallback)}getMode(){return this.mode}is(e){return this.mode===e}getProps(){return this.props}getHandler(){return this.handler}getFileTypeText(e){switch(e){case"xls":return ZPI18N.getString("zp.xls");case"xlsx":return ZPI18N.getString("zp.xlsx");case"csv":return ZPI18N.getString("zp.csv");case"tsv":return ZPI18N.getString("zp.tsv");case"pdf":return ZPI18N.getString("zp.pdf");case"ics":return"ICS"}return e||""}openModal(){this.Modal=new popupModal(ZPI18N.getString("zp.export"),new Tab("ZP5Export",this.constructModal.bind(this),this.submit.bind(this))),this.Modal.save=ZPI18N.getString("zp.export"),this.Modal.construct(),this.Modal.setCloseCallback(this.closeModal.bind(this))}init(){this.openModal(),!0===this.getHandler().init()&&(this.container.find("[name=exportFileType]:first").prop("checked",!0),this.container.find("#exportIncludeUsersDiv, #exportIncludeTabularDataDiv, #exportIncludeAttachmentsDiv").find("input").prop("checked",!1),this.getHandler().additionalCallback(this.container.find("[elem=exportPopupDiv] [elem=exportAdditionalContainer]"),this.getProps()),this.container.find("#loadingDiv").remove(),this.container.find("[elem=modalBodyContainer] [elem=exportPopupDiv]").removeClass("DNI"),this.container.find("#sliderSbt").removeClass("disabled").prop("disabled",!1))}constructModal(e){this.container=e.sliderDiv,0==this.container.find("#cardZP5Export").children().length&&(this.container.find("#cardZP5Export").html('<div class="zpl_crd"><div class="zpl_crdcnt" elem="modalBodyContainer"><div id="loadingDiv">'+ZPeople.LOADING_HTML+'</div><div elem="exportPopupDiv" class="DNI"></div></div></div>'),this.container.find("#cardZP5Export [elem=exportPopupDiv]").html(this.getModalBody()),this.container.find("#sliderSbt").addClass("disabled").prop("disabled",!0))}getModalBody(){let e='<div class="zpl_Emptydata" elem="exportContainer">';e+='<div class="zpl_mdexprtimg smll"></div><h4 elem="exportHeader">'+ZPI18N.getString("zp.choosefileformat")+"</h4>",e+='<div elem="fileTypeDiv" class="zpl_secn"><div><div>';let t=this.getHandler().getFileFormats();for(i=0;i<t.length;i++){let r=t[i];e+=this.getFileTypeOption(r,this.getFileTypeText(r))}return e+="</div>",e+="</div></div></div>",e+='<div class="zpl_secn" >',this.getHandler().isIncludeUsersDiv()&&(e+='<div id="exportIncludeUsersDiv"><div class="zcheckbox"><input type="checkbox" name="includeusers" id="exportIncludeUsers" class="zcheckbox__helper"><label class="zcheckbox__label" for="exportIncludeUsers"><span class="zcheckbox__text" id="exportIncludeUsers_label">'+this.getHandler().getUserDivLabel()+"</span></label></div></div>"),this.getHandler().hasTabularSections()&&(e+='<div id="exportIncludeTabularDataDiv"><div class="zcheckbox"><input type="checkbox" name="includeTabularData" id="exportIncludeTabularData" class="zcheckbox__helper"><label class="zcheckbox__label" for="exportIncludeTabularData"><span class="zcheckbox__text" id="exportIncludeTabularData_label">'+this.getHandler().getTabularlabel()+"</span></label></div></div>",e+='<div class="zpl_secn DNI" id="exportSheetTypeDiv"><div><div class="zradiobutton zradiobutton--horizontal"><input type="radio" id="exportSheetTypeSingle" value="single" name="exportSheetType" class="zradiobutton__helper"><label for="exportSheetTypeSingle" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.singlefile")+"</span></label></div>",e+='<div class="zradiobutton zradiobutton--horizontal"><input checked type="radio" id="exportSheetTypeSeparate" value="separate" name="exportSheetType" class="zradiobutton__helper"><label for="exportSheetTypeSeparate" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.multiplefiles")+"</span></label></div></div></div>"),this.getHandler().hasFileAttachments()&&(e+='<div id="exportIncludeAttachmentsDiv"><div class="zcheckbox"><input type="checkbox" name="includeAttachments" id="exportIncludeAttachments" class="zcheckbox__helper"><label class="zcheckbox__label" for="exportIncludeAttachments"><span class="zcheckbox__text">'+ZPI18N.getString("zp.includeAttachements")+"</span></label></div></div>"),this.getHandler().isApprovalEnabled()&&(e+='<div id="exportIncludeApproverDtlsDiv"><div class="zcheckbox"><input type="checkbox" name="includeApproverDtls" id="exportIncludeApproverDtls" class="zcheckbox__helper"><label class="zcheckbox__label" for="exportIncludeApproverDtls"><span class="zcheckbox__text">'+ZPI18N.getString("zp.exportinclappr")+"</span></label></div></div>"),e+="</div>",e+='<div elem="exportAdditionalContainer" class="DNI"></div>',this.is("auditHistory")&&(e+='<div class="zpl_secn" id="exportHistoryDataCalDiv"> <div id="exportHistoryDataDateRangePicker" data-for-element="#exportHistoryDataDateRangeDiv"></div> <div> <h5>'+ZPI18N.getString("zp.fromtodate")+"</h5> </div>",e+='<div> <div class="ztextbox--group zh-alignright"><i class="ztextbox__icon PI_calendar"></i><input id="exportHistoryDataDateRangeDiv" class="ztextbox"></div> <span elem="errorMsg" class="ztextbox--error__label"></span> </div> </div>'),this.getHandler().isNoteDivNeeded()&&(e+=this._getNoteDivHTML(this.getHandler().getNoteDivContent())),e}getFileTypeOption(e,t){return`<div class="zradiobutton zradiobutton--horizontal" elem="fileTypeRadio"><input type="radio" id="exportFileType${e}" value="${e}" name="exportFileType" class="zradiobutton__helper"><label for="exportFileType${e}" class="zradiobutton__label"><span class="zradiobutton__text">${t}</span></label></div>`}closeModal(){this.getHandler().closeCallback(),this.Modal.remove(),ZP5Export.CURR_EXPO_OBJ=null,delete ZP5Export.CURR_EXPO_OBJ}getSelFileType(){let e=this.container.find("[name=exportFileType]:checked").val(),t=this.getHandler().getFileFormats();return void 0!==e&&""!==e.trim()||(e=ZPUtil.checkValueInArray(t,e,t[0])),e}_getNoteDivHTML(e){let t="";return t+='<div class="zpl_secn" elem="exportHelpInfoContainer">',t+="<div>",t+='<div class="zpl_info" elem="exportHelpInfo">',t+='<h6 elem="helpInfoHeader"><b>'+ZPI18N.getString("zp.note")+"<b>:</h6>",t+="<p>"+e+"</p>",t+="</div>",t+="</div>",t+="</div>",t}submit(){this.container.find("#sliderSbt").addClass("disabled").prop("disabled",!0);let e={},t=this.getSelFileType();this.getHandler().validate(this.container,e,t)&&(ZPUtil.Validation.isFunction(this.submitCallback)?this.submitCallback(this.container,e,t,this.getMode()):this.getHandler().submit(this.container,e,t,this.getMode()),this.closeModal())}}class ExportV5Handler{constructor(e){this.mode=e}getMode(){return this.mode}isApprovalEnabled(){return!1}hasTabularSections(){return!1}showSheetType(){return!1}getTabularlabel(){return ZPI18N.getString("zp.includetabulardata")}hasFileAttachments(){return!1}isPasswordProtected(){return!1}getAllowedFormats(){return new Array("xls","xlsx","csv","tsv")}getFileFormats(){return this.isPasswordProtected()?this.getPassWordProtectedFileFormats():this.getAllowedFormats()}getPassWordProtectedFileFormats(){return new Array("xlsx")}isIncludeUsersDiv(){return!1}isNoteDivNeeded(){return!1}getNoteDivContent(){return ZPI18N.getString("zp.userexportadditionalinfo")}getUserDivLabel(){return ZPI18N.getString("zp.includeassignees")}additionalCallback(){return!0}init(){return!0}getFormId(){let e;return ZP5Views.getCurrViewObj()&&(e=ZP5Views.getCurrViewObj().getFormId()),e}getViewId(){let e;return ZP5Views.getCurrViewObj()&&(e=ZP5Views.getCurrViewObj().getViewId()),e}validate(){return!0}formBasedSubmit(e,t,i,r){urlFormConf.isForm()&&(t.viewID=this.getViewId(),t.isSingleSheetExport=this.showSheetType()&&"single"==e.find("[name=exportSheetType]:checked").val(),t.includeTabular=e.find("#exportIncludeTabularData").prop("checked"),t.includeFiles=e.find("#exportIncludeAttachments").prop("checked"),t.includeApproval=e.find("#exportIncludeApproverDtls").prop("checked"),this.setViewBasedParams(t)),t.ftype=i,t[csrfParamName]=csrfToken,this.setParams(e,t),FrameworkCommon.getHTMLFormDataObj("zp_export_form","ExportData.zp","post","exportresp",t).submit()}moduleBasedSubmit(e,t,i,r){ZPUtil.Validation.isFunction(ZP5Export.CURR_EXPO_OBJ.moduleSysViewCallback)?ZP5Export.CURR_EXPO_OBJ.moduleSysViewCallback(e,t,i,r):ZPComponents.SystemView.exportData()}submit(e,t,i,r){urlFormConf.isModuleForm()&&ZP5Views.isSystemView()&&!ZP5Views.isApproverView()?this.moduleBasedSubmit(e,t,i,r):this.formBasedSubmit(e,t,i,r)}setParams(e,t){return!0}closeCallback(){}setViewBasedParams(e){let t,i,r,s,a,n;ZP5Views.getCurrViewObj()&&({approvalStatus:t,employeeStatus:i,typeOfView:r,searchBy:s,orgStructureFilter:a,searchUserId:n}=ZP5Views.getCurrViewObj().getAllParams(!0)),e.approvalStatus=this.getApprovalStatus(t),e.employeeStatus=this.getEmployeeStatus(i),e.typeOfView=this.getTypeOfView(r),this.setSearchByParams(e,s),this.setOrgStructureFilterParams(e,a),this.setSearchUserIdParams(e,n)}getTypeOfView(e){return null==e&&(e="all",settingsUrlProps.urlParamsArr.hasOwnProperty("typeOfView")?e=settingsUrlProps.urlParamsArr.typeOfView:settingsPage.container.find("#viewActionsContainer").find("#viewType").length>0&&(e=ZPeopleComponents.select(settingsPage.container.find("#viewActionsContainer").find("#viewType")).getValue())),e}getEmployeeStatus(e){return null==e&&(e="activeemprecord",settingsUrlProps.urlParamsArr.hasOwnProperty("empstatus")?e=settingsUrlProps.urlParamsArr.empstatus:$.inArray(ZP5Form.getCurrFormsOperation().getTableName(),["P_EmployeeLeave","P_TimesheetJob","P_TimesheetJobsList","P_ClientDetails","P_Resignation","P_Termination","P_Deceased"])>-1&&(e="all")),e}getApprovalStatus(e){return null==e&&(e="all",settingsUrlProps.urlParamsArr.hasOwnProperty("approvalStatus")&&(e=settingsUrlProps.urlParamsArr.approvalStatus)),e}setSearchByParams(e,t){null==t?settingsUrlProps.urlParamsArr.hasOwnProperty("searchBy")&&(e.searchBy=settingsUrlProps.urlParamsArr.searchBy):e.searchBy=t}setOrgStructureFilterParams(e,t){null==t?settingsUrlProps.urlParamsArr.hasOwnProperty("orgStructureFilter")&&(e.orgStructureFilter=settingsUrlProps.urlParamsArr.orgStructureFilter):e.orgStructureFilter=t}setSearchUserIdParams(e,t){null==t?settingsUrlProps.urlParamsArr.hasOwnProperty("searchUserId")&&(e.searchUserId=settingsUrlProps.urlParamsArr.searchUserId):e.searchUserId=t}}class FormsExportV5Handler extends ExportV5Handler{constructor(){super("form")}isApprovalEnabled(){return!(!urlFormConf.isForm()||urlFormConf.isModuleForm()||!ZP5Form.isApprovalEnabled(this.getFormId()))}hasTabularSections(){return ZP5Views.getCurrViewObj().getFormProperty("hasTabularSection")}showSheetType(){return!0}hasFileAttachments(){return urlFormConf.isForm()&&ZP5Views.getCurrViewObj()&&ZP5Views.getCurrViewObj().hasOwnProperty("isFileAvailable")&&ZP5Views.getCurrViewObj().isFileAvailable}isPasswordProtected(){return ZP5Views.getCurrViewObj()&&ZP5Views.getCurrViewObj().getFormProperty("isPasswordProtected")}getPassWordProtectedFileFormats(){return new Array("xlsx")}getAllowedFormats(){return new Array("xls","xlsx","csv","tsv")}init(){return this.hasTabularSections()&&ZP5Export.getCurrContainer().find("#exportIncludeTabularDataDiv input").off().on("change",(function(){$(this).prop("checked")?(ZP5Export.getCurrContainer().find("input[value='separate']").prop("checked","checked"),ZP5Export.getCurrContainer().find("#exportSheetTypeDiv").removeClass("DNI")):ZP5Export.getCurrContainer().find("#exportSheetTypeDiv").addClass("DNI")})),!0}}class HistoryExportV5Handler extends ExportV5Handler{constructor(){super("auditHistory")}init(){let e="#exportHistoryDataDateRangePicker";return ZPeopleComponents.daterangepicker(e,{change:(e,t)=>{ZP5Export.getCurrContainer().find("#exportHistoryDataDateRangeDiv").val(t.fromValueString+"-"+t.toValueString)},format:dateFmt,appendTo:"body"}),ZP5Export.getCurrContainer().find("#exportHistoryDataDateRangeDiv").off("click").on("click",(function(){$(e).is(":visible")?ZPeopleComponents.daterangepicker(e).close():ZPeopleComponents.daterangepicker(e).open()})),!0}isPasswordProtected(){return ZP5Views.getCurrViewObj()&&ZP5Views.getCurrViewObj().getFormProperty("isPasswordProtected")}getPassWordProtectedFileFormats(){return new Array("xlsx")}getAllowedFormats(){return new Array("xls","xlsx","csv","tsv")}validate(e,t){let i,r,s=e.find("#exportHistoryDataDateRangeDiv").val();if(!ZPSetupCommon.isEmpty(s)){let a=t=>{e.find("[elem=exportHistoryDataDateRangeDiv]").addClass("ztextbox__error"),e.find("[elem=exportHistoryDataDateRangeDiv]").find("[elem=errorMsg]").html(t),FrameworkCommon.show(e.find("[elem=exportHistoryDataDateRangeDiv]").find("[elem=errorMsg]")),e.find("#sliderSbt").removeClass("disabled").prop("disabled",!1)},n=s.split("-");if(-1==uidateFormat.indexOf("-")?(i=n[0],r=1==n.length?void 0:n[1]):(i=n[0]+"-"+n[1]+"-"+n[2],r=n.length<=3?void 0:n[3]+"-"+n[4]+"-"+n[5]),!ZPSetupCommon.isEmpty(i)&&!ZPUtil.Validation.isDate(i))return a(ZPI18N.getString("zp.invalidfromdate")),!1;if(t.fromDate=i,!ZPSetupCommon.isEmpty(r)&&!ZPUtil.Validation.isDate(r))return a(ZPI18N.getString("zp.invalidtodate")),!1;if(t.toDate=r,!ZPSetupCommon.isEmpty(i)&&!ZPSetupCommon.isEmpty(r)&&(i=new Date(Calendar.parseDate(i,uidateFormat)),r=new Date(Calendar.parseDate(r,uidateFormat)),r.getTime()<i.getTime()))return a(ZPI18N.getString("zp.fromDateToDateerror")),!1}return!0}submit(e,t,i,r){let s={ftype:i,formID:this.getFormId()+"",viewID:this.getViewId()+"",typeOfView:this.getTypeOfView(),approvalStatus:this.getApprovalStatus(),employeeStatus:this.getEmployeeStatus()};ZPUtil.Validation.isEmpty(t.fromDate)||(s.from=t.fromDate),ZPUtil.Validation.isEmpty(t.toDate)||(s.to=t.toDate),FrameworkCommon.getHTMLFormDataObj("zp_history_export_form","HistoryExportData.zp","post",void 0,s).submit()}closeCallback(){$("#exportHistoryDataDateRangePicker").remove()}}const ZP5ExportCommon={getHandler:e=>{switch(e){case"profile":case"users":return new UsersExportV5Handler(e);case"stream":return new StreamsExportV5Handler(e);case"location":return new LocationsExportV5Handler(e);case"auditHistory":return new HistoryExportV5Handler(e);case"pareports":return new PAReportExportHandler(e);case"transfer":return new TransferExportV5Handler(e);case"activityLog":return new ActivityLogExportV5Handler(e);case"form12Report":return new Form12ReportV5Handler(e);case"client":case"job":case"project":case"jsExport":case"tt_report_fields":case"timeLogLeaveReport":case"tt_reports":case"DateBasedPayrollReport":case"salary":case"HrCase":case"officereadiness":case"vaccinationstatus":case"timelog":case"timesheet":case"compensatory":case"holiday":case"czbalance":case"grant":case"employeeShiftMapping":case"attendanceEntries":case"attendance":case"attendanceReports":case"ftp":case"leavetracker":case"leavetracker_ICS":case"leaveReports":case"leaveReports_hideEmpFields":case"initialbalance":case"empsalary":case"salaryrevision":case"compreports":case"lms":case"shiftDetails":case"okr":case"appointment":return new ModuleExportV5Handler(e)}return new FormsExportV5Handler("form")}};class ModuleExportV5Handler extends ExportV5Handler{constructor(e){super(e)}isIncludeUsersDiv(){if(ZP5Views.isSystemView())switch(ZP5Export.getCurrExportObj().getMode()){case"timelog":return Timetracker.isDataAdminForAllUsers();case"attendanceEntries":return Att_Common_Operations.isAllEntriesAllowed();case"project":case"job":return!0}return!1}getUserDivLabel(){switch(ZP5Export.getCurrExportObj().getMode()){case"job":return ZPI18N.getString("zp.includeassignees");case"timelog":return ZPI18N.getString("zp.includealluser");case"attendanceEntries":return ZPI18N.getString("zp.includeallentries");case"employeeShiftMapping":return ZPI18N.getString("zp.incempfields")}return ZPI18N.getString("zp.includeusers")}hasTabularSections(){switch(ZP5Export.getCurrExportObj().getMode()){case"project":return Timetracker.projects.formDetails.hasTabularSection;case"job":return Timetracker.jobs.formDetails.hasTabularSection;case"salary":return!0}return!1}hasFileAttachments(){if(!ZP5Views.isSystemView())switch(ZP5Export.getCurrExportObj().getMode()){case"project":return Timetracker.projects.formDetails.isFileAvailable;case"job":return Timetracker.jobs.formDetails.isFileAvailable}return!1}getTableName(){switch(ZP5Export.getCurrExportObj().getMode()){case"client":return"P_ClientDetails";case"project":return"P_TimesheetJobsList";case"job":return"P_TimesheetJob"}}getPassWordProtectedFileFormats(){switch(ZP5Export.getCurrExportObj().getMode()){case"employeeShiftMapping":case"attendanceEntries":case"attendance":case"attendanceReports":return this.getAllowedFormats()}return new Array("xlsx")}getAllowedFormats(){var e=ZP5Export.getCurrExportObj().getMode();let t=[],r=new Array("xls","xlsx","csv","tsv");"leavetracker"==e||"holiday"==e||"leavetracker_ICS"==e?r.push("ics"):"attendanceReports"!=e&&"shiftDetails"!=e||!ZP5Export.getCurrExportObj().props.isPdf||r.push("pdf");let s=this.getRestrictedFormats();for(i=0;i<r.length;i++)-1==$.inArray(r[i],s)&&t.push(r[i]);return t}getRestrictedFormats(){switch(ZP5Export.getCurrExportObj().getMode()){case"HrCase":case"transfer":case"officereadiness":case"vaccinationstatus":case"employeeShiftMapping":case"ftp":case"attendanceEntries":case"attendance":case"shiftDetails":return new Array("tsv");case"attendanceReports":return ZP5Export.getCurrExportObj().props.isPdf?new Array("xlsx","tsv","xls","csv"):new Array("tsv");case"timesheet":case"holiday":return new Array("csv","tsv");case"timeLogLeaveReport":return new Array("xlsx","tsv");case"leavetracker":return new Array("ics");case"empsalary":case"salaryrevision":return new Array("xls","csv","tsv")}return new Array}isPasswordProtected(){return"leavetracker"==ZPeople.Module.getModuleKey()||"leavetracker"==this.getMode()||"leavetracker_ICS"==this.getMode()?ZPeople.Module.getData("leavetracker").formConf.isPasswordProtected:"attendance"==ZPeople.Module.getModuleKey()?ZPeople.Module.getData("attendance").isExportPwdProtected:"attendanceReports"==ZP5Export.getCurrExportObj().getMode()?ZPLite.Reports.moduleData.attendance.isExportPwdProtected:$.inArray(ZP5Export.getCurrExportObj().getMode(),["client","project","job"])>-1?!ZP5Views.isSystemView()&&ZPeople.Module.getData().formDetailsMap.isPasswordProtected:"empsalary"==this.getMode()||"salaryrevision"==this.getMode()}additionalCallback(e,t){var i=this.getMode();"timelog"==i||"tt_report_fields"==i||"timeLogLeaveReport"==i||"jsExport"==i||"compreports"==i?t.optns&&t.optns.additionalHtml&&(e.append(t.optns.additionalHtml),e.removeClass("DNI")):"compensatory"==i||"czbalance"==i||"grant"==i||"leaveReports"==i?(LeaveAdminOpers.Util.getAddlExpContainer(e),e.removeClass("DNI")):"empsalary"==this.getMode()||"salaryrevision"==this.getMode()?(t.additionalHtmlCallback(e,t),e.removeClass("DNI")):("employeeShiftMapping"==i||"attendanceReports"==i)&&ZP5Export.getCurrContainer().find("[elem='exportPopupDiv']").append(t.additionalHtml)}}class UsersExportV5Handler extends ExportV5Handler{constructor(e){super(e)}isPasswordProtected(){return User.pwdProtCheck}init(){return!0}isNoteDivNeeded(){return!0}setParams(e,t){t.modeCheck="users"==ZP5Export.getCurrExportObj().getMode()?"user":"profile";let i=Users.common.getCurrentPageId(),r=Users.operations.view.getParamsFromFilter(!1,i),s=r.hasOwnProperty("searchval")?r.searchval:"",a=r.hasOwnProperty("searchType")?r.searchType:0,n=null,o=null;"All Status"!==r.userStatus&&(n=r.userStatus),""!==r.searchByEmpStatus&&"All Status"!==r.searchByEmpStatus&&(o=r.searchByEmpStatus);let l=0!=r.searchByRole?r.searchByRole:null,d=0!=r.searchByLoc?r.searchByLoc:null,p=0!=r.searchByDept?r.searchByDept:null;t.viewID=Users.config.viewId,t.typeOfView=isadmin?"all":"",null!=n&&n.length>0&&(t.userStatus=n),null!=o&&o.length>0&&(t.Employeestatus=o,t.Employeestatus_op="28"),null!=l&&l.length>0&&(t.roleVal=l),null!=d&&d.length>0&&(t.locationVal=d),null!=p&&p.length>0&&(t.deptVal=p),null!=s&&s.length>0&&(t.searchVal=s),t.searchType=a}}class LocationsExportV5Handler extends ExportV5Handler{constructor(){super("location")}setParams(e,t){t.modeCheck="location",t.searchType="0",t.viewID=Locations.NewSetting.locationsViewId,Locations.NewSetting.setExportExtraParams(t)}}class StreamsExportV5Handler extends ExportV5Handler{constructor(){super("stream")}setParams(e,t){t.modeCheck="stream",t.searchType="0",t.viewID=StreamsNew.viewId,StreamsNew.Filter.alterParamsForExport(t)}}class TransferExportV5Handler extends ExportV5Handler{constructor(){super("transfer")}setParams(e,t){t.viewID=ZPViewsHolder.getCurrViewHandler().getViewId(),t.typeOfView=ZPViewsHolder.getCurrViewHandler().getTypeOfView()}}class ActivityLogExportV5Handler extends ExportV5Handler{constructor(){super("activityLog")}getAllowedFormats(){return new Array("csv")}isNoteDivNeeded(){return!0}getNoteDivContent(){return ZPI18N.getString("zp.activitylogexportadditionalinfo")}init(){return ZP5Export.getCurrContainer().find("[elem=exportHeader]").html("CSV"),FrameworkCommon.hide(ZP5Export.getCurrContainer().find("[elem=fileTypeDiv]")),!0}submit(e,t,i,r){let s={fileType:i,conreqcsr:csrfToken};ZP5ActivityLog.setFilterOptions(s),ZPeople.Request.sendRequestWithVersion("/dataadministration/exportActivityLog",s,"POST",((e,t,i)=>{if(e&&e.hasOwnProperty("isSuccess")&&e.isSuccess&&e.msg)ZPeople.Message.success(e.msg);else{let t=e.msg?e.msg:ZPI18N.getString("zp.reports.defaulterrormessage");ZPeople.Message.warning(t)}}),{},((e,t,i)=>{ZPeople.Message.failure(ZPI18N.getString("zp.reports.defaulterrormessage"))}))}}class Form12ReportV5Handler extends ExportV5Handler{constructor(){super("form12Report")}getAllowedFormats(){return new Array("csv")}isNoteDivNeeded(){return!0}getNoteDivContent(){return ZPeople.FireScroll.getRecordCount()<=200?ZPI18N.getString("zp.form12exportadditionalinfo1"):ZPI18N.getString("zp.form12exportadditionalinfo2")}init(){return ZP5Export.getCurrContainer().find("[elem=exportHeader]").html("Form 12 Report"),FrameworkCommon.hide(ZP5Export.getCurrContainer().find("[elem=fileTypeDiv]")),!0}additionalCallback(e){e.append('<input type="text" class="ztextbox" id="registrationNo" placeholder="Registration no:">'),FrameworkCommon.show(e)}submit(){let e=ZP5Export.getCurrContainer().find("[elem=exportAdditionalContainer] #registrationNo").val();if(ZPeople.FireScroll.getRecordCount()<=200){let t=$("#zp_export_form").html("");t.attr("action","v5/report/form12report/export"),t.attr("method","get"),t.append('<input type="hidden" value="'+csrfToken+'" name="'+csrfParamName+'"/>'),t.append('<input type="hidden" value="'+settingsUrlProps.urlParamsArr.type+'" name="type"/>'),t.append('<input type="hidden" value="'+e+'" name="registerNo"/>'),t.submit()}else{let t={conreqcsr:csrfToken,type:settingsUrlProps.urlParamsArr.type,isExport:!0,registerNo:e};ZPeople.Request.sendRequestWithVersion("/report/form12report/export",t,"GET",((e,t,i)=>{e&&e.msg?ZPeople.Message.success(e.msg):ZPeople.Message.warning(ZPI18N.getString("zp.reports.defaulterrormessage"))}),{},(e=>{ZPeople.Message.failure(ZPI18N.getString("zp.reports.defaulterrormessage"))}))}}}var zp5MassUpdate={formId:void 0,url:"/massUpdate.zp",params:{},callback:"",firstFieldId:void 0,fieldDetails:void 0,fields:[],FORM_COMPONENTS:{},fieldCount:0,sliderProps:{hdrName:ZPI18N.getString("zp.massupdate"),isSubmitBtnNeeded:!0,id:"massUpdateSlider",cardId:"massUpdateSliderCard"},addLinkHtml:'<tr name="addnewlink"><td colspan="4"><a class="btn btn-link ML5" id="addnewLnk" onclick="zp5MassUpdate.listBulkUpdateFields(null,null,true)"><span class="IC-add MR5 S12"></span>'+ZPI18N.getString("zp.addnew")+"</a></td></tr>",infoToolTipObj:void 0,container:void 0,getModuleHandler:e=>{switch(e){case"P_Employee":return new EmployeeMassUpdateHandler;case"P_Candidate":return new OnboardingMassUpdateHandler;case"P_Goals":return new GoalsMassUpdateHandler;case"P_EmployeeSalary":return new EmplyeeSalaryMassUpdateHandler}return new MassUpdateModuleHandler},massUpdateFields:function(e,t){zp5MassUpdate.constructModal(),zp5MassUpdate.loadHandler(e,t),null==ZP5Form.getFormsOperation(zp5MassUpdate.formId).getFormComponentData()?ZPeople.Request.send(ZP5Form.URL,{formId:zp5MassUpdate.formId,mode:"getFormComponents"},(e=>{zp5MassUpdate.setFormComponentData(e),zp5MassUpdate.getMassUpdateFields()})):zp5MassUpdate.getMassUpdateFields()},loadHandler:(e,t)=>{zp5MassUpdate.formId=e,zp5MassUpdate.tableName=t,zp5MassUpdate.moduleHandler=zp5MassUpdate.getModuleHandler(t)},getMassUpdateFields:()=>{zp5MassUpdate.setFormComponentData(ZP5Form.getFormsOperation(zp5MassUpdate.formId).getFormComponentData());let e=ZP5Form.getFormsOperation(zp5MassUpdate.formId).isLocationTrackingEnabled(),t={ele:zp5MassUpdate,isLocationTrackingEnabled:e};e?FrameworkCommon.Location.fetch(zp5MassUpdate.massUpdateFieldsGeo,t):zp5MassUpdate.massUpdateFieldsGeo(t)},massUpdateFieldsGeo:function(e,t){let{ele:i,isLocationTrackingEnabled:r}=e;if(i.formId=zp5MassUpdate.formId,!r||t&&t.isPermEnabled)i.params={formid:i.formId,mode:"list"},i.callback=i.requestCallback,ZPeople.Request.send(i.url,i.params,i.callback,void 0,(e=>{zp5MassUpdate.loadingObj.remove(),zp5MassUpdate.container.find("#sliderCancel,#sliderCls").removeClass("zpl_DNI"),zp5MassUpdate.container.find("#sliderSbt").remove();let t=ZP5Form.NO_DATA.SERVER_ERROR;null!=e&&e.responseText.indexOf("IAM_SECURITY_ERROR")>-1&&(t=ZP5Form.NO_DATA.NO_PERMISSION),ZP5Form.showNoData(void 0,t,zp5MassUpdate.container.find("#"+zp5MassUpdate.sliderProps.cardId))}));else{let e={isSuccess:!1,message:"LOCATION_DISABLED"};zp5MassUpdate.requestCallback(e)}},constructModal:function(){zp5MassUpdate.sliderModalObj=new sliderModal(ZPI18N.getString("zp.massupdate"),zp5MassUpdate.sliderProps),zp5MassUpdate.sliderModalObj.setContainerAsBody(!0),zp5MassUpdate.sliderModalObj.save=ZPI18N.getString("zp.saveandupdate"),zp5MassUpdate.sliderModalObj.setCloseCallback(zp5MassUpdate.callOnCloseFunc),zp5MassUpdate.sliderProps.validate=zp5MassUpdate.submitMassUpdate,zp5MassUpdate.sliderProps.callback=()=>{zp5MassUpdate.container=$("body").find("#"+zp5MassUpdate.sliderProps.id),zp5MassUpdate.container.addClass("zpl_massupt-fld"),zp5MassUpdate.container.find("#sliderCls,#sliderSbt,#sliderCancel").addClass("zpl_DNI"),zp5MassUpdate.loadingObj=new LoadingClass(zp5MassUpdate.container.find("#"+zp5MassUpdate.sliderProps.cardId)),zp5MassUpdate.loadingObj.add()},zp5MassUpdate.sliderModalObj.construct()},setFormComponentData:function(e){e.iCache=!0,ZP5Form.getFormsOperation(zp5MassUpdate.formId).updateFormConf(e.formDetails),ZP5Form.formatFields(e.message,void 0,void 0,void 0,zp5MassUpdate.formId),ZP5Form.getFormsOperation(zp5MassUpdate.formId).setFormComponentData(e),zp5MassUpdate.FORM_COMPONENTS=ZP5Form.populateFields(e.message)},requestCallback:function(e){if(zp5MassUpdate.loadingObj.remove(),zp5MassUpdate.container.find("#sliderCancel,#sliderCls").removeClass("zpl_DNI"),e.isSuccess)zp5MassUpdate.fieldCount=0,zp5MassUpdate.fieldDetails=e,zp5MassUpdate.fields=[],$.each(zp5MassUpdate.fieldDetails.sections,(function(e,t){$.each(t.fields,(function(e,i){zp5MassUpdate.fields.push({text:decodeHTML(i.displayName),id:i.fcId,groupName:decodeHTML(t.displayName)})}))})),zp5MassUpdate.massUpdateBdyCnstrctr(),zp5MassUpdate.container.find("#sliderSbt").removeClass("zpl_DNI");else{let t=ZP5Form.NO_DATA.SERVER_ERROR;"NOFIELDS"==e.message?t=ZP5Form.NO_DATA.NO_EDITABLE_FIELDS:"LOCATION_DISABLED"==e.message&&(t=ZP5Form.NO_DATA.LOCATION_DISABLED),zp5MassUpdate.container.find("#sliderSbt").remove(),ZP5Form.showNoData(void 0,t,zp5MassUpdate.container.find("#"+zp5MassUpdate.sliderProps.cardId))}},massUpdateBdyCnstrctr:function(){let e=zp5MassUpdate.container.find("#"+zp5MassUpdate.sliderProps.cardId),t=zp5MassUpdate.constructHeader();e.html("");let i=`<div class="zpl_secn"><div class="zpl_tblres"><table class="zpl_tbl zpl_tblvtop wd100_per zpl_nocrsor" id="massUpdateTable"><thead><tr><th width="40%">${ZPI18N.getString("zp.fieldname")}</th>\n\t\t\t\t\t<th width="50%">${ZPI18N.getString("zp.value")}</th><th></th></tr></thead><tbody elem="tblebdy"></tbody></table><div class="zpl_idiv" elem="addNewFieldMassUpdate">\n\t\t\t\t\t<a class="zpl_lnkbg" onclick="zp5MassUpdate.addNewField()"><i class="PI_plus"></i>${ZPI18N.getString("zp.addnew")}</a></div></div></div>`;zp5MassUpdate.LAYOUT=$('<form><div class="zpl_crd">'+t+'<div class="zpl_crdcnt" >'+i+"</div></div></form>"),e.html(zp5MassUpdate.LAYOUT),e.find('[elem="inpToggleWorkflow"]').length>0&&ZPeopleComponents.toggleswitch(e.find('[elem="inpToggleWorkflow"]')).switchOn(),e.find('[elem="inpToggleCv"]').length>0&&ZPeopleComponents.toggleswitch(e.find('[elem="inpToggleCv"]')).switchOn(),zp5MassUpdate.infoToolTipObj=new InfoToolTip,zp5MassUpdate.addNewField()},addNewField:function(){let e=zp5MassUpdate.getInitElementHtml();zp5MassUpdate.LAYOUT.find('[elem="tblebdy"]').append(e);let t=zp5MassUpdate.constructOptions({dataSourceNotNeed:!0});t.beforedropdownlistopen=zp5MassUpdate.constructOptionsForFieldNames,t.optionclick=zp5MassUpdate.optionClickCallback;let i=ZPeopleComponents.select(zp5MassUpdate.LAYOUT.find("#fieldRow_"+zp5MassUpdate.fieldCount).find("select[name='fieldName_"+zp5MassUpdate.fieldCount+"']")[0],t);i.setValue(zp5MassUpdate.getFirstField()),zp5MassUpdate.constructValueField(i,!1),zp5MassUpdate.updateButtons()},deleteCurField:function(e){let t=$(e.target).parents("tr"),i=t.find("[zpmassupdvalcol=true] [name^=fieldValue_]").attr("fcid");zp5MassUpdate.handleDependentFields(i),zp5MassUpdate.handleDeleteField(t)},handleDeleteField:e=>{zp5MassUpdate.destroyZComponents(e.find("td [name^=fieldName_]")),zp5MassUpdate.destroyZComponents(e.find("td [name^=fieldValue_]")),zp5MassUpdate.infoToolTipObj.destroyTooltips({id:e.find('[id^="infoTooltip_"]').attr("id"),isSpecific:!0}),e.remove(),zp5MassUpdate.updateButtons()}};zp5MassUpdate.handleDependentFields=e=>{let t=[];var i={};$.each(ZP5Form.getFormsOperation(zp5MassUpdate.formId).getFormComponentData().message.formComponentDetails,(function(){let t=this.column1;for(field in t)if(t[field].formComponentId==e)return i=t[field],!1;let r=this.column2;for(field in r)if(r[field].formComponentId==e)return i=r[field],!1})),null!=i.dependentFiledList&&i.dependentFiledList.length>0&&(t=i.dependentFiledList),ZP5Form.Field.Edit.getDependFieldMappingFields(e,t,zp5MassUpdate.formId),$.each(t,(function(e,t){$(zp5MassUpdate.LAYOUT).find("td[zpmassupdvalcol=true]").each((function(){$(this).find("[fcid="+t+"]").length>0&&zp5MassUpdate.handleDeleteField($(this).find("[fcid="+t+"]").parents("tr"))}))}))},zp5MassUpdate.submitMassUpdate=function(){var e=zp5MassUpdate.LAYOUT,t=[];if($.each(e.find('select[name^="fieldName_"]'),(function(e,i){t[e]=ZPeopleComponents.select(i).getValue()})),ZP5Form.isAllowedToEdit("EDIT",zp5MassUpdate.formId,t,!0)){var i="zp.editapprovalconfirmmsg";ZP5Form.getFormsOperation(zp5MassUpdate.formId).getApprovalSettingsDetails().isVerifySend&&(i="zp.editapprsendconfirmmsg");let e=new InfoAlertMessage(ZPI18N.getString("zp.confirm"),ZPI18N.getString(i));e.yesButtonText=ZPI18N.getString("zp.confirm"),e.setCallback((()=>{zp5MassUpdate.update()})),e.show()}else zp5MassUpdate.update()},zp5MassUpdate.callOnCloseFunc=function(){null!=zp5MassUpdate.LAYOUT&&$.each(zp5MassUpdate.LAYOUT.find("[zcomponentname]"),(function(e,t){zp5MassUpdate.destroyZComponents($(t))})),null!=zp5MassUpdate.infoToolTipObj&&zp5MassUpdate.infoToolTipObj.destroyTooltips(),$("#"+zp5MassUpdate.sliderProps.id).remove(),zp5MassUpdate.resetDetails()},zp5MassUpdate.optionClickCallback=function(e){let t=e.target;zp5MassUpdate.constructValueField(ZPeopleComponents.select(t),!1)},zp5MassUpdate.update=function(){var e=ZP5Form.getFormsOperation(zp5MassUpdate.formId).isLocationTrackingEnabled();let t={isLocationTrackingEnabled:e};e?FrameworkCommon.Location.fetch(zp5MassUpdate.updateGeo,t):zp5MassUpdate.updateGeo(t)},zp5MassUpdate.destroyZComponents=function(e){ZPUtil.Validation.isEmpty(e.attr("zcomponentname"))||ZPeopleComponents[e.attr("zcomponentname")](e).destroy()},zp5MassUpdate.resetDetails=function(){zp5MassUpdate.fieldCount=0,zp5MassUpdate.formId=void 0,zp5MassUpdate.params={},zp5MassUpdate.callback="",zp5MassUpdate.firstFieldId=void 0,zp5MassUpdate.fieldDetails=void 0,zp5MassUpdate.fields=[],zp5MassUpdate.sliderProps={hdrName:ZPI18N.getString("zp.massupdate"),isSubmitBtnNeeded:!0,id:"massUpdateSlider",cardId:"massUpdateSliderCard"},zp5MassUpdate.LAYOUT=void 0,zp5MassUpdate.sliderModalObj=void 0,zp5MassUpdate.infoToolTipObj=void 0},zp5MassUpdate.updateGeo=function(e,t){var i=zp5MassUpdate.LAYOUT,r=zp5MassUpdate.formId,s=zp5MassUpdate.moduleHandler.getPkIds(),a=[];let n=!1;zp5MassUpdate.selectedFieldIds=[],$("#"+zp5MassUpdate.sliderProps.id+" #sliderSbt").addClass("disabled"),$.each(i.find('select[name^="fieldName_"]'),(function(e,t){a[e]=ZPeopleComponents.select(t).getValue()}));let o=e.isLocationTrackingEnabled;if(e={formid:r,mode:"edit",fcIds:JSON.stringify(a),pkIds:JSON.stringify(s),loginUserZUID:_LOGGEDIN_ZUID},o){if(!t.isPermEnabled)return ZPeople.Message.failure(ZPI18N.getString("zp.enableaccesstolocation")),void $("#"+zp5MassUpdate.sliderProps.id+" #sliderSbt").removeClass("disabled");e.latitude=t.locData.latitude,e.longitude=t.locData.longitude,e.accuracy=t.locData.accuracy}if(i.find("[elem=inpToggleWorkflow]").length>0){ZPeopleComponents.toggleswitch(i.find("[elem=inpToggleWorkflow]")).getState()&&(e.isWfTrigger=!0)}i.find("[elem=inpToggleCv]").length>0&&(e.customValidationOn=ZPeopleComponents.toggleswitch(i.find("[elem=inpToggleCv]")).getState()),zp5MassUpdate.removeFieldError(),$.each(i.find("table#massUpdateTable tbody[elem='tblebdy']").find("tr[name='fieldRow']"),(function(t,i){if("fieldRow"===$(i).attr("name")){let t=$(i).attr("rowcnt"),d=ZPeopleComponents.select($(i).find("select[name='fieldName_"+t+"']"));var r=d.getValue();let p=zp5MassUpdate.FORM_COMPONENTS[r];var s=p.labelName,a=$(i).find("[name='fieldValue_"+t+"']");let m;var o=p.fieldType;m=zp5MassUpdate.getValueForFields(o,a,p);var l=$(i).find("td [name^=fieldValue_]");let c=!1;"true"===d.element.attr("isMandatory")&&(c="select"==l.attr("zcomponentname")&&"-Select-"==m?ZPUtil.Validation.isEmpty(m):o==FormConstants.FieldType.CHECK_BOX?!m:ZPUtil.Validation.isEmpty(m)),c?(zp5MassUpdate.constructFieldError(ZPI18N.getString("zp.mandatoryfield",new Array(s)),l,o,!0),n=!0):o!=FormConstants.FieldType.EMAIL_ADDRESS||ZPUtil.Validation.isEmpty(m)||ZPUtil.Validation.isEmail(m)?(m=o==FormConstants.FieldType.DATE_TIME?Calendar.convertHourFormat(m):m,e[s]=m):(zp5MassUpdate.constructFieldError(ZPI18N.getString("zp.validemail",new Array(s)),l,o,!0),n=!0),zp5MassUpdate.selectedFieldIds.push(r)}})),n?$("#"+zp5MassUpdate.sliderProps.id+" #sliderSbt").removeClass("disabled"):(e.isPicklistIdEnabled=!0,ZPeople.Request.send("/massUpdate.zp",e,zp5MassUpdate.handleResponseOfBulkUpdate))},zp5MassUpdate.getValueForFields=function(e,t,i){if(e===FormConstants.FieldType.PICKLIST||e==FormConstants.FieldType.LOOKUP&&!ZPeople.isZPNewUI()||e===FormConstants.FieldType.BLOODGROUP||e===FormConstants.FieldType.GENDER||e===FormConstants.FieldType.COUNTRY){let r=ZPeopleComponents.select(t).getValue();return""==r||"-Select-"==r||e!=FormConstants.FieldType.PICKLIST||i.isEmpStatus||(r=ZP5Form.getSelectOptionsAttr(t,!1,"optid",[r])[0]),r}if(e===FormConstants.FieldType.DATE||e===FormConstants.FieldType.DATE_TIME){let i;return i=e===FormConstants.FieldType.DATE?ZPeopleComponents.datefield(t):ZPeopleComponents.datetimefield(t),void 0===i.getValue().dateObject?"":i.formatDate(i.getValue().dateObject,i.getAttribute("format"))}return e===FormConstants.FieldType.TEXT_AREA?t.val():e===FormConstants.FieldType.CHECK_BOX?$(t).is(":checked"):e==FormConstants.FieldType.LOOKUP?ZPeopleComponents.select(t).getValue():t.val()},zp5MassUpdate.handleResponseOfBulkUpdate=function(e,t){if(e.isSuccess)zp5MassUpdate.moduleHandler.handleSuccess(e,t);else{let t=!0;if("VALIDATION"===e.errorType)zp5MassUpdate.removeFieldError(),e.isLookupErr?ZPeople.Message.failure(e.errors.message):$.each(e.errors,(function(t,i){var r=zp5MassUpdate.LAYOUT.find("#editable"+t),s=i.message;6919===i.code&&(e.isSuperAdmin?s+=ZPI18N.getString("zp.reports.linktochangeanalyticsdbowner",new Array(window.location.href.split("#")[0]+"#reports/analytics/listReport")):s+=ZPI18N.getString("zp.reports.contactsuperadmin")),zp5MassUpdate.constructFieldError(s,r,r.attr("fieldType"),!0)}));else if(7031==e.code||7400==e.code)ZPeople.Message.failure(e.message);else if("CUSTOMVALIDATIONFAILED"===e.errorType){let t=e.errormessage,i=`<div class="zpl_crd" id="massUpdate_ErrorTable"><div class="zpl_crdhdr"><h4>${ZPI18N.getString("zp.errorDetails")}</h4></div><div class="zpl_crdcnt"><div class="zpl_secn"><div class="zpl_tblres"><table class="zpl_tbl zpl_tblvtop wd100_per zpl_nocrsor"><tbody>`,r="#"+Layout.Page.hashDtl.hash.substring(0,Layout.Page.hashDtl.hash.lastIndexOf("/")+1);$.each(t,((e,t)=>{i+=`<tr><td><a href="${r}view-recordId:${t.recordId}" target="_blank">${ZPI18N.getString("zp.viewRecord")}</a></td>`,$.each(Object.keys(t.message),((e,r)=>{i+=0==e?"<td>":"<br><br>",i+=ZPeople.decodeTxt(t.message[r])})),i+="</td>"})),i+="</tbody></table></div></div></div></div>",zp5MassUpdate.LAYOUT.append(i),zp5MassUpdate.LAYOUT.find("#massUpdate_ErrorTable")[0].scrollIntoView({behavior:"smooth"})}else t=!1;zp5MassUpdate.moduleHandler.handleFailure(e,t)}},zp5MassUpdate.constructHeader=function(){let e="";return zp5MassUpdate.fieldDetails.isWorkFlowAvailable&&ZP5Form.getFormsOperation(zp5MassUpdate.formId).isAdmin()&&(e+='<div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbutton-js" style="display: none;" elem="inpToggleWorkflow">'+ZPI18N.getString("zp.executeeworkflow")+"</h5></div>"),zp5MassUpdate.fieldDetails.isCVAvailable&&(e+='<div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbutton-js" style="display: none;" elem="inpToggleCv">'+ZPI18N.getString("zp.executecustomvalidation")+"</h5></div>"),e?"<div class='zpl_crdhdr'><div>"+e+"</div></div>":""},zp5MassUpdate.constructValueField=function(e,t){let i=e.getValue(),r=zp5MassUpdate.FORM_COMPONENTS[i];var s=r.fieldType,a=r.labelName;let n=e.container.parents("tr"),o=n.attr("rowCnt");var l=[];if(ZP5Form.Field.Edit.getDependFieldMappingFields(i,l,zp5MassUpdate.formId),e.element.attr("isdependentfield")&&"true"==e.element.attr("isdependentfield")){e.element.removeAttr("isdependentfield");var d=e.element.attr("dependentField"),p=zp5MassUpdate.FORM_COMPONENTS[d];e.element.removeAttr("dependentField");var m=[];if(ZP5Form.Field.Edit.getDependFieldMappingFields(d,m,zp5MassUpdate.formId),p.dependentFiledList&&p.dependentFiledList.length>0)for(var c=0;c<p.dependentFiledList.length;c++)m.push(p.dependentFiledList[c]);zp5MassUpdate.dependentFieldHandling(m,!0)}""!=n.find("[zpmassupdvalcol=true]").html()&&(zp5MassUpdate.destroyZComponents(n.find("[zpmassupdvalcol=true] [name^=fieldValue_]")),zp5MassUpdate.infoToolTipObj.destroyTooltips({id:n.find('[id^="infoTooltip_"]').attr("id"),isSpecific:!0}),n.find("[zpmassupdvalcol=true]").empty()),e.element.attr("isMandatory",r.isMandatory);let{infoHtml:u,toolTip:g}=ZP5Form.getToolTipHtml(i,r.description,r.descriptionType,"MASSUPDATE",void 0,!0,zp5MassUpdate.infoToolTipObj);if(s===FormConstants.FieldType.PICKLIST||r.fieldType!=FormConstants.FieldType.LOOKUP&&!ZPeople.isZPNewUI()||s===FormConstants.FieldType.BLOODGROUP||s===FormConstants.FieldType.GENDER||s===FormConstants.FieldType.COUNTRY||s===FormConstants.FieldType.NEW_BLOODGROUP||s===FormConstants.FieldType.NEW_GENDER||s===FormConstants.FieldType.NEW_COUNTRY){n.find("[zpmassupdvalcol=true]").append(`<div class="d-flex"><select zcomponentname="select" id="editable${a}" name="fieldValue_${o}"  data-width="300" fcid="${i}" fieldtype="${s}" class="select-js" style="display: none;"></select>${u}</div>`);var h=r.hasOwnProperty("isPrimaryLookup")&&r.isPrimaryLookup?r.hasOwnProperty("AddOptions")?r.AddOptions:r.EditOptions:r.Options,f=s===FormConstants.FieldType.NEW_BLOODGROUP||s===FormConstants.FieldType.NEW_GENDER?r.oIds:r.OptionsWithId;let e=zp5MassUpdate.constructOptionsForValueFields(h,f,s),t=ZPeopleComponents.select(n.find("[zpmassupdvalcol=true]").find("[name=fieldValue_"+o+"]")[0],e);null!=r.autofillvalue&&r.autofillvalue.length>0?t.setValue(r.autofillvalue):t.setValue(e.options[0])}else{let e=null!=r.autofillvalue&&r.autofillvalue.length>0?r.autofillvalue:"";if(s===FormConstants.FieldType.DATE||s===FormConstants.FieldType.DATE_TIME){let t=dateFmt,r={};if(s==FormConstants.FieldType.DATE_TIME){let e=timeFormat.replace("a","tt");Calendar.is12HrFormat()||(e=timeFormat+":ss",r={secondStep:1}),t+=" "+e}r={...r,calendarIcon:!0,format:t,picker:!0,spinButtons:"none",clearButton:"none",change:ZP5Form.dateFieldChangeCallback,pickerOptions:{labels:FormConstants.ZCOMPONENT.LOCALE_OPTIONS},value:e},n.find("[zpmassupdvalcol=true]").append('<div class="d-flex"><div class="w300"><input id="editable'+a+'" name="fieldValue_'+o+'" fcid="'+i+'" fieldtype='+s+' class="datepicker-js" data-placeholder-type="date-format-in-lower" data-format="dd/MM/yyyy" data-picker="true" data-calendar-icon="true" data-clear-button="none" data-spin-buttons="none" data-width="300" style="display: none;"></div>'+u+"</div>"),s===FormConstants.FieldType.DATE?(n.find("[name=fieldValue_"+o+"]").attr("zcomponentname","datefield"),ZPeopleComponents.datefield(n.find("[zpmassupdvalcol=true]").find('[name="fieldValue_'+o+'"]'),r)):(n.find("[name=fieldValue_"+o+"]").attr("zcomponentname","datetimefield"),ZPeopleComponents.datetimefield(n.find("[zpmassupdvalcol=true]").find('[name="fieldValue_'+o+'"]'),r))}else if(s===FormConstants.FieldType.TEXT_AREA)n.find("[zpmassupdvalcol=true]").append('<div class="d-flex"><textarea id="editable'+a+'" name="fieldValue_'+o+'" fcid="'+i+'" fieldtype='+s+" "+g+' rows="2" class="ztextbox w300"></textarea>'+u+"</div>");else if(s===FormConstants.FieldType.CHECK_BOX){let t="true"==e?'checked="true"':"";n.find("[zpmassupdvalcol=true]").append(`<div class="d-flex"><div class="zcheckbox"><input type="checkbox" id="editable${a}" name="fieldValue_${o}" fcid="${i}" fieldtype="${s}" class="zcheckbox__helper" ${t}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for="editable${a}" class="zcheckbox__label"><span class="zcheckbox__text"></span></label></div>${u}</div>`)}else if(r.fieldType==FormConstants.FieldType.LOOKUP){n.find("[zpmassupdvalcol=true]").append(`<div class="d-flex"><select zcomponentname="select" id="editable${a}" name="fieldValue_${o}"  data-width="300" fcid="${i}" fieldtype="${s}" class="select-js" style="display: none;"></select>${u}</div>`);let e=zp5MassUpdate.constructOptionsForLookups(i,n.find("[zpmassupdvalcol=true]").find('[name="fieldValue_'+o+'"]'),r);ZPeopleComponents.select(n.find("[zpmassupdvalcol=true]").find("[name=fieldValue_"+o+"]"),e)}else s===FormConstants.FieldType.CURRENCY?n.find("[zpmassupdvalcol=true]").append('<div class="d-flex"><div class="ztextbox--group ztextbox--zicon zpl_inpticfild w300"><i class="ztextbox__icon">'+r.currencyType+'</i><input type="text" id="editable'+a+'" name="fieldValue_'+o+'" fcid="'+i+'"'+g+" fieldtype="+s+' class="ztextbox w300" value="'+e+'"></div>'+u+"</div>"):n.find("[zpmassupdvalcol=true]").append('<div class="d-flex"><input type="text" id="editable'+a+'" name="fieldValue_'+o+'" fcid="'+i+'"'+g+" fieldtype="+s+' class="ztextbox w300" value="'+e+'">'+u+"</div>")}if(!t){if(r.dependentFiledList&&r.dependentFiledList.length>0)for(c=0;c<r.dependentFiledList.length;c++)l.push(r.dependentFiledList[c]);l.length>0&&(e.element.attr("isDependentField",!0),e.element.attr("dependentField",r.formComponentId),l=zp5MassUpdate.moduleHandler.updateOrderOfFields(l,r),zp5MassUpdate.dependentFieldHandling(l,!1,r.formComponentId))}zp5MassUpdate.infoToolTipObj.constructTooltips(!0)},zp5MassUpdate.getInitElementHtml=function(){return zp5MassUpdate.fieldCount++,`<tr name="fieldRow" rowCnt=${zp5MassUpdate.fieldCount} id="fieldRow_${zp5MassUpdate.fieldCount}"><td><select zcomponentname="select" name="fieldName_${zp5MassUpdate.fieldCount}"  data-width="250" class="select-js" style="display: none;">\n\t\t </select></td><td zpmassupdvalcol=true></td><td><div class="zpl_hvr" name="fieldDelete_${zp5MassUpdate.fieldCount}"><i class="PI_delete" onclick="zp5MassUpdate.deleteCurField(event)"></i></div></td></tr>`},zp5MassUpdate.dependentFieldHandling=function(e,t){for(var i=0;i<e.length;i++)if(t){if(1==zp5MassUpdate.LAYOUT.find("[fcid="+e[i]+"]").length){let t=zp5MassUpdate.LAYOUT.find("[fcid="+e[i]+"]").parents("tr");zp5MassUpdate.destroyZComponents(t.find("td [name^=fieldName_]")),zp5MassUpdate.destroyZComponents(t.find("td [name^=fieldValue_]")),t.remove(),zp5MassUpdate.updateButtons()}}else{for(var r=zp5MassUpdate.fields,s=r[0],a=0;a<r.length;a++){var n=r[a];if(n.id==e[i]){s=n;break}}if(s.id==e[i]){var o=zp5MassUpdate.getInitElementHtml();zp5MassUpdate.LAYOUT.find('[elem="tblebdy"]').append(o),zp5MassUpdate.LAYOUT.find("[name^=fieldDelete_"+zp5MassUpdate.fieldCount+"]").remove();let e={disabled:!0,dataMapping:{label:"text",value:"id",optgroupLabel:"groupName"},options:[s]},t=ZPeopleComponents.select(zp5MassUpdate.LAYOUT.find("#fieldRow_"+zp5MassUpdate.fieldCount).find("select[name='fieldName_"+zp5MassUpdate.fieldCount+"']")[0],e);t.setValue(s.id),zp5MassUpdate.constructValueField(t,!0),zp5MassUpdate.updateButtons()}}},zp5MassUpdate.constructOptions=function(e,t){let i={};return null!=e.getDataMapping?e.getDataMapping(i):i.dataMapping={label:"text",value:"id",optgroupLabel:"groupName"},null==e.dataSourceNotNeed&&(i.dataSource=ZPMultiRoles_Select2.getDataSource(e,t)),i.contentType=e.contentType?e.contentType:"text",i.showSearchField=!0,i.acceptNewValues=!0,i.serverSearch=!0,i.dropdownList={fitForElement:!0,height:300,width:250,className:"zpl_ddoptnrml"},i.messages={noResults:ZPI18N.getString("zp.noresults")},i},zp5MassUpdate.constructOptionsForLookups=function(e,t,i){let r=zp5MassUpdate.constructStaticSelect2Option(i),s={dataMapping:r.dataMapping,lazyLoading:!0,viewPerPage:199,cacheData:!1,serverSearch:!0,messages:{noResults:ZPI18N.getString("zp.nomatchesfound")},showSearchField:!0,dropdownList:{fitForElement:!0,height:300,width:250,className:"zpl_ddoptnrml"}};return s.options=r.dataoptions,s.value=r.selValue,s.change=zp5MassUpdate.handledependentFieldChange,s.dataSource={search:t=>new Promise((i=>{let r=null==t.pages?1:t.pages,s=t.query;zp5MassUpdate.ZCSelect.getOptionsForLookup(e,i,s,r)})),paginated:!0},s},zp5MassUpdate.constructStaticSelect2Option=function(e){var t=e.hasOwnProperty("isPrimaryLookup")&&e.isPrimaryLookup?e.hasOwnProperty("AddOptions")?e.AddOptions:e.EditOptions:e.Options;let i={dataMapping:{label:"text",value:"id",id:"id",text:"text"}},r=[];return r.push({id:"-Select-",text:ZPI18N.getString("zp.choosefield")}),i.selValue="-Select-",$.each(t,(function(e,t){r.push({id:t.Id,text:ZPeople.decodeTxt(t.Value)})})),i.dataoptions=r,i},zp5MassUpdate.ZCSelect={OPTIONS:{},getOptionsForLookup:function(e,t,r,s){var a=[],n=e,o=!0,l=zp5MassUpdate.FORM_COMPONENTS[e];if(l.dependentFiledList&&l.dependentFiledList.length>0){var d=zp5MassUpdate.getFieldValuesForSearch(l.dependentFiledList);jQuery.isEmptyObject(d)||(n+=JSON.stringify(d))}if(null==zp5MassUpdate.ZCSelect.OPTIONS[n]&&(zp5MassUpdate.ZCSelect.OPTIONS[n]={},o=!1),zp5MassUpdate.ZCSelect.OPTIONS[n][r]&&0==zp5MassUpdate.ZCSelect.OPTIONS[n][r].length)isnew=!1;else{if(!(zp5MassUpdate.ZCSelect.OPTIONS[n][r]&&zp5MassUpdate.ZCSelect.OPTIONS[n][r].length>0&&zp5MassUpdate.ZCSelect.OPTIONS[n][r].length>200*(s-1)))return void(a=zp5MassUpdate.ZCSelect.getOptions(e,r,s,t,o));for(i=200*(s-1);i<200*s&&i<zp5MassUpdate.ZCSelect.OPTIONS[n][r].length;i++)-1==$.inArray(zp5MassUpdate.ZCSelect.OPTIONS[n][r][i],a)&&a.push(zp5MassUpdate.ZCSelect.OPTIONS[n][r][i]);isnew=!1}t({results:a,more:a.length>=200})},getOptions:function(e,t,i,r,s){fields=[e];var a=zp5MassUpdate.FORM_COMPONENTS[e],n={mode:"fetchFormLookupOtions",luFcIds:JSON.stringify(fields),formId:zp5MassUpdate.formId,searchtxt:t,startInd:200*(i-1)+1,conreqcsr:csrfToken,isfilternotneeded:!1};url=ZP5Form.URL;var o=[],l=e;if(a.dependentFiledList&&a.dependentFiledList.length>0){var d=zp5MassUpdate.getFieldValuesForSearch(a.dependentFiledList);jQuery.isEmptyObject(d)||(n.fieldValues=JSON.stringify(d),l+=n.fieldValues)}return zp5MassUpdate.moduleHandler.setParamsForLookupOpt(n),$.ajax({type:"POST",async:!0,url,data:n,success:function(i){s||o.push({id:"-Select-",text:ZPI18N.getString("zp.choosefield")}),i.code==zpconst.ResponseCodes.API_ERR_NO_ERROR&&i.message&&i.message[e]&&$.each(i.message[e],(function(e,t){o.push({id:t.Id,text:ZPeople.decodeTxt(t.Value)})})),zp5MassUpdate.ZCSelect.OPTIONS[l][t]||(zp5MassUpdate.ZCSelect.OPTIONS[l][t]=[]),$.each(o,(function(e,i){zp5MassUpdate.ZCSelect.OPTIONS[l][t].push(i)})),r({results:o,more:o.length>=200})}}),o}},zp5MassUpdate.getFieldValuesForSearch=function(e){var t={},i=zp5MassUpdate.LAYOUT;return $.each(e,(function(e,r){$(i).find("td[zpmassupdvalcol=true]").each((function(){if($(this).find("[fcid="+r+"]").length>0){var e=ZPeopleComponents.select($(this).find("[fcid="+r+"]")).getValue();t[r]=e}}))})),t},zp5MassUpdate.handledependentFieldChange=function(e){var t=e.target.attr("fcId"),i=[],r=zp5MassUpdate.LAYOUT;ZP5Form.Field.Edit.getDependFieldMappingFields(t,i,zp5MassUpdate.formId);for(var s=0;s<i.length;s++)i[s]!=t&&1==r.find("td[zpmassupdvalcol=true]").find("[fcid="+i[s]+"]").length&&ZPeopleComponents.select(r.find("td[zpmassupdvalcol=true]").find("[fcid="+i[s]+"]")).setValue({id:"-Select-",text:ZPI18N.getString("zp.choosefield")})},zp5MassUpdate.constructOptionsForValueFields=function(e,t,i){let r={},s={};return i===FormConstants.FieldType.PICKLIST||i===FormConstants.FieldType.BLOODGROUP||i===FormConstants.FieldType.GENDER||i===FormConstants.FieldType.NEW_BLOODGROUP||i===FormConstants.FieldType.NEW_GENDER?(r.dataMapping={label:"text",value:"id",id:"id"},s={text:ZPI18N.getString("zp.choosefield"),id:"-Select-",optid:"-Select-"}):i===FormConstants.FieldType.COUNTRY?(r.dataMapping={label:"text",value:"code"},s={text:ZPI18N.getString("zp.choosefield"),code:"-Select-"}):(r.dataMapping={label:"text",value:"value"},s={text:ZPI18N.getString("zp.choosefield"),value:"-Select-"}),r.options=[],r.options.push(s),$.each(e,(function(e,s){if(option={},i===FormConstants.FieldType.PICKLIST||i===FormConstants.FieldType.BLOODGROUP||i===FormConstants.FieldType.GENDER||i===FormConstants.FieldType.NEW_BLOODGROUP||i===FormConstants.FieldType.NEW_GENDER){var a=i===FormConstants.FieldType.PICKLIST||i===FormConstants.FieldType.NEW_BLOODGROUP||i===FormConstants.FieldType.NEW_GENDER&&null!=t?i===FormConstants.FieldType.NEW_BLOODGROUP||i===FormConstants.FieldType.NEW_GENDER?t[e]:t[e].Id:"-1";option.optid=a,option.id=s,i!==FormConstants.FieldType.NEW_BLOODGROUP&&i!==FormConstants.FieldType.NEW_GENDER||(option.id=a),option.text=ZPeople.decodeTxt(s)}else if(i===FormConstants.FieldType.COUNTRY||i===FormConstants.FieldType.NEW_COUNTRY){var n=s.name.toUpperCase();option.code=n,i===FormConstants.FieldType.NEW_COUNTRY&&(option.code=s.code),option.text=n}else r.dataMapping={label:"text",value:"id"},option.text=s.Value,option.id=s.Id;r.options.push(option)})),r.contentType="text",r.showSearchField=!0,r.acceptNewValues=!0,r.serverSearch=!0,r.dropdownList={fitForElement:!0,height:300,width:250,className:"zpl_ddoptnrml"},r.messages={noResults:ZPI18N.getString("zp.noresults")},r},zp5MassUpdate.constructOptionsForFieldNames=function(e){let t=e.target;var i=[],r=[];let s=ZPeopleComponents.select(t).getValue();$.each(zp5MassUpdate.LAYOUT.find("select[name^='fieldName_']").not(t),(function(){let e=ZPeopleComponents.select(this).getValue();i.push(e)})),$.each(zp5MassUpdate.fields,(function(e,t){-1==i.indexOf(t.id)&&r.push(t)})),ZPeopleComponents.select(t).removeAllOptions(),ZPeopleComponents.select(t).addOption(r,t),ZPeopleComponents.select(t).setValue(""!=s?s:r[0])},zp5MassUpdate.updateButtons=function(){1==zp5MassUpdate.LAYOUT.find("[name=fieldRow] [name^=fieldDelete_]").length?zp5MassUpdate.LAYOUT.find('[name=fieldRow] td [name^="fieldDelete_"]').addClass("DNI"):zp5MassUpdate.LAYOUT.find('[name=fieldRow] td [name^="fieldDelete_"]').removeClass("DNI"),zp5MassUpdate.LAYOUT.find("[name=fieldRow]").length>=zp5MassUpdate.fields.length?zp5MassUpdate.LAYOUT.find('[elem="addNewFieldMassUpdate"]').addClass("DNI"):zp5MassUpdate.LAYOUT.find('[elem="addNewFieldMassUpdate"]').removeClass("DNI")},zp5MassUpdate.getFirstField=function(){var e=[];let t=null;return $.each(zp5MassUpdate.LAYOUT.find("select[name^='fieldName_']"),(function(){let t=ZPeopleComponents.select(this).getValue();e.push(t)})),$.each(zp5MassUpdate.fields,(function(i,r){if(-1==e.indexOf(r.id))return t=r,!1})),t},zp5MassUpdate.constructFieldError=function(e,t,i,r){let s=$(t).parent();null==i||i!=FormConstants.FieldType.DATE&&i!=FormConstants.FieldType.DATE_TIME&&i!=FormConstants.FieldType.CHECK_BOX&&i!=FormConstants.FieldType.CURRENCY||(s=$(t).parent().parent()),FrameworkCommon.showError(e,t,!r,s)},zp5MassUpdate.removeFieldError=function(){let e=zp5MassUpdate.LAYOUT.find("tr[name='fieldRow']").find("td [name^=fieldValue_]");FrameworkCommon.removeError(e),FrameworkCommon.removeError(e.parent()),FrameworkCommon.removeError(e.parent().parent()),zp5MassUpdate.LAYOUT.find("#massUpdate_ErrorTable").length>0&&zp5MassUpdate.LAYOUT.find("#massUpdate_ErrorTable").remove()};class MassUpdateModuleHandler{getContainer(){return ZP5Views.getCurrViewObj().container}getPkIds(){let e=[],t=this.getContainer().find("table#viewsContainer:visible");return $.each(t.find("tbody input[name=check]:checked"),(function(t){e[t]=$(this).parents("[recordid]").attr("recordid")})),e}handleFailure(e,t){t||ZPeople.Message.failure(ZPI18N.getString("zp.sorryservererror")),zp5MassUpdate.container.find("#sliderSbt").removeClass("disabled")}handleSuccess(e,t){var i=e.modifiedPkIds;if(jQuery.isEmptyObject(i))ZPeople.Message.failure(ZPI18N.getString("zp.permdeniedornodata"));else{ZPeople.Message.success(ZPI18N.getString("zp.updatedsuccessfully"));i=e.modifiedPkIds;let r=ZP5Form.getFormsOperation(t.formid).getApprovalSettingsDetails();$.each(i,(function(e){ZP5Form.refreshRecord(t.formid,e),null!=r&&r.isVerifySend&&ZPApprovals.APPROVAL_DETAILS[e]&&delete ZPApprovals.APPROVAL_DETAILS[e]}))}ZP5Views.refreshview(),zp5MassUpdate.sliderModalObj.close()}updateOrderOfFields(e){return e}getAlteredFieldsArray(e,t){let i=[];for(var r=0;r<t.length;r++)for(var s=0;s<e.length;s++){zp5MassUpdate.FORM_COMPONENTS[e[s]].labelName==t[r]&&i.push(e[s])}return i}setParamsForLookupOpt(){}}class EmployeeMassUpdateHandler extends MassUpdateModuleHandler{showEmployeeError(e){e.hasOwnProperty("activeUserList")?ZPeople.Message.failure(e.activeUserList.message):e.hasOwnProperty("closedUserList")?ZPeople.Message.failure(e.closedUserList.message):e.hasOwnProperty("dwngrdUserList")?ZPeople.Message.failure(e.dwngrdUserList.message):e.hasOwnProperty("invitationInactive")?ZPeople.Message.failure(e.invitationInactive.message):e.hasOwnProperty("dupMailIdList")&&ZPeople.Message.failure(e.dupMailIdList.message)}handleFailure(e,t){if(e.isSuperAdminChange){var i=e.errorMap;zp5MassUpdate.constructFieldError(i.message,zp5MassUpdate.LAYOUT.find("#editable"+i.labelName),void 0,!0)}t||(e.isLicenseCountExceeded?ZPeople.Message.failure(ZPI18N.getString("zp.licensecountexceeded")):"EMPERRORS"===e.errorType?this.showEmployeeError(e):e.isSuperAdminChange||ZPeople.Message.failure(ZPI18N.getString("zp.sorryservererror"))),zp5MassUpdate.container.find("#sliderSbt").removeClass("disabled")}handleSuccess(e,t){"EMPERRORS"===e.errorType?this.showEmployeeError(e):super.handleSuccess(e,t)}updateOrderOfFields(e,t){var i=e;if("Entity"==t.labelName||"Business_unit"==t.labelName||"Division"==t.labelName){return super.getAlteredFieldsArray(e,["Entity","Business_unit","Division","Department"])}return i}}class OnboardingMassUpdateHandler extends MassUpdateModuleHandler{updateOrderOfFields(e,t){var i=e;if("CandidateEntity"==t.labelName||"Business_unit"==t.labelName||"CandidateDivision"==t.labelName){return super.getAlteredFieldsArray(e,["CandidateEntity","Business_unit","CandidateDivision","CandidateDepartment"])}return i}}var FormsCommonLayout={validateUrl:()=>{let e,t=FormsCommonLayout.getFormIdFromLabelName(!0);return settingsUrlProps.urlParamsArr.formId=t.formId,!!settingsUrlProps.urlParamsArr.formId&&(e=Layout.Page.hashDtl.hashArr,e[e.length-3]==t.tabName||{isValid:!0,redirectToURL:FormsCommonLayout.constructUrlBasedonTabName(t.tabName.toLowerCase())})},validateOldUrl:()=>Layout.Page.hashDtl.isSystemForm?FormsCommonLayout.redirectSystemForm():FormsCommonLayout.redirectToNewUrl(),getFormIdFromLabelName:e=>{let t,i=Layout.Page.hashDtl.hashArr,r=i.length,s=i[r-2],a=i[r-3];Layout.Page.hashDtl.tabAliasName&&(t=a,a=Layout.Page.hashDtl.tabAliasName);let n=ZP5ServicesCommon.getDefaultFormAndViewId(a,s);return null!=t&&a==n.tabName?n.tabName=t:"employee"==s&&(n.tabName=null!=t?t:"organization"),e?n:n.formId},setModulePrefixParams:()=>{let e=Layout.Page.hashDtl.hashArr,t=e.length,i=e[t-2];Layout.Page.hashDtl.formLabelName&&(i=Layout.Page.hashDtl.formLabelName);let r=e[t-3];return Layout.Page.hashDtl.tabAliasName&&(r=Layout.Page.hashDtl.tabAliasName),"employee"!=i&&"department"!=i?r+="-form-listview":r=r+"-"+i,{modulePrefix:r,formId:settingsUrlProps.urlParamsArr.formId,submode:r}},redirectToNewUrl:()=>{let e=Layout.Page.hashDtl.hashArr,t=e.length,i=e[t-3];Layout.Page.hashDtl.tabAliasName&&(i=Layout.Page.hashDtl.tabAliasName);let r,s,a=e[t-1],n=[],o=!1;if("listview"==a){if(!settingsUrlProps.urlParamsArr.formId)return FormsCommonLayout.validateUrl();{o=isadmin||isOperationalRoleAdmin||"dataadmin"==Layout.Page.urlparam.typeOfView;let e=ZP5ServicesCommon.getFormLinkNameFromFormId(i,settingsUrlProps.urlParamsArr.formId,settingsUrlProps.urlParamsArr.viewId);s=FormsCommonLayout.addCustomParamsForView(e.isSystemDefaultView),r=e.formLinkName}}else{o=isadmin||isOperationalRoleAdmin,r=settingsUrlProps.urlParamsArr.formLinkName;let e=settingsUrlProps.urlParamsArr.formId;if(!r&&!e)return FormsCommonLayout.validateUrl();("edit"==a||"view"==a)&&(s="recordId:"+settingsUrlProps.urlParamsArr.recordId),!r&&e&&(r=ZP5ServicesCommon.getFormLinkNameFromFormId(i,e).formLinkName)}if(null==r)return!1;r=r.toLowerCase(),o&&n.push("operations"),n.push(i),n.push(r),n.push(a);let l=n[0];for(let e=1;e<n.length;e++)l=l+"/"+n[e];return null!=s&&""!=s&&(l=l+"-"+s),{isValid:!0,redirectToURL:l}},redirectSystemForm:()=>{let e,t=Layout.Page.hashDtl.hashArr,i=t[0],r=t[t.length-1],s=!1,a=[];switch(r){case"view":case"edit":paramsStr="recordId:"+settingsUrlProps.urlParamsArr.recordId;case"add":s=isadmin||isOperationalRoleAdmin,e=settingsUrlProps.urlParamsArr.formLinkName,a.push(r);break;case"import":case"bulkupload":case"photoupload":paramsStr="",s=isadmin||isOperationalRoleAdmin,e=settingsUrlProps.urlParamsArr.formLinkName.toLowerCase(),a.push(r);break;default:s=isadmin||isOperationalRoleAdmin||"dataadmin"==Layout.Page.urlparam.typeOfView;let t=ZP5ServicesCommon.getFormLinkNameFromFormId(i,settingsUrlProps.urlParamsArr.formId,settingsUrlProps.urlParamsArr.viewId);paramsStr=FormsCommonLayout.addCustomParamsForView(t.isSystemDefaultView),e=t.formLinkName,a.push("listview")}if(null==e){if("listview"==r)return!1;if(e=ZP5ServicesCommon.getFormLinkNameFromFormId(i,settingsUrlProps.urlParamsArr.formId).formLinkName,null==e)return!1}s?a.push("operations"):a.push("home"),a.push(i),a.push(e.toLowerCase());let n=a[1];for(let e=2;e<a.length;e++)n=n+"/"+a[e];return n=n+"/"+a[0],null!=paramsStr&&""!=paramsStr&&(n=n+"-"+paramsStr),{isValid:!0,redirectToURL:n}},addCustomParamsForView:e=>{let t="",i=!1;for(var r in e||(t=t+"viewId:"+settingsUrlProps.urlParamsArr.viewId,i=!0),settingsUrlProps.urlParamsArr)if("formId"!=r&&"viewId"!=r){let e,s=r;if("approval"==r&&(s="approvalStatus","all"==settingsUrlProps.urlParamsArr[r]))continue;"orgStructureFilter"==r&&(settingsUrlProps.urlParamsArr[r]=encodeURIComponent(JSON.stringify(JSON.parse(decodeURIComponent(settingsUrlProps.urlParamsArr[r]))[0])));let a={},n=[];"search"==r&&(s="searchBy",$.each(JSON.parse(decodeURIComponent(settingsUrlProps.urlParamsArr[r])),((t,i)=>{$.each(i,((t,i)=>{switch(t){case"1":e=i;break;case"2":a[e+"_op"]=i;break;case"3":a[e]=i;break;case"4":a[e+"_ids"]=i;break;case"5":a[e+"_idFlag"]=i}})),n.push(a),a={}})),settingsUrlProps.urlParamsArr[r]=encodeURIComponent(JSON.stringify(n)));let o="/";i||(o="",i=!0),t=t+o+s+":"+settingsUrlProps.urlParamsArr[r]}return t},constructUrlBasedonTabName:e=>{let t=["operations","home"],i=Layout.Page.hashDtl.hashArr,r=i.length,s=i[r-3];i[r-3]=e;let a=i[0];for(let e=1;e<i.length;e++)a+="/"+i[e];let n=i[r-2];return["employee"].indexOf(n)>-1&&"organization"!=s&&-1==t.indexOf(i[0])&&(a=isadmin||isOperationalRoleAdmin||null!=Layout.Page.urlparam.typeOfView&&"dataadmin"==Layout.Page.urlparam.typeOfView?t[0]+"/"+a:t[1]+"/"+a),a+(""!=settingsUrlProps.urlParams?"-":"")+settingsUrlProps.urlParams},constructUrlBasedOnFormIdAndViewIdOnly:()=>{let e,t,i=Layout.Page.hashDtl.hashArr,r=i[i.length-1],s="",a="",n=[],o=!1;if("listview"==r){if(settingsUrlProps.urlParamsArr.formId){e=ZP5ServicesCommon.getServiceNameFromFormIds([settingsUrlProps.urlParamsArr.formId])[settingsUrlProps.urlParamsArr.formId];let i=ZP5ServicesCommon.getFormLinkNameFromFormId(e,settingsUrlProps.urlParamsArr.formId,settingsUrlProps.urlParamsArr.viewId);t=i.formLinkName,s=i.isSystemDefaultView?"":"-viewId:"+settingsUrlProps.urlParamsArr.viewId,o=isadmin||isOperationalRoleAdmin||"dataadmin"==Layout.Page.urlparam.typeOfView}}else settingsUrlProps.urlParamsArr.formLinkName&&(t=settingsUrlProps.urlParamsArr.formLinkName,s="view"==r||"edit"==r?"-recordId:"+settingsUrlProps.urlParamsArr.recordId:"",e=e||ZP5ServicesCommon.getDefaultFormAndViewId(e,t).tabName,o=isadmin||isOperationalRoleAdmin);if(!t||!e)return!1;o&&n.push("operations"),n.push(e),n.push(t.toLowerCase()),n.push(r);for(let e=0;e<n.length;e++)a+=0==e?n[e]:"/"+n[e];return a+=s,{isValid:!0,redirectToURL:a}}};class BulkFileUploadV5 extends ImportV5{constructor(e){super(e),this.isPhoto=e==ZP5Import.HANDLER_MODE.PHOTOUPLOAD}getBaseFormId(){return this.formId}setBaseFormId(e){this.formId=e}getIsBulkFileUpload(){return!0}setAttachmentFields(e){this.fields=e}getAttachmentFields(){return this.fields}getInitSummary(){return this.initSummary}setInitSummary(e){this.initSummary=e}static getURL(){return"/Importbulk.zp"}init(){let e={mode:"init"};e.formId=this.getHandler().getFormId(),e.isPhoto=this.isPhoto,this.getSliderInstance().open(),ZPeople.Request.send(BulkFileUploadV5.getURL(),e,this.getUploadInstance().init.bind(this.getUploadInstance()),{},this.failCallback.bind(this))}}class BulkFileUploadV5UploadFile extends ImportV5UploadFile{constructor(e){super(),this.tab=new Tab(ZPI18N.getString("zp.uploadfile")),this.tab.id=BulkFileUploadV5UploadFile.getTabId(),this.tab.cardId=BulkFileUploadV5UploadFile.getCardId(),this.initSummary=!1,this.isPhoto=e==ZP5Import.HANDLER_MODE.PHOTOUPLOAD}getTab(){return this.tab}static getTabId(){return"tabUploadFile"}static getCardId(){return"cardUploadFile"}init(e,t,i){if(e.isSuccess){this.getImportInstance().setIsWorkFlowAvailable(e.isworkflowAvailable),this.getImportInstance().setIsApprovalConfigured(e.isApprovalEnabled),this.getImportInstance().setCandidateFields(e.candidateFields),this.getImportInstance().setUniqueFields(e.uniquefieldArr),this.getImportInstance().setAttachmentFields(e.fieldArr);let t=(e,t)=>{e.isLocationTrackingEnabled&&!t.isPermEnabled?(FrameworkCommon.showInfoAlert("",ZPI18N.getString("zp.requestuserlocation")+" "+ZPI18N.getString("zp.blockedlocation")),this.getImportInstance().getSliderModal().close()):(FrameworkCommon.removeLoading(this.getImportInstance().getContainer().find("#"+BulkFileUploadV5UploadFile.getCardId())),this.getImportInstance().getContainer().find("#"+BulkFileUploadV5UploadFile.getCardId()).addClass("zpl_crdwthful zpl_crdfull"),this.getImportInstance().getContainer().find("#"+BulkFileUploadV5UploadFile.getCardId()).html(this._getPage()),FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=bulkUploadFileContainer]")),this.getImportInstance().getSliderModal().modalFooter.find("#saveButton").addClass("disabled").prop({disabled:!0}),this.isPhoto&&(FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=bulkUploadDataForCont")),FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=bulkUploadDataFor"))),this._defaultActions())};t.bind(this),ImportV5.validateLocation(this.getImportInstance().getBaseFormId(),t)}else{let t=ZPI18N.getString("zp.sorryservererror");e.hasOwnProperty("error")&&e.error&&(t=e.error),ZPeople.Message.failure(t),this.getImportInstance().getSliderModal().close()}}onChangeFileByXHR(e){if(e.size>=0){this.showHideProgressBar(!0),this.getImportInstance().getContainer().find("[elem=bulkUploadFile],[elem=bulkUploadButton]").addClass("disabled").prop({disabled:!0});let t=this.getImportInstance().getHandler().getFormId(),i=new XMLHttpRequest,r=(new Date).getTime()+"_"+_LOGGEDIN_ZUID+"_"+t,s={portalId:_LOGGEDIN_ACCZSOID,moduleName:"Forms_BulkImport",formId:t,isBulkUpload:!0},a=UPLOAD_URL+"/"+UDS_UPLOAD_SERVICE_CODE+"/ver1/stream/upload";i.upload.uploadId=r,i.open("post",a,!0),i.setRequestHeader("x-assured-response",!0),i.setRequestHeader("x-streammode","1"),s=JSON.stringify(s),i.setRequestHeader("app-info",s),i.setRequestHeader("file-info",JSON.stringify({fileName:encodeURIComponent(e.name),contentType:e.type,fileSize:e.size})),i.setRequestHeader("upload-id",r),i.withCredentials=!0,i.onreadystatechange=function(e){4==i.readyState&&(this.showHideProgressBar(!1),this.getImportInstance().getContainer().find("[elem=bulkUploadFile],[elem=bulkUploadButton]").removeClass("disabled").prop({disabled:!1}),200===i.status?this.handleXhrResponse(JSON.parse(i.response)):this.handleFileUploadFailure(JSON.parse(i.getResponseHeader("x-error"))))}.bind(this),i.send(e)}}handleFileUploadFailure(e){if(this.showHideProgressBar(!1),this.getImportInstance().setFileList(""),FrameworkCommon.show(this.getImportInstance().getContainer().find('[elem="bulkUploadFileHelp"]')),this.getImportInstance().getContainer().find("[elem=bulkUploadFile],[elem=bulkUploadButton]").removeClass("disabled").prop({disabled:!1}),this.getImportInstance().getContainer().find('[elem="bulkUploadFileNameCont"]').text(ZPI18N.getString("zp.draganddropatthere")),this.getImportInstance().getContainer().find('[elem="bulkUploadButton"]').text(ZPI18N.getString("zp.uploadfile")),this.getImportInstance().getContainer().find("[elem=bulkUploadFile]")[0].files=(new DataTransfer).files,null!=e&&e.errorMessage){let t="zp.rebranderrinaction",i=[];"MAX SIZE EXCEEDED"==e.errorMessage?(t="zp.maxuploadfilesize",i.push(Math.round(e.fileSizeLimit/1048576)+"MB")):"SERVICE NOT APPLICABLE"==e.errorMessage&&(t="zp.applicability.services.noaccess",this.getImportInstance().getSliderModal().close()),ZPeople.Message.failure(ZPI18N.getString(t,i))}else ZPeople.Message.failure(ZPI18N.getString("zp.reuploadfile"))}handleXhrResponse(e,t){this.showHideProgressBar(!1);let i=e.fileInfo;if(i){let e=this.getImportInstance();e.getContainer().find("[elem=bulkUploadFile]").attr("fileId",i.fileId),e.getSliderModal().modalFooter.find("#saveButton").removeClass("disabled").prop({disabled:!1}),t&&(this.showHideProgressBar(!0),e.getSliderModal().modalFooter.find("#saveButton").addClass("disabled").prop({disabled:!0}))}}showHideProgressBar(e){let t=this.getImportInstance().getContainer().find("[elem=BulkUploadProgressBar]");FrameworkCommon.hide(t),ZPeopleComponents.progressbar(t).destroy(),e&&(ZPeopleComponents.progressbar(t),FrameworkCommon.show(t))}_getPage(){let e='<form elem="bulkFileUploadForm">';return e+='<div class="zpl_crd" elem="card"><div class="zpl_crdcnt DNI" elem="bulkUploadFileContainer">',e+='<div class="zpl_secn zpl_idivingrp" style="width: 500px;">',e+='<div><div><label elem="bulkUploadDataForCont">'+ZPI18N.getString("zp.uploaddatafor")+'</label><label elem="bulkUploadBasedOnCont">'+ZPI18N.getString("zp.uploadbasedon")+"</label></div></div>",e+='<div><div><select elem="bulkUploadDataFor" name="importDataFor"></select><select elem="bulkUploadBasedOn" name="importBasedOn"></select></div></div></div>',e+='<div class="zpl_secn" elem="bulkUploadSeparatorDiv"  style="width: 500px;"><div><label>'+ZPI18N.getString("zp.separator")+'</label></div><div><input  elem="bulkUploadSeparator" name="separator" type="text" class="ztextbox"></div></div>',e+='<div class="zpl_secn" elem="bulkUploadHelpInfoContainer"><div><div class="zpl_info" ele="bulkUploadHelpInfo">',e+='<h6 elem="bulkUploadHelpInfoHeader"><b>'+ZPI18N.getString("zp.note")+"</b></h6>",e+='<ul><li elem="bulkUploadHelp">'+ZPI18N.getString("zp.bulkuploadhelp")+"</li></ul>",e+="</div></div></div>",e+='<div class="zpl_secn"><div><div class="zpl_upld"><div class="zpl_fldrp" elem="bulkFileDropContainer">',e+='<div class="zpl_mdzipimprt"></div>',e+='<h4 elem="bulkUploadFileNameCont">'+ZPI18N.getString("zp.draganddropatthere")+"</h4>",e+='<p elem="bulkUploadFileHelp">'+ZPI18N.getString("zp.zipformatsupport")+"</p>",e+='<input class="DNI" type="file" name="zipFile" accept=".zip" elem="bulkUploadFile">',e+='<button type="button" class="zlabel zlabel--blue zlabel--medium" elem="bulkUploadButton">'+ZPI18N.getString("zp.uploadfile")+"</button>",e+='<p elem="bulkUploadFileHelp">'+ZPI18N.getString("zp.maxfilesize50")+"</p>",e+='<div class="DB" elem="BulkUploadProgressBar" data-mode="indeterminate"></div>',e+="</div></div></div></div>",e+="</div></div>",e+='<input type="hidden" name="mode" value="uploadFile" />',e+='<input type="hidden" name="'+csrfParamName+'"     value="" />',e+='<input type="hidden" name="latitude"      value="" />',e+='<input type="hidden" name="longitude"     value="" />',e+='<input type="hidden" name="formId"        value="" />',e+="</form>",e}_defaultActions(){this.getImportInstance().getContainer().find('[elem="bulkUploadButton"]').off("click").on("click",function(e){this.getImportInstance().setFileList(this.getImportInstance().getContainer().find("[elem=bulkUploadFile]")[0].files),$(e.target).siblings("[elem=bulkUploadFile]").trigger("click")}.bind(this)),FrameworkCommon.removeError(this.getImportInstance().getContainer().find("[elem=bulkFileDropContainer]")),FrameworkCommon.initDragDropFiles(this.getImportInstance().getContainer().find('[elem="bulkFileDropContainer"]'),this.getImportInstance().getContainer(),(e=>{if("zip"===e[0].name.split(".").pop()){this.getImportInstance().setFileList(this.getImportInstance().getContainer().find("[elem=bulkUploadFile]")[0].files);let t=new DataTransfer;t.items.add(e[0]),this.getImportInstance().getContainer().find('[elem="bulkUploadFile"]')[0].files=t.files,this.getImportInstance().getContainer().find('[elem="bulkUploadFile"]').trigger("change")}else ZPeople.Message.failure(ZPI18N.getString("zp.zipformatsupport"))}).bind(this),1),this.getImportInstance().getContainer().find('[elem="bulkUploadFile"]').off("change").on("change",this._handleUploadedFile.bind(this)),ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=bulkUploadDataFor]"),ComponentsCommon.select.getProps({showSearchField:!0})),this.setSelectValue(this.getImportInstance().getContainer().find("[elem=bulkUploadDataFor]"),this.getImportInstance().getAttachmentFields()),ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=bulkUploadBasedOn]"),ComponentsCommon.select.getProps({showSearchField:!0,change:this.onChangeBasedOn.bind(this)})),this.setSelectValue(this.getImportInstance().getContainer().find("[elem=bulkUploadBasedOn]"),this.getImportInstance().getUniqueFields()),this.getImportInstance().getContainer().find("[elem=bulkUploadSeparator]").val(","),this.onChangeBasedOn(),this.getImportInstance().getContainer().find("[elem=bulkUploadSeparator]").off("click").on("click",this.onChangeSeparator.bind(this))}setSelectValue(e,t){(t=this.getSelectOptions(t)).length>0&&(ZPeopleComponents.select(e).setAttributes({options:t}),ZPeopleComponents.select(e).setValue(t[0].value))}getSelectOptions(e){let t=[];if(e)for(i=0;i<e.length;i++)t.push({label:ZPeople.decodeTxt(e[i].displayName),value:e[i].formcomponentId});return t}getCandidateFieldMessage(e){let t="",i=this.getImportInstance().getCandidateFields();return i&&(t=i.join(e)),t}onChangeBasedOn(){if("0"==ZPeopleComponents.select(this.getImportInstance().getContainer().find("[elem=bulkUploadBasedOn]")).getValue()){let e=this.getImportInstance().getContainer().find("[elem=bulkUploadSeparator]").val();FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=bulkUploadSeparatorDiv]")),this.getImportInstance().getContainer().find("[elem=bulkUploadHelp]").html(ZPI18N.getString("zp.bulkfileuploaduniquefieldNote",[this.getCandidateFieldMessage(e)]))}else FrameworkCommon.hide(this.getImportInstance().getContainer().find("[elem=bulkUploadSeparatorDiv]")),this.getImportInstance().getContainer().find("[elem=bulkUploadHelp]").html(ZPI18N.getString("zp.bulkuploadhelp"))}onChangeSeparator(){let e=this.getImportInstance().getContainer().find("[elem=bulkUploadSeparator]"),t=$(e).val();FrameworkCommon.removeError(e),0==t.length?(FrameworkCommon.showError(ZPI18N.getString("zp.uniqSeparatorErr"),e),this.getImportInstance().getContainer().find("[elem=bulkUploadHelp]").html("")):(FrameworkCommon.show(this.getImportInstance().getContainer().find("[elem=bulkUploadSeparatorDiv]")),this.getImportInstance().getContainer().find("[elem=bulkUploadHelp]").html(ZPI18N.getString("zp.bulkfileuploaduniquefieldNote",[this.getCandidateFieldMessage(t)])))}_handleUploadedFile(e){let t=this.getImportInstance().getFileList(),i=!0;if(""!=t&&common._empty($(e.target).val())&&(this.getImportInstance().getContainer().find("[elem=bulkUploadFile]")[0].files=t,i=!1),this.getImportInstance().getContainer().find("[elem=bulkUploadFile]")[0].files[0].size/1048576>50)return this.getImportInstance().getContainer().find("[elem=bulkUploadFile]")[0].files=t,ZPeople.Message.failure(ZPI18N.getString("zp.maxfilesize50")),void this.getImportInstance().setFileList("");this.getImportInstance().setFileList(""),$(e.target).siblings("[elem=bulkUploadButton]").text(ZPI18N.getString("zp.removeandnew")),FrameworkCommon.hide(this.getImportInstance().getContainer().find('[elem="bulkUploadFileHelp"]'));let r=$(e.target).val();r=r.replace("C:\\fakepath\\",""),$(e.target).parents("[elem=bulkFileDropContainer]").find("[elem=bulkUploadFileNameCont]").text(r),common._empty(r)?(this.getImportInstance().getContainer().find("[elem=bulkFileDropContainer]").addClass("fldrp_err"),FrameworkCommon.showError(ZPI18N.getString("zp.uploadfilewarning"),this.getImportInstance().getContainer().find("[elem=bulkFileDropContainer]"))):(this.getImportInstance().getContainer().find("[elem=bulkFileDropContainer]").removeClass("fldrp_err"),FrameworkCommon.removeError(this.getImportInstance().getContainer().find("[elem=bulkFileDropContainer]")),i&&UDS_UPLOAD_IS_ACTIVE?ImportV5.validateLocation(this.getImportInstance().getBaseFormId(),this.upload.bind(this)):(this.showHideProgressBar(!1),UDS_UPLOAD_IS_ACTIVE||this.getImportInstance().getSliderModal().modalFooter.find("#saveButton").removeClass("disabled").prop({disabled:!1})))}onChangeFileByFileAction(e){this.showHideProgressBar(!0),this.getImportInstance().getContainer().find("[elem=bulkUploadFile],[elem=bulkUploadButton]").addClass("disabled").prop({disabled:!0});let t=new FormData;t.set("zipFile",e.get("zipFile")),t.set("formId",e.get("formId"));let i=this;ZPeople.Request.sendFormData("/formsImportFile/bulkFileUpload",t,(e=>{e.isSuccess?i.handleXhrResponse({fileInfo:e}):i.handleFileUploadFailure(e).bind(i)}),void 0,(()=>{i.handleFileUploadFailure().bind(i)}))}validate(){ImportV5.validateLocation(this.getImportInstance().getBaseFormId(),this.forward.bind(this))}upload(){if(UDS_UPLOAD_IS_ACTIVE){this.getImportInstance().setImportFormId(this.getImportInstance().getHandler().getFormId());let e=this.getImportInstance().getContainer().find("#"+BulkFileUploadV5UploadFile.getCardId()).find("form[elem=bulkFileUploadForm]"),t=new FormData(e[0]);this.onChangeFileByXHR(t.get("zipFile"))}}_forwardValidation(e,t,i){if(t.isLocationTrackingEnabled&&!i.isPermEnabled)return FrameworkCommon.showInfoAlert("",ZPI18N.getString("zp.requestuserlocation")+" "+ZPI18N.getString("zp.blockedlocation")),this.getImportInstance().getSliderModal().close(),!1;this.getImportInstance().getSliderModal().modalFooter.find("#saveButton").addClass("disabled").prop({disabled:!0}),e.find("[name="+csrfParamName+"]").val(csrfToken),e.find("[name=formId]").val(this.getImportInstance().getHandler().getFormId());let r=this.getImportInstance().getContainer().find('[elem="bulkUploadFile"]').val();if(null==r||null==r||""==r.trim())return this.getImportInstance().getContainer().find("[elem=bulkFileDropContainer]").addClass("fldrp_err"),FrameworkCommon.showError(ZPI18N.getString("zp.uploadfilewarning"),$(this.getImportInstance().getContainer().find("[elem=bulkFileDropContainer]"))),this.getImportInstance().getContainer().find("#saveButton").removeClass("disabled").prop({disabled:!1}),!1;if(this.getImportInstance().getIsWorkFlowAvailable()||this.getImportInstance().getIsApprovalConfigured()){if(this.getImportInstance().showAlertBeforeImportData())return this.getImportInstance().alertBeforeImportData(),!1;this.getImportInstance().getIsAlertAutomation()||(this.getImportInstance().getTriggerWorkflow()&&e.find("[name=workFlowOn]").val("on"),this.getImportInstance().getTriggerApproval()&&e.find("[name=approvalOn]").val("on"))}return t.isLocationTrackingEnabled&&i.isPermEnabled&&(e.find('input[name="latitude"]').val(i.latitude),e.find('input[name="longitude"]').val(i.longitude)),!0}_scheduleBulkImport(e){let t=this;ZPeople.Request.send("/zpformscommon/bulkImport/schedule",e,(e=>{e.isSuccess?ZPeople.Message.success(ZPI18N.getString("zp.bulkimportscheduled")):ZPeople.Message.failure(ZPI18N.getString("zp.bulkimportschedulefailed")),t.getImportInstance().getSliderModal().close()}),{},((e,i,r)=>{let s=(e,t,i)=>this.getImportInstance().getSliderModal().close();ServiceApplicabilityUtil.Error.showWarningMessage(e,i,r,s.bind(t))||(FrameworkCommon.failureCallback(e),s.call(t))}))}_importFileForFileId(e,t){this.showHideProgressBar(!0),this.getImportInstance().getContainer().find("[elem=bulkUploadFile],[elem=bulkUploadButton]").addClass("disabled").prop({disabled:!0});let i=new FormData;i.set("zipFile",e.get("zipFile")),i.set("formId",e.get("formId"));let r=this;ZPeople.Request.sendFormData("/zpformscommon/bulkImport/uploadFile",i,(e=>{e.isSuccess?(r.handleXhrResponse({fileInfo:e},!0),t.fileId=this.getImportInstance().getContainer().find("[elem=bulkUploadFile]").attr("fileId"),r._scheduleBulkImport(t)):r.handleFileUploadFailure(e)}),void 0,((e,t,i)=>{ServiceApplicabilityUtil.Error.showWarningMessage(e,t,i,((e,t,i)=>this.getImportInstance().getSliderModal().close()).bind(r))||r.handleFileUploadFailure(e)}))}forward(e,t){this.getImportInstance().setImportFormId(this.getImportInstance().getHandler().getFormId());let i=this.getImportInstance().getContainer().find("#"+BulkFileUploadV5UploadFile.getCardId()).find("form[elem=bulkFileUploadForm]");if(!this._forwardValidation(i,e,t))return;ZPeopleComponents.progressbar(this.getImportInstance().getContainer().find("[elem=BulkUploadProgressBar]"));let r=new FormData(i[0]),s=(this.getImportInstance().getSummaryInstance(),{mode:r.get("mode"),formId:r.get("formId"),importDataFor:r.get("importDataFor"),importBasedOn:r.get("importBasedOn"),proPicZipFileId:r.get("proPicZipFileId"),workFlowOn:r.get("workFlowOn"),separator:r.get("separator"),latitude:r.get("latitude"),longitude:r.get("longitude"),fileId:this.getImportInstance().getContainer().find("[elem=bulkUploadFile]").attr("fileId")});UDS_UPLOAD_IS_ACTIVE&&s.fileId?this._scheduleBulkImport(s):this._importFileForFileId(r,s)}}class BulkFileUploadV5Slider extends ImportV5Slider{constructor(e,t){super(),this.isPhoto=t}getModalHeader(){return this.isPhoto?ZPI18N.getString("zp.uploadphoto"):ZPI18N.getString("zp.bulkupload")}open(){let e=e=>{e.setCallback(this._callback.bind(this)),e.setValidate(this._validate.bind(this))};e.bind(this);let t=this.getImportInstance().getUploadInstance().getTab(),i=this.getImportInstance().getSummaryInstance().getTab();e(t),e(i),this.getImportInstance().setSliderModal(new fullPageModal(this.getModalHeader(),t,i)),this.getImportInstance().getSliderModal()._fullPageModalId="bulkFileUploadModal",this.getImportInstance().getSliderModal().topNavigation=!0,this.getImportInstance().getSliderModal().next=ZPI18N.getString("zp.submit"),this.getImportInstance().getSliderModal().setCloseCallback(this._close.bind(this)),this.getImportInstance().getSliderModal().construct(0),this.getImportInstance().getContainer().find("#"+BulkFileUploadV5UploadFile.getTabId()).addClass("disabled"),this.getImportInstance().getContainer().find("#"+BulkFileUploadV5Summary.getTabId()).addClass("disabled"),this.getImportInstance().getContainer().find("#saveButton").text(ZPI18N.getString("zp.submit")).addClass("disabled").prop({disabled:!0}),this.handleFooter(),this.getImportInstance().getSliderModal().open()}_validate(e){e._isValidated=!1,(!this.getImportInstance().getInitSummary()&&e.currentTab.id==BulkFileUploadV5UploadFile.getTabId()||this.getImportInstance().getInitSummary()&&e._stackCallTab.id==ImportV5Summary.getTabId())&&(e._isValidated=!0,e.showTab(e._stackCallTab))}_callback(e){this.getImportInstance().setContainer(e.mainWrapId.find(`#${e._fullPageModalId}`)),FrameworkCommon.hide(this.getImportInstance().getContainer().find("#tabLeftUl").parents(".zpl_mmnulft")),this.getImportInstance().getContainer().removeClass("zpl_mdltopnav"),e.isCardIntialCallback()&&(this.getImportInstance().getContainer().find("#"+e.currentTab.cardId).html(""),e.currentTab.id==ImportV5Summary.getTabId()&&this.getImportInstance().getContainer().find("#"+e.currentTab.cardId).append(this.getImportInstance().getSummaryInstance().getPage()),FrameworkCommon.addLoading(this.getImportInstance().getContainer().find("#"+e.currentTab.cardId))),this.handleFooter(e.currentTab.id==ImportV5Summary.getTabId())}handleFooter(e){let t=this.getImportInstance().getSliderModal().modalFooter;t.find("#saveButton, #cancelButton").addClass("disabled").prop({disabled:!0}).off("click"),FrameworkCommon.hide(t.find("#saveButton, #cancelButton")),t.html('<div><button id="cancelButton" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.cancel")+"</button></div>"),e?t.find("#cancelButton").text(ZPI18N.getString("zp.done")):(this.getImportInstance().setIsAlertAutomation(!0),t.append('<div><button id="saveButton" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.submit")+"</button></div>"),t.find("#saveButton").addClass("disabled").prop({disabled:!0}).on("click",this.getImportInstance().getUploadInstance().validate.bind(this.getImportInstance().getUploadInstance())),FrameworkCommon.show(t.find("#saveButton"))),t.find("#cancelButton").removeClass("disabled").prop({disabled:!1}).on("click",this._close.bind(this,this.getImportInstance().getSliderModal())),FrameworkCommon.show(t.find("#cancelButton"))}_close(e){e.remove(),this.getImportInstance().getRefresh()&&this.getImportInstance().getHandler().refreshCallback(),this.getImportInstance().getHandler().hashChangeCallback(),ZP5Import.destroy()}}class BulkFileUploadV5Summary extends ImportV5Summary{constructor(){super()}setInstances(){this.addInstance=new ImportV5SummaryData(ZP5Import.SUMMARY_DATA_TYPE.ADDED),this.addInstance.setSummaryInstance(this),this.errorInstance=new ImportV5SummaryData(ZP5Import.SUMMARY_DATA_TYPE.ERROR),this.errorInstance.setSummaryInstance(this)}setInitialValues(){this.isOnlySummary=!1,this.isTabularImport=!1,this.isBulkFileUpload=!0,this.isRecViewRestricted=!1}isAddUpdateRestricted(){return!1}getIsBulkFileUpload(){return!0}setImportUniqueId(e){this.importUniqId=e}getImportUniqueId(){return this.importUniqId}setImportFormId(e){this.importFormId=e}getImportFormId(){return this.importFormId}getPage(){let e='<div class="zpl_imprtrecordvw DNI" elem="bulkUploadSummaryDiv">';return e+='<div class="zpl_secn" elem="bulkUploadViewRecDiv"><div><div class="zpl_imprtrecord"><div elem="bulkUploadSuccessMsg"><i class="PI_tick2_fil grn"></i>'+ZPI18N.getString("zp.updateCalendarMsg")+"</div>",e+='<button elem="bulkUploadViewRecBtn" type="button" class="zlabel zlabel--blue zlabel--medium DNI">'+ZPI18N.getString("zp.viewRecords")+"</button>",e+="</div></div></div></div>",e+='<div class="zpl_btnmnu" elem="bulkUploadSummaryCountDiv"><div><ul class="zpl_grpmnu" elem="recordCountListDiv">',e+='<li elem="bulkUploadAddedDiv" actType="ADDED">'+ZPI18N.getString("zp.addedrecords")+'<b elem="bulkUploadAddedCount" actType="ADDED"></b></li>',e+='<li elem="bulkUploadErrorDiv" actType="ERROR">'+ZPI18N.getString("zp.recorderrors")+'<b elem="bulkUploadErrorCount" actType="ERROR"></b></li>',e+="</ul></div></div>",e+='<div class="zpl_rgtcnt" elem="summaryRecContDiv" id="summaryRecContDiv"><div class="zpl_tblres" elem="tableContainer">',e+='<div actType="ADDED"  elem="bulkUploadSummaryADDEDRecDiv"></div>',e+='<div actType="ERROR" elem="bulkUploadSummaryERRORRecDiv"></div>',e+="</div>",e+='<div elem="emptyDivContainer">',e+='<div actType="ADDED"></div>',e+='<div actType="ERROR"></div></div>',e+="</div>",e}initViaImport(e){this.getImportInstance().getContainer().find("#"+ImportV5Summary.getTabId()).addClass("zpl_tblfxd"),this.getImportInstance().setInitSummary(!0),this.setIsOnlySummary(!1),this.setContainer(this.getImportInstance().getContainer()),this.setSliderModal(this.getImportInstance().getSliderModal()),void 0!==e.error?(ZPeople.Message.failure(e.error),this.setSliderModal().close()):(this.getSliderModal().nextTab(!1),this.setImportUniqueId(e.impUniqueId),this.setImportFormId(this.getImportInstance().getImportFormId()),this.setFormId(this.getImportInstance().getImportFormId()),this.init(e,e.noofsuccess,e.failedList.length))}initOnlySummary(e,t,i,r){this.setIsOnlySummary(!0),this.setImportUniqueId(e),this.setImportFormId(t),this.setFormId(t),this.createSlider(),this.init(void 0,i,r)}createSlider(){let e=this.getTab();e.setCallback(function(e){this.setContainer(e.mainWrapId.find(`#${e._fullPageModalId}`)),FrameworkCommon.hide(this.getContainer().find("#tabLeftUl").parents(".zpl_mmnulft")),this.getContainer().removeClass("zpl_mdltopnav"),this.getContainer().find("#"+ImportV5Summary.getCardId()).html(this.getPage()).append(ZPeople.LOADING_HTML)}.bind(this)),this.setSliderModal(new fullPageModal(ZPI18N.getString("zp.ImportSummary"),e)),this.getSliderModal()._fullPageModalId="importSummaryModal",this.getSliderModal().topNavigation=!1,this.getSliderModal()._saveToggle=!1,this.getSliderModal()._previousToggle=!1,this.getSliderModal().construct(0),this.getSliderModal().open(),this.getSliderModal().setCloseCallback((e=>{e.remove(),ZP5Import.destroy()}));let t=this.getSliderModal().modalFooter;t.html('<div><button id="cancelButton" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.done")+"</button></div>"),t.find("#cancelButton").removeClass("disabled").prop({disabled:!1}).on("click",(()=>{this.getSliderModal().close()})),FrameworkCommon.show(t.find("#cancelButton")),this.getContainer().find("#"+ImportV5Summary.getTabId()).addClass("zpl_tblfxd")}init(e,t,i){if(this.getIsOnlySummary()||(e.hasOwnProperty("hasProfilePicDCF")&&(ZPeople.isProfilePicDCFEnabled=e.hasProfilePicDCF),this.getContainer().find("[elem=bulkUploadViewRecBtn]").off("click").on("click",(()=>{this.getSliderModal().close()})),FrameworkCommon.show(this.getContainer().find("[elem=bulkUploadViewRecBtn]")),this.getImportInstance().setRefresh(t>0)),this.getContainer().find("[elem=bulkUploadSummaryCountDiv] [elem=bulkUploadAddedCount]").html(t>=10?t:"0"+t),this.getContainer().find("[elem=bulkUploadSummaryCountDiv] [elem=bulkUploadErrorCount]").html(i>=10?i:"0"+i),t>0)FrameworkCommon.show(this.getContainer().find("[elem=bulkUploadSummaryDiv]"));else{let e=this.getContainer().find("[elem=summaryRecContDiv] [elem=emptyDivContainer] [actType=ADDED]");new EmptyPages("zp_nd_nodata1",ZPI18N.getString("zp.nodatafound"),"",e).show()}if(i>0)this.getIsOnlySummary()||(this.getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.ERROR).setIsInit(!1),this.getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.ERROR).setHasMore(!1),this.getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.ERROR).setRecCount(e.failedList.length),this.constructErrorContainer(e));else{let e=this.getContainer().find("[elem=summaryRecContDiv] [elem=emptyDivContainer] [actType=ERROR]");new EmptyPages("zp_nd_nodata1",ZPI18N.getString("zp.nodatafound"),"",e).show()}this.getContainer().find("[elem=bulkUploadSummaryCountDiv]").find("[elem=recordCountListDiv] li").off().on("click",function(e){this.getContainer().find("[elem=bulkUploadSummaryCountDiv]").find("[elem=recordCountListDiv] li").removeClass("zpl_act"),this.getContainer().find("[elem=bulkUploadSummaryCountDiv]").find('[elem=recordCountListDiv] li[actType="'+$(e.target).attr("actType")+'"]').addClass("zpl_act"),this.showRecContainer()}.bind(this)),this.getContainer().find("[elem=bulkUploadSummaryCountDiv]").find("[elem=recordCountListDiv] li:first").click()}constructErrorContainer(e){let t='<table class="zpl_tbl zpl_nocrsor" elem="bulkUploadErrorDiv" actType="ERROR">';t+='<thead elem="tableHeader"><tr><th style="width:10%">'+ZPI18N.getString("zp.filename")+"</th><th>"+ZPI18N.getString("zp.errorDetails")+"</th></tr></thead>",t+='<tbody elem="tableBody" pageDiv="1">',$.each(e.failedList,(function(e,i){t+='<tr><td style="width:10%">'+ZPeople.decodeTxt(i.filename)+"</td><td>"+ZPeople.decodeTxt(i.message)+"</td><tr>",0!=e&&e%200==0&&(t+='</tbody><tbody class="DNI" elem="tableBody" pageDiv="'+(e+1)+'">')})),t+="</tbody></table>",this.getContainer().find("[elem=summaryRecContDiv]").find("[elem=bulkUploadSummaryERRORRecDiv]").html(t),$(this.getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.ERROR).getPaginationDiv()).insertBefore(this.getSliderModal().modalFooter),this.getDataInstance(ZP5Import.SUMMARY_DATA_TYPE.ERROR).handlePagination()}showRecContainer(){let e=this.getContainer(),t=e.find("[elem=recordCountListDiv] li.zpl_act"),i=this.getDataInstance(t.attr("actType"));FrameworkCommon.hide(e.find("[elem=summaryRecContDiv] [elem=tableContainer]").children()),FrameworkCommon.hide(e.find("[elem=summaryRecContDiv] [elem=emptyDivContainer]").children()),e.find("#"+ImportV5Summary.getCardId()).find("[elem=summaryRecContDiv]").append(ZPeople.LOADING_HTML),e.find("[elem=summaryRecContDiv] [elem=tableContainer] div[actType="+i.getMode()+"]").children().length>0?i.showContainer(!1):e.find("[elem=summaryRecContDiv] [elem=emptyDivContainer] [actType="+i.getMode()+"]").children().length>0?i.showContainer(!0):i.getIsInit()?(i.setIsInit(!0),i.init(!0)):FrameworkCommon.removeLoading(this.getContainer().find("#"+ImportV5Summary.getCardId()).find("[elem=summaryRecContDiv]"))}}const ZP5ProfilePicture={CURROBJ:null,MODES:["empview","userprofile","useroperations"],init:(e,t,i)=>{ZP5ProfilePicture.handleMode(i)&&ZPeople.Request.sendRequest("/v5/profilepicture/transferdetails",{recordId:t},"GET",(i=>{if(i.isSuccess){(null==e||null==e)&&(e=$("body #modal_Container")),ZP5ProfilePicture.CURROBJ=new ProfilePhoto(e,t),ZP5ProfilePicture.CURROBJ.transferId=i.transferId,null==i.prevPhoto&&(i.prevPhoto="");let r=""==i.prevPhoto?ZPeople.getDefaultUserImagePath():"viewPhoto?filename="+i.prevPhoto.split("|")[1],s=""==i.curPhoto?ZPeople.getDefaultUserImagePath():"viewPhoto?filename="+i.curPhoto.split("|")[1],a=()=>{ZP5ProfilePicture.CURROBJ.getConfirmCropProfileConstruct(r,s,i.apprStatus)},n=ZPeople.getUserDetailsById(t),o="";n&&(o=ZPeople.getUserDisplayName(n.fname,n.lname)),ZP5ProfilePicture.CURROBJ.openSecondaryModal(o,a.bind(ZP5ProfilePicture.CURROBJ))}else{let i=null==e||null==e;i&&(e=$("body #modal_Container")),ZP5ProfilePicture.CURROBJ=new ProfilePhoto(e,t),ZP5ProfilePicture.CURROBJ.show(i)}}),{},FrameworkCommon.failureCallback)},approvalView:e=>{ZPeople.Request.sendRequest("/v5/profilepicture/approvalStatusDetails",{recordId:e},"GET",ProfilePictureTransfer.viewApproval,{},FrameworkCommon.failureCallback)},modelRemove:()=>{$("#tabprofilePhotoChangeForm").remove()},destroy:()=>{ZP5ProfilePicture.CURROBJ&&(ZP5ProfilePicture.CURROBJ._destroy(),ZP5ProfilePicture.CURROBJ=null)},handleMode:e=>!!ZP5ProfilePicture.MODES.includes(e)&&("useroperations"!==e||"organization"==settingsUrlProps.currentMode)};class profilePictureModal extends popupModal{constructor(e,t,i,r){super(e,t),this.erecno=i,this.setUserDetails(i),this.setIsAppendOnBody(r),this._setContainer()}setIsAppendOnBody(e){this.isAppendOnBody=e,this._setContainer()}getIsAppendOnBody(){return this.isAppendOnBody}setUserDetails(e){this.userDetails=ZPeople.getUserDetailsById(e)}getUserDetails(){return this.userDetails}_getUserFullName(){if(this.getUserDetails())return ZPeople.getUserDisplayName(this.userDetails.fname,this.userDetails.lname)}_getFullImageDiv(){return'<div elem="userProfileDts" class="zpl_em d-flexclmcap MB10"></div>'}_getUserNameWithEmpId(){if(this.getUserDetails()){let e=this.userDetails.empid?this.userDetails.empid:"",t="<em>"+e+" "+(""==this._getUserFullName()||""==e?"":"- ")+"</em><b>"+this._getUserFullName()+"</b>";return'<div class="zpl_emdts" title="'+(e+(""==this._getUserFullName()||""==e?"":" - ")+this._getUserFullName())+'"><div>'+t+"</div></div>"}}_getImageByUrl(e){return'<div elem="imgDiv" class="zpl_emimg">'+this._getImageTag(e)+"</div>"}_getImageTag(e){return'<img elem="imgEle" src="'+e+'">'}_getUserImage(){if(this.getUserDetails()){let e=ZPUtil.Validation.isEmpty(this.userDetails.zpeoplePhoto)?""+this.userDetails.avatar:""+this.userDetails.zpeoplePhoto;if(e)return this._getImageByUrl(e)}}_getUserFullImage(e){if(this.getUserDetails()){let t=this.getUserDetails().originalphoto;if(t)return e?this._getImageTag(t):this._getImageByUrl(t)}}_setContainer(){this.container=this.getIsAppendOnBody()?$("body #modal_Container"):$(settingsPage.container)}getContainer(){return this.container}construct(){if(this.mainWrapId=this.getContainer(),this.sliderDiv=this.mainWrapId.find("#"+this.tab.id),this.sliderDiv.length>0)this.open();else{this.mainWrapId.append('<div id="'+this.tab.id+'" class="zpl_mdl zpl_mcenter zpl_mopen zpl_msm zpl_phtprevw" tabindex=0> <div class="zpl_minr ovv"> <a id="sliderCls" class="PI_cls _cls" title="'+ZPI18N.getString("zp.close")+'"></a> <div id="'+this.tab.cardId+'" class="zpl_mcnt P0I"> </div> <div class="zpl_phtacts zpl_mfoter zpl_DNI" elem="modalFooter"></div> </div> </div>'),this.tab.cardIdDiv=this.mainWrapId.find("#"+this.tab.id).find("#"+this.tab.cardId),this.sliderDiv=this.mainWrapId.find("#"+this.tab.id);let e=this;this.sliderDiv.find("#sliderCls").off().on("click",(function(){e.close()})),this.sliderDiv.on("keyup",(function(t){27==t.keyCode&&e.close()})),this.sliderDiv.focus(),this._callCallback(this.tab.callback)}}setChangePhotoCallback(e){this.changeCallback=e}setCropPhotoCallback(e){this.cropCallback=e}tabElem(){return this.getContainer().find(`#${this.tab.id}`)}cardElem(){return this.getContainer().find(`#${this.tab.cardId}`)}showFooter(e,t){let i=this.tabElem().find("[elem=modalFooter]"),r='<button class="zlabel zlabel--blue zlabel--medium zlabel--outline" elem="changePhoto" type="button"><i class="PI_edt"></i>'+ZPI18N.getString("zp.changeprofilepicture")+"</button>",s='<button class="zlabel zlabel--blue zlabel--medium zlabel--outline" elem="cropPhoto" type="button"><i class="PI_crop"></i>'+ZPI18N.getString("zp.cropphoto")+"</button>";i.html(""),(e||t)&&(e&&(i.append(r),this.changeCallback&&i.find("[elem=changePhoto]").off("click").on("click",this.changeCallback)),t&&(i.append(s),this.cropCallback&&i.find("[elem=cropPhoto]").off("click").on("click",this.cropCallback)),i.removeClass("zpl_DNI"))}}class ProfilePhoto{constructor(e,t,i){this._setRecordId(t),this._setContainer(e),this._setMode(i)}_getPriModalName(){return"ProfilePic"}_getSecModalName(){return"ChangeCropPhoto"}_setContainer(e){this.container=e}_setMode(e){this.mode=e}getMode(){return this.mode}_setRecordId(e){this.recordId=e}getContainer(){return this.container}getIsAppendOnBody(){return this._getProModal().getIsAppendOnBody()}_destroy(){this._getSecondaryModal()&&(this._getSecondaryModal().sliderDiv.find("#pendingButton")&&this._getSecondaryModal().sliderDiv.find("#pendingButton").remove(),this._getSecondaryModal().remove(),this._getSecondaryModal()),this._getProModal()&&(this._getProModal().remove(),this._getProModal()),this._setSecondaryModalValuesAsEmpty(),this.proPopModal=""}_setSecondaryModalValuesAsEmpty(){this.changedPicPath="",this.changedPicUrl="",this.changedPicStat="",this.jcropPositions={},this.newImgFullId="",this.secondaryProModal=""}getRecordId(){return this.recordId}_setProfilePicModal(e){this.proPopModal=e}_getProModal(){return this.proPopModal}_setSecondProfilePicModal(e){this.secondaryProModal=e}_getSecondaryModal(){return this.secondaryProModal}_getConstruct(){this._getProModal().sliderDiv.find("#card"+this._getPriModalName()).html(ZPeople.LOADING_HTML),this._showProModalImage()}_showProModalImage(){this._getProModal().sliderDiv.find("#card"+this._getPriModalName()).empty(),this._getProModal().sliderDiv.find("#card"+this._getPriModalName()).html(this._getProModal()._getFullImageDiv()),this._getProModal().sliderDiv.find("#card"+this._getPriModalName()+" [elem=userProfileDts]").append(this._getProModal()._getUserImage()),this._getProModal().sliderDiv.find("#card"+this._getPriModalName()+" [elem=userProfileDts]").append(this._getProModal()._getUserNameWithEmpId())}_setChangedPicPath(e){this.changedPicPath=e}_getChangedPicPath(){return this.changedPicPath}_setChangedPicUrl(e){this.changedPicUrl=e}_getChangedPicUrl(){return this.changedPicUrl}_setChangedPicStat(e){this.changedPicStat=e}_getChangedPicStat(){return this.changedPicStat}_setJCropPositions(e){this.jcropPositions||(this.jcropPositions={}),this.jcropPositions.x=parseInt(e.x),this.jcropPositions.width=parseInt(e.w),this.jcropPositions.y=parseInt(e.y),this.jcropPositions.height=parseInt(e.h)}_setProfileSuccessCallback(e,t,i){if("success"==e.status){e.hasOwnProperty("hasProfilePicDCF")&&(ZPeople.isProfilePicDCFEnabled=e.hasProfilePicDCF);let i=e.transferId;if(ZPeople.isProfilePicDCFEnabled&&!e.isUpdated)return this._hideLoadingInSecModal("diffCont"),this._getSecondaryModal().sliderDiv.find("#modalFooter").remove(),this._getSecondaryModal().sliderDiv.find("#sliderCls").before(this.getStatusDiv(this.getRecordId(),"pending")),$("#tabProfilePic")&&$("#tabProfilePic").remove(),void $("#zp_pending_comment_btn").on("click",(function(){$("#tabChangeCropPhoto")&&$("#tabChangeCropPhoto").show(),ZPeople.Request.sendRequest("/v5/profilepicture/approvalStatusDetails",{recordId:i},"GET",ProfilePictureTransfer.getApprovalDetails,{},FrameworkCommon.failureCallback)}));let r=ZPeople.getUserDetailsById(t.recordId);if(void 0!==e.images&&""!==e.images)e.images.split("|").length>0&&void 0!==t.recordId&&(r.avatarid=e.avatarid,ZPeople.setPhotoURL("1",void 0,r));if(ZPeople.Message.success(ZPI18N.getString("zp.photouploadedsuccessfully")),this._getSecondaryModal()&&(this._getSecondaryModal().sliderDiv.find("#pendingButton")&&this._getSecondaryModal().sliderDiv.find("#pendingButton").remove(),this._getSecondaryModal().remove(),this._getSecondaryModal()),this._getProModal()){let e=this.getIsAppendOnBody()?null:this.getContainer();this._getProModal().remove(),this._getProModal(),ZP5ProfilePicture.destroy(),ZP5ProfilePicture.init(e,this.getRecordId(),this.getMode())}$("img[empid="+r.usererec+"][elem=profilePhoto], img[empid="+r.id+"][elem=profilePhoto]").each((function(){var e=$(this).attr("imgtype");this.src="thumb"===e?r.thumb:"original"===e?r.originalphoto:"zpimg"===e?r.zpeoplePhoto:r.avatar}))}else e.hasOwnProperty("message")?ZPeople.Message.failure(e.message):"DIFFERENT_USER"===e.response?ZPeople.Message.failure(ZPI18N.getString("zp.unabletoprocess")):ZPeople.Message.failure(ZPI18N.getString("zp.unabletoconnectwithserver")),this._hideLoadingInSecModal("diffCont"),this._getSecondaryModal().sliderDiv.find("sliderSbt").removeClass("disabled")}_showLoadingInSecModal(e){this._getSecondaryModal().sliderDiv.find("#sliderSbt").addClass("disabled"),FrameworkCommon.hide(this._getSecondaryModal().sliderDiv.find("[elem="+e+"]").children()),this._getSecondaryModal().sliderDiv.find("[elem="+e+"]").append(ZPeople.LOADING_HTML)}_hideLoadingInSecModal(e){this._getSecondaryModal().sliderDiv.find("#sliderSbt").removeClass("disabled"),this._getSecondaryModal().sliderDiv.find("#zp_page_loading").remove(),FrameworkCommon.show(this._getSecondaryModal().sliderDiv.find("[elem="+e+"]").children())}_setNewProfilePhoto(){let e={mode:"addProfilePicRow",recordId:this.getRecordId()};this._getNewImgFullId()&&(e.photoId=this._getNewImgFullId());this._showLoadingInSecModal("diffCont"),ZPeople.Request.send("/transfers.zp",e,this._setProfileSuccessCallback.bind(this),void 0,((e,t,i)=>{this._hideLoadingInSecModal("diffCont"),FrameworkCommon.failureCallback(e,t,i)}).bind(this))}_getJCropPositions(){return this.jcropPositions}_isChangePhotoAllowed(){if(this._getProModal().getUserDetails()){let e=this._getProModal().getUserDetails();if(erecno===e.usererec&&"0"===orgPhotoDisplayType||isadmin||ZPeople.isAssignedUserAdmin)return!0}return!1}_isCropImageAllowed(){if(this._getProModal().getUserDetails()){let e=this._getProModal().getUserDetails();if(this._isChangePhotoAllowed()&&e.hasZPImg)return!0}return!1}show(e){this._getSecondaryModal()&&this._getSecondaryModal().remove(),this.getContainer().Modal=new profilePictureModal("",new Tab(this._getPriModalName(),this._getConstruct.bind(this)),this.getRecordId(),e),this._setProfilePicModal(this.getContainer().Modal),this._getProModal().construct();let t=()=>{this._getProModal().remove(),this._getProModal(),this.proPopModal="",ZP5ProfilePicture.destroy()};this._getProModal().closeCallback=t.bind(this),this._getProModal().sliderDiv.find("#sliderCls").off("click").on("click",t.bind(this));let i=this._isChangePhotoAllowed(),r=this._isCropImageAllowed();i&&this._getProModal().setChangePhotoCallback(this.showChangeProfile.bind(this)),r&&this._getProModal().setCropPhotoCallback(this.showCropProfile.bind(this)),this._getProModal().showFooter(i,r)}_resetFileHolder(e){e&&e.sliderDiv.find("input[name=fileToUpload]").length>0&&(e.sliderDiv.find("input[name=fileToUpload]")[0].files=(new DataTransfer).files)}_changePicSuccessCallback(e,t,i){if(e&&e.isSuccess){if(i&&i.currentSecModal!=this._getSecondaryModal())return;this._setChangedPicPath(e.path),this._setChangedPicUrl(e.photoUrl),this._setChangedPicStat(e.photoStat),this.showCropProfile()}else if(e&&e.error){this._resetFileHolder(i.currentSecModal),this._hideLoadingInSecModal("pictureDropcont");let t=ZPI18N.getString("zp.sorryservererror");if("ERROR"==e.error)return void ZPeople.Message.warning(ZPI18N.getString("zp.rebranderrinaction"));"NO_PERMISSION"==e.error?t=ZPI18N.getString("zp.permdenied"):"RES_ERROR"==e.error&&e.hasOwnProperty("msg")&&e.msg&&(t=e.msg),ZPeople.Message.failure(t)}}_getCropProfileConstruct(){this._getSecondaryModal().sliderDiv.addClass("zpl_mmd"),this._getSecondaryModal().sliderDiv.find("#card"+this._getSecModalName()).html(ZPeople.LOADING_HTML),this._getSecondaryModal().sliderDiv.find("#sliderSbt").text("Crop").addClass("zlabel--outline");let e='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_upld"><div elem="imgDiv" class="zpl_upld-orignlimg">'+(this._getChangedPicUrl()?this._getProModal()._getImageTag(this._getChangedPicUrl()):this._getProModal()._getUserFullImage(!0))+"</div></div></div></div>";this._getSecondaryModal().sliderDiv.find("#card"+this._getSecModalName()).html(e),this._getSecondaryModal().sliderDiv.find("[elem=imgEle]").css("cursor","crosshair");let t=this._getSecondaryModal().sliderDiv.find("[elem=imgEle]"),i=new Image;i.src=t.attr("src"),FrameworkCommon.hide(t),i.onload=()=>{let e=i.naturalWidth,r=i.naturalHeight;FrameworkCommon.show(t),t.Jcrop({bgColor:"white",onSelect:this._setJCropPositions.bind(this),bgFade:!0,bgOpacity:.7,minSize:[75,75],aspectRatio:1,boxWidth:800,boxHeight:400,trueSize:[e,r]},(function(){this.setSelect((e=>{let t=e.ui.holder;var i=$(t).width(),r=$(t).height();if(i==r)return[0,0,i,r];if(i<r){var s=i;return[0,a=Math.round((r-i)/2),0,a+s]}if(i>r){var a;s=r;return[a=Math.round((i-r)/2),0,a+s,0]}})(this))}))}}cropImagecallback(e,t,i){let r=this._getJCropPositions();r.recordId=this.getRecordId(),this._getChangedPicPath()&&(r.uploadFile=this._getChangedPicPath());this._showLoadingInSecModal("imgDiv");let s={...r};this._getSecondaryModal()&&this._getSecondaryModal().sliderDiv.find("#pendingButton")&&this._getSecondaryModal().sliderDiv.find("#pendingButton").remove(),s.currentSecModal=this._getSecondaryModal(),ZPeople.Request.send("/cropImg.zp",r,this.showConfirmProfile.bind(this),s,((e,t,i)=>{this._hideLoadingInSecModal("imgDiv"),FrameworkCommon.failureCallback(e,t,i)}).bind(this))}_getConfirmCropProfileConstruct(e,t){this._getSecondaryModal().sliderDiv.find("#card"+this._getSecModalName()).html(ZPeople.LOADING_HTML),this._getSecondaryModal().sliderDiv.find("#sliderSbt").text(ZPI18N.getString("zp.setasprofilephoto")),this._getSecondaryModal().sliderDiv.find("#sliderCancel").text(ZPI18N.getString("zp.lms.changePhoto"));this._getSecondaryModal().sliderDiv.find("#card"+this._getSecModalName()).html('<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_upld"><div elem="diffCont" class="zpl_upld-cropimg"></div></div></div></div>');let i=(e,t)=>'<div class="d-flexclm8 zpl_em">'+this._getProModal()._getImageByUrl(t)+'<div class="zpl_emdts">'+e+"</div></div>";null!=e&&this._getSecondaryModal().sliderDiv.find("[elem=diffCont]").append(i(ZPI18N.getString("zp.profilephoto.current"),e)),this._getSecondaryModal().sliderDiv.find("[elem=diffCont]").append(i(ZPI18N.getString("zp.profilephoto.new"),t))}_setNewImgFullId(e){e&&(this.newImgFullId=e)}_getNewImgFullId(){return this.newImgFullId}showConfirmProfile(e,t,i){if(!i||i.currentSecModal==this._getSecondaryModal())if(e.success){this._setNewImgFullId(e.Photo);let t=""==e["Photo.PREVIOUS"]?ZPeople.getDefaultUserImagePath():"viewPhoto?filename="+e["Photo.PREVIOUS"].split("|")[1],i=""==e.Photo?ZPeople.getDefaultUserImagePath():"viewPhoto?filename="+e.Photo.split("|")[1],r=()=>{this._getConfirmCropProfileConstruct(t,i)};this._openSecondaryModal(this._getProModal()._getUserFullName(),r.bind(this),this._setNewProfilePhoto.bind(this)),this._getSecondaryModal().sliderDiv.find("#sliderCancel").off("click").on("click",this.showChangeProfile.bind(this))}else e.hasOwnProperty("message")?ZPeople.Message.failure(e.message):"DIFFERENT_USER"===e.response?ZPeople.Message.failure(ZPI18N.getString("zp.unabletoprocess")):"NOT_ALLOWED"===e.response?ZPeople.Message.failure(ZPI18N.getString("zp.permdenied")):ZPeople.Message.failure(ZPI18N.getString("zp.unabletoconnectwithserver")),this._hideLoadingInSecModal("imgDiv"),this._getSecondaryModal().sliderDiv.find("sliderSbt").removeClass("disabled")}showCropProfile(){this._openSecondaryModal(ZPI18N.getString("zp.cropphoto"),this._getCropProfileConstruct.bind(this),this.cropImagecallback.bind(this))}_openProModal(){this._getSecondaryModal()&&(this._getSecondaryModal().remove(),this._getSecondaryModal()),this._setSecondaryModalValuesAsEmpty(),this._getProModal().open(),this._getProModal().sliderDiv.focus()}_onImageChangeCallback(e){let t=this._getSecondaryModal().sliderDiv.find("[elem=picElem]");if(!e.target&&e[0]){let i=new DataTransfer;i.items.add(e[0]),t[0].files=i.files}if(""!=t.val())if(ZPUtil.isAllowedFormatForImage(t.val()))if(ZPUtil.isFileSizeExceed(t,null,!0))ZPeople.Message.warning(ZPI18N.getString("zp.photolengthwarning"));else{this._showLoadingInSecModal("pictureDropcont");let e=new FormData(t.parents("[elem=uploadPicture]")[0]);e.set("recordId",this.getRecordId());let i={currentSecModal:this._getSecondaryModal(),fileElement:t};ZPeople.Request.sendFormData("/PhotoUpload.zp",e,this._changePicSuccessCallback.bind(this),i,((e,t,i)=>{this._resetFileHolder(i.currentSecModal),this._hideLoadingInSecModal("pictureDropcont"),FrameworkCommon.failureCallback(e,t,i)}))}else ZPeople.Message.warning(ZPI18N.getString("zp.allowedimagetypes"))}_getChangeProfileConstruct(){this._getSecondaryModal().sliderDiv.find("#card"+this._getSecModalName()).html(ZPeople.LOADING_HTML);let e='<form elem="uploadPicture"><div elem="profileCont" class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_upld" data-popup-open="CropPhoto"><div class="zpl_secn"><div></div></div><div elem="pictureDropcont" class="zpl_fldrp"><div class="zpl_flupld_img"></div><h4>'+ZPI18N.getString("zp.dragaprofilephotohere")+"</h4><p>"+ZPI18N.getString("zp.or")+'</p><input class="zpl_DNI" elem="picElem" accept=".jpeg,.jpg,.png,.gif" type="file" id="fileToUpload" name="fileToUpload"><button elem="fileUploadBtn" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.selectaphotofromyourcomputer")+"</button></div><p><span>"+ZPI18N.getString("zp.supportsFileForOrgLogo")+"</span><span>"+ZPI18N.getString("zp.impmaxsize")+": 2MB</span></p></div></div></div></form>";this._getSecondaryModal().sliderDiv.find("#card"+this._getSecModalName()).html(e),this._getSecondaryModal().sliderDiv.find("[elem=fileUploadBtn]").off("click").on("click",(function(e){$(e.target).siblings("[elem=picElem]").trigger("click")})),FrameworkCommon.initDragDropFiles(this._getSecondaryModal().sliderDiv.find('[elem="pictureDropcont"]'),this._getSecondaryModal().sliderDiv.find('[elem="profileCont"]'),this._onImageChangeCallback.bind(this),1),this._getSecondaryModal().sliderDiv.find('[elem="pictureDropcont"]').off("change").on("change",this._onImageChangeCallback.bind(this)),this._getSecondaryModal().sliderDiv.find("#modalFooter").remove()}_openSecondaryModal(e,t,i){this._getSecondaryModal()&&(this._getSecondaryModal().sliderDiv.find("#pendingButton")&&this._getSecondaryModal().sliderDiv.find("#pendingButton").remove(),this._getSecondaryModal().remove(),this._getSecondaryModal(),this.secondaryProModal=""),this._getProModal().close(!0),this.getContainer().secondaryModal=new popupModal(e,new Tab(this._getSecModalName(),t,i)),this._setSecondProfilePicModal(this.getContainer().secondaryModal),this._getSecondaryModal().setContainerAsBody(!0),this._getSecondaryModal().setCloseCallback(this._openProModal.bind(this)),this._getSecondaryModal().construct(),this._getSecondaryModal().sliderDiv.attr("uniqueId",(new Date).getTime())}showChangeProfile(){this._openSecondaryModal(ZPI18N.getString("zp.uploadphoto"),this._getChangeProfileConstruct.bind(this))}getConfirmCropProfileConstruct(e,t,i){let r=this._getSecondaryModal().sliderDiv;r.find("#card"+this._getSecModalName()).html(ZPeople.LOADING_HTML),r.find("#sliderSbt").remove(),r.find("#sliderCancel").remove();let s;r.find("#card"+this._getSecModalName()).html('<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_upld"><div elem="diffCont" class="zpl_upld-cropimg"></div></div></div></div>'),["#pendingButton","#approvedButton","#rejectedButton"].forEach((e=>{r.find(e).remove()}));let a=ZPI18N.getString("zp.profilephoto.old");if(1===i?s="approved":-1===i?(s="pending",a=ZPI18N.getString("zp.profilephoto.current")):0===i&&(s="rejected"),s){const e=this.getStatusDiv(this.transferId,s),t="#"+("approved"===s?"zp_approved_comment_btn":"pending"===s?"zp_pending_comment_btn":"zp_rejected_comment_btn");r.find("#sliderCls").before(e),$(t).on("click",(function(){ZPeople.Request.sendRequest("/v5/profilepicture/approvalStatusDetails",{recordId:$(this).attr("transferId")},"GET",ProfilePictureTransfer.getApprovalDetails,{},FrameworkCommon.failureCallback)}))}let n=(e,t)=>'<div class="d-flexclm8 zpl_em"><div elem="imgDiv" class="zpl_emimg"><img elem="imgEle" src="'+t+'"></div><div class="zpl_emdts">'+e+"</div></div>";r.find("[elem=diffCont]").append(n(a,e)),r.find("[elem=diffCont]").append(n(ZPI18N.getString("zp.profilephoto.new"),t))}openSecondaryModal(e,t,i){this._getSecondaryModal()&&(this._getSecondaryModal().sliderDiv.find("#pendingButton")&&this._getSecondaryModal().sliderDiv.find("#pendingButton").remove(),this._getSecondaryModal().remove()),this.getContainer().secondaryModal=new popupModal(e,new Tab(this._getSecModalName(),t,i)),this._setSecondProfilePicModal(this.getContainer().secondaryModal),this._getSecondaryModal().setContainerAsBody(!0),this._getSecondaryModal().construct();let r=this._getSecondaryModal();this._getSecondaryModal().sliderDiv.find("#sliderCls").off().on("click",(function(){r.sliderDiv.removeClass("zpl_mopen"),r.sliderDiv.remove(),ZP5ProfilePicture.CURROBJ.isFromUrl&&(window.location.href="#home/myspace/overview-actionlist")})),this._getSecondaryModal().sliderDiv.attr("uniqueId",(new Date).getTime())}getStatusDiv(e,t){const i={pending:{iconClass:"PI_ap_pending",textKey:"zp.pending",btnId:"zp_pending_comment_btn"},approved:{iconClass:"PI_ap_approved",textKey:"zp.approved",btnId:"zp_approved_comment_btn"},rejected:{iconClass:"PI_ap_reject",textKey:"zp.rejected",btnId:"zp_rejected_comment_btn"}}[t];return`<span id="${t}Button" class="zpl_mhderrgt"><div class="zpl_frmstus"><i class="${i.iconClass}"></i><span>${ZPI18N.getString(i.textKey)}</span><button id="${i.btnId}" transferId="${e}" class="zlabel zlabel--blue zlabel--small">${ZPI18N.getString("zp.view")}</button></div></span>`}}var ProfilePictureTransfer={getApprovalDetails:(e,t)=>{if(e.success){let t={formId:e.result.formId,recordId:e.result.recordId,method:"getApprovalDetails"};ZPeople.Request.sendAsyncPost("/getApprovalDetails.zp",t,(function(e){if(!e.errorMsg){let i=new ApprovalParam(e.approvalSettingsDetails.formId,t.recordId,e.currentApprovalStatus,e.isOwner),r=new LayoutParam(void 0,$("div.zpl_mhder"),$("div#singleRecordRoot"),void 0,void 0);new ApprovalTimeline(i,r).open()}}),null,FrameworkCommon.failureCallback)}},photoTransferModel:(e,t)=>{ZPeople.Request.sendRequest("/v5/profilepicture/oldAndNewPhoto",{transferId:e},"GET",(i=>{if(i.isSuccess){let r;(null==r||null==r)&&(r=$("body #modal_Container")),null==i.oldPhoto&&(i.oldPhoto=""),ZP5ProfilePicture.CURROBJ=new ProfilePhoto(r,e),ZP5ProfilePicture.CURROBJ.transferId=e,ZP5ProfilePicture.CURROBJ.isFromUrl=t;let s=""==i.oldPhoto?ZPeople.getDefaultUserImagePath():"viewPhoto?filename="+i.oldPhoto.split("|")[1],a=""==i.newPhoto?ZPeople.getDefaultUserImagePath():"viewPhoto?filename="+i.newPhoto.split("|")[1],n=()=>{ZP5ProfilePicture.CURROBJ.getConfirmCropProfileConstruct(s,a,i.apprStatus)},o=ZPeople.getUserDetailsById(i.erecno),l="";o&&(l=ZPeople.getUserDisplayName(o.fname,o.lname)),ZP5ProfilePicture.CURROBJ.openSecondaryModal(l,n.bind(ZP5ProfilePicture.CURROBJ))}}),{},FrameworkCommon.failureCallback)}};