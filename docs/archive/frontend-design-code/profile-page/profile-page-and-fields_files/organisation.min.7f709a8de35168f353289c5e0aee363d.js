var SubscriptionDetails={init:function(){if(isadmin||isSubscriptionAdmin){var container=$('<div class="zpl_rgtcnt zpl_orgsubsc"></div>');settingsPage.container.append(container);ZPeople.Request.send("subscriptionAction/getInfo",{},function(res){SubscriptionDetails.constructPlanDetails(res,container),SubscriptionDetails.constructDetails(res,container)})}},constructPlanDetailsHeader:function(res){var trialHTML=this.constructTrialDetails(res),html='<div class="zpl_crd"><div class="zpl_crdhdr"><div><div><h4><span class="ylw">'+res.planName+(1==res.planId||res.isTrial?" - </span>"+trialHTML+"</h4>":"")+(1==res.planId||res.isTrial?"":"<p>"+ZPI18N.getString("zp.BillingCycle")+' - <b class="blk">'+res.payPeriod+"</b> | "+ZPI18N.getString("zp.duedate")+' - <b class="blk">'+res.DueDays+"</b></p>")+'</div></div><div class="zpl_rgt"><div class="zpl_updtmelne"></div><div class="zlabel zlabel--yellow zlabel--outline zlabel--medium" onclick="SubscriptionDetails.openStore()">'+ZPI18N.getString("zp.managesubscription")+"</div>"+(isSuperAdmin&&!Layout.isPeoplePlus?'<div class="zlabel zlabel--red zlabel--primary zlabel--medium" onclick="ZPCloseOrg.Page.init()">'+ZPI18N.getString("zp.closeaccount")+"</div>":"")+"</div></div></div>";return $(html)},constructPlanDetails:function(res,container){var planHTML=this.constructPlanDetailsHeader(res);container.append(planHTML);var userObj=res.usage.USERCOUNT,nonuserObj=res.usage.NONUSERCOUNT,outerDiv=(nonuserObj.total,this.getDualCardContainer(0,container)),header=this.constructHeader(ZPI18N.getString("zp.userlicense"),ZPI18N.getString("zp.userdesc")),body=this.constructBodyContainer(header,!0,"userChart");(tableObj=[{},{}])[0][ZPI18N.getString("zp.settings.Limit")]=userObj.total,tableObj[1][ZPI18N.getString("zp.Used")]=userObj.used;var row=this.constructRow(tableObj);body.append(row),(tableObj=[{}])[0][ZPI18N.getString("zp.lms.course.Available")]=userObj.balance,row=this.constructRow(tableObj),body.append(row),outerDiv.append(header);header=this.constructHeader(ZPI18N.getString("zp.employeeprofilelicense"),ZPI18N.getString("zp.employeeprofiledesc")),body=this.constructBodyContainer(header,!0,"nonuserChart");(tableObj=[{},{}])[0][ZPI18N.getString("zp.settings.Limit")]=nonuserObj.total,tableObj[1][ZPI18N.getString("zp.Used")]=nonuserObj.used;var tableObj;row=this.constructRow(tableObj);body.append(row),(tableObj=[{}])[0][ZPI18N.getString("zp.lms.course.Available")]=nonuserObj.balance,row=this.constructRow(tableObj),body.append(row),outerDiv.append(header),SubscriptionDetails.constructUserCircleChart("userChart",userObj.total,userObj.used,!0),SubscriptionDetails.constructUserCircleChart("nonuserChart",nonuserObj.total,nonuserObj.used,!0)},constructDetails:function(res,container){var cardCount=0,formUsageObj=res.usage.FORMCOUNT,reportUsageObj=res.usage.REPORTCOUNT,hasForms=formUsageObj.total>0,hasReports=reportUsageObj.total>0&&reportUsageObj.used>0;reportUsageObj.used=reportUsageObj.used;var outerDiv=this.getDualCardContainer(cardCount,container);if(hasForms){var header=this.constructHeader(ZPI18N.getString("zp.forms"),ZPI18N.getString("zp.formsdesc")),body=this.constructBodyContainer(header,!0,"formUsageChart"),formTableObj=[{},{}];formTableObj[0][ZPI18N.getString("zp.settings.Limit")]=formUsageObj.defaultVal+formUsageObj.addonVal,formTableObj[1][ZPI18N.getString("zp.Used")]=formUsageObj.used;var row=this.constructRow(formTableObj);body.append(row),(formTableObj=[{}])[0][ZPI18N.getString("zp.lms.course.Available")]=formUsageObj.balance,row=this.constructRow(formTableObj),body.append(row),outerDiv.append(header),cardCount++}if(hasReports){header=this.constructHeader(ZPI18N.getString("zp.reports"),ZPI18N.getString("zp.reportsdesc")),body=this.constructBodyContainer(header,!0,"reportUsageChart");var reportTableObj=[{},{}];reportTableObj[0][ZPI18N.getString("zp.settings.Limit")]=reportUsageObj.used,reportTableObj[1][ZPI18N.getString("zp.Used")]=reportUsageObj.used;row=this.constructRow(reportTableObj);body.append(row),(reportTableObj=[{}])[0][ZPI18N.getString("zp.lms.course.Available")]=0,row=this.constructRow(reportTableObj),body.append(row),outerDiv.append(header),cardCount++}if(hasForms&&SubscriptionDetails.constructUserCircleChart("formUsageChart",formUsageObj.total,formUsageObj.used,!1),hasReports&&SubscriptionDetails.constructUserCircleChart("reportUsageChart",reportUsageObj.total,reportUsageObj.used,!1),outerDiv=this.getDualCardContainer(cardCount,container,outerDiv),1e3==reportUsageObj.addonVal&&res.addons.push(ZPI18N.getString("zp.reports")),res.addons.length>0){header=this.constructHeader(ZPI18N.getString("zp.addon"),ZPI18N.getString("zp.addondesc")),body=this.constructBodyContainer(header,!1);for(addon of res.addons){row=this.constructRow(addon,1,200,!0);body.append(row)}outerDiv.append(header),cardCount++}(outerDiv=this.getDualCardContainer(cardCount,container,outerDiv)).append(this.getContactDetails(res))},getContactDetails:function(res){var contactHTML=this.constructHeader(ZPI18N.getString("zp.ContactInformation"));isadmin&&contactHTML.find(".zpl_crdhdr").append('<div><div class="zpl_icncnt" onclick="SubscriptionDetails.navigateToCompanySetup()"><div class="zpl_hvr"><i class="PI_edt"></i></div></div></div>');var body=this.constructBodyContainer(contactHTML);return body.append('<tr><td width="200"><em><b>'+ZPI18N.getString("zp.AccountOwner")+"</b></em></td><td><span>"+ZSEC.Encoder.encodeForHTML(res.contactName)+"</span></td></tr>"),body.append('<tr><td width="200"><em><b>'+ZPI18N.getString("zp.contactEmailsub")+"</b></em></td><td><span>"+ZSEC.Encoder.encodeForHTML(res.contactMail)+"</span></td></tr>"),body.append('<tr><td width="200"><em><b>'+ZPI18N.getString("zp.companyname")+"</b></em></td><td><span>"+ZSEC.Encoder.encodeForHTML(res.companyName)+"</span></td></tr>"),contactHTML},navigateToCompanySetup(){window.location.hash="#settings/service/accountsetup/companydetails"},getDualCardContainer:function(addedCardsCount,parentContainer,currentContainer){if(addedCardsCount%2==0||void 0===currentContainer){var outerDiv=$('<div class="zpl_crdcvr"></div>');return parentContainer.append(outerDiv),outerDiv}return currentContainer},constructHeader:function(name,description){var header=$('<div class="zpl_crd"></div>');return header.append('<div class="zpl_crdhdr"><div><h4 class="ylw">'+name+"</h4><p>"+(description||"")+"</p></div></div>"),header},constructBodyContainer:function(container,hasChart,chartID){return hasChart?container.append('<div class="zpl_crdcnt flx"><div class="zpl_rptcht" id="'+chartID+'"></div><div class="zpl_gbox zpl_subscrion"><table class="zpl_itbl"><tbody></tbody></table></div></div>'):container.append('<div class="zpl_crdcnt"><div class="zpl_gbox"><table class="zpl_itbl"><tbody></tbody></table></div></div>'),container.find("tbody")},constructRow:function(valObj,colSpan,width,isAddon){var row=$("<tr></tr>");if(isAddon)row.append('<td width="200"><b>'+valObj+"</b></td>");else for(valObj of valObj){var name=Object.keys(valObj)[0],val=valObj[name]||"-";row.append('<td width="'+(width||"")+'" '+(colSpan?'colspan="'+colSpan+'"':"")+"><div><em>"+name+"</em></div> <b>"+val+"</b></td>")}return row},openStore:function(){window.open(paymentUrl,"_blank")},constructTrialDetails:function(res){var isFree=1==res.planId,trialtxt="";return res.isTrialChangeAllowed||!isFree?(trialtxt="["+(res.isTrialChangeAllowed?isFree?ZPI18N.getString("zp.clicksubscription"):ZPI18N.getString("zpp.trial"):"Trial - Exhausted")+"]",Layout.isPeoplePlus&&!ZPeoplePlus.isPeoplePlusAdmin?'<b class="gry8">'+trialtxt+"</b>":(settingsPage.container.append(this.getOtherEditionHTML(res)),settingsPage.container.find("#trialPlan").on("click",function(e){"trialPlan"===e.target.id&&SubscriptionDetails.closeTrialPopUp()}),$(document).on("keyup",function(e){27===e.keyCode&&SubscriptionDetails.closeTrialPopUp()}),'<a onclick="SubscriptionDetails.showTrialPopUp()"><b>'+trialtxt+"</b></a>")):"<b>[Trial - Exhausted]</b>"},getOtherEditionHTML:function(res){var currPlanId=res.planId,pricingURL=res.peoplePricingURL,html='<div id="trialPlan" class="zpl_mdl '+(Layout.isPeoplePlus?"zpl_mlrgpp":"zpl_mlrg")+'" data-modal-box="subscription" data-toggle="modal"><div class="zpl_minr"><div class="zpl_mhder"><div><h4>'+ZPI18N.getString("zp.tryeditions")+'</h4></div><a class="PI_cls" onclick="SubscriptionDetails.closeTrialPopUp()"></a></div><div class="zpl_mcnt"><div class="zpl_trailplan">';if(Layout.isPeoplePlus){var daysToExpire=0;void 0!=PPSubscription.planDetails.Trial&&(daysToExpire=PPSubscription.planDetails.Trial.daysToExpire),pricingURL="https://www.zoho.com/peopleplus/pricing.html",html=html+'<div id="26"><h2>'+ZPI18N.getString("zp.peoplepluspremiumedition")+"</h2><ul><li>"+ZPI18N.getString("zp.essential.onb")+"</li><li>"+ZPI18N.getString("zp.essential.empdb")+"</li><li>"+ZPI18N.getString("zp.essential.files")+"</li><li>"+ZPI18N.getString("zp.essential.approval")+"</li><li>"+ZPI18N.getString("zp.professional.attendance")+"</li><li>"+ZPI18N.getString("zp.professional.timetrack")+"</li><li>"+ZPI18N.getString("zpp.leavefeature")+"</li><li>"+ZPI18N.getString("zp.performancemang")+"</li><li>"+ZPI18N.getString("zpp.compensationfeatures")+"</li><li>"+ZPI18N.getString("zpp.atsfeatures")+"</li><li>"+ZPI18N.getString("zpp.payrollfeatures")+'</li></ul><button class="ppChangeTrial" onclick="PPSubscription.changePeoplePlusTrial(this)">'+ZPI18N.getString("zp.trynow")+"</button><span>"+ZPI18N.getString("zpp.trialdays",[daysToExpire])+'</span></div><div id="22"><h2>'+ZPI18N.getString("zp.peopleplusenterpriseedition")+"</h2><ul><b>"+ZPI18N.getString("zp.peoplepluspremiumeditionplus")+"</b><li>"+ZPI18N.getString("zp.ennterprise.hrcase")+"</li><li>"+ZPI18N.getString("zp.ennterprise.sla")+"</li><li>"+ZPI18N.getString("zp.ennterprise.lms")+"</li><li>"+ZPI18N.getString("zp.ennterprise.blended")+"</li><li>"+ZPI18N.getString("zp.ennterprise.coursemgmt")+"</li><li>"+ZPI18N.getString("zp.ennterprise.coursefeedback")+"</li><li>"+ZPI18N.getString("zp.ennterprise.discussion")+"</li><li>"+ZPI18N.getString("zpp.cliqfeatures")+"</li><li>"+ZPI18N.getString("zpp.expensefeatures")+"</li><li>"+ZPI18N.getString("zpp.vaultfeatures")+"</li><li>"+ZPI18N.getString("zpp.signfeatures")+'</li></ul><button class="ppChangeTrial" onclick="PPSubscription.changePeoplePlusTrial(this)">'+ZPI18N.getString("zp.trynow")+"</button><span>"+ZPI18N.getString("zpp.trialdays",[daysToExpire])+'</span></div></div></div><div class="zpl_mfoter"><div class="zpl_grplnk"><a target="_blank" href="'+pricingURL+'">'+ZPI18N.getString("zp.checkotherpricing")+"</a></div></div></div></div>"}else html=html+'<div id="18"><h2>'+ZPI18N.getString("zp.essentialhr")+"</h2><ul><li>"+ZPI18N.getString("zp.essential.onb")+"</li><li>"+ZPI18N.getString("zp.essential.empdb")+"</li><li>"+ZPI18N.getString("zp.essential.files")+"</li><li>"+ZPI18N.getString("zp.essential.self")+"</li><li>"+ZPI18N.getString("zp.essential.timeoff")+"</li><li>"+ZPI18N.getString("zp.essential.approval")+"</li><li>"+ZPI18N.getString("zp.essential.reports")+"</li><li>"+ZPI18N.getString("zp.essential.wf")+"</li><li>"+ZPI18N.getString("zp.essential.zia")+"</li><li>"+ZPI18N.getString("zp.officereadiness")+'</li></ul><button onclick="SubscriptionDetails.changeTrial(this)">'+ZPI18N.getString("zp.trynow")+"</button><span>"+ZPI18N.getString("zp.trial")+'</span></div><div id="20"><h2>'+ZPI18N.getString("zp.professionalhr")+"</h2><ul><b>"+ZPI18N.getString("zp.essentialhrplus")+"</b><li>"+ZPI18N.getString("zp.professional.attendance")+"</li><li>"+ZPI18N.getString("zp.professional.biometric")+"</li><li>"+ZPI18N.getString("zp.professional.shiftscheduling")+"</li><li>"+ZPI18N.getString("zp.shiftrotation")+"</li><li>"+ZPI18N.getString("zp.professional.ipgeo")+"</li><li>"+ZPI18N.getString("zp.professional.overtime")+"</li><li>"+ZPI18N.getString("zp.professional.timetrack")+"</li><li>"+ZPI18N.getString("zp.professional.timesheet")+"</li><li>"+ZPI18N.getString("zp.professional.timeschdl")+"</li><li>"+ZPI18N.getString("zp.professional.bill")+'</li></ul><button onclick="SubscriptionDetails.changeTrial(this)">'+ZPI18N.getString("zp.trynow")+"</button><span>"+ZPI18N.getString("zp.trial")+'</span></div><div id="21"><h2>'+ZPI18N.getString("zp.premiumhr")+"</h2><ul><b>"+ZPI18N.getString("zp.professionalhrplus")+"</b><li>"+ZPI18N.getString("zp.premium.jobschdl")+"</li><li>"+ZPI18N.getString("zp.premium.pa")+"</li><li>"+ZPI18N.getString("zp.premium.kra")+"</li><li>"+ZPI18N.getString("zp.premium.skillmat")+"</li><li>"+ZPI18N.getString("zp.premium.360feedback")+"</li><li>"+ZPI18N.getString("zp.premium.selfappraisal")+"</li><li>"+ZPI18N.getString("zp.formmultiraterreview")+"</li><li>"+ZPI18N.getString("zp.premium.advanalytics")+'</li></ul><button onclick="SubscriptionDetails.changeTrial(this)">'+ZPI18N.getString("zp.trynow")+"</button><span>"+ZPI18N.getString("zp.trial")+'</span></div><div id="19"><h2>'+ZPI18N.getString("zp.enterprisehr")+"</h2><ul><b>"+ZPI18N.getString("zp.premiumhrplus")+"</b><li>"+ZPI18N.getString("zp.ennterprise.hrcase")+"</li><li>"+ZPI18N.getString("zp.ennterprise.sla")+"</li><li>"+ZPI18N.getString("zp.ennterprise.lms")+"</li><li>"+ZPI18N.getString("zp.ennterprise.blended")+"</li><li>"+ZPI18N.getString("zp.ennterprise.coursemgmt")+"</li><li>"+ZPI18N.getString("zp.ennterprise.coursefeedback")+"</li><li>"+ZPI18N.getString("zp.ennterprise.discussion")+'</li></ul><button onclick="SubscriptionDetails.changeTrial(this)">'+ZPI18N.getString("zp.trynow")+"</button><span>"+ZPI18N.getString("zp.trial")+'</span></div></div></div><div class="zpl_mfoter"><div class="zpl_grplnk"><a onclick="SubscriptionDetails.changeToFreeVersion()">'+ZPI18N.getString("zp.changetofree")+'</a><a target="_blank" href="'+pricingURL+'">'+ZPI18N.getString("zp.checkotherpricing")+"</a></div></div></div></div>";return(html=$(html)).find("#"+currPlanId).append('<div id="currentDiv">'+ZPI18N.getString("zp.currenttrial")+"</div>").addClass("current"),html},showTrialPopUp:function(){settingsPage.container.find("#trialPlan").addClass("zpl_mopen"),$("body").addClass("zpl_mdlbdy")},closeTrialPopUp:function(){settingsPage.container.find("#trialPlan").removeClass("zpl_mopen"),$("body").removeClass("zpl_mdlbdy")},changeTrial:function(btnEle){var ele=$(btnEle),planId=ele.parent().attr("id");ele.prop("disabled",!0),$.post("/getSubscriptionPlans.zp",{mode:"changeTrialStatus",conreqcsr:csrfToken,planId:planId},function(resultData){ele.prop("disabled",!1);var status=resultData.result;"success"==status?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.trialchangedsuccessfully")),window.location.reload()):"countExceeded"==status?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.trialcountexceeded")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.errorinchangingtrial"))})},changeToFreeVersion:function(){$.post("/getSubscriptionPlans.zp",{mode:"changeToFreeVersion",conreqcsr:csrfToken},function(resultData){window.location.reload(),"success"==(resultData=JSON.parse(resultData)).result?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.trialcancelsuccess")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.errorincanceltrial"))})},constructUserCircleChart:function(elementID,total,used,users){var remain=total-used,obj={chart:{type:"pie",margin:0,plotBorderWidth:0,plotShadow:!1,events:{load:function(event){event.target.reflow()}}},credits:{enabled:!1},exporting:{enabled:!1},title:{text:ZPI18N.getString("zp.lms.course.Available")+'<br><span style="font-size:20px;color: #000000; display:block; text-align: center; font-weight: bold">'+remain+"</span>",verticalAlign:"middle",useHTML:!0,style:{fontSize:"12px"},x:.5*(this.chartWidth-(this.spacingLeft+this.spacingRight)),y:.5*(this.chartHeight-(this.spacingTop+this.spacingBottom)),floating:!0},plotOptions:{pie:{shadow:!1,center:["50%","50%"],size:"100%",allowPointSelect:!1,borderWidth:0,dataLabels:{enabled:!1}},series:{enableMouseTracking:!0,point:{events:{mouseOver:function(){clearTimeout(this.series.chart.title.mouseOutTimeOut),this.series.chart.title.update({text:""})},mouseOut:function(){var thisChart=this;this.series.chart.title.mouseOutTimeOut=setTimeout(function(){thisChart.series.chart.title.update({text:ZPI18N.getString("zp.lms.course.Available")+'<br><span style="font-size:20px; color: #000000; display:block; text-align: center; font-weight: bold">'+remain+"</span>"})},550)}}}}},tooltip:{enabled:!0,borderWidth:0,backgroundColor:"none",shadow:!1,style:{fontSize:"12px"},formatter:function(){var tooltipColor=this.point.isremaining?"#000000":this.point.color;this.series.chart.title.update({text:this.point.name+'<br><span style="font-size:20px; color: '+tooltipColor+'; display:block; text-align: center; font-weight: bold">'+this.point.y+"</span>"})},positioner:function(labelWidth,labelHeight){return{x:.5*(this.chart.chartWidth-labelWidth),y:.5*(this.chart.chartHeight-labelHeight)}}},series:[{data:[{y:used,color:"#DC5C5D",name:ZPI18N.getString("zp.Used")},{y:remain,color:"#10BC6B",name:ZPI18N.getString("zp.lms.course.Available"),isremaining:!0}],innerSize:"85%"}]};users&&total<=0&&(obj.title.text='<br><span style="font-size:15px;color: #515151; display:block; text-align: center; font-weight: bold">'+ZPI18N.getString("zp.notpurchased")+"</span>",obj.title.y=-15,obj.plotOptions.series.enableMouseTracking=!1,obj.tooltip.enabled=!1,obj.series[0].data=[{y:1,color:Highcharts.color("#D3D3D3").setOpacity(.3).get(),name:ZPI18N.getString("zp.lms.course.Available"),isremaining:!0}]),Highcharts.chart(elementID,obj)},getChartColor:function(percentageValue){return percentageValue<10?"#75e838":percentageValue<30?"#c8e838":percentageValue<50?"#f2e93f":percentageValue<70?"#f2b03f":percentageValue<90?"#f26f3f":"#f23f3f"}};APIUsage5_0={url:"/organizationReports.zp",urlVitals:{report:"APIUsage",mode:"report"},container:void 0,setcontainer:function(){return APIUsage5_0.container=settingsPage.container,APIUsage5_0.container},init:function(){APIUsage5_0.setcontainer(),"1"!=ZPeople.PLANID&&(isadmin||isSubscriptionAdmin)?(APIUsage5_0.initPagecomp(),ZPeople.Request.sendRequest(APIUsage5_0.url,APIUsage5_0.urlVitals,"GET",APIUsage5_0.reportBuilder,{},APIUsage5_0.errorHandler)):APIUsage5_0.container.html(ZPUtil.newNoDataHTML("CR-nodata",8,ZPI18N.getString("zp.permissiondenied"),void 0,void 0,void 0))},pageBuilder:function(){let htm='<div class="zpl_rgtcnt zpl_crdwthful zpl_orgsubsc"><div class="zpl_crd" id="apiusage" style="display:none"><div class="zpl_crdcnt"><div class="zpl_secn">\t<div class="api_card" id="tusage">\t\t<div class="api_head">\t\t\t<div class="title">'+ZPI18N.getString("zp.apidaily")+'</div>\t\t\t<div class="action"></div>       </div>      <div class="api_body">         <div class="t_usage" id="t_usage">           <div name="tusage">             <div class="total">                <div class="usage"><span></span></div>                 <div class="legend">                   <span class="used">'+ZPI18N.getString("zp.Used")+'</span>                   <span class="remain">'+ZPI18N.getString("zp.Unused")+'</span>                 </div>               </div>             </div>            <div name="allotted">\t\t\t\t<div class="value"></div>\t\t\t\t<span>'+ZPI18N.getString("zp.totalcalls")+'</span>\t\t\t  </div>\t\t\t  <div name="used">\t\t\t\t<div class="value" ></div>\t\t\t\t<span>'+ZPI18N.getString("zp.usedcalls")+'</span>\t\t\t  </div>\t\t\t<div  name="left">\t\t\t\t<div class="value"></div>\t\t\t\t<span>'+ZPI18N.getString("zp.leftcalls")+'</span>\t\t\t</div>        </div>     </div>\t</div>\t<div class="api_card">\t\t<div class="api_head">   \t\t <div class="title">'+ZPI18N.getString("zp.timeline",[30])+'</div>   \t\t<div class="action"> </div>\t\t</div>\t\t<div class="api_body" id="chartDiv5_0">\t\t</div>\t</div></div></div></div>';settingsPage.container.append(htm)},initPagecomp:function(){APIUsage5_0.container.find("#apiusage").hide(),0==APIUsage5_0.container.find("#zp_page_loading").length&&APIUsage5_0.container.append(ZPeople.LOADING_HTML),APIUsage5_0.container.find('div[name="tusage"]').find(".usage").find("span").width("0")},reportBuilder:function(data,param){var layout=APIUsage5_0.container;if(void 0!=data.tusage){layout.find("#tusage").find(".title").text(ZPI18N.getString("zp.apidaily",[data.today])),tusage_can=layout.find("#tusage").find("#t_usage"),$.each(data.tusage,function(key,val){tusage_can.find('div[name="'+key+'"] > .value').text(val)}),usageEle=tusage_can.find('div[name="tusage"]').find(".usage");var width=void 0==usageEle.width()||0==usageEle.width()?300:usageEle.width();usedWidth=width/data.tusage.allotted*data.tusage.used}layout.find("#apiusage").show(),layout.find("#zp_page_loading").remove(),usageEle.find("span").width(usedWidth),APIUsage5_0.chart(data)},chart:function(data){return info={chart:{renderTo:"chartDiv5_0",type:"area"},title:{text:""},credits:{enabled:!1},xAxis:[{categories:data.reports.xaxis}],yAxis:[{title:{text:ZPI18N.getString("zp.apicalls")}}],plotOptions:{area:{fillOpacity:.4}},series:[{name:ZPI18N.getString("zp.Used"),type:"area",data:data.reports.yvalue}],legend:{enabled:!1},exporting:{enabled:!0,buttons:{contextButton:{align:"left",x:-10,y:-10,menuItems:[{text:ZPI18N.getString("zp.lms.reports.exportAsCSV"),onclick:function(){APIUsage5_0.exportchart("csv")}},{text:ZPI18N.getString("zp.lms.reports.exportAsXLS"),onclick:function(){APIUsage5_0.exportchart("xls")}}]}}}},Highcharts.chart(info)},exportchart:function(type){var formObj=$("#zp_export_form").html("");formObj.attr("method","get"),formObj.attr("action",APIUsage5_0.url),formObj.append('<input type="hidden" value="export" name="mode">'),formObj.append('<input type="hidden" value="APIUsage" name="report">'),formObj.append('<input type="hidden" value="'+type+'" name="type">'),formObj.submit(),formObj.attr("action","ExportData.zp"),formObj.attr("method","post"),formObj.html("")},errorHandler:function(data,params){403==data.status?APIUsage5_0.container.html(ZPUtil.newNoDataHTML("CR-nodata",8,ZPI18N.getString("zp.permissiondenied"),void 0,void 0,void 0)):APIUsage5_0.container.html(ZPUtil.newNoDataHTML("CR-nodata",8,ZPI18N.getString("zp.sorryservererror"),void 0,void 0,void 0))}};var gettingStarted={};gettingStarted.newSettings={paramNames:[],paramVals:[],url:"",pageId:void 0,initCallback:function(){gettingStarted.newSettings.pageId=Layout.Page.container;var pageId=gettingStarted.newSettings.pageId;html="",html+='<div id="gettingStarted" data-modal-box="gettingStarted" class="zpl_mdl zpl_mfull zpl_mopen">',html+='<div class="zpl_minr">',html+='<div class="zpl_mhder">',html+="<div>",html+="<h4>"+ZPI18N.getString("zp.gettingStarted")+"</h4>",html+="</div>",html+='<a class="_cls PI_cls" onclick="gettingStarted.newSettings.closeGettingStartedSlide()"></a>',html+="</div>",html+='<div class="zpl_mcnt zpl_getsted">',html+='<div class="zpl_crd">',html+='<div class="zpl_crdcnt zpl_rgtpanl">',html+="<div>",html+='<div class="zpl_secn" id = "zpl-overview">',html+="</div>",html+='<div class="zpl_zpl_getstedrgt">',html+='<div class="zpl_secn">',html+="<div>",html+="<h4>"+ZPI18N.getString("zp.letsbegin")+"</h4>",html+="</div>",html+="<div>",html+="<p>"+ZPI18N.getString("zp.flwNote")+"</p>",html+="</div>",html+="</div>",html+='<div><div class="zpl_secn">',html+="</div><div>",html+="<ul>",html+="<li>",html+='<h4><a href="#settings/service/accountsetup/companydetails" target="_blank" >'+ZPI18N.getString("zp.setUpOrgan")+"</a></h4>",html+="<p>"+ZPI18N.getString("zp.configureOrganSetng")+"</p>",html+="</li>",html+="<li>",html+='<h4><a href="#settings/service/accountsetup/users/all" target="_blank">'+ZPI18N.getString("zp.addinviteusers")+"</a></h4>",html+="<p>"+ZPI18N.getString("zp.inUserSelfPortal")+"</p>",html+="</li>",html+="<li>",html+='<h4><a href="#settings/service/leavetracker/leavepolicy" target="_blank">'+ZPI18N.getString("zp.leavePolicy")+"</a></h4>",html+="<p>"+ZPI18N.getString("zp.uploadNShareDoc")+"</p>",html+="</li>",html+="<li>",html+='<h4><a href="#settings/service/shift/manage" target="_blank">'+ZPI18N.getString("zp.defShift")+"</a></h4>",html+="<p>"+ZPI18N.getString("zp.multipleShif")+"</p>",html+="</li>",html+="<li>",html+='<h4><a href="#settings/service/timetracker/approval" target="_blank">'+ZPI18N.getString("zp.timesheetAppval")+"</a></h4>",html+="<p>"+ZPI18N.getString("zp.approvertimeSheet")+"</p>",html+="</li>",html+="</ul>",html+="</div>",html+="</div>",html+="</div>",html+="</div>",html+="</div>",html+="</div>",html+="</div>",html+='<div class="zpl_mfoter">',html+='<button type="button" onclick="gettingStarted.newSettings.closeGettingStartedSlide()" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.welgetstarted")+"</button>",html+="</div>",html+="</div>",html+="</div>",pageId.append(html),pageId.find("#zpl-overview").append(ZPOverView.construct()),$("ul#thumbnails li").click(function(e){var imgTitle=$(this).find("a").attr("href");gettingStarted.newSettings.url=imgTitle,$("#stopVideo").attr({src:imgTitle}),e.preventDefault()})},openLight:function(){var lightBoxObj=new LightBox("youtube");lightBoxObj.viewUrl=gettingStarted.newSettings.url,lightBoxObj.show()},addCompdetls:function(data){var iamPortalName=data.hasOwnProperty("iamPortalName")?data.iamPortalName:"",pageId=gettingStarted.newSettings.pageId,html="";html+='<div class="zpl_mdl zpl_mcenter" id="ZPUinfo"><div class="zpl_minr"><div class="zpl_mhder"><div><h4>'+ZPI18N.getString("zp.compinfo")+"</h4><p>"+ZPI18N.getString("zp.compinfomsg")+'</p></div></div><div class="zpl_mcnt zpl_fm"><form><div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.companyname")+'</label></div><div><input type="text" class="ztextbox" name="companyname" onkeyup="gettingStarted.newSettings.autoFillPortalName(this)"></div></div><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.portal")+'</label></div><div><input type="text" onkeyup="gettingStarted.newSettings.portalNameRegex(this);" maxlength="50" class="ztextbox" name="portal" value="'+iamPortalName+'"></div></div><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.industryType")+'</label></div><div><select class="zselectbox" id="typeOfIndgsp" updateKey="typeOfIndgsp">',html+='</select></div></div><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.phonenumber")+'</label></div><div><input onkeyup="gettingStarted.newSettings.mobileRegex(this);" type="text" class="ztextbox" id="mobile" name="mobile"></div></div></div></div></form></div><div class="zpl_mfoter"><button id="createRoleButton" type="button" onclick="gettingStarted.newSettings.UpdateBasicSetupInfo()" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.save")+"</button></div></div></div>",pageId.append(html),MP.Extension.isTestEnvironment()&&pageId.find('input[name="portal"]').addClass("is-disabled").attr("disabled",!0);var options=[],values=[];values.push(ZPI18N.getString("zp.restaurantAfood")),values.push(ZPI18N.getString("zp.retail")),values.push(ZPI18N.getString("zp.education")),values.push(ZPI18N.getString("zp.callcentre")),values.push(ZPI18N.getString("zp.agri")),values.push(ZPI18N.getString("zp.automotive")),values.push(ZPI18N.getString("zp.bussiness")),values.push(ZPI18N.getString("zp.construction")),values.push(ZPI18N.getString("zp.financeAins")),values.push(ZPI18N.getString("zp.housAreal")),values.push(ZPI18N.getString("zp.manufacturing")),values.push(ZPI18N.getString("zp.telecom")),values.push(ZPI18N.getString("zp.medicalAheal")),values.push(ZPI18N.getString("zp.nonProfit")),values.push(ZPI18N.getString("zp.entertainAevents")),values.push(ZPI18N.getString("zp.consultant")),values.push(ZPI18N.getString("zp.emergency")),values.push(ZPI18N.getString("zp.govApublic")),values.push(ZPI18N.getString("zp.homeimpser")),values.push(ZPI18N.getString("zp.infotech")),values.push(ZPI18N.getString("zp.media")),values.push(ZPI18N.getString("zp.mine")),values.push(ZPI18N.getString("zp.resellAwhite")),values.push(ZPI18N.getString("zp.securser")),values.push(ZPI18N.getString("zp.soft")),values.push(ZPI18N.getString("zp.transportAlogis")),values.push(ZPI18N.getString("zp.utilities")),values.push(ZPI18N.getString("zp.veter")),values.push(ZPI18N.getString("zp.publishing")),$.each(values,function(index,data){options[index]={},options[index].label=options[index].value=data}),ZPeopleComponents.select(document.getElementById("typeOfIndgsp"),{showSearchField:!0,dropdownList:{height:"210px"}}),ZPeopleComponents.select(document.getElementById("typeOfIndgsp")).addOption(options)},autoFillPortalName:function(obj){var portalName=$(obj).val();!MP.Extension.isTestEnvironment()&&$("#ZPUinfo").find("input[name='portal']").val(portalName),gettingStarted.newSettings.portalNameRegex($("#ZPUinfo").find("input[name='portal']"),!0)},init:function(){if(!(Layout.Page.container.find("#gettingStarted").length>0)){gettingStarted.newSettings.initCallback();var params={conreqcsr:csrfToken,mode:"GettingStarted"};ZPeople.Request.send("/gettingStarted.zp",params,gettingStarted.newSettings.getReponseForbasicSetup)}},getReponseForbasicSetup:function(resultData){var pageId=$("body");resultData.showCompanyDetailsPopup?(gettingStarted.newSettings.addCompdetls(resultData),pageId.find("div#ZPUinfo").addClass("zpl_mopen"),ZPeopleComponents.select(document.getElementById("typeOfIndgsp")).setAttribute("selectedValue",ZPI18N.getString("zp.restaurantAfood")),null!=resultData.ctctNo&&void 0!=resultData.ctctNo&&$("[name=mobile]").val(resultData.ctctNo),resultData.hideContactno&&$("#mobile").parent().parent().hide(),null!=resultData.cmpName&&void 0!=resultData.cmpName&&$("[name=companyname]").val(resultData.cmpName)):ZPeople.isSampleDataRequestNotRaised&&SampleData5Zp.AddSampleDataObj.initAddSampleData()},portalNameRegex:function(obj,isFromCompanyName){isFromCompanyName||$("#ZPUinfo").find("input[name='companyname']").removeAttr("onkeyup"),$("#errorportal").remove();var portal=$(obj).val();portal=(portal=portal?portal.replace(/[^a-z0-9]/gi,""):"").toLowerCase(),$(obj).val(portal)},createJsonObject:function(json){$.each(gettingStarted.newSettings.paramNames,function(i,param){json[param]=gettingStarted.newSettings.paramVals[i]})},addSampleAndRedirect:function(button){var params={issampledatarequired:"addsampledata"===button.id};ZPeople.Request.send("/onboarding/sample/runSampleDataScheduler",params,function(response){var url=window.location.protocol+"//"+window.location.host+"/"+ZPeople.PORTAL_NAME+"/zp"+window.location.hash;params.issampledatarequired&&response.hasOwnProperty("message")?ZPeople.confirm(null,"",response.message,function(){url==window.location.href?window.location.reload():window.location.href=url},!0,!0,ZPI18N.getString("zp.ok")):url!=window.location.href&&(window.location.href=url)}),ZPeople.isSampleDataRequestNotRaised=!1,$("#sampleDiv,.modal-backdrop").remove()},appendSampleDataPopUp:function(){var sampleDataPopUp='<div class="tdAcc modalShdw" id="sampleDiv"><span class="modalShdwInner"><em></em></span>';sampleDataPopUp+='<div style="dtable"><div class="lft"><img src="/newhr/images/sampleData.png"></div>',sampleDataPopUp+='<div class="rht">',sampleDataPopUp+='<p class="bld">'+ZPI18N.getString("zp.sampledataheader")+"</p>",sampleDataPopUp+="<p>"+ZPI18N.getString("zp.sampledatabody")+"</p>",sampleDataPopUp+='<span class="tdAccBtn" id="dataAccount">',sampleDataPopUp+='<a id="addsampledata" onclick="gettingStarted.newSettings.addSampleAndRedirect(this)">'+ZPI18N.getString("zp.sampledataaccept")+"</a>",sampleDataPopUp+='</span><span class="tdAccBtn">',sampleDataPopUp+='<a id="dontaddsmapledata" onclick="gettingStarted.newSettings.addSampleAndRedirect(this)" class="link">'+ZPI18N.getString("zp.sampledatareject")+"</a>",sampleDataPopUp+='</span></div></div><span class="modalShdwInner flip"><em></em></span></div><div class="modal-backdrop"></div>',$("body").append(sampleDataPopUp),$("#sampleDiv").addClass("in")},mobileRegex:function(obj){var mobile=$(obj).val();mobile=mobile?mobile.replace(/[^0-9-+()]/gi,""):"",$(obj).val(mobile)},reset:function(){$("#errormobile").remove(),$("#errorportal").remove(),$("#errorcompanyName").remove(),$("#errorTypeOfInd").remove()},UpdateBasicSetupInfo:function(){var pageId=$("body");gettingStarted.newSettings.reset();var mobId=pageId.find("input[name='mobile']").removeClass("ztextbox__error"),portalId=pageId.find("input[name='portal']").removeClass("ztextbox__error"),companyId=pageId.find("input[name='companyname']").removeClass("ztextbox__error"),typeOfIndustryId=pageId.find("select[updateKey='typeOfIndgsp']").removeClass("ztextbox__error"),companyName=companyId.val(),companyNameisEmpty=ZPSetupCommon.isEmpty(companyName),portalName=portalId.val(),portalNameisEmpty=ZPSetupCommon.isEmpty(portalName),mobileNum=mobId.val(),mobileIsEmpty=ZPSetupCommon.isEmpty(mobileNum),mobileIsVisible=$("#mobile").parent().is(":visible"),typeOfIndustryVal=typeOfIndustryId.val(),keyForIndIsEmpty=ZPSetupCommon.isEmpty(typeOfIndustryVal),GettingStartedJsonObject={},params={};companyNameisEmpty&&companyId.addClass("ztextbox__error").after("<span id='errorcompanyName' class='ztextbox--error__label'>"+ZPI18N.getString("zp.organizationemptymsg")+"</span>"),keyForIndIsEmpty&&typeOfIndustryId.parent().addClass("ztextbox__error").after("<span id='errorTypeOfInd' class='ztextbox--error__label'>"+ZPI18N.getString("zp.industrytypeemptmsg")+"</span>");var isValidMobile=new RegExp(/^[0-9-+()]{5,14}$/gi).test(mobileNum);mobileIsVisible?mobileIsEmpty?mobId.addClass("ztextbox__error").after("<span id='errormobile' class='ztextbox--error__label'>"+ZPI18N.getString("zp.phoneemptymsg")+"</span>"):isValidMobile||mobId.addClass("ztextbox__error").after("<span id='errormobile' class='ztextbox--error__label'>"+ZPI18N.getString("zp.moPhoneError")+"</span>"):isValidMobile=!0;var isValidPortal=new RegExp(/^[a-z0-9]{6,50}$/gi).test(portalName);portalNameisEmpty?portalId.addClass("ztextbox__error").after("<span id='errorportal' class='ztextbox--error__label'>"+ZPI18N.getString("zp.portalemptymsg")+"</span>"):isValidPortal||portalId.addClass("ztextbox__error").after("<span id='errorportal' class='ztextbox--error__label'>"+ZPI18N.getString("zp.moportalerror")+"</span>"),!companyNameisEmpty&&!keyForIndIsEmpty&&isValidPortal&&isValidMobile&&(gettingStarted.newSettings.paramNames.push("portalname"),gettingStarted.newSettings.paramVals.push(portalName),gettingStarted.newSettings.paramNames.push("industryType"),gettingStarted.newSettings.paramVals.push(typeOfIndustryVal),gettingStarted.newSettings.paramNames.push("companyName"),gettingStarted.newSettings.paramVals.push(companyName),gettingStarted.newSettings.paramNames.push("contactno"),gettingStarted.newSettings.paramVals.push(mobileNum),gettingStarted.newSettings.createJsonObject(GettingStartedJsonObject),params={conreqcsr:csrfToken,mode:"updateBasicInfo",updateBasicInfoJSON:JSON.stringify(GettingStartedJsonObject)},ZPeople.Request.send("/updateBasicInfo.zp",params,function(data){if("SUCCESS"==data.BasicInfoUpdate){$("#zpeople_admin").removeClass("dis"),pageId.find("div#ZPUinfo").removeClass("zpl_mopen"),ZPeople.PORTAL_NAME=portalName;var portalUrl="/"+portalName+(MP.Extension.isTestEnvironment()?"/devv5/sandbox":"/zp")+"#settings/service/gettingStarted",curUrl=window.location.href;window.open(portalUrl,"_self"),curUrl==window.location.protocol+"//"+window.location.host+"/"+ZPeople.PORTAL_NAME+"/zp"+window.location.hash&&SampleData5Zp.AddSampleDataObj.initAddSampleData()}else data.hasOwnProperty("portalError")?($("#errorportal").remove(),portalId.addClass("ztextbox__error").after("<span id='errorportal' class='ztextbox--error__label'>"+ZPI18N.getString("zp.moportalnameexists")+"</span>")):"FAILURE"==data.BasicInfoUpdate?ZPeople.Message.showFailureMsg(data.BasicInfoUpdate):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.domainiserror"))},null,gettingStarted.newSettings.failCallBack))},failCallBack:function(data,vals){null!=data.responseJSON.error&&void 0!=data.responseJSON.error&&ZPeople.Message.showFailureMsg(data.responseJSON.error)},closeGettingStartedSlide:function(){var pageId=$("body");pageId.find("#ZPUinfo").remove(),pageId.find("#sampleDiv").remove(),pageId.find("#gettingStarted").remove(),MP.Extension.isTestEnvironment()?window.location.hash="#"+Layout.HashUtil.LANDING_HASH:window.open("#settings/service/accountsetup/companydetails","_self")}};var ZPOverView={};ZPOverView={currentView:0,totalView:0,show:()=>{ZPOverView.Popup?ZPOverView.Popup.removeClass("zpl_DNI"):ZPOverView.construct()},close:()=>{ZPOverView.Popup.addClass("zpl_DNI"),ZPOverView.initClose||ZPeople.Request.send(ZPeople.User.URL,{mode:"UPDATE_5_0_INTORPOPUP"}),ZPOverView.initClose=!0},construct:()=>{let conf=[{img:"5.0_exp.png",header:"zp.5.0.introduction",content:"zp.5.0.introductionmessage",inverse:!0},{img:"MySpace_exp.png",header:"zp.tab.myspace",content:"zp.5.0.myspacemessage"},{img:"TeamSpace_exp.png",header:"zp.teamspace",content:"zp.5.0.teamspacemessage"},{img:"Reports_exp.png",header:"zp.reports",content:"zp.5.0.reporsmessage"},{img:"Operation_exp.png",header:"zp.operations",content:"zp.5.0.operationmessage",infotext:"zp.5.0.foradministrators"},{img:"Settings_exp.png",header:"zp.settings",content:"zp.5.0.settingsmessage",infotext:"zp.5.0.foradministrators"}],content=$('<div conttype="view" class="zpl_introgdbg"></div>'),nav="";ZPOverView.totalView=conf.length-1,conf.forEach(function(value,ind){let container=$('<div id="cont_'+ind+'" class="zpl_introsld '+(0!=ind?"zpl_DNI":"")+'"></div>');container.append(ZPOverView.Component.createView(value)),content.append(container),nav+='<div id="nav_'+ind+'" class="'+(0==ind?"zpl_act":"")+'" onclick="ZPOverView.changeView('+ind+')"></div>'});let viewContainer=ZPOverView.Component.container();return content.append(ZPOverView.Component.navBar(nav)),viewContainer.append(content),ZPOverView.Popup=viewContainer,viewContainer},changeView:navId=>{"next"!=navId||5!=ZPOverView.currentView?("next"==navId&&ZPOverView.currentView<ZPOverView.totalView?ZPOverView.currentView++:"previous"==navId&&ZPOverView.currentView>0?ZPOverView.currentView--:"next"!=navId&&"previous"!=navId&&(ZPOverView.currentView=navId),0==ZPOverView.currentView?ZPOverView.Popup.find('[fieldType="previous"]').addClass("zpl_DNI"):ZPOverView.Popup.find('[fieldType="previous"]').removeClass("zpl_DNI"),5==ZPOverView.currentView?(ZPOverView.Popup.find('[fieldType="next_close"]').text(""),ZPOverView.Popup.find("#split_ele").addClass("zpl_DNI")):(ZPOverView.Popup.find('[fieldType="next_close"]').text(ZPI18N.getString("zp.next")),ZPOverView.Popup.find("#split_ele").removeClass("zpl_DNI")),0==ZPOverView.currentView&&ZPOverView.Popup.find("#split_ele").addClass("zpl_DNI"),ZPOverView.Popup.find("#nav_"+ZPOverView.currentView).addClass("zpl_act").siblings().removeClass("zpl_act"),ZPOverView.Popup.find("#cont_"+ZPOverView.currentView).removeClass("zpl_DNI").siblings(".zpl_introsld").addClass("zpl_DNI")):ZPOverView.close()},Component:{container:()=>{return $('<div class="zpl_introgd zpl_introgd_inpg"></div>')},createView:data=>{let infoImg=`<div class="zpl_introsld_cnt"><img src="${ZPeople.getResourceURL(imageUrl+data.img)}" alt=""></div>`,message=`<div class="zpl_introsld_ttl ${data.inverse?"btmttl":""}"><div><h4>${ZPI18N.getString(data.header)}</h4>${data.infotext?`<em class="zpl_ff-light">(${ZPI18N.getString(data.infotext)})</em>`:""}<p>${ZPI18N.getString(data.content)}</p></div></div>`;return data.inverse?infoImg+message:message+infoImg},navBar:navigator=>`<div class="zpl_introgd_ftr"><div><div><button onclick="ZPOverView.close()" class="zlabel zlabel--medium zlabel--nobg zpl_DNI" data-popup-open="tagkra">${ZPI18N.getString("zp.skip")}</button></div><div contType="navigator" class="zpl_introsldr">${navigator}</div><div class="zpl_intronxt"><button fieldType="previous" onclick="ZPOverView.changeView('previous')" class="zpl_DNI zlabel zlabel--nobg zlabel--medium ">${ZPI18N.getString("zp.previous")}</button><span fieldType="previous" id="split_ele" class = "zpl_DNI">|</span><button fieldType="next_close" onclick="ZPOverView.changeView('next')" class="zlabel zlabel--nobg zlabel--medium">${ZPI18N.getString("zp.next")}</button></div></div></div>`}};var CompanySetup={};function updateCompanyLogo(result,url){CompanySetup.NewSetting.companyDetailsPageId;if("error"===result)ZAlertBanner.show({message:result.error,isMessageHTMLEncoded:!0,hideDelay:ZPeople.Message.getMessageTime(result.error),type:"error"});else{var imageUrl=CompanySetup.NewSetting.defaultPhotoUrl+url,wrapperObj=$("div#wrapper");if(0===wrapperObj.find("img#zp_logo").length){var zpHeadLeft=wrapperObj.find("div.ZPHeadLft");Layout.isPeoplePlus&&zpHeadLeft.find("a.ZPPLogo").remove(),zpHeadLeft.find("a.ZPLogo").remove(),zpHeadLeft.append('<img height="24" src="" class="ZPLogo1" id="zp_logo">')}wrapperObj.find("img#zp_logo").attr("src",imageUrl),CompanySetup.NewSetting.closeLogoPopup(),CompanySetup.NewSetting.setOrgLogo(imageUrl)}}CompanySetup.NewSetting={defaultPhotoUrl:"viewPhoto?filename=",topDiv:'<div class="zpl_rgtcnt" id="topDiv"> </div>',card:'<div class="zpl_crd" id="card"> </div>',cardHeader:'<div class="zpl_crdhdr" id="details-card-header"> <div> <h4>  </h4> </div></div>',companyDetailsPageId:null,companySettingsPageId:null,unsavedCompanyDetails:{},unsavedNotificationSettings:{},unsavedAppLockSettings:{},unsavedLocaleSettings:{},unsavedSearchSettings:{},unsavedPersonalSettings:{},unsavedPhotoSettings:{},companyDetailsInitCallback:function(){settingsPage.container.find("#topSettMenu").addClass("zpl_DNI");var pageId=CompanySetup.NewSetting.companyDetailsPageId=settingsPage.container;CompanySetup.NewSetting.initCallback(pageId,CompanySetup.NewSetting.loadInitialDetails)},initCallback:function(pageId,successCallBack){ZPeople.Request.send("/initCompanySettings.zp",{mode:"init",method:"getCompanySettingsDetails"},successCallBack,pageId,CompanySetup.NewSetting.failInitCallBack)},failInitCallBack:function(result,params,pageId){pageId.append(result.responseText)},orgDetailsPageSetup:function(pageId){pageId.append(CompanySetup.NewSetting.topDiv),pageId.find("#topDiv").append(CompanySetup.NewSetting.card),pageId.find("#card").append(CompanySetup.NewSetting.cardHeader),pageId.find("#details-card-header h4").text(ZPI18N.getString("zp.basicdetails"));var header='<div id="details-btn-div" style="display:none"><button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="CompanySetup.NewSetting.resetOrgDetails()"> '+ZPI18N.getString("zp.reset")+' </button><button type="button" class="zlabel zlabel--blue zlabel--medium" onclick="CompanySetup.NewSetting.validate(settingsPage.container,\'details\')"> '+ZPI18N.getString("zp.save")+" </button></div>";pageId.find("#details-card-header").append(header),pageId.find("#card").append('<div class="zpl_crdcnt zpl_cmpy zpl_frmtwo" id="card-content"> </div>');var elements={};elements.compLogo={value:ZPI18N.getString("zp.lms.settings.Logo")},elements.companyName={value:ZPI18N.getString("zp.name"),isMandatory:!0},elements.website={value:ZPI18N.getString("zp.website")},elements.industryType={value:ZPI18N.getString("zp.organizationType")},elements.contactperson={value:ZPI18N.getString("zp.contactPers")},elements.contactno={value:ZPI18N.getString("zp.contactNumber")},elements.adminemail={value:ZPI18N.getString("zp.compContactEmail"),isMandatory:!0},elements.firstaddr={value:ZPI18N.getString("zp.primaryAddress")},elements.secondaddr={value:""},elements.compAddress3={value:""},elements.compAddress4={value:""},$.each(elements,function(key,valueObj){var cardElement='<div class="zpl_secn" id="'+key+'Div"> <div> <label class="'+(valueObj.isMandatory?"zpl_mtry":"")+'">'+valueObj.value+" </label> </div> </div>";pageId.find("#card-content").append(cardElement),valueObj.value||pageId.find("#card-content div#"+key+"Div div").html("")}),pageId.find("#compLogoDiv").append('<div><div class="zpl_upld prof" id="compLogoVal"><div class="zpl_fldrp complog"><div class="zpl_profcnt" id="orgLogo"><img no-logo="true"><div class="zpl_imgact"><span class="zlabel zlabel--blue" onclick="CompanySetup.NewSetting.openUploadPopup()"><i class="PI_edt"></i>'+ZPI18N.getString("zp.icoEdit")+'</span><span class="zlabel zlabel--red" id="resetLogo" onclick="CompanySetup.NewSetting.deleteLogoAlert()" style="display: none;"><i class="PI_reset"></i>'+ZPI18N.getString("zp.reset")+"</span></div></div>"),pageId.find("#compLogoDiv").append('<form method="post" action="ViewCompanyLogoImage.zp" enctype="multipart/form-data" id="submitOrgLogo" style="display: none;" target="companyLogoTarget"><iframe align="top" frameborder="0" src="/people/html/blank.html" name="companyLogoTarget" marginwidth="0" marginheight="0" scrolling="no" width="100%" height="30" style="display:none"> </iframe><input type="hidden" name="'+csrfParamName+'" value="'+csrfToken+'"/></form>');var timeout=null;pageId.find("#card-content").on("keyup","input",function(event){pageId.find("#details-btn-div").show();var id=event.target.getAttribute("id");clearTimeout(timeout),timeout=setTimeout(function(){CompanySetup.NewSetting.unsavedCompanyDetails[id]=pageId.find("#"+id).val()},250)}),pageId.find("#card-content").on("zselectchange",function(event){if(event.detail.fromUI){pageId.find("#details-btn-div").show();var id=event.target.attr("id"),name=event.target.attr("name");CompanySetup.NewSetting.unsavedCompanyDetails[name]=ZPeopleComponents.select(document.getElementById(id)).getValue(),"countryNew"==id&&(CompanySetup.NewSetting.unsavedCompanyDetails.state="")}}),pageId.find("#companyNameDiv").append('<div> <input type="text" class="ztextbox" id="companyName" placeholder="'+ZPI18N.getString("zp.companyname")+'"> </div>'),pageId.find("#websiteDiv").append('<div> <input type="text" class="ztextbox" id="website" placeholder="'+ZPI18N.getString("zp.companywebsite")+'"> </div>'),pageId.find("#contactpersonDiv").append('<div> <input type="text" class="ztextbox" id="contactperson" placeholder="'+ZPI18N.getString("zp.contactPers")+'"> </div>'),pageId.find("#contactnoDiv").append('<div> <input type="text" class="ztextbox" id="contactno" placeholder="'+ZPI18N.getString("zp.contactNumber")+'"> </div>'),pageId.find("#adminemailDiv").append('<div> <input type="text" class="ztextbox" id="adminemail" placeholder="'+ZPI18N.getString("zp.compContactEmail")+'"> </div>'),pageId.find("#firstaddrDiv").append('<div> <input type="text" class="ztextbox" id="firstaddr" placeholder="'+ZPI18N.getString("zp.addressLine")+" "+ZPI18N.getString("zp.lms.one")+'"> </div>'),pageId.find("#secondaddrDiv").append('<div> <input type="text" class="ztextbox" id="secondaddr" placeholder="'+ZPI18N.getString("zp.addressLine")+" "+ZPI18N.getString("zp.lms.two")+'"> </div>'),pageId.find("#industryTypeDiv").append('<div><select class="select-js" data-width="400" name="industryType" id="industryTypeNew"> </select></div>'),pageId.find("#compAddress3Div").append('<div><div class="zpl_idiv"><input type="text" class="ztextbox" id="city" placeholder="'+ZPI18N.getString("zp.local.City")+'"><select data-width="400" id="stateNew" name="state"> </select ></div></div>'),pageId.find("#compAddress4Div").append('<div><div class="zpl_idiv"><select class="select-js" data-width="400" name="country" id="countryNew"> </select><input type="text" class="ztextbox" id="zipcode" placeholder="'+ZPI18N.getString("zp.local.ZIPPINCode")+'"></div></div>');var popup='<div class="zpl_mdl zpl_mcenter" closemodelview="true" id="uploadLogoPopup" data-modal-box="companylogo"><div class="zpl_minr"><div class="zpl_mhder"><div><h4>'+ZPI18N.getString("zp.uploadlogo")+'</h4></div><a class="_cls PI_cls" onclick="CompanySetup.NewSetting.closeLogoPopup()"></a></div><div class="zpl_mcnt zpl_fm"><div class="zpl_upld"><div class="zpl_fldrp" ><i class="PI_image"></i><img src="" alt="" class="wd50_per"><h4>'+ZPI18N.getString("zp.supportsFileForOrgLogo")+'</h4><p class="zpl_imgnam" id="logoImgName"><span></span><i class="PI_tick2_fil grn"></i></p><p>'+ZPI18N.getString("zp.resolutionSizeForOrgLogo")+"</p><p>"+ZPI18N.getString("zp.lms.attachment.MaxfileSize")+' 500KB</p><button id="filebtn" class="zlabel zlabel--blue zlabel--medium" onclick="CompanySetup.NewSetting.uploadLogo()"></button> </div></div></div><div class="zpl_mfoter"><button class="zlabel zlabel--blue zlabel--medium" onclick="CompanySetup.NewSetting.uploadOrgLogo()">'+ZPI18N.getString("zp.upload")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="CompanySetup.NewSetting.closeLogoPopup()">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div>";pageId.append(popup)},loadInitialDetails:function(resultData,params,pageId){CompanySetup.NewSetting.orgDetailsPageSetup(pageId),ZPeopleComponents.select(document.getElementById("stateNew"),{acceptNewValues:!0,placeholder:ZPI18N.getString("zp.orgselectlabel",new Array(ZPI18N.getString("zp.state")))}),CompanySetup.NewSetting.loadIndustriesValues(),CompanySetup.NewSetting.loadCountries(resultData,"countryNew",!0,pageId),CompanySetup.NewSetting.setCompanyDetails(resultData,params)},loadIndustriesValues:function(){var industryTypes=Array(),industries=Array();industries.push(ZPI18N.getString("zp.restaurantAfood")),industries.push(ZPI18N.getString("zp.retail")),industries.push(ZPI18N.getString("zp.education")),industries.push(ZPI18N.getString("zp.callcentre")),industries.push(ZPI18N.getString("zp.agri")),industries.push(ZPI18N.getString("zp.automotive")),industries.push(ZPI18N.getString("zp.bussiness")),industries.push(ZPI18N.getString("zp.construction")),industries.push(ZPI18N.getString("zp.financeAins")),industries.push(ZPI18N.getString("zp.housAreal")),industries.push(ZPI18N.getString("zp.manufacturing")),industries.push(ZPI18N.getString("zp.telecom")),industries.push(ZPI18N.getString("zp.medicalAheal")),industries.push(ZPI18N.getString("zp.nonProfit")),industries.push(ZPI18N.getString("zp.entertainAevents")),industries.push(ZPI18N.getString("zp.consultant")),industries.push(ZPI18N.getString("zp.emergency")),industries.push(ZPI18N.getString("zp.govApublic")),industries.push(ZPI18N.getString("zp.homeimpser")),industries.push(ZPI18N.getString("zp.infotech")),industries.push(ZPI18N.getString("zp.media")),industries.push(ZPI18N.getString("zp.mine")),industries.push(ZPI18N.getString("zp.resellAwhite")),industries.push(ZPI18N.getString("zp.securser")),industries.push(ZPI18N.getString("zp.soft")),industries.push(ZPI18N.getString("zp.transportAlogis")),industries.push(ZPI18N.getString("zp.utilities")),industries.push(ZPI18N.getString("zp.veter")),industries.push(ZPI18N.getString("zp.publishing")),$.each(industries,function(index,industry){industryTypes[index]={},industryTypes[index].label=industryTypes[index].value=industry}),ZPeopleComponents.select(document.getElementById("industryTypeNew"),{placeholder:ZPI18N.getString("zp.select")}),ZPeopleComponents.select(document.getElementById("industryTypeNew")).addOption(industryTypes),ZPeopleComponents.select(document.getElementById("industryTypeNew")).setAttribute("showSearchField",!0)},loadTimeZones:function(resultData,targetId){var timeZoneList=Array(),timeZoneValues={};CompanySetup.NewSetting.setTimeZoneGroups(resultData.timeZoneList,timeZoneList,"name","id","timeZoneGroup"),timeZoneValues.dataMapping={label:"name",value:"id",optgroupLabel:"timeZoneGroup"},timeZoneValues.options=timeZoneList,ZPeopleComponents.select(document.getElementById(targetId)).setAttributes(timeZoneValues)},loadCountries:function(resultData,targetId,isAddress,pageId){var countries=Array();isAddress&&ZPeopleComponents.select(document.getElementById(targetId),{change:CompanySetup.NewSetting.loadStateValues,placeholder:ZPI18N.getString("zp.orgselectlabel",new Array(ZPI18N.getString("zp.country"))),showSearchField:!0}),CompanySetup.NewSetting.getCountryValues(resultData.countryList,countries,targetId),ZPeopleComponents.select(pageId.find("#"+targetId)).addOption(countries)},getCountryValues:function(countryList,countries,targetId){$.each(countryList,function(index,country){countries[index]={};var countryName="countriesForLocation"==targetId?country.name.toUpperCase():country.name;countries[index].label=countries[index].value=countryName,countries[index].id=country.code})},companyDetailsCallback:function(){CompanySetup.NewSetting.companyCallback(null,null,"details")},setOrgLogo:function(logoUrl){var pageId=CompanySetup.NewSetting.companyDetailsPageId;pageId.find("input#desktop").val("");var compLogo=pageId.find("#compLogoVal");compLogo.find("img").attr("src",logoUrl),compLogo.find("img").attr("no-logo",!1),pageId.find("#resetLogo").show(),pageId.find("#orgLogo").show()},setCompanyDetails:function(resultData,params){var pageId=CompanySetup.NewSetting.companyDetailsPageId;pageId.find("#companyName").removeClass("ztextbox__error"),pageId.find("#adminemail").removeClass("ztextbox__error");pageId.find("#errorOrgName").remove(),pageId.find("#errorAdminMail").remove();var orgDetails=resultData.orgSettingsDtls,orgLogo=orgDetails.logo;orgLogo?CompanySetup.NewSetting.setOrgLogo(orgLogo):pageId.find("#orgLogo img").attr("src",ZPeople.getResourceURL(newHRImgUrl+(Layout.isPeoplePlus?"zpeoplePlus.png":"zohopeoplelogo.png"))),pageId.find("#companyName").val(ZPeople.decodeTxt(orgDetails.companyName)),pageId.find("#website").val(ZPeople.decodeTxt(orgDetails.website));var industry=orgDetails.industryType;industry?ZPeopleComponents.select(document.getElementById("industryTypeNew")).setAttribute("selectedValue",ZPeople.decodeTxt(industry)):ZPeopleComponents.select(document.getElementById("industryTypeNew")).deselectAllOptions(),pageId.find("#contactperson").val(ZPeople.decodeTxt(orgDetails.contactperson)),pageId.find("#contactno").val(ZPeople.decodeTxt(orgDetails.contactno)),pageId.find("#adminemail").val(orgDetails.ADMINSUPPORT);var firstAddr=orgDetails.firstaddr;firstAddr?pageId.find("#firstaddr").val(ZPeople.decodeTxt(firstAddr)):pageId.find("#firstaddr").val("");var secondAddr=orgDetails.secondaddr;secondAddr?pageId.find("#secondaddr").val(ZPeople.decodeTxt(secondAddr)):pageId.find("#secondaddr").val("");var city=orgDetails.city;city?pageId.find("#city").val(ZPeople.decodeTxt(city)):pageId.find("#city").val("");var zip=orgDetails.zipcode;zip?pageId.find("#zipcode").val(ZPeople.decodeTxt(zip)):pageId.find("#zipcode").val("");var country=orgDetails.country;country?ZPeopleComponents.select(document.getElementById("countryNew")).setAttribute("selectedValue",ZPeople.decodeTxt(country)):(ZPeopleComponents.select(document.getElementById("countryNew")).deselectAllOptions(),ZPeopleComponents.select(document.getElementById("stateNew")).removeAllOptions());var state=orgDetails.state;state?ZPeopleComponents.select(document.getElementById("stateNew")).setAttribute("selectedValue",ZPeople.decodeTxt(state)):ZPeopleComponents.select(document.getElementById("stateNew")).deselectAllOptions(),CompanySetup.NewSetting.unsavedCompanyDetails={},pageId.find("#details-btn-div").hide()},deleteLogoAlert:function(){var alertDelete=new DeleteAlertMessage(ZPI18N.getString("zp.resetlogo"),ZPI18N.getString("zp.resetLogoConfirm"));alertDelete.yesButtonText=ZPI18N.getString("zp.confirm"),alertDelete.setCallback(CompanySetup.NewSetting.resetOrgLogo),alertDelete.show()},resetOrgLogo:function(){ZPeople.Request.send("/editCompanySettings.zp",{mode:"edit",method:"resetCompanyLogo"},function(resultData){if(resultData.hasOwnProperty("result")&&resultData.result){var pageId=CompanySetup.NewSetting.companyDetailsPageId;pageId.find("#compLogoVal img").attr("src",ZPeople.getResourceURL(newHRImgUrl+(Layout.isPeoplePlus?"zpeoplePlus.png":"zohopeoplelogo.png"))),pageId.find("#compLogoVal img").attr("no-logo","true"),pageId.find("#resetLogo").hide(),$(".zp_Nav .ZPHeadLft img").remove(),0==$(".zp_Nav .ZPHeadLft .DB").length&&$(".zp_Nav .ZPHeadLft").append('<a class="ZPLogo DB"></a>')}})},resetOrgDetails:function(){CompanySetup.NewSetting.companyDetailsCallback()},setTimeZoneGroups:function(timeZoneList,timeZoneValues,name,id,groupName){$.each(timeZoneList,function(index,timeZones){CompanySetup.NewSetting.setTimeZoneValues(timeZones,timeZoneValues,name,id,groupName)})},setTimeZoneValues:function(timeZones,timeZoneValues,label,value,groupName){$.each(timeZones.list,function(index,timeZone){if(timeZone.disp)CompanySetup.NewSetting.setTimeZoneGroups(timeZones,timeZoneValues,label,value,groupName);else{var time={};time[groupName]=timeZones.disp,time[label]=timeZone.name+" ("+timeZone.code+")",time[value]=timeZone.code,timeZoneValues.push(time)}})},validate:function(pageId,action){var companName=pageId.find("#companyName").removeClass("ztextbox__error"),adminMail=pageId.find("#adminemail").removeClass("ztextbox__error");pageId.find("#errorOrgName").remove(),pageId.find("#errorAdminMail").remove();var validate=!0;""==CompanySetup.NewSetting.unsavedCompanyDetails.companyName&&(companName.addClass("ztextbox__error").after("<span id='errorOrgName' class='ztextbox--error__label'>"+ZPI18N.getString("zp.emptyOrgName")+"</span>"),validate=!1),CompanySetup.NewSetting.unsavedCompanyDetails.hasOwnProperty("adminemail")&&!/^\w+((-\w+)|(\.\w+)|(\+\w+)|(\'\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/.test($.trim(CompanySetup.NewSetting.unsavedCompanyDetails.adminemail))&&(adminMail.addClass("ztextbox__error").after("<span id='errorAdminMail' class='ztextbox--error__label'>"+ZPI18N.getString("zp.entervalidemailaddress")+"</span>"),validate=!1),validate&&CompanySetup.NewSetting.showSaveAlert(pageId,action)},showSaveAlert:function(pageId,action){var alertInfo;"details"==action?(alertInfo=new InfoAlertMessage(ZPI18N.getString("zp.saveOrgDetailsTitle"),ZPI18N.getString("zp.saveOrgDetailsConfirmMsg"))).setCallback(CompanySetup.NewSetting.saveOrgDetails):((alertInfo=new InfoAlertMessage(ZPI18N.getString("zp.saveOrgSettingsTitle"),ZPI18N.getString("zp.saveOrgSettingsConfirmMsg"))).setCallback(CompanySetup.NewSetting.saveOrgFormats),alertInfo.action=action);alertInfo.yesButtonText=ZPI18N.getString("zp.confirm"),alertInfo.show()},saveOrgDetails:function(){var pageId=CompanySetup.NewSetting.companyDetailsPageId;ZPeople.autosave.loading(pageId.find("#details-card-header"),ZPI18N.getString("zp.saving")),pageId.find("#details-btn-div").hide(),CompanySetup.NewSetting.saveOrgValues(CompanySetup.NewSetting.unsavedCompanyDetails,"details")},loadStateValues:function(event,data){if(data.selectedValue){var code;data.fromUI?code=data.optionData.id:$.each(data.element[0].options,function(index,optionElement){optionElement.selected&&(code=optionElement.id)});var params={countryCode:code,mode:"getStatesList"};CompanySetup.NewSetting.unsavedCompanyDetails.country=code,ZPeople.Request.send("/formAction.zp",params,CompanySetup.NewSetting.loadStatesBasedOnCountry,event)}},loadStatesBasedOnCountry:function(result,params,event){var states=Array();$.each(result.data,function(index,state){states[index]={},states[index].label=states[index].value=state.state_name,states[index].id=state.state_code});var stateEle=ZPeopleComponents.select(settingsPage.container.find('select[name="state"]')),stateInDB=stateEle.getAttribute("selectedValue");stateEle.removeAllOptions(),stateEle.addOption(states),stateEle.deselectAllOptions(),event.detail.fromUI||stateEle.setAttribute("selectedValue",stateInDB),stateEle.setAttribute("showSearchField",states.length>4)},openUploadPopup:function(){var pageId=CompanySetup.NewSetting.companyDetailsPageId,uploadLogoPopup=pageId.find("#uploadLogoPopup"),previousImage=pageId.find("#compLogoVal img").attr("src");"true"==pageId.find("#compLogoVal img").attr("no-logo")?(uploadLogoPopup.find("i").removeClass("DN"),uploadLogoPopup.find("h4").removeClass("DN"),uploadLogoPopup.find("img").addClass("DN"),uploadLogoPopup.find("#filebtn").text(ZPI18N.getString("zp.uploadfile"))):(uploadLogoPopup.find("i").addClass("DN"),uploadLogoPopup.find("h4").addClass("DN"),uploadLogoPopup.find("img").removeClass("DN"),uploadLogoPopup.find("#filebtn").text(ZPI18N.getString("zp.removeandnew")),uploadLogoPopup.find("img").attr("src",previousImage)),uploadLogoPopup.find("#logoImgName").addClass("DNI"),pageId.find("#uploadLogoPopup").addClass("zpl_mopen")},closeLogoPopup:function(){var pageId=CompanySetup.NewSetting.companyDetailsPageId;pageId.find("input#desktop").val(""),pageId.find("#uploadLogoPopup").removeClass("zpl_mopen")},uploadLogo:function(){var pageId=CompanySetup.NewSetting.companyDetailsPageId,formId=pageId.find("#submitOrgLogo");0==formId.find("input#desktop").length&&formId.append('<input type="file" class="ZPFfile" id="desktop" accept="image/png, image/gif, image/jpeg, image/jpg" name="image" onChange="CompanySetup.NewSetting.setSelectedImgFile()">'),pageId.find("input#desktop").val(""),pageId.find("input#desktop").trigger("click")},setSelectedImgFile:function(){var pageId=CompanySetup.NewSetting.companyDetailsPageId;if(pageId.find("input#desktop")[0].files[0].size>512e3){var msg=ZPI18N.getString("zp.filesizeexceeded");ZPeople.Message.failure(msg)}else{var uploadLogoPopup=pageId.find("#uploadLogoPopup");uploadLogoPopup.find("img").addClass("DN"),uploadLogoPopup.find("i").removeClass("DN"),uploadLogoPopup.find("h4").addClass("DN"),uploadLogoPopup.find("#filebtn").text(ZPI18N.getString("zp.removeandnew"));var imagePath=pageId.find("input#desktop").val();uploadLogoPopup.find("#logoImgName").removeClass("DNI").find("span").text(imagePath)}},uploadOrgLogo:function(){var pageId=CompanySetup.NewSetting.companyDetailsPageId,imagePath=pageId.find("input#desktop").val();if(imagePath&&0!=imagePath.length)if(imagePath.endsWith("jpg")||imagePath.endsWith("png")||imagePath.endsWith("gif")||imagePath.endsWith("jpeg")||imagePath.endsWith("JPG")||imagePath.endsWith("PNG")||imagePath.endsWith("GIF")||imagePath.endsWith("JPEG")){if(pageId.find("input#desktop")[0].files[0].size<512e3)pageId.find("form#submitOrgLogo").trigger("submit");else{msg=ZPI18N.getString("zp.filesizeexceeded");ZPeople.Message.failure(msg)}}else{var msg=ZPI18N.getString("zp.allowedimagetypes");ZPeople.Message.failure(msg)}else{var msg=ZPI18N.getString("zp.selectimage");ZPeople.Message.failure(msg)}},companySettingsInitCallback:function(){settingsPage.container.find("#topSettMenu").addClass("zpl_DNI");var pageId=CompanySetup.NewSetting.companySettingsPageId=settingsPage.container;CompanySetup.NewSetting.initCallback(pageId,CompanySetup.NewSetting.companySettingsInitCall)},orgSettingsPageSetup:function(pageId){pageId.append(CompanySetup.NewSetting.topDiv),pageId.find("#topDiv").append('<div class="zpl_crd" id="notificationsCard"> </div>');var header='<div class="zpl_crdhdr" id="notification-card-header"> <div> <h4>'+ZPI18N.getString("zp.alertschats")+'</h4> </div><div id="notification-btn-div" style="display:none"><button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="CompanySetup.NewSetting.resetOrgFormats(\'notification\')"> '+ZPI18N.getString("zp.reset")+' </button><button type="button" class="zlabel zlabel--blue zlabel--medium" onclick="CompanySetup.NewSetting.showSaveAlert(settingsPage.container,\'notification\')"> '+ZPI18N.getString("zp.save")+" </button><div></div>";pageId.find("#notificationsCard").append(header),pageId.find("#notificationsCard").append('<div class="zpl_crdcnt" id="notifications-card-content"> </div>'),cardElement='<div class="zpl_secn"><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbuttondis-js" name="notify" id="notifyNew" />'+ZPI18N.getString("zp.notifications")+'</h5><p id="notifyNewDesc"> </p></div></div>',pageId.find("#notifications-card-content").append(cardElement),ZPeopleComponents.toggleswitch(document.getElementById("notifyNew"),{on:!1}),cardElement='<div class="zpl_secn"><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input name="chat" class="togbuttondis-js" id="chatNew" />'+ZPI18N.getString("zp.chatsettings.chat")+'</h5><p id="chatNewDesc"> </p></div></div>',pageId.find("#notifications-card-content").append(cardElement),ZPeopleComponents.toggleswitch(document.getElementById("chatNew"),{on:!1}),cardElement='<div class="zpl_secn"><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input name="botendisable" class="togbuttondis-js" id="botendisableNew" />'+ZPI18N.getString("zp.bot")+'</h5><p id="botendisableNewDesc"> </p></div></div>',pageId.find("#notifications-card-content").append(cardElement),ZPeopleComponents.toggleswitch(document.getElementById("botendisableNew"),{on:!1}),$("#notifications-card-content").on("ztoggleswitchchange",function(event){pageId.find("#notification-btn-div").show();var id=event.target.attr("id"),name=event.target.attr("name");CompanySetup.NewSetting.unsavedNotificationSettings[name]="botendisableNew"==id?ZPeopleComponents.toggleswitch(document.getElementById(id)).getState():ZPeopleComponents.toggleswitch(document.getElementById(id)).getState()?"1":"0"}),pageId.find("#notifications-card-content #notifyNewDesc").text(ZPI18N.getString("zp.notificationsToggleDesc")),pageId.find("#notifications-card-content #chatNewDesc").text(ZPI18N.getString("zp.chatToggleDesc")),pageId.find("#notifications-card-content #botendisableNewDesc").text(ZPI18N.getString("zp.botToggleDesc")),employeeSettings.personalInfo.builder(pageId),pageId.find("#topDiv").append('<div class="zpl_crd" id="searchSettingsCard"> </div>');header='<div class="zpl_crdhdr" id="orgSearchSetting-card-header"> <div> <h4>'+ZPI18N.getString("zp.employeesearch")+'</h4> </div><div id="search-btn-div" style="display:none"><button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="CompanySetup.NewSetting.resetOrgFormats(\'orgSearchSetting\')"> '+ZPI18N.getString("zp.reset")+' </button><button type="button" class="zlabel zlabel--blue zlabel--medium" onclick="CompanySetup.NewSetting.showSaveAlert(settingsPage.container,\'orgSearchSetting\')"> '+ZPI18N.getString("zp.save")+" </button><div></div>";pageId.find("#searchSettingsCard").append(header),pageId.find("#searchSettingsCard").append('<div class="zpl_crdcnt" id="search-card-content"> </div>'),cardElement='<div class="zpl_secn"><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbuttondis-js" name="isMobileSearchAllowed" id="searchSettingNew" />'+ZPI18N.getString("zp.allowMobileInSearch")+'</h5><p id="searchSettingNewDesc"> </p></div></div>',pageId.find("#search-card-content").append(cardElement),ZPeopleComponents.toggleswitch(document.getElementById("searchSettingNew"),{on:!1}),$("#search-card-content").on("ztoggleswitchchange",function(event){pageId.find("#search-btn-div").show();var id=event.target.attr("id"),name=event.target.attr("name");CompanySetup.NewSetting.unsavedSearchSettings[name]=ZPeopleComponents.toggleswitch(document.getElementById(id)).getState()?"1":"0"}),employeeSettings.photoInfo.builder(pageId),pageId.find("#topDiv").append('<div class="zpl_crd" id="coverImageCard"> </div>');header='<div class="zpl_crdhdr" id="coverImageCard-card-header"> <div> <h4>'+ZPI18N.getString("zp.coverimagepreference")+"</h4><p>"+ZPI18N.getString("zp.coverimagedesccompanysettings")+'</p> </div><div id="coverimage-btn-div" style="display:none"><button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="CompanySetup.NewSetting.resetOrgFormats(\'coverImgSetting\')"> '+ZPI18N.getString("zp.reset")+' </button><button type="button" class="zlabel zlabel--blue zlabel--medium" onclick="CompanySetup.NewSetting.showSaveAlert(settingsPage.container,\'coverImgSetting\')"> '+ZPI18N.getString("zp.save")+" </button><div></div>";pageId.find("#coverImageCard").append(header),pageId.find("#coverImageCard").append('<div class="zpl_crdcnt" id="coverImgOption-card-content"> </div>'),cardElement='<div class="zpl_secn"><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbuttondis-js" name="isSysImg" id="isSysImg" />'+ZPI18N.getString("zp.isPredefinedAllowed")+'</h5><p id="isPredefinedAllowedNewDesc"> </p></div></div>',cardElement+='<div class="zpl_secn"><div class="zpl_tgsprt"><h5 class="zpl_tgl"><input class="togbuttondis-js" name="isCustomImg" id="isCustomImg" />'+ZPI18N.getString("zp.isCustomCoverAllowed")+'</h5><p id="isCustomCoverAllowedNeeDesc"> </p></div></div>',pageId.find("#coverImgOption-card-content").append(cardElement),ZPeopleComponents.toggleswitch(document.getElementById("isSysImg"),{on:!1}),ZPeopleComponents.toggleswitch(document.getElementById("isCustomImg"),{on:!1}),$("#coverImgOption-card-content").on("ztoggleswitchchange",function(event){pageId.find("#coverimage-btn-div").show();var id=event.target.attr("id"),name=event.target.attr("name");CompanySetup.NewSetting.unsavedSearchSettings[name]=ZPeopleComponents.toggleswitch(document.getElementById(id)).getState()?"1":"0"}),pageId.find("#topDiv").append('<div class="zpl_crd" id="localeCard"> </div>');header='<div class="zpl_crdhdr" id="locale-card-header"> <div> <h4>'+ZPI18N.getString("zp.localeDisplay")+'</h4> </div><div id="locale-btn-div" style="display:none"><button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="CompanySetup.NewSetting.resetOrgFormats(\'locale\')"> '+ZPI18N.getString("zp.reset")+' </button><button type="button" class="zlabel zlabel--blue zlabel--medium" onclick="CompanySetup.NewSetting.showSaveAlert(settingsPage.container,\'locale\')"> '+ZPI18N.getString("zp.save")+" </button><div></div>";pageId.find("#localeCard").append(header),pageId.find("#localeCard").append('<div class="zpl_crdcnt" id="locale-card-content"> </div>'),cardElement='<div class="zpl_secn"> <div> <h5>'+ZPI18N.getString("zp.localesettings.locale")+' </h5><p id="currentlocaleNewDesc"> </p> </div><div class="zpl_idiv"> <select class="select-js" data-width="400" name="currentlocale" id="currentlocaleNew"> </select> </div></div>',pageId.find("#locale-card-content").append(cardElement),ZPeopleComponents.select(document.getElementById("currentlocaleNew"),{acceptNewValues:!0,showSearchField:!0}),cardElement='<div class="zpl_secn"> <div> <h5>'+ZPI18N.getString("zp.timezone")+' </h5><p id="timezoneNewDesc"> </p> </div><div class="zpl_idiv"> <select class="select-js" data-width="400" name="timezone" id="timezoneNew"> </select> </div></div>',pageId.find("#locale-card-content").append(cardElement),ZPeopleComponents.select(document.getElementById("timezoneNew"),{acceptNewValues:!0,showSearchField:!0}),cardElement='<div class="zpl_secn"><div><h5> '+ZPI18N.getString("zp.time")+"</h5><p>"+ZPI18N.getString("zp.timeFormatDesc")+'<p></div><div id="radioTime"><div class="zradiobutton zradiobutton--horizontal"><input id="12hrs" type="radio" name="timeFormat" class="zradiobutton__helper"><label for="12hrs" class="zradiobutton__label"><span class="zradiobutton__text"> '+ZPI18N.getString("zp.12Hrs")+' </span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="24hrs" type="radio" name="timeFormat" class="zradiobutton__helper" ><label for="24hrs" class="zradiobutton__label"><span class="zradiobutton__text"> '+ZPI18N.getString("zp.24Hrs")+" </span></label></div></div></div>",pageId.find("#locale-card-content").append(cardElement),cardElement='<div class="zpl_secn"> <div> <h5>'+ZPI18N.getString("zp.name")+' </h5><p id="userDetailTypeNewDesc"> </p> </div><div class="zpl_idiv"> <select class="select-js" data-width="400" name="userDetailType" id="userDetailTypeNew"> </select> </div></div>',pageId.find("#locale-card-content").append(cardElement),cardElement='<div class="zpl_secn"> <div> <h5>'+ZPI18N.getString("zp.date")+' </h5><p id="dateformatNewDesc"> </p> </div><div class="zpl_idiv"> <select class="select-js" data-width="400" name="dateformat" id="dateformatNew"> </select> </div></div>',pageId.find("#locale-card-content").append(cardElement),ZPeopleComponents.select(document.getElementById("dateformatNew"),{acceptNewValues:!0,showSearchField:!0}),pageId.find("#locale-card-content #currentlocaleNewDesc").text(ZPI18N.getString("zp.localeCountryDesc")),pageId.find("#locale-card-content #timezoneNewDesc").text(ZPI18N.getString("zp.localeTimezoneDesc")),pageId.find("#locale-card-content #userDetailTypeNewDesc").text(ZPI18N.getString("zp.nameFormatDesc")),pageId.find("#locale-card-content #dateformatNewDesc").text(ZPI18N.getString("zp.dateFormatDesc")),pageId.find("#radioTime").on("change",function(){pageId.find("#locale-btn-div").show(),CompanySetup.NewSetting.unsavedLocaleSettings.timeFormat="24hrs"==pageId.find('input[name="timeFormat"]:checked').prop("id")?"HH:mm":"hh:mm a"}),pageId.find("#locale-card-content").on("zselectchange",function(event){pageId.find("#locale-btn-div").show();var id=event.target.attr("id"),name=event.target.attr("name");switch(id){case"currentlocaleNew":CompanySetup.NewSetting.unsavedLocaleSettings[name]=pageId.find("#currentlocaleNew :selected").attr("id");break;default:CompanySetup.NewSetting.unsavedLocaleSettings[name]=ZPeopleComponents.select(document.getElementById(id)).getValue()}}),CompanySetup.NewSetting.initialSettings()},initialSettings:function(){var dateFormats=Array();dateFormats.push({value:"MM-dd-yyyy",label:ZPI18N.getString("zp.format1")}),dateFormats.push({value:"dd-MM-yyyy",label:ZPI18N.getString("zp.format2")}),dateFormats.push({value:"dd-MMM-yyyy",label:ZPI18N.getString("zp.format3")}),dateFormats.push({value:"dd-MMM-yy",label:ZPI18N.getString("zp.format4")}),dateFormats.push({value:"MM/dd/yyyy",label:ZPI18N.getString("zp.format5")}),dateFormats.push({value:"dd/MM/yyyy",label:ZPI18N.getString("zp.format6")}),dateFormats.push({value:"yyyy-MM-dd",label:ZPI18N.getString("zp.format7")}),dateFormats.push({value:"yyyy/MM/dd",label:ZPI18N.getString("zp.format8")}),dateFormats.push({value:"dd.MM.yyyy",label:ZPI18N.getString("zp.format9")}),ZPeopleComponents.select(document.getElementById("dateformatNew")).addOption(dateFormats)},companySettingsInitCall:function(resultData,params,pageId){CompanySetup.NewSetting.orgSettingsPageSetup(pageId),CompanySetup.NewSetting.getLocaleValues(resultData),CompanySetup.NewSetting.setValuesForCompanySettings(resultData,params)},companySettingsCallback:function(mode){mode=void 0==mode?"settings":mode,CompanySetup.NewSetting.companyCallback(null,null,mode)},setValuesForCompanySettings:function(resultData,params,mode){var pageId=CompanySetup.NewSetting.companySettingsPageId=settingsPage.container,result=resultData.orgSettingsDtls;switch(mode){case"locale":if((localeRegion=result.currentlocale)?ZPeopleComponents.select(document.getElementById("currentlocaleNew")).setAttribute("selectedValue",ZPeople.decodeTxt(localeRegion)):ZPeopleComponents.select(document.getElementById("currentlocaleNew")).deselectAllOptions(),(timeZone=result.timezoneVal)?ZPeopleComponents.select(document.getElementById("timezoneNew")).setAttribute("selectedValue",timeZone):ZPeopleComponents.select(document.getElementById("timezoneNew")).deselectAllOptions(),ZPeopleComponents.select(document.getElementById("userDetailTypeNew")).setAttribute("selectedValue",result.userDetailType),ZPeopleComponents.select(document.getElementById("dateformatNew")).setAttribute("selectedValue",ZPeople.decodeTxt(result.dateformat)),timeFormat=result.timeFormat){var optionId="HH:mm"==timeFormat?"24hrs":"12hrs";$(settingsPage.container).find("#"+optionId).prop("checked",!0)}else $('input[name="timeFormat"]').prop("checked",!1);CompanySetup.NewSetting.unsavedLocaleSettings={},pageId.find("#locale-btn-div").hide();break;case"notification":ZPeopleComponents.toggleswitch(document.getElementById("notifyNew")).setAttribute("on","1"==result.notify),ZPeopleComponents.toggleswitch(document.getElementById("chatNew")).setAttribute("on","1"==result.chat),ZPeopleComponents.toggleswitch(document.getElementById("botendisableNew")).setAttribute("on",result.isBotEnabled),CompanySetup.NewSetting.unsavedNotificationSettings={},pageId.find("#notification-btn-div").hide();break;case"orgSearchSetting":ZPeopleComponents.toggleswitch(document.getElementById("searchSettingNew")).setAttribute("on",result.isMobileSearchAllowed),CompanySetup.NewSetting.unsavedSearchSettings={},pageId.find("#search-btn-div").hide();break;case"coverImgSetting":ZPeopleComponents.toggleswitch(document.getElementById("isSysImg")).setAttribute("on",result.isSysImg),ZPeopleComponents.toggleswitch(document.getElementById("isCustomImg")).setAttribute("on",result.isCustomImg),CompanySetup.NewSetting.unsavedSearchSettings={},pageId.find("#coverimage-btn-div").hide();break;default:var localeRegion,timeZone;(localeRegion=result.currentlocale)?ZPeopleComponents.select(document.getElementById("currentlocaleNew")).setAttribute("selectedValue",ZPeople.decodeTxt(localeRegion)):ZPeopleComponents.select(document.getElementById("currentlocaleNew")).deselectAllOptions(),(timeZone=result.timezoneVal)?ZPeopleComponents.select(document.getElementById("timezoneNew")).setAttribute("selectedValue",timeZone):ZPeopleComponents.select(document.getElementById("timezoneNew")).deselectAllOptions(),ZPeopleComponents.toggleswitch(document.getElementById("notifyNew")).setAttribute("on","1"==result.notify),ZPeopleComponents.toggleswitch(document.getElementById("chatNew")).setAttribute("on","1"==result.chat),ZPeopleComponents.toggleswitch(document.getElementById("botendisableNew")).setAttribute("on",result.isBotEnabled);var timeFormat,nameFormats=Array();if(ZPeopleComponents.select(document.getElementById("userDetailTypeNew")).removeAllOptions(),(resultData.isLastNameMand||result.isLastNameMand)&&nameFormats.push({label:ZPeople.decodeTxt(ZPI18N.getString("zp.lastname")),value:2}),nameFormats.push({label:ZPeople.decodeTxt(ZPI18N.getString("zp.firstname")),value:3}),nameFormats.push({label:ZPeople.decodeTxt(ZPI18N.getString("zp.firstnamelastname")),value:4}),nameFormats.push({label:ZPeople.decodeTxt(ZPI18N.getString("zp.lastnamefirstname")),value:5}),ZPeopleComponents.select(document.getElementById("userDetailTypeNew")).addOption(nameFormats),ZPeopleComponents.select(document.getElementById("userDetailTypeNew")).setAttribute("selectedValue",result.userDetailType),ZPeopleComponents.select(document.getElementById("dateformatNew")).setAttribute("selectedValue",ZPeople.decodeTxt(result.dateformat)),timeFormat=result.timeFormat){optionId="HH:mm"==timeFormat?"24hrs":"12hrs";$(pageId).find("#"+optionId).prop("checked",!0)}else $('input[name="timeFormat"]').prop("checked",!1);employeeSettings.personalInfo.initiator(result,pageId),employeeSettings.photoInfo.initiator(result,pageId,params.mode),ZPeopleComponents.toggleswitch(document.getElementById("searchSettingNew")).setAttribute("on",result.isMobileSearchAllowed),ZPeopleComponents.toggleswitch(document.getElementById("isSysImg")).setAttribute("on",result.isSysImg),ZPeopleComponents.toggleswitch(document.getElementById("isCustomImg")).setAttribute("on",result.isCustomImg),CompanySetup.NewSetting.unsavedNotificationSettings={},CompanySetup.NewSetting.unsavedAppLockSettings={},CompanySetup.NewSetting.unsavedLocaleSettings={},CompanySetup.NewSetting.unsavedSearchSettings={},CompanySetup.NewSetting.unsavedPersonalSettings={},CompanySetup.NewSetting.unsavedPhotoSettings={},pageId.find('[id*="_CLEARSAVE"]').hide(),pageId.find("#locale-btn-div").hide(),pageId.find("#notification-btn-div").hide(),pageId.find("#appLock-btn-div").hide(),pageId.find("#search-btn-div").hide(),pageId.find("#coverimage-btn-div").hide()}},resetOrgFormats:function(mode){CompanySetup.NewSetting.companySettingsCallback(mode)},saveOrgFormats:function(data){var pageId=CompanySetup.NewSetting.companySettingsPageId,orgValues={};switch(data.action){case"locale":orgValues=CompanySetup.NewSetting.unsavedLocaleSettings,pageId.find("#locale-btn-div").hide();break;case"notification":orgValues=CompanySetup.NewSetting.unsavedNotificationSettings,pageId.find("#notification-btn-div").hide();break;case"appLock":orgValues=CompanySetup.NewSetting.unsavedAppLockSettings,pageId.find("#appLock-btn-div").hide();break;case"orgSearchSetting":orgValues=CompanySetup.NewSetting.unsavedSearchSettings,pageId.find("#search-btn-div").hide();break;case"coverImgSetting":orgValues=CompanySetup.NewSetting.unsavedSearchSettings,pageId.find("#coverimage-btn-div").hide();break;case constants.DB_PERSONAL:orgValues=employeeSettings.db._saveobjbymode(data.action),pageId.find("#"+data.action+"_CLEARSAVE").hide();break;case constants.DB_PHOTO:pageId.find("#"+data.action+"_CLEARSAVE").hide(),orgValues=employeeSettings.photoInfo.photoParamsAssign()}pageId.find("#"+data.action+"-card-header").length>0?ZPeople.autosave.loading(pageId.find("#"+data.action+"-card-header"),ZPI18N.getString("zp.saving")):ZPeople.autosave.loading(common._crd_ele(data.action+"_CARD",pageId).find(".zpl_crdhdr"),ZPI18N.getString("zp.saving")),CompanySetup.NewSetting.saveOrgValues(orgValues,data.action)},callForSetTimeOutEvent:function(mode){switch(mode){case"details":CompanySetup.NewSetting.unsavedCompanyDetails={};break;case"locale":CompanySetup.NewSetting.unsavedLocaleSettings={};break;case"notification":CompanySetup.NewSetting.unsavedNotificationSettings={};break;case"appLock":CompanySetup.NewSetting.unsavedAppLockSettings={};break;case"orgSearchSetting":case"coverImgSetting":CompanySetup.NewSetting.unsavedSearchSettings={};break;case constants.DB_PERSONAL:CompanySetup.NewSetting.unsavedPersonalSettings={};break;case constants.DB_PHOTO:CompanySetup.NewSetting.unsavedPhotoSettings={}}},getLocaleValues:function(resultData){var pageId=settingsPage.container;CompanySetup.NewSetting.loadTimeZones(resultData,"timezoneNew"),CompanySetup.NewSetting.loadCountries(resultData,"currentlocaleNew",!1,pageId)},companyCallback:function(resultData,params,mode){var callBackName="details"==mode?CompanySetup.NewSetting.setCompanyDetails:CompanySetup.NewSetting.setValuesForCompanySettings;ZPeople.Request.send("/viewCompanySettings.zp",{mode:"view",method:"getCompanySettingsDetails"},callBackName,mode)},saveOrgValues:function(orgValues,mode){var params={orgsettingsjson:JSON.stringify(orgValues),method:"saveCompanySettings"};ZPeople.Request.send("/saveCompanySettings.zp",params,CompanySetup.NewSetting.saveOrgDetailsCallBack,mode,CompanySetup.NewSetting.saveOrgDetailsCallBack)},saveOrgDetailsCallBack:function(resultData,params,mode){var pageId=settingsPage.container;if("Success"==resultData.result)pageId.find("#"+mode+"-card-header").length>0?ZPeople.autosave.success(pageId.find("#"+mode+"-card-header"),ZPI18N.getString("zp.saved")):(mode!=constants.DB_PERSONAL&&mode!=constants.DB_PHOTO||employeeSettings._cardObjbymode(mode).setReset(pageId,resultData.values),ZPeople.autosave.success(common._crd_ele(mode+"_CARD").find(".zpl_crdhdr"),ZPI18N.getString("zp.saved"))),CompanySetup.NewSetting.callForSetTimeOutEvent(mode),resultData.values&&(resultData.values.hasOwnProperty("timeFormat")&&resultData.values.timeFormat&&(timeFormat=resultData.values.timeFormat),resultData.values.hasOwnProperty("dateformat")&&resultData.values.dateformat&&(dateFmt=resultData.values.dateformat));else{if(pageId.find("#"+mode+"-card-header").length>0?ZPeople.autosave.fail(pageId.find("#"+mode+"-card-header"),ZPI18N.getString("zp.notsaved")):ZPeople.autosave.fail(common._crd_ele(mode+"_CARD").find(".zpl_crdhdr"),ZPI18N.getString("zp.notsaved")),resultData.responseJSON&&resultData.responseJSON.error){var msg=resultData.responseJSON.error;ZPeople.Message.failure(msg)}else if(resultData.adminemail)pageId.find("#adminemail").addClass("ztextbox__error").after("<span id='errorAdminMail' class='ztextbox--error__label'>"+ZPI18N.getString("zp.adminmailerrmsg")+"</span>");else{msg=ZPI18N.getString("zp.lms.settings.Unabletosave");ZPeople.Message.failure(msg)}switch(mode){case"details":pageId.find("#details-btn-div").show();break;case"locale":pageId.find("#locale-btn-div").show();break;case"notification":pageId.find("#notification-btn-div").show();break;case"appLock":pageId.find("#appLock-btn-div").show();break;case"orgSearchSetting":pageId.find("#search-btn-div").show();break;case"coverImgSetting":pageId.find("#coverimage-btn-div").show();break;case constants.DB_PERSONAL:case constants.DB_PHOTO:pageId.find("#"+mode+"_CLEARSAVE").show()}}},unsavedDetailsCallback:function(li,callback){if(isEmpty(CompanySetup.NewSetting.unsavedCompanyDetails))callback(li);else{var alertInfo=new InfoAlertMessage(ZPI18N.getString("zp.unsavehdr"),ZPI18N.getString("zp.unsavedesc"));alertInfo.setCallback(function(){callback(li)}),alertInfo.yesButtonText=ZPI18N.getString("zp.confirm"),alertInfo.show()}},unsavedSettingsCallback:function(li,callback){if(isEmpty(CompanySetup.NewSetting.unsavedLocaleSettings)&&isEmpty(CompanySetup.NewSetting.unsavedNotificationSettings)&&isEmpty(CompanySetup.NewSetting.unsavedAppLockSettings)&&isEmpty(CompanySetup.NewSetting.unsavedSearchSettings)&&isEmpty(CompanySetup.NewSetting.unsavedPersonalSettings)&&isEmpty(CompanySetup.NewSetting.unsavedPhotoSettings))callback(li);else{var alertInfo=new InfoAlertMessage(ZPI18N.getString("zp.unsavehdr"),ZPI18N.getString("zp.unsavedesc"));alertInfo.setCallback(function(){callback(li)}),alertInfo.yesButtonText=ZPI18N.getString("zp.confirm"),alertInfo.show()}}};var Locations={};Locations.NewSetting={options:'<div class="zpl_rgt" id="options"><button class="zlabel zlabel--blue zlabel--medium" id="addButton" onclick="Locations.NewSetting.openAddModel()">'+ZPI18N.getString("zp.addlocation")+"</button></div>",table:'<div class="zpl_rgtcnt" id="rgttable" style="display:none""><div class="zpl_tblres"><table class="zpl_tbl"><thead> </thead><tbody elem="tableContainer"> </tbody></table></div></div>',locationsPageId:null,locationsFormId:null,locationsViewId:null,fireScrollUniqID:"orgLocationsNode",startingIndex:1,limitPerPage:25,filterApplied:!1,filterLocName:"",filterCountryName:"",filterPopup:'<div class="zpl_fltr"><div><div class="zpl_fltrhd"><h5> '+ZPI18N.getString("zp.filter")+' </h5><i class="PI_cls" onclick="Locations.NewSetting.filterOut()"> </i></div></div><div class="zpl_fltrcnt"><div><div class="zpl_fltclps fltopn"><div class="zpl_fltrlst" id="filterList"></div></div></div></div><div><button id="" type="button" elem="applyFilter" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.apply")+' </button><button type="button" elem="resetFilter" class="zlabel zlabel--outline zlabel--medium"> '+ZPI18N.getString("zp.reset")+" </button></div></div>",emptyData:'<div class="zpl_crd zpl_nodata" id="emptyDataCard"> <div class="zpl_crdcnt"> <div class="zpl_Emptydata"> <div> <div id="emptyImage" class="zpl_emptimg"> </div><h4> </h4><p> </p><font><button class="zlabel zlabel--blue zlabel--medium"></button></font> </div> </div> </div> </div>',filterChanged:!1,isOnLoad:!0,containsAddressField:!1,needRefreshLocationsList:!0,initialCallBack:function(){var pageId=Locations.NewSetting.locationsPageId=settingsPage.container.addClass("zpl_tblfxd zpl_orgloc");0==pageId.find("#zp_page_loading").length&&pageId.append(ZPeople.LOADING_HTML),FrameworkCommon.hide(pageId.find("#topSettMenu")),pageId.find("#topSettMenu").append('<div class="PT5"> <span>'+ZPI18N.getString("zp.counttotal")+' : <a onclick="Locations.NewSetting.getLocationsCount()" id="hash">#</a><b id="totalCount" class="DN">0</b></span> </div>'),pageId.find("#topSettMenu").append(Locations.NewSetting.options);var icons='<button class="zlabel zlabel--outline zlabel--medium" id="importButton" onClick="Locations.NewSetting.importLocation()"> '+ZPI18N.getString("zp.import")+' </button><a class="zpl_ibg" title="'+ZPI18N.getString("zp.export")+'" id="exportButon" onClick="Locations.NewSetting.exportLocation()"> <span class="PI_exprt"></span> </a><i class="zpl_ibg PI_fltr" onClick="Locations.NewSetting.filterOpen()" title="'+ZPI18N.getString("zp.filter")+'"> </i>';pageId.find("#options").children().eq(0).after(icons),pageId.append('<div id="location-filterBreadcrumb" class="zpl_fltrvw DN"> <div id="location-filterBreadcrumbWrapper"> <ul id="location-filterBreadcrumbList" class="zpl_fltrvwlst"></ul> </div> <div id="location-breadcrumbClearAll" class="d-flexcap MLauto"><a class="zpl_link" onclick="Locations.NewSetting.resetFilter()">Clear all</a> </div> </div>'),pageId.append(Locations.NewSetting.table);var tableHeading='<tr><th style="min-width: 250px;"> '+ZPI18N.getString("zp.locationname")+" </th>"+(ZPeople.isCodeFieldEnabled?'<th style="min-width: 200px;"> '+ZPI18N.getString("zp.code")+" </th>":"")+"<th> "+ZPI18N.getString("zp.associatedUsers")+" </th><th> "+ZPI18N.getString("zp.mail")+' </th><th id="locCountry" class="zpl_DNI" style="min-width: 200px;"> '+ZPI18N.getString("zp.country")+' </th><th id="locAddress" class="zpl_DNI" style="min-width: 200px;"> '+ZPI18N.getString("zp.address")+" </th><th> "+ZPI18N.getString("zp.schtimezone")+" </th><th> "+ZPI18N.getString("zp.description")+' </th><th style="min-width: 200px;display:none;"> '+ZPI18N.getString("zp.state")+' </th><th style="min-width: 80px;"> <div class="text-center"> </div> </th></tr>';pageId.find("thead").append(tableHeading),pageId.find("table").after(Locations.NewSetting.emptyData),pageId.find("#emptyDataCard").after('<div id="noLocEmptPage"></div>'),new EmptyPages("zp_nd_locat",ZPI18N.getString("zp.locationNoDataForFilter"),"",pageId.find("#noLocEmptPage")).show(),FrameworkCommon.hide(pageId.find("#emptPage"));var emptyData=pageId.find("#emptyDataCard");emptyData.find("#emptyImage").addClass("zp_nd_locat"),emptyData.find("p").text(ZPI18N.getString("zp.locationNoData")),emptyData.find("button").on("click",function(){Locations.NewSetting.openAddModel()}),emptyData.find("button").text(ZPI18N.getString("zp.addlocation")),pageId.append(Locations.NewSetting.filterPopup),pageId.find("[elem=applyFilter]").off("click").on("click",Locations.NewSetting.applyFilter),pageId.find("[elem=resetFilter]").off("click").on("click",Locations.NewSetting.resetFilter);var option='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.locationname")+'</label></div><div><input placeholder="'+ZPI18N.getString("zp.locationname")+'" type="text" class="ztextbox" id="locationNameFilter"></div></div><div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.country")+'</label></div><div><select class="zselectbox select-js has-focus has-mfocus" id="countryFilter"></select></div></div>';pageId.find("#filterList").append(option),pageId.find("#locationNameFilter").off("change").on("change",Locations.NewSetting.onFilterChange);new FireScrollBack(Locations.NewSetting.callBackForFireScroll,pageId,Locations.NewSetting.fireScrollUniqID);var params={mode:"edit",method:"getCompanySettingsDetails",zsoid:_LOGGEDIN_ZSOID};ZPeople.Request.send("/editCompanySettings.zp",params,Locations.NewSetting.initAddModel,pageId,null)},getLocationsCount:function(){var pageId=Locations.NewSetting.locationsPageId;params={},params.name=Locations.NewSetting.filterLocName,params.country=Locations.NewSetting.filterCountryName,ZPeople.Request.sendRequest("/v5/location/getCount",params,"GET",function(data){pageId.find("#hash").hide(),pageId.find("#totalCount").html(data.numRows).show()})},callbackForForm:function(){null===Locations.NewSetting.locationsFormId?Locations.NewSetting.callBackForFireScroll(function(resultData){Locations.NewSetting.locationsFormId=resultData.formId,settingsUrlProps.urlParamsArr.formId=Locations.NewSetting.locationsFormId,ZP5Form.formsCallback()}):(settingsUrlProps.urlParamsArr.formId=Locations.NewSetting.locationsFormId,ZP5Form.formsCallback())},initAddModel:function(resultData,params,pageId){let countries=Array();CompanySetup.NewSetting.getCountryValues(resultData.countryList,countries,"countryFilter"),countries.unshift({label:ZPI18N.getString("zp.select"),value:"-1",id:"-1"}),ZPeopleComponents.select(pageId.find("#countryFilter"),{change:Locations.NewSetting.onFilterChange,showSearchField:!0,dropdownList:{fitForElement:!0,height:"335px"}}).addOption(countries)},onFilterChange:function(){var pageId=Locations.NewSetting.locationsPageId,locName=pageId.find("#locationNameFilter").val(),countryName=pageId.find("#countryFilter").val();locName==Locations.NewSetting.filterLocName&&countryName==Locations.NewSetting.filterCountryName||(Locations.NewSetting.filterChanged=!0)},callBack:function(){var pageId=Locations.NewSetting.locationsPageId;Locations.NewSetting.needRefreshLocationsList&&(FrameworkCommon.hide(pageId.find("#emptyDataCard")),FrameworkCommon.hide(pageId.find("#emptPage")),pageId.find("#hash").show(),pageId.find("#totalCount").html("0").hide(),pageId.find("tbody").empty(),0==pageId.find("#zp_page_loading").length&&pageId.append(ZPeople.LOADING_HTML),Locations.NewSetting.startingIndex=1,Locations.NewSetting.callBackForFireScroll(),Locations.NewSetting.needRefreshLocationsList=!1)},openViewModel:function(event){if(event&&($(event.target).is("td")||!$(event.target).closest("td").hasClass("action-td"))){var trElem=event.target.closest("tr");window.location.href="#settings/service/accountsetup/locations/view-recordId:"+trElem.id}},openAddModel:function(){window.location.href="#settings/service/accountsetup/locations/add"},importLocation:function(){ZP5Import.init("location")},exportLocation:function(){ZP5Export.init("location")},setExportExtraParams:params=>{if(Locations.NewSetting.locationsPageId.find("[elem=tableContainer]").length<=0)return;let searchParam=[],name=Locations.NewSetting.locationsPageId.find("input#locationNameFilter").val(),country=ZPeopleComponents.select(Locations.NewSetting.locationsPageId.find("#countryFilter")).getValue();""!=name&&searchParam.push({LocationName:name,LocationName_op:"26"}),country&&""!=country&&"-1"!=country&&searchParam.push({Country:country,Country_op:"18"}),searchParam.length>0&&(searchParam=JSON.stringify(searchParam),params.searchBy=searchParam)},setLocations:function(resultData,params){var pageId=Locations.NewSetting.locationsPageId;if(Locations.NewSetting.filterLocName=params.name,Locations.NewSetting.filterCountryName=params.country,pageId.find("#rgttable").show(),FrameworkCommon.show(pageId.find("#topSettMenu")),FrameworkCommon.show(pageId.find("[elem=tableContainer]")),pageId.find("[elem=applyFilter],[elem=resetFilter]").removeClass("disabled"),pageId.find("#zp_page_loading").remove(),Locations.NewSetting.locationsFormId=resultData.formId,Locations.NewSetting.locationsViewId=resultData.viewId,Locations.NewSetting.isOnLoad&&(Locations.NewSetting.containsAddressField=resultData.isAddressField,resultData.isAddressField?pageId.find("#locAddress").removeClass("zpl_DNI"):pageId.find("#locCountry").removeClass("zpl_DNI"),Locations.NewSetting.isOnLoad=!1),0==resultData.locationDtls.length&&!Locations.NewSetting.filterApplied&&Locations.NewSetting.startingIndex<=1)pageId.find("table").hide(),FrameworkCommon.show(pageId.find("#emptyDataCard")),pageId.find("#addButton").hide();else{var locRows="";$.each(resultData.locationDtls,function(index,data){var description=data.LOCATIONDESC?ZSEC.Encoder.encodeForHTML(data.LOCATIONDESC):"",mailAlias=data.MAILALIAS?ZSEC.Encoder.encodeForHTML(data.MAILALIAS):"",timeZone=data.TIME_ZONE?ZSEC.Encoder.encodeForHTML(data.TIME_ZONE):"",address=data.ADDRESS?ZSEC.Encoder.encodeForHTML(data.ADDRESS):"",country=data.COUNTRY?ZSEC.Encoder.encodeForHTML(data.COUNTRY):"",locationName=ZSEC.Encoder.encodeForHTML(data.LOCATIONNAME),membersCount=data.membersCount,locRow='<tr id="'+data.LOCATIONID+'" locationname="'+ZSEC.Encoder.encodeForHTMLAttribute(data.LOCATIONNAME)+'" onclick="Locations.NewSetting.openViewModel(event)"> <td name="locationInList"> <span class="txttrim zpl_w200" onmouseover="orgSetupForms.mouseEnterFunction()">'+locationName+"</span> </td>";ZPeople.isCodeFieldEnabled&&(locRow+='<td name="codeInList"> <span>'+ZSEC.Encoder.encodeForHTML(data.CODE)+"</span> </td>"),locRow+='<td class="action-td"> <span>'+(membersCount>0?'<a onclick="Locations.NewSetting.locationCountUsers(event)">'+membersCount+"</a>":membersCount)+"</span> </td>",locRow+='<td name="mailAliasInList"> <span class="txttrim zpl_w200" onmouseover="orgSetupForms.mouseEnterFunction()"> '+mailAlias+"</span> </td>",Locations.NewSetting.containsAddressField?locRow+='<td name="addressInList">'+address+"</td>":locRow+='<td name="countryInList">'+country+"</td>",locRow+='<td name="timeZoneInList">'+timeZone+"</td>",locRow+='<td name="descriptionInList"> <span class="txttrim zpl_w200" onmouseover="orgSetupForms.mouseEnterFunction()">'+description+"</span> </td>",locRow+='<td class="action-td"> <div class="text-center"> <div class="zpl_hvr"> <i class="PI_delete" onClick="Locations.NewSetting.deleteLocationAlert(this)" title="'+ZPI18N.getString("zp.delete")+'"> </i> </div> </div> </td> </tr>',locRows+=locRow}),pageId.find("tbody").append(locRows),pageId.find("table").show(),pageId.find("#addButton").show(),pageId.find("[elem=applyFilter],[elem=resetFilter]").removeClass("disabled"),params.startInd+resultData.numRows<=1?Locations.NewSetting.filterApplied?FrameworkCommon.show(pageId.find("#emptPage")):FrameworkCommon.show(pageId.find("#emptyDataCard")):(FrameworkCommon.hide(pageId.find("#emptyDataCard")),FrameworkCommon.hide(pageId.find("#emptPage"))),resultData.numRows==Locations.NewSetting.limitPerPage?(Locations.NewSetting.startingIndex=params.startInd+resultData.numRows,settingsPage.fireScrollObj[Locations.NewSetting.fireScrollUniqID].reset()):resultData.numRows<Locations.NewSetting.limitPerPage&&(settingsPage.fireScrollObj[Locations.NewSetting.fireScrollUniqID].fireScrollCalled=!0)}},callBackForFireScroll:function(callback){Locations.NewSetting.locationsPageId;callback=callback||Locations.NewSetting.setLocations;var params={mode:"filter",name:Locations.NewSetting.filterLocName,country:Locations.NewSetting.filterCountryName,startInd:Locations.NewSetting.startingIndex,sortByType:0,isOnLoad:Locations.NewSetting.isOnLoad,isLocForm:!0};ZPeople.Request.sendRequest("/v5/location/getLocations",params,"GET",callback,null,null)},deleteLocationAlert:function(thisObj){var alertDelete=new DeleteAlertMessage(ZPI18N.getString("zp.locationDelMsgTitle"),ZPI18N.getString("zp.deleteLocationConfirmMsg"));alertDelete.setCallback(function(){Locations.NewSetting.deleteLocation(thisObj)}),alertDelete.yesButtonText=ZPI18N.getString("zp.confirm"),alertDelete.show()},deleteLocation:function(thisObj){var locationId=$(thisObj).closest("tr").attr("id"),params={mode:"deleteRecords",formId:Locations.NewSetting.locationsFormId,recordIds:locationId};ZPeople.Request.send("/formAction.zp",params,Locations.NewSetting.callBackForDeleteLocation,thisObj,null)},callBackForDeleteLocation:function(resultData,params,thisObj){var pageId=Locations.NewSetting.locationsPageId,errorObj=resultData.errObj;if(errorObj&&Object.keys(errorObj).length>0)errorObj[0].hasOwnProperty("error")?ZPeople.Message.failure(errorObj[0].error):ZPeople.Message.failure(errorObj[0].message);else if(void 0!=resultData.code&&7e3!==resultData.code)ZPeople.Message.warning(resultData.message);else if(void 0!=resultData.code&&7e3===resultData.code){$(thisObj).closest("tr").remove(),Locations.NewSetting.startingIndex--;var count=$(pageId).find("tr").length;count<=1&&(Locations.NewSetting.filterApplied?(Locations.NewSetting.needRefreshLocationsList=!0,Locations.NewSetting.callBack()):(FrameworkCommon.show(pageId.find("#emptyDataCard")),pageId.find("#addButton").hide(),pageId.find("table").hide())),pageId.find("#totalCount").html(count-1),ZPeople.Message.success(ZPI18N.getString("zp.locationDelSuccMsg"))}},filterOut:function(){Locations.NewSetting.locationsPageId.attr("class","zpl_act zpl_tblfxd zpl_orgloc")},filterOpen:function(){Locations.NewSetting.locationsPageId.attr("class","zpl_act zpl_tblfxd zpl_orgloc zpl_fltr_flt")},applyFilter:function(){if(Locations.NewSetting.filterChanged){var pageId=Locations.NewSetting.locationsPageId;FrameworkCommon.hide(pageId.find("[elem=tableContainer]")),pageId.append(ZPeople.LOADING_HTML),FrameworkCommon.hide(pageId.find("#emptyDataCard")),Locations.NewSetting.filterApplied=!0,pageId.find("[elem=applyFilter],[elem=resetFilter]").addClass("disabled");var breadCrumb=pageId.find("#location-filterBreadcrumb");FrameworkCommon.show(breadCrumb);var breadCrumbList=breadCrumb.find("#location-filterBreadcrumbList").empty();Locations.NewSetting.filterLocName=pageId.find("input#locationNameFilter").val(),Locations.NewSetting.filterCountryName=ZPeopleComponents.select(document.getElementById("countryFilter")).getValue(),"-1"==Locations.NewSetting.filterCountryName&&(Locations.NewSetting.filterCountryName=""),""==Locations.NewSetting.filterLocName&&""==Locations.NewSetting.filterCountryName&&FrameworkCommon.hide(pageId.find("#location-filterBreadcrumb")),""!=Locations.NewSetting.filterLocName&&breadCrumbList.append('<li id="location-locName-breadcrumbItem"><label>'+ZPI18N.getString("zp.locationname")+" :</label><span>"+ZSEC.Encoder.encodeForHTML(Locations.NewSetting.filterLocName)+'</span><a class="PI_cls" onclick="Locations.NewSetting.clearBreadCrumb(\'name\')"></a></li>'),""!=Locations.NewSetting.filterCountryName&&breadCrumbList.append('<li id="location-country-breadcrumbItem"><label>'+ZPI18N.getString("zp.country")+" :</label><span>"+ZSEC.Encoder.encodeForHTML(Locations.NewSetting.filterCountryName)+'</span><a class="PI_cls" onclick="Locations.NewSetting.clearBreadCrumb(\'country\')"></a></li>'),Locations.NewSetting.needRefreshLocationsList=!0,Locations.NewSetting.callBack(),Locations.NewSetting.filterChanged=!1,Locations.NewSetting.filterOut()}else ZPeople.Message.warning(ZPI18N.getString("zp.nochangesmade"))},clearBreadCrumb:function(type){var pageId=Locations.NewSetting.locationsPageId,breadCrumbList=pageId.find("#location-filterBreadcrumbList");"name"==type?(Locations.NewSetting.filterLocName="",pageId.find("input#locationNameFilter").val(""),breadCrumbList.find("#location-locName-breadcrumbItem").remove()):"country"==type&&(Locations.NewSetting.filterCountryName="",breadCrumbList.find("#location-country-breadcrumbItem").remove(),ZPeopleComponents.select(document.getElementById("countryFilter")).deselectAllOptions()),0==breadCrumbList.children().length&&(FrameworkCommon.hide(pageId.find("#location-filterBreadcrumb")),Locations.NewSetting.filterApplied=!1),Locations.NewSetting.needRefreshLocationsList=!0,Locations.NewSetting.callBack()},clearFilter:function(){var pageId=Locations.NewSetting.locationsPageId;FrameworkCommon.hide(pageId.find("[elem=tableContainer]")),pageId.append(ZPeople.LOADING_HTML),FrameworkCommon.hide(pageId.find("#emptyDataCard")),FrameworkCommon.hide(pageId.find("#emptPage")),pageId.find("[elem=applyFilter],[elem=resetFilter]").addClass("disabled");var breadCrumb=pageId.find("#location-filterBreadcrumb");FrameworkCommon.hide(breadCrumb),breadCrumb.find("#location-filterBreadcrumbList").empty(),pageId.find("input#locationNameFilter").val(""),ZPeopleComponents.select(document.getElementById("countryFilter")).deselectAllOptions(),ZPeopleComponents.select(pageId.find("#countryFilter")).setValue("-1"),Locations.NewSetting.filterLocName="",Locations.NewSetting.filterCountryName="",Locations.NewSetting.filterApplied=!1},resetFilter:function(){Locations.NewSetting.filterApplied?(Locations.NewSetting.clearFilter(),Locations.NewSetting.needRefreshLocationsList=!0,Locations.NewSetting.callBack(),Locations.NewSetting.filterChanged=!1,Locations.NewSetting.filterOut()):ZPeople.Message.warning(ZPI18N.getString("zp.nochangesmade"))},locationCountUsers:function(event){var trElem=event.target.closest("tr");Locations.NewSetting.LocationEmpList.showList(trElem.id,trElem.getAttribute("locationname"),event.target.textContent)},LocationEmpList:{isInit:!1,url:"users/getUsersListing",listData:{},searchData:{},showList:function(locationId,locationName,membersCount){Locations.NewSetting.LocationEmpList.isInit=!0;var empListSlider=new sliderModal(ZSEC.Encoder.encodeForHTML(locationName),new Tab("EmpLocListPopup",function(){if(0==empListSlider.sliderDiv.find("#cardEmpLocListPopup").children().length){let empLocListHTML='<div class="zpl_mmnu"><div id="empLocListTable" class="zpl_mmnurgt"><div class="zpl_act">';empLocListHTML+='<div class="zpl_crd">',empLocListHTML+='<div class="zpl_crdhdr zpl_crdhdrcnt">',empLocListHTML+='<div><div class="zpl_idiv">',empLocListHTML+='<div class="zpl_search zpl_srchsml w300" elem="searchContainer"><input elem="empLocListSearch" placeholder="'+ZPI18N.getString("zp.searchdata")+'" class="ztextbox wd100_per"><i class="PI_lens"></i></div>',empLocListHTML+="</div></div>",empLocListHTML+='<div class="zpl_posnon"><div class="zpl_idiv"><span>'+ZPI18N.getString("zp.lite.totempcount")+' : </span><b elem="empLocListCount">'+membersCount+"</b></div></div></div>",empLocListHTML+='<div class="zpl_crdcnt"><div class="zpl_tblres" elem="empLocListTableCont">',empLocListHTML+=Locations.NewSetting.LocationEmpList.getTableHTML(),empLocListHTML+=ZPeople.LOADING_HTML,empLocListHTML+="</div></div>",empLocListHTML+="</div></div></div>",empListSlider.sliderDiv.find("#cardEmpLocListPopup").append(empLocListHTML),empListSlider.sliderDiv.find("#sliFootDiv").remove();let params={searchByRole:0,searchByLoc:locationId,searchByDept:0,searchByEmpStatus:"All Status",searchByOnbStatus:-1,userType:1,userStatus:3,sortByType:"2_0",isAjax:!0,needTotalCount:!0};ZPeople.Request.send(Locations.NewSetting.LocationEmpList.url,params,Locations.NewSetting.LocationEmpList.construct,empListSlider)}},()=>{}));empListSlider.construct(),empListSlider.setCloseCallback(function(){void 0==ZPComponents.Search.Configuration.JSON||_.isNull(ZPComponents.Search.Configuration.JSON)||ZPComponents.Search.reset(ZPComponents.Search.Configuration.JSON,!0),empListSlider.remove(),delete empListSlider})},getTableHTML:function(){var empLocListHTML="";return empLocListHTML+='<table class="zpl_nocrsor zpl_tbl">',empLocListHTML+='<thead><tr><th width="350">'+ZPI18N.getString("zp.user")+'</th><th width="350">'+ZPI18N.getString("zp.email")+'</th></tr></thead><tbody elem="tableBody" type="all"></tbody>',empLocListHTML+="</table>"},construct:function(data,params,empListSlider){if(data.usersDtls){if(Locations.NewSetting.LocationEmpList.isInit){Locations.NewSetting.LocationEmpList.firescrollObj=new FireScrollBack($.proxy(Locations.NewSetting.LocationEmpList.firescroll,null,empListSlider,params.searchByLoc),empListSlider.sliderDiv.find("#empLocListTable"),"EmpLocListScroll");var timer=0;empListSlider.sliderDiv.find("[elem=empLocListSearch]").on("keyup",$.proxy(function(empListSlider,firescrollObj){clearTimeout(timer),timer=setTimeout(Locations.NewSetting.LocationEmpList.search,200,empListSlider,firescrollObj,params.searchByLoc)},null,empListSlider,Locations.NewSetting.LocationEmpList.firescrollObj)),Locations.NewSetting.LocationEmpList.constructList(data,params,{empListSlider:empListSlider,firescrollObj:Locations.NewSetting.LocationEmpList.firescrollObj}),Locations.NewSetting.LocationEmpList.firescrollObj.reset(),Locations.NewSetting.LocationEmpList.isInit=!1}}else ZPeople.Message.failure(ZPI18N.getString("zp.sorryservererror")),empListSlider.close()},constructList:function(data,params,otherDetails){var locData,empListSlider=otherDetails.empListSlider,firescrollObj=otherDetails.firescrollObj,isFirescroll=params.hasOwnProperty("startInd");$("#cardEmpLocListPopup").find("[elem=empLocListCount]").text(data.totalCount),params.searchval?(isFirescroll?Locations.NewSetting.LocationEmpList.searchData[params.searchval].usersDtls=Locations.NewSetting.LocationEmpList.searchData[params.searchval].usersDtls.concat(data.usersDtls):(empListSlider.sliderDiv.find("#cardEmpLocListPopup [elem=tableBody][type=all]").length>0&&empListSlider.sliderDiv.find("#cardEmpLocListPopup [elem=tableBody][type=all]").html(""),$("#empLocListTable").scrollTop(0),Locations.NewSetting.LocationEmpList.searchData[params.searchval]=data),locData=Locations.NewSetting.LocationEmpList.searchData[params.searchval]):(isFirescroll?Locations.NewSetting.LocationEmpList.listData.usersDtls=Locations.NewSetting.LocationEmpList.listData.usersDtls.concat(data.usersDtls):(empListSlider.sliderDiv.find("#cardEmpLocListPopup [elem=tableBody][type=all]").length>0&&empListSlider.sliderDiv.find("#cardEmpLocListPopup [elem=tableBody][type=all]").html(""),Locations.NewSetting.LocationEmpList.listData=data),locData=Locations.NewSetting.LocationEmpList.listData);var empLocList=isFirescroll?data.usersDtls:locData.usersDtls;if(locData.firescroll=empLocList.length>0&&empLocList.length%25==0,void 0==empLocList||0==empLocList.length&&!isFirescroll)return empListSlider.sliderDiv.find("#cardEmpLocListPopup [elem=empLocListTableCont]").html(""),void new EmptyPages("zp_nd_nodata",ZPI18N.getString("zp.nodatafound"),"",empListSlider.sliderDiv.find("#cardEmpLocListPopup [elem=empLocListTableCont]")).show();{empListSlider.sliderDiv.find("#cardEmpLocListPopup [elem=empLocListTableCont] .zp_nd_nodata").length>0&&empListSlider.sliderDiv.find("#cardEmpLocListPopup [elem=empLocListTableCont]").html(Locations.NewSetting.LocationEmpList.getTableHTML());let empLocListTblHTML="";for(i of empLocList)empLocListTblHTML+="<tr>",empLocListTblHTML+='<td width="350"><div class="zpl_em" erecno="'+i.ERECNO+'">',empLocListTblHTML+='<div class="zpl_emimg"><img src="'+i.EMPLOYEEPHOTO+'"></div>',empLocListTblHTML+='<div class="zpl_emdts zpl_cp" id="LocEmpPro" onmouseover="orgSetupForms.mouseEnterFunction(`'+ZSEC.Encoder.encodeForHTMLAttribute(i.EMPLOYEEID)+" - "+ZSEC.Encoder.encodeForHTMLAttribute(i.EMPLOYEENAME)+'`)">',empLocListTblHTML+="<div><em>"+ZSEC.Encoder.encodeForHTML(i.EMPLOYEEID)+" - </em><b>"+ZSEC.Encoder.encodeForHTML(i.EMPLOYEENAME)+"</b></div>",empLocListTblHTML+="</div>",empLocListTblHTML+="</div></td>",empLocListTblHTML+='<td width="350"><span class="txttrim zpl_w300" onmouseover="orgSetupForms.mouseEnterFunction(`'+(i.EMPLOYEEMAILALIAS?ZSEC.Encoder.encodeForHTML(i.EMPLOYEEMAILALIAS):"")+'`)">'+(i.EMPLOYEEMAILALIAS?ZSEC.Encoder.encodeForHTML(i.EMPLOYEEMAILALIAS):"")+"</span></td>",empLocListTblHTML+="</tr>";params.startInd?empListSlider.sliderDiv.find("#cardEmpLocListPopup [elem=tableBody][type=all]").append(empLocListTblHTML):empListSlider.sliderDiv.find("#cardEmpLocListPopup [elem=tableBody][type=all]").html(empLocListTblHTML),empListSlider.sliderDiv.find("#cardEmpLocListPopup [id=LocEmpPro]").off().on("click",function(){ZPeople.getUserPage($(this).parent().attr("erecno")),empListSlider.close()})}firescrollObj.reset(),empListSlider.sliderDiv.find("[elem=empLocListTableCont]").find("#zp_page_loading").remove()},search:function(empListSlider,firescrollObj,locationId){0==empListSlider.sliderDiv.find("[elem=empLocListTableCont]").find("#zp_page_loading").length&&empListSlider.sliderDiv.find("[elem=empLocListTableCont]").append(ZPeople.LOADING_HTML),empListSlider.sliderDiv.find("[elem=empLocListTableCont]").find("[elem=emptPageCont]").hide();var key=empListSlider.sliderDiv.find("[elem=empLocListSearch]").val();if(void 0==key||0==key.trim().length)Locations.NewSetting.LocationEmpList.constructList(Locations.NewSetting.LocationEmpList.listData,{},{empListSlider:empListSlider,firescrollObj:firescrollObj});else if(Locations.NewSetting.LocationEmpList.searchData[key])Locations.NewSetting.LocationEmpList.constructList(Locations.NewSetting.LocationEmpList.searchData[key],{searchval:key},{empListSlider:empListSlider,firescrollObj:firescrollObj});else{let params={searchByRole:0,searchByLoc:locationId,searchByDept:0,searchByEmpStatus:"All Status",searchByOnbStatus:-1,searchval:encodeURIComponent(key),userType:1,userStatus:3,sortByType:"2_0",isAjax:!0,needTotalCount:!0};ZPeople.Request.send(Locations.NewSetting.LocationEmpList.url,params,Locations.NewSetting.LocationEmpList.constructList,{empListSlider:empListSlider,firescrollObj:firescrollObj})}},firescroll:function(empListSlider,locationId){var key=empListSlider.sliderDiv.find("[elem=empLocListSearch]").val(),firescrollObj=Locations.NewSetting.LocationEmpList.firescrollObj,isSearch=void 0!=key&&0!=key.trim().length;0==empListSlider.sliderDiv.find("[elem=empLocListTableCont]").find("#zp_page_loading").length&&empListSlider.sliderDiv.find("[elem=empLocListTableCont]").append(ZPeople.LOADING_HTML);var locData=isSearch?Locations.NewSetting.LocationEmpList.searchData[key]:Locations.NewSetting.LocationEmpList.listData;if(locData.firescroll){let params={searchByRole:0,searchByLoc:locationId,searchByDept:0,searchByEmpStatus:"All Status",searchByOnbStatus:-1,userType:1,userStatus:3,startInd:locData.usersDtls.length+1,sortByType:"2_0",isAjax:!0,needTotalCount:!0};isSearch&&(params.searchval=key),ZPeople.Request.send(Locations.NewSetting.LocationEmpList.url,params,Locations.NewSetting.LocationEmpList.constructList,{empListSlider:empListSlider,firescrollObj:firescrollObj})}else empListSlider.sliderDiv.find("[elem=empLocListTableCont]").find("#zp_page_loading").remove()}}};var Domains={};Domains.NewSetting={popup:'<div class="zpl_mdl zpl_mmd zpl_mcenter" id="modelPopup"><div class="zpl_minr" id="popup"><div class="zpl_mhder"><div><h4> </h4></div><a class="_cls PI_cls" onclick="Domains.NewSetting.closePopup()"> </a></div><div class="zpl_mcnt"><form><div class="zpl_crd"><div class="zpl_crdcnt" id="popupContent"><div class="zpl_secn" id="contentDescription"><div><h5> </h5></div></div><div class="zpl_secn"><div><div class="zpl_idiv"> <p> '+ZPI18N.getString("zp.lms.one")+". "+ZPI18N.getString("zp.signinnote")+'</p></div><div class="zpl_idiv" id="secondPopupPoint"> <p> '+ZPI18N.getString("zp.lms.two")+". "+ZPI18N.getString("zp.addtxtrec")+'</p></div></div></div><div class="zpl_secn"><div class="zpl_tblres"><table class="zpl_tbl"><tbody></tbody></table></div><div class="zpl_idiv" id="noDetail" style="display:none;"> </div></div><div class="zpl_secn"><div><div class="zpl_idiv" id="thirdPopupPoint"> </div></div></div><div class="zpl_secn"><div id="finalPopupPoint"><p> <a target="_blank" id="clickHere"> '+ZPI18N.getString("zp.clickhere")+"</a> "+ZPI18N.getString("zp.tofollownotetxt")+'</p></div></div><div class="zpl_secn" id="thisDataTxt" style="display:none;"> </div><div class="zpl_secn" id="thisDataCname" style="display:none;"> </div><div class="zpl_secn" id="thisCNameDestination" style="display:none;"> </div><div id="copyRow" style="opacity:0;"> </div></div></div></form></div><div class="zpl_mfoter" id="popupFooter"><button id="popupVerify" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.verify")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="Domains.NewSetting.closePopup()">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div>",dnsProviderDropdown:'<div style="width:250px" class="zpl_secn zpl_mailtmp" id="DnsCategories"><div style="width:150px"><label>'+ZPI18N.getString("zp.dnsprovider")+'</label></div><div class="getDns" id="getDNS"><select id="dnsProvider"></select></div></div>',note:'<div id="note" class="zpl_mailtmp zpl_info wd100_per"><h6>'+ZPI18N.getString("zp.notePA")+"</h6><p><em>"+ZPI18N.getString("zp.dnsnote")+"</em></p></div>",domainPattern:'<div class="zpl_secn" id="categories"><div><div class="zradiobutton zradiobutton--horizontal"><input id="txt" type="radio" name="domainPattern" class="zradiobutton__helper"><label for="txt" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.txt")+'</span></label></div><div class="zradiobutton zradiobutton--horizontal"><input id="cname" type="radio" name="domainPattern" class="zradiobutton__helper" ><label for="cname" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.cname")+"</span></label></div></div></div>",domainsAndRebrandPageId:null,addModel:'<div class="zpl_mdl zpl_mcenter" closemodelview="true" id="addPopUp"><div class="zpl_minr"><div class="zpl_mhder" id="modelHeader"><div><h4>  </h4></div><a class="_cls PI_cls"> </a></div><div class="zpl_mcnt" id="modelContent"></div><div class="zpl_mfoter" id="modelFooter"><button type="button" class="zlabel zlabel--blue zlabel--medium" id="addDomainSubmit" value="submit"> '+ZPI18N.getString("zp.save")+' </button><button type="button" class="zlabel zlabel--outline zlabel--medium" value="cancel"> '+ZPI18N.getString("zp.cancel")+" </button></div></div></div>",form:'<form><div class="zpl_crd"><div class="zpl_crdcnt" id="cardContent"></div></div></form>',noData:'<div class="zpl_crd zpl_nodata" id="noDataCard"> <div class="zpl_crdcnt"> <div class="zpl_Emptydata"> <div> <div id="emptyImage" class="zpl_emptimg"> </div><h4> </h4><p> </p> </div> </div> </div> </div>',initialCallBack:function(){var pageId=Domains.NewSetting.domainsAndRebrandPageId=settingsPage.container;pageId.append(Locations.NewSetting.menu),pageId.find("#topSettMenu").append(Locations.NewSetting.options);var addButton=pageId.find("#addButton");addButton.text(ZPI18N.getString("zp.adddomain")),addButton.attr("onclick","Domains.NewSetting.openAddModel()"),pageId.append(Locations.NewSetting.table),pageId.find("table").attr("id","domainsTable");var tableHeading='<tr><th width="45%"> '+ZPI18N.getString("zp.dmnName")+' </th><th width="45%"> '+ZPI18N.getString("zp.verificationstatus")+' </th><th width="10%">'+ZPI18N.getString("zp.actions")+" </th></tr>";pageId.find("#domainsTable thead").append(tableHeading),pageId.find("#domainsTable").after(Locations.NewSetting.emptyData),pageId.find("#emptyDataCard #emptyImage").addClass("zp_nd_domain"),pageId.find("#emptyDataCard h4").text(ZPI18N.getString("zp.domainnodata")),pageId.find("#emptyDataCard p").text(ZPI18N.getString("zp.domainnodatamsg")),pageId.find("#emptyDataCard button").on("click",Domains.NewSetting.openAddModel),pageId.find("#emptyDataCard button").text(ZPI18N.getString("zp.adddomain")),pageId.append(Domains.NewSetting.addModel),pageId.find("#emptyDataCard").after(Domains.NewSetting.noData),pageId.find("#noDataCard #emptyImage").addClass("zp_nd_domain"),pageId.find("#noDataCard p").text(ZPI18N.getString("zp.noAccessToManageDomains",[ZPeople.peopleSupportEmail])),pageId.find("#modelHeader h4").text(ZPI18N.getString("zp.settings.addDomainName")),pageId.find("#modelHeader a").attr("onclick","Domains.NewSetting.closeAddModel(Domains.NewSetting.domainsAndRebrandPageId)"),pageId.find("#modelContent").append(Domains.NewSetting.form),pageId.find('#modelFooter button[value="cancel"]').attr("onclick","Domains.NewSetting.closeAddModel(Domains.NewSetting.domainsAndRebrandPageId)"),pageId.find('#modelFooter button[value="submit"]').attr("onclick","Domains.NewSetting.saveDomain()");var cardElement='<div class="zpl_secn"><div><label class="zpl_mtry"> '+ZPI18N.getString("zp.dmnName")+' </label></div><div><input type="text" class="ztextbox" id="domainName" placeholder="'+ZPI18N.getString("zp.domainname")+'"><div id="domainErrorMsg" class="dverrormsg ztextbox--error__label" style="display:none;"> </div> </div><div><label class="gry"> '+ZPI18N.getString("zp.domainexample")+" </label> </div></div>";pageId.find("#cardContent").append(cardElement),pageId.append(Domains.NewSetting.popup),Rebranding.NewSetting.initialCall()},openAddModel:function(){var pageId=Domains.NewSetting.domainsAndRebrandPageId;pageId.find("#domainName").val("");var domainError=pageId.find("#cardContent #domainErrorMsg");domainError.text(""),domainError.hide(),pageId.find("#addPopUp").addClass("zpl_mopen"),pageId.find("#domainName").focus()},closeAddModel:function(pageId){pageId.find("#addPopUp").removeClass("zpl_mopen")},callBack:function(){ZPeople.Request.send("/getOrgDomains.zp",{method:"getOrgDomainsList"},Domains.NewSetting.setDomains,null,null)},setDomains:function(resultData,params){var pageId=Domains.NewSetting.domainsAndRebrandPageId;if(pageId.find("#rgttable").show(),pageId.find("#topSettMenu").show(),pageId.find("#zp_page_loading").remove(),pageId.find("#domainsTable tbody").empty(),resultData.orgDtls&&resultData.orgDtls.length>0){var dkimDetails=resultData.dkimDetails;$.each(resultData.orgDtls,function(index,data){var domain=JSON.parse(data.domainDetails),dkimStatus=void 0!=dkimDetails[domain.ORG_DOMAIN]&&dkimDetails[domain.ORG_DOMAIN],row=(dkimStatus?ZPI18N.getString("zp.authenticated"):ZPI18N.getString("zp.get"),"<tr><td><span>"+domain.ORG_DOMAIN+"</span></td><td><span>"+("0"==domain.IS_VERIFIED?"<a onClick=\"Domains.NewSetting.openPopup(this,'domain')\"> "+ZPI18N.getString("zp.verify")+" </a>":ZPI18N.getString("zp.domainverified"))+"</span></td>");"0"==domain.IS_VERIFIED&&(row+='<td style="display:none" id="dataCname">'+data.cname+'</td><td style="display:none" id="cNameDestination">'+data.cnamedest+'</td><td style="display:none" id="dataTxt">'+data.txt+"</td>"),row+='<td><div class="zpl_hvr"><i class="PI_delete" onclick="Domains.NewSetting.deleteDomainAlert(this)" title="'+ZPI18N.getString("zp.delete")+'"> </i></div></td></tr>',pageId.find("#domainsTable tbody").append(row)}),pageId.find("#domainsTable").show(),pageId.find("#emptyDataCard").hide(),pageId.find("#noDataCard").hide(),pageId.find("#topSettMenu").show(),pageId.find("#rebrandCard").show(),Rebranding.NewSetting.callBack()}else pageId.find("#domainsTable").hide(),pageId.find("#topSettMenu").hide(),pageId.find("#rebrandCard").hide(),resultData.hasOwnProperty("notAllowed")?(pageId.find("#emptyDataCard").hide(),pageId.find("#noDataCard").show()):(pageId.find("#emptyDataCard").show(),pageId.find("#noDataCard").hide())},deleteDomainAlert:function(thisObj){var alertDelete=new DeleteAlertMessage(ZPI18N.getString("zp.delDomainTitle"),ZPI18N.getString("zp.delDomainMsg"));alertDelete.setCallback(function(){Domains.NewSetting.deleteDomain(thisObj)}),alertDelete.show()},deleteDomain:function(thisObj){var params={method:"deleteDomainNewUI",domainName:$(thisObj).closest("tr").find("td:first").text()};ZPeople.Request.send("/deleteDomain.zp",params,Domains.NewSetting.callBackForDeleteDomain,thisObj,null)},callBackForDeleteDomain:function(resultData,params,thisObj){var pageId=Domains.NewSetting.domainsAndRebrandPageId;resultData.hasOwnProperty("success")&&resultData.success?(ZPeople.Message.success(ZPI18N.getString("zp.domainDelSucc")),$(thisObj).closest("tr").remove(),$(pageId).find("#domainsTable tr").length<=1&&(pageId.find("#emptyDataCard").show(),pageId.find("#noDataCard").hide(),pageId.find("#topSettMenu").hide(),pageId.find("#domainsTable").hide(),pageId.find("#rebrandCard").hide())):resultData.hasOwnProperty("failed")&&ZPeople.Message.failure(resultData.failed)},saveDomain:function(){var pageId=Domains.NewSetting.domainsAndRebrandPageId;let submitBtn=pageId.find("#addDomainSubmit").addClass("disabled");var domainError=pageId.find("#cardContent #domainErrorMsg");domainError.text(""),domainError.hide();var name=pageId.find("#domainName").val().trim();if(void 0==name||0==name.length)domainError.text(ZPI18N.getString("zp.domainNameEmpty")),domainError.show(),pageId.find("#domainName").addClass("ztextbox__error"),submitBtn.removeClass("disabled");else if(isValidDomainName(name)){pageId.find("#domainName").removeClass("ztextbox__error"),"www"===name.split(".")[0]&&"."===name.charAt(3)&&(name=name.substring(4,name.length).trim());var params={method:"addDomainNewUI",domainName:name};ZPeople.Request.send("/addNewDomain.zp",params,Domains.NewSetting.callBackForSaveDomain,submitBtn,null)}else domainError.text(ZPI18N.getString("zp.entervaliddomain")),domainError.show(),pageId.find("#domainName").addClass("ztextbox__error"),submitBtn.removeClass("disabled")},callBackForSaveDomain:function(resultData,params,submitBtn){submitBtn.removeClass("disabled"),Domains.NewSetting.closeAddModel(Domains.NewSetting.domainsAndRebrandPageId),resultData.hasOwnProperty("success")?(ZPeople.Message.success(resultData.success),Domains.NewSetting.callBack()):resultData.hasOwnProperty("warning")?ZPeople.Message.warning(resultData.warning):resultData.hasOwnProperty("failed")&&ZPeople.Message.failure(resultData.failed)},closePopup:function(){Domains.NewSetting.domainsAndRebrandPageId.find("#modelPopup").removeClass("zpl_mopen")},openPopup:function(thisObj,mode){var name=$(thisObj).closest("tr").find("td:first").text();if("domain"==mode)Domains.NewSetting.handleResponseForOpenPopup(null,{method:"domain"},thisObj);else{var params={method:"dkimdetails",domainName:name};ZPeople.Request.send("/dkimdetails.zp",params,Domains.NewSetting.handleResponseForOpenPopup,thisObj,null)}},dnsChange:function(obj,hostName){var popupContent=Domains.NewSetting.domainsAndRebrandPageId.find("#popup").find("#popupContent"),hostKeyCell=popupContent.find("#hostKey"),updatedHostKey=hostKeyCell.text().trim().replace(`.${hostName}`,"");"GoDaddy"===obj.detail.value?(hostKeyCell.html(updatedHostKey),popupContent.find("#newHostKey").val(updatedHostKey)):(hostKeyCell.html(updatedHostKey+"."+hostName),popupContent.find("#newHostKey").val(updatedHostKey+"."+hostName))},handleResponseForOpenPopup:function(resultData,params,thisObj){var pageId=Domains.NewSetting.domainsAndRebrandPageId,popup=pageId.find("#popup");popup.find("tbody").html(""),popup.find("#noDetail").hide(),popup.find("#popupFooter").hide();var popupContent=popup.find("#popupContent");popupContent.find("#categories").remove(),popupContent.find("#note").remove(),popupContent.find("#DnsCategories").remove(),popupContent.find("#thisDataTxt").text(""),popupContent.find("#thisDataCname").text(""),popupContent.find("#thisCNameDestination").text(""),popupContent.find("#copyRow").html("");var header,description,mode,thisRow=$(thisObj).closest("tr"),name=thisRow.find("td:first").text();if("domain"==(mode=params.method))header=ZPI18N.getString("zp.verifydomain",[name]),description=ZPI18N.getString("zp.followinst",[name]),popup.find("#popupFooter").show(),popup.find("#popupVerify").off().on("click",function(){Domains.NewSetting.verifyDomain(name)}),popupContent.find("#contentDescription").after(Domains.NewSetting.domainPattern),document.getElementById("txt").addEventListener("change",Domains.NewSetting.changeDomainPattern),document.getElementById("cname").onchange=Domains.NewSetting.changeDomainPattern,document.getElementById("txt").setAttribute("checked",!0),mode="verify",popupContent.find("#thisDataTxt").text(thisRow.find("td#dataTxt").text()),popupContent.find("#thisDataCname").text(thisRow.find("td#dataCname").text()),popupContent.find("#thisCNameDestination").text(thisRow.find("td#cNameDestination").text());else{header=ZPI18N.getString("zp.dkimdetails")+" - "+name,description=ZPI18N.getString("zp.authenticatedomain",[name]),popupContent.find("#secondPopupPoint").after(Domains.NewSetting.dnsProviderDropdown),popupContent.find("#thirdPopupPoint").before(Domains.NewSetting.note);let listProp={options:[ZPI18N.getString("zp.others"),ZPI18N.getString("zp.godaddy")],dataMapping:{label:"value",value:"value"},change:function(obj){Domains.NewSetting.dnsChange(obj,name)}};if(ZPA_Common.ZCompProp.loadSelectListProp(listProp),ZPeopleComponents.select("#getDNS",listProp),resultData.TRANSMAIL_HOSTKEY){var keyRow='<tr><th width="20%">'+ZPI18N.getString("zp.hostkey")+'</th><td id="hostKey" width="70%">'+resultData.TRANSMAIL_HOSTKEY+' </td><td width="10%"> <i class="PI_cpy" onClick=copyTextToClipBoard("key") title="'+ZPI18N.getString("zp.copy")+'"> </i> </td></tr>',valueRow='<tr><th width="20%">'+ZPI18N.getString("zp.hostvalue")+'</th><td width="70%"> <div class="dom_hostval">'+resultData.TRANSMAIL_HOSTVALUE+' </div> </td><td width="10%"> <i class="PI_cpy" onClick=copyTextToClipBoard("value") title="'+ZPI18N.getString("zp.copy")+'"> </i> </td></tr>',validationRow='<tr><th width="20%"> '+ZPI18N.getString("zp.validation")+'</th><td width="70%">'+(resultData.TRANSMAIL_DKIM_VERIFICATION?ZPI18N.getString("zp.authenticated"):ZPI18N.getString("zp.notauthenticated"))+' </td><td width="10%"> </td></tr>';popup.find("tbody").append(keyRow+valueRow+validationRow);var copyRow='<input id="newHostKey" type="text" value="'+resultData.TRANSMAIL_HOSTKEY+'"><input id="newHostValue" type="text" value="'+resultData.TRANSMAIL_HOSTVALUE+'">';popupContent.find("#copyRow").append(copyRow)}else popup.find("#noDetail").text(ZPI18N.getString("zp.dkimdetailsnotfound")),popup.find("#noDetail").show();mode="get"}popup.find("h4").text(header),popup.find("#contentDescription h5").text(description),Domains.NewSetting.changeDomainPattern(null,null,mode),pageId.find("#modelPopup").addClass("zpl_mopen")},changeDomainPattern:function(event,data,mode){var patternId,clickHere,secondPopupPoint,thirdPopupPoint,finalPopupPoint,popup=Domains.NewSetting.domainsAndRebrandPageId.find("#popup"),popupContent=popup.find("#popupContent");if(popupContent.find("#thirdPopupPoint").html(""),popupContent.find("#finalPopupPoint").html(""),mode&&"get"==mode?(patternId="txt",thirdPopupPoint="<p>"+ZPI18N.getString("zp.dkimwaittxt")+"</p>",clickHere=ZPeople.ZOHOURL+"/people/help/adminguide/overview-orgsettings.html#Email%20Auth"):(patternId=popup.find('input[name="domainPattern"]:checked').attr("id"),clickHere=ZPeople.ZOHOURL+"/people/help/adminguide/overview-orgsettings.html#domains",popup.find("tbody").html("")),"txt"==patternId){if(secondPopupPoint=ZPI18N.getString("zp.lms.two")+". "+ZPI18N.getString("zp.addtxtrec"),finalPopupPoint=ZPI18N.getString("zp.tofollownotetxt"),!mode||"get"!=mode){thirdPopupPoint="<p>"+ZPI18N.getString("zp.lms.three")+". "+ZPI18N.getString("zp.plswaittxt")+"</p>";var nameRow='<tr><th width="30%"> '+ZPI18N.getString("zp.hostoraliastxt")+'</th><td width="70%"> '+ZPI18N.getString("zp.blankorat")+"</td></tr>",valueRow='<tr><th width="30%"> '+ZPI18N.getString("zp.pointo")+'</th><td width="70%">'+popupContent.find("#thisDataTxt").text()+" </td></tr>";popup.find("tbody").append(nameRow+valueRow)}}else{secondPopupPoint=ZPI18N.getString("zp.lms.two")+". "+ZPI18N.getString("zp.addcnamerec"),thirdPopupPoint="<p>"+ZPI18N.getString("zp.lms.three")+". "+ZPI18N.getString("zp.plswaitcname")+"</p>",finalPopupPoint=ZPI18N.getString("zp.tofollownotecname");nameRow='<tr><th width="30%"> '+ZPI18N.getString("zp.hostoraliascname")+'</th><td width="70%"> '+popupContent.find("#thisDataCname").text()+"</td></tr>",valueRow='<tr><th width="30%"> '+ZPI18N.getString("zp.pointo")+'</th><td width="70%">'+popupContent.find("#thisCNameDestination").text()+" </td></tr>";popup.find("tbody").append(nameRow+valueRow)}popupContent.find("#secondPopupPoint p").text(secondPopupPoint),popupContent.find("#thirdPopupPoint").append(thirdPopupPoint),popupContent.find("#finalPopupPoint").append('<p> <a target="_blank" id="clickHere" href="'+clickHere+'"> '+ZPI18N.getString("zp.clickhere")+"</a> "+finalPopupPoint+"</p>")},verifyDomain:function(name){var popup=Domains.NewSetting.domainsAndRebrandPageId.find("#popup"),params=(popup.find("#popupContent"),{method:"verifyDomain",mode:popup.find('input[name="domainPattern"]:checked').attr("id"),domainName:name});ZPeople.Request.send("/verifyDomain.zp",params,Domains.NewSetting.callBackForVerifyDomain,null,null)},callBackForVerifyDomain:function(resultData,params){var pattern=Domains.NewSetting.domainsAndRebrandPageId.find('#popup input[name="domainPattern"]:checked').next("label").text(),result=JSON.parse(resultData);if(result.status){if(200==result.status){var msg=ZPI18N.getString("zp.domainsuccessmessage");ZPeople.Message.success(msg),Domains.NewSetting.callBack()}else if(404==result.status){msg=ZPI18N.getString("zp.domainVerificationFailure",[pattern]);ZPeople.Message.failure(msg)}}else{msg=ZPI18N.getString("zp.domainiserror");ZPeople.Message.failure(msg)}}};var Rebranding={};function isValidDomainName(val){return/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,22}$/.test(val)}function copyTextToClipBoard(mode){var successCopy;"key"===mode?$("input#newHostKey").trigger("select"):"value"===mode&&$("input#newHostValue").trigger("select");try{if(!1===(successCopy=document.execCommand("copy"))){var msg=ZPI18N.getString("zp.copyfailed");ZPeople.Message.failure(msg)}else{msg=ZPI18N.getString("zp.copysuccess");ZPeople.Message.success(msg)}}catch(exception){msg=ZPI18N.getString("zp.copyfailed");successCopy=!1,ZPeople.Message.failure(msg)}return successCopy}Rebranding.NewSetting={rebrandPath:null,initialCall:function(){var pageId=Domains.NewSetting.domainsAndRebrandPageId;0==pageId.find("#zp_page_loading").length&&pageId.append(ZPeople.LOADING_HTML),pageId.append(CompanySetup.NewSetting.card),pageId.find("#card").attr("id","rebrandCard"),pageId.find("#rebrandCard").hide(),pageId.find("#rebrandCard").append(CompanySetup.NewSetting.cardHeader),pageId.find("#card-header h4").text(ZPI18N.getString("zp.rebranding"));var cardHeadContent="<p>"+ZPI18N.getString("zp.rebrandcustom")+"</p>";pageId.find("#card-header div").append(cardHeadContent);var cardContent='<div class="zpl_crdcnt"><div class="zpl_secn"><div><div class="zpl_idiv" id="mappingUrl1"></div><div class="zpl_idiv"><em>'+ZPI18N.getString("zp.rebrandinfoline2")+'</em></div><div class="zpl_idiv zpl_lineheight">'+ZPI18N.getString("zp.addnlrebrandnote",[ZPeople.peopleSupportEmail])+'</div></div></div><div class="zpl_secn"><div><table class="zpl_itbl"><tbody><tr><td width="100">'+ZPI18N.getString("zp.rebrandloginurl")+'</td><td><input type="text" class="ztextbox w300" id="activeRebrand" onkeyup="Rebranding.NewSetting.putYourDomainName()"></td><td><select class="select-js" data-width="200" id="verifiedDomainsList"> </select></td><td><div class="zpl_hvr zpl_hvrsw"><i class="PI_edt tooltip-js" style="display:none" id="rebrandUpdate" onclick="Rebranding.NewSetting.modifyRebranding()" title="Edit"></i><i class="PI_delete tooltip-js" style="display:none" id="rebrandReset" onclick="Rebranding.NewSetting.deleteRebrand()" title="Delete"></i><i class="PI_tick grn tooltip-js" style="display:none" onclick="Rebranding.NewSetting.AddUpdateRebranidng()" id="rebrandSave" title="Confirm"></i><i class="PI_cls red tooltip-js" style="display:none" onclick="Rebranding.NewSetting.resetRebranding()" id="rebrandCancel"" title="Cancel"></i></div></td></tr></tbody></table></div></div><div class="zpl_secn" id="guideNotes" style="display:none;"><div><div class="zpl_info" style="max-width: max-content;"><ul><li>'+ZPI18N.getString("zp.porttabline1")+"</li><li>"+ZPI18N.getString("zp.porttabline2")+'</li></ul><table class="zpl_itbl"><tbody><tr><td>'+ZPI18N.getString("zp.porttabhost")+'</td><td id="yourDomain"> </td></tr><tr><td>'+ZPI18N.getString("zp.porttabpointsto")+'</td><td id="mappingUrl2"></td></tr></tbody></table></div></div></div></div>';pageId.find("#rebrandCard").append(cardContent),pageId.find("#guideNotes td#yourDomain").text("<"+ZPI18N.getString("zp.yoursubdomain")+">"),ZPeopleComponents.select(document.getElementById("verifiedDomainsList"),{disabled:!1,placeholder:ZPI18N.getString("zp.select")})},callBack:function(){ZPeople.Request.send("/org/getRebrandingDetails",{method:"getRebrandingDetails"},Rebranding.NewSetting.setRebrandData,null,null)},setRebrandData:function(resultData,params){var pageId=Domains.NewSetting.domainsAndRebrandPageId;if(Rebranding.NewSetting.rebrandPath=null,pageId.find("#activeRebrand").val(""),pageId.find("#activeRebrand").attr("disabled",!0),pageId.find("#activeRebrand").addClass("is-disabled"),pageId.find("#verifiedDomainsList").closest("td").hide(),pageId.find("#mappingUrl1").html(ZPI18N.getString("zp.rebrandinfoline1",[resultData.cnameMappedUrl])),pageId.find("#mappingUrl2").html(resultData.cnameMappedUrl),ZPeopleComponents.select(document.getElementById("verifiedDomainsList")).removeAllOptions(),pageId.find("#guideNotes").hide(),resultData.ERROR_PAYMENT){var msg=ZPI18N.getString("zp.embedupgrade",new Array(resultData.paymentUrl));ZPeople.Message.failure(msg)}else if(resultData.hasOwnProperty("domName")&&resultData.domName){var domainDetails=resultData.dnsDtls;if(Rebranding.NewSetting.rebrandPath=resultData.domName,pageId.find("#activeRebrand").val(Rebranding.NewSetting.rebrandPath),pageId.find("#rebrandSave").hide(),pageId.find("#rebrandCancel").hide(),pageId.find("#rebrandUpdate").show(),pageId.find("#rebrandReset").show(),domainDetails)if(domainDetails.hasOwnProperty("hasCName")&&!domainDetails.hasCName){msg=ZPI18N.getString("zp.rebrandnocname");ZPeople.Message.warning(msg)}else if(domainDetails.hasOwnProperty("unResolved")&&domainDetails.unResolved){msg=ZPI18N.getString("zp.rebrandnohost");ZPeople.Message.warning(msg)}}else ZPeople.Request.send("/org/getOrgDomains",{method:"getOrgDomains"},Rebranding.NewSetting.getRebrandDomains,null,null)},modifyRebranding:function(){var pageId=Domains.NewSetting.domainsAndRebrandPageId,spltDom="",spltInd="",subDm="",mainDm="",domName=Rebranding.NewSetting.rebrandPath;void 0!=domName&&null!=domName&&""!=domName&&(spltDom=domName.split("."),spltInd=domName.indexOf("."),subDm=spltDom[0],mainDm=domName.substring(spltInd+1,domName.length)),ZPeople.Request.send("/org/getOrgDomains",{method:"getOrgDomains"},function(resultData,params){Rebranding.NewSetting.getRebrandDomains(resultData,params),resultData.hasOwnProperty("orgDtls")&&resultData.orgDtls.length>0&&(pageId.find("#activeRebrand").val(subDm),pageId.find("#yourDomain").text(subDm),ZPeopleComponents.select(document.getElementById("verifiedDomainsList")).setAttribute("selectedValue",mainDm))},null,null)},getRebrandDomains:function(resultData,params){if(resultData.ERROR_PAYMENT){var msg=ZPI18N.getString("zp.embedupgrade",new Array(resultData.paymentUrl));ZPeople.Message.failure(msg)}else if(resultData.hasOwnProperty("notAllowed")){msg=resultData.notAllowed;ZPeople.Message.warning(msg)}else if(resultData.hasOwnProperty("orgDtls")&&resultData.orgDtls.length>0){var pageId=Domains.NewSetting.domainsAndRebrandPageId,result=resultData.orgDtls,domainsList=Array(),selectEle=document.getElementById("verifiedDomainsList");$.each(result,function(index,data){domainsList[index]={},domainsList[index].label=domainsList[index].value=data.ORG_DOMAIN,domainsList[index].id=index}),ZPeopleComponents.select(selectEle).addOption(domainsList),ZPeopleComponents.select(selectEle).setAttribute("showSearchField",domainsList.length>4),ZPeopleComponents.select(selectEle).setAttribute("change",function(event,data){data.fromUI&&(pageId.find("#rebrandSave").show(),pageId.find("#rebrandCancel").show())}),pageId.find("#activeRebrand").attr("disabled",!1),pageId.find("#activeRebrand").removeClass("is-disabled"),$("#activeRebrand").off("keyup").on("keyup",function(){pageId.find("#rebrandSave").show(),pageId.find("#rebrandCancel").show()}),pageId.find("#rebrandUpdate").hide(),pageId.find("#rebrandReset").hide(),pageId.find("#verifiedDomainsList").closest("td").show(),pageId.find("#guideNotes").show()}else if(resultData.hasOwnProperty("noReq")){msg=ZPI18N.getString("zp.rebrandnodomreqraised");ZPeople.Message.warning(msg)}else{msg=ZPI18N.getString("zp.noVerifiedDomain",[ZPeople.peopleSupportEmail]);ZPeople.Message.warning(msg)}},resetRebranding:function(){var pageId=Domains.NewSetting.domainsAndRebrandPageId;pageId.find("#activeRebrand").val(""),ZPeopleComponents.select(document.getElementById("verifiedDomainsList")).setAttribute("selectedValue",""),pageId.find("#yourDomain").text(""),pageId.find("#rebrandSave").hide(),pageId.find("#rebrandCancel").hide(),null!=Rebranding.NewSetting.rebrandPath&&void 0!=Rebranding.NewSetting.rebrandPath&&""!=Rebranding.NewSetting.rebrandPath&&(pageId.find("#activeRebrand").attr("disabled",!0),pageId.find("#activeRebrand").addClass("is-disabled"),pageId.find("#verifiedDomainsList").closest("td").hide(),ZPeopleComponents.select(document.getElementById("verifiedDomainsList")).removeAllOptions(),pageId.find("#activeRebrand").val(Rebranding.NewSetting.rebrandPath),pageId.find("#guideNotes").hide(),pageId.find("#rebrandUpdate").show(),pageId.find("#rebrandReset").show())},AddUpdateRebranidng:function(){var rebrandValue=Domains.NewSetting.domainsAndRebrandPageId.find("#activeRebrand").val().trim(),selectedDomain=ZPeopleComponents.select(document.getElementById("verifiedDomainsList")).getValue();if(rebrandValue&&selectedDomain&&"Select"!=selectedDomain){var domainPath=rebrandValue+"."+selectedDomain,mode=null!=Rebranding.NewSetting.rebrandPath&&void 0!=Rebranding.NewSetting.rebrandPath&&""!=Rebranding.NewSetting.rebrandPath?"UPDATE":"ADD";if(rebrandValue.startsWith("-")||rebrandValue.endsWith("-")||selectedDomain.startsWith("-")||selectedDomain.endsWith("-")||!/^[0-9a-zA-Z-]+$/.test(rebrandValue)||!/^[0-9a-zA-Z.-]+$/.test(domainPath)){var msg=ZPI18N.getString("zp.rebranddomalphanum");ZPeople.Message.failure(msg)}else{var params={method:"addorUpdateRebrandingDetails",mode:mode,domainPath:domainPath};ZPeople.Request.send("/org/addorUpdateRebrandingDetails",params,Rebranding.NewSetting.callBackForAddOrUpdateRebranding,null,null)}}else{msg=ZPI18N.getString("zp.rebranddomnotvalid");ZPeople.Message.failure(msg)}},deleteRebrand:function(){var domainPath=Domains.NewSetting.domainsAndRebrandPageId.find("#activeRebrand").val().trim();if(domainPath){var alertDelete=new DeleteAlertMessage(ZPI18N.getString("zp.rebranddelmapheading"),ZPI18N.getString("zp.rebranddelconfirm"));alertDelete.setCallback(function(){Rebranding.NewSetting.deleteMapping(domainPath)}),alertDelete.show()}else{var msg=ZPI18N.getString("zp.rebranddomnotvalid");ZPeople.Message.failure(msg)}},enableOrDisableRebranding:function(event,data){var pageId=Domains.NewSetting.domainsAndRebrandPageId;if(data.fromUI)if(ZPeopleComponents.toggleswitch(document.getElementById("rebrandingSwitch")).getState()){var rebrandValue=pageId.find("#activeRebrand").val().trim(),selectedDomain=ZPeopleComponents.select(document.getElementById("verifiedDomainsList")).getValue();if(rebrandValue&&selectedDomain&&"Select"!=selectedDomain){var domainPath=rebrandValue+"."+selectedDomain;if(/^[^-][0-9a-zA-Z-]+[^-]$/.test(rebrandValue)&&/^[^-][0-9a-zA-Z.-]+[^-]$/.test(domainPath)){var params={method:"addorUpdateRebrandingDetails",mode:"ADD",domainPath:domainPath};ZPeople.Request.send("/org/addorUpdateRebrandingDetails",params,Rebranding.NewSetting.callBackForAddOrUpdateRebranding,null,null)}else{var msg=ZPI18N.getString("zp.rebranddomalphanum");ZPeople.Message.failure(msg)}}else{msg=ZPI18N.getString("zp.rebranddomnotvalid");ZPeople.Message.failure(msg)}}else{if(domainPath=pageId.find("#activeRebrand").val().trim()){var alertDelete=new DeleteAlertMessage(ZPI18N.getString("zp.rebranddelmapheading"),ZPI18N.getString("zp.rebranddelconfirm"));alertDelete.setCallback(function(){Rebranding.NewSetting.deleteMapping(domainPath)}),alertDelete.setCloseCallback(function(){ZPeopleComponents.toggleswitch(document.getElementById("rebrandingSwitch")).switchOn()}),alertDelete.show()}else{msg=ZPI18N.getString("zp.rebranddomnotvalid");ZPeople.Message.failure(msg)}}},callBackForAddOrUpdateRebranding:function(resultData,params){if(resultData&&resultData.hasOwnProperty("msgDtl")){if(result=resultData.msgDtl,"Added"==result){var msg=ZPI18N.getString("zp.rebrandaddsuccess");ZPeople.Message.success(msg)}else if("Updated"==result){msg=ZPI18N.getString("zp.rebrandupdatesucc");ZPeople.Message.success(msg)}else if("domain error"==result){msg=ZPI18N.getString("zp.rebranderrdomname");ZPeople.Message.failure(msg)}else if("error occurred"==result){msg=ZPI18N.getString("zp.rebranderrinaction");ZPeople.Message.failure(msg)}else if("cnameerror"==result){msg=ZPI18N.getString("zp.rebrandnohost");ZPeople.Message.failure(msg)}else if("crossidcerror"==result){msg=ZPI18N.getString("zp.crossidcerror",[""]);ZPeople.Message.failure(msg)}else ZPeople.Message.failure(result);"Added"!=result&&"Updated"!=result||Rebranding.NewSetting.callBack()}},deleteMapping:function(domainPath){var params={method:"delRebrandingDetails",domainPath:domainPath};ZPeople.Request.send("/org/delRebrandingDetails",params,function(result){if(result){var msg=ZPI18N.getString("zp.rebranddelsucc");ZPeople.Message.success(msg),Rebranding.NewSetting.callBack()}else{msg=ZPI18N.getString("zp.rebranddelunable");ZPeople.Message.failure(msg)}})},putYourDomainName:function(){var pageId=Domains.NewSetting.domainsAndRebrandPageId,rebrandValue=pageId.find("#activeRebrand").val().trim();rebrandValue?pageId.find("#guideNotes td#yourDomain").text(rebrandValue):pageId.find("#guideNotes td#yourDomain").text("<"+ZPI18N.getString("zp.yoursubdomain")+">")}},FilesUsage={init:function(){var html='<div class="zpl_rgtcnt">';html+='<div class="zpl_crd"><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.fileusage")+'</h4></div></div><div class="zpl_crdcnt flx"><div id="fileUsageChart_subscription"></div><div class="zpl_gbox zpl_subscrion"><table class="zpl_itbl"><tbody><tr><td width="120"><div><em>'+ZPI18N.getString("zp.totalstorage")+'</em></div><b id="totalSpace"></b></td><td width="80"><div><em>'+ZPI18N.getString("zp.usedSpace")+'</em></div><b id="usedSpace"></b></td></tr><tr><td><div><em>'+ZPI18N.getString("zp.freespace")+'</em></div><b id="freeSpace"></b></td></tr></tbody></table></div></div></div></div>',settingsPage.container.append(html),FilesUsage.consXMLdata()},consXMLdata:function(){var fileUsage="",userStorageSpace="",params={conreqcsr:csrfToken};$.post("/zpzsign/getFileUsage",params,function(resultData){$.each(resultData[1],function(index,data){fileUsage=data.fileUsageSpace;var totalMbSpace="",totaldisplayName="",freespaceDisplayName="",usedspaceDisplayName="",usedSpaceCnt="";if(0==(userStorageSpace=data.userStorage)){var totalbytes=1073741824;totalMbSpace="250 MB ";var total=250;usedSpaceCnt=used=FilesUsage.truncateVal(fileUsage/1024/1024);var free=total-used;freespaceDisplayName=total===used||used>total?"0 MB ":total-used+" MB ",usedspaceDisplayName=used+" MB "}else{totaldisplayName=userStorageSpace+" GB ";totalbytes=1073741824;1!=userStorageSpace&&(totalbytes*=userStorageSpace),totalbytes,totaldisplayName=fileUsage<totalbytes?FilesUsage.truncateVal(fileUsage/1024/1024)+" MB ":FilesUsage.truncateVal(fileUsage/1073741824)+" GB ",totalMbSpace=userStorageSpace+" GB ";total="";var used="";free="";(fileUsage===totalbytes||fileUsage>totalbytes)&&(used=FilesUsage.truncateVal(fileUsage/1073741824),freespaceDisplayName="0 GB",usedspaceDisplayName=FilesUsage.truncateVal(fileUsage/1073741824)+" GB ",usedSpaceCnt=used,free=0),fileUsage<totalbytes&&(total=1024*userStorageSpace,fileUsage<1073741824&&1073741824!==fileUsage?usedspaceDisplayName=(used=FilesUsage.truncateVal(fileUsage/1024/1024))+" MB":(usedspaceDisplayName=(used=FilesUsage.truncateVal(fileUsage/1073741824))+" GB",used=1024*used*1024*1024),usedSpaceCnt=used,(free=FilesUsage.truncateVal(total-FilesUsage.truncateVal(fileUsage/1024/1024)))<1024?(totaldisplayName=free+" MB",free*=1024,freespaceDisplayName=void 0!=totaldisplayName.toString().split(".")[1]?totaldisplayName.split(".")[0]+"."+totaldisplayName.toString().split(".")[1][0]+" MB":totaldisplayName):(totaldisplayName=FilesUsage.truncateVal(free/1024)+" GB",free=1024*free*1024,freespaceDisplayName=void 0!=totaldisplayName.toString().split(".")[1]?totaldisplayName.split(".")[0]+"."+totaldisplayName.toString().split(".")[1][0]+totaldisplayName.toString().split(".")[1][1]+" GB":totaldisplayName),totalMbSpace=total<1024?userStorageSpace+" MB":userStorageSpace+" GB")}new Highcharts.Chart({chart:{renderTo:"fileUsageChart_subscription",type:"pie",plotShadow:!1,spacingBottom:10,spacingTop:10,spacingLeft:30,spacingRight:10,width:600,height:500},credits:{enabled:!1},title:{text:""},tooltip:{percentageDecimals:2,pointFormat:"{point.name} ,<b>{point.percentage:.2f}%</b>"},legend:{enabled:!1},exporting:{enabled:!1,filename:"File Usage Report",buttons:{contextButton:{align:"left",x:0,y:0}}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",depth:30,dataLabels:{enabled:!0,formatter:function(){return this.point.name+","+this.point.x},style:{fontWeight:"normal",fontSize:"12px",fontFamily:"Verdana, sans-serif",color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{data:[{name:ZPI18N.getString("zp.usedSpace"),x:usedspaceDisplayName,y:Math.round(usedSpaceCnt),color:"#9cc6e5",sliced:!0},{name:ZPI18N.getString("zp.freespace"),x:freespaceDisplayName,y:Math.round(free),color:"#b2d7ad"}],startAngle:225}]});settingsPage.container.find("#totalSpace").html(totalMbSpace),settingsPage.container.find("#usedSpace").html(usedspaceDisplayName),settingsPage.container.find("#freeSpace").html(freespaceDisplayName)})})},truncateVal:function(num){var nAdj=Math.pow(10,2);return Math.floor(num*nAdj)/nAdj}};var orgSetupForms={orgFormHtml:void 0,htmlUrl:"/getOrgSetupPage.zp",countPath:"/getTableBasedRecordCount.zp",needRefresh:!0,classObj:{},limitPerPage:26,isInitialCallBack:!0,filterOprion:{},selectedValues:[],initialCallBack:()=>{orgSetupForms.needRefresh=!0,orgSetupForms.isInitialCallBack=!0,common._load(0,settingsPage.container),delete orgSetupForms.classObj[settingsUrlProps.niceUrlArr[3]],orgSetupForms.orgFormHtml?orgSetupForms.isInitialCallBack=!1:ZPeople.Request.send(orgSetupForms.htmlUrl,{},data=>{orgSetupForms.orgFormHtml=data,orgSetupForms.isInitialCallBack=!1,orgSetupForms.callback()})},callback:()=>{let currObj,objkey;orgSetupForms.needRefresh&&!orgSetupForms.isInitialCallBack&&(objkey=settingsUrlProps.niceUrlArr[3],currObj=orgSetupForms.checkAndUpadteCurrObject(objkey),orgSetupForms.needRefresh=!1,currObj.startIndex=1,currObj.constructView())},recordRealatedCallback:()=>{let objKey=settingsUrlProps.niceUrlArr[3];orgSetupForms.checkAndUpadteCurrObject(objKey).constructRecordAction()},checkAndUpadteCurrObject:objKey=>{let currObj=orgSetupForms.classObj[objKey];return orgSetupForms.classObj[objKey]=void 0==currObj?new OrgsetupView({container:settingsPage.container,tabName:objKey}):currObj},mouseEnterFunction:isText=>{let elementToCheck=event.target;event.target.offsetWidth<event.target.scrollWidth&&!$(elementToCheck).attr("title")&&($(elementToCheck).addClass("tooltip-js"),$(elementToCheck).attr("title",$(event.target).text()),$(elementToCheck).attr("data-title-position","auto"),$(elementToCheck).attr("data-title-display-type","box"))},setModulePrefixParams:()=>{let hashArr=Layout.Page.hashDtl.hashArr,hashArrLength=hashArr.length,formLabelName=hashArr[hashArrLength-2],tabName=hashArr[hashArrLength-3];return{modulePrefix:tabName=tabName+"-"+formLabelName,formId:settingsUrlProps.urlParamsArr.formId,submode:tabName}}};class OrgsetupView{constructor(props){this.main_container=props.container,this.tabName=props.tabName,this.unique_Id=this.tabName+"_uniqueFireScrollId",this.startIndex=1,this.headerslist=[],this.param={},this.additionalParam={},this.rowId="",this.recDtl="",this.tableName=void 0,this.formId=void 0,this.isFriescroll=!1,this.searchVal="",this.FilterApplyed=!1,this.moduleHandler=void 0,this.moduleHandler=getModuleHandler.getmodulehandler(this.tabName)}getRequestParams(){this.param={startInd:this.startIndex,searchVal:this.searchVal},this.param.method=this.moduleHandler.getrecordMethod()}sendRequest(ind){this.getRequestParams(),ZPeople.Request.send(this.moduleHandler.getAdditionParam().url,this.param,data=>{switch(this.formId=data.formId,settingsUrlProps.urlParamsArr.formId=this.formId,ind){case 1:this.constructViews(data);break;case 3:this.constructViews(data,!0)}})}constructView(){this.main_container.html(ZPeople.LOADING_HTML),this.main_container.addClass("zpl_tblfxd zpl_orgloc"),this.sendRequest(1)}constructViews(data,recordOnly){if(common._load(1,this.main_container),!recordOnly){this.main_container.append(orgSetupForms.orgFormHtml),this.constructHeaders(data.colDetails);new FireScrollBack(()=>{this.callBackForFireScroll()},this.main_container,this.unique_Id);let filterValues,filterselOption={};void 0!=this.searchVal&&""!=this.searchVal?(filterValues=JSON.parse(this.searchVal),filterselOption=this.getFilterOptions(filterValues)):filterValues={};new OrgSetupFilter({container:this.main_container,filterFields:data.colDetails,applyCallback:filterVal=>{this.constructRecordBasedOnFilter(filterVal)},filterValues:filterValues,selOption:filterselOption,moduleHandler:this.moduleHandler})}this.constructRecords(data[this.moduleHandler.getAdditionParam().recDtl]),this.initActions(),this.main_container.find("#filterConatainer [id=applyFilter],[id=resetFilter]").removeClass("disabled"),data.numRows>=orgSetupForms.limitPerPage?(this.startIndex=this.param.startInd+data.numRows,settingsPage.fireScrollObj[this.unique_Id].reset()):data.numRows<orgSetupForms.limitPerPage&&(settingsPage.fireScrollObj[this.unique_Id].fireScrollCalled=!0)}constructHeaders(headerslist){let keys=this.moduleHandler.getStaticheaders(),row="";this.headerslist=[];for(let ind=0;ind<keys.length;ind++)switch(keys[ind]){case"membersCount":row+="<th>"+ZPI18N.getString("zp.associatedUsers")+"</th>",this.headerslist.push(keys[ind]);break;case"CODE":ZPeople.isCodeFieldEnabled&&(row+='<th width="200">'+ZPI18N.getString("zp.code")+"</th>",this.headerslist.push(keys[ind]));break;case"ACTION":row+='<th style="min-width: 80px;" width="80"><div class="text-center"> </div> </th>',this.headerslist.push(keys[ind]);break;case"DESIGNATIONNAME":let desigName=headerslist[keys[ind]];ZPeople.checkHTML(desigName)&&(desigName=ZPeople.escapeHtml(desigName)),row+='<th width="450">'+desigName+"</th>",this.headerslist.push(keys[ind]);break;case"DEPARTMENTNAME":let deptName=headerslist[keys[ind]];ZPeople.checkHTML(deptName)&&(deptName=ZPeople.escapeHtml(deptName)),row+='<th width="250">'+deptName+"</th>",this.headerslist.push(keys[ind]);break;case"MAILALIAS":row+="<th>"+headerslist[keys[ind]]+"</th>",this.headerslist.push(keys[ind]);break;default:row+='<th width="200">'+headerslist[keys[ind]]+"</th>",this.headerslist.push(keys[ind])}this.main_container.find("#tablediv #headerRow").append(row)}constructRecords(recordDetails){let Rows="";if(0!=recordDetails.length){FrameworkCommon.hide(this.main_container.find("#emptyDataCard"));for(let singleList of recordDetails){let row="<tr id="+singleList[this.moduleHandler.getAdditionParam().rowId]+">";for(let key of this.headerslist){let val=singleList[key];row+=void 0!=val?this.moduleHandler.constructTD(key,val):"ACTION"!=key?"<td><span></span></td>":'<td class="action-td"><div class="text-center"><div class="zpl_hvr"><i id="deleteIcon" class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'"> </i></div></div></td>'}Rows+=row+="</tr>"}this.main_container.find("tbody").append(Rows),this.main_container.find("#options #addButton").removeClass("DNI")}else if(!this.isFriescroll){this.removeButtonBasedonFilter();let $_elem=this.main_container.find("#emptyDataCard");$_elem.find("#emptycontent").text(ZPI18N.getString(this.moduleHandler.getAdditionParam().emptyText)),$_elem.find("#emptybutn").text(ZPI18N.getString(this.moduleHandler.getAdditionParam().butnText)),FrameworkCommon.show($_elem),$_elem.find("#emptybutn").off().on("click",()=>{this.addAndEditEventHandling("add")})}this.isFriescroll=!1}removeButtonBasedonFilter(){this.FilterApplyed?(this.main_container.find("#options #addButton").removeClass("DNI"),this.main_container.find("#emptyDataCard #emptybutn").addClass("DNI")):(this.main_container.find("#options #addButton").addClass("DNI"),this.main_container.find("#emptyDataCard #emptybutn").removeClass("DNI"))}getFilterOptions(filterValues){let values={};for(let key in filterValues){let optons=[];if(this.moduleHandler.getTokenFields().indexOf(key)>-1){for(let id of filterValues[key])optons.push({...{Id:id},...orgSetupForms.selectedValues[id]});values[key]=optons}}return values}initActions(){this.main_container.find("#topSettMenu #getCount").off().on("click",()=>{let $_elem=$(event.target);ZPeople.Request.send(orgSetupForms.countPath,{mode:this.tabName,method:"getTableBasedRecordCounts",searchVal:this.searchVal},data=>{7e3==data.code&&($_elem.addClass("DNI"),$_elem.next().removeClass("DNI").text(data.rowsCnt))})}),this.main_container.find("#addButton").off().on("click",()=>{this.addAndEditEventHandling("add")}),this.main_container.find("#addButton").text(ZPI18N.getString(this.moduleHandler.getAdditionParam().butnText)),this.main_container.find("#importBtn").off().on("click",()=>{ZP5Import.init("setting_"+this.tabName)}),this.main_container.find("#tablediv tbody tr").off().on("click",()=>{this.addAndEditEventHandling("view",$(event.target).closest("tr").attr("id"))}),this.main_container.find("#tablediv tbody tr #deleteIcon").off().on("click",()=>{event.stopPropagation(),this.deleteAlert(event)}),this.main_container.find("#tablediv tr #membCount ").off().on("click",()=>{event.stopPropagation();let $_row=$(event.target).closest("tr"),count=$(event.target).text(),recId=$_row.attr("id"),name=$_row.children("td:first").text();new Sliderpop({name:name,recId:recId,count:count,tabName:this.tabName}).init()})}addAndEditEventHandling(mode,recordId){switch(mode){case"add":window.location.href=Layout.Page.hash+"/add";break;case"view":window.location.href=Layout.Page.hash+"/view-recordId:"+recordId}}callBackForFireScroll(){this.isFriescroll=!0,this.sendRequest(3)}constructRecordAction(){if(void 0==this.formId){let formdetl=ZPeople.Module.getData();formdetl.result?settingsUrlProps.urlParamsArr.formId=formdetl.result.formId:(formdetl=ZP5ServicesCommon.getDefaultFormAndViewId("",this.tabName),settingsUrlProps.urlParamsArr.formId=formdetl.formId)}else settingsUrlProps.urlParamsArr.formId=this.formId;ZP5Form.formsCallback(orgSetupForms.setModulePrefixParams().modulePrefix)}deleteAlert(event){var alertDelete=new DeleteAlertMessage(ZPI18N.getString("zp.delete"),ZPI18N.getString("zp.leave.operations.deleteinfo",[ZPI18N.getString(this.additionalParam.text)]));alertDelete.setCallback(()=>{this.deleterecord(event)}),alertDelete.yesButtonText=ZPI18N.getString("zp.confirm"),alertDelete.show()}deleterecord(event){let recId=$(event.target).closest("tr").attr("id"),params={mode:"deleteRecords",formId:this.formId,recordIds:recId};this.main_container.find("#tablediv tbody").addClass("DNI"),common._load(0,this.main_container),ZPeople.Request.send("/formAction.zp",params,(resultData,params,elem)=>{this.deleteRecordCallBack(resultData,params,elem)},event.target,null)}deleteRecordCallBack(resultData,params,elem){resultData.errObj;switch(resultData.code){case 7e3:ZPeople.Message.success(ZPI18N.getString("zp.recorddeletedsuccessfully")),this.main_container.find("#tablediv tbody").removeClass("DNI"),this.main_container.find("#tablediv tbody").html(""),this.startIndex=1,this.sendRequest(3),this.main_container.find("#topSettMenu #totalcount").addClass("DNI"),this.main_container.find("#topSettMenu #getCount").removeClass("DNI");break;case 7400:ZPeople.Message.failure(ZPI18N.getString("zp.sorryservererror")),common._load(1,this.main_container),this.main_container.find("#tablediv tbody").removeClass("DNI");break;default:ZPeople.Message.warning(resultData.message),common._load(1,this.main_container),this.main_container.find("#tablediv tbody").removeClass("DNI")}}constructRecordBasedOnFilter(filterVal){this.searchVal=JSON.stringify(filterVal),this.FilterApplyed=void 0!=filterVal&&Object.keys(filterVal).length>0,this.main_container.find("#tablediv tbody").html(""),FrameworkCommon.hide(this.main_container.find("#emptyDataCard")),common._load(0,this.main_container),this.startIndex=1,this.sendRequest(3)}}class Sliderpop{constructor(props){this.name=props.name,this.recId=props.recId,this.count=props.count,this.startIndex=1,this.isFriescroll=!1,this.searchSliderValues={},this.limitPerpage=25,this.isSearchAllow=!0,this.tabName=props.tabName,this.unique_Id=this.tabName+"_slider_Uique"}init(){this.empListSlider=new sliderModal(ZSEC.Encoder.encodeForHTML(this.name),new Tab("EmpListPopup",()=>{this.constructSliderHtml()},()=>{})),this.empListSlider.construct(),this.empListSlider.setCloseCallback(()=>{this.closeSlider()}),this.getDataForSlider(!0,this.getParamForSlider()),this.initSliderActions()}closeSlider(){this.empListSlider.remove(),delete this.empListSlider}constructSliderHtml(){let empListHTML='<div class="zpl_mmnu"><div id="empLocListTable" class="zpl_mmnurgt"><div class="zpl_act">';empListHTML+='<div class="zpl_crd">',empListHTML+='<div class="zpl_crdhdr zpl_crdhdrcnt">',empListHTML+='<div id="empErrMsg"><div class="zpl_idiv">',empListHTML+='<div class="zpl_search zpl_srchsml w300" elem="searchContainer"><input elem="empLocListSearch" placeholder="'+ZPI18N.getString("zp.searchdata")+'" class="ztextbox wd100_per"><i class="PI_lens"></i></div>',empListHTML+="</div></div>",empListHTML+='<div class="zpl_posnon"><div class="zpl_idiv"><span>'+ZPI18N.getString("zp.lite.totempcount")+' : </span><b elem="empLocListCount">'+this.count+"</b></div></div></div>",empListHTML+='<div class="zpl_crdcnt"><div class="zpl_tblres" elem="empLocListTableCont">',empListHTML+=this.sliderTableHtml(),empListHTML+=ZPeople.LOADING_HTML,empListHTML+="</div></div>",empListHTML+="</div></div></div>",this.empListSlider.sliderDiv.find("#cardEmpListPopup").append(empListHTML),this.empListSlider.sliderDiv.find("#sliFootDiv").remove()}sliderTableHtml(){let sliderTabHTML="";return sliderTabHTML+='<table class="zpl_tbl">',sliderTabHTML+='<thead><tr><th width="400">'+ZPI18N.getString("zp.user")+'</th><th width="400">'+ZPI18N.getString("zp.email")+'</th></tr></thead><tbody elem="tableBody" type="all"></tbody>',sliderTabHTML+="</table>"}getDataForSlider(needFireScroll,params){ZPeople.Request.send("/users/getUsersListing",params,(data,params)=>{this.constructSliderView(data,params,needFireScroll)})}getParamForSlider(Srchval){let params={method:"getUsersListing",searchByRole:0,searchByLoc:0,searchByDept:0,searchByDesig:0,startInd:this.startIndex,searchByEmpStatus:"All Status",searchByOnbStatus:-1,userType:1,userStatus:3,sortByType:"2_0",isAjax:!0,needTotalCount:!0};switch(void 0!=Srchval&&(params.searchval=Srchval),this.tabName){case"department":params.searchByDept=this.recId;break;case"designation":params.searchByDesig=this.recId}return params}constructSliderView(data,params,needFireScroll){data.usersDtls?(needFireScroll&&new FireScrollBack(()=>{this.sliderFireScrollCallback()},this.empListSlider.sliderDiv.find("#cardEmpListPopup #empLocListTable"),this.unique_Id),this.constructSliderRecords(data.usersDtls,params)):(ZPeople.Message.failure(ZPI18N.getString("zp.sorryservererror")),empListSlider.close()),$("#cardEmpLocListPopup").find("[elem=empLocListCount]").text(data.totalCount),this.isFriescroll=!1}sliderFireScrollCallback(){this.isFriescroll=!0;let Srchval=this.empListSlider.sliderDiv.find("[elem=empLocListSearch]").val();""!=Srchval?this.getDataForSlider(!1,this.getParamForSlider(Srchval)):this.getDataForSlider(!1,this.getParamForSlider())}constructSliderRecords(records,params){let rows="",lengthofRec=records.length;if(void 0!=records&&0!=lengthofRec||this.isFriescroll){this.empListSlider.sliderDiv.find("#cardEmpListPopup [elem=empLocListTableCont] .zp_nd_nodata").length>0&&this.empListSlider.sliderDiv.find("#cardEmpListPopup [elem=empLocListTableCont]").html(this.sliderTableHtml());for(let emp of records){let row='<tr><td><div class="zpl_em" erecno="'+emp.ERECNO+'" zctooltip="true" data-title-position="bottom" title="'+ZSEC.Encoder.encodeForHTMLAttribute(emp.EMPLOYEEID)+" - "+ZSEC.Encoder.encodeForHTMLAttribute(emp.EMPLOYEENAME)+'">';row+='<div class="zpl_emimg"><img src="'+emp.EMPLOYEEPHOTO+'"></div>',row+='<div class="zpl_emdts" id="empprof">',row+="<div><em>"+ZSEC.Encoder.encodeForHTML(emp.EMPLOYEEID)+" - </em><b>"+ZSEC.Encoder.encodeForHTML(emp.EMPLOYEENAME)+"</b></div>",row+="</div>",row+="</div></td>",rows+=row+="<td><em>"+(emp.EMPLOYEEMAILALIAS?ZSEC.Encoder.encodeForHTML(emp.EMPLOYEEMAILALIAS):"")+"</em></td></tr>"}}else new EmptyPages("zp_nd_nodata",ZPI18N.getString("zp.nodatafound"),"",this.empListSlider.sliderDiv.find("#cardEmpListPopup [elem=empLocListTableCont]")).show();void 0==params.searchval||this.isFriescroll?this.empListSlider.sliderDiv.find("#cardEmpListPopup [elem=tableBody][type=all]").append(rows):this.empListSlider.sliderDiv.find("#cardEmpListPopup [elem=tableBody][type=all]").html(rows),this.empListSlider.sliderDiv.find("[elem=empLocListTableCont]").find("#zp_page_loading").remove(),this.initSliderRecordAction(),lengthofRec>=this.limitPerpage?(this.startIndex=this.startIndex+lengthofRec,settingsPage.fireScrollObj[this.unique_Id].reset()):lengthofRec<this.limitPerpage&&(settingsPage.fireScrollObj[this.unique_Id].fireScrollCalled=!0)}initSliderRecordAction(){this.empListSlider.sliderDiv.find("[id=empprof]").off().on("click",()=>{ZPeople.getUserPage($(event.currentTarget).parent().attr("ERECNO")),this.empListSlider.close()})}initSliderActions(){this.empListSlider.sliderDiv.find("[elem=empLocListSearch]").off().on("keyup",()=>{this.SliderSearchHandling(event)})}SliderSearchHandling(event){this.isSearchAllow&&(this.isSearchAllow=!1,setTimeout(()=>{let searchval=$(event.target).val().trim();this.isSearchAllow=!0;let $_error_emem=this.empListSlider.sliderDiv.find("#cardEmpListPopup #empLocListTable #empErrMsg");searchval.length>50?0==$_error_emem.find("#error_message").length&&$_error_emem.append('<span id="error_message" class="ztextbox--error__label">'+ZPI18N.getString("zp.maxFieldLength",[ZPI18N.getString("zp.searchdata"),50])+"</span>"):($_error_emem.find("#error_message").length>0&&$_error_emem.find("#error_message").remove(),this.startIndex=1,this.getDataForSlider(!1,this.getParamForSlider(searchval)))},500))}}class OrgSetupFilter{constructor(props){this.container=props.container,this.filterFields=props.filterFields,this.applyCallback=props.applyCallback,this.filterValues=props.filterValues,this.selOption=props.selOption,this.moduleHandler=props.moduleHandler,this.initFilter(),this.initFilterAction()}initFilter(){let filterComp="",selectComp=[];for(let field of this.moduleHandler.getFilterStaticHeaders())filterComp+="<div class='zpl_secn' id='"+field+"'><div><label>"+ZSEC.Encoder.encodeForHTML(this.filterFields[field])+"</label></div>",this.moduleHandler.getTokenFields().indexOf(field)>-1?(filterComp+="<div><select class='zselectbox select-js'></select></div>",selectComp.push(field)):filterComp+="<div><input placeholder='"+ZSEC.Encoder.encodeForHTMLAttribute(this.filterFields[field])+"' type='text' class='ztextbox'label='"+field+"'></div></div>";this.container.find("#filterConatainer #filterList").append(filterComp),this.initSelectComponent(selectComp),this.setFilterValues()}initSelectComponent(selectComp){let options=this.selOption;if(selectComp.length>0)for(let val of selectComp){let $_elem=this.container.find("#filterConatainer #filterList #"+val+" select");if(0!=$_elem.length){let option={dataSource:{search:queryParams=>new Promise(function(search,reject){let results=[],respObj={},term=queryParams.query,page=queryParams.pages;orgSetupForms.filterOprion[term]||(orgSetupForms.filterOprion[term]=[]),orgSetupForms.filterOprion[term].length>0?(results=[...results,...orgSetupForms.filterOprion[term]],search(respObj={results:results,more:!1})):ZPeople.Request.send("/getDepartMentLeads.zp",{method:"getDepartMentLeads",searchText:term,startIndex:page},data=>{"7000"==data.code&&(results=[...results,...data.result],orgSetupForms.filterOprion[term]=data.result),search(respObj={results:results,more:!1})})})},dropdownList:{contentType:"image-text",sortResults:!0,fitForElement:!0,height:"335px"},dataMapping:{id:"Id",value:"Id",text:"Value",image:"Image"},placeholder:ZPI18N.getString("zp.local.DepartmentLead"),serverSearch:!0,lazyLoading:!0,sortBy:"Id",tokens:{contentType:"image-text"},viewPerPage:20,maxAllowedValues:5,randomDropdownListId:!0,search:{minKeywordLength:0,highlightKeyword:!0,delay:20,showNoResultsMessage:!0},messages:{noResults:ZPI18N.getString("zp.noresults"),remove:ZPI18N.getString("zp.remove")},values:options[val]};ZPeopleComponents.isComponent($_elem)&&ZPeopleComponents.tokenfield($_elem).destroy(),ZPeopleComponents.tokenfield($_elem,option)}}}setFilterValues(){if(Object.keys(this.filterValues).length>0){let $_filterList=this.container.find("#filterConatainer #filterList");for(let key in this.filterValues)-1==this.moduleHandler.getTokenFields().indexOf(key)&&$_filterList.find("#"+key).find("input").val(this.filterValues[key]);this.constructbreadCrumbs()}}initFilterAction(){this.container.find("#filterButton").off().on("click",()=>{this.openFilter()}),this.container.find("#filterConatainer #closeFilter").off().on("click",()=>{this.closeFilter()}),this.container.find("#filterConatainer #applyFilter").off().on("click",()=>{this.applyfilter(),this.closeFilter()}),this.container.find("#filterConatainer #resetFilter").off().on("click",()=>{this.resetFilter(),this.closeFilter()})}openFilter(){this.container.addClass("zpl_fltr_flt")}closeFilter(){this.container.removeClass("zpl_fltr_flt")}applyfilter(){let $_filterList=this.container.find("#filterConatainer #filterList"),tempFilterVal={...this.filterValues},breadCrumbVal={};for(let field of this.moduleHandler.getFilterStaticHeaders()){let val;if(this.moduleHandler.getTokenFields().indexOf(field)>-1){let zcomp=ZPeopleComponents.tokenfield($_filterList.find("#"+field).find("select"));val=[];for(let obj of zcomp.getAllValues())val.push(obj.Id),orgSetupForms.selectedValues[obj.Id]={Value:obj.Value,Image:obj.Image}}else val=$_filterList.find("#"+field).find("input").val();""!=val&&"select"!=val?(this.filterValues[field]=val,breadCrumbVal[field]=val):delete this.filterValues[field]}0==Object.keys(this.filterValues).length&&0==Object.keys(tempFilterVal).length||_.isEqual(tempFilterVal,this.filterValues)?ZPeople.Message.warning(ZPI18N.getString("zp.nochangesmade")):(this.constructbreadCrumbs(breadCrumbVal),this.applyCallback(this.filterValues),this.resetCount(),this.disableButton())}resetFilter(){0!=Object.keys(this.filterValues).length?(this.filterValues={},this.constructbreadCrumbs(),this.applyCallback(),this.clearDataInFilter(),this.resetCount(),this.disableButton(),orgSetupForms.selectedValues=[]):ZPeople.Message.warning(ZPI18N.getString("zp.nochangesmade"))}disableButton(){this.container.find("#filterConatainer [id=applyFilter],[id=resetFilter]").addClass("disabled")}constructbreadCrumbs(){let breadString=$('<ul id="filterBreadcrumbList" class="zpl_fltrvwlst"></ul>'),$_liHtml="";for(let key in this.filterValues)if("DEPARTMENT_LEAD"==key){$_liHtml=$('<li id="breadcrumbItem" filterind="0" label="'+key+'"><label>'+ZSEC.Encoder.encodeForHTML(this.filterFields[key])+' :</label><span class="zpl_fltrvwimg" id="imageSpan"></span><span id="textspan" onmouseover="orgSetupForms.mouseEnterFunction()"></span><a class="PI_cls" id="breadRemove"></a></li>');let ind=!0;for(let id of this.filterValues[key]){if(!ind){$_liHtml.find("#textspan").after("<sub id='breadcrumbPop' class='zpl_drpdwn-js'>+ "+(this.filterValues[key].length-1)+"</sub>");break}$_liHtml.find("#imageSpan").append("<img src="+orgSetupForms.selectedValues[id].Image+">"),$_liHtml.find("#textspan").text(orgSetupForms.selectedValues[id].Value),ind=!1}breadString.append($_liHtml)}else($_liHtml=$('<li id="breadcrumbItem" label="'+key+'"><label>'+ZSEC.Encoder.encodeForHTML(this.filterFields[key])+' :</label><span id="textspan" onmouseover="orgSetupForms.mouseEnterFunction()"></span><a class="PI_cls" id="breadRemove"></a></li>')).find("#textspan").text(this.filterValues[key]),breadString.append($_liHtml);Object.keys(this.filterValues).length>0?(this.container.find("#orgform-filterBreadcrumb #filterBreadcrumbWrapper").html(breadString[0]),this.container.find("#orgform-filterBreadcrumb").removeClass("DNI"),this.container.addClass("zpl_fltrvwfxd"),this.initBreadCrumbsAction()):(this.container.find("#orgform-filterBreadcrumb #filterBreadcrumbList").html(""),this.container.find("#orgform-filterBreadcrumb").addClass("DNI"),this.container.removeClass("zpl_fltrvwfxd"))}initBreadCrumbsAction(){let $_elem=this.container.find("#orgform-filterBreadcrumb");$_elem.find("#filterBreadcrumbList [id=breadRemove]").off().on("click",()=>{event.stopPropagation(),this.breadCrumbRemove($(event.target).closest("li"))}),$_elem.find("#orgform-breadcrumbClearAll").off().on("click",()=>{this.resetFilter()}),$_elem.find("#filterBreadcrumbList [id=breadcrumbPop]").off().on("click",()=>{event.stopPropagation(),0==this.container.find("#breadcrumbPopdiv").length&&this.container.append($('<div id="breadcrumbPopdiv" class="zpl_popovr zpl_fltrvw-popovr" data-type="list" data-content-type="icon-text" role="menu" tabindex="0" aria-hidden="true"></div>')),this.constructPopover(event)})}constructPopover(event){let $_elem=$(event.target),label=$_elem.closest("li").attr("label"),idsArr=this.filterValues[label],$popover=$('<ul data-body="true" class="zpl_fltrvwlst" />');for(let ind=1;ind<idsArr.length;ind++){let $_liHtml=$('<li id="breadcrumbItem" filterind="'+idsArr[ind]+'" label="'+label+'"><span class="zpl_fltrvwimg" id="imageSpan"></span><span id="textspan" onmouseover="orgSetupForms.mouseEnterFunction()"></span><a class="PI_cls" id="breadRemove"></a></li>');$_liHtml.find("#imageSpan").append("<img src="+orgSetupForms.selectedValues[idsArr[ind]].Image+">"),$_liHtml.find("#textspan").text(orgSetupForms.selectedValues[idsArr[ind]].Value),$popover.append($_liHtml)}ZPeopleComponents.popover(this.container.find("#breadcrumbPopdiv")).destroy(),this.container.find("#breadcrumbPopdiv").html($popover),ZPeopleComponents.popover(this.container.find("#breadcrumbPopdiv"),{forElement:$_elem,position:"bottom",displayType:"box"}),ZPeopleComponents.popover(this.container.find("#breadcrumbPopdiv")).open(),this.container.find("#breadcrumbPopdiv").find("[id=breadRemove]").on("click",event=>{this.breadCrumbRemove($(event.target).closest("li")),ZPeopleComponents.popover(this.container.find("#breadcrumbPopdiv")).close()})}breadCrumbRemove(elem){let labelName=elem.attr("label"),filterValue=void 0,filterind=elem.attr("filterind"),valArr=[];if(void 0!=filterind&&0!=filterind){let length=elem.parent().children().length,$_breadcoutele=this.container.find("#orgform-filterBreadcrumb #filterBreadcrumbList").find("[label="+labelName+"]").find("#breadcrumbPop");1==length?$_breadcoutele.remove():$_breadcoutele.text("+ "+(length-1)),this.filterValues[labelName].splice(this.filterValues[labelName].indexOf(filterind),1),delete orgSetupForms.selectedValues[filterind],valArr.id=filterind}else delete this.filterValues[labelName];0==Object.keys(this.filterValues).length?(elem.parent().closest("#orgform-filterBreadcrumb").addClass("DNI"),this.container.removeClass("zpl_fltrvwfxd"),orgSetupForms.selectedValues=[]):filterValue=this.filterValues,valArr.lname=labelName,elem.remove(),this.clearDataInFilter(valArr),this.applyCallback(filterValue),this.resetCount()}clearDataInFilter(valArr){let fid=void 0,staticfield=void 0;valArr?(staticfield=[valArr.lname],fid=[valArr.id]):staticfield=this.moduleHandler.getFilterStaticHeaders();let $_filterList=this.container.find("#filterConatainer #filterList");for(let field of staticfield)this.moduleHandler.getTokenFields().indexOf(field)>-1?void 0!==fid&&fid[0]?ZPeopleComponents.tokenfield($_filterList.find("#"+field).find("select")).removeTokens(fid):ZPeopleComponents.tokenfield($_filterList.find("#"+field).find("select")).removeAllTokens():$_filterList.find("#"+field).find("input").val("")}resetCount(){this.container.find("#topSettMenu #totalcount").addClass("DNI"),this.container.find("#topSettMenu #getCount").removeClass("DNI")}}getModuleHandler={getmodulehandler:mode=>{switch(mode){case"department":case"designation":return new OrganizationModuleHandler(mode)}}};class OrganizationModuleHandler{constructor(mode){this.mode=mode}getTableName(){switch(this.mode){case"department":return"P_Department";case"designation":return"P_Designation"}}getAdditionParam(){switch(this.mode){case"department":return{url:"/getDepartmentsList.zp",rowId:"DEPARTMENTID",recDtl:"deptDtls",butnText:"zp.manageadddept",emptyText:"zp.nodepartmentfound",text:"zp.sdepartment"};case"designation":return{url:"/getDesignationsList.zp",rowId:"DESIGNATIONID",recDtl:"desgDtls",butnText:"zp.adddesg",emptyText:"zp.nodesignationfound",text:"zp.sdesignation"}}}getStaticheaders(){switch(this.mode){case"department":return["DEPARTMENTNAME","CODE","membersCount","MAILALIAS","DEPARTMENT_LEAD","PARENT_DEPARTMENT","ACTION"];case"designation":return["DESIGNATIONNAME","CODE","membersCount","MAILALIAS","ACTION"]}}getFilterStaticHeaders(){switch(this.mode){case"department":return["DEPARTMENTNAME","DEPARTMENT_LEAD"];case"designation":return["DESIGNATIONNAME"]}}getTokenFields(){return["DEPARTMENT_LEAD"]}getrecordMethod(){switch(this.mode){case"department":return"getDepartmentsDetails";case"designation":return"getDesignationsDetails"}}constructTD(key,val){switch(this.mode){case"department":switch(key){case"CODE":return ZPeople.isCodeFieldEnabled?"<td><span class='txttrim zpl_w200' onmouseover='orgSetupForms.mouseEnterFunction()' >"+val+"</span></td>":"";case"membersCount":return val>0?"<td><span><a id='membCount'>"+val+"</a></span></td>":"<td><span>"+val+"</span></td>";default:return"<td><span class='txttrim zpl_w200' onmouseover='orgSetupForms.mouseEnterFunction()' >"+val+"</span></td>"}break;case"designation":switch(key){case"CODE":return ZPeople.isCodeFieldEnabled?"<td><span class='txttrim zpl_w300' onmouseover='orgSetupForms.mouseEnterFunction()' >"+val+"</span></td>":"";case"membersCount":return val>0?"<td><span class='txttrim zpl_w200'><a id='membCount'>"+val+"</a></span></td>":"<td><span class='txttrim zpl_w200'>"+val+"</span></td>";case"DESIGNATIONNAME":case"MAILALIAS":return"<td><span class='txttrim zpl_w300' onmouseover='orgSetupForms.mouseEnterFunction()' >"+val+"</span></td>"}}}}class SettingDepartMentModuleHandler extends ModuleHandler{constructor(formClassObj){super(formClassObj)}close(){return"settings/service/accountsetup/department"}singleFieldEditCallback(data,params,isModified){orgSetupForms.needRefresh=isModified,isModified&&(orgSetupForms.filterOprion={})}successCallback(resultData,params){orgSetupForms.needRefresh=!0,orgSetupForms.filterOprion={}}}class SettingDesignationModuleHandler extends ModuleHandler{constructor(formClassObj){super(formClassObj)}close(){return"settings/service/accountsetup/designation"}singleFieldEditCallback(data,params,isModified){orgSetupForms.needRefresh=isModified,isModified&&(orgSetupForms.filterOprion={})}successCallback(resultData,params){orgSetupForms.needRefresh=!0,orgSetupForms.filterOprion={}}}var StreamsNew={streamDependency:!1,isRecordInitCall:!1,hashChangeCallback:()=>{"streams"==settingsUrlProps.niceUrlArr[3]&&$.inArray(settingsUrlProps.niceUrlArr[4],["add","view","edit"])||(StreamsNew.constructListObj.isResetNeeded=!0,StreamsNew.Filter.resetValues())},init:function(){StreamsNew.constructListObj.listSettingsConfObj.container=settingsPage.container,StreamsNew.constructListObj.container=settingsPage.container,StreamsNew.initPage()},recordInitCallback:()=>{StreamsNew.isRecordInitCall&&(settingsUrlProps.urlParamsArr.formId=StreamsNew.formId,ZP5Form.formsCallback(),StreamsNew.isRecordInitCall=!1)},initFormActions:function(){StreamsNew.isRecordInitCall=!0,StreamsNew.formId?StreamsNew.recordInitCallback():StreamsNew.init()},initPage:()=>{if(StreamsNew.constructListObj.isResetNeeded&&""!=StreamsNew.Filter.savedVals.name&&0!=StreamsNew.Filter.savedVals.designations.length)return StreamsNew.Filter.close(),StreamsNew.Filter.apply(!0),void(StreamsNew.constructListObj.isResetNeeded=!1);(0==settingsPage.container.find('[elem="tblHead"]').length||StreamsNew.constructListObj.isResetNeeded)&&(StreamsNew.destroyComponents(),CommonSettingsObj.initListPage(StreamsNew.constructListObj),StreamsNew.constructListObj.isResetNeeded=!1),StreamsNew.constructListObj.isFromForms=!1},onClickMemberCount(event){event.stopPropagation(),StreamsNew.Filter.close();let elem=$(event.target).parents("[elem=streamRow]"),streamId=elem.attr("streamid"),streamName=elem.find("[elem=streamName]").text(),count=elem.find("[elem=memCnt]").text(),sliderObj=new EmpListSlider("streamBasedEmpSlider",{title:streamName});sliderObj.setCallback(function(searchKey,startIndex,finalCallback){let params={searchKey:searchKey,startIndex:startIndex};ZPeople.Request.sendRequestWithVersion("/stream/"+streamId+"/associatedEmployees",params,"GET",(data,params,others)=>{if(data&&data.isSuccess){let usersList=[];data.hasOwnProperty("userList")&&data.userList.length>0&&data.userList.forEach(emps=>{let emp={};emp.empId=emps.empId,emp.empPhoto=emps.empPhoto,emp.erecNo=emps.erecNo,emp.empFname=emps.empName,emp.empLname="",emp.empMail=emps.empMail,usersList.push(emp)});let retData={usersList:usersList,searchKey:searchKey,count:count,hasMore:data.more,nextStart:data.nxtsrt};data.hasOwnProperty("isEncoded")&&sliderObj.setIsEncoded(data.isEncoded),finalCallback(retData)}})}),sliderObj.setProfileRedirect(!0),sliderObj.open()},constructListObj:{addBtnListener:()=>{StreamsNew.Filter.close(),window.location.href=Layout.Page.hash+"/add"},totalCountDiv:'<div class="PT5"><span elem="totalCount">'+ZPI18N.getString("zp.counttotal")+': <a elem="getCount">#</a><b elem="count">0</b></span></div>',importBtnDiv:'<button type="button" elem="importElemButton" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.import")+"</button>",exportDiv:'<a class="zpl_ibg" elem="exportElemButton" target="_blank" title="'+ZPI18N.getString("zp.export")+'"><span class="PI_exprt"></span></a>',filterDiv:'<i class="zpl_ibg PI_fltr" elem="filterButton" title="'+ZPI18N.getString("zp.filter")+'"></i>',container:{},isBtnMnuNeeded:!0,isAddBtnNeeded:!0,isRightSubMnuNeeded:!0,isResetNeeded:!0,addBtnText:ZPI18N.getString("zp.addstream"),constructOtherBtn:function(settingsConfObj){0==settingsConfObj.container.find('[elem="importElemButton"]').length&&(settingsConfObj.container.find("[elem=btnsDiv]").before(settingsConfObj.totalCountDiv),settingsConfObj.container.find('[elem="btnsDiv"]').append(settingsConfObj.importBtnDiv),settingsConfObj.container.find('[elem="btnsDiv"]').append(settingsConfObj.exportDiv),settingsConfObj.container.find('[elem="btnsDiv"]').append(settingsConfObj.filterDiv)),settingsConfObj.container.addClass("zpl_tblfxd"),settingsConfObj.container.find("[elem=importElemButton]").off("click").on("click",()=>{ZP5Import.init("stream")}),settingsConfObj.container.find("[elem=exportElemButton]").off("click").on("click",()=>{ZP5Export.init("stream")}),FrameworkCommon.show(settingsConfObj.container.find("[elem=getCount]").off("click").on("click",StreamsNew.getCount)),FrameworkCommon.show(settingsConfObj.container.find("[elem=filterButton]").off("click").on("click",StreamsNew.Filter.open)),FrameworkCommon.hide(settingsConfObj.container.find("[elem=count]"))},listSettingsConfObj:{container:{},isFireScrollNeeded:!0,fireScrollProps:{uId:"operations_employee_streams"},reqMethod:"GET",url:URL_VERSION+"/streams/list",getParams:function(){let params={startIndex:this.fireScrollProps.fireScrollObj.recordCount+1};return StreamsNew.Filter.alterParams(params),params},constructTblHead:function(){let tblHead="<tr>";return tblHead+='<th width="200">'+ZPI18N.getString("zp.streamname")+"</th>",tblHead+="<th>"+ZPI18N.getString("zp.associatedUsers")+"</th>",tblHead+='<th width="200">'+ZPI18N.getString("zp.description")+"</th>",StreamsNew.streamDependency&&(tblHead+='<th width="200" elem="desigNameHeader">'+ZPI18N.getString("zp.designations")+"</th>"),tblHead+='<th width="80"><div class="text-center"></div></th>',tblHead+="</tr>"},constructTblRow:function(data){let tblRow='<tr elem="streamRow" streamId="'+data.STREAMID+'"><td width="200" elem="streamName">'+ZSEC.Encoder.encodeForHTML(data.NAME)+"</td>";if(tblRow+="<td>"+(data.membersCount>0?'<a elem="memCnt">'+data.membersCount+"<a>":data.membersCount)+"</td>",tblRow+='<td width="200"><span class="txttrim zpl_w200" title="'+(ZPSetupCommon.isEmpty(data.DESCRIPTION)?"":ZSEC.Encoder.encodeForHTMLAttribute(data.DESCRIPTION))+'">'+(ZPSetupCommon.isEmpty(data.DESCRIPTION)?"":ZSEC.Encoder.encodeForHTML(data.DESCRIPTION))+"<span></td>",StreamsNew.streamDependency){let popoverHtml="";tblRow+='<td width="200">',ZPSetupCommon.isEmpty(data.DESIGNATION)||0===data.DESIGNATION.length||$.each(data.DESIGNATION,function(index,desgName){index<4?(tblRow+=ZSEC.Encoder.encodeForHTML(desgName),tblRow+=index!=data.DESIGNATION.length-1&&3!=index?", ":""):popoverHtml+="<li>"+ZSEC.Encoder.encodeForHTML(desgName)+"</li>"}),""!=popoverHtml&&(StreamsNew.constructListObj.container.find("#desc"+data.STREAMID).remove(),popoverHtml="<ul>"+popoverHtml+"</ul>",tblRow+=" & "+(data.DESIGNATION.length-4)+" ",tblRow+='<a elem="moreElem" popoverid="desc'+data.STREAMID+'">'+ZPI18N.getString("zp.more").toLowerCase()+"</a>",tblRow+='<div class="zpl_drpdwn" id="desc'+data.STREAMID+'" elem="descMorePopover" data-content="'+ZSEC.Encoder.encodeForHTMLAttribute(popoverHtml)+'"></div>'),tblRow+="</td>"}return tblRow+='<td width="80"><div class="zpl_hvr" elem="actionsContainer">',tblRow+='<i elem="streamDeleteIcon" class="PI_delete"></i>',tblRow+="</div></td>",tblRow+="</tr>"},successCallback:function(resultData,params,listSettingsConfObj){if(listSettingsConfObj.container.find("[elem=emptyDivCont]").remove(),StreamsNew.Filter.hideBreadCrums(),StreamsNew.constructListObj.isResetNeeded=!1,"displayErrorMsgStream"==resultData.streamErr)listSettingsConfObj.container.find("#zp_page_loading").remove(),StreamsNew.constructListObj.container.find('[elem="btnMnu"]').addClass("DNI"),StreamsNew.showHideNodata(!0,!0),StreamsNew.Filter.hideBreadCrums();else{if(StreamsNew.streamDependency=resultData.isDependent,StreamsNew.formId=resultData.formId,StreamsNew.viewId=resultData.viewId,FrameworkCommon.show(StreamsNew.constructListObj.container.find('[elem="btnMnu"]')),listSettingsConfObj.container.find("#zp_page_loading").remove(),resultData.numRows>0)params.stIndex=params.startIndex,CommonSettingsObj.constructList(resultData.streamDtls,params,listSettingsConfObj),StreamsNew.defaultActions(),listSettingsConfObj.fireScrollProps.fireScrollObj.recordCount+=resultData.numRows,listSettingsConfObj.fireScrollProps.fireScrollObj.fireScrollCalled=!1;else{if(0!=listSettingsConfObj.fireScrollProps.fireScrollObj.recordCount||listSettingsConfObj.isFromFilter||StreamsNew.showHideNodata(!0),listSettingsConfObj.isFromFilter){listSettingsConfObj.container.append("<div elem=emptyDivCont></div>"),new EmptyPages("zp_nd_nodata",ZPI18N.getString("zp.nostreams"),"",listSettingsConfObj.container.find("[elem=emptyDivCont]")).show()}listSettingsConfObj.fireScrollProps.fireScrollObj.fireScrollCalled=!0}StreamsNew.Filter.init(resultData),StreamsNew.Filter.onResize(!0),StreamsNew.recordInitCallback()}},constructEmptyPage:function(){StreamsNew.showHideNodata(!0)}}},showHideNodata:function(isShow,isDisabled){FrameworkCommon.show(StreamsNew.constructListObj.container.find("[elem=addElemBtn]"));let emptyPageDiv=settingsPage.container.find("[elem=emptyDivCont]");0==emptyPageDiv.children().length&&(0==settingsPage.container.find(".zpl_rgtcnt").length&&settingsPage.container.append('<div name="outlineDiv" class="zpl_rgtcnt" elem="tblContainer">'),settingsPage.container.find(".zpl_rgtcnt").append('<div elem="emptyDivCont" class="DNI"></div>'),emptyPageDiv=settingsPage.container.find("[elem=emptyDivCont]"));let emptyPage=new EmptyPages("zp_nd_nodata",ZPI18N.getString("zp.nodatafound"),ZPI18N.getString("zp.streamnotes"),emptyPageDiv);isDisabled?emptyPage=new EmptyPages("zp_nd_disbldsgn",ZPI18N.getString("zp.displayErrorMsgStream"),ZPI18N.getString("zp.streamnotes"),emptyPageDiv):(FrameworkCommon.hide(StreamsNew.constructListObj.container.find("[elem=addElemBtn]")),emptyPage.setButton(ZPI18N.getString("zp.addstream"),StreamsNew.constructListObj.addBtnListener)),emptyPage.show(),isShow?(FrameworkCommon.hide(settingsPage.container.find('[elem="tblContainer"] [elem="table"]')),FrameworkCommon.show(emptyPageDiv)):(FrameworkCommon.hide(emptyPageDiv),FrameworkCommon.show(settingsPage.container.find('[elem="tblContainer"] [elem="table"]')))},defaultActions:function(){StreamsNew.constructListObj.container.find("[elem=streamRow]").off("click").on("click",event=>{StreamsNew.Filter.close(),window.location.href=Layout.Page.hash+"/view-recordId:"+$(event.target).closest("[elem=streamRow]").attr("streamid")}),StreamsNew.constructListObj.container.find("[elem=streamRow] [elem=moreElem]").off().on("click",StreamsNew.openPopover),StreamsNew.constructListObj.container.find('[elem="memCnt"]').off("click").on("click",StreamsNew.onClickMemberCount),ZPeopleComponents.popover(StreamsNew.constructListObj.container.find("[elem=streamRow] [elem=descMorePopover]"),{appendTo:StreamsNew.constructListObj.container,position:"bottom",className:"zpl_popovr",isContentHTMLEncoded:!0}),StreamsNew.constructListObj.container.find("[elem=streamDeleteIcon]").off("click").on("click",StreamsNew.confirmDelete)},openPopover:event=>{event.stopPropagation(),StreamsNew.Filter.close();let currPopOverObj=StreamsNew.constructListObj.container.find("[elem=descMorePopover][id="+$(event.target).attr("popoverid")+"]");ZPeopleComponents.popover(currPopOverObj).setAttribute("forElement",$(event.target)),ZPeopleComponents.popover(currPopOverObj).open()},confirmDelete:event=>{event.stopPropagation();let streamId=$(event.target).closest("tr").attr("streamId"),msg=ZPI18N.getString("zp.fielddeletemsg",[ZSEC.Encoder.encodeForHTML($(event.target).closest("tr").find("[elem=streamName]").text())])+" "+ZPI18N.getString("zp.deleteconfirm"),props={callback:()=>{let params={mode:"deleteRecords",recordIds:streamId,formId:StreamsNew.formId};ZPeople.Request.send("formAction.zp",params,StreamsNew.deleteCallback,{streamId:streamId})}};FrameworkCommon.showDoubleDeleteAlert("",msg,props)},deleteCallback:(data,params,others)=>{data.hasOwnProperty("errObj")&&null!=data.errObj&&data.errObj.length>0?$.each(data.errObj,function(k,v){if(v.error)return ZPeople.Message.failure(v.error),!1}):(StreamsNew.constructListObj.container.find('[elem=streamRow][streamId="'+others.streamId+'"]').remove(),ZPeople.Message.success(ZPI18N.getString("zp.recorddeletedsuccessfully")),0==StreamsNew.constructListObj.container.find("[elem=streamRow]:visible").length&&StreamsNew.showHideNodata(!0))},resetCount:()=>{FrameworkCommon.show(StreamsNew.constructListObj.container.find("[elem=getCount]")),FrameworkCommon.hide(StreamsNew.constructListObj.container.find("[elem=count]"))},getCount:()=>{StreamsNew.constructListObj.container.find("[elem=getCount]").addClass("disabled");let params={};StreamsNew.Filter.alterParams(params),ZPeople.Request.sendRequestWithVersion("/streams/count",params,"GET",(data,params,others)=>{if(data)if(data.hasOwnProperty("streamErr")&&"displayErrorMsgStream"==data.streamErr)StreamsNew.constructListObj.container.find('[elem="btnMnu"]').addClass("DNI"),StreamsNew.showHideNodata(!0,!0);else if(data.hasOwnProperty("count")&&data.count>=0){let countDiv=StreamsNew.constructListObj.container.find("[elem=count]");countDiv.text(data.count),FrameworkCommon.hide(StreamsNew.constructListObj.container.find("[elem=getCount]")),FrameworkCommon.show(countDiv)}StreamsNew.constructListObj.container.find("[elem=getCount]").removeClass("disabled")},{},(data,params,others)=>{StreamsNew.constructListObj.container.find("[elem=getCount]").removeClass("disabled")})},destroyComponents:()=>{$.each(StreamsNew.constructListObj.container.find("[elem=streamRow] [elem=descMorePopover]"),(ind,elem)=>{ComponentsCommon.safeDestroyZComponent("popover",$(elem)),$(elem).remove()})},Filter:{savedVals:{name:"",designations:[]},isEmpty:()=>""==StreamsNew.Filter.savedVals.name&&0==StreamsNew.Filter.savedVals.designations.length,init:data=>{if(!(StreamsNew.constructListObj.container.find("[elem=filterCont]").length>0)&&data&&data.hasOwnProperty("filterDetails")&&data.filterDetails.length>0){let filterHtml='<div class="zpl_fltr" elem="filterCont"><div><div class="zpl_fltrhd"><h5>'+ZPI18N.getString("zp.filter")+'</h5><i class="PI_cls" elem="closeFilter"></i></div></div>';filterHtml+='<div class="zpl_fltrcnt"><div><div class="zpl_fltclps fltopn"><div class="zpl_fltrlst" elem="filterList"></div></div></div></div>',filterHtml+='<div><button elem="applyFilter" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.apply")+'</button><button elem="resetFilter" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.reset")+"</button></div></div>",StreamsNew.constructListObj.container.append(filterHtml),StreamsNew.constructListObj.container.find("[elem=filterCont] [elem=filterList]").html(ZPeople.LOADING_HTML);let filtersHtml="";data.filterDetails.forEach(filter=>{let zfctype="";filter.fcType==FormConstants.FieldType.LOOKUP&&(zfctype="tokenfield"),filtersHtml+='<div class="zpl_secn" elem="'+filter.labelName+'"><div><label>'+filter.dispName+"</label></div>",filtersHtml+='<div><input fcId="'+filter.fcId+'" zfctype="'+zfctype+'" elem="'+filter.labelName+'" placeholder="'+ZPI18N.getString(filter.placeholderKey)+'" type="text" class="ztextbox"></div>',filtersHtml+="</div>"}),StreamsNew.constructListObj.container.find("[elem=filterCont] [elem=filterList]").html(filtersHtml),StreamsNew.constructListObj.container.find("[elem=filterCont] [zfctype=tokenfield]").each((ind,elem)=>{let fcId=$(elem).attr("fcid"),dataMapping={dataSource:{search:queryParams=>new Promise(function(search,reject){let respObj={},term=queryParams.query,page=queryParams.pages;ZPeople.Request.send("/formAction.zp",{mode:"fetchFormLookupOtions",searchtxt:term,startInd:page,formId:StreamsNew.formId,luFcIds:JSON.stringify([fcId]),isPermBasedListNotNeeded:!0,isfilternotneeded:!0,isRelatedLookup:!1},data=>{let results=[];data.hasOwnProperty("message")&&data.message.hasOwnProperty(fcId)&&data.message[fcId].length>0&&(results=data.message[fcId]),results&&results.length>0&&results.forEach(designation=>{designation.Value=decodeHTML(designation.Value)}),search(respObj={results:results,more:!1})})})},serverSearch:!0,lazyLoading:!0,sortBy:"Value",dataMapping:{id:"Id",value:"Id",text:"Value",title:"Value"},dropdownList:{contentType:"text",sortResults:!0,fitForElement:!0,height:"335px"},tokens:{contentType:"text"},randomDropdownListId:!0,search:{minKeywordLength:0,highlightKeyword:!0,delay:20,showNoResultsMessage:!0},messages:{noResults:ZPI18N.getString("zp.noresults"),remove:ZPI18N.getString("zp.remove")}};ZPeopleComponents.tokenfield($(elem),dataMapping)}),StreamsNew.constructListObj.container.find("[elem=filterCont] [elem=Name] input").off("change").on("change",event=>{FrameworkCommon.removeError($(event.target)),$(event.target).val().trim().length>100&&FrameworkCommon.showError(ZPI18N.getString("zp.descriptioncharlimit",["100"]),$(event.target))}),StreamsNew.constructListObj.container.find("[elem=filterCont] [elem=applyFilter]").off("click").on("click",StreamsNew.Filter.apply),StreamsNew.constructListObj.container.find("[elem=filterCont] [elem=resetFilter]").off("click").on("click",StreamsNew.Filter.reset),StreamsNew.constructListObj.container.find("[elem=filterCont] [elem=closeFilter]").off("click").on("click",StreamsNew.Filter.close)}},restoreValues:()=>{if(StreamsNew.constructListObj.container.find("[elem=filterCont] input[elem=Name]").val(StreamsNew.Filter.savedVals.name),StreamsNew.constructListObj.container.find("[elem=filterCont] input[elem=Designations]").length>0){ZPeopleComponents.tokenfield(StreamsNew.constructListObj.container.find("[elem=filterCont] input[elem=Designations]")).removeAllTokens();let dsgs=[...StreamsNew.Filter.savedVals.designations];ZPeopleComponents.tokenfield(StreamsNew.constructListObj.container.find("[elem=filterCont] input[elem=Designations]")).setAttribute("values",dsgs)}},open:()=>{StreamsNew.Filter.hideBreadCrums(),StreamsNew.Filter.restoreValues(),StreamsNew.constructListObj.container.addClass("zpl_fltr_flt")},close:()=>{FrameworkCommon.removeError(StreamsNew.constructListObj.container.find("[elem=filterCont] [elem=Name] input")),StreamsNew.constructListObj.container.removeClass("zpl_fltr_flt"),StreamsNew.Filter.showBreadCrums()},isOpen:()=>StreamsNew.constructListObj.container.hasClass("zpl_fltr_flt"),resetValues:()=>{StreamsNew.Filter.close(),StreamsNew.Filter.savedVals.name="",StreamsNew.Filter.savedVals.designations=[]},reset:skipNoChangeCheck=>{1!=skipNoChangeCheck&&StreamsNew.Filter.isEmpty()?ZPeople.Message.warning(ZPI18N.getString("zp.nochangesmade")):(StreamsNew.Filter.resetValues(),StreamsNew.Filter.close(),StreamsNew.Filter.hideBreadCrums(),FrameworkCommon.hide(StreamsNew.constructListObj.container.find("[elem=tblContainer]")),FrameworkCommon.hide(StreamsNew.constructListObj.container.find("[elem=emptyDivCont]")),StreamsNew.constructListObj.isFromForms||(StreamsNew.constructListObj.isResetNeeded=!0),StreamsNew.constructListObj.listSettingsConfObj.fireScrollProps.fireScrollObj.recordCount=0,StreamsNew.resetCount(),StreamsNew.initPage())},alterParamsForExport:params=>{if(StreamsNew.constructListObj.container.find("[elem=filterCont]").length<=0)return;let searchParam=[],name=StreamsNew.constructListObj.container.find("[elem=filterCont] input[elem=Name]").val();if(""!=name){let nameObj={Name:name,Name_op:"26"};searchParam.push(nameObj)}if(StreamsNew.constructListObj.container.find("[elem=filterCont] input[elem=Designations]").length>0){let dsgIds=[],dsgFlags=[],dsgs=[];if(ZPeopleComponents.tokenfield(StreamsNew.constructListObj.container.find("[elem=filterCont] input[elem=Designations]")).getAllValues().forEach(data=>{dsgIds.push(data.Id),dsgFlags.push(1),dsgs.push(data.Value)}),dsgs.length>0){let dsgObj={Designations_ids:dsgIds,Designations_idFlag:dsgFlags,Designations:dsgs.join(";"),Designations_op:"26"};searchParam.push(dsgObj)}}searchParam.length>0&&(searchParam=JSON.stringify(searchParam),params.searchBy=searchParam)},alterParams:params=>{if(StreamsNew.constructListObj.container.find("[elem=filterCont]").length<=0)return;let name=StreamsNew.constructListObj.container.find("[elem=filterCont] input[elem=Name]").val();if(""!=name&&(params.streamName=name),StreamsNew.constructListObj.container.find("[elem=filterCont] input[elem=Designations]").length>0){let dsgs=[];ZPeopleComponents.tokenfield(StreamsNew.constructListObj.container.find("[elem=filterCont] input[elem=Designations]")).getAllValues().forEach(data=>{dsgs.push(data.Id)}),dsgs.length>0&&(params.designationIds=JSON.stringify(dsgs))}},apply:skipNoChangeCheck=>{let nameDiv=StreamsNew.constructListObj.container.find("[elem=filterCont] input[elem=Name]");FrameworkCommon.removeError($(nameDiv));let name=$(nameDiv).val();if((name=(name=void 0==name?"":name).trim()).length>100)return void FrameworkCommon.showError(ZPI18N.getString("zp.descriptioncharlimit",["100"]),$(nameDiv));let hasDsg=StreamsNew.constructListObj.container.find("[elem=filterCont] input[elem=Designations]").length>0,dsgs=[],savedDsgs=[];if(hasDsg){ZPeopleComponents.tokenfield(StreamsNew.constructListObj.container.find("[elem=filterCont] input[elem=Designations]")).getAllValues().forEach(data=>{dsgs.push(data.Id),savedDsgs.push({Id:data.Id,Value:data.Value})})}let noChanges=name==StreamsNew.Filter.savedVals.name.trim();if(hasDsg&&(dsgs.length==StreamsNew.Filter.savedVals.designations.length?StreamsNew.Filter.savedVals.designations.forEach(savedObj=>{dsgs.includes(savedObj.Id)||(noChanges=!1)}):noChanges=!1),1!=skipNoChangeCheck&&noChanges)return void ZPeople.Message.warning(ZPI18N.getString("zp.nochangesmade"));StreamsNew.constructListObj.container.append(ZPeople.LOADING_HTML),StreamsNew.Filter.savedVals.name=name,hasDsg&&(StreamsNew.Filter.savedVals.designations=savedDsgs),StreamsNew.constructListObj.listSettingsConfObj.fireScrollProps.fireScrollObj.recordCount=0,FrameworkCommon.hide(StreamsNew.constructListObj.container.find("[elem=tblContainer]")),FrameworkCommon.hide(StreamsNew.constructListObj.container.find("[elem=emptyDivCont]"));let params={startIndex:1};""!=name&&(params.streamName=name),hasDsg&&dsgs.length>0&&(params.designationIds=JSON.stringify(dsgs)),StreamsNew.Filter.close(),StreamsNew.Filter.hideBreadCrums(),StreamsNew.Filter.isEmpty()?StreamsNew.Filter.reset(!0):(FrameworkCommon.show(StreamsNew.constructListObj.container.find("[elem=addElemBtn]")),StreamsNew.resetCount(),ZPeople.Request.sendRequestWithVersion("/streams/list",params,"GET",(data,params,others)=>{StreamsNew.constructListObj.container.find("[elem=tblContainer]").remove(),StreamsNew.constructListObj.listSettingsConfObj.isFromFilter=!0,StreamsNew.constructListObj.listSettingsConfObj.successCallback(data,params,StreamsNew.constructListObj.listSettingsConfObj),StreamsNew.constructListObj.listSettingsConfObj.isFromFilter=!1}))},onResize:isInit=>{if(StreamsNew.resizeTimer||StreamsNew.Filter.isOpen())return;let timer=isInit&&"boolean"==typeof isInit?0:400;StreamsNew.resizeTimer=setTimeout(function(){let bcDiv=StreamsNew.constructListObj.container.find("[elem=breadCrumsDiv]"),morePopover=bcDiv.find("[elem=morePopup]");ZPeopleComponents.isComponent(morePopover)&&ZPeopleComponents.popover(morePopover).close(),morePopover.remove(),StreamsNew.Filter.handleBreadCrums();let totalWidth=(bcDiv=StreamsNew.constructListObj.container.find("[elem=breadCrumsDiv]")).outerWidth(),leftWidth=bcDiv.find("[elem=breadCrums]").outerWidth(),threshold=totalWidth-(bcDiv.find("[elem=bcClear]").outerWidth()+25);StreamsNew.constructListObj.container.find("[elem=breadCrums] li[elem=morePopupLi]").remove(),StreamsNew.constructListObj.container.find("[elem=morePopup]");let moreLi=$('<li elem="morePopupLi" class="zpl_mre"><i class="PI_more d-flex"></i></li>'),popoverDiv=$('<div elem="morePopup" class="zpl_drpdwn zpl_fltrvwlst zmenu zmenu--iconwithtext"></div>');if(threshold<leftWidth){ComponentsCommon.safeDestroyZComponent("popover",popoverDiv);let filterList=bcDiv.find("[elem=breadCrums]"),isMoreShow=!1,popover='<ul data-body="true">',eleWidth=44;if($.each(filterList.find("li"),(ind,li)=>{(eleWidth+=12+$(li).outerWidth())>=threshold&&"morePopupLi"!=$(li).attr("elem")&&(popover+=$(li)[0].outerHTML,$(li).remove(),isMoreShow=!0)}),popover+="</ul>",isMoreShow&&(popoverDiv.html(popover),popoverDiv.find("[elem=removeBc]").off("click").on("click",StreamsNew.Filter.removeOnBreadCrums),bcDiv.append(popoverDiv),bcDiv.find("[elem=breadCrums]").append(moreLi),ZPeopleComponents.popover(popoverDiv),ZPeopleComponents.popover(popoverDiv).setAttribute("forElement",moreLi),ZPeopleComponents.popover(popoverDiv).setAttribute("position","bottom-left"),moreLi.off("click").on("click",()=>{ZPeopleComponents.popover(popoverDiv).open()}),popoverDiv.find("[name=AllDsgs]").length>0)){let popDiv=popoverDiv.find("[elem=moreDsgs]"),dsgPop=StreamsNew.constructListObj.container.find("[elem=moreDsgPop]");ZPeopleComponents.popover(dsgPop),ZPeopleComponents.popover(dsgPop).setAttribute("forElement",popDiv),ZPeopleComponents.popover(dsgPop).setAttribute("position","bottom-left"),popDiv.off("click").on("click",()=>{ZPeopleComponents.popover(dsgPop).open()})}}StreamsNew.resizeTimer=void 0},timer)},destroyFilterBCPopups:()=>{ComponentsCommon.safeDestroyZComponent("popover",StreamsNew.constructListObj.container.find("[elem=moreDsgPop]")),ComponentsCommon.safeDestroyZComponent("popover",StreamsNew.constructListObj.container.find("[elem=breadCrumsDiv] [elem=morePopup]")),StreamsNew.constructListObj.container.find("[elem=moreDsgPop]").remove(),StreamsNew.constructListObj.container.find("[elem=breadCrumsDiv] [elem=morePopup]").remove()},handleBreadCrums:()=>{StreamsNew.Filter.destroyFilterBCPopups(),StreamsNew.constructListObj.container.find("[elem=breadCrumsDiv]").remove();let breadCrum="";breadCrum+='<div elem="breadCrumsDiv" class="zpl_fltrvw">',breadCrum+='<div><ul elem="breadCrums" class="zpl_fltrvwlst"></ul></div>',breadCrum+='<div elem="bcClear" class="d-flexcap MLauto"><a class="zpl_link">'+ZPI18N.getString("zp.clearAll")+"</a></div>",breadCrum+="</div>",StreamsNew.constructListObj.container.find("[elem=btnMnu]").after(breadCrum);let breadCrumbs=StreamsNew.constructListObj.container.find('[elem=breadCrumsDiv] [elem="breadCrums"]');if(""!=StreamsNew.Filter.savedVals.name&&breadCrumbs.append('<li elem="bcList" title="'+ZSEC.Encoder.encodeForHTML(StreamsNew.Filter.savedVals.name.trim())+'" name="Name"><label>'+ZPI18N.getString("zp.streamname")+" :</label><span>"+ZSEC.Encoder.encodeForHTML(StreamsNew.Filter.savedVals.name)+'</span><a class="PI_cls" elem="removeBc"></a></li>'),StreamsNew.Filter.savedVals.designations.length>0){hasFilter=!0;let dsgs=[],dsgIds=[];if(StreamsNew.Filter.savedVals.designations.forEach(dsg=>{dsgs.push(ZSEC.Encoder.encodeForHTML(dsg.Value)),dsgIds.push(dsg.Id)}),1==StreamsNew.Filter.savedVals.designations.length)breadCrumbs.append('<li elem="bcList" dsgId="'+dsgIds+'" title="'+dsgs+'" name="AllDsgs"><label>'+ZPI18N.getString("zp.designations")+" :</label><span>"+dsgs+'</span><a class="PI_cls" elem="removeBc"></a></li>');else{breadCrumbs.append('<li elem="bcList" name="AllDsgs"><label>'+ZPI18N.getString("zp.designations")+' :</label><span class="zpl_w100">'+dsgs+'</span><sub elem="moreDsgs" class="zpl_drpdwn-js">'+StreamsNew.Filter.savedVals.designations.length+' </sub><a class="PI_cls" elem="removeBc"></a></li>');let moreDsgs="";dsgs.forEach((dsg,ind)=>{moreDsgs+='<li elem="bcList" dsgId="'+dsgIds[ind]+'" title="'+dsg+'" name="Designations"><span>'+dsg+'</span><a class="PI_cls" elem="removeBc"></a></li>'}),StreamsNew.constructListObj.container.append('<div elem="moreDsgPop" class="zpl_popovr zpl_fltrvw-popovr zpopover"><ul class="zpl_fltrvwlst" data-body="true">'+moreDsgs+"</ul></div>");let popDiv=breadCrumbs.find("[elem=moreDsgs]"),popoverDiv=StreamsNew.constructListObj.container.find("[elem=moreDsgPop]");popoverDiv.find("[elem=removeBc]").off("click").on("click",StreamsNew.Filter.removeOnBreadCrums),ZPeopleComponents.popover(popoverDiv),ZPeopleComponents.popover(popoverDiv).setAttribute("forElement",popDiv),ZPeopleComponents.popover(popoverDiv).setAttribute("position","bottom-left"),popDiv.off("click").on("click",()=>{ZPeopleComponents.popover(popoverDiv).open()})}}breadCrumbs.find("[elem=bcList]").length>0?($(window).on("resize",StreamsNew.Filter.onResize),StreamsNew.constructListObj.container.find("[elem=breadCrumsDiv] [elem=removeBc]").off("click").on("click",StreamsNew.Filter.removeOnBreadCrums),StreamsNew.constructListObj.container.find("[elem=breadCrumsDiv] [elem=bcClear]").off("click").on("click",StreamsNew.Filter.reset)):StreamsNew.constructListObj.container.find("[elem=breadCrumsDiv]").remove()},removeOnBreadCrums:event=>{StreamsNew.Filter.hideBreadCrums(),StreamsNew.constructListObj.container.find("[elem=breadCrums] [elem=morePopupLi]").length>0&&ZPeopleComponents.popover(StreamsNew.constructListObj.container.find("[elem=breadCrumsDiv] [elem=morePopup]")).close();let hasDsg=StreamsNew.constructListObj.container.find("[elem=filterCont] input[elem=Designations]").length>0,elem=$(event.target).parents("[elem=bcList]"),name=elem.attr("name");if("Name"==name)StreamsNew.constructListObj.container.find("[elem=filterCont] input[elem=Name]").val("");else if(hasDsg&&"AllDsgs"==name)ZPeopleComponents.tokenfield(StreamsNew.constructListObj.container.find("[elem=filterCont] input[elem=Designations]")).removeAllTokens();else if(hasDsg&&"Designations"==name){let dsgId=elem.attr("dsgId");for(let i=0;i<StreamsNew.Filter.savedVals.designations.length;i++){if(StreamsNew.Filter.savedVals.designations[i].Id==dsgId){StreamsNew.Filter.savedVals.designations.splice(i,1);break}}StreamsNew.Filter.restoreValues()}StreamsNew.Filter.destroyFilterBCPopups(),StreamsNew.Filter.apply(!0)},showBreadCrums:()=>{FrameworkCommon.show(StreamsNew.constructListObj.container.find("[elem=breadCrumsDiv]"))},hideBreadCrums:()=>{FrameworkCommon.hide(StreamsNew.constructListObj.container.find("[elem=breadCrumsDiv]"))}}};class StreamsFormHandler extends ModuleHandler{constructor(formClassObj){super(formClassObj)}close(){return StreamsNew.constructListObj.isFromForms=!0,"settings/service/accountsetup/streams"}singleFieldEditCallback(data,params,isModified){StreamsNew.constructListObj.isFromForms=!0,StreamsNew.constructListObj.isResetNeeded=!0}successCallback(resultData,params){StreamsNew.constructListObj.isFromForms=!0,StreamsNew.constructListObj.isResetNeeded=!0}}let ZPCloseOrg={};ZPCloseOrg.Page=function(){function fetch(url,params,isGet,isTimeOutNeeded){return new Promise(function(resolve,reject){isGet?ZPeople.Request.sendRequest(url,params,"GET",resolve,{},reject):ZPeople.Request.send(url,params,resolve,{},reject),isTimeOutNeeded&&setTimeout(function(){reject("Something went wrong!")},5e3)})}let isDataBackupDone=!1,isDataBackupAllowed=!1,errors={};const id="ZPCloseOrg";let modal;const components={sliderHdr:function(){return`<h4>${ZPI18N.getString("zp.closeaccount")}</h4><a id="sliderCls" class="_cls PI_cls" title="${ZPI18N.getString("zp.close")}"></a>`},sliderFtr:function(){return`<button type="button" id="sliderSbt" class="zlabel zlabel--red zlabel--medium">${ZPI18N.getString("zp.closeaccount")}</button><button type="button" id="sliderCancel" class="zlabel zlabel--outline zlabel--medium">${ZPI18N.getString("zp.close")}</button>`},sliderMainWrapper:function(){return`<div class="zpl_mmnu"><div class="zpl_mmnurgt"><div class="zpl_act" id="${id}_mainWrp"></div></div>`}},util_showCloseOrgBtn=()=>{void 0!==modal&&void 0!==modal.footerDiv&&modal.footerDiv.find("#sliderSbt").removeClass("disabled")};function construct(modal){if(modal.tab.cardIdDiv.find("#"+id+"_mainWrp").length>0)return;modal.tab.cardIdDiv.append(components.sliderMainWrapper());let mainWrp=modal.tab.cardIdDiv.find("#"+id+"_mainWrp");isDataBackupDone=errors.ZPC00&&errors.ZPC00.isCompleted,ZPCloseOrg.Components.dataBackUp.construct($(`<div class="zpl_crd" id="${id+"_ZPC00"}">`).appendTo(mainWrp),isDataBackupAllowed,isDataBackupDone);for(let error in errors)ZPCloseOrg.Components[error]&&ZPCloseOrg.Components[error].construct($(`<div class="zpl_crd ${!isDataBackupDone||errors[error].isCompleted?"disabled":""}" id="${id+"_"+error}">`).appendTo(mainWrp),errors[error])}function handleCloseErrors(errorObj){errorObj?(errorObj.ZPC00&&!errorObj.ZPC00.isCompleted?ZPeople.Message.failure(ZPI18N.getString("zp.closeorg.backupstatus")):ZPeople.Message.failure(ZPI18N.getString("zp.closeorg.followsteps")),destroyComponents(),modal.tab.cardIdDiv.empty(),errors=errorObj,construct(modal)):ZPeople.Message.failure(ZPI18N.getString("zp.closeorg.somthingwentwrong"))}async function closeOrg(modal){modal.footerDiv.find("#sliderSbt").addClass("disabled");try{let response=await validate(),close=async function(){if(!await ZPCloseOrg.Components.uiComponents.closeOrgAlert("closeOrgAlertBox"))return;let response=await fetch("/org/closeOrg",{});response.isClosed?(closeModalCallback(),window.location.href=window.location.origin):handleCloseErrors(response.errors)};response.canClose?await close():handleCloseErrors(response.errors)}catch(e){}finally{modal.footerDiv.find("#sliderSbt").removeClass("disabled")}}async function validate(){let data=await fetch("/org/validateOrgClosing",{});return data.errors&&(errors=data.errors),isDataBackupAllowed=data.isBackupAllowed,data}function destroyComponents(){ZPCloseOrg.Components.dataBackUp.destroy();for(let error in errors)ZPCloseOrg.Components[error]&&"function"==typeof ZPCloseOrg.Components[error].destroy&&ZPCloseOrg.Components[error].destroy()}function closeModalCallback(){destroyComponents(),modal.remove()}return{init:async function(){isSuperAdmin&&(errors={},modal=function(){let closeOrgFullPageModal=new sliderModal(id,new Tab(id,construct,closeOrg));return closeOrgFullPageModal.fullPageSize=!0,closeOrgFullPageModal.setContainerAsBody(!0),closeOrgFullPageModal.setCloseCallback(closeModalCallback),modal=closeOrgFullPageModal,closeOrgFullPageModal}(),await validate(),modal.construct(components.sliderHdr(),components.sliderFtr()),modal.sliderDiv.addClass("closeacc"),$("#"+modal.tab.id).data("closeCallback",closeModalCallback),modal.open())},fetch:fetch,setDataBackupStatus:function(status){isDataBackupDone=status,status&&function(){for(let error in errors)errors[error].isCompleted||$("#"+modal.tab.id).find("#"+id+"_"+error).removeClass("disabled")}()},reAuthRejectCallback:function(){util_showCloseOrgBtn()}}}(),ZPCloseOrg.Components={ZPC01:{construct:function(wrapper,data){let ele=$(`<div class="zpl_crdhdr"><div><h4>${ZPI18N.getString("zp.closeorg.userswillbedisabled")}</h4><p>${ZPI18N.getString("zp.closeorg.userswillbedisabledmsg")}</p></div>${data.isCompleted?'<div><div class="zpl_atosv"><div class="zpl_atocnt svd"><div class="zpl_atoprg"><div></div><div></div><div></div><div></div><div></div></div><i class="PI_tick2"></i> <span id="svloading">Completed</span></div></div></div>':""}</div><div class="zpl_crdcnt"><div class="zpl_secn zpl_delcount"><span><label>${ZPI18N.getString("zp.users")}</label><label class="zpl_usrcls blu" data-popup-open="teammeaImg">${data.user}</label></span>${data.nonuser?`<span><label>${ZPI18N.getString("zp.employeeProfiles")}</label><label class="blu">${data.nonuser}</label></span>`:""}</div><div class="zpl_secn"><div><div class="zcheckbox ${data.isCompleted?"disabled":""} zpl_mtry"><input id="disableUserCheckBox" type="checkbox" name="check" class="zcheckbox__helper"  ${data.isCompleted?'checked="checked"':""}"><label for="disableUserCheckBox" class="zcheckbox__label">${ZPI18N.getString("zp.closeorg.userswillbedisabledack")}</label></div></div></div></div>`);ele.find("#disableUserCheckBox").on("change",async function(){if($(this).is(":checked")){$(this).attr("disabled",!0);let rslt={};try{rslt=await ZPCloseOrg.Page.fetch("org/acknowledgeDisableAllUsers",{},!1,!0)}catch(err){}if(rslt.success)return wrapper.addClass("disabled"),void wrapper.find(".zpl_crdhdr").append('<div><div class="zpl_atosv"><div class="zpl_atocnt svd"><div class="zpl_atoprg"><div></div><div></div><div></div><div></div><div></div></div><i class="PI_tick2"></i> <span id="svloading">Completed</span></div></div></div>');$(this).attr("disabled",!1),$(this).prop("checked",!1)}}),wrapper.append(ele)}},ZPC02:{construct:function(wrapper,data){let card=$(`<div class="zpl_crdhdr"><div><h4>${ZPI18N.getString("zp.moveplan")}</h4><p>${ZPI18N.getString("zp.movedtofreeplan")}</p></div>${data.isCompleted?'<div><div class="zpl_atosv"><div class="zpl_atocnt svd"><div class="zpl_atoprg"><div></div><div></div><div></div><div></div><div></div></div><i class="PI_tick2"></i> <span id="svloading">Completed</span></div></div></div>':""}</div><div class="zpl_crdcnt"><div class="zpl_secn"><div><label>${ZPI18N.getString("zp.clickheretomovetofreeplan")}</label></div></div><div class="zpl_secn"><div class="zpl_idiv">${data.isPaid?`<div class="zlabel zlabel--yellow zlabel--outline zlabel--medium" onclick="SubscriptionDetails.openStore()">${ZPI18N.getString("zp.managesubscription")}</div>`:`<button type="button" id="freePlan" class="zlabel zlabel--blue zlabel--medium">${ZPI18N.getString("zp.freeplan")}</button>`}</div></div></div>`);card.find("#freePlan").on("click",async function(){await ZPCloseOrg.Components.uiComponents.openConfirmationDialog("freeplanpopup","",ZPI18N.getString("zp.closeorg.freeplan"))&&SubscriptionDetails.changeToFreeVersion()}),wrapper.append(card)}},ZPC03:{construct:function(wrapper,data){ZPCloseOrg.Components.uiComponents.getBundleErrorHtml(wrapper,ZPI18N.getString("zp.zohoOne"),"support@zohoone.com",data)}},ZPC04:{construct:function(wrapper,data){ZPCloseOrg.Components.uiComponents.getBundleErrorHtml(wrapper,ZPI18N.getString("zp.peoplePlus"),Layout.ppSupportEmail,data)}},ZPC05:{setDefaultOrg:async function(defaultOrg,wrapper){if(defaultOrg&&""!=defaultOrg){if(await ZPCloseOrg.Components.uiComponents.openConfirmationDialog("defaultOrgConfirmationPopup","",ZPI18N.getString("zp.moMakeDefault"))){(await ZPCloseOrg.Page.fetch("/org/markAsDefaultOrg",{method:"markAsDefaultOrg",zsoid:defaultOrg})).isDef&&(wrapper.addClass("disabled"),ZPeople.Message.success(ZPI18N.getString("zp.moDefOrgchanged")),wrapper.find(".zpl_crdhdr").append('<div><div class="zpl_atosv"><div class="zpl_atocnt svd"><div class="zpl_atoprg"><div></div><div></div><div></div><div></div><div></div></div><i class="PI_tick2"></i> <span id="svloading">Completed</span></div></div></div>'))}}else ZPeople.Message.failure(ZPI18N.getString("zp.closeorg.selectorg"))},construct:function(wrapper,data){let ele=$(`<div class="zpl_crdhdr"><div><h4>${ZPI18N.getString("zp.organizationSetup")}</h4><p>${ZPI18N.getString("zp.changecurrentorg")}</p></div>${data.isCompleted?'<div><div class="zpl_atosv"><div class="zpl_atocnt svd"><div class="zpl_atoprg"><div></div><div></div><div></div><div></div><div></div></div><i class="PI_tick2"></i> <span id="svloading">Completed</span></div></div></div>':""}</div><div class="zpl_crdcnt">${data.isCompleted?"":`<div class="zpl_secn"><div><label>${ZPI18N.getString("zp.organization")}</label></div><div><select id="ZPCloseOrg-selectDefaultOrg"class="select-js w400" style="display: none;"></select></div></div>`}<div class="zpl_secn"><div class="zpl_idiv"><button type="button" id="ZPCloseOrg-setDefaultOrg" class="zlabel zlabel--blue zlabel--medium">${ZPI18N.getString("zp.moSetDefault")}</button></div></div></div>`);data.isCompleted||function(ele,data){let options=data.orgDetails.serviceOrgs.filter(serviceOrg=>!serviceOrg.isDefaultOrg).map(serviceOrg=>({label:serviceOrg.orgName,value:serviceOrg.ZSOID}));ZPeopleComponents.select(ele.find("#ZPCloseOrg-selectDefaultOrg")),ZPeopleComponents.select(ele.find("#ZPCloseOrg-selectDefaultOrg")).addOption(options)}(ele,data);let context=this;ele.find("#ZPCloseOrg-setDefaultOrg").on("click",function(){context.setDefaultOrg(ZPeopleComponents.select(ele.find("#ZPCloseOrg-selectDefaultOrg")).getValue(),wrapper)}),wrapper.append(ele)},destroy:function(){ZPeopleComponents.select("#ZPCloseOrg-selectDefaultOrg")&&ZPeopleComponents.select("#ZPCloseOrg-selectDefaultOrg").destroy(),$(document.body).find("#ZPCloseOrg_ZPC05").remove()}},dataBackUp:{construct:async function(wrapper,isDataBackupAllowed,isDataBackupDone){let ele=$(`<div class="zpl_crdhdr"> <div><h4>${ZPI18N.getString("zp.backup")}</h4><p>${isDataBackupDone?ZPI18N.getString("zp.databackuptaken"):isDataBackupAllowed?ZPI18N.getString("zp.closeorg.databackavailable"):ZPI18N.getString("zp.closeorg.databacknotavailable")}</p></div>${isDataBackupDone?'<div><div class="zpl_atosv"><div class="zpl_atocnt svd"><div class="zpl_atoprg"><div></div><div></div><div></div><div></div><div></div></div><i class="PI_tick2"></i> <span id="svloading">Completed</span></div></div></div>':""}</div><div class="zpl_crdcnt"><div class="zpl_secn">${isDataBackupAllowed?`<div class="zpl_idiv"><button type="button" class="zlabel zlabel--blue zlabel--medium" id="dataBackup">${ZPI18N.getString("zp.backup")}</button></div>`:""}<div><div class="zcheckbox ${isDataBackupDone?"disabled":""} zpl_mtry"><input id="dataBackupCheckBox" type="checkbox" name="check" class="zcheckbox__helper"  ${isDataBackupDone?'checked="checked"':""}"><label for="dataBackupCheckBox" class="zcheckbox__label">${ZPI18N.getString("zp.closeorg.ackbackup")}</label></div></div></div></div>`);ele.find("#dataBackupCheckBox").on("change",async function(){if($(this).is(":checked")){if(!await ZPCloseOrg.Components.uiComponents.openConfirmationDialog("ackwnogementAlert",ZPI18N.getString("zp.closeorg.irreversableaction"),ZPI18N.getString("zp.closeorg.ackbackupalert")))return void $(this).prop("checked",!1);$(this).attr("disabled",!0);let rslt={};try{rslt=await ZPCloseOrg.Page.fetch("org/acknowledgeCloseOrgDataBackup",{},!1,!0)}catch(err){}rslt.success?(ZPCloseOrg.Page.setDataBackupStatus(!0),wrapper.find(".zpl_crdhdr").append('<div><div class="zpl_atosv"><div class="zpl_atocnt svd"><div class="zpl_atoprg"><div></div><div></div><div></div><div></div><div></div></div><i class="PI_tick2"></i> <span id="svloading">Completed</span></div></div></div>')):($(this).attr("disabled",!1),$(this).prop("checked",!1))}}),ele.find("#dataBackup").on("click",function(){window.location.hash="#operations/dataadministration/databackup"}),wrapper.append(ele)},constructList(adminDetails,ele){if(adminDetails.isSuccess){let superAdminErecno,options=[];for(let admin in adminDetails.adminsList){let empDets=adminDetails.adminsList[admin];options.push({label:empDets.empId+" - "+empDets.name,informativeText:empDets.mailId,image:empDets.photo,value:empDets.erecno}),empDets.hasOwnProperty("isSuperAdmin")&&empDets.isSuperAdmin&&(superAdminErecno=empDets.erecno)}let selectProps={contentType:"image-text-desc",dataMapping:{value:"value",label:"label",image:"image",informativeText:"informativeText",title:"label"},dropdownList:{contentType:"image-text-desc"}};selectProps.messages={noResults:ZPI18N.getString("zp.nouserstotransferadminrights")},selectProps.search={by:["label","informativeText"]},selectProps.options=options,selectProps.showSearchField=options.length>4,selectProps.selectedValue=superAdminErecno,selectProps.multiple=!0,ZPeopleComponents.select(ele,selectProps)}},destroy:function(){}},uiComponents:{getBundleErrorHtml:function(wrapper,bundleName,email,data){return wrapper.append(`<div class="zpl_crdhdr"><div><h4>${ZPI18N.getString("zp.bundleorg",[bundleName])}</h4><p>${ZPI18N.getString("zp.bundleorgaccount",[bundleName])}</p></div>${data.isCompleted?'<div><div class="zpl_atosv"><div class="zpl_atocnt svd"><div class="zpl_atoprg"><div></div><div></div><div></div><div></div><div></div></div><i class="PI_tick2"></i> <span id="svloading">Completed</span></div></div></div>':""}</div><div class="zpl_crdcnt"><div class="zpl_secn"><div><label>${ZPI18N.getString("zp.bundleorgcontactsupport",[email])}</label></div></div></div></div>`)},handlePopup:function(ele,id,hasCheckBox=!1,errorMsg){return new Promise(resolve=>{ele.find("#cls_btn,#cancel_btn").on("click",function(){Layout.Page.container.find("#"+id).remove(),resolve(!1)}),ele.find("#submit_btn").on("click",function(){if(hasCheckBox){if(!ele.find("#"+id+"_checkbox").is(":checked"))return void ZPeople.Message.failure(errorMsg)}Layout.Page.container.find("#"+id).remove(),resolve(!0)}),Layout.Page.container.append(ele)})},openConfirmationDialog:function(id,header,msg){let popup=$(`<div class="zpl_mdl zpl_malrtmsg zpl_mopen" id="${id}"><div class="zpl_minr"><a class="_cls PI_cls" id="cls_btn"></a><div class="zpl_mcnt"><div class="alert_contain"><i class="ico info"></i><div class="cont"><h3>${header}</h3><p>${msg}</p></div></div></div><div class="zpl_mfoter"><button id="submit_btn" type="button" class="zlabel zlabel--yellow zlabel--medium MR10">${ZPI18N.getString("zp.confirm")}</button><button type="button" class="zlabel zlabel--outline zlabel--medium" id="cancel_btn">${ZPI18N.getString("zp.cancel")}</button></div></div></div>`);return this.handlePopup(popup,id)},closeOrgAlert:function(id){let popup=$(`<div class="zpl_mdl zpl_malrtmsg zpl_mopen" id="${id}"><div class="zpl_minr"><a class="_cls PI_cls" id="cls_btn"></a><div class="zpl_mcnt"><div class="alert_contain"><i class="ico delete"></i><div class="cont"><h3>${ZPI18N.getString("zp.closeorg.areyousure")}</h3><p class="zpl_mcenter zpl_w-90">${ZPI18N.getString("zp.closeorg.closeorgalert")}</p><div class="zcheckbox zpl_mcenter zpl_mt6 zpl_txtlft zpl_w-90"><input id="${id+"_checkbox"}" type="checkbox" name="check" class="zcheckbox__helper"><label for="${id+"_checkbox"}" class="zcheckbox__label">${ZPI18N.getString("zp.closeorg.finalack")}</label></div></div></div></div><div class="zpl_mfoter"><button id="submit_btn" type="button" class="zlabel zlabel--red zlabel--medium MR10">${ZPI18N.getString("zp.confirm")}</button><button type="button" class="zlabel zlabel--outline zlabel--medium" id="cancel_btn">${ZPI18N.getString("zp.cancel")}</button></div></div></div>`);return this.handlePopup(popup,id,!0,ZPI18N.getString("zp.closeorg.finalackerror"))}}};