var NewCalendar={PrevPosX:null,PrevPosY:null,currrentDate:new Date,curYear:(new Date).getFullYear(),curMonth:(new Date).getMonth(),curDate:(new Date).getDate(),weekfromdate:new Date,weektodate:new Date,monthfromdate:new Date,monthtodate:new Date,daydate:null,tmpMonth:null,tmpYear:null,leaveErecNo:null,daysObj:{empty:"",weekend:"Cl-wked",day:"zpcaldays",today:"Cl-today",leave:"zpcalholi"},calObj:function(){this.curYear=null,this.curMonth=null,this.calcontId=null,this.outerdivId=null,this.daysObj=null,this.divid=null,this.callback=null,this.mode=null,this.tdonclick=null,this.totaldata=null},jumpToSelectedDate:function(calObj){this.constructCalendar(calObj)},initCalendar:function(calObj){var outerClass="";"/hr"===ZPeople.CONTEXT&&(-1!==Layout.Page.currentmode.indexOf("/calendarview")||-1!==Layout.Page.currentmode.indexOf("/views/calendar")||-1!==Layout.Page.currentmode.indexOf("/timelogscalendarview")?outerClass="ZPcalmtp":-1!==Layout.Page.currentmode.indexOf("/dashboard/calendar")&&(outerClass="ZPcalvw-dash"));var cont=Layout.Page.container.find("#"+calObj.outerdivId);cont.addClass(outerClass);var calendarHTML=NewCalendar.Template.getCalendarHTML(calObj.calcontId,!1,calObj);cont.find("#"+calObj.divid).html(calendarHTML);var rarrClass=calObj.prearrow,larrClass=calObj.nextarrow;cont.find("."+larrClass).off("click"),cont.find("."+larrClass).on("click",function(){NewCalendar.nextMonth(calObj)}),cont.find("."+rarrClass).off("click"),cont.find("."+rarrClass).on("click",function(){NewCalendar.previousMonth(calObj)});var datepicker=calObj.datepickerClass;if(datepicker){let pickerType=calObj.datepickerMode?calObj.datepickerMode:"month";cont.find("."+datepicker).off("click"),cont.find("."+datepicker).on("click",function(event){"week"==pickerType?Calendar.setUpCalendar(event,this,void 0,void 0,function(tmpdate,currentObj,pickerObj){NewCalendar.choosedWeek(tmpdate,calObj)},void 0,{weekselection:!0}):Calendar.setUpCalendar(event,this,2,void 0,function(tmpdate,currentObj,pickerObj){NewCalendar.choosedMonth(tmpdate,calObj)})})}this.constructCalendar(calObj),cont.find("#"+calObj.divid).show()},constructCalendar:function(calObj){this.clearOldvalues(calObj,3);var mode=calObj.mode,currentUserId=NewCalendar.getCurrentUserErecno(mode),startDate=new Date(calObj.curYear,calObj.curMonth),endDate=new Date(new Date(calObj.curYear,calObj.curMonth+1)-1),param={mode:"GET_WEEKEND_DEFINITION",fromDate:Calendar.formatDate(startDate),toDate:Calendar.formatDate(endDate),userErecNo:currentUserId,userLocation:ZPeople.getUserDetailsById(currentUserId).locId,conreqcsr:csrfToken};$.post("/commonAction.zp",param,function(resultData){var fdayofmonth=Calendar.getFirstDayofMonth(calObj.curYear,calObj.curMonth);(fdayofmonth-=Number(weekstarts))<0&&(fdayofmonth+=7);var ndayofmonth=Calendar.daysInMonth(calObj.curYear,calObj.curMonth),cont=Layout.Page.container.find("#"+calObj.outerdivId);cont.find("#calmonth").html(months[calObj.curMonth]+" "+calObj.curYear),cont.find("#calmonthnew").html(months[calObj.curMonth]+" "+calObj.curYear);var tmpmonth=calObj.curMonth;tmpmonth++;var monthlist=cont.find(".zpmon");$(monthlist[0]).html(calObj.curYear),cont.find(".zpmonsel").hasClass("zpmon zpmonsel")?cont.find(".zpmonsel").removeClass("zpmon zpmonsel"):cont.find(".zpmonsel").addClass("zpmon zpmonsel"),$(monthlist[tmpmonth]).hasClass("zpmon zpmonsel")?$(monthlist[tmpmonth]).removeClass("zpmon zpmonsel"):$(monthlist[tmpmonth]).addClass("zpmon zpmonsel");var hrsspent="Total Hours";hrsspent=hrsspent.replace("<0>",months[calObj.curMonth]+" "+calObj.curYear),cont.find("#caltotmont").html(hrsspent);var tdlist=cont.find("#"+calObj.divid).find(".ZPcalvw-box.ZPcalvw-month-view").find("#moncal_body").find("td.findday,td."+NewCalendar.daysObj.day+",td."+NewCalendar.daysObj.today+",td."+NewCalendar.daysObj.weekend+",td."+NewCalendar.daysObj.leave),startcal=!1,cal=1,i=0,row=1;for("feedcalendar"===mode&&tdlist.removeAttr("date"),i=0;i<tdlist.length;i++)if(i!=fdayofmonth||startcal||(startcal=!0),startcal&&cal<=ndayofmonth){if(row=i%7==0?i/7:row,"addjobcalendar"===mode)tdlist[i].innerHTML=cal,$(tdlist[i]).attr("date",calObj.curMonth+1+"-"+cal+"-"+calObj.curYear);else if("feedcalendar"===mode)tdlist[i].innerHTML='<div class="ZPcalvw-month-day"><span>'+cal+'</span></div><a class="ZPcalvw-addbtn"><i class="PI_plus"></i></a>',$(tdlist[i]).attr("date",calObj.curMonth+1+"-"+cal+"-"+calObj.curYear);else if("leave"!==mode||LVUtil.urls.OnLeave.isHome())if("timesheet"===mode){calObj.curYear,calObj.curMonth;Timetracker.util.allowAddingTimelogs()?tdlist[i].innerHTML='<div class="ZPcalvw-month-day"><span>'+cal+'</span></div><a class="ZPcalvw-addbtn" title="'+ZPI18N.getString("zp.logtime")+'"><i class="PI_plus"></i></a>':tdlist[i].innerHTML='<div class="ZPcalvw-month-day"><span>'+cal+"</span></div>",$(tdlist[i]).attr("date",calObj.curMonth+1+"-"+cal+"-"+calObj.curYear)}else if("dashboardcal"===mode){calObj.curYear,calObj.curMonth;tdlist[i].innerHTML='<div class="ZPcalvw-month-day"><span>'+cal+'</span></div><a class="ZPcalvw-addbtn"><i class="PI_plus"></i></a>',$(tdlist[i]).attr("date",calObj.curMonth+1+"-"+cal+"-"+calObj.curYear)}else{calObj.curYear,calObj.curMonth;tdlist[i].innerHTML='<div class="ZPcalvw-month-day ZPcalvw-month-daynot"><span>'+cal+"</span></div>",$(tdlist[i]).attr("date",calObj.curMonth+1+"-"+cal+"-"+calObj.curYear)}else{calObj.curYear,calObj.curMonth;tdlist[i].innerHTML='<div class="ZPcalvw-month-day"><span>'+cal+'</span></div><a class="ZPcalvw-addbtn" title="'+ZPI18N.getString("zp.leave.apply")+'"><i class="PI_plus"></i></a>',$(tdlist[i]).attr("date",calObj.curMonth+1+"-"+cal+"-"+calObj.curYear)}var currentDate=calObj.curYear+"-"+Attendance.disTwoDigit(calObj.curMonth+1)+"-"+Attendance.disTwoDigit(cal);tdlist[i].ldata=cal,tdlist[i].mdata=calObj.curMonth,tdlist[i].ydata=calObj.curYear;var className="";cal+""==curdate+""&&curmonth+""==calObj.curMonth+""&&curyear+""==calObj.curYear+""?className=className+" "+NewCalendar.daysObj.today:$(tdlist[i]).hasClass("zpcaltotal")||(className=className+" "+NewCalendar.daysObj.day),void 0!==resultData.weekendArray&&-1!==resultData.weekendArray.indexOf(currentDate)&&(className=className+" "+NewCalendar.daysObj.weekend),tdlist[i].className=className,cal++,28==i&&$(Layout.Page.container.find("#"+calObj.outerdivId).find("#moncal_body").find("tbody").children().get(4)).show(),35==i&&$(Layout.Page.container.find("#"+calObj.outerdivId).find("#moncal_body").find("tbody").children().get(5)).show()}else tdlist[i].className="findday",28==i&&$(Layout.Page.container.find("#"+calObj.outerdivId).find("#moncal_body").find("tbody").children().get(4)).hide(),35==i&&$(Layout.Page.container.find("#"+calObj.outerdivId).find("#moncal_body").find("tbody").children().get(5)).hide();$(tdlist).find(".ZPcalvw-addbtn").on("click",function(event){var date=$(this).parents("td").attr("date");ZPCal.Calendar.showAddpopUp(event,$(this),date,calObj)}),calObj.callback&&"function"==typeof calObj.callback&&calObj.callback(calObj),Layout.Page.container.find("#monthcalendarhead,#monthcalendarbody").removeClass("DN"),Layout.Page.container.find("#zp_page_loading").remove()})},nextMonth:function(calObj){var month=calObj.curMonth,year=calObj.curYear;11==month?(calObj.curMonth=0,calObj.curYear=year+1):calObj.curMonth=month+1,this.constructCalendar(calObj)},previousMonth:function(calObj){var month=calObj.curMonth,year=calObj.curYear;0==month?(calObj.curMonth=11,calObj.curYear=year-1):calObj.curMonth=month-1,this.constructCalendar(calObj)},choosedMonth:function(tmpdate,calObj){if(tmpdate){let date=new Date(tmpdate);calObj.curMonth=date.getMonth(),calObj.curYear=date.getFullYear()}NewCalendar.constructCalendar(calObj)},populateData:function(calObj,resultData){var pageId=Layout.Page.container.find("#"+calObj.outerdivId);pageId.find(".ZPcalvw-month-view").scrollTop(0);var trlist=pageId.find("#moncal_body").find("tr");calObj.totaldata?($.each(trlist,function(trindex,data){var datatd=$(trlist.get(trindex)).find("td."+NewCalendar.daysObj.day+",td."+NewCalendar.daysObj.today+",td."+NewCalendar.daysObj.weekend+",td."+NewCalendar.daysObj.leave),totaltd=$(trlist.get(trindex)).find("td.zpcaltotal");$.each(datatd,function(tdindex,data){$(datatd.get(tdindex)).data("objval","0");var dataEle=$(datatd.get(tdindex)).children().children(":eq(0)").nextAll();$(dataEle).remove()}),$(totaltd.get(0)).data("objval","0")}),pageId.find(".zpcaltotal,.zpcaltxt,.zpcalgtotal,.zpcaltot").show()):($.each(trlist,function(trindex,data){var datatd=$(trlist.get(trindex)).find("td."+NewCalendar.daysObj.day+",td."+NewCalendar.daysObj.today+",td."+NewCalendar.daysObj.weekend+",td."+NewCalendar.daysObj.leave);$.each(datatd,function(tdindex,data){$(datatd.get(tdindex)).data("objval","0");var dataEle=$(datatd.get(tdindex)).children().children(":eq(0)").nextAll();$(dataEle).remove()})}),pageId.find(".zpcaltotal,.zpcaltxt,.zpcalgtotal,.zpcaltot").hide());var tdlist=pageId.find("#moncal_body").find("td."+NewCalendar.daysObj.day+",td."+NewCalendar.daysObj.today+",td."+NewCalendar.daysObj.weekend+".td."+NewCalendar.daysObj.leave);if($.each(resultData,function(index,data){if(calObj.totaldata&&$(tdlist.get(data.date-1)).data("objval",data.objval),"1"==data.type)$(tdlist.get(data.date-1)).addClass(NewCalendar.daysObj.leave),$(tdlist.get(data.date-1)).removeClass(NewCalendar.daysObj.day);else if(""!==data.txt){var dataEle=$(tdlist.get(data.date-1));let txt=data.txt;if(showNewTab&&LVUtil.Tab.isCalendar()&&data.recordid){if((txt=$(txt)).hasClass("ZPcalvw-lk"))txt.attr("href",LVUtil.urls.setModeOfViewInUrl("/summary-mode:calendar/recordId")+":"+data.recordid);else if(txt.hasClass("zpl_shftdts")&&!txt.hasClass("zpl_absntBgbdr"))for(let i=0;i<txt.length;i++){let ele=$(txt[i]);ele.attr("isabsent")||ele.attr("onclick","window.location.href='"+LVUtil.urls.setModeOfViewInUrl("/summary-mode:calendar/recordId")+":"+ele.attr("recordId")+"'")}data.isabsent||$(dataEle).find(".ZPcalvw-addbtn").remove()}$(dataEle).find(".ZPcalvw-month-day").after(txt)}}),calObj.totaldata){var grandtotal=0;$.each(trlist,function(trindex,data){var datatd=$(trlist.get(trindex)).find("td."+NewCalendar.daysObj.day+",td."+NewCalendar.daysObj.today+",td."+NewCalendar.daysObj.weekend+",td."+NewCalendar.daysObj.leave),totaltd=$(trlist.get(trindex)).find("td.zpcaltotal"),totaltime=0;$.each(datatd,function(tdindex,data){var ldata=$(datatd.get(tdindex)).data();ldata.objval?totaltime+=Number(ldata.objval):$(datatd.get(tdindex)).data("objval","")}),grandtotal+=totaltime,$(totaltd.get(0)).data("objval",totaltime),$(totaltd.get(0)).html('<div class="MT50" align="center">'+Calendar.minstohrs(totaltime)+"</div>")});var gtotaltd=pageId.find("#calbody").find("td.zpcalgtotal");$(gtotaltd.get(0)).html('<div class="MT50" align="center">'+Calendar.minstohrs(grandtotal)+"</div>")}ZPCal.Calendar.showAttInfoPopUp(calObj)},addPopHasHrs:null,calculateTop:function(isFromAdd,top,allPosAttr,altervalue){if(!0===isFromAdd)0!==$("#hoursdiv").length&&null!==$("#hoursdiv").height()||(top+=60,NewCalendar.addPopHasHrs=!1),null!==$("#timelog_hours_time").length&&0!==$("#timelog_hours_time").length||(top+=30);else if("none"!==Layout.Page.container.find("#hoursdiv").css("display")&&void 0!==Layout.Page.container.find("#hoursdiv").css("display")||"#mdialog"!==allPosAttr.id||(top+=65),"#mdialogview"===allPosAttr.id){top=allPosAttr.posY-250+altervalue}return top},cellPopPosition:function(allPosAttr){var left,top,cls,top_adjust=23,down_adjust=30,altervalue=20,altervalue2=0,altervalue3=0;1==ZPCal.Calendar.isDashboardCal()&&"#mdialog"===allPosAttr.id&&(top_adjust-=35,down_adjust+=25,altervalue=0,altervalue2=60,altervalue3=15);ZPeople.isZPNewUI?($("#zp_maintabs").width(),$("#zp_dash_left_panel").width()):($("#zpeople_tabs_container").width(),$("#zp_dash_left_panel").width());var w_width=$(window).width(),w_height=$(window).height();allPosAttr.posY+allPosAttr.heightpop<=w_height?(top=allPosAttr.posY,allPosAttr.posX+allPosAttr.widthpop<=w_width?(left=allPosAttr.posX-24,top=top+top_adjust-altervalue3,cls="ZPCmn-Arrow top lt gray"):(left=allPosAttr.posX-allPosAttr.widthpop-15,top=top-top_adjust-altervalue2-altervalue3,cls="ZPCmn-Arrow right tp gray")):(top=allPosAttr.posY-allPosAttr.heightpop,allPosAttr.posX+allPosAttr.widthpop<=w_width?(left=allPosAttr.posX-24,cls="ZPCmn-Arrow bottom lt gray",(top=top-down_adjust+altervalue)<=0&&(top=(top=allPosAttr.posY)+top_adjust-altervalue3,cls="ZPCmn-Arrow top lt gray")):(left=allPosAttr.posX-allPosAttr.widthpop-15,cls="ZPCmn-Arrow right bm gray",(top=top+down_adjust-altervalue2)<=0&&(top=(top=allPosAttr.posY)-top_adjust-altervalue2-altervalue3,cls="ZPCmn-Arrow right tp gray"))),Layout.Page.container.find(allPosAttr.id).css({left:left,top:top}),Layout.Page.container.find(allPosAttr.id).addClass(cls)},calPlusPosition:function(curObject){Layout.Page.container.find("#error_message").remove();var posX=$(curObject).offset().left,posY=$(curObject).offset().top;NewCalendar.removeArrowClasses("#mdialog"),Layout.Page.container.find("#calpluspop2").modal("show");var widthpop=Layout.Page.container.find("#mdialog").width();Layout.Page.container.find("#mdialog").height();var allPosAttr={id:"#mdialog"};allPosAttr.widthpop=widthpop,allPosAttr.heightpop=335,allPosAttr.posX=posX,allPosAttr.posY=posY,NewCalendar.cellPopPosition(allPosAttr)},bannerHtCalc:function(){return $("#peoplebanner").is(":visible")?$("#peoplebanner").height():0},removeArrowClasses:function(id){var layoutadd=Layout.Page.container.find(id);layoutadd.removeClass("ZPCmn-Arrow top lt gray"),layoutadd.removeClass("ZPCmn-Arrow left tp gray"),layoutadd.removeClass("ZPCmn-Arrow bottom lt gray"),layoutadd.removeClass("ZPCmn-Arrow right tp gray"),layoutadd.removeClass("ZPCmn-Arrow right bm gray")},commonPositionSet:function(allPosAttr){void 0!=allPosAttr.globalposX&&void 0!=allPosAttr.globalposY&&(Layout.Page.container.find(allPosAttr.id).css({left:allPosAttr.globalposX+100,top:allPosAttr.globalposY-100}),allPosAttr.posY=allPosAttr.globalposY-10,allPosAttr.posX=allPosAttr.globalposX,NewCalendar.cellPopPosition(allPosAttr))},initWeekCalendar:function(calObj){Layout.Page.container.find("#"+calObj.divid).hide();var pageId=Layout.Page.container.find("#"+calObj.outerdivId),calendarHTML='<div id="weekcal" class="ZPcalvw">'+NewCalendar.Template.getCalendarHTML(calObj.calcontId,!0,calObj)+"</div>";pageId.find("#"+calObj.divid).html(calendarHTML);var outerClass="";-1!==Layout.Page.currentmode.indexOf("/dashboard/calendar")&&(outerClass="ZPcalvw-dash"),pageId.addClass(outerClass);var rarrClass=calObj.prearrow,larrClass=calObj.nextarrow;pageId.find("."+larrClass).off("click"),pageId.find("."+larrClass).on("click",function(){NewCalendar.nextWeek(calObj)}),pageId.find("."+rarrClass).off("click"),pageId.find("."+rarrClass).on("click",function(){NewCalendar.previousWeek(calObj)}),this.constructWeekCalendar(calObj)},constructWeekCalendar:function(calObj){this.clearOldvalues(calObj,2);var pageId=Layout.Page.container.find("#"+calObj.outerdivId),fromdateft=new Date(calObj.curWeek.from.getFullYear(),calObj.curWeek.from.getMonth(),calObj.curWeek.from.getDate()),todateft=new Date(calObj.curWeek.to.getFullYear(),calObj.curWeek.to.getMonth(),calObj.curWeek.to.getDate());pageId.find("#calmonth").html("<a href='javascript:;'>"+moment(fromdateft).format(dateFmt.toUpperCase())+"&nbsp;&nbsp;&nbsp;"+ZPI18N.getString("zp.sto")+"&nbsp;&nbsp;&nbsp;"+moment(todateft).format(dateFmt.toUpperCase())+"</a>"),pageId.find(".ZP-weekcol .ZP-calline").html(""),pageId.find(".ZP-topcol").html(""),pageId.find(".contenttxt").remove();var mode=calObj.mode,currentUserId=NewCalendar.getCurrentUserErecno(mode),weekDays=calObj.curWeek.from;if(1==calObj.initweekend){var param={mode:"GET_WEEKEND_DEFINITION",fromDate:Calendar.formatDate(calObj.curWeek.from),toDate:Calendar.formatDate(calObj.curWeek.to),userErecNo:currentUserId,userLocation:ZPeople.getUserDetailsById(currentUserId).locId,conreqcsr:csrfToken};$.post("/commonAction.zp",param,function(resultData){for(var i=0;i<7;i++){var dateObj=new Date(weekDays),currentDate=dateObj.getFullYear()+"-"+Attendance.disTwoDigit(dateObj.getMonth()+1)+"-"+Attendance.disTwoDigit(dateObj.getDate());void 0!==resultData.weekendArray&&-1!==resultData.weekendArray.indexOf(currentDate)&&($(pageId.find("#weekcal .ZPcalvw-box-head .ZPcalvw-box-dayheader")[i+1]).addClass(NewCalendar.daysObj.weekend),$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-daynoti-hd")[i+1]).addClass(NewCalendar.daysObj.weekend),$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[i+1]).addClass(NewCalendar.daysObj.weekend)),$(pageId.find("#weekcal .ZPcalvw-box-head .ZPcalvw-box-dayheader")[i+1]).html("<span><small>"+ZPDateTime.days[dateObj.getDay()]+"</small>"+dateObj.getDate()+"</span>"),curdate+""==dateObj.getDate()+""&&curmonth+""==dateObj.getMonth()+""&&($(pageId.find("#weekcal .ZPcalvw-box-head .ZPcalvw-box-dayheader")[i+1]).addClass("Cl-today"),$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-daynoti-hd")[i+1]).addClass("Cl-today"),$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[i+1]).addClass("Cl-today")),$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[i+1]).attr("date",dateObj.getMonth()+1+"-"+dateObj.getDate()+"-"+dateObj.getFullYear()),weekDays.setDate(weekDays.getDate()+1)}$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")).on("click",function(event){ZPCal.Calendar.showAddpopUp(event,$(this),$(this).attr("date"),calObj)}),weekDays.setDate(weekDays.getDate()-7)})}else{for(var i=0;i<7;i++){var dateObj=new Date(weekDays);$(pageId.find("#weekcal .ZPcalvw-box-head .ZPcalvw-box-dayheader")[i+1]).html("<span><small>"+ZPDateTime.days[dateObj.getDay()]+"</small>"+dateObj.getDate()+"</span>"),curdate+""==dateObj.getDate()+""&&curmonth+""==dateObj.getMonth()+""&&($(pageId.find("#weekcal .ZPcalvw-box-head .ZPcalvw-box-dayheader")[i+1]).addClass("Cl-today"),$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-daynoti-hd")[i+1]).addClass("Cl-today"),$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[i+1]).addClass("Cl-today")),$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[i+1]).attr("date",dateObj.getMonth()+1+"-"+dateObj.getDate()+"-"+dateObj.getFullYear()),weekDays.setDate(weekDays.getDate()+1)}$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")).on("click",function(event){ZPCal.Calendar.showAddpopUp(event,$(this),$(this).attr("date"),calObj)}),weekDays.setDate(weekDays.getDate()-7)}calObj.callback&&"function"==typeof calObj.callback&&calObj.callback(calObj)},populateWeekCalendar:function(calObj,resultData){var pageId=Layout.Page.container.find("#"+calObj.outerdivId);pageId.find(".ZPcalvw-box-scroller").scrollTop(0);for(var currDay,weekDays=calObj.curWeek.from,i=0;i<7;i++){var dateObj=new Date(weekDays),currentDate=dateObj.getFullYear()+"-"+Attendance.disTwoDigit(dateObj.getMonth()+1)+"-"+Attendance.disTwoDigit(dateObj.getDate());void 0!==calObj.weekendarray&&-1!==calObj.weekendarray.indexOf(currentDate)&&($(pageId.find("#weekcal .ZPcalvw-box-head .ZPcalvw-box-dayheader")[i+1]).addClass(NewCalendar.daysObj.weekend),$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-daynoti-hd")[i+1]).addClass(NewCalendar.daysObj.weekend),$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[i+1]).addClass(NewCalendar.daysObj.weekend),curdate+""==dateObj.getDate()+""&&curmonth+""==dateObj.getMonth()+""||$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[i+1]).find("#curr_time").remove()),curdate+""==dateObj.getDate()+""&&curmonth+""==dateObj.getMonth()+""&&(currDay=$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[i+1])),weekDays.setDate(weekDays.getDate()+1)}weekDays.setDate(weekDays.getDate()-7);for(var index=0;index<resultData.length;index++){var data=resultData[index];if(void 0!==data.jobs){var notiList="",count=1;for(var job in data.jobs){job=data.jobs[job];var jobHrs=Calendar.minstohrs(job.jobHrs).split(":");notiList+='<div class="ZPcalvw-box-label '+(count>2?"DN":"")+'"><div class="ZPcalvw-box-label-txt"> <span>'+job.jobName+"</span>"+(void 0!==jobHrs?" <span>"+jobHrs[0]+"h "+jobHrs[1]+"m</span>":"")+"</div> </div>",count++}$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-daynoti .ZPcalvw-box-daynoti-hd")[index+1]).find(".ZPcalvw-box-daynoti-box").prepend(notiList),void 0!==data.jobs&&Object.keys(data.jobs).length>2&&$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-daynoti .ZPcalvw-box-daynoti-hd")[index+1]).append('<div class="ZPcalvw-morebox"> <a class="ZPcalvw-morebtn" id="timlog_morebtn"><span>'+(Object.keys(data.jobs).length-2)+"</span>more</a> </div>"),$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-mainbox .ZPcalvw-box-bg-timegd").find("td")[index+1]).prepend(data.txt)}else $(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-mainbox .ZPcalvw-box-bg-timegd").find("td")[index+1]).prepend(data.txt);if($(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-mainbox .ZPcalvw-box-bg-timegd").find("td")[index+1]).find(".ZPcalvw-box-main-wkdayltbox").length>0){var childlen=$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-mainbox .ZPcalvw-box-bg-timegd").find("td")[index+1]).find(".ZPcalvw-box-main-wkdayltbox").children().length,classname=2;1==childlen?classname="":2==childlen?classname=2:3==childlen?classname=3:4==childlen?classname=4:5==childlen?classname=5:childlen>5&&(classname=5),$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-mainbox .ZPcalvw-box-bg-timegd").find("td")[index+1]).find(".ZPcalvw-box-main-wkdayltbox").addClass("ZPcalvw-box-col"+classname)}void 0!==data.attHead&&$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-daynoti .ZPcalvw-box-daynoti-hd")[index+1]).append('<h6 class="ZPcalvwbox-head">'+data.attHead+"</h6>"),void 0!==data.isFullColor&&($(pageId.find("#weekcal .ZPcalvw-box-head .ZPcalvw-box-dayheader")[index+1]).addClass(data.isFullColor),$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-daynoti-hd")[index+1]).addClass(data.isFullColor),$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[index+1]).addClass(data.isFullColor))}if(0==pageId.find("#timlog_morebtn").length?pageId.find("#showAllWkHdrbtn").addClass("DN"):pageId.find("#showAllWkHdrbtn").removeClass("DN"),pageId.find("#showAllWkHdrbtn").off("click").removeClass("active"),pageId.find("[id='timlog_morebtn']").on("click",function(){NewCalendar.showHideWeekHeader(calObj,$(this))}),pageId.find("#showAllWkHdrbtn").on("click",function(){NewCalendar.showAllWkHeader(calObj,$(this))}),pageId.find("#"+calObj.divid).show(),pageId.find(".ZPcalvw-box-scroller").css("top",Layout.Page.container.find(".ZPcalvw").height()+(ZPeople.isZPNewUI()?45:40)+"px"),ZPCal.checkIsToday(calObj,"2")&&void 0!==currDay&&currDay.length>0){var curDate=new Date(ZPDateTime.convertToTimezone((new Date).getTime())),scrollTop=60*curDate.getUTCHours()*1.1667+1.1667*curDate.getUTCMinutes();currDay.find("#curr_time").html('<span class="DN">'+ZPDateTime.getDisplayTime(curDate,!Calendar.is12HrFormat())+"</span>"),currDay.find("#curr_time").on("mouseover",function(event){event.stopPropagation(),NewCalendar.showCurrTime(currDay.find("#curr_time"))}),currDay.find("#curr_time").on("mouseleave",function(event){event.stopPropagation(),NewCalendar.showCurrTime(currDay.find("#curr_time"))}),currDay.find("#curr_time").removeClass("DN"),currDay.find("#curr_time").css("top",scrollTop+"px"),this.setCurrTime(pageId,currDay),currDay.find("#curr_time").is(":visible")&&void 0!==currDay.find("#curr_time").offset()&&("selfservice/user/calendar"!==Layout.Page.currentmode?pageId.find(".ZPcalvw-box-scroller").animate({scrollTop:currDay.find("#curr_time").offset().top-400}):Layout.Page.parentContainer.find(".Scrcont").animate({scrollTop:currDay.find("#curr_time").offset().top-400}))}else currDay.find("#curr_time").addClass("DN")},showHideWeekHeader:function(calObj,Obj){var isOpen=!1;if(Obj.parents(".ZPcalvw-box-tdbox").find("#showAllWkHdrbtn").hasClass("active")){Layout.Page.container.find("#"+calObj.outerdivId),Obj.parent().siblings();Obj.parent().hasClass("DN")&&(isOpen=!0,Obj.parents(".ZPcalvw-box-tdbox").find("#showAllWkHdrbtn").removeClass("active"))}else Obj.parents(".ZPcalvw-box-tdbox").find("#showAllWkHdrbtn").addClass("active");1!=isOpen?(Obj.parent().addClass("DN"),$(Obj.parent().siblings(".ZPcalvw-box-daynoti-box")[0]).children().removeClass("DN")):(Obj.parent().removeClass("DN"),Obj.siblings(".ZPcalvw-box-daynoti-box").children().addClass("DN"),$(Obj.siblings(".ZPcalvw-box-daynoti-box").children()[0]).removeClass("DN"),$(Obj.siblings(".ZPcalvw-box-daynoti-box").children()[1]).removeClass("DN")),Layout.Page.container.find(".ZPcalvw-box-scroller").css("top",Layout.Page.container.find(".ZPcalvw").height()+(ZPeople.isZPNewUI()?45:40)+"px")},showAllWkHeader:function(calObj,Obj){var pageId=Layout.Page.container.find("#"+calObj.outerdivId),tdlist=Obj.parent().siblings(),isOpen=!1;Obj.hasClass("active")&&(isOpen=!0);for(var i=0;i<tdlist.length;i++)isOpen?(Obj.removeClass("active"),$(tdlist[i]).find(".ZPcalvw-box-daynoti-box").children().addClass("DN"),$(tdlist[i]).children(".ZPcalvw-morebox").removeClass("DN"),$($(tdlist[i]).find(".ZPcalvw-box-daynoti-box").children()[0]).removeClass("DN"),$($(tdlist[i]).find(".ZPcalvw-box-daynoti-box").children()[1]).removeClass("DN")):(Obj.addClass("active"),$(tdlist[i]).find(".ZPcalvw-box-daynoti-box").children().removeClass("DN"),$(tdlist[i]).children(".ZPcalvw-morebox").addClass("DN"));pageId.find(".ZPcalvw-box-scroller").css("top",Layout.Page.container.find(".ZPcalvw").height()+(ZPeople.isZPNewUI()?45:40)+"px")},setCurrTime:function(pageId,currDay){setInterval(function(){var curDate=new Date(ZPDateTime.convertToTimezone((new Date).getTime())),scrollTop=60*curDate.getUTCHours()*1.1667+1.1667*curDate.getUTCMinutes();void 0==currDay&&(currDay=pageId),currDay.find("#curr_time").html("<span>"+ZPDateTime.getDisplayTime(curDate,!Calendar.is12HrFormat())+"</span>"),currDay.find("#curr_time").css("top",scrollTop+"px")},1e4)},initDayCalendar:function(calObj){var pageId=Layout.Page.container.find("#"+calObj.outerdivId),calendarHTML='<div id="weekcal" class="ZPcalvw">'+(calendarHTML=NewCalendar.Template.getCalendarHTML(calObj.calcontId,!1,calObj))+"</div>";pageId.find("#"+calObj.divid).html(calendarHTML);var rarrClass=calObj.prearrow,larrClass=calObj.nextarrow;pageId.find("."+larrClass).off("click"),pageId.find("."+larrClass).on("click",function(){NewCalendar.nextDay(calObj)}),pageId.find("."+rarrClass).off("click"),pageId.find("."+rarrClass).on("click",function(){NewCalendar.previousDay(calObj)}),this.constructDayCalendar(calObj),$("#"+calObj.divid).show()},populateDayCalendar:function(calObj,resultData){for(var pageId=Layout.Page.container.find("#"+calObj.outerdivId),index=0;index<resultData.length;index++){var data=resultData[index];if($(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-mainbox .ZPcalvw-box-bg-timegd").find("td")[index+1]).prepend(data.txt),$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-mainbox .ZPcalvw-box-bg-timegd").find("td")[index+1]).find(".ZPcalvw-box-main-wkdayltbox").length>0){var childlen=$($("#weekcal .ZPcalvw-box-body .ZPcalvw-box-mainbox .ZPcalvw-box-bg-timegd").find("td")[index+1]).find(".ZPcalvw-box-main-wkdayltbox").children().length,classname="";2==childlen?classname=2:3==childlen?classname=3:4==childlen?classname=4:childlen>4&&(classname=4),$($("#weekcal .ZPcalvw-box-body .ZPcalvw-box-mainbox .ZPcalvw-box-bg-timegd").find("td")[index+1]).find(".ZPcalvw-box-main-wkdayltbox").addClass("ZPcalvw-box-col"+classname)}}var dateObj=calObj.dateObj,currentDate=dateObj.getFullYear()+"-"+Attendance.disTwoDigit(dateObj.getMonth()+1)+"-"+Attendance.disTwoDigit(dateObj.getDate());void 0!==calObj.weekendarray&&-1!==calObj.weekendarray.indexOf(currentDate)?$($($(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[1]).find(".ZPcalvw-box-bgcol")[0])).addClass(NewCalendar.daysObj.weekend):$($($(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[1]).find(".ZPcalvw-box-bgcol")[0])).removeClass(NewCalendar.daysObj.weekend),pageId.find("#"+calObj.divid).show()},nextDay:function(calObj){var month=calObj.curMonth,year=calObj.curYear,date=calObj.curdate;1!==month?0==month||2==month||4==month||6==month||7==month||9==month||11==month?31===date?(calObj.curdate=1,calObj.curMonth=month+1):calObj.curdate=date+1:-1!==month?30===date?(calObj.curdate=1,calObj.curMonth=month+1):calObj.curdate=date+1:-1===month&&(28===date&&year%4==0?calObj.curdate=date+1:29===date?(calObj.curdate=1,calObj.curMonth=month+1):calObj.curdate=date+1):1==month?year%4==0?29==date?(calObj.curdate=1,calObj.curMonth=month+1):calObj.curdate=date+1:28==date?(calObj.curdate=1,calObj.curMonth=month+1):calObj.curdate=date+1:12==month&&(calObj.curMonth=0,calObj.curYear=year+1);var dt=new Date;dt.setFullYear(calObj.curYear,calObj.curMonth,calObj.curdate),calObj.curDay=dt.getDay(),calObj.dateObj=dt,this.constructDayCalendar(calObj)},previousDay:function(calObj){var month=calObj.curMonth,year=calObj.curYear,date=calObj.curdate;1===date?1==month||3==month||5==month||6==month||7==month||8==month||10==month?(calObj.curdate=31,calObj.curMonth=month-1):2==month?(calObj.curdate=year%4==0?29:28,calObj.curMonth=month-1):(calObj.curdate=30,calObj.curMonth=month-1):calObj.curdate=date-1,-1==calObj.curMonth&&(calObj.curMonth=11,calObj.curYear=year-1);var dt=new Date;dt.setFullYear(calObj.curYear,calObj.curMonth,calObj.curdate),calObj.curDay=dt.getDay(),calObj.dateObj=dt,this.constructDayCalendar(calObj)},constructDayCalendar:function(calObj){var pageId=Layout.Page.container.find("#"+calObj.outerdivId);pageId.find(".ZPcalvw-box-scroller").scrollTop(0),this.clearOldvalues(calObj,1);var dateft=new Date(calObj.dateObj.getFullYear(),calObj.dateObj.getMonth(),calObj.dateObj.getDate());if(pageId.find("#calmonth").html("<a href='javascript:;'>"+moment(dateft).format(dateFmt.toUpperCase())+"</a>"),pageId.find("#today_name").text(ZPDateTime.days_long[calObj.curDay]),$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[1]).on("click",function(event){var date=calObj.curMonth+1+"-"+calObj.curdate+"-"+calObj.curYear;ZPCal.Calendar.showAddpopUp(event,$(this),date,calObj)}),1==calObj.initweekend){var fromDate=Calendar.formatDate(calObj.dateObj),mode=calendarObj.mode,currentUserId=NewCalendar.getCurrentUserErecno(mode),param={mode:"GET_WEEKEND_DEFINITION",fromDate:fromDate,toDate:fromDate,userErecNo:currentUserId,userLocation:ZPeople.getUserDetailsById(currentUserId).locId,conreqcsr:csrfToken};$.post("/commonAction.zp",param,function(resultData){var dateObj=calObj.dateObj,currentDate=dateObj.getFullYear()+"-"+Attendance.disTwoDigit(dateObj.getMonth()+1)+"-"+Attendance.disTwoDigit(dateObj.getDate());void 0!==resultData.weekendArray&&-1!==resultData.weekendArray.indexOf(currentDate)?$($($(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[1]).find(".ZPcalvw-box-bgcol")[0])).addClass(NewCalendar.daysObj.weekend):$($($(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td")[1]).find(".ZPcalvw-box-bgcol")[0])).removeClass(NewCalendar.daysObj.weekend)})}if(calObj.callback&&"function"==typeof calObj.callback&&calObj.callback(calObj),pageId.find(".ZPcalvw-box-scroller").css("top",Layout.Page.container.find(".ZPcalvw").height()+(ZPeople.isZPNewUI()?45:40)+"px"),ZPCal.checkIsToday(calObj,"1")){var curDate=new Date(ZPDateTime.convertToTimezone((new Date).getTime())),scrollTop=60*curDate.getUTCHours()*1.1667+1.1667*curDate.getUTCMinutes();pageId.find("#curr_time").html('<span class="DN">'+ZPDateTime.getDisplayTime(curDate,!Calendar.is12HrFormat())+"</span>"),pageId.find("#curr_time").on("mouseover",function(event){event.stopPropagation(),NewCalendar.showCurrTime(pageId.find("#curr_time"))}),pageId.find("#curr_time").on("mouseleave",function(event){event.stopPropagation(),NewCalendar.showCurrTime(pageId.find("#curr_time"))}),pageId.find("#curr_time").css("top",scrollTop+"px"),pageId.find("#curr_time").removeClass("DN"),this.setCurrTime(pageId),pageId.find("#curr_time").is(":visible")&&void 0!==pageId.find("#curr_time").offset()&&pageId.find(".ZPcalvw-box-scroller").animate({scrollTop:pageId.find("#curr_time").offset().top-400})}else pageId.find("#curr_time").addClass("DN")},showCurrTime:function(Obj){$(Obj).find("span").hasClass("DN")?$(Obj).find("span").removeClass("DN"):$(Obj).find("span").addClass("DN")},getCurrentUserErecno:function(mode){return"leave"===mode&&void 0!==Leave.View.SELECTED_USER.id?Leave.View.SELECTED_USER.id:"timesheet"===mode?Timetracker.timelogs.tserecno:"attendance"===mode&&null!==Attendance.Entry.erecno?Attendance.Entry.erecno:"bday"===mode?ZPeople.CURR_USER.usererec:ZPCal.getCurrUser()},clearOldvalues:function(calObj,type,isDataDel){var pageId=Layout.Page.container.find("#"+calObj.outerdivId);if(1==type){var tdlist=$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td"));$.each(tdlist,function(tdindex,data){$(tdlist[tdindex]).html("")})}else if(2==type){tdlist=$(pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-bg-timegd").find("td"));$.each(tdlist,function(tdindex,data){$(tdlist[tdindex]).html(""),$(tdlist[tdindex]).html('<div class="ZPcalvw-box-main-crnttime DN" id="curr_time"></div>'),$(tdlist[tdindex]).removeClass("Cl-today"),$(tdlist[tdindex]).removeClass("Cl-wked"),$(tdlist[tdindex]).removeClass("Cl-hlday")}),tdlist=pageId.find("#weekcal .ZPcalvw-box-body .ZPcalvw-box-daynoti").find("td"),$.each(tdlist,function(tdindex,data){$(tdlist[tdindex]).find(".ZPcalvw-box-daynoti-box").html(""),$(tdlist[tdindex]).find(".ZPcalvw-box-daynoti-box").siblings().remove(),$(tdlist[tdindex]).removeClass("Cl-today"),$(tdlist[tdindex]).removeClass("Cl-wked"),$(tdlist[tdindex]).removeClass("Cl-hlday")}),pageId.find("#weekcal .ZPcalvw-box-head").find(".Cl-today").removeClass("Cl-today"),pageId.find("#weekcal .ZPcalvw-box-head").find(".Cl-wked").removeClass("Cl-wked"),pageId.find("#weekcal .ZPcalvw-box-head").find(".Cl-hlday").removeClass("Cl-hlday")}else if(3==type){tdlist=pageId.find("#"+calObj.divid).find(".ZPcalvw-box.ZPcalvw-month-view").find("#moncal_body").find("td.findday,td."+NewCalendar.daysObj.day+",td."+NewCalendar.daysObj.today+",td."+NewCalendar.daysObj.weekend+",td."+NewCalendar.daysObj.leave+",td.zpcaltotal");$.each(tdlist,function(tdindex,data){1==isDataDel?($(tdlist[tdindex]).find("#timelog_div").remove(),$(tdlist[tdindex]).find(".ZPcalvw-month-item").remove(),$(tdlist[tdindex]).find(".zpl_shftdts").remove(),$(tdlist[tdindex]).hasClass("zpcaltotal")&&$(tdlist[tdindex]).html("")):$(tdlist[tdindex]).html("")})}},inArray:function(str,arr){for(var key in arr){var tempstr=arr[key];if((tempstr=tempstr.toString())==str)return!0}return!1},toggleCalendar:function(mode){"0"===mode?(Layout.Page.container.find("#monthcal").removeClass("DN"),Layout.Page.container.find("#weekcal").addClass("DN")):"1"===mode&&(Layout.Page.container.find("#monthcal").addClass("DN"),Layout.Page.container.find("#weekcal").removeClass("DN"))},getCurrentWeek:function(){var dateobj=new Date(curyear,curmonth,curdate),day=dateobj.getDay(),date=dateobj.getDate();return day<weekstarts&&(date-=7),this.weekfromdate=new Date(curyear,curmonth,curdate),this.weekfromdate.setDate(date-day+weekstarts),this.weektodate=new Date(curyear,curmonth,curdate),this.weektodate.setDate(date-day+6+weekstarts),{from:this.weekfromdate,to:this.weektodate}},getNextWeek:function(tmpDate){return void 0!==tmpDate&&(this.weektodate=tmpDate.to,this.weekfromdate=tmpDate.from),this.weektodate.setDate(this.weektodate.getDate()+7),this.weekfromdate.setDate(this.weekfromdate.getDate()+7),{from:this.weekfromdate,to:this.weektodate}},getPreviousWeek:function(tmpDate){return void 0!==tmpDate&&(this.weektodate=tmpDate.to,this.weekfromdate=tmpDate.from),this.weektodate.setDate(this.weektodate.getDate()-7),this.weekfromdate.setDate(this.weekfromdate.getDate()-7),{from:this.weekfromdate,to:this.weektodate}},nextWeek:function(calObj){for(var days=new Array,tempdate=calObj.curWeek.to,i=0;i<7;i++)tempdate.setDate(tempdate.getDate()+1),days.push(new Date(tempdate));calObj.curWeek.from.setDate(calObj.curWeek.from.getDate()+7),calObj.curWeek.days=days,this.constructWeekCalendar(calObj)},previousWeek:function(calObj){var days=new Array,tempdate=calObj.curWeek.from;tempdate.setDate(tempdate.getDate()-8);for(var i=0;i<7;i++)tempdate.setDate(tempdate.getDate()+1),days.push(new Date(tempdate));calObj.curWeek.to.setDate(calObj.curWeek.to.getDate()-7),calObj.curWeek.from.setDate(calObj.curWeek.from.getDate()-6),calObj.curWeek.days=days,this.constructWeekCalendar(calObj)},choosedWeek:function(tmpdate,calObj){if(tmpdate){var days=new Array;let tempdate=new Date(tmpdate);tempdate.setDate(tempdate.getDate()-8);for(var i=0;i<7;i++)tempdate.setDate(tempdate.getDate()+1),days.push(new Date(tempdate));let date=new Date(tmpdate);calObj.curWeek.to.setDate(date.getDate()-7),calObj.curWeek.from.setDate(date.getDate()-6),calObj.curWeek.days=days}NewCalendar.constructWeekCalendar(calObj)},getCurrentWeekdays:function(){var dateobj=new Date(curyear,curmonth,curdate),day=dateobj.getDay(),date=dateobj.getDate();day<weekstarts&&(date-=7);var weekfromdate=new Date(curyear,curmonth,curdate);weekfromdate.setDate(date-day+weekstarts);var weektodate=new Date(curyear,curmonth,curdate);weektodate.setDate(date-day+6+weekstarts);var weekObj={};weekObj.days=new Array;var tempdate=weekfromdate;weekObj.days.push(new Date(tempdate));for(var i=0;i<6;i++)tempdate.setDate(tempdate.getDate()+1),weekObj.days.push(new Date(tempdate));return weekfromdate.setDate(weekfromdate.getDate()-6),weekObj.weekfromdate=weekfromdate,weekObj.weektodate=weektodate,weekObj}};NewCalendar.Template={getSingleCalendar:function(doubleCal,isWkCal,constructOnWeekstarts){var singCal=this.getOuter("singlecalendardiv",void 0,void 0!==doubleCal);return void 0!==doubleCal?"from"===doubleCal?singCal.find("#header").append(this.getNavigators(!1)):singCal.find("#header").append(this.getNavigators(!0,void 0,!0)):singCal.find("#header").append(this.getNavigators(!0,void 0,void 0,isWkCal)),singCal.find("#calbody").append(this.getDayHeader(constructOnWeekstarts)).append(this.getDates()),singCal.find("#caltimeview").append(this.getTimeOption()),singCal},getDoubleCalendar:function(){var doubleCal=this.getOuter("doublecalendardiv",!0);doubleCal.find("#fromcalendar").find("#header").append(this.getNavigators(!1)),doubleCal.find("#tocalendar").find("#header").append(this.getNavigators(!0,!0));var dayHeader=this.getDayHeader(),dates=this.getDates();return doubleCal.find("#fromcalendar").find("#calbody").append(dayHeader).append(dates),doubleCal.find("#tocalendar").find("#calbody").append(dayHeader).append(dates),doubleCal},getDayHeader:function(constructOnWeekstarts){var html='<tr class="dayslist">';if(constructOnWeekstarts&&weekstarts){for(var day=weekstarts,dayCnt=0;dayCnt<days.length;dayCnt++)html+='<td class="name">'+days[day]+"</td>",day=day>5?0:day+1;return html+"</tr>"}for(var day in days)html+='<td class="name">'+days[day]+"</td>";return html+"</tr>"},getOuter:function(id,isDoubleCal,isSingleforDouble){var outer=$('<div class="ZPcalsha DN" id="'+id+'" style="position: absolute;"></div>'),tableHtml='<table class="ZPUsel" width="100%" cellspacing="0" cellpadding="0" border="0"><tbody id="header"></tbody><tbody id="calbody"></tbody><tbody id="moncalbody" class="mnthView"></tbody><tbody id="yearcalbody" class="yearView"></tbody><tfoot id="caltimeview"></tfoot></table>';return isDoubleCal?outer.append('<div class="zpfcal" id="fromcalendar">'+tableHtml+'</div><div class="zpfcal" id="tocalendar">'+tableHtml+"</div>"):outer.append('<div class="'+(!0!==isSingleforDouble?"zpfcal":"")+'">'+tableHtml+"</div>"),outer},getNavigators:function(isOpr,isRef,isSec,isWkCal){return'<tr class="monnav calnav" id="cal_close"><td colspan="7">'+(isOpr?'<div class="IC-cls gry S13 CP FR MR8" '+(isSec?' onclick="Calendar.hideDoubleCalendar();"></div>':'onclick="Calendar.hideSingleCalendar();"></div>')+(isRef?'<div class="IC-rfesh gry S16 CP FR MR10"></div>':""):"&nbsp;")+'</td></tr><tr class="monnav"><td colspan="7"><div class="PI_alft gry S16 CP FL ML5"></div><span id="calmonth" box="1"></span><div class="PI_argt gry S16 CP FR MR5"></div></td></tr>'},getDates:function(){for(var dates="",i=0;i<7;i++){dates+='<tr class="datelist">';for(var dCnt=0;dCnt<7;dCnt++)dates+='<td class="day"><div class="zpflc"><span class="num">0</span></div></td>';dates+="</tr>"}return dates},getTimeOption:function(){var timeHtml='<tr class="monnav monnav1 DN"><td align="center" colspan="7"><input type="text"  id="hrs" class="form-control" placeholder="HH" maxlength="2"> : <input type="text"  class="form-control" id="minutes" placeholder="MM" maxlength="2"> : ';return"hh:mm a"===timeFormat?timeHtml+='<input type="text"  class="form-control" id="ampm" placeholder="AM" maxlength="2"></td>':timeHtml+='<input type="text"  class="form-control" id="seconds" placeholder="SS" maxlength="2"></td>',timeHtml+"</tr>"},getMonthlyCalendar:function(weekcal,calObj){var i,calhtml="";if(weekcal){for(calhtml+='<div class="ZPcalvw-cnt ZPcalvw-thtd"><div class="ZPcalvw-box zp-Week-view"><table>',calhtml+='<thead class="ZPcalvw-box-head"><tr><td class="ZPcalvw-box-tdbox"><div class="ZPcalvw-box-headrow ZPcalvw-row"> <table> <thead> <tr>',i=0;i<8;i++)calhtml+='<th class="ZPcalvw-box-dayheader '+(0==i?" W60":"")+'"></th>';for(calhtml+="</tr></thead></table></div></td></tr></thead>",calhtml+='<tbody class="ZPcalvw-box-body"><tr><td class="ZPcalvw-box-tdbox">',calhtml+='<div class="ZPcalvw-box-daynoti ZPcalvw-row"> <table> <tbody> <tr>',i=0;i<8;i++)calhtml+='<td class="ZPcalvw-box-daynoti-hd '+(0==i?" W60":"")+'">'+(0==i?' <a class="ZPcalvw-box-daynoti-close" id="showAllWkHdrbtn"> <i class="IC-ar-dwn"></i></a>':'<div class="ZPcalvw-box-daynoti-box"> </div>')+"</td>";for(calhtml+="</tr></tbody></table></div>",calhtml+='<div class="ZPcalvw-box-main ZPcalvw-box-scroller"><div class="ZPcalvw-box-mainbox">',calhtml+='<div class="ZPcalvw-box-bg ZPcalvw-box-bg-timegd"><table><tbody><tr>',i=0;i<8;i++)calhtml+='<td class="'+(0==i?" W60":"")+'"></td>';if(calhtml+="</tr></tbody></table></div>",calhtml+='<div class="ZPcalvw-box-main-slots"> <table> <tbody>',Calendar.is12HrFormat()){for(calhtml+='<tr><td class=" W60"><span>12 '+ZPI18N.getString("zp.am")+"</span></td><td></td></tr>",i=1;i<12;i++)calhtml+="<tr><td><span>"+i+"&nbsp;"+ZPI18N.getString("zp.am")+"</span></td><td></td></tr>";for(calhtml+="<tr><td><span>12 "+ZPI18N.getString("zp.pm")+"</span></td><td></td></tr>",i=1;i<12;i++)calhtml+="<tr><td><span>"+i+"&nbsp;"+ZPI18N.getString("zp.pm")+"</span></td><td></td></tr>"}else for(i=0;i<24;i++)calhtml+="<tr><td><span>"+(i<10?"0"+i:i)+":00&nbsp;</span></td><td></td></tr>";calhtml+="</tbody></table></div>",calhtml+='<div class="ZPcalvw-box-main-wkdaylt"> <table> <tbody> <tr>';for(var k=0;k<8;k++)calhtml+="<td "+(0==k?'class="W60':"")+'><td> <div class="ZPcalvw-box-main-wkdayltbox"></div></td></td>';calhtml+="</tr></tbody></table></div>",calhtml+="</td></tr></tbody>",calhtml+="</div></div>"}else{calhtml+='<div class="ZPcalvw-cnt ZPcalvw-thtd">',calhtml+='<div class="ZPcalvw-month-hd ZPcalvw-row"> <table> <tbody><tr>';for(var day=weekstarts,dayCnt=0;dayCnt<days.length;dayCnt++)calhtml+="<td><small>"+days[day]+"</small></td>",day=day>5?0:day+1;"timesheet"==calObj.mode&&(calhtml+="<td><small>"+ZPI18N.getString("zp.totalhours")+"</small></td>"),calhtml+="</tr> </tbody></table></div>",calhtml+='<div class="ZPcalvw-box ZPcalvw-month-view"><table><tbody class="ZPcalvw-box-body"> <tr> <td class="ZPcalvw-box-tdbox"><div class="ZPcalvw-box-main"> <div class="ZPcalvw-box-mainbox ZPcalvw-row"> <table class="ZPcalvw-month-tb zpl_nocrsor" id="moncal_body"><tbody>';for(var j=0;j<6;j++){for(calhtml+="<tr>",i=0;i<7;i++)calhtml+='<td class="findday"></td>';"timesheet"===calObj.mode&&(calhtml+='<td class="zpcaltotal"></td>'),calhtml+="</tr>"}calhtml+="</tbody></table></div></div></td></tr></tbody></table></div></div>"}return calhtml},getDayCalendar:function(){var calhtml='<div class="ZPcalvw-cnt ZPcalvw-thtd"> <div class="ZPcalvw-box ZPcalvw-today"><table class="ZPcalvw-today-maintb">';if(calhtml+='<thead class="ZPcalvw-box-head"><tr><td class="ZPcalvw-box-tdbox"><div class="ZPcalvw-box-headrow ZPcalvw-box-today-head ZPcalvw-row"><table><thead><tr><th><span id="today_name">Thingal</span></th></tr></thead></table></div></td></tr></thead>',calhtml+='<tbody class="ZPcalvw-box-body"><tr><td class="ZPcalvw-box-tdbox"><div class="ZPcalvw-box-main ZPcalvw-box-scroller"><div class="ZPcalvw-box-mainbox">',calhtml+='<div class="ZPcalvw-box-bg ZPcalvw-box-bg-timegd"> <table> <tbody> <tr> <td class=" W60"></td> <td></td> </tr> </tbody> </table> </div>',calhtml+='<div class="ZPcalvw-box-main-slots"><table><tbody>',Calendar.is12HrFormat()){calhtml+='<tr><td style="width: 60px;"><span>12 '+ZPI18N.getString("zp.am")+"</span></td><td></td></tr>";for(var i=1;i<12;i++)calhtml+="<tr><td><span>"+i+"&nbsp;"+ZPI18N.getString("zp.am")+"</span></td><td></td></tr>";calhtml+="<tr><td><span>12 "+ZPI18N.getString("zp.pm")+"</span></td><td></td></tr>";for(var j=1;j<12;j++)calhtml+="<tr><td><span>"+j+"&nbsp;"+ZPI18N.getString("zp.pm")+"</span></td><td></td></tr>"}else for(i=0;i<24;i++)calhtml+="<tr><td><span>"+(i<10?"0"+i:i)+":00&nbsp;</span></td><td></td></tr>";return calhtml+="</tbody></table></div>",calhtml+='<div class="ZPcalvw-box-main-today"></div>',calhtml+='<div class="ZPcalvw-box-main-crnttime posfl0 DN" id="curr_time"></div>',calhtml+="</div></div></td></tr></tbody></table></div></div>"},getCalendarHTML:function(id,weekcal,calObj){return"monthcalendardiv"===id?this.getMonthlyCalendar(weekcal,calObj):"daycalendardiv"===id?this.getDayCalendar():"fromcalendar"===id?NewCalendar.Template.getSingleCalendar("from").html():"tocalendar"===id?NewCalendar.Template.getSingleCalendar("to").html():NewCalendar.Template.getSingleCalendar(void 0,calObj.weekselection,calObj.constructOnWeekstarts).html()}};var ZPCalendar={};ZPCalendar={calAppLoaded:!1,calInfoObj:!1,jsPath:null,cssPath:null,securityJs:null,urlArr:new Array,calApp:function(pubMsg){ZPCalendar.calAppLoaded||ZPCalendar.getCalJSList("calendar",function(){ZPCalendar.calAppLoaded=!0})},getCalJSList:function(){ZPCalendar.calInfoObj||$.get("/zcal/loadjs",function(data){jsPath=data[0].jsPath,cssPath=data[0].cssPath;try{ZPCalendar.securityJs=data[0].securityJs}catch(e){}$.each(data,function(index,data1){ZPCalendar.calInfoObj=data1}),ZPCalendar.constructionJS()})},FILECNT:0,constructionJS:function(){if(null!=ZPCalendar.securityJs){var s=document.createElement("script");s.type="text/javascript",s.src="https://"+ZPCalendar.securityJs,ZPCalendar.urlArr.push(s.src),document.getElementsByTagName("head")[0].appendChild(s)}$.each(ZPCalendar.calInfoObj.calendar.css,function(index,cssdata){var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",s.href="https://"+cssPath+cssdata,document.getElementsByTagName("head")[0].appendChild(s)}),$.each(ZPCalendar.calInfoObj.calendar.js,function(index,jsdata){try{var s=document.createElement("script");s.type="text/javascript",s.src="https://"+jsPath+jsdata,ZPCalendar.urlArr.push(s.src),document.getElementsByTagName("head")[0].appendChild(s),ZPCalendar.FILECNT++,s.onload=ZPCalendar.markLoaded,s.onerror=ZPCalendar.markLoaded}catch(e){}})},markLoaded:function(){ZPCalendar.FILECNT--,ZPCalendar.FILECNT<=0&&loadApp(491893108)}},ZPCal={},ZPCal={initCalPageComponents:function(){Layout.Page.container.find(".Scrcont").remove();var dt=new Date;$("#"+Layout.Page.pageId).html('<div id="zp_dashboard_calendar_view" class="ZPcalvw"><div class="ZPcalvw-tphd" id="cal_header"><div class="ZPcalvw-tphd-fr"> <div class="ZPcalvw-tphd-lt"> <a view="true"  type="1" href="javascript:;">'+ZPI18N.getString("zp.cday")+'</a> <a  view="true"  class="active"  type="2" href="javascript:;">'+ZPI18N.getString("zp.week")+'</a><a view="true" type="3" href="javascript:;">'+ZPI18N.getString("zp.month")+'</a> </div></div> <div class="ZPcalvw-tphd-tc"> <div class="ZPcalvw-tphd-td"> <a href="javascript:;" onclick="ZPCal.Calendar.goToCurrentday()" data-toggle="tooltip" data-placement="bottom" title="'+ZPDateTime.days_long[dt.getDay()]+",&nbsp;"+ZPDateTime.months_long[dt.getMonth()]+" "+dt.getDate()+'">'+ZPI18N.getString("zp.today")+'</a> </div> <div class="ZPcalvw-tphd-ntpv"> <a><i class="IC-ar-lft" data-toggle="tooltip" data-placement="bottom"></i></a> <a ><i class="IC-ar-rgt" data-toggle="tooltip" data-placement="bottom"></i></a> </div> <div class="ZPcalvw-tphd-hd"> <h2 id="calmonth"><a href="javascript:;">01-JAN-2018</a> </h2> </div></div> </div><div id="cal_body">'+ZPeople.LOADING_HTML+"</div></div>"),$("#zp_dashboard_calendar_view").find('[view="true"]').on("click",function(){$(this).hasClass("active")||($(this).siblings().removeClass("active"),$(this).addClass("active"),ZPCal.toggleCalViews($(this)))}),ZPCal.Calendar.weekCalendarView(),Timetracker.location.navigatorGeoReturn(),Timetracker.generalSettings.getSyncTimesheetSettings(),ZPCal.setModuleDatastoVar()},setModuleDatastoVar:function(){var name=ZPeople.isZPNewUI()?"calendar-dashboardcalendar":"home-dashboard-calendar";null===Timetracker.generalSettings.settingDetails&&ZPeople.Module.MODULE_DATA[name].settingDetails&&(Timetracker.generalSettings.settingDetails=ZPeople.Module.MODULE_DATA[name].settingDetails,Timetracker.generalSettings.updateTimelogCustFieldsCache(Timetracker.generalSettings.settingDetails)),null===Timetracker.jobs.formDetails&&ZPeople.Module.MODULE_DATA[name].formDetails&&(Timetracker.jobs.formDetails=void 0!==ZPeople.Module.MODULE_DATA[name].formDetails.P_TimesheetJob?ZPeople.Module.MODULE_DATA["home-dashboard-calendar"].formDetails.P_TimesheetJob:null),null==Timetracker.projects.formDetails&&ZPeople.Module.MODULE_DATA[name].formDetails&&(Timetracker.projects.formDetails=void 0!==ZPeople.Module.MODULE_DATA[name].formDetails.P_TimesheetJobsList?ZPeople.Module.MODULE_DATA["home-dashboard-calendar"].formDetails.P_TimesheetJobsList:null)},toggleCalViews:function(Obj){var type=Obj.attr("type");1==type?(ZPCal.Calendar.preDayValue=0,ZPCal.Calendar.dayCalendarView(Obj)):2==type?(ZPCal.Calendar.preWeekValue=0,ZPCal.Calendar.weekCalendarView(Obj)):3==type&&(ZPCal.Calendar.preMonthValue=0,ZPCal.Calendar.monthCalendarView(Obj))},gethrCalendarOuter:function(){var dt=new Date,outerCont='<div id="zp_dashboard_calendar_view" class="ZPcalvw"> <div class="ZPcalvw-tphd" id="cal_header"> <div class="ZPcalvw-tphd-fr"> <div class="ZPcalvw-tphd-lt"> <a view="true" type="1" href="javascript:;" onclick="ZPCal.clickViewTypes(this)">'+ZPI18N.getString("zp.cday")+'</a> <a view="true" type="2" href="javascript:;" onclick="ZPCal.clickViewTypes(this)">'+ZPI18N.getString("zp.week")+'</a> <a view="true" type="3" href="javascript:;" onclick="ZPCal.clickViewTypes(this)">'+ZPI18N.getString("zp.month")+'</a> </div> </div> <div class="ZPcalvw-tphd-tc"> <div class="ZPcalvw-tphd-td"> <a href="javascript:;" onclick="ZPCal.Calendar.goToCurrentday()" data-toggle="tooltip" data-placement="bottom" title="'+ZPDateTime.days_long[dt.getDay()]+",&nbsp;"+ZPDateTime.months_long[dt.getMonth()]+" "+dt.getDate()+'">'+ZPI18N.getString("zp.today")+'</a> </div> <div class="ZPcalvw-tphd-ntpv"> <a><i class="IC-ar-lft" data-toggle="tooltip" data-placement="bottom"></i></a> <a><i class="IC-ar-rgt" data-toggle="tooltip" data-placement="bottom"></i></a> </div> <div class="ZPcalvw-tphd-hd"> <h2 id="calmonth"><a href="javascript:;"></a></h2> </div> </div> </div> <div id="cal_body"> '+ZPeople.LOADING_HTML+"</div> </div>";Layout.Page.container.html(outerCont),ZPDashboard.TimelogLocation.init()},calendarCallBack:function(){ZPCal.setModuleDatastoVar(),ZPCal.clickViewTypes($("#zp_dashboard_calendar_view").find('[type="2"]'),!0)},clickViewTypes:function(Obj,isReload){!0!==isReload&&$(Obj).hasClass("active")||($(Obj).siblings().removeClass("active"),$(Obj).addClass("active"),ZPCal.toggleCalViews($(Obj)))},getCurrUser:function(){var userId;return ZPeople.isZPNewUI()?ZPeople.isZPNewUI()&&"undefined"==typeof SelfService?userId=ZPeople.CURR_USER.usererec:ZPeople.isZPNewUI()&&(userId=SelfService.getUserId()):userId=ZPDashboard.getUserId(),userId},checkIsToday:function(calObj,type){var dfDate=new Date;if("1"==type){if(dfDate.getDate()==calObj.curdate&&dfDate.getMonth()==calObj.curMonth&&dfDate.getFullYear()==calObj.curYear)return!0}else if("2"==type&&void 0!==calObj.curWeek&&void 0!==calObj.curWeek.days){var length=calObj.curWeek.days.length;if(length>0)for(var cnt=0;cnt<length;cnt++)if(calObj.curWeek.days[cnt].getDate()==dfDate.getDate()&&dfDate.getMonth()==calObj.curWeek.days[cnt].getMonth())return!0}return!1}},ZPCal.Calendar={calendarObj:{},weekCalendarObj:{},dayCalendarObj:{},preMonthValue:0,preWeekValue:0,preDayValue:0,dayTimeSheetData:{},weekTimeSheetData:{},CURMODE:"week",allowedToCheckIn:!1,refresh:!0,todayDate:null,applyLvDate:void 0,goToCurrentday:function(){var currrentDate=new Date,curYear=(new Date).getFullYear(),curMonth=(new Date).getMonth();NewCalendar.getCurrentWeekdays();if("day"===ZPCal.Calendar.CURMODE){calObj=ZPCal.Calendar.dayCalendarObj;var dt=new Date;dt.setFullYear(curYear,curMonth,currrentDate.getDate()),calObj.curDay=dt.getDay(),calObj.curdate=dt.getDate(),calObj.curMonth=curMonth,calObj.curYear=curYear,calObj.dateObj=dt,ZPCal.Calendar.dayCalendarObj=calObj,NewCalendar.constructDayCalendar(calObj)}else"week"===ZPCal.Calendar.CURMODE?(calObj=ZPCal.Calendar.weekCalendarObj,calObj.curYear=curYear,calObj.curMonth=curMonth,calObj.curdate=currrentDate.getDate(),calObj.curWeek=NewCalendar.getCurrentWeek(),calObj.curWeek.days=ZPCal.Calendar.getDayObj(calObj),ZPCal.Calendar.preWeekValue=0,ZPCal.Calendar.weekCalendarObj=calObj,NewCalendar.constructWeekCalendar(calObj)):"month"===ZPCal.Calendar.CURMODE&&(calObj=ZPCal.Calendar.calendarObj,calObj.curMonth=curMonth,calObj.curYear=curYear,calObj.curdate=currrentDate.getDate(),ZPCal.Calendar.calendarObj=calObj,ZPCal.Calendar.preMonthValue=0,NewCalendar.constructCalendar(calObj))},dayCalendarView:function(obj){ZPCal.Calendar.CURMODE="day",Layout.Page.container.find(".IC-ar-lft").attr("onclick","ZPCal.Calendar.dayNavigation(-1)"),Layout.Page.container.find(".IC-ar-rgt").attr("onclick","ZPCal.Calendar.dayNavigation(1)"),Layout.Page.container.find(".IC-ar-lft").removeAttr("data-original-title").attr("data-original-title",ZPI18N.getString("zp.calprevday")),Layout.Page.container.find(".IC-ar-rgt").removeAttr("data-original-title").attr("data-original-title",ZPI18N.getString("zp.calnextday")),ZPCal.Calendar.populatedayCalendar()},weekCalendarView:function(obj){ZPCal.Calendar.CURMODE="week",Layout.Page.container.find(".IC-ar-lft").attr("onclick","ZPCal.Calendar.weekNavigation(-1)"),Layout.Page.container.find(".IC-ar-rgt").attr("onclick","ZPCal.Calendar.weekNavigation(1)"),Layout.Page.container.find(".IC-ar-lft").removeAttr("data-original-title").attr("data-original-title",ZPI18N.getString("zp.calprevweek")),Layout.Page.container.find(".IC-ar-rgt").removeAttr("data-original-title").attr("data-original-title",ZPI18N.getString("zp.calnextweek")),ZPCal.Calendar.populateWeekCalendar()},monthCalendarView:function(obj){ZPCal.Calendar.CURMODE="month",Layout.Page.container.find(".IC-ar-lft").attr("onclick","ZPCal.Calendar.monthNavigation(1)"),Layout.Page.container.find(".IC-ar-rgt").attr("onclick","ZPCal.Calendar.monthNavigation(-1)"),Layout.Page.container.find(".IC-ar-lft").removeAttr("data-original-title").attr("data-original-title",ZPI18N.getString("zp.calprevmonth")),Layout.Page.container.find(".IC-ar-rgt").removeAttr("data-original-title").attr("data-original-title",ZPI18N.getString("zp.calnextmonth")),ZPCal.Calendar.populateCalendar()},monthNavigation:function(navigationType){ZPCal.Calendar.preMonthValue+=navigationType},weekNavigation:function(navigationType){ZPCal.Calendar.preWeekValue+=navigationType},dayNavigation:function(navigationType){ZPCal.Calendar.preDayValue+=navigationType},populateCalendar:function(calendarObj){if(Layout.Page.container.find("#zpcal_addpop").remove(),void 0===calendarObj){Calendar.getCurrentDay().day.getDate();var calObj,curmonth=Calendar.getCurrentDay().day.getMonth();jQuery.isEmptyObject(calendarObj)?((calObj=new NewCalendar.calObj).curYear=Calendar.getCurrentDay().day.getFullYear(),calObj.curMonth=curmonth,calObj.curMonthDays=curmonth,calObj.calcontId="monthcalendardiv",calObj.outerdivId="zp_dashboard_calendar_view",calObj.daysObj={empty:"zpcalempty",weekend:"zpcalweek",day:"zpcaldays",today:"zpcaltoday",leave:"zpcalholi"},calObj.divid="cal_body",calObj.callback=ZPCal.Calendar.populateCalendar,calObj.mode="dashboardcal",calObj.tdonclick=null,calObj.prearrow="IC-ar-lft",calObj.nextarrow="IC-ar-rgt",calObj.dashboardClass="ZP-monthtable",ZPCal.Calendar.calendarObj=calObj):(calObj=ZPCal.Calendar.calendarObj).outerdivId="zp_dashboard_calendar_view",NewCalendar.initCalendar(calObj)}else{var params={mode:"MONTH_CALENDAR_ACTION",userId:ZPCal.getCurrUser(),view:"month",preMonth:ZPCal.Calendar.preMonthValue,month:calendarObj.curMonth,year:calendarObj.curYear,conreqcsr:csrfToken};$.post("/commonAction.zp",params,function(resultData){for(var resData=new Array,firstDayOfMonth=new Date(ZPCal.Calendar.calendarObj.curYear,ZPCal.Calendar.calendarObj.curMonth,1),lastDayOfMonth=new Date(ZPCal.Calendar.calendarObj.curYear,ZPCal.Calendar.calendarObj.curMonth+1,1),index=0;firstDayOfMonth.getTime()!==lastDayOfMonth.getTime();index++){Calendar.formatDate(firstDayOfMonth);var rData={};rData.date=firstDayOfMonth.getDate();var status="",txt=document.createDocumentFragment();txt=$(txt);var includeAttendance=!0,leaveData=resultData.leaveReport[parseInt(index)+1];void 0!==leaveData&&(-1!==leaveData.txt.indexOf("Absent")&&(includeAttendance=!1),txt.append(leaveData.txt));var data=resultData.attendanceReport[index],isAttOnDutyConfigured=resultData.isAttOnDutyConfigured;if(Attendance.isAllowToCapturePhotoInWeb=void 0!==resultData.isAllowToCapturePhotoInWeb&&resultData.isAllowToCapturePhotoInWeb,Attendance.isAllowToVerifyUserInWeb=void 0!==resultData.isAllowToVerifyUserInWeb&&resultData.isAllowToVerifyUserInWeb,void 0!==data){1==data.isToday&&(ZPCal.Calendar.todayDate=data.attDate,ZPCal.Calendar.allowedToCheckIn=data.isAllowedtoIn);var attTxt="";if(includeAttendance){var sate=data.status.split(",");for(var k in sate)if("Weekend"!==(status=sate[k])){var transStat=$("<div/>").text(Attendance.statusI18n(status)).html();if(transStatus=Attendance.remCommaInLast(transStat),-1===status.indexOf("Absent")||data.isToday?-1===status.indexOf("Present")&&-1===status.indexOf("0.5 day Present")||(-1===status.indexOf("Absent")&&-1===status.indexOf("0.5 day Absent")&&-1===status.indexOf("0.5 day Present")?attTxt+='<div class="ZPcalvw-month-item Cl-prsnt">':(attTxt+='<div class="ZPcalvw-month-item ZPcalvwlebor Cl-prsnt">',void 0!==data.session&&("1"==data.session?attTxt+='<span class="ZPcalvwlebg ZPcalvw-Wshlf"></span>':attTxt+='<span class="ZPcalvwlebg  ZPcalvw-Wfhlf"></span>'))):0!==data.tsecs?attTxt+='<div class="ZPcalvw-month-item Cl-absnt">':-1!==status.indexOf("0.5 day Absent")?(attTxt+='<div class="ZPcalvw-month-item ZPcalvwlebor Cl-absnt">',void 0!==data.session&&("1"==data.session?attTxt+='<span class="ZPcalvwlebg ZPcalvw-Wshlf"></span>':attTxt+='<span class="ZPcalvwlebg  ZPcalvw-Wfhlf"></span>')):attTxt+='<div class="ZPcalvw-month-item Cl-absnt">',isAttOnDutyConfigured&&-1!==status.indexOf("On Duty"))attTxt+='<div class="ZPcalvw-month-item LT3"><strong>'+transStatus.replace(/'/g,"&#039;").replace(/"/g,"&quot;")+"</strong></div>";if(!ZPUtil.Validation.isEmpty(attTxt)&&(-1!==status.indexOf("Absent")&&!data.isToday||-1!==status.indexOf("Present")||-1!==status.indexOf("0.5 day Present")))attTxt+="<strong>"+transStatus.replace(/'/g,"&#039;").replace(/"/g,"&quot;")+"</strong>";attTxt+="</div>"}if(""===attTxt&&0!==data.tsecs&&(attTxt+='<div class="ZPcalvw-month-item Cl-prsnt"><strong>'+ZPI18N.getString("zp.present")+"</strong></div>"),data.totalPermissionHours&&"00:00"!=data.totalPermissionHours){var permissionDisp=ZPI18N.getString("zp.perm")+" - "+data.totalPermissionHours;attTxt+='<div class="ZPcalvw-month-item LT3"><strong title="'+permissionDisp+'">'+permissionDisp+"</strong></div>"}(attTxt=$(attTxt)).data("attDate",data.attDate),void 0!==data.filo.ftime&&attTxt.data("ftime",data.filo.ftime),void 0!==data.filo.ttime&&attTxt.data("ttime",data.filo.ttime),txt.append(attTxt)}var txtChildrens=$("<div/>").append(txt).children();0!==txtChildrens.length&&(txt=txtChildrens.parent())}if(resultData.timesheetReport&&0!==resultData.timesheetReport.length){Timetracker.util.setUserErecno(ZPCal.getCurrUser());var tsData=resultData.timesheetReport[0][parseInt(index)+1];void 0!==tsData&&txt.append(Timetracker.timelogs.populateTimesheetData(tsData,index,calendarObj,void 0,1,!1).txt)}txt.children().length>0?rData.txt=txt:rData.txt="",resData.push(rData),firstDayOfMonth.setDate(firstDayOfMonth.getDate()+1)}NewCalendar.clearOldvalues(calendarObj,3,!0),NewCalendar.populateData(calendarObj,resData)})}},attendanceStatusHandle:function(){1==ZPCal.Calendar.allowedToCheckIn?(Layout.Page.container.find("#zpcal_addpop #attStatusIcon").prop("checked",!1),Layout.Page.container.find("#zpcal_addpop #attStatusName").html(ZPI18N.getString("zp.checkin"))):(Layout.Page.container.find("#zpcal_addpop #attStatusIcon").prop("checked",!0),Layout.Page.container.find("#zpcal_addpop #attStatusName").html(ZPI18N.getString("zp.checkout"))),1==ZPCal.Calendar.allowedToCheckIn?Layout.Page.container.find("#zpcal_addpop #attStatusIcon").off("click").on("click",function(){Attendance.Entry.punchIn();var param={mode:"getStatus",conreqcsr:csrfToken};$.post("/AttendanceAction.zp",param,function(resultData){ZPCal.Calendar.attendanceStatusHandleCallback(resultData)}),Layout.Page.container.find("#zpcal_addpop #attStatusIcon").prop("checked",!0),Layout.Page.container.find("#zpcal_addpop #attStatusName").html(ZPI18N.getString("zp.checkout"))}):Layout.Page.container.find("#zpcal_addpop #attStatusIcon").off("click").on("click",function(){Attendance.Entry.punchOut();var param={mode:"getStatus",conreqcsr:csrfToken};$.post("/AttendanceAction.zp",param,function(resultData){ZPCal.Calendar.attendanceStatusHandleCallback(resultData)}),Layout.Page.container.find("#zpcal_addpop #attStatusIcon").prop("checked",!1),Layout.Page.container.find("#zpcal_addpop #attStatusName").html(ZPI18N.getString("zp.checkin"))})},attendanceStatusHandleCallback:function(resultData){if(ZPCal.Calendar.allowedToCheckIn=!ZPCal.Calendar.allowedToCheckIn,1==ZPCal.Calendar.isDashboardCal())if(0!==Layout.Page.container.find("#monthcal_body").length){if(void 0!==resultData&&void 0!==resultData.response[0]){var rdata=resultData.response[0];ZPCal.Calendar.todayDate=resultData.todayDate;var curDateObj=Calendar.parseDate(ZPCal.Calendar.todayDate,uidateFormat),curDate=curDateObj.getMonth()+1+"-"+curDateObj.getDate()+"-"+curDateObj.getFullYear();0!==Layout.Page.container.find('[date="'+curDate+'"] .ZP-monthcol .ZPmchr').length?(Layout.Page.container.find('[date="'+curDate+'"] .ZP-monthcol .ZPmchr').empty(),Layout.Page.container.find('[date="'+curDate+'"] .ZP-monthcol .ZPmchr').html('<span class="present-bg"></span> <label class="atttime M0">'+Calendar.minstohrs(rdata.totalSecs/60)+"</label>")):(0!==Layout.Page.container.find('[date="'+curDate+'"] .ZP-monthcol .ZPmbtn').length&&Layout.Page.container.find('[date="'+curDate+'"] .ZP-monthcol .ZPmbtn').each(function(index,data){(data=$(data)).removeClass("hp hp1 hp2"),0===index?data.addClass("hp"):data.addClass("hp"+index)}),Layout.Page.container.find('[date="'+curDate+'"] .ZP-monthcol').append('<div class="ZPmchr"><span class="present-bg"></span> <label class="atttime M0">'+Calendar.minstohrs(rdata.totalSecs/60)+"</label></div>"))}}else 0!==Layout.Page.container.find("#weekcal").length&&(ZPCal.Calendar.refreshAttendanceContent(),clearInterval(ZPCal.Calendar.timerObj),ZPCal.Calendar.timerObj=setInterval(ZPCal.Calendar.updateAttendanceBar,1e4));Layout.Page.container.find("#zpcal_addpop").remove()},setCurrTime:function(pageId){pageId=pageId.find("#"+calObj.outerdivId);var curDate=new Date(ZPDateTime.convertToTimezone((new Date).getTime())),scrollTop=60*curDate.getUTCHours()*1.1667+1.1667*curDate.getUTCMinutes();pageId.find("#curr_time").html("<span>"+ZPDateTime.getDisplayTime(curDate)+"</span>"),pageId.find("#curr_time").css("top",scrollTop+"px")},plusIconAction:function(curBoxObj,year,month,date){if(0===Layout.Page.container.find("#calendar3").length){var popOver='<div id="calendar3" class="dropdown-menu W200 calpluspop calwkpop  ZPCmn-Arrow gray" style="left: 360px; top: 140px; display: block;"><ul class="ZPNlists" id="bodyContent">';-1!==ZPTabs.ACTIVE_TABARR.indexOf("leavetracker")&&(popOver=popOver+'<li id="applyleave"><a data-target="#calendar31" data-toggle="modal">'+ZPI18N.getString("zp.leave.apply")+"</a></li>"),-1!==ZPTabs.ACTIVE_TABARR.indexOf("timetracker")&&(popOver=popOver+'<li id="logtime"><a data-target="#logtime" data-toggle="modal">'+ZPI18N.getString("zp.logtime")+"</a></li>"),popOver+="</ul></div>",Layout.Page.container.find("#zp_dashboard_calendar_view").find("#caldiv").append(popOver),$(document).on("click",function(e){Layout.Page.container.find("#calendar3").hide()}),Layout.Page.container.find("#calendar3").on("click",function(event){event.stopPropagation()})}++month<10&&(month="0"+month),date<10&&(date="0"+date);var d=year+"-"+month+"-"+date;month--,ZPCal.Calendar.todayDate===d&&ZPDashboard.getUserId()===erecno&&-1!==ZPTabs.ACTIVE_TABARR.indexOf("attendance")?(0===Layout.Page.container.find("#calendar3 #attCont").length&&Layout.Page.container.find("#calendar3 #bodyContent").append('<li class="ZPCtogle" id="attCont"><p class="MB10">'+ZPI18N.getString("zp.attendance")+'</p><a><label class="btnactive MB0I"><input class="cmn-toggle-small cmn-toggle-round-small" id="attStatusIcon" type="checkbox"><span class="M0"></span></label><span class="pull-right dgry" id="attStatusName"></span></a></li>'),ZPCal.Calendar.attendanceStatusHandle()):Layout.Page.container.find("#calendar3").find("#attCont").remove();var left,top,cssClass,posX=$(curBoxObj).offset().left;if(0!==Layout.Page.container.find("#zp_dashboard_calendar_view").find("#monthcal").length){var bannerht,posY=$(curBoxObj).offset().top;bannerht=NewCalendar.bannerHtCalc();var widthpop=Layout.Page.container.find("#calendar3").width(),heightpop=Layout.Page.container.find("#calendar3").height(),vht=$(window).height(),wht=$(window).width();posX-=475,wht-=450,(vht-=100)-((posY-=62)+heightpop)<0&&wht-(posX+widthpop)<0?(left=posX-widthpop+50,top=posY-heightpop-bannerht+10,cssClass="bottom rt"):(vht-(posY+heightpop)<0&&(left=posX-20,top=posY-heightpop-bannerht,cssClass="bottom lt"),wht-(posX+widthpop)<0&&(left=posX-widthpop-5,top=posY-bannerht+15,cssClass="right tp"),vht-(posY+heightpop)>0&&wht-(posX+widthpop)>0&&(left=posX-10,top=posY+20-bannerht,cssClass="top lt"))}else top=154,posX<1100?(cssClass="left tp",left=posX-430):(cssClass="right tp",left=posX-618);Layout.Page.container.find("#calendar3").removeClass("top lt right tp bottom rt left"),Layout.Page.container.find("#calendar3").addClass(cssClass),Layout.Page.container.find("#calendar3").css({left:left,top:top}),Layout.Page.container.find("#calendar3").fadeIn("500"),Layout.Page.container.find("#calendar3 #applyleave").attr("onclick","ZPDashboard.Leave.applyLeave('"+year+"','"+month+"','"+date+"')"),Layout.Page.container.find("#calendar3 #logtime").off("click").on("click",function(){Timetracker.timelogs.calendarplus(this,year,month,date)})},triggerPopover:function(e){e.stopPropagation(),Layout.Page.container.find("#calendar3").fadeIn("500")},preventEventTrigger:function(event){event.stopPropagation()},closeTimelogPopover:function(Obj){$(Obj).parent().css("display","none")},addWeekviewTimelog:function(thisObj,year,month,day){var popupPosition=0;$(thisObj).is(":visible")&&(popupPosition=$(thisObj).offset().left-419),Timetracker.timelogs.calendarplus(null,year,month,day),popupPosition>550?(popupPosition-=470,Layout.Page.container.find("#calpluspop2").css({left:popupPosition}),Layout.Page.container.find("#calpluspop2").removeClass("left"),Layout.Page.container.find("#calpluspop2").addClass("right")):(Layout.Page.container.find("#calpluspop2").removeClass("right"),Layout.Page.container.find("#calpluspop2").addClass("left")),Layout.Page.container.find("#calpluspop2").removeClass("top lt").addClass("tp"),Layout.Page.container.find("#calpluspop2").css({left:popupPosition}),Layout.Page.container.find("#calpluspop2").modal("show")},populateTimelogbox:function(fromTime,toTime,data,timerId,timeSequence,index,isCurrentlyRunning){Layout.Page.container.find("#dashboard_timelog_popover").remove();var startPixel,endPixel,minsWorked,tsCalIcon,resCont="",tsIcon="",workDate=Calendar.parseDate(data.workDate,uidateFormat),today=Calendar.getCurrentDay().day,canShowIcon=void 0!==data.timearr&&void 0!==index&&Calendar.equalsTo(today,workDate),diffTime=0;if(fromTime=void 0===fromTime&&void 0!==toTime?toTime:fromTime,startPixel=Math.round(60*Calendar.minstohrs(fromTime/60).split(":")[0]*1.1667+1.1667*Calendar.minstohrs(fromTime/60).split(":")[1]),(isCurrentlyRunning=void 0!==data.timearr&&void 0!==index&&void 0!==data.timearr[index]&&void 0!==data.timearr[index].isRunning?isCurrentlyRunning&&data.timearr[index].isRunning:isCurrentlyRunning)&&Timetracker.timelogs.currentTimerJobData&&(isCurrentlyRunning=data.timearr[index].timerId===Timetracker.timelogs.currentTimerJobData.timerId),void 0===toTime&&isCurrentlyRunning){var d=new Date(ZPDateTime.convertToTimezone((new Date).getTime())),hours=d.getUTCHours(),mins=d.getUTCMinutes(),toTimeDiff=Calendar.minstohrs(fromTime/60);Calendar.equalsTo(today,workDate)&&hours+":"+mins>=toTimeDiff?(endPixel=Math.round(60*hours*1.1667+1.1667*mins+.0194*d.getUTCSeconds())-startPixel,minsWorked=(diffTime=Calendar.minstohrs(60*hours+mins-fromTime/60).split(":"))[0]+"h "+diffTime[1]+"m",canShowIcon=!0):(endPixel=1198-startPixel,minsWorked=(diffTime=Calendar.minstohrs((timeSequence.diff+data.totaltime)/60).split(":"))[0]+"h "+diffTime[1]+"m"),(canShowIcon||isCurrentlyRunning)&&(tsIcon='<span class="CP"><img src="'+ZPeople.getResourceURL(newUIImageUrl+"timelog2.gif")+'" timerid="'+timerId+'" title="'+ZPI18N.getString("zp.stoptimer")+'" onclick="'+(Timetracker.timelogs.tserecno===erecno?"Timetracker.timelogs.pauseclock()":"Timetracker.util.showAlert(1,'"+ZPI18N.getString("zp.timeralert7")+"');")+'"/></span>',Timetracker.timelogs.tserecno!==erecno||Timetracker.timelogs.currentTimerJobData||(Timetracker.timelogs.timerTime(data),isCurrentlyRunning=Timetracker.timelogs.currentTimerJobData?Timetracker.timelogs.currentTimerJobData&&data.timearr[index].timerId===Timetracker.timelogs.currentTimerJobData.timerId:isCurrentlyRunning),tsCalIcon=!0)}else(toTime=void 0!==toTime||isCurrentlyRunning?toTime:fromTime)<fromTime?(endPixel=1198-startPixel,minsWorked=(diffTime=Calendar.minstohrs(data.totaltime/60).split(":"))[0]+"h "+diffTime[1]+"m"):((minsWorked=Math.round((toTime-fromTime)/60))>59?minsWorked=Math.floor(minsWorked/60)+"h "+minsWorked%60+"m":minsWorked+="m",endPixel=Math.round(60*Calendar.minstohrs(toTime/60).split(":")[0]*1.1667+1.1667*Calendar.minstohrs(toTime/60).split(":")[1])-startPixel),canShowIcon&&0===index&&(tsIcon='<span class="ZPcaltimer CP"><i class="IC-play grn" title="'+ZPI18N.getString("zp.resumetimer")+'" timerid="'+timerId+'" onclick="'+(Timetracker.timelogs.tserecno===erecno?"Timetracker.timelogs.nextStart(this)":"Timetracker.util.showAlert(1,'"+ZPI18N.getString("zp.timeralert7")+"');")+'"></i></span>');"day"===ZPCal.Calendar.CURMODE?ZPCal.Calendar.dayTimeSheetData[timerId]=data:"week"===ZPCal.Calendar.CURMODE&&(ZPCal.Calendar.weekTimeSheetData[timerId]=data);var curTimer="";isCurrentlyRunning&&(curTimer="currentlyrunning = true",ZPCal.Calendar.timerClock.hrs=Number(diffTime[0]),ZPCal.Calendar.timerClock.mins=Number(diffTime[1]));var jobColorClass="LC"+(data.jobColor?data.jobColor:"1"),jobName=data.jobName.replace('"','"').replace("'","'"),taskName=data.taskName;return taskName=void 0===taskName||""===taskName?ZPI18N.getString("zp.noworkitem"):taskName.replace('"','"').replace("'","'"),endPixel<23?resCont+='<div class="ZPcalvw-box-main-wkdayltps ZPcalvw-box-wksheet '+jobColorClass+'" taskname="'+taskName+'" jobname="'+jobName+'" timerid="'+timerId+'" '+curTimer+' style="top:'+startPixel+"px;height:"+endPixel+'px;" onclick="ZPCal.Calendar.showTimelogPopover(this, event, \''+timerId+"','"+jobColorClass+"',"+(""!==tsIcon)+","+!(!timeSequence||!timeSequence.isRunning)+",'"+minsWorked+'\')"><h6 class="ZPcalvwbox-head"><strong title="'+taskName+'">'+data.jobName+'</strong> <span class="ZPcalvwbox-time"><span '+(tsCalIcon&&Timetracker.timelogs.tserecno===erecno?'id="dashboard_week_day_timer"':"")+">"+minsWorked+" </span>"+tsIcon+"</span></h6></div>":endPixel<66?resCont+='<div class="ZPcalvw-box-main-wkdayltps ZPcalvw-box-wksheet '+jobColorClass+'" taskname="'+taskName+'" jobname="'+jobName+'" timerid="'+timerId+'" '+curTimer+' style="top:'+startPixel+"px;height:"+endPixel+'px;" onclick="ZPCal.Calendar.showTimelogPopover(this, event, \''+timerId+"','"+jobColorClass+"',"+(""!==tsIcon)+","+!(!timeSequence||!timeSequence.isRunning)+",'"+minsWorked+'\')"><h6 class="ZPcalvwbox-head"><strong title="'+taskName+'">'+data.jobName+'</strong> <span class="ZPcalvwbox-time"><span '+(tsCalIcon&&Timetracker.timelogs.tserecno===erecno?'id="dashboard_week_day_timer"':"")+">"+minsWorked+" </span>"+tsIcon+"</span></h6></div>":(tsCalIcon&&(tsIcon='<span class="CP"><img class="FR" title="'+ZPI18N.getString("zp.stoptimer")+'" onclick="'+(Timetracker.timelogs.tserecno===erecno?"Timetracker.timelogs.pauseclock()":"Timetracker.util.showAlert(1,'"+ZPI18N.getString("zp.timeralert7")+"');")+'" src="'+ZPeople.getResourceURL(newUIImageUrl+"timelog2.gif")+'"></span>'),resCont+='<div class="ZPcalvw-box-main-wkdayltps ZPcalvw-box-wksheet '+jobColorClass+'" taskname="'+taskName+'" jobname="'+jobName+'" timerid="'+timerId+'" '+curTimer+' style="top:'+startPixel+"px;height:"+endPixel+'px;" onclick="ZPCal.Calendar.showTimelogPopover(this, event, \''+timerId+"','"+jobColorClass+"',"+(""!==tsIcon)+","+!(!timeSequence||!timeSequence.isRunning)+",'"+minsWorked+'\')"> <h6 class="ZPcalvwbox-head"><strong title="'+taskName+'">'+data.jobName+'</strong> <span class="ZPcalvwbox-time"><span '+(tsCalIcon&&Timetracker.timelogs.tserecno===erecno?'id="dashboard_week_day_timer"':"")+">"+minsWorked+" </span>"+tsIcon+"</span></h6></div>"),$(document).on("click",function(e){0===$(e.target).parents("#dashboard_timelog_popover").length&&Layout.Page.container.find("#dashboard_timelog_popover").remove()}),resCont},getDayObj:function(calObj){for(var days=new Array,fromDt=calObj.curWeek.from,tempdate=new Date,i=0;i<7;i++)tempdate.setDate(fromDt.getDate()+i),days.push(new Date(tempdate));return days},populateWeekCalendar:function(weekCalendarObj){if(Layout.Page.container.find("#zpcal_addpop").remove(),void 0===weekCalendarObj){var calObj;jQuery.isEmptyObject(weekCalendarObj)?((calObj=new NewCalendar.calObj).curYear=(new Date).getFullYear(),calObj.curMonth=(new Date).getMonth(),calObj.curdate=(new Date).getDate(),calObj.calcontId="monthcalendardiv",calObj.outerdivId="zp_dashboard_calendar_view",calObj.daysObj={empty:"zpcalempty",weekend:"zpcalweek",day:"zpcaldays",today:"zpcaltoday",leave:"zpcalholi"},calObj.divid="cal_body",calObj.callback=ZPCal.Calendar.populateWeekCalendar,calObj.mode="dashboardcal",calObj.tdonclick=null,calObj.prearrow="IC-ar-lft",calObj.nextarrow="IC-ar-rgt",calObj.dashboardContent="weekcontent",calObj.curWeek=NewCalendar.getCurrentWeek(),calObj.curWeek.days=ZPCal.Calendar.getDayObj(calObj),ZPCal.Calendar.weekCalendarObj=calObj):(calObj=ZPCal.Calendar.weekCalendarObj).outerdivId="zp_dashboard_calendar_view",NewCalendar.initWeekCalendar(calObj)}else{var fromDate=Calendar.formatDate(weekCalendarObj.curWeek.from),toDate=Calendar.formatDate(weekCalendarObj.curWeek.to),mode=weekCalendarObj.mode,currentUserId=NewCalendar.getCurrentUserErecno(mode);Timetracker.generalSettings.getSyncTimesheetSettings();var param={mode:"GET_WEEKEND_DEFINITION",fromDate:fromDate,toDate:toDate,userErecNo:currentUserId,userLocation:ZPeople.getUserDetailsById(currentUserId).locId,conreqcsr:csrfToken};if($.post("/commonAction.zp",param,function(resultData){weekCalendarObj.weekendarray=resultData.weekendArray;var params={mode:"WEEK_CALENDAR_ACTION",userErecNo:ZPCal.getCurrUser(),fromDate:fromDate,toDate:toDate,newsubmode:"timesheet",preMonth:ZPCal.Calendar.preWeekValue,view:"week",loadToday:!1,conreqcsr:csrfToken};$.post("/commonAction.zp",params,function(resultData){var tsObj={},tempDate="",resCont="",totLogHrs=0,tsJobs=(Calendar.getCurrentDay().day,{});if(ZPCal.Calendar.weekTimeSheetData={},void 0!==resultData.tsArr){Timetracker.util.setUserErecno(ZPCal.getCurrUser()),$.each(resultData.tsArr,function(index,data){if(data.taskName=ZPCal.Calendar.undefinedToEmpty(data.taskName),0!==index&&data.workDate!==tempDate){var tsTempObj={};tsTempObj.txt=resCont,tsTempObj.totHrs=Calendar.minstohrs(totLogHrs),tsTempObj.jobs=tsJobs,tsObj[tempDate]=tsTempObj,resCont="",totLogHrs=0,tsJobs={}}void 0!==data.timearr?$.each(data.timearr,function(index,timeSequence){resCont+=ZPCal.Calendar.populateTimelogbox(timeSequence.fromTime,timeSequence.toTime,data,timeSequence.timerId,timeSequence,index,data.isCurrentlyRunning)}):void 0!==data.fromTime&&0!==data.fromTime&&void 0!==data.toTime&&0!==data.toTime&&(resCont+=ZPCal.Calendar.populateTimelogbox(60*data.fromTime,60*data.toTime,data,data.timelogId)),totLogHrs+=data.hours;var jobObj={};void 0!==tsJobs[data.jobId]?(jobObj.jobId=data.jobId,jobObj.jobName=data.jobName,jobObj.jobHrs=data.hours+tsJobs[data.jobId].jobHrs):(jobObj.jobId=data.jobId,jobObj.jobName=data.jobName,jobObj.jobHrs=data.hours),tsJobs[data.jobId]=jobObj,tempDate=data.workDate});var tsTempObj={};tsTempObj.txt=resCont,tsTempObj.totHrs=Calendar.minstohrs(totLogHrs),tsTempObj.jobs=tsJobs,tsObj[tempDate]=tsTempObj}var resData=new Array,nextStartObj={nextStart:void 0,nextStartTxt:void 0},dayOfWeek=weekCalendarObj.curWeek.from;$.each(NewCalendar.getCurrentWeekdays().days,function(index,day){var curDate=Calendar.formatDate(dayOfWeek),data=resultData.attendanceReport[index],isAttOnDutyConfigured=resultData.isAttOnDutyConfigured;Attendance.isAllowToCapturePhotoInWeb=void 0!==resultData.isAllowToCapturePhotoInWeb&&resultData.isAllowToCapturePhotoInWeb,Attendance.isAllowToVerifyUserInWeb=void 0!==resultData.isAllowToVerifyUserInWeb&&resultData.isAllowToVerifyUserInWeb;var resCont,leaveObj,tempObj,weekCalObj={},leaveDtl="",absentClass="",isattDisabled=!1;if(void 0!==data){if(1==data.isToday&&(ZPCal.Calendar.todayDate=data.attDate,ZPCal.Calendar.allowedToCheckIn=data.isAllowedtoIn),void 0!==data.status&&""!==data.status){var statusDataArr=data.status.split(",");$.each(statusDataArr,function(index,statusData){var transStat=$("<div/>").text(Attendance.statusI18n(statusData)).html();transStat=(transStat=Attendance.remCommaInLast(transStat)).replace(/'/g,"&#039;").replace(/"/g,"&quot;"),-1!==statusData.indexOf("Weekend")?(weekCalObj.isFullColor="Cl-wked",weekCalObj.attHead='<h6 class="ZPcalvwbox-head"><i class="Cl-wked"></i>'+transStat+"</h6>"):-1!==statusData.indexOf("0.25 day Absent")?(leaveDtl+='<div class="ZPcalvw-box-bgcol Cl-absnt  '+ZPCal.Calendar.getSessionClass(data.session)+'"></div>',weekCalObj.attHead='<h6 class="ZPcalvwbox-head"><i class="Cl-absnt"></i>'+transStat+"</h6>"):-1!==statusData.indexOf("0.5 day Absent")?(data.session=void 0!==data.session?1==data.session?2:1:"",leaveDtl+='<div class="ZPcalvw-box-bgcol Cl-absnt '+absentClass+" "+ZPCal.Calendar.getSessionClass(data.session,!0)+'"></div>',weekCalObj.attHead='<h6 class="ZPcalvwbox-head"><i class="Cl-absnt"></i>'+transStat+"</h6>"):-1!==statusData.indexOf("Absent")?(leaveDtl='<div class="ZPcalvw-box-bgcol Cl-absnt"></div>',weekCalObj.attHead='<h6 class="ZPcalvwbox-head"><i class="Cl-absnt"></i>'+transStat+"</h6>"):-1!==statusData.indexOf("0.5 day Holiday")?(leaveDtl='<div class="ZPcalvw-box-bgcol Cl-hlday'+ZPCal.Calendar.getSessionClass(data.session,!0)+'"></div>',weekCalObj.attHead='<h6 class="ZPcalvwbox-head"><i class="Cl-hlday"></i>'+transStat+"</h6>",absentClass="ZPcalvw-Thfd"):(-1!==statusData.indexOf("Holiday")||Att_Common_Operations.isRestrictedHoliday(statusData))&&(weekCalObj.isFullColor="Cl-hlday",weekCalObj.attHead='<h6 class="ZPcalvwbox-head"><i class="Cl-hlday"></i>'+transStat+"</h6>"),isAttOnDutyConfigured&&-1!==statusData.indexOf("On Duty")&&(leaveDtl+='<div class="ZPcalvw-box-bgcol LT3"><span>'+transStat+"</span></div>")})}}else isattDisabled=!0;if(void 0!==resultData.leaveArr&&void 0!==(leaveObj=resultData.leaveArr[0][curDate]))if(void 0===leaveObj[0]){if(0!==(tempObj=leaveObj).count)leaveDtl+='<div class="ZPcalvw-box-bgcol LT'+tempObj.ltyp_color+" "+ZPCal.Calendar.getSessionClass(tempObj.session,!(tempObj.count<.5))+'"><span>'+ZPeople.escapeHtml(tempObj.ltyp_name)+"</span></div>";else if(isattDisabled&&void 0!==resultData.leaveReport){var leaveData=resultData.leaveReport[curDate];void 0!==leaveData&&(weekCalObj.isFullColor="Cl-hlday",weekCalObj.attHead='<h6 class="ZPcalvwbox-head"><i class="Cl-hlday"></i>'+leaveData.name+"</h6>")}}else for(var cnt=0;cnt<leaveObj.length;cnt++)void 0!==(tempObj=leaveObj[cnt])&&0!==tempObj.count&&(leaveDtl+='<div class="ZPcalvw-box-bgcol LT'+tempObj.ltyp_color+" "+ZPCal.Calendar.getSessionClass(tempObj.session,!(tempObj.count<.5))+'"><span>'+ZPeople.escapeHtml(tempObj.ltyp_name)+"</span></div>");resCont=ZPCal.Calendar.constructAttendanceList(data,nextStartObj,weekCalObj),leaveDtl=leaveDtl+'<div class="ZPcalvw-box-main-wkdayltbox">'+resCont+(void 0!==tsObj[curDate]?tsObj[curDate].txt:"")+"</div>",void 0!==tsObj[curDate]?(weekCalObj.txt=leaveDtl,weekCalObj.tsHrs=tsObj[curDate].totHrs,weekCalObj.jobs=tsObj[curDate].jobs):weekCalObj.txt=leaveDtl,void 0!==data&&"00:00"!==data.tHrs&&(weekCalObj.attHrs=data.tHrs),resData.push(weekCalObj),dayOfWeek.setDate(dayOfWeek.getDate()+1)}),dayOfWeek.setDate(dayOfWeek.getDate()-7),NewCalendar.clearOldvalues(weekCalendarObj,2),NewCalendar.populateWeekCalendar(weekCalendarObj,resData),Layout.Page.container.find("#weekcalendarbody").removeClass("DN"),Layout.Page.container.find(".ZP-weekhead").removeClass("DN"),Layout.Page.container.find(".ZP-weektop").removeClass("DN"),Layout.Page.container.find("#zp_page_loading").remove()})}),null!==ZPCal.Calendar.todayDate){var curDateObj=Calendar.parseDate(ZPCal.Calendar.todayDate,uidateFormat),curDate=curDateObj.getFullYear()+"-"+curDateObj.getMonth()+"-"+curDateObj.getDate(),curElement=Layout.Page.container.find('[date="'+curDate+'"]');void 0===curElement.attr("onclick")&&(curElement.attr("onclick","ZPCal.Calendar.plusIconAction(this,'"+curDateObj.getFullYear()+"','"+curDateObj.getMonth()+"','"+curDateObj.getDate()+"')"),curElement.on("click",function(e){e.stopPropagation(),Layout.Page.container.find("#calendar3").fadeIn("500")}))}$(document).on("click",function(e){Layout.Page.container.find(".ZPNdrop").hide()})}$(document).on("click",".ZPCusPd",function(e){e.stopPropagation()}),clearInterval(ZPCal.Calendar.timerObj),ZPCal.Calendar.timerObj=setInterval(ZPCal.Calendar.updateAttendanceBar,1e4)},getSessionClass:function(session,isHalf){var sessionClass="";if(void 0!==session)return 1==isHalf?"1"==session?sessionClass=" ZPcalvw-Wfhlf":"2"==session&&(sessionClass=" ZPcalvw-Wshlf"):"1"==session?sessionClass=" ZPcalvw-Wqtd":"2"==session?sessionClass=" ZPcalvw-Wsqtd":"3"==session?sessionClass=" ZPcalvw-Wtqtd":"4"==session&&(sessionClass=" ZPcalvw-Wfqtd"),sessionClass},getLeaveTypeClass:function(type){},refreshAttendanceContent:function(){var params={mode:"GET_ATTENDANCE_LIST",userErecNo:ZPCal.getCurrUser(),preMonth:0,view:"week",loadToday:!1,conreqcsr:csrfToken},resData=new Array;$.post("/commonAction.zp",params,function(resultData){var nextStartObj={nextStart:void 0,nextStartTxt:void 0};$.each(resultData.attendanceReport,function(index,data){var weekCalObj={};1==data.isToday&&(data.isAllowedtoIn=1!=data.isAllowedtoIn&&void 0,weekCalObj.isToday=data.isToday);var resCont=ZPCal.Calendar.constructAttendanceList(data,nextStartObj,weekCalObj);weekCalObj.txt=resCont,resData.push(weekCalObj)}),Layout.Page.container.find(".ZPcalvw-box-bg-timegd").find("[isAtt='true']").remove();var tdlist=Layout.Page.container.find(".ZPcalvw-box-bg-timegd").find("td");if("day"!=ZPCal.Calendar.CURMODE)for(var index=0;index<resData.length;index++){void 0!==(data=resData[index]).attLine&&("week"==ZPCal.Calendar.CURMODE?$(tdlist[index+1]).find(".ZPcalvw-box-main-wkdayltbox").prepend(data.txt):$(tdlist[index+1]).find(".ZPcalvw-box-main-wkdayltps").prepend(data.txt))}else{var weekStart=weekstarts;for(index=0;index<resData.length;index++){var data;if(1==(data=resData[weekStart]).isToday){$(tdlist[1]).find(".ZPcalvw-box-main-wkdayltbox").prepend(data.txt);break}6===weekStart?weekStart=0:weekStart++}}})},constructAttendanceList:function(data,nextStartObj,weekCalObj){var resCont="",today=Calendar.getCurrentDay().day;if(void 0!==nextStartObj.nextStart&&(nextStartObj.nextStartTxt='<div class="ZPcalvw-box-main-wkdayltps Cl-prsnt" isAtt="true"  style="top:2px;height:'+nextStartObj.nextStart+'px;"><h6 class="ZPcalvwbox-head"></h6> <h6 class="ZPcalvwbox-head ZPcalvwbox-head-checkout"></h6> </div>',nextStartObj.nextStart=void 0,weekCalObj.attLine=!0),void 0!==data&&void 0!==data.filo&&void 0!==data.filo.checkin){var checkin=moment(data.filo.checkin)._d,checkout=moment(data.filo.checkout)._d,startPixel=Math.round(60*checkin.getHours()*1.1667+1.1667*checkin.getMinutes()),curStatus="";if(void 0!==data.filo.checkout&&Calendar.formatDate(checkin)!==Calendar.formatDate(checkout))endPixel=1675,nextStartObj.nextStart=Math.round(60*checkout.getHours()*1.1667+1.1667*checkout.getMinutes());else{if(void 0===data.isAllowedtoIn||1==data.isAllowedtoIn)if(void 0!==data.filo.checkout)endPixel=Math.round(60*checkout.getHours()*1.1667+1.1667*checkout.getMinutes());else if(Calendar.formatDate(new Date(today))===Calendar.formatDate(checkin)){var currentTime=new Date(ZPDateTime.convertToTimezone((new Date).getTime()));endPixel=Math.round(60*currentTime.getUTCHours()*1.1667+1.1667*currentTime.getUTCMinutes())+.0194*currentTime.getUTCSeconds()}else endPixel=1675;else var curDate=new Date(ZPDateTime.convertToTimezone((new Date).getTime())),endPixel=60*curDate.getUTCHours()*1.1667+1.1667*curDate.getUTCMinutes();void 0!==data.isAllowedtoIn&&(ZPCal.Calendar.allowedToCheckIn=data.isAllowedtoIn,ZPCal.Calendar.allowedToCheckIn?(Layout.Page.container.find("#zpcal_addpop #attStatusIcon").prop("checked",!1),Layout.Page.container.find("#zpcal_addpop #attStatusName").html(ZPI18N.getString("zp.checkin"))):(Layout.Page.container.find("#zpcal_addpop #attStatusIcon").prop("checked",!0),Layout.Page.container.find("#zpcal_addpop #attStatusName").html(ZPI18N.getString("zp.checkout"))),data.isAllowedtoIn||(curStatus='currentstatus="true"'))}resCont='<div class="ZPcalvw-box-main-wkdayltps Cl-prsnt" isAtt="true" '+curStatus+' style="top:'+startPixel+"px;height:"+(endPixel-=startPixel)+'px;"> <h6 class="ZPcalvwbox-head">'+(void 0!==data.filo.ftime?"<strong>"+ZPI18N.getString("zp.checkin")+"</strong><span>"+data.filo.ftime+"</span></h6>":"")+' <h6 class="ZPcalvwbox-head ZPcalvwbox-head-checkout">'+(void 0!==data.isAllowedtoIn&&!0!==data.isAllowedtoIn||void 0===data.filo.ttime?"":"<strong>"+ZPI18N.getString("zp.checkout")+"</strong><span>"+data.filo.ttime+"</span>")+"</h6> </div>",weekCalObj.attLine=!0}return void 0!==nextStartObj.nextStartTxt&&(resCont=nextStartObj.nextStartTxt+resCont,nextStartObj.nextStartTxt=void 0),resCont},timerObj:null,timerClock:{hrs:0,mins:0,secs:0},isCheckin:!1,attendanceTimer:0,attendanceOldDate:null,updateAttendanceTimer:function(diffTime){if(ZPCal.Calendar.attendanceTimer=ZPCal.Calendar.attendanceTimer+diffTime,0!==Layout.Page.container.find("#monthcal").length){var curDateObj=Calendar.parseDate(ZPCal.Calendar.todayDate,uidateFormat),curDate=curDateObj.getMonth()+1+"-"+curDateObj.getDate()+"-"+curDateObj.getFullYear(),sec=parseInt(ZPCal.Calendar.attendanceTimer%60),min=parseInt((ZPCal.Calendar.attendanceTimer-sec)/60%60),hrs=parseInt((ZPCal.Calendar.attendanceTimer-min)/3600),attTimerVal=Attendance.disTwoDigit(hrs)+":"+Attendance.disTwoDigit(min)+":"+Attendance.disTwoDigit(sec);Layout.Page.container.find("[date="+curDate+"] .ZP-monthcol .ZPmchr .atttime").html(attTimerVal)}},updateAttendanceBar:function(){var pageId=$("#"+Layout.Page.pageId);if(pageId.find('[currentstatus="true"]').is(":visible")&&pageId.find('[currentstatus="true"]').length>0){var currHeight=pageId.find('[currentstatus="true"]').height()+pageId.find('[currentstatus="true"]').offset().top;scrollTop=pageId.find('[currentstatus="true"]').height()+(pageId.find("#curr_time").offset().top-currHeight),pageId.find('[currentstatus="true"]').css({height:scrollTop+"px"})}},setIconNavigation:function(){var d=new Date(ZPDateTime.convertToTimezone((new Date).getTime()));if(-1!==ZPTabs.ACTIVE_TABARR.indexOf("attendance")&&!ZPCal.Calendar.allowedToCheckIn){null===ZPCal.Calendar.attendanceOldDate&&(ZPCal.Calendar.attendanceOldDate=d.getTime());var diffTime=Math.abs(Math.round((ZPCal.Calendar.attendanceOldDate-d.getTime())/1e3));ZPCal.Calendar.updateAttendanceTimer(diffTime),ZPCal.Calendar.attendanceOldDate=d.getTime()}if(0!==Layout.Page.container.find("#weekcal").length){var offPosition=60*d.getUTCHours()*1.1667+1.1667*d.getUTCMinutes()+.0139*d.getUTCSeconds();Layout.Page.container.find("#currenttimedoticon").css("top",offPosition+"px");var updateTime=!1;ZPCal.Calendar.timerClock.secs++,60===ZPCal.Calendar.timerClock.secs&&(ZPCal.Calendar.timerClock.secs=0,ZPCal.Calendar.timerClock.mins++,updateTime=!0),60===ZPCal.Calendar.timerClock.mins&&(ZPCal.Calendar.timerClock.mins=0,ZPCal.Calendar.timerClock.hrs++,updateTime=!0);var timerObj=Layout.Page.container.find("[currentlyrunning=true]");if(0!==timerObj.length){var timeroffset=offPosition-timerObj.position().top,timerId=timerObj.attr("timerid");if(timeroffset>0&&timeroffset<1198&&(timerObj.css("height",timeroffset+"px"),Layout.Page.container.find("#timelog_"+timerId).css("top",offPosition+"px")),23===Math.round(timeroffset)&&ZPCal.Calendar.isFirstSTimer){ZPCal.Calendar.isFirstSTimer=!1;var timerdata="44";Layout.Page.container.find("[currentlyrunning=true] #innerdata").html('<div class="NotiTym"><span id="timedetails">'+timerdata+"</span></div>")}else if(66===Math.round(timeroffset)&&ZPCal.Calendar.isFirstLTimer){ZPCal.Calendar.isFirstLTimer=!1;timerdata="44";var jobName=timerObj.attr("jobname"),taskName=timerObj.attr("taskname"),timerBoxParent=timerObj.parent(),top=timerObj.position().top;timerObj.remove();var timeEntryBox='<div class="ZPNotiBox" timerid="'+timerId+'" currentlyrunning="true" style="top:'+top+"px;height:"+timeroffset+'px;" onclick="ZPCal.Calendar.preventEventTrigger(event)"><div class="ZPNoticol"><h5>'+ZPCal.Calendar.undefinedToEmpty(jobName)+"</h5><p>"+ZPCal.Calendar.undefinedToEmpty(taskName)+'</p><div class="NotiTym"><span>'+timerdata+'</span><img class="FR" onclick="'+(Timetracker.timelogs.tserecno===erecno?"Timetracker.timelogs.pauseclock()":"Timetracker.util.showAlert(1,'"+ZPI18N.getString("zp.timeralert7")+"');")+'" src="'+ZPeople.getResourceURL(newUIImageUrl+"timelog2.gif")+'"></div></div></div>';timerBoxParent.append(timeEntryBox)}if(updateTime){var hrs=ZPCal.Calendar.timerClock.hrs,mins=ZPCal.Calendar.timerClock.mins;hrs<10&&(hrs="0"+hrs),mins<10&&(mins="0"+mins),timeroffset<23?Layout.Page.container.find("#timelog_"+timerId+" #timedetails").html(hrs+"h "+mins+"m"):timerObj.find("#timedetails").html(hrs+"h "+mins+"m")}}var attObj=Layout.Page.container.find("[currentstatus=true]");if(0!==attObj.length){var nextDayEnd=attObj.position().top,attoffset=offPosition-nextDayEnd;if(attoffset>0&&attoffset<1198)attObj.css("height",attoffset+"px");else{var nextDayStatus=Layout.Page.container.find("[nextDayStatus=true]");0===nextDayStatus.length?attObj.parent().parent().next().find(".contenttxt").html('<div class="ZPLbar" nextDayStatus="true" style="top:2px;height:3px;"></div>'):nextDayEnd>offPosition-2&&nextDayStatus.css("height",offPosition-2+"px")}}}},isFirstSTimer:!0,isFirstLTimer:!0,showTimelogPopover:function(obj,event,timerId,jobColorClass,isIconNeeded,isCurrentlyRunning,minsWorked){jobName=$(obj).attr("jobname"),taskName=$(obj).attr("taskname"),void 0!==taskName&&""!==taskName||(taskName=ZPI18N.getString("zp.noworkitem")),Layout.Page.container.find("#dashboard_timelog_popover").remove(),Layout.Page.container.find("#zpcal_addpop").remove(),event.stopPropagation();var positionClass="bottom",top=$(obj).offset().top-$(Layout.Page.container).offset().top,left=$(obj).offset().left;$(window).width()<left+250&&(left=left-250+20,positionClass="bottom btm_rgt"),left=ZPeople.isZPNewUI()?left:left-$(Layout.Page.container).offset().left,ZPCal.Calendar.isSelfServiceCal()&&(top-=20,left-=290);var style='style="top: '+top+"px;left : "+left+'px;"',timerText="<span>"+minsWorked+"</span>";isIconNeeded&&(isCurrentlyRunning?timerText=Timetracker.timelogs.tserecno===erecno?'<span id="dashboard_week_day_timer">'+minsWorked+'</span><span class="ZPcaltimer CP"><img class="FR" title="'+ZPI18N.getString("zp.stoptimer")+'" onclick="Timetracker.timelogs.pauseclock(this);" src="'+ZPeople.getResourceURL(newUIImageUrl+"timelog2.gif")+'"></span>':"<span>"+minsWorked+'</span><span class="ZPcaltimer CP"><img class="FR" title="'+ZPI18N.getString("zp.stoptimer")+'" onclick="Timetracker.util.showAlert(1,\''+ZPI18N.getString("zp.timeralert7")+'\');" src="'+ZPeople.getResourceURL(newUIImageUrl+"timelog2.gif")+'"></span>':Timetracker.timelogs.tserecno===erecno?timerText+='<span class="ZPcaltimer CP"><i class="IC-play grn" title="'+ZPI18N.getString("zp.resumetimer")+'" timerid="'+timerId+'" onclick="Timetracker.timelogs.nextStart(this);"></i></span>':timerText+='<span class="ZPcaltimer CP"><i class="IC-play grn" title="'+ZPI18N.getString("zp.resumetimer")+'" timerid="'+timerId+'" onclick="Timetracker.util.showAlert(1,\''+ZPI18N.getString("zp.timeralert7")+"');\"></i></span>");var html=$('<div id="dashboard_timelog_popover" class="zpwrkpop '+positionClass+'" '+style+'><span class="ZPcalvw-popuparw"></span><div class="ZPcalvw-box-label-txt '+jobColorClass+'"><span class="ZPcalvwbox-head"></span>'+timerText+"</div></div>");html.find(".ZPcalvwbox-head").attr("title",taskName).text(jobName),Layout.Page.container.append(html)},populatedayCalendar:function(calendarObj){if(Layout.Page.container.find("#zpcal_addpop").remove(),void 0===calendarObj){var calObj;if(jQuery.isEmptyObject(calendarObj)){(calObj=new NewCalendar.calObj).curYear=Calendar.getCurrentDay().day.getFullYear(),calObj.curMonth=(new Date).getMonth(),calObj.curDay=Calendar.getCurrentDay().day.getDay(),calObj.curdate=(new Date).getDate(),calObj.calcontId="daycalendardiv",calObj.outerdivId="zp_dashboard_calendar_view",calObj.divid="cal_body",calObj.callback=ZPCal.Calendar.populatedayCalendar,calObj.mode="dashboardcal",calObj.tdonclick=null,calObj.prearrow="IC-ar-lft",calObj.nextarrow="IC-ar-rgt",calObj.dashboardClass="ZP-monthtable";var dt=new Date;dt.setFullYear(calObj.curYear,calObj.curMonth,calObj.curdate),calObj.dateObj=dt,ZPCal.Calendar.dayCalendarObj=calObj}else(calObj=ZPCal.Calendar.dayCalendarObj).outerdivId="zp_dashboard_calendar_view";NewCalendar.initDayCalendar(calObj)}else{var fromDate=Calendar.formatDate(calendarObj.dateObj),mode=calendarObj.mode,currentUserId=NewCalendar.getCurrentUserErecno(mode);Timetracker.generalSettings.getSyncTimesheetSettings();var param={mode:"GET_WEEKEND_DEFINITION",fromDate:fromDate,toDate:fromDate,userErecNo:currentUserId,userLocation:ZPeople.getUserDetailsById(currentUserId).locId,conreqcsr:csrfToken};$.post("/commonAction.zp",param,function(resultData){calendarObj.weekendarray=resultData.weekendArray;var params={mode:"DAYCALENDAR_ACTION",userErecNo:ZPCal.getCurrUser(),fromDate:fromDate,toDate:fromDate,newsubmode:"timesheet",preMonth:0,view:"day",loadToday:!1,conreqcsr:csrfToken};$.post("/commonAction.zp",params,function(resultData){var tsObj={},tempDate="",resCont="",totLogHrs=0,tsJobs=(Calendar.getCurrentDay().day,{});if(ZPCal.Calendar.dayTimeSheetData={},void 0!==resultData.tsArr){Timetracker.util.setUserErecno(ZPCal.getCurrUser()),$.each(resultData.tsArr,function(index,data){if(data.taskName=ZPCal.Calendar.undefinedToEmpty(data.taskName),0!==index&&data.workDate!==tempDate){var tsTempObj={};tsTempObj.txt=resCont,tsTempObj.totHrs=Calendar.minstohrs(totLogHrs),tsTempObj.jobs=tsJobs,tsObj[tempDate]=tsTempObj,resCont="",totLogHrs=0,tsJobs={}}void 0!==data.timearr?$.each(data.timearr,function(index,timeSequence){resCont+=ZPCal.Calendar.populateTimelogbox(timeSequence.fromTime,timeSequence.toTime,data,timeSequence.timerId,timeSequence,index,data.isCurrentlyRunning)}):void 0!==data.fromTime&&0!==data.fromTime&&void 0!==data.toTime&&0!==data.toTime&&(resCont+=ZPCal.Calendar.populateTimelogbox(60*data.fromTime,60*data.toTime,data,data.timelogId)),totLogHrs+=data.hours;var jobObj={};void 0!==tsJobs[data.jobId]?(jobObj.jobId=data.jobId,jobObj.jobName=data.jobName,jobObj.jobHrs=data.hours+tsJobs[data.jobId].jobHrs):(jobObj.jobId=data.jobId,jobObj.jobName=data.jobName,jobObj.jobHrs=data.hours),tsJobs[data.jobId]=jobObj,tempDate=data.workDate});var tsTempObj={};tsTempObj.txt=resCont,tsTempObj.totHrs=Calendar.minstohrs(totLogHrs),tsTempObj.jobs=tsJobs,tsObj[tempDate]=tsTempObj}var resData=new Array,nextStartObj={nextStart:void 0,nextStartTxt:void 0},curDate=fromDate,data=resultData.attendanceReport[0],isAttOnDutyConfigured=resultData.isAttOnDutyConfigured;Attendance.isAllowToCapturePhotoInWeb=void 0!==resultData.isAllowToCapturePhotoInWeb&&resultData.isAllowToCapturePhotoInWeb,Attendance.isAllowToVerifyUserInWeb=void 0!==resultData.isAllowToVerifyUserInWeb&&resultData.isAllowToVerifyUserInWeb;var leaveObj,dayCalObj={},leaveDtl=(resCont="",""),absentClass="",isattDisabled=!1;if(void 0!==data){if(1==data.isToday&&(ZPCal.Calendar.todayDate=data.attDate,ZPCal.Calendar.allowedToCheckIn=data.isAllowedtoIn),void 0!==data.status&&""!==data.status){var statusDataArr=data.status.split(",");$.each(statusDataArr,function(index,statusData){var transStat=$("<div/>").text(Attendance.statusI18n(statusData)).html();transStat=(transStat=Attendance.remCommaInLast(transStat)).replace(/'/g,"&#039;").replace(/"/g,"&quot;"),-1!==statusData.indexOf("Weekend")?(leaveDtl+='<div class="ZPcalvw-box-bgcol "></div>',dayCalObj.attHead='<h6 class="ZPcalvwbox-head"><i class="Cl-wked"></i>Weekend</h6>'):-1!==statusData.indexOf("0.25 day Absent")?(leaveDtl+='<div class="ZPcalvw-box-bgcol Cl-absnt  '+ZPCal.Calendar.getSessionClass(data.session)+'"></div>',dayCalObj.attHead='<h6 class="ZPcalvwbox-head"><i class="Cl-absnt"></i>'+statusData+"</h6>"):-1!==statusData.indexOf("0.5 day Absent")?(data.session=void 0!==data.session?1==data.session?2:1:"",leaveDtl+='<div class="ZPcalvw-box-bgcol Cl-absnt '+absentClass+" "+ZPCal.Calendar.getSessionClass(data.session,!0)+'"></div>',dayCalObj.attHead='<h6 class="ZPcalvwbox-head"><i class="Cl-absnt"></i>'+statusData+"</h6>"):-1!==statusData.indexOf("Absent")?leaveDtl='<div class="ZPcalvw-box-bgcol Cl-absnt"><h6 class="ZPcalvwbox-head"><i class="Cl-absnt"></i>'+statusData+"</h6></div>":-1!==statusData.indexOf("0.5 day Holiday")?(leaveDtl='<div class="ZPcalvw-box-bgcol Cl-hlday'+ZPCal.Calendar.getSessionClass(data.session,!0)+'"><h6 class="ZPcalvwbox-head"><i class="Cl-hlday"></i>'+statusData+"</h6></div>",absentClass="ZPcalvw-Thfd"):(-1!==statusData.indexOf("Holiday")||Att_Common_Operations.isRestrictedHoliday(statusData))&&(leaveDtl='<div class="ZPcalvw-box-bgcol Cl-hlday"><h6 class="ZPcalvwbox-head"><i class="Cl-hlday"></i>'+ZPeople.escapeHtml(statusData)+"</h6></div>"),isAttOnDutyConfigured&&-1!==statusData.indexOf("On Duty")&&(leaveDtl+='<div class="ZPcalvw-box-bgcol LT3"><span>'+transStat+"</span></div>")})}}else isattDisabled=!0;if(void 0!==resultData.leaveArr&&void 0!==(leaveObj=resultData.leaveArr[0][curDate]))if(void 0===leaveObj[0]){if(tempObj=leaveObj,0!==tempObj.count)leaveDtl+='<div class="ZPcalvw-box-bgcol LT'+tempObj.ltyp_color+" "+ZPCal.Calendar.getSessionClass(tempObj.session,!(tempObj.count<.5))+'"><span>'+ZPeople.escapeHtml(tempObj.ltyp_name)+"</span></div>";else if(isattDisabled&&void 0!==resultData.leaveReport){var leaveData=resultData.leaveReport[curDate];void 0!==leaveData&&(leaveDtl='<div class="ZPcalvw-box-bgcol Cl-hlday"><h6 class="ZPcalvwbox-head"><i class="Cl-hlday"></i>'+leaveData.name+"</h6></div>")}}else for(var cnt=0;cnt<leaveObj.length;cnt++)tempObj=leaveObj[cnt],void 0!==tempObj&&0!==tempObj.count&&(leaveDtl+='<div class="ZPcalvw-box-bgcol LT'+tempObj.ltyp_color+" "+ZPCal.Calendar.getSessionClass(tempObj.session,!(tempObj.count<.5))+'"><span>'+ZPeople.escapeHtml(tempObj.ltyp_name)+"</span></div>");resCont=ZPCal.Calendar.constructAttendanceList(data,nextStartObj,dayCalObj),leaveDtl=leaveDtl+'<div class="ZPcalvw-box-main-wkdayltbox">'+resCont+(void 0!==tsObj[curDate]?tsObj[curDate].txt:"")+"</div>",void 0!==tsObj[curDate]?(dayCalObj.txt=leaveDtl,dayCalObj.tsHrs=tsObj[curDate].totHrs,dayCalObj.jobs=tsObj[curDate].jobs):dayCalObj.txt=leaveDtl,void 0!==data&&"00:00"!==data.tHrs&&(dayCalObj.attHrs=data.tHrs),resData.push(dayCalObj),NewCalendar.clearOldvalues(calendarObj,1),NewCalendar.populateDayCalendar(calendarObj,resData)})})}},undefinedToEmpty:function(value){return void 0===value&&(value=""),value},setPopUpPostion:function(event,curBoxObj){var left,top,cssClass;$(curBoxObj).is(":visible")&&($(curBoxObj).offset().left,$(curBoxObj).offset().top);NewCalendar.bannerHtCalc();var popupwidth=Layout.Page.container.find("#zpcal_addpop").width(),popupheight=Layout.Page.container.find("#zpcal_addpop").height(),winHei=$(window).height(),winWid=$(window).width(),mouposX=event.clientX,mouposY=event.clientY;if(showNewTab){left=mouposX-(lftCont=60),cssClass="top",top=mouposY,top-=Layout.Page.pageContWrapper.find(".zpl_usrprfdv").length>0?130:80}else if("calendar/dashboardcalendar"!==Layout.Page.currentmode||"home/dashboard/calendar"!==Layout.Page.currentmode||"selfservice/user/calendar"!==Layout.Page.currentmode){var isNewUI=ZPeople.isZPNewUI(),isSelfService=!1;"selfservice/user/calendar"===Layout.Page.currentmode&&(isSelfService=!0);var lftCont;(left=mouposX-(lftCont=isNewUI?isSelfService?330:0:$("body").hasClass("ZPsbarMini")?350:500))+popupwidth>winWid-lftCont?(left-=popupwidth-50,cssClass="top top_rgt"):cssClass="top",(top=mouposY)+popupheight>winHei?(top=top-2*popupheight+30,cssClass="bottom",mouposX-lftCont+popupwidth>winWid-lftCont&&(cssClass="bottom btm_rgt")):(isSelfService&&(top+=Layout.Page.parentContainer.find(".Scrcont").scrollTop()),top-=isNewUI?isSelfService?200:0:50)}return{top:top,left:left,classname:cssClass}},showAddpopUp:function(event,Obj,dateObj,calObj){var month,date,year;if(Layout.Page.container.find("#dashboard_timelog_popover").remove(),event.stopPropagation(),void 0!==dateObj){var currDate=dateObj.split("-");month=parseInt(currDate[0]),date=parseInt(currDate[1]),year=currDate[2]}var mode=calObj.mode;Layout.Page.container.find("#zpcal_addpop").remove();var pophtml='<div class="ZPcalvw-addpopup" id="zpcal_addpop"><span class="ZPcalvw-popuparw"></span><ul class="ZPcalvw-addpopup-cnt">';if(void 0!==mode&&("timesheet"!==mode&&-1!==ZPTabs.ACTIVE_TABARR.indexOf("leavetracker")&&(-1!=Layout.Page.currentmode.indexOf("leavetracker/")&&-1!=Layout.Page.currentmode.indexOf("/summary")||"home/dashboard/calendar"===Layout.Page.currentmode||"calendar/dashboardcalendar"===Layout.Page.currentmode||SelfService.Info.allow_add_leave)&&(pophtml+='<li id="zpcal_appLeave"><a>'+ZPI18N.getString("zp.leave.apply")+"</a></li>"),"dashboardcal"===mode&&!ZPTabs.isTabHidden("timetracker")&&Timetracker.util.allowAddingTimelogs()&&(pophtml+='<li id="zpcal_appLog"><a>'+ZPI18N.getString("zp.logtime")+"</a></li>"),("dashboardcal"===mode||"attendance"===mode)&&-1!==ZPTabs.ACTIVE_TABARR.indexOf("attendance"))){var d=year+"-"+(month<=9?"0"+month:month)+"-"+(date<=9?"0"+date:date);ZPCal.Calendar.todayDate===d&&ZPCal.getCurrUser()===erecno&&(pophtml+='<li class="ZPcalvw-checkbox" id="zpcal_checkInOut"> <a > <span id="attStatusName">'+(1==ZPCal.Calendar.allowedToCheckIn?"Check out":"Check In")+'</span> <label class="btnactive"> <input id="attStatusIcon" class="cmn-toggle-small cmn-toggle-round-small"  type="checkbox"> <span ></span> </label> </a> </li>')}if(pophtml+="</ul></div>",pophtml=$(pophtml),month-=1,"dashboardcal"===mode){if(-1!==ZPTabs.ACTIVE_TABARR.indexOf("leavetracker")&&pophtml.find("#zpcal_appLeave").on("click",function(){ZPCal.Calendar.showCalendarPopUp(calObj,"leave",year,month,date)}),-1!==ZPTabs.ACTIVE_TABARR.indexOf("timetracker")&&pophtml.find("#zpcal_appLog").on("click",function(){ZPCal.Calendar.showCalendarPopUp(Obj,"timelog",year,month,date)}),0!==Layout.Page.container.find("#weekcal").length){$(Layout.Page.container.find(".ZPcalvw")[0]).append(pophtml);var popJson=ZPCal.Calendar.setPopUpPostion(event,Layout.Page.container.find("#zpcal_addpop"));pophtml.css({transform:"translate(0, 0%)",left:popJson.left+"px",top:popJson.top+"px"}),pophtml.addClass(popJson.classname)}else{$(Layout.Page.container.find(".ZPcalvw")[0]).append(pophtml),"top"===(popJson=ZPCal.Calendar.setPopUpPostion(event,Layout.Page.container.find("#zpcal_addpop"))).classname.trim()&&(popJson.left=popJson.left-200,popJson.classname="top top_rgt"),pophtml.css({transform:"translate(0, 0%)",left:popJson.left+"px",top:popJson.top+"px"}),pophtml.addClass(popJson.classname)}ZPCal.Calendar.attendanceStatusHandle(),$(document).on("click",function(e){0===$(e.target).parents("#zpcal_addpop").length&&Layout.Page.container.find("#zpcal_addpop").remove()})}else"timesheet"===mode?-1!==ZPTabs.ACTIVE_TABARR.indexOf("timetracker")&&ZPCal.Calendar.showCalendarPopUp(Obj,"timelog",year,month,date):"leave"==mode&&-1!=Layout.Page.currentmode.indexOf("leavetracker/")&&-1!=Layout.Page.currentmode.indexOf("/summary")&&-1!==ZPTabs.ACTIVE_TABARR.indexOf("leavetracker")&&ZPCal.Calendar.showCalendarPopUp(calObj,"leave",year,month,date)},showAttInfoPopUp:function(calObj){Layout.Page.container.find("#"+calObj.divid).on("click",".zpl_shftdts",function(e){e.stopPropagation();var month,year,dateObj=$(this).parents("td").attr("date");if(void 0!==dateObj){var currDate=dateObj.split("-");month=parseInt(currDate[0])-1,date=parseInt(currDate[1]),year=parseInt(currDate[2])}var ftime=$(this).data("ftime"),ttime=$(this).data("ttime");if(void 0!==ftime&&null!==ftime&&""!==ftime||void 0!==ttime&&null!==ttime&&""!==ttime){var popup,date=new Date(year,month,date);if($(this).hasClass("zpl_prsntBgbdr")&&void 0!==date)Layout.Page.container.find("#checkInOutpop").remove(),void 0!==ftime&&0==$(this).siblings("#checkInOutpop").length&&(popup=$('<div class="ZPcalvw-atdepopup" id="checkInOutpop"><div class="ZPcalvw-atdepopup-hd"> <span>'+date.getDate()+" "+ZPDateTime.months_short[date.getMonth()]+" "+date.getFullYear()+'</span> <a class="ZPcalvw-atdepopup-close"><i class="PI_cls"></i></a> </div> <div class="ZPcalvw-atdepopup-cnt"> <div class="ZPcalvwbox-head"><em>'+ZPI18N.getString("zp.checkin")+'</em><span class="grn">'+ftime+"</span></div>"+(void 0!==ttime?'<div class="ZPcalvwbox-head"><em>'+ZPI18N.getString("zp.checkout")+'</em><span class="red">'+ttime+"</span></div>":"")+"</div> </div>")),$(popup).find("#zpcal_appLeave").on("click",function(){ZPCal.Calendar.showCalendarPopUp(calObj,"leave",year,month,date),Layout.Page.container.find("#checkInOutpop").remove(),$("body").removeClass("zpcalact")}),$(popup).find(".ZPcalvw-atdepopup-close").on("click",function(e){Layout.Page.container.find("#checkInOutpop").remove(),$("body").removeClass("zpcalact")}),$(this).after(popup),$("body").addClass("zpcalact");$(document).on("click",function(e){0===$(event.target).parents("#checkInOutpop").length&&(Layout.Page.container.find("#checkInOutpop").remove(),$("body").removeClass("zpcalact"))})}})},showCalendarPopUp:function(Obj,type,year,month,date){if("timelog"===type&&-1!==ZPTabs.ACTIVE_TABARR.indexOf("timetracker"))ZPCal.Calendar.applyLog(Obj,year,month,date);else if("leave"===type&&-1!==ZPTabs.ACTIVE_TABARR.indexOf("leavetracker"))if(showNewTab){var d=new Date;d.setFullYear(year,month,date);var selectedDate=Calendar.formatDate(d);ZPCal.Calendar.applyLvDate=selectedDate,LVUtil.urls.prevUrl.setHash(),window.location.href=LVUtil.urls.getUrlAsHash(LVUtil.urls.ListView.ADD())}else ZPCal.Calendar.applyLeave(year,month,date)},isDashboardCal:function(){var isDashboardCal=!1;return ZPeople.isZPNewUI()&&-1!==Layout.Page.currentmode.indexOf("calendar/dashboardcalendar")?isDashboardCal=!0:ZPeople.isZPNewUI()||-1===Layout.Page.currentmode.indexOf("home/dashboard/calendar")||(isDashboardCal=!0),isDashboardCal},isSelfServiceCal:function(){return!(!ZPeople.isZPNewUI()||-1===Layout.Page.currentmode.indexOf("selfservice/user/calendar"))},applyLog:function(Obj,year,month,date){showNewTab?Timetracker.timelogs.calendar.addTimelog(year,month,date):Timetracker.timelogs.calendarplus(Obj,year,month,date)},applyLeave:function(year,month,date){var mode;Layout.Page.container.find("#calendar3").fadeOut("300"),-1!==Layout.Page.currentmode.indexOf("/dashboardcalendar")?mode="calendar-dashboardcalendar":-1!==Layout.Page.currentmode.indexOf("/dashboard/calendar")?mode="home-dashboard-calendar":-1!==Layout.Page.currentmode.indexOf("/views/calendar")?mode="leavetracker":-1!==Layout.Page.currentmode.indexOf("/entry/calendarview")&&(mode="attendance");var formId=!!ZPeople.Module.MODULE_DATA[mode]&&ZPeople.Module.MODULE_DATA[mode].formid,d=new Date;d.setFullYear(year,month,date);var selectedDate=Calendar.formatDate(d),params={formId:formId,lookupValue:-1!=Layout.Page.currentmode.indexOf("/dashboard")?ZPCal.getCurrUser():SelfService.getUserId(),defaultDateValue:selectedDate,callback:function(){ZPCal.Calendar.refresh&&0!==Layout.Page.container.find(".ZPcalvw").length&&("month"==ZPCal.Calendar.CURMODE?ZPCal.Calendar.populateCalendar(ZPCal.Calendar.calendarObj):"week"==ZPCal.Calendar.CURMODE?ZPCal.Calendar.populateWeekCalendar(ZPCal.Calendar.weekCalendarObj):"day"==ZPCal.Calendar.CURMODE&&ZPCal.Calendar.populatedayCalendar(ZPCal.Calendar.dayCalendarObj))}};Leave.add(params)},TimelogLocationinit:function(){Timetracker.location.navigatorGeoReturn()}};