var Timetracker={},TimetrackerOperations={};Timetracker.isDataAdmin=function(){return Timetracker.isDataAdminForAllUsers()||Timetracker.isDataAdminForSpecificUsers()},Timetracker.isDataAdminForAllUsers=function(){return!!isadmin||(Timetracker.setInitModuleData(),ZPeople.Module.MODULE_DATA.timetracker.isTTDataAdminForAllUsers)},Timetracker.isDataAdminForSpecificUsers=function(){return Timetracker.setInitModuleData(),ZPeople.Module.MODULE_DATA.timetracker.isTTDataAdmin},Timetracker.isDataAdminForUser=function(user){if(void 0!==user){if(Timetracker.isDataAdminForAllUsers())return!0;if(Timetracker.isDataAdminForSpecificUsers()&&Timetracker.dataAdminApplicableUsers)return-1!==Timetracker.dataAdminApplicableUsers.indexOf(""+user)}return!1},Timetracker.isSettingsAdmin=function(){return!!isadmin||(Timetracker.setInitModuleData(),ZPeople.Module.MODULE_DATA.timetracker.isTTSettingsAdmin)},Timetracker.isTTCustomAdminForUser=function(type,user){if(void 0!==user)switch(type){case Timetracker.constants.TTCustomAdmin.EntryEdit:return!!Timetracker.ttCustomAdminEntryEditOpApplicableUsers&&-1!==Timetracker.ttCustomAdminEntryEditOpApplicableUsers.indexOf(""+user);case Timetracker.constants.TTCustomAdmin.EntryView:return!!Timetracker.ttCustomAdminEntryViewOpApplicableUsers&&-1!==Timetracker.ttCustomAdminEntryViewOpApplicableUsers.indexOf(""+user)}return!1},Timetracker.isTTCustomAdmin=function(type){switch(Timetracker.setInitModuleData(),type){case Timetracker.constants.TTCustomAdmin.ReportView:return ZPeople.Module.MODULE_DATA.timetracker.isTTCustomAdminForReports;case Timetracker.constants.TTCustomAdmin.EntryView:return ZPeople.Module.MODULE_DATA.timetracker.isTTCustomAdminForEntriesView;case Timetracker.constants.TTCustomAdmin.EntryEdit:return ZPeople.Module.MODULE_DATA.timetracker.isTTCustomAdminForEntriesEdit}},Timetracker.isTTCustomAdminForAny=function(){return Timetracker.setInitModuleData(),ZPeople.Module.MODULE_DATA.timetracker.isTTCustomAdminForReports||ZPeople.Module.MODULE_DATA.timetracker.isTTCustomAdminForEntriesView},Timetracker.setInitModuleData=function(){void 0===ZPeople.Module.MODULE_DATA.timetracker&&ZPeople.Request.sendAsyncPost(Timetracker.constants.URL,{mode:"getTTInitModuleData",getAdminPerms:!0,checkIfTimelogAddRestricted:!0},function(response){1===response.res&&(ZPeople.Module.MODULE_DATA.timetracker=$.extend(ZPeople.Module.MODULE_DATA.timetracker,response.resObj),Timetracker.dataAdminApplicableUsers=void 0!==response.resObj.dataAdminApplicableUsers?response.resObj.dataAdminApplicableUsers:Timetracker.dataAdminApplicableUsers,Timetracker.ttCustomAdminEntryEditOpApplicableUsers=void 0!==response.resObj.ttCustomAdminEntryEditOpApplicableUsers?response.resObj.ttCustomAdminEntryEditOpApplicableUsers:Timetracker.ttCustomAdminEntryEditOpApplicableUsers,Timetracker.ttCustomAdminEntryViewOpApplicableUsers=void 0!==response.resObj.ttCustomAdminEntryViewOpApplicableUsers?response.resObj.ttCustomAdminEntryViewOpApplicableUsers:Timetracker.ttCustomAdminEntryViewOpApplicableUsers,Timetracker.util.restrictTimelogAdd=response.resObj.restrictTimelogAdd)})},Timetracker.isTTSthiftEnabled=function(){return 1==ZPeople.Module.MODULE_DATA.timetracker.isTTShiftEnabled},Timetracker.setWorkitemCache=function(detailsJson,isSendRequest){if(void 0===Timetracker.timelogs.workItem.workItemDetailsCache||void 0===Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped||isSendRequest){let params=Timetracker.timelogs.workItem.getWorkItemparams(detailsJson);ZPeople.Request.sendAsyncPost(Timetracker.constants.URL,params,function(response){response&&"1"===response.res&&response.workitemListing&&Timetracker.timelogs.workItem.setWorkItemData(response.workitemListing,params)})}},Timetracker.setWorkitems=async function(detailsJson,isSendRequest){if(void 0===Timetracker.timelogs.workItem.workItemDetailsCache||void 0===Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped||isSendRequest){let params=Timetracker.timelogs.workItem.getWorkItemparams(detailsJson);var[response]=await ZPeople.Request.sendRequestAsPromise(Timetracker.constants.URL,params);response&&"1"===response.res&&response.workitemListing&&Timetracker.timelogs.workItem.setWorkItemData(response.workitemListing,params)}},Timetracker.initSetup=function(){if(void 0===ZPeople.Module.MODULE_DATA.timetracker||void 0===ZPeople.Module.MODULE_DATA.timetracker.settingDetails){var params={initmodule:JSON.stringify({modulePrefix:"timetracker"})};ZPeople.Request.sendAsyncPost("/gettabdetails/initpage",params,function(result){result.initmodule&&(ZPeople.Module.MODULE_DATA.timetracker=result.initmodule)})}Timetracker.generalSettings.settingDetails=null===Timetracker.generalSettings.settingDetails?ZPeople.Module.MODULE_DATA.timetracker.settingDetails:Timetracker.generalSettings.settingDetails,0===Object.keys(Timetracker.generalSettings.timelogEnabledFields).length&&Timetracker.generalSettings.updateTimelogCustFieldsCache(Timetracker.generalSettings.settingDetails),Timetracker.generalSettings.userBasedSettings=null===Timetracker.generalSettings.userBasedSettings?ZPeople.Module.MODULE_DATA.timetracker.userBasedSettings:Timetracker.generalSettings.userBasedSettings,Timetracker.jobs.formDetails=void 0!==ZPeople.Module.MODULE_DATA.timetracker.formDetails.P_TimesheetJob?ZPeople.Module.MODULE_DATA.timetracker.formDetails.P_TimesheetJob:null,Timetracker.projects.formDetails=void 0!==ZPeople.Module.MODULE_DATA.timetracker.formDetails.P_TimesheetJobsList?ZPeople.Module.MODULE_DATA.timetracker.formDetails.P_TimesheetJobsList:null,Timetracker.clients.formDetails=void 0!==ZPeople.Module.MODULE_DATA.timetracker.formDetails.P_ClientDetails?ZPeople.Module.MODULE_DATA.timetracker.formDetails.P_ClientDetails:null,Timetracker.timelogs.formDetails=void 0!==ZPeople.Module.MODULE_DATA.timetracker.formDetails.P_Timesheet?ZPeople.Module.MODULE_DATA.timetracker.formDetails.P_Timesheet:null,Timetracker.util.checkAddJobPermVar=Timetracker.forms.isPermAllowed(Timetracker.constants.JOB_TABLE,"ADD"),Timetracker.util.checkAddProjectPermVar=Timetracker.forms.isPermAllowed(Timetracker.constants.PROJECT_TABLE,"ADD"),Timetracker.util.checkAddClientPermVar=Timetracker.forms.isPermAllowed(Timetracker.constants.CLIENT_TABLE,"ADD"),Timetracker.dataAdminApplicableUsers=ZPeople.Module.MODULE_DATA.timetracker.dataAdminApplicableUsers?ZPeople.Module.MODULE_DATA.timetracker.dataAdminApplicableUsers:null,Timetracker.ttCustomAdminEntryEditOpApplicableUsers=void 0!==ZPeople.Module.MODULE_DATA.timetracker.ttCustomAdminEntryEditOpApplicableUsers?ZPeople.Module.MODULE_DATA.timetracker.ttCustomAdminEntryEditOpApplicableUsers:null,Timetracker.ttCustomAdminEntryViewOpApplicableUsers=void 0!==ZPeople.Module.MODULE_DATA.timetracker.ttCustomAdminEntryViewOpApplicableUsers?ZPeople.Module.MODULE_DATA.timetracker.ttCustomAdminEntryViewOpApplicableUsers:null,Timetracker.util.restrictTimelogAdd=ZPeople.Module.MODULE_DATA.timetracker.restrictTimelogAdd,ZPMaps.loadStatic(),Timetracker.currentlyRunningTimer.resetHangingTimer(),Timetracker.util.init()},Timetracker.permissionCheckForOperPages=function(){var niceUrl=settingsUrlProps.niceUrl;if(-1==niceUrl.indexOf("operations"))return!0;if((-1!=niceUrl.indexOf("operations/timetracker/timelogs")||-1!=niceUrl.indexOf("operations/timetracker/clients/")||-1!=niceUrl.indexOf("operations/timetracker/projects/")||-1!=niceUrl.indexOf("operations/timetracker/timesheets")||-1!=niceUrl.indexOf("operations/timetracker/jobs/")||0==niceUrl.indexOf("operations/timetracker/searchuser/"))&&(Timetracker.isDataAdmin()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryView)))return!0;if("operations/timetracker/jobschedule/list"==niceUrl&&Timetracker.jobSchedule.isJobScheduleEnabled()&&(Timetracker.isDataAdmin()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.EntryView)))return!0;if("operations/timetracker/billing"==niceUrl&&Timetracker.isDataAdminForAllUsers())return!0;if("operations/timetracker/jobschedule/location"==niceUrl&&Timetracker.isDataAdminForAllUsers())return!0;if("operations/timetracker/integrations"==niceUrl&&(Timetracker.isDataAdmin()||Timetracker.isTTCustomAdmin(Timetracker.constants.TTCustomAdmin.ReportView)))return!0;if("operations/timetracker/payroll"==niceUrl&&Timetracker.isSettingsAdmin())return!0;var container=Timetracker.Util.getLayout();return 0==niceUrl.indexOf("timetracker")||(container.html("<div class='zpl_rgtcnt'></div>"),Timetracker.Util.showHideNoData({div:container,msg:ZPI18N.getString("zp.notallowedforpage"),cls:"zp_nd_permission"}),!1)},Timetracker.util={DAILY:"0",WEEKLY:"1",MONTHLY:"2",CUSTOM:"3",CUSTOM_TL:"6",MODE:"timetracker",restrictTimelogAdd:!1,checkAddProjectPermVar:!1,checkAddJobPermVar:!1,checkEditProjectPermVar:!1,checkEditJobPermVar:!1,iperrorreturn:"<script type='text/javascript'>parent.Timetracker.showIPErrorAlert()<\/script>",geoerrorreturn:"Operation Restricted in this Geo Range",enableaccesstolocation:"Please allow access to your location",defaultbillingType:"0",rateRegex:/^(([\d]*[.][\d]+)|([\d]+))$/i,maxhrsRegex:/^(([\d]{0,3}[.|:][\d]{1,2})|([\d]{1,4}))$/i,maxWeekHrsRegex:/^(([\d]{0,4}[.|:][\d]{1,2})|([\d]{1,4}))$/i,emailRegex:/^([A-Za-z0-9-._%-+]+@[A-Za-z0-9.-]+\.[a-zA-Z]{2,6}(,?))+$/i,timeRegex:/^([0-9]{0,3})$/i,jobAddhrsRegex:/^(([\d]{0,4}[.|:][\d]{1,2})|([\d]{1,4}))$/i,emailExp:/^[\w\-\.\+]+\@[a-zA-Z0-9\.\-]+\.[a-zA-z0-9]{2,6}$/,phoneExp:/^[A-Za-z0-9\-\_]+$/,countriesOption:null,jobDispName:ZPI18N.getString("zp.jobs"),projectDispName:ZPI18N.getString("zp.projects"),clientDispName:ZPI18N.getString("zp.clients"),permissionDenied_HTML:'<div id="permission_denied" class="ZPND Scrcont"><div class="PAdms"></div><h4>'+ZPI18N.getString("zp.permissiondenied")+"</h4></div>",EMPTY_DATA_HTML:'<div id="zp_empty_data"><div id="zp_empty_data_in"></div></div>',init:function(){var layout=Layout.Page.container;if(0===layout.length&&(layout=settingsPage.container),Timetracker.jobs.formDetails=Timetracker.util.getFormDetails(Timetracker.jobs.formDetails,"P_TimesheetJob"),Timetracker.projects.formDetails=Timetracker.util.getFormDetails(Timetracker.projects.formDetails,"P_TimesheetJobsList"),Timetracker.clients.formDetails=Timetracker.util.getFormDetails(Timetracker.clients.formDetails,"P_ClientDetails"),Timetracker.util.jobDispName=void 0!==Timetracker.jobs.formDetails&&void 0!==Timetracker.jobs.formDetails.formDispName?Timetracker.jobs.formDetails.formDispName:ZPI18N.getString("zp.jobs"),Timetracker.util.projectDispName=void 0!==Timetracker.projects.formDetails&&void 0!==Timetracker.projects.formDetails.formDispName?Timetracker.projects.formDetails.formDispName:ZPI18N.getString("zp.projects"),Timetracker.util.clientDispName=void 0!==Timetracker.clients.formDetails&&void 0!==Timetracker.clients.formDetails.formDispName?Timetracker.clients.formDetails.formDispName:ZPI18N.getString("zp.clients"),Timetracker.util.workitemDispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.WORKITEM),Timetracker.util.descriptionDispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.DESC),Timetracker.util.attachmentDispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.ATTACHMENT),void 0!==Timetracker.jobs.formDetails&&void 0!==Timetracker.jobs.formDetails.labelDetails&&(layout.find(".form_jobname").html(Timetracker.jobs.formDetails.labelDetails.JOBNAME),layout.find(".form_sdate").html(Timetracker.jobs.formDetails.labelDetails.STARTDATE).attr("title",ZPeople.decodeTxt(Timetracker.jobs.formDetails.labelDetails.STARTDATE)),layout.find(".form_edate").html(Timetracker.jobs.formDetails.labelDetails.ENDDATE).attr("title",ZPeople.decodeTxt(Timetracker.jobs.formDetails.labelDetails.ENDDATE)),(layout.find(".form_jobname").hasClass("ellipsis")||layout.find(".form_jobname").hasClass("tt_add_title"))&&layout.find(".form_jobname").attr("title",ZPeople.decodeTxt(Timetracker.jobs.formDetails.labelDetails.JOBNAME))),void 0!==Timetracker.util.workitemDispName&&(layout.find(".form_workitemname").html(Timetracker.util.workitemDispName),(layout.find(".form_workitemname").hasClass("ellipsis")||layout.find(".form_workitemname").hasClass("tt_add_title"))&&layout.find(".form_workitemname").attr("title",ZPeople.decodeTxt(Timetracker.util.workitemDispName))),void 0!==Timetracker.util.descriptionDispName&&(layout.find(".form_descname").html(Timetracker.util.descriptionDispName),(layout.find(".form_descname").hasClass("ellipsis")||layout.find(".form_descname").hasClass("tt_add_title"))&&layout.find(".form_descname").attr("title",ZPeople.decodeTxt(Timetracker.util.descriptionDispName))),void 0!==Timetracker.projects.formDetails&&void 0!==Timetracker.projects.formDetails.labelDetails&&(layout.find(".form_projectname").html(Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME),(layout.find(".form_projectname").hasClass("ellipsis")||layout.find(".form_projectname").hasClass("tt_add_title"))&&layout.find(".form_projectname").attr("title",ZPeople.decodeTxt(Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME))),void 0!==Timetracker.clients.formDetails.labelDetails&&layout.find(".form_clientname").html(Timetracker.clients.formDetails.labelDetails.CLIENTNAME),layout.find(".form_jobs").html(Timetracker.util.jobDispName),0!==layout.find(".form_jobs.singluar_name").length){var jobDispName=Timetracker.util.getJobDisplayName(!0);layout.find(".form_jobs.singluar_name").html(jobDispName)}if((layout.find(".form_jobs").hasClass("ellipsis")||layout.find(".form_jobs").hasClass("zptbjbs_fnt")||layout.find(".form_jobs").hasClass("tt_add_title"))&&layout.find(".form_jobs").attr("title",ZPeople.decodeTxt(Timetracker.util.jobDispName)),layout.find(".form_projects").html(Timetracker.util.projectDispName),0!==layout.find(".form_projects.singluar_name").length){var projectDispName=Timetracker.util.getProjectDisplayName(!0);layout.find(".form_projects.singluar_name").html(projectDispName)}if((layout.find(".form_projects").hasClass("ellipsis")||layout.find(".form_projects").hasClass("zptbjbs_fnt")||layout.find(".form_projects").hasClass("tt_add_title"))&&layout.find(".form_projects").attr("title",ZPeople.decodeTxt(Timetracker.util.projectDispName)),layout.find(".form_clients").html(Timetracker.util.clientDispName),0!==layout.find(".form_clients.singluar_name").length){var clientDispName=Timetracker.util.getClientDisplayName(!0);layout.find(".form_clients.singluar_name").html(clientDispName)}(layout.find(".form_clients").hasClass("ellipsis")||layout.find(".form_clients").hasClass("zptbjbs_fnt")||layout.find(".form_clients").hasClass("tt_add_title"))&&layout.find(".form_clients").attr("title",Timetracker.util.clientDispName)},allowAddingTimelogs:function(){return Timetracker.setInitModuleData(),!Timetracker.util.restrictTimelogAdd},getJobDisplayName:function(needSingular,needLowerCase){needSingular=!!needSingular,needLowerCase=!!needLowerCase;return"Jobs"===Timetracker.util.jobDispName?needSingular?needLowerCase?ZPI18N.getString("zp.sjob"):ZPI18N.getString("zp.job"):needLowerCase?ZPI18N.getString("zp.sjobs"):Timetracker.util.jobDispName:Timetracker.util.jobDispName},getProjectDisplayName:function(needSingular,needLowerCase){needSingular=!!needSingular,needLowerCase=!!needLowerCase;return"Projects"===Timetracker.util.projectDispName?needSingular?needLowerCase?ZPI18N.getString("zp.sproject"):ZPI18N.getString("zp.project"):needLowerCase?ZPI18N.getString("zp.sprojects"):Timetracker.util.projectDispName:Timetracker.util.projectDispName},getClientDisplayName:function(needSingular,needLowerCase){needSingular=!!needSingular,needLowerCase=!!needLowerCase;return"Clients"===Timetracker.util.clientDispName?needSingular?needLowerCase?ZPI18N.getString("zp.sclient"):ZPI18N.getString("zp.client"):needLowerCase?ZPI18N.getString("zp.sclients"):Timetracker.util.clientDispName:Timetracker.util.clientDispName},getStartAndEnddateDisplayName:function(isSmallCaseNeeded){var needSmallCase=!0,dateJson={},sDate=Timetracker.jobs.formDetails.labelDetails.STARTDATE,eDate=Timetracker.jobs.formDetails.labelDetails.ENDDATE;return void 0===isSmallCaseNeeded?0===Layout.Page.container.find(".small_case").length&&(needSmallCase=!1):needSmallCase=isSmallCaseNeeded,needSmallCase&&("Start Date"===sDate&&(sDate=ZPI18N.getString("zp.smallsdate")),"End Date"===eDate&&(eDate=ZPI18N.getString("zp.smalledate"))),dateJson.sdatename=sDate,dateJson.edatename=eDate,dateJson},getWorkItemDispName:function(needPlural=!1,needLowerCase=!1){return"Work Item"===Timetracker.util.workitemDispName?needPlural?needLowerCase?ZPI18N.getString("zp.sworkitems"):ZPI18N.getString("zp.workitems"):needLowerCase?ZPI18N.getString("zp.sworkitem"):ZPI18N.getString("zp.workitem"):Timetracker.util.workitemDispName},getDescriptionDispName:function(needLowerCase){return"Description"===Timetracker.util.descriptionDispName?needLowerCase?ZPI18N.getString("zp.sdescription"):ZPI18N.getString("zp.description"):Timetracker.util.descriptionDispName},getFormsLabelDisplayName:function(labelName){return"jobName"===labelName?Timetracker.jobs.formDetails&&Timetracker.jobs.formDetails.labelDetails?Timetracker.jobs.formDetails.labelDetails.JOBNAME:ZPI18N.getString("zp.jobname"):"projectName"===labelName?Timetracker.projects.formDetails&&Timetracker.projects.formDetails.labelDetails?Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME:ZPI18N.getString("zp.projectname"):void 0},showIPErrorAlert:function(){return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.geoiprestriction",["IP"])),!1},showGeoErrorAlert:function(isLocEnabled){return ZPeople.Message.showFailureMsg(!0===isLocEnabled?ZPI18N.getString("zp.geoiprestriction",["Geo"]):ZPI18N.getString("zp.enableaccesstolocation")),!1},checkIfSelectHasValue:function($elm,val){var exists=!1;return $elm.find("option").each(function(){if(this.value==val)return exists=!0,!1}),exists},showAlert:function(type,msg){var obj=ModuleComp.Msg;switch(type){case 0:obj.showFailureMsg(msg);break;case 1:obj.showWarningMsg(msg);break;case 2:obj.showSuccessMsg(msg)}},uploadFile:function(file,entity,callback){if(!(file.size>maxFileSizeBytes||file.size<=0)){var xhr=new XMLHttpRequest,uploadId=(new Date).getTime()+"_"+_LOGGEDIN_ZUID;xhr.upload.uploadId=uploadId;var udsUploadApi=UPLOAD_URL+"/"+UDS_UPLOAD_SERVICE_CODE+"/ver1/stream/upload";xhr.open("post",udsUploadApi,!0),void 0!=ZPeople.zaid&&xhr.setRequestHeader("x-cli-zaid",ZPeople.zaid),xhr.setRequestHeader("x-assured-response",!0),xhr.setRequestHeader("x-streammode","1"),xhr.setRequestHeader("x-fclient-version","2"),xhr.setRequestHeader("app-info",JSON.stringify({portalId:_LOGGEDIN_ACCZSOID,zaid:ZPeople.zaid,moduleName:"Timetracker",entity:entity})),xhr.setRequestHeader("file-info",JSON.stringify({fileName:encodeURIComponent(file.name),contentType:file.type,fileSize:file.size})),xhr.setRequestHeader("upload-id",uploadId),xhr.withCredentials=!0,xhr.onreadystatechange=function(oEvent){4==xhr.readyState&&(200===xhr.status?callback(JSON.parse(xhr.response)):callback())},xhr.send(file)}},downloadFile:function(attachmentId,recordId,entity){var downloadUrl="";if(UDS_DOWNLOAD_IS_ACTIVE){var downloadParams={portalId:_LOGGEDIN_ACCZSOID,mode:"Timetracker",recordId:recordId,original:!1};downloadParams.extraDtls={loggedInUserErecNo:erecno,entity:entity,recordId:recordId,attachmentId:attachmentId};var eventid=_LOGGEDIN_ZUID+"_"+(new Date).getTime()+"_"+recordId+"_"+attachmentId;void 0!==ZPeople.zaid&&(downloadParams.zaid=ZPeople.zaid),downloadParams=JSON.stringify(downloadParams),downloadUrl=UDS_DOWNLOAD_URL+"/webdownload?x-service="+UDS_DOWNLOAD_SERVICE_CODE+"&event-id="+eventid+"&x-cli-msg="+encodeURIComponent(downloadParams),void 0!=ZPeople.zaid&&(downloadUrl+="&x-cli-zaid="+ZPeople.zaid),window.open(downloadUrl)}else{downloadUrl="/"+contextPath+Timetracker.constants.URL+"?mode=attachmentDownload&entity="+entity+"&recordId="+recordId+"&attachmentId="+attachmentId;var form=document.createElement("form");form.id="exportTimetrackerData";var exportElement=document.createElement("input");form.setAttribute("method","post"),form.setAttribute("action",downloadUrl),form.setAttribute("target","exportresp"),exportElement.setAttribute("type","hidden"),exportElement.setAttribute("name","conreqcsr"),exportElement.setAttribute("value",csrfToken),form.appendChild(exportElement),document.body.appendChild(form),form.submit(),form.reset(),$("#exportTimetrackerData").remove()}},toggleFileUpload:function(obj){$(obj).parent().siblings().find("input[type=file]").attr("name");var isRestore=!0;"true"===$(obj).attr("ischange")?($(obj).html(ZPI18N.getString("zp.restore")),isRestore=!1):$(obj).html(ZPI18N.getString("zp.change")),$(obj).parent().siblings().find("input[type=file]").val("").siblings("#drop_file").html(ZPI18N.getString("zp.dropfiletoattach")),$(obj).parent().siblings().toggle(),$(obj).siblings().toggle(),$(obj).attr("ischange",isRestore)},addFileNameAttachment:function(obj,type){var layout=Timetracker.Util.getLayout();if(layout.find("#error_message").remove(),"Desktop"==type){if(filename=$(obj).val(),0==filename.length)return;var filedata=$(obj)[0].files[0];if(filedata.size>maxFileSizeBytes||filedata.size<=0)return void layout.find("#timesheetBeforeUpload").after('<div id="error_message" class="ztextbox--error__label">'+ZPI18N.getString("zp.maxuploadfilesize",[maxFileSize])+"</div>");layout.find("#timesheetAfterUpload").data("uploadType","Desktop"),layout.find("#timesheetAfterUpload").data("fileUploadData",$(obj)[0].files[0])}else"cloudUpload"==type?(filename=obj.docName,layout.find("#timesheetAfterUpload").data("uploadType","cloudUpload"),layout.find("#timesheetAfterUpload").data("fileUploadData",JSON.stringify(obj))):"workDriveUpload"==type&&(filename=obj.name,layout.find("#timesheetAfterUpload").data("uploadType","workDrive"),layout.find("#timesheetAfterUpload").data("fileUploadData",JSON.stringify(obj)));layout.find("#timesheetBeforeUpload").addClass("zpl_DNI"),layout.find("#timesheetAfterUpload").removeClass("zpl_DNI");var splitfileName=filename.split("\\"),fileExtn="";-1!=(splitfileName=splitfileName[splitfileName.length-1]).lastIndexOf(".")&&(fileExtn=(fileExtn=splitfileName.substr(splitfileName.lastIndexOf(".")+1,splitfileName.length)).toLowerCase());var restoreHtml="",fileConsHtml='<div><div class="zpl_atchimg"><i class="'+FilesCommon.getFileIcon(fileExtn)+'"></i></div><div class="zpl_atchdtl"><h4 title="'+ZSEC.Encoder.encodeForHTML(splitfileName)+'">'+ZSEC.Encoder.encodeForHTML(splitfileName)+'</h4><p elem="file-info"><span restoreOptionEnabled="true">'+restoreHtml+'</span></p></div><div class="zpl_atchicn"><i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'" onclick="Timetracker.util.removeFileAttachment(this, \'Attachment\')"></i></div></div>';layout.find("#timesheetAfterUpload").html(fileConsHtml)},removeFileAttachment:function(obj,name){"Attachment"==name?($(obj).parents("#timesheetAfterUpload").html(""),Layout.Page.container.find("#timesheet_attach_file").val(""),Layout.Page.container.find("#timesheetAfterUpload,#file_name").addClass("zpl_DNI"),void 0===Layout.Page.container.find("#file_name_change").data("restore")?Layout.Page.container.find("#zp_timesheet_file_disp").addClass("zpl_DNI"):Layout.Page.container.find("#file_name").addClass("zpl_DNI"),Layout.Page.container.find("#timesheetBeforeUpload").removeClass("zpl_DNI")):(Layout.Page.container.find("#timesheetAfterUpload").children(".zpmulti-fl").html(""),Layout.Page.container.find("#file_name_change").data("restore")?(Layout.Page.container.find("#timesheetAfterUpload,#zp_timesheet_file_disp,#timesheetBeforeUpload").addClass("zpl_DNI"),Layout.Page.container.find("#zp_timesheet_file_disp,#file_name").removeClass("zpl_DNI"),Layout.Page.container.find("#file_name_change").data("restore",!1),Layout.Page.container.find("#file_name_change").text(" "+ZPI18N.getString("zp.changefile"))):(Layout.Page.container.find("#file_name_change").data("restore",!0),Layout.Page.container.find("#file_name_change").text(ZPI18N.getString("zp.restore")),Layout.Page.container.find("#timesheetAfterUpload,#timesheetBeforeUpload,#file_name").addClass("zpl_DNI"),Layout.Page.container.find("#timesheetBeforeUpload,#zp_timesheet_file_disp").removeClass("zpl_DNI")))},showDeleteIcon:function(obj){$(obj).find(".IC-delete,.IC-pen").show()},hideDeleteIcon:function(obj){$(obj).find(".IC-delete,.IC-pen").hide()},showHideFilters:function(obj,id,advance_id,isCustom){$("#page-wrapper").removeClass("Nbar2F Nbar2F2 Nbar4 Nbar2 Nbar5");var type,cls="";"job_filter_div"!==id&&"project_filter_div"!==id&&"unassjob_filter_div"!==id&&"unassprojectlist_filter_div"!==id||("job_filter_div"===id?type="jobName":"project_filter_div"===id?type="projectName":"unassjob_filter_div"===id?type="unassJobName":"unassprojectlist_filter_div"===id&&(type="unassProjectName"),"0"!==Layout.Page.container.find("#"+type).val()&&""===Layout.Page.container.find("#"+type+"Search").val()&&(Layout.Page.container.find("#"+type+"Search").val(Layout.Page.container.find("#"+id).data("previousSearchName")),"0"!=Layout.Page.container.find("#"+id).data("previousName")&&void 0!=Layout.Page.container.find("#"+id).data("previousName")||(Layout.Page.container.find("#"+type+"Search").addClass("DNI"),Layout.Page.container.find("#"+type).select2("val",0))),Layout.Page.container.find("#"+type+"_error").addClass("DNI"));Timetracker.util.isFilterOpen(id)?("timelogfilter"===id&&Layout.Page.container.find("#timerarea").is(":visible")?(cls="Nbar4",Layout.Page.container.find("#"+id).removeClass("TLbnd TLbnd1 PA")):(cls="Nbar2",Layout.Page.container.find("#"+id).removeClass("TEbnd TEbnd1 TLbnd TLbnd1 PA"),"job_filter_div"!==id&&"unassjob_filter_div"!==id&&"project_filter_div"!==id&&"unassprojectlist_filter_div"!==id||(cls="Nbar5")),"2"!==isCustom&&(Layout.Page.container.find("#"+id).find(".DN").hide(),Layout.Page.container.find("#"+id).removeClass("TEbnd1")),Timetracker.Page.Timelogs.isSelfServiceListView()||$("#page-wrapper").addClass(cls),Layout.Page.container.find(".ERR").remove()):("2"===isCustom?(cls="Nbar2F2",Layout.Page.container.find("#"+id).addClass("TEbnd1")):("timelogfilter"===id&&Layout.Page.container.find("#timerarea").is(":visible")?(cls="Nbar4",Layout.Page.container.find("#"+id).addClass("TLbnd PA")):("pdbod_timelog_filter"!==id&&"jobs_filter"!==id&&"timelogcalfilter"!==id&&(cls="Nbar2F"),Layout.Page.container.find("#"+id).addClass("TEbnd")),advance_id&&Layout.Page.container.find("#"+advance_id).show()),Timetracker.Page.Timelogs.isSelfServiceListView()||$("#page-wrapper").addClass(cls))},isFilterOpen:function(id){return id?"timelogcalfilter"===id?Layout.Page.container.find("#"+id).hasClass("TEbnd"):0!==Layout.Page.container.find(".ZPFilMain#"+id).height():0!==Layout.Page.container.find(".ZPFilMain").height()},showAdvanced:function(id,advance_id){var cls="";"timelogfilter"===id&&Layout.Page.container.find("#timerarea").is(":visible")?(cls="Nbar4",Layout.Page.container.find("#"+id).addClass("TLbnd1").removeClass("TLbnd")):(cls="Nbar2F2",$("#page-wrapper").removeClass("Nbar2F"),Layout.Page.container.find("#"+id).addClass("TEbnd1").removeClass("TEbnd")),Timetracker.Page.Timelogs.isSelfServiceListView()||$("#page-wrapper").addClass(cls),Layout.Page.container.find("#"+id).find(".DN").show(),Layout.Page.container.find("#"+advance_id).hide()},showHideConfirmDeleteButtonForTimer:function(obj,toggleId,divClass){Layout.Page.container.find("tr[mapid='ZPmapcons']").css("display","none"),Layout.Page.container.find("."+divClass).css("overflow-x","hidden");Layout.Page.container.find("#editdelete"+timerId);if("action_confirm_button"===toggleId){var timerId=$(obj).attr("id");$("#editdelete"+timerId).hasClass("col-sm-3")?Layout.Page.container.find("#editdelete"+timerId).removeClass("col-sm-3").addClass("MT25 MR25"):Layout.Page.container.find("#editdelete"+timerId).removeClass("MR25").addClass("MT10 MR10")}if($(obj).parent().toggle("drop",{direction:"right"},200,function(){$(obj).parent().siblings("#"+toggleId).toggle("drop",200),Layout.Page.container.find("."+divClass).css("overflow-x","")}),"action_button"===toggleId){timerId=$(obj).attr("id");$("#editdelete"+timerId).hasClass("MT25 MR25")?Layout.Page.container.find("#editdelete"+timerId).removeClass("MT25 MR25").addClass("col-sm-3"):Layout.Page.container.find("#editdelete"+timerId).removeClass("MT10 MR25").addClass("MR25")}},showHideConfirmDeleteButtons:function(obj,toggleId,divClass){Layout.Page.container.find("tr[mapid='ZPmapcons']").css("display","none"),Layout.Page.container.find("."+divClass).css("overflow-x","hidden"),$(obj).parent().toggle("drop",{direction:"right"},200,function(){$(obj).parent().siblings("#"+toggleId).toggle("drop",200),Layout.Page.container.find("."+divClass).css("overflow-x","")})},closePopUp:function(id){Layout.Page.container.find("#"+id).hide("slide",{direction:"right"},400,function(){Layout.Page.container.find(".ZPcontwrap").css("overflow-y","auto"),ZPeople.pageMaskLayer(!1)})},showPopup:function(outerdivid){var popObj=Layout.Page.container.find("#"+outerdivid);popObj.is(":visible")||(popObj.show("slide",{direction:"right"},400),Layout.Page.container.find(".ZPcontwrap").scrollTop(0),Layout.Page.container.find(".ZPcontwrap").css("overflow-y","hidden"),ZPeople.pageMaskLayer(!0))},setPopupPosition:function(obj,id,event,isNotes,topAdjustment){var container=Layout.Page.container.find(".Scrcont:visible");Timetracker.Page.Timelogs.isSelfServiceListView()?container=Layout.Page.container.find(".ZP-selfcont"):0===Layout.Page.hash.indexOf("#reports")&&(container=Layout.Page.container.find(".table_responsive"));var popUpHeight=container.find("#"+id).height(),popUpTop=$(obj).offset().top,popUpLeft=$(obj).offset().left;isNotes&&(popUpLeft=popUpLeft-container.find("#"+id).outerWidth()+40),popUpTop-popUpHeight-20>=container.offset().top?(popUpTop-=popUpHeight,isNotes&&(popUpTop-=20),container.find("#"+id).removeClass("top").addClass("bottom")):(popUpTop+=topAdjustment,container.find("#"+id).removeClass("bottom").addClass("top"));let containerRight=container.offset().left+container.outerWidth();if(popUpLeft+container.find("#"+id).outerWidth()>containerRight){popUpLeft=popUpLeft+$(obj).outerWidth()-container.find("#"+id).outerWidth()}container.find("#"+id).offset({top:popUpTop,left:popUpLeft})},constructCountriesOption:function(id){if(null===Timetracker.util.countriesOption){var params={mode:"getCountries",conreqcsr:csrfToken};$.post("/timesheet.zp",params,function(result){var countryCode=result.countryCode,txt="";$.each(result.countryName,function(index,country){txt+='<option value="'+countryCode[index]+'">'+country+"</option>"}),Timetracker.util.countriesOption=txt,Layout.Page.container.find("#"+id).append(Timetracker.util.countriesOption)})}else Layout.Page.container.find("#"+id).append(Timetracker.util.countriesOption)},calculateLengthofBoxes:function(obj,maxlength,inputname){if($(obj).val().length>maxlength){if($(obj).parent().find(".ERR").length<1){var tempMessage=ZPI18N.getString("zp.namecharlimit",[inputname,maxlength]);$(obj).parent().append("<span class='ERR'>"+tempMessage+"</span>")}}else $(obj).parent().find(".ERR").remove()},validateFunction:function(eleId,value,msg,tagName,checkflag,layout,errorClass){var flag=!0,ele=(layout=layout||Layout.Page.container).find("#"+eleId),val=ele.val().trim();return"billing-client"===eleId&&"0"===val&&(value=null),ele.parent().hasClass("input-group")&&(ele=ele.parent()),ele.parents().hasClass("date-range")&&(ele=ele.parents(".date-range")),val!==value&&null!==value||(ele.parent().find(".ERR").length<1&&(ele.parent().append("<"+tagName+' class="ERR '+(errorClass||"")+'">'+msg+"</"+tagName+">"),msg===ZPI18N.getString("zp.greaterfromdate")&&ele.parent().find(".ERR").addClass("WNW")),flag=!1),checkflag||(flag=!1),flag},addJobCheck:function(){Timetracker.util.checkAddJobPermVar?Layout.Page.container.find("#addjobbutton").show():Layout.Page.container.find("#addjobbutton").hide()},addProjectCheck:function(){Timetracker.util.checkAddProjectPermVar?Layout.Page.container.find("#addProject").show():Layout.Page.container.find("#addProject").hide()},addClientCheck:function(){Timetracker.util.checkAddClientPermVar?Layout.Page.container.find("#addClientBar").show():Layout.Page.container.find("#addClientBar").hide()},showImport:function(type){var formId=null;"job"===type?(Timetracker.jobs.formDetails=Timetracker.util.getFormDetails(Timetracker.jobs.formDetails,"P_TimesheetJob"),formId=Timetracker.jobs.formDetails.formId):"project"===type?(Timetracker.projects.formDetails=Timetracker.util.getFormDetails(Timetracker.projects.formDetails,"P_TimesheetJobsList"),formId=Timetracker.projects.formDetails.formId):"client"===type&&(Timetracker.clients.formDetails=Timetracker.util.getFormDetails(Timetracker.clients.formDetails,"P_ClientDetails"),formId=Timetracker.clients.formDetails.formId),Import.init(formId,void 0,Layout.Page.hash)},getFormDetails:function(formDetails,tableName){return null===formDetails&&$.ajax({type:"POST",async:!1,url:Timetracker.constants.URL,data:{mode:"getFormDetailsByTableName",tableName:tableName,conreqcsr:csrfToken},success:function(result){formDetails=result[tableName]}}),formDetails},gettlFieldDispName:function(settingData,tlField){var dispName="";switch(tlField){case Timetracker.constants.WORKITEM:case"Work_Item":dispName=ZPI18N.getString("zp.workitem"),void 0!==settingData&&null!==settingData&&settingData.hasOwnProperty("TLC_Workitem_Name")&&(dispName=settingData.TLC_Workitem_Name);break;case Timetracker.constants.DESC:case"Description":dispName=ZPI18N.getString("zp.description"),void 0!==settingData&&null!==settingData&&settingData.hasOwnProperty("TLC_Desc_Name")&&(dispName=settingData.TLC_Desc_Name);break;case Timetracker.constants.ATTACHMENT:case"Attachment":dispName=ZPI18N.getString("zp.attachment"),void 0!==settingData&&null!==settingData&&settingData.hasOwnProperty("TLC_Attachment_Name")&&(dispName=settingData.TLC_Attachment_Name)}return dispName},printReport:function(){var newWindow=window.open();newWindow.focus();var newContent='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html>',copyhead=$("head").clone();copyhead.find("script").each(function(){$(this).remove()});var wholeCont=$("#"+Layout.Page.pageId).clone();$(wholeCont).find("#reports-page").addClass("zpl_allreports"),$(wholeCont).find(".lt_nav").find(".fil").remove(),$(wholeCont).find(".lt_nav").find(".tfilter").remove(),$(wholeCont).find("iframe").remove(),$(wholeCont).find("form").remove(),$(wholeCont).find("#leaveUserReportChartParent").removeClass("tabcont"),$(wholeCont).find("#leaveDailyReportChartParent").removeClass("tabcont"),$(wholeCont).find(".sstab").remove(),$(wholeCont).find(".home").remove(),$(wholeCont).find(".prev").remove(),$(wholeCont).find(".next").remove(),$(wholeCont).find("#pageDiv").removeClass("shw_tfilter"),$(wholeCont).find(".table_responsive")[0]&&($(wholeCont).find(".table_responsive").find("li").removeAttr("class"),$(wholeCont).find(".table_responsive").find("a").removeAttr("href"),$(wholeCont).find(".table_responsive").find("a").removeAttr("data-toggle"),$(wholeCont).find(".table_responsive").find(".ZPLRow").find(".lt_title").addClass("DNI"),$(wholeCont).find(".tfilter").hide(),$(wholeCont).find(".table_responsive").find("desc").removeClass("CP")),$(wholeCont).find(".ZPDat")[0]&&$(wholeCont).find(".ZPDat").css("left","0px");var logoCont=$(".ZPHeadLft").clone();$(logoCont).find("i").remove(),newContent+=copyhead.html(),newContent+='<body onload="self.print()" style="overflow:scroll;width:100%;zoom:65%;background: #fff"><div class="ZPHeadLft">',newContent+=0!=logoCont.length?logoCont.html():"",newContent+='</div><div class="clearfix"></div><hr>',newContent+=wholeCont.html(),newWindow.document.write(newContent),newWindow.document.close()},constructTwoStepsModal:function(json,isFormTimesheet){if(isFormTimesheet){var modal='<div class="modal popRgtModel PopSsModel PopSgModel in" id="'+json.id+'" style="display: none !important;"><div class="modal-dialog"><div class="modal-content"><div id="'+json.step1Id+'" style="display: none;"><div class="modal-header"><div class="zp-back" data-dismiss="modal"><i class="IC-ar-lft"></i></div><div class="ssp-profmin"><span class="ssp-un addPopTitle"></span></div><a data-dismiss="modal" class="IC-cls close"></a></div><div class="modal-body P0I"></div><div class="modal-footer"></div></div><div id="'+json.step2Id+'"><div class="modal-header"><div class="zp-back" id="timesheet_create_back"><i class="IC-ar-lft"></i></div><div class="ssp-profmin"><span class="ssp-profminPro"></span></div><div class="ssp-profrht"><span class="btn btn-default btn-min" id="timesheet_create_moreopt" style="display: none;"><i class="IC-print" onclick="Timetracker.timesheet.printTimesheet();"></i></span>';modal+='</div><a class="IC-cls close" id="zp_modal_close" data-dismiss="modal"></a></div><div class="modal-body P0I"></div><div class="modal-footer"></div></div></div></div></div>'}else modal='<div id="'+json.id+'" class="modal popRgtModel PopLgModel"><div class="modal-dialog"><div class="modal-content"><div class="ZPNxtStep DN" id="'+json.step1Id+'"><div class="modal-header"><h6 class="addPopTitle FL"></h6><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true"><i class="IC-cls-1px red S21 CP"></i></span></button></div><div class="modal-body "></div><div class="modal-footer text-left"></div></div><div class="O0 DN ZPNxtStep" id="'+json.step2Id+'"><div class="modal-header"><h6 class="addPopTitle FL"></h6><button type="button" id="zp_modal_close" class="close" aria-label="Close"><span aria-hidden="true"><i class="IC-cls-1px red S21 CP"></i></span></button></div><div class="modal-body"></div><div class="modal-footer text-left"></div></div></div></div></div>';Layout.Page.container.append(modal),void 0!=json.callBack?Layout.Page.container.find("#"+json.id).find("#zp_modal_close")[0].onclick=function(){json.callBack()}:Layout.Page.container.find("#"+json.id).find("#zp_modal_close").attr("data-dismiss","modal")},appendErrorMsg:function(json){var obj=json.obj,action=json.action?json.action:"after",msg=json.msg;if(void 0!==msg)if(void 0!==obj){var classes=json.classes,errHtml='<div class="ztextbox--error__label">'+msg+"</div>";errHtml=$(errHtml),classes&&errHtml.addClass(classes),"after"===action?$(obj).after(errHtml):"prepend"===action?$(obj).prepend(errHtml):"append"===action&&$(obj).append(errHtml)}else Timetracker.util.showAlert(0,msg)},removeErrorMsg:function(id,layout){(layout=void 0===layout?id?Timetracker.Util.getLayout().find("#"+id):Timetracker.Util.getLayout():layout).find(".ztextbox__error").removeClass("ztextbox__error"),layout.find(".ztextbox--error__label").remove()},setFromToDate:function(date,fromId,toId){var parts=date.split("-");2==parts.length?(Layout.Page.container.find("#"+fromId).val(parts[0]),Layout.Page.container.find("#"+toId).val(parts[1])):6==parts.length&&(Layout.Page.container.find("#"+fromId).val(parts[0]+"-"+parts[1]+"-"+parts[2]),Layout.Page.container.find("#"+toId).val(parts[3]+"-"+parts[4]+"-"+parts[5]))},appendLoading:function(id,json){var layout=json&&json.layout?json.layout:Timetracker.Util.getLayout();if(layout.find("#zp_page_loading").length<=0)if(json&&json.type){if("popup"===json.type){layout=Timetracker.Util.getMainContainer();var containerId=json.containerId,containerClass=json.containerClass;void 0!=id&&null!=id?layout.find("#"+containerId).find("#"+id).prepend(ZPeople.LOADING_HTML):"after"==json.appendType&&void 0!=containerClass?layout.find("#"+containerId).find("."+containerClass).after(ZPeople.LOADING_HTML):void 0!=containerClass&&layout.find("#"+containerId).find("."+containerClass).prepend(ZPeople.LOADING_HTML)}}else json&&json.fullPageModal?layout.append(ZPeople.LOADING_HTML):json&&json.operPageModal?settingsPage.container.find(".zpl_rgtcnt").prepend(ZPeople.LOADING_HTML):json&&json.divId?layout.find("#"+json.divId).prepend(ZPeople.LOADING_HTML):layout.find(".zpl_rgtcnt").prepend(ZPeople.LOADING_HTML)},removeLoading:function(layout){(layout=layout||(Timetracker.Util.isVersionFive()?settingsPage.container:Layout.Page.container)).find("#zp_page_loading").remove()},appendEmptyData:function(message,json){if(json.onlyHTML)return ZPUtil.newNoDataHTML(json.classname,json.path);var layout=void 0!==json.id?Layout.Page.container.find("#"+json.id):Layout.Page.container.find(".Scrcont");if(json.widget){var html=ZPUtil.newNoDataHTML(json.classname,json.path,message);ZPDashboard.Widget.show(json.widget,html)}else 0===layout.find("#zp_empty_data").find("."+json.classname).length&&(Timetracker.util.EMPTY_DATA_HTML=ZPUtil.newNoDataHTML(json.classname,json.path,message,void 0,"zp_empty_data")),0===layout.find("#zp_empty_data").length&&(void 0===json.type||"append"===json.type?layout.append(Timetracker.util.EMPTY_DATA_HTML):"prepend"===json.type&&layout.prepend(Timetracker.util.EMPTY_DATA_HTML)),layout.find("#zp_empty_data").hasClass("DN")&&layout.find("#zp_empty_data").removeClass("DN"),layout.find("#zp_empty_data").show()},removeEmptyData:function(){Layout.Page.container.find("#zp_empty_data").remove()},appendPermissionDenied:function(retainHtml){Layout.Page.container.find("#permission_denied").length<=0&&(void 0!==retainHtml&&!1!==retainHtml||settingsPage.container.html(""),Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.notallowed"),cls:"zp_nd_permission"}))},removePermissionDenied:function(){Layout.Page.container.find("#permission_denied").remove()},freezeSubmit:function(layoutId,buttonId,layout){(layout=layout||Timetracker.Util.getLayout().find("#"+layoutId)).find("#"+buttonId).addClass("disabled")},unfreezeSubmit:function(layoutId,buttonId,layout){(layout=layout||Timetracker.Util.getLayout().find("#"+layoutId)).find("#"+buttonId).removeClass("disabled")},handleHeaderForTablePositioning:function(){Layout.Page.container.find("[statictable=true]:visible").find("[staticheader=true]").find("th").each(function(){var innerHtml=$(this).html();0===$(this).children("div").length&&$(this).html("<div>"+innerHtml+"</div>"+innerHtml)})},getTotalTimeForHours:function(hrstot){var hrs=mins=0,ampm="am";if(hrs=hrstot[0],"hh:mm a"===timeFormat){mins=hrstot[1].split(" ")[0],ampm=hrstot[1].split(" ")[1].toLowerCase();var time=Calendar.timetomins(hrs+":"+mins,mins,ampm);return time.tottime}return mins=Number(hrstot[1]),time=Number(60*hrs+mins)},getShiftDatebyTime:function(val,ldate,type){var date=new Date(ldate);return type==Timetracker.constants.MINUTES?date.setTime(date.getTime()+60*val*1e3):date.setTime(date.getTime()+1e3*val),date},getShiftDatebyTimeStr:function(val,dateStr,type,OnlyTimeNeeded){var tdate=Calendar.parseDate(dateStr,uidateFormat);return date=Timetracker.util.getShiftDatebyTime(val,tdate,type),tdate.getDate()==date.getDate()?Timetracker.DateTime.minstoTimeMeridian(60*date.getHours()+date.getMinutes()):OnlyTimeNeeded?Timetracker.DateTime.minstoTimeMeridian(60*date.getHours()+date.getMinutes()):Calendar.formatDate(date)+" "+Timetracker.DateTime.minstoTimeMeridian(60*date.getHours()+date.getMinutes())},convertDateTo2digit:function(date){return date<10?"0"+date:date},updateThirdLevelURLs:function(){if(showNewTab&&Timetracker.Page.isTeamDataView()){let user=Timetracker.Team.getSelectedUser(),thirdLevelTabs=Layout.Page.container.parents(".cont-wrap").find(".zpl_cstmProfNav.zpl_profIn").find("li");thirdLevelTabs.length>0&&$.each(thirdLevelTabs,function(index,element){let href=$(element).find("a").attr("href");-1===href.indexOf("-userId:")&&(href+="-userId:"+user,$(element).find("a").attr("href",href))})}},setUserErecno:function(userErecNo){userErecNo!==Timetracker.timelogs.tserecno&&(Timetracker.timelogs.currentTimelogData={},Timetracker.timelogs.breakLogsData={},Timetracker.timelogs.resetTLFetch()),userErecNo?Timetracker.timelogs.tserecno=userErecNo:Timetracker.timelogs.tserecno||(Timetracker.timelogs.tserecno=erecno)},getUserErecno:function(){return-1!==Layout.Page.hash.indexOf("home/dashboard")?Timetracker.util.setUserErecno(erecno):Timetracker.util.setUserErecno(),Timetracker.timelogs.tserecno},isActiveUserNonUser:function(user){var userDtls=ZPeople.getUserDetailsById(user);return"true"===userDtls.isLogEnb||"false"===userDtls.isLogEnb&&"true"===userDtls.isNonUser},capitalizeFirstLetter:function(text){return text.charAt(0).toUpperCase()+text.slice(1)},checkIsParamNotEmpty:function(param){return null!==param&&void 0!==param&&""!==param},getParamValForMultiSelect:function(param,optValue){return null!==param&&void 0!==param&&0!=param.length?param:optValue||"0"},getCommonData:function(params,callback){var json={url:Timetracker.constants.URL,params:params,callback:callback};Timetracker.Request.sendAsyncPost(json)},entryViewChange:function(isV5){var layout=isV5?Timetracker.Util.getMainContainer().find("#cardmoduleSettingsPopUP"):Layout.Page.container,editButt=layout.find("#ZPTT_EntriesEditEnabled");editButt.prop("disabled",!1),layout.find("#ZPTT_EntriesViewEnabled").is(":checked")||(editButt.prop("checked",!1),editButt.prop("disabled",!0))},setViewType:function(viewtype,element){var tmpDate={},mode=null;switch(viewtype){case"0":tmpDate=Calendar.getCurrentDay(),mode=Timetracker.util.DAILY;break;case"1":tmpDate=Calendar.getCurrentWeek(),mode=Timetracker.util.WEEKLY;break;case"2":tmpDate=Calendar.getCurrentMonth(),mode=Timetracker.util.MONTHLY;break;case"3":tmpDate=Calendar.getCurrentDay(),tmpDate=Calendar.getPreviousDay(tmpDate),mode=Timetracker.util.DAILY;break;case"4":tmpDate=Calendar.getCurrentWeek(),tmpDate=Calendar.getPreviousWeek(tmpDate),mode=Timetracker.util.WEEKLY;break;case"5":tmpDate=Calendar.getCurrentMonth(),tmpDate=Calendar.getPreviousMonth(tmpDate),mode=Timetracker.util.MONTHLY;break;case"6":var dateLayout=Layout.Page.container.find("#new_"+element+"customreportfromtodate");tmpDate.from=dateLayout.find("#fromdate").val(),tmpDate.to=dateLayout.find("#todate").val(),mode=Timetracker.util.CUSTOM_TL}"Timelog"==element?(Timetracker.timelogs.tmpDate=tmpDate,Timetracker.timelogs.dispMode=mode):"mytimesheet"==element?Timetracker.timesheet.timesheetTmpDate=tmpDate:"myapproval"===element?Timetracker.timesheet.approvalTmpDate=tmpDate:"r"==element?Timetracker.reports.timeLogReport.tmpDate=tmpDate:"ur"===element?Timetracker.reports.payrollReport.tmpDate=tmpDate:"jschdr"===element&&(Timetracker.jobSchedule.getParamsForJobSchdReport.tmpDate=tmpDate)},isProjectHeadExists:function(){return Timetracker.projects.formDetails=Timetracker.util.getFormDetails(Timetracker.projects.formDetails,"P_TimesheetJobsList"),Timetracker.projects.formDetails.projectHeadFCId},isFromProjectDashboard:function(entity){return entity&&""!==entity?"feeds"===entity?-1!==Layout.Page.hash.indexOf("timetracker/projectdashboard/feeds"):"jobs"===entity?-1!==Layout.Page.hash.indexOf("timetracker/projectdashboard/jobs"):"users"===entity?-1!==Layout.Page.hash.indexOf("timetracker/projectdashboard/users"):"timelogs"===entity?-1!==Layout.Page.hash.indexOf("timetracker/projectdashboard/timelogs"):"attachments"===entity?-1!==Layout.Page.hash.indexOf("timetracker/projectdashboard/attachments"):void 0:-1!==Layout.Page.hash.indexOf("timetracker/projectdashboard")},constructPieChart:function(chartDetails){new Highcharts.Chart({chart:{renderTo:chartDetails.renderTo,type:"pie",plotShadow:!1,width:chartDetails.width,height:chartDetails.height},title:{text:chartDetails.centerText?chartDetails.centerText:"",align:"center",verticalAlign:"middle",y:chartDetails.enableLegend?-30:0},tooltip:{percentageDecimals:0,pointFormat:"{point.name} ,<b>{point.percentage:.2f}%</b>"},legend:{enabled:chartDetails.enableLegend,verticalAlign:"bottom",layout:"vertical",y:10,itemMarginTop:5,itemMarginBottom:5,itemStyle:{fontSize:"13px !important"},labelFormatter:function(){return this.name+' <div style="font-family:Zoho_Puvi_Medium !important;">'+(chartDetails.dataInMins?Calendar.minstohrs(this.y):this.y)+"</div>"}},exporting:{enabled:!1},credits:{enabled:!1},plotOptions:{pie:{allowPointSelect:!1,showInLegend:chartDetails.enableLegend,cursor:"pointer",dataLabels:{connectorWidth:0,enabled:!1},point:{events:{legendItemClick:function(){void 0!==chartDetails.legendOnClickCallback&&"function"==typeof chartDetails.legendOnClickCallback&&chartDetails.legendOnClickCallback(this)}}}}},series:[{type:"pie",data:chartDetails.dataArray,innerSize:chartDetails.innerSize+"%"}]})},constructHighChart:function(chartDetails){new Highcharts.Chart({chart:{renderTo:chartDetails.renderTo,type:"column",plotBorderWidth:1,plotBorderColor:"#f3f3f3",spacingBottom:10,spacingTop:30,spacingLeft:10,spacingRight:10,width:chartDetails.width},scrollbar:{enabled:!!chartDetails.isScrollNeeded&&chartDetails.isScrollNeeded,barBackgroundColor:"#cfd6d9",barBorderRadius:7,barBorderWidth:0,barBorderHeight:2,buttonBackgroundColor:"#cfd6d9",buttonBorderWidth:0,buttonArrowColor:"white",buttonBorderRadius:4,rifleColor:"#cfd6d9",trackBorderWidth:1,trackBorderColor:"white",trackBorderRadius:7},title:{text:""},xAxis:{title:{text:chartDetails.xAxisTitle?chartDetails.xAxisTitle:""},categories:chartDetails.xAxisLabel,labels:{rotation:0},min:0,max:void 0!==chartDetails.xAxisMaxPointsOnFocus?chartDetails.xAxisMaxPointsOnFocus:5},yAxis:{title:{text:chartDetails.yAxisTitle?chartDetails.yAxisTitle:""},tickInterval:chartDetails.yAxisTickInterval?chartDetails.yAxisTickInterval:5},tooltip:{formatter:function(){return this.x+","+Math.round(100*this.point.y)/100}},legend:{enabled:chartDetails.enableLegend,itemStyle:{fontWeight:"bold !important",fontSize:"14px !important"}},exporting:{enabled:!1},credits:{enabled:!1},plotOptions:{column:{pointPadding:.1,borderWidth:0,borderRadius:0},series:{pointWidth:chartDetails.barSize?chartDetails.barSize:20,dataLabels:{enabled:!0,formatter:function(){return 0===this.point.y?"0":Math.round(100*this.point.y)/100},style:{fontWeight:"normal",fontSize:"13px",fontFamily:"Verdana, sans-serif"}}}},series:chartDetails.dataArray})},getTTLocation:function(callback,arg1,arg2,arg3,arg4,arg5,arg6){Timetracker.generalSettings.isTTLocationAllowed(Timetracker.timelogs.tserecno)?Timetracker.location.getLocation(callback,arg1,arg2,arg3,arg4,arg5,arg6):(Timetracker.location.latLongParam={},null!==callback&&callback(arg1,arg2,arg3,arg4,arg5,arg6))}},Timetracker.location={dblatlonvalue:{},latLongParam:{},cityNamesList:{},latLonCityNamesList:{},latLonCityNamesListLocal:new Array,getLocation:function(callback,arg1,arg2,arg3,arg4,arg5,arg6){if(0===Object.keys(Timetracker.location.latLongParam).length&&void 0!==typeof Storage){var att_LatLonDet_String=localStorage.getItem("att_LatLonDet");if(att_LatLonDet_String){var att_LatLonDet=JSON.parse(att_LatLonDet_String);att_LatLonDet&&(new Date).getTime()-att_LatLonDet.fetchedTime<12e4&&null!=att_LatLonDet&&Timetracker.location.storePositionInTTLocalStorage(att_LatLonDet)}}if(0===Object.keys(Timetracker.location.latLongParam).length){var options={timeout:2e3},isGeoRestrictTTVal=!1;void 0!==ZPeople.Module.MODULE_DATA.timetracker&&(isGeoRestrictTTVal=!!ZPeople.Module.MODULE_DATA.timetracker.hasOwnProperty("isGeoRestrictTT")&&ZPeople.Module.MODULE_DATA.timetracker.isGeoRestrictTT),isGeoRestrictTTVal&&(options={}),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(position){Timetracker.location.storePositionInLocalStorage(position),null!=position&&Timetracker.location.storePositionInTTLocalStorage(position.coords),null!==callback&&callback(arg1,arg2,arg3,arg4,arg5,arg6)},function(error){var isGeoLocationError=!1;null!=error&&"GeolocationPositionError"===error.constructor.name&&error.code&&(isGeoLocationError=!0),isGeoLocationError&&(Timetracker.location.latLongParam={},null!==callback&&callback(arg1,arg2,arg3,arg4,arg5,arg6))},options)}else null!==callback&&callback(arg1,arg2,arg3,arg4,arg5,arg6)},checkForKeysinIPCache:function(ip){var hasIp=!1;return 0!==Object.keys(Timetracker.location.cityNamesList).length&&Timetracker.location.cityNamesList.hasOwnProperty(ip)?hasIp=!0:hasIp},getCityName:function(strip){var address="-";return Timetracker.location.cityNamesList[strip]&&(address=Timetracker.location.cityNamesList[strip]),address},getLatLonLocAddress:function(latlonid){var address="-",strlatlonid=String(latlonid);return Timetracker.location.latLonCityNamesList[strlatlonid]&&(address=Timetracker.location.latLonCityNamesList[strlatlonid]),address},sendRequestForCityNames:function(latLonList,result,isFromNonTimer){if(0!=latLonList.length){var param={mode:"getCityNameByLatLong",conreqcsr:csrfToken,latLongList:JSON.stringify(latLonList)};$.post("/AttendanceAction.zp",param,function(rdata){if(rdata.cityNames&&(Timetracker.location.latLonCityNamesList=$.extend(Timetracker.location.latLonCityNamesList,rdata.cityNames)),isFromNonTimer){if(null!==result.latitude&&null!=result.longitude){var geoLocation=Timetracker.location.getLatLonLocAddress(result.timelogId);Timetracker.location.latLonCityNamesListLocal.push({latitude:result.latitude,longitude:result.longitude,geoLocation:geoLocation});var mapTxt=Timetracker.location.constructMap(result.timelogId);$("#view-map").remove(),Layout.Page.container.find("#nontimereditbodymodal").append(mapTxt),Layout.Page.container.find("#view-map"+result.timelogId).css("display","table-row");var dispLocAddress=Timetracker.location.loadMapOverwrite(geoLocation),markerTitle="<b>"+ZPI18N.getString("zp.address")+"</b>:";ZPMaps.loadMap(result.latitude,result.longitude,!1,Layout.Page.pageId+"_map",markerTitle,dispLocAddress,!1)}}else{var city_response=rdata.cityNames;$.each(city_response,function(index,data){Layout.Page.container.find("#"+index).html(data)})}})}},checkAndSendRequestLatLonforNontimer:function(timelogDBVal){var loadMapInModal=!1,geoLocation="-",lat=null,lon=null,timelogId=timelogDBVal.timelogId;if(null!==timelogDBVal&&timelogDBVal.hasOwnProperty("latitude")&&timelogDBVal.hasOwnProperty("longitude"))if(lat=timelogDBVal.latitude,lon=timelogDBVal.longitude,geoLocation=Timetracker.location.getLocationName(lat,lon),!timelogDBVal.hasOwnProperty("geoLocation")||null===timelogDBVal.geoLocation&&"-"===timelogDBVal.geoLocation)if("-"!==geoLocation)loadMapInModal=!0;else{var latLonList=new Array;latLonList.push({lat:lat,lon:lon,id:timelogId}),Timetracker.location.sendRequestForCityNames(latLonList,timelogDBVal,!0)}else loadMapInModal=!0,"-"!==(geoLocation=timelogDBVal.geoLocation)&&Timetracker.location.latLonCityNamesListLocal.push({latitude:lat,longitude:lon,geoLocation:geoLocation});if(loadMapInModal){var mapTxt=Timetracker.location.constructMap(timelogId);$("#view-map").remove(),Layout.Page.container.find("#nontimereditbodymodal").append(mapTxt),Layout.Page.container.find("#view-map"+timelogId).css("display","table-row");var dispLocAddress=Timetracker.location.loadMapOverwrite(geoLocation),markerTitle="<b>"+ZPI18N.getString("zp.address")+"</b>:";ZPMaps.loadMap(lat,lon,!1,Layout.Page.pageId+"_map",markerTitle,dispLocAddress,!1)}},getLocationName:function(lat,lon){var geoLocName="-";if(null==lat||null==lon)return geoLocName;var locLatLonCache=Timetracker.location.latLonCityNamesListLocal;return void 0==locLatLonCache||null==locLatLonCache||0==locLatLonCache.length?geoLocName:($.each(locLatLonCache,function(index,locData){if(locData.latitude===lat&&locData.longitude===lon&&locData.hasOwnProperty("geoLocation"))return geoLocName=locData.geoLocation}),geoLocName)},checkDuplicateAndPushToLocationCache:function(cache,lat,lon){var hasObj=!1;if(0!==cache.length)return $.each(cache,function(index,data){if(data.latitude===lat&&data.longitude===lon)return hasObj=!0}),hasObj},sendRequestLatLon:function(){var dbObj=Timetracker.location.dblatlonvalue,latLonList=new Array;$.each(dbObj,function(index,locObj){var i_ele="",i_ele_end="";if(locObj.latitude&&locObj.longitude?locObj.accuracy&&locObj.accuracy<=3e3&&locObj.accuracy>1e3&&(i_ele='<i class="PI_info zpl_icinfogry" data-title-position="right" title="'+ZPI18N.getString("zp.lowaccuracyinfo",[locObj.accuracy])+'">'):i_ele=locObj.accuracy?'<i class="PI_info zpl_icinfogry" data-title-position="right" title="'+ZPI18N.getString("zp.lowaccuracyandipaddrinfo",[locObj.add_ip,locObj.accuracy])+'">':'<i class="PI_info zpl_icinfogry" data-title-position="right" title="'+ZPI18N.getString("zp.ipaddrinfo",[locObj.add_ip])+'">',locObj.latitude_end&&locObj.longitude_end?locObj.accuracy_end&&locObj.accuracy_end<=3e3&&locObj.accuracy_end>1e3&&(i_ele_end='<i class="PI_info zpl_icinfogry" data-title-position="right" title="'+ZPI18N.getString("zp.lowaccuracyinfo",[locObj.accuracy_end])+'">'):i_ele_end=locObj.accuracy_end?'<i class="PI_info zpl_icinfogry" data-title-position="right" title="'+ZPI18N.getString("zp.lowaccuracyandipaddrinfo",[locObj.mod_ip,locObj.accuracy_end])+'">':'<i class="PI_info zpl_icinfogry" data-title-position="right" title="'+ZPI18N.getString("zp.ipaddrinfo",[locObj.mod_ip])+'">',locObj.hasOwnProperty("geoLocation_in"))if(locObj.latitude&&locObj.longitude){(obj={}).latitude=locObj.latitude,obj.longitude=locObj.longitude,obj.geoLocation=locObj.geoLocation_in,Timetracker.location.checkDuplicateAndPushToLocationCache(Timetracker.location.latLonCityNamesListLocal,locObj.latitude,locObj.longitude)||Timetracker.location.latLonCityNamesListLocal.push(obj);var id="latLon_"+locObj.timerId,geoLocation=null!==locObj.geoLocation_in?locObj.geoLocation_in:"-";geoLocation+=" "+i_ele,Layout.Page.container.find("#latLon_"+locObj.timerId).html(" "+geoLocation)}else if(0===Layout.Page.container.find("#geoIn_"+locObj.timerId).length){geoLocation=locObj.geoLocation_in;geoLocation+=" "+i_ele;var locHtml='<em class="zpl_f12"><i class="PI_location"></i><span id="geoIn_'+locObj.timerId+'"> '+geoLocation+"</span>",fromTimeObj=Layout.Page.container.find("#timerFromTime_"+locObj.timerId);fromTimeObj.siblings("em").length&&fromTimeObj.siblings("em").remove(),fromTimeObj.after($(locHtml))}else Layout.Page.container.find("#geoIn_"+locObj.timerId).html(" "+locObj.geoLocation_in+" "+i_ele);else if(locObj.hasOwnProperty("latitude")&&locObj.hasOwnProperty("longitude")){id="latLon_"+locObj.timerId;if(null!=locObj.latitude&&null!=locObj.longitude)if("-"!==(geoLocation=Timetracker.location.getLocationName(locObj.latitude,locObj.longitude)))geoLocation+=" "+i_ele,Layout.Page.container.find("#"+id).html(" "+geoLocation);else{var latLonObj={};latLonObj.lat=locObj.latitude,latLonObj.lon=locObj.longitude,latLonObj.id=id,latLonList.push(latLonObj)}}if(locObj.hasOwnProperty("geoLocation_out"))if(locObj.latitude_end&&locObj.longitude_end){var obj;(obj={}).latitude=locObj.latitude_end,obj.longitude=locObj.longitude_end,obj.geoLocation=locObj.geoLocation_out,Timetracker.location.checkDuplicateAndPushToLocationCache(Timetracker.location.latLonCityNamesListLocal,locObj.latitude_end,locObj.longitude_end)||Timetracker.location.latLonCityNamesListLocal.push(obj);id="latLonEnd_"+locObj.timerId,geoLocation=null!==locObj.geoLocation_out?locObj.geoLocation_out:"-";geoLocation+=" "+i_ele_end,Layout.Page.container.find("#latLonEnd_"+locObj.timerId).html(" "+geoLocation)}else if(0===Layout.Page.container.find("#geoOut_"+locObj.timerId).length){geoLocation=locObj.geoLocation_out;geoLocation+=" "+i_ele_end;locHtml='<em class="zpl_f12"><i class="PI_location"></i><span id="geoIn_'+locObj.timerId+'"> '+geoLocation+"</span></em>";var toTimeObj=Layout.Page.container.find("#timerToTime_"+locObj.timerId);toTimeObj.siblings("em").length&&toTimeObj.siblings("em").remove(),toTimeObj.after($(locHtml))}else Layout.Page.container.find("#geoOut_"+locObj.timerId).html(" "+locObj.geoLocation_out+" "+i_ele_end);else if(locObj.hasOwnProperty("latitude_end")&&locObj.hasOwnProperty("longitude_end")){id="latLonEnd_"+locObj.timerId;if(null!=locObj.latitude_end&&null!=locObj.longitude_end)if("-"!==(geoLocation=Timetracker.location.getLocationName(locObj.latitude_end,locObj.longitude_end)))geoLocation+=" "+i_ele_end,Layout.Page.container.find("#"+id).html(" "+geoLocation);else{var latLonObj_end={};latLonObj_end.lat=locObj.latitude_end,latLonObj_end.lon=locObj.longitude_end,latLonObj_end.id=id,latLonList.push(latLonObj_end)}}}),""!==latLonList&&Timetracker.location.sendRequestForCityNames(latLonList),Layout.Page.container.popover({selector:"[data-popover].popHover",trigger:"click hover",placement:"right"})},navigatorGeoReturn:function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(Timetracker.location.successcallback,Timetracker.location.errorcallback)},successcallback:function(position){Timetracker.location.latLongParam.latitude=position.coords.latitude,Timetracker.location.latLongParam.longitude=position.coords.longitude,Timetracker.location.latLongParam.accuracy=position.coords.accuracy},errorcallback:function(error){error.code&&(Timetracker.location.latLongParam={})},appendHeadToTable:function(){var headtxt='<thead id="headTable" > <tr> <th >'+ZPI18N.getString("zp.starttime")+"</th><th>"+ZPI18N.getString("zp.endtime")+'</th><th width="100px">'+ZPI18N.getString("zp.totalhours")+"</th></tr></thead>";Layout.Page.container.find("#modalTable").prepend(headtxt)},removeHeadFromTable:function(){0!==Layout.Page.container.find("#headTable").length&&Layout.Page.container.find("#headTable").remove()},nonTimermodal:function(result){var dateString=result.dateString;if(Layout.Page.container.find("#nontimereditpopupmodal").find("#modalDate").text(dateString),Layout.Page.container.find("#nontimereditpopupmodal").find("#ts_accuracy").remove(),"0"===result.type){Timetracker.location.removeHeadFromTable();var txt=""}else{Timetracker.location.removeHeadFromTable(),Timetracker.location.appendHeadToTable();(result.toTime-result.fromTime)/60;txt="<tr><td>"+Calendar.minstohrs(result.fromTime)+"</td><td>"+Calendar.minstohrs(result.toTime)+"</td><td>"+Calendar.minstohrs(result.hours)+"</td></tr>"}if(Layout.Page.container.find("#nontimereditpopupmodal").find("#totHrsFooter").html(Calendar.minstohrs(result.hours)+" "+ZPI18N.getString("zp.hrs")),Layout.Page.container.find("#nontimereditbodymodal").html(txt),result.hasOwnProperty("latitude")&&result.hasOwnProperty("longitude")){if(null!==result.latitude&&null!=result.longitude&&(Timetracker.location.dblatlonvalue=result,Timetracker.location.checkAndSendRequestLatLonforNontimer(result)),result.accuracy&&result.accuracy>1e3&&result.accuracy<3e3){var i_ele='<div class="zpl_info" id="ts_accuracy">'+ZPI18N.getString("zp.lowaccuracyinfo",[result.accuracy])+"</div>";Layout.Page.container.find("#nontimereditpopupmodal").find("#modalTable").parent().append(i_ele)}}else{var strip=String(result.add_ip);if(result.hasOwnProperty("geoLocation")){var noniptxt='<tr><td colspan="3">'+(null!==result.geoLocation?result.geoLocation:"-")+"</td></tr>";Layout.Page.container.find("#nontimereditbodymodal").append(noniptxt)}else if(Timetracker.location.cityNamesList[strip]){noniptxt='<tr><td colspan="3">'+Timetracker.location.cityNamesList[strip]+"</td></tr>";Layout.Page.container.find("#nontimereditbodymodal").append(noniptxt)}}},nontimerModalConstruction:function(obj){if(0===Layout.Page.container.find("#nontimereditpopupmodal").length){var body='<div class="zpl_tblres"><table class="zpl_tbl" id="modalTable"><thead id="headTable" > <tr> <th >'+ZPI18N.getString("zp.starttime")+"</th><th>"+ZPI18N.getString("zp.endtime")+'</th><th width="100px">'+ZPI18N.getString("zp.totalhours")+'</th></tr></thead><tbody id="nontimereditbodymodal" ></tbody></table></div>',footer='<div class="zpl_mfoter"> <div class="zpl_tblpagination" style="position: inherit;"><div class="zpl_lftpgn"><div class="zpl_viewdays"><div class="zpl_dytyp grnbdr1"><span>'+ZPI18N.getString("zp.totalhours")+'</span><b id="totHrsFooter" class="grn"></b></div></div></div><div class="zpl_rhtpgn"></div></div></div>';ModuleComp.Modal.setup({id:"nontimereditpopupmodal",type:1,headerHtml:'<div><h4 id="modalDate"></h4></div> <span class="zpl_mhderrgt a-itm-cntr"></span><a class="_cls PI_cls"></a></div>',body:body,footer:footer,backdrop:!0,closeOnSubmit:!1,modalClass:"zpl_mdl",deleteOnHide:!1,closeonEsc:!0})}ModuleComp.Modal.show(Layout.Page.container.find("#nontimereditpopupmodal"));var result=$(obj).parent().parent().parent().data().tsval;Timetracker.location.nonTimermodal(result)},timerModalConstruction:function(){if(0===Layout.Page.container.find("#timereditpopupmodal").length){var modal='<div id="timereditpopupmodal" class="modal popRgtModel PopMdModel" aria-hidden="false"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h5 id="modalDate" class="PL15"></h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button></div><div id="modalTable" class="modal-body P0I"><div ><div class="ZPcoltbl"><div class="ZPcolhead"><div class="row"><div class="col-sm-4"><b>'+ZPI18N.getString("zp.starttime")+'</b></div><div class="col-sm-4"><b>'+ZPI18N.getString("zp.endtime")+'</b></div><div class="col-sm-3"<b>'+ZPI18N.getString("zp.totalhours")+'</b></div><div class="col-sm-1"></div></div></div><div id="timereditbodymodal" class="ZPcolbody"></div></div></div></div><div class="modal-footer text-left"><div><div class="time-rslt ZPBC12 ML0I"><span>'+ZPI18N.getString("zp.totalhours")+'<b id="tothrsfooter" class="digit-type grn"></b></span></div></div></div>';Layout.Page.container.append(modal)}},loadMapOverwrite:function(address){address.length>60&&(address=address.substring(0,60)+"<br>"+address.substring(60,address.length));return address},constructMap:function(viewMapUniqId){return'<tr id="view-map'+viewMapUniqId+'"  mapid="ZPmapcons" style="display: none;"><td colspan="3"><div id="show_map" class="showMap"><div  style="overflow:hidden; height:400px;width:100%;border:0;"><div id="display-google-map" style="height:100%; width:100%;max-width:100%;"><div id=\''+Layout.Page.pageId+"_map' style='height:400px;width:100%;border:0;'></div></div></div></div></td></tr>"},openMap:function(latitude,longitude){null!==latitude&&void 0!==latitude&&null!==longitude&&void 0!==longitude&&window.open("https://maps.google.com/?q="+latitude+","+longitude,"_blank")},storePositionInLocalStorage:function(position){if(position&&void 0!==typeof Storage){var positionParams={};positionParams.latitude=position.coords.latitude,positionParams.longitude=position.coords.longitude,positionParams.accuracy=position.coords.accuracy,positionParams.fetchedTime=(new Date).getTime(),localStorage.setItem("att_LatLonDet",JSON.stringify(positionParams))}},storePositionInTTLocalStorage:function(positioncoords){null!==positioncoords&&(Timetracker.location.latLongParam.latitude=positioncoords.latitude,Timetracker.location.latLongParam.longitude=positioncoords.longitude,Timetracker.location.latLongParam.accuracy=positioncoords.accuracy)}},Timetracker.generalSettings={userBasedSettings:null,settingDetails:null,workitemListing:null,deletedWorkitems:"",timelogEnabledFields:{},loadingSettingsPage:function(){Timetracker.initSetup(),Timetracker.setWorkitemCache(),Layout.Page.container.find("#generalSettingsDiv").hide(),Timetracker.generalSettings.getSyncTimesheetSettings(),Timetracker.generalSettings.constructWorkitems(!1,{showCommonWorkitems:!0}),Timetracker.generalSettings.displayGeneralSettings(Timetracker.generalSettings.settingDetails)},getSyncTimesheetSettings:function(){null===Timetracker.generalSettings.settingDetails&&$.ajax({type:"POST",async:!1,url:Timetracker.constants.URL,data:{mode:"getTimesheetSettings",conreqcsr:csrfToken},success:function(data){Timetracker.generalSettings.settingDetails=data,Timetracker.generalSettings.updateTimelogCustFieldsCache(data)}})},updateTimelogCustFieldsCache:function(data){Timetracker.generalSettings.timelogEnabledFields.TLC_Clients=data.TLC_Clients,Timetracker.generalSettings.timelogEnabledFields.TLC_Projects=data.TLC_Projects,Timetracker.generalSettings.timelogEnabledFields.TLC_Desc=data.TLC_Desc,Timetracker.generalSettings.timelogEnabledFields.TLC_Workitem=data.TLC_Workitem,Timetracker.generalSettings.timelogEnabledFields.TLC_Clients_Mandatory=data.TLC_Clients_Mandatory,Timetracker.generalSettings.timelogEnabledFields.TLC_Projects_Mandatory=data.TLC_Projects_Mandatory,Timetracker.generalSettings.timelogEnabledFields.TLC_Workitem_Mandatory=data.TLC_Workitem_Mandatory,Timetracker.generalSettings.timelogEnabledFields.TLC_Desc_Mandatory=data.TLC_Desc_Mandatory,Timetracker.generalSettings.timelogEnabledFields.TLC_Billable_Show=data.TLC_Billable_Show,Timetracker.generalSettings.timelogEnabledFields.TLC_Attachment_Show=data.TLC_Attachment_Show,Timetracker.util.workitemDispName=Timetracker.util.gettlFieldDispName(data,Timetracker.constants.WORKITEM),Timetracker.util.descriptionDispName=Timetracker.util.gettlFieldDispName(data,Timetracker.constants.DESC),Timetracker.util.attachmentDispName=Timetracker.util.gettlFieldDispName(data,Timetracker.constants.ATTACHMENT)},disableTimerRelatedSettings:function(element){Timetracker.generalSettings.disablePushToAttendance(element),Timetracker.generalSettings.disableAttCheckinTimerRestrict()},isTimerAttIntgAllowed:function(type){return void 0===type?void 0===Timetracker.generalSettings.settingDetails.specificSettings||void 0===Timetracker.generalSettings.settingDetails.specificSettings.timerAttIntgFlag:"isTimerLogdisabled"===type?!(Timetracker.generalSettings.settingDetails.specificSettings&&0===Timetracker.generalSettings.settingDetails.specificSettings.timerAttIntgFlag):"isRestrictTLInAttHrs"===type?!(Timetracker.generalSettings.settingDetails.specificSettings&&1===Timetracker.generalSettings.settingDetails.specificSettings.timerAttIntgFlag):"isRestrictTimerWhenNotCheckIn"===type?!(Timetracker.generalSettings.settingDetails.specificSettings&&2===Timetracker.generalSettings.settingDetails.specificSettings.timerAttIntgFlag):void 0},isStartEndAttIntgAllowed:function(type){return void 0===type?void 0===Timetracker.generalSettings.settingDetails.specificSettings||void 0===Timetracker.generalSettings.settingDetails.specificSettings.startEndAttIntgFlag:"isStartEndLogdisabled"===type?!(Timetracker.generalSettings.settingDetails.specificSettings&&0===Timetracker.generalSettings.settingDetails.specificSettings.startEndAttIntgFlag):"isRestrictTLInAttHrs"===type?!(Timetracker.generalSettings.settingDetails.specificSettings&&1===Timetracker.generalSettings.settingDetails.specificSettings.startEndAttIntgFlag):"isTLOverlapAllowed"===type?!(Timetracker.generalSettings.settingDetails.specificSettings&&2===Timetracker.generalSettings.settingDetails.specificSettings.startEndAttIntgFlag):void 0},disablePushToAttendance:function(){Layout.Page.container.find("#tssettings_timestamp_automatic").is(":checked")?(Layout.Page.container.find("#tssettings_attendance_timer").prop("disabled",!1),Layout.Page.container.find("#tssettings_attendance_timer").parent().removeClass("lbl_disbld").attr("title","")):(Layout.Page.container.find("#tssettings_attendance_timer").is(":checked")&&(Layout.Page.container.find("#tssettings_attendance_timer").prop("checked",!1),Timetracker.util.showAlert(1,ZPI18N.getString("zp.disabledatt"))),Layout.Page.container.find("#tssettings_attendance_timer").prop("disabled",!0),Layout.Page.container.find("#tssettings_attendance_timer").parent().addClass("lbl_disbld").attr("title",ZPI18N.getString("zp.disabledattendance"))),Layout.Page.container.find("#tssettings_timestamp_fromtolog").is(":checked")&&Layout.Page.container.find("#timeentry_overlap_restrict").is(":checked")?(Layout.Page.container.find("#tssettings_attendance_startend").prop("disabled",!1),Layout.Page.container.find("#tssettings_attendance_startend").parent().removeClass("lbl_disbld").attr("title","")):(Layout.Page.container.find("#tssettings_attendance_startend").is(":checked")&&(Layout.Page.container.find("#tssettings_attendance_startend").prop("checked",!1),Timetracker.util.showAlert(1,ZPI18N.getString("zp.disabledatt2"))),Layout.Page.container.find("#tssettings_attendance_startend").prop("disabled",!0),Layout.Page.container.find("#tssettings_timestamp_fromtolog").is(":checked")?Layout.Page.container.find("#tssettings_attendance_startend").parent().addClass("lbl_disbld").attr("title",ZPI18N.getString("zp.disabledattendance3")):Layout.Page.container.find("#tssettings_attendance_startend").parent().addClass("lbl_disbld").attr("title",ZPI18N.getString("zp.disabledattendance2")))},checkSpecificSettingsBasedOnAttIntg:function(element){var eleId=$(element).attr("id");"tssettings_timestamp_fromtolog"===eleId&&!$(element).is(":checked")&&Timetracker.generalSettings.isPushStartEndLogToAttendanceEnabled()?($(element).prop("checked",!0),Timetracker.util.showAlert(1,ZPI18N.getString("zp.enableFromTolog"))):"tssettings_timestamp_automatic"===eleId&&!$(element).is(":checked")&&Timetracker.generalSettings.isPushTimerToAttendanceEnabled()?($(element).prop("checked",!0),Timetracker.util.showAlert(1,ZPI18N.getString("zp.enableAutomaticlog"))):"tssettings_att_timelog"===eleId&&$(element).is(":checked")&&(Timetracker.generalSettings.isPushTimerToAttendanceEnabled()||Timetracker.generalSettings.isPushStartEndLogToAttendanceEnabled())?($(element).prop("checked",!1),Timetracker.util.showAlert(1,ZPI18N.getString("zp.disableattHrsExceedTimelog"))):"timeentry_overlap_allow"!==eleId&&"timeentry_overlap_warn"!==eleId||!Layout.Page.container.find("#timeentry_overlap_restrict").is(":checked")&&Timetracker.generalSettings.isPushStartEndLogToAttendanceEnabled()&&(Layout.Page.container.find("#timeentry_overlap_allow").prop("checked",!1),Layout.Page.container.find("#timeentry_overlap_warn").prop("checked",!1),Layout.Page.container.find("#timeentry_overlap_restrict").prop("checked",!0),Timetracker.util.showAlert(1,ZPI18N.getString("zp.restrictTimelogOverlap")))},disableAttCheckinTimerRestrict:function(data){var attCheckInTimerDom=Layout.Page.container.find("#tssettings_att_timer_checkin"),isPushTimerEnabled=0!=Layout.Page.container.find("#tssettings_attendance_timer").length?Layout.Page.container.find("#tssettings_attendance_timer").is(":checked"):data&&"1"===data.TS_attendance;attCheckInTimerDom.prop("disabled",!1),attCheckInTimerDom.parent().removeClass("lbl_disbld").attr("title",""),Layout.Page.container.find("#tssettings_timestamp_automatic").is(":checked")?isPushTimerEnabled&&(attCheckInTimerDom.prop("checked",!1),attCheckInTimerDom.prop("disabled",!0),attCheckInTimerDom.parent().addClass("lbl_disbld").attr("title",ZPI18N.getString("zp.attCheckinLogTimerNote"))):attCheckInTimerDom.is(":checked")&&(attCheckInTimerDom.prop("checked",!1),attCheckInTimerDom.prop("disabled",!0),Timetracker.util.showAlert(1,ZPI18N.getString("zp.disabledatt3")),attCheckInTimerDom.parent().addClass("lbl_disbld").attr("title",ZPI18N.getString("zp.disabledattendance")))},showWarningAttSetting:function(ele){Timetracker.generalSettings.settingDetails;var eleId=$(ele).attr("id"),attHrsTimelogRestrictDom=Layout.Page.container.find("#tssettings_att_timelog"),timerPushToAttDom=Layout.Page.container.find("#tssettings_attendance_timer"),timelogPushToAttDom=Layout.Page.container.find("#tssettings_attendance_startend"),attCheckinTimerDom=Layout.Page.container.find("#tssettings_att_timer_checkin"),timerEnableDom=Layout.Page.container.find("#tssettings_timestamp_automatic");if(timerEnableDom.is(":checked")||(timerPushToAttDom.prop("checked",!1),timerPushToAttDom.prop("disabled",!0),timerPushToAttDom.parent().addClass("lbl_disbld").attr("title",ZPI18N.getString("zp.disabledattendance")),attCheckinTimerDom.prop("checked",!1),attCheckinTimerDom.prop("disabled",!0),attCheckinTimerDom.parent().addClass("lbl_disbld").attr("title",ZPI18N.getString("zp.disabledattendance"))),"tssettings_attendance_timer"!=eleId&&"tssettings_attendance_startend"!=eleId||(attHrsTimelogRestrictDom.is(":checked")?(Timetracker.util.showAlert(1,ZPI18N.getString("zp.cannotenablepushtimertoatt")),timerPushToAttDom.prop("checked",!1),timerPushToAttDom.prop("disabled",!0),timerPushToAttDom.parent().addClass("lbl_disbld").attr("title",ZPI18N.getString("zp.cannotenablepushtimertoatt")),timelogPushToAttDom.prop("checked",!1),timelogPushToAttDom.prop("disabled",!0),timelogPushToAttDom.parent().addClass("lbl_disbld").attr("title",ZPI18N.getString("zp.cannotenablepushtimertoatt"))):timerEnableDom.is(":checked")?(timerPushToAttDom.prop("disabled",!1),timerPushToAttDom.parent().removeClass("lbl_disbld").attr("title",""),Layout.Page.container.find("#timeentry_overlap_restrict").prop("checked")&&(timelogPushToAttDom.prop("disabled",!1),timelogPushToAttDom.parent().removeClass("lbl_disbld").attr("title",""))):(timerPushToAttDom.prop("checked",!1),timerPushToAttDom.prop("disabled",!0),timerPushToAttDom.parent().addClass("lbl_disbld").attr("title",ZPI18N.getString("zp.disabledattendance")))),"tssettings_attendance_timer"==eleId&&(timerPushToAttDom.is(":checked")?attCheckinTimerDom.is(":checked")?(Timetracker.util.showAlert(1,ZPI18N.getString("zp.cannotenablepushtimertoatt2")),timerPushToAttDom.prop("checked",!1),timerPushToAttDom.prop("disabled",!0),timerPushToAttDom.parent().addClass("lbl_disbld").attr("title",ZPI18N.getString("zp.cannotenablepushtimertoatt2"))):(timerPushToAttDom.prop("disabled",!1),timerPushToAttDom.parent().removeClass("lbl_disbld").attr("title","")):(attCheckinTimerDom.prop("disabled",!1),attCheckinTimerDom.parent().removeClass("lbl_disbld").attr("title",""))),"tssettings_att_timelog"==eleId&&(attHrsTimelogRestrictDom.is(":checked")&&(timerPushToAttDom.is(":checked")||timelogPushToAttDom.is(":checked"))?(Timetracker.util.showAlert(1,ZPI18N.getString("zp.attHrsExceedTimelogNote")),attHrsTimelogRestrictDom.prop("disabled",!0),attHrsTimelogRestrictDom.prop("checked",!1),attHrsTimelogRestrictDom.parent().addClass("lbl_disbld").attr("title",ZPI18N.getString("zp.attHrsExceedTimelogNote"))):(attHrsTimelogRestrictDom.prop("disabled",!1),attHrsTimelogRestrictDom.parent().removeClass("lbl_disbld").attr("title",""))),"tssettings_att_timer_checkin"==eleId)if(attCheckinTimerDom.is(":checked"))if(timerPushToAttDom.is(":checked")||!timerEnableDom.is(":checked")){var msg=timerPushToAttDom.is(":checked")?ZPI18N.getString("zp.attCheckinLogTimerNote"):ZPI18N.getString("zp.disabledattendance");Timetracker.util.showAlert(1,msg),attCheckinTimerDom.prop("checked",!1),attCheckinTimerDom.prop("disabled",!0),attCheckinTimerDom.parent().addClass("lbl_disbld").attr("title",msg)}else attCheckinTimerDom.prop("disabled",!1),attCheckinTimerDom.parent().removeClass("lbl_disbld").attr("title","");else timerPushToAttDom.prop("disabled",!1),timerPushToAttDom.parent().removeClass("lbl_disbld").attr("title","")},setWeekendHolidayOvertimeInput:function(data){Layout.Page.container.find("#weekend_input,#holiday_input").prop("checked",!1),Timetracker.generalSettings.isWeekendOTEnabled(null,null,data)&&Layout.Page.container.find("#weekend_input").prop("checked",!0),Timetracker.generalSettings.isHolidayOTEnabled(null,null,data)&&Layout.Page.container.find("#holiday_input").prop("checked",!0)},getMaxLogHours:function(id,maxlogHrsType,data){if(Timetracker.util.removeErrorMsg(id),"1"===maxlogHrsType&&Timetracker.generalSettings.setWeekendHolidayOvertimeInput(data),"1"===maxlogHrsType||"2"===maxlogHrsType){if(0===Layout.Page.container.find("#max_hrs_val").length){var txt=$('<input class="form-control MT10 MB10 W80" id="max_hrs_val" maxlength="7"/>');Layout.Page.container.find("#tssettings_maxloghrs").append(txt)}var value="1"===maxlogHrsType?Timetracker.generalSettings.getMaxHoursPerDay(null,null,data):Timetracker.generalSettings.getMaxHoursPerWeek(null,null,data);if(value=void 0===value?0:value,Layout.Page.container.find("#tssettings_maxloghrs").find("#max_hrs_val").val(Calendar.minstohrs(value)),0===Layout.Page.container.find("#tssettings_ot").length){txt=$('<div class="blkCbox"><label id="tssettings_ot" class="checkbox DIB MR10"> <input id="tssettings_otval" type="checkbox"><span>'+ZPI18N.getString("zp.allowovertime")+"</span></label>");Layout.Page.container.find("#tssettings_maxloghrs").append(txt)}Layout.Page.container.find("#tssettings_ot").off("click").on("click",function(){Timetracker.generalSettings.showSingleDoublePayHours(data)}),Layout.Page.container.find("#tssettings_otval").prop("checked",!(maxlogHrsType!==Timetracker.generalSettings.getMaxLogHoursRestrictType(null,null,data)||!Timetracker.generalSettings.isOTAllowed(null,null,data))),Timetracker.generalSettings.showSingleDoublePayHours(data)}else Layout.Page.container.find("#max_hrs_val,#tssettings_ot,#tsot_singledoublepay,#tssettings_payot,#tsweekend_ot,#tsholiday_ot").remove()},showHideMinMaxHrsInput:function(id,enabledVal,data,type){Timetracker.util.removeErrorMsg(id);var idPrefix="min"===type?"min":"max";if("1"===enabledVal){Layout.Page.container.find("#"+idPrefix+"_hrs_value_box").css("display","block"),Layout.Page.container.find("#"+idPrefix+"_per_day").css("display","block"),Layout.Page.container.find("#"+idPrefix+"_per_week").css("display","block");var hrsType="min"===type?data.TS_MinHrsType:data.TS_MaxHrsType;"0"===hrsType?Layout.Page.container.find("#"+idPrefix+"hrsperday_chkbox").prop("checked","checked"):"1"===hrsType?Layout.Page.container.find("#"+idPrefix+"hrsperweek_chkbox").prop("checked","checked"):"2"===hrsType?(Layout.Page.container.find("#"+idPrefix+"hrsperday_chkbox").prop("checked","checked"),Layout.Page.container.find("#"+idPrefix+"hrsperweek_chkbox").prop("checked","checked")):(Layout.Page.container.find("#"+idPrefix+"hrsperday_chkbox").prop("checked",!1),Layout.Page.container.find("#"+idPrefix+"hrsperweek_chkbox").prop("checked",!1));var hours=0;hours="min"===type?void 0===data.TS_MinHrsPerDay?0:data.TS_MinHrsPerDay:void 0===data.TS_MaxHrsPerDay?0:data.TS_MaxHrsPerDay,Layout.Page.container.find("#"+idPrefix+"_hrs_value_box").find("#"+idPrefix+"_per_day"),Layout.Page.container.find("#"+idPrefix+"_hrs_value_box").find("#"+idPrefix+"_per_day").val(Calendar.minstohrs(hours)),hours="min"===type?void 0===data.TS_MinHrsPerWeek?0:data.TS_MinHrsPerWeek:void 0===data.TS_MaxHrsPerWeek?0:data.TS_MaxHrsPerWeek,Layout.Page.container.find("#"+idPrefix+"_hrs_value_box").find("#"+idPrefix+"_per_day"),Layout.Page.container.find("#"+idPrefix+"_hrs_value_box").find("#"+idPrefix+"_per_week").val(Calendar.minstohrs(hours))}else Layout.Page.container.find("#"+idPrefix+"_hrs_value_box").css("display","none"),Layout.Page.container.find("#"+idPrefix+"_per_day").css("display","none"),Layout.Page.container.find("#"+idPrefix+"_per_week").css("display","none")},showHidePastDays:function(id,isChecked,data){Timetracker.util.removeErrorMsg(id);var pastLogDiv=Layout.Page.container.find("#tssettings_pastlogdaysdiv");if(pastLogDiv.find("input[name=pastlogdays]").off("change"),isChecked){pastLogDiv.find("input[name=pastlogdays]").on("change",function(){Timetracker.generalSettings.showHidePastLogInput(id,pastLogDiv,$(this).val(),data)});var isAllDays=data.TS_pastLogAllowDays&&data.TS_pastLogAllowDays>0?"1":"0";pastLogDiv.find("input[name=pastlogdays][value="+isAllDays+"]").prop("checked",!0).trigger("change"),pastLogDiv.show()}else pastLogDiv.hide()},showHidePastLogInput:function(id,pastLogDiv,enabledVal,data){if(Timetracker.util.removeErrorMsg(id),"0"===enabledVal)pastLogDiv.find("#tssettings_pastlog_pastdaysvalue").val("").attr("disabled",!0);else{var pastLogAllowDays=data.TS_pastLogAllowDays&&0!=data.TS_pastLogAllowDays?data.TS_pastLogAllowDays:"";pastLogDiv.find("#tssettings_pastlog_pastdaysvalue").val(pastLogAllowDays).attr("disabled",!1)}},showSingleDoublePayHours:function(data){var txt_wht=$('<label id="tsweekend_ot" class="checkbox DIB MR10"> <input id="weekend_input" type="checkbox"><span>'+ZPI18N.getString("zp.weekendOT")+'</span></label><label id="tsholiday_ot" class="checkbox DIB MR10"> <input id="holiday_input" type="checkbox"><span>'+ZPI18N.getString("zp.holidayOT")+"</span></label></div>"),maxlogHrsType=Layout.Page.container.find("input[name=maxloghrstype]:checked").val(),isChecked=Layout.Page.container.find("#tssettings_otval").is(":checked");if(Layout.Page.container.find("#tssettings_otval").prop("checked",isChecked),isChecked){if(0===Layout.Page.container.find("#tsot_singledoublepay").length){var txt=$('<div id="tsot_singledoublepay"><div class="Almil"><label class="FL MT8 MR10">'+ZPI18N.getString("zp.otsinglehours")+'</label><div class="input-group curncy-group FR W120"><input class="form-control" id="tsot_singlepay_val" maxlength="7"><div class="input-group-addon">HRS</div></div><div class=" clearfix"></div></div><div class="Almil"><label class="FL MT8 MR10">'+ZPI18N.getString("zp.otdoublehours")+'</label><div class="input-group curncy-group FR W120"><input class="form-control" id="tsot_doublepay_val" maxlength="7"><div class="input-group-addon">HRS</div></div><div class=" clearfix"></div></div><i data-popover="true" data-html="true" data-content="<p class=\'LH18I\'>'+ZPI18N.getString("zp.ot_doublehoursdesc")+'</p>" style="/*! bottom:24px; */ /*! right:0; */margin-right: -30px;margin-top: -40px;" class="IC-info S18 gry popHover FR"></i></div>');Layout.Page.container.find("#tssettings_maxloghrs").find("#tssettings_ot").after(txt),Layout.Page.container.popover({selector:"[data-popover].popHover",trigger:"click hover",placement:"right"})}0!==Layout.Page.container.find("#tshol_ot")&&(Layout.Page.container.find("#tsweekend_ot").remove(),Layout.Page.container.find("#tsholiday_ot").remove(),"1"===maxlogHrsType&&(Layout.Page.container.find("#tsot_singledoublepay").parent().append(txt_wht),Timetracker.generalSettings.setWeekendHolidayOvertimeInput(data)));var singleValue=0,doubleValue=0;maxlogHrsType===Timetracker.generalSettings.getMaxLogHoursRestrictType(null,null,data)&&(singleValue=Timetracker.generalSettings.getSinglePayOTHours(null,null,data),doubleValue=Timetracker.generalSettings.getDoublePayOTHours(null,null,data)),Layout.Page.container.find("#tssettings_maxloghrs").find("#tsot_singlepay_val").val(Calendar.minstohrs(singleValue)),Layout.Page.container.find("#tssettings_maxloghrs").find("#tsot_doublepay_val").val(Calendar.minstohrs(doubleValue))}else Layout.Page.container.find("#tsot_singledoublepay").remove(),0!==Layout.Page.container.find("#tsweekend_ot")&&(Layout.Page.container.find("#tsweekend_ot").remove(),Layout.Page.container.find("#tsholiday_ot").remove(),"1"===maxlogHrsType&&(Layout.Page.container.find("#tssettings_ot").parent().append(txt_wht),Timetracker.generalSettings.setWeekendHolidayOvertimeInput(data)))},displayLeaveRestriction:function(data){Layout.Page.container.find("#tssettings_include_holiday").prop("checked",!1),"1"===data.TS_holidayLogRestriction&&Layout.Page.container.find("#tssettings_include_holiday").prop("checked",!0),Layout.Page.container.find("#tssettings_include_weekend").prop("checked",!1),"1"===data.TS_weekendLogRestriction&&Layout.Page.container.find("#tssettings_include_weekend").prop("checked",!0),Layout.Page.container.find("#tssettings_include_unpaid").prop("checked",!1),"1"===data.TS_unpaidLeaveTLRestriction&&Layout.Page.container.find("#tssettings_include_unpaid").prop("checked",!0),Layout.Page.container.find("#tssettings_include_paid").prop("checked",!1),"1"===data.TS_paidLeaveTLRestriction&&Layout.Page.container.find("#tssettings_include_paid").prop("checked",!0)},getAbsentName:function(){var abName="Absent";if(void 0!==ZPeople.Module.MODULE_DATA.leavetracker&&void 0!==ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops&&ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.hasOwnProperty("leavetype")){var leaveJson=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.leavetype;$.each(leaveJson,function(index,data){2===data.type&&(abName=data.name)}),Layout.Page.container.find("#absentText").text(abName)}else{var params={mode:"getAbsentName"};params.conreqcsr=csrfToken,$.post(Timetracker.constants.URL,params,function(result){null!==result&&result.hasOwnProperty("name")&&(abName=result.name),Layout.Page.container.find("#absentText").text(abName)})}},getSelectedLeaveRestrction:function(params){params.isWeekendLogRestricted="0",Layout.Page.container.find("#tssettings_include_weekend").is(":checked")&&(params.isWeekendLogRestricted="1"),params.isHolidayLogRestricted="0",Layout.Page.container.find("#tssettings_include_holiday").is(":checked")&&(params.isHolidayLogRestricted="1"),params.isUnpaidLogRestricted="0",Layout.Page.container.find("#tssettings_include_unpaid").is(":checked")&&(params.isUnpaidLogRestricted="1"),params.isPaidLogRestricted="0",Layout.Page.container.find("#tssettings_include_paid").is(":checked")&&(params.isPaidLogRestricted="1")},showHideRestrictTSSubmissionPeriod:{onTimesheetPeriodChange:function(obj,settings){var tsPeriod=Timetracker.generalSettings.getTSPeriod(null,null,settings),ts_period=$(obj).val(),submissionDiv=Layout.Page.container.find("#tssettings_tssubmissiondiv");if(submissionDiv.addClass("DN"),submissionDiv.find("#tssettings_tsrestrict,#tssettings_tsspan").addClass("DN"),ts_period===Timetracker.constants.TS_PERIOD.WEEK||ts_period===Timetracker.constants.TS_PERIOD.MONTH){if(submissionDiv.find("#tssettings_tsrestrict").removeClass("DN"),submissionDiv.find("#tssettings_tsrestrict").off("click").on("click",function(){Timetracker.generalSettings.showHideRestrictTSSubmissionPeriod.onRestrictEnableDisable(this,settings)}),submissionDiv.find("#tssettings_restricttimesheetsubmission").prop("checked",!1),tsPeriod===ts_period){var tsSubmissionPeriod=Timetracker.generalSettings.getTSSubmissionPeriod(null,null,settings);tsSubmissionPeriod&&0!==Object.keys(tsSubmissionPeriod).length&&(submissionDiv.find("#tssettings_restricttimesheetsubmission").prop("checked",!0),submissionDiv.find("#tssettings_tsrestrict").trigger("click"))}submissionDiv.removeClass("DN")}},onRestrictEnableDisable:function(obj,settings){var tsPeriod=Timetracker.generalSettings.getTSPeriod(null,null,settings),isEnabled=$(obj).find("#tssettings_restricttimesheetsubmission").is(":checked"),ts_submission_period_div=$(obj).parents("#tssettings_tssubmissiondiv"),ts_spanDiv=ts_submission_period_div.find("#tssettings_tsspan");if(ts_spanDiv.addClass("DN"),ts_submission_period_div.find(".error-msg").remove(),ts_spanDiv.find("#ts_period_note").remove(),isEnabled){var ts_period=Layout.Page.container.find("#tssettings_timesheetperiod").val();if(ts_period===Timetracker.constants.TS_PERIOD.WEEK||ts_period===Timetracker.constants.TS_PERIOD.MONTH){var dayoptions,rangeoptions;if(ts_period===Timetracker.constants.TS_PERIOD.WEEK?(dayoptions=Timetracker.DateTime.constructDayOfWeekOptions(),rangeoptions='<option value="0"> '+ZPI18N.getString("zp.scurrentweek")+' </option><option value="1"> '+ZPI18N.getString("zp.snextweek")+" </option>"):(dayoptions=Timetracker.DateTime.constructDayOfMonthOptions(),rangeoptions='<option value="0"> '+ZPI18N.getString("zp.scurrentmonth")+' </option><option value="1"> '+ZPI18N.getString("zp.snextmonth")+" </option>"),ts_spanDiv.find("#from_day,#to_day").html('<option value="-1"> '+ZPI18N.getString("zp.select")+" </option>"+dayoptions).val("-1"),ts_spanDiv.find("#from_day,#to_day").off("change").on("change",Timetracker.generalSettings.showHideRestrictTSSubmissionPeriod.onDayChange),ts_spanDiv.find("#from_range,#to_range").html(rangeoptions).val("0"),ts_spanDiv.find("#from_range,#to_range").off("change").on("change",Timetracker.generalSettings.showHideRestrictTSSubmissionPeriod.appendNote),ts_spanDiv.find("#from_range_span,#to_range_span").addClass("DN"),tsPeriod===ts_period){var tsSubmissionPeriod=Timetracker.generalSettings.getTSSubmissionPeriod(null,null,settings);tsSubmissionPeriod&&0!==Object.keys(tsSubmissionPeriod).length&&(void 0!==tsSubmissionPeriod.from_day&&(ts_spanDiv.find("#from_day").val(tsSubmissionPeriod.from_day).trigger("change"),ts_spanDiv.find("#from_range").val(tsSubmissionPeriod.from_range).trigger("change")),void 0!==tsSubmissionPeriod.to_day&&(ts_spanDiv.find("#to_day").val(tsSubmissionPeriod.to_day).trigger("change"),ts_spanDiv.find("#to_range").val(tsSubmissionPeriod.to_range).trigger("change")))}ts_spanDiv.removeClass("DN")}}},onDayChange:function(event){var ele,day=$(this).val();"from_day"===event.target.id?ele=$(this).siblings("#from_range_span"):"to_day"===event.target.id&&(ele=$(this).siblings("#to_range_span")),ele&&("-1"===day?ele.addClass("DN"):ele.removeClass("DN")),Timetracker.generalSettings.showHideRestrictTSSubmissionPeriod.appendNote()},appendNote:function(){var ts_period=Layout.Page.container.find("#tssettings_timesheetperiod").val(),ts_submission_period_div=Layout.Page.container.find("#tssettings_tssubmissiondiv"),ts_spanDiv=ts_submission_period_div.find("#tssettings_tsspan");ts_submission_period_div.find(".error-msg").remove(),ts_spanDiv.find("#ts_period_note").remove();var note_content,from_day=ts_spanDiv.find("#from_day").val(),from_range=ts_spanDiv.find("#from_range").val(),to_day=ts_spanDiv.find("#to_day").val(),to_range=ts_spanDiv.find("#to_range").val(),msg_key=ts_period===Timetracker.constants.TS_PERIOD.WEEK?"week":ts_period===Timetracker.constants.TS_PERIOD.MONTH?"month":null,from_range_key="-1"!==from_range?"0"===from_range?"cur":"1"===from_range?"nxt":null:null,to_range_key="-1"!==to_range?"0"===to_range?"cur":"1"===to_range?"nxt":null:null;if(null!=msg_key)if("-1"!==from_day&&"-1"!==to_day){if(parseInt(from_range)>parseInt(to_range)||parseInt(from_day)>parseInt(to_day)&&parseInt(from_range)===parseInt(to_range))return void ts_submission_period_div.find("[label='timesheetSubmissionPeriod']").append('<div class="error-msg">'+ZPI18N.getString("zp.tsfromperiodgreaterthanto")+"</div>");note_content=from_day===to_day&&from_range===to_range?ZPI18N.getString("zp.tsperiod"+msg_key+from_range_key+"on",[Timetracker.generalSettings.showHideRestrictTSSubmissionPeriod.getPeriodValueForNote(ts_period,from_day)]):ZPI18N.getString("zp.tsperiod"+msg_key+from_range_key+to_range_key+"range",[Timetracker.generalSettings.showHideRestrictTSSubmissionPeriod.getPeriodValueForNote(ts_period,from_day),Timetracker.generalSettings.showHideRestrictTSSubmissionPeriod.getPeriodValueForNote(ts_period,to_day)])}else"-1"!==from_day&&"-1"===to_day?note_content=ZPI18N.getString("zp.tsperiod"+msg_key+from_range_key+"from",[Timetracker.generalSettings.showHideRestrictTSSubmissionPeriod.getPeriodValueForNote(ts_period,from_day)]):"-1"===from_day&&"-1"!==to_day&&(note_content=ZPI18N.getString("zp.tsperiod"+msg_key+to_range_key+"to",[Timetracker.generalSettings.showHideRestrictTSSubmissionPeriod.getPeriodValueForNote(ts_period,to_day)]));note_content&&ts_spanDiv.append('<div id="ts_period_note" class="label-message label-note text-leftI P10I MT15 B0I" style="line-height:18px"><p class="S13">'+note_content+"</p></div>")},getPeriodValueForNote:function(ts_period,val){return ts_period===Timetracker.constants.TS_PERIOD.WEEK?Timetracker.DateTime.getDayOfWeek(parseInt(val)):ts_period===Timetracker.constants.TS_PERIOD.MONTH?Timetracker.DateTime.getDayOfMonth(parseInt(val),!0):val}},jobScheduleViewEditPermChange:function(obj){var objVal=$(obj).val();Layout.Page.container.find("#tt_jobschd_edit_settings option").attr("disabled",!1),"0"===objVal?(Layout.Page.container.find("#tt_jobschd_edit_settings option[value!=0]").attr("disabled","true"),Layout.Page.container.find("#tt_jobschd_edit_settings").select2("val","0")):"1"===objVal&&(Layout.Page.container.find("#tt_jobschd_edit_settings option[value=2]").attr("disabled","true"),Layout.Page.container.find("#tt_jobschd_edit_settings").select2("val","0"))},getJobSchedulePermission:function(params){var viewPerm=Layout.Page.container.find("#tt_jobschd_view_settings").val(),editPerm=Layout.Page.container.find("#tt_jobschd_edit_settings").val();return viewPerm<editPerm?(Timetracker.util.showAlert(0,ZPI18N.getString("zp.editviewpermcontradiction")),!1):(viewPerm&&editPerm&&(params.jobScheduleView=viewPerm,params.jobScheduleEdit=editPerm),!0)},needToResetWorkitemBoolean:function(params){(params.hasOwnProperty("workitemArr")&&""!==params.workitemArr||params.hasOwnProperty("deletedWorkitems")&&""!==params.deletedWorkitems)&&Timetracker.timelogs.workItem.resetWorkitemCache(params.zp_recordId)},htmlForWorkitemField:function(otherDetails){var workitemDispName=Timetracker.util.getWorkItemDispName(!1,!0),dataContent=ZPI18N.getString("zp.infoworkiteminjob",[workitemDispName]);otherDetails.hasOwnProperty("fieldWidth")&&otherDetails.fieldWidth;var html="";return Timetracker.forms.isFromOperations?html+='<div class="zpl_secn" isallowed="true"><div class="d-flexC"><label>'+workitemDispName+'</label><i class="PI_info tooltip-js" data-title-position="right" data-html="true" title="'+dataContent+'"></i></div><div folabel="WORKITEM"><div class="zpl_gbox mxhgt" id="workitems_body"></div></div></div>':(html='<div class="zp-label zp-labelWI" isallowed="false"><label class="zplt-label PR">'+workitemDispName+'<div class="ZPActIcn" style="top: 0;left: 80px;margin: 0;width: auto;" id="wiContentPopOver"><a data-popover="true" data-content="'+dataContent+'" data-placement="right" data-toggle="popover" data-html="true" class="IC-info popHover" data-original-title="" title=""></a></div></label><div folabel="WORKITEM" class="zprt-label">',html+='<div class="ZPSCdiv Tcstm MB10">',html+='<table class="table"><tbody id="workitems_body"> </tbody></table></div></div></div>'),html},htmlForWorkitemFieldView:function(otherDetails){var html='<div fieldouter="true" class="zpl_secn" isallowed="true"><div><label elem="labelName" class="">'+Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.WORKITEM)+'</label><span elem="viewToolTip"></span></div><div folabel="BillableStatus">';if(otherDetails){var workitemLists=otherDetails.workitemDetails;workitemLists&&0!==workitemLists.length?(html+='<div class="zpl_tglist">',$.each(workitemLists,function(index,data){var txt='<div class="zpl_tg"><span>'+data.wiName+"</span></div>";html+=txt}),html+="</div>"):html+="<span>-</span>"}return html+="</div></div>"},constructWorkitems:function(refreshData,extraDetails){var isFromForm=void 0!==extraDetails&&void 0!==extraDetails.isFromForm&&extraDetails.isFromForm;void 0!==refreshData&&refreshData&&!isFromForm&&(delete Timetracker.timelogs.workItemDataCache,Timetracker.setWorkitemCache());var showCommonWorkitems=void 0!==extraDetails&&void 0!==extraDetails.showCommonWorkitems&&extraDetails.showCommonWorkitems,txt="",result=null,workitemDispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.WORKITEM);if(!isFromForm&&void 0!==Timetracker.timelogs.workItemDataCache&&0!==Timetracker.timelogs.workItemDataCache.length&&Timetracker.timelogs.workItemDataCache.hasOwnProperty("allWorkitemUnmapped"))showCommonWorkitems&&(result=Timetracker.timelogs.workItemDataCache.allWorkitemUnmapped);else if(isFromForm)if(ZPForm.isEditMode()){var jobId=extraDetails.jobId,applyJson=Timetracker.timelogs.checkIfDropDownNeededForWorkitem({jobId:jobId,skipGeneralWitems:!0});"false"===applyJson.input&&(result=applyJson.data)}else(ZPForm.isAddMode()||ZPForm.isPreviewForm)&&(result=null);Layout.Page.container.find("#workitems_body").html(""),null===result||0===result.length||""===result?(txt='<tr><td><input type="text" class="form-control" onkeyup="Timetracker.generalSettings.validateWorkitemLength(this);" placeholder="'+ZPI18N.getString("zp.workitemplaceholder",[workitemDispName])+'"></td>',txt+="<td>",txt+='<i class="IC-cls-fill S16 gry FL MT5 CP" onclick="Timetracker.generalSettings.deleteWorkitemRows(this);"></i>',txt+='<i class="IC-plus-fill S16 gry FL MT5 ML5 CP" onclick="Timetracker.generalSettings.addWorkitemRows();"></i></td></tr>',Layout.Page.container.find("#workitems_body").append(txt),Layout.Page.container.find("#workitems_body").find(".IC-cls-fill").show()):$.each(result,function(index,data){txt='<tr><td><input type="text" class="form-control" onkeyup="Timetracker.generalSettings.validateWorkitemLength(this);" placeholder="'+ZPI18N.getString("zp.workitemplaceholder",[workitemDispName])+'"title="'+data.wiName+'" value="'+data.wiName+'" wiId="'+data.wiId+'"></td>',txt+="<td>",txt+='<i class="IC-cls-fill S16 gry FL MT5 CP" onclick="Timetracker.generalSettings.deleteWorkitemRows(this);"></i>',txt+='<i class="IC-plus-fill S16 gry FL MT5 ML5 CP" onclick="Timetracker.generalSettings.addWorkitemRows();"></i></td></tr>',Layout.Page.container.find("#workitems_body").find(".IC-cls-fill").show(),Layout.Page.container.find("#workitems_body").find(".IC-plus-fill").hide(),Layout.Page.container.find("#workitems_body").append(txt),0===index&&1===result.length&&(Layout.Page.container.find("#workitems_body").find(".IC-cls-fill").show(),Layout.Page.container.find("#workitems_body").find(".IC-plus-fill").show())})},validateWorkitemErrorInForm:function(){return 0===Layout.Page.container.find("#wiLenErr").length},validateWorkitemLength:function(obj){var currentDom=$(obj),value=$(obj).val(),isWithinMaxLength=value.length;if(currentDom.attr("title",value),currentDom.hasClass("error-clr")&&currentDom.removeClass("error-clr"),currentDom.parent().find(".error-msg").length>0&&currentDom.parent().find(".error-msg").remove(),isWithinMaxLength>500){currentDom.addClass("error-clr");var errDom='<div id="wiLenErr" class="error-msg MB10">'+ZPI18N.getString("zp.namecharlimit",["Work Item","500"])+"</div>";currentDom.parent().append(errDom)}},addWorkitemRows:function(){var workitemDispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.WORKITEM),txt="";Layout.Page.container.find("#workitems_body > tr").length>=1&&(txt+='<tr><td><input type="text" class="form-control" onkeyup="Timetracker.generalSettings.validateWorkitemLength(this);"  placeholder="'+ZPI18N.getString("zp.workitemplaceholder",[workitemDispName])+'"></td>',Layout.Page.container.find("#workitems_body").find(".IC-cls-fill").show(),Layout.Page.container.find("#workitems_body").find(".IC-plus-fill").hide(),txt+="<td>",txt+='<i class="IC-cls-fill S16 gry FL MT5 CP" onclick="Timetracker.generalSettings.deleteWorkitemRows(this);"></i>',txt+='<i class="IC-plus-fill S16 gry FL MT5 ML5 CP" onclick="Timetracker.generalSettings.addWorkitemRows();"></i></td></tr>'),Layout.Page.container.find("#workitems_body").append(txt)},deleteWorkitemRows:function(obj){var siblingsArray=$(obj).parent().siblings(),wiId=$(siblingsArray[0]).find(".form-control").attr("wiId");wiId&&(Timetracker.generalSettings.deletedWorkitems+=wiId+","),$(obj).parent().parent().remove(),Layout.Page.container.find("#workitems_body").find(".IC-plus-fill").last().show(),0===Layout.Page.container.find("#workitems_body > tr").length&&Timetracker.generalSettings.constructWorkitems(!1,{showCommonWorkitems:!1})},removeDeletedWorkitemsFromCache:function(cache){var deletedArr=0!==Timetracker.generalSettings.deletedWorkitems.length?Timetracker.generalSettings.deletedWorkitems.split(","):null;if(null!==deletedArr)for(var i=0;i<deletedArr.length-1;i++){var index=Timetracker.timelogs.findJSONArrayIndexForWorkitem(cache,deletedArr[i],"wiId");cache.splice(index,1)}return cache},updateWorkitemParams:function(params){var workitemArr=new Array,errorFlag=!1,counter=0,existingWorkitemNames={},noOf_new_edit_workitems=0,itrWorkitemData=null,workitemData=Timetracker.timelogs.workItemDataCache&&Timetracker.timelogs.workItemDataCache.allWorkitemUnmapped?Timetracker.timelogs.workItemDataCache.allWorkitemUnmapped:null;if(-1!==Layout.Page.hash.indexOf("scheduler/jobs/edit")||Timetracker.Page.isProjectDashboard("jobs")||Timetracker.UserSpace.isMySpace()||-1!==Layout.Page.hash.indexOf("home/user/jobs")){var jobId=params.zp_recordId;Timetracker.timelogs.workItemDataCache&&Timetracker.timelogs.workItemDataCache[jobId]&&0!==Timetracker.timelogs.workItemDataCache[jobId].length&&(workitemData=Timetracker.timelogs.workItemDataCache[jobId])}if(null!=workitemData){var cache=JSON.parse(JSON.stringify(workitemData));itrWorkitemData=Timetracker.generalSettings.removeDeletedWorkitemsFromCache(cache)}var errJson={};if(Layout.Page.container.find("#workitems_body > tr").each(function(){var textChildren=$(this).children(),wiId=$(textChildren[0]).find(".form-control").attr("wiId"),wiName=$(textChildren[0]).find(".form-control").val().trim();""!==wiName&&(existingWorkitemNames[wiName]?($(textChildren[0]).find("#wiDuplicate").remove(),$(textChildren[0]).append('<span id="wiDuplicate" class="ERR">'+ZPI18N.getString("zp.duplicateWorkitem",[Timetracker.util.workitemDispName])+"</span>"),errorFlag=!0,errJson={errMsg:"duplicate"}):existingWorkitemNames[wiName]="exists",wiName.length>500&&(errorFlag=!0,$(textChildren[0]).find("#wiLenErr").remove(),$(textChildren[0]).append('<span id="wiLenErr" class="ERR">'+ZPI18N.getString("zp.fieldlength",[Timetracker.util.workitemDispName,"500"])+"</span>"),errJson={errMsg:"exceedlength"}),wiId&&!errorFlag?(null!==itrWorkitemData&&wiName===itrWorkitemData[counter].wiName||""!==wiName&&(workitemArr.push({wiName:wiName,wiId:wiId}),noOf_new_edit_workitems++),counter++):errorFlag||""!==wiName.trim()&&(workitemArr.push({wiName:wiName}),noOf_new_edit_workitems++))}),noOf_new_edit_workitems>500)return errJson={errMsg:"workitemCountExceed"};if(errorFlag){if(1!==Layout.Page.container.find("#workitems_body > tr").length)return errJson;var textChildren=$(this).children(),wiId=$(textChildren[0]).find(".form-control").attr("wiId"),wiName=$(textChildren[0]).find(".form-control").val();if(void 0!==wiId||void 0!==wiName)return!1}params.workitemArr=JSON.stringify(workitemArr),params.deletedWorkitems=Timetracker.generalSettings.deletedWorkitems},checkIfWorkitemChanged:function(settingsChanged,params){void 0!==params.workitemArr&&0!==params.workitemArr.length&&("[]"===params.workitemArr&&""===Timetracker.generalSettings.deletedWorkitems||(settingsChanged=!0));return settingsChanged},setGeneralSettings:function(layout,data){void 0!==data.TS_defaultbillingType&&(Timetracker.util.defaultbillingType=data.TS_defaultbillingType),data.TS_DefaultView?layout.find("#tssettings_defaultview").val(data.TS_DefaultView):layout.find("#tssettings_defaultview").val("0"),layout.find("#tssettings_timedisplay[value='"+data.TS_TimeDisplay+"']").prop("checked","checked"),data.TS_defaultbillingType?layout.find("#tssettings_billingstatus").val(data.TS_defaultbillingType):layout.find("#tssettings_billingstatus").val("0"),data.TS_timesheetOwners?layout.find("#tssettings_timesheetcreation").val(data.TS_timesheetOwners):layout.find("#tssettings_timesheetcreation").val("0"),$("#tssettings_timesheetperiod",layout).val(void 0!==data.TS_timesheetPeriod?data.TS_timesheetPeriod:Timetracker.constants.TS_PERIOD.ANY_DATE_RANGE).trigger("change",[data]),$("#tssettings_timesheetoverlap",layout).prop("checked",data.TS_restrictTimesheetOverlap&&"1"===data.TS_restrictTimesheetOverlap),data.TS_automaticLog&&"true"===data.TS_automaticLog?layout.find("#tssettings_timestamp_automatic").prop("checked",!0):layout.find("#tssettings_timestamp_automatic").prop("checked",!1),data.TS_fromToTimeLog&&"true"===data.TS_fromToTimeLog?layout.find("#tssettings_timestamp_fromtolog").prop("checked",!0):layout.find("#tssettings_timestamp_fromtolog").prop("checked",!1),data.TS_manualLog&&"true"===data.TS_manualLog?layout.find("#tssettings_timestamp_manual").prop("checked",!0):layout.find("#tssettings_timestamp_manual").prop("checked",!1),data.TS_clienttimesheetType&&"2"===data.TS_clienttimesheetType?layout.find("#tssettings_timesheetClients_internal").prop("checked",!0):layout.find("#tssettings_timesheetClients_internal").prop("checked",!1),void 0===data.TS_estimatedHoursRestriction||"0"===data.TS_estimatedHoursRestriction?layout.find("#tssettings_estimated_hours_no").prop("checked","checked"):layout.find("#tssettings_estimated_hours_yes").prop("checked","checked"),data.TS_showRPHForAdmin&&"1"===data.TS_showRPHForAdmin?layout.find("#tssettings_isAdmin").prop("checked",!0):layout.find("#tssettings_isAdmin").prop("checked",!1),data.TS_showRPHForApprover&&"1"===data.TS_showRPHForApprover?layout.find("#tssettings_isApprover").prop("checked",!0):layout.find("#tssettings_isApprover").prop("checked",!1),data.TS_showRPHForReportingManager&&"1"===data.TS_showRPHForReportingManager?layout.find("#tssettings_isReportingto").prop("checked",!0):layout.find("#tssettings_isReportingto").prop("checked",!1),data.TS_showRPHForEmployee&&"1"===data.TS_showRPHForEmployee?layout.find("#tssetting_isEmployee").prop("checked",!0):layout.find("#tssetting_isEmployee").prop("checked",!1),data.TS_isApproverEditLogtime&&"1"===data.TS_isApproverEditLogtime?layout.find("#tssettings_isApproverLogsEdit").prop("checked",!0):layout.find("#tssettings_isApproverLogsEdit").prop("checked",!1),"1"===data.TS_restrict24hrsLogPerDay?layout.find("#tssettings_24hrs_timelog_yes").prop("checked",!0):layout.find("#tssettings_24hrs_timelog_no").prop("checked",!0),data.TS_maxLogHoursRestriction?"0"===data.TS_maxLogHoursRestriction?layout.find("#tssettings_maxloghrs_none").prop("checked","checked"):"1"===data.TS_maxLogHoursRestriction?layout.find("#tssettings_maxloghrs_day").prop("checked","checked"):"2"===data.TS_maxLogHoursRestriction&&(layout.find("#tssettings_maxloghrs_week").prop("checked","checked"),layout.find("#tssettings_weekendOT,#tssettings_holidayOT").prop("checked",!1),layout.find("#tssettings_weekendOT,#tssettings_holidayOT").prop("disabled",!0)):layout.find("#tssettings_maxloghrs_none").prop("checked","checked"),Timetracker.generalSettings.getMaxLogHours(layout.attr("id"),data.TS_maxLogHoursRestriction,data),data.TS_MinHrsEnabled&&("1"===data.TS_MinHrsEnabled?layout.find("#enable_min_hrs").prop("checked","checked"):layout.find("#disable_min_hrs").prop("checked","checked")),Timetracker.generalSettings.showHideMinMaxHrsInput(layout.attr("id"),data.TS_MinHrsEnabled,data,"min"),data.TS_MaxHrsEnabled&&("1"===data.TS_MaxHrsEnabled?layout.find("#enable_max_hrs").prop("checked","checked"):layout.find("#disable_max_hrs").prop("checked","checked")),Timetracker.generalSettings.showHideMinMaxHrsInput(layout.attr("id"),data.TS_MaxHrsEnabled,data,"max"),data.TS_timeEntriesOverlap?"0"===data.TS_timeEntriesOverlap?layout.find("#timeentry_overlap_allow").prop("checked","checked"):"1"===data.TS_timeEntriesOverlap?layout.find("#timeentry_overlap_warn").prop("checked","checked"):"2"===data.TS_timeEntriesOverlap&&layout.find("#timeentry_overlap_restrict").prop("checked","checked"):layout.find("#timeentry_overlap_allow").prop("checked","checked"),data.TS_billingtimesheetType?"0"===data.TS_billingtimesheetType?layout.find("#tssettings_timesheetBillingStatus_both").prop("checked","checked"):"1"===data.TS_billingtimesheetType?layout.find("#tssettings_timesheetBillingStatus_billable").prop("checked","checked"):"2"===data.TS_billingtimesheetType&&layout.find("#tssettings_timesheetBillingStatus_nonbillable").prop("checked","checked"):layout.find("#tssettings_timesheetBillingStatus_both").prop("checked","checked"),data.TS_timerEdit?layout.find("#tssettings_timeredit").val(data.TS_timerEdit):layout.find("#tssettings_timeredit").val("0"),layout.find("#weekend_input,#holiday_input").prop("checked",!1),data.TS_weekendOvertime&&"1"===data.TS_weekendOvertime&&layout.find("#weekend_input").prop("checked",!0),data.TS_holidayOvertime&&"1"===data.TS_holidayOvertime&&layout.find("#holiday_input").prop("checked",!0),layout.find("#tssettings_pastlog").prop("checked",!1),"1"===data.TS_pastLogRestriction&&layout.find("#tssettings_pastlog").prop("checked",!0),Timetracker.generalSettings.showHidePastDays(layout.attr("id"),"1"===data.TS_pastLogRestriction,data),layout.find("#tssettings_futurelog").prop("checked",!1),"1"===data.TS_futureLogRestriction&&layout.find("#tssettings_futurelog").prop("checked",!0),Timetracker.generalSettings.displayLeaveRestriction(data);var dateNameJson=Timetracker.util.getStartAndEnddateDisplayName(),sdatename=dateNameJson.sdatename,edatename=dateNameJson.edatename;if(layout.find("#span_presentdate").html(ZPI18N.getString("zp.tlrestrictjoboptions",[ZPI18N.getString("zp.thepresentdate"),Timetracker.util.getJobDisplayName(),sdatename,edatename])),layout.find("#span_tldate").html(ZPI18N.getString("zp.tlrestrictjoboptions",[ZPI18N.getString("zp.tldate"),Timetracker.util.getJobDisplayName(),sdatename,edatename])),data.TS_showTimelogLocation&&"1"!==data.TS_showTimelogLocation?layout.find("#tssettings_showtimeloglocation_no").prop("checked","checked"):layout.find("#tssettings_showtimeloglocation_yes").prop("checked","checked"),layout.find("#tssettings_paidleave_payroll").prop("checked",!1),"1"===data.TS_includePaidLeaveInPayroll&&layout.find("#tssettings_paidleave_payroll").prop("checked",!0),layout.find("#tssettings_presentdate").prop("checked",!1),"1"===data.TS_presentDateWithinJobPerid&&layout.find("#tssettings_presentdate").prop("checked",!0),layout.find("#tssettings_timelogdate").prop("checked",!1),"1"===data.TS_timelogDateWithinJobPerid&&layout.find("#tssettings_timelogdate").prop("checked",!0),layout.find("#tssettings_attendance_timer").prop("checked",!1),"1"===data.TS_attendance&&layout.find("#tssettings_attendance_timer").prop("checked",!0),layout.find("#tssettings_attendance_startend").prop("checked",!1),"1"===data.TS_attendance_startEnd&&layout.find("#tssettings_attendance_startend").prop("checked",!0),Timetracker.jobSchedule.isJobScheduleEnabled()){var jobSchedViewPerm=data.TS_jobScheduleView?data.TS_jobScheduleView:2,jobSchedEditPerm=data.TS_jobScheduleEdit?data.TS_jobScheduleEdit:2;layout.find("#tt_jobschd_view_settings").select2("val",jobSchedViewPerm).trigger("change"),layout.find("#tt_jobschd_edit_settings").select2("val",jobSchedEditPerm),layout.find("#tt_jobschd_exclude_weekend").prop("checked","1"===data.TS_excludeJobSchdOnWeekEnds),layout.find("#tt_jobschd_exclude_holiday").prop("checked","1"===data.TS_excludeJobSchdOnHolidays),layout.find("#tt_jobschd_exclude_leave").prop("checked","1"===data.TS_excludeJobSchdOnLeave),layout.find("#tt_jobschd_hide_weekend").prop("checked","1"===data.TS_hideWeekEndsInJobSchd),layout.find("#tt_jobschd_hide_holiday").prop("checked","1"===data.TS_hideHolidaysInJobSchd),layout.find("#tt_jobschd_hide_leave").prop("checked","1"===data.TS_hideLeaveInJobSchd);var mailnotify=data.TS_jobSchdPublishMailNotify&&"0"===data.TS_jobSchdPublishMailNotify?"0":"1";layout.find("input[name=tt_jobschd_mailnotify_settings][value="+mailnotify+"]").prop("checked",!0);var feednotify=data.TS_jobSchdPublishFeedNotify&&"0"===data.TS_jobSchdPublishFeedNotify?"0":"1";layout.find("input[name=tt_jobschd_feednotify_settings][value="+feednotify+"]").prop("checked",!0)}else layout.find(".ZP_JobSchd").remove();Timetracker.generalSettings.disablePushToAttendance(),layout.find("#tssettings_export").prop("checked",!1),"1"===data.TS_isPasswordProtected&&layout.find("#tssettings_export").prop("checked",!0),layout.find("#tssettings_att_timelog").prop("checked",!1),"1"===data.TS_attendanceHrsLogRestrict&&layout.find("#tssettings_att_timelog").prop("checked",!0),layout.find("#tssettings_zeroHours_timelog").prop("checked",!1),"1"===data.TS_zeroHoursRestriction&&layout.find("#tssettings_zeroHours_timelog").prop("checked",!0),Timetracker.generalSettings.disablePushToAttendance(),Timetracker.generalSettings.disableAttCheckinTimerRestrict(data),Timetracker.generalSettings.isTimerAttCheckInConfigured()?0!=layout.find("#tssettings_att_timer_checkin").length&&(layout.find("#tssettings_att_timer_checkin").prop("checked",!1),"1"===data.TS_attTimerEntryRestrection&&layout.find("#tssettings_att_timer_checkin").prop("checked",!0)):layout.find("#tssettings_att_timer_checkin").closest("div.form-group").remove();var helpUrl=Timetracker.generalSettings.constructHelpUrl("timesheet-settings.html#ts1job"),noteDiv='<div id="jobPrd_div" class="label-message label-note text-leftI P10I MT15 B0I" style="line-height:18px"><p class="S13"><span class="DB MB10"><b><u>'+ZPI18N.getString("zp.note")+":</u></b></span>"+ZPI18N.getString("zp.settingNoteJobPeriod",[sdatename,edatename,Timetracker.util.getJobDisplayName(),helpUrl])+"</p></div>";Timetracker.generalSettings.appendNoteParticularSetting("tlrestrictJobPrd_colsm",{noteDivId:"jobPrd_div"},noteDiv),Timetracker.generalSettings.populatetlCustSetting(layout,data),layout.find("#defWorkitem").html(ZPI18N.getString("zp.defaultworkitem",[Timetracker.util.workitemDispName]))},populatetlCustSetting:function(layout,data){layout.find("#clientname_show").prop("checked",!1),"1"===data.TLC_Clients&&layout.find("#clientname_show").prop("checked",!0),layout.find("#clientname_mand").prop("checked",!1),"1"===data.TLC_Clients_Mandatory&&layout.find("#clientname_mand").prop("checked",!0),layout.find("#projectname_show").prop("checked",!1),"1"===data.TLC_Projects&&layout.find("#projectname_show").prop("checked",!0),layout.find("#projectname_mand").prop("checked",!1),"1"===data.TLC_Projects_Mandatory&&layout.find("#projectname_mand").prop("checked",!0),layout.find("#workitemname_show").prop("checked",!1),"1"===data.TLC_Workitem&&layout.find("#workitemname_show").prop("checked",!0),layout.find("#workitemname_mand").prop("checked",!1),"1"===data.TLC_Workitem_Mandatory&&layout.find("#workitemname_mand").prop("checked",!0),layout.find("#descname_show").prop("checked",!1),"1"===data.TLC_Desc&&layout.find("#descname_show").prop("checked",!0),layout.find("#descname_mand").prop("checked",!1),"1"===data.TLC_Desc_Mandatory&&layout.find("#descname_mand").prop("checked",!0),layout.find("#billablename_show").prop("checked",!1),"1"===data.TLC_Billable_Show&&layout.find("#billablename_show").prop("checked",!0);var dispName=Timetracker.util.gettlFieldDispName(data,Timetracker.constants.WORKITEM);layout.find("#workitem_name").html(dispName),layout.find("#workitemNameInp").val(ZPeople.decodeTxt(dispName)),dispName=Timetracker.util.gettlFieldDispName(data,Timetracker.constants.DESC),layout.find("#desc_name").html(dispName),layout.find("#descNameInp").val(ZPeople.decodeTxt(dispName)),Layout.Page.container.find("#workitem_editdiv").hide(),Layout.Page.container.find("#desc_editdiv").hide(),Layout.Page.container.find("#workitem_maindiv").show(),Layout.Page.container.find("#desc_maindiv").show()},changeShowMandSetting:function(inpObj,showMandStr){var isFromShow="show"===showMandStr,isFromMand="mand"===showMandStr,isInpChecked=$(inpObj).is(":checked"),inpId=$(inpObj).attr("id"),tableLayout=Layout.Page.container.find("#tlsetting_customize");isInpChecked?(isFromShow&&-1!==inpId.indexOf("client")&&tableLayout.find("#projectname_show").prop("checked",!0),isFromMand&&(-1!==inpId.indexOf("client")&&(tableLayout.find("#clientname_show").prop("checked",!0),tableLayout.find("#projectname_show").prop("checked",!0),tableLayout.find("#projectname_mand").prop("checked",!0)),-1!==inpId.indexOf("project")&&tableLayout.find("#projectname_show").prop("checked",!0),-1!==inpId.indexOf("workitem")&&tableLayout.find("#workitemname_show").prop("checked",!0),-1!==inpId.indexOf("desc")&&tableLayout.find("#descname_show").prop("checked",!0))):(isFromShow&&(-1!==inpId.indexOf("project")&&(tableLayout.find("#projectname_mand").prop("checked",!1),tableLayout.find("#clientname_show").prop("checked",!1),tableLayout.find("#clientname_mand").prop("checked",!1)),-1!==inpId.indexOf("client")&&tableLayout.find("#clientname_mand").prop("checked",!1),-1!==inpId.indexOf("workitem")&&tableLayout.find("#workitemname_mand").prop("checked",!1),-1!==inpId.indexOf("desc")&&tableLayout.find("#descname_mand").prop("checked",!1)),isFromMand&&-1!==inpId.indexOf("project")&&tableLayout.find("#clientname_mand").prop("checked",!1))},showHideInputDiv:function(editObj,isShowInput,tlField){var inputDomId="",mainDomId="",dispName="";"workitem"===tlField?(inputDomId="workitem_editdiv",mainDomId="workitem_maindiv",dispInpDiv="workitemNameInp",dispName=ZPeople.decodeTxt(Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.WORKITEM))):"description"===tlField&&(inputDomId="desc_editdiv",mainDomId="desc_maindiv",dispInpDiv="descNameInp",dispName=ZPeople.decodeTxt(Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.DESC))),isShowInput?(Layout.Page.container.find("#"+inputDomId).find("#error_message").remove(),Layout.Page.container.find("#"+inputDomId).show(),Layout.Page.container.find("#"+mainDomId).hide()):(Layout.Page.container.find("#"+inputDomId).hide(),Layout.Page.container.find("#"+mainDomId).show()),Layout.Page.container.find("#"+dispInpDiv).val(dispName)},appendNoteParticularSetting:function(settingColId,otherCssDtls,helpHtml){var noteDivId=otherCssDtls.hasOwnProperty("noteDivId")?otherCssDtls.noteDivId:null,layout=Layout.Page.container,colDom=layout.find("#"+settingColId),noteDiv=layout.find("#"+noteDivId);void 0!==colDom&&0!==colDom.length&&void 0!==noteDiv&&0===$(noteDiv).length&&colDom.append(helpHtml)},constructHelpUrl:function(settingUrl){return(ZPeople.isChinaSetup?"https://www.zoho.com.cn/people/help/adminguide":"https://www.zoho.com/people/help/adminguide")+"/"+settingUrl},displayGeneralSettings:function(data){null!==data&&data.hasOwnProperty("refreshWorkItem")&&(delete data.refreshWorkItem,Timetracker.generalSettings.constructWorkitems(!0,{showCommonWorkitems:!0})),Timetracker.generalSettings.settingDetails=data,Timetracker.generalSettings.updateTimelogCustFieldsCache(data),Timetracker.generalSettings.deletedWorkitems="",Layout.Page.container.find("#tssettings_timesheetperiod").off("change").on("change",function(){Timetracker.generalSettings.showHideRestrictTSSubmissionPeriod.onTimesheetPeriodChange(this,Timetracker.generalSettings.settingDetails)}),Layout.Page.container.find("div.error-msg").remove(),Timetracker.generalSettings.setGeneralSettings(Layout.Page.container,data),Layout.Page.container.find("input[name=maxloghrstype]").off("click").on("click",function(){Timetracker.generalSettings.getMaxLogHours("generalSettingsDiv",$(this).val(),Timetracker.generalSettings.settingDetails)}),Layout.Page.container.find("input[name=restrictmin]").off("click").on("click",function(){Timetracker.generalSettings.showHideMinMaxHrsInput("generalSettingsDiv",$(this).val(),Timetracker.generalSettings.settingDetails,"min")}),Layout.Page.container.find("input[name=restrictmax]").off("click").on("click",function(){Timetracker.generalSettings.showHideMinMaxHrsInput("generalSettingsDiv",$(this).val(),Timetracker.generalSettings.settingDetails,"max")}),Layout.Page.container.find("#tssettings_pastlog").off("click").on("click",function(){Timetracker.generalSettings.showHidePastDays("generalSettingsDiv",$(this).is(":checked"),Timetracker.generalSettings.settingDetails)}),Layout.Page.container.find("#generalSettingsDiv").find("select").select2({minimumResultsForSearch:1/0}),Layout.Page.container.find("#generalSettingsDiv").fadeIn(200)},getParamsForUpdateSettings:function(params,data,isUser){var defaultview=Layout.Page.container.find("#tssettings_defaultview").val();params.defaultview=defaultview;var timeredit=Layout.Page.container.find("#tssettings_timeredit").val();params.timeredit=timeredit;var defaultbilling=Layout.Page.container.find("#tssettings_billingstatus").val();params.defaultbillingType=defaultbilling;var timesheetOwners=Layout.Page.container.find("#tssettings_timesheetcreation").val();params.timesheetOwners=timesheetOwners,params.timesheetPeriod=Layout.Page.container.find("#tssettings_timesheetperiod").val(),Layout.Page.container.find("div.error-msg").remove();var periodjson={};if(params.timesheetPeriod===Timetracker.constants.TS_PERIOD.WEEK||params.timesheetPeriod===Timetracker.constants.TS_PERIOD.MONTH){var ts_submission_period_div=Layout.Page.container.find("#tssettings_tssubmissiondiv");if(ts_submission_period_div.find("#tssettings_restricttimesheetsubmission").is(":checked")){var ts_span=ts_submission_period_div.find("#tssettings_tsspan"),from_day=ts_span.find("#from_day").val();if("-1"!==from_day){var from_range=ts_span.find("#from_range").val();periodjson.from_day=Number(from_day),periodjson.from_range=from_range}var to_day=ts_span.find("#to_day").val();if("-1"!==to_day){var to_range=ts_span.find("#to_range").val();if(periodjson.from_day&&periodjson.from_range&&(parseInt(periodjson.from_range)>parseInt(to_range)||parseInt(periodjson.from_day)>parseInt(to_day)&&parseInt(periodjson.from_range)===parseInt(to_range)))return ts_submission_period_div.find("[label='timesheetSubmissionPeriod']").append('<div class="error-msg">'+ZPI18N.getString("zp.tsfromperiodgreaterthanto")+"</div>"),{isError:!0};periodjson.to_day=Number(to_day),periodjson.to_range=to_range}if(0===Object.keys(periodjson).length)return ts_submission_period_div.find("[label='timesheetSubmissionPeriod']").append('<div class="error-msg">'+ZPI18N.getString("zp.tsinvalidperiod")+"</div>"),{isError:!0}}}var maxAllowedBillableHrsPerDay,maxAllowedBillableHrsPerWeek,settingsChanged=!1;if(params.timesheetSubmissionPeriod=JSON.stringify(periodjson),params.restrictTimesheetOverlap=Layout.Page.container.find("#tssettings_timesheetoverlap").is(":checked")?"1":"0",params.manualLog=Layout.Page.container.find("#tssettings_timestamp_manual").is(":checked")?"true":"false",params.fromToTimeLog=Layout.Page.container.find("#tssettings_timestamp_fromtolog").is(":checked")?"true":"false",params.automaticLog=Layout.Page.container.find("#tssettings_timestamp_automatic").is(":checked")?"true":"false",!(params.manualLog||params.fromToTimeLog||params.automaticLog))return Layout.Page.container.find("#tssettings_logtype").append('<div class="error-msg MB10">'+ZPI18N.getString("zp.selectoption")+"</div>"),{isError:!0};if(Layout.Page.container.find("#tssettings_timesheetClients_internal").is(":checked")?params.clienttimesheetType="2":params.clienttimesheetType="0",selected=Layout.Page.container.find("input[type='radio'][name='estimatedHoursRestriction']:checked"),selected.length>0&&(params.estimatedHoursRestriction=selected.val()),selected=Layout.Page.container.find("input[type='radio'][name='showTimelogLocation']:checked"),selected.length>0&&(params.showTimelogLocation=selected.val()),Layout.Page.container.find("#tssettings_isAdmin").is(":checked"),params.showRPHForAdmin="1",Layout.Page.container.find("#tssettings_isApprover").is(":checked")?params.showRPHForApprover="1":params.showRPHForApprover="0",Layout.Page.container.find("#tssettings_isReportingto").is(":checked")?params.showRPHForReportingManager="1":params.showRPHForReportingManager="0",Layout.Page.container.find("#tssetting_isEmployee").is(":checked")?params.showRPHForEmployee="1":params.showRPHForEmployee="0",Layout.Page.container.find("#tssettings_isApproverLogsEdit").is(":checked")?params.isApproverEditLogtime="1":params.isApproverEditLogtime="0","1"===Layout.Page.container.find("input[name='24HoursLogRestriction']:checked").val()?(params.restrict24HrsLog="1",maxAllowedBillableHrsPerDay=Timetracker.constants.PER_DAY_MIN,maxAllowedBillableHrsPerWeek=Timetracker.constants.PER_WEEK_MIN):(params.restrict24HrsLog="0",maxAllowedBillableHrsPerDay=Timetracker.constants.MAX_LOGHRS_PERDAY,maxAllowedBillableHrsPerWeek=Timetracker.constants.MAX_LOGHRS_PERWEEK),selected=Layout.Page.container.find("input[type='radio'][name='maxloghrstype']:checked"),selected.length>0){params.maxLogHoursRestriction=selected.val();var value=Layout.Page.container.find("#max_hrs_val").val();if(params.hoursperday=params.hoursperweek=0,"1"===params.maxLogHoursRestriction||"2"===params.maxLogHoursRestriction){var isError=!1,regexForValidation="2"===params.maxLogHoursRestriction?Timetracker.util.maxWeekHrsRegex:Timetracker.util.maxhrsRegex;if(!value.match(regexForValidation))return isError=!0,Layout.Page.container.find("#max_hrs_val").addClass("error-clr"),{isError:!0};var s_payvalue=0,d_payvalue=0;if(params.allowOT="0",Layout.Page.container.find("#tssettings_otval").is(":checked")){if(params.allowOT="1",s_payvalue=Layout.Page.container.find("#tsot_singlepay_val").val(),d_payvalue=Layout.Page.container.find("#tsot_doublepay_val").val(),!s_payvalue.match(regexForValidation))return isError=!0,Layout.Page.container.find("#tsot_singlepay_val").addClass("error-clr"),{isError:!0};if(params.singlepayhours=s_payvalue,!d_payvalue.match(regexForValidation))return isError=!0,Layout.Page.container.find("#tsot_doublepay_val").addClass("error-clr"),{isError:!0};params.doublepayhours=d_payvalue}var logHrs=Timetracker.DateTime.convertToMins(value)+Timetracker.DateTime.convertToMins(s_payvalue)+Timetracker.DateTime.convertToMins(d_payvalue);if("1"===params.maxLogHoursRestriction?(isError=logHrs>maxAllowedBillableHrsPerDay,params.hoursperday=value):"2"===params.maxLogHoursRestriction&&(isError=logHrs>maxAllowedBillableHrsPerWeek,params.hoursperweek=value),isError)return Layout.Page.container.find("#max_hrs_val,#tsot_singlepay_val,#tsot_doublepay_val").addClass("error-clr"),Layout.Page.container.find("#max_hrs_val").after('<div class="error-msg MB10">'+ZPI18N.getString("zp.maxhrserror",[Timetracker.Hours.convertMinsToHrs(maxAllowedBillableHrsPerDay,0),Timetracker.Hours.convertMinsToHrs(maxAllowedBillableHrsPerWeek,0)])+"</div>"),{isError:!0};value=void 0===value?0:value}if("0"!==params.maxLogHoursRestriction&&data.TS_maxLogHoursRestriction===params.maxLogHoursRestriction){logHrs=""+Timetracker.DateTime.convertToMins(value);("1"===params.maxLogHoursRestriction&&logHrs!==data.TS_hoursperday||"2"===params.maxLogHoursRestriction&&logHrs!==data.TS_hoursperweek)&&(settingsChanged=!0)}settingsChanged||(settingsChanged=params.allowOT===data.TS_allowOT&&(void 0!==s_payvalue&&data.TS_singlePayHours!==""+Timetracker.DateTime.convertToMins(s_payvalue)||void 0!==d_payvalue&&data.TS_doublePayHours!==""+Timetracker.DateTime.convertToMins(d_payvalue)))}if(selected=Layout.Page.container.find("input[type='radio'][name='restrictmin']:checked").val(),"1"===selected){var is_minSel_day=Layout.Page.container.find("input[id='minhrsperday_chkbox']").is(":checked"),is_minSel_week=Layout.Page.container.find("input[id='minhrsperweek_chkbox']").is(":checked");if(!is_minSel_day&&!is_minSel_week)return{isError:!0,errMsg:"minhrs_day_week_mand"};if(is_minSel_day){if(!(hrs=Layout.Page.container.find("#min_hrs_value_box").find("#min_per_day").val()).match(Timetracker.util.maxhrsRegex))return Layout.Page.container.find("#min_per_day").addClass("error-clr"),{isError:!0};params.minHrsPerDay=hrs,params.minHrsType="0"}if(is_minSel_week){if(!(hrs=Layout.Page.container.find("#min_hrs_value_box").find("#min_per_week").val()).match(Timetracker.util.maxWeekHrsRegex))return Layout.Page.container.find("#min_per_week").addClass("error-clr"),{isError:!0};params.minHrsPerWeek=hrs,params.minHrsType="1"}is_minSel_day&&is_minSel_week&&(params.minHrsType="2"),params.minHrsEnabled="1"}else params.minHrsEnabled="0";if(selected=Layout.Page.container.find("input[type='radio'][name='restrictmax']:checked").val(),"1"===selected){var is_maxSel_day=Layout.Page.container.find("input[id='maxhrsperday_chkbox']").is(":checked"),is_maxSel_week=Layout.Page.container.find("input[id='maxhrsperweek_chkbox']").is(":checked");if(!is_maxSel_day&&!is_maxSel_week)return{isError:!0,errMsg:"maxhrs_day_week_mand"};if(is_maxSel_day){if(!(hrs=Layout.Page.container.find("#max_hrs_value_box").find("#max_per_day").val()).match(Timetracker.util.maxhrsRegex))return Layout.Page.container.find("#max_per_day").addClass("error-clr"),{isError:!0};params.maxHrsPerDay=hrs,params.maxHrsType="0"}if(is_maxSel_week){var hrs;if(!(hrs=Layout.Page.container.find("#max_hrs_value_box").find("#max_per_week").val()).match(Timetracker.util.maxWeekHrsRegex))return Layout.Page.container.find("#max_per_week").addClass("error-clr"),{isError:!0};params.maxHrsPerWeek=hrs,params.maxHrsType="1"}is_maxSel_day&&is_maxSel_week&&(params.maxHrsType="2"),params.maxHrsEnabled="1"}else params.maxHrsEnabled="0";if(Layout.Page.container.find("#timeentry_overlap_allow").is(":checked")?params.timeentryOverlap="0":Layout.Page.container.find("#timeentry_overlap_warn").is(":checked")?params.timeentryOverlap="1":Layout.Page.container.find("#timeentry_overlap_restrict").is(":checked")&&(params.timeentryOverlap="2"),params.attendanceTimelog="0",!0===Layout.Page.container.find("#tssettings_att_timelog").is(":checked")&&(params.attendanceTimelog="1"),Timetracker.generalSettings.isTimerAttCheckInConfigured()&&0!=Layout.Page.container.find("#tssettings_att_timer_checkin").length&&(params.attTimerRestriction="0",!0===Layout.Page.container.find("#tssettings_att_timer_checkin").is(":checked")&&(params.attTimerRestriction="1")),params.zeroHoursTimelog="0",!0===Layout.Page.container.find("#tssettings_zeroHours_timelog").is(":checked")&&(params.zeroHoursTimelog="1"),params.weekendOvertime="0",!0===Layout.Page.container.find("#weekend_input").is(":checked")&&(params.weekendOvertime="1"),params.holidayOvertime="0",!0===Layout.Page.container.find("#holiday_input").is(":checked")&&(params.holidayOvertime="1"),selected=Layout.Page.container.find("input[type='radio'][name='billingtimesheetType']:checked"),selected.length>0&&(params.billingtimesheetType=selected.val()),params.pastLog="0",!0===Layout.Page.container.find("#tssettings_pastlog").is(":checked")){params.pastLog="1",params.pastLogAllowDays="0";var pastLogDiv=Layout.Page.container.find("#tssettings_pastlogdaysdiv");if(selected=pastLogDiv.find("input[type='radio'][name='pastlogdays']:checked").val(),"1"===selected){var allowDays=pastLogDiv.find("#tssettings_pastlog_pastdaysvalue").val().trim();if(ZPUtil.Validation.isEmpty(allowDays)||!ZPUtil.Validation.isNumber(allowDays)||allowDays<=0||allowDays>365)return pastLogDiv.find("#tssettings_pastlog_pastdaysvalue").addClass("error-clr"),Timetracker.util.appendErrorMsg({obj:pastLogDiv,msg:ZPI18N.getString("zp.entervalinrange",[1,365]),classes:"ML25"}),{isError:!0};params.pastLogAllowDays=allowDays}data.TS_pastLogAllowDays!=params.pastLogAllowDays&&(settingsChanged=!0)}if(params.futureLog="0",!0===Layout.Page.container.find("#tssettings_futurelog").is(":checked")&&(params.futureLog="1"),params.tlrestrictPresentDate="0",!0===Layout.Page.container.find("#tssettings_presentdate").is(":checked")&&(params.tlrestrictPresentDate="1"),params.tlrestrictTimelogDate="0",!0===Layout.Page.container.find("#tssettings_timelogdate").is(":checked")&&(params.tlrestrictTimelogDate="1"),params.includePaidLeaveInPayroll="0",!0===Layout.Page.container.find("#tssettings_paidleave_payroll").is(":checked")&&(params.includePaidLeaveInPayroll="1"),params.attendanceInteg="0",!0===Layout.Page.container.find("#tssettings_attendance_timer").is(":checked")&&(params.attendanceInteg="1"),params.attendanceIntegStartEnd="0",params.fromToTimeLog&&"2"==params.timeentryOverlap&&Layout.Page.container.find("#tssettings_attendance_startend").is(":checked")&&(params.attendanceIntegStartEnd="1"),Timetracker.generalSettings.getSelectedLeaveRestrction(params),Timetracker.jobSchedule.isJobScheduleEnabled()){if(!Timetracker.generalSettings.getJobSchedulePermission(params))return{isError:!0};params.excludeJobSchdOnWeekEnds="0",Layout.Page.container.find("#tt_jobschd_exclude_weekend").is(":checked")&&(params.excludeJobSchdOnWeekEnds="1"),params.excludeJobSchdOnHolidays="0",Layout.Page.container.find("#tt_jobschd_exclude_holiday").is(":checked")&&(params.excludeJobSchdOnHolidays="1"),params.excludeJobSchdOnLeave="0",Layout.Page.container.find("#tt_jobschd_exclude_leave").is(":checked")&&(params.excludeJobSchdOnLeave="1"),params.hideWeekEndsInJobSchd="0",Layout.Page.container.find("#tt_jobschd_hide_weekend").is(":checked")&&(params.hideWeekEndsInJobSchd="1"),params.hideHolidaysInJobSchd="0",Layout.Page.container.find("#tt_jobschd_hide_holiday").is(":checked")&&(params.hideHolidaysInJobSchd="1"),params.hideLeaveInJobSchd="0",Layout.Page.container.find("#tt_jobschd_hide_leave").is(":checked")&&(params.hideLeaveInJobSchd="1"),selected=Layout.Page.container.find("input[type='radio'][name='tt_jobschd_mailnotify_settings']:checked"),selected.length>0&&(params.jobSchdPubMailNotification=selected.val()),selected=Layout.Page.container.find("input[type='radio'][name='tt_jobschd_feednotify_settings']:checked"),selected.length>0&&(params.jobSchdPubFeedNotification=selected.val()),settingsChanged||(settingsChanged=void 0!==params.jobScheduleView&&data.TS_jobScheduleView!==params.jobScheduleView||void 0!==params.jobScheduleEdit&&data.TS_jobScheduleEdit!==params.jobScheduleEdit||void 0!==params.excludeJobSchdOnWeekEnds&&data.TS_excludeJobSchdOnWeekEnds!==params.excludeJobSchdOnWeekEnds||void 0!==params.excludeJobSchdOnHolidays&&data.TS_excludeJobSchdOnHolidays!==params.excludeJobSchdOnHolidays||void 0!==params.excludeJobSchdOnLeave&&data.TS_excludeJobSchdOnLeave!==params.excludeJobSchdOnLeave||void 0!==params.hideWeekEndsInJobSchd&&data.TS_hideWeekEndsInJobSchd!==params.hideWeekEndsInJobSchd||void 0!==params.hideHolidaysInJobSchd&&data.TS_hideHolidaysInJobSchd!==params.hideHolidaysInJobSchd||void 0!==params.hideLeaveInJobSchd&&data.TS_hideLeaveInJobSchd!==params.hideLeaveInJobSchd||void 0!==params.jobSchdPubMailNotification&&data.TS_jobSchdPublishMailNotify!==params.jobSchdPubMailNotification||void 0!==params.jobSchdPubFeedNotification&&data.TS_jobSchdPublishFeedNotify!==params.jobSchdPubFeedNotification)}if(params.isPasswordProtected="0",!0===Layout.Page.container.find("#tssettings_export").is(":checked")&&(params.isPasswordProtected="1"),void 0!==isUser&&isUser||Timetracker.generalSettings.gettlcustSettingParams(params),params.hasOwnProperty("hasFieldError"))return{isError:!0};if(!settingsChanged&&(data.TS_DefaultView!==defaultview||data.TS_timerEdit!==timeredit||data.TS_defaultbillingType!==defaultbilling||void 0!==timesheetOwners&&data.TS_timesheetOwners!==timesheetOwners||data.TS_timesheetPeriod!==params.timesheetPeriod||data.TS_timesheetSubmissionPeriod!==params.timesheetSubmissionPeriod||data.TS_restrictTimesheetOverlap!==params.restrictTimesheetOverlap||data.TS_manualLog!==String(params.manualLog)||data.TS_fromToTimeLog!==String(params.fromToTimeLog)||data.TS_automaticLog!==String(params.automaticLog)||data.TS_estimatedHoursRestriction!==params.estimatedHoursRestriction||data.TS_maxLogHoursRestriction!==params.maxLogHoursRestriction||"1"===data.TS_maxLogHoursRestriction&&(data.TS_weekendOvertime!==params.weekendOvertime||data.TS_holidayOvertime!==params.holidayOvertime)||void 0!==params.allowOT&&data.TS_allowOT!==params.allowOT||void 0!==params.clienttimesheetType&&data.TS_clienttimesheetType!==params.clienttimesheetType||void 0!==params.billingtimesheetType&&data.TS_billingtimesheetType!==params.billingtimesheetType||void 0!==params.timeentryOverlap&&data.TS_timeEntriesOverlap!==params.timeentryOverlap||void 0!==params.includePaidLeaveInPayroll&&data.TS_includePaidLeaveInPayroll!==params.includePaidLeaveInPayroll||void 0!==params.attendanceInteg&&data.TS_attendance!==params.attendanceInteg||void 0!==params.attendanceIntegStartEnd&&data.TS_attendance_startEnd!==params.attendanceIntegStartEnd||data.TS_futureLogRestriction!==params.futureLog||data.TS_pastLogRestriction!==params.pastLog||data.TS_weekendLogRestriction!==params.isWeekendLogRestricted||data.TS_holidayLogRestriction!==params.isHolidayLogRestricted||data.TS_paidLeaveTLRestriction!==params.isPaidLogRestricted||data.TS_unpaidLeaveTLRestriction!==params.isUnpaidLogRestricted||data.TS_showTimelogLocation!==params.showTimelogLocation||data.TS_isPasswordProtected!==params.isPasswordProtected||data.attendanceTimelog!==params.attendanceTimelog||data.attTimerRestriction!==params.attTimerRestriction||data.zeroHoursTimelog!==params.zeroHoursTimelog||data.TS_presentDateWithinJobPerid!==params.tlrestrictPresentDate||data.TS_timelogDateWithinJobPerid!==params.tlrestrictTimelogDate)&&(settingsChanged=!0),data.TS_showRPHForAdmin===params.showRPHForAdmin&&data.TS_showRPHForApprover===params.showRPHForApprover&&data.TS_showRPHForEmployee===params.showRPHForEmployee&&data.TS_showRPHForReportingManager===params.showRPHForReportingManager&&data.TS_isApproverEditLogtime===params.isApproverEditLogtime||(settingsChanged=!0),void 0===isUser||!1===isUser){var updateValidate=Timetracker.generalSettings.updateWorkitemParams(params);if(void 0!==updateValidate&&(!updateValidate||updateValidate.hasOwnProperty("errMsg")))return settingsChanged=!1,updateValidate;settingsChanged||Timetracker.generalSettings.checkIfWorkitemChanged(settingsChanged,params)}return settingsChanged?params:null},gettlcustSettingParams:function(params){var tlCustJson={tlc_clients:"0"};!0===Layout.Page.container.find("#clientname_show").is(":checked")&&(tlCustJson.tlc_clients="1"),tlCustJson.tlc_projects="0",!0===Layout.Page.container.find("#projectname_show").is(":checked")&&(tlCustJson.tlc_projects="1"),tlCustJson.tlc_workitems="0",!0===Layout.Page.container.find("#workitemname_show").is(":checked")&&(tlCustJson.tlc_workitems="1"),tlCustJson.tlc_desc="0",!0===Layout.Page.container.find("#descname_show").is(":checked")&&(tlCustJson.tlc_desc="1"),tlCustJson.tlc_billableSt="0",!0===Layout.Page.container.find("#billablename_show").is(":checked")&&(tlCustJson.tlc_billableSt="1"),tlCustJson.tlc_client_mand="0",!0===Layout.Page.container.find("#clientname_mand").is(":checked")&&(tlCustJson.tlc_client_mand="1"),tlCustJson.tlc_project_mand="0",!0===Layout.Page.container.find("#projectname_mand").is(":checked")&&(tlCustJson.tlc_project_mand="1"),tlCustJson.tlc_workitem_mand="0",!0===Layout.Page.container.find("#workitemname_mand").is(":checked")&&(tlCustJson.tlc_workitem_mand="1"),tlCustJson.tlc_desc_mand="0",!0===Layout.Page.container.find("#descname_mand").is(":checked")&&(tlCustJson.tlc_desc_mand="1");var workitemInpDom=Layout.Page.container.find("#workitemNameInp"),workitemInp=workitemInpDom.val(),fldDispName=ZPeople.decodeTxt(Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.WORKITEM)),tlSettDtls={tlFieldType:"text",errorClass:"zp-err-msg",tlValue:workitemInp,fldDispName:fldDispName,skipMandCheck:!0,fldLength:250,allowEmptyCheck:!0},res=Timetracker.timelogs.createErrorTextInputFields(tlSettDtls,!1);"valid"!==res?(workitemInpDom.find("#error_message").remove(),$(res).insertBefore(workitemInpDom),workitemInpDom.parent().addClass("zp-err"),params.hasFieldError=!0):tlCustJson.tlc_workitem_name=workitemInp;var descInpDom=Layout.Page.container.find("#descNameInp"),descInp=descInpDom.val();tlSettDtls={tlFieldType:"text",tlValue:descInp,errorClass:"zp-err-msg",fldDispName:fldDispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.DESC),skipMandCheck:!0,fldLength:250,allowEmptyCheck:!0},"valid"!==(res=Timetracker.timelogs.createErrorTextInputFields(tlSettDtls,!1))?(descInpDom.find("#error_message").remove(),$(res).insertBefore(descInpDom),descInpDom.parent().addClass("zp-err"),params.hasFieldError=!0):tlCustJson.tlc_desc_name=descInp,params.hasOwnProperty("hasFieldError")||(params.tlCustParams=JSON.stringify(tlCustJson))},updateGeneralSettings:function(){Timetracker.util.removeErrorMsg("generalSettingsDiv");var params={mode:"updateTimesheetSettings",conreqcsr:csrfToken};if(null!==(params=Timetracker.generalSettings.getParamsForUpdateSettings(params,Timetracker.generalSettings.settingDetails))){var hasError=!1;if(params.isError&&(Layout.Page.container.find("#zp_tt_submit").removeClass("disabled"),hasError=!0),params.hasOwnProperty("errMsg")&&("duplicate"===params.errMsg?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.duplicateWorkitem",[Timetracker.util.workitemDispName])):"exceedlength"===params.errMsg?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.namecharlimit",[Timetracker.util.workitemDispName,"500"])):"workitemCountExceed"===params.errMsg?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.workitemcountexceed",[Timetracker.util.workitemDispName])):"minhrs_day_week_mand"===params.errMsg?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.minperdayweekmand")):"maxhrs_day_week_mand"===params.errMsg&&ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.maxperdayweekmand")),hasError=!0),hasError||0!==Layout.Page.container.find("#error_message_tscri").length&&(hasError=!0),hasError)return;$.post(Timetracker.constants.URL,params,function(resultData){Layout.Page.container.find(".error-msg").remove(),0!==resultData.res?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.settingupdatesuccess")),Timetracker.generalSettings.displayGeneralSettings(resultData)):resultData.message&&resultData.label?Layout.Page.container.find("[label='"+resultData.label+"']").append('<div class="error-msg">'+resultData.message+"</div>"):ZPeople.Message.showFailureMsg(resultData.message?resultData.message:ZPI18N.getString("zp.ttfailuremsg"))})}else ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.nochangesmade"))},validateCriHrs:function(eventObj){var hrsTime=$(eventObj).val(),hrsTime_mins=Timetracker.DateTime.convertToMins(hrsTime),inpId=$(eventObj).attr("id"),parentEventObj=$(eventObj).parent(),errTxt="";$(parentEventObj).removeClass("zp-err"),$(parentEventObj).find("#error_message_tscri").remove();var smallcasemin=ZPI18N.getString("zp.smallcasemin"),smallcasemax=ZPI18N.getString("zp.smallcasemax"),smallcaseperday=ZPI18N.getString("zp.smallcaseperday"),smallcaseperweek=ZPI18N.getString("zp.smallcaseperweek"),smallgreater=ZPI18N.getString("zp.smallgreater"),smalllesser=ZPI18N.getString("zp.smalllesser"),maxstr=ZPI18N.getString("zp.maximum"),minstr=ZPI18N.getString("zp.minimum"),errMsg="",hasError=!1;if(-1!==inpId.indexOf("min")){var selected=Layout.Page.container.find("input[type='radio'][name='restrictmax']:checked").val();if("1"===selected){if(-1!==inpId.indexOf("day")){if(Layout.Page.container.find("input[id='maxhrsperday_chkbox']").is(":checked")){var hrsMax=Layout.Page.container.find("#max_hrs_value_box").find("#max_per_day").val();hrsTime_mins>Timetracker.DateTime.convertToMins(hrsMax)&&(errMsg=ZPI18N.getString("zp.hrscrisubmiterrTS",[minstr,smallcaseperday,smallgreater,smallcasemax,smallcaseperday]),hasError=!0)}}else if(-1!==inpId.indexOf("week")){if(Layout.Page.container.find("input[id='maxhrsperweek_chkbox']").is(":checked")){hrsMax=Layout.Page.container.find("#max_hrs_value_box").find("#max_per_week").val();hrsTime_mins>Timetracker.DateTime.convertToMins(hrsMax)&&(errMsg=ZPI18N.getString("zp.hrscrisubmiterrTS",[minstr,smallcaseperweek,smallgreater,smallcasemax,smallcaseperweek]),hasError=!0)}}hasError&&(errTxt='<div id="error_message_tscri" class="zp-err-msg">'+errMsg+"</div>",$(parentEventObj).append(errTxt),$(parentEventObj).addClass("zp-err tscrierr"))}}else if(-1!==inpId.indexOf("max")&&"1"===(selected=Layout.Page.container.find("input[type='radio'][name='restrictmin']:checked").val())){if(-1!==inpId.indexOf("day")){if(Layout.Page.container.find("input[id='minhrsperday_chkbox']").is(":checked")){var hrsMin=Layout.Page.container.find("#min_hrs_value_box").find("#min_per_day").val();hrsTime_mins<Timetracker.DateTime.convertToMins(hrsMin)&&(errMsg=ZPI18N.getString("zp.hrscrisubmiterrTS",[maxstr,smallcaseperday,smalllesser,smallcasemin,smallcaseperday]),hasError=!0)}}else if(-1!==inpId.indexOf("week")){if(Layout.Page.container.find("input[id='minhrsperweek_chkbox']").is(":checked")){hrsMin=Layout.Page.container.find("#min_hrs_value_box").find("#min_per_week").val();hrsTime_mins<Timetracker.DateTime.convertToMins(hrsMin)&&(errMsg=ZPI18N.getString("zp.hrscrisubmiterrTS",[maxstr,smallcaseperweek,smalllesser,smallcasemin,smallcaseperweek]),hasError=!0)}}hasError&&(errTxt='<div id="error_message_tscri" class="zp-err-msg">'+errMsg+"</div>",$(parentEventObj).append(errTxt),$(parentEventObj).addClass("zp-err tscrierr"))}},getTSSettings:function(user,settingId,data){return data&&null!==data?data:user&&null!==user?(Timetracker.userTSSettings.getUserTSSettings(user),Timetracker.userTSSettings.userSettingDetails[user]):settingId&&null!==settingId?Timetracker.userTSSettings.getSettingDetails(settingId):Timetracker.generalSettings.settingDetails&&null!==Timetracker.generalSettings.settingDetails?Timetracker.generalSettings.settingDetails:(Timetracker.generalSettings.getSyncTimesheetSettings(),Timetracker.generalSettings.settingDetails?Timetracker.generalSettings.settingDetails:{})},getDefaultViewType:function(user,settingId,data){return Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_DefaultView},getDefaultBillableStatus:function(user,settingId,data){return Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_defaultbillingType},isManualLogAllowed:function(user,settingId,data){return"true"===Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_manualLog},isFromToTimeLogAllowed:function(user,settingId,data){return"true"===Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_fromToTimeLog},isAutomaticLogAllowed:function(user,settingId,data){return"true"===Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_automaticLog},isOnlyFromToTimeLogAllowed:function(user,settingId,data){return Timetracker.generalSettings.isFromToTimeLogAllowed(user,settingId,data)&&!Timetracker.generalSettings.isManualLogAllowed(user,settingId,data)&&!Timetracker.generalSettings.isAutomaticLogAllowed(user,settingId,data)},isTTLocationAllowed:function(user,settingId,data){return 1==Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_showTimelogLocation},getTSClientSetting:function(user,settingId,data){return Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_clienttimesheetType},getTSsettingsRPHAdmin:function(user,settingId,data){return Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_showRPHForAdmin},getTSsettingsRPHApprover:function(user,settingId,data){return Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_showRPHForApprover},getTSsettingsRPHRManager:function(user,settingId,data){return Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_showRPHForReportingManager},getTSsettingsRPHEmployee:function(user,settingId,data){return Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_showRPHForEmployee},getTSsettingsApproverEditLogtime:function(user,settingId,data){return Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_isApproverEditLogtime},getTSBillableSetting:function(user,settingId,data){return Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_billingtimesheetType},getTSPermission:function(user,settingId,data){return Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_timesheetOwners},getTSPeriod:function(user,settingId,data){return Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_timesheetPeriod||Timetracker.constants.TS_PERIOD.ANY_DATE_RANGE},getTSSubmissionPeriod:function(user,settingId,data){return Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_timesheetSubmissionPeriod||{}},isRestrictTimesheetOverlap:function(user,settingId,data){return"1"===Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_restrictTimesheetOverlap},getMaxLogHoursRestrictType:function(user,settingId,data){return Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_maxLogHoursRestriction},getMaxHoursPerDay:function(user,settingId,data){return Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_hoursperday},getMaxHoursPerWeek:function(user,settingId,data){return Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_hoursperweek},getSinglePayOTHours:function(user,settingId,data){return Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_singlePayHours},getDoublePayOTHours:function(user,settingId,data){return Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_doublePayHours},isOTAllowed:function(user,settingId,data){return"1"===Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_allowOT},isWeekendOTEnabled:function(user,settingId,data){return"1"===Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_weekendOvertime},isHolidayOTEnabled:function(user,settingId,data){return"1"===Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_holidayOvertime},isTimelogZeroHoursRestrict:function(user,settingId,data){return"1"===Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_zeroHoursRestriction},getJobSchdViewPerm:function(){return Timetracker.generalSettings.getTSSettings().TS_jobScheduleView},getJobSchdEditPerm:function(){return Timetracker.generalSettings.getTSSettings().TS_jobScheduleEdit},getJobSchdEditPastDatePerm:function(){return Timetracker.generalSettings.getTSSettings().TS_jobScheduleEdit_PastDays},getTimelogOverlapType:function(user,settingId,data){let timeEntriesOverlap=Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_timeEntriesOverlap;return Timetracker.Validations.isDefiniteValue(timeEntriesOverlap)?timeEntriesOverlap:"0"},hideWeekEnd:function(){return"1"===Timetracker.generalSettings.getTSSettings().TS_hideWeekEndsInJobSchd},hideHoliday:function(){return"1"===Timetracker.generalSettings.getTSSettings().TS_hideHolidaysInJobSchd},hideLeave:function(){return"1"===Timetracker.generalSettings.getTSSettings().TS_hideLeaveInJobSchd},isProjectsIntegEnabled:function(){return"1"===Timetracker.generalSettings.getTSSettings().TS_projectsInteg},getAutoBillNo:function(){return Timetracker.generalSettings.getTSSettings().TS_BillnoAuto},getBillNoPrefix:function(){return Timetracker.generalSettings.getTSSettings().TS_BillnoPrefix},getBillStartNo:function(){return Timetracker.generalSettings.getTSSettings().TS_BillnoStarts},isProjectManagerPerm:function(){return!0},isBreakEnabled:function(){var isBreakEnabled=Timetracker.generalSettings.getTSSettings().TS_breakEnabled;return!!isBreakEnabled&&"1"===isBreakEnabled},isBreakConfigured:function(user){return Timetracker.generalSettings.isBreakEnabled()&&Timetracker.Validations.isTrue(Timetracker.generalSettings.getTSSettings(user),"isBreakConfigured")},showScheduleHoursInTS:function(){var showSchdHoursInTS=Timetracker.generalSettings.getTSSettings().TS_showSchdHoursInTS;return!!showSchdHoursInTS&&"1"===showSchdHoursInTS},isBudgetEnabled:function(){var isBudgetEnabled=Timetracker.generalSettings.getTSSettings().TS_budgetEnabled;return!!isBudgetEnabled&&"1"===isBudgetEnabled},isTimelogAttendanceRestrict:function(){var att_timelog=Timetracker.generalSettings.getTSSettings().TS_attendanceHrsLogRestrict;return!!att_timelog&&"1"===att_timelog},isTimerAttCheckInConfigured:function(){var att_timer=Timetracker.generalSettings.getTSSettings().TS_attTimerEntryRestrection;return void 0!=att_timer&&null!=att_timer},isTimerAttCheckInRestrict:function(){var att_timer=Timetracker.generalSettings.getTSSettings().TS_attTimerEntryRestrection;return!!att_timer&&"1"===att_timer},isPushTimerToAttendanceEnabled:function(){return"1"===Timetracker.generalSettings.getTSSettings().TS_attendance},isPushStartEndLogToAttendanceEnabled:function(){return"1"===Timetracker.generalSettings.getTSSettings().TS_attendance_startEnd},isAutoPopulateSingleJob:function(){return"1"===Timetracker.generalSettings.getTSSettings().TS_autoPopulateSingleJob},isJobProLocApplicableEnabled:function(){return"1"===Timetracker.generalSettings.getTSSettings().TS_JobProj_LocApplicable},isJobSchTLRestrictExtendEnabled:function(){return"1"===Timetracker.generalSettings.getTSSettings().TS_jobschTimeIntervalTLRestrict_Extend},isJobSchTLRestricted:function(){return"1"===Timetracker.generalSettings.getTSSettings().TS_jobschTimeIntervalTLRestrict},isJobSchDatainTLEnabled:function(){return"1"===Timetracker.generalSettings.getTSSettings().TS_jobschDataInTimelogs},isCustomReminderLogTimeWithInAttHours:function(){let value=Timetracker.generalSettings.getTSSettings().TS_CustomReminder_logTimeWithInAttHours||{};return value.hasOwnProperty("enabled")&&"true"===value.enabled},is24HoursTimelogRestrictionEnabled:function(){return"1"===Timetracker.generalSettings.getTSSettings().TS_restrict24hrsLogPerDay},isOrgTagEnabled:function(){return"1"===Timetracker.generalSettings.getTSSettings().TS_OrgTag_Enabled},isRoleFilterEnabled:function(){return isadmin},isPayRollPayPeriodPersistenceEnabled:function(){return"1"===Timetracker.generalSettings.getTSSettings().TS_payRollPayperiodEnabled||xeroEnabled},isPayRollPayPeriodFormFiltersHiding:function(){return"1"===Timetracker.generalSettings.getTSSettings().TS_payRollPayPeriodFormFiltersHiding},getTTPayRollApprovalFilterDefaultVal:function(){if(!Timetracker.generalSettings.isPayRollPayPeriodPersistenceEnabled())return"0";let value=Timetracker.generalSettings.getTSSettings().TS_PayrollApprovalFilter_DefaultValue;return void 0===value||null===value?"1":value},isTTXeroEnabled:()=>isadmin&&xeroEnabled&&Timetracker.generalSettings.isPayRollPayPeriodPersistenceEnabled(),isShowFormsAllData:function(){return"1"==Timetracker.generalSettings.getTSSettings().TS_showFormsAllData},isShiftEnabled:function(){return"1"==Timetracker.generalSettings.getTSSettings().TS_shiftEnabled},isTimelogAddEnabledInTimesheet:function(){return"1"==Timetracker.generalSettings.getTSSettings().TS_timelogAddInTSEnabled},isNonBillableTLforPayableHours:function(user,settingId,data){return"1"==Timetracker.generalSettings.getTSSettings(user,settingId,data).TS_NonBillableTLforPayableHours}},Timetracker.userTSSettings={currentSettingId:null,settingDetails:{},userSettingDetails:{},applicable_for_list:[],location_app_for_list:[],loadUserTSSettings:function(){Timetracker.initSetup(),Timetracker.userTSSettings.getUserTSSettingsList()},getUserTSSettings:function(user){if(Timetracker.userTSSettings.userSettingDetails[user])return Timetracker.userTSSettings.userSettingDetails[user];ZPeople.Request.sendAsyncPost(Timetracker.constants.URL,{mode:"getUserTimesheetSettings",users:user},Timetracker.userTSSettings.getUserTSSettingsCallback,{},Timetracker.Util.generalFailureCallback)},getUserTSSettingsCallback:function(result,params){var error_msg,isError=void 0===result||null===result||0===Object.keys(result).length;if(isError)error_msg=Timetracker.Util.getFailureMessageByCode();else{var error_code=result.errorCode;error_code&&(isError=!0,error_msg=Timetracker.Util.getFailureMessageByCode(error_code,result.extra_dtls))}isError?Timetracker.util.showAlert(0,error_msg):result.success&&result.settingsObj&&(Timetracker.userTSSettings.userSettingDetails[params.users]=result.settingsObj)},resetUserTSSettings:function(){Timetracker.userTSSettings.userSettingDetails={}},getSettingDetails:function(settingId){if(Timetracker.userTSSettings.settingDetails[settingId])return Timetracker.userTSSettings.settingDetails[settingId];ZPeople.Request.send(Timetracker.constants.URL,{mode:"getUserTimesheetSettingsById",settingId:settingId},Timetracker.userTSSettings.getSettingDetailsCallback,{},Timetracker.Util.generalFailureCallback)},getSettingDetailsCallback:function(result,params){var error_msg,isError=void 0===result||null===result||0===Object.keys(result).length;if(isError)error_msg=Timetracker.Util.getFailureMessageByCode();else{var error_code=result.errorCode;error_code&&(isError=!0,error_msg=Timetracker.Util.getFailureMessageByCode(error_code,result.extra_dtls))}if(!isError)return result.success&&result.settingsObj?(Timetracker.userTSSettings.settingDetails[settingId]=result.settingsObj,Timetracker.userTSSettings.settingDetails[settingId]):{};Timetracker.util.showAlert(0,error_msg)},resetTSSettings:function(settingsId){settingsId?delete Timetracker.userTSSettings.settingDetails[settingId]:Timetracker.userTSSettings.settingDetails={}},getParamsForUserTSListing:function(){var params={mode:"getUserTimesheetSettingsList",sIndex:0};return params.limit=Timetracker.FireScroll.getMaxFetchCount(Timetracker.constants.MODES.USER_TS_SETTINGS),params},getUserTSSettingsList:function(){Timetracker.util.appendLoading(),Timetracker.userTSSettings.applicable_for_list=[],Timetracker.userTSSettings.location_app_for_list=[],ZPeople.Request.send(Timetracker.constants.URL,Timetracker.userTSSettings.getParamsForUserTSListing(),Timetracker.userTSSettings.getUserTSSettingsListCallback,{},Timetracker.Util.generalFailureCallback)},getUserTSSettingsListCallback:function(result,params){var isEmpty=void 0===result||null===result||0===Object.keys(result).length;if(!isEmpty){isEmpty=void 0===result.configInfo||0===result.configInfo.length;var error_code=result.errorCode;if(error_code){var error_msg=Timetracker.Util.getFailureMessageByCode(error_code);Timetracker.util.showAlert(0,error_msg)}}if(Layout.Page.container.find("#user_settings_list").addClass("DN"),Timetracker.util.removeLoading(),isEmpty)Timetracker.util.appendEmptyData(ZPI18N.getString("zp.nosettingsconfigured"),{classname:"CR-at-set-user",path:"path4"});else{var txt=Timetracker.userTSSettings.constructUserTSSettingsList(result.configInfo);Layout.Page.container.find("#tssettings-usertbody").html($(txt).children()),Timetracker.util.removeEmptyData(),Layout.Page.container.find("#user_settings_list").removeClass("DN"),Timetracker.Util.handleTablePosition(),Timetracker.FireScroll.initFireScroll(Timetracker.constants.MODES.USER_TS_SETTINGS,Timetracker.constants.URL,params,Timetracker.userTSSettings.loadMoreDataInUserTSSettings),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.USER_TS_SETTINGS,result.configInfo),Layout.Page.parentContainer.find("[scroll=enabled]").scrollTop(0)}},constructUserTSSettingsList:function(configArr){var txt=$("<div/>");return $.each(configArr,function(index,configObj){$(txt).append(Timetracker.userTSSettings.constructUserTSSettingsListRow(configObj))}),txt},constructUserTSSettingsListRow:function(configObj){var txt='<tr id="'+configObj.settingsId+'" class="ZPLRow"><td class="CP" onclick="Timetracker.userTSSettings.loadEditUserTSSettings($(this).closest(\'tr\'));">'+configObj.settingsName+'</td><td><div id="action_button" class="over-display"><i onclick="Timetracker.util.showHideConfirmDeleteButtons(this,\'action_confirm_button\',\'table-responsive\');" title="'+ZPI18N.getString("zp.delete")+'" class="IC-delete S14 gry FR MR15 CP"></i><i class="IC-pen S14 gry FR MR15 CP" title="'+ZPI18N.getString("zp.edit")+'" onclick="Timetracker.userTSSettings.loadEditUserTSSettings($(this).closest(\'tr\'));"></i></div><div style="display:none" id="action_confirm_button"><button onclick="Timetracker.util.showHideConfirmDeleteButtons(this,\'action_button\',\'table-responsive\');" class="btn btn-default btn-sm FR" type="button">'+ZPI18N.getString("zp.cancel")+"</button><button onclick=\"Timetracker.userTSSettings.deleteUserTSSettings('"+configObj.settingsId+'\');" id="deleteShow_'+configObj.settingsId+'" class="btn btn-danger btn-sm FR MR10" type="button">'+ZPI18N.getString("zp.confirm")+"</button></div></td><td></td></tr>";txt=$(txt).data("configInfo",configObj);var current_app_for_list=configObj.applicableForIds?configObj.applicableForIds.split(";"):[];Timetracker.userTSSettings.applicable_for_list=ZPUtil.removeDuplicatesFromArray(Timetracker.userTSSettings.applicable_for_list.concat(current_app_for_list));var current_loc_app_for_list=configObj.locAppForIds?configObj.locAppForIds.split(";"):[];return Timetracker.userTSSettings.location_app_for_list=ZPUtil.removeDuplicatesFromArray(Timetracker.userTSSettings.location_app_for_list.concat(current_loc_app_for_list)),Timetracker.userTSSettings.settingDetails[configObj.settingsId]=configObj,txt},getSettingsType:function(type){return ZPI18N.getString("zp.users")},loadMoreDataInUserTSSettings:function(result){var configInfo=result.configInfo||[],txt=Timetracker.userTSSettings.constructUserTSSettingsList(result.configInfo);Layout.Page.container.find("#tssettings-usertbody").append($(txt).children()),Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.USER_TS_SETTINGS,configInfo)},constructAddEditUserTSSettings:function(mode,config){var modal=Layout.Page.container.find("#zp_ts_user_settings");modal.find("#zp_modal_blubtn").removeClass("disabled").off("click").on("click",function(){Timetracker.userTSSettings.addEditUserTSSettings({mode:mode,config:config})}),modal.find("#tssettings_timestamp_automatic").off("change").on("change",function(){Timetracker.generalSettings.disableAttCheckinTimerRestrict(config)}),modal.find("#tssettings_att_timer_checkin").off("change").on("change",function(){Timetracker.generalSettings.disableAttCheckinTimerRestrict(config)});var keys=[];return keys.push(ZPPickList.CONSTANTS.LOCATIONS),keys.push(ZPPickList.CONSTANTS.USERS),ZPPickList.loginUserNeed=!0,modal.find("#applicableToComponent").html(ZPPickList.init(keys)),Timetracker.userTSSettings.resetDataOnAddEditUserTSSettings(modal,config),modal},resetDataOnAddEditUserTSSettings:function(modal,config){void 0===config&&Timetracker.generalSettings.getSyncTimesheetSettings();var settingsData=void 0!==config?config:Timetracker.generalSettings.settingDetails;modal.find("#tssettings_timesheetperiod").off("change").on("change",function(){Timetracker.generalSettings.showHideRestrictTSSubmissionPeriod.onTimesheetPeriodChange(this,settingsData)}),modal.find("div.error-msg").remove(),Timetracker.generalSettings.setGeneralSettings(modal,settingsData),modal.find("input[name=maxloghrstype]").off("click").on("click",function(){Timetracker.generalSettings.getMaxLogHours("userSettingsDiv",$(this).val(),settingsData)}),modal.find("input[name=restrictmin]").off("click").on("click",function(){Timetracker.generalSettings.showHideMinMaxHrsInput("userSettingsDiv",$(this).val(),settingsData,"min")}),modal.find("input[name=restrictmax]").off("click").on("click",function(){Timetracker.generalSettings.showHideMinMaxHrsInput("userSettingsDiv",$(this).val(),settingsData,"max")}),modal.find("#tssettings_pastlog").off("click").on("click",function(){Timetracker.generalSettings.showHidePastDays("zp_ts_user_settings",$(this).is(":checked"),settingsData)}),modal.find("select").select2({minimumResultsForSearch:1/0})},loadAddUserTSSettings:function(){var modal=Timetracker.userTSSettings.constructAddEditUserTSSettings(Timetracker.constants.ADD);modal.find("#zp_ts_usersettings_name").val(""),modal.find("input[name=setting_type]").val("0"),ZPPickList.setSelectedUsers([],!0),ZPeople.BSModal.show(modal)},loadEditUserTSSettings:function(thisObj){var config=$.extend(!0,{},$(thisObj).data("configInfo")),modal=Timetracker.userTSSettings.constructAddEditUserTSSettings(Timetracker.constants.EDIT,config);modal.find("#zp_ts_usersettings_name").val(ZPeople.decodeTxt(config.settingsName)),modal.find("input[name=setting_type]").val(config.settingsType),ZPPickList.setSelectedUsers($.extend([],ZPUtil.Validation.isEmpty(config.applicableForIds)?[]:config.applicableForIds.split(";"),!0)),ZPPickList.setSelectedLocations($.extend([],ZPUtil.Validation.isEmpty(config.locAppForIds)?[]:config.locAppForIds.split(";"),!0)),ZPeople.BSModal.show(modal)},validateAndSetParams:function(json){Timetracker.util.removeErrorMsg("zp_ts_user_settings");var layout=Layout.Page.container.find("#zp_ts_user_settings"),params={mode:"updateUserTimesheetSettings"},isError=!1,settingsNameObj=layout.find("#zp_ts_usersettings_name"),settingsName=settingsNameObj.val();ZPUtil.Validation.isEmpty(settingsName)?(isError=!0,Timetracker.util.appendErrorMsg({obj:settingsNameObj,msg:ZPI18N.getString("zp.pleaseentersettingname")})):params.settingsName=settingsName;var settingsType=layout.find("input[name=setting_type]:checked").val();ZPUtil.Validation.isEmpty(settingsType)?(isError=!0,Timetracker.util.appendErrorMsg({obj:layout.find("input[name=setting_type]").parent("label"),msg:ZPI18N.getString("zp.pleaseselectsettingtype")})):params.settingsType=settingsType;var appFor=[],existing_appFor_cnt=0,config=json.config?$.extend(!0,{},json.config):Timetracker.generalSettings.settingDetails;if(params.settingsType&&"0"===params.settingsType)for(var selectedUsers=ZPPickList.getSelectedUsers(),previous_appfor=config.applicableForIds?config.applicableForIds:[],i=0;i<selectedUsers.length;i++)-1===previous_appfor.indexOf(selectedUsers[i])&&-1!==Timetracker.userTSSettings.applicable_for_list.indexOf(selectedUsers[i])?existing_appFor_cnt++:appFor.push(selectedUsers[i]);var settingsTypeDataObj=layout.find("#applicableToComponent");existing_appFor_cnt>0&&(isError=!0,Timetracker.util.appendErrorMsg({obj:settingsTypeDataObj,msg:ZPI18N.getString("zp.useralreadymappedsett",[existing_appFor_cnt])}));var locAppFor=[],existing_locappFor_cnt=0,selectedLoc=ZPPickList.getSelectedLocations(),previous_locappfor=config.locAppForIds?config.locAppForIds:[];for(i=0;i<selectedLoc.length;i++)-1===previous_locappfor.indexOf(selectedLoc[i])&&-1!==Timetracker.userTSSettings.location_app_for_list.indexOf(selectedLoc[i])?existing_locappFor_cnt++:locAppFor.push(selectedLoc[i]);if(existing_locappFor_cnt>0&&(isError=!0,Timetracker.util.appendErrorMsg({obj:settingsTypeDataObj,msg:ZPI18N.getString("zp.alreadymappedsett",[existing_locappFor_cnt,ZPI18N.getString("zp.multiplelocation")])})),!isError)if(0!=appFor.length||0!=locAppFor.length){var appfor={};appfor.user=appFor,appfor.loc=locAppFor,params.appfor=JSON.stringify(appfor)}else isError=!0,Timetracker.util.appendErrorMsg({obj:settingsTypeDataObj,msg:ZPI18N.getString("zp.appforempty")});return isError||0!==Layout.Page.container.find("#error_message_tscri").length&&(isError=!0),isError?{isError:!0}:(json.mode===Timetracker.constants.EDIT&&config.settingsId&&(params.settingsId=config.settingsId),params=Timetracker.generalSettings.getParamsForUpdateSettings(params,config,!0))},addEditUserTSSettings:function(json){json.mode;var layout=Layout.Page.container.find("#zp_ts_user_settings");layout.find("#zp_modal_blubtn").addClass("disabled");var params=Timetracker.userTSSettings.validateAndSetParams(json);if(null===params)ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.nochangesmade")),layout.find("#zp_modal_blubtn").removeClass("disabled");else{if(params.isError)return layout.find("#zp_modal_blubtn").removeClass("disabled"),void(params.hasOwnProperty("errMsg")&&("minhrs_day_week_mand"===params.errMsg?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.minperdayweekmand")):"maxhrs_day_week_mand"===params.errMsg&&ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.maxperdayweekmand"))));ZPeople.Request.send(Timetracker.constants.URL,params,Timetracker.userTSSettings.addEditUserTSSettingsCallback,{},Timetracker.Util.generalFailureCallback)}},addEditUserTSSettingsCallback:function(result,params){Layout.Page.container.find("#zp_ts_user_settings").find("#zp_modal_blubtn").removeClass("disabled");var error_msg,isError=void 0===result||null===result||0===Object.keys(result).length;if(isError)error_msg=Timetracker.Util.getFailureMessageByCode();else{var error_code=result.errorCode;error_code?(isError=!0,error_msg=Timetracker.Util.getFailureMessageByCode(error_code,result.extra_dtls)):0===result.res&&result.message&&(isError=!0,error_msg=result.message)}if(isError)Timetracker.util.showAlert(1,error_msg);else if(result.success)if(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.ttsettingssaved")),ZPeople.BSModal.hide("zp_ts_user_settings"),result.extra_dtls&&result.extra_dtls.configObj){var configObj=result.extra_dtls.configObj,txt=Timetracker.userTSSettings.constructUserTSSettingsListRow(configObj),listLayout=Layout.Page.container.find(".Scrcont"),settingsId=$(txt).attr("id"),settingObj=listLayout.find("tr#"+settingsId);if(settingObj&&0!==settingObj.length){var configInfo=settingObj.data("configInfo");if(configInfo){if(configInfo.applicableForIds!==configObj.applicableForIds){var previous_appFor_ids=configInfo.applicableForIds.split(";"),current_appFor_ids=configObj.applicableForIds.split(";");0!==(remove_appFor_ids=ZPUtil.getDistinctElementsInArrays(previous_appFor_ids,current_appFor_ids)).length&&(Timetracker.userTSSettings.applicable_for_list=ZPUtil.getDistinctElementsInArrays(Timetracker.userTSSettings.applicable_for_list,remove_appFor_ids))}if(configInfo.locAppForIds!==configObj.locAppForIds){var remove_appFor_ids;previous_appFor_ids=configInfo.locAppForIds.split(";"),current_appFor_ids=configObj.locAppForIds.split(";");0!==(remove_appFor_ids=ZPUtil.getDistinctElementsInArrays(previous_appFor_ids,current_appFor_ids)).length&&(Timetracker.userTSSettings.location_app_for_list=ZPUtil.getDistinctElementsInArrays(Timetracker.userTSSettings.location_app_for_list,remove_appFor_ids))}}settingObj.replaceWith(txt),Timetracker.userTSSettings.resetUserTSSettings()}else{var trCnt=listLayout.find("#tssettings-usertbody").find("tr").length;listLayout.find("#tssettings-usertbody").append(txt),0===trCnt?(Timetracker.util.removeEmptyData(),listLayout.find("#user_settings_list").removeClass("DN"),Timetracker.Util.handleTablePosition()):Timetracker.FireScroll.setFetchCount(Timetracker.constants.MODES.USER_TS_SETTINGS,1)}}else Timetracker.userTSSettings.getUserTSSettingsList(),Timetracker.userTSSettings.resetUserTSSettings()},deleteUserTSSettings:function(settingsId){ZPeople.Request.send(Timetracker.constants.URL,{mode:"deleteUserTimesheetSettings",settingsId:settingsId},Timetracker.userTSSettings.deleteUserTSSettingsCallback,{},Timetracker.Util.generalFailureCallback)},deleteUserTSSettingsCallback:function(result,params){var error_msg,isError=void 0===result||null===result||0===Object.keys(result).length;if(isError)error_msg=Timetracker.Util.getFailureMessageByCode();else{var error_code=result.errorCode;error_code&&(isError=!0,error_msg=Timetracker.Util.getFailureMessageByCode(error_code))}if(isError)Timetracker.util.showAlert(0,error_msg);else if(result.success){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.ttsettingsdeleted"));var listLayout=Layout.Page.container.find(".Scrcont"),trObj=listLayout.find("tr#"+params.settingsId),configInfo=trObj.data("configInfo");trObj.remove();var current_applicablefor=configInfo&&configInfo.applicableForIds?configInfo.applicableForIds.split(";"):[];Timetracker.userTSSettings.applicable_for_list=ZPUtil.getDistinctElementsInArrays(Timetracker.userTSSettings.applicable_for_list,current_applicablefor);var current_locAppfor=configInfo&&configInfo.locAppForIds?configInfo.locAppForIds.split(";"):[];Timetracker.userTSSettings.location_app_for_list=ZPUtil.getDistinctElementsInArrays(Timetracker.userTSSettings.location_app_for_list,current_locAppfor),0===listLayout.find("#tssettings-usertbody").find("tr").length&&(listLayout.find("#user_settings_list").addClass("DN"),Timetracker.util.appendEmptyData(ZPI18N.getString("zp.nosettingsconfigured"),{classname:"CR-at-set-user",path:"path4"})),Timetracker.userTSSettings.resetUserTSSettings(),Timetracker.userTSSettings.resetTSSettings()}}},Timetracker.approvalSettings={approvalFormId:"",getApprovalSettings:function(){var params={mode:"fetchApprovals",conreqcsr:csrfToken};$.post(Timetracker.constants.URL,params,function(resultData){var txt="";Layout.Page.container.find("div#approvalsettingsdiv").removeClass("DN"),Layout.Page.container.find("#zp_empty_data").addClass("DN"),$.each(resultData,function(index,data){data&&data.FORMID?(Timetracker.approvalSettings.approvalFormId=data.FORMID,txt+='<tr id="approval_'+data.FORM_TEMPLATE_ACTION_ID+'" class="ZPLRow" approvalId="'+data.FORM_TEMPLATE_ACTION_ID+'">',txt+="<td>"+data.TEMPLATE_NAME+"</td>",txt+="<td>"+data.SUBJECT+"</td>",txt+='<td><div class="btnactive"><input type="checkbox" onclick="ApprovalProcess.enableDisable(\''+data.FORM_TEMPLATE_ACTION_ID+"','"+data.FORMID+'\');" class="cmn-toggle-small cmn-toggle-round-small" id="approvalStatus_'+data.FORM_TEMPLATE_ACTION_ID+'"',data.ISACTIVE&&(txt+=" checked"),txt+='><label class="M0" for="approvalStatus_'+data.FORM_TEMPLATE_ACTION_ID+'"></label></div></td>',txt+='<td class="text-right P0I"><div id="action_button" class="over-display"><i onclick="Timetracker.util.showHideConfirmDeleteButtons(this,\'action_confirm_button\',\'table-responsive\');" title="'+ZPI18N.getString("zp.delete")+'" class="IC-delete S14 gry FR MR15 CP"></i><i onclick="Timetracker.approvalSettings.editApproval(\''+data.FORM_TEMPLATE_ACTION_ID+"','"+Timetracker.approvalSettings.approvalFormId+'\');" title="'+ZPI18N.getString("zp.edit")+'" class="IC-pen S14 gry FR MR15 CP"></i></div>',txt+='<div style="display:none" id="action_confirm_button"><button onclick="Timetracker.util.showHideConfirmDeleteButtons(this,\'action_button\',\'table-responsive\');" class="btn btn-default btn-sm FR MR15" type="button">'+ZPI18N.getString("zp.cancel")+"</button><button onclick=\"Timetracker.approvalSettings.deleteApproval('"+Timetracker.approvalSettings.approvalFormId+"','"+data.FORM_TEMPLATE_ACTION_ID+'\');" class="btn btn-danger btn-sm FR MR10" type="button">'+ZPI18N.getString("zp.confirm")+"</button></div></td>",txt+="<td></td>"):(data&&data.newformid&&(Timetracker.approvalSettings.approvalFormId=data.newformid),Layout.Page.container.find("div#approvalsettingsdiv").addClass("DN"),Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noapproval"),{classname:"CR-set-approval",path:"path4"}))}),Layout.Page.container.find("#tsapproval-tbody").html(txt),Layout.Page.container.find("#tsapproval-table").attr("formId",Timetracker.approvalSettings.approvalFormId),ZPView.handleTablePosition()}),AutomationCommon.pageInsert(ApprovalProcess.MODE),Layout.Page.container.find("#approvalListTable").remove()},addApproval:function(){ApprovalProcess.addNew(Timetracker.approvalSettings.approvalFormId,"0",Timetracker.approvalSettings.getApprovalSettings,"Timesheet")},editApproval:function(approvalId,formId){ApprovalProcess.getApprovalRow(approvalId,formId,Timetracker.approvalSettings.getApprovalSettings)},addSettings:function(){ApprovalSettings.initiatePage(Timetracker.approvalSettings.approvalFormId,"Timesheet")},deleteApproval:function(formId,approvalId){"success"===ApprovalProcess.deleteApproval(approvalId,formId).result?(Layout.Page.container.find("#tsapproval-tbody").find("#approval_"+approvalId).remove(),0===Layout.Page.container.find("#tsapproval-tbody").find("tr").length&&(Layout.Page.container.find("div#approvalsettingsdiv").addClass("DN"),Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noapproval"),{classname:"CR-set-approval",path:"path4"})),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.approvalconfigdeletionsuccess"))):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.ttfailuremsg"))}},Timetracker.schedulerReminderSettings={TIMESHEET_SCHEDULER_TYPE:0,TIMESHEET_REMINDER_TYPE:1,TIMELOG_REMINDER_TYPE:2,TIMER_CUSTOM_REMINDER_TYPE:42,tabId:null,scheduleObj:null,reminderObj:null,fetchData:!1,editMode:!1,editData:null,empSingleTempId:"0",repSingleTempId:"0",specSingleTempId:"0",empConsecTempId:"0",repConsecTempId:"0",specConsecTempId:"0",isSingle:!1,isConsec:!1,templateJson:{},tempArr:[],orgTimeZoneOffset:void 0,initAutoSchedule:function(){Timetracker.initSetup(),Timetracker.schedulerReminderSettings.getAutoSchedule()},getAutoSchedule:function(){Layout.Page.container.find("#tssettings-addreminderdiv,#tssettings-addschdiv,#reminderlist,#zp_empty_data,#schedulinglist").hide(),Timetracker.schedulerReminderSettings.fetchData=!1;var type=Timetracker.schedulerReminderSettings.TIMESHEET_SCHEDULER_TYPE,resultData=Timetracker.schedulerReminderSettings.scheduleObj;if("timetracker/settings/remindersettings"===Layout.Page.currentmode&&(type=Timetracker.schedulerReminderSettings.TIMESHEET_REMINDER_TYPE,resultData=Timetracker.schedulerReminderSettings.reminderObj),null===resultData&&(Timetracker.schedulerReminderSettings.fetchData=!0),Timetracker.schedulerReminderSettings.fetchData){var params={mode:"getAutoSchedule",type:type,conreqcsr:csrfToken};$.post(Timetracker.constants.URL,params,function(resultData){Timetracker.schedulerReminderSettings.constructAutoSchedule(resultData,type),type?Timetracker.schedulerReminderSettings.reminderObj=resultData:Timetracker.schedulerReminderSettings.scheduleObj=resultData})}else Timetracker.schedulerReminderSettings.constructAutoSchedule(resultData,type)},constructAutoSchedule:function(resultData,type){var tbodyId="#tssettings-schtbody";type&&(tbodyId="#tssettings-remindertbody"),Layout.Page.container.find(tbodyId).html("");var frequency=new Array(ZPI18N.getString("zp.daily"),ZPI18N.getString("zp.weekly"),ZPI18N.getString("zp.monthly")),billstatus=new Array(ZPI18N.getString("zp.all"),ZPI18N.getString("zp.billable"),ZPI18N.getString("zp.nonbillable"));0===resultData.length||""===resultData?type?(Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noreminderconfigured"),{classname:"CR-tt-set-reminder",path:"path6"}),Layout.Page.container.find("#reminderlist").fadeOut(200)):(Timetracker.util.appendEmptyData(ZPI18N.getString("zp.noscheduleconfigured"),{classname:"CR-tt-set-scheduler",path:"path6"}),Layout.Page.container.find("#schedulinglist").fadeOut(200)):($.each(resultData,function(index,data){var reminderType;data.type===Timetracker.schedulerReminderSettings.TIMESHEET_REMINDER_TYPE?reminderType=ZPI18N.getString("zp.timesheets"):data.type===Timetracker.schedulerReminderSettings.TIMELOG_REMINDER_TYPE?reminderType=ZPI18N.getString("zp.timelogs"):data.type==Timetracker.schedulerReminderSettings.TIMER_CUSTOM_REMINDER_TYPE&&(reminderType=ZPI18N.getString("zp.timercustomremindermailsubjectnotrunning"));var txt='<tr class="ZPLRow">';txt+='<td class="CP" title="'+ZPI18N.getString("zp.edit")+'" onclick="Timetracker.schedulerReminderSettings.showAutoScheduleModify(this,undefined,\''+data.type+"')\">"+data.scheduleName+"</td>",data.type!==Timetracker.schedulerReminderSettings.TIMER_CUSTOM_REMINDER_TYPE&&data.type!==Timetracker.schedulerReminderSettings.TIMESHEET_REMINDER_TYPE&&data.type!==Timetracker.schedulerReminderSettings.TIMELOG_REMINDER_TYPE||(txt+="<td>"+reminderType+"</td>"),data.type===Timetracker.schedulerReminderSettings.TIMER_CUSTOM_REMINDER_TYPE?(txt+="<td></td>",txt+="<td></td>"):(txt+="<td>"+frequency[data.frequency]+"</td>",txt+="<td>"+Calendar.minstotime(data.time)+"</td>"),type||(txt+="<td>"+billstatus[data.billStatus+1]+"</td>"),txt+='<td class="text-right P0I"><div id="action_button" class="over-display"><i onclick="Timetracker.util.showHideConfirmDeleteButtons(this,\'action_confirm_button\',\'table-responsive\');" title="'+ZPI18N.getString("zp.delete")+'" class="IC-delete S14 gry FR MR15 CP"></i><i id="edit'+data.scheduleId+'" onclick="Timetracker.schedulerReminderSettings.showAutoScheduleModify(this,1,\''+data.type+'\');"  title="'+ZPI18N.getString("zp.edit")+'" class="IC-pen S14 gry FR MR15 CP"></i></div>',txt+='<div style="display:none" id="action_confirm_button"><button onclick="Timetracker.util.showHideConfirmDeleteButtons(this,\'action_button\',\'table-responsive\');" class="btn btn-default btn-sm FR MR15" type="button">'+ZPI18N.getString("zp.cancel")+"</button><button onclick=\"Timetracker.schedulerReminderSettings.deleteAutoSchedule('"+data.scheduleId+'\');" class="btn btn-danger btn-sm FR MR10" type="button">'+ZPI18N.getString("zp.confirm")+"</button></div></td>",txt+="<td></td></tr>",(txt=$(txt)).data(data),Layout.Page.container.find(tbodyId).append(txt)}),type?(Layout.Page.container.find("#reminderlist").fadeIn(200),Layout.Page.container.find("#zp_empty_data").fadeOut(200)):(Layout.Page.container.find("#schedulinglist").fadeIn(200),Layout.Page.container.find("#zp_empty_data").fadeOut(200)),ZPView.handleTablePosition())},deleteAutoSchedule:function(scheduleId){$.post(Timetracker.constants.URL,{mode:"deleteAutoSchedule",scheduleId:scheduleId,conreqcsr:csrfToken},function(resultData){-1!==Layout.Page.hash.indexOf("timetracker/settings/remindersettings")?(Timetracker.schedulerReminderSettings.reminderObj=null,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.reminderdeleted"))):(Timetracker.schedulerReminderSettings.scheduleObj=null,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.scheduledeleted"))),Timetracker.schedulerReminderSettings.getAutoSchedule()})},showCommonCodeForScheduleAndReminderAddPage:function(flag){Timetracker.schedulerReminderSettings.editMode=!1,Timetracker.schedulerReminderSettings.editData=null,Timetracker.schedulerReminderSettings.showCommonCodeForScheduleAndReminderAddEditPage(flag)},showCommonCodeForScheduleAndReminderAddEditPage:function(flag){Timetracker.schedulerReminderSettings.tabId="tssettings-addschdiv","1"!==String(flag)&&"2"!==String(flag)&&"42"!==String(flag)||(Timetracker.schedulerReminderSettings.tabId="tssettings-addreminderdiv");var modal=Layout.Page.container.find("#"+Timetracker.schedulerReminderSettings.tabId);0==modal.length?modal=Timetracker.schedulerReminderSettings.contructSchedulerReminderSettingsPopup(flag):Timetracker.util.removeErrorMsg(Timetracker.schedulerReminderSettings.tabId),Timetracker.schedulerReminderSettings.resetSchedulerReminderSettingsPopup(flag),$("#"+Layout.Page.pageId+" #ZPAtt_absentScheduler").is(":visible")||ZPeople.BSModal.show(modal)},switchApplicableTabs:function(ele){"appl"==$(ele).attr("id")?(Layout.Page.container.find("#tsreminderapplicableDiv").removeClass("DN"),Layout.Page.container.find("#tsreminderexceptionDiv").addClass("DN")):(Layout.Page.container.find("#tsreminderexceptionDiv").removeClass("DN"),Layout.Page.container.find("#tsreminderapplicableDiv").addClass("DN")),$(ele).addClass("active"),$(ele).siblings().removeClass("active")},contructSchedulerReminderSettingsPopup:function(flag){var header=ZPI18N.getString("zp.schedconfig"),frequencyOnChange="",schedulefreq="",footer=null,isTSScheduler=-1!==Layout.Page.pageId.indexOf("timetracker-settings-schedulersettings"),isTSReminder=-1!==Layout.Page.pageId.indexOf("timetracker-settings-remindersettings");-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftrotation")&&(frequencyOnChange="AttendanceShift.frequencyOnChange()",schedulefreq=ZPI18N.getString("zp.schedule")+" "),isTSReminder&&(header=ZPI18N.getString("zp.reminderconfig"));var body='<div class="col-sm-12"><form class="form-horizontal pad" role="form"><div class="form-group"> ';-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftrotation")&&(body+='<h6 class="ZPbold MT0">'+ZPI18N.getString("zp.scheduledetails")+"</h6>");var name=ZPI18N.getString("zp.schedulename"),timeOfSch=ZPI18N.getString("zp.timeofschedule");if($("#"+Layout.Page.pageId+" #ZPAtt_absentScheduler").is(":visible")&&(name=ZPI18N.getString("zp.name"),timeOfSch=ZPI18N.getString("zp.schrunsat",new Array(""))),body+='<label class="control-label col-sm-3" id="tssettings-schedule-label-name">'+name+'</label><div class="col-sm-6"><input type="text" class="form-control" id="tssettings-schdulename"></div></div>',isTSReminder&&(body+='<div class="form-group"><label class="control-label col-sm-3" id="tssettings-schedule-remindertype">'+ZPI18N.getString("zp.type")+'</label><div class="col-sm-6"><select id="tssettings-remindertype"><option value="1">'+ZPI18N.getString("zp.timelogs")+'</option><option value="0">'+ZPI18N.getString("zp.timesheets")+"</option>",Timetracker.generalSettings.isCustomReminderLogTimeWithInAttHours()&&(body+='<option value="42">'+ZPI18N.getString("zp.tologwithinatthours")+"</option>"),body+="</select></div></div>"),!$("#"+Layout.Page.pageId+" #ZPAtt_absentScheduler").is(":visible")){body+='<div class="form-group"><label class="control-label col-sm-3">'+schedulefreq+ZPI18N.getString("zp.frequency")+'</label><div class="col-sm-8"><div class="row"><div class="col-sm-4"><select id="tssettings-frequency" onchange="Timetracker.schedulerReminderSettings.changeTSfrequency(this);'+frequencyOnChange+'"><option value="0">'+ZPI18N.getString("zp.daily")+'</option><option value="1">'+ZPI18N.getString("zp.weekly")+'</option><option value="2">'+ZPI18N.getString("zp.monthly")+"</option>",-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftrotation")&&(body+='<option value="3">'+ZPI18N.getString("zp.local.BiWeekly")+"</option>"),body+='</select></div><div class="col-sm-5" id="tssettings-dayofweek" style="display: none"><select id="tssettings-dayweek" onchange='+frequencyOnChange+'><option value="0">'+ZPI18N.getString("zp.sunday")+'</option><option value="1">'+ZPI18N.getString("zp.monday")+'</option><option value="2">'+ZPI18N.getString("zp.tuesday")+'</option><option value="3">'+ZPI18N.getString("zp.wednesday")+'</option><option value="4">'+ZPI18N.getString("zp.thursday")+'</option><option value="5">'+ZPI18N.getString("zp.friday")+'</option><option value="6">'+ZPI18N.getString("zp.saturday")+'</option></select><span class="oeweek"> '+ZPI18N.getString("zp.everyweek/month",[ZPI18N.getString("zp.sweek")])+'</span></div><div class="col-sm-5" id="tssettings-dayofmonth" style="display: none"><select id="tssettings-daymonth" onchange='+frequencyOnChange+">";var monthFreqDays=31;-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftrotation")&&(monthFreqDays=30);for(var i=1;i<=monthFreqDays;i++)body+='<option value="'+i+'">'+i+Timetracker.DateTime.getNumberSuffix(i)+"</option>";body+='<option value="'+(monthFreqDays=parseInt(monthFreqDays)+1)+'">'+ZPI18N.getString("zp.lastday")+'</option></select><span class="oeweek">'+ZPI18N.getString("zp.everyweek/month",[ZPI18N.getString("zp.smonth")])+"</span></div></div></div></div>"}if((isTSScheduler||isTSReminder)&&(body+='<div class="form-group"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.processdataof",[""])+'</label><div id="tssettings_processperiod_layout" class="col-sm-6"><select id="tssettings_processperiod" class="W150"></select></div></div>'),body+='<div class="form-group"><label class="control-label col-sm-3">'+timeOfSch+"</label>",$("#"+Layout.Page.pageId+" #ZPAtt_absentScheduler").is(":visible")?body+='<div class="col-sm-2"><div class="input-group bootstrap-timepicker zp_Cust-timpckr"><input type="text" class="form-control ts_sammaryTag" id="tssettings-time"><span class="input-group-addon"><i class="IC-clock gry CP"></i></span></div></div><div class="col-sm-5 PL0I"><span class="FL MT7 MR10">'+ZPI18N.getString("zp.processdate",new Array("",""))+'</span><select onchange="Attendance.Settings.Scheduler.selectValChange()" class="FL DIB" style=width:125px; id="schDate"><option value="0">'+ZPI18N.getString("zp.sameday")+'</option><option value="1">1 '+ZPI18N.getString("zp.daybefore",new Array(""))+'</option><option value="2">2 '+ZPI18N.getString("zp.daysbefore",new Array(""))+'</option><option value="3">3 '+ZPI18N.getString("zp.daysbefore",new Array(""))+'</option><option value="4">4 '+ZPI18N.getString("zp.daysbefore",new Array(""))+'</option><option value="5">5 '+ZPI18N.getString("zp.daysbefore",new Array(""))+"</option></select></div></div>":body+='<div class="col-sm-6"><div class="input-group bootstrap-timepicker timepicker"><input type="text" class="form-control ts_sammaryTag" id="tssettings-time"><span class="input-group-addon"><i class="IC-clock gry CP"></i></span></div></div></div>',-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftrotation")&&(body+='<h6 class="ZPbold">'+ZPI18N.getString("zp.shiftcycledetails")+"</h6>"),$("#"+Layout.Page.pageId+" #ZPAtt_absentScheduler").is(":visible")||-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftrotation")){if(-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftrotation")){title=ZPI18N.getString("zp.applicableperiod"),dateofschedule='<div class="col-sm-8"><label class="MT7 MR2 FL" id="scheduleDateBeforeCont"></label> <div style="display: none;width:110px;" class="DIB FL"><input type="text" id="shiftScheduleDate" onkeypress="return (event.charCode >= 48 && event.charCode <= 57) || event.charCode == 0" class="form-control bfh-number" onkeyup="AttendanceShift.frequencyOnChange()"></div>',dateofschedule+='<div style="display:none; width:150px;" class="DIB FL"><select id="tssettings-dayweekCycleAffected" onchange='+frequencyOnChange+'><option value="0">'+ZPI18N.getString("zp.sunday")+'</option><option value="1">'+ZPI18N.getString("zp.monday")+'</option><option value="2">'+ZPI18N.getString("zp.tuesday")+'</option><option value="3">'+ZPI18N.getString("zp.wednesday")+'</option><option value="4">'+ZPI18N.getString("zp.thursday")+'</option><option value="5">'+ZPI18N.getString("zp.friday")+'</option><option value="6">'+ZPI18N.getString("zp.saturday")+"</option></select></div>",dateofschedule+='<div style="display:none; width:110px;" class="DIB FL"><select id="tssettings-daymonthCycleAffected" onchange='+frequencyOnChange+">";for(i=1;i<=30;i++)dateofschedule+='<option value="'+i+'">'+i+"</option>";dateofschedule+='<option value="31">'+ZPI18N.getString("zp.lastday")+'</option></select></div> <label class="MT7 ML2 FL" id="scheduleDateAfterCont"></label></div>',footer='<div class="modal-footer"><button type="button" id="zp_modal_blubtn" class="btn btn-primary">'+ZPI18N.getString("zp.submit")+'</button><button type="button" class="btn btn-default" data-dismiss="modal">'+ZPI18N.getString("zp.cancel")+"</button>",footer+='<div class="label-message ZPAltmsg label-note"><p class="S13" id="shiftSchedule-notemessage"></p></div></div>',body+='<div class="form-group" id="tssettings-schedule-beforeCont-row"><label class="control-label col-sm-3">'+title+"</label>"+dateofschedule+"</div>"}}else body+='<div class="form-group" id="tssettings-schedule-billing-row"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.billablestatus")+'</label><div class="col-sm-6"><select id="tssettings-billstatus"><option value="-1">'+ZPI18N.getString("zp.all")+'</option><option value="0">'+ZPI18N.getString("zp.billable")+'</option><option value="1">'+ZPI18N.getString("zp.nonbillable")+"</option></select></div></div>";if($("#"+Layout.Page.pageId+" #ZPAtt_absentScheduler").is(":visible")&&(body+='<div class="form-group" id="ZPAtt_AbsSch_form4"><div class="col-sm-6 col-sm-offset-3"><div class="PR"><label class="checkbox DB MB15">',body+='<input type="checkbox" id="ZPAtt_pushAbsentEntryCheck"><span>'+ZPI18N.getString("zp.pushabsenttoleave")+'</span></label><label class="checkbox DB" style="margin-top: 5px;">',body+='<input type="checkbox" id="ZPAtt_notifyAbsentEntryCheck" onchange="Attendance.Settings.constructAbsSchNotify()"><span>'+ZPI18N.getString("zp.notifyemail")+'</span></label><a  id="customise_template" class="cust_optn" onclick="Timetracker.schedulerReminderSettings.hideShowCustTemp()" style="display:none">'+ZPI18N.getString("zp.custmailtemp")+"</a></div></div></div>"),isTSReminder&&(body+='<div id="ts_summary"><div class="form-group" id="TS_notifyWhenTLog"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.notifywhenempolyees")+'</label><div class="col-sm-6"><div class="MB10"><label class="radio"><input type="radio" name="NotifyWhenEmpTL" id="TLnotSubmit" value="0" checked><span>'+ZPI18N.getString("zp.hnotloggedtime")+'</span></label><div class="radinputIB MT8 MB10"><label class="radio"><input type="radio" name="NotifyWhenEmpTL" id="TLlessSubmit" value="1"><span>'+ZPI18N.getString("zp.hloggedlessthan",[""])+'<input id="timeLimitToNotify" type="text" value="00:00" class="form-control ctxtbox ML5I" style="width: 60px;"> '+ZPI18N.getString("zp.shours")+"</span></label></div></div></div></div>",body+='<div class="form-group" id="TS_notifyWhenTSheet"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.notifywhenempolyees")+'</label><div class="col-sm-8"><div class="MB10"><label class="radio"><input type="radio" name="NotifyWhenEmpTS" id="TSnotSubmit" value="0" checked><span>'+ZPI18N.getString("zp.hnotsubmittedtimesheet")+'</span></label><div class="radinputIB MT8 MB10"><label class="radio"><input type="radio" name="NotifyWhenEmpTS" id="TSlessSubmit" value="1"><span>'+ZPI18N.getString("zp.hsubmittedlessthan",[""])+'<input id="timeLimitToNotify" type="text" value="00:00" class="form-control ctxtbox ML5I" style="width: 60px;">'+ZPI18N.getString("zp.hoursforapproval")+'</span><a class="IC-info ML5 gry popHover" data-content="'+ZPI18N.getString("zp.timesheethoursconsidered")+'" data-trigger="hover" data-placement="bottom" data-toggle="popover" data-html="true"></a></div></label></div></div></div></div>'),body+=isTSReminder?'<div class="form-group"><label class="control-label col-sm-3 Matry">'+ZPI18N.getString("zp.applicablefor",[""])+'</label><div class="zpTabs_content MB20 appException col-md-8"><div class="zpTabs_contentInner P0I" data-content="2" style="display: block;" id="TSReminderApplicableFor"><div class="zpTabs_innerContainer zpTabs_innerFields"><ul class="zpTabs_innerTitleOut"><li class="zpTabs_innerTabTitle CP active" id="appl" onclick="Timetracker.schedulerReminderSettings.switchApplicableTabs(this)">'+ZPI18N.getString("zp.leavetype.applicable")+'</li><li class="zpTabs_innerTabTitle CP" id="except" onclick="Timetracker.schedulerReminderSettings.switchApplicableTabs(this)">'+ZPI18N.getString("zp.leavetype.exceptions")+'</li></ul><div id="tsreminderapplicableDiv" class="P20"><div class="zp-label Rflds" id="location_field"><label class="zplt-label">'+ZPI18N.getString("zp.location")+'</label><div class="W300 DIB"><select multiple="multiple"class="selectBox appl" name="location" ></select></div></div><div class="zp-label Rflds" id="department_field"><label class="zplt-label">'+ZPI18N.getString("zp.department")+'</label><div class="W300 DIB"><select multiple="multiple"class="selectBox appl" name="department"></select></div></div><div class="zp-label Rflds" id="designation_field"><label class="zplt-label">'+ZPI18N.getString("zp.designation")+'</label><div class="W300 DIB"><select multiple="multiple"class="selectBox appl" name="designation"></select></div></div><div class="zp-label Rflds" id="role_field"><label class="zplt-label">'+ZPI18N.getString("zp.role")+'</label><div class="W300 DIB"><select multiple="multiple"class="selectBox appl" name="role"></select></div></div><div class="zp-label Rflds" id="group_field"><label class="zplt-label">'+ZPI18N.getString("zp.group")+'</label><div class="W300 DIB"><select multiple="multiple"class="selectBox appl" name="group"></select></div></div><div class="zp-label Rflds"><label class="zplt-label"></label><div class="W300 DIB"><h7 class="gry">(+)</h7></div></div> <div class="zp-label Rflds" id="users_field"><label class="zplt-label">'+ZPI18N.getString("zp.employee")+'</label><div class="W300 DIB"><input ismultiple="true" class="selectBox appl" searchmode="SETTINGS" name="users"/><div id="selectedempcount" class="red error"></div></div></div></div> <div id="tsreminderexceptionDiv" class="DN P20"><div class="zp-label Rflds" id="location_field"><label class="zplt-label">'+ZPI18N.getString("zp.location")+'</label><div class="W300 DIB"><select multiple="multiple"class="selectBox except" name="location"></select></div></div><div class="zp-label Rflds" id="department_field"><label class="zplt-label">'+ZPI18N.getString("zp.department")+'</label><div class="W300 DIB"><select multiple="multiple"class="selectBox except" name="department"></select></div></div><div class="zp-label Rflds" id="designation_field"><label class="zplt-label">'+ZPI18N.getString("zp.designation")+'</label><div class="W300 DIB"><select multiple="multiple"class="selectBox except" name="designation"></select></div></div><div class="zp-label Rflds" id="role_field"><label class="zplt-label">'+ZPI18N.getString("zp.role")+'</label><div class="W300 DIB"><select multiple="multiple"class="selectBox except" name="role"></select></div></div><div class="zp-label Rflds" id="group_field"><label class="zplt-label">'+ZPI18N.getString("zp.group")+'</label><div class="W300 DIB"><select multiple="multiple"class="selectBox except" name="group"></select></div></div><div class="zp-label Rflds"><label class="zplt-label"></label><div class="W300 DIB"><h7 class="gry">(+)</h7></div></div><div class="zp-label Rflds" id="users_field"><label class="zplt-label">'+ZPI18N.getString("zp.employee")+'</label><div class="W300 DIB"><input ismultiple="true" class="selectBox except" searchmode="SETTINGS" name="users"/><div id="selectedempcount" class="red error"></div></div></div></div></div></div></div></div>':'<div class="form-group"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.applicablefor",[""])+'</label><div id="applicableToComponent" class="col-sm-6 MB10"></div></div>',-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftrotation")&&(header=ZPI18N.getString("zp.shiftrotation"),body+='<div class="form-group" id="tssettings-schedule-shiftRotation-row"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.shiftrotation")+'</label><div class="col-sm-8"><div class="RotBox" id="ZPAtt_shiftRotationBox"></div></div>'),isTSReminder&&(body+='<div class="form-group P10"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.notifyviamail")+'</label><div class="col-sm-7"><div class="MB15"><label class="checkbox MB10I"><input type="checkbox" id="notifyToEmp"><span>'+ZPI18N.getString("zp.employee")+'</span></label><small class="DB MT5 PL20 sub-clr">'+ZPI18N.getString("zp.applicableemployees")+'</small></div><div class="MB15"><label class="checkbox MB10I"><input type="checkbox" id="notifyToReporting"><span>'+ZPI18N.getString("zp.reportingmanager")+'</span></label><small class="DB MT5 PL20 sub-clr">'+ZPI18N.getString("zp.notifytoreportingmanager")+'</small></div><div class="MB15"><label class="checkbox MB10I"><input type="checkbox" id="notifyToSEmp"><span>'+ZPI18N.getString("zp.specificusers")+'</span></label><small class="DB MT5 PL20 sub-clr">'+ZPI18N.getString("zp.notifytoselectedemployees")+'</small></div><div id="notifEmpDiv" class="notfiysel-js DN W250 ML20"><input placeholder="Select user" id="notifyToSEmpUsers"></div></div></div>'),body+="</form></div>",!$("#"+Layout.Page.pageId+" #ZPAtt_absentScheduler").is(":visible")){var modalclass="popRgtModel";return isTSReminder&&(modalclass="popRgtModel dvGeoconfigure"),ZPeople.BSModal.get({id:Timetracker.schedulerReminderSettings.tabId,type:2,modalClass:modalclass,header:header,body:body,footer:footer,deleteOnHide:!1,closeOnSubmit:!1,buttonValue:ZPI18N.getString("zp.submit"),successCallback:Timetracker.schedulerReminderSettings.updateScheduleSettings})}$("#attendance-settings-absentschedule #ZPAtt_addPopup .modal-body").html(body),Layout.Page.container.find("#schDate").select2()},resetSchedulerReminderSettingsPopup:function(flag){var divId=Timetracker.schedulerReminderSettings.tabId,isTSScheduler=-1!==Layout.Page.pageId.indexOf("timetracker-settings-schedulersettings"),isTSReminder=-1!==Layout.Page.pageId.indexOf("timetracker-settings-remindersettings");if("1"!==String(flag)&&"2"!==String(flag)&&"42"!==String(flag)||(Layout.Page.container.find("#"+divId).find("#tssettings-schedule-label-name").text(ZPI18N.getString("zp.remindername")),Layout.Page.container.find("#"+divId).find("#tssettings-schedule-billing-row").hide()),Layout.Page.container.find("#"+divId).find("#zp_modal_blubtn").prop("disabled",!1),Layout.Page.container.find("#"+divId).find("#tssettings-dayofweek").hide(),Layout.Page.container.find("#"+divId).find("#tssettings-dayofmonth").hide(),isTSReminder?(Timetracker.schedulerReminderSettings.constructApplicableForReminder(),Timetracker.schedulerReminderSettings.populateOptions()):Timetracker.schedulerReminderSettings.constructApplicableFor(),Layout.Page.container.find("#tssettings-time").off("change").on("change",function(){Timetracker.schedulerReminderSettings.constAbsentSchedulerSummary(),AttendanceShift.frequencyOnChange()}),Layout.Page.container.find("#schDate").off("change").on("change",function(){Timetracker.schedulerReminderSettings.constAbsentSchedulerSummary()}),Timetracker.schedulerReminderSettings.editMode){var data=$.extend({},Timetracker.schedulerReminderSettings.editData,!0);if(-1!==Layout.Page.pageId.indexOf("attendance-settings-absentschedule")){$("#"+Layout.Page.pageId+" #tssettings-schdulename").val(ZPeople.decodeTxt(data.scheduleName)),$("#"+Layout.Page.pageId+" #tssettings-time").timepicker({defaultTime:Calendar.minstotime(data.time%1440),minuteStep:1}),$("#"+Layout.Page.pageId+" #schDate").select2("val",parseInt(data.time/1440)),0===parseInt(data.time/1440)&&($("#beforeCont").show(),$("#scheduleDateCont").html(ZPI18N.getString("zp.day")));var isNewV=data.unencodedSchedulerConf&&data.unencodedSchedulerConf.notifyThroughMail;if(isNewV&&data.unencodedSchedulerConf.templateIds&&(Timetracker.schedulerReminderSettings.tempArr=data.unencodedSchedulerConf.templateIds),(isNewV&&1==data.unencodedSchedulerConf.pushAbsentToLeave||!data.unencodedSchedulerConf||!isNewV&&0==data.unencodedSchedulerConf.pushAbsentToLeave)&&(Layout.Page.container.find("#ZPAtt_pushAbsentEntryCheck")[0].checked=!0),isNewV&&1==data.unencodedSchedulerConf.notifyThroughMail||!isNewV&&data.unencodedSchedulerConf&&1==data.unencodedSchedulerConf.pushAbsentToLeave){var templates=[];Layout.Page.container.find("#ZPAtt_notifyAbsentEntryCheck")[0].checked=!0,Layout.Page.container.find("#customise_template").show(),isNewV?$.each(data.unencodedSchedulerConf.notify,function(index,notify){index=parseInt(index);var initialSelection=[];if(notify.notifySpecificUsers){var notifySpecificUsers=notify.notifySpecificUsers;$.each(notifySpecificUsers,function(index,erecNo){var empDisName=data.empDetails[erecNo].dispName,results={};results.id=erecNo,results.text=ZPeople.decodeTxt(empDisName),results.html=empDisName,initialSelection[index]=results})}Attendance.Settings.addDaysConfigForAbsSch(index,initialSelection);var row=Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days .RotBox.zpnotfy[value="+index+"]");initialSelection.length>0&&(row.find("#ZPAtt_notifyAbsToNotSpec_"+index)[0].checked=!0),row.find("#ZPAtt_dayOptions").select2("val",index),notify.isNotifyEmployee&&(row.find("#ZPAtt_notifyAbsToEmp_"+index)[0].checked=!0),notify.isNotifyRepMan&&(row.find("#ZPAtt_notifyAbsToRepMan_"+index)[0].checked=!0),index<2?(Timetracker.schedulerReminderSettings.empSingleTempId=notify.cusEmpTempId?notify.cusEmpTempId:Timetracker.schedulerReminderSettings.empSingleTempId,Timetracker.schedulerReminderSettings.repSingleTempId=notify.repManTempId?notify.repManTempId:Timetracker.schedulerReminderSettings.repSingleTempId,Timetracker.schedulerReminderSettings.specSingleTempId=notify.specTempId?notify.specTempId:Timetracker.schedulerReminderSettings.specSingleTempId):(Timetracker.schedulerReminderSettings.empConsecTempId=notify.cusEmpTempId?notify.cusEmpTempId:Timetracker.schedulerReminderSettings.empConsecTempId,Timetracker.schedulerReminderSettings.repConsecTempId=notify.repManTempId?notify.repManTempId:Timetracker.schedulerReminderSettings.repConsecTempId,Timetracker.schedulerReminderSettings.specConsecTempId=notify.specTempId?notify.specTempId:Timetracker.schedulerReminderSettings.specConsecTempId)}):(Attendance.Settings.addDaysConfigForAbsSch(1),Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days .RotBox.zpnotfy[value=1]").find("#ZPAtt_notifyAbsMultiUser_1").val("").trigger("change"),Layout.Page.container.find("#ZPAtt_notifyAbsToEmp_1")[0].checked=!0,Layout.Page.container.find("#ZPAtt_notifyAbsToRepMan_1")[0].checked=!0),templates.push(Timetracker.schedulerReminderSettings.empSingleTempId),templates.push(Timetracker.schedulerReminderSettings.repSingleTempId),templates.push(Timetracker.schedulerReminderSettings.specSingleTempId),templates.push(Timetracker.schedulerReminderSettings.empConsecTempId),templates.push(Timetracker.schedulerReminderSettings.repConsecTempId),templates.push(Timetracker.schedulerReminderSettings.specConsecTempId),Timetracker.schedulerReminderSettings.loadTemplateMessagesForIds(templates)}Timetracker.schedulerReminderSettings.constAbsentSchedulerSummary()}else{var notifyData;if(Layout.Page.container.find("#"+divId).find("#tssettings-schdulename").val(ZPeople.decodeTxt(data.scheduleName)),"42"!==String(flag)&&Layout.Page.container.find("#"+divId).find("#tssettings-frequency").val(data.frequency),void 0==data.schedulerConf||"1"!==String(flag)&&"2"!==String(flag)?"1"!==String(flag)&&"2"!==String(flag)||(Layout.Page.container.find("#"+divId).find("#notifyToEmp")[0].checked=1,Layout.Page.container.find("#"+divId).find("#notifyToReporting")[0].checked=0,Layout.Page.container.find("#"+divId).find("#notifyToSEmp")[0].checked=0,Layout.Page.container.find("#"+divId).find("#TSnotSubmit")[0].checked=1,Layout.Page.container.find("#"+divId).find("#TLnotSubmit")[0].checked=1,Layout.Page.container.find("#TS_notifyWhenTSheet").find("#timeLimitToNotify").val(Calendar.minstohrs(0)),Layout.Page.container.find("#TS_notifyWhenTLog").find("#timeLimitToNotify").val(Calendar.minstohrs(0)),Timetracker.Search.populateUsers("notifyToSEmpUsers",null,{projectManagerPerm:!0,submode:"TIMETRACKER_SETTINGS"},!0)):(notifyData=JSON.parse(decodeHTML(data.schedulerConf)),Layout.Page.container.find("#"+divId).find("#notifyToEmp")[0].checked=parseInt(notifyData.isNotifyEmployee),Layout.Page.container.find("#"+divId).find("#notifyToReporting")[0].checked=parseInt(notifyData.isNotifyRepMan),0!=notifyData.notifySpecificUsers.length?(Layout.Page.container.find("#"+divId).find("#notifyToSEmp")[0].checked=1,Timetracker.Search.populateUsers("notifyToSEmpUsers",String(notifyData.notifySpecificUsers),{projectManagerPerm:!0,submode:"TIMETRACKER_SETTINGS"},!0)):(Layout.Page.container.find("#"+divId).find("#notifyToSEmp")[0].checked=0,Timetracker.Search.populateUsers("notifyToSEmpUsers",null,{projectManagerPerm:!0,submode:"TIMETRACKER_SETTINGS"},!0)),1==notifyData.notifyCondition?data.type==Timetracker.schedulerReminderSettings.TIMESHEET_REMINDER_TYPE?(Layout.Page.container.find("#"+divId).find("#TSlessSubmit")[0].checked=1,Layout.Page.container.find("#TS_notifyWhenTSheet").find("#timeLimitToNotify").val(Calendar.minstohrs(notifyData.minHrsReq))):(Layout.Page.container.find("#"+divId).find("#TLlessSubmit")[0].checked=1,Layout.Page.container.find("#TS_notifyWhenTLog").find("#timeLimitToNotify").val(Calendar.minstohrs(notifyData.minHrsReq))):data.type==Timetracker.schedulerReminderSettings.TIMESHEET_REMINDER_TYPE?(Layout.Page.container.find("#"+divId).find("#TSnotSubmit")[0].checked=1,Layout.Page.container.find("#TS_notifyWhenTSheet").find("#timeLimitToNotify").val(Calendar.minstohrs(0))):(Layout.Page.container.find("#"+divId).find("#TLnotSubmit")[0].checked=1,Layout.Page.container.find("#TS_notifyWhenTLog").find("#timeLimitToNotify").val(Calendar.minstohrs(0)))),"1"!==String(flag)&&"2"!==String(flag)&&"42"!==String(flag)||(data.type===Timetracker.schedulerReminderSettings.TIMESHEET_REMINDER_TYPE?Layout.Page.container.find("#"+divId).find("#tssettings-remindertype").val(0):data.type===Timetracker.schedulerReminderSettings.TIMELOG_REMINDER_TYPE?Layout.Page.container.find("#"+divId).find("#tssettings-remindertype").val(1):data.type===Timetracker.schedulerReminderSettings.TIMER_CUSTOM_REMINDER_TYPE&&Layout.Page.container.find("#"+divId).find("#tssettings-remindertype").val(42).trigger("change")),Layout.Page.container.find("#"+divId).find("#tssettings-time").timepicker("setTime",Calendar.minstotime(data.time)),Layout.Page.container.find("#"+divId).find("#tssettings-billstatus").val(data.billStatus||-1),"1"===String(data.frequency)?(Layout.Page.container.find("#"+divId).find("#tssettings-dayweek").val(data.day).select2(Timetracker.select2.getSelect2Properties()),Layout.Page.container.find("#"+divId).find("#tssettings-dayofweek").show(),Layout.Page.container.find("#"+divId).find("#tssettings-dayofweek .oeweek").show()):"2"===String(data.frequency)?(Layout.Page.container.find("#"+divId).find("#tssettings-daymonth").val(data.day).select2(Timetracker.select2.getSelect2Properties()),Layout.Page.container.find("#"+divId).find("#tssettings-dayofmonth").show()):"3"===String(data.frequency)&&(Layout.Page.container.find("#"+divId).find("#tssettings-dayweek").val(data.day).select2(Timetracker.select2.getSelect2Properties()),Layout.Page.container.find("#"+divId).find("#tssettings-dayofweek").show(),Layout.Page.container.find("#"+divId).find("#tssettings-dayofweek .oeweek").hide()),(isTSScheduler||isTSReminder)&&Timetracker.schedulerReminderSettings.changeTSfrequency(Layout.Page.container.find("#"+divId).find("#tssettings-frequency")[0],data),-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftrotation")){Layout.Page.container.find("#"+divId).find("#tssettings-time").timepicker("setTime",Calendar.minstotime(data.time%1440)),"1"===String(data.frequency)||"3"===String(data.frequency)?$("#"+Layout.Page.pageId+" #tssettings-dayweekCycleAffected").select2("val",parseInt(data.time/1440)+""):"2"===String(data.frequency)?$("#"+Layout.Page.pageId+" #tssettings-daymonthCycleAffected").select2("val",parseInt(data.time/1440)+""):$("#"+Layout.Page.pageId+" #shiftScheduleDate").val(parseInt(data.time/1440)),AttendanceShift.frequencyOnChange();var sch_Id=data.scheduleId;if(AttendanceShift.shiftRotList[sch_Id])AttendanceShift.shiftRotRowCons(!1,!1,!1,AttendanceShift.shiftRotList[sch_Id]);else{$("#"+Layout.Page.pageId+" #ZPAtt_shiftRotationBox").empty().append(ZPeople.LOADING_HTML);var params={mode:"getShiftRotation",conreqcsr:csrfToken,scheduleId:sch_Id};$.post("/AttendanceShiftAction.zp",params,function(rdata){$("#"+Layout.Page.pageId+" #ZPAtt_shiftRotationBox").empty(),AttendanceShift.shiftRotList[sch_Id]=rdata.list,AttendanceShift.shiftRotRowCons(!1,!1,!1,rdata.list)})}$("#"+Layout.Page.pageId+" #tssettings-addschdiv .modal-body").attr("class","modal-body ZPalert")}}isTSReminder?Timetracker.schedulerReminderSettings.updateEditOptions():Timetracker.schedulerReminderSettings.constructApplicableForEdit()}else $("#"+Layout.Page.pageId+" #tssettings-schdulename").trigger("focus"),-1!==Layout.Page.pageId.indexOf("attendance-settings-absentschedule")?($("#"+Layout.Page.pageId+" #tssettings-schdulename").val(""),$("#"+Layout.Page.pageId+" #tssettings-time").timepicker({defaultTime:"12:00 AM",minuteStep:1}),$("#"+Layout.Page.pageId+" #schDate").select2("val",1),-1!==Layout.Page.pageId.indexOf("attendance-settings-absentschedule")&&Timetracker.schedulerReminderSettings.constAbsentSchedulerSummary(),Layout.Page.container.find("#ZPAtt_pushAbsentEntryCheck")[0].checked=!0):(Layout.Page.container.find("#"+divId).find("#tssettings-frequency").val("0"),-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftrotation")&&($("#"+Layout.Page.pageId+" #shiftScheduleDate").val(1),$("#"+Layout.Page.pageId+" #ZPAtt_shiftRotationBox").empty(),AttendanceShift.shiftRotRowCons(),$("#"+Layout.Page.pageId+" #tssettings-addschdiv .modal-body").attr("class","modal-body ZPalert"),Layout.Page.container.find("#"+divId).find("#tssettings-frequency").val("1"),Timetracker.schedulerReminderSettings.changeTSfrequency(Layout.Page.container.find("#"+divId).find("#tssettings-frequency")[0]),AttendanceShift.frequencyOnChange()),(isTSScheduler||isTSReminder)&&Layout.Page.container.find("#"+divId).find("#tssettings-frequency").trigger("change"),Layout.Page.container.find("#"+divId).find("#tssettings-schdulename").val(""),Layout.Page.container.find("#"+divId).find("#tssettings-billstatus").val("-1"),Layout.Page.container.find("#"+divId).find("#tssettings-time").timepicker("remove"),Layout.Page.container.find("#"+divId).find("#tssettings-time").val("").timepicker()),"1"===String(flag)&&(Layout.Page.container.find("#"+divId).find("#tssettings-remindertype").val(1),Layout.Page.container.find("#"+divId).find("#TLnotSubmit")[0].checked=1,Layout.Page.container.find("#"+divId).find("#notifyToEmp")[0].checked=1,Layout.Page.container.find("#"+divId).find("#notifyToReporting")[0].checked=0,Layout.Page.container.find("#"+divId).find("#notifyToSEmp")[0].checked=0,Layout.Page.container.find("#"+divId).find("#TS_notifyWhenTSheet").find("#timeLimitToNotify").val(Calendar.minstohrs(0)),Layout.Page.container.find("#"+divId).find("#TSnotSubmit")[0].checked=1,Layout.Page.container.find("#"+divId).find("#TS_notifyWhenTLog").find("#timeLimitToNotify").val(Calendar.minstohrs(0)),Layout.Page.container.find("#"+divId).find("#TLnotSubmit")[0].checked=1,Timetracker.Search.populateUsers("notifyToSEmpUsers",null,{projectManagerPerm:!0,submode:"TIMETRACKER_SETTINGS"},!0),$("#"+Layout.Page.pageId+" #tssettings-schdulename").trigger("focus"));Layout.Page.container.find("#"+divId).find("#tssettings-frequency,#tssettings-remindertype,#tssettings-billstatus").select2({minimumResultsForSearch:1/0});var layout=Layout.Page.container.find("#"+divId);isTSReminder&&($('[data-toggle="popover"]').popover(),layout.find("#tssettings-remindertype").on("change",function(){Timetracker.schedulerReminderSettings.tsScheduleSummary(this),layout.find("#tssettings-remindertype").val()==Timetracker.schedulerReminderSettings.TIMER_CUSTOM_REMINDER_TYPE?(layout.find("#tssettings-frequency,#tssettings_processperiod,#tssettings-time,#notifyToReporting,#TLnotSubmit,#TSnotSubmit").closest(".form-group").hide(),Layout.Page.container.find("#"+divId).find("#tssettings-frequency").val(0)):(layout.find("#tssettings-frequency,#tssettings_processperiod,#tssettings-time,#notifyToReporting,#TLnotSubmit,#TSnotSubmit").closest(".form-group").show(),"1"==layout.find("#tssettings-remindertype").val()?(layout.find("#TS_notifyWhenTSheet").hide(),layout.find("#TS_notifyWhenTLog").show()):(layout.find("#TS_notifyWhenTSheet").show(),layout.find("#TS_notifyWhenTLog").hide()))}),layout.find("#notifyToSEmp").on("change",function(){layout.find("#notifyToSEmp").is(":checked")?layout.find("#notifEmpDiv").show():layout.find("#notifEmpDiv").hide()}),layout.find("#notifyToSEmp").trigger("change"),layout.find("#tssettings-remindertype").trigger("change"),layout.find("#ts_summary").find("input").off("change").on("change",function(){(Timetracker.schedulerReminderSettings.tsScheduleSummary(this),remindertype=layout.find("#tssettings-remindertype").val(),"1"===remindertype||1===remindertype)?0==Layout.Page.container.find("#TS_notifyWhenTLog").find("input:checked").val()?Layout.Page.container.find("#TS_notifyWhenTLog").find("#timeLimitToNotify").prop("disabled",!0):Layout.Page.container.find("#TS_notifyWhenTLog").find("#timeLimitToNotify").prop("disabled",!1):0==Layout.Page.container.find("#TS_notifyWhenTSheet").find("input:checked").val()?Layout.Page.container.find("#TS_notifyWhenTSheet").find("#timeLimitToNotify").prop("disabled",!0):Layout.Page.container.find("#TS_notifyWhenTSheet").find("#timeLimitToNotify").prop("disabled",!1)}),layout.find("#ts_summary").find("input").trigger("change")),(isTSScheduler||isTSReminder)&&(layout.find(".modal-footer").find("#cycle_details").remove(),layout.find(".modal-footer").append('<div class="label-message PPAltmsg label-note" id="cycle_details"><div class="MB10"><b>'+ZPI18N.getString("zp.summary")+'</b></div><p id="ts_schedule_summary"></p></div>'),layout.find(".modal-body").css("bottom","150px"),layout.find("#tssettings-frequency,#tssettings-dayweek,#tssettings-daymonth,.ts_sammaryTag").off("change").change(function(){Timetracker.schedulerReminderSettings.tsScheduleSummary(this)}),Timetracker.schedulerReminderSettings.tsScheduleSummary(layout))},constructApplicableFor:function(){var keys=[];keys.push(ZPPickList.CONSTANTS.ROLES),keys.push(ZPPickList.CONSTANTS.DEPARTMENTS),keys.push(ZPPickList.CONSTANTS.DESIGNATIONS),keys.push(ZPPickList.CONSTANTS.LOCATIONS),keys.push(ZPPickList.CONSTANTS.GROUPS),keys.push(ZPPickList.CONSTANTS.USERS),ZPPickList.loginUserNeed=!0;var isAllBtnOnly=!1;"attendance-settings-defaultpresence"!==Layout.Page.pageId&&"attendance-settings-absentschedule"!==Layout.Page.pageId&&"timetracker-settings-schedulersettings"!==Layout.Page.pageId&&"attendance-shiftmapping-shiftrotation"!==Layout.Page.pageId&&"timetracker-settings-remindersettings"!==Layout.Page.pageId||(isAllBtnOnly=!0),Layout.Page.container.find("#applicableToComponent").html(ZPPickList.init(keys,null,isAllBtnOnly)),Layout.Page.container.find("#applicableToComponent").find("#pickListComp").find(".dropdown-menu").addClass("ZPSchPoP")},constructApplicableForReminder:function(){APPLICABLEFORKEYS=[ZPPickList.CONSTANTS.ROLES,ZPPickList.CONSTANTS.DEPARTMENTS,ZPPickList.CONSTANTS.DESIGNATIONS,ZPPickList.CONSTANTS.LOCATIONS,ZPPickList.CONSTANTS.USERS,ZPPickList.CONSTANTS.GROUPS],ZPPickList.loginUserNeed=!0,ZPPickList.init(APPLICABLEFORKEYS,null,!0)},populateOptions:function(reminderId){var html=Layout.Page.container.find("#TSReminderApplicableFor");html.find("#appl").addClass("active"),html.find("#appl").siblings().removeClass("active"),html.find("#users_field #selectedempcount").text(""),Layout.Page.container.find("#selConditional").addClass("DN"),Layout.Page.container.find("#tsreminderexceptionDiv").addClass("DN"),Layout.Page.container.find("#tsreminderapplicableDiv").removeClass("DN"),Timetracker.schedulerReminderSettings.emptyDropdown(),Timetracker.schedulerReminderSettings.regApplicable(Layout.Page.container.find("#tsreminderapplicableDiv"),"appl"),Timetracker.schedulerReminderSettings.regApplicable(Layout.Page.container.find("#tsreminderexceptionDiv"),"except"),Timetracker.schedulerReminderSettings.populateApplicableOptions("location","loc",ZPPickList.allLocations),Timetracker.schedulerReminderSettings.populateApplicableOptions("designation","desg",ZPPickList.allDesignations),Timetracker.schedulerReminderSettings.populateApplicableOptions("department","dept",ZPPickList.allDepartments),Timetracker.schedulerReminderSettings.populateApplicableOptions("role","role",ZPPickList.allRoles),Timetracker.schedulerReminderSettings.populateApplicableOptions("group","group",ZPPickList.allGroups),Timetracker.schedulerReminderSettings.userInputSelect2(Layout.Page.container.find("#tsreminderexceptionDiv").find("input[name=users].except")),Timetracker.schedulerReminderSettings.userInputSelect2(Layout.Page.container.find("#tsreminderapplicableDiv").find("input[name=users].appl")),Timetracker.schedulerReminderSettings.appendSelect2(Layout.Page.container.find("#tsreminderapplicableDiv"),!0),Timetracker.schedulerReminderSettings.appendSelect2(Layout.Page.container.find("#tsreminderexceptionDiv")),Timetracker.schedulerReminderSettings.removeAllOption()},removeAllOption:function(){"0"===ZPPickList.allLocations[0].recID&&delete ZPPickList.allLocations[0],"0"===ZPPickList.allDesignations[0].recID&&delete ZPPickList.allDesignations[0],"0"===ZPPickList.allDepartments[0].recID&&delete ZPPickList.allDepartments[0],"0"===ZPPickList.allRoles[0].recID&&delete ZPPickList.allRoles[0],"0"===ZPPickList.allGroups[0].recID&&delete ZPPickList.allGroups[0]},emptyDropdown:function(){Layout.Page.container.find("#location_field select[name=location]").empty(),Layout.Page.container.find("#department_field select[name=department]").empty(),Layout.Page.container.find("#designation_field select[name=designation]").empty(),Layout.Page.container.find("#role_field select[name=role]").empty(),Layout.Page.container.find("#group_field select[name=group]").empty(),Layout.Page.container.find("select[name=selConditional]").empty()},appendSelect2:function(applicabletype,isappl){applicabletype.find("#location_field select[name=location]").val("").select2(),applicabletype.find("#department_field select[name=department]").val("").select2(),applicabletype.find("#designation_field select[name=designation]").val("").select2(),applicabletype.find("#role_field select[name=role]").val("").select2(),applicabletype.find("#group_field select[name=group]").val("").select2(),applicabletype.find("#users_field input[name=users]").select2("data",null)},regApplicable:function(modal,type){modal.children("div").removeClass("DN"),modal.find("."+type).on("change",function(){var name=$(this).attr("name"),data=$(this).select2("data"),arr=_.pluck(data,"id");1==arr.length&&"-1"==arr[0]||"-1"==_.last(arr)?$(this).select2("data",_.filter(data,function(obj){return"-1"==obj.id})):-1!=arr.indexOf("-1")&&$(this).select2("data",_.filter(data,function(obj){return"-1"!=obj.id}));var type=$(this).attr("class"),oppmodal=-1!=type.indexOf("appl")?Layout.Page.container.find("#tsreminderexceptionDiv"):Layout.Page.container.find("#tsreminderapplicableDiv"),oppType=-1!=type.indexOf("appl")?"except":"appl",oppEle=oppmodal.find("[name="+name+"]."+oppType);oppEle.parents(".zp-label").removeClass("DN"),"users"==name&&oppEle.parents(".zp-label").prev().removeClass("DN"),1==arr.length&&"0"==arr[0]||"0"==_.last(arr)?$(this).select2("data",_.filter(data,function(obj){return"0"==obj.id})):-1!=arr.indexOf("0")&&($(this).select2("data",_.filter(data,function(obj){return"0"!=obj.id})),oppEle.parents(".zp-label").addClass("DN"),"users"==name&&oppEle.parents(".zp-label").prev().addClass("DN")),arr.length>0&&($(this).is("input")?oppEle.select2("val",""):oppEle.select2("val",[]),oppEle.parents(".zp-label").addClass("DN"),"users"==name&&oppEle.parents(".zp-label").prev().addClass("DN"))})},populateApplicableOptions:function(tagname,type,options){var select=Layout.Page.container.find("#tsreminderapplicableDiv select[name="+tagname+"]"),selectalltextname="All";switch(tagname){case"location":selectalltextname=ZPI18N.getString("zp.alllocaction");break;case"department":selectalltextname=ZPI18N.getString("zp.alldepartment");break;case"designation":selectalltextname=ZPI18N.getString("zp.alldesignation");break;case"role":selectalltextname=ZPI18N.getString("zp.allroles");break;case"group":selectalltextname=ZPI18N.getString("zp.allgroups");break;default:selectalltextname="All"}options[0]={recName:selectalltextname,recID:"0"},$.each(options,function(indx,obj){$(select).append(ZP.create("option",{value:obj.recID,text:ZPeople.decodeTxt(obj.recName)}))});select=Layout.Page.container.find("#tsreminderexceptionDiv select[name="+tagname+"]");$.each(options,function(indx,obj){$(select).append(ZP.create("option",{value:obj.recID,text:ZPeople.decodeTxt(obj.recName)}))})},userInputSelect2:function(ele){var defaultValue={id:"0",text:ZPI18N.getString("zp.allemployees"),html:ZPI18N.getString("zp.allemployees")},eleId=$(ele).attr("id"),mode=$(ele).attr("searchmode")?$(ele).attr("searchmode"):"DATAVIEW",isMultiple=$(ele).attr("ismultiple");if(void 0==eleId||""==eleId){var maxIndx=0;$.each(Layout.Page.container.find("[id^="+Layout.Page.pageId+"_empsearch_]"),function(){var indx=$(this).attr("id").split("_")[2];maxIndx=Math.max(indx,maxIndx)}),eleId=Layout.Page.pageId+"_empsearch_"+(maxIndx+1),$(ele).attr("id",eleId)}var json={id:eleId,inpFormat:"select",isMultiple:isMultiple,initCurrentUser:!1,type:1,limit:10,searchMode:"TIMETRACKER_"+mode,searchType:"emp",defaultOption:defaultValue};"employee"===name&&isMultiple&&(json.initialSelection=null,json.defaultOption=null),ZPComponents.Search.reset(json,!0),ZPComponents.Search.create(json)},APPLICABLE_FOR_KEYS:["dept","desg","loc","role","user","group"],EXCEPTION_FOR_KEYS:["exceptdept","exceptdesg","exceptloc","exceptrole","exceptuser","exceptgroup"],constructApplicableForEdit:function(data){data||(data=$.extend({},Timetracker.schedulerReminderSettings.editData,!0)),-1!==data.role.indexOf("0")?(ZPPickList.allRolesSelected=!0,ZPPickList.setSelectedRoles(Object.keys(ZPPickList.allRoles))):ZPPickList.setSelectedRoles($.extend([],data.role,!0)),-1!==data.dept.indexOf("0")?(ZPPickList.allDepartmentsSelected=!0,ZPPickList.setSelectedDepartments(Object.keys(ZPPickList.allDepartments))):ZPPickList.setSelectedDepartments($.extend([],data.dept,!0)),-1!==data.desg.indexOf("0")?(ZPPickList.allDesignationsSelected=!0,ZPPickList.setSelectedDesignations(Object.keys(ZPPickList.allDesignations))):ZPPickList.setSelectedDesignations($.extend([],data.desg,!0)),-1!==data.loc.indexOf("0")?(ZPPickList.allLocationsSelected=!0,ZPPickList.setSelectedLocations(Object.keys(ZPPickList.allLocations))):ZPPickList.setSelectedLocations($.extend([],data.loc,!0)),-1!==data.group.indexOf("0")?(ZPPickList.allGroupsSelected=!0,ZPPickList.setSelectedGroups(ZPPickList.allGroups)):ZPPickList.setSelectedGroups($.extend([],data.group,!0)),-1!==data.user.indexOf("0")?(ZPPickList.allUsersSelected=!0,ZPPickList.setSelectedUsers(ZPPickList.allUsersObj)):ZPPickList.setSelectedUsers($.extend([],data.user,!0))},showAutoScheduleModify:function(obj,flag,scheduleType){var data=$(obj).parent().data();void 0!==flag&&(data=$(obj).parents(":nth(2)").data()),Timetracker.schedulerReminderSettings.editMode=!0,Timetracker.schedulerReminderSettings.editData=data,Timetracker.schedulerReminderSettings.showCommonCodeForScheduleAndReminderAddEditPage(scheduleType)},tsScheduleSummary:function(obj){var layout=void 0!==$(obj).attr("id")&&$(obj).attr("id")===Timetracker.schedulerReminderSettings.tabId?obj:$(obj).parents("#"+Timetracker.schedulerReminderSettings.tabId);if(0!==layout.find("#ts_schedule_summary").length){Layout.Page.pageId.indexOf("timetracker-settings-schedulersettings");var condStatement,isTSReminder=-1!==Layout.Page.pageId.indexOf("timetracker-settings-remindersettings"),atTime=layout.find("#tssettings-time").val(),hrs=atTime.split(/(\s+)/)[0],ampm=atTime.split(/(\s+)/)[2].toLowerCase(),frequency=(Calendar.timetomins(hrs,0,ampm),layout.find("#tssettings-frequency").val()),process_period=layout.find("#tssettings_processperiod").val();process_period=parseInt(process_period);var summary="";if(isTSReminder){var remType=layout.find("#tssettings-remindertype").val(),regexForValidation=Timetracker.util.maxWeekHrsRegex;if("1"==remType){var condition=layout.find("#TS_notifyWhenTLog").find("input:checked").val();(minh=layout.find("#TS_notifyWhenTLog").find("#timeLimitToNotify").val()).match(regexForValidation)||(minh="00:00",layout.find("#TS_notifyWhenTLog").find("#timeLimitToNotify").val(minh)),condStatement=0==condition?ZPI18N.getString("zp.notloggedtime"):ZPI18N.getString("zp.loggedlessthan",[minh])+" "+ZPI18N.getString("zp.shours")}else{if("42"==remType)return summary=ZPI18N.getString("zp.timercustomreminderhelpnote"),void layout.find("#ts_schedule_summary").html(summary);var minh;condition=layout.find("#TS_notifyWhenTSheet").find("input:checked").val();(minh=layout.find("#TS_notifyWhenTSheet").find("#timeLimitToNotify").val()).match(regexForValidation)||(minh="00:00",layout.find("#TS_notifyWhenTLog").find("#timeLimitToNotify").val(minh)),condStatement=0==condition?ZPI18N.getString("zp.notsubmittedtimesheet"):ZPI18N.getString("zp.submittedlessthan",[minh])+" "+ZPI18N.getString("zp.hoursforapproval")}}if("0"===frequency)summary=process_period>1?isTSReminder?ZPI18N.getString("zp.tsreminderdaybeforesummary",[ZPeople.escapeHtml(atTime),condStatement,process_period]):ZPI18N.getString("zp.tsschddaybeforesummary",[process_period,ZPeople.escapeHtml(atTime)]):1===process_period?isTSReminder?ZPI18N.getString("zp.tsreminderdayyestsummary",[ZPeople.escapeHtml(atTime),condStatement]):ZPI18N.getString("zp.tsschdayyestsummary",[ZPeople.escapeHtml(atTime)]):isTSReminder?ZPI18N.getString("zp.tsreminderdaycurrsummary",[ZPeople.escapeHtml(atTime),condStatement]):ZPI18N.getString("zp.tsschdaycurrsummary",[ZPeople.escapeHtml(atTime)]);else if("1"===frequency){var sch_day=layout.find("#tssettings-dayweek").val();if(sch_day=parseInt(sch_day),0===process_period)summary=isTSReminder?ZPI18N.getString("zp.tsreminderweeklastsummary",[Timetracker.DateTime.getDayOfWeek(sch_day),ZPeople.escapeHtml(atTime),condStatement]):ZPI18N.getString("zp.tsschweeklastsummary",[Timetracker.DateTime.getDayOfWeek(sch_day),ZPeople.escapeHtml(atTime)]);else if(1===process_period)summary=isTSReminder?ZPI18N.getString("zp.tsreminderweekcurrsummary",[Timetracker.DateTime.getDayOfWeek(sch_day),ZPeople.escapeHtml(atTime),condStatement]):ZPI18N.getString("zp.tsschweekcurrsummary",[Timetracker.DateTime.getDayOfWeek(sch_day),ZPeople.escapeHtml(atTime)]);else if(2===process_period){var process_period_to=layout.find("#tssettings_processperiod_custom").find("#to_day").val(),process_period_from=6===(process_period_to=parseInt(process_period_to))?0:process_period_to+1;summary=isTSReminder?ZPI18N.getString("zp.tsreminderweekcustsummary",[Timetracker.DateTime.getDayOfWeek(sch_day),ZPeople.escapeHtml(atTime),condStatement,Timetracker.DateTime.getDayOfWeek(process_period_from),Timetracker.DateTime.getDayOfWeek(process_period_to)]):ZPI18N.getString("zp.tsschweekcustsummary",[Timetracker.DateTime.getDayOfWeek(process_period_from),Timetracker.DateTime.getDayOfWeek(process_period_to),Timetracker.DateTime.getDayOfWeek(sch_day),ZPeople.escapeHtml(atTime)])}}else if("2"===frequency){sch_day=layout.find("#tssettings-daymonth").val();if(sch_day=parseInt(sch_day),0===process_period)summary=isTSReminder?ZPI18N.getString("zp.tsremindermonlastsummary",[Timetracker.DateTime.getDayOfMonth(sch_day,!0),ZPeople.escapeHtml(atTime),condStatement]):ZPI18N.getString("zp.tsschmonlastsummary",[Timetracker.DateTime.getDayOfMonth(sch_day,!0),ZPeople.escapeHtml(atTime)]);else if(1===process_period)summary=isTSReminder?ZPI18N.getString("zp.tsremindermoncurrsummary",[Timetracker.DateTime.getDayOfMonth(sch_day,!0),ZPeople.escapeHtml(atTime),condStatement]):ZPI18N.getString("zp.tsschmoncurrsummary",[Timetracker.DateTime.getDayOfMonth(sch_day,!0),ZPeople.escapeHtml(atTime)]);else if(2===process_period){process_period_to=layout.find("#tssettings_processperiod_custom").find("#to_day").val(),process_period_from=31===(process_period_to=parseInt(process_period_to))||32===process_period_to?1:process_period_to+1;summary=isTSReminder?ZPI18N.getString(31===process_period_to||32===process_period_to?"zp.tsremindermoncustcurrsummary":"zp.tsremindermoncustsummary",[Timetracker.DateTime.getDayOfMonth(sch_day,!0),ZPeople.escapeHtml(atTime),condStatement,Timetracker.DateTime.getDayOfMonth(process_period_from,!0),Timetracker.DateTime.getDayOfMonth(process_period_to,!0)]):ZPI18N.getString(31===process_period_to||32===process_period_to?"zp.tsschmoncustcurrsummary":"zp.tsschmoncustsummary",[Timetracker.DateTime.getDayOfMonth(process_period_from,!0),Timetracker.DateTime.getDayOfMonth(process_period_to,!0),Timetracker.DateTime.getDayOfMonth(sch_day,!0),ZPeople.escapeHtml(atTime)])}}layout.find("#ts_schedule_summary").html(summary)}},changeTSfrequency:function(obj,scheduleInfo){var outerAddLayoutId=Layout.Page.container.find("#"+Timetracker.schedulerReminderSettings.tabId);outerAddLayoutId.find("#tssettings-dayofweek").hide(),outerAddLayoutId.find("#tssettings-dayofmonth").hide(),"1"===$(obj).val()?(outerAddLayoutId.find("#tssettings-dayweek").select2(Timetracker.select2.getSelect2Properties()),outerAddLayoutId.find("#tssettings-dayofweek").show(),outerAddLayoutId.find("#tssettings-dayofweek .oeweek").show()):"2"===$(obj).val()?(outerAddLayoutId.find("#tssettings-daymonth").select2(Timetracker.select2.getSelect2Properties()),outerAddLayoutId.find("#tssettings-dayofmonth").show()):"3"===$(obj).val()&&(outerAddLayoutId.find("#tssettings-dayweek").select2(Timetracker.select2.getSelect2Properties()),outerAddLayoutId.find("#tssettings-dayofweek").show(),outerAddLayoutId.find("#tssettings-dayofweek .oeweek").hide());var isTSScheduler=-1!==Layout.Page.pageId.indexOf("timetracker-settings-schedulersettings"),isTSReminder=-1!==Layout.Page.pageId.indexOf("timetracker-settings-remindersettings");if(isTSScheduler||isTSReminder){var options,process_period_select=outerAddLayoutId.find("div#tssettings_processperiod_layout").find("select#tssettings_processperiod");if("1"===$(obj).val())options='<option value="0">'+ZPI18N.getString("zp.prevweek")+'</option><option value="1">'+ZPI18N.getString("zp.currentweek")+'</option><option value="2">'+ZPI18N.getString("zp.customweek")+"</option>";else if("2"===$(obj).val())options='<option value="0">'+ZPI18N.getString("zp.prevmonth")+'</option><option value="1">'+ZPI18N.getString("zp.thismonth")+'</option><option value="2">'+ZPI18N.getString("zp.custommonth")+"</option>";else{options='<option value="0">'+ZPI18N.getString("zp.currentday")+"</option>";for(var i=1;i<6;i++)options+='<option value="'+i+'">'+i+" "+(1===i?ZPI18N.getString("zp.daybefore",[""]):ZPI18N.getString("zp.daysbefore",[""]))+"</option>"}process_period_select.html(options),process_period_select.siblings().remove();var process_period="0";if(scheduleInfo&&(process_period="1"===$(obj).val()||"2"===$(obj).val()?"2":"0",scheduleInfo.schedulerConf)){var conf=JSON.parse(decodeHTML(scheduleInfo.schedulerConf));conf&&void 0!==conf.process_period&&(process_period=""+conf.process_period)}process_period_select.off("change").on("change",function(){Timetracker.schedulerReminderSettings.onProcessPeriodChange(this,scheduleInfo),Timetracker.schedulerReminderSettings.tsScheduleSummary(this)}),process_period_select.val(process_period).select2(Timetracker.select2.getSelect2Properties(!1,{noSearch:!0})),process_period_select.trigger("change")}},onProcessPeriodChange:function(obj,scheduleInfo){var outer_layout=$(obj).parents("#"+Timetracker.schedulerReminderSettings.tabId),process_period=$(obj).val(),process_period_layout=outer_layout.find("div#tssettings_processperiod_layout"),frequency=outer_layout.find("#tssettings-frequency").val();if(process_period_layout.find("#tssettings_processperiod_custom").remove(),("1"===frequency||"2"===frequency)&&"2"===process_period){var custom_period_layout=$('<div id="tssettings_processperiod_custom"><div class="Almil" style="border: none !important"><label class="MR5">'+ZPI18N.getString("zp.from")+'</label> <select id="from_day" class="W120" disabled></select><span id="from_range_span" class="ML2" style="color:#858585"></span></div><div class="Almil" style="border: none !important"><label class="MR5">'+ZPI18N.getString("zp.to")+'</label> <select id="to_day" class="W120"></select><span id="to_range_span" class="ML2" style="color:#858585"></span></div></div>'),from_range_span=" "+ZPI18N.getString("zp.soflastweek"),to_range_span=" "+ZPI18N.getString("zp.sofcurrentweek"),options=Timetracker.DateTime.constructDayOfWeekOptions(),process_period_to=outer_layout.find("select#tssettings-dayweek").val()||"0";if("2"==frequency&&(from_range_span=" "+ZPI18N.getString("zp.soflastmonth"),to_range_span=" "+ZPI18N.getString("zp.sofcurrentmonth"),options=Timetracker.DateTime.constructDayOfMonthOptions(32),process_period_to=outer_layout.find("select#tssettings-daymonth").val()||"1"),scheduleInfo&&scheduleInfo.schedulerConf){var conf=JSON.parse(decodeHTML(scheduleInfo.schedulerConf));conf&&void 0!==conf.process_period_to&&(process_period_to=""+conf.process_period_to)}custom_period_layout.find("#from_range_span").text(from_range_span),custom_period_layout.find("#to_range_span").text(to_range_span),custom_period_layout.find("#from_day,#to_day").html(options),process_period_layout.append(custom_period_layout),(custom_period_layout=process_period_layout.find("#tssettings_processperiod_custom")).find("#to_day").off("change").on("change",function(){Timetracker.schedulerReminderSettings.onProcessPeriodCustomDateChange(this,frequency),Timetracker.schedulerReminderSettings.tsScheduleSummary(this)}),custom_period_layout.find("#to_day").val(process_period_to).select2(Timetracker.select2.getSelect2Properties(!1,{noSearch:!0})),custom_period_layout.find("#to_day").trigger("change")}},onProcessPeriodCustomDateChange:function(obj,frequency){var outer_layout=$(obj).parents("#"+Timetracker.schedulerReminderSettings.tabId),process_period_to=$(obj).val(),custom_process_period_layout=outer_layout.find("div#tssettings_processperiod_custom"),process_period_from="6"===process_period_to?"0":""+(parseInt(process_period_to)+1);"2"===frequency&&(process_period_from="31"===process_period_to||"32"===process_period_to?"1":""+(parseInt(process_period_to)+1),custom_process_period_layout.find("#from_range_span").text(" "+ZPI18N.getString("1"===process_period_from?"zp.sofcurrentmonth":"zp.soflastmonth"))),custom_process_period_layout.find("#from_day").val(process_period_from).select2(Timetracker.select2.getSelect2Properties(!1,{noSearch:!0}))},updateTimerReminderSettings:function(params){if(!Timetracker.schedulerReminderSettings.editMode&&Timetracker.schedulerReminderSettings.reminderObj){var isCustomReminderExist=!1;Timetracker.schedulerReminderSettings.reminderObj.forEach(remdObj=>{if(remdObj&&remdObj.type===Timetracker.schedulerReminderSettings.TIMER_CUSTOM_REMINDER_TYPE)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.timercustomremindererrormsg")),void(isCustomReminderExist=!0)})}isCustomReminderExist||(Timetracker.schedulerReminderSettings.reminderObj=null,Timetracker.schedulerReminderSettings.editMode&&(params.mode="modifyAutoSchedule",params.scheduleId=Timetracker.schedulerReminderSettings.editData.scheduleId),params.type=Timetracker.schedulerReminderSettings.TIMER_CUSTOM_REMINDER_TYPE,$.post(Timetracker.constants.URL,params,function(){var message=Timetracker.schedulerReminderSettings.editMode?ZPI18N.getString("zp.remedited"):ZPI18N.getString("zp.remconfig");ZPeople.Message.showSuccessMsg(message),ZPeople.BSModal.hide(Timetracker.schedulerReminderSettings.tabId),Timetracker.schedulerReminderSettings.getAutoSchedule()}))},updateScheduleSettings:function(){var outerAddLayoutId=Layout.Page.container.find("#"+Timetracker.schedulerReminderSettings.tabId);outerAddLayoutId.find("#zp_modal_blubtn").prop("disabled",!0),-1!==Layout.Page.pageId.indexOf("attendance-settings-absentschedule")?(Timetracker.util.removeErrorMsg("ZPAtt_addPopup"),outerAddLayoutId=$("#"+Layout.Page.pageId).find("#ZPAtt_addPopup")):Timetracker.util.removeErrorMsg(Timetracker.schedulerReminderSettings.tabId);var isTSScheduler=-1!==Layout.Page.pageId.indexOf("timetracker-settings-schedulersettings"),isTSReminder=-1!==Layout.Page.pageId.indexOf("timetracker-settings-remindersettings"),scheduleName=outerAddLayoutId.find("#tssettings-schdulename").val(),frequency=outerAddLayoutId.find("#tssettings-frequency").val(),remindertype=outerAddLayoutId.find("#tssettings-remindertype").val(),dayofweek=outerAddLayoutId.find("#tssettings-dayweek").val(),dayofmonth=outerAddLayoutId.find("#tssettings-daymonth").val(),time=outerAddLayoutId.find("#tssettings-time").val(),billstatus=outerAddLayoutId.find("#tssettings-billstatus").val();if(""===scheduleName.trim()){var errorStr=ZPI18N.getString("zp.cannotbeempty",[ZPI18N.getString("zp.schedulename")]);return"timetracker/settings/remindersettings"===Layout.Page.currentmode&&(errorStr=ZPI18N.getString("zp.cannotbeempty",[ZPI18N.getString("zp.remindername")])),outerAddLayoutId.find("#tssettings-schdulename").parent().append('<div class="error-msg">'+errorStr+"</div>"),Layout.Page.container.find("#ZPAtt_addPopup .modal-body").animate({scrollTop:0}),outerAddLayoutId.find("#zp_modal_blubtn").prop("disabled",!1),!1}if(""===time.trim()){var element=outerAddLayoutId.find("#tssettings-time").parent();return Timetracker.util.appendErrorMsg({obj:element,msg:ZPI18N.getString("zp.entervalidtime")}),element[0].scrollIntoView({behavior:"smooth"}),outerAddLayoutId.find("#zp_modal_blubtn").prop("disabled",!1),!1}var hrs=time.split(/(\s+)/)[0],ampm=time.split(/(\s+)/)[2].toLowerCase();time=Calendar.timetomins(hrs,0,ampm);var params={mode:"createAutoSchedule",scheduleName:scheduleName,type:Timetracker.schedulerReminderSettings.TIMESHEET_SCHEDULER_TYPE,conreqcsr:csrfToken},applicableCompId="applicableToComponent";if("timetracker/settings/remindersettings"===Layout.Page.currentmode){var applicableFor={};Timetracker.schedulerReminderSettings.getApplData(applicableFor,!0);var exceptFor={};Timetracker.schedulerReminderSettings.getApplData(exceptFor,!1),params.isValid=!0,Timetracker.schedulerReminderSettings.validateAppForReminder(applicableFor,exceptFor,params),params.appfor=JSON.stringify(applicableFor),params.exceptfor=JSON.stringify(exceptFor),applicableCompId="TSReminderApplicableFor"}else params=Timetracker.schedulerReminderSettings.returnParamsForRoleDeptDesignationForSchedules(params);if(params.isAllCriteriaNull)return(element=outerAddLayoutId.find("#"+applicableCompId)).append('<div class="error-msg">'+ZPI18N.getString("zp.appforempty")+"</div>"),Layout.Page.container.find("#ZPAtt_addPopup .modal-body").animate({scrollTop:element.position().top}),outerAddLayoutId.find("#zp_modal_blubtn").prop("disabled",!1),!1;if(remindertype==Timetracker.schedulerReminderSettings.TIMER_CUSTOM_REMINDER_TYPE&&isTSReminder)Timetracker.schedulerReminderSettings.updateTimerReminderSettings(params);else{params.frequency=frequency,params.time=time.tottime,params.billstatus=billstatus;var day,pushConfig={};if("timetracker/settings/remindersettings"===Layout.Page.currentmode){var layout;if(params.type=Timetracker.schedulerReminderSettings.TIMESHEET_REMINDER_TYPE,"1"===remindertype||1===remindertype?(params.type=Timetracker.schedulerReminderSettings.TIMELOG_REMINDER_TYPE,layout=Layout.Page.container.find("#TS_notifyWhenTLog"),pushConfig.notifyCondition=parseInt(layout.find("input:checked").val())):(layout=Layout.Page.container.find("#TS_notifyWhenTSheet"),pushConfig.notifyCondition=parseInt(layout.find("input:checked").val())),1==pushConfig.notifyCondition){pushConfig.minHrsReq=layout.find("#timeLimitToNotify").val();var regexForValidation=Timetracker.util.maxWeekHrsRegex;if(!pushConfig.minHrsReq.match(regexForValidation))return layout.find("#timeLimitToNotify").addClass("error-clr"),layout.find("#timeLimitToNotify").closest("label").append('<div class="error-msg">'+ZPI18N.getString("zp.entervalidinput")+"</div>"),!1;pushConfig.minHrsReq=Timetracker.DateTime.convertToMins(pushConfig.minHrsReq)}pushConfig.isNotifyEmployee=0|Layout.Page.container.find("#notifyToEmp")[0].checked,pushConfig.isNotifyRepMan=0|Layout.Page.container.find("#notifyToReporting")[0].checked;var users=Layout.Page.container.find("#notifyToSEmpUsers").val().split(",");if(pushConfig.notifySpecificUsers=""!=users[0]&&Layout.Page.container.find("#notifyToSEmp")[0].checked?users:[],pushConfig.isNotifyEmployee+pushConfig.isNotifyRepMan+(0|Layout.Page.container.find("#notifyToSEmp")[0].checked)<1)return outerAddLayoutId.find("#notifEmpDiv").parent().append('<div class="error-msg">'+ZPI18N.getString("zp.maperror",["options"])+"</div>"),!1;params.pushConfig=JSON.stringify(pushConfig)}"1"===frequency||"3"===frequency?day=params.dayofweek=dayofweek:"2"===frequency&&(day=params.dayofmonth=dayofmonth);var process_period_config={};if(isTSScheduler||isTSReminder){var process_period=outerAddLayoutId.find("select#tssettings_processperiod").val();if(process_period=parseInt(""+process_period),"0"===frequency)process_period>=0&&process_period<6&&(process_period_config.process_period=process_period);else if("1"===frequency){if(0!==process_period&&1!==process_period&&2!==process_period||(process_period_config.process_period=process_period),2===process_period){var process_period_to=outerAddLayoutId.find("div#tssettings_processperiod_custom").find("#to_day").val();(process_period_to=parseInt(""+process_period_to))>=0&&process_period_to<7&&(process_period_config.process_period_to=process_period_to)}}else if("2"===frequency&&(0!==process_period&&1!==process_period&&2!==process_period||(process_period_config.process_period=process_period),2===process_period)){process_period_to=outerAddLayoutId.find("div#tssettings_processperiod_custom").find("#to_day").val();(process_period_to=parseInt(""+process_period_to))>=0&&process_period_to<=32&&(process_period_config.process_period_to=process_period_to)}params.process_period_config=JSON.stringify(process_period_config)}if(Timetracker.schedulerReminderSettings.editMode&&(params.mode="modifyAutoSchedule",params.scheduleId=Timetracker.schedulerReminderSettings.editData.scheduleId),-1===Layout.Page.pageId.indexOf("attendance-settings-absentschedule")&&-1===Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftrotation")){var isValid=!0;if(Timetracker.schedulerReminderSettings.editMode){var schedule_conf=void 0!=Timetracker.schedulerReminderSettings.editData.schedulerConf?JSON.parse(decodeHTML(Timetracker.schedulerReminderSettings.editData.schedulerConf)):{};params.scheduleName!=Timetracker.schedulerReminderSettings.editData.scheduleName||params.frequency!=Timetracker.schedulerReminderSettings.editData.frequency||void 0!==day&&day!=Timetracker.schedulerReminderSettings.editData.day||params.time!=Timetracker.schedulerReminderSettings.editData.time||params.billstatus!=Timetracker.schedulerReminderSettings.editData.billStatus||params.type!=Timetracker.schedulerReminderSettings.editData.type||params.isValid||schedule_conf.notifyCondition!=pushConfig.notifyCondition||schedule_conf.isNotifyEmployee!=pushConfig.isNotifyEmployee||schedule_conf.isNotifyRepMan!=pushConfig.isNotifyRepMan||!_.isEqual(schedule_conf.notifySpecificUsers,pushConfig.notifySpecificUsers)||schedule_conf.process_period!==process_period_config.process_period||schedule_conf.process_period_to!==process_period_config.process_period_to||(1==pushConfig.notifyCondition?schedule_conf.minHrsReq==pushConfig.minHrsReq&&(isValid=!1):isValid=!1)}isValid?(delete params.isValid,"timetracker/settings/remindersettings"===Layout.Page.currentmode?Timetracker.schedulerReminderSettings.reminderObj=null:Timetracker.schedulerReminderSettings.scheduleObj=null,$.post(Timetracker.constants.URL,params,function(){var message=Timetracker.schedulerReminderSettings.editMode?ZPI18N.getString("zp.schededited"):ZPI18N.getString("zp.schedconfiged");"timetracker/settings/remindersettings"===Layout.Page.currentmode&&(message=Timetracker.schedulerReminderSettings.editMode?ZPI18N.getString("zp.remedited"):ZPI18N.getString("zp.remconfig")),ZPeople.Message.showSuccessMsg(message),ZPeople.BSModal.hide(Timetracker.schedulerReminderSettings.tabId),Timetracker.schedulerReminderSettings.getAutoSchedule()})):(ZPeople.BSModal.hide(Timetracker.schedulerReminderSettings.tabId),ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.nochangesmade")))}else if(-1!==Layout.Page.pageId.indexOf("attendance-shiftmapping-shiftrotation")){delete params.isValid,delete params.type;var schDate,schTime=$("#"+Layout.Page.pageId).find("#tssettings-time").val();12===(schMinz=parseInt(schTime.split(":")[0],10))&&(schMinz=0),schtime=60*schMinz+parseInt(schTime.split(":")[1].split(" ")[0],10),"PM"===schTime.split(":")[1].split(" ")[1]&&(schtime+=720),""===(schDate=$("#"+Layout.Page.pageId).find("#tssettings-dayweekCycleAffected").parent().is(":visible")?$("#"+Layout.Page.pageId).find("#tssettings-dayweekCycleAffected").val():$("#"+Layout.Page.pageId).find("#tssettings-daymonthCycleAffected").parent().is(":visible")?$("#"+Layout.Page.pageId).find("#tssettings-daymonthCycleAffected").val():$("#"+Layout.Page.pageId).find("#shiftScheduleDate").val().trim())&&(schDate=0),params.time=schtime+24*parseInt(schDate)*60;var rotationObj={};if($.each($("#"+Layout.Page.pageId+" #ZPAtt_shiftRotationBox").children(),function(index,data){var select=$(data).find("select");null!==select.eq(0).val()&&null!==select.eq(1).val()&&select.eq(0).val()!==select.eq(1).val()?rotationObj[$(data).index()]=select.eq(0).val()+"_"+select.eq(1).val():rotationObj={}}),0===Object.keys(rotationObj).length)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.rotfieldshouldnotempty"));params.shiftRotation=JSON.stringify(rotationObj),"createAutoSchedule"===params.mode?params.mode="createShiftSchedule":"modifyAutoSchedule"===params.mode&&(params.mode="modifyShiftSchedule"),Layout.Page.container.find("#tssettings-addschdiv").find("#zp_modal_blubtn").prop("disabled",!0),$.post("/AttendanceShiftAction.zp",params,function(){Layout.Page.container.find("#tssettings-addschdiv").find("#zp_modal_blubtn").prop("disabled",!1),AttendanceShift.shiftRotList={},AttendanceShift.getShiftRotationList(),AttendanceShift.toggleAddNewPopUp()})}else{delete params.isValid,delete params.type;var schMinz;schTime=$("#"+Layout.Page.pageId).find("#tssettings-time").val();12===(schMinz=parseInt(schTime.split(":")[0],10))&&(schMinz=0);var schtime=60*schMinz+parseInt(schTime.split(":")[1].split(" ")[0],10);"PM"===schTime.split(":")[1].split(" ")[1]&&(schtime+=720),params.time=schtime+24*parseInt($("#"+Layout.Page.pageId).find("#schDate").val())*60,"createAutoSchedule"===params.mode?params.mode="createAbsentSchedule":"modifyAutoSchedule"===params.mode&&(params.mode="modifyAbsentSchedule");var pushAbsConfig={},templateArr=[];if(pushAbsConfig.pushAbsentToLeave=0,Layout.Page.container.find("#ZPAtt_pushAbsentEntryCheck")[0].checked&&(pushAbsConfig.pushAbsentToLeave=1),pushAbsConfig.notifyThroughMail=0,Layout.Page.container.find("#ZPAtt_notifyAbsentEntryCheck")[0].checked){var emptyDate,notify={};if(Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days .RotBox.zpnotfy").each(function(index){var temp={},isDataAdded=!1,row=$(Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days .RotBox.zpnotfy")[index]),day=row.attr("value");if(row.find("#ZPAtt_notifyAbsToEmp_"+day)[0].checked&&(isDataAdded=temp.isNotifyEmployee=!0,"1"===day&&"0"!==Timetracker.schedulerReminderSettings.empSingleTempId?(temp.cusEmpTempId=Timetracker.schedulerReminderSettings.empSingleTempId,templateArr.push(temp.cusEmpTempId)):"1"!==day&&"0"!==Timetracker.schedulerReminderSettings.empConsecTempId&&(temp.cusEmpTempId=Timetracker.schedulerReminderSettings.empConsecTempId,templateArr.push(temp.cusEmpTempId))),row.find("#ZPAtt_notifyAbsToRepMan_"+day)[0].checked&&(isDataAdded=temp.isNotifyRepMan=!0,"1"===day&&"0"!==Timetracker.schedulerReminderSettings.repSingleTempId?(temp.repManTempId=Timetracker.schedulerReminderSettings.repSingleTempId,templateArr.push(temp.repManTempId)):"1"!==day&&"0"!==Timetracker.schedulerReminderSettings.repConsecTempId&&(temp.repManTempId=Timetracker.schedulerReminderSettings.repConsecTempId,templateArr.push(temp.repManTempId))),row.find("#ZPAtt_notifyAbsToNotSpec_"+day)[0].checked&&""!==row.find("#ZPAtt_notifyAbsMultiUser_"+day).val()&&(temp.notifySpecificUsers=Layout.Page.container.find("#ZPAtt_notifyAbsMultiUser_"+day).val().split(","),isDataAdded=!0,"1"===day&&"0"!==Timetracker.schedulerReminderSettings.specSingleTempId?(temp.specTempId=Timetracker.schedulerReminderSettings.specSingleTempId,templateArr.push(temp.specTempId)):"1"!==day&&"0"!==Timetracker.schedulerReminderSettings.specConsecTempId&&(temp.specTempId=Timetracker.schedulerReminderSettings.specConsecTempId,templateArr.push(temp.specTempId))),!isDataAdded)return emptyDate=day,!1;notify[day]=temp}),void 0!==emptyDate)return Layout.Page.container.find("#ZPAtt_notifyAbsMultiUser_"+emptyDate).parent().append('<div class="error-msg W100 FL">'+ZPI18N.getString("zp.selectaction")+"</div>"),Layout.Page.container.find("#ZPAtt_addPopup .modal-body").animate({scrollTop:Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days .RotBox.zpnotfy[value="+emptyDate+"]").position().top+160}),!1;pushAbsConfig.notify=notify,0!==templateArr.length&&(pushAbsConfig.templateIds=templateArr),0!==Timetracker.schedulerReminderSettings.tempArr.length&&$.post("/AttendanceSettingsAction.zp",{mode:"deleteTemplates",oldTemplates:JSON.stringify(Timetracker.schedulerReminderSettings.tempArr),newTemplates:JSON.stringify(templateArr),conreqcsr:csrfToken},function(rdata){}),pushAbsConfig.notifyThroughMail=1}else if(0===pushAbsConfig.pushAbsentToLeave)return Layout.Page.container.find("#ZPAtt_notifyAbsentEntryCheck").parent().append('<div class="error-msg">'+ZPI18N.getString("zp.selectaction")+"</div>"),!1;var editData=Timetracker.schedulerReminderSettings.editData;null!==editData&&editData.unencodedSchedulerConf&&editData.unencodedSchedulerConf.isCheckNoSwipe?pushAbsConfig.isCheckNoSwipe=editData.unencodedSchedulerConf.isCheckNoSwipe:pushAbsConfig.isCheckNoSwipe=0,params.pushAbsentConfig=JSON.stringify(pushAbsConfig),Layout.Page.container.find("#ZPAtt_sNewPopupRecSave").prop("disabled",!0),$.post("/AttendanceSettingsAction.zp",params,function(){Layout.Page.container.find("#ZPAtt_sNewPopupRecSave").prop("disabled",!1),Attendance.Settings.Scheduler.showScheduleList(),Attendance.Settings.toggleAddNewPopUp()})}}},initializeGlobalVar:function(){Timetracker.schedulerReminderSettings.empSingleTempId="0",Timetracker.schedulerReminderSettings.repSingleTempId="0",Timetracker.schedulerReminderSettings.specSingleTempId="0",Timetracker.schedulerReminderSettings.empConsecTempId="0",Timetracker.schedulerReminderSettings.repConsecTempId="0",Timetracker.schedulerReminderSettings.specConsecTempId="0",Timetracker.schedulerReminderSettings.tempArr=[],Timetracker.schedulerReminderSettings.templateJson={},Timetracker.schedulerReminderSettings.isSingle=!1,Timetracker.schedulerReminderSettings.isConsec=!1,Timetracker.schedulerReminderSettings.orgTimeZoneOffset=ZPeople.Module.MODULE_DATA.attendance.orgTimeZoneOffset},loadTemplateMessagesForIds:function(templates){var tempParams={conreqcsr:csrfToken,mode:"getCusTempMsg"};tempParams.templateArr=JSON.stringify(templates),$.post("/AttendanceSettingsAction.zp",tempParams,function(rdata){rdata.temps&&(Timetracker.schedulerReminderSettings.templateJson=rdata.temps)})},saveCusTemplate:function(obj){var temp_parent=$(obj).closest("#absmailtemplate"),option=temp_parent.find("#usersOption"),val=$(option).children("option:selected").val();if(temp_parent.find("#editorTextArea_absmailtemplate").is(":visible")){var tempParams={conreqcsr:csrfToken},isvisible=temp_parent.find("input:radio[name=ZPAtt_consTempDay]").is(":visible"),isChecked=isvisible&&temp_parent.find("input:radio[name=ZPAtt_consTempDay]")[1].checked||Timetracker.schedulerReminderSettings.isConsec&&!isvisible;tempParams.templateId=isChecked?"emp"===val?Timetracker.schedulerReminderSettings.empConsecTempId:"rep"===val?Timetracker.schedulerReminderSettings.repConsecTempId:Timetracker.schedulerReminderSettings.specConsecTempId:"emp"===val?Timetracker.schedulerReminderSettings.empSingleTempId:"rep"===val?Timetracker.schedulerReminderSettings.repSingleTempId:Timetracker.schedulerReminderSettings.specSingleTempId;var absSchDays_parent=Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days");if(isvisible){var ischeck=!1;if(absSchDays_parent.find(".RotBox.zpnotfy").each(function(index,row){if(ischeck="emp"===val?$(row).find("[id^=ZPAtt_notifyAbsToEmp]").prop("checked"):"rep"==val?$(row).find("[id^=ZPAtt_notifyAbsToRepMan]").prop("checked"):$(row).find("[id^=ZPAtt_notifyAbsToNotSpec]").prop("checked"),!temp_parent.find("input:radio[name=ZPAtt_consTempDay]")[1].checked&&parseInt($(row).attr("value"))<=1||ischeck)return!1}),!ischeck)return}if(tempParams.templateMessage=editor.getContent(),"<div><br></div>"===tempParams.templateMessage)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.abstemplateempty"));tempParams.mode="saveCusTemplate",temp_parent.find(".btn-primary").attr("disabled",!0),$.post("/AttendanceSettingsAction.zp",tempParams,function(rdata){temp_parent.find(".btn-primary").prop("disabled",!1),rdata.Id&&(Layout.Page.container.find("#absmailtemplate").modal("hide"),isChecked?"emp"===val?Timetracker.schedulerReminderSettings.empConsecTempId=rdata.Id:"rep"===val?Timetracker.schedulerReminderSettings.repConsecTempId=rdata.Id:Timetracker.schedulerReminderSettings.specConsecTempId=rdata.Id:"emp"===val?Timetracker.schedulerReminderSettings.empSingleTempId=rdata.Id:"rep"===val?Timetracker.schedulerReminderSettings.repSingleTempId=rdata.Id:Timetracker.schedulerReminderSettings.specSingleTempId=rdata.Id,Timetracker.schedulerReminderSettings.templateJson[rdata.Id]=tempParams.templateMessage)})}},hideShowCustTemp:function(){var absSchDays_parent=Layout.Page.container.find("#ZPAtt_addPopup #ZPAtt_AbsSch_Days");Timetracker.schedulerReminderSettings.isSingle=!1,Timetracker.schedulerReminderSettings.isConsec=!1,absSchDays_parent.find(".RotBox.zpnotfy").each(function(index,row){1===parseInt($(row).attr("value"))?Timetracker.schedulerReminderSettings.isSingle=!0:parseInt($(row).attr("value"))>1&&(Timetracker.schedulerReminderSettings.isConsec=!0)});var popup_parent=Layout.Page.container.find("#absmailtemplate");popup_parent.find("#msgEditor").empty(),popup_parent.find("#cust").hide(),Timetracker.schedulerReminderSettings.isSingle&&Timetracker.schedulerReminderSettings.isConsec&&(popup_parent.find("input:radio[name=ZPAtt_consTempDay]")[0].checked=!0,popup_parent.find("#cust").show()),popup_parent.find("#selectCont").empty();var txt='<select class="select2-container W300A" id="usersOption" onchange="Timetracker.schedulerReminderSettings.hideShowSingleOrConsecDaysTemp()">';absSchDays_parent.find("[id^=ZPAtt_notifyAbsToEmp]").filter(":checked").length>0&&(txt+='<option value="emp">'+ZPI18N.getString("zp.employee")+"</option>"),absSchDays_parent.find("[id^=ZPAtt_notifyAbsToRepMan]").filter(":checked").length>0&&(txt+='<option value="rep">'+ZPI18N.getString("zp.reportingmanager")+"</option>"),absSchDays_parent.find("[id^=ZPAtt_notifyAbsToNotSpec]").filter(":checked").length>0&&(txt+='<option value="spec">'+ZPI18N.getString("zp.specificusers")+"</option>"),txt+="</select>",popup_parent.find("#selectCont").append(txt),popup_parent.find("select").select2({minimumResultsForSearch:4}),popup_parent.modal("show"),Timetracker.schedulerReminderSettings.hideShowSingleOrConsecDaysTemp()},hideShowSingleOrConsecDaysTemp:function(obj){var val="1",popup_parent=Layout.Page.container.find("#absmailtemplate"),option=popup_parent.find("#usersOption"),selectedoption=$(option).children("option:selected").val();if(void 0!=selectedoption){for(var logoCnt="",i=0;i<176;i++)logoCnt+="&nbsp;";var id,tempDataViewCont=(logoCnt+="${Company_Logo}<br><br>")+ZPI18N.getString("zp.usermarkedabsenttemp");if(popup_parent.find("input:radio[name=ZPAtt_consTempDay]").is(":visible")&&popup_parent.find("input:radio[name=ZPAtt_consTempDay]")[0].checked||Timetracker.schedulerReminderSettings.isSingle&&!popup_parent.find("input:radio[name=ZPAtt_consTempDay]").is(":visible"))"0"!==(id=Timetracker.schedulerReminderSettings.empSingleTempId)&&void 0!==Timetracker.schedulerReminderSettings.templateJson[id]&&(tempDataViewCont=Timetracker.schedulerReminderSettings.templateJson[id]),"emp"!==selectedoption&&(tempDataViewCont=logoCnt+ZPI18N.getString("zp.belowusersmarkedabsenttemp"),id=Timetracker.schedulerReminderSettings.repSingleTempId,"rep"===selectedoption&&"0"!==id&&void 0!==Timetracker.schedulerReminderSettings.templateJson[id]&&(tempDataViewCont=Timetracker.schedulerReminderSettings.templateJson[id]),id=Timetracker.schedulerReminderSettings.specSingleTempId,"spec"===selectedoption&&"0"!==id&&void 0!==Timetracker.schedulerReminderSettings.templateJson[id]&&(tempDataViewCont=Timetracker.schedulerReminderSettings.templateJson[id]));else(popup_parent.find("input:radio[name=ZPAtt_consTempDay]").is(":visible")&&popup_parent.find("input:radio[name=ZPAtt_consTempDay]")[1].checked||Timetracker.schedulerReminderSettings.isConsec&&!popup_parent.find("input:radio[name=ZPAtt_consTempDay]").is(":visible"))&&(val="2",id=Timetracker.schedulerReminderSettings.empConsecTempId,tempDataViewCont=logoCnt+ZPI18N.getString("zp.consedaysabsforusertemp"),"0"!==id&&void 0!==Timetracker.schedulerReminderSettings.templateJson[id]&&(tempDataViewCont=Timetracker.schedulerReminderSettings.templateJson[id]),"emp"!==selectedoption&&(tempDataViewCont=logoCnt+ZPI18N.getString("zp.consedaysabsforrepmantemp"),id=Timetracker.schedulerReminderSettings.repConsecTempId,"rep"===selectedoption&&"0"!==id&&void 0!==Timetracker.schedulerReminderSettings.templateJson[id]&&(tempDataViewCont=Timetracker.schedulerReminderSettings.templateJson[id]),id=Timetracker.schedulerReminderSettings.specConsecTempId,"spec"===selectedoption&&"0"!==id&&void 0!==Timetracker.schedulerReminderSettings.templateJson[id]&&(tempDataViewCont=Timetracker.schedulerReminderSettings.templateJson[id])));popup_parent.find("#msgTemplate").html('<div class="row"><div class="msgpreview-outer"><div class="msgpreview clearfix"><div id="tempViewCont" class="P10">'+tempDataViewCont+"</div></div></div></div>"),absentScheduler.appendTemplate(popup_parent,selectedoption,val)}},constAbsentSchedulerSummary:function(){if(-1!==Layout.Page.pageId.indexOf("attendance-settings-absentschedule")){var schTime=$("#"+Layout.Page.pageId).find("#tssettings-time").val(),schDate=parseInt($("#"+Layout.Page.pageId).find("#schDate").val()),schMinz=parseInt(schTime.split(":")[0],10);12===schMinz&&(schMinz=0),schtime=60*schMinz+parseInt(schTime.split(":")[1].split(" ")[0],10),"PM"===schTime.split(":")[1].split(" ")[1]&&(schtime+=720);var date=new Date,offset=void 0!==Timetracker.schedulerReminderSettings.orgTimeZoneOffset?Timetracker.schedulerReminderSettings.orgTimeZoneOffset:0,utc=date.getTime()+6e4*date.getTimezoneOffset(),newDate=new Date(utc+36e5*offset),curtime=60*newDate.getHours()+newDate.getMinutes(),day=ZPI18N.getString("zp.stoday"),addDay=0;schtime<curtime&&(day=ZPI18N.getString("zp.stomorrow"),addDay=1);var child_txt='<div class="label-message PPAltmsg label-note" style="display: inline-block;">';child_txt+='<div class="MB10"><b>Summary</b></div>',child_txt+="<p>Scheduler will next run at "+schTime+" "+day+" and will process absence for "+Calendar.formatDate(new Date(date.setDate(newDate.getDate()-schDate+addDay)))+".</p></div>",$("#"+Layout.Page.pageId+" #ZPAtt_addPopup").find(".modal-footer").append(child_txt),Layout.Page.container.find("#ZPAtt_addPopup").find(".modal-body").css("bottom","140px")}},returnParamsForRoleDeptDesignationForSchedules:function(params){var appfor={},isSchedulerPage="attendance-settings-absentschedule"===Layout.Page.pageId||"timetracker-settings-schedulersettings"===Layout.Page.pageId||"leavetracker-settings-compensatoryoffschedule"===Layout.Page.pageId||"attendance-shiftmapping-shiftrotation"===Layout.Page.pageId||"timetracker-settings-remindersettings"===Layout.Page.pageId;return appfor.role=ZPPickList.isAllDataCheckBoxSelected(ZPPickList.getSelectedRoles(),isSchedulerPage?ZPPickList.CONSTANTS.ROLES:Object.keys(ZPPickList.allRoles)),appfor.dept=ZPPickList.isAllDataCheckBoxSelected(ZPPickList.getSelectedDepartments(),isSchedulerPage?ZPPickList.CONSTANTS.DEPARTMENTS:Object.keys(ZPPickList.allDepartments)),appfor.desg=ZPPickList.isAllDataCheckBoxSelected(ZPPickList.getSelectedDesignations(),isSchedulerPage?ZPPickList.CONSTANTS.DESIGNATIONS:Object.keys(ZPPickList.allDesignations)),appfor.loc=ZPPickList.isAllDataCheckBoxSelected(ZPPickList.getSelectedLocations(),isSchedulerPage?ZPPickList.CONSTANTS.LOCATIONS:Object.keys(ZPPickList.allLocations)),appfor.user=ZPPickList.isAllDataCheckBoxSelected(ZPPickList.getSelectedUsers(),isSchedulerPage?ZPPickList.CONSTANTS.USERS:Object.keys(ZPPickList.allUsersObj)),appfor.group=ZPPickList.isAllDataCheckBoxSelected(ZPPickList.getSelectedGroups(),isSchedulerPage?ZPPickList.CONSTANTS.GROUPS:Object.keys(ZPPickList.allGroups)),0===appfor.role.length&&0===appfor.dept.length&&0===appfor.desg.length&&0===appfor.loc.length&&0===appfor.user.length&&0===appfor.group.length&&(params.isAllCriteriaNull=!0),params.isValid=!0,Timetracker.schedulerReminderSettings.editMode&&JSON.stringify(appfor.role)==JSON.stringify(Timetracker.schedulerReminderSettings.editData.role)&&JSON.stringify(appfor.dept)==JSON.stringify(Timetracker.schedulerReminderSettings.editData.dept)&&JSON.stringify(appfor.desg)==JSON.stringify(Timetracker.schedulerReminderSettings.editData.desg)&&JSON.stringify(appfor.loc)==JSON.stringify(Timetracker.schedulerReminderSettings.editData.loc)&&JSON.stringify(appfor.user)==JSON.stringify(Timetracker.schedulerReminderSettings.editData.user)&&JSON.stringify(appfor.group)==JSON.stringify(Timetracker.schedulerReminderSettings.editData.group)&&(params.isValid=!1),params.appfor=JSON.stringify(appfor),params},getApplData:function(applicableFor,type){for(var mapping={role:"role",loc:"location",dept:"department",desg:"designation",user:"users",group:"group"},appclass=type?"appl":"except",appUserele=Layout.Page.container.find("#TSReminderApplicableFor [name=users]."+appclass),appliConfigured=(_.pluck(appUserele.select2("data"),"id"),!1),i=0;i<Timetracker.schedulerReminderSettings.APPLICABLE_FOR_KEYS.length;i++){var applArr,keyName=Timetracker.schedulerReminderSettings.APPLICABLE_FOR_KEYS[i],ele=Layout.Page.container.find("#TSReminderApplicableFor [name="+mapping[keyName]+"]."+appclass);applArr=_.pluck(ele.select2("data"),"id"),appliConfigured=!(!type||"users"==keyName)||appliConfigured,applicableFor[keyName]=applArr}if(appliConfigured)for(i=0;i<Timetracker.schedulerReminderSettings.APPLICABLE_FOR_KEYS.length;i++)keyName=Timetracker.schedulerReminderSettings.APPLICABLE_FOR_KEYS[i]},validateAppForReminder:function(appfor,exceptfor,params){0===appfor.role.length&&0===appfor.dept.length&&0===appfor.desg.length&&0===appfor.loc.length&&0===appfor.user.length&&0===appfor.group.length&&0===exceptfor.role.length&&0===exceptfor.dept.length&&0===exceptfor.desg.length&&0===exceptfor.loc.length&&0===exceptfor.user.length&&0===exceptfor.group.length&&(params.isAllCriteriaNull=!0)},updateEditOptions:function(){Timetracker.schedulerReminderSettings.setApplData(Layout.Page.container.find("#tsreminderapplicableDiv"),!0),Timetracker.schedulerReminderSettings.setApplData(Layout.Page.container.find("#tsreminderexceptionDiv"),!1)},setApplData:function(modal,appFor){var data=Timetracker.schedulerReminderSettings.editData,fields=Timetracker.schedulerReminderSettings.APPLICABLE_FOR_KEYS,mapping={role:"role",loc:"location",dept:"department",desg:"designation",user:"users",group:"group"},oppmodal=Layout.Page.container.find("#tsreminderexceptionDiv");for(var indx in appFor||(oppmodal=Layout.Page.container.find("#tsreminderapplicableDiv"),fields=Timetracker.schedulerReminderSettings.EXCEPTION_FOR_KEYS,mapping={exceptrole:"role",exceptloc:"location",exceptdept:"department",exceptdesg:"designation",exceptuser:"users",exceptgroup:"group"}),fields){var field=fields[indx],obj=data[field],arr=_.isArray(obj)?obj:[];if(0!=arr.length)if(modal.find("#"+mapping[field]+"_field").removeClass("DN"),1==arr.length&&"0"==arr[0]||"0"==_.last(arr)?oppmodal.find("#"+mapping[field]+"_field").removeClass("DN"):oppmodal.find("#"+mapping[field]+"_field").addClass("DN"),"user"==field||"exceptuser"==field){var values=[];modal.find("#users_field").prev().removeClass("DN");var userList=ZPeople.getUserDetailsByIds(arr,!1);for(var i in(1==arr.length&&"0"==arr[0]||"0"==_.last(arr))&&values.push({id:"0",text:ZPI18N.getString("zp.allemployees"),html:ZPI18N.getString("zp.allemployees")}),arr){var id=arr[i],userDtl=ZPeople.getUserDetailsByIdInList(id,userList);void 0!=id&&"null"!=id&&(userDtl&&-1!=userDtl.id&&values.push({id:id,text:ZPeople.decodeTxt(userDtl.name),html:userDtl.name,photo:userDtl.photo}))}modal.find("input[name=users]").select2("data",values),"0"!=id&&oppmodal.find("#users_field").prev().addClass("DN")}else"-1"!=_.last(arr)&&(modal.find("[name="+mapping[field]+"]").select2("val",arr),modal.find("[name="+mapping[field]+"]").val(arr).trigger("change"));else oppmodal.find("#"+mapping[field]+"_field").removeClass("DN"),("user"==field||"exceptuser"==field)&&oppmodal.find("#users_field").prev().removeClass("DN")}}},Timetracker.billingSettings={currencyData:null,locationData:null,locationCurrencyUpdate:{},deletedTaxes:"",deletedCurrencies:"",taxData:null,currenciesData:null,currencyRepeat:!1,loadBillingSettings:function(){Timetracker.initSetup(),Layout.Page.container.find("#billing-settingsdiv-edit,#billing-settingsfoot-edit").hide(),Timetracker.billingSettings.getBillingSettings()},getBillingSettings:function(){Timetracker.util.removeErrorMsg("billing-settingsdiv-edit"),Timetracker.billingSettings.currencyRepeat=!1,null===Timetracker.billingSettings.taxData||null===Timetracker.billingSettings.currenciesData?(Timetracker.billingSettings.locationCurrencyUpdate={},$.post(Timetracker.constants.URL,{mode:"getBillingSettings",conreqcsr:csrfToken},function(resultData){Timetracker.billingSettings.constructCurrenciesOption(resultData.currenciesList),Timetracker.billingSettings.constructLocationsOption(resultData.locArr),Timetracker.reports.billing.taxforBill=Timetracker.billingSettings.taxData=resultData.taxData,Timetracker.billingSettings.currenciesData=resultData.currenciesData,Timetracker.generalSettings.settingDetails=resultData.billNumberSettings,Timetracker.billingSettings.constructTaxes(resultData.taxData),Timetracker.billingSettings.updateBillNoSettings(resultData.billNumberSettings),Timetracker.billingSettings.constructCurrencies(resultData.currenciesData),Timetracker.billingSettings.setBillingSettings()})):(Timetracker.billingSettings.constructTaxes(Timetracker.billingSettings.taxData),Timetracker.billingSettings.constructCurrencies(Timetracker.billingSettings.currenciesData),Timetracker.billingSettings.setBillingSettings())},constructCurrenciesOption:function(currencyList){for(var txt="",i=0;i<currencyList.length;i++){var obj=currencyList[i];txt+='<option value="'+obj.curCode+'">'+obj.curName+"</option>"}Layout.Page.container.find("#currency_info").attr("value",txt),Timetracker.billingSettings.currencyData=txt},constructLocationsOption:function(locarr){for(var txt="",i=0;i<locarr.length;i++){var obj=locarr[i];txt+='<option value="'+obj.locationId+'">'+obj.locationName+"</option>"}Layout.Page.container.find("#location_info").attr("value",txt),Timetracker.billingSettings.locationData=txt},setBillingSettings:function(){"1"===Timetracker.generalSettings.getAutoBillNo()?(Layout.Page.container.find("#tssettings-billautodiv").show(),Layout.Page.container.find("#tssettings-billautodiv_view").show(),Layout.Page.container.find("#tssettings_billnoprefix").val(Timetracker.generalSettings.getBillNoPrefix()),Layout.Page.container.find("#tssettings_billnostarts").val(Timetracker.generalSettings.getBillStartNo())):(Timetracker.generalSettings.settingDetails.TS_BillnoAuto="0",Layout.Page.container.find("#tssettings-billautodiv").hide(),Layout.Page.container.find("#tssettings-billautodiv_view").hide(),Layout.Page.container.find("#tssettings_billnoprefix").val(""),Layout.Page.container.find("#tssettings_billnostarts").val("")),Layout.Page.container.find("input[type='radio'][name='billnoauto'][value='"+Timetracker.generalSettings.getAutoBillNo()+"']").prop("checked",!0),Layout.Page.container.find("#billing-settingsdiv-edit,#billing-settingsfoot-edit").fadeIn(200)},updateBillNoSettings:function(resultData){if(resultData.TS_BillnoAuto&&"1"===resultData.TS_BillnoAuto){var myTemptxt="";resultData.TS_BillnoPrefix&&void 0!==resultData.TS_BillnoPrefix&&(myTemptxt+=ZPI18N.getString("zp.prefix")+" : "+resultData.TS_BillnoPrefix+" &nbsp; &nbsp"),myTemptxt+=ZPI18N.getString("zp.startsfrom")+" : "+resultData.TS_BillnoStarts,Layout.Page.container.find("#tssettings_billno_view").text(ZPI18N.getString("zp.automatic")),Layout.Page.container.find("#tssettings-billno_view_prefix").show(),Layout.Page.container.find("#tssettings-billno_view_prefix").html(myTemptxt)}else Layout.Page.container.find("#tssettings_billno_view").text(ZPI18N.getString("zp.manual")),Layout.Page.container.find("#tssettings-billno_view_prefix").hide()},constructTaxes:function(result,view){var txt="";Layout.Page.container.find("#taxes_body").html(""),0===result.length||""===result?(txt='<tr><td><input type="text" class="form-control" placeholder="'+ZPI18N.getString("zp.taxname")+'"></td>',txt+='<td><input type="text" class="form-control" placeholder="'+ZPI18N.getString("zp.percentage")+'"></td>',txt+="<td>",txt+='<i class="IC-cls-fill S16 gry FL MT5 CP" onclick="Timetracker.billingSettings.deleteTaxRows(this);"></i>',txt+='<i class="IC-plus-fill S16 gry FL MT5 ML5 CP" onclick="Timetracker.billingSettings.addTaxRows();"></i></td></tr>',Layout.Page.container.find("#taxes_body").append(txt),Layout.Page.container.find("#taxes_body").find(".IC-cls-fill").hide()):$.each(result,function(index,data){txt='<tr><td><input type="text" class="form-control" placeholder="'+ZPI18N.getString("zp.taxname")+'" value="'+data.taxName+'" taxId="'+data.taxId+'"></td>',txt+='<td><input type="text" class="form-control" placeholder="'+ZPI18N.getString("zp.percentage")+'" value="'+data.taxPerCent+'"></td>',txt+="<td>",txt+='<i class="IC-cls-fill S16 gry FL MT5 CP" onclick="Timetracker.billingSettings.deleteTaxRows(this);"></i>',txt+='<i class="IC-plus-fill S16 gry FL MT5 ML5 CP" onclick="Timetracker.billingSettings.addTaxRows();"></i></td></tr>',Layout.Page.container.find("#taxes_body").find(".IC-cls-fill").show(),Layout.Page.container.find("#taxes_body").find(".IC-plus-fill").hide(),Layout.Page.container.find("#taxes_body").append(txt),0===index&&1===result.length&&(Layout.Page.container.find("#taxes_body").find(".IC-cls-fill").hide(),Layout.Page.container.find("#taxes_body").find(".IC-plus-fill").show())})},addTaxRows:function(){var txt="";Layout.Page.container.find("#taxes_body > tr").length>=1&&(txt+='<tr><td><input type="text" class="form-control" placeholder="'+ZPI18N.getString("zp.taxname")+'"></td>',txt+='<td><input type="text" class="form-control" placeholder="'+ZPI18N.getString("zp.percentage")+'"></td>',Layout.Page.container.find("#taxes_body").find(".IC-cls-fill").show(),Layout.Page.container.find("#taxes_body").find(".IC-plus-fill").hide(),txt+="<td>",txt+='<i class="IC-cls-fill S16 gry FL MT5 CP" onclick="Timetracker.billingSettings.deleteTaxRows(this);"></i>',txt+='<i class="IC-plus-fill S16 gry FL MT5 ML5 CP" onclick="Timetracker.billingSettings.addTaxRows();"></i></td></tr>'),Layout.Page.container.find("#taxes_body").append(txt)},deleteTaxRows:function(obj){if(1!==Layout.Page.container.find("#taxes_body > tr").length){var siblingsArray=$(obj).parent().siblings(),taxId=$(siblingsArray[0]).find(".form-control").attr("taxId");taxId&&(Timetracker.billingSettings.deletedTaxes+=taxId+","),$(obj).parent().parent().remove(),Layout.Page.container.find("#taxes_body").find(".IC-plus-fill").last().show(),1===Layout.Page.container.find("#taxes_body > tr").length&&Layout.Page.container.find("#taxes_body").find(".IC-cls-fill").hide()}},constructCurrencies:function(result,view){for(var txt="",locationData=Layout.Page.container.find("#location_info").val(),currencyData=Layout.Page.container.find("#currency_info").val(),defaultIndex=0,index=0;index<result.length;index++)result[index].hasOwnProperty("locationId")?(txt+='<tr><td><select onchange="Timetracker.billingSettings.checkLocationInfoChange(this);"><option value="0">'+ZPI18N.getString("zp.selectcurrency")+"</option>"+currencyData+"</select></td>",txt+='<td><select onchange="Timetracker.billingSettings.checkLocationCurrencyChange(this,false);"><option value="0">'+ZPI18N.getString("zp.selectlocation")+"</option>"+locationData+"</select></td>",txt+="<td>",txt+='<i class="IC-cls-fill S16 gry FL MT5 CP" onclick="Timetracker.billingSettings.deleteCurrencyRows(this);"></i>',txt+='<i class="IC-plus-fill S16 gry FL MT5 ML5 CP DN" onclick="Timetracker.billingSettings.addCurrencyRows();"></i></td></tr>'):result[index].locationName===ZPI18N.getString("zp.default")&&(txt+='<tr><td><select id="defaultCurrencyRow"><option value="0">'+ZPI18N.getString("zp.selectcurrency")+"</option>"+currencyData+"</select></td>",txt+='<td><input type="text" class="form-control" value='+result[index].locationName+' disabled="disabled"></td>',txt+='<td><i class="IC-plus-fill S16 gry FL MT5 CP DN" onclick="Timetracker.billingSettings.addCurrencyRows();"></i></td></tr>',defaultIndex=index);Layout.Page.container.find("#currencies_body").html(txt),Layout.Page.container.find("#currencies_body").find(".IC-plus-fill").last().show(),Layout.Page.container.find("#defaultCurrencyRow").val(result[defaultIndex].currencyCode);var count=0;Layout.Page.container.find("#currencies_body > tr").each(function(){$(this).attr("currencyId",result[count].currencyId);var textChildren=$(this).children();$(textChildren[0]).find("select").val(result[count].currencyCode).select2(Timetracker.select2.getSelect2Properties()),result[count].hasOwnProperty("locationId")&&$(textChildren[1]).find("select").val(result[count].locationId),$(textChildren[1]).find("select").select2(Timetracker.select2.getSelect2Properties()),Timetracker.billingSettings.locationCurrencyUpdate[result[count].locationId]=result[count].currencyCode,count++}),Timetracker.billingSettings.locationData=locationData,Timetracker.billingSettings.currencyData=currencyData},checkLocationCurrencyChange:function(obj,reset){Timetracker.billingSettings.currencyRepeat=!1;var currencyCode=Timetracker.billingSettings.locationCurrencyUpdate[$(obj).val()],textChildren=$(obj).parent().siblings();currencyCode&&null!==currencyCode&&!reset&&($(textChildren[0]).find("select").val(currencyCode),Timetracker.billingSettings.currencyRepeat=!0,$(textChildren[0]).find("select").select2(Timetracker.select2.getSelect2Properties())),Timetracker.billingSettings.locationCurrencyUpdate[$(obj).val()]=$(textChildren[0]).find("select").val()},checkLocationInfoChange:function(obj){var textChildren=$(obj).parent().siblings();Timetracker.billingSettings.locationCurrencyUpdate[$(textChildren[0]).find("select").val()]=$(obj).val()},addCurrencyRows:function(){var txt='<tr><td><select onchange="Timetracker.billingSettings.checkLocationInfoChange(this);"><option value="0">'+ZPI18N.getString("zp.selectcurrency")+"</option>"+Timetracker.billingSettings.currencyData+"</select></td>";txt+='<td><select onchange="Timetracker.billingSettings.checkLocationCurrencyChange(this,false);"><option value="0">'+ZPI18N.getString("zp.selectlocation")+"</option>"+Timetracker.billingSettings.locationData+"</select></td>",txt+="<td>",txt+='<i class="IC-cls-fill S16 gry FL MT5 CP" onclick="Timetracker.billingSettings.deleteCurrencyRows(this);"></i>',txt+='<i class="IC-plus-fill S16 gry FL MT5 ML5 CP" onclick="Timetracker.billingSettings.addCurrencyRows();"></i></td></tr>',Layout.Page.container.find("#currencies_body").find(".IC-cls-fill").show(),Layout.Page.container.find("#currencies_body").find(".IC-plus-fill").hide(),Layout.Page.container.find("#currencies_body").append(txt),Layout.Page.container.find("#currencies_body").find("select").select2(Timetracker.select2.getSelect2Properties())},deleteCurrencyRows:function(obj){if(Layout.Page.container.find("#currencies_body").parent().find(".ERR").remove(),1!==Layout.Page.container.find("#currencies_body > tr").length){var currencyId=$(obj).parent().parent().attr("currencyId");currencyId&&(Timetracker.billingSettings.deletedCurrencies+=currencyId+",");var textChildren=$(obj).parent().siblings();Timetracker.billingSettings.locationCurrencyUpdate[$(textChildren[1]).find("select").val()]=null,Timetracker.billingSettings.checkLocationCurrencyChange(obj,!0),$(obj).parent().parent().remove(),Layout.Page.container.find("#currencies_body").find(".IC-plus-fill").last().show(),1===Layout.Page.container.find("#currencies_body > tr").length&&Layout.Page.container.find("#currencies_body").find(".IC-cls-fill").hide()}},updateBillingSettings:function(){Timetracker.util.removeErrorMsg("billing-settingsdiv-edit");var billnoauto=Layout.Page.container.find("input[type='radio'][name='billnoauto']:checked").val(),billnoprefix=Layout.Page.container.find("#tssettings_billnoprefix").val(),billnostarts=Layout.Page.container.find("#tssettings_billnostarts").val(),taxArray=new Array,errorFlag=!1;"1"===billnoauto&&(void 0===billnostarts||""===billnostarts?(Layout.Page.container.find("#tssettings_billnostarts").after('<div class="ERR">'+ZPI18N.getString("zp.billstartingnumberempty")+"</div>"),errorFlag=!0):ZPUtil.Validation.isNumber(billnostarts)||(Layout.Page.container.find("#tssettings_billnostarts").after('<div class="ERR">'+ZPI18N.getString("zp.fieldupdate.numbererror")+"</div>"),errorFlag=!0));var counter=0,existingTaxNames={};if(Layout.Page.container.find("#taxes_body > tr").each(function(){var textChildren=$(this).children(),taxId=$(textChildren[0]).find(".form-control").attr("taxId"),taxName=$(textChildren[0]).find(".form-control").val(),taxpercent=$(textChildren[1]).find(".form-control").val();""===taxName.trim()&&""!==taxpercent.trim()&&($(textChildren[0]).append('<span class="ERR">'+ZPI18N.getString("zp.specifyname")+"</span>"),errorFlag=!0),""!==taxName.trim()&&(""===taxpercent.trim()||isNaN(taxpercent.trim())||taxpercent<0||taxpercent>100)&&($(textChildren[1]).append('<span class="ERR">'+ZPI18N.getString("zp.invalidpercent")+"</span>"),errorFlag=!0),existingTaxNames[taxName]?($(textChildren[0]).append('<span class="ERR">'+ZPI18N.getString("zp.duplicatename")+"</span>"),errorFlag=!0):""!==taxName.trim()&&(existingTaxNames[taxName]="exists"),taxId&&!errorFlag?taxName===Timetracker.billingSettings.taxData[counter].taxName&&Number(taxpercent)===Timetracker.billingSettings.taxData[counter].taxPerCent||""!==taxName.trim()&&""!==taxpercent.trim()&&taxArray.push({taxName:taxName,taxPercent:taxpercent,taxId:taxId}):errorFlag||""!==taxName.trim()&&""!==taxpercent.trim()&&taxArray.push({taxName:taxName,taxPercent:taxpercent}),counter++}),errorFlag)return!1;var currencyArray=new Array;if(errorFlag=!1,counter=0,Layout.Page.container.find("#currencies_body > tr").each(function(){var textChildren=$(this).children(),currencyId=$(this).attr("currencyId");"0"===$(textChildren[0]).find("select").val()&&($(textChildren[0]).append('<span class="ERR">'+ZPI18N.getString("zp.selectacur")+"</span>"),errorFlag=!0),"0"===$(textChildren[1]).find("select").val()&&($(textChildren[1]).append('<span class="ERR">'+ZPI18N.getString("zp.selectaloc")+"</span>"),errorFlag=!0),currencyId?$(textChildren[0]).find("select").val()===Timetracker.billingSettings.currenciesData[counter].currencyCode||Number($(textChildren[1]).find("select").val())===Timetracker.billingSettings.currenciesData[counter].locationId||isNaN(Number($(textChildren[1]).find("select").val())===Timetracker.billingSettings.currenciesData[counter].locationId)||currencyArray.push({currencyId:currencyId,currencyCode:$(textChildren[0]).find("select").val(),locationCode:$(textChildren[1]).find("select").val()}):currencyArray.push({currencyCode:$(textChildren[0]).find("select").val(),locationCode:$(textChildren[1]).find("select").val()}),counter++}),errorFlag)return!1;if(Timetracker.billingSettings.currencyRepeat)return Layout.Page.container.find("#currencies_body").parent().append('<span class="ERR" style="line-height:10px">Mapping wrong</span>'),!1;var noEdit=!1;if(billnoauto!==String(Timetracker.generalSettings.getAutoBillNo())?noEdit=!0:((currencyArray.length>0||taxArray.length>0||""!==Timetracker.billingSettings.deletedCurrencies||""!==Timetracker.billingSettings.deletedTaxes)&&(noEdit=!0),"1"===billnoauto&&(billnoprefix.trim()===String(Timetracker.generalSettings.getBillNoPrefix()).trim()&&billnostarts.trim()===String(Timetracker.generalSettings.getBillStartNo()).trim()||(noEdit=!0))),noEdit){var params={mode:"updateBillingSettings",taxArray:JSON.stringify(taxArray),currencyArray:JSON.stringify(currencyArray),billnoauto:billnoauto,billnoprefix:billnoprefix,billnostarts:billnostarts,conreqcsr:csrfToken};""!==Timetracker.billingSettings.deletedTaxes&&(params.deletedTaxes=Timetracker.billingSettings.deletedTaxes),""!==Timetracker.billingSettings.deletedCurrencies&&(params.deletedCurrencies=Timetracker.billingSettings.deletedCurrencies),ZPeople.Request.send(Timetracker.constants.URL,params,Timetracker.billingSettings.detailsUpdateSuccess)}else ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.nochangesmade")),Timetracker.billingSettings.getBillingSettings(!0)},detailsUpdateSuccess:function(){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.billingsettingsupdated")),Timetracker.billingSettings.deletedTaxes="",Timetracker.billingSettings.deletedCurrencies="",Timetracker.billingSettings.taxData=null,Timetracker.billingSettings.currenciesData=null,Timetracker.billingSettings.currencyRepeat=!1,Timetracker.billingSettings.getBillingSettings()}},Timetracker.timelogCustomization={TLC_CLIENTS:"TLC_Clients",TLC_PROJECTS:"TLC_Projects",TLC_WORKITEM:"TLC_Workitem",TLC_DESC:"TLC_Desc",TLC_BILLABLE_SHOW:"TLC_Billable_Show",isTLFieldEnabled:function(tlField,checkBreak){var isEnabled=!1,isFromBreak=!1;if(void 0!==checkBreak&&checkBreak&&(isFromBreak=Timetracker.BreakTimelogs.isBreakLog()),null!==Timetracker.generalSettings.timelogEnabledFields)switch(tlField){case Timetracker.constants.CLIENT:"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients&&(isEnabled=!0,isFromBreak&&(isEnabled=!1));break;case Timetracker.constants.PROJECT:"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Projects&&(isEnabled=!0,isFromBreak&&(isEnabled=!1));break;case Timetracker.constants.WORKITEM:"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Workitem&&(isEnabled=!0,isFromBreak&&(isEnabled=!1));break;case Timetracker.constants.DESC:("1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Desc||isFromBreak)&&(isEnabled=!0);break;case Timetracker.constants.BILLABLE_STATUS:("1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Billable_Show||isFromBreak)&&(isEnabled=!0);break;case Timetracker.constants.ATTACHMENT:"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Attachment_Show&&(isEnabled=!0)}return isEnabled},isTLFieldMandatory:function(tlField,checkBreak){var isMandatory=!1,isFromBreak=!1;if(void 0!==checkBreak&&checkBreak&&(isFromBreak=Timetracker.BreakTimelogs.isBreakLog()),null!==Timetracker.generalSettings.timelogEnabledFields)switch(tlField){case Timetracker.constants.CLIENT:"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients_Mandatory&&(isMandatory=!0,isFromBreak&&(isMandatory=!1));break;case Timetracker.constants.PROJECT:"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Projects_Mandatory&&(isMandatory=!0,isFromBreak&&(isMandatory=!1));break;case Timetracker.constants.WORKITEM:case"Work_Item":"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Workitem_Mandatory&&(isMandatory=!0,isFromBreak&&(isMandatory=!1));break;case Timetracker.constants.DESC:case"Description":"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Desc_Mandatory&&(isMandatory=!0,isFromBreak&&(isMandatory=!1))}return isMandatory}},Timetracker.Department={dept_List:{load:!0},reports_dept_List:{load:!0},constructDepartmentFilter:function(id,param,defaultValue,type){param.submode===Timetracker.constants.Perm.REPORTS?Timetracker.Department.reports_dept_List.load&&Timetracker.util.getCommonData(param,Timetracker.Filters.setCacheForFilterValues):Timetracker.Department.dept_List.load&&Timetracker.util.getCommonData(param,Timetracker.Filters.setCacheForFilterValues);var dept_List=param.submode===Timetracker.constants.Perm.REPORTS?Timetracker.Department.reports_dept_List:Timetracker.Department.dept_List;if(0!==dept_List.length){Layout.Page.container.find("#"+id).parents(".department").removeClass("DNI");var deptTxt=$("<div></div>"),selJson={};"tirDepartmentName"==id?deptTxt.append($('<option value="0">'+ZPI18N.getString("zp.alldepartment")+"</option>")):selJson.multipleSelections=!0;var isCurrentUserDepartmentIncluded=!1;for(var i in dept_List)isCurrentUserDepartmentIncluded||(isCurrentUserDepartmentIncluded=dept_List[i].dept_ID===ZPeople.CURR_USER.deptId),deptTxt.append($('<option value="'+dept_List[i].dept_ID+'">'+dept_List[i].dept_Name+"</option>"));!isCurrentUserDepartmentIncluded&&Timetracker.util.checkIsParamNotEmpty(ZPeople.CURR_USER.deptId)&&(dept_List.unshift({dept_Name:ZPeople.CURR_USER.deptName,dept_ID:ZPeople.CURR_USER.deptId}),deptTxt.append($('<option value="'+ZPeople.CURR_USER.deptId+'">'+ZPeople.CURR_USER.deptName+"</option>"))),void 0===defaultValue&&(defaultValue=Timetracker.util.checkIsParamNotEmpty(ZPeople.CURR_USER.deptId)?ZPeople.CURR_USER.deptId:"0"),Layout.Page.container.find("#"+id).html($(deptTxt).html()).val(defaultValue).select2(Timetracker.select2.getSelect2Properties(!1,selJson))}}},Timetracker.organizationTags={orgTagList:{refresh:!0},reports_orgTagList:{refresh:!0},constructFilter:function(id,param,type){if(Timetracker.generalSettings.isOrgTagEnabled()){param.submode===Timetracker.constants.Perm.REPORTS?Timetracker.organizationTags.reports_orgTagList.refresh&&Timetracker.util.getCommonData(param,Timetracker.Filters.setCacheForFilterValues):Timetracker.organizationTags.orgTagList.refresh&&Timetracker.util.getCommonData(param,Timetracker.Filters.setCacheForFilterValues);var list=param.submode===Timetracker.constants.Perm.REPORTS?Timetracker.organizationTags.reports_orgTagList:Timetracker.organizationTags.orgTagList;if(0!==list.length){Layout.Page.container.find("#"+id).parents(".organizationtag").removeClass("DNI");var orgTagText=$("<div></div>");for(var i in list)orgTagText.append($('<option value="'+list[i].ORGANIZATION_TAG_ID+'">'+list[i].NAME+"</option>"));Layout.Page.container.find("#"+id).html($(orgTagText).html()).select2(Timetracker.select2.getSelect2Properties(!1,{multipleSelections:!0}))}}},fetchParams:function(filterDiv,params,fromReports,formatAsJson,skipDefaultValues){if(Timetracker.generalSettings.isOrgTagEnabled()){if(fromReports){if(values=ZPLite.Filters.getValues(filterDiv.find('[name="orgTagFilter"]')),values&&values.length>0&&(!skipDefaultValues||1!=values.length||"0"!=values[0])){let idArray=[];$.each(values,function(index,option){idArray.push(option.id)}),params.orgTagId=formatAsJson?JSON.stringify(idArray):idArray.join(",")}}else params.orgTagId=Timetracker.util.getParamValForMultiSelect(filterDiv.val()),params.orgTagId="0"!=params.orgTagId?params.orgTagId.toString():params.orgTagId;return params}}},Timetracker.roles={reports_roleList:{refresh:!0},fetchParams:function(filterDiv,params,fromReports,formatAsJson,skipDefaultValues){if(Timetracker.generalSettings.isRoleFilterEnabled()){if(fromReports&&(values=ZPLite.Filters.getValues(filterDiv.find('[name="roleFilter"]')),values&&values.length>0&&(!skipDefaultValues||1!=values.length||"0"!=values[0]))){let idArray=[];$.each(values,function(index,option){idArray.push(option.id)}),params.roleId=formatAsJson?JSON.stringify(idArray):idArray.join(",")}return params}}},Timetracker.Designation={desg_List:{load:!0},reports_desg_List:{load:!0},constructDesignationFilter:function(id,param,type){param.submode===Timetracker.constants.Perm.REPORTS?Timetracker.Designation.reports_desg_List.load&&Timetracker.util.getCommonData(param,Timetracker.Filters.setCacheForFilterValues):Timetracker.Designation.desg_List.load&&Timetracker.util.getCommonData(param,Timetracker.Filters.setCacheForFilterValues);var desg_List=param.submode===Timetracker.constants.Perm.REPORTS?Timetracker.Designation.reports_desg_List:Timetracker.Designation.desg_List;if(0!==desg_List.length){Layout.Page.container.find("#"+id).parents(".designation").removeClass("DNI");var desgText=$("<div></div>");for(var i in desg_List)desgText.append($('<option value="'+desg_List[i].desg_ID+'">'+desg_List[i].desg_Name+"</option>"));Layout.Page.container.find("#"+id).html($(desgText).html()).select2(Timetracker.select2.getSelect2Properties(!1,{multipleSelections:!0}))}}},Timetracker.Location={loc_List:{load:!0},settings_loc_list:{refresh:!0},reports_loc_List:{load:!0},constructLocationFilter:function(id,param,type,json){param.submode===Timetracker.constants.Perm.SETTINGS?Timetracker.Location.settings_loc_list.refresh&&Timetracker.util.getCommonData(param,Timetracker.Filters.setCacheForFilterValues):param.submode===Timetracker.constants.Perm.REPORTS?Timetracker.Location.reports_loc_List.load&&Timetracker.util.getCommonData(param,Timetracker.Filters.setCacheForFilterValues):Timetracker.Location.loc_List.load&&Timetracker.util.getCommonData(param,Timetracker.Filters.setCacheForFilterValues);var locList=Timetracker.Location.loc_List;param.submode===Timetracker.constants.Perm.SETTINGS?locList=Timetracker.Location.settings_loc_list:param.submode===Timetracker.constants.Perm.REPORTS&&(locList=Timetracker.Location.reports_loc_List),0!==locList.length&&(Layout.Page.container.find("#"+id).parents(".location").removeClass("DNI"),details={},details.element=Layout.Page.container.find("#"+id),details.placeholder=ZPI18N.getString("zp.alllocaction"),details.data=Timetracker.Location.loc_List,details.tokenField=!1,details.dataMapping={value:"locationId",label:"locationName"},details.search={by:"locationName"},TimetrackerOperations.Filters.createSelectFieldComponent(details))}},Timetracker.Division={divisionList:{refresh:!0},reports_divisionList:{refresh:!0},constructDivisionFilter:function(id,param,type){param.submode===Timetracker.constants.Perm.REPORTS?Timetracker.Division.reports_divisionList.refresh&&Timetracker.util.getCommonData(param,Timetracker.Filters.setCacheForFilterValues):Timetracker.Division.divisionList.refresh&&Timetracker.util.getCommonData(param,Timetracker.Filters.setCacheForFilterValues);var divisionList=param.submode===Timetracker.constants.Perm.REPORTS?Timetracker.Division.reports_divisionList:Timetracker.Division.divisionList;if(0!==divisionList.length){Layout.Page.container.find("#"+id).parents(".division").removeClass("DNI"),ZPeople.orgStructureDispNameMap.hasOwnProperty("division")&&Layout.Page.container.find("#"+id).siblings(".division").html(ZPeople.orgStructureDispNameMap.division);var htmlText=$("<div></div>");for(var i in divisionList)htmlText.append($('<option value="'+divisionList[i].DivisionID+'">'+divisionList[i].Name+"</option>"));Layout.Page.container.find("#"+id).html($(htmlText).html()).select2(Timetracker.select2.getSelect2Properties(!1,{multipleSelections:!0}))}}},Timetracker.BusinessUnit={businessUnitList:{refresh:!0},reports_businessUnitList:{refresh:!0},constructBusinessUnitFilter:function(id,param,type){param.submode===Timetracker.constants.Perm.REPORTS?Timetracker.BusinessUnit.reports_businessUnitList.refresh&&Timetracker.util.getCommonData(param,Timetracker.Filters.setCacheForFilterValues):Timetracker.BusinessUnit.businessUnitList.refresh&&Timetracker.util.getCommonData(param,Timetracker.Filters.setCacheForFilterValues);var businessUnitList=param.submode===Timetracker.constants.Perm.REPORTS?Timetracker.BusinessUnit.reports_businessUnitList:Timetracker.BusinessUnit.businessUnitList;if(0!==businessUnitList.length){Layout.Page.container.find("#"+id).parents(".businessUnit").removeClass("DNI"),ZPeople.orgStructureDispNameMap.hasOwnProperty("unit")&&Layout.Page.container.find("#"+id).siblings(".unit").html(ZPeople.orgStructureDispNameMap.unit);var htmlText=$("<div></div>");for(var i in businessUnitList)htmlText.append($('<option value="'+businessUnitList[i].UnitID+'">'+businessUnitList[i].Name+"</option>"));Layout.Page.container.find("#"+id).html($(htmlText).html()).select2(Timetracker.select2.getSelect2Properties(!1,{multipleSelections:!0}))}}},Timetracker.LegalEntity={legalEntityList:{refresh:!0},reports_legalEntityList:{refresh:!0},constructLegalEntityFilter:function(id,param,type){param.submode===Timetracker.constants.Perm.REPORTS?Timetracker.LegalEntity.reports_legalEntityList.refresh&&Timetracker.util.getCommonData(param,Timetracker.Filters.setCacheForFilterValues):Timetracker.LegalEntity.legalEntityList.refresh&&Timetracker.util.getCommonData(param,Timetracker.Filters.setCacheForFilterValues);var legalEntityList=param.submode===Timetracker.constants.Perm.REPORTS?Timetracker.LegalEntity.reports_legalEntityList:Timetracker.LegalEntity.legalEntityList;if(0!==legalEntityList.length){Layout.Page.container.find("#"+id).parents(".legalEntity").removeClass("DNI"),ZPeople.orgStructureDispNameMap.hasOwnProperty("entity")&&Layout.Page.container.find("#"+id).siblings(".entity").html(ZPeople.orgStructureDispNameMap.entity);var htmlText=$("<div></div>");for(var i in legalEntityList)htmlText.append($('<option value="'+legalEntityList[i].EntityID+'">'+legalEntityList[i].Name+"</option>"));Layout.Page.container.find("#"+id).html($(htmlText).html()).select2(Timetracker.select2.getSelect2Properties(!1,{multipleSelections:!0}))}}},Timetracker.Page={isMyDataView:function(){return-1!==Layout.Page.hash.indexOf("timetracker/mydata")},isTeamDataView:function(){return-1!==Layout.Page.hash.indexOf("timetracker/team")},Timelogs:{isListView:function(){return-1!==Layout.Page.hash.indexOf("timelogs")&&"list"==Layout.Page.urlparam.mode},isCalendarView:function(){return-1!==Layout.Page.hash.indexOf("timelogs")&&"calendar"==Layout.Page.urlparam.mode},isMyDataListView:function(){return Timetracker.Page.isMyDataView()&&this.isListView()},isMyDataCalendarView:function(){return Timetracker.Page.isMyDataView()&&this.isCalendarView()},isTeamDataListView:function(){return Timetracker.Page.isTeamDataView()&&this.isListView()},isTeamDataCalendarView:function(){return Timetracker.Page.isTeamDataView()&&this.isCalendarView()},isSelfServiceListView:function(){return-1!==Layout.Page.hash.indexOf("selfservice/timelogs/list")},isAddRecord:function(){return-1!==Layout.Page.hash.indexOf("timelogs/addtimelog")},isEditRecord:function(){return-1!==Layout.Page.hash.indexOf("timelogs/edittimelog")},isViewRecord:function(){return-1!==Layout.Page.hash.indexOf("timelogs/viewtimelog")}},Timesheet:{isListView:function(){return-1!==Layout.Page.hash.indexOf("timesheets")}},Projects:{isHomeMembersView:function(){return-1!==Layout.Page.hash.indexOf("home/team/projectmembers")},isModuleMembersView:function(){return-1!==Layout.Page.hash.indexOf("timetracker/team/projectmembers")}},isProjectDashboard:function(entity){return entity&&""!==entity?"feeds"===entity?-1!==Layout.Page.hash.indexOf("/projectdashboard/feeds"):"jobs"===entity?-1!==Layout.Page.hash.indexOf("/projectdashboard/jobs"):"users"===entity?-1!==Layout.Page.hash.indexOf("/projectdashboard/users"):"timelogs"===entity?-1!==Layout.Page.hash.indexOf("/projectdashboard/timelogs"):"attachments"===entity&&-1!==Layout.Page.hash.indexOf("/projectdashboard/attachments"):-1!==Layout.Page.hash.indexOf("/projectdashboard/")},ProjectDashboard:{isBasic:function(){return-1!==Layout.Page.hash.indexOf("/projectdashboard")},isPerformanceView:function(){return this.isBasic()&&-1!==Layout.Page.hash.indexOf("performance")},isFeedsView:function(){return this.isBasic()&&-1!==Layout.Page.hash.indexOf("feeds")},isJobsView:function(){return this.isBasic()&&-1!==Layout.Page.hash.indexOf("jobs")},isTimelogsView:function(){return this.isBasic()&&-1!==Layout.Page.hash.indexOf("timelogs")},isUsersView:function(){return this.isBasic()&&-1!==Layout.Page.hash.indexOf("users")},isAttachmentsView:function(){return this.isBasic()&&-1!==Layout.Page.hash.indexOf("attachments")}},getPageMode:function(){var url=Layout.Page.hash?Layout.Page.hash:"";return-1!=url.indexOf("mydata")||-1!=url.indexOf("myspace")?"ts_mydata":-1!=url.indexOf("team/user")?"ts_teamuser":-1!=url.indexOf("operations/timetracker/searchuser")?"ts_operuser":-1!=url.indexOf("operations")?"ts_operations":-1!=url.indexOf("home/team/")?"ts_hometeam":-1!=url.indexOf("/team/")?"ts_team":-1!=url.indexOf("home/user")?"ts_homeuser":void 0},isSelectedUser:function(pageMode){return"ts_teamuser"==(pageMode=void 0!=pageMode||null!=pageMode?pageMode:Timetracker.Page.getPageMode())||"ts_operuser"==pageMode||"ts_homeuser"==pageMode},isLoggedInUser:function(pageMode){return"ts_mydata"==(pageMode=void 0!=pageMode||null!=pageMode?pageMode:Timetracker.Page.getPageMode())||("ts_operuser"==pageMode||"ts_teamuser"==pageMode)&&Timetracker.timelogs.tserecno==erecno},getPageModeCode:function(){var url=settingsUrlProps.niceUrl;return-1!=url.indexOf("mydata")?"my_":-1!=url.indexOf("team/user")?"tu_":-1!=url.indexOf("operations/timetracker/searchuser")?"ou_":-1!=url.indexOf("operations")?"opr_":-1!=url.indexOf("home/team/")?"htm_":-1!=url.indexOf("/team/")?"tms_":void 0},isJobForm:function(mode){return!(-1===Layout.Page.hash.indexOf("/jobs/"+mode)&&!Timetracker.Page.isProjectDashboard("jobs")&&-1===Layout.Page.hash.indexOf("home/myspace/overview-jobs")&&-1===Layout.Page.hash.indexOf("home/user/jobs"))}},Timetracker.Team={selectedUser:null,initPage:function(userElement){let userId;if(userId=void 0!==userElement?$(userElement).attr("userId"):Timetracker.Page.Timelogs.isAddRecord()||Timetracker.Page.Timelogs.isEditRecord()||Timetracker.Page.Timelogs.isViewRecord()?Layout.Page.childUrlParam.userId:Layout.Page.urlparam.userId,Timetracker.Team.setSelectedUser(userId),userId){let backUrl=Timetracker.Team.getPreviousPageUrl();Layout.Page.Header.updateUser(userId,backUrl),Timetracker.Page.Timelogs.isListView()||Timetracker.Page.Timelogs.isCalendarView()||Timetracker.Page.Timelogs.isAddRecord()||Timetracker.Page.Timelogs.isEditRecord()||Timetracker.Page.Timelogs.isViewRecord()?Timetracker.timelogs.init():-1!==Layout.Page.hash.indexOf("user/timesheets")&&Timetracker.timesheet.init()}},useChildParams:function(){var urlAttr=settingsUrlProps.niceUrl.split("/").pop();return-1!=["viewtimelog","edittimelog","addtimelog"].indexOf(urlAttr)},setSelectedUser:function(user){void 0==user&&(user=Timetracker.Team.useChildParams()?Layout.Page.childUrlParam.userId:Layout.Page.urlparam.userId),Timetracker.Team.selectedUser=user,Timetracker.util.setUserErecno(user)},getSelectedUser:function(){return void 0==Timetracker.Team.selectedUser&&Timetracker.Team.setSelectedUser(),Timetracker.Team.selectedUser},updateUserDetail:()=>{let userId=Layout.Page.urlparam.userId;if(userId){let backUrl=Timetracker.Team.getPreviousPageUrl();var userDtls=ZPeople.getUserDetailsById(userId);return userDtls&&userDtls.usererec?'<div class="zpl_usrprfdv" name="header-profile">'+Layout.Page.Header.getUser(userDtls,backUrl)+"</div>":'<div class="zpl_usrprfdv" name="header-profile">'+Layout.Page.Header.getUser(ZPeople.CURR_USER,backUrl)+"</div>"}},getPreviousPageUrl:()=>{let pageContWrapperData=Layout.Page.pageContWrapper.data(),previousPageUrl="#timetracker/team/members";return 0==settingsUrlProps.niceUrl.indexOf("operations")||void 0===Layout.HashUtil.getPreviousHashConfig()||"timetracker/team/members"===Layout.HashUtil.getPreviousHashConfig().fullHash||"timetracker/team/projectmembers"===Layout.HashUtil.getPreviousHashConfig().fullHash?(0==settingsUrlProps.niceUrl.indexOf("operations")?previousPageUrl="#operations/timetracker/searchuser":void 0!==Layout.HashUtil.getPreviousHashConfig()&&"timetracker/team/projectmembers"===Layout.HashUtil.getPreviousHashConfig().fullHash&&(previousPageUrl="#timetracker/team/projectmembers"),pageContWrapperData.timesheetPrevSecondLevelUrl=previousPageUrl,Layout.Page.pageContWrapper.data(pageContWrapperData)):previousPageUrl=pageContWrapperData.timesheetPrevSecondLevelUrl,previousPageUrl},updateThirdLevelURLs:hash=>{Timetracker.Team.setSelectedUser();let user=Timetracker.Team.getSelectedUser();if(void 0!=user&&"undefined"!=user)return-1!=hash.indexOf("timelog")?-1==hash.indexOf("mode")?hash+"-":hash+"/userId:"+user:hash+"-userId:"+user},setTLTabParams:params=>{Timetracker.Team.setSelectedUser(),params.userErecno=Timetracker.Team.getSelectedUser()}},Timetracker.timelogs={tmpDate:null,monthtmpDate:null,weektmpDate:null,daytmpDate:null,dispMode:"0",tserecno:null,listId:null,starttimer:0,type:"",logdate:"",timeid:0,commentid:0,sec:0,min:0,hour:0,timesheetid:0,timersheetId:0,memdata:null,calObj:{},timeLogAllowedTypes:{manualLog:!0,fromToTimeLog:!0,automaticLog:!0},currentTimerJobData:null,ipaddflag:!0,iprestid:0,tabId:"",originTimelogs:!1,timesheetData:null,editMode:!1,formDetails:null,istimelogsdatafetched:!1,istimelogscaldatafetched:!1,timelogsPopulated:!1,refreshData:!0,skipResetOfTempDate:!1,imp_records:"",currentTimelogData:{},currentlyUnSubmittedhrs:0,monthData:{},breakLogsData:{},widgetLoaded:!1,init:function(){if(Timetracker.initSetup(),Timetracker.permissionCheckForOperPages())if(Timetracker.setWorkitemCache(),Timetracker.Page.Timelogs.isCalendarView())Timetracker.timelogs.calendar.getCalendarPage();else{if(!(Timetracker.Page.Timelogs.isListView()||Timetracker.Page.Timelogs.isAddRecord()||Timetracker.Page.Timelogs.isEditRecord()||Timetracker.Page.Timelogs.isViewRecord())){var pageMode=Timetracker.Page.getPageMode();"ts_mydata"==pageMode?window.location.href="#timetracker/mydata/timelogs-mode:list":"ts_teamuser"==pageMode?window.location.href="#timetracker/team/user/timelogs-mode:list/userId:"+Timetracker.Team.getSelectedUser():"ts_operuser"==pageMode&&(window.location.href="#operations/timetracker/searchuser/timelogs-mode:list/userId:"+Timetracker.Team.getSelectedUser())}Timetracker.timelogs.getTimelogsPage()}},getTimelogsPage:function(isLoad){Timetracker.timelogs.initTimelogsPage()},initTimelogsPage:function(){if(Timetracker.Page.Timelogs.isListView()){var layout=Timetracker.Util.getLayout();let filterDiv=TimetrackerOperations.Filters.getFilterDiv();if(0!==filterDiv.length&&"6"===TimelyZComp.select.getValue(filterDiv.find("[compname='period']"))){let fromDate=ZPeopleComponents.datefield(filterDiv.find("#tt_fromdate")).getValue().dateString,toDate=ZPeopleComponents.datefield(filterDiv.find("#tt_todate")).getValue().dateString,resetPeriod=void 0===fromDate||void 0===toDate||!Calendar.isvalidDate(fromDate)||!Calendar.isvalidDate(toDate);if(!resetPeriod){var fdate=Calendar.parseDate(fromDate,uidateFormat),tdate=Calendar.parseDate(toDate,uidateFormat);resetPeriod=fdate>tdate||Timetracker.DateTime.getDateDiff(fdate,tdate)>31}if(resetPeriod){let userViewType="ts_mydata"===Timetracker.Page.getPageMode()?Timetracker.generalSettings.getDefaultViewType(erecno):Timetracker.generalSettings.getDefaultViewType(Timetracker.Team.getSelectedUser());TimelyZComp.select.setValue(filterDiv.find("[compname='period']"),userViewType)}}var timelogsPage=layout.find("#timelogs_list_view");0==timelogsPage.length?(Timetracker.generalSettings.getSyncTimesheetSettings(),Timetracker.timelogs.constructTimelogsPage(),Timetracker.timelogs.refreshData=!0,Timetracker.Util.addEventListner("timelogs_list_view","click",Timetracker.timelogs.clickHandler,!0),TimelyZComp.toolTip.intiliaze()):(timelogsPage.removeClass("zpl_DNI"),layout.find("#timelogs_calendar_view").addClass("zpl_DNI")),Timetracker.timelogs.initTimelogs(),layout.find("#timelogs_list_view").on("click",function(event){0==$(event.target).parents("#singlecalendar").length&&0==$(event.target).parents("#doublecalendar").length&&(Calendar.hideSingleCalendar(),Calendar.hideDoubleCalendar(),Calendar.currentObj=null)})}else if(Timetracker.Page.Timelogs.isAddRecord()||Timetracker.Page.Timelogs.isEditRecord()||Timetracker.Page.Timelogs.isViewRecord()){let userErecNo=erecno;if(Timetracker.Page.isSelectedUser()&&(userErecNo=Timetracker.Team.getSelectedUser(),Timetracker.timelogs.resetCacheValues(),Timetracker.timelogs.refreshData=!0),Timetracker.util.setUserErecno(userErecNo),Timetracker.Page.Timelogs.isAddRecord()&&!Timetracker.util.allowAddingTimelogs())return Timetracker.util.showAlert(1,ZPI18N.getString("zp.notallowedtoedit")),void("ts_mydata"==pageMode?window.location.href="#timetracker/mydata/timelogs-mode:list":"ts_teamuser"==pageMode?window.location.href="#timetracker/team/user/timelogs-mode:list/userId:"+Timetracker.Team.getSelectedUser():"ts_operuser"==pageMode&&(window.location.href="#operations/timetracker/searchuser/timelogs-mode:list/userId:"+Timetracker.Team.getSelectedUser()));Timetracker.timelogs.formDetails=Timetracker.util.getFormDetails(Timetracker.timelogs.formDetails,"P_Timesheet");var formDetails={formId:Timetracker.timelogs.formDetails.formId};formDetails.formMode=Timetracker.Page.Timelogs.isAddRecord()?"ADD":Timetracker.Page.Timelogs.isEditRecord()?"EDIT":"VIEW",formDetails.createFldFunctions={JobId:Timetracker.forms.constructFormField,Project:Timetracker.forms.constructFormField,Billable_Status:Timetracker.forms.constructFormField,TotalHours:Timetracker.forms.constructFormField},formDetails.onloadCallback=Timetracker.forms.formOnLoadCallback,formDetails.callback=Timetracker.timelogs.forms.showListPage,formDetails.tableName="P_Timesheet",Timetracker.Page.Timelogs.isViewRecord()?(formDetails.recordId=Layout.Page.childUrlParam.recordId,formDetails.disableSingleEdit=!0):Timetracker.Page.Timelogs.isEditRecord()?(formDetails.recordId=Layout.Page.childUrlParam.recordId,Timetracker.timelogs.skipResetOfTempDate=!0):Timetracker.Page.Timelogs.isAddRecord()&&(Timetracker.timelogs.skipResetOfTempDate=!0),ZP5Form._toForm(formDetails).init()}},clickHandler:function(event){var ele=event.target,ref=$(ele).attr("ref");if("skip"!=ref)if(0!=$(ele).closest("tr").length&&0!=$(ele).closest("tbody").length&&-1!=$(ele).closest("tbody").attr("id").indexOf("timelogbody")){var data=$(ele).closest("tr").data("tsval");if(0===Object.keys(data).length)return;if("delete"==ref)if(data.isCurrentlyRunning)Timetracker.util.showAlert(1,ZPI18N.getString("zp.timerlogalert7"));else{var extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[ZPI18N.getString("zp.stimeLog")]),body:ZPI18N.getString("zp.common.delEntityInfo2",[ZPI18N.getString("zp.stimeLog")]),btnVal:ZPI18N.getString("zp.confirm")};Timetracker.Util.confirmpopUp(data.timelogId,Timetracker.timelogs.deleteTimeLog,data.timelogId,0,extraDtls)}else"checkbox"==ref?Timetracker.timelogs.util.checkParticularLog(ele):"timelogLoc"==ref?Timetracker.location.nontimerModalConstruction(ele):"timerEditPopup"==ref?Timetracker.timelogs.timer.showTimerEditModal(data):"nextStart"==ref?Timetracker.timelogs.timer.nextStart(ele):"pauseClock"==ref?Timetracker.timelogs.timer.pauseclock(ele):"fileDownload"==ref?data.attachId?Timetracker.util.downloadFile(data.attachId,data.timelogId,"timelog"):data.attachPath&&window.open(ZPeople.decodeTxt(data.attachPath)):"edit"==ref?Timetracker.timelogs.forms.formViewCallback(!1,data.timelogId):"view"==ref&&Timetracker.timelogs.forms.formViewCallback(!0,data.timelogId)}else{if(void 0==ref)return;if("startTimer"==ref||"pauseClock"==ref)Timetracker.timelogs.timer.pauseclock(ele);else if("checkall"==ref)Timetracker.timelogs.util.checkAll(ele);else if("multiDelete"==ref){var wDate=$(ele).attr("wDate");if(void 0==wDate)return;extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[ZPI18N.getString("zp.stimelogs")]),body:ZPI18N.getString("zp.common.delEntityInfo3",[ZPI18N.getString("zp.stimelogs")]),btnVal:ZPI18N.getString("zp.confirm")};Timetracker.Util.confirmpopUp(wDate,Timetracker.timelogs.multiSelectDelete,wDate,0,extraDtls)}else"toggleFilter"==ref?Timetracker.timelogs.constructFilter():"createTimesheet"==ref?Timetracker.timelogs.getCreateTimesheetList():"showHideDescPopup"==ref?Timetracker.timelogs.showHideDescPopup():"closeDescPopup"==ref?Timetracker.timelogs.closeDescPopup():"saveDescPopup"==ref?Timetracker.timelogs.saveDescPopup(ele):"bulkDescPopup"==ref?Timetracker.timelogs.bulkView.showHideDescPopup(ele):"breakPopup"==ref?Timetracker.BreakTimelogs.List.showAddBreakPopup(ele):"deleteNote"==ref&&Timetracker.timelogs.deleteNote(ele)}},constructTimelogsPage:function(){var pageMode=Timetracker.Page.getPageMode(),prefix=Timetracker.Page.getPageModeCode(),header='<div class="zpl_btnmnu"><div class="zpl_lft"></div><div class="zpl_cntrdv"><div class="zpl_inav"><i class="PI_alft" title="'+ZPI18N.getString("zp.previous")+'" aria-label="'+ZPI18N.getString("zp.common.previous")+'" tabindex="0" id="goToPreviousBtn"></i><i class="PI_monthly" id="tl_datePicker" aria-label="'+ZPI18N.getString("zp.selectdate")+'" tabindex="0" ></i><i class="PI_argt" aria-label="'+ZPI18N.getString("zp.common.next")+'" tabindex="0" title="'+ZPI18N.getString("zp.next")+'" id="goToNextBtn"></i></div><b id="dateNavigatorText"></b></div><div class="zpl_rgt">'+(Timetracker.generalSettings.isBreakEnabled()?'<div id="breakStopButton" class="zpl_brkrunbtn zpl_DNI"><div class="d-flexC d-flexclmcap5"><i id="brkRunImg" class="PI_brk"></i><b id="breakTimer"></b></div><span>'+ZPI18N.getString("zp.endbreak")+'</span></div><div id="breakStartButton" class="zpl_ico zpl_DNI"><span class="PI_brktime icn lv_bgclr7"  ref="breakPopup" title="'+ZPI18N.getString("zp.startbreak")+'"></span></div>':"")+'<div aria-label="Log Time" id="tlogviews" class="zbutton--split zbutton--splitprimary"><button id="addtimelogbutton" aria-label="Log Time" tabindex="0" role="button" class="zbutton zbutton--medium zbutton--primary zbutton--action" type="button" onclick="Timetracker.timelogs.util.redirectToAddTimelogPage();"><span class="zbutton__text">'+ZPI18N.getString("zp.logtime")+'</span></button><button id="'+prefix+'logselectBtn" class="zbutton zbutton--menu zbutton--medium zbutton--primary" type="button"><i class="zbutton__icon zh-floatright"><svg class="zbutton__svg zbutton__menuarrow" focusable="false"><use xlink:href="#zc__svg--downarrow"></use></svg></i></button></button></div><div class="grpbtn"> <i class="PI_listview zpl_act" onclick="Timetracker.timelogs.switchView(true)" title="'+ZPI18N.getString("zp.listview")+'"></i><i class="PI_monthly" onclick="Timetracker.timelogs.switchView(false)" title="'+ZPI18N.getString("zp.calendarview")+'"></i></div><i id="'+prefix+'filter_icon" class="zpl_ibg PI_fltr" aria-label="'+ZPI18N.getString("zp.filter")+'" tabindex="0" title="'+ZPI18N.getString("zp.filter")+'" ref="toggleFilter"></i><i id="'+prefix+'timelogmoredataBtn" class="zpl_ibg PI_more" aria-label="'+ZPI18N.getString("zp.more")+'" tabindex="0"  title="'+ZPI18N.getString("zp.more")+'"></i></div></div>'+TimetrackerOperations.Filters.filterHeaderHtml,timerBand='<div class="zpl_dfcrd zpl_timeband zpl_tmchkin zpl_psticky" id="timerarea" style="top:56px"><div class="d-flex zpl_DNI" id="tt_jobsch_brief_div"><div class="zpl_timebandlft"><b>'+ZPI18N.getString("zp.jobschtoday")+'</b><div class="d-flexclmcap20" id="jsch_brief_divs"></div></div></div><div class="d-flex"><div class="zpl_timebandlft"><div class="zpl_slct" id="divClient"><input id="timerclients" style="width: 180px;"></div><div class="zpl_slct" id="divProject"><Input id="timerprojects" clientId="timerclients" jobId="timerjobs" style="width: 180px;"></div><div class="zpl_slct"><input id="timerjobs" projectId="timerprojects" style="width: 180px;"></div><div class="zpl_slct" id="workitemId"><input id="timertask" class="ztextbox" placeholder="'+ZPI18N.getString("zp.whatareyouworkingon")+'" title="'+ZPI18N.getString("zp.enterentity",[Timetracker.util.getWorkItemDispName(!1,!0)])+'"></div><div class="zpl_slct" id="billStDiv"><select id="timerbill" style="width: 150px;"><option value="0">'+ZPI18N.getString("zp.billable")+'</option><option value="1">'+ZPI18N.getString("zp.nonbillable")+'</option></select></div><span id="timerDesc" class="PI_note icn" ref="showHideDescPopup" title="'+Timetracker.util.getDescriptionDispName()+'"></span></div><div class="zpl_timebandrgt"><div class="zpl_tmrunmid"><div class="zpl_chk-in" name="timerButton" onclick="Timetracker.timelogs.timer.pauseclock(this)" id="checkInButton"><div><b name="timerButton" id="watch">00:00:00</b></div><span id="timerstart"><i class="PI_timer"></i></span><span class="zpl_DNI" id="timerrunning"><img src="'+ZPeople.getResourceURL(newUIImageUrl+"timer.gif")+'"></span><span class="zpl_DNI" id="timerloading"><div class="zpl_ldngring"><div></div><div></div><div></div><div></div></div></span></div></div></div></div></div>';Timetracker.jobSchedule.hasCustomFields()&&(timerBand+='<div class="zpl_dfcrd zpl_DNI" id="main_jsch_dtl_id"><div class="zpl_ttrstcnhdr opn" id="exp_id"><i class="PI_atop"></i><h5>Schedule</h5></div><div class="zpl_ttrstcnbx zpl_DNI" id="jsch_dtl_div"></div></div>');var html='<div id="timelogs_list_view">'+header+'<div class="zpl_rgtcnt" id="timelogBody">'+timerBand+'<div class="zpl_secn" id="timelogslistview"><div class="zpl_tblres" id="listviewtable"></div></div>'+('<div class="zpl_tblpagination" id="timelog_footer"><div class="zpl_rhtpgn"><div class="zpl_viewdays"><div class="zpl_dytyp blubdr zpl_cpd"><span class="blu"><b id="total_hours">00:00 Hrs</b></span><span>'+ZPI18N.getString("zp.total")+'</span></div><div class="zpl_dytyp grnbdr1 zpl_cpd"><span class="grn"><b id="submitted_hours">00:00 Hrs</b></span><span>'+ZPI18N.getString("zp.submitted")+'</span></div><div class="zpl_dytyp nosubmt zpl_cp" onclick="Timetracker.timelogs.getCreateTimesheetList();"><span class="ylw"><b id="not_submitted_hours">00:00 Hrs</b></span><span>'+ZPI18N.getString("zp.notsubmitted")+'</span><a><i class="PI_argt ylw"></i></a></div></div></div></div>')+"</div></div>",layout=Timetracker.Util.getLayout();layout.find("#timelogs_calendar_view").addClass("zpl_DNI"),layout.append(html);var descPopover='<div id="timerDescPopup" class="zpl_popovr" data-type="popover" style="display: none;"> <div class="zpl_popoverinr"> <div class="text-right"> <a class="_cls PI_cls red" ref="closeDescPopup" title="'+ZPI18N.getString("zp.close")+'"></a></div><div id="timerDescInp" class="d-flexclm8 w250"><div><textarea rows="5" class="ztextbox"></textarea></div><div><button class="zlabel zlabel--blue zlabel--small" ref="saveDescPopup">'+ZPI18N.getString("zp.ok")+'</button></div></div><div id="timerDescView" class="w250 zpl_DNI"><span></span></div> </div></div>';layout.find("#timerDesc").parent().append(descPopover),ZPeopleComponents.popover(layout.find("#timerDescPopup"),{displayType:"callout",closeOnBodyClick:!0,forElement:layout.find(".zpl_timebandlft").find("#timerDesc")});var timelogType=[{id:"logtimebutton","aria-label":ZPI18N.getString("zp.logtime"),tabindex:0,name:ZPI18N.getString("zp.logtime"),callback:"Timetracker.timelogs.util.redirectToAddTimelogPage"},{id:"dailylogtime","aria-label":ZPI18N.getString("zp.dailylog"),tabindex:0,name:ZPI18N.getString("zp.dailylog"),callback:"Timetracker.timelogs.bulkView.showDayWeekMonthLogTimeCallback"},{id:"weeklylogtime","aria-label":ZPI18N.getString("zp.weeklylog"),tabindex:0,name:ZPI18N.getString("zp.weeklylog"),callback:"Timetracker.timelogs.bulkView.showDayWeekMonthLogTimeCallback"},{id:"halfmonthlylogtime","aria-label":ZPI18N.getString("zp.semimonthlylog"),tabindex:0,name:ZPI18N.getString("zp.semimonthlylog"),callback:"Timetracker.timelogs.bulkView.showDayWeekMonthLogTimeCallback"},{id:"monthlylogtime","aria-label":ZPI18N.getString("zp.monthlylog"),tabindex:0,name:ZPI18N.getString("zp.monthlylog"),callback:"Timetracker.timelogs.bulkView.showDayWeekMonthLogTimeCallback"}],logSelBtnId=prefix+"logselect";Timetracker.Util.constructMoreOption(timelogType,logSelBtnId,null,null,{skipIcon:!0,direction:"bottom",container:layout.find("#timelogs_list_view")});var moreOpt=[{id:"timelogImport",name:ZPI18N.getString("zp.import"),callback:"Timetracker.timelogs.Import.construct",iClass:"PI_imprt"},{id:"timelogExport",name:ZPI18N.getString("zp.export"),callback:"Timetracker.timelogs.timelogExportCallback",iClass:"PI_exprt"}];Timetracker.util.allowAddingTimelogs()||moreOpt.splice(0,1);var moreBtnId=prefix+"timelogmoredata";Timetracker.Util.constructMoreOption(moreOpt,moreBtnId,null,null,{container:layout.find("#timelogs_list_view"),appendTo:layout.find("#timelogs_list_view")}),settingsPage.container.addClass("zpl_ttlstvw");var dateNavigationDtls={};dateNavigationDtls.mode=Timetracker.timelogs.Firescroll.getMode(),dateNavigationDtls.containerId=settingsPage.container.attr("id"),dateNavigationDtls.previousBtnId="goToPreviousBtn",dateNavigationDtls.nextBtnId="goToNextBtn",dateNavigationDtls.displayAreaId="dateNavigatorText",dateNavigationDtls.displayDateAsText=!0,dateNavigationDtls.navigationCallback=Timetracker.timelogs.getTimelogRecords,ZPCommonUtil.DateNavigator.init(dateNavigationDtls),Timetracker.timelogs.setDateHeader();var dateRange=void 0!=layout.find("#dateNavigatorText").text()?layout.find("#dateNavigatorText").text():"";layout.find("#dateNavigatorText").parent().attr({"aria-label":ZPI18N.getString("zp.common.period")+dateRange,tabindex:"0"});var userViewType="ts_mydata"==pageMode?Timetracker.generalSettings.getDefaultViewType(erecno):Timetracker.generalSettings.getDefaultViewType(Timetracker.Team.getSelectedUser());layout.find("#timelogs_list_view").find("#tl_datePicker").attr("mode",dateNavigationDtls.mode);var callback=Timetracker.timelogs.timelogDateNavCallBack;layout.find("#timelogs_list_view").find("#tl_datePicker").off().on("click",function(event){var viewType=0!=settingsPage.container.find("[compname='period']").length?TimetrackerOperations.Filters.getSelectFilterValues(settingsPage.container.find("[compname='period']")):userViewType;if(6==viewType)Calendar.setUpDoubleCalendar(event,this,0,void 0,callback);else if(1==viewType||4==viewType)Calendar.setUpCalendar(event,this,void 0,void 0,callback,void 0,{weekselection:!0,constructOnWeekstarts:!0});else{var type=2==viewType||5==viewType?2:0;Calendar.setUpCalendar(event,this,type,void 0,callback,void 0,{constructOnWeekstarts:!0})}}),layout.parent().parent().attr({"aria-label":ZPI18N.getString("zp.common.tabname",[ZPI18N.getString("zp.timelogs")]),tabindex:"0"})},showHideDescPopup:function(){if(settingsPage.container.find("#timerDescPopup").is(":visible"))Timetracker.timelogs.closeDescPopup();else{Timetracker.util.removeErrorMsg("timerDescInp");var descCont=Layout.Page.container.find("#timerDesc").data().timerDesc;descCont&&Layout.Page.container.find("#timerDescInp").find("textarea").val(descCont),ZPeopleComponents.popover(Layout.Page.container.find("#timerDescPopup")).open()}},registerDescViewPopup(descTxt,layout){layout=layout||Timetracker.Util.getLayout(),void 0!==descTxt&&""!==descTxt.trim()&&null!==descTxt||(descTxt=ZPI18N.getString("zp.nodescprovided",[Timetracker.util.getDescriptionDispName(!0)])),layout.find("#timerDescPopup").find("#timerDescInp").find("textarea").val(ZPeople.decodeTxt(descTxt)),layout.find("#timerDescPopup").find("#timerDescView").find("span").text(ZPeople.decodeTxt(descTxt)),layout.find("#timerDescPopup").find("#timerDescInp").addClass("zpl_DNI"),layout.find("#timerDescPopup").find("#timerDescView").removeClass("zpl_DNI"),layout.find("#timerDesc").removeClass("lv_bgclr5").addClass("lv_bgclr2"),layout.find("#timerDesc").data().timerDesc=ZPeople.decodeTxt(descTxt)},registerDescInputDropdown:function(isFromTimerStop){Layout.Page.container.find("#timerDescIcon").hasClass("Tclr")&&Layout.Page.container.find("#timerDescIcon").removeClass("Tclr").addClass("gry"),Layout.Page.container.find("#timerDescIcon").off("click").on("click",function(e){Layout.Page.container.find("#descInpBox_timer").addClass("active")}),Layout.Page.container.find("#closeDesc").off("click").on("click",function(e){e.stopPropagation(),""===Layout.Page.container.find("#timerDescIcon").data("timerDesc")&&Layout.Page.container.find("#descTextArea").val("");var descInpBox=Layout.Page.container.find("#descInpBox_timer");$(descInpBox).removeClass("active")}),Layout.Page.container.find("#saveDescButton").off("click").on("click",function(e){e.stopPropagation(),Timetracker.timelogs.saveDescInTimerBand()}),isFromTimerStop&&Timetracker.timelogs.resetDescModal(),$(document).on("click",function(event){var Obj=$(event.target);"timerDescIcon"!==Obj.attr("id")&&"descInpBox_timer"!==Obj.attr("id")&&"descTextArea"!==Obj.attr("id")&&"saveDescButton"!==Obj.attr("id")&&Timetracker.timelogs.animateDescModal("descInpBox_timer")})},resetDescModal:function(){Layout.Page.container.find("#timerDesc").data({timerDesc:""}).removeClass("lv_bgclr5 lv_bgclr2"),Layout.Page.container.find("#timerDescPopup").find("textarea").val("").prop("disabled",!1),Layout.Page.container.find("#timerDescPopup").find("#timerDescInp").removeClass("zpl_DNI"),Layout.Page.container.find("#timerDescPopup").find("#timerDescView").addClass("zpl_DNI"),Layout.Page.container.find("#descTextArea").val(""),Layout.Page.container.find("#timerDescIcon").data("timerDesc","")},animateDescModal:function(descBoxId){Layout.Page.container.find("#"+descBoxId).removeClass("active")},closeDescPopup:function(){Timetracker.util.removeErrorMsg("timerDescInp"),ZPeopleComponents.popover(Layout.Page.container.find("#timerDescPopup")).close()},saveDescPopup:function(obj){var descPopup=Layout.Page.container.find("#timerDescPopup");if(Timetracker.timelogs.validateAndShowErrorForDesc(descPopup)){var descCont=descPopup.find("#timerDescInp").find("textarea").val();""==descCont.trim()?(settingsPage.container.find("#timerDesc").data({timerDesc:descCont}).removeClass("lv_bgclr2"),descPopup.find("#timerDescView").find("span").val(descCont.trim())):(settingsPage.container.find("#timerDesc").data({timerDesc:descCont}).removeClass("lv_bgclr5").addClass("lv_bgclr2"),descPopup.find("#timerDescView").find("span").val(descCont)),Timetracker.timelogs.closeDescPopup()}},validateAndShowErrorForDesc:function(descPopup){Timetracker.util.removeErrorMsg("timerDescInp");var descCont=descPopup.find("#timerDescInp").find("textarea").val(),isValid=!0,displayName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.DESC);return""===descCont.trim()&&Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.DESC)?(isValid=!1,errMsg=ZPI18N.getString("zp.entervalforfield",[displayName])):-1!==descCont.indexOf(">")||-1!==descCont.indexOf("<")?(isValid=!1,errMsg=ZPI18N.getString("zp.charactorremove",["<,>"])):descCont.length>250&&(isValid=!1,errMsg=ZPI18N.getString("zp.fieldlength",[displayName,"250"])),isValid||Timetracker.Util.appenErrorMsgForElem({obj:descPopup.find("#timerDescInp").find("textarea"),msg:errMsg,appendTo:descPopup.find("#timerDescInp").find("textarea").parent()}),isValid},timelogDateNavCallBack:function(dateVal,obj,data){var layout=Timetracker.Util.getLayout();layout.find("#tl_datePicker").html("");var pageMode=Timetracker.Page.getPageMode(),viewType=2;Timetracker.Page.Timelogs.isListView()&&(viewType=0!=layout.find("[compname='period']").length?TimetrackerOperations.Filters.getSelectFilterValues(settingsPage.container.find("[compname='period']")):"ts_mydata"==pageMode?Timetracker.generalSettings.getDefaultViewType(erecno):Timetracker.generalSettings.getDefaultViewType(Timetracker.Team.getSelectedUser()));var extraDtls={},hideDateNav=!1;if(1==viewType||4==viewType)extraDtls.from=data.fromDate,extraDtls.to=data.toDate,extraDtls.type=ZPCommonUtil.DateNavigator.TYPE.WEEKLY;else if(6==viewType){var calDiv=layout.find("#timelogs_list_view").find("#tl_datePicker");if("fromcalendar"==obj.calcontId)return obj.clickedEle&&($(obj.clickedEle).closest("tbody").find(".leave").removeClass("leave"),$(obj.clickedEle).addClass("leave")),void calDiv.data({fromValue:dateVal});if(void 0==(data=calDiv.data()).fromValue||data.fromValue>dateVal)return void Timetracker.util.showAlert(1,ZPI18N.getString("zp.greaterfromdate"));if(Timetracker.DateTime.getDateDiff(data.fromValue,dateVal)>31)return void Timetracker.util.showAlert(1,ZPI18N.getString("zp.datewithindays",["31"]));extraDtls.from=data.fromValue,extraDtls.to=dateVal,extraDtls.type=ZPCommonUtil.DateNavigator.TYPE.CUSTOM,hideDateNav=!0,obj=calDiv}else if(0==viewType||3==viewType)extraDtls.day=dateVal,extraDtls.type=ZPCommonUtil.DateNavigator.TYPE.DAILY;else{extraDtls.from=dateVal;var curyear=dateVal.getFullYear(),curmonth=dateVal.getMonth(),toVal=new Date(curyear,curmonth);toVal.setDate(new Date(curyear,curmonth+1,0).getDate()),extraDtls.to=toVal,extraDtls.type=ZPCommonUtil.DateNavigator.TYPE.MONTHLY}var mode=$(obj).attr("mode");ZPCommonUtil.DateNavigator.setPeriod(mode,extraDtls.type,void 0,hideDateNav,extraDtls),Timetracker.Page.Timelogs.isListView()?Timetracker.timelogs.getTimelogsListView():(Timetracker.timelogs.calObj.curYear=dateVal.getFullYear(),Timetracker.timelogs.calObj.curMonth=dateVal.getMonth(),NewCalendar.constructCalendar(Timetracker.timelogs.calObj))},switchView:function(toListView){var url=Layout.Page.hash.slice(1);url=toListView?url.replace("calendar","list"):url.replace("list","calendar"),ZPTabs.changeTab(url)},constructFilter:function(){if(0==settingsPage.container.find("#filterDiv").length){filterOpt={period:{single:!0,label:ZPI18N.getString("zp.period")},fromdate:{label:ZPI18N.getString("zp.fromdate"),type:"input",id:"tt_fromdate"},todate:{label:ZPI18N.getString("zp.todate"),type:"input",id:"tt_todate"},client:{label:Timetracker.util.getClientDisplayName(),paramId:"clientId",tokenField:!0},project:{label:Timetracker.util.getProjectDisplayName(),paramId:"projectId",tokenField:!0},job:{label:Timetracker.util.getJobDisplayName(),paramId:"jobId",tokenField:!0},billableStatus:{single:!0,label:ZPI18N.getString("zp.billablestatus"),paramId:"typeMode",defValue:-1},approvalStatus:{single:!0,label:ZPI18N.getString("zp.approvalstatus"),paramId:"approvalStatus",defValue:0}},Timetracker.timelogs.isClientFieldAllowed()||delete filterOpt.client,Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)||delete filterOpt.billableStatus,TimetrackerOperations.Filters.constructFilterDiv(filterOpt);var config={calendarIcon:!0,format:dateFmt,picker:!0,spinButtons:"none",clearButton:"none"},filterDiv=settingsPage.container.find("#filterDiv");ZPeopleComponents.datefield(filterDiv.find("#tt_fromdate"),config),ZPeopleComponents.datefield(filterDiv.find("#tt_todate"),config),$(filterDiv).find(".zpl_search").remove(),filterDiv.find('[compname="period"]').off().on("zselectchange",function(){var container=settingsPage.container.find("#filterDiv"),preiodDiv=container.find('[compname="period"]');if(6==TimelyZComp.select.getValue(preiodDiv)){if(Timetracker.util.removeErrorMsg("filterDiv"),ZPCommonUtil.DateNavigator.getType(Timetracker.timelogs.Firescroll.getMode())!==ZPCommonUtil.DateNavigator.TYPE.CUSTOM)ZPeopleComponents.datefield(filterDiv.find("#tt_fromdate")).clear(),ZPeopleComponents.datefield(filterDiv.find("#tt_todate")).clear();else{let customPeriodDate=ZPCommonUtil.DateNavigator.getPeriod(Timetracker.timelogs.Firescroll.getMode());void 0!==customPeriodDate.from&&void 0!==customPeriodDate.to&&(ZPeopleComponents.datefield(filterDiv.find("#tt_fromdate")).setValue(customPeriodDate.from),ZPeopleComponents.datefield(filterDiv.find("#tt_todate")).setValue(customPeriodDate.to))}container.find("#tt_fromdate").parent().parent().removeClass("zpl_DNI"),container.find("#tt_todate").parent().parent().removeClass("zpl_DNI")}else container.find("#tt_fromdate").parent().parent().addClass("zpl_DNI"),container.find("#tt_todate").parent().parent().addClass("zpl_DNI")}),Timetracker.Util.addEventListner("filterDiv","click",Timetracker.timelogs.calendar.clickHandler,!0),Timetracker.timelogs.resetFilter()}Timetracker.Page.Timelogs.isCalendarView()?(settingsPage.container.find("#filterDiv").find('[compname="period"]').parent().parent().addClass("zpl_DNI"),settingsPage.container.find("#tt_fromdate").parent().parent().addClass("zpl_DNI"),settingsPage.container.find("#tt_todate").parent().parent().addClass("zpl_DNI")):(settingsPage.container.find("#filterDiv").find('[compname="period"]').parent().parent().removeClass("zpl_DNI"),settingsPage.container.find("#filterDiv").find('[compname="period"]').trigger("zselectchange")),TimetrackerOperations.Filters.toggleFilter(),TimelyZComp.toolTip.intiliaze(filterDiv)},resetFilter:function(){var filterDiv=Layout.Page.container.find("#filterDiv");if(0!=filterDiv.length){TimetrackerOperations.Filters.clearFilters(),Timetracker.util.removeErrorMsg("filterDiv",filterDiv),filterDiv.find("#tt_fromdate").parent().parent().addClass("zpl_DNI"),filterDiv.find("#tt_todate").parent().parent().addClass("zpl_DNI");var emp="ts_mydata"==Timetracker.Page.getPageMode()?erecno:Timetracker.Team.getSelectedUser(),viewType=Timetracker.generalSettings.getDefaultViewType(emp);TimelyZComp.select.setValue(filterDiv.find('[compname="period"]'),viewType),0!=filterDiv.find('[compname="billableStatus"]').length&&TimelyZComp.select.setValue(filterDiv.find('[compname="billableStatus"]'),-1),TimelyZComp.select.setValue(filterDiv.find('[compname="approvalStatus"]'),0)}},applyFilter:function(){(Timetracker.util.removeErrorMsg("filterDiv"),Timetracker.timelogs.setDateHeader())&&(Timetracker.Util.getLayout().find("#timelogs_list_view").find("#tt_filterResultsHeader.timetracker").addClass("zpl_DNI"),Timetracker.timelogs.getTimelogsListView(!0,-1))},removeTopFilter:function(event,clearAll){if(clearAll)Timetracker.timelogs.resetFilter();else{var ele=event.target,entity=$(ele).closest("li").attr("filterno");filterDiv=settingsPage.container.find("#filterDiv"),"billableStatus"==entity?TimelyZComp.select.setValue(filterDiv.find('[compname="billableStatus"]'),-1):"approvalStatus"==entity?TimelyZComp.select.setValue(filterDiv.find('[compname="approvalStatus"]'),0):TimelyZComp.tokenField.removeAllTokens(filterDiv.find('[compname="'+entity+'"]'))}Timetracker.timelogs.applyFilter(),Timetracker.timelogs.calendar.refreshData=!0},setDateHeader:function(){var periodtype,tenseBasedOnShift,layout=Timetracker.Util.getLayout().find("#filterDiv"),preiodDiv=layout.find('[compname="period"]');if(0==preiodDiv.length){var emp="ts_mydata"==Timetracker.Page.getPageMode()?erecno:Timetracker.Team.getSelectedUser();let viewtype=Timetracker.timelogs.getDefaultViewType(emp);periodtype=viewtype.periodtype,tenseBasedOnShift=viewtype.tense}else periodtype=TimelyZComp.select.getValue(preiodDiv);var type=ZPCommonUtil.DateNavigator.TYPE.MONTHLY,tense=void 0!=tenseBasedOnShift?tenseBasedOnShift:ZPCommonUtil.DateNavigator.TENSE.CURRENT,hideNavigation=!1,customDatePeriod=void 0;switch(periodtype){case"0":type=ZPCommonUtil.DateNavigator.TYPE.DAILY,tense=void 0!=tenseBasedOnShift?tenseBasedOnShift:ZPCommonUtil.DateNavigator.TENSE.CURRENT;break;case"1":type=ZPCommonUtil.DateNavigator.TYPE.WEEKLY,tense=void 0!=tenseBasedOnShift?tenseBasedOnShift:ZPCommonUtil.DateNavigator.TENSE.CURRENT;break;case"3":type=ZPCommonUtil.DateNavigator.TYPE.DAILY,tense=ZPCommonUtil.DateNavigator.TENSE.PREVIOUS;break;case"4":type=ZPCommonUtil.DateNavigator.TYPE.WEEKLY,tense=ZPCommonUtil.DateNavigator.TENSE.PREVIOUS;break;case"5":type=ZPCommonUtil.DateNavigator.TYPE.MONTHLY,tense=ZPCommonUtil.DateNavigator.TENSE.PREVIOUS;break;case"6":if(type=ZPCommonUtil.DateNavigator.TYPE.CUSTOM,tense=void 0,hideNavigation=!0,customDatePeriod={},TimetrackerOperations.Filters.getFormToDatefromPeriodFilter(customDatePeriod,layout,"tt_fromdate","tt_todate","2"),void 0==customDatePeriod.fromDate&&void 0==customDatePeriod.toDate)return!1;customDatePeriod={from:Calendar.parseDate(customDatePeriod.fromDate,uidateFormat),to:Calendar.parseDate(customDatePeriod.toDate,uidateFormat)}}return ZPCommonUtil.DateNavigator.setPeriod(Timetracker.timelogs.Firescroll.getMode(),type,tense,hideNavigation,customDatePeriod),!0},getDefaultViewType:function(emp){var viewType=Timetracker.generalSettings.getDefaultViewType(emp);if(Timetracker.isTTSthiftEnabled()){var tense=ZPCommonUtil.DateNavigator.TENSE.CURRENT;let shiftDate=Timetracker.generalSettings.getTSSettings(emp).TS_shiftDate;var sdate=Calendar.parseDate(shiftDate,uidateFormat);if(0==viewType){let curDay=Calendar.getCurrentDate();curDay<sdate?tense=ZPCommonUtil.DateNavigator.TENSE.NEXT:curDay>sdate&&(tense=ZPCommonUtil.DateNavigator.TENSE.PREVIOUS)}else if(1==viewType){let curWeek=Calendar.getCurrentWeek();curWeek.from>sdate?tense=ZPCommonUtil.DateNavigator.TENSE.PREVIOUS:curWeek.to<sdate&&(tense=ZPCommonUtil.DateNavigator.TENSE.NEXT)}else if(2==viewType){let curMonth=Calendar.getCurrentMonth();curMonth.from>sdate?tense=ZPCommonUtil.DateNavigator.TENSE.PREVIOUS:curMonth.to<sdate&&(tense=ZPCommonUtil.DateNavigator.TENSE.NEXT)}return{periodtype:viewType,tense:tense}}return{periodtype:viewType}},getDefaultTimelogParams:function(){var params={mode:"getTimesheet",isTimerDetails:!0,isCommentsCount:!0,isTotalHours:!0,clientId:"0",projectId:"0",jobId:"0",approvalStatus:"0",typeMode:"-1",conreqcsr:csrfToken};return Timetracker.Page.Timelogs.isSelfServiceListView()||(params.sIndex=Timetracker.FireScroll.getFetchCount(Timetracker.timelogs.Firescroll.getMode()),params.limit=Timetracker.FireScroll.getMaxFetchCount(Timetracker.timelogs.Firescroll.getMode())),params.sIndex=0,params.limit=Timetracker.timesheet.MAXTIMESHEET_FETCH_COUNT,params},getParamsToFetchTimelogs:function(){var params=Timetracker.timelogs.getDefaultTimelogParams(),layout=Timetracker.Util.getLayout();if(TimetrackerOperations.Filters.getFormToDatefromPeriodFilter(params,layout.find("#filterDiv"),"tt_fromdate","tt_todate","2"),void 0==params.fromDate||void 0==params.toDate)return null;0!=layout.find("#filterDiv").length&&TimetrackerOperations.Filters.getFilterValues(params);var datePeriod=ZPCommonUtil.DateNavigator.getPeriod(Timetracker.timelogs.Firescroll.getMode());void 0!==datePeriod&&(void 0!==datePeriod.from&&void 0!==datePeriod.to?(params.fromDate=Calendar.formatDate(datePeriod.from),params.toDate=Calendar.formatDate(datePeriod.to)):(params.fromDate=Calendar.formatDate(datePeriod.day),params.toDate=Calendar.formatDate(datePeriod.day))),Timetracker.timelogs.isClientFieldAllowed()||delete params.clientId;var pageMode=Timetracker.Page.getPageMode();return"ts_mydata"==pageMode||Timetracker.UserSpace.isMySpace()?params.userErecNo=Timetracker.timelogs.tserecno:Timetracker.Page.isSelectedUser(pageMode)&&(params.userErecNo=Timetracker.Team.getSelectedUser()),"ts_mydata"==pageMode&&Timetracker.generalSettings.isJobSchDatainTLEnabled()&&(params.fetchTLJobschDtls=!0),ZPUtil.checkIsOtherUserProfile()&&(params.isFmSService=!0),null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients&&null!==Timetracker.timelogs.currentTimerJobData&&(params.requireClientDetails=!0),params},resetCacheValues:function(){Timetracker.timelogs.istimelogsdatafetched=!1,Timetracker.timelogs.istimelogscaldatafetched=!1},resetTLFetch:function(isBasedOnUrl){isBasedOnUrl?(Timetracker.timelogs.refreshData=!Timetracker.Page.Timelogs.isListView(),Timetracker.timelogs.calendar.refreshData=!0,Timetracker.UserSpace.Timelogs.isRefreshNeeded=!Timetracker.UserSpace.isMySpaceTimelogs(),$("[id=timelogs_list_view]").data("isPageLoaded",!1),Layout.Page.container.find("#timelogs_list_view").data("isPageLoaded",!1)):(Timetracker.timelogs.refreshData=!0,Timetracker.timelogs.calendar.refreshData=!0,Timetracker.UserSpace.Timelogs.isRefreshNeeded=!0,(Timetracker.Page.Timelogs.isListView()||Timetracker.Page.Timelogs.isCalendarView())&&Timetracker.timelogs.resetFilter(),$("[id=timelogs_list_view]").data("isPageLoaded",!1))},initTimelogs:async function(){var pageMode=Timetracker.Page.getPageMode();let userErecNo=Timetracker.Page.isSelectedUser(pageMode)?Timetracker.Team.getSelectedUser():erecno;Timetracker.Page.isSelectedUser(pageMode)&&userErecNo!=Timetracker.timelogs.tserecno&&(Timetracker.timelogs.resetCacheValues(),Timetracker.timelogs.refreshData=!0),Timetracker.util.setUserErecno(userErecNo);var layout=Layout.Page.container,refreshPage=Timetracker.Page.isLoggedInUser(pageMode)&&1!=layout.find("#timelogs_list_view").data("isPageLoaded");if(Timetracker.Page.Timelogs.isListView()||Timetracker.UserSpace.isMySpaceTimelogs()){if(!Timetracker.timelogs.timelogsPopulated||Timetracker.timelogs.refreshData||refreshPage||Timetracker.UserSpace.isMySpace()){if(Timetracker.generalSettings.isBreakEnabled()&&Timetracker.BreakTimelogs.List.setValuesInBreakButton("RESET"),Timetracker.Page.isLoggedInUser(pageMode)&&Timetracker.generalSettings.isAutomaticLogAllowed(userErecNo)){TimelyZComp.select.intialize(layout.find("#timerbill"),{randomDropdownListId:!0,dropdownList:{appendTo:Timetracker.Util.getLayout(),moveOnScroll:!0}}),Timetracker.clients.getClients("timerclients",null,null,!1,userErecNo,void 0,{isV5:!0}),await Timetracker.projects.Filters.createProjectSelect(!0,userErecNo,"0","timerLogTime",void 0,void 0,void 0,Timetracker.constants.TTCustomAdmin.EntryView);var clientSel=layout.find("#timerclients"),projSel=layout.find("#timerprojects"),jobSel=layout.find("#timerjobs");clientSel.off("zselectchange").on("zselectchange",function(event,data){if(data.fromUI){var clientId=data.selectedValue;Timetracker.projects.Filters.createProjectSelect(!0,userErecNo,clientId,"timerLogTime",null,"0",null,Timetracker.constants.TTCustomAdmin.EntryView)}}),projSel.off("zselectchange").on("zselectchange",function(event,data){if(data.fromUI){var cltid=TimetrackerOperations.Filters.getSelectFilterValues(clientSel),projId=data.selectedValue;Timetracker.jobs.Filters.createJobSelect(userErecNo,"0","timerLogTime",projId,cltid,Timetracker.constants.TTCustomAdmin.EntryView)}}),jobSel.off("zselectchange").on("zselectchange",function(event,data){data.fromUI&&Timetracker.timelogs.jobChange("timerLogTime",void 0)})}Timetracker.UserSpace.isMySpace()||(!Timetracker.timelogs.istimelogsdatafetched||Timetracker.Page.Timelogs.isSelfServiceListView()?(Timetracker.timelogs.originTimelogs=!1,Timetracker.timelogs.timesheetData=null,Timetracker.timelogs.getTimelogsListView(!0,"-1",!0,Timetracker.timelogs.skipResetOfTempDate),Timetracker.timelogs.timelogsPopulated=!0,Timetracker.timelogs.skipResetOfTempDate=!0):(Timetracker.timelogs.originTimelogs=!1,Timetracker.timelogs.timesheetData=null,Timetracker.timelogs.getTimelogsListView(!0,"-1",!0,Timetracker.timelogs.skipResetOfTempDate,!0),Timetracker.timelogs.timelogsPopulated=!0,Timetracker.timelogs.skipResetOfTempDate=!0)),Timetracker.jobSchedule.timelogsView.eventHandlingsJobSchDtls("CLR_SEL_CLS","timelogs_list_view")}else TimetrackerOperations.Filters.isFilterOpen()&&TimetrackerOperations.Filters.toggleFilter(),Timetracker.jobSchedule.hasCustomFields()&&0!==Layout.Page.container.find("#tt_jobsch_brief_div").find("#jsch_brief_divs").children().length&&Timetracker.jobSchedule.timelogsView.eventHandlingsJobSchDtls("JSCH_BRIEF_LIST","timelogs_list_view");Timetracker.Util.removeError(layout.find("#timertask")),!Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.CLIENT)&&Timetracker.UserSpace.isMySpaceTimelogs()&&Layout.Page.container.find("#workitemId").find("#timertask").addClass("mw200");let jobId="0";if(0!==layout.find("#timerjobs").length&&ZPeopleComponents.isComponent(layout.find("#timerjobs"))&&(jobId=TimelyZComp.select.getValue(layout.find("#timerjobs"))),Timetracker.timelogs.workItem.checkIfDropDownNeededForWorkitem({jobId:jobId})){let appendDiv=Timetracker.UserSpace.isMySpace()?Layout.Page.parentContainer:layout;Timetracker.timelogs.workItem.createDropdownForWorkitem({elementId:"timertask",jobId:jobId,dropdownAppendTo:appendDiv})}else Timetracker.timelogs.workItem.destroySelect2ApplyInput({eleId:"timertask"});Timetracker.Page.Timelogs.isListView()&&(Timetracker.timelogs.refreshData=!1),layout.find("#timelogs_list_view").data("isPageLoaded",!0)}},getTimelogsListView:function(flag,prenxt,initflag,skipResetTmpDate,isTabInvoke,extraDtls){if(initflag&&Timetracker.generalSettings.getSyncTimesheetSettings(),flag){Timetracker.timelogs.timeLogAllowedTypes.automaticLog=!!Timetracker.generalSettings.isAutomaticLogAllowed(Timetracker.timelogs.tserecno),Timetracker.timelogs.timeLogAllowedTypes.manualLog=!!Timetracker.generalSettings.isManualLogAllowed(Timetracker.timelogs.tserecno),Timetracker.timelogs.timeLogAllowedTypes.fromToTimeLog=!!Timetracker.generalSettings.isFromToTimeLogAllowed(Timetracker.timelogs.tserecno),Timetracker.util.defaultbillingType=Timetracker.generalSettings.getDefaultBillableStatus(Timetracker.timelogs.tserecno);var skipResetDefaultTmpDate=!1;void 0!==skipResetTmpDate&&skipResetTmpDate&&(skipResetDefaultTmpDate=!0),skipResetDefaultTmpDate||Timetracker.timelogs.setDateHeader(),Timetracker.timelogs.currentTimelogData={}}var layout=Timetracker.Util.getLayout();Timetracker.Page.getPageMode();Timetracker.util.allowAddingTimelogs()?(Timetracker.timelogs.timeLogAllowedTypes.automaticLog&&Timetracker.Page.isLoggedInUser()?layout.find("#timerarea").removeClass("zpl_DNI"):layout.find("#timerarea").addClass("zpl_DNI"),Timetracker.Page.Timelogs.isSelfServiceListView()&&!Timetracker.timelogs.timeLogAllowedTypes.automaticLog&&layout.find(".ZP-tlogtable").addClass("MT0I"),Timetracker.timelogs.timeLogAllowedTypes.automaticLog||Timetracker.timelogs.timeLogAllowedTypes.fromToTimeLog?layout.find("#breakAddDiv").removeClass("zpl_DNI"):layout.find("#breakAddDiv").addClass("zpl_DNI")):(layout.find("#timerarea").addClass("zpl_DNI"),layout.find("#tlogviews").addClass("zpl_DNI"),layout.find("#breakAddDiv").addClass("zpl_DNI"),Timetracker.Page.Timelogs.isSelfServiceListView()&&layout.find(".ZP-tlogtable").addClass("MT0I")),Timetracker.timelogs.getTimelogRecords()},getTimelogRecords:function(){var layout=Layout.Page.container,params=Timetracker.timelogs.getParamsToFetchTimelogs();if(null!=params){layout.off("scroll"),layout.find("#timesheetlist").scrollTop(0),Timetracker.FireScroll.resetDataOnLoad(Timetracker.timelogs.Firescroll.getMode()),Timetracker.Util.showHideNoData({remove:!0}),Timetracker.util.appendLoading(null,{divId:"timelogslistview"}),layout.find("#timelogs_list_view").find("#tt_filterResultsHeader").addClass("zpl_DNI"),layout.find("#timelogWeekChanger,#adddailyLog,#addweeklyLog,#addhalfmonthlyLog,#addmonthlyLog,#addtimenote,#listviewtable").addClass("zpl_DNI"),Timetracker.Util.showHideNoData({remove:!0}),Timetracker.timelogs.timer.hideTimerEditModal(),TimetrackerOperations.Filters.isFilterOpen()&&TimetrackerOperations.Filters.toggleFilter();var pageMode=Timetracker.Page.getPageMode();Timetracker.Page.isLoggedInUser(pageMode)&&(Timetracker.timelogs.showHideTlFieldsInTimer(),Timetracker.timelogs.currentTimerJobData||Timetracker.timelogs.timer.resetTimer()),$.post(Timetracker.constants.URL,params,function(result){Timetracker.Page.Timelogs.isSelfServiceListView()?Timetracker.timelogs.istimelogsdatafetched=!1:Timetracker.timelogs.istimelogsdatafetched=!0,Timetracker.Page.isLoggedInUser(pageMode)&&params.fetchTLJobschDtls&&result&&null!=result&&Timetracker.jobSchedule.timelogsView.populateJobSchDetailsCache(result);var resultData=result&&null!==result&&result.tsArr?result.tsArr:[];resultData=result&&null!==result&&result.errorCode?result:resultData;var hoursObj=result&&null!==result&&result.hoursObj?result.hoursObj:null;Timetracker.timelogs.constructTimelogs(resultData,hoursObj,"listviewtable",layout),Timetracker.Page.Timelogs.isSelfServiceListView()||(Timetracker.FireScroll.initFireScroll(Timetracker.timelogs.Firescroll.getMode(),Timetracker.constants.URL,params,Timetracker.timelogs.loadMoreTimeLogs,""),Timetracker.FireScroll.setFetchCount(Timetracker.timelogs.Firescroll.getMode(),resultData)),Timetracker.util.removeLoading(),TimetrackerOperations.Filters.setFilterHeader(Timetracker.timelogs.removeTopFilter,void 0,layout.find("#timelogs_list_view")),Timetracker.jobSchedule.timelogsView.constructBriefJobSch()})}},constructTimelogs:function(resultData,hoursObj,divid,layout){if(Timetracker.Page.isLoggedInUser()&&Timetracker.timelogs.currentTimerJobData&&Timetracker.timelogs.timer.setValuesInTimerBand(),null===resultData||null!==resultData&&0===resultData.length){var noDataMsg=ZPI18N.getString("zp.nodatafoundValue",[ZPI18N.getString("zp.stimelogs")]);Timetracker.util.allowAddingTimelogs()&&(noDataMsg+=ZPI18N.getString("zp.nodataclickadd",[ZPI18N.getString("zp.stimelogs"),ZPI18N.getString("zp.logtime")])),Timetracker.Util.showHideNoData({msg:noDataMsg,layout:layout,divId:"timelogs_list_view"}),layout.find("#"+divid).addClass("zpl_DNI"),Timetracker.timelogs.setTotalLogHours(0,0)}else if(resultData.errorCode){var flag;flag=resultData.errorCode!=Timetracker.constants.ERROR_CODES.BUDGET.ER_BUDGET_DATE_CMP,Timetracker.Util.displayFailureMessage(Timetracker.Util.getFailureMessageByCode(resultData.errorCode,null,flag)),Timetracker.Util.showHideNoData({msg:ZPI18N.getString("zp.notimelogs"),layout:layout}),Layout.Page.container.find("#"+divid).addClass("zpl_DNI"),Timetracker.timelogs.setTotalLogHours(0,0)}else Layout.Page.container.find("#"+divid).html(""),Timetracker.timelogs.constructTimelogsHtml(resultData,hoursObj,divid,layout);Layout.Page.container.find("#timelogs_list_view").removeClass("zpl_DNI")},constructTimelogsHtml:function(resultData,hoursObj,divid,layout){var workDatesObj,txt="",ipsList=new Array;Timetracker.Page.getPageMode();if(layout=void 0!=layout?layout.find("#"+divid):Layout.Page.container.find("#"+divid),$.each(resultData,function(index,data){var workDate=Calendar.parseDate(data.workDate,uidateFormat),day=workDate.getDate(),month=workDate.getMonth(),year=workDate.getFullYear(),monthName=months[month],dbDate=Timetracker.DateTime.getDateinDBformat(workDate,!0),theadObj=layout.find("#timeloghead"+dbDate);if(0===$(theadObj).length){tothrsid="tot_"+monthName+"_"+day+"_"+year,(workDatesObj=workDatesObj||{})[Timetracker.DateTime.getDateinDBformat(workDate,!0)]=tothrsid,txt='<table class="zpl_tbl"><thead id="timeloghead'+dbDate+'"><tr aria-label="'+ZPI18N.getString("zp.date")+":"+monthName+" "+day+" , "+year+'" tabindex="0" workDate="'+dbDate+'"><th width="40">',txt+='<div class="zcheckbox"><input type="checkbox" class="zcheckbox__helper" id="'+dbDate+'" disabled="true" ref="checkall"><label class="zcheckbox__label" for="'+dbDate+'"></label></div>',txt+='</th><th colspan="2"><div class="d-flexcap"><label>'+monthName+" "+day+" , "+year+'</label><i class="PI_delete zpl_DNI" title="'+ZPI18N.getString("zp.delete")+'" id="timelog_multiple_delete" ref="multiDelete" wDate="'+dbDate+'"></i></div></th>',Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)&&(txt+="<th></th>"),txt+='<th><span class="grn" id="'+tothrsid+'"></span></th><th></th><th></th></tr></thead>',txt+='<tbody id="timelogbody'+dbDate+'"></tbody></table>';var lastHeaderWDate=Layout.Page.container.find("thead[id^=timeloghead]:last").find("tr").attr("workDate"),lHDate=lastHeaderWDate?new Date(lastHeaderWDate):null;if(null!=lHDate&&workDate<lHDate){var appendDiv=null;layout.find("table").each(function(){if(!(new Date($(this).find("thead tr").attr("workDate"))<workDate))return!1;appendDiv=$(this)}),null==appendDiv?layout.prepend(txt):$(appendDiv).after(txt)}else layout.append(txt);theadObj=layout.find("#timeloghead"+dbDate)}txt="";var tbodyObj=layout.find("#timelogbody"+dbDate);tbodyObj.find("#tablecheck"+data.timelogId).remove(),txt+=Timetracker.timelogs.constructTimelogRowHtml(data),tbodyObj.append(txt),-2!==data.approvalStatus&&void 0!==data.approvalStatus||0!==data.billingStatus||$(theadObj).find("input[type='checkbox']").prop("disabled",!1),txt="",layout.find("#tablecheck"+data.timelogId).data("tsval",data),data.hasOwnProperty("timearr")&&$.each(data.timearr,function(subindex,timerdata){!timerdata.hasOwnProperty("add_ip")||-1!==ipsList.indexOf(timerdata.add_ip)||timerdata.hasOwnProperty("geoLocation_in")||Timetracker.location.checkForKeysinIPCache(timerdata.add_ip)||ipsList.push(timerdata.add_ip),!timerdata.hasOwnProperty("mod_ip")||-1!==ipsList.indexOf(timerdata.mod_ip)||timerdata.hasOwnProperty("geoLocation_out")||Timetracker.location.checkForKeysinIPCache(timerdata.mod_ip)||ipsList.push(timerdata.mod_ip)}),-1!==ipsList.indexOf(data.mod_ip)||data.hasOwnProperty("geoLocation")||Timetracker.location.checkForKeysinIPCache(data.mod_ip)||ipsList.push(data.mod_ip),-1!==ipsList.indexOf(data.add_ip)||data.hasOwnProperty("geoLocation")||Timetracker.location.checkForKeysinIPCache(data.add_ip)||ipsList.push(data.add_ip)}),""!==(ipsList=ipsList.toString())){var param={mode:"getCityNameByIp",conreqcsr:csrfToken,ipList:ipsList};$.post("/AttendanceAction.zp",param,function(rdata){Timetracker.location.cityNamesList=$.extend(Timetracker.location.cityNamesList,rdata.cityNames)})}if(hoursObj&&null!=hoursObj){var subHours=0,usubHours=0;workDatesObj&&$.each(workDatesObj,function(dbWDate,tothrsid){var totalhrs=0,hrsObj=hoursObj[dbWDate];hrsObj&&hrsObj.day_tothrs&&(totalhrs=hrsObj.day_tothrs),layout.find("#"+tothrsid).html(Calendar.minstohrs(totalhrs)).data("totalhrs",totalhrs),layout.find("#"+tothrsid).attr({"aria-label":ZPI18N.getString("zp.totalhours")+":"+Calendar.minstohrs(totalhrs),tabindex:"0"})});var totalHoursObj=hoursObj.total_hours;totalHoursObj&&(subHours=totalHoursObj.tot_subhrs?totalHoursObj.tot_subhrs:0,usubHours=totalHoursObj.tot_unsubhrs?totalHoursObj.tot_unsubhrs:0),Timetracker.timelogs.setTotalLogHours(subHours,usubHours)}0!==resultData.length&&layout.is(":hidden")&&(Timetracker.Util.showHideNoData({remove:!0}),layout.removeClass("zpl_DNI"))},constructTimelogRowHtml:function(data){var workDate=Calendar.parseDate(data.workDate,uidateFormat),day=workDate.getDate(),month=workDate.getMonth(),year=workDate.getFullYear(),dateString=months[month]+" "+day+", "+year,billstatus="",isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",data),isEditAllowed=data.isEditAllowed&&(-2===data.approvalStatus||void 0===data.approvalStatus)&&0===data.billingStatus,isCurrentlyRunning=data.isCurrentlyRunning&&(Timetracker.timelogs.tserecno!==erecno||!Timetracker.timelogs.currentTimerJobData||Timetracker.timelogs.currentTimerJobData&&data.timelogId===Timetracker.timelogs.currentTimerJobData.timelogId);billstatus=0===data.billableStatus?isBreakLog?ZPI18N.getString(Timetracker.Break.TYPE_STATUS[0]):ZPI18N.getString("zp.billable"):isBreakLog?ZPI18N.getString(Timetracker.Break.TYPE_STATUS[1]):ZPI18N.getString("zp.nonbillable"),"2"===data.type&&isCurrentlyRunning&&Timetracker.timelogs.tserecno===erecno&&(Timetracker.timelogs.currentTimerJobData||Timetracker.timelogs.timer.timerTime(data));var ind=settingsUrlProps.niceUrl.indexOf("/timelogs/")+10;settingsUrlProps.niceUrl.slice(0,ind);if(data.dateString=dateString,txt='<tr class=" '+(isBreakLog?"tt_brkrw":"")+'" id="tablecheck'+data.timelogId+'" workDate="'+Timetracker.DateTime.getDateinDBformat(workDate,!0)+'">',txt+='<td width="20"><div class="zcheckbox zcheckbox--horizontal"><input type="checkbox" id="'+data.timelogId+'" class="zcheckbox__helper" '+(isEditAllowed?'ref="checkbox">':'disabled="true">'),txt+='<label class="zcheckbox__label" for="'+data.timelogId+'"></label></div></td>',data.jobName?txt+="<td onclick=\"Timetracker.timelogs.forms.formViewCallback(true, '"+data.timelogId+'\');"><div aria-label="'+ZPI18N.getString("zp.jobname")+":"+data.jobName+" "+(data.projectName?ZPI18N.getString("zp.projectname")+":"+data.projectName:" ")+'" tabindex="0" ><span><span>'+data.jobName+"</span>"+(data.projectName?'<span class="zpl_dots"></span><em>'+data.projectName+"</em>":"")+"</span></div></td>":txt+="<td>-</td>",Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.WORKITEM)&&data.taskName?txt+='<td class="w300 zpl_cpd"><span class="txtbrk" aria-label="'+ZPI18N.getString("zp.workitem")+":"+data.taskName+' tabindex="0">'+data.taskName+"</span></td>":txt+='<td class="w300 zpl_cpd"></td>',Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)&&(txt+='<td  width="110" class="zpl_cpd"><span aria-label="'+billstatus+'" tabindex="0">'+billstatus+"</span></td>"),""==data.timearr||"2"!==data.type||isCurrentlyRunning){if(txt+='<td width="150" class="zpl_cpd" ref="skip"><div class="d-flexC d-flex-btw">',"2"===data.type&&isCurrentlyRunning&&Timetracker.timelogs.tserecno===erecno)txt+='<span id="watch_time">';else if("1"===data.type||1===data.type){var strTimeInterval=Timetracker.util.getShiftDatebyTimeStr(data.fromTime,data.workDate,Timetracker.constants.MINUTES)+" - "+Timetracker.util.getShiftDatebyTimeStr(data.toTime,data.workDate,Timetracker.constants.MINUTES);txt+='<span title="'+strTimeInterval+'" ref ="skip">'}else txt+='<span ref ="skip">';txt+=Calendar.minstohrs(data.hours)+"</span>"}else txt+='<td width="150"><div class="d-flexC d-flex-btw"><a id="timerEditPopup" class="CP" ref="timerEditPopup" title="'+ZPI18N.getString("zp.view")+'" aria-label="'+ZPI18N.getString("zp.timer")+":"+Calendar.minstohrs(data.hours)+'" tabindex="0">'+Calendar.minstohrs(data.hours)+"</a>";if("2"===data.type&&(isBreakLog||(0!==data.commentsCount?txt+='<span id="addNote'+data.timelogId+'" class="zpl_icncont zpl_cp" title="'+ZPI18N.getString("zp.notes")+'" onclick="Timetracker.timelogs.showNoteEntry(this,event,\''+data.timelogId+"','"+data.workDate+'\');"><i class="PI_note zpl_popovr-js" data-menu-id="addnotes"><sup id="notesCount'+data.timelogId+'">'+data.commentsCount+"</sup></i></span>":isCurrentlyRunning&&0===data.commentsCount&&erecno===Timetracker.timelogs.tserecno&&(txt+='<span id="addNote'+data.timelogId+'" class="zpl_icncont zpl_cp" title="'+ZPI18N.getString("zp.notes")+'" onclick="Timetracker.timelogs.showNoteEntry(this,event,\''+data.timelogId+"','"+data.workDate+'\');"><i class="PI_note zpl_popovr-js" data-menu-id="addnotes"><sup id="notesCount'+data.timelogId+'"><i class="PI_plus wauto zpl_f12"></i></sup></i></span>'))),txt+="</div></td>",txt+='<td width="100" ref="skip"><div class="d-flexC d-flex-btw">',"2"===data.type){var isTimerflag=!1;if(isCurrentlyRunning){var tempObj=data.timearr[Timetracker.timelogs.getLastTimerIndex(data.timearr)];if(void 0!==tempObj&&tempObj.isRunning)isTimerflag=!0;else for(var arrObj in data.timearr)if(data.timearr[arrObj].isRunning){isTimerflag=!0;break}}let today=Timetracker.isTTSthiftEnabled()?Timetracker.timelogs.getShiftDate().date:Calendar.getCurrentDay().day;isTimerflag?Timetracker.timelogs.tserecno===erecno?txt+='<span><img id="watchstatus'+data.timelogId+'" src="'+ZPeople.getResourceURL(newUIImageUrl+"timelog2.gif")+'" class="tympass CP" title="'+ZPI18N.getString("zp.stoptimer")+'" ref="skip" onclick="Timetracker.timelogs.timer.pauseclock(this);"></span>':txt+='<span><img src="'+ZPeople.getResourceURL(newUIImageUrl+"timelog2.gif")+'" class="tympass CP" ref="skip" onclick="Timetracker.util.showAlert(1,\''+ZPI18N.getString("zp.timeralert7")+'\');" ref="skip"></span>':!isTimerflag&&Calendar.equalsTo(today,workDate)&&(Timetracker.timelogs.tserecno===erecno?txt+='<span class="PI_fil_play grn zpl_h3" tid="'+data.timelogId+'" id="watchstatus'+data.timelogId+'" title="'+ZPI18N.getString("zp.resumetimer")+'" ref="skip" onclick="Timetracker.timelogs.timer.nextStart(this)"></span>':txt+='<span class="PI_fil_play grn zpl_h3" onclick="Timetracker.util.showAlert(1,\''+ZPI18N.getString("zp.timeralert7")+'\');" ref="skip"></span>')}else{var innertxt="";if(data.hasOwnProperty("latitude")&&data.hasOwnProperty("longitude"))innertxt='<i class="PI_location" ref="timelogLoc"></i>';else{var address="-",strip="0",info="";data.hasOwnProperty("geoLocation")&&"-"!==data.geoLocation?(address=data.geoLocation,strip=data.hasOwnProperty("mod_ip")?String(data.mod_ip):String(data.add_ip)):"undefined"===(strip=data.hasOwnProperty("mod_ip")?String(data.mod_ip):String(data.add_ip))&&"0"===strip||(address=Timetracker.location.getCityName(strip)),"-"!=address&&(info=data.accuracy?" ("+ZPI18N.getString("zp.lowaccuracyandipaddrinfo",[strip,data.accuracy])+")":" ("+ZPI18N.getString("zp.ipaddrinfo",[strip])+")"),innertxt='<i id="cityonly'+data.timelogId+'"class="PI_location" ref="skip" title="'+address+info+'"></i>'}txt+=innertxt}return txt+=(data.attachId||data.attachPath?'<span><i class="PI_attach" title="'+ZPI18N.getString("zp.downloadfile")+'"  ref="fileDownload"></i></span>':"")+"</div></td>",txt+='<td class="zpl_cpd" width="100">'+(isEditAllowed?'<div class="zpl_hvr" name="delete"><i class="PI_edt" title="'+ZPI18N.getString("zp.edit")+'" ref="edit"></i><i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'" ref="delete"></i></div>':"")+"</td></tr>",txt},getShiftDate:function(){var shiftDateStr=Timetracker.generalSettings.getTSSettings(Timetracker.timelogs.tserecno).TS_shiftDate;return shiftDateStr=void 0==shiftDateStr?Calendar.formatDate(Calendar.getCurrentDay().day):shiftDateStr,{date:Calendar.parseDate(shiftDateStr,uidateFormat),uidate:shiftDateStr}},setTotalLogHours:function(subHours,usubHours,isFromCal){if(!0===isFromCal){(layout=Layout.Page.container.find("#timelogs_calendar_view").find("#timelog_footer")).find("#submitted_hours").html(Calendar.minstohrs(subHours)+" "+ZPI18N.getString("zp.hrs")),layout.find("#not_submitted_hours").html(Calendar.minstohrs(usubHours)+" "+ZPI18N.getString("zp.hrs")),layout.find("#total_hours").html(Calendar.minstohrs(subHours+usubHours)+" "+ZPI18N.getString("zp.hrs")),Timetracker.timelogs.currentlyUnSubmittedhrs=usubHours}else{var layout=Layout.Page.container.find("#timelogs_list_view").find("#timelog_footer");Timetracker.timelogs.currentlyUnSubmittedhrs=usubHours,layout.find("#submitted_hours").html(Calendar.minstohrs(subHours)+" "+ZPI18N.getString("zp.hrs")).data("subHours",subHours),layout.find("#not_submitted_hours").html(Calendar.minstohrs(usubHours)+" "+ZPI18N.getString("zp.hrs")).data("usubHours",usubHours),layout.find("#total_hours").html(Calendar.minstohrs(subHours+usubHours)+" "+ZPI18N.getString("zp.hrs")).data("totalHours",subHours+usubHours)}},constructTimelogRow:function(data){var workDate=Calendar.parseDate(data.workDate,uidateFormat),fromDate="",toDate="",datePeriod=ZPCommonUtil.DateNavigator.getPeriod(Timetracker.timelogs.Firescroll.getMode());if(void 0!==datePeriod&&(void 0!==datePeriod.from&&void 0!==datePeriod.to?(fromDate=new Date(datePeriod.from.toDateString()),toDate=new Date(datePeriod.to.toDateString())):fromDate=toDate=new Date(datePeriod.day.toDateString())),workDate>=fromDate&&workDate<=toDate||0!=Layout.Page.container.find("#tablecheck"+data.timelogId).length){var layout=Timetracker.Util.getLayout().find("#timelogs_list_view"),rtxt=Timetracker.timelogs.constructTimelogRowHtml(data),day=workDate.getDate(),month=workDate.getMonth(),year=workDate.getFullYear(),dbDate=Timetracker.DateTime.getDateinDBformat(workDate,!0),monthName=months[month],tothrsid="tot_"+monthName+"_"+day+"_"+year,usubHours=layout.find("#not_submitted_hours").data("usubHours"),subHours=layout.find("#submitted_hours").data("subHours");void 0===data.approvalId?usubHours+=data.hours:subHours+=data.hours;var totalhrs=0;if(0===layout.find("#tablecheck"+data.timelogId).length&&0===layout.find("thead#timeloghead"+dbDate).length){var txt='<table class="zpl_tbl"><thead id="timeloghead'+dbDate+'"><tr workDate="'+dbDate+'"><th width="40">';txt+='<div class="zcheckbox"><input type="checkbox" class="zcheckbox__helper" id="'+dbDate+'" ref="checkall"><label class="zcheckbox__label" for="'+dbDate+'"></label></div>',txt+='</th><th colspan="2"><div class="d-flexcap"><label>'+monthName+" "+day+" , "+year+'</label><i class="PI_delete zpl_DNI" id="timelog_multiple_delete" title="'+ZPI18N.getString("zp.delete")+'" ref="multiDelete" wDate="'+dbDate+'"></i></div></th>',Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)&&(txt+="<th></th>"),txt+='<th><span class="grn" id="'+tothrsid+'"></span></th><th></th><th></th></tr></thead>',txt+='<tbody id="timelogbody'+dbDate+'">'+rtxt+"</tbody></table>";var lastHeaderWDate=layout.find("thead[id^=timeloghead]:last").find("tr").attr("workDate"),lHDate=lastHeaderWDate?new Date(lastHeaderWDate):null;if(null!=lHDate&&workDate<lHDate){var appendDiv=null;layout.find("table").each(function(){if(!(new Date($(this).find("thead tr").attr("workDate"))<workDate))return!1;appendDiv=$(this)}),null==appendDiv?layout.find("#listviewtable").prepend(txt):$(appendDiv).after(txt)}else layout.find("#emptPage").is(":visible")&&layout.find("#listviewtable").empty(),layout.find("#listviewtable").append(txt);Timetracker.Util.showHideNoData({remove:!0}),layout.find("#listviewtable").removeClass("zpl_DNI"),totalhrs=data.hours}else if(0===layout.find("#tablecheck"+data.timelogId).length)layout.find("tbody#timelogbody"+dbDate+" tr:first").before(rtxt),totalhrs=layout.find("#"+tothrsid).data("totalhrs"),totalhrs+=data.hours;else{totalhrs=layout.find("#"+tothrsid).data("totalhrs");var oldData=layout.find("#tablecheck"+data.timelogId).data("tsval");layout.find("#tablecheck"+data.timelogId).replaceWith(rtxt),totalhrs=totalhrs-oldData.hours+data.hours,void 0===oldData.approvalId?usubHours-=oldData.hours:subHours-=oldData.hours}layout.find("#"+tothrsid).html(Calendar.minstohrs(totalhrs)).data("totalhrs",totalhrs),layout.find("#tablecheck"+data.timelogId).data("tsval",data),Timetracker.timelogs.setTotalLogHours(subHours,usubHours)}else"2"!==data.type||Timetracker.timelogs.currentTimerJobData||Timetracker.timelogs.tserecno!==erecno||Timetracker.timelogs.timer.timerTime(data);if(0===Object.keys(Timetracker.location.latLongParam).length){var ipsList=new Array;if((data.hasOwnProperty("add_ip")&&!data.hasOwnProperty("geoLocation_in")||data.hasOwnProperty("mod_ip")&&!data.hasOwnProperty("geoLocation_out"))&&(-1===ipsList.indexOf(data.add_ip)&&(Timetracker.location.checkForKeysinIPCache(data.add_ip)||ipsList.push(data.add_ip)),data.hasOwnProperty("mod_ip")&&-1===ipsList.indexOf(data.mod_ip)&&(Timetracker.location.checkForKeysinIPCache(data.mod_ip)||ipsList.push(data.add_ip)),""!==(ipsList=ipsList.toString()))){var param={mode:"getCityNameByIp",conreqcsr:csrfToken,ipList:ipsList};$.post("/AttendanceAction.zp",param,function(rdata){Timetracker.location.cityNamesList=$.extend(Timetracker.location.cityNamesList,rdata.cityNames)})}}},HideNoteEntry:function(addNotePopup){null==addNotePopup&&(addNotePopup=Layout.Page.parentContainer.find("#addtimenote")),ZPeopleComponents.popover(addNotePopup).close()},openNoteEntry:function(layout,addNotePopup){var forElement=ZPeopleComponents.popover(addNotePopup).getAttributes().forElement;forElement=layout.find("#"+$(forElement).attr("id")),0!=$(forElement).length&&(ZPeopleComponents.popover(addNotePopup).setAttribute("forElement",forElement),ZPeopleComponents.popover(addNotePopup).open())},showNoteEntry:function(obj,event,timeLogId,workDate){event.stopPropagation();var layout=Layout.Page.parentContainer,addNotePopup=layout.find("#addtimenote");if(0==addNotePopup.length){var popupHtml='<div id="addtimenote" class="zpl_popovr"><div class="zpl_breakpop"><div class="d-flexC"><h5 id="notetitle">'+ZPI18N.getString("zp.notes")+'</h5><div class="MLauto"><a class="_cls PI_cls red" onclick="Timetracker.timelogs.HideNoteEntry();"></a></div></div><div class="zpl_crd"><div class="zpl_crdcnt"><div id="note" class="zpl_secn"><textarea id="noteBox" class="ztextbox" placeholder="'+ZPI18N.getString("zp.addanote")+'" onkeypress="Timetracker.timelogs.addNote(event)"></textarea></div><ul id="noteareapad" class="zpl_dotstmln"></ul></div></div></div></div>';layout.append(popupHtml),addNotePopup=layout.find("#addtimenote"),ZPeopleComponents.popover(addNotePopup,{displayType:"callout",closeOnBodyClick:!0,forElement:obj})}else ZPeopleComponents.popover(addNotePopup).setAttribute("forElement",obj);Timetracker.util.removeErrorMsg(void 0,layout.find("#addtimenote"),!0),addNotePopup.find("#noteBox").val(""),Timetracker.timelogs.timesheetid=timeLogId;var result=$(obj).data().commentArray,tsval=Timetracker.UserSpace.isMySpaceTimelogs()||"ts_homeuser"===Timetracker.Page.getPageMode()?layout.find("#timelog-"+timeLogId).data().tsval:layout.find("#tablecheck"+timeLogId).data().tsval;addNotePopup.data("tsval",tsval),void 0!==result&&null!==result?(Timetracker.timelogs.constructNoteEntry(result,event),addNotePopup.data("commentArray",result)):$.post("/timesheet.zp",{mode:"getComments",timeLogId:timeLogId,conreqcsr:csrfToken},function(resultData){if(resultData&&resultData.res){var result=resultData.resArr;$(obj).data("commentArray",result),Timetracker.timelogs.constructNoteEntry(result,event),addNotePopup.data("commentArray",result)}else{var message=Timetracker.Util.getFailureMessageByCode(resultData.errorCode,resultData.extraDtls,!0);Timetracker.util.showAlert(1,message),Timetracker.timelogs.HideNoteEntry(addNotePopup)}})},constructNoteEntry:function(commentArr,event){event.stopPropagation();var layout=Layout.Page.parentContainer,flag=0;Timetracker.timelogs.timesheetid===Timetracker.timelogs.timersheetId&&Timetracker.timelogs.currentTimerJobData&&(flag=1);var txt="";0===commentArr.length&&""===commentArr||$.each(commentArr,function(index,data){txt+='<li id="notearea'+data.commentId+'" data-commentId="'+data.commentId+'"><span class="d-flex-btw">',txt+=' <div class="d-flexclm8 w250"><em id="commenttime'+data.commentId+'">'+data.createdTime+"</em>",txt+='<p id="timercomment'+data.commentId+'">'+data.comment+"</p></div>",erecno===Timetracker.timelogs.tserecno&&(txt+='<div class="zpl_hvr"><i id="del'+data.commentId+'" class="PI_delete" ref="deleteNote" onclick="Timetracker.timelogs.deleteNote(this)" title="'+ZPI18N.getString("zp.delete")+'"></i></div>'),txt+="</span></li>"}),layout.find("#noteareapad").html(txt),layout.find("#note").addClass("zpl_DNI"),erecno===Timetracker.timelogs.tserecno&&1===flag&&layout.find("#note").removeClass("zpl_DNI"),layout.find("#addtimenote").removeClass("zpl_DNI"),Timetracker.timelogs.openNoteEntry(layout,layout.find("#addtimenote"))},deleteNote:function(obj){var layout=Layout.Page.parentContainer,result=layout.find("#addtimenote").data().tsval;if(void 0!==result.approvalStatus){if(1===result.approvalStatus)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.notealert1")),!1;if(0===result.approvalStatus)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.notealert2")),!1;if(-1===result.approvalStatus)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.notealert3")),!1}if(1===result.billingStatus)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.notealert4")),!1;var addNotePopup=layout.find("#addtimenote");ZPeopleComponents.popover(addNotePopup).setAttribute("closeOnBodyClick",!1);var extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[ZPI18N.getString("zp.snote")]),body:ZPI18N.getString("zp.common.delEntityInfo2",[ZPI18N.getString("zp.snote")]),btnVal:ZPI18N.getString("zp.confirm"),hiddenCallback:function(){ZPeopleComponents.popover(addNotePopup).setAttribute("closeOnBodyClick",!0)}};Timetracker.Util.confirmpopUp("deleteNote",Timetracker.timelogs.deleteNoteRecord,obj,0,extraDtls)},deleteNoteRecord:function(obj){var result,layout=Layout.Page.parentContainer,addNotePopup=layout.find("#addtimenote");result=Timetracker.UserSpace.isMySpaceTimelogs()||"ts_homeuser"===Timetracker.Page.getPageMode()?layout.find("#timelog-"+Timetracker.timelogs.timesheetid).data().tsval:layout.find("#tablecheck"+Timetracker.timelogs.timesheetid).data().tsval,Timetracker.timelogs.commentid=$(obj).parents(":nth(2)").attr("data-commentId"),$.post("/timesheet.zp",{mode:"deletecomment",commentId:Timetracker.timelogs.commentid,timesheetId:Timetracker.timelogs.timesheetid,conreqcsr:csrfToken},function(response){if("permissionDenied"===response.trim())Timetracker.util.showAlert(1,ZPI18N.getString("zp.notealert5")),Timetracker.timelogs.HideNoteEntry(addNotePopup);else{addNotePopup.find("#notearea"+Timetracker.timelogs.commentid).remove();var len=layout.find("#noteareapad>li").length;if(0===len)Timetracker.timelogs.HideNoteEntry(addNotePopup),result.isCurrentlyRunning?(Timetracker.UserSpace.isMySpaceTimelogs()?layout.find("#notesCount"+result.timelogId).html('<span class="PI_plus wauto zpl_f12"></span>'):layout.find("#notesCount"+result.timelogId).html('<i class="PI_plus wauto zpl_f12"></i>'),layout.find("#addNote"+Timetracker.timelogs.timesheetid).data("commentArray",[])):layout.find("#addNote"+Timetracker.timelogs.timesheetid).remove();else{layout.find("#notesCount"+result.timelogId).html(len);var cmtArray=addNotePopup.data("commentArray"),rmvIndx=Timetracker.projects.Operations.findJSONArrayIndex(cmtArray,Timetracker.timelogs.commentid,"commentId");-1!=rmvIndx?(cmtArray.splice(rmvIndx,1),layout.find("#addNote"+Timetracker.timelogs.timesheetid).data("commentArray",cmtArray),addNotePopup.data("commentArray",cmtArray)):(layout.find("#addNote"+Timetracker.timelogs.timesheetid).data("commentArray",null),addNotePopup.data("commentArray",null)),Timetracker.timelogs.openNoteEntry(layout,addNotePopup)}Timetracker.util.showAlert(2,ZPI18N.getString("zp.notedeleted")),Timetracker.timelogs.resetTLFetch(!0)}})},addNote:function(event){var layout=Layout.Page.parentContainer;if(13===event.keyCode){event.preventDefault();var addNotePopup=layout.find("#addtimenote");addNotePopup.find("#noteBox").attr("onkeypress","");var notes=addNotePopup.find("#noteBox").val();if(notes=notes.trim(),Timetracker.util.removeErrorMsg(void 0,addNotePopup),notes.length>250)return Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#noteBox"),msg:ZPI18N.getString("zp.namecharlimit",[ZPI18N.getString("zp.notes"),"250"])}),void addNotePopup.find("#noteBox").attr("onkeypress","Timetracker.timelogs.addNote(event)");if(!Timetracker.timelogs.currentTimerJobData)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.alreadytimerstopped")),void addNotePopup.find("#noteBox").attr("onkeypress","Timetracker.timelogs.addNote(event)");if(0===notes.length)Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#noteBox"),msg:ZPI18N.getString("zp.enternote")}),addNotePopup.find("#noteBox").attr("onkeypress","Timetracker.timelogs.addNote(event)");else{var params={mode:"addcomment",timesheetId:Timetracker.timelogs.timesheetid,comment:notes,userErecNo:Timetracker.timelogs.tserecno,conreqcsr:csrfToken};$.post("/timesheet.zp",params,function(result){if(addNotePopup.find("#noteBox").attr("onkeypress","Timetracker.timelogs.addNote(event)"),"permissionDenied"===result)Timetracker.util.showAlert(1,ZPI18N.getString("zp.notealert5")),Timetracker.timelogs.HideNoteEntry();else{Timetracker.util.removeErrorMsg(void 0,layout.find("#addtimenote"),!0),layout.find("#addNote"+Timetracker.timelogs.timesheetid).data("commentArray",result);var res="";res=Timetracker.UserSpace.isMySpaceTimelogs()||"ts_homeuser"===Timetracker.Page.getPageMode()?layout.find("#addNote"+Timetracker.timelogs.timesheetid).parent().parent().data().tsval:layout.find("#addNote"+Timetracker.timelogs.timesheetid).parent().parent().parent().data().tsval,layout.find("#addNote"+res.timelogId).find("#notesCount"+res.timelogId).html(result.length);var txt="";$.each(result,function(index,data){txt+='<li id="notearea'+data.commentId+'" data-commentId="'+data.commentId+'"><span class="d-flex-btw">',txt+=' <div class="d-flexclm8 w250"><em id="commenttime'+data.commentId+'">'+data.createdTime+"</em>",txt+='<p id="timercomment'+data.commentId+'">'+data.comment+"</p></div>",erecno===Timetracker.timelogs.tserecno&&(txt+='<div class="zpl_hvr"><i id="del'+data.commentId+'" class="PI_delete" ref="deleteNote" onclick="Timetracker.timelogs.deleteNote(this)" title="'+ZPI18N.getString("zp.delete")+'"></i></div>'),txt+="</span></li>"}),addNotePopup.find("#noteareapad").html(txt),addNotePopup.find("#noteBox").val(""),addNotePopup.data("commentArray",result),Timetracker.util.showAlert(2,ZPI18N.getString("zp.noteadded")),ZPeopleComponents.popover(addNotePopup).open(),Timetracker.timelogs.resetTLFetch(!0)}})}}},loadMoreTimeLogs:function(result){var resultData=result&&null!==result&&result.tsArr?result.tsArr:[],hoursObj=result&&null!==result&&result.hoursObj?result.hoursObj:null;Timetracker.timelogs.constructTimelogsHtml(resultData,hoursObj,"listviewtable"),Timetracker.FireScroll.setFetchCount(Timetracker.timelogs.Firescroll.getMode(),resultData)},multiSelectDelete:function(workDate){var id="timelogbody"+workDate,rowObj=Layout.Page.container.find("#listviewtable").find("[id="+id+"]"),selectedLogs=$(rowObj).find("input[type='checkbox']:checked");if(selectedLogs.length<=0)return Layout.Page.container.find("#listviewtable").find("#timeloghead"+workDate).find("input[type='checkbox']").prop("checked",!1),Layout.Page.container.find("#listviewtable").find("#timeloghead"+workDate).find("#timelog_multiple_delete").addClass("zpl_DNI"),Timetracker.util.showAlert(1,ZPI18N.getString("zp.timeralert14")),!1;var tempids="";if($.each(selectedLogs,function(index){$(this).parents(":nth(2)").data("tsval").isCurrentlyRunning||(tempids+=$(this).parents(":nth(2)").data("tsval").timelogId,index!=selectedLogs.length-1&&(tempids+=","))}),!(tempids=tempids.replace(/,+$/,"")))return Layout.Page.container.find("#listviewtable").find("#timeloghead"+workDate).find("input[type='checkbox']").prop("checked",!1),$(rowObj).find("input[type='checkbox']").prop("checked",!1),Layout.Page.container.find("#listviewtable").find("#timeloghead"+workDate).find("#timelog_multiple_delete").addClass("zpl_DNI"),Timetracker.util.showAlert(1,ZPI18N.getString("zp.timerlogalert7")),!1;Timetracker.timelogs.deleteTimeLog(tempids)},showListView:function(isRefreshTL){Layout.Page.container.find("#timelogs_bulk_view").addClass("zpl_DNI"),Timetracker.timelogs.currentTimelogData={},Timetracker.generalSettings.isBreakEnabled()&&Timetracker.timelogs.bulkView.processBrkLogCacheData(!0),Layout.Page.container.find("#timelogs_list_view").removeClass("zpl_DNI"),!(Timetracker.Page.Timelogs.isMyDataListView()||Timetracker.UserSpace.isMySpaceTimelogs()||"ts_homeuser"===Timetracker.Page.getPageMode())||isRefreshTL?(Timetracker.timelogs.tserecno!==erecno&&Timetracker.projects.Filters.createProjectSelect(!0,Timetracker.timelogs.tserecno,null,"timerLogTime","-1","0"),Timetracker.timelogs.getTimelogsListView(!0,null,!1,!0)):TimetrackerOperations.Filters.isFilterOpen()&&TimetrackerOperations.Filters.toggleFilter()},deleteTimeLog:function(timelogId){var params={mode:"deleteTimesheet",sheetId:timelogId,conreqcsr:csrfToken},layout=Layout.Page.container;$.post("/timesheet.zp",params,function(resultData){var tlString=timelogId.split(",").length>1?ZPI18N.getString("zp.ctimelogs"):ZPI18N.getString("zp.ctimelog");if("true"===resultData){var tot_workDate,timelogIds=timelogId.split(","),workDate=layout.find("tr#tablecheck"+timelogIds[0]).attr("workdate"),usubHrs=0,subHrs=0;for(var i in timelogIds){var data=layout.find("tr#tablecheck"+timelogIds[i]).data("tsval");(Timetracker.UserSpace.isMySpaceTimelogs()||"ts_homeuser"===Timetracker.Page.getPageMode())&&(data=layout.find("#timelog-"+timelogIds[i]).data("tsval")),tot_workDate=data.workDate,void 0===data.approvalId?usubHrs+=data.hours:subHrs+=data.hours,Timetracker.UserSpace.isMySpaceTimelogs()||"ts_homeuser"===Timetracker.Page.getPageMode()?(layout.find("#timelog-"+timelogIds[i]).remove(),0===layout.find("#myspace_tl_lst").children().length&&(layout.find("#timelog_pagewrap").remove(),Timetracker.Util.showHideNoData({appendToDiv:!0,msg:ZPI18N.getString("zp.notaddedforrange",[ZPI18N.getString("zp.stimelogs"),ZPI18N.getString("zp.stoday")]),layout:layout}))):layout.find("tr#tablecheck"+timelogIds[i]).remove()}Timetracker.timelogs.currentTimelogData={},layout.find("thead#timeloghead"+workDate).find("#timelog_multiple_delete").addClass("zpl_DNI");var checkAllLogs=layout.find("thead#timeloghead"+workDate).find("input[type=checkbox]");if(checkAllLogs.prop("checked",!1),Timetracker.timelogs.util.checkAll(checkAllLogs),0!==layout.find("thead#timeloghead"+workDate).length&&0===layout.find("tbody#timelogbody"+workDate).find("tr").length){if(layout.find("thead#timeloghead"+workDate).parent().remove(),0===layout.find("#listviewtable>table").length){layout.find("#listviewtable").addClass("zpl_DNI");var noDataMsg=ZPI18N.getString("zp.nodatafoundValue",[ZPI18N.getString("zp.stimelogs")]);Timetracker.util.allowAddingTimelogs()&&(noDataMsg+=ZPI18N.getString("zp.nodataclickadd",[ZPI18N.getString("zp.stimelogs"),ZPI18N.getString("zp.logtime")])),Timetracker.Util.showHideNoData({msg:noDataMsg,layout:layout,divId:"timelogs_list_view"})}}else{var workDate_ui=Calendar.parseDate(tot_workDate,uidateFormat),day=workDate_ui.getDate(),month=workDate_ui.getMonth(),year=workDate_ui.getFullYear(),tothrsid="tot_"+months[month]+"_"+day+"_"+year,tot_hrs=layout.find("#"+tothrsid).data("totalhrs");tot_hrs-=usubHrs,layout.find("#"+tothrsid).html(Calendar.minstohrs(tot_hrs)).data("totalhrs",tot_hrs)}var tSubHrs=layout.find("#submitted_hours").data("subHours"),tuSubHrs=layout.find("#not_submitted_hours").data("usubHours");if(0!==subHrs&&(tSubHrs=0!==tSubHrs&&tSubHrs>=subHrs?tSubHrs-subHrs:tSubHrs),0!==usubHrs&&(tuSubHrs=0!==tuSubHrs&&tuSubHrs>=usubHrs?tuSubHrs-usubHrs:tuSubHrs),Timetracker.timelogs.setTotalLogHours(tSubHrs,tuSubHrs),Timetracker.util.showAlert(2,ZPI18N.getString("zp.deleted.successfully.msg",[tlString])),Timetracker.currentlyRunningTimer.removeTimerDom(),0!==layout.find("#timeloghead"+workDate).length&&0!==layout.find("#timelogbody"+workDate).length&&layout.find("#timeloghead"+workDate).find("input[type='checkbox']").is(":enabled"))0===layout.find("#timelogbody"+workDate).find("input[type='checkbox']:enabled").length&&layout.find("#timeloghead"+workDate).find("input[type='checkbox']").prop("disabled",!0);Timetracker.Page.Timelogs.isSelfServiceListView()||Timetracker.FireScroll.checkAndLoadMoreData(Timetracker.timelogs.Firescroll.getMode(),timelogIds.length),Timetracker.timelogs.resetTLFetch(!0)}else if("true_refresh"===resultData)Timetracker.util.showAlert(2,ZPI18N.getString("zp.timelogdeleted")),Timetracker.timelogs.resetTLFetch(!0),Timetracker.UserSpace.isMySpaceTimelogs()||"ts_homeuser"===Timetracker.Page.getPageMode()?(layout.find("#timelog-"+timelogId).remove(),0===layout.find("#myspace_tl_lst").children().length&&(layout.find("#timelog_pagewrap").remove(),Timetracker.Util.showHideNoData({appendToDiv:!0,msg:ZPI18N.getString("zp.notaddedforrange",[ZPI18N.getString("zp.stimelogs"),ZPI18N.getString("zp.stoday")]),layout:layout}))):Timetracker.timelogs.getTimelogsListView(!0,null,!1,!0);else if(-1!==resultData.indexOf("TSpayperioderror_")||-1!==resultData.indexOf("TSbudgeterror_")||-1!==resultData.indexOf("TimerRunningError")||-1!==resultData.indexOf("TSBreakError_")){var error=resultData.split(":");Timetracker.util.showAlert(1,error.length>1?error[1]:resultData)}else Timetracker.util.showAlert(0,ZPI18N.getString("zp.timelogdelerror"))})},constructSingleTimelog:function(timelog){if(ZPCal.Calendar.isDashboardCal()||ZPCal.Calendar.isSelfServiceCal()?"day"===ZPCal.Calendar.CURMODE||"week"===ZPCal.Calendar.CURMODE?(Layout.Page.container.find("#dashboard_timelog_popover").remove(),Timetracker.timelogs.tserecno===erecno&&("day"===ZPCal.Calendar.CURMODE?ZPCal.Calendar.populatedayCalendar(ZPCal.Calendar.dayCalendarObj):(ZPCal.Calendar.weekCalendarObj=void 0,ZPCal.Calendar.populateWeekCalendar(ZPCal.Calendar.weekCalendarObj)))):"month"===ZPCal.Calendar.CURMODE&&($(".modal-backdrop").remove(),Timetracker.timelogs.tserecno===erecno&&Timetracker.timelogs.calendar.constructTimelogRowInCalendar(timelog)):Timetracker.Page.Timelogs.isCalendarView()?($(".modal-backdrop").remove(),Timetracker.timelogs.tserecno===erecno&&Timetracker.timelogs.calendar.constructTimelogRowInCalendar(timelog)):Timetracker.Page.Timelogs.isListView()||Timetracker.Page.Timelogs.isSelfServiceListView()?($(".modal-backdrop").remove(),Timetracker.timelogs.tserecno===erecno&&Timetracker.timelogs.constructTimelogRow(timelog)):Timetracker.UserSpace.isMySpace()&&($(".modal-backdrop").remove(),Timetracker.timelogs.tserecno===erecno&&(Layout.Page.container.find("#timelog-"+timelog.timelogId).replaceWith(Timetracker.UserSpace.Timelogs.constructTimelogRow(timelog)),Layout.Page.container.find("#timelog-"+timelog.timelogId).data("tsval",timelog).find("#timerEditPopup").on("click",function(){Timetracker.timelogs.timer.showTimerEditModal(data)}))),Timetracker.timelogs.widgetLoaded&&Calendar.equalsTo(Timetracker.Widgets.Timelogs.currentTimelogDate,Calendar.getCurrentDate())){var appendRow=Timetracker.Widgets.Timelogs.constructSingleTimelogRow(timelog);$("#dashTimelog"+timelog.timelogId).html(appendRow),$("#dashTimelog"+timelog.timelogId).data("data",timelog)}},showHideTlFieldsInTimer:function(isFromSelfService){var timerLayout=Layout.Page.container.find("#timerarea"),pageMode=Timetracker.Page.getPageMode();Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.PROJECT)?timerLayout.find("#divProject").removeClass("zpl_DNI"):(timerLayout.find("#divProject").addClass("zpl_DNI"),timerLayout.find("#divClient").addClass("zpl_DNI")),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.CLIENT)?(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.WORKITEM)&&Timetracker.Page.isLoggedInUser(pageMode)&&!Timetracker.UserSpace.isMySpaceTimelogs()&&Layout.Page.container.find("#workitemId").find("#timertask").addClass("mw200"),timerLayout.find("#divClient").removeClass("zpl_DNI")):(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.WORKITEM)&&Timetracker.Page.isLoggedInUser(pageMode)&&!Timetracker.UserSpace.isMySpaceTimelogs()&&Layout.Page.container.find("#workitemId").find("#timertask").addClass("mw350"),timerLayout.find("#divClient").addClass("zpl_DNI")),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.WORKITEM)?timerLayout.find("#workitemId").removeClass("zpl_DNI"):timerLayout.find("#workitemId").addClass("zpl_DNI"),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC)?timerLayout.find("#timerDesc").removeClass("zpl_DNI"):timerLayout.find("#timerDesc").addClass("zpl_DNI"),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)?(isFromSelfService&&timerLayout.find("#billStDiv").width("15%"),timerLayout.find("#billStDiv").removeClass("zpl_DNI")):(timerLayout.find("#billStDiv").addClass("zpl_DNI"),timerLayout.find("#billStDiv").addClass("zpl_DNI"))},workItem:{checkIfDropDownNeededForWorkitem:function(json){let jobId=json&&json.jobId&&""!==json.jobId?json.jobId:"0",skipGeneralWitems=!(!json||!json.skipGeneralWitems)&&json.skipGeneralWitems,isJobWorkItemsExist=json&&json.hasOwnProperty("isJobWorkItemsExist")?json.isJobWorkItemsExist:null;return Timetracker.setWorkitemCache(),null!==isJobWorkItemsExist||"0"===jobId||!Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.WORKITEM)&&-1===Layout.Page.hash.indexOf("jobschedule")||Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped&&0===Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped.fetchedCount&&!Timetracker.timelogs.workItem.workItemDetailsCache[jobId]&&Timetracker.setWorkitemCache({jobId:jobId,erecno:json.erecno},!0),!(skipGeneralWitems||!Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped||0===Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped.fetchedCount)||!("0"===jobId||!(Timetracker.timelogs.workItem.workItemDetailsCache[jobId]&&0!==Timetracker.timelogs.workItem.workItemDetailsCache[jobId].fetchedCount||isJobWorkItemsExist))},createDropdownForWorkitem:function(extraJson){let elementId=extraJson.elementId,containerId=extraJson.containerId?extraJson.containerId:"",layout=void 0!==extraJson.layout?extraJson.layout:Layout.Page.container.find("#"+elementId);if(0===layout.length)return;let isBulkType=void 0!==extraJson.isBulkType&&extraJson.isBulkType,defSelectText=ZPI18N.getString("zp.orgselectlabel",[Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.WORKITEM)]),defOptSel={id:"0",html:defSelectText,text:defSelectText},initSelJson=defOptSel,dropdown={isTextHTMLEncoded:!0,appendTo:extraJson.dropdownAppendTo?extraJson.dropdownAppendTo:layout.closest(".zpl_mdl").length>0?layout.closest(".zpl_mdl"):Timetracker.Util.getLayout(),width:"300px",height:"300px",className:"zpl_ddoptnrml"};dropdown.moveOnScroll=!extraJson.hasOwnProperty("moveOnScroll")||extraJson.moveOnScroll,isBulkType&&(dropdown.className="zpl_ddoptnrml zpl_z-0",dropdown.appendTo=Timetracker.Util.getLayout().find("#timelogs_bulk_view .zpl_rgtcnt:not(.zpl_DNI)"),dropdown.moveOnScroll=!1,dropdown.position="bottom-left"),void 0!==extraJson.toAppendOption&&""!==extraJson.toAppendOption&&(initSelJson={id:extraJson.toAppendOption,html:extraJson.toAppendOption,text:extraJson.toAppendOption},defOptSel.isNewKey=!0,defOptSel.newEle=initSelJson),elementId=elementId||layout.attr("id"),selJson={defSelJson:defOptSel,initSelJson:initSelJson,elementId:elementId,entity:Timetracker.constants.WORKITEM,url:Timetracker.constants.URL,erecno:extraJson.erecno,params:Timetracker.timelogs.workItem.getWorkItemparams({jobId:!1===extraJson.isJobWorkItemsExist?void 0:extraJson.jobId,erecno:extraJson.erecno,isForSearch:!0}),useCommonFlowForSearch:!0,callbackToFetchOptions:Timetracker.timelogs.workItem.getWorkItemOptions,callbackToProcessSearchResults:Timetracker.timelogs.workItem.getSearchResultsForWorkItem,selectComponentExtraProperties:{dropdownlistclose:Timetracker.timelogs.workItem.resetDropdownloadedDetails,dropdownList:dropdown}},extraJson.jobId&&"0"!==extraJson.jobId&&!1!==extraJson.isJobWorkItemsExist&&(selJson.jobId=extraJson.jobId),""!==containerId&&(selJson.containerId=containerId),Timetracker.zselect.create(!0,selJson),Layout.Page.container.find("#"+elementId).data().loadedDetails={},layout.off("zselectchange").on("zselectchange",function(event,obj){obj.container[0].title=ZPeople.decodeTxt(obj.selectedOptionsData[0].label)}),Timetracker.jobs.Filters.gettitle(elementId)},resetDropdownloadedDetails:function(event){event.detail.element.data().loadedDetails={}},convertResultFormatOfWorkItem:function(result){var resultArr=[];if(void 0!==result&&0!==result.length)for(var i in result){var worktiems=result[i];resultArr.push({id:worktiems.wiName,html:worktiems.wiName,text:worktiems.wiName})}return resultArr},destroySelect2ApplyInput:function(extraJson){var eleId=extraJson.eleId,checkDefaultWICache=!!extraJson.hasOwnProperty("checkCache")&&extraJson.checkCache,setInput=!0;0!==Layout.Page.container.find("#"+eleId).length&&ZPeopleComponents.isComponent(Layout.Page.container.find("#"+eleId))&&(checkDefaultWICache&&Timetracker.timelogs.workItem.checkIfDropDownNeededForWorkitem()&&(setInput=!1),setInput&&TimelyZComp.select.destroy(Layout.Page.container.find("#"+eleId)))},getWorkItemOptions:async function(selJson){let resultArr=[],totalJobWorkItemsLoaded=0,totalDefaultWorkItemsLoaded=0,loadedDetails=Layout.Page.container.find("#"+selJson.elementId).data("loadedDetails"),defaultWorkitemLoadedCount=loadedDetails.allWorkitemUnmapped?loadedDetails.allWorkitemUnmapped:0,jobWorkitemLoadedCount=selJson.jobId&&loadedDetails[selJson.jobId]?loadedDetails[selJson.jobId]:0,detailsToloadWorkItems=Timetracker.timelogs.workItem.getDetailsToloadMoreWorkItems(selJson,loadedDetails);if(detailsToloadWorkItems.isFetchMoreData&&(await Timetracker.setWorkitems({jobId:detailsToloadWorkItems.jobId,erecno:selJson.erecno,limit:selJson.limit},!0),detailsToloadWorkItems.jobId&&Timetracker.timelogs.workItem.workItemDetailsCache[detailsToloadWorkItems.jobId]&&(detailsToloadWorkItems.jobWorkItemsNeedToLoad=Timetracker.timelogs.workItem.workItemDetailsCache[detailsToloadWorkItems.jobId].fetchedCount-jobWorkitemLoadedCount>selJson.limit?selJson.limit:Timetracker.timelogs.workItem.workItemDetailsCache[detailsToloadWorkItems.jobId].fetchedCount-jobWorkitemLoadedCount),Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped&&(detailsToloadWorkItems.defaultWorkItemsNeedToLoad=Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped.fetchedCount-defaultWorkitemLoadedCount>selJson.limit-detailsToloadWorkItems.jobWorkItemsNeedToLoad?selJson.limit-detailsToloadWorkItems.jobWorkItemsNeedToLoad:Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped.fetchedCount-defaultWorkitemLoadedCount)),selJson.jobId){totalJobWorkItemsLoaded=jobWorkitemLoadedCount+detailsToloadWorkItems.jobWorkItemsNeedToLoad;for(let i=jobWorkitemLoadedCount;i<totalJobWorkItemsLoaded;i++)resultArr.push({id:Timetracker.timelogs.workItem.workItemDetailsCache[selJson.jobId].data[i].wiName,html:Timetracker.timelogs.workItem.workItemDetailsCache[selJson.jobId].data[i].wiName,text:Timetracker.timelogs.workItem.workItemDetailsCache[selJson.jobId].data[i].wiName});Layout.Page.container.find("#"+selJson.elementId).data().loadedDetails[selJson.jobId]=totalJobWorkItemsLoaded}totalDefaultWorkItemsLoaded=defaultWorkitemLoadedCount+detailsToloadWorkItems.defaultWorkItemsNeedToLoad;for(let i=defaultWorkitemLoadedCount;i<totalDefaultWorkItemsLoaded;i++)resultArr.push({id:Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped.data[i].wiName,html:Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped.data[i].wiName,text:Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped.data[i].wiName});return Layout.Page.container.find("#"+selJson.elementId).data().loadedDetails.allWorkitemUnmapped=totalDefaultWorkItemsLoaded,resultArr},getDetailsToloadMoreWorkItems:function(selJson,loadedDetails){let isFetchMoreData=!1,jobWorkItemsNeedToLoad=0,defaultWorkItemsNeedToLoad=0,details={};if(Timetracker.timelogs.workItem.workItemDetailsCache){let jobId=selJson.jobId,fetchedCount=0,loadedCount=0,isLoadMore=!0,workitemsToBeLoaded=0;jobId&&(Timetracker.timelogs.workItem.workItemDetailsCache[jobId]&&(fetchedCount=Timetracker.timelogs.workItem.workItemDetailsCache[jobId].fetchedCount,isLoadMore=Timetracker.timelogs.workItem.workItemDetailsCache[jobId].isLoadMore),(workitemsToBeLoaded=fetchedCount-(loadedCount=loadedDetails[jobId]?loadedDetails[jobId]:0))<selJson.limit&&isLoadMore?(isFetchMoreData=!0,details.jobId=jobId):jobWorkItemsNeedToLoad=workitemsToBeLoaded>=selJson.limit?selJson.limit:workitemsToBeLoaded),!isFetchMoreData&&jobWorkItemsNeedToLoad<selJson.limit&&(Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped&&(fetchedCount=Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped.fetchedCount,isLoadMore=Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped.isLoadMore),(workitemsToBeLoaded=fetchedCount-(loadedCount=loadedDetails.allWorkitemUnmapped?loadedDetails.allWorkitemUnmapped:0))<selJson.limit&&isLoadMore?isFetchMoreData=!0:defaultWorkItemsNeedToLoad=workitemsToBeLoaded>=selJson.limit-jobWorkItemsNeedToLoad?selJson.limit-jobWorkItemsNeedToLoad:workitemsToBeLoaded)}return details.isFetchMoreData=isFetchMoreData,details.jobWorkItemsNeedToLoad=jobWorkItemsNeedToLoad,details.defaultWorkItemsNeedToLoad=defaultWorkItemsNeedToLoad,details},getWorkItemparams:function(details){let jobId=details&&details.jobId?details.jobId:"0",isForSearch=!(!details||!details.isForSearch)&&details.isForSearch,params={mode:"getWorkItemListing",erecno:details&&details.erecno?details.erecno:Timetracker.timelogs.tserecno,limit:details&&details.limit?details.limit:Timetracker.constants.DEFAULT_FIRESCROLL_LIMIT,sIndex:0,isDefaultWorkItemsNeeded:!0};if("0"!==jobId&&(params.jobId=jobId),!isForSearch){let fetchedCount=0;"0"!==jobId?(fetchedCount=Timetracker.timelogs.workItem.workItemDetailsCache&&Timetracker.timelogs.workItem.workItemDetailsCache[jobId]?Timetracker.timelogs.workItem.workItemDetailsCache[jobId].fetchedCount:0,params.isDefaultWorkItemsNeeded=!1):Timetracker.timelogs.workItem.workItemDetailsCache&&Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped&&(fetchedCount=Timetracker.timelogs.workItem.workItemDetailsCache.allWorkitemUnmapped.fetchedCount),params.sIndex=fetchedCount+1}return params},setWorkItemData:function(result,params){Timetracker.timelogs.workItem.workItemDetailsCache=Timetracker.timelogs.workItem.workItemDetailsCache?Timetracker.timelogs.workItem.workItemDetailsCache:{},params.isDefaultWorkItemsNeeded&&Timetracker.timelogs.workItem.updateWorkItemData(result,"allWorkitemUnmapped",params.limit),params.jobId&&Timetracker.timelogs.workItem.updateWorkItemData(result,params.jobId,params.limit)},updateWorkItemData:function(result,key,limit){Timetracker.timelogs.workItem.workItemDetailsCache[key]=Timetracker.timelogs.workItem.workItemDetailsCache[key]?Timetracker.timelogs.workItem.workItemDetailsCache[key]:{};let defaultWIFetchedCount="allWorkitemUnmapped"!==key&&result.allWorkitemUnmapped?result.allWorkitemUnmapped.length:0,resultCount=result[key]?result[key].length:0,fetchedCount=Timetracker.timelogs.workItem.workItemDetailsCache[key].fetchedCount?Timetracker.timelogs.workItem.workItemDetailsCache[key].fetchedCount+resultCount:resultCount,isLoadMore=resultCount+defaultWIFetchedCount>=limit;0!==resultCount&&(Timetracker.timelogs.workItem.workItemDetailsCache[key].data=Timetracker.timelogs.workItem.workItemDetailsCache[key].data?Timetracker.timelogs.workItem.workItemDetailsCache[key].data:[],Timetracker.timelogs.workItem.workItemDetailsCache[key].data=Timetracker.timelogs.workItem.workItemDetailsCache[key].data.concat(result[key])),Timetracker.timelogs.workItem.workItemDetailsCache[key].fetchedCount=fetchedCount,Timetracker.timelogs.workItem.workItemDetailsCache[key].isLoadMore=isLoadMore},getSearchResultsForWorkItem:function(searchResults,result,extraDtls){let data=[];result&&result.workitemListing&&(data=extraDtls.conf.jobId&&result.workitemListing[extraDtls.conf.jobId]?result.workitemListing[extraDtls.conf.jobId]:data,data=result.workitemListing.allWorkitemUnmapped?data.concat(result.workitemListing.allWorkitemUnmapped):data);let dtlsJson={result:searchResults=searchResults&&searchResults.result?searchResults.result.concat(Timetracker.timelogs.workItem.convertResultFormatOfWorkItem(data)):Timetracker.timelogs.workItem.convertResultFormatOfWorkItem(data),doSearch:!(extraDtls.params&&extraDtls.params.limit&&data.length<extraDtls.params.limit)};return Timetracker.Filters.Search.setSearchDtlsAndKeys(extraDtls.entity,extraDtls.searchKey,dtlsJson),searchResults},resetWorkitemCache:function(key){Timetracker.timelogs.workItem.workItemDetailsCache&&Timetracker.timelogs.workItem.workItemDetailsCache[key]&&delete Timetracker.timelogs.workItem.workItemDetailsCache[key]},getWorkitemData:function(key){return Timetracker.timelogs.workItem.workItemDetailsCache&&Timetracker.timelogs.workItem.workItemDetailsCache[key]&&0!==Timetracker.timelogs.workItem.workItemDetailsCache[key].fetchedCount?Timetracker.timelogs.workItem.workItemDetailsCache[key].data:null},findJSONArrayIndexForWorkitem:function(dataArray,keyValue,keyName){var index=-1;if(dataArray&&keyValue&&keyName)for(var i in dataArray)if(dataArray[i][keyName]===keyValue){index=i;break}return index}},forms:{showListPage:function(pkId,currentTimerData){if(pkId&&Timetracker.timelogs.resetTLFetch(),currentTimerData&&!currentTimerData.hasOwnProperty("tabHidden")&&(Timetracker.timelogs.timer.resetTimerValues(),Timetracker.timelogs.timer.constructTimerTime(currentTimerData),Timetracker.timelogs.widgetLoaded&&Calendar.equalsTo(Timetracker.Widgets.Timelogs.currentTimelogDate,Calendar.getCurrentDate())&&Timetracker.Widgets.Timelogs.getTimelogs(""+Timetracker.Widgets.Timelogs.currentTimelogDate),Timetracker.generalSettings.isPushTimerToAttendanceEnabled()&&Attendance.Dashboard)){var dashlay=$(Attendance.Dashboard.pageLayout());dashlay.find('[name="ATTENDANCE"] #ZPAtt_Dash_CurrDate')[0]&&Attendance.Dashboard.WeeklyData.getCurWeekData(),dashlay.find("#ZPD_Top_Att_Stat")[0]&&Attendance.Dashboard.CurrStatus.getCurrDayStatus()}let formsClassObj=ZP5Form.getFormClassObj();$.each(formsClassObj.LAYOUT.find("[zcomponentname]"),function(){formsClassObj.destroyZComponents($(this))}),Layout.Page.container.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_timer']").prop("checked")&&(Timetracker.timelogs.skipResetOfTempDate=!1),Timetracker.BreakTimelogs.Forms.load("CLOSE");var pageMode=Timetracker.Page.getPageMode();Timetracker.Page.Timelogs.isSelfServiceListView()?Timetracker.timelogs.initTimelogs():"ts_teamuser"==pageMode?window.location.href="#timetracker/team/user/timelogs-mode:list/userId:"+Timetracker.Team.getSelectedUser():"ts_operuser"==pageMode?window.location.href="#operations/timetracker/searchuser/timelogs-mode:list/userId:"+Timetracker.Team.getSelectedUser():Timetracker.UserSpace.isMySpaceTimelogs()?Timetracker.UserSpace.Timelogs.init(Layout.Page.container,{erecno:erecno}):"ts_homeuser"==pageMode?Timetracker.UserSpace.Timelogs.init(Layout.Page.container,{erecno:Timetracker.Team.getSelectedUser()}):window.location.href="#timetracker/mydata/timelogs-mode:list"},formViewCallback:function(isViewRecord,recordId){var logtype=isViewRecord?"/viewtimelog":"/edittimelog",ind=(recordId=recordId||Layout.Page.childUrlParam.recordId,settingsUrlProps.niceUrl.indexOf("/timelogs")+9),url="#"+settingsUrlProps.niceUrl.slice(0,ind)+logtype+"-recordId:"+recordId;Timetracker.Page.isSelectedUser()&&(url+="/userId:"+Timetracker.Team.getSelectedUser()),window.location.href=url},validateAndSubmitCallback:function(){Layout.Page.container.find("#zp_forms_add_btn").addClass("disabled"),Timetracker.util.getTTLocation(function(){ZP5Form.getFormClassObj().IS_SUBMITNEW=!1,Timetracker.timelogs.locRequested=!0,ZP5Form.getFormClassObj().validateAndSubmit(),Timetracker.timelogs.locRequested=!1})},getTimelogDetailsForForm:function(params){params.isFromNewUI=!0;var formRef=ZP5Form.getFormClassObj(),layout=formRef.LAYOUT,recDetails=ZP5Form.getSingleRecord(),isTLAddFromTS=Timetracker.timesheet.isAddTimelogFromTSAllowed();params.JobId=TimelyZComp.select.getValue(layout.find("input[name=JobId]"));var projectId=0!=layout.find("input[name=Project]").length?TimelyZComp.select.getValue(layout.find("input[name=Project]")):"0";"0"!==projectId&&(params.Project=projectId),0!=layout.find("[name=Billable_Status]").length&&(params.Billable_Status=TimelyZComp.select.getValue(layout.find("select[name=Billable_Status]"))),params.User_Name=Timetracker.Page.isSelectedUser()?Timetracker.Team.getSelectedUser():erecno;var parentContainerId=Layout.Page.parentContainer.attr("id");if(void 0!==parentContainerId&&"embed_logtime"===parentContainerId&&(params.User_Name=TimelyZComp.select.getValue(layout.find('input[name="EmployeeName"]'))),isTLAddFromTS){var tsBody=Layout.Page.container.find("#tsdatatbody"),tserecNo=$(tsBody).attr("tserecNo");void 0!==tserecNo&&(params.User_Name=tserecNo)}if(formRef.isEditMode()&&(params.timelogtype=recDetails.record.extraDetails.timelogtype,Timetracker.BreakTimelogs.isBreakLog())){var payType=layout.find("span[name=payType]").attr("value");"0"!==payType&&"1"!==payType||(params.Billable_Status=payType)}if(0!==layout.find("#timelog_type").length&&(!formRef.isEditMode()||formRef.isEditMode()&&void 0!=layout.find("#timelog_type").find("input[name='timelogTime']:checked").val())){if(params.timelogtype=layout.find("#timelog_type").find("input[name='timelogTime']:checked").val(),"0"===params.timelogtype)params.loggedHrs=layout.find("#timelog_hrstime").val();else if("1"===params.timelogtype)if(Timetracker.isTTSthiftEnabled()){var dt=TimelyZComp.dateField.getValue(layout.find("input[name='Date']")),logDate=Calendar.parseDate(dt,uidateFormat),fromTime=TimelyZComp.datetimefield.getDateObj(layout.find("#timelog_fromtime")),toTime=TimelyZComp.datetimefield.getDateObj(layout.find("#timelog_totime"));logDate&&fromTime&&(params.fromTime=logDate.getDiff(fromTime,Timetracker.constants.MINUTES)),logDate&&toTime&&(params.toTime=logDate.getDiff(toTime,Timetracker.constants.MINUTES))}else{var fromhrstot=TimelyZComp.timeField.getValue(layout.find("#timelog_fromtime")),tohrstot=TimelyZComp.timeField.getValue(layout.find("#timelog_totime"));fromhrstot&&(params.fromTime=Timetracker.util.getTotalTimeForHours(fromhrstot.split(":"))),tohrstot&&(params.toTime=Timetracker.util.getTotalTimeForHours(tohrstot.split(":")))}}else formRef.isEditMode()&&void 0==layout.find("#timelog_type").find("input[name='timelogTime']:checked").val()&&("0"===params.timelogtype?params.loggedHrs=Calendar.minstohrs(recDetails.record.extraDetails.totalTime):"1"===params.timelogtype&&(params.fromTime=""+recDetails.record.extraDetails.fromTime,params.toTime=""+recDetails.record.extraDetails.toTime));if("2"==params.timelogtype&&(formRef.isAddMode()&&!Timetracker.timelogs.currentTimerJobData||formRef.isEditMode()&&Timetracker.timelogs.currentTimerJobData&&params.zp_recordId===Timetracker.timelogs.currentTimerJobData.timelogId)&&(params.getCurrentlyRunningTimer=!0,params.getProjectAndClient=!0),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.WORKITEM)&&0!=layout.find('input[name="Work_Item"]').length)if(ZPeopleComponents.isComponent(layout.find('input[name="Work_Item"]'))){var wiId=ZPeople.decodeTxt(TimelyZComp.select.getValue(layout.find('input[name="Work_Item"]')));params.Work_Item="0"!==wiId&&0!==wiId?wiId:""}else params.Work_Item=layout.find('input[name="Work_Item"]').val();if(isTLAddFromTS){var listId=Timetracker.timesheet.getTimesheetIdForTimelog();null!==listId&&void 0!==listId&&(params.listId=listId)}if(0!==Object.keys(Timetracker.location.latLongParam).length){var obj=Timetracker.location.latLongParam;obj.hasOwnProperty("latitude")&&null!==obj.latitude&&obj.hasOwnProperty("longitude")&&null!==obj.longitude&&obj.hasOwnProperty("accuracy")&&null!==obj.accuracy&&(params.longitude=Timetracker.location.latLongParam.longitude,params.latitude=Timetracker.location.latLongParam.latitude,params.accuracy=Timetracker.location.latLongParam.accuracy)}},showAddJobProjectFromTimelogsCallBack:function(otherDetails){Timetracker.Validations.isDefiniteValue(otherDetails)&&Timetracker.Validations.isDefiniteValue(otherDetails.containerId)&&"jobsch_form"===otherDetails.containerId&&Layout.Page.container.find("#jobsch_modelmask").hide(),Timetracker.timelogs.forms.quick5FormFields(otherDetails)},showQuickAddJobProject:function(ele){var eleId=$(ele).attr("eleId"),otherDetails={id:eleId,containerId:$(ele).attr("cId"),isFromProjects:-1==eleId.indexOf("job")};Timetracker.timelogs.forms.quickAddFormFields(otherDetails,!0)},quick5FormFields:function(otherDetails){var isFromProjects=otherDetails.isFromProjects;Timetracker.timelogs.formDetails=Timetracker.util.getFormDetails(Timetracker.timelogs.formDetails,Timetracker.constants.TIMELOG_TABLE);var formId=Timetracker.timelogs.formDetails.formId,formData=ZP5Form.getFormsOperation(formId).getFormComponentData();void 0==formData&&(formData=ZP5Form.getTempFormComponentData(formId)),Timetracker.timelogs.forms.setFormComponentIdfromQForm(isFromProjects,formId,otherDetails,formData)},updateValuesInSelect:function(resultData,layoutDetails,quickAddReqParams,isV5){if(layoutDetails||"P_Timesheet"!==ZP5Form.getFormClassObj().tableName){var selectThisProject="0",operation="",eno=Timetracker.timelogs.tserecno?Timetracker.timelogs.tserecno:erecno,isFromProjects=(id="",!1);layoutDetails.isFromProjects?(isFromProjects=!0,Timetracker.jobs.Util.clearCache(resultData[0].pkId,"project",!0)):Timetracker.jobs.Util.clearCache(resultData[0].pkId,"job",!0);var elementId=layoutDetails.id;elementId.indexOf("day")>=0?(operation="dailyLogTime",id="day"):elementId.indexOf("week")>=0?(operation="weeklyLogTime",id="week"):elementId.indexOf("halfmonth")>=0?(operation="halfmonthlyLogTime",id="halfmonth"):elementId.indexOf("month")>=0&&(operation="monthlyLogTime",id="month");var elementObj="";layoutDetails.hasOwnProperty("containerId")&&(containerObj=Layout.Page.container.find("#"+layoutDetails.containerId),elementObj=$(containerObj)),elementObj=""===elementObj||void 0===elementObj?Layout.Page.container:elementObj;var elementProjectId=$(elementObj).find("#"+elementId).attr("projectId"),elementJobId=$(elementObj).find("#"+elementId).attr("jobId"),elementClientId=$(elementObj).find("#"+elementId).attr("clientId"),currerecno=Timetracker.timelogs.tserecno?Timetracker.timelogs.tserecno:erecno;if("jbsch_projectid"!==elementId&&"jbsch_jobid"!==elementId||(currerecno=null===Timetracker.jobSchedule.currPopupUser||void 0===Timetracker.jobSchedule.currPopupUser?ZPeople.CURR_USER.usererec:Timetracker.jobSchedule.currPopupUser),layoutDetails.isFromProjects)selectThisProject=resultData[0].pkId,quickAddReqParams.projectId=resultData[0].pkId;else{resultData[0].pkId,quickAddReqParams.hasOwnProperty("Project")&&(selectThisProject=quickAddReqParams.Project)}elementProjectId=elementProjectId||elementId,elementJobId=elementJobId||elementId;if("timerprojects"===elementId||"timerjobs"===elementId){var selectdetails={allowAll:!0,isNewKey:!0,isV5:!0};data={isFromQA:!0};if(isFromProjects?(data.projectId=resultData[0].pkId,data.projectName=resultData[0].lkpDetails.lookupValue,data.isFromProjectsQA=!0):(data.jobId=resultData[0].pkId,data.jobName=resultData[0].lkpDetails.lookupValue),(quickAddReqParams.hasOwnProperty("ClientId")||quickAddReqParams.hasOwnProperty("Project"))&&null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients){clientData=ZPeopleComponents.select(Layout.Page.container.find("#timerclients")).getOptionData()[0];data.clientId=clientData.id,data.clientName=clientData.text}Timetracker.timelogs.setValuesInSelectInput(data,"timerLogTime",null,null,selectdetails)}else if(elementId&&"-1"!=elementId.indexOf("zp_field")){resultData[0].pKId=0==quickAddReqParams.pkId?"-Select-":resultData[0].projectId;eno=$("#tsusers").val()?$("#tsusers").val():erecno;Timetracker.projects.Filters.createProjectSelect(!0,eno,null,"addeditlogtime",null,selectThisProject)}else if("jbsch_projectid"===elementId||"jbsch_jobid"===elementId){selectdetails={allowAll:!0,isNewKey:!0},data={isFromQA:!0,erecno:[]};if(isFromProjects)data.assignedTo=currerecno,data.projectId=resultData[0].pkId,data.projectName=resultData[0].lkpDetails.lookupValue,data.isFromProjectsQA=!0;else if(data.assignedTo=currerecno,data.jobId=resultData[0].pkId,data.jobName=resultData[0].lkpDetails.lookupValue,ZPeopleComponents.isComponent(Layout.Page.container.find("#jbsch_clientid"))&&(quickAddReqParams.hasOwnProperty("ClientId")||quickAddReqParams.hasOwnProperty("Project"))&&null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients){clientData=ZPeopleComponents.select(Layout.Page.container.find("#jbsch_clientid")).getOptionData()[0];data.clientId=clientData.id,data.clientName=clientData.text}Timetracker.timelogs.setValuesInSelectInput(data,"jobsch",null,null,selectdetails)}else if("projectid"===elementId||"jobid"===elementId){selectdetails={allowAll:!0,isNewKey:!0},data={isFromQA:!0};if(isFromProjects?(data.projectId=resultData[0].pkId,data.projectName=resultData[0].lkpDetails.lookupValue,data.isFromProjectsQA=!0):(data.jobId=resultData[0].pkId,data.jobName=resultData[0].lkpDetails.lookupValue),(quickAddReqParams.hasOwnProperty("ClientId")||quickAddReqParams.hasOwnProperty("Project"))&&null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients){clientData=ZPeopleComponents.select(Layout.Page.container.find("#caltimelogClient")).getOptionData()[0];data.clientId=clientData.id,data.clientName=clientData.text}Timetracker.timelogs.setValuesInSelectInput(data,"calendarLogTime","calAddPopup",null,selectdetails)}else{var containerId=layoutDetails.containerId;selectdetails={allowAll:!0,isNewKey:!0},data={isFromQA:!0};if(isFromProjects)data.projectId=resultData[0].pkId,data.projectName=resultData[0].lkpDetails.lookupValue,data.isFromProjectsQA=!0;else if(data.jobId=resultData[0].pkId,data.jobName=resultData[0].lkpDetails.lookupValue,quickAddReqParams.hasOwnProperty("Project")&&null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients){clientDiv=Layout.Page.container.find("#"+containerId).find("#"+elementClientId);if("dailyLogTime"!=operation&&"weeklyLogTime"!=operation&&"halfmonthlyLogTime"!=operation&&"monthlyLogTime"!=operation||(clientDiv=Layout.Page.container.find("#"+containerId).find("input[name=client]")),0!=clientDiv.length)null!=(clientData=ZPeopleComponents.select(clientDiv).getOptionData()[0])&&(data.clientId=clientData.id,data.clientName=clientData.text)}Timetracker.timelogs.setValuesInSelectInput(data,null,containerId,null,selectdetails)}}else{var succObj=resultData[0],selectDetails={allowAll:!0,isNewKey:!0};selectDetails.isV5=isV5;var data,id="";if((data={}).isFromQA=!0,"P_TimesheetJob"===succObj.lkpDetails.lkpFormLinkName?("P_TimesheetJob",data.jobId=succObj.pkId,data.jobName=succObj.lkpDetails.lookupValue,id="timelogJob",Timetracker.jobs.jobData=[]):"P_TimesheetJobsList"===succObj.lkpDetails.lkpFormLinkName&&("P_TimesheetJobsList",data.projectId=succObj.pkId,data.projectName=succObj.lkpDetails.lookupValue,data.isFromProjectsQA=!0,id="timelogProject"),null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients&&(quickAddReqParams.hasOwnProperty("ClientId")||quickAddReqParams.hasOwnProperty("Project"))){var clientDiv,clientData,clientId=0;0!=(clientDiv=Layout.Page.container.find("#timelogClient")).length&&ZPeopleComponents.isComponent(clientDiv)&&(clientId=(clientData=ZPeopleComponents.select(clientDiv).getOptionData()[0]).id),void 0!=clientId&&null!=clientId&&"0"!=clientId&&"-Select-"!=clientId&&(data.clientId=clientId,data.clientName=clientData.text)}Timetracker.timelogs.setValuesInSelectInput(data,"addeditlogtime",void 0,id,selectDetails)}},setFormComponentIdfromQForm:function(isFromProjects,formid,otherDetails,formData){var fcDetails;if(null!=(fcDetails=isFromProjects?formData.message.formComponentDetails[0].column1[0].refTableName===Timetracker.constants.PROJECT_TABLE?formData.message.formComponentDetails[0].column1[0]:Timetracker.timelogs.forms.iterateResponseForfcID(formData.message.formComponentDetails,!0):formData.message.formComponentDetails[0].column1[1].refTableName===Timetracker.constants.JOB_TABLE?formData.message.formComponentDetails[0].column1[1]:Timetracker.timelogs.forms.iterateResponseForfcID(formData.message.formComponentDetails,!1))){var mainFormDeatils={formId:formid,tableName:Timetracker.constants.TIMELOG_TABLE};mainFormDeatils.ttSelectAddData=otherDetails;var params={};params.formId=fcDetails.referredFormId,params.tableName=fcDetails.refTableName,params.formMode="ADD",params.disableUrlTrack=!0,params.mainFrom=mainFormDeatils,ZP5Form._toForm(params).setReffcid(fcDetails.referredfcId).setLookupfcid(fcDetails.formComponentId).setisQuickAdd(!0).init()}},iterateResponseForfcID:function(resultData,isFromProjects){var fcDetails=null;return $.each(resultData,function(){void 0!==this.column1&&this.column1.length&&$.each(this.column1,function(){if(isFromProjects){if(void 0!==this.refTableName&&this.refTableName===Timetracker.constants.PROJECT_TABLE)return fcDetails=this,this}else if(void 0!==this.refTableName&&this.refTableName===Timetracker.constants.JOB_TABLE)return fcDetails=this,this})}),fcDetails},quickFormFields:function(otherDetails){var formId;otherDetails.isFromProjects?(Timetracker.projects.formDetails=Timetracker.util.getFormDetails(Timetracker.projects.formDetails,"P_TimesheetJobsList"),Timetracker.projects.formDetails,formId=Timetracker.projects.formDetails.formId):(Timetracker.jobs.formDetails=Timetracker.util.getFormDetails(Timetracker.jobs.formDetails,"P_TimesheetJob"),Timetracker.jobs.formDetails,formId=Timetracker.jobs.formDetails.formId),ZP5Form._toForm({formId:formId,formMode:"ADD",disableUrlTrack:!0}).init()},quickAddFormFields:function(otherDetails){var isFromProjects=otherDetails.isFromProjects;Timetracker.timelogs.formDetails=Timetracker.util.getFormDetails(Timetracker.timelogs.formDetails,Timetracker.constants.TIMELOG_TABLE);var lookUpId,refFcId,params={};isFromProjects?(Timetracker.projects.formDetails=Timetracker.util.getFormDetails(Timetracker.projects.formDetails,Timetracker.constants.PROJECT_TABLE),params.tableName=Timetracker.constants.PROJECT_TABLE,params.formId=Timetracker.projects.formDetails.formId,refFcId=Timetracker.projects.formDetails.projectFCId,lookUpId=Timetracker.timelogs.formDetails.projectLookUpFCId):(Timetracker.jobs.formDetails=Timetracker.util.getFormDetails(Timetracker.jobs.formDetails,Timetracker.constants.JOB_TABLE),params.tableName=Timetracker.constants.JOB_TABLE,params.formId=Timetracker.jobs.formDetails.formId,refFcId=Timetracker.jobs.formDetails.jobFCId,lookUpId=Timetracker.timelogs.formDetails.jobLookUpFCId);var mainFormDeatils={formId:Timetracker.timelogs.formDetails.formId,tableName:Timetracker.constants.TIMELOG_TABLE};mainFormDeatils.ttSelectAddData=otherDetails,params.formMode="ADD",params.disableUrlTrack=!0,params.mainFrom=mainFormDeatils,ZP5Form._toForm(params).setReffcid(refFcId).setLookupfcid(lookUpId).setisQuickAdd(!0).init()},addFromSelect:function(containerId,elementId,addValue,callBack,otherDetails){var layout=Timetracker.Util.getLayout();otherDetails.containerId&&(layout=layout.find("#"+otherDetails.containerId),containerId=otherDetails.containerId),layout.find("#"+elementId).off("zselectbeforedropdownlistopen").on("zselectbeforedropdownlistopen",function(){var optId=elementId+"add";ZPeopleComponents.select(layout.find("#"+elementId)).removeOption([optId],"footer");var opt=[{isFooter:!0,innerHTML:'<button class="zlabel zlabel--blue zlabel--outline zlabel--medium zpl_btncnt" onclick="Timetracker.timelogs.forms.showQuickAddJobProject(this)" eleId="'+elementId+'" cId="'+containerId+'">'+addValue+"</button>",id:optId}];ZPeopleComponents.select(layout.find("#"+elementId)).addOption(opt)})},bindEventHandlingFormFields:async function(layout,extraJson){var projSelDiv=(layout=void 0==layout?Layout.Page.container:layout).find('input[name="Project"]'),jobSelDiv=layout.find('input[name="JobId"]'),clientSelDiv=layout.find('input[name="Client"]'),workitemDiv=layout.find('input[name="Work_Item"]'),isFromTSTLAdd=!1,isEmbedForm=!1,parentContainerId=Layout.Page.parentContainer.attr("id");if(void 0!==parentContainerId&&"embed_logtime"===parentContainerId){isEmbedForm=!0;var layoutEmbed=EmbedTimetrackerAddRequest.getEmbedModalContainer();Timetracker.Util.setLayout(layoutEmbed),empDiv=Layout.Page.container.find('input[name="EmployeeName"]')}projSelDiv.attr("jobid",jobSelDiv.attr("id")),jobSelDiv.attr("projectid",projSelDiv.attr("id")),workitemDiv.attr("orgTaskName",ZSEC.Encoder.encodeForHTML(workitemDiv.val()));var eno=Timetracker.util.getUserErecno(),projId=projSelDiv.val(),projectName=projSelDiv.text(),jobId=jobSelDiv.val(),jobName=jobSelDiv.text(),clientId=clientSelDiv.val(),clientName=clientSelDiv.text(),fromRef=ZP5Form.getFormClassObj();if((null!==extraJson||void 0!=extraJson)&&extraJson.hasOwnProperty("isFromTSTLAdd")){extraJson.hasOwnProperty("projectId")&&extraJson.hasOwnProperty("projectName")&&(projId=extraJson.projectId,projectName=extraJson.projectName,isFromTSTLAdd=!0),extraJson.hasOwnProperty("clientId")&&extraJson.hasOwnProperty("clientName")&&(clientId=extraJson.clientId,clientName=extraJson.clientName,isFromTSTLAdd=!0);var tsBody=Layout.Page.container.find("#tsdatatbody"),erecNo=$(tsBody).attr("tserecNo");void 0!==erecNo&&null!==erecNo&&(eno=erecNo)}if(Timetracker.clients.getClients("timelogClient",null,null,!1,eno,Timetracker.constants.TTCustomAdmin.EntryView,{isV5:!0}),clientSelDiv.off("zselectchange").on("zselectchange",function(eve,data){if(data.fromUI){var parentContainerId=Layout.Page.parentContainer.attr("id");void 0!==parentContainerId&&"embed_logtime"===parentContainerId&&(eno=TimelyZComp.select.getValue(layout.find('input[name="EmployeeName"]'))),Timetracker.projects.Filters.createProjectSelect(!0,eno,data.value,"addeditlogtime",null,"0",void 0,Timetracker.constants.TTCustomAdmin.EntryView)}}),await Timetracker.projects.Filters.createProjectSelect(!0,eno,clientId,"addeditlogtime",null,projId,void 0,Timetracker.constants.TTCustomAdmin.EntryView,{isAdd:fromRef.isAddMode()}),projSelDiv.off("zselectchange").on("zselectchange",function(eve,data){if(data.fromUI){var parentContainerId=Layout.Page.parentContainer.attr("id");void 0!==parentContainerId&&"embed_logtime"===parentContainerId&&(eno=TimelyZComp.select.getValue(layout.find('input[name="EmployeeName"]')));var cltid=ZPeopleComponents.isComponent(clientSelDiv)?TimetrackerOperations.Filters.getSelectFilterValues(clientSelDiv):void 0,dtlsJson={};isFromTSTLAdd&&(dtlsJson.isFromTSTLAdd=isFromTSTLAdd,null!=clientId&&void 0!=clientId&&""!==clientId&&(dtlsJson.clientId=clientId),null!=projId&&void 0!=projId&&""!==projId&&(dtlsJson.projectId=projId)),Timetracker.jobs.Filters.createJobSelect(eno,"-1","addeditlogtime",data.value,cltid,Timetracker.constants.TTCustomAdmin.EntryView,dtlsJson)}}),jobSelDiv.off("zselectchange").on("zselectchange",function(eve,data){if(data.fromUI){var dtlsJson={};isFromTSTLAdd&&(dtlsJson.isFromTSTLAdd=isFromTSTLAdd,null!=clientId&&void 0!=clientId&&""!==clientId&&(dtlsJson.clientId=clientId,dtlsJson.clientVal=clientName),null!=projId&&void 0!=projId&&""!==projId&&(dtlsJson.projectId=projId,dtlsJson.projectVal=projectName)),0!=dtlsJson.length?Timetracker.timelogs.jobChange("addeditlogtime",null,dtlsJson):Timetracker.timelogs.jobChange("addeditlogtime",void 0)}}),isEmbedForm&&EmbedTimetrackerAddRequest.createEmpZComp(),fromRef.isEditMode()||isFromTSTLAdd){var data={};""!==jobId&&(data.jobId=jobId,data.jobName=jobName),""!==projId&&(data.projectId=projId,data.projectName=projectName),null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients&&""!==clientId&&(data.clientId=clientId,data.clientName=clientName),Timetracker.timelogs.setValuesInSelectInput(data,"addeditlogtime",void 0,null,{allowAll:!0,isNewKey:!0,isV5:!0})}if(fromRef.isEditMode()){let extraJson={};extraJson.jobId=jobId,Timetracker.timelogs.workItem.checkIfDropDownNeededForWorkitem(extraJson)&&(extraJson.layout=workitemDiv,extraJson.toAppendOption=workitemDiv.attr("orgTaskName"),extraJson.isV5=!0,Timetracker.timelogs.workItem.createDropdownForWorkitem(extraJson))}else{if(Timetracker.timelogs.workItem.checkIfDropDownNeededForWorkitem())(extraJson={}).layout=workitemDiv,extraJson.isV5=!0,Timetracker.timelogs.workItem.createDropdownForWorkitem(extraJson)}Timetracker.isTTSthiftEnabled()&&layout.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_end']").length&&layout.find("input[name=Date]").off("zdatefieldchange").on("zdatefieldchange",function(eve,data){var date=data.dateValue,pickerOptions={};date.setDate(date.getDate()-1),pickerOptions.minDate=Calendar.formatDate(date).toString(),date.setDate(date.getDate()+2),pickerOptions.maxDate=Calendar.formatDate(date).toString(),TimelyZComp.datetimefield.setAttribute(layout.find("#timelog_fromtime"),"pickerOptions",pickerOptions),TimelyZComp.datetimefield.setAttribute(layout.find("#timelog_totime"),"pickerOptions",pickerOptions)})}},util:{redirectToAddTimelogPage:function(){var url="#"+settingsUrlProps.niceUrl+"/addtimelog";Timetracker.Page.isSelectedUser()&&(url+="-userId:"+Timetracker.Team.getSelectedUser()),window.location.href=url},checkParticularLog:function(obj){var workDate=$(obj).parents(":nth(2)").attr("workDate"),id="timelogbody"+workDate,layout=Layout.Page.container.find("#listviewtable"),rowObj=layout.find("[id="+id+"]"),trObj=layout.find("[id="+id+"]").find("input[type='checkbox']:enabled");$(obj).is(":checked")?(logSelected=$(rowObj).find("input[type='checkbox']:checked"),logSelected.length===trObj.length&&layout.find("#timeloghead"+workDate).find("input[type='checkbox']").prop("checked",!0),layout.find("#timeloghead"+workDate).find("#timelog_multiple_delete").removeClass("zpl_DNI")):(layout.find("#timeloghead"+workDate).find("input[type='checkbox']").prop("checked",!1),logSelected=$(rowObj).find("input[type='checkbox']:checked"),logSelected.length<1&&layout.find("#timeloghead"+workDate).find("#timelog_multiple_delete").addClass("zpl_DNI"))},checkAll:function(obj){var workDate=$(obj).parents(":nth(2)").attr("workDate"),id="timelogbody"+workDate,layout=Layout.Page.container.find("#listviewtable");$(obj).is(":checked")?(layout.find("[id="+id+"]").find("input[type='checkbox']").each(function(){$(this).attr("disabled")||$(this).prop("checked",!0)}),layout.find("#timeloghead"+workDate).find("#timelog_multiple_delete").removeClass("zpl_DNI")):(layout.find("[id="+id+"]").find("input[type='checkbox']:checked").each(function(){$(this).prop("checked",!1)}),layout.find("#timeloghead"+workDate).find("#timelog_multiple_delete").addClass("zpl_DNI"))},createErrorTextInputFields:function(fldDtls,isFromForm){var fldError=!1,errorClass=fldDtls.hasOwnProperty("errorClass")?fldDtls.errorClass:"error-msg",errTxt="",tlFieldType=fldDtls.tlFieldType,tlValue=fldDtls.tlValue,fldDispName=fldDtls.fldDispName,tlField=fldDtls.tlField,skipMandCheck=!!fldDtls.hasOwnProperty("skipMandCheck")&&fldDtls.skipMandCheck,allowEmptyCheck=!!fldDtls.hasOwnProperty("allowEmptyCheck")&&fldDtls.allowEmptyCheck,skipSpclChar=!!fldDtls.hasOwnProperty("skipSpclChar")&&fldDtls.skipSpclChar;Timetracker.timelogCustomization.isTLFieldMandatory(tlField)&&!skipMandCheck&&(allowEmptyCheck=!0);var maxLength=null;fldDtls.hasOwnProperty("fldLength")?maxLength=fldDtls.fldLength:tlField===Timetracker.constants.WORKITEM?maxLength=500:tlField===Timetracker.constants.DESC&&(maxLength=15e3),"text"===tlFieldType&&(""===tlValue.trim()&&allowEmptyCheck?(fldError=!0,errTxt=ZPI18N.getString("zp.entervalforfield",[fldDispName])):skipSpclChar||(-1!==tlValue.indexOf(">")||-1!==tlValue.indexOf("<")?(fldError=!0,errTxt=ZPI18N.getString("zp.charactorremove",["<,>"])):null!==maxLength&&tlValue.length>maxLength&&(fldError=!0,errTxt=ZPI18N.getString("zp.fieldlength",[fldDispName,maxLength.toString()]))));var errorCont="valid";if(fldError){if(fldDtls.hasOwnProperty("fromTimlogSettCust")&&fldDtls.fromTimlogSettCust||fldDtls.hasOwnProperty("isV5")&&fldDtls.isV5)return errTxt;errorCont='<div id="error_message" class="'+errorClass+'">'+errTxt+"</div>"}return errorCont}},jobChange:function(id,obj,extraDetails){var billableStatus=void 0!==Timetracker.util.defaultbillingType?Timetracker.util.defaultbillingType:"0",disabled=!1,islogViewType=!1,jobVal="0",layout=Layout.Page.container,projectId="timerprojects",jobId="timerjobs",clientId="timerclients",containerId="",operation="",workitemDomId="",workItemNameofRow="",setWorkItem=!0,isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",extraDetails);extraDetails&&extraDetails.isV5;if(jobVal=void 0!==extraDetails&&void 0!==extraDetails.jobVal?extraDetails.jobVal:jobVal,"day"===id||"week"===id||"halfmonth"===id||"month"===id||extraDetails&&extraDetails.isBulkView)islogViewType=!0,containerId=(layout=obj=$(obj).closest("tr")).attr("id"),$(obj).find(".error-clr").removeClass("error-clr"),void 0!==extraDetails&&extraDetails.skipUpdate||(jobVal=TimelyZComp.select.getValue($(obj).find("[name='job']")),billableStatus=TimelyZComp.select.getValue($(obj).find("[name='bill_status']")),projectId=layout.find("[name='project']").attr("id"),jobId=layout.find("[name='job']").attr("id"),clientId=layout.find("[name='client']").attr("id")),workItemNameofRow=$(obj).attr("orgTaskName"),workitemDomId=layout.find("[name='workitem']").attr("id"),$(obj).find("[id^=daytxt],[id^=timepickerfrom],[id^=timepickerto],#"+workitemDomId+',[name="descText"],[id^="confirmBtn"]').prop("disabled",!1).removeClass("disabled"),$(obj).find("#"+workitemDomId).prop("disabled",!1).removeClass("disabled"),id=$(obj).find("[name='bill_status']").attr("id"),isBreakLog&&(setWorkItem=!1);else if("addeditlogtime"===id||"calendarLogTime"===id||"addeditbreaklogtime"===id){if("calendarLogTime"==id?(layout=layout.find("#calAddPopup"),containerId="calAddPopup"):layout=ZP5Form.getLayout()?ZP5Form.getLayout():layout,void 0===extraDetails||!extraDetails.skipUpdate||"addeditlogtime"===id&&extraDetails.hasOwnProperty("isFromTSTLAdd")&&extraDetails.isFromTSTLAdd){operation=id;void 0!==extraDetails&&extraDetails.hasOwnProperty("projectId")&&extraDetails.hasOwnProperty("projectVal")?(projectId=extraDetails.projectId,extraDetails.projectVal):(projectId=layout.find("input[name=Project]").attr("id"),0!=layout.find("#"+projectId).length&&ZPeopleComponents.select(layout.find("#"+projectId)).getValue()),void 0!==extraDetails&&extraDetails.hasOwnProperty("clientId")&&extraDetails.hasOwnProperty("clientVal")?(clientId=extraDetails.clientId,extraDetails.clientVal):(clientId=layout.find("input[name=Client]").attr("id"),0!=layout.find("#"+clientId).length&&ZPeopleComponents.select(layout.find("#"+clientId)).getValue()),jobId=layout.find("input[name=JobId]").attr("id"),jobVal=ZPeopleComponents.select(layout.find("#"+jobId)).getValue()}workitemDomId=layout.find('input[name="Work_Item"]').attr("id"),workItemNameofRow=layout.find('input[name="Work_Item"]').attr("orgTaskName"),id=layout.find("select[name=Billable_Status]").attr("id"),{}}else if("qbReport"===id)jobVal=Layout.Page.container.find("select[name=JobId]").val(),id=Layout.Page.container.find("select[name=Billable_Status]").attr("id"),projectId=Layout.Page.container.find("select[name=Project]").attr("id"),jobId=Layout.Page.container.find("select[name=JobId]").attr("id"),"projectid"===projectId?"0":"-Select-",{};else if("jobsch"===id){operation=id;var modal=layout.find("#jobScheduleAddEditPopup");clientId=modal.find("input[name=Client]").attr("id"),projectId=modal.find("input[name=Project]").attr("id"),jobId=modal.find("input[name=JobId]").attr("id"),"0"===jobVal&&(jobVal=ZPeopleComponents.select(modal.find("#"+jobId)).getValue()),ZPeopleComponents.select(modal.find("#"+projectId)).getValue(),ZPeopleComponents.isComponent(modal.find("#"+clientId))?ZPeopleComponents.select(modal.find("#"+clientId)).getValue():void 0,id="sch_billableStatus",workitemDomId="sch_workitem",{},billableStatus=-1}else if("timesheetEdit"===id){operation=id,jobVal=TimelyZComp.select.getValue(obj);let tData=$(obj).closest("tr").data();id="statusEdit_"+tData.timelogId,operation="timesheetEdit",workitemDomId=$(obj).closest("tr").find("[name='tsWorkItemSelect']").attr("id"),workItemNameofRow=tData.taskName}else void 0!==extraDetails&&extraDetails.skipUpdate||"0"!==(jobVal=ZPeopleComponents.select(Layout.Page.container.find("#timerjobs")).getValue())&&Timetracker.Util.removeError(Layout.Page.container.find("#timerjobs")),id="timerbill",operation="timerLogTime",workitemDomId="timertask";var jobIndex=Timetracker.projects.Operations.findJSONArrayIndex(Timetracker.jobs.jobData,jobVal,"jobId");if(-1!==jobIndex&&void 0!==Timetracker.jobs.jobData[jobIndex]&&(isBreakLog?void 0!==Timetracker.jobs.jobData[jobIndex].billableStatus&&(billableStatus=Timetracker.jobs.jobData[jobIndex].billableStatus,extraDetails&&extraDetails.isEditMode&&("disable",disabled=!0)):void 0!==Timetracker.jobs.jobData[jobIndex].jobBillableStatus&&(billableStatus=Timetracker.jobs.jobData[jobIndex].jobBillableStatus,"disable",disabled=!0),void 0!==Timetracker.jobs.jobData[jobIndex].projectId&&Timetracker.jobs.jobData[jobIndex].projectId,void 0!==Timetracker.jobs.jobData[jobIndex].clientId&&Timetracker.jobs.jobData[jobIndex].clientId),isBreakLog)if(extraDetails&&extraDetails.isEditMode)TimelyZComp.select.setValue(layout.find("#"+id),billableStatus),TimelyZComp.select.setAttributes(layout.find("#"+id),{disabled:!0});else{var billDomId="calendarLogTime"===operation?"brkTypevalCal":"brkTypevalText";-1===jobIndex?layout.find("#"+billDomId).html("-"):layout.find("#"+billDomId).html(ZPI18N.getString(Timetracker.Break.TYPE_STATUS[billableStatus])),layout.find("#"+billDomId).attr("name","payType"),layout.find("#"+billDomId).attr("value",-1===jobIndex?"-1":billableStatus)}else 0!=layout.find("#"+id).length&&(TimelyZComp.select.setValue(layout.find("#"+id),billableStatus),TimelyZComp.select.setAttributes(layout.find("#"+id),{disabled:disabled}));var selectdetails={allowAll:!0,isNewKey:!0};if(isBreakLog&&(selectdetails.isBreakLog=isBreakLog,setWorkItem=!1),-1!==jobIndex&&void 0!==Timetracker.jobs.jobData[jobIndex])var jobDataIndex=Timetracker.projects.Operations.findJSONArrayIndex(Timetracker.jobs.jobData,jobVal,"jobId"),jobDataAtIndex=Timetracker.jobs.jobData[jobDataIndex];else selectdetails.isNewKey=!1;if(void 0!==extraDetails&&extraDetails.skipUpdate||(extraDetails&&(extraDetails.skipJobReset&&(selectdetails.skipJobReset=extraDetails.skipJobReset),extraDetails.hasOwnProperty("isFromTSTLAdd")&&extraDetails.isFromTSTLAdd&&(selectdetails.isFromTSTLAdd=extraDetails.isFromTSTLAdd,extraDetails.hasOwnProperty("clientId")&&""!==extraDetails.clientId&&(selectdetails.clientId=extraDetails.clientId),extraDetails.hasOwnProperty("projectId")&&""!==extraDetails.projectId&&(selectdetails.projectId=extraDetails.projectId))),selectdetails.isV5=!0,Timetracker.timelogs.setValuesInSelectInput(jobDataAtIndex,operation,containerId,null,selectdetails)),setWorkItem){Timetracker.Util.removeError(layout.find("#"+workitemDomId));let extraJson={};if("jobsch"===operation?extraJson.erecno=Timetracker.jobSchedule.currPopupUser:"timesheetEdit"===operation&&(extraJson.erecno=extraDetails.erecno),extraJson.jobId=jobVal,extraJson.isJobWorkItemsExist=jobDataAtIndex?jobDataAtIndex.isJobWorkItemsExist:null,Timetracker.timelogs.workItem.checkIfDropDownNeededForWorkitem(extraJson)){if(extraJson.elementId=workitemDomId,extraJson.layout=layout.find("#"+workitemDomId),(islogViewType||"addeditlogtime"===operation||"calendarLogTime"===operation)&&(extraJson.toAppendOption=workItemNameofRow),islogViewType&&(extraJson.isBulkType=!0,extraJson.containerId=containerId),"timesheetEdit"===operation){let tr=$(obj).closest("tr");extraJson.elementId=$(tr).find("[name='tsWorkItemSelect']").attr("id"),extraJson.layout=$(tr).find("[name='tsWorkItemSelect']"),extraJson.moveOnScroll=!1,$(tr).find(".workItemEdit,[name='tsWorkItemSelect']").removeClass("zpl_DNI"),$(tr).find("#tsWorkItemInput").addClass("zpl_DNI")}extraJson.isV5=!0,Timetracker.timelogs.workItem.createDropdownForWorkitem(extraJson)}else if(workItemNameofRow=void 0==workItemNameofRow?"":workItemNameofRow,Timetracker.util.checkIsParamNotEmpty(workitemDomId)&&"0"!==workitemDomId.length&&(ZPeopleComponents.isComponent(layout.find("#"+workitemDomId))&&TimelyZComp.select.destroy(layout.find("#"+workitemDomId)),layout.find("#"+workitemDomId).val(ZPeople.decodeTxt(workItemNameofRow))),"timesheetEdit"===operation){let tr=$(obj).closest("tr");$(tr).find("#tsWorkItemInput").val(ZPeople.decodeTxt(workItemNameofRow)),$(tr).find("#tsWorkItemInput").removeClass("zpl_DNI"),$(tr).find("[name='tsWorkItemSelect']").addClass("zpl_DNI")}}if(Timetracker.jobSchedule.hasCustomFields()&&("addeditlogtime"===operation&&Timetracker.jobSchedule.timelogsView.constructJschinTLForm(),"timerLogTime"===operation)){var currSelObj={};if(currSelObj.jobId=jobVal,0!=jobVal&&"0"!==jobVal){var jschId=Timetracker.jobSchedule.timelogsView.fetchJobschIdCorresJob(currSelObj);null!=jschId?(currSelObj.isFromTimerSelect=!0,currSelObj.jschid=jschId,Timetracker.jobSchedule.timelogsView.constructDtlViewJobSch(currSelObj)):Layout.Page.container.find("#jsch_brief_divs").removeClass("zpl_act")}else Layout.Page.container.find("#jsch_brief_divs").removeClass("zpl_act")}},setBillableStatusForSingleJob:function(selJson,operation,jobVal,obj,otherDtls){operation="monthlyLogTime"===(operation="halfmonthlyLogTime"===(operation="weeklyLogTime"===(operation="dailyLogTime"===operation?"day":operation)?"week":operation)?"halfmonth":operation)?"month":operation;var extraDetails={skipUpdate:!0,jobVal:jobVal};Timetracker.BreakTimelogs.isBreakLog("DATA",otherDtls)&&(extraDetails.isBreakLog=!0),extraDetails.isV5=!0,-1!==["day","week","halfmonth","month","timerLogTime","calendarLogTime","addeditlogtime","jobsch"].indexOf(operation)&&Timetracker.timelogs.jobChange(operation,obj,extraDetails),"jobsch"===operation&&Timetracker.jobSchedule.setJobColor(jobVal)},setValuesInSelectInput:function(data,operation,containerId,elementId,otherDetails){var viewEditPermissionType,appendToDiv,clientId="0",projectId="0",jobId="0",allowClientSelect=!1,allowProjectSelect=!1,allowJobSelect=!1,allowQAinDropdown=!0,projLayout="",jobLayout="",clientLayout="",jobeleId="",projecteleId="",clienteleId="",setJobDefault=!0,setDefaultOption=!0,isNewKey=!1,isLogviewtype=!1,erecno=Timetracker.timelogs.tserecno,isBreakLog=!1,layout=Timetracker.Util.getLayout();if(containerId&&(layout=layout.find("#"+containerId)),otherDetails&&null!==otherDetails&&(otherDetails.hasOwnProperty("allowAll")&&(allowClientSelect=allowProjectSelect=allowJobSelect=!0),otherDetails.hasOwnProperty("specificKeyReset")&&(-1!==otherDetails.specificKeyReset.indexOf("client")&&(allowClientSelect=!0),-1!==otherDetails.specificKeyReset.indexOf("project")&&(allowProjectSelect=!0),-1!==otherDetails.specificKeyReset.indexOf("job")&&(allowJobSelect=!0)),isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",otherDetails),isNewKey=otherDetails.isNewKey,otherDetails.resetKey),"addeditlogtime"===operation||"addeditbreaklogtime"===operation){projLayout=(layout=ZP5Form.getLayout()?ZP5Form.getLayout():layout).find("#timelogProject"),projecteleId="timelogProject",jobLayout=layout.find("#timelogJob"),jobeleId="timelogJob",clientLayout=layout.find("#timelogClient"),clienteleId="timelogClient",allowClientSelect=!0,allowQAinDropdown=!1,viewEditPermissionType=Timetracker.constants.TTCustomAdmin.EntryView;var tsBody=Layout.Page.container.find("#tsdatatbody");if(void 0!==tsBody&&0!==tsBody.length){var tserecno=$(tsBody).attr("tserecNo");void 0!==tserecno&&null!==tserecno&&(erecno=tserecno)}}else"timerLogTime"===operation?(projLayout=layout.find("#timerprojects"),projecteleId="timerprojects",jobLayout=layout.find("#timerjobs"),jobeleId="timerjobs",clientLayout=layout.find("#timerclients"),clienteleId="timerclients",containerId="timerarea",viewEditPermissionType=Timetracker.constants.TTCustomAdmin.EntryView):"calendarLogTime"===operation?(projLayout=layout.find("#projectid"),projecteleId="projectid",jobLayout=layout.find("#jobid"),jobeleId="jobid",clientLayout=layout.find("#caltimelogClient"),clienteleId="caltimelogClient",viewEditPermissionType=Timetracker.constants.TTCustomAdmin.EntryView,allowQAinDropdown=!1):"timesheetEdit"===operation?(jobeleId=elementId,jobLayout=layout.find("#"+elementId),viewEditPermissionType=Timetracker.constants.TTCustomAdmin.EntryView,erecno=data.erecno,projectId=data.projectId,allowQAinDropdown=!1,setDefaultOption=!1,appendToDiv=Layout.Page.container.find("#timesheet_view_create")):"jobsch"===operation?(clientLayout=layout.find("#jbsch_clientid"),clienteleId="jbsch_clientid",projLayout=layout.find("#jbsch_projectid"),projecteleId="jbsch_projectid",jobLayout=layout.find("#jbsch_jobid"),jobeleId="jbsch_jobid",containerId="jobschdform",viewEditPermissionType=Timetracker.constants.TTCustomAdmin.EntryView,void 0!==data&&void 0!==data.assignedTo?erecno=data.assignedTo:void 0!==data&&void 0!==data.erecno?erecno=data.erecno[0]:void 0!=layout.find("#jobsch_form").attr("erecno")?erecno=layout.find("#jobsch_form").attr("erecno"):void 0!=layout.find("#jobScheduleAddEditPopup").attr("erecno")?erecno=layout.find("#jobScheduleAddEditPopup").attr("erecno"):null!=otherDetails&&otherDetails.hasOwnProperty("erecNo")&&(erecno=otherDetails.erecNo),allowQAinDropdown=!0):(containerId.indexOf("day")>=0?(operation="dailyLogTime","day",allowQAinDropdown=!isBreakLog):containerId.indexOf("week")>=0?(operation="weeklyLogTime","week",allowQAinDropdown=!isBreakLog):containerId.indexOf("halfmonth")>=0?(operation="halfmonthlyLogTime","halfmonth",allowQAinDropdown=!isBreakLog):containerId.indexOf("month")>=0&&(operation="monthlyLogTime","month",allowQAinDropdown=!isBreakLog),isLogviewtype=!0,viewEditPermissionType=Timetracker.constants.TTCustomAdmin.EntryView,containerId.indexOf("locjobschddtl")>=0&&(operation="locationjobschedule","locjobschd",allowQAinDropdown=!1,isLogviewtype=!1));var jobDispName=Timetracker.util.getJobDisplayName(!0),projectDispName=Timetracker.util.getProjectDisplayName(!0),clientDispName=Timetracker.util.getClientDisplayName(),jobtext=jobName="addeditlogtime"===operation||"calendarLogTime"===operation||"jobsch"===operation?ZPI18N.getString("zp.select"):ZPI18N.getString("zp.orgselectlabel",[jobDispName]);isBreakLog&&(jobtext=jobName=ZPI18N.getString("zp.select")+" "+ZPI18N.getString("zp.break"));var projecttext=projectName="addeditlogtime"===operation||"calendarLogTime"===operation||"jobsch"===operation?ZPI18N.getString("zp.select"):ZPI18N.getString("zp.orgselectlabel",[projectDispName]),clienttext=clientName="addeditlogtime"===operation||"calendarLogTime"===operation||"jobsch"===operation?ZPI18N.getString("zp.select"):ZPI18N.getString("zp.orgselectlabel",[clientDispName]),jobCacheKey=jobeleId,projectCacheKey=projecteleId,clientCacheKey=clienteleId;void 0!==data&&null!==data&&(null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients&&data.hasOwnProperty("clientName")||"jobsch"==operation&&data.hasOwnProperty("clientId")?(clientId=data.clientId,clientName=data.clientName,allowClientSelect=!0):allowClientSelect=!1,data.hasOwnProperty("projectName")&&(""!==data.projectId&&(projectId=data.projectId),""!==data.projectName&&(projectName=data.projectName),null===Timetracker.generalSettings.timelogEnabledFields||"1"!==Timetracker.generalSettings.timelogEnabledFields.TLC_Projects||isLogviewtype||(allowProjectSelect=!0)),void 0!==data.jobId&&""!=data.jobName&&(jobId=data.jobId,jobName=data.jobName)),null!=otherDetails&&otherDetails.hasOwnProperty("isFromTSTLAdd")&&(otherDetails.hasOwnProperty("clientId")&&(clientId=otherDetails.clientId),otherDetails.hasOwnProperty("projectId")&&(projectId=otherDetails.projectId)),"dailyLogTime"!==operation&&"weeklyLogTime"!==operation&&"halfmonthlyLogTime"!==operation&&"monthlyLogTime"!==operation&&"locationjobschedule"!==operation||(jobeleId=layout.find("[name='job']").attr("id"),jobLayout=layout.find("[name='job']"),jobCacheKey=containerId+"_"+jobeleId,projecteleId=layout.find("[name='project']").attr("id"),projLayout=layout.find("[name='project']"),projectCacheKey=containerId+"_"+projecteleId,clienteleId=layout.find("[name='client']").attr("id"),clientLayout=layout.find("[name='client']"),clientCacheKey=containerId+"_"+clienteleId),void 0!==data&&null!==data&&data.hasOwnProperty("isFromQA")&&(data.hasOwnProperty("isFromProjectsQA")?(""!==clientLayout&&ZPeopleComponents.isComponent(clientLayout)&&(clientId=TimelyZComp.select.getValue(clientLayout),allowClientSelect=!1),setJobDefault=!1):(projectId=TimelyZComp.select.getValue(projLayout),allowProjectSelect=allowClientSelect=!1));var jobconfigprop=Timetracker.Filters.Configuartion.getProperty(jobCacheKey+"-job"),projectconfigprop=Timetracker.Filters.Configuartion.getProperty(projectCacheKey+"-project"),clientconfigprop=Timetracker.Filters.Configuartion.getProperty(clientCacheKey+"-client");if(allowJobSelect){var jobNewKey=isNewKey,newElement={id:jobId,text:jobName,html:jobName,isNewKey:!0},params={mode:"getJobs",erecno:erecno,getCurUserJobs:!0,jobStatus:"0",projectId:projectId,includeDeptJobs:!0,isClientDetailsNeeded:!0,conreqcsr:csrfToken};void 0!==clientId&&"0"!==clientId&&""!==clientId&&(params.clientId=clientId),viewEditPermissionType&&Timetracker.isTTCustomAdmin(viewEditPermissionType)&&(params.viewEditPermissionType=viewEditPermissionType),isBreakLog&&(params.fetchBreakJobs=!0),"locationjobschedule"===operation&&(params.fetchOnlyLocationJobs=!0,params.assignedTo=otherDetails&&null!=otherDetails&&otherDetails.locationId?otherDetails.locationId:"0",delete params.getCurUserJobs,delete params.erecno,delete params.includeDeptJobs);var selJson={elementId:jobeleId,entity:Timetracker.constants.JOB,params:params};if(void 0!==jobconfigprop&&(jobconfigprop.params=params),null!==containerId&&isLogviewtype&&(selJson.containerId=containerId),setDefaultOption){var selectedJobId=0!=jobLayout.length&&TimelyZComp.isComponent(jobLayout)?ZPeopleComponents.select(jobLayout).getValue():"0";("0"===selectedJobId&&selectedJobId===newElement.id||"0"==newElement.id)&&(jobNewKey=!1),jobNewKey&&setJobDefault?(selJson.defSelJson={id:"0",text:jobtext,html:jobtext,isNewKey:!0,newEle:newElement},selJson.initSelJson=newElement):selJson.defSelJson=selJson.initSelJson={id:"0",text:jobtext,html:jobtext}}else jobNewKey&&(selJson.initSelJson=newElement);otherDetails&&otherDetails.skipJobReset&&(selJson.skipreset=otherDetails.skipJobReset),Timetracker.UserSpace.isMySpaceTimelogs()?selJson.appendTo=Layout.Page.parentContainer:void 0!=appendToDiv&&(selJson.appendTo=appendToDiv);Timetracker.zselect.create(!0,selJson);if(allowQAinDropdown&&Timetracker.util.checkAddJobPermVar){var json={id:jobeleId,isFromProjects:!1,containerId:containerId};"jobsch"===operation&&(json.optId="jsaddadd",json.containerId="jobschdform"),"timerLogTime"===operation&&(json.optId="timerjobadd"),Timetracker.timelogs.forms.addFromSelect(containerId,jobeleId,ZPI18N.getString("zp.add")+" "+jobDispName,Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json)}("jobsch_form"==containerId&&"false"==$("#jobsch_form").data("disEditab")||0==$("#jobsch_form").data("disEditab"))&&(0==$("#jobsch_form").data("IsPublish")||"false"==$("#jobsch_form").data("IsPublish")?layout.find("#submitSchedule").prop("disabled",!1):layout.find("#publishSchedule").prop("disabled",!1)),"dailyLogTime"===operation||"weeklyLogTime"===operation||"halfmonthlyLogTime"===operation||"monthlyLogTime"===operation||"locationjobschedule"===operation?Timetracker.jobs.Filters.gettitle(jobeleId,containerId):Timetracker.jobs.Filters.gettitle(jobeleId)}if(allowProjectSelect){var projectNewKey=isNewKey;params={mode:"getTimesheetProjectList",projectStatus:"0",proAssignedTo:erecno,isFromFilter:!0,includeDeptProjects:!0,conreqcsr:csrfToken};void 0!==clientId&&""!==clientId&&(params.clientId=clientId),viewEditPermissionType&&Timetracker.isTTCustomAdmin(viewEditPermissionType)&&(params.viewEditPermissionType=viewEditPermissionType);var orderObj=Timetracker.Util.getSortAscendingValues(Timetracker.constants.PROJECT);params.sortType=orderObj.sortType,params.isAscending=orderObj.isAscending,"locationjobschedule"===operation&&(params.fetchOnlyLocationProjects=!0,params.assignedTo=otherDetails&&null!=otherDetails&&otherDetails.locationId?otherDetails.locationId:"0",delete params.getCurUserJobs,delete params.proAssignedTo,delete params.includeDeptProjects);newElement={id:projectId,text:projectName,html:projectName,isNewKey:!0};void 0!==projectconfigprop&&(projectconfigprop.params=params);selJson={elementId:projecteleId,entity:Timetracker.constants.PROJECT,params:params};null!==containerId&&isLogviewtype&&(selJson.containerId=containerId);var selectedProjectId=0==projLayout.length?"0":ZPeopleComponents.select(projLayout).getValue();"0"===selectedProjectId&&selectedProjectId===newElement.id&&(projectNewKey=!1),projectNewKey?(selJson.defSelJson={id:"0",text:projecttext,html:projecttext,isNewKey:!0,newEle:newElement},selJson.initSelJson=newElement):selJson.defSelJson=selJson.initSelJson={id:"0",text:projecttext,html:projecttext},Timetracker.UserSpace.isMySpaceTimelogs()&&(selJson.appendTo=Layout.Page.parentContainer);Timetracker.zselect.create(!0,selJson);if(allowQAinDropdown&&Timetracker.util.checkAddProjectPermVar&&Timetracker.util.checkAddJobPermVar){json={id:projecteleId,isFromProjects:!0,containerId:containerId};"jobsch"===operation&&(json.optId="jsaddproject",json.containerId="jobschdform"),"timerLogTime"===operation&&(json.optId="timerprojectadd"),Timetracker.timelogs.forms.addFromSelect(containerId,projecteleId,ZPI18N.getString("zp.addcomponents",[projectDispName]),Timetracker.timelogs.forms.showAddJobProjectFromTimelogsCallBack,json)}"jobsch_form"!=containerId||"false"!=$("#jobsch_form").data("disEditab")&&0!=$("#jobsch_form").data("disEditab")||(0==$("#jobsch_form").data("IsPublish")||"false"==$("#jobsch_form").data("IsPublish")?layout.find("#submitSchedule").prop("disabled",!1):layout.find("#publishSchedule").prop("disabled",!1)),"dailyLogTime"===operation||"weeklyLogTime"===operation||"halfmonthlyLogTime"===operation||"monthlyLogTime"===operation||"locationjobschedule"===operation?Timetracker.jobs.Filters.gettitle(projecteleId,containerId):Timetracker.jobs.Filters.gettitle(projecteleId)}if(""!==clientLayout&&(allowClientSelect||"0"===clientId)){var clientNewKey=isNewKey,isFromClientSelect=otherDetails&&otherDetails.isFromClientSelect;""==clientId&&(clientNewKey=!1);params={mode:"getClientList",conreqcsr:csrfToken,isFromFilter:!0,assignedTo:erecno};viewEditPermissionType&&Timetracker.isTTCustomAdmin(viewEditPermissionType)&&(params.viewEditPermissionType=viewEditPermissionType);orderObj=Timetracker.Util.getSortAscendingValues(Timetracker.constants.CLIENT);params.sortType=orderObj.sortType,params.isAscending=orderObj.isAscending;newElement={id:clientId,text:clientName,html:clientName,isNewKey:!0};void 0!==clientconfigprop&&(clientconfigprop.params=params);-1==["timelogClient","caltimelogClient","jbsch_clientid","dayclientselect","weekclientselect","monthclientselect","timerclients"].indexOf(clienteleId)&&-1==["dailyLogTime","weeklyLogTime","halfmonthlyLogTime","monthlyLogTime"].indexOf(operation)||(params.includeDeptClients=!0,params.includeDivClients=!0),"locationjobschedule"===operation&&(params.fetchOnlyLocClients=!0,params.assignedto=otherDetails&&null!=otherDetails&&otherDetails.locationId?otherDetails.locationId:"0",delete params.assignedTo,delete params.includeDeptClients,delete params.includeDivClients,delete params.includeLocClients);selJson={elementId:clienteleId,entity:Timetracker.constants.CLIENT,params:params};null!==containerId&&isLogviewtype&&(selJson.containerId=containerId);var selectedClientId=0==clientLayout.length?"0":ZPeopleComponents.select(clientLayout).getValue();("0"===selectedClientId&&selectedClientId===newElement.id||!isFromClientSelect&&!projectNewKey)&&(clientNewKey=!1),otherDetails&&otherDetails.hasOwnProperty("clientNewKey")&&otherDetails.clientNewKey&&(clientNewKey=!0),clientNewKey?(selJson.defSelJson={id:"0",text:clienttext,html:clienttext,isNewKey:!0,newEle:newElement},selJson.initSelJson=newElement):selJson.defSelJson=selJson.initSelJson={id:"0",text:clienttext,html:clienttext},Timetracker.UserSpace.isMySpaceTimelogs()&&(selJson.appendTo=Layout.Page.parentContainer);Timetracker.zselect.create(!0,selJson);"dailyLogTime"===operation||"weeklyLogTime"===operation||"halfmonthlyLogTime"===operation||"monthlyLogTime"===operation||"locationjobschedule"===operation?Timetracker.jobs.Filters.gettitle(clienteleId,containerId):Timetracker.jobs.Filters.gettitle(clienteleId)}"timerLogTime"===operation&&Timetracker.jobSchedule.hasCustomFields()&&(Timetracker.Page.Timelogs.isListView()||Timetracker.UserSpace.isMySpaceTimelogs())&&Timetracker.jobSchedule.timelogsView.eventHandlingsJobSchDtls("BACK_JSCH_BREIF_LIST")},timelogExportCallback:function(){Timetracker.ImportExport.showExportOptions(Timetracker.timelogs.timelogExport,"timelog",!0,Timetracker.constants.TTCustomAdmin.EntryView,!0,!0,!0)},timelogExport:function(layout,params,downloadType){if(null==(params=Timetracker.timelogs.getParamsToFetchTimelogs()))return;var user=params.userErecNo;layout.find("#exportIncludeUsers").is(":visible")&&layout.find("#exportIncludeUsers").is(":checked")&&(user="0"),params.fileType=downloadType,path=(contextPath&&"null"!==contextPath&&"undefined"!==contextPath?"/"+contextPath:"")+Timetracker.constants.URL+"?mode=exportTimelogs&userErecNo="+user+"&getfrmDate="+params.fromDate+"&gettoDate="+params.toDate+"&getbill="+params.typeMode+"&fileType="+downloadType+(Timetracker.timelogs.isClientFieldAllowed()?"&clientId="+params.clientId:"")+"&jobId="+params.jobId+"&projectId="+params.projectId+"&approvalStatus="+params.approvalStatus;let exportAdditionalInfoContainer=Layout.Page.container.find("#tabZP5Export").find("[elem=exportAdditionalContainer]");exportAdditionalInfoContainer.length>0&&(path+="&designationNeeded="+exportAdditionalInfoContainer.find("#designationExport").is(":checked")+"&locationNeeded="+exportAdditionalInfoContainer.find("#locationExport").is(":checked")+"&reportingToNeeded="+exportAdditionalInfoContainer.find("#reportingToExport").is(":checked")+"&departmentNeeded="+exportAdditionalInfoContainer.find("#departmentExport").is(":checked"),isOrgStructureEnabled&&(path+="&legalEntityNeeded="+exportAdditionalInfoContainer.find("#leaglEntityExport").is(":checked")+"&businessUnitNeeded="+exportAdditionalInfoContainer.find("#businessUnitExport").is(":checked")+"&divisionNeeded="+exportAdditionalInfoContainer.find("#divisionExport").is(":checked")),Timetracker.generalSettings.isOrgTagEnabled()&&(path+="&orgTagNeeded="+exportAdditionalInfoContainer.find("#orgTagExport").is(":checked"))),Timetracker.ImportExport.submiteFormForExport(path)},getCreateTimesheetList:function(extraDtls){var params={mode:"getTimesheet",list:!0,includeLeave:!0,conreqcsr:csrfToken};0===Object.keys(Timetracker.leave.leaveTypeMap).length&&(params.leaveTypeNeeded=!0);var pageMode=Timetracker.Page.getPageMode(),tlparams={};if(tlparams=Timetracker.Page.Timelogs.isCalendarView()?Timetracker.timelogs.calendar.getParamsToFetchTimelogs("ts_mydata"==pageMode?erecno:Timetracker.Team.getSelectedUser()):Timetracker.timelogs.getParamsToFetchTimelogs(),Timetracker.timesheet.TsList.clientId=params.clientId=tlparams.clientId||"0",Timetracker.timesheet.TsList.projectId=params.projectId=tlparams.projectId||"0",Timetracker.timesheet.TsList.jobId=params.jobId=tlparams.jobId||"0",Timetracker.timesheet.TsList.billStatus=params.typeMode=void 0!=tlparams.typeMode?tlparams.typeMode:"-1",Timetracker.timesheet.TsList.userErecNum=params.userErecNo=Timetracker.timesheet.tslerecno=tlparams.userErecNo,Timetracker.timesheet.TsList.userName=ZPeople.getUserDetailsById(params.userErecNo).name,Timetracker.timesheet.TsList.empId=ZPeople.getUserDetailsById(params.userErecNo).empid,Timetracker.timesheet.TsList.image=ZPeople.decodeTxt(ZPeople.getUserDetailsById(params.userErecNo).avatar),Timetracker.Page.Timelogs.isCalendarView()){var curYear=(new Date).getFullYear(),curMonth=(new Date).getMonth();void 0!==Timetracker.timelogs.calObj&&void 0!==Timetracker.timelogs.calObj.curYear&&(curYear=Timetracker.timelogs.calObj.curYear),void 0!==Timetracker.timelogs.calObj&&void 0!==Timetracker.timelogs.calObj.curMonth&&(curMonth=Timetracker.timelogs.calObj.curMonth);var fromToDate=new Date(curYear,curMonth,1);Timetracker.timesheet.TsList.fromDate=params.fromDate=Calendar.formatDate(fromToDate),fromToDate=new Date(curYear,curMonth+1,0),Timetracker.timesheet.TsList.toDate=params.toDate=Calendar.formatDate(fromToDate)}else Timetracker.timesheet.TsList.fromDate=params.fromDate=tlparams.fromDate,Timetracker.timesheet.TsList.toDate=params.toDate=tlparams.toDate;$.post(Timetracker.constants.URL,params,function(result){if("NotAllowed"==result.error)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.timesheetcreationnotallowed")),!1;if(0!==result.tsArr.length)params.leaveTypeNeeded&&Timetracker.leave.setLeaveTypesMap(result.leaveData),Timetracker.timelogs.timesheetData=result,Timetracker.timelogs.originTimelogs=!0,"ts_mydata"==pageMode?window.location.href="#timetracker/mydata/timesheets":"ts_teamuser"==pageMode?window.location.href="#timetracker/team/user/timesheets-userId:"+Timetracker.Team.getSelectedUser():"ts_operuser"==pageMode&&(window.location.href="#operations/timetracker/searchuser/timesheets-userId:"+Timetracker.Team.getSelectedUser()),extraDtls&&extraDtls.isTLAddFromTS?Timetracker.timesheet.getTimesheetPage():Timetracker.timelogs.originUrl=Layout.Page.hash;else if(0!==Timetracker.timelogs.currentlyUnSubmittedhrs){var message="",tsbillablesetting=Timetracker.generalSettings.getTSBillableSetting(Timetracker.timesheet.tslerecno);message="2"===Timetracker.generalSettings.getTSClientSetting(Timetracker.timesheet.tslerecno)?"1"===tsbillablesetting?ZPI18N.getString("zp.timesheetcreationerrormessage1",[Timetracker.util.jobDispName]):"2"===tsbillablesetting?ZPI18N.getString("zp.timesheetcreationerrormessage2",[Timetracker.util.jobDispName]):ZPI18N.getString("zp.timesheetcreationerrormessage5",[Timetracker.util.jobDispName]):"1"===tsbillablesetting?ZPI18N.getString("zp.timesheetcreationerrormessage3"):"2"===tsbillablesetting?ZPI18N.getString("zp.timesheetcreationerrormessage4"):ZPI18N.getString("zp.nologhours",[ZPI18N.getString("zp.smallsubmit")]),Timetracker.util.showAlert(1,message)}else Timetracker.util.showAlert(1,ZPI18N.getString("zp.nologhours",[ZPI18N.getString("zp.smallsubmit")]))})},updateBrkCache:function(newValues,dateInp,removeTempEntires,updateExisitingCache){if(void 0!==removeTempEntires&&removeTempEntires){if(0!==Object.keys(Timetracker.timelogs.breakLogsData))for(var brkDateKeys=Object.keys(Timetracker.timelogs.breakLogsData),dte=0;dte<brkDateKeys.length;dte++)for(var dateVal=brkDateKeys[dte],brkDateDtl=Timetracker.timelogs.breakLogsData[dateVal],brkitr=0;brkitr<brkDateDtl.length;brkitr++){var dtls=brkDateDtl[brkitr];dtls.hasOwnProperty("isTempValue")&&dtls.isTempValue&&brkDateDtl.splice(brkitr,1)}}else if(void 0!==updateExisitingCache&&updateExisitingCache){if(!!newValues.hasOwnProperty("jschId")){if(Timetracker.timelogs.breakLogsData.hasOwnProperty(dateInp)){var brkArr=Timetracker.timelogs.breakLogsData[dateInp];for(brkitr=0;brkitr<brkArr.length;brkitr++){if((brkTempJson=brkArr[brkitr]).hasOwnProperty("jschId")&&newValues.hasOwnProperty("jschId")&&brkTempJson.jschId===newValues.jschId){brkTempJson.fromTime=newValues.fromTime,brkTempJson.toTime=newValues.toTime;break}}}}else if(Timetracker.timelogs.breakLogsData.hasOwnProperty(dateInp))for(brkArr=Timetracker.timelogs.breakLogsData[dateInp],brkitr=0;brkitr<brkArr.length;brkitr++){if((brkTempJson=brkArr[brkitr]).hasOwnProperty("timelogId")&&newValues.hasOwnProperty("timelogId")&&brkTempJson.timelogId===newValues.timelogId){brkTempJson.fromTime=newValues.fromTime,brkTempJson.toTime=newValues.toTime;break}}}else if(Timetracker.timelogs.breakLogsData.hasOwnProperty(dateInp)){brkArr=Timetracker.timelogs.breakLogsData[dateInp];var sameRowUpdate=!1;for(brkitr=0;brkitr<brkArr.length;brkitr++){var brkTempJson;if((brkTempJson=brkArr[brkitr]).hasOwnProperty("rowId")&&newValues.hasOwnProperty("rowId")&&brkTempJson.rowId===newValues.rowId){brkArr[brkitr]=newValues,sameRowUpdate=!0;break}}sameRowUpdate||Timetracker.timelogs.breakLogsData[dateInp].push(newValues)}else Timetracker.timelogs.breakLogsData[dateInp]=[],Timetracker.timelogs.breakLogsData[dateInp].push(newValues)},isClientFieldAllowed:function(){return Timetracker.jobSchedule.Form.isClientFilterAllowed()},getLastTimerIndex:function(data){return 0},constructWarnPopupForOverlap:function(reqParams,callbackFunctionName,addtnlParams){var callbackParams={params:reqParams,additionalParams:addtnlParams},header=ZPI18N.getString("zp.overlapwarnheader"),body=ZPI18N.getString("zp.overlapwarnbody"),btnVal=ZPI18N.getString("zp.allow.singular"),hdnCallback=null;addtnlParams&&addtnlParams.message&&(body=addtnlParams.message),addtnlParams&&addtnlParams.hasOwnProperty("hiddenCallback")&&"function"==typeof addtnlParams.hiddenCallback&&(hdnCallback=addtnlParams.hiddenCallback),ModuleComp.Modal.setup({id:"overlapWarnPopup",type:2,header:header,body:body,deleteOnHide:!0,closeOnSubmit:!0,isConfirm:!1,removeConfirmButtonClass:"zlabel--blue",confirmButtonClass:"zlabel--yellow",buttonValue:btnVal,iconClass:"ico info",backdrop:!1,successCallback:function(){callbackFunctionName(callbackParams)},hiddenCallback:hdnCallback})},showHideTimeLogTimer:function(type,id){Timetracker.util.removeErrorMsg("hoursdiv");var layout=Layout.Page.container,start_end_time_id="timelog_start_end_time",hours_time_id="timelog_hours_time",isFromBulk="bulklog_add_edit"===id;if(isFromBulk&&(start_end_time_id="bulk_timelog_start_end_time",hours_time_id="bulk_timelog_hours_time"),layout.find("#"+start_end_time_id).addClass("zpl_DNI"),layout.find("#"+hours_time_id).addClass("zpl_DNI"),"1"===type){var strtEndLayout=layout.find("#"+start_end_time_id);strtEndLayout.removeClass("zpl_DNI"),isFromBulk&&(strtEndLayout.find("input").hasClass("ztextbox__error")?layout.find("#bulklog_submit").addClass("disabled"):layout.find("#bulklog_submit").removeClass("disabled"))}else if("0"===type){var hrsLayout=layout.find("#"+hours_time_id);hrsLayout.removeClass("zpl_DNI"),isFromBulk&&(hrsLayout.find("input").hasClass("ztextbox__error")?layout.find("#bulklog_submit").addClass("disabled"):layout.find("#bulklog_submit").removeClass("disabled"))}},Firescroll:{getMode:function(){return Timetracker.Page.getPageMode()+"_tl"}},Operations:{formAddEditView:function(formId,recordId,viewLog,setWidgetDate,setCurrentUser,otherDtls){setCurrentUser&&Timetracker.util.setUserErecno(erecno),Timetracker.generalSettings.getSyncTimesheetSettings();var addEditJson=null,isTLAddFromTS=otherDtls&&otherDtls.isTLAddFromTS;Timetracker.timelogs.formDetails=Timetracker.util.getFormDetails(Timetracker.timelogs.formDetails,"P_Timesheet"),(addEditJson={formId:Timetracker.timelogs.formDetails.formId,tableName:"P_Timesheet",onloadCallback:Timetracker.forms.formOnLoadCallback,isEmbed:!0}).createFldFunctions={JobId:Timetracker.forms.constructFormField,Project:Timetracker.forms.constructFormField,Billable_Status:Timetracker.forms.constructFormField,TotalHours:Timetracker.forms.constructFormField},addEditJson.responseFldFunctions={JobId:Timetracker.forms.quickaddCallback,Project:Timetracker.forms.quickaddCallback},-1!==Layout.Page.hash.indexOf("home/dashboard")||Timetracker.Page.isProjectDashboard()?addEditJson.callback=Timetracker.timelogs.Operations.formAddEditViewCallback:Timetracker.Page.Timelogs.isSelfServiceListView()?addEditJson.callback=Timetracker.timelogs.showListPage:isTLAddFromTS&&(addEditJson.callback=Timetracker.timesheet.setFormTimelogAddCallback,addEditJson.isTLAddFromTS=!0,otherDtls.hasOwnProperty("tsFromDate")&&otherDtls.hasOwnProperty("tsToDate")&&(addEditJson.tsFromDate=otherDtls.tsFromDate,addEditJson.tsToDate=otherDtls.tsToDate),otherDtls.hasOwnProperty("isSingleProject")&&otherDtls.hasOwnProperty("projectName")&&otherDtls.hasOwnProperty("projectId")&&(addEditJson.projectId=otherDtls.projectId,addEditJson.projectName=otherDtls.projectName),otherDtls.hasOwnProperty("isSingleClient")&&otherDtls.hasOwnProperty("clientName")&&otherDtls.hasOwnProperty("clientId")&&(addEditJson.clientId=otherDtls.clientId,addEditJson.clientName=otherDtls.clientName),otherDtls.hasOwnProperty("ts_tl_manuallog")&&(addEditJson.ts_tl_manuallog=otherDtls.ts_tl_manuallog),otherDtls.hasOwnProperty("ts_tl_fromToLog")&&(addEditJson.ts_tl_fromToLog=otherDtls.ts_tl_fromToLog)),Timetracker.util.checkIsParamNotEmpty(recordId)?viewLog?(addEditJson.recordId=recordId,addEditJson.formMode="VIEW",addEditJson.editCallback=Timetracker.timelogs.Operations.formAddEditView,addEditJson.disableSingleEdit=!0):(addEditJson.recordId=recordId,addEditJson.formMode="EDIT"):setWidgetDate&&(addEditJson.setWidgetDate=!0),isTLAddFromTS||!Timetracker.UserSpace.isMySpace()&&"ts_homeuser"!=Timetracker.Page.getPageMode()||(addEditJson.noUrlChangeNeeded=!0,addEditJson.callback=Timetracker.timelogs.forms.showListPage),null!==addEditJson&&ZP5Form._toForm(addEditJson).init(),Timetracker.setWorkitemCache(),Timetracker.timesheet.isAddTimelogFromTSAllowed()&&Timetracker.timesheet.modifyTimelogModalFromTimesheet()},formAddEditViewCallback:function(pkId,currentTimerData){Timetracker.UserSpace.isMySpace()?Timetracker.UserSpace.Timelogs.init(Layout.Page.container,{erecno:erecno}):(pkId&&(Timetracker.timelogs.resetTLFetch(),Timetracker.timelogs.widgetLoaded&&Calendar.equalsTo(Timetracker.Widgets.Timelogs.currentTimelogDate,Calendar.getCurrentDate())&&Timetracker.Widgets.Timelogs.getTimelogs(""+Timetracker.Widgets.Timelogs.currentTimelogDate),Timetracker.Widgets.BillableNonBillable.getTimelogData(""+Timetracker.Widgets.Timelogs.currentTimelogDate)),currentTimerData&&!currentTimerData.hasOwnProperty("tabHidden")&&(Timetracker.timelogs.resetTimerValues(!0),Timetracker.timelogs.constructTimerTime(currentTimerData)))}}},Timetracker.timelogs.Import={construct:function(){Timetracker.Import.dtls={},Timetracker.Import.fileType=["xls","xlsx","csv"],Timetracker.Import.acceptFiles=".xls,xlsx,.csv",Timetracker.Import.dtls.noteArr=[ZPI18N.getString("zp.firstrowmsg"),ZPI18N.getString("zp.hoursformatmsg"),ZPI18N.getString("zp.unexpectederrormsg"),ZPI18N.getString("zp.alloweddatemsg")],Timetracker.Import.dtls.fileSlider=Timetracker.timelogs.Import.getImportSlider,Timetracker.Import.dtls.fileUploading=Timetracker.timelogs.Import.fileUploading,Timetracker.Import.dtls.getMappingSliderHtml=Timetracker.timelogs.Import.getMappingSliderHtml,Timetracker.Import.dtls.getVerifySliderHtml=Timetracker.timelogs.Import.getVerifySliderHtml,Timetracker.Import.dtls.getImportSummaryHtml=Timetracker.timelogs.Import.getImportSummaryHtml,Timetracker.Import.dtls.inputFileVerify=Timetracker.timelogs.Import.inputFileVerify,Timetracker.Import.dtls.autoMappingFields=Timetracker.timelogs.Import.autoMappingFields,Timetracker.Import.dtls.importTemplate=Timetracker.timelogs.Import.importTemplate,Timetracker.Import.dtls.viewRecords=Timetracker.timelogs.initTimelogs,Timetracker.Import.construct()},getImportSlider:function(dtls){var isBreakEnabled=Timetracker.generalSettings.isBreakEnabled(),content='<div class="zpl_crd" id="importCont"><div id="importFileDiv1" class="zpl_crdcnt"><div class="zpl_secn"><div class="zpl_imprtrecord zpl_DNI"><div id="partialrecordcountdiv"></div><button type="button" class="zlabel zlabel--blue zlabel--medium" id="partialRecordsMapping">'+ZPI18N.getString("zp.clickhere")+'</button></div></div><div class="zpl_secn"><div><div class="zpl_upld"><div class="zpl_fldrp"><div class="zpl_mdimprtimg"></div><h4 elem="fileNameInfo">'+ZPI18N.getString("zp.fileimported")+'</h4><p elem="fileExtensionInfo">'+ZPI18N.getString("zp.formfomtsupportxlscsv")+'</p><div><input style="display:none" type="file" accept=".xls,.xlsx,.csv" elem="ttConfigImportFile"><button elem="ttConfigImportButton" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.importfile")+'</button></div><p elem="fileSizeInfo">'+ZPI18N.getString("zp.maxfilesize")+'</p><p elem="templateInfo"><a onclick="Timetracker.Import.dtls.importTemplate()"><b>'+ZPI18N.getString("zp.shiftmapping.sampleFileImport")+"</b></a></p></div></div></div></div>";return content+='<div class="zpl_secn" elem="notes_section"><div><div class="zpl_info"><h6><b>'+ZPI18N.getString("zp.note")+"</b></h6>",dtls.noteArr&&(isBreakEnabled&&dtls.noteArr.push(ZPI18N.getString("zp.tlimporttypenote")),dtls.noteArr.forEach(function(x,i){content+="<p>"+(i+1)+") "+x+"</p>"})),content+="</div></div></div></div>",content+='</div><div class="zpl_DNI" id="loadingImportDiv"></div>'},fileUploading:function(fileObj){var cont=Timetracker.Import.importfileUpContiner;cont.find("#importFileDiv1").addClass("zpl_DNI"),cont.find("#loadingImportDiv").removeClass("zpl_DNI"),cont.find("#loadingImportDiv").html(ZPeople.LOADING_HTML);var formData=new FormData;fileObj&&(formData.append("file_name",fileObj),formData.append("module","Timelogs"),formData.append("conreqcsr",csrfToken),cont.find("#nextButton").addClass("disabled"),$.ajax({url:"/timeSheetImport.zp",type:"POST",data:formData,contentType:!1,processData:!1,success:function(response){cont.find("#nextButton").removeClass("disabled"),1===response.res?(Timetracker.Import.fileData=response,Timetracker.Import.constructImportDiv()):(void 0!=response.errorCode?Timetracker.Util.displayFailureMessage(Timetracker.Util.getFailureMessageByCode(response.errorCode)):void 0!=response.errMsg?Timetracker.Util.displayFailureMessage(response.errMsg):Timetracker.Util.displayFailureMessage(ZPI18N.getString("zp.ttfailuremsg")),Timetracker.Import.importfileUpObj.close())}}))},mappingFieldArr:null,getMappingFieldArr:function(){if(!Timetracker.timelogs.Import.mappingFieldArr){Timetracker.timelogs.Import.mappingFieldArr=[];var mappingFields=[];mappingFields.push({field:"date",labelName:ZPI18N.getString("zp.date")}),mappingFields.push({field:"job",labelName:Timetracker.jobs.formDetails.labelDetails.JOBNAME}),mappingFields.push({field:"jobslist",labelName:Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME}),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.CLIENT)&&mappingFields.push({field:"client",labelName:Timetracker.clients.formDetails.labelDetails.CLIENTNAME}),mappingFields.push({field:"Billing",labelName:ZPI18N.getString("zp.billablestatus")}),mappingFields.push({field:"Description",labelName:Timetracker.util.descriptionDispName}),mappingFields.push({field:"fromtime",labelName:ZPI18N.getString("zp.fromtime")}),mappingFields.push({field:"totime",labelName:ZPI18N.getString("zp.totime")}),mappingFields.push({field:"task",labelName:Timetracker.util.workitemDispName}),mappingFields.push({field:"Hrs",labelName:ZPI18N.getString("zp.hours")}),Timetracker.generalSettings.isBreakEnabled()&&mappingFields.push({field:"Type",labelName:ZPI18N.getString("zp.type")});for(var rowCount=parseInt(mappingFields.length/2)+mappingFields.length%2,ind=0;ind<rowCount;)obj=mappingFields[ind],Timetracker.timelogs.Import.mappingFieldArr.push(obj),ind+rowCount<mappingFields.length&&(obj=mappingFields[ind+rowCount],Timetracker.timelogs.Import.mappingFieldArr.push(obj)),ind++}return Timetracker.timelogs.Import.mappingFieldArr},getMappingSliderHtml:function(){var isMand,fontClass,field,labelName,fieldArr=Timetracker.timelogs.Import.getMappingFieldArr(),html='<div class="zpl_btnmnu"><div><ul class="zpl_grpmnu"><li elem="mapUnMapDiv" value="allFields" class="zpl_act">All</li><li elem="mapUnMapDiv" value="mappedFields">'+ZPI18N.getString("zp.mapping")+' <div id="mappedNo"><b></b></div></li><li elem="mapUnMapDiv" value="unMappedFields">'+ZPI18N.getString("zp.unmapped")+' <div id="unMappedNo"><b></b></div></li></ul></div><div class="zpl_rgt"><button class="zlabel zlabel--red zlabel--medium zlabel--outline" onclick="Timetracker.Import.resetOrAutomapFields(true);">'+ZPI18N.getString("zp.resetfields")+'</button><button class="zlabel zlabel--blue zlabel--medium zlabel--outline" onclick="Timetracker.Import.resetOrAutomapFields();">'+ZPI18N.getString("zp.automapfields")+'</button></div></div><div class="zpl_rgtcnt zpl_crdwthful"><div class="zpl_crd" elem="collapseMainDiv"><div class="zpl_crdcnt zpl_colpanls" data-toggle-button-position="right" aria-multiselectable="true"><div id="ttimport_empmapping_collapseDiv" elem="collapsibleSectionPanel"><div><div <h4="">'+ZPI18N.getString("zp.mapdetails")+'</div> </div><div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.mappingfield")+'</font><b class="zbadges DNI"></b></label><select class="select-js defaultValues" id="imp_mapfield_map" style="display: none;"><option value="-1">'+ZPI18N.getString("zp.select")+'</option><option value="1">'+ZPI18N.getString("zp.mailId")+'</option><option value="2">'+ZPI18N.getString("zp.empid")+'</option></select></div></div><div><div elem="mappingFieldDiv"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.mappingvalue")+'</font><b class="zbadges columnIndex DNI"></b></label><div class="d-flexcap a-itm-cntr"><select id="imp_mapvalue_map" class="select-js" style="display: none;"></select></div></div></div></div></div></div></div></div><div class="zpl_crd" elem="collapseMainDiv"><div class="zpl_crdcnt zpl_colpanls" data-toggle-button-position="right" aria-multiselectable="true"><div id="ttimport_mapping_collapseDiv" elem="collapsibleSectionPanel"><div><div <h4="">'+ZPI18N.getString("zp.basicinfo")+"</div></div><div>",isLeftCol=!0;return $.each(fieldArr,function(ind,obj){switch(field=obj.field,labelName=obj.labelName,isMand=!1,fontClass="",field){case"job":isMand=!0,fontClass="form_jobname";break;case"Hrs":case"date":isMand=!0;break;case"jobslist":isMand=Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.PROJECT),fontClass="form_projectname";case"client":isMand=Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.CLIENT),fontClass="form_clientname";break;case"task":isMand=Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.WORKITEM),fontClass="form_workitemname";break;case"Description":isMand=Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.DESC),fontClass="form_descname"}html+=isLeftCol?'<div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label'+(isMand?' class="zpl_mtry"':"")+'><font class="'+fontClass+'">'+labelName+'</font><b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="imp_'+field+'_map" style="display: none;"></select></div></div>':'<div><div elem="mappingFieldDiv"><label'+(isMand?' class="zpl_mtry"':"")+'><font class="'+fontClass+'">'+labelName+'</font><b class="zbadges columnIndex DNI"></b></label><div class="d-flexcap a-itm-cntr"><select class="select-js" id="imp_'+field+'_map" style="display: none;"></select></div></div></div></div>',isLeftCol=!isLeftCol}),html+=(isLeftCol?"":"</div>")+'</div></div></div></div></div><div id="zp_empty_data"/></div></div>'},getVerifySliderHtml:function(){var isMand,fontClass,fieldArr=Timetracker.timelogs.Import.getMappingFieldArr(),html='<div class="zpl_rgtcnt zpl_crdwthful"><div class="zpl_crd" elem="collapseMainDiv"><div class="zpl_crdcnt zpl_colpanls" data-toggle-button-position="right" aria-multiselectable="true"><div id="ttimport_empmapping_collapseDiv" elem="collapsibleSectionPanel"><div><div <h4="">'+ZPI18N.getString("zp.mapdetails")+'</div> </div><div><div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.mappingfield")+'</font><b class="zbadges DNI"></b></label><select class="select-js defaultValues" id="imp_mapfield" style="display: none;"><option value="-1">'+ZPI18N.getString("zp.select")+'</option><option value="1">'+ZPI18N.getString("zp.mailId")+'</option><option value="2">'+ZPI18N.getString("zp.empid")+'</option></select></div></div><div><div elem="mappingFieldDiv"><label class="zpl_mtry"><font>'+ZPI18N.getString("zp.mappingvalue")+'</font><b class="zbadges columnIndex DNI"></b></label><div class="d-flexcap a-itm-cntr"><select id="imp_mapvalue" class="select-js" style="display: none;"></select></div></div></div></div></div></div></div></div><div class="zpl_crd"><div class="zpl_crdcnt zpl_colpanls" data-toggle-button-position="right" aria-multiselectable="true"><div id="ttimport_mapping_collapseDiv" elem="collapsibleSectionPanel"><div><div <h4="">'+ZPI18N.getString("zp.basicinfo")+"</div> </div><div>",isLeftCol=!0;return $.each(fieldArr,function(ind,obj){switch(field=obj.field,labelName=obj.labelName,isMand=!1,fontClass="",field){case"job":isMand=!0,fontClass="form_jobname";break;case"Hrs":case"date":isMand=!0;break;case"jobslist":isMand=Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.PROJECT),fontClass="form_projectname";case"client":isMand=Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.CLIENT),fontClass="form_clientname";break;case"task":isMand=Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.WORKITEM),fontClass="form_workitemname";break;case"Description":isMand=Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.DESC),fontClass="form_descname"}html+=isLeftCol?'<div class="zpl_secn zpl_twoclum" elem="rowContainer"><div><div elem="mappingFieldDiv"><label'+(isMand?' class="zpl_mtry"':"")+'><font class="'+fontClass+'">'+labelName+'</font><b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="imp_'+field+'" style="display: none;"></select></div></div>':'<div><div elem="mappingFieldDiv"><label'+(isMand?' class="zpl_mtry"':"")+'><font class="'+fontClass+'">'+labelName+'</font><b class="zbadges columnIndex DNI"></b></label><div class="d-flexcap a-itm-cntr"><select class="select-js" id="imp_'+field+'" style="display: none;"></select></div></div></div></div>',isLeftCol=!isLeftCol}),html+=(isLeftCol?"":"</div>")+'</div></div></div></div></div><div id="zp_empty_data"/></div></div>'},getImportSummaryHtml:function(resultData){var totalRec=resultData.totalcount,errorRec=resultData.errorcount?resultData.errorcount:0,addedRec=totalRec-errorRec,skippedRec=errorRec;addedRec>0&&Timetracker.timelogs.resetTLFetch(!0);var html='<div class="zpl_imprtrecordvw"><div class="zpl_secn"><div><div class="zpl_imprtrecord">';if(html+='<div><i class="PI_tick2_fil grn"></i><b>'+ZPI18N.getString("zp.importSuccess",[""])+"</b></div>",html+='<button type="button" class="zlabel zlabel--blue zlabel--medium" onclick="Timetracker.Import.viewRecords()">'+ZPI18N.getString("zp.viewRecords")+"</button>",html+="</div></div></div></div>",html+='<div class="zpl_btnmnu"><div><ul class="zpl_grpmnu">',html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfTot")+" <b>"+totalRec+"</b></li>",html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfAdd")+" <b>"+addedRec+"</b></li>",html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfSkip")+" <b>"+skippedRec+"</b></li>",html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfErr")+" <b>"+errorRec+"</b></li>",html+="</ul></div></div>",resultData.errorcount){var keys=new Array;for(var k in resultData.errors)keys.push(k);keys.sort();var len=keys.length;html+='<div class="zpl_rgtcnt"><div class="zpl_tblres"> <table class="zpl_tbl"><thead><tr><th>Key</th><th>'+ZPI18N.getString("zp.error")+"</th></tr></thead><tbody>";for(var tempI=0;tempI<len;tempI++){var key=keys[tempI],split=resultData.errors[key].split(":");html+="<tr><td>"+split[0]+"</td><td>"+split[1]+"</td></tr>"}html+="</tbody></table></div></div>"}return html},inputFileVerify:function(){var container=Timetracker.Import.importContainer.find("#ttimport_verify_card");container.find("#nextButton").addClass("disabled");var mandFields=container.find(".zpl_mtry"),showFldError=!1;if($.each(mandFields,function(ind,field){var selectFiled=$(field).parent().find("select"),val=TimetrackerOperations.Filters.getSelectFilterValues(selectFiled);if(!val||-1==val)return showFldError=!0,!1}),showFldError)Timetracker.Import.importObj.showTab(2);else{var params={mode:"timesheetImportMapping",fileFormat:Timetracker.Import.fileFormat,conreqcsr:csrfToken};if(Timetracker.timelogs.Import.updateParam(container.find("#imp_mapfield"),params,"mapfield"),Timetracker.timelogs.Import.updateParam(container.find("#imp_mapvalue"),params,"mapvalue"),Timetracker.timelogs.Import.updateParam(container.find("#imp_date"),params,"date"),Timetracker.timelogs.Import.updateParam(container.find("#imp_job"),params,"projname"),Timetracker.timelogs.Import.updateParam(container.find("#imp_jobslist"),params,"jobslist"),0!=container.find("#imp_client").length&&Timetracker.timelogs.Import.updateParam(container.find("#imp_client"),params,"clientname"),Timetracker.timelogs.Import.updateParam(container.find("#imp_Billing"),params,"billing"),Timetracker.timelogs.Import.updateParam(container.find("#imp_Description"),params,"description"),Timetracker.timelogs.Import.updateParam(container.find("#imp_fromtime"),params,"ftime"),Timetracker.timelogs.Import.updateParam(container.find("#imp_totime"),params,"ttime"),Timetracker.timelogs.Import.updateParam(container.find("#imp_task"),params,"task"),Timetracker.timelogs.Import.updateParam(container.find("#imp_Hrs"),params,"hours"),Timetracker.generalSettings.isBreakEnabled()){var type=TimelyZComp.select.getValue(container.find("#imp_Type"));"-1"!=type&&""!=type&&(params.type=type)}ZPeople.Request.send("/timeSheetImport.zp",params,function(response){Timetracker.Import.importSummary(response),container.find("#nextButton").removeClass("disabled")},{},Timetracker.Util.generalFailureCallback)}},updateParam:function(layoutDiv,param,paramId){var val=TimelyZComp.select.getValue(layoutDiv);"-1"!=val&&""!=val||(val=-1),param[paramId]=val},autoMappingFields:function(cont){var hoursAutoMapArr=new Array;hoursAutoMapArr.push("hour(s)"),hoursAutoMapArr.push("hours"),hoursAutoMapArr.push("hour");var encodedHrs=ZSEC.Encoder.encodeForHTML("hour(s)");hoursAutoMapArr.push(encodedHrs),TimelyZComp.select.setValue(cont.find("#imp_date_map"),Timetracker.Import.headerHash.date),TimelyZComp.select.setValue(cont.find("#imp_job_map"),Timetracker.Import.headerHash["job name"]),TimelyZComp.select.setValue(cont.find("#imp_jobslist_map"),Timetracker.Import.headerHash["project name"]),0!=cont.find("#imp_client_map").length&&TimelyZComp.select.setValue(cont.find("#imp_client_map"),Timetracker.Import.headerHash["client name"]),TimelyZComp.select.setValue(cont.find("#imp_fromtime_map"),Timetracker.Import.headerHash["from time"]),TimelyZComp.select.setValue(cont.find("#imp_totime_map"),Timetracker.Import.headerHash["to time"]),TimelyZComp.select.setValue(cont.find("#imp_task_map"),Timetracker.Import.headerHash["work item"]),TimelyZComp.select.setValue(cont.find("#imp_Description_map"),Timetracker.Import.headerHash.description),TimelyZComp.select.setValue(cont.find("#imp_Billing_map"),Timetracker.Import.headerHash["billing status"]);for(var itr=0;itr<hoursAutoMapArr.length;itr++){var hrsTxt=hoursAutoMapArr[itr];TimelyZComp.select.setValue(cont.find("#imp_Hrs_map"),Timetracker.Import.headerHash[hrsTxt])}0!=cont.find("#imp_Type_map").length&&TimelyZComp.select.setValue(cont.find("#imp_Type_map"),Timetracker.Import.headerHash.type)},importTemplate:function(){var formObj=$("<form id='timelog_imp_form' action='timeSheetImport.zp?mode=timesheetImportTemplate' method='post' target='exportresp1' style='display:none'/>").html("");formObj.append('<input type="hidden" value="'+csrfToken+'" name="conreqcsr"/>'),formObj.append('<input type="hidden" value="importTTLogs" name="module"/>'),$("body").append(formObj),formObj.trigger("submit")}},Timetracker.timelogs.timer={pauseclock:function(obj){0!==$(obj).length&&$(obj).attr("onclick","").off("click");var timerButton=Layout.Page.container.find("#checkInButton");$(timerButton).attr("onclick","").off("click"),Timetracker.timelogs.currentTimerJobData?(timerButton.find("#timerrunning").addClass("zpl_DNI"),timerButton.find("#timerloading").removeClass("zpl_DNI")):(timerButton.find("#timerstart").addClass("zpl_DNI"),timerButton.find("#timerloading").removeClass("zpl_DNI")),$("body").find("#stop-timer").attr("onclick","").off("click"),Timetracker.util.getTTLocation(Timetracker.timelogs.timer.pauseclockCallback,obj)},pauseclockCallback:function(obj){var isTimerRunning=Timetracker.timelogs.currentTimerJobData,isBreakLog=Timetracker.BreakTimelogs.isBreakTimerRunning(),isFromTimerButton=obj&&"timerButton"===$(obj).attr("name"),isFromBreak=obj&&"breakTimer"===$(obj).attr("name"),layout=Layout.Page.container;if(isTimerRunning&&(!isBreakLog&&!isFromBreak||isBreakLog&&!isFromTimerButton)){Layout.Page.container.find("#addtimenote").addClass("zpl_DNI");var timesheetId=Timetracker.timelogs.currentTimerJobData.timelogId,timerButton="checkInButton";isBreakLog&&(timerButton="breakStopButton");var timerId=Layout.Page.container.find("#"+timerButton).attr("timeId");timerId||(Timetracker.timelogs.currentTimerJobData.hasOwnProperty("timearr")?$.each(Timetracker.timelogs.currentTimerJobData.timearr,function(index,timerdata){if(!timerdata.toTime)return timerId=timerdata.timerId,isBreakLog||Timetracker.timelogs.timer.hideTimerLoadIcon("timerrunning"),!1}):Timetracker.timelogs.currentTimerJobData.hasOwnProperty("timerId")&&(timerId=Timetracker.timelogs.currentTimerJobData.timerId));var params={mode:"nextend",returnTimelog:!0,timesheetId:timesheetId,timerId:timerId,conreqcsr:csrfToken};if(0!==Object.keys(Timetracker.location.latLongParam).length){var location_obj=Timetracker.location.latLongParam;location_obj.hasOwnProperty("latitude")&&null!==location_obj.latitude&&!isNaN(Timetracker.location.latLongParam.latitude)&&location_obj.hasOwnProperty("longitude")&&null!==location_obj.longitude&&!isNaN(Timetracker.location.latLongParam.longitude)&&location_obj.hasOwnProperty("accuracy")&&null!==location_obj.accuracy&&!isNaN(Timetracker.location.latLongParam.accuracy)&&(params.longitude=Timetracker.location.latLongParam.longitude,params.latitude=Timetracker.location.latLongParam.latitude,params.accuracy=Timetracker.location.latLongParam.accuracy)}$.post("/timesheet.zp",params,function(result){var rebindTimerEvents=!0,resCode="",resMsg="",isSuccess=!1;if(isBreakLog&&Timetracker.timelogs.timer.hideTimerLoadIcon("timerstart"),null!==result&&!(isSuccess=result.res)&&result.hasOwnProperty("errorCode")&&(resCode=result.errorCode,resMsg=result.hasOwnProperty("extraDtls")?Timetracker.Util.getFailureMessageByCode(resCode,result.extraDtls,!0):Timetracker.Util.getFailureMessageByCode(resCode,null,!0),Timetracker.util.showAlert(1,resMsg)),resCode===Timetracker.constants.ERROR_CODES.TIMELOG.TIMER_NEXT_DAY)rebindTimerEvents=!1,Timetracker.timelogs.timer.resetTimerValues();else if(isSuccess){var timelog=result.resArr;if(timelog=0!==timelog.length?timelog[0]:null)return rebindTimerEvents=!1,Timetracker.timelogs.timer.resetComponentsOnTimerPause(timelog,isBreakLog),result.extraDtls&&result.extraDtls.newTimelog&&Timetracker.timelogs.constructSingleTimelog(result.extraDtls.newTimelog),result.extraDtls&&result.extraDtls.deducted_hrs?(Timetracker.timelogs.timer.resetTimerValues(),Timetracker.util.showAlert(1,ZPI18N.getString("zp.timerstophrswarningerror"))):Timetracker.util.showAlert(2,ZPI18N.getString("zp.timerstopped")),Timetracker.jobSchedule.hasCustomFields()&&Timetracker.jobSchedule.timelogsView.eventHandlingsJobSchDtls("CLR_SEL_CLS"),void Timetracker.timelogs.resetTLFetch(!0)}rebindTimerEvents&&Timetracker.timelogs.timer.rebindTimerEvents(obj,!1)})}else if(isFromBreak){var allowStartTimer=!0,jobId=$(obj).attr("jobid");(allowStartTimer=Timetracker.BreakTimelogs.List.validateAndShowErrorBreakLog(jobId,"2"))?Timetracker.BreakTimelogs.List.startBreakTimerlog(jobId):Timetracker.BreakTimelogs.List.rebindTimerEvents()}else{allowStartTimer=!0;Timetracker.util.removeErrorMsg(null,layout.find("#timerarea"));var jobid=TimelyZComp.select.getValue(layout.find("#timerjobs"));if(jobid&&"0"!==jobid||(Timetracker.Util.addError(layout.find("#timerjobs")),allowStartTimer=!1),Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.PROJECT)){var projId=0==layout.find("#timerprojects").length?"0":TimelyZComp.select.getValue(layout.find("#timerprojects"));if(projId&&"0"!==projId||(Timetracker.Util.addError(layout.find("#timerprojects")),allowStartTimer=!1),Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.CLIENT)){var clntId=0==layout.find("#timerclients").length?"0":TimelyZComp.select.getValue(layout.find("#timerclients"));clntId&&"0"!==clntId||(Timetracker.Util.addError(layout.find("#timerclients")),allowStartTimer=!1)}}if(Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.WORKITEM)){var wiDiv=layout.find("#timertask");if(0!=wiDiv.length)if(Timetracker.Util.removeError(wiDiv),ZPeopleComponents.isComponent(wiDiv)){var wiId=ZPeople.decodeTxt(TimelyZComp.select.getValue(wiDiv));wiId&&"0"!==wiId||(Timetracker.Util.addError(wiDiv),allowStartTimer=!1)}else{""===wiDiv.val()&&(Timetracker.Util.addError(wiDiv),allowStartTimer=!1)}else allowStartTimer=!1}if(Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.DESC)){var descTxt=layout.find("#timerDesc").data().timerDesc;""!==descTxt&&void 0!==descTxt||(layout.find("#timerDesc").removeClass("lv_bgclr2").addClass("lv_bgclr5"),allowStartTimer=!1)}allowStartTimer?Timetracker.timelogs.timer.startTimerlog(jobid):(Timetracker.timelogs.timer.hideTimerLoadIcon("timerstart"),Timetracker.timelogs.timer.rebindTimerEvents(obj,!1))}},hideTimerLoadIcon:function(showID){var timerButton=Layout.Page.container.find("#checkInButton");timerButton.find("#timerloading").addClass("zpl_DNI"),"timerstart"==showID?(timerButton.find("#timerstart").removeClass("zpl_DNI"),timerButton.find("#timerrunning").addClass("zpl_DNI")):(timerButton.find("#timerrunning").removeClass("zpl_DNI"),timerButton.find("#timerstart").addClass("zpl_DNI"))},startTimerlog:function(jobid){Timetracker.timelogs.isTimerReq=!1,Timetracker.util.getTTLocation(Timetracker.timelogs.timer.startTimerlogCallback,jobid)},startTimerlogCallback:function(jobid){var layout=Layout.Page.container;if(Timetracker.timelogs.tserecno!==erecno)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.timeralert7")),Layout.Page.container.find("#checkInButton").off().on("click",function(e){Timetracker.timelogs.timer.pauseclock(this)}),Timetracker.timelogs.timer.hideTimerLoadIcon("timerstart"),!1;var billid=null;Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)&&(billid=TimelyZComp.select.getValue(layout.find("#timerbill")));var task=Layout.Page.container.find("#timertask").val();if(ZPeopleComponents.isComponent(layout.find("#timertask"))&&"0"===(task=ZPeople.decodeTxt(TimelyZComp.select.getValue(layout.find("#timertask"))))&&(task=null),task&&null!==task&&task.trim().length>500)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.namecharlimit",[Timetracker.util.workitemDispName,"500"])),Layout.Page.container.find("#timertask").parent().addClass("error"),Layout.Page.container.find("#checkInButton").off().on("click",function(e){Timetracker.timelogs.timer.pauseclock(this)}),Timetracker.timelogs.timer.hideTimerLoadIcon("timerstart"),!1;var desc="";if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC)&&(desc=Layout.Page.container.find("#timerDesc").data().timerDesc),Layout.Page.container.find("#checkInButton").attr("onclick","").off("click"),!Timetracker.timelogs.isTimerReq){Timetracker.timelogs.isTimerReq=!0;var params={jobId:jobid,mode:"timeradd",returnTimelog:!0,type:2,conreqcsr:csrfToken};null!==billid&&(params.billable=billid),null!==task&&(params.taskName=task),null!==desc&&""!==desc&&(params.desc=desc);var projectId=0!=layout.find("#timerprojects").length?TimelyZComp.select.getValue(layout.find("#timerprojects")):"0";if(null!==projectId&&"0"!==projectId&&0!==projectId&&void 0===projectId&&(params.projectId=projectId),0!==Object.keys(Timetracker.location.latLongParam).length){var obj=Timetracker.location.latLongParam;obj.hasOwnProperty("latitude")&&null!==obj.latitude&&obj.hasOwnProperty("longitude")&&null!==obj.longitude&&obj.hasOwnProperty("accuracy")&&null!==obj.accuracy&&(params.longitude=Timetracker.location.latLongParam.longitude,params.latitude=Timetracker.location.latLongParam.latitude,params.accuracy=Timetracker.location.latLongParam.accuracy)}null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients&&(params.requireClientDetails=!0),Timetracker.timelogs.timer.sendTimeraddRequest(params)}},sendTimeraddRequest:function(params){var layout=Layout.Page.container;$.post("/timesheet.zp",params,function(result){Timetracker.timelogs.isTimerReq=!1,layout.find("#checkInButton").off().on("click",function(e){Timetracker.timelogs.timer.pauseclock(this)}),Timetracker.timelogs.timer.hideTimerLoadIcon("timerstart");var resCode="",resMsg="",isSuccess=!1;if(null!==result&&!(isSuccess=result.res)&&result.hasOwnProperty("errorCode")&&(resCode=result.errorCode,result.hasOwnProperty("extraDtls")?resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_TIMELOG_ENTRY_OVERLAP&&"1"===Timetracker.generalSettings.getTimelogOverlapType()?Timetracker.timelogs.constructWarnPopupForOverlap(params,Timetracker.timelogs.timer.successcallbackTimeradd,{}):(resMsg=Timetracker.Util.getFailureMessageByCode(resCode,result.extraDtls,!0),Timetracker.util.showAlert(1,resMsg)):resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_MAXLOGHOURRESTRICT?(resMsg=result.message,Timetracker.util.showAlert(1,resMsg)):(resMsg=Timetracker.Util.getFailureMessageByCode(resCode,null,!0),Timetracker.util.showAlert(1,resMsg))),resCode===Timetracker.constants.ERROR_CODES.TIMELOG.IPRESTRICTION)Timetracker.timelogs.timer.resetTimer(),layout.find("#checkInButton").removeClass("disabled");else if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.GEORESTRICTION)Timetracker.timelogs.timer.resetTimer(),layout.find("#checkInButton").attr("disabled",!1);else if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_ESTIMATEDHOURRESTRICT||resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_MAXLOGHOURRESTRICT||resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_PAYPERIOD||resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_BUDGET)Timetracker.timelogs.timer.resetTimer(),layout.find("#checkInButton").attr("disabled",!1);else if(isSuccess){var timelog=result.resArr;if(timelog=0!==timelog.length?timelog[0]:null){if(Timetracker.timelogs.widgetLoaded&&Calendar.equalsTo(Timetracker.Widgets.Timelogs.currentTimelogDate,Calendar.getCurrentDate())&&Timetracker.Widgets.Timelogs.getTimelogs(""+Timetracker.Widgets.Timelogs.currentTimelogDate),Timetracker.generalSettings.isPushTimerToAttendanceEnabled()&&Attendance.Dashboard){var dashlay=$(Attendance.Dashboard.pageLayout());dashlay.find('[name="ATTENDANCE"] #ZPAtt_Dash_CurrDate')[0]&&Attendance.Dashboard.WeeklyData.getCurWeekData(),dashlay.find("#ZPD_Top_Att_Stat")[0]&&Attendance.Dashboard.CurrStatus.getCurrDayStatus()}if(Timetracker.timelogs.resetTLFetch(!0),Timetracker.UserSpace.Timelogs.isRefreshNeeded=!0,Timetracker.timelogs.calendar.refreshData=!0,Timetracker.timelogs.currentTimerJobData&&result.extraDtls&&result.extraDtls.pausedTimelog){Timetracker.timelogs.timer.hideTimerLoadIcon("timerrunning");var pausedTimelog=result.extraDtls.pausedTimelog;Timetracker.timelogs.timer.resetComponentsOnTimerPause(pausedTimelog,Timetracker.BreakTimelogs.isBreakLog("DATA",pausedTimelog))}if(result.extraDtls&&result.extraDtls.newTimelog&&Timetracker.timelogs.constructSingleTimelog(result.extraDtls.newTimelog),Timetracker.UserSpace.isMySpace()){let timelogDiv=$(Timetracker.UserSpace.Timelogs.constructTimelogRow(timelog));if(timelogDiv.data("tsval",timelog),timelogDiv.find("#timerEditPopup").on("click",function(){Timetracker.timelogs.timer.showTimerEditModal(data)}),layout.find("#myspace_tl_lst").length>0)layout.find("#myspace_tl_lst").prepend(timelogDiv);else{layout.find("#zp_empty_data").remove();let timelogHeader=$('<div id="myspace_tl_hdr" class="zpl_gbox"><span><em><b>'+ZPI18N.getString("zp.timelogs")+'</b></em><em class="zpl_dots sm"></em><em>'+ZPI18N.getString("zp.today")+"</em></span></div>");0===layout.find("#timelog_pagewrap").length&&layout.append($('<div id="timelog_pagewrap"></div>')),layout.find("#timelog_pagewrap").append(timelogHeader);let timelogList=$('<div class="zpl_msplst" id="myspace_tl_lst"></div>');timelogList.append(timelogDiv),layout.find("#timelog_pagewrap").append(timelogList)}Timetracker.timelogs.timer.timerTime(timelog)}else Timetracker.timelogs.constructTimelogRow(timelog);if(Timetracker.currentlyRunningTimer.constructStopPlayInModal(),Timetracker.jobSchedule.hasCustomFields()){var otherDtls={};null!==Timetracker.timelogs.currentTimerJobData&&(otherDtls.runningJobId=Timetracker.timelogs.currentTimerJobData.jobId,Timetracker.jobSchedule.timelogsView.eventHandlingsJobSchDtls("FREEZE_OTHER_JSCH",null,otherDtls))}Timetracker.util.showAlert(2,ZPI18N.getString("zp.timelogentryadded"))}}layout.find(".ERR").remove(),layout.find(".error,.error-clr").removeClass("error error-clr")})},nextStart:function(obj){0!==$(obj).length&&$(obj).attr("onclick","").off("click"),Timetracker.timelogs.isTimerReq=!1,$("body").find("#stop-timer").attr("onclick","").off("click"),Timetracker.util.getTTLocation(Timetracker.timelogs.timer.nextStartCallback,obj)},nextStartCallback:function(obj){var currTimerlogData;if($(obj).attr("isfromhangingtimer")&&$("body").find("#hangingDOM").data()&&(currTimerlogData=$("body").find("#hangingDOM").data().recentlyPausedTimerlogData),!currTimerlogData)if(ZPCal.Calendar.isDashboardCal()||ZPCal.Calendar.isSelfServiceCal()){if("day"===ZPCal.Calendar.CURMODE){var tId=$(obj).attr("timerid");currTimerlogData=ZPCal.Calendar.dayTimeSheetData[tId]}else if("week"===ZPCal.Calendar.CURMODE){tId=$(obj).attr("timerid");currTimerlogData=ZPCal.Calendar.weekTimeSheetData[tId]}else if("month"===ZPCal.Calendar.CURMODE){tId=$(obj).attr("tid");currTimerlogData=Timetracker.timelogs.monthData[tId]}}else if(Timetracker.Page.Timelogs.isCalendarView()){$(".modal-backdrop").remove();tId=$(obj).attr("tid");currTimerlogData=Timetracker.timelogs.monthData[tId]}else-1!==Layout.Page.currentmode.indexOf("home/dashboard")?$(obj).parent().parent().data()&&(currTimerlogData=$(obj).parent().parent().data().data):(Timetracker.UserSpace.isMySpace(),$(obj).parent().parent().parent().data()&&(currTimerlogData=$(obj).parent().parent().parent().data().tsval));if(!currTimerlogData.jobIsActive)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.timeralert1",[Timetracker.util.jobDispName])),Timetracker.timelogs.timer.rebindTimerEvents(obj,!0),!1;if(1===currTimerlogData.jobIsCompleted)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.timeralert2",[Timetracker.util.jobDispName])),Timetracker.timelogs.timer.rebindTimerEvents(obj,!0),!1;if(currTimerlogData.approvalStatus&&-2!==currTimerlogData.approvalStatus)return 1===currTimerlogData.approvalStatus?Timetracker.util.showAlert(1,ZPI18N.getString("zp.timeralert3")):0===currTimerlogData.approvalStatus?Timetracker.util.showAlert(1,ZPI18N.getString("zp.timeralert4")):-1===currTimerlogData.approvalStatus&&Timetracker.util.showAlert(1,ZPI18N.getString("zp.timeralert5")),Timetracker.timelogs.timer.rebindTimerEvents(obj,!0),!1;if(1===currTimerlogData.billingStatus)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.timeralert6")),Timetracker.timelogs.timer.rebindTimerEvents(obj,!0),!1;if(Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.DESC)){var isError=!1;if(currTimerlogData.hasOwnProperty("description"))""===currTimerlogData.description&&(isError=!0);else isError=!0;if(isError)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.entervalforfield",[Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.DESC)])),Timetracker.timelogs.timer.rebindTimerEvents(obj,!0),!1}var isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",currTimerlogData);if(!isBreakLog&&Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.WORKITEM)){isError=!1;if(currTimerlogData.hasOwnProperty("taskName"))""===currTimerlogData.taskName&&(isError=!0);else isError=!0;if(isError)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.entervalforfield",[Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.WORKITEM)])),Timetracker.timelogs.timer.rebindTimerEvents(obj,!0),!1}if(!isBreakLog&&Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.PROJECT)){isError=!1;if(currTimerlogData.hasOwnProperty("projectId")){var projId=currTimerlogData.projectId;null===projId&&void 0===projId||"0"!==projId||(isError=!0)}else isError=!0;if(isError){var projectfieldname=void 0!==Timetracker.projects.formDetails.labelDetails?Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME:ZPI18N.getString("zp.projectname");return Timetracker.util.showAlert(1,ZPI18N.getString("zp.selvalforfield",[projectfieldname])),Timetracker.timelogs.timer.rebindTimerEvents(obj,!0),!1}}if(!isBreakLog&&Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.CLIENT)){isError=!1;if(currTimerlogData.hasOwnProperty("clientId")){var clientId=currTimerlogData.clientId;null===clientId&&void 0===clientId||"0"!==clientId||(isError=!0)}else isError=!0;if(isError){var clientfldname=void 0!==Timetracker.client.formDetails.labelDetails?Timetracker.client.formDetails.labelDetails.CLIENTNAME:ZPI18N.getString("zp.clientname");return Timetracker.util.showAlert(1,ZPI18N.getString("zp.selvalforfield",[clientfldname])),Timetracker.timelogs.timer.rebindTimerEvents(obj,!0),!1}}if(Timetracker.timelogs.currentTimerJobData&&!Timetracker.BreakTimelogs.skipAnotherTimerRunningValidation("DATA",currTimerlogData))Timetracker.util.showAlert(1,ZPI18N.getString("zp.timeralert8")),Timetracker.timelogs.timer.rebindTimerEvents(obj,!0);else{if(Timetracker.timelogs.isTimerReq)return;Timetracker.timelogs.isTimerReq=!0,Timetracker.timelogs.timersheetId=currTimerlogData.timelogId;var params={mode:"nextstart",returnTimelog:!0,requireClientDetails:!0,timesheetId:currTimerlogData.timelogId,conreqcsr:csrfToken};if(0!==Object.keys(Timetracker.location.latLongParam).length){var location_obj=Timetracker.location.latLongParam;location_obj.hasOwnProperty("latitude")&&null!==location_obj.latitude&&!isNaN(Timetracker.location.latLongParam.latitude)&&location_obj.hasOwnProperty("longitude")&&null!==location_obj.longitude&&!isNaN(Timetracker.location.latLongParam.longitude)&&location_obj.hasOwnProperty("accuracy")&&null!==location_obj.accuracy&&!isNaN(Timetracker.location.latLongParam.accuracy)&&(params.longitude=Timetracker.location.latLongParam.longitude,params.latitude=Timetracker.location.latLongParam.latitude,params.accuracy=Timetracker.location.latLongParam.accuracy)}Timetracker.timelogs.timer.sendNextStartRequest(params,obj)}},sendNextStartRequest:function(params,obj){$.post("/timesheet.zp",params,function(result){var rebindTimerEvents=!0;Timetracker.timelogs.isTimerReq=!1;var resCode="",resMsg="",isSuccess=!1;if(null!==result&&!(isSuccess=result.res)&&result.hasOwnProperty("errorCode"))if((resCode=result.errorCode)===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_TIMELOG_ENTRY_OVERLAP)if("1"===Timetracker.generalSettings.getTimelogOverlapType()){Timetracker.timelogs.constructWarnPopupForOverlap(params,Timetracker.timelogs.timer.successcallbackNextstart,{requestSendMethodName:"abc"})}else resMsg=Timetracker.Util.getFailureMessageByCode(resCode,void 0!=result.extraDtls?result.extraDtls:void 0,!0),Timetracker.util.showAlert(1,resMsg);else{let extraDtls=void 0!=result.extraDtls?result.extraDtls:{};extraDtls.msg=result.message,resMsg=Timetracker.Util.getFailureMessageByCode(resCode,extraDtls,!0),Timetracker.util.showAlert(1,resMsg)}if(isSuccess){Timetracker.util.showAlert(2,ZPI18N.getString("zp.timerstarted"));var timerTimelog=result.resArr;if(timerTimelog=0!==timerTimelog.length?timerTimelog[0]:null){if(rebindTimerEvents=!1,Timetracker.timelogs.currentTimerJobData&&result.extraDtls&&result.extraDtls.pausedTimelog){Timetracker.timelogs.timer.hideTimerLoadIcon("timerrunning");var timelog=result.extraDtls.pausedTimelog;Timetracker.timelogs.timer.resetComponentsOnTimerPause(timelog,Timetracker.BreakTimelogs.isBreakLog("DATA",timelog))}if(result.extraDtls&&result.extraDtls.newTimelog&&Timetracker.timelogs.constructSingleTimelog(result.extraDtls.newTimelog),Timetracker.timelogs.timer.timerTime(timerTimelog),Timetracker.timelogs.constructSingleTimelog(timerTimelog),Timetracker.currentlyRunningTimer.constructStopPlayInModal(),Timetracker.jobSchedule.hasCustomFields()&&null!==Timetracker.timelogs.currentTimerJobData){var otherDtls={};otherDtls.runningJobId=Timetracker.timelogs.currentTimerJobData.jobId,Timetracker.jobSchedule.timelogsView.eventHandlingsJobSchDtls("FREEZE_OTHER_JSCH",null,otherDtls)}return void Timetracker.timelogs.resetTLFetch()}}rebindTimerEvents&&Timetracker.timelogs.timer.rebindTimerEvents(obj,!0)})},rebindTimerEvents:function(obj,nextStart){nextStart?(void 0!==obj&&0!==$(obj).length&&$(obj).off("click").on("click",function(e){Timetracker.timelogs.timer.nextStart(this)}),$("body").find("#stop-timer").off("click").on("click",function(){Timetracker.timelogs.timer.nextStart(this)})):(Layout.Page.container.find("#checkInButton").off("click").on("click",function(){Timetracker.timelogs.timer.pauseclock(this)}),void 0!==obj&&0!==$(obj).length&&$(obj).off("click").on("click",function(e){Timetracker.timelogs.timer.pauseclock(this)}),$("body").find("#stop-timer").off("click").on("click",function(e){Timetracker.timelogs.timer.pauseclock(this)}))},resetValuesInTimerBand:function(isBreakLog,skipTimerIconUpdate){var layout=Layout.Page.container;if(isBreakLog)return Timetracker.BreakTimelogs.List.setValuesInBreakButton("RESET"),Layout.Page.container.find("#breakTimer").html("00:00:00"),void(skipTimerIconUpdate||Timetracker.currentlyRunningTimer.appendPausePlayImg());layout.find("#timertask").val("").prop("disabled",!1),layout.find("#timertask").removeClass("is-disabled"),layout.find("#timerDesc").data({timerDesc:""}).removeClass("lv_bgclr5 lv_bgclr2"),layout.find("#timerDescPopup").find("textarea").val("").prop("disabled",!1),layout.find("#timerDescPopup").find("#timerDescInp").removeClass("zpl_DNI"),layout.find("#timerDescPopup").find("#timerDescView").addClass("zpl_DNI"),ZPeopleComponents.isComponent(layout.find("#timertask"))&&(Timetracker.timelogs.workItem.createDropdownForWorkitem({elementId:"timertask"}),TimelyZComp.select.setAttributes(layout.find("#timertask"),{disabled:!1}),Timetracker.jobs.Filters.gettitle("timertask")),TimelyZComp.select.setAttributes(layout.find("#timerclients"),{disabled:!1}),TimelyZComp.select.setAttributes(layout.find("#timerprojects"),{disabled:!1}),TimelyZComp.select.setAttributes(layout.find("#timerjobs"),{disabled:!1}),TimelyZComp.select.setAttributes(layout.find("#timerbill"),{disabled:!1}),Timetracker.timelogs.setValuesInSelectInput("0","timerLogTime","",null,{allowAll:!0,isV5:!0}),0!=layout.find("#timerbill").length&&TimelyZComp.select.setValue(layout.find("#timerbill"),Timetracker.util.defaultbillingType),layout.find("#checkInButton").attr("title",ZPI18N.getString("zp.timerstart")),skipTimerIconUpdate||(layout.find("#watch").html("00:00:00"),layout.find("#checkInButton").removeClass("out"),layout.find("#checkInButton").find("#timerstart").removeClass("zpl_DNI"),layout.find("#checkInButton").find("#timerrunning").addClass("zpl_DNI"),layout.find("#checkInButton").find("#timerloading").addClass("zpl_DNI"),Timetracker.currentlyRunningTimer.appendPausePlayImg())},resetTimer:function(){Timetracker.timelogs.sec=Timetracker.timelogs.min=Timetracker.timelogs.hour=0,Timetracker.timelogs.timersheetId=0,Timetracker.timelogs.timer.resetTimerValues()},resetTimerValues:function(skipTimerIconUpdate){var isBreakLog=Timetracker.BreakTimelogs.isBreakTimerRunning();Timetracker.timelogs.currentTimerJobData=null,Timetracker.currentlyRunningTimer.lastRefreshTime=null,Timetracker.currentlyRunningTimer.lastStartedTime=null,clearInterval(Timetracker.timelogs.starttimer),(Timetracker.Page.isLoggedInUser()||Timetracker.UserSpace.isMySpaceTimelogs())&&Timetracker.timelogs.timer.resetValuesInTimerBand(isBreakLog,skipTimerIconUpdate),skipTimerIconUpdate||Timetracker.currentlyRunningTimer.appendPausePlayImg()},resetComponentsOnTimerPause:function(timelog,isBreakLog){if(Timetracker.timelogs.timer.resetTimerValues(),Timetracker.Page.Timelogs.isCalendarView()&&($(".modal-backdrop").remove(),Timetracker.timelogs.tserecno===erecno&&Timetracker.timelogs.calendar.constructTimelogRowInCalendar(timelog)),ZPCal.Calendar.isDashboardCal()||ZPCal.Calendar.isSelfServiceCal())Layout.Page.container.find("#dashboard_timelog_popover").remove(),"day"===ZPCal.Calendar.CURMODE?Timetracker.timelogs.tserecno===erecno&&ZPCal.Calendar.populatedayCalendar(ZPCal.Calendar.dayCalendarObj):"week"===ZPCal.Calendar.CURMODE?Timetracker.timelogs.tserecno===erecno&&(ZPCal.Calendar.weekCalendarObj=void 0,ZPCal.Calendar.populateWeekCalendar(ZPCal.Calendar.weekCalendarObj)):"month"===ZPCal.Calendar.CURMODE&&($(".modal-backdrop").remove(),Timetracker.timelogs.tserecno===erecno&&Timetracker.timelogs.calendar.constructTimelogRowInCalendar(timelog));else if(Timetracker.Page.Timelogs.isListView()||Timetracker.Page.Timelogs.isSelfServiceListView())Timetracker.timelogs.tserecno===erecno&&Timetracker.timelogs.constructTimelogRow(timelog);else if(Timetracker.UserSpace.isMySpace()&&($(".modal-backdrop").remove(),Timetracker.timelogs.tserecno===erecno))if(Layout.Page.container.find("#timelog-"+timelog.timelogId).length>0)Layout.Page.container.find("#timelog-"+timelog.timelogId).replaceWith(Timetracker.UserSpace.Timelogs.constructTimelogRow(timelog)),Layout.Page.container.find("#timelog-"+timelog.timelogId).data("tsval",timelog).find("#timerEditPopup").on("click",function(){Timetracker.timelogs.timer.showTimerEditModal(timelog)});else{let timelogDiv=$(Timetracker.UserSpace.Timelogs.constructTimelogRow(timelog));timelogDiv.find("#timerEditPopup").on("click",function(){Timetracker.timelogs.timer.showTimerEditModal(data)}),Layout.Page.container.find("#myspace_tl_lst").append(timelogDiv)}if(Timetracker.timelogs.widgetLoaded&&Calendar.equalsTo(Timetracker.Widgets.Timelogs.currentTimelogDate,Calendar.getCurrentDate())){var appendRow=Timetracker.Widgets.Timelogs.constructSingleTimelogRow(timelog),currentTimerLog=$("#dashTimelog"+timelog.timelogId);if(0!==currentTimerLog.length){var oldData=currentTimerLog.data().data;currentTimerLog.html(appendRow),currentTimerLog.data("data",timelog),0!==timelog.hours&&oldData&&void 0!==oldData.hours&&(Timetracker.Widgets.Timelogs.totalLoggedHours=Timetracker.Widgets.Timelogs.totalLoggedHours+timelog.hours-oldData.hours,$("#dashTimelogTotalHours").html(ZPI18N.getString("zp.totalhours")+" <b>"+Calendar.minstohrs(Timetracker.Widgets.Timelogs.totalLoggedHours)+"</b>"))}else Timetracker.Widgets.Timelogs.getTimelogs()}if(Timetracker.generalSettings.isPushTimerToAttendanceEnabled()&&Attendance.Dashboard){var dashlay=$(Attendance.Dashboard.pageLayout());dashlay.find('[name="ATTENDANCE"] #ZPAtt_Dash_CurrDate')[0]&&Attendance.Dashboard.WeeklyData.getCurWeekData(),dashlay.find("#ZPD_Top_Att_Stat")[0]&&Attendance.Dashboard.CurrStatus.getCurrDayStatus()}Layout.Page.container.find("#checkInButton").off("click").on("click",function(){Timetracker.timelogs.timer.pauseclock(this)}),isBreakLog||(Timetracker.timelogs.workItem.destroySelect2ApplyInput({eleId:"timertask",checkCache:!0}),Timetracker.timelogs.registerDescInputDropdown(!0)),Timetracker.currentlyRunningTimer.constructStopPlayInModal(timelog)},timerTime:function(data){if(data.isCurrentlyRunning){var tempObj=data.timearr[Timetracker.timelogs.getLastTimerIndex(data.timearr)];tempObj&&tempObj.isRunning?Timetracker.timelogs.timer.constructTimerTime(data,tempObj):$.each(data.timearr,function(index,subdata){subdata.isRunning&&Timetracker.timelogs.timer.constructTimerTime(data,subdata)})}},constructTimerTime:function(data,tempObj){Timetracker.timelogs.currentTimerJobData=data,Timetracker.timelogs.timersheetId=data.timelogId,Timetracker.timelogs.timeid=tempObj?tempObj.timerId:data.timerId,(Timetracker.Page.isLoggedInUser()||Timetracker.UserSpace.isMySpaceTimelogs())&&Timetracker.timelogs.timer.setValuesInTimerBand(),Timetracker.currentlyRunningTimer.appendPausePlayImg(),Timetracker.currentlyRunningTimer.lastRefreshTime=null,clearInterval(Timetracker.timelogs.starttimer);var diff=(tempObj?tempObj.diff:data.diff)+data.totaltime;Timetracker.currentlyRunningTimer.lastStartedTime=(new Date).getTime()-1e3*diff,Timetracker.timelogs.sec=diff%60;var tempMins=(diff-Timetracker.timelogs.sec)/60;Timetracker.timelogs.min=tempMins%60,Timetracker.timelogs.hour=(tempMins-Timetracker.timelogs.min)/60,Timetracker.timelogs.starttimer=setInterval(Timetracker.timelogs.timer.updateTimer,1e3)},setValuesInTimerBand:function(){var layout=Layout.Page.container;if(Timetracker.Page.Timelogs.isListView()||Timetracker.Page.Timelogs.isSelfServiceListView()||Timetracker.UserSpace.isMySpaceTimelogs()){if(Timetracker.BreakTimelogs.isBreakTimerRunning())return Timetracker.BreakTimelogs.List.setValuesInBreakButton("SET"),void(Layout.Page.container.find("#checkInButton").hasClass("out")&&Timetracker.timelogs.timer.resetValuesInTimerBand(!1));if(Timetracker.timelogs.setValuesInSelectInput(Timetracker.timelogs.currentTimerJobData,"timerLogTime",null,null,{isNewKey:!0,allowAll:!0,isV5:!0}),Timetracker.Util.removeError(layout.find("#timertask")),0!==layout.find("#timertask").length&&ZPeopleComponents.isComponent(layout.find("#timertask"))){var extraJson={};extraJson.jobId=Timetracker.timelogs.currentTimerJobData.jobId,Timetracker.timelogs.workItem.checkIfDropDownNeededForWorkitem(extraJson)?(extraJson.layout=Layout.Page.container.find("#timertask"),extraJson.toAppendOption=Timetracker.timelogs.currentTimerJobData.taskName,Timetracker.timelogs.workItem.createDropdownForWorkitem(extraJson),TimelyZComp.select.setAttributes(layout.find("#timertask"),{disabled:!0}),Timetracker.jobs.Filters.gettitle("timertask")):(Timetracker.timelogs.workItem.destroySelect2ApplyInput({eleId:"timertask"}),layout.find("#timertask").val(ZPeople.decodeTxt(Timetracker.timelogs.currentTimerJobData.taskName)),layout.find("#timertask").prop("disabled",!0),layout.find("#timertask").addClass("is-disabled"))}else layout.find("#timertask").val(ZPeople.decodeTxt(Timetracker.timelogs.currentTimerJobData.taskName)),layout.find("#timertask").prop("disabled",!0),layout.find("#timertask").addClass("is-disabled");if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC)){var descTxt="";Timetracker.timelogs.currentTimerJobData.hasOwnProperty("description")&&null!==Timetracker.timelogs.currentTimerJobData.description&&(descTxt=Timetracker.timelogs.currentTimerJobData.description),Timetracker.timelogs.registerDescViewPopup(descTxt,layout)}layout.find("#timertask").prop("disabled",!0);var billableStatus=void 0!==Timetracker.timelogs.currentTimerJobData.billableStatus?Timetracker.timelogs.currentTimerJobData.billableStatus:Timetracker.timelogs.currentTimerJobData.billingStatus;Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)&&(1===billableStatus||"1"===billableStatus?TimelyZComp.select.setValue(layout.find("#timerbill"),"1"):TimelyZComp.select.setValue(layout.find("#timerbill"),"0")),TimelyZComp.select.setAttributes(layout.find("#timerclients"),{disabled:!0}),TimelyZComp.select.setAttributes(layout.find("#timerprojects"),{disabled:!0}),TimelyZComp.select.setAttributes(layout.find("#timerjobs"),{disabled:!0}),TimelyZComp.select.setAttributes(layout.find("#timerbill"),{disabled:!0}),Timetracker.jobs.Filters.gettitle("timerclients"),Timetracker.jobs.Filters.gettitle("timerprojects"),Timetracker.jobs.Filters.gettitle("timerjobs"),Timetracker.jobs.Filters.gettitle("timerbill"),layout.find("#checkInButton").attr("title",ZPI18N.getString("zp.stoptimer")),layout.find("#checkInButton").find("#timerstart").addClass("zpl_DNI"),layout.find("#checkInButton").find("#timerrunning").removeClass("zpl_DNI"),layout.find("#checkInButton").attr("timesheetId",Timetracker.timelogs.currentTimerJobData.timelogId),layout.find("#checkInButton").attr("jobId",Timetracker.timelogs.currentTimerJobData.jobId),layout.find("#checkInButton").attr("timeId",Timetracker.timelogs.timeid),layout.find("#checkInButton").addClass("out")}},updateTimer:function(){if(Timetracker.currentlyRunningTimer.lastRefreshTime&&(new Date).getTime()-Timetracker.currentlyRunningTimer.lastRefreshTime>18e5)return clearInterval(Timetracker.timelogs.starttimer),Timetracker.timelogs.starttimer=0,Timetracker.currentlyRunningTimer.lastRefreshTime=null,Timetracker.currentlyRunningTimer.lastStartedTime=null,void Timetracker.currentlyRunningTimer.getCurrentTimerDetails();Timetracker.currentlyRunningTimer.lastRefreshTime=(new Date).getTime();var diff=Math.abs(Math.round(((new Date).getTime()-Timetracker.currentlyRunningTimer.lastStartedTime)/1e3));Timetracker.timelogs.sec=diff%60;var tempMins=(diff-Timetracker.timelogs.sec)/60;Timetracker.timelogs.min=tempMins%60,Timetracker.timelogs.hour=(tempMins-Timetracker.timelogs.min)/60,Timetracker.timelogs.sec<10&&(Timetracker.timelogs.sec="0"+Timetracker.timelogs.sec),Timetracker.timelogs.min<10&&String(Timetracker.timelogs.min).length<2&&(Timetracker.timelogs.min="0"+Timetracker.timelogs.min),Timetracker.timelogs.hour<10&&String(Timetracker.timelogs.hour).length<2&&(Timetracker.timelogs.hour="0"+Timetracker.timelogs.hour),Timetracker.timelogs.currentTimerJobData&&(Timetracker.BreakTimelogs.isBreakTimerRunning()?Layout.Page.container.find("#breakTimer").html(Timetracker.timelogs.hour+":"+Timetracker.timelogs.min+":"+Timetracker.timelogs.sec):Layout.Page.container.find("#watch").html(Timetracker.timelogs.hour+":"+Timetracker.timelogs.min+":"+Timetracker.timelogs.sec)),Layout.Page.container.find("#watch_time,#dashboard_timer,#dashboard_week_day_timer").html(Timetracker.timelogs.hour+":"+Timetracker.timelogs.min+":"+Timetracker.timelogs.sec),Timetracker.timelogs.currentTimerJobData&&Timetracker.currentlyRunningTimer.placeHTimer(),$("body").find("#timer-val").html(Timetracker.timelogs.hour+":"+Timetracker.timelogs.min+":"+Timetracker.timelogs.sec),$("body").find("#in-modal-timer").html(Timetracker.timelogs.hour+":"+Timetracker.timelogs.min+":"+Timetracker.timelogs.sec),Timetracker.Page.Timelogs.isCalendarView()?0!==Layout.Page.container.find(".ZPcalvw-morepopup-cnt").find("span[inchrsid="+Timetracker.timelogs.currentTimerJobData.timelogId+"]").length?(Layout.Page.container.find(".ZPcalvw-morepopup-cnt").find("span[inchrsid="+Timetracker.timelogs.currentTimerJobData.timelogId+"]").html(Timetracker.timelogs.hour+":"+Timetracker.timelogs.min+":"+Timetracker.timelogs.sec),0!==Layout.Page.container.find("span[class='ZPTimerLog'][ inchrsid="+Timetracker.timelogs.currentTimerJobData.timelogId+"]").length&&Layout.Page.container.find("span[class='ZPTimerLog'][ inchrsid="+Timetracker.timelogs.currentTimerJobData.timelogId+"]").html(Timetracker.timelogs.hour+":"+Timetracker.timelogs.min+":"+Timetracker.timelogs.sec)):Layout.Page.container.find("span[inchrsid="+Timetracker.timelogs.currentTimerJobData.timelogId+"]").html(Timetracker.timelogs.hour+":"+Timetracker.timelogs.min+":"+Timetracker.timelogs.sec):(ZPCal.Calendar.isDashboardCal()||ZPCal.Calendar.isSelfServiceCal())&&"month"===ZPCal.Calendar.CURMODE&&(0!==Layout.Page.container.find(".ZPcalvw-morepopup-cnt").find("span[inchrsid="+Timetracker.timelogs.currentTimerJobData.timelogId+"]").length?(Layout.Page.container.find(".ZPcalvw-morepopup-cnt").find("span[inchrsid="+Timetracker.timelogs.currentTimerJobData.timelogId+"]").html(Timetracker.timelogs.hour+":"+Timetracker.timelogs.min+":"+Timetracker.timelogs.sec),0!==Layout.Page.container.find("span[class='ZPTimerLog'][ inchrsid="+Timetracker.timelogs.currentTimerJobData.timelogId+"]").length&&Layout.Page.container.find("span[class='ZPTimerLog'][ inchrsid="+Timetracker.timelogs.currentTimerJobData.timelogId+"]").html(Timetracker.timelogs.hour+":"+Timetracker.timelogs.min+":"+Timetracker.timelogs.sec)):Layout.Page.container.find("span[inchrsid="+Timetracker.timelogs.currentTimerJobData.timelogId+"]").html(Timetracker.timelogs.hour+":"+Timetracker.timelogs.min+":"+Timetracker.timelogs.sec))},updateTimertimeData:function(data,toChange,isFromDel){for(var total_time=0,diff_time=0,skipTotal=!1,fromTime=0,toTime=0,result={},timerarr=data.timearr,i=0;i<timerarr.length;i++){var currFromTime=timerarr[i].fromTime,currToTime=timerarr[i].toTime;skipTotal=!1;var old_diff_time=currFromTime&&currToTime?currFromTime>currToTime?currToTime+86400-currFromTime:currToTime-currFromTime:0;if(timerarr[i].timerId===toChange.timerId)if(isFromDel)timerarr.splice(i,1),i--,skipTotal=!0,diff_time=old_diff_time;else{currToTime!==toChange.toTime&&(timerarr[i].toTime=currToTime=toChange.toTime),currFromTime!==toChange.fromTime&&(timerarr[i].fromTime=currFromTime=toChange.fromTime);var new_diff_time=currFromTime>currToTime?currToTime+86400-currFromTime:currToTime-currFromTime;diff_time=new_diff_time-old_diff_time,old_diff_time=new_diff_time}skipTotal||(total_time+=old_diff_time),currFromTime&&currToTime&&-1!==i&&(fromTime=currFromTime,toTime=currToTime)}return data.timearr=timerarr,data.totaltime=total_time,data.hours=Math.floor(total_time/60),data.fromTime=Math.ceil(fromTime/60),data.toTime=Math.ceil(toTime/60),result.tsval=data,result.total_time=total_time,result.diff_time=Math.floor(diff_time/60),result},constructTimertimeRefresh:function(data,newdata,isFromDel){var wrkdate=Calendar.parseDate(data.workDate,uidateFormat),day=wrkdate.getDate(),month=wrkdate.getMonth(),year=wrkdate.getFullYear(),tothrsid="tot_"+months[month]+"_"+day+"_"+year,usubHours=Layout.Page.container.find("#not_submitted_hours").data("usubHours"),subHours=Layout.Page.container.find("#submitted_hours").data("subHours"),updatedData=Timetracker.timelogs.timer.updateTimertimeData(data,newdata,isFromDel),timelogDiv=Layout.Page.container.find("#tablecheck"+data.timelogId);Timetracker.UserSpace.isMySpaceTimelogs()&&(timelogDiv=Layout.Page.container.find("#timelog-"+data.timelogId)),timelogDiv.data("tsval",data),timelogDiv.find("#timerEditPopup").html(Calendar.minstohrs(Math.ceil(updatedData.total_time/60)-1));updatedData.total_time;var diff_time,tot_hrs=Layout.Page.container.find("#"+tothrsid).data("totalhrs");if(diff_time=updatedData.diff_time,isFromDel){if(tot_hrs-=diff_time,data.hasOwnProperty("approvalId")&&void 0!==data.approvalId?subHours-=diff_time:usubHours-=diff_time,0===updatedData.tsval.timearr.length){var txt=$("<span>"+Calendar.minstohrs(Math.ceil(updatedData.total_time/60)-1)+"</span>");timelogDiv.find("#timerEditPopup").parent().css("cursor","text"),timelogDiv.find("#timerEditPopup").replaceWith(txt)}}else tot_hrs+=diff_time,data.hasOwnProperty("approvalId")&&void 0!==data.approvalId?subHours+=diff_time:usubHours+=diff_time;Layout.Page.container.find("#"+tothrsid).html(Calendar.minstohrs(tot_hrs)).data("totalhrs",tot_hrs),Timetracker.timelogs.setTotalLogHours(subHours,usubHours,!1)},sendTimerRequests:function(extraDetails){var reqParams=extraDetails.params;reqParams.skipOverlapValidation=!0,reqParams.isFromWarnPopup=!0;var addtnlParams=extraDetails.additionalParams;reqParams.data=addtnlParams.data,Timetracker.timelogs.timer.senEditTimerIntervalRequest(reqParams)},senEditTimerIntervalRequest:function(timerMandDtls,data,obj){var newtotime=timerMandDtls.toTime,newfromtime=timerMandDtls.fromTime,timeId=timerMandDtls.timerId,islasttimeset=timerMandDtls.islasttimeset,params={mode:"edittimedata",userErecNo:Timetracker.timelogs.tserecno,toTime:newtotime,fromTime:newfromtime,timerId:timeId,conreqcsr:csrfToken,islasttimeset:islasttimeset};if(timerMandDtls.hasOwnProperty("isFromWarnPopup")?params.timesheetId=timerMandDtls.timesheetId:params.timesheetId=data.timelogId,timerMandDtls.hasOwnProperty("skipOverlapValidation")&&(params.skipOverlapValidation=timerMandDtls.skipOverlapValidation),0!==Object.keys(Timetracker.location.latLongParam).length){var location_obj=Timetracker.location.latLongParam;location_obj.hasOwnProperty("latitude")&&null!==location_obj.latitude&&location_obj.hasOwnProperty("longitude")&&null!==location_obj.longitude&&location_obj.hasOwnProperty("accuracy")&&null!==location_obj.accuracy&&(params.longitude=Timetracker.location.latLongParam.longitude,params.latitude=Timetracker.location.latLongParam.latitude,params.accuracy=Timetracker.location.latLongParam.accuracy)}$.post("/timesheet.zp",params,function(resultData){var resCode="",resMsg="",isSuccess=!1;if($(obj).off("click").on("click",function(){Timetracker.timelogs.timer.saveEditTimer(obj,timeId,islasttimeset)}),null!==resultData&&!(isSuccess=resultData.res)&&resultData.hasOwnProperty("errorCode"))if(resCode=resultData.errorCode,resultData.hasOwnProperty("extraDtls"))if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_TIMELOG_ENTRY_OVERLAP)if("1"===Timetracker.generalSettings.getTimelogOverlapType()){var additionalParams={data:data};Timetracker.timelogs.constructWarnPopupForOverlap(params,Timetracker.timelogs.timer.sendTimerRequests,additionalParams)}else resMsg=Timetracker.Util.getFailureMessageByCode(resCode,resultData.extraDtls,!0),Timetracker.util.showAlert(1,resMsg);else resMsg=Timetracker.Util.getFailureMessageByCode(resCode,resultData.extraDtls,!0),Timetracker.util.showAlert(1,resMsg);else{if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.TIMER_EDIT_DEL_BILLED_APP||resCode===Timetracker.constants.ERROR_CODES.TIMELOG.TIMER_EDIT_DEL_PERM){resMsg=Timetracker.Util.getFailureMessageByCode(resCode,{text:"edit"},!0)}else resMsg=resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_MAXLOGHOURRESTRICT?resultData.message:Timetracker.Util.getFailureMessageByCode(resCode,null,!0);Timetracker.util.showAlert(1,resMsg)}if(isSuccess)if(Timetracker.util.showAlert(2,ZPI18N.getString("zp.timeedited")),Timetracker.timelogs.timer.hideTimerEditModal(),Timetracker.timelogs.resetTLFetch(!0),Timetracker.Validations.isTrue(resultData,"refresh"))if(Timetracker.UserSpace.isMySpaceTimelogs()||"ts_homeuser"==Timetracker.Page.getPageMode()){let params={erecno:"ts_homeuser"==Timetracker.Page.getPageMode()?Timetracker.Team.getSelectedUser():erecno};Timetracker.UserSpace.Timelogs.isRefreshNeeded=!0,Timetracker.UserSpace.Timelogs.init(Layout.Page.container,params)}else Timetracker.timelogs.getTimelogsListView(!0,null,!1,!0);else timerMandDtls.hasOwnProperty("isFromWarnPopup")&&(data=timerMandDtls.data),Timetracker.timelogs.timer.constructTimertimeRefresh(data,params,!1)})},successcallbackTimeradd:function(extraDetails){var reqParams=extraDetails.params;reqParams.skipOverlapValidation=!0,reqParams.isFromWarnPopup=!0,Timetracker.timelogs.timer.sendTimeraddRequest(reqParams)},successcallbackNextstart:function(extraDetails){var reqParams=extraDetails.params;reqParams.skipOverlapValidation=!0,reqParams.isFromWarnPopup=!0,Timetracker.timelogs.timer.sendNextStartRequest(reqParams)},hideEditTimer:function(timerId){var popupModal=Layout.Page.container.find("#timereditpopupmodal");popupModal.find("#timerEditRow_"+timerId).addClass("zpl_DNI"),popupModal.find("#timerViewRow_"+timerId).removeClass("zpl_DNI")},saveEditTimerCallback:function(obj,timerId,isLastTimeset){var popupModal=Layout.Page.container.find("#timereditpopupmodal"),fromTimerDiv=popupModal.find("#timerEditFromTime_"+timerId),toTimerDiv=popupModal.find("#timerEditToTime_"+timerId);Timetracker.Util.removeError(fromTimerDiv),Timetracker.Util.removeError(toTimerDiv);var isShiftEnabled=Timetracker.isTTSthiftEnabled();let fTime=isShiftEnabled?TimelyZComp.datetimefield.getDateObj(fromTimerDiv):TimelyZComp.timeField.getValue(fromTimerDiv),tTime=isShiftEnabled?TimelyZComp.datetimefield.getDateObj(toTimerDiv):TimelyZComp.timeField.getValue(toTimerDiv);var isEdited=!1,data=popupModal.data().tsval,isValidFromTime=fTime&&""!=fTime,isValidToTime=tTime&&""!=tTime;if(!isValidFromTime||!isValidToTime)return isValidFromTime||Timetracker.Util.addError(fromTimerDiv),isValidToTime||Timetracker.Util.addError(toTimerDiv),$(obj).off("click").on("click",function(){Timetracker.timelogs.timer.saveEditTimer(obj,timerId,isLastTimeset)}),!1;var fromTime=0,toTime=0,tempTo=0;if(isShiftEnabled){var logDate=Calendar.parseDate(data.workDate,uidateFormat);fromTime=logDate.getDiff(fTime,Timetracker.constants.MINUTES),tempTo=toTime=logDate.getDiff(tTime,Timetracker.constants.MINUTES);var isError=!1;if(isNaN(fromTime)||isNaN(toTime)){isError=!0;var msg=ZPI18N.getString("zp.entervalidinput")}else if(fromTime>toTime){isError=!0;msg=ZPI18N.getString("zp.fromtimegreater")}else if(toTime-fromTime>Timetracker.constants.PER_DAY_MIN){isError=!0;msg=ZPI18N.getString("zp.timeexceeded24")}if(isError)return Timetracker.Util.addError(fromTimerDiv),Timetracker.Util.addError(toTimerDiv),Timetracker.util.showAlert(1,msg),$(obj).off("click").on("click",function(){Timetracker.timelogs.timer.saveEditTimer(obj,timerId,isLastTimeset)}),!1}else tempTo=(fromTime=Timetracker.util.getTotalTimeForHours(fTime.split(":")))>(toTime=Timetracker.util.getTotalTimeForHours(tTime.split(":")))?toTime-Timetracker.constants.PER_DAY_SEC:toTime;var oldFromSec=Number(fromTimerDiv.attr("valInSec")),oldToSec=Number(toTimerDiv.attr("valInSec"));if(Math.floor(oldFromSec/60)!=fromTime||Math.floor(oldToSec/60)!=toTime){oldToSec=oldFromSec>oldToSec?oldToSec+Timetracker.constants.PER_DAY_SEC:oldToSec;var prevInterval=Math.floor((oldToSec-oldFromSec)/60);if(data.hours-prevInterval+(tempTo-fromTime)>Timetracker.constants.PER_DAY_MIN)return Timetracker.Util.addError(fromTimerDiv),Timetracker.Util.addError(toTimerDiv),Timetracker.util.showAlert(1,ZPI18N.getString("zp.tt.timelogsettings.restricttimelogsto24hours")),$(obj).off("click").on("click",function(){Timetracker.timelogs.timer.saveEditTimer(obj,timerId,isLastTimeset)}),!1;var newFromSec=60*fromTime+oldFromSec%60,newToSec=60*toTime+oldToSec%60;if(oldFromSec!=newFromSec||oldToSec!=newToSec){isEdited=!0;var timerMandDtls={};timerMandDtls.toTime=newToSec,timerMandDtls.fromTime=newFromSec,timerMandDtls.timerId=timerId,timerMandDtls.islasttimeset=isLastTimeset,Timetracker.timelogs.timer.senEditTimerIntervalRequest(timerMandDtls,data,obj)}}isEdited||(Timetracker.timelogs.timer.hideTimerEditModal(),Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade")))},saveEditTimer:function(obj,timerId,total,isLastTimeset){$(obj).off("click"),Timetracker.util.getTTLocation(Timetracker.timelogs.timer.saveEditTimerCallback,obj,timerId,total,isLastTimeset)},deleteTimerCallback:function(timerId){var popupModal=Layout.Page.container.find("#timereditpopupmodal"),timerData=popupModal.data().tsval;if(Timetracker.timelogs.timer.isTimerEditable(timerData)){var isLastTimeset=1==timerData.timearr.length?1:0,params={mode:"deletetimedata",timerId:timerId,islasttimeset:isLastTimeset,conreqcsr:csrfToken,timesheetId:timerData.timelogId,userErecNo:Timetracker.timelogs.tserecno};$.post("/timesheet.zp",params,function(response){var resCode=Timetracker.constants.ERROR_CODES.GENERAL_ERROR,resMsg="",isSuccess=!1;if(null!==response)if(!(isSuccess=response.res)&&response.hasOwnProperty("errorCode")){if(resCode=response.errorCode,response.hasOwnProperty("extraDtls"))resMsg=Timetracker.Util.getFailureMessageByCode(resCode,response.extraDtls,!0);else if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.TIMER_EDIT_DEL_BILLED_APP||resCode===Timetracker.constants.ERROR_CODES.TIMELOG.TIMER_EDIT_DEL_PERM){resMsg=Timetracker.Util.getFailureMessageByCode(resCode,{text:"delete"},!0)}else resMsg=Timetracker.Util.getFailureMessageByCode(resCode,null,!0);Timetracker.util.showAlert(1,resMsg)}else isSuccess&&response.resArr;isSuccess&&(popupModal.find("#timerViewRow_"+timerId).remove(),popupModal.find("#timerEditRow_"+timerId).remove(),Timetracker.util.showAlert(2,ZPI18N.getString("zp.timerdeleted")),Timetracker.timelogs.timer.hideTimerEditModal(),Timetracker.Validations.isTrue(response,"refresh")?Timetracker.timelogs.getTimelogsListView(!0,null,!1,!0):Timetracker.timelogs.timer.constructTimertimeRefresh(timerData,params,!0))})}},deleteTimer:function(timerId){var extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[ZPI18N.getString("zp.stimer")]),body:ZPI18N.getString("zp.timerdeleteinfo"),btnVal:ZPI18N.getString("zp.confirm")};Timetracker.Util.confirmpopUp(timerId,Timetracker.timelogs.timer.deleteTimerCallback,timerId,0,extraDtls)},editTimer:function(timerId,timersheetId,isAmPm){var popupModal=Layout.Page.container.find("#timereditpopupmodal"),timerData=popupModal.data().tsval;if(Timetracker.timelogs.timer.isTimerEditable(timerData)){var fromTime=popupModal.find("#timerEditFromTime_"+timerId),toTime=popupModal.find("#timerEditToTime_"+timerId);if(Timetracker.Util.removeError(fromTime),Timetracker.Util.removeError(toTime),Timetracker.isTTSthiftEnabled()){var logDate=Calendar.parseDate(timerData.workDate,uidateFormat),fromTimeVal=Timetracker.util.getShiftDatebyTime(fromTime.attr("valInSec"),logDate),toTimeVal=Timetracker.util.getShiftDatebyTime(toTime.attr("valInSec"),logDate);if(!ZPeopleComponents.isComponent(fromTime)||!ZPeopleComponents.isComponent(toTime)){var pickerOptions={},tlDate=new Date(logDate);tlDate.setDate(tlDate.getDate()-1),pickerOptions.minDate=Calendar.formatDate(tlDate).toString(),tlDate.setDate(tlDate.getDate()+2),pickerOptions.maxDate=Calendar.formatDate(tlDate).toString();var attr={pickerOptions:pickerOptions};TimelyZComp.datetimefield.intialize(fromTime,attr),TimelyZComp.datetimefield.intialize(toTime,attr)}TimelyZComp.datetimefield.setValue(fromTime,fromTimeVal),TimelyZComp.datetimefield.setValue(toTime,toTimeVal)}else{fromTimeVal=fromTime.val(),toTimeVal=toTime.val();if(!ZPeopleComponents.isComponent(fromTime)||!ZPeopleComponents.isComponent(toTime)){var opt={clearButton:"none",change:function(event,data){event.target.val(data.value)},className:"w150"};opt.format=timeFormat.replace("a","tt"),TimelyZComp.timeField.intialize(fromTime,opt),TimelyZComp.timeField.intialize(toTime,opt)}TimelyZComp.timeField.setValue(fromTime,fromTimeVal),TimelyZComp.timeField.setValue(toTime,toTimeVal)}popupModal.find("#timerViewRow_"+timerId).addClass("zpl_DNI"),popupModal.find("#timerEditRow_"+timerId).removeClass("zpl_DNI")}},isTimerEditable:function(timerData){if(Timetracker.Validations.isDefiniteValue(timerData)){if(void 0!==timerData.approvalStatus){if(1===timerData.approvalStatus)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.timerlogalert1")),!1;if(0===timerData.approvalStatus)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.timerlogalert2")),!1;if(-1===timerData.approvalStatus)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.timerlogalert3")),!1}return 1!==timerData.billingStatus||(Timetracker.util.showAlert(1,ZPI18N.getString("zp.timerlogalert4")),!1)}return!1},hideTimerEditModal:function(){ModuleComp.Modal.hide("timereditpopupmodal")},showTimerEditModal:function(data){var modal=Timetracker.timelogs.timer.timerModalConstruction();if(modal.data("tsval",data),void 0==data.dateString){let workDate=Calendar.parseDate(data.workDate,uidateFormat),day=workDate.getDate(),month=workDate.getMonth(),year=workDate.getFullYear(),monthName=months[month];data.dateString=monthName+" "+day+", "+year}modal.find("#modalDate").text(data.dateString),modal.find("#totHrsFooter").html(Calendar.minstohrs(data.hours)+" "+ZPI18N.getString("zp.hrs")),Timetracker.location.dblatlonvalue=data.timearr;var tBody=$('<tbody id="timereditbody"></tbody>');$.each(data.timearr,function(index,timerData){var fromTimeTxt="-",toTimeTxt="-",timerId=timerData.timerId,totalHrs=0,tr=$('<tr id ="timerViewRow_'+timerId+'"></tr>');if(timerData.fromTime&&(fromTimeTxt=Timetracker.util.getShiftDatebyTimeStr(timerData.fromTime,data.workDate)),timerData.toTime&&(toTimeTxt=Timetracker.util.getShiftDatebyTimeStr(timerData.toTime,data.workDate),timerData.fromTime)){var totalHrsInSec=timerData.fromTime>timerData.toTime?timerData.toTime+86399-timerData.fromTime:timerData.toTime-timerData.fromTime;totalHrs=Math.round(totalHrsInSec/60)}var isLastTimeset=!1;Timetracker.timelogs.getLastTimerIndex(data.timearr)===index&&(isLastTimeset=!0);var div=$('<div class="d-flexclm8"></div>');if(div.append('<span id="timerFromTime_'+timerId+'" class="grn w100">'+fromTimeTxt+"</span>"),timerData.hasOwnProperty("latitude")&&timerData.hasOwnProperty("longitude"))div.append('<em class="zpl_f12"><i class="PI_location"></i><span id="latLon_'+timerId+'"></span></em><a class="zpl_f12 zpl_popovr-js w60" onclick="Timetracker.location.openMap('+timerData.latitude+", "+timerData.longitude+');">'+ZPI18N.getString("zp.viewmap")+"</a>");else if(timerData.hasOwnProperty("mod_ip")||timerData.hasOwnProperty("add_ip")||timerData.hasOwnProperty("geoLocation")){intostartchecks=!0;var address="-";if(timerData.hasOwnProperty("geoLocation_in")&&null!==timerData.geoLocation_in&&"-"!==timerData.geoLocation_in)address=data.geoLocation;else{var strip=0;"undefined"!==(strip=timerData.hasOwnProperty("mod_ip")?String(timerData.mod_ip):String(timerData.add_ip))&&(address=Timetracker.location.getCityName(strip))}div.append('<em class="zpl_f12"><i class="PI_location"></i><span  id="geoIn_'+timerId+'">'+address+"</span></em>")}if(tr.append($("<td/>").append(div)),(div=$('<div class="d-flexclm8"></div>')).append('<span id="timerToTime_'+timerId+'" class="grn w100">'+toTimeTxt+"</span>"),timerData.hasOwnProperty("latitude_end")&&timerData.hasOwnProperty("longitude_end"))div.append('<em class="zpl_f12"><i class="PI_location"></i><span id="latLonEnd_'+timerId+'"></span></em><a class="zpl_f12 zpl_popovr-js" onclick="Timetracker.location.openMap('+timerData.latitude_end+", "+timerData.longitude_end+');">'+ZPI18N.getString("zp.viewmap")+"</a>");else if(timerData.hasOwnProperty("mod_ip")||timerData.hasOwnProperty("add_ip")||timerData.hasOwnProperty("geoLocation_end")){intostartchecks=!0;address="-";if(timerData.hasOwnProperty("geoLocation_end")&&null!==timerData.geoLocation_end&&"-"!==timerData.geoLocation_end)address=data.geoLocation_end;else{strip=0;"undefined"!==(strip=timerData.hasOwnProperty("mod_ip")?String(timerData.mod_ip):String(timerData.add_ip))&&(address=Timetracker.location.getCityName(strip))}div.append('<em class="zpl_f12"><i class="PI_location"></i><span id="geoOut_'+timerId+'">'+address+"</span></em>")}tr.append($("<td/>").append(div)),tr.append($("<td> <span>"+Calendar.minstohrs(totalHrs)+'</span></td><td width="100px"><div class="zpl_hvr" name="delete"><i class="PI_edt" title="'+ZPI18N.getString("zp.edit")+'" onclick="Timetracker.timelogs.timer.editTimer(\''+timerId+"','"+data.timelogId+'\', \'false\');"></i><i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'" onclick="Timetracker.timelogs.timer.deleteTimer(\''+timerId+"');\"></i></div></td>")),tBody.append(tr),tBody.append('<tr id ="timerEditRow_'+timerId+'" class="zpl_DNI"><td><input id ="timerEditFromTime_'+timerId+'" type="text" class="ztextbox" value="'+fromTimeTxt+'" valInSec="'+timerData.fromTime+'"></td><td><input id ="timerEditToTime_'+timerId+'" type="text" class="ztextbox" value="'+toTimeTxt+'" valInSec="'+timerData.toTime+'"></td><td></td><td><div class="zpl_hvr zpl_hvrsw"><i id="savetimer_'+timerId+'" class="PI_tick grn" title="'+ZPI18N.getString("zp.save")+'"></i><i class="PI_cls red" title="'+ZPI18N.getString("zp.cancel")+'" onclick="Timetracker.timelogs.timer.hideEditTimer(\''+timerId+"');\"></i></div></td></tr>"),tBody.find("#savetimer_"+timerId).off("click").on("click",function(){Timetracker.timelogs.timer.saveEditTimer(this,timerId,isLastTimeset)})}),modal.find("#timereditbody").replaceWith(tBody),Timetracker.location.sendRequestLatLon(),ModuleComp.Modal.show(modal)},timerModalConstruction:function(){var modal=Layout.Page.container.find("#timereditpopupmodal");if(0===modal.length){var header='<div><h4 id="modalDate"></h4></div> <span class="zpl_mhderrgt a-itm-cntr"></span><a class="_cls PI_cls" title="'+ZPI18N.getString("zp.close")+'"></a></div>',body='<div class="zpl_tblres"><table class="zpl_tbl"> <thead> <tr> <th width="400px">'+ZPI18N.getString("zp.starttime")+'</th><th width="400px">'+ZPI18N.getString("zp.endtime")+'</th><th colspan="2">'+ZPI18N.getString("zp.totalhours")+'</th></tr></thead><tbody id ="timereditbody" ></tbody></table></div>',footer='<div class="zpl_mfoter"> <div class="zpl_tblpagination" style="position: inherit;"><div class="zpl_lftpgn"><div class="zpl_viewdays"><div class="zpl_dytyp grnbdr1"><span>'+ZPI18N.getString("zp.totalhours")+'</span><b id="totHrsFooter" class="grn"></b></div></div></div><div class="zpl_rhtpgn"></div></div></div>';modal=ModuleComp.Modal.get({id:"timereditpopupmodal",type:1,headerHtml:header,body:body,footer:footer,backdrop:!0,closeOnSubmit:!1,modalClass:"zpl_mdl zpl_mmd",deleteOnHide:!1,closeonEsc:!0})}return modal}},Timetracker.currentlyRunningTimer={removeHangingTimerVal:!1,lastRefreshTime:null,lastStartedTime:null,getCurrentTimerDetails:function(){Timetracker.util.setUserErecno(),ZPeople.Request.send("/timesheet.zp",{mode:"getCurrentlyRunningTimer",getProjectAndClient:!0},function(response){response&&!response.hasOwnProperty("tabHidden")&&(Timetracker.Page.Timelogs.isListView()||Timetracker.UserSpace.isMySpace()?Layout.PageUtil.loadFiles(["timely.1.min.js"],function(){Timetracker.timelogs.timer.constructTimerTime(response)}):Timetracker.timelogs.timer.constructTimerTime(response))})},placeHTimer:function(){Timetracker.timelogs.currentTimerJobData&&(0!==$("body").find("#hangingDOM").length||Timetracker.currentlyRunningTimer.removeHangingTimerVal||(Timetracker.currentlyRunningTimer.appendHangingTimer(),Timetracker.currentlyRunningTimer.refreshTimerValues()),$("body").find("#hangingDOM").data("timerData",Timetracker.timelogs.currentTimerJobData))},resetHangingTimer:function(){Timetracker.currentlyRunningTimer.appendPausePlayImg(),$("body").find("#timer-rem").css("display","none")},calculateDiffVal:function(){var curTimer={};if(Timetracker.timelogs.currentTimerJobData){var curJobData=Timetracker.timelogs.currentTimerJobData;return curTimer.timelogId=curJobData.timelogId,curTimer.totaltime=curJobData.totaltime,curJobData.hasOwnProperty("timearr")?$.each(curJobData.timearr,function(index,subdata){if(subdata.isRunning)return curTimer.timerId=subdata.timerId,curTimer.diff=subdata.diff,void(curTimer.toTime=null)}):(curTimer.diff=curJobData.diff,curTimer.timerId=curJobData.timerId,curJobData.hasOwnProperty("toTime")&&(curTimer.toTime=curJobData.toTime)),curTimer}return curTimer=$("body").find("#hangingDOM").data("timerData")},refreshTimerValues:function(){var timerData;if(0===Timetracker.timelogs.starttimer){if(Timetracker.timelogs.currentTimerJobData){var diff=(timerData=Timetracker.timelogs.currentTimerJobData.hasOwnProperty("timearr")?Timetracker.currentlyRunningTimer.calculateDiffVal():Timetracker.timelogs.currentTimerJobData).diff+timerData.totaltime;Timetracker.timelogs.sec=diff%60;var tempMins=(diff-Timetracker.timelogs.sec)/60;Timetracker.timelogs.min=tempMins%60,Timetracker.timelogs.hour=(tempMins-Timetracker.timelogs.min)/60,Timetracker.timelogs.starttimer=setInterval(Timetracker.timelogs.timer.updateTimer,1e3)}}else $("body").find("#timer-val").html(Timetracker.timelogs.hour+":"+Timetracker.timelogs.min+":"+Timetracker.timelogs.sec),$("body").find("#in-modal-timer").html(Timetracker.timelogs.hour+":"+Timetracker.timelogs.min+":"+Timetracker.timelogs.sec)},constructHangingTimerModal:function(){if(0===$("body").find("#timerCurModal").length){var modalTxt="";modalTxt+='<div id="timerCurModal" style="display: none;" class="zpl_popovr">',modalTxt+='<div class="zpsys_notification">',modalTxt+='<div class="zpsys_ndt">',modalTxt+='<div id="time_div" class="zpsys_nic w150">',modalTxt+='<span id="in-modal-img"></span>',modalTxt+='<span id="in-modal-timer"></span>',modalTxt+="</div>",modalTxt+='<p id="jobName"></p>',modalTxt+="</div>",modalTxt+='<div class="zpsys_btn">',modalTxt+='<a id="stop-timer" class="red" isfromhangingtimer="true">'+ZPI18N.getString("zp.stop")+"</a>",modalTxt+='<a id="tlViewList" class="blu">'+ZPI18N.getString("zp.view")+"</a>",modalTxt+="</div>",modalTxt+="</div>",modalTxt+="</div>",modalTxt+="</div>",$("body").append(modalTxt),ZPeopleComponents.popover($("body").find("#timerCurModal"),{displayType:"callout",closeOnBodyClick:!0,position:"left-top",forElement:$("body").find("#timer-show")}),$("body").find("#timerCurModal").on("zpopoverclose",function(){$("body").find("#timer-rem").css("display","none")})}ZPeopleComponents.popover($("body").find("#timerCurModal")).open()},closeHangingTimerModal:function(){$("body").find(".modal-backdrop").remove(),ZPeopleComponents.popover($("body").find("#timerCurModal")).close(),$("body").find("#timer-rem").css("display","none")},removeTimerDom:function(){if(0!==$("body").find("#hangingDOM").length){let ele=$("body").find("#timerCurModal");0!==ele.length&&ZPeopleComponents.isComponent(ele)&&ZPeopleComponents.popover(ele).close(),$("body").find("#hangingDOM").remove()}},constructStopPlayInModal:function(recentlyPausedTimerlogData){var today=Calendar.getCurrentDay().day,stDom=$("body").find("#stop-timer"),curTimer=Timetracker.currentlyRunningTimer.calculateDiffVal(),workDate=null;curTimer&&curTimer.hasOwnProperty("workDate")&&(workDate=Calendar.parseDate(curTimer.workDate,uidateFormat));var nextStartTimerHide=!1;if(Timetracker.timelogs.currentTimerJobData||!workDate||Calendar.equalsTo(today,workDate)||(nextStartTimerHide=!0),nextStartTimerHide)stDom.text(""),stDom.attr("onclick",""),$("body").find("#timerCurModal").modal("hide"),$("body").find("#hangingDOM").remove();else if(!Timetracker.timelogs.currentTimerJobData&&null!==workDate&&Calendar.equalsTo(today,workDate)){if(stDom.text(ZPI18N.getString("zp.hangingtimerresume")).removeClass("red").addClass("grn"),recentlyPausedTimerlogData){var hangingTimerObj=$("body").find("#hangingDOM");if(0!==hangingTimerObj.length&&hangingTimerObj.data("recentlyPausedTimerlogData",recentlyPausedTimerlogData),recentlyPausedTimerlogData.totaltime){Timetracker.timelogs.sec=recentlyPausedTimerlogData.totaltime%60;var tempMins=(recentlyPausedTimerlogData.totaltime-Timetracker.timelogs.sec)/60;Timetracker.timelogs.min=tempMins%60,Timetracker.timelogs.hour=(tempMins-Timetracker.timelogs.min)/60,hangingTimerObj.find("#timer-val").html(Timetracker.DateTime.convertTo2digit(Timetracker.timelogs.hour)+":"+Timetracker.DateTime.convertTo2digit(Timetracker.timelogs.min)+":"+Timetracker.DateTime.convertTo2digit(Timetracker.timelogs.sec)),0!==(hangingTimerObj=$("body").find("#in-modal-timer")).length&&hangingTimerObj.html(Timetracker.DateTime.convertTo2digit(Timetracker.timelogs.hour)+":"+Timetracker.DateTime.convertTo2digit(Timetracker.timelogs.min)+":"+Timetracker.DateTime.convertTo2digit(Timetracker.timelogs.sec))}}stDom.attr("onclick","").off("click").on("click",function(){Timetracker.timelogs.timer.nextStart(this)})}else stDom.text(ZPI18N.getString("zp.stop")).removeClass("grn").addClass("red"),Timetracker.timelogs.currentTimerJobData&&stDom.attr("onclick","").off("click").on("click",function(){Timetracker.timelogs.timer.pauseclock(this)})},appendPausePlayImg:function(){var imgTxt=Timetracker.currentlyRunningTimer.timerImg();$("body").find("#in-modal-img").html(imgTxt),$("body").find("#timer-img").html(imgTxt)},setHangingTimerModalValues:function(){var curTimer=Timetracker.timelogs.currentTimerJobData;curTimer||(curTimer=$("body").find("#hangingDOM").data("recentlyPausedTimerlogData")),Timetracker.currentlyRunningTimer.constructStopPlayInModal(),Timetracker.currentlyRunningTimer.appendPausePlayImg();var modalDom=$("body").find("#timerCurModal");modalDom.find("#tlViewList").removeClass("disabled"),modalDom.find("#jobName").text(ZPeople.decodeTxt(curTimer.jobName)),modalDom.find("#jobName").attr("title",ZPeople.decodeTxt(curTimer.jobName)),modalDom.find("#workDate").html(curTimer.workDate),Timetracker.timelogs.currentTimerJobData?modalDom.find("#in-modal-timer").html(Timetracker.timelogs.hour+":"+Timetracker.timelogs.min+":"+Timetracker.timelogs.sec):modalDom.find("#in-modal-timer").html($("body").find("#timer-val").text()),modalDom.find("#tlViewList").off("click").on("click",function(){Timetracker.currentlyRunningTimer.closeHangingTimerModal(),Timetracker.Page.isMyDataView()&&Timetracker.Page.Timelogs.isListView()&&Timetracker.timelogs.showListView();var isRefreshView=Timetracker.timelogs.tserecno!==erecno;!isRefreshView&&ZPeople.isMyspace()&&(isRefreshView=!Timetracker.UserSpace.isMySpaceTimelogs()),isRefreshView||!Timetracker.Page.Timelogs.isListView()&&!Timetracker.Page.Timelogs.isCalendarView()?isRefreshView=!0:(Timetracker.Page.Timelogs.isListView()&&(isRefreshView=0==Layout.Page.container.find("#tablecheck"+curTimer.timelogId).length),Timetracker.Page.Timelogs.isCalendarView()&&(isRefreshView=0==Layout.Page.container.find("#timelogs_calendar_view").find('[jobrowid="'+curTimer.timelogId+'"]').length)),isRefreshView&&(Timetracker.timelogs.tserecno!==erecno&&(Timetracker.util.setUserErecno(erecno),Timetracker.timelogs.istimelogsdatafetched=!1,Timetracker.timelogs.istimelogscaldatafetched=!1,Timetracker.reports.jobReport.isjobreportdatafetched=!1,Timetracker.reports.timeLogReport.istimelogreportdatafetched=!1),Timetracker.timelogs.resetTLFetch(),Timetracker.timelogs.skipResetOfTempDate=!1,Timetracker.Page.Timelogs.isMyDataListView()?Timetracker.timelogs.initTimelogs():Timetracker.Page.Timelogs.isMyDataCalendarView()?(ZPCommonUtil.DateNavigator.setPeriod(Timetracker.Page.getPageMode()+"_cal",ZPCommonUtil.DateNavigator.TYPE.MONTHLY,ZPCommonUtil.DateNavigator.TENSE.CURRENT),Timetracker.timelogs.calendar.populateTimesheet()):ZPeople.isMyspace()?window.location.href="#home/myspace/overview-timelogs":window.location.href="#timetracker/mydata/timelogs-mode:list")})},showHangingTimerModal:function(obj){Timetracker.currentlyRunningTimer.constructHangingTimerModal(),Timetracker.currentlyRunningTimer.setHangingTimerModalValues(),$("body").find("#timer-rem").css("display","inline")},timerImg:function(){return Timetracker.timelogs.currentTimerJobData?'<img id="stopimg" src="'+ZPeople.getResourceURL(newUIImageUrl+"timelog2.gif")+'" class="tympass MR2" title="'+ZPI18N.getString("zp.stoptimer")+'"/>':'<img id="playimg" src="'+ZPeople.getResourceURL(newUIImageUrl+"play.png")+'" class="tympass MR2" title="'+ZPI18N.getString("zp.resumetimer")+'">'},hangingTimer:function(){return'<li id="hangingDOM"><div class="zpl_glbetlog zpl_popovr-js" id="timer-show" onclick="Timetracker.currentlyRunningTimer.showHangingTimerModal(this);"><i id="timer-img"><img src="'+ZPeople.getResourceURL(newUIImageUrl+"timelog2.gif")+'" title="'+ZPI18N.getString("zp.stoptimer")+'" onclick="Timetracker.currentlyRunningTimer.showHangingTimerModal(this);"></i><b class="zpl_glbetimer" id="timer-val">00:00:00</b></div></li>'},removeHangingTimer:function(obj){ZPeopleComponents.popover($("body").find("#timerCurModal")).close(),$("body").find("#hangingDOM").remove(),Timetracker.currentlyRunningTimer.removeHangingTimerVal=!0,Timetracker.currentlyRunningTimer.placeHTimer()},appendHangingTimer:function(){var hTxt=Timetracker.currentlyRunningTimer.hangingTimer();$("body").find("#rgtnav").find("div:last-child").find("ul").prepend(hTxt),0===$("body").find("#timerCurModal").length&&$("body").find("#timer-remove").css("style","none")}},Timetracker.timelogs.calendar={init:function(){Timetracker.initSetup(),Timetracker.setWorkitemCache(),Timetracker.timelogs.calendar.getCalendarPage()},getCalendarPage:function(){var layout=Timetracker.Util.getLayout();0==layout.find("#timelogs_calendar_view").length?(Timetracker.timelogs.istimelogscaldatafetched=!1,Timetracker.timelogs.calendar.initHtml()):(layout.find("#timelogs_calendar_view").removeClass("zpl_DNI"),layout.find("#timelogs_list_view").addClass("zpl_DNI")),Timetracker.timelogs.calendar.initTimesheetCalendar()},clickHandler:function(event){var ele=event.target,ref=$(ele).attr("ref");void 0!=ref&&("applyFilter"==ref?Timetracker.Page.Timelogs.isCalendarView()?(Timetracker.timelogs.calendar.populateTimesheet(Timetracker.timelogs.calObj,!0),Timetracker.timelogs.refreshData=!0):(Timetracker.timelogs.applyFilter(),Timetracker.timelogs.calendar.refreshData=!0):"resetFilter"==ref?Timetracker.timelogs.resetFilter():"toggleFilter"==ref&&Timetracker.timelogs.constructFilter())},removeTopFilter:function(event,clearAll){if(clearAll)Timetracker.timelogs.resetFilter();else{var ele=event.target,entity=$(ele).closest("li").attr("filterno");filterDiv=settingsPage.container.find("#filterDiv"),"billableStatus"==entity?TimelyZComp.select.setValue(filterDiv.find('[compname="billableStatus"]'),-1):"approvalStatus"==entity?TimelyZComp.select.setValue(filterDiv.find('[compname="approvalStatus"]'),0):TimelyZComp.tokenField.removeAllTokens(filterDiv.find('[compname="'+entity+'"]'))}Timetracker.timelogs.calendar.populateTimesheet(Timetracker.timelogs.calObj,!0),Timetracker.timelogs.refreshData=!0},initHtml:function(){var pageMode=Timetracker.Page.getPageMode(),prefix="md_";"ts_teamuser"===pageMode?prefix="td_":"ts_operuser"===pageMode&&(prefix="od_");var html='<div id="timelogs_calendar_view">'+('<div class="zpl_btnmnu" ><div class="zpl_lft"></div><div class="zpl_cntrdv"><div class="zpl_inav"><i class="PI_alft" title="'+ZPI18N.getString("zp.previous")+'" id="cl_goToPreviousBtn"></i><i class="PI_monthly" id="tl_datePicker"></i><i class="PI_argt" title="'+ZPI18N.getString("zp.next")+'" id="cl_goToNextBtn"></i></div><b id="cl_dateNavigatorText"></b></div><div class="zpl_rgt"><div class="grpbtn"><i class="PI_listview" onclick="Timetracker.timelogs.switchView(true)" title="'+ZPI18N.getString("zp.listview")+'"></i><i class="PI_monthly zpl_act" onclick="Timetracker.timelogs.switchView(false)" title="'+ZPI18N.getString("zp.calendarview")+'"></i></div><i id="'+prefix+'filter_icon" class="zpl_ibg PI_fltr" title="'+ZPI18N.getString("zp.filter")+'" ref="toggleFilter" onclick="Timetracker.timelogs.constructFilter()"></i></div></div>'+TimetrackerOperations.Filters.filterHeaderHtml)+'<div class="zpl_rgtcnt" id="timelogBody"><div id="caldiv" class="zpl_calndrvw"></div>'+('<div class="zpl_tblpagination" id="timelog_footer"><div class="zpl_rhtpgn"><div class="zpl_viewdays"><div class="zpl_dytyp blubdr zpl_cpd"><span class="blu"><b id="total_hours">00:00 Hrs</b></span><span>'+ZPI18N.getString("zp.total")+'</span></div><div class="zpl_dytyp grnbdr1 zpl_cpd"><span class="grn"><b id="submitted_hours">00:00 Hrs</b></span><span>'+ZPI18N.getString("zp.submitted")+'</span></div><div class="zpl_dytyp nosubmt zpl_cp" onclick="Timetracker.timelogs.getCreateTimesheetList();"><span class="ylw"><b id="not_submitted_hours">00:00 Hrs</b></span><span>'+ZPI18N.getString("zp.notsubmitted")+'</span><a><i class="PI_argt ylw"></i></a></div></div></div></div>')+"</div></div>",layout=Timetracker.Util.getLayout();layout.find("#timelogs_list_view").addClass("zpl_DNI"),layout.append(html),layout.off("click"),layout.addClass("zpl_ttlstvw");var dateNavigationDtls={};dateNavigationDtls.mode=Timetracker.Page.getPageMode()+"_cal",dateNavigationDtls.containerId=layout.attr("id"),dateNavigationDtls.previousBtnId="cl_goToPreviousBtn",dateNavigationDtls.nextBtnId="cl_goToNextBtn",dateNavigationDtls.displayAreaId="cl_dateNavigatorText",dateNavigationDtls.displayDateAsText=!0,dateNavigationDtls.unbindEventOnClick=!0,dateNavigationDtls.navigationCallback=Timetracker.timelogs.calendar.getPrevNxtCalCallback,ZPCommonUtil.DateNavigator.init(dateNavigationDtls),ZPCommonUtil.DateNavigator.setPeriod(dateNavigationDtls.mode,ZPCommonUtil.DateNavigator.TYPE.MONTHLY,ZPCommonUtil.DateNavigator.TENSE.CURRENT),layout.find("#timelogs_calendar_view").find("#tl_datePicker").attr("mode",Timetracker.Page.getPageMode()+"_cal");var callback=Timetracker.timelogs.timelogDateNavCallBack;layout.find("#timelogs_calendar_view").find("#tl_datePicker").off().on("click",function(event){Calendar.setUpCalendar(event,this,2,void 0,callback)}),$(layout).on("click",function(event){0===$(event.target).parents(".ZPcalvw-morepopup").length&&$(".ZPcalvw-morepopup").addClass("zpl_DNI")})},getPrevNxtCalCallback:function(isNext){isNext?NewCalendar.nextMonth(Timetracker.timelogs.calObj):NewCalendar.previousMonth(Timetracker.timelogs.calObj)},initTimesheetCalendar:function(obj){Timetracker.initSetup(),Timetracker.timelogs.istimelogscaldatafetched?Timetracker.timelogs.calendar.refreshData&&Timetracker.timelogs.calendar.populateTimesheet(Timetracker.timelogs.calObj,!0):Timetracker.timelogs.calendar.populateTimesheet()},getParamsToFetchTimelogs:function(userErecNo){let layout=Timetracker.Util.getLayout(),params={mode:"getMonthTimesheet",userErecNo:userErecNo,year:Timetracker.timelogs.calObj.curYear,month:Timetracker.timelogs.calObj.curMonth,isFromNewUI:!0,clientId:"0",projectId:"0",jobId:"0",typeMode:"-1",approvalStatus:"0",conreqcsr:csrfToken};return 0!=layout.find("#filterDiv").length&&TimetrackerOperations.Filters.getFilterValues(params),null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients&&(params.isClientDetailsNeeded=!0),Timetracker.timelogs.isClientFieldAllowed()||delete params.clientId,params},populateTimesheet:function(calObj,isSearch){if(TimetrackerOperations.Filters.isFilterOpen()&&TimetrackerOperations.Filters.toggleFilter(),void 0===calObj){(calObj=new NewCalendar.calObj).curYear=(new Date).getFullYear(),calObj.curMonth=(new Date).getMonth(),calObj.calcontId="monthcalendardiv",calObj.outerdivId="timelogs_calendar_view",calObj.daysObj={empty:"zpcalempty",weekend:"zpcalweek",day:"zpcaldays",today:"zpcaltoday",leave:"zpcalholi"},calObj.divid="caldiv",calObj.callback=Timetracker.timelogs.calendar.populateTimesheet,calObj.mode="timesheet",calObj.tdonclick=null,calObj.totaldata=!0,calObj.prearrow="IC-ar-lft",calObj.nextarrow="IC-ar-rgt",Timetracker.timelogs.calObj=calObj,NewCalendar.initCalendar(calObj),Layout.Page.container.find("#timelogs_calendar_view").find("#caldiv").find(".ZPcalvw-thtd").addClass("ZPcalmbt")}else{var User_Name;User_Name=ZPCal.Calendar.isDashboardCal()?erecno:-1!==Layout.Page.hash.indexOf("selfservice")?SelfService.getUserId():null===Timetracker.timelogs.tserecno?erecno:Timetracker.timelogs.tserecno;var layout=Layout.Page.container.find("#timelogs_calendar_view");Timetracker.util.setUserErecno(User_Name),Timetracker.setWorkitemCache();var params=Timetracker.timelogs.calendar.getParamsToFetchTimelogs(User_Name);TimetrackerOperations.Filters.setFilterHeader(Timetracker.timelogs.calendar.removeTopFilter,void 0,layout),$.post("/timesheet.zp",params,function(resultData){Timetracker.timelogs.istimelogscaldatafetched=!0,Timetracker.timelogs.calendar.refreshData=!1,1==isSearch&&NewCalendar.clearOldvalues(calObj,3,!0);var resData=new Array,extraArguments={subHrs:0,usubHrs:0};Timetracker.timelogs.monthData={};var hasError=!1;if(0!=resultData.length){var result=resultData[0];if(void 0!==result&&result.hasOwnProperty("res")&&result.res==Timetracker.constants.RESPONSE_CODES.FAILURE&&(hasError=!0),hasError){var resObj=resultData[0].hasOwnProperty("resObj")?resultData[0].resObj:null;null!=resObj&&resObj.hasOwnProperty("errorCode")&&Timetracker.Util.displayFailureMessage(Timetracker.Util.getFailureMessageByCode(resObj.errorCode,null,!1))}$.each(resultData[0],function(index,data){if(0!=Object.keys(data).length){var rData=Timetracker.timelogs.calendar.populateTimesheetData(data,index,calObj,extraArguments,void 0,!0);resData.push(rData)}})}Timetracker.timelogs.setTotalLogHours(extraArguments.subHrs,extraArguments.usubHrs,!0),NewCalendar.populateData(calObj,resData),layout.find("#caldiv").find(".ZPcalvw-thtd").addClass("ZPcalmbt"),ZPCommonUtil.DateNavigator.bindEvent(Timetracker.Page.getPageMode()+"_cal")})}},populateTimesheetData:function(data,index,calObj,extraArguments,recLimit,canShowLeave){var rData={};rData.date=parseInt(index),rData.type=data.type;var today=Calendar.getCurrentDay().day;calObj.totaldata&&(rData.objval=data.objval),void 0===recLimit&&(recLimit=ZPCal.Calendar.isDashboardCal()||ZPCal.Calendar.isSelfServiceCal()?1:2),void 0!==extraArguments&&data.subhrs&&(extraArguments.subHrs+=data.subhrs),void 0!==extraArguments&&data.usubhrs&&(extraArguments.usubHrs+=data.usubhrs);var divele=document.createDocumentFragment();if(data.jobobj){var moreNumber=data.jobobj.length-recLimit,moreElement=$('<div class="ZPcalvw-morebox zpl_DNI"> <a class="ZPcalvw-morebtn" id="tl_morebtn"><span jobcnt='+moreNumber+">"+moreNumber+"</span> "+ZPI18N.getString("zp.smore")+"</a> </div>"),timelogDiv=$('<div id="timelog_div"></div>'),morePopUpContent=$('<div class="ZPcalvw-morepopup zpl_DNI"><div class="ZPcalvw-morepopup-hd"><span></span><a class="ZPcalvw-morepopup-close"><i class="IC-cls-1px"></i></a> </div><div class="ZPcalvw-morepopup-cnt"></div></div>');$.each(data.jobobj,function(rowindex,timelogData){Calendar.parseDate(timelogData.workDate,uidateFormat);if(0!=Object.keys(timelogData).length){if(rowindex<recLimit){var timelogRow=Timetracker.timelogs.calendar.getTimelogRowHtmlForCalendar(timelogData,Calendar.minstohrs(timelogData.hours),!1,today,rowindex);timelogDiv.append(timelogRow);var timelogRowInMoreContent=Timetracker.timelogs.calendar.getTimelogRowHtmlForCalendar(timelogData,Calendar.minstohrs(timelogData.hours),!0,today,rowindex);morePopUpContent.find(".ZPcalvw-morepopup-cnt").append(timelogRowInMoreContent)}else{(timelogRowInMoreContent=Timetracker.timelogs.calendar.getTimelogRowHtmlForCalendar(timelogData,Calendar.minstohrs(timelogData.hours),!0,today,rowindex)).data("elemData",timelogData),morePopUpContent.find(".ZPcalvw-morepopup-cnt").append(timelogRowInMoreContent)}moreElement.find("#tl_morebtn").data("date",timelogData.workDate)}}),moreElement.append(morePopUpContent),timelogDiv.find(".ZPcalvw-month-wksheet").find(".ZPcalvwbox-head").on("click",function(ev){ev.stopPropagation();var x=$(this).offset().left,y=$(this).offset().top,elemData=$(this).parent().parent().data("elemData");Timetracker.timelogs.calendar.showViewPopup(elemData,x,y)}),$(moreElement).find("#tl_morebtn").on("click",function(e){e.stopPropagation(),$(".ZPcalvw-morepopup").addClass("zpl_DNI");var morepop=$(this).siblings(".ZPcalvw-morepopup"),dateObj=Calendar.parseDate($(this).data("date"),uidateFormat);$(".ZPcalvw-morepopup").find(".ZPcalvw-morepopup-hd").find("span").html(ZPDateTime.days[dateObj.getDay()]+"<strong>"+dateObj.getDate()+"</strong>"),morepop.removeClass("zpl_DNI");var top,scrollTop=Layout.Page.container.find(".ZPcalvw-box").scrollTop(),wintop=Layout.Page.container.find("#moncal_body").offset().top+scrollTop,poptop=morepop.offset().top+scrollTop,popHei=morepop.height(),winHei=Layout.Page.container.find("#moncal_body").height(),calObj=new NewCalendar.calObj;$("#"+calObj.outerdivId).hasClass("ZPcalmbt")&&(wintop-=60),top=poptop+popHei>wintop+winHei?parseInt("-"+(popHei+70)):35,left=parseInt("-192");var winleft=Layout.Page.container.find("#moncal_body").offset().left,popwidth=morepop.width(),popleft=morepop.offset().left;winleft>popleft&&(left=popleft+popwidth),morepop.css({top:top+"px",left:left+"px"}),wintop+winHei<(poptop=morepop.offset().top+scrollTop)+popHei&&(top=parseInt("-"+(popHei+70))),(popleft=morepop.offset().left)<winleft&&(left+=popwidth),morepop.css({top:top+"px",left:left+"px"}),morepop.removeClass("zpl_DNI")}),$(moreElement).find(".ZPcalvw-morepopup-close").on("click",function(){$(".ZPcalvw-morepopup").addClass("zpl_DNI")}),$(moreElement).find(".ZPcalvw-month-wksheet").find(".ZPcalvwbox-head").on("click",function(ev){ev.stopPropagation();var x=$(this).offset().left,y=$(this).offset().top,elemData=$(this).parent().parent().data("elemData");$(".ZPcalvw-morepopup").addClass("zpl_DNI"),Timetracker.timelogs.calendar.showViewPopup(elemData,x,y)}),$(".ZPcalvw-morepopup").addClass("zpl_DNI"),$(timelogDiv[0]).append(moreElement),moreNumber>0&&moreElement.removeClass("zpl_DNI")}if(void 0!==timelogDiv&&void 0!=timelogDiv[0]){var newtxt=timelogDiv[0];divele.appendChild(newtxt)}if(canShowLeave&&data.leave){let leaveHtmlElements=$(Timetracker.timelogs.calendar.constructLeaveHtmlForCalview(data.leave));$.each(leaveHtmlElements,function(index,leavehtml){divele.appendChild(leavehtml)})}return rData.txt=divele,rData},constructLeaveHtmlForCalview:function(leaveData){let leaveHtml="";if(leaveData&&(leaveData.isHoliday&&(leaveHtml="<div class='zpl_shftdts zpl_holiBgbdr' title='"+leaveData.holidayName+"' ><span>"+leaveData.holidayName+"</span></div>"),""===leaveHtml&&(leaveData.isHalfHoliday||leaveData.leaves&&0!==leaveData.leaves.length)&&(leaveData.isHalfHoliday&&(leaveHtml="<div class='zpl_shftdts zpl_holibrdrd"+(2===leaveData.holidaySession?" zpl_halfsec":" zpl_halffst")+"' title='"+leaveData.holidayName+"'><span>"+leaveData.holidayName+"</span></div>"),leaveData.leaves&&0!==leaveData.leaves.length))){let leaveCount,leaveSession;$.each(leaveData.leaves,function(index,data){leaveCount=data.leaveCount,leaveSession=data.leaveSession,leaveCount>0&&(leaveHtml+="<div class='zpl_shftdts",.5===leaveCount?leaveHtml+=" lv_bgbdrs"+data.leavetypeColor+(2===leaveSession?" zpl_halfsec":" zpl_halffst"):.25===leaveCount?(leaveHtml+=" lv_bgbdrs"+data.leavetypeColor,1===leaveSession?leaveHtml+=" zpl_qrtrfst":2===leaveSession?leaveHtml+=" zpl_qrtrsec":3===leaveSession?leaveHtml+=" zpl_qrtrthrd":4===leaveSession&&(leaveHtml+=" zpl_qrtrfour")):leaveHtml+=" lv_bgbdr"+data.leavetypeColor,leaveHtml+="' title='"+data.leavetypeName+"'><span>"+data.leavetypeName+"</span></div>")})}return leaveHtml},getTimelogRowHtmlForCalendar:function(timelogData,hours,isInMorePopUp,today,rowIndex){var isCurrentlyRunning=timelogData.isCurrentlyRunning&&(Timetracker.timelogs.tserecno!==erecno||!Timetracker.timelogs.currentTimerJobData||Timetracker.timelogs.currentTimerJobData&&timelogData.timelogId===Timetracker.timelogs.currentTimerJobData.timelogId),colorClass="LC"+(void 0!==timelogData.jobColor?timelogData.jobColor:"1"),inchrsid=2==timelogData.type||"2"===timelogData.type||isInMorePopUp?'inchrsid="'+timelogData.timelogId+'"':"";today=today||Calendar.getCurrentDay().day;var workDate=timelogData.workDate instanceof Date?timelogData.workDate:Calendar.parseDate(timelogData.workDate,uidateFormat),timelogRowHtml="";if(2!==timelogData.type&&"2"!==timelogData.type||!isCurrentlyRunning&&!Calendar.equalsTo(today,workDate))timelogRowHtml+='<div class="ZPcalvw-box-label ZPcalvw-month-wksheet"><div jobrowid="'+timelogData.timelogId+'" class="ZPcalvw-box-label-txt '+colorClass+'"> <span class="ZPcalvwbox-head CP" title="'+(timelogData.taskName?timelogData.taskName:ZPI18N.getString("zp.nodescprovided",[Timetracker.util.getWorkItemDispName(!1,!0)]))+'">'+timelogData.jobName+"</span><span "+inchrsid+'><div  id="hrsOfTL" >'+hours+"</div></span></div></div>";else{var timerText=Timetracker.timelogs.calendar.appendTimerText(timelogData,today,workDate);timelogRowHtml+='<div class="ZPcalvw-box-label ZPcalvw-month-wksheet"><div jobrowid="'+timelogData.timelogId+'" class="ZPcalvw-box-label-txt ZPcalvw-tmron '+colorClass+" "+(isInMorePopUp?"ZPcalvw-tmron":"")+'"> <span class="ZPcalvwbox-head CP" title="'+(timelogData.taskName?timelogData.taskName:ZPI18N.getString("zp.nodescprovided",[Timetracker.util.getWorkItemDispName(!1,!0)]))+'">'+timelogData.jobName+'</span><span class="ZPTimerLog"'+inchrsid+">"+hours+'</span><span class="ZPcaltimer CP">'+timerText+"</span></div></div>"}var timelogRowElement=$(timelogRowHtml);if(1===timelogData.type||"1"===timelogData.type){var dataPlacement="top";isInMorePopUp&&void 0!==rowIndex&&0===rowIndex&&(dataPlacement="bottom"),timelogRowElement.find("#hrsOfTL").attr("data-placement",dataPlacement),timelogRowElement.find("#hrsOfTL").attr("data-toggle","tooltip");var ttl=Timetracker.util.getShiftDatebyTimeStr(timelogData.fromTime,timelogData.workDate,Timetracker.constants.MINUTES)+" - "+Timetracker.util.getShiftDatebyTimeStr(timelogData.toTime,timelogData.workDate,Timetracker.constants.MINUTES);timelogRowElement.find("#hrsOfTL").attr("title",ttl)}return timelogRowElement.data("elemData",timelogData),timelogRowElement},appendTimerText:function(innerdata,today,workDate){var innertxt="",isTimerflag=!1;if(innerdata.isCurrentlyRunning&&(Timetracker.timelogs.tserecno!==erecno||!Timetracker.timelogs.currentTimerJobData||Timetracker.timelogs.currentTimerJobData&&innerdata.timelogId===Timetracker.timelogs.currentTimerJobData.timelogId)){var tempObj=innerdata.timearr[Timetracker.timelogs.getLastTimerIndex(innerdata.timearr)];if(void 0!==tempObj&&tempObj.isRunning)isTimerflag=!0;else for(var arrObj in innerdata.timearr)if(innerdata.timearr[arrObj].isRunning){isTimerflag=!0;break}}return isTimerflag?Timetracker.timelogs.tserecno===erecno?(Timetracker.timelogs.currentTimerJobData||Timetracker.timelogs.timer.timerTime(innerdata),innertxt='<img id="watchstatus'+innerdata.timelogId+'" src="'+ZPeople.getResourceURL(newUIImageUrl+"timelog2.gif")+'" title="'+ZPI18N.getString("zp.stoptimer")+'" onclick="Timetracker.timelogs.timer.pauseclock(this);">'):innertxt='<img src="'+ZPeople.getResourceURL(newUIImageUrl+"timelog2.gif")+'" onclick="Timetracker.util.showAlert(1,\''+ZPI18N.getString("zp.timeralert7")+"');\">":!isTimerflag&&Calendar.equalsTo(today,workDate)&&(Timetracker.timelogs.tserecno===erecno?(Timetracker.timelogs.monthData[innerdata.timelogId]=innerdata,innertxt='<i class="PI_fil_play grn" tid="'+innerdata.timelogId+'" id="watchstatus'+innerdata.timelogId+'" title="'+ZPI18N.getString("zp.resumetimer")+'" onclick="Timetracker.timelogs.timer.nextStart(this);"></i>'):innertxt='<i class="PI_fil_play grn" onclick="Timetracker.util.showAlert(1,\''+ZPI18N.getString("zp.timeralert7")+"');\"></i>"),innertxt},addTimelog:function(year,month,caldate){var popupModal=Timetracker.timelogs.calendar.constructAddEditPopupHtml(!0,!1),selectedDate=new Date(year,month,caldate);popupModal.find("#cal_log_date").html(caldate+" "+days[selectedDate.getDay()]),Timetracker.clients.getClients("caltimelogClient",null,null,!1,Timetracker.timelogs.tserecno,Timetracker.constants.TTCustomAdmin.EntryView,{isV5:!0}),Timetracker.projects.Filters.createProjectSelect(!0,Timetracker.timelogs.tserecno,null,"calendarLogTime",null,null,null,Timetracker.constants.TTCustomAdmin.EntryView);var clientSel=popupModal.find("#caltimelogClient"),projSel=popupModal.find("#projectid"),jobSel=popupModal.find("#jobid");if(clientSel.off("zselectchange").on("zselectchange",function(event,data){data.fromUI&&Timetracker.projects.Filters.createProjectSelect(!0,Timetracker.timelogs.tserecno,data.selectedValue,"calendarLogTime",null,"0",null,Timetracker.constants.TTCustomAdmin.EntryView)}),projSel.off("zselectchange").on("zselectchange",function(event,data){if(data.fromUI){var cltid=null;0!=clientSel.length&&(cltid=TimetrackerOperations.Filters.getSelectFilterValues(clientSel)),Timetracker.jobs.Filters.createJobSelect(Timetracker.timelogs.tserecno,"0","calendarLogTime",data.selectedValue,cltid,Timetracker.constants.TTCustomAdmin.EntryView)}}),jobSel.off("zselectchange").on("zselectchange",function(event,data){data.fromUI&&Timetracker.timelogs.jobChange("calendarLogTime",void 0)}),Timetracker.timelogs.workItem.checkIfDropDownNeededForWorkitem()){var extraJson={elementId:"cal_log_workitemid"};extraJson.layout=popupModal.find("#cal_log_workitemid"),Timetracker.timelogs.workItem.createDropdownForWorkitem(extraJson)}if(popupModal.find("#timelog_start_end_time").addClass("zpl_DNI"),popupModal.find("#timelog_hours_time").addClass("zpl_DNI"),popupModal.find("input[name='timelogTime'][id='timelog_hrs']").length?(popupModal.find("input[name='timelogTime'][id='timelog_hrs']").prop("checked",!0),popupModal.find("#timelog_hours_time").removeClass("zpl_DNI")):popupModal.find("input[name='timelogTime'][id='timelog_start_end']").length?(popupModal.find("input[name='timelogTime'][id='timelog_start_end']").prop("checked",!0),popupModal.find("#timelog_start_end_time").removeClass("zpl_DNI")):popupModal.find("input[name='timelogTime'][id='timelog_start_timer']").length&&popupModal.find("input[name='timelogTime'][id='timelog_start_timer']").prop("checked",!0),Timetracker.isTTSthiftEnabled()){var pickerOptions={},shitDt=new Date(selectedDate);shitDt.setDate(shitDt.getDate()-1),pickerOptions.minDate=Calendar.formatDate(shitDt).toString(),shitDt.setDate(shitDt.getDate()+2),pickerOptions.maxDate=Calendar.formatDate(shitDt).toString();var attr={pickerOptions:pickerOptions,value:selectedDate};TimelyZComp.datetimefield.intialize(popupModal.find("#timelog_fromtime"),attr,!0),TimelyZComp.datetimefield.intialize(popupModal.find("#timelog_totime"),attr,!0)}else{var options={clearButton:"none",format:timeFormat.replace("a","tt"),minuteStep:1,className:"w150"};options.value=Timetracker.DateTime.getUserTimeZoneCurrDateTime(),TimelyZComp.timeField.intialize(popupModal.find("#timelog_fromtime"),options),TimelyZComp.timeField.intialize(popupModal.find("#timelog_totime"),options)}TimelyZComp.select.intialize(popupModal.find("#cal_log_billableStatus"),{dropdownList:{appendTo:popupModal,moveOnScroll:!0}}),popupModal.find("#submitLogtime").removeClass("disabled").attr("onclick","").off("click").on("click",function(){popupModal.find("#submitLogtime").addClass("disabled"),Timetracker.timelogs.calendar.submitTimelog(year,month,caldate)}),Timetracker.timelogs.calendar.showHideAddUpdatePopup(!0,popupModal)},constructAddEditPopupHtml:function(addValue,editvalue,othrDtls){var isBreakLog=editvalue&&Timetracker.BreakTimelogs.isBreakLog("DATA",othrDtls);Timetracker.util.defaultbillingType=Timetracker.generalSettings.getDefaultBillableStatus(Timetracker.timelogs.tserecno);var header='<span class="d-flexC"><h4 id="titleid">'+ZPI18N.getString("zp.logtime")+'</h4><span class="zpl_dots"></span><em id="cal_log_date"></em></span><a class="_cls PI_cls" title="'+ZPI18N.getString("zp.close")+'"></a>',body='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><table class="zpl_itbl zpl_nocrsor zpl_ttllblfxd"><tbody>';if(!isBreakLog&&Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.CLIENT)&&(body+="<tr><td><label"+(Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.CLIENT)?' class="zpl_mtry"':"")+">"+Timetracker.clients.formDetails.labelDetails.CLIENTNAME+'</label></td><td><div><input class="w400" id="caltimelogClient"  name="Client"></div></td></tr>'),!isBreakLog&&Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.PROJECT)&&(body+="<tr><td><label"+(Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.PROJECT)?' class="zpl_mtry"':"")+">"+Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME+'</label></td><td><div><input class="w400" id="projectid"  name="Project" clientid="caltimelogClient" jobid="jobid"></div></td></tr>'),body+='<tr><td><label class="zpl_mtry">'+(isBreakLog?ZPI18N.getString("zp.break"):Timetracker.jobs.formDetails.labelDetails.JOBNAME)+'</label></td><td><div><input class="w400" id="jobid"  name="JobId" clientid="caltimelogClient" projectid="projectid"></div></td></tr>',isBreakLog&&Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)&&(body+='<tr><td><label class="zpl_mtry">'+ZPI18N.getString("zp.type")+'</label></td><td><div><span class="w400" id="brkTypevalCal"></span></div></td></tr>'),!isBreakLog&&Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.WORKITEM)){var workitemDispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.WORKITEM);body+="<tr><td><label"+(Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.WORKITEM)?' class="zpl_mtry"':"")+">"+workitemDispName+'</label></td><td><div><input class="ztextbox w400" id="cal_log_workitemid" name="Work_Item" type="text"></div></td></tr>'}if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC)){var descDispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.DESC);body+="<tr><td><label"+(Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.DESC)?' class="zpl_mtry"':"")+">"+descDispName+'</label></td><td><div><textarea class="ztextbox wd100_per w400" id="cal_log_descid"  name="Description"></textarea></div></td></tr>'}body+='<tr><td><label class="zpl_mtry">'+ZPI18N.getString("zp.hourslog")+'</label></td><td><div id="timelog_type" class="zpl_flex-wrap zpl_flexgap3">';var manualLog=automaticLog=fromToTimeLog=!0;(Timetracker.generalSettings.isManualLogAllowed(Timetracker.timelogs.tserecno)||(manualLog=!1),Timetracker.generalSettings.isFromToTimeLogAllowed(Timetracker.timelogs.tserecno)||(fromToTimeLog=!1),Timetracker.generalSettings.isAutomaticLogAllowed(Timetracker.timelogs.tserecno)||(automaticLog=!1),manualLog&&!Timetracker.BreakTimelogs.isBreakLog()&&(body+='<div class="zradiobutton zradiobutton--horizontal"><input id="timelog_hrs" type="radio" name="timelogTime"  class="zradiobutton__helper" value="0" onclick="Timetracker.timelogs.showHideTimeLogTimer(\'0\');"><label for="timelog_hrs" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.stotalhours")+"</span></label></div>"),fromToTimeLog&&(body+='<div class="zradiobutton zradiobutton--horizontal"><input id="timelog_start_end" type="radio" name="timelogTime"  class="zradiobutton__helper" value="1" onclick="Timetracker.timelogs.showHideTimeLogTimer(\'1\');"><label for="timelog_start_end" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.startandend")+"</span></label></div>"),automaticLog&&(body+='<div class="zradiobutton zradiobutton--horizontal"><input id="timelog_start_timer" type="radio" name="timelogTime"  class="zradiobutton__helper" value="2" onclick="Timetracker.timelogs.showHideTimeLogTimer(\'2\');"><label for="timelog_start_timer" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.timer")+"</span></label></div>"),body+="</div></td></tr>",body+='<tr><td></td><td  class="w400"><div id="hours_val_div">',manualLog&&!Timetracker.BreakTimelogs.isBreakLog())&&(body+='<div id="timelog_hours_time" class="d-flexC d-flexclmcap5 zpl_DNI"><input id="timelog_hrstime" type="text" class="ztextbox w80" value="00:00" placeholder="00:00"><i id="hrs_format_info" class="PI_info"></i></div>',body+='<div id="hrs_format_popup" style="display:none"><table class="zpl_itbl M0I"> <tbody><tr><td>2:50</td><td>'+ZPI18N.getString("zp.twohoursfiftymins")+"</td></tr><tr><td>10:5</td><td>"+ZPI18N.getString("zp.tenhoursfivemins")+"</td></tr><tr><td>:35</td><td>"+ZPI18N.getString("zp.thirtyfivemins")+"</td></tr><tr><td>3.5</td><td>"+ZPI18N.getString("zp.threehoursthirtymins")+"</td></tr><tr><td>4.75</td><td>"+ZPI18N.getString("zp.fourhoursfortyfivemins")+"</td></tr><tr><td>.5</td><td>"+ZPI18N.getString("zp.thirtymins")+"</td></tr><tr><td>7</td><td>"+ZPI18N.getString("zp.sevenhours")+"</td></tr></tbody></table></div>");fromToTimeLog&&(body+='<div id="timelog_start_end_time" class="d-flexC flexclmcap zpl_DNI"><input id="timelog_fromtime" type="text" class="ztextbox w100" value="00:00"><em>-</em><input id="timelog_totime" type="text" class="ztextbox w100" value="00:00"></div>'),body+="</div></td></tr>",!isBreakLog&&Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)&&(body+="<tr><td><label>"+ZPI18N.getString("zp.billablestatus")+'</label></td><td><div><div folabel="BillableStatus" id="cal_log_billableStatus_div"><select id="cal_log_billableStatus" name="Billable_Status"><option value="0">'+ZPI18N.getString("zp.billable")+'</option><option value="1">'+ZPI18N.getString("zp.nonbillable")+"</option></select></div></div></td></tr>"),body+="</tbody> </table></div></div></div>";var buttonHtml='<button id="submitLogtime" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.save")+'</button><button id="zp_modal_whitebtn" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.cancel")+"</button>",modal=ModuleComp.Modal.get({id:"calAddPopup",type:1,headerHtml:header,body:body,backdrop:!0,closeOnSubmit:!0,modalClass:"zpl_mdl zpl_mcenter sel_postion",deleteOnHide:!0,closeonEsc:!0,hiddenCallback:Timetracker.timelogs.calendar.destroyZComp,buttonHtml:buttonHtml});return manualLog&&!Timetracker.BreakTimelogs.isBreakLog()&&(ZPeopleComponents.popover(modal.find("#hrs_format_popup"),{displayType:"callout",closeOnBodyClick:!0,forElement:modal.find("#hrs_format_info"),position:"right"}),modal.find("#hrs_format_info").on("mouseover",function(){ZPeopleComponents.popover(modal.find("#hrs_format_popup")).open()}),modal.find("#hrs_format_info").on("mouseout",function(){ZPeopleComponents.popover(modal.find("#hrs_format_popup")).close()})),Timetracker.isTTSthiftEnabled()&&(modal.find("#timelog_start_end_time").addClass("zpl_flex-column"),modal.find("#timelog_start_end_time").find("em").remove()),modal},showHideAddUpdatePopup:function(show,modal){show?(0!=Layout.Page.container.find("#calViewPopup").length&&ModuleComp.Modal.hide("calViewPopup"),modal=modal||Layout.Page.container.find("#calAddPopup"),ModuleComp.Modal.show(modal)):ModuleComp.Modal.hide("calAddPopup",!0)},submitTimelog:function(curYear,curMonth,caldate){Timetracker.util.getTTLocation(Timetracker.timelogs.calendar.submitTimelogCallback,curYear,curMonth,caldate)},submitTimelogCallback:function(curYear,curMonth,caldate){var layout=Layout.Page.container.find("#calAddPopup"),allParams=Timetracker.timelogs.calendar.setParamsAddEditforCal({},curYear,curMonth,caldate,!0);if(null===allParams||1==allParams.isError){let msg=allParams.errMsg?allParams.errMsg:ZPI18N.getString("zp.entervalidtime");return Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#timelog_fromtime"),msg:msg,appendTo:layout.find("#hours_val_div")}),Timetracker.Util.appenErrorMsgForElem({obj:layout.find("#timelog_totime")}),layout.find("#submitLogtime").removeClass("disabled"),!1}var params=Timetracker.timelogs.calendar.calAddUpdateParam(allParams,!1),errObj={};(errObj={hrsfld:layout.find("#timelog_type").find("input[name='timelogTime']:checked").length}).hrsregexerr=allParams.hrsregexerr,errObj.jobid=allParams.jobid;var errVal=Timetracker.timelogs.calendar.validateDispLogError(errObj,params);if(!0===errVal)errVal=!0;else{var calParams={};calParams.reqParams=params,calParams.allParams=allParams,Timetracker.timelogs.calendar.sendAddTLReq(calParams)}},setParamsAddEditforCal:function(arg,curYear,curMonth,caldate1,isFromAdd){var isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",arg),params={};if(isBreakLog)params=Timetracker.BreakTimelogs.Calendar.setParamsForEditCal(arg,curYear,curMonth,caldate1);else{var hrsregexerr,bill_stat,modal=Layout.Page.container.find("#calAddPopup"),date_val=0,integerform=0,date_format=0,newdiffT=0,diffmins=0,loggedHrs=0;if(Timetracker.util.removeErrorMsg(void 0,modal,!0),null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients){var clientId=TimelyZComp.select.getValue(modal.find("#caltimelogClient"));null!=clientId&&"0"!==clientId&&(params.clientId=clientId,params.clientName=ZPeople.decodeTxt(ZPeopleComponents.select(modal.find("#caltimelogClient")).getOptionData()[0].text))}if(null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Projects){var projid=TimelyZComp.select.getValue(modal.find("#projectid"));null!==projid&&"0"!==projid&&(params.projectid=projid,params.Project=projid,params.projectname=ZPeople.decodeTxt(ZPeopleComponents.select(modal.find("#projectid")).getOptionData()[0].text))}var User_Name,jobid=TimelyZComp.select.getValue(modal.find("#jobid"));params.jobid=jobid,params.jobname=ZPeople.decodeTxt(ZPeopleComponents.select(modal.find("#jobid")).getOptionData()[0].text),null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Billable_Show&&(bill_stat=TimelyZComp.select.getValue(modal.find("#cal_log_billableStatus"))),User_Name=ZPCal.Calendar.isDashboardCal()?erecno:ZPCal.Calendar.isSelfServiceCal()?SelfService.getUserId():null===Timetracker.timelogs.tserecno?erecno:Timetracker.timelogs.tserecno,Timetracker.timelogs.formDetails=Timetracker.util.getFormDetails(Timetracker.timelogs.formDetails,"P_Timesheet");if(isFromAdd?params.zp_mode="addRecord":(params.zp_mode="updateRecord",params.zp_recordId=arg.timelogId),isFromAdd){var stringmonth=curMonth.toString();stringmonth.startsWith("0")&&(stringmonth=stringmonth.replace("0",""));var stringdate=caldate1.toString();stringdate.startsWith("0")&&(stringdate=stringdate.replace("0",""));var intmonth=Number(stringmonth),intdate=Number(stringdate);integerform=intmonth+1+"-"+intdate+"-"+curYear,date_val=new Date(curYear,curMonth,caldate1),date_format=Calendar.formatDate(date_val)}else{var argworkdate=arg.workDate;if(String(argworkdate).indexOf("GMT")>=0){if(arg.hasOwnProperty("fordatepart")){arg.fordatepart;date_format=Calendar.formatDate(argworkdate),!1;var day=arg.workDate.getDate(),month=arg.workDate.getMonth(),year=arg.workDate.getFullYear();date_val=new Date(year,month,day),integerform=month+1+"-"+day+"-"+year}}else{if(0!=argworkdate.substr(0,argworkdate.indexOf(" ")).length)argworkdate.substr(0,argworkdate.indexOf(" "));else if(arg.hasOwnProperty("fordatepart"))arg.fordatepart;else arg.workDate;var workDate=Calendar.parseDate(arg.workDate,uidateFormat);day=workDate.getDate(),month=workDate.getMonth(),year=workDate.getFullYear();date_val=new Date(year,month,day),integerform=month+1+"-"+day+"-"+year,date_format=Calendar.formatDate(date_val)}}if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)&&(params.Billable_Status=bill_stat,isBreakLog&&!isFromAdd)){var payType=Layout.Page.container.find("span[name=payType]").attr("value");"0"!==payType&&"1"!==payType||(params.Billable_Status=payType)}if(params.Date=date_format,params.JobId=jobid,params.User_Name=User_Name,params.conreqcsr=csrfToken,params.isFromNewUI=!0,params.loginUserZUID=_LOGGEDIN_ZUID,params.zp_formId=Timetracker.timelogs.formDetails.formId,params.zp_tableName="P_Timesheet",0!==Object.keys(Timetracker.location.latLongParam).length){var obj=Timetracker.location.latLongParam;obj.hasOwnProperty("latitude")&&null!==obj.latitude&&obj.hasOwnProperty("longitude")&&null!==obj.longitude&&obj.hasOwnProperty("accuracy")&&null!==obj.accuracy&&(params.longitude=Timetracker.location.latLongParam.longitude,params.latitude=Timetracker.location.latLongParam.latitude,params.accuracy=Timetracker.location.latLongParam.accuracy)}if(isFromAdd||(params.timelogtype=arg.type,params.loggedHrs=Calendar.minstohrs(arg.hours),params.fromTime=arg.fromTime,params.toTime=arg.toTime,newdiffT=Calendar.minstohrs(arg.hours)),0!==modal.find("#timelog_type").length&&(isFromAdd||!isFromAdd&&void 0!=modal.find("#timelog_type").find("input[name='timelogTime']:checked").val()))if(selectedType=modal.find("#timelog_type").find("input[name='timelogTime']:checked").val(),params.timelogtype=selectedType,"2"!==arg.type&&2!==arg.type||!1!==isFromAdd){if("0"===selectedType){loggedHrs=modal.find("#timelog_hrstime").val(),params.loggedHrs=loggedHrs,newdiffT=loggedHrs;var returnnewdiffT=Timetracker.DateTime.convertToMins(loggedHrs);newdiffT=Calendar.minstohrs(returnnewdiffT),hrsregexerr=null!==(hrsregexerr=loggedHrs.match(Timetracker.util.maxhrsRegex))||null,params.timelogtype=selectedType}else if("1"===selectedType&&(params.timelogtype=selectedType,hrsregexerr=!0,modal.find("#timelog_fromtime").val()&&modal.find("#timelog_totime").val())){var fromTime,toTime;if(Timetracker.isTTSthiftEnabled()){let fTime=TimelyZComp.datetimefield.getDateObj(modal.find("#timelog_fromtime")),tTime=TimelyZComp.datetimefield.getDateObj(modal.find("#timelog_totime"));if(date_val&&fTime&&(fromTime=date_val.getDiff(fTime,Timetracker.constants.MINUTES)),date_val&&tTime&&(toTime=date_val.getDiff(tTime,Timetracker.constants.MINUTES)),isNaN(fromTime)||isNaN(toTime))return null;if(fromTime>toTime)return{isError:!0,errMsg:ZPI18N.getString("zp.fromtimegreater")};if(toTime-fromTime>Timetracker.constants.PER_DAY_MIN)return{isError:!0,errMsg:ZPI18N.getString("zp.timeexceeded24")}}else{var fromhrstot=TimelyZComp.timeField.getValue(modal.find("#timelog_fromtime")),tohrstot=TimelyZComp.timeField.getValue(modal.find("#timelog_totime"));if(!fromhrstot||!tohrstot)return null;if(fromTime=Timetracker.util.getTotalTimeForHours(fromhrstot.split(":")),toTime=Timetracker.util.getTotalTimeForHours(tohrstot.split(":")),isNaN(fromTime)||isNaN(toTime))return null}toTime>=fromTime?(diffmins=toTime-fromTime,newdiffT=Calendar.minstohrs(diffmins)):(diffmins=toTime+Timetracker.constants.PER_DAY_MIN-fromTime,newdiffT=Calendar.minstohrs(diffmins)),params.fromTime=fromTime,params.toTime=toTime,params.loggedHrs=newdiffT}}else newdiffT=Calendar.minstohrs(arg.hours),hrsregexerr=!0,params.timelogtype=arg.type,params.loggedHrs=arg.hours,loggedHrs=arg.hours;if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.WORKITEM))if(ZPeopleComponents.isComponent(modal.find("#cal_log_workitemid"))){var workItem=ZPeople.decodeTxt(TimelyZComp.select.getValue(modal.find("#cal_log_workitemid")));params.Work_Item="0"!==workItem&&0!==workItem?workItem:""}else{var workitemTxt=modal.find("#cal_log_workitemid").val();!isFromAdd&&arg.hasOwnProperty("taskName")&&""!=arg.taskName?params.Work_Item=workitemTxt:""!==workitemTxt&&(params.Work_Item=workitemTxt)}if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC)){var descTxt=modal.find("#cal_log_descid").val();!isFromAdd&&arg.hasOwnProperty("description")&&""!=arg.description?params.Description=descTxt:""!==descTxt&&(params.Description=descTxt)}params.date_val=date_val,params.hrsregexerr=hrsregexerr,params.diffmins=diffmins,params.integerform=integerform,params.newdiffT=newdiffT,params.jobid=jobid,params.jobColor=arg.jobColor}return params},calAddUpdateParam:function(allParams,isFromEdit){var params={zp_mode:allParams.zp_mode,Date:allParams.Date,JobId:allParams.JobId,User_Name:allParams.User_Name,conreqcsr:allParams.conreqcsr};return params.isFromNewUI=allParams.isFromNewUI,params.loginUserZUID=allParams.loginUserZUID,params.zp_formId=allParams.zp_formId,params.zp_tableName=allParams.zp_tableName,params.timelogtype=allParams.timelogtype,isFromEdit&&(params.zp_recordId=allParams.zp_recordId),allParams.hasOwnProperty("loggedHrs")&&(params.loggedHrs=allParams.loggedHrs),allParams.hasOwnProperty("fromTime")&&(params.fromTime=allParams.fromTime),allParams.hasOwnProperty("toTime")&&(params.toTime=allParams.toTime),allParams.hasOwnProperty("Work_Item")&&(params.Work_Item=allParams.Work_Item),allParams.hasOwnProperty("Description")&&(params.Description=allParams.Description),allParams.hasOwnProperty("Project")&&(params.Project=allParams.Project),allParams.hasOwnProperty("Billable_Status")&&(params.Billable_Status=allParams.Billable_Status),allParams.hasOwnProperty("latitude")&&allParams.hasOwnProperty("longitude")&&allParams.hasOwnProperty("accuracy")&&(params.latitude=allParams.latitude,params.longitude=allParams.longitude,params.accuracy=allParams.accuracy),params},validateDispLogError:function(errObj,params){var isCalFormError=!1,modal=Layout.Page.container.find("#calAddPopup");if(null!==errObj.hrsregexerr&&0!==errObj.hrsfld||(Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#timelog_hrstime"),msg:ZPI18N.getString("zp.entervalidinput"),appendTo:modal.find("#hours_val_div")}),isCalFormError=!0),Timetracker.generalSettings.isTimelogZeroHoursRestrict(Timetracker.timelogs.tserecno)&&(0==params.timelogtype&&0==Timetracker.DateTime.convertToMins(params.loggedHrs)||1==params.timelogtype&&params.fromTime-params.toTime==0)&&(0==params.timelogtype?Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#timelog_hrstime"),msg:ZPI18N.getString("zp.logalert9"),appendTo:modal.find("#hours_val_div")}):(Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#timelog_fromtime"),msg:ZPI18N.getString("zp.logalert9"),appendTo:modal.find("#hours_val_div")}),Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#timelog_totime")})),isCalFormError=!0),!params.JobId||"0"===params.JobId||"-Select-"===params.JobId){var jobname=void 0!==Timetracker.jobs.formDetails.labelDetails?Timetracker.jobs.formDetails.labelDetails.JOBNAME:ZPI18N.getString("zp.jobname");Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#jobid"),msg:ZPI18N.getString("zp.selvalforfield",[jobname])}),isCalFormError=!0}if(void 0!==params&&!errObj.isBreakLog&&Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.PROJECT)){var prjctError=!1,projectVal=TimelyZComp.select.getValue(modal.find("#projectid"));if("0"!==projectVal&&0!==projectVal&&"-Select-"!==projectVal||(prjctError=!0),prjctError){var projectfieldname=void 0!==Timetracker.projects.formDetails.labelDetails?Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME:ZPI18N.getString("zp.projectname");Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#projectid"),msg:ZPI18N.getString("zp.selvalforfield",[projectfieldname])}),isCalFormError=!0}if(Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.CLIENT)){var clientError=!1,clientVal=TimelyZComp.select.getValue(modal.find("#caltimelogClient"));if("0"!==clientVal&&0!==clientVal&&"-Select-"!==clientVal||(clientError=!0),clientError){var clntfieldname=void 0!==Timetracker.clients.formDetails.labelDetails?Timetracker.clients.formDetails.labelDetails.CLIENTNAME:ZPI18N.getString("zp.clientname");Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#caltimelogClient"),msg:ZPI18N.getString("zp.selvalforfield",[clntfieldname])}),isCalFormError=!0}}}if(void 0!==params&&!errObj.isBreakLog&&Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.WORKITEM)){var errMsg="",wiFieldName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.WORKITEM);if(Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.WORKITEM)&&(params.hasOwnProperty("Work_Item")||(errMsg=ZPI18N.getString("zp.entervalforfield",[wiFieldName]))),params.hasOwnProperty("Work_Item")){var fldDtls={tlFieldType:"text",tlValue:params.Work_Item,fldDispName:wiFieldName,tlField:Timetracker.constants.WORKITEM,isV5:!0};errMsg=Timetracker.timelogs.util.createErrorTextInputFields(fldDtls,!0)}""!==errMsg&&"valid"!==errMsg&&(Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#cal_log_workitemid"),msg:errMsg}),modal.find("#cal_log_workitemid").parent().find("#errorDiv").addClass("txtbrk"),isCalFormError=!0)}if(void 0!==params&&Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC)){var descFieldName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.DESC);errMsg="";if(Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.DESC)&&(params.hasOwnProperty("Description")||(errMsg=ZPI18N.getString("zp.entervalforfield",[descFieldName]))),params.hasOwnProperty("Description")){fldDtls={tlFieldType:"text",tlValue:params.Description,fldDispName:descFieldName,tlField:Timetracker.constants.DESC,isV5:!0};errMsg=Timetracker.timelogs.util.createErrorTextInputFields(fldDtls,!0)}""!==errMsg&&"valid"!==errMsg&&(Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#cal_log_descid"),msg:errMsg}),modal.find("#cal_log_descid").parent().find("#errorDiv").addClass("txtbrk"),isCalFormError=!0)}return isCalFormError&&modal.find("#submitLogtime").removeClass("disabled"),isCalFormError},successCallbackTLAdd:function(extraDetails){var reqParams=extraDetails.params,addtnlParams=extraDetails.additionalParams;reqParams.skipOverlapValidation=!0,reqParams.isFromWarnPopup=!0;var calendarParams={};calendarParams.allParams=addtnlParams.allParams,calendarParams.reqParams=reqParams,Timetracker.timelogs.calendar.sendAddTLReq(calendarParams)},sendAddTLReq:function(calParams){params=calParams.reqParams,allParams=calParams.allParams,$.post("/addUpdateRecord.zp",params,function(resdata){if(resdata.length>0){var resObj=resdata[0];if(Layout.Page.container.find("#submitLogtime").removeClass("disabled"),resObj.hasOwnProperty("code")&&7e3!==resObj.code)if(resObj.hasOwnProperty("showOverlapWarn")&&resObj.showOverlapWarn)"1"===Timetracker.generalSettings.getTimelogOverlapType()&&Timetracker.timelogs.constructWarnPopupForOverlap(params,Timetracker.timelogs.calendar.successCallbackTLAdd,{allParams:allParams});else if("object"==typeof resObj.message){var msgObj=resObj.message;Timetracker.timelogs.calendar.timelogErrDisp(msgObj)}else Timetracker.util.showAlert(1,ZPI18N.getString("zp.ttfailuremsg"));else if(Timetracker.timelogs.refreshData=!0,Timetracker.UserSpace.Timelogs.isRefreshNeeded=!0,(ZPCal.Calendar.isDashboardCal()||ZPCal.Calendar.isSelfServiceCal())&&"month"!==ZPCal.Calendar.CURMODE)Timetracker.util.showAlert(2,ZPI18N.getString("zp.timelogentryadded")),Timetracker.timelogs.calendar.showHideAddUpdatePopup(!1),"day"===ZPCal.Calendar.CURMODE?ZPCal.Calendar.populatedayCalendar(ZPCal.Calendar.dayCalendarObj):"week"===ZPCal.Calendar.CURMODE&&ZPCal.Calendar.populateWeekCalendar(ZPCal.Calendar.weekCalendarObj);else{var true_refresh=!1;if(resObj.hasOwnProperty("true_refresh")&&(true_refresh=resObj.true_refresh),Timetracker.util.showAlert(2,ZPI18N.getString("zp.timelogentryadded")),Timetracker.UserSpace.isMySpaceActionList()&&Timetracker.Util.getLayout().find("#addTlCard").remove(),2===params.timelogtype||"2"===params.timelogtype||true_refresh)Timetracker.timelogs.calendar.refreshCalForTimer(),Timetracker.UserSpace.isMySpace()&&2==params.timelogtype&&Timetracker.currentlyRunningTimer.getCurrentTimerDetails();else{Timetracker.timelogs.calendar.showHideAddUpdatePopup(!1);var newargs=Timetracker.timelogs.calendar.tlViewParams(allParams,{},params,!1),pkId1=resObj.pkId;newargs.timelogId=pkId1;var timelogRowHtml=Timetracker.timelogs.calendar.getTimelogRowHtmlForCalendar(newargs,allParams.newdiffT,!1),timelogRowHtmlInMoreContent=Timetracker.timelogs.calendar.getTimelogRowHtmlForCalendar(newargs,allParams.newdiffT,!0),recLimit=ZPCal.Calendar.isDashboardCal()||ZPCal.Calendar.isSelfServiceCal()?1:2,integerform=allParams.integerform,ZP_Callayout=Layout.Page.container.find("td[date="+integerform+"]"),moreNumber=ZP_Callayout.find(".ZPcalvw-month-wksheet").length+1-2*recLimit;if(moreNumber>0){var moreElement=ZP_Callayout.find(".ZPcalvw-morebox");timelogRowHtmlInMoreContent.data("elemData",newargs),moreElement.find("#tl_morebtn").find("span").replaceWith('<span jobcnt="'+moreNumber+'">'+moreNumber+"</span>"),moreElement.find(".ZPcalvw-morepopup-cnt").append(timelogRowHtmlInMoreContent);var clickjob=moreElement.find("div[jobrowid="+newargs.timelogId+"]").find(".ZPcalvwbox-head");Layout.Page.container.find(clickjob).attr("onclick","").off("click").on("click",function(e){e.stopPropagation();var x=$(this).offset().left,y=$(this).offset().top;Timetracker.timelogs.calendar.showViewPopup(newargs,x,y)}),moreElement.removeClass("zpl_DNI")}else{timelogRowHtml.data("elemData",newargs);var timelogDiv=ZP_Callayout.find("#timelog_div"),morePopUpContent=(moreElement=timelogDiv.find(".ZPcalvw-morebox")).find(".ZPcalvw-morepopup");0===timelogDiv.length?((timelogDiv=$('<div id="timelog_div"></div>')).append(timelogRowHtml),(moreElement=$('<div class="ZPcalvw-morebox zpl_DNI"> <a class="ZPcalvw-morebtn" id="tl_morebtn"><span jobcnt='+moreNumber+">"+moreNumber+"</span> "+ZPI18N.getString("zp.smore")+"</a> </div>")).find("#tl_morebtn").data("date",params.Date),(morePopUpContent=$('<div class="ZPcalvw-morepopup zpl_DNI"><div class="ZPcalvw-morepopup-hd"><span></span><a class="ZPcalvw-morepopup-close"><i class="IC-cls-1px"></i></a> </div><div class="ZPcalvw-morepopup-cnt"></div></div>')).find(".ZPcalvw-morepopup-cnt").append(timelogRowHtmlInMoreContent),moreElement.append(morePopUpContent),timelogDiv.append(moreElement),ZP_Callayout.find(".ZPcalvw-addbtn").before(timelogDiv),ZP_Callayout.find("#tl_morebtn").on("click",function(e){e.stopPropagation(),$(".ZPcalvw-morepopup").addClass("zpl_DNI");var morepop=$(this).siblings(".ZPcalvw-morepopup"),dateObj=Calendar.parseDate($(this).data("date"),uidateFormat);$(".ZPcalvw-morepopup").find(".ZPcalvw-morepopup-hd").find("span").html(ZPDateTime.days[dateObj.getDay()]+"<strong>"+dateObj.getDate()+"</strong>"),morepop.removeClass("zpl_DNI");var scrollTop;scrollTop=Layout.Page.container.find(".ZPcalvw-box").scrollTop();var top,wintop=Layout.Page.container.find("#moncal_body").offset().top+scrollTop,poptop=morepop.offset().top+scrollTop,popHei=morepop.height(),winHei=Layout.Page.container.find("#moncal_body").height(),calObj=new NewCalendar.calObj;$("#"+calObj.outerdivId).hasClass("ZPcalmbt")&&(wintop-=60),top=poptop+popHei>wintop+winHei?parseInt("-"+(popHei+70)):35,left=parseInt("-192");var winleft=Layout.Page.container.find("#moncal_body").offset().left,popwidth=morepop.width(),popleft=morepop.offset().left;winleft>popleft&&(left=popleft+popwidth),morepop.css({top:top+"px",left:left+"px"}),wintop+winHei<(poptop=morepop.offset().top+scrollTop)+popHei&&(top=parseInt("-"+(popHei+70))),(popleft=morepop.offset().left)<winleft&&(left+=popwidth),morepop.css({top:top+"px",left:left+"px"}),morepop.removeClass("zpl_DNI")})):(timelogDiv.find(".ZPcalvw-morebox").before(timelogRowHtml),morePopUpContent.find(".ZPcalvw-morepopup-cnt").append(timelogRowHtmlInMoreContent));clickjob=ZP_Callayout.find("div[jobrowid="+newargs.timelogId+"]").find(".ZPcalvwbox-head");Layout.Page.container.find(clickjob).attr("onclick","").off("click").on("click",function(){var x=$(this).offset().left,y=$(this).offset().top;Timetracker.timelogs.calendar.showViewPopup(newargs,x,y)})}if(!ZPCal.Calendar.isDashboardCal()&&!ZPCal.Calendar.isSelfServiceCal()){$(".ZPcalvw-month-view").find("#moncal_body").find("tr");var dispdiffmins,trindex=ZP_Callayout.parent().index(),totval=Layout.Page.container.find(".ZPcalvw-month-view").find("#moncal_body").find("tr").eq(trindex).find(".zpcaltotal").text(),usubHours=Layout.Page.container.find("#timelogs_calendar_view").find("#not_submitted_hours").text(),subHours=Layout.Page.container.find("#timelogs_calendar_view").find("#submitted_hours").text(),numusubHours=Timetracker.DateTime.convertStringhrstoMins(usubHours),numsubHours=Timetracker.DateTime.convertStringhrstoMins(subHours),minsval=Timetracker.DateTime.splittime(totval)+(dispdiffmins=params.hasOwnProperty("loggedHrs")?Timetracker.DateTime.convertToMins(params.loggedHrs):allParams.diffmins);numusubHours+=dispdiffmins;var totdisp=Calendar.minstohrs(minsval);Timetracker.timelogs.setTotalLogHours(numsubHours,numusubHours,!0);var totdom=$('<td class="zpcaltotal"><div class="MT50" align="center">'+totdisp+"</div></td>");Layout.Page.container.find(".ZPcalvw-month-view").find("#moncal_body").find("tr").eq(trindex).find(".zpcaltotal").replaceWith(totdom)}}}}})},refreshCalForTimer:function(refreshTimer){Timetracker.timelogs.timer.resetTimerValues(refreshTimer),Timetracker.timelogs.calendar.showHideAddUpdatePopup(!1),Timetracker.UserSpace.isMySpace()||(ZPCommonUtil.DateNavigator.setPeriod(Timetracker.Page.getPageMode()+"_cal",ZPCommonUtil.DateNavigator.TYPE.MONTHLY,ZPCommonUtil.DateNavigator.TENSE.CURRENT),Timetracker.timelogs.calObj=void 0,Timetracker.timelogs.calendar.populateTimesheet(Timetracker.timelogs.calObj))},tlViewParams:function(allParams,arg,params,isFromEdit){var viewParams={};viewParams.type=params.timelogtype,viewParams.fordatepart=allParams.date_format,Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)&&(viewParams.billableStatus=params.Billable_Status),viewParams.fromTime=params.fromTime,viewParams.toTime=params.toTime,viewParams.jobId=allParams.jobid,viewParams.jobColor=allParams.jobColor,viewParams.hasOwnProperty("fromTime")&&void 0!==viewParams.fromTime&&(viewParams.fromTimeInTimeFormat=Calendar.minstotime(viewParams.fromTime)),viewParams.hasOwnProperty("toTime")&&void 0!==viewParams.toTime&&(viewParams.toTimeInTimeFormat=Calendar.minstotime(viewParams.toTime));var jobIndex=-1;return null!==Timetracker.jobs.jobData&&(jobIndex=Timetracker.projects.Operations.findJSONArrayIndex(Timetracker.jobs.jobData,viewParams.jobId,"jobId")),-1!==jobIndex?(void 0!==Timetracker.jobs.jobData[jobIndex].jobName&&(viewParams.jobName=Timetracker.jobs.jobData[jobIndex].jobName),void 0!==Timetracker.jobs.jobData[jobIndex].jobColor&&(viewParams.jobColor=Timetracker.jobs.jobData[jobIndex].jobColor)):viewParams.jobName=ZPeople.escapeHtml(allParams.jobname),-1!==jobIndex&&void 0!==Timetracker.jobs.jobData[jobIndex].projectName&&"0"===allParams.projectid?(viewParams.projectName=Timetracker.jobs.jobData[jobIndex].projectName,viewParams.projectId=Timetracker.jobs.jobData[jobIndex].projectId):void 0!==allParams.projectid&&(viewParams.projectId=allParams.projectid,viewParams.projectName=ZPeople.escapeHtml(allParams.projectname)),null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients&&allParams.hasOwnProperty("clientId")&&void 0!==allParams.clientId&&(viewParams.clientId=allParams.clientId,viewParams.clientName=ZPeople.escapeHtml(allParams.clientName)),isFromEdit?(viewParams.jobhrs=allParams.loggedHrs,viewParams.hours=allParams.loggedHrs,viewParams.timelogId=arg.timelogId,Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)&&(viewParams.billingStatus=allParams.bill_stat),viewParams.jobIsCompleted=arg.jobIsCompleted,viewParams.workDate=arg.workDate,viewParams.isEditAllowed=arg.isEditAllowed):(viewParams.hours=allParams.newdiffT,viewParams.jobIsCompleted=params.jobIsCompleted,viewParams.workDate=allParams.Date,viewParams.isEditAllowed=!0),params.hasOwnProperty("Work_Item")&&(viewParams.taskName=ZPeople.escapeHtml(params.Work_Item)),params.hasOwnProperty("Description")&&(viewParams.description=ZPeople.escapeHtml(params.Description)),Timetracker.BreakTimelogs.isBreakLog("DATA",arg)&&(viewParams.isBreakLog=!0),viewParams},timelogErrDisp:function(msgObj){var msgKey=Object.keys(msgObj)[0],errMsg=msgObj[msgKey],modal=Layout.Page.container.find("#calAddPopup");switch(msgKey){case"TotalHours":case"Date":Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#hours_val_div"),msg:errMsg,appendTo:modal.find("#hours_val_div")});break;case"JobId":Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#jobid"),msg:errMsg});break;case"Work_Item":Timetracker.Util.appenErrorMsgForElem({obj:modal.find("#cal_log_workitemid"),msg:errMsg});break;default:Timetracker.util.showAlert(1,errMsg)}},destroyZComp:function(){var modal=Layout.Page.container.find("#calAddPopup");0!=modal.length&&(ZPeopleComponents.isComponent(modal.find("#cal_log_billableStatus"))&&TimelyZComp.select.destroy(modal.find("#cal_log_billableStatus")),ZPeopleComponents.isComponent(modal.find("#caltimelogClient"))&&TimelyZComp.select.destroy(modal.find("#caltimelogClient")),ZPeopleComponents.isComponent(modal.find("#projectid"))&&TimelyZComp.select.destroy(modal.find("#projectid")),ZPeopleComponents.isComponent(modal.find("#jobid"))&&TimelyZComp.select.destroy(modal.find("#jobid")),ZPeopleComponents.isComponent(modal.find("#cal_log_workitemid"))&&TimelyZComp.select.destroy(modal.find("#cal_log_workitemid")))},constructViewHtml:function(viewargs){viewargs.type;var isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",viewargs);0!==Layout.Page.container.find("#viewCalPopup").length&&Layout.Page.container.find("#viewCalPopup").remove();var header='<span class="d-flexC"><h4>'+ZPI18N.getString("zp.local.TimeLog")+'</h4><span class="zpl_dots"></span><em id="cal_log_date"></em></span><span class="zpl_mhderrgt"><a id="editpen" data-popup-open="editlog" class="PI_edt zpl_btnic" title="'+ZPI18N.getString("zp.edit")+'"></a></span><a class="_cls PI_cls" title="'+ZPI18N.getString("zp.close")+'"></a>',body='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><table class="zpl_itbl zpl_ttllblfxd zpl_nocrsor"><tbody>';if(!isBreakLog&&Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.CLIENT)&&(body+='<tr><td class="w150"><em'+(Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.CLIENT)?' class="zpl_mtry"':"")+">"+Timetracker.clients.formDetails.labelDetails.CLIENTNAME+'</em></td><td class="w300 txtbrk"><span id="viewclientid"></span></td></tr>'),!isBreakLog&&Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.PROJECT)&&(body+='<tr><td class="w150"><em'+(Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.PROJECT)?' class="zpl_mtry"':">")+Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME+'</em></td><td class="w300 txtbrk"><span id="viewprojectid"></span></td></tr>'),body+='<tr><td class="w150"><em class="zpl_mtry">'+(isBreakLog?ZPI18N.getString("zp.break"):Timetracker.jobs.formDetails.labelDetails.JOBNAME)+'</em></td><td class="w300 txtbrk"><span id="viewjobid"></span></td></tr>',isBreakLog&&Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)&&(body+='<tr><td class="w150"><em>'+ZPI18N.getString("zp.type")+'</em></td><td class="w300 txtbrk"><span id="viewbillid"></span></td></tr>'),!isBreakLog&&Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.WORKITEM)){var workitemDispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.WORKITEM);body+='<tr><td class="w150"><em'+(Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.WORKITEM)?' class="zpl_mtry txtbrk"':' class="txtbrk"')+">"+workitemDispName+'</em></td><td class="w300 txtbrk"><span id="viewworkitemid"></span></td></tr>'}if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC)){var descDispName=Timetracker.util.gettlFieldDispName(Timetracker.generalSettings.settingDetails,Timetracker.constants.DESC);body+='<tr><td class="w150"><em'+(Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.DESC)?' class="zpl_mtry txtbrk"':' class="txtbrk"')+">"+descDispName+'</em></td><td class="w300 txtbrk"><span id="viewdescid"></span></td></tr>'}body+='<tr><td class="w150"><em class="zpl_mtry">'+ZPI18N.getString("zp.hourslog")+'</em></td><td class="w300 txtbrk"><span id="viewhrsid"></span></td></tr>',!isBreakLog&&Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)&&(body+='<tr><td class="w150"><em>'+ZPI18N.getString("zp.billablestatus")+'</em></td><td class="w300 txtbrk"><span id="viewbillid"></span></td></tr>'),body+="</tbody> </table></div></div></div>",buttonHtml='<button id="zp_modal_whitebtn" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.close")+"</button>",ModuleComp.Modal.get({id:"calViewPopup",type:1,headerHtml:header,body:body,backdrop:!0,closeOnSubmit:!0,modalClass:"zpl_mdl zpl_mcenter",deleteOnHide:!1,closeonEsc:!0,buttonHtml:buttonHtml})},showViewPopup:function(viewargs,x,y){Timetracker.timelogs.calendar.constructViewHtml(viewargs);var projname,prid,popupModal=Layout.Page.container.find("#calViewPopup"),isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",viewargs),jobhrs=viewargs.hours,clientname="-",wDate=Calendar.parseDate(viewargs.workDate,uidateFormat);if(popupModal.find("#cal_log_date").html(wDate.getDate()+" "+days[wDate.getDay()]),!0===viewargs.hasOwnProperty("projectId")?(projname=viewargs.projectName,prid=viewargs.projectId):("false",prid=!1),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.CLIENT)&&viewargs.hasOwnProperty("clientId")&&viewargs.hasOwnProperty("clientName")&&(clientname=viewargs.clientName,viewargs.clientId),"0"===viewargs.projectId||null===viewargs.projectId||"null"===projname||!1===prid||0===viewargs.projectId||void 0!==projname&&projname.indexOf("Select")>=0?(viewargs.projectId=null,projname="-"):projname=viewargs.projectName,void 0!=jobhrs){jobhrs=jobhrs.toString().indexOf(":")<0?Calendar.minstohrs(viewargs.hours):viewargs.hours}else{var difftime,ftime=viewargs.fromTime,totime=viewargs.toTime;difftime=totime>=ftime?totime-ftime:(totime+=1440)-ftime,jobhrs=Calendar.minstohrs(difftime)}if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)){var bill_val,bill_stat=viewargs.billableStatus;bill_val="0"===bill_stat||0===bill_stat?isBreakLog?ZPI18N.getString(Timetracker.Break.TYPE_STATUS[0]):ZPI18N.getString("zp.billable"):isBreakLog?ZPI18N.getString(Timetracker.Break.TYPE_STATUS[1]):ZPI18N.getString("zp.nonbillable")}if(!isBreakLog&&Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.CLIENT)){var clientEle=$('<span id="viewclientid">'+clientname+"</span>");popupModal.find("#viewclientid").replaceWith(clientEle)}var jobEle=$('<span id="viewjobid">'+viewargs.jobName+"</span>");if(popupModal.find("#viewjobid").replaceWith(jobEle),!isBreakLog){var projectEle=$('<span id="viewprojectid">'+projname+"</span>");popupModal.find("#viewprojectid").replaceWith(projectEle)}var hoursEle=$('<span id="viewhrsid">'+jobhrs+"</span>"),billEle=$('<span id="viewbillid">'+bill_val+"</span>");if(popupModal.find("#viewhrsid").replaceWith(hoursEle),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)&&popupModal.find("#viewbillid").replaceWith(billEle),!isBreakLog&&Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.WORKITEM)){var taskName="-";viewargs.hasOwnProperty("taskName")&&(taskName=viewargs.taskName);var workitemEle=$('<span id="viewworkitemid">'+taskName+"</span>");popupModal.find("#viewworkitemid").replaceWith(workitemEle)}if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.DESC)){var desc="-";viewargs.hasOwnProperty("description")&&(desc=viewargs.description);var descEle=$('<span id="viewdescid">'+desc+"</span>");popupModal.find("#viewdescid").replaceWith(descEle)}popupModal.find("#editpen").removeClass("zpl_DNI"),(void 0!=viewargs.approvalStatus&&-2!=viewargs.approvalStatus||1===viewargs.billingStatus||!viewargs.isEditAllowed)&&popupModal.find("#editpen").addClass("zpl_DNI"),popupModal.find("#editpen").off("click").on("click",function(){Timetracker.timelogs.calendar.editTimelog(viewargs),Timetracker.timelogs.calendar.showHideAddUpdatePopup(!0)}),ModuleComp.Modal.show(popupModal)},constructEditPopupHtml:async function(arg){var isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",arg),popupModal=Timetracker.timelogs.calendar.constructAddEditPopupHtml(!1,!0,{isBreakLog:isBreakLog}),wDate=Calendar.parseDate(arg.workDate,uidateFormat);if(popupModal.find("#cal_log_date").html(wDate.getDate()+" "+days[wDate.getDay()]),isBreakLog)Timetracker.BreakTimelogs.Calendar.populateCalendarEditPopUpBreak(arg);else{var dispName=ZPI18N.getString("zp.edit")+" "+ZPI18N.getString("zp.local.TimeLog");if(popupModal.find("#titleid").html(dispName),Timetracker.clients.getClients("caltimelogClient",null,null,!1,Timetracker.timelogs.tserecno,Timetracker.constants.TTCustomAdmin.EntryView,{isV5:!0}),popupModal.find("#caltimelogClient").off("zselectchange").on("zselectchange",function(event,data){data.fromUI&&Timetracker.projects.Filters.createProjectSelect(!0,Timetracker.timelogs.tserecno,data.selectedValue,"calendarLogTime",null,"0",null,Timetracker.constants.TTCustomAdmin.EntryView)}),await Timetracker.projects.Filters.createProjectSelect(!0,Timetracker.timelogs.tserecno,null,"calendarLogTime",null,null,null,Timetracker.constants.TTCustomAdmin.EntryView),popupModal.find("#projectid").off("zselectchange").on("zselectchange",function(event,data){if(data.fromUI){var cltid=null;0!=popupModal.find("#caltimelogClient").length&&(cltid=TimetrackerOperations.Filters.getSelectFilterValues(popupModal.find("#caltimelogClient"))),Timetracker.jobs.Filters.createJobSelect(Timetracker.timelogs.tserecno,"0","calendarLogTime",data.selectedValue,cltid,Timetracker.constants.TTCustomAdmin.EntryView)}}),popupModal.find("#jobid").off("zselectchange").on("zselectchange",function(event,data){data.fromUI&&Timetracker.timelogs.jobChange("calendarLogTime",void 0)}),2==arg.type)popupModal.find("#timelog_type").parent().parent().addClass("zpl_DNI");else{popupModal.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_timer']").parent().remove(),popupModal.find("#timelog_type").parent().parent().removeClass("zpl_DNI");let isShiftEnabled=Timetracker.isTTSthiftEnabled();if(isShiftEnabled){var pickerOptions={},logDate=Calendar.parseDate(arg.workDate,uidateFormat);logDate.setDate(logDate.getDate()-1),pickerOptions.minDate=Calendar.formatDate(logDate).toString(),logDate.setDate(logDate.getDate()+2),pickerOptions.maxDate=Calendar.formatDate(logDate).toString();var attr={pickerOptions:pickerOptions,value:Calendar.parseDate(arg.workDate,uidateFormat)};TimelyZComp.datetimefield.intialize(popupModal.find("#timelog_fromtime"),attr,!0),TimelyZComp.datetimefield.intialize(popupModal.find("#timelog_totime"),attr,!0)}else{var options={clearButton:"none",format:timeFormat.replace("a","tt"),minuteStep:1,className:"w150"};options.value=Timetracker.DateTime.getUserTimeZoneCurrDateTime(),TimelyZComp.timeField.intialize(popupModal.find("#timelog_fromtime"),options),TimelyZComp.timeField.intialize(popupModal.find("#timelog_totime"),options)}if(1==arg.type)if(popupModal.find("#timelog_type").find("input[name='timelogTime'][id='timelog_hrs']").prop("checked",!1),popupModal.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_end']").prop("checked",!0),popupModal.find("#timelog_hours_time").addClass("zpl_DNI"),popupModal.find("#timelog_hrstime").val(Calendar.minstohrs(0)),popupModal.find("#timelog_start_end_time").removeClass("zpl_DNI"),isShiftEnabled){let logDate=Calendar.parseDate(arg.workDate,uidateFormat),ftime=Timetracker.util.getShiftDatebyTime(arg.fromTime,logDate,Timetracker.constants.MINUTES);TimelyZComp.datetimefield.setValue(popupModal.find("#timelog_fromtime"),ftime);let ttime=Timetracker.util.getShiftDatebyTime(arg.toTime,logDate,Timetracker.constants.MINUTES);TimelyZComp.datetimefield.setValue(popupModal.find("#timelog_totime"),ttime)}else TimelyZComp.timeField.setValue(popupModal.find("#timelog_fromtime"),Timetracker.DateTime.minstoTimeMeridian(arg.fromTime)),TimelyZComp.timeField.setValue(popupModal.find("#timelog_totime"),Timetracker.DateTime.minstoTimeMeridian(arg.toTime));else if(0==arg.type){var jobhrs=arg.hours;jobhrs=jobhrs.toString().indexOf(":")<0?Calendar.minstohrs(arg.hours):arg.hours,popupModal.find("#timelog_type").parent().parent().removeClass("zpl_DNI"),popupModal.find("#timelog_type").find("input[name='timelogTime'][id='timelog_start_end']").prop("checked",!1),popupModal.find("#timelog_start_end_time").addClass("zpl_DNI"),popupModal.find("#timelog_type").find("input[name='timelogTime'][id='timelog_hrs']").prop("checked",!0),popupModal.find("#timelog_hrstime").val(jobhrs),popupModal.find("#timelog_hours_time").removeClass("zpl_DNI")}""===popupModal.find("#timelog_type").html()&&popupModal.find("#timelog_type").parent().parent().remove()}var data={};!0===arg.hasOwnProperty("projectId")&&null!=arg.projectId&&(data.projectId=arg.projectId,data.projectName=arg.projectName),arg.hasOwnProperty("jobId")&&(arg.jobIsActive||void 0==arg.jobIsActive)&&(data.jobId=arg.jobId,data.jobName=arg.jobName),null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients&&arg.hasOwnProperty("clientId")&&arg.hasOwnProperty("clientName")&&(data.clientId=arg.clientId,data.clientName=arg.clientName),Timetracker.timelogs.setValuesInSelectInput(data,"calendarLogTime","calAddPopup",null,{isNewKey:!0,allowAll:!0,isV5:!0}),null!==Timetracker.generalSettings.timelogEnabledFields&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Billable_Show&&(TimelyZComp.select.setValue(popupModal.find("#cal_log_billableStatus"),arg.billableStatus),null!==arg.jobId&&arg.jobBillableStatus==TimelyZComp.select.getValue(popupModal.find("#cal_log_billableStatus"))&&TimelyZComp.select.setAttributes(popupModal.find("#cal_log_billableStatus"),{disabled:"disabled"}));var workitemDiv=popupModal.find('input[name="Work_Item"]');let extraJson={};extraJson.jobId=data.jobId,Timetracker.timelogs.workItem.checkIfDropDownNeededForWorkitem(extraJson)?(arg.hasOwnProperty("taskName")&&(workitemDiv.attr("orgTaskName",arg.taskName),extraJson.toAppendOption=arg.taskName),extraJson.layout=workitemDiv,extraJson.elementId="cal_log_workitemid",Timetracker.timelogs.workItem.createDropdownForWorkitem(extraJson)):arg.hasOwnProperty("taskName")&&(workitemDiv.attr("orgTaskName",arg.taskName),workitemDiv.val(ZPeople.decodeTxt(arg.taskName))),arg.hasOwnProperty("description")&&popupModal.find("#cal_log_descid").val(ZPeople.decodeTxt(arg.description)),Layout.Page.container.find("#submitLogtime").removeClass("disabled").attr("onclick","").off("click").on("click",function(){Layout.Page.container.find("#submitLogtime").addClass("disabled"),Timetracker.timelogs.calendar.submitEditTimelog(arg)})}},editTimelog:function(arg){Timetracker.timelogs.calendar.constructEditPopupHtml(arg)},submitEditTimelog:function(arg){Timetracker.util.getTTLocation(Timetracker.timelogs.calendar.submitEditTimelogCallback,arg)},submitEditTimelogCallback:function(arg){var allParams;if(null===(allParams=Timetracker.timelogs.calendar.setParamsAddEditforCal(arg,0,0,0,!1))||1==allParams.isError){let msg=allParams.errMsg?allParams.errMsg:ZPI18N.getString("zp.entervalidtime");return Timetracker.Util.appenErrorMsgForElem({obj:Layout.Page.container.find("#timelog_fromtime"),msg:msg,appendTo:Layout.Page.container.find("#hours_val_div")}),Timetracker.Util.appenErrorMsgForElem({obj:Layout.Page.container.find("#timelog_totime")}),Layout.Page.container.find("#submitLogtime").removeClass("disabled"),!1}var params=Timetracker.timelogs.calendar.calAddUpdateParam(allParams,!0);0==allParams.timelogtype&&!Timetracker.generalSettings.isManualLogAllowed(arg.erecno)||1==allParams.timelogtype&&!Timetracker.generalSettings.isFromToTimeLogAllowed(arg.erecno)||2==allParams.timelogtype?hrfldval=2:hrfldval=Layout.Page.container.find("#timelog_type").find("input[name='timelogTime']:checked").length;var errObj={hrsfld:hrfldval};errObj.hrsregexerr=allParams.hrsregexerr,errObj.jobid=allParams.jobid,errObj.isBreakLog=arg.isBreakLog;var errVal=Timetracker.timelogs.calendar.validateDispLogError(errObj,params);if(!0===errVal)errVal=!0;else{var calendarDetails={};calendarDetails.reqParams=params,calendarDetails.allParams=allParams,calendarDetails.arg=arg,Timetracker.timelogs.calendar.sendUpdateTLReq(calendarDetails)}},successCallbackTLUpdate:function(extraDetails){var reqParams=extraDetails.params,addtnlParams=extraDetails.additionalParams;reqParams.skipOverlapValidation=!0,reqParams.isFromWarnPopup=!0;var calendarParams={};calendarParams.allParams=addtnlParams.allParams,calendarParams.arg=addtnlParams.arg,calendarParams.reqParams=reqParams,Timetracker.timelogs.calendar.sendUpdateTLReq(calendarParams)},sendUpdateTLReq:function(calendarDetails){var params=calendarDetails.reqParams,allParams=calendarDetails.allParams,arg=calendarDetails.arg,layout=Layout.Page.container.find("#timelogs_calendar_view");$.post("/addUpdateRecord.zp",params,function(resdata){var resObj=resdata[0];if(Layout.Page.container.find("#submitLogtime").removeClass("disabled"),resObj.hasOwnProperty("code")&&7e3!==resObj.code)if(resObj.hasOwnProperty("showOverlapWarn")&&resObj.showOverlapWarn){if("1"===Timetracker.generalSettings.getTimelogOverlapType()){var additionalParams={allParams:allParams,arg:arg};Timetracker.timelogs.constructWarnPopupForOverlap(params,Timetracker.timelogs.calendar.successCallbackTLUpdate,additionalParams)}}else if("object"==typeof resObj.message){var msgObj=resObj.message;Timetracker.timelogs.calendar.timelogErrDisp(msgObj)}else Timetracker.util.showAlert(1,ZPI18N.getString("zp.ttfailuremsg"));else{var true_refresh=!1;if(Timetracker.timelogs.refreshData=!0,Timetracker.UserSpace.Timelogs.isRefreshNeeded=!0,resObj.hasOwnProperty("true_refresh")&&(true_refresh=resObj.true_refresh),Timetracker.util.showAlert(2,ZPI18N.getString("zp.updatedsuccessfully")),2===params.timelogtype||"2"===params.timelogtype||true_refresh){var refreshTimer=Timetracker.timelogs.currentTimerJobData&&Timetracker.timelogs.currentTimerJobData.timelogId===params.zp_recordId;Timetracker.timelogs.calendar.refreshCalForTimer(refreshTimer)}else{var refreshargs=Timetracker.timelogs.calendar.tlViewParams(allParams,arg,params,!0);Timetracker.timelogs.calendar.constructTimelogRowInCalendar(refreshargs,!0,allParams.newdiffT,allParams.integerform);var hrsnew,hrsold,hrstomodify,strarghours,usubHours=layout.find("#not_submitted_hours").text(),subHours=layout.find("#submitted_hours").text(),numusubHours=Timetracker.DateTime.convertStringhrstoMins(usubHours),numsubHours=Timetracker.DateTime.convertStringhrstoMins(subHours),trlist=layout.find(".ZPcalvw-month-view").find("#moncal_body").find("tr"),trindex=trlist.find("td[date="+allParams.integerform+"]").parent().index(),totval=trlist.eq(trindex).find(".zpcaltotal").text(),totvalmins=Timetracker.DateTime.splittime(totval);if("1"===params.timelogtype||1===params.timelogtype)if(hrsnew=params.toTime-params.fromTime,void 0!=arg.toTime&&"0"!=arg.type&&0!=arg.type)hrsold=arg.toTime-arg.fromTime;else if("0"==arg.type||0==arg.type)hrsold=(strarghours=arg.hours.toString()).indexOf(":")>=0||strarghours.indexOf(".")>=0?Timetracker.DateTime.convertToMins(arg.hours):arg.hours;else hrsold=0;else if(hrsnew=Timetracker.DateTime.convertToMins(refreshargs.hours),arg.hours)hrsold=(strarghours=arg.hours.toString()).indexOf(":")>=0||strarghours.indexOf(".")>=0?Timetracker.DateTime.convertToMins(arg.hours):arg.hours;else hrsold=allParams.diffmins;hrstomodify=hrsnew>hrsold?hrsnew-hrsold:hrsold-hrsnew;var minsval,diffmins=Timetracker.DateTime.splittime(hrstomodify);hrsnew>hrsold?(minsval=totvalmins+diffmins,numusubHours+=diffmins):(minsval=totvalmins-diffmins,numusubHours-=diffmins),Timetracker.timelogs.setTotalLogHours(numsubHours,numusubHours,!0);var totdisp=Calendar.minstohrs(minsval);if(ZPCal.Calendar.isDashboardCal()||ZPCal.Calendar.isSelfServiceCal()){var totdom=$('<td class="zpcaltotal"><div class="MT50" align="center">'+totdisp+"</div></td>");layout.find(".ZPcalvw-month-view").find("#moncal_body").find("tr").eq(trindex).find(".zpcaltotal").replaceWith(totdom)}Timetracker.timelogs.calendar.showHideAddUpdatePopup(!1)}}})},constructTimelogRowInCalendar:function(timerTimelog,isFromFormEdit,hours,cellDate){var integerform;if(isFromFormEdit)integerform=cellDate,hours;else{var today=Calendar.getCurrentDay().day,workDate=timerTimelog.workDate instanceof Date?timerTimelog.workDate:Calendar.parseDate(timerTimelog.workDate,uidateFormat),day=workDate.getDate();integerform=workDate.getMonth()+1+"-"+day+"-"+workDate.getFullYear(),Calendar.minstohrs(timerTimelog.hours),"2"!==timerTimelog.type||Timetracker.timelogs.currentTimerJobData||Timetracker.timelogs.tserecno!==erecno||Timetracker.timelogs.timer.timerTime(timerTimelog)}var timelogDiv=$('[id="moncal_body"]').find("tr").find("td[date="+integerform+"]").find("#timelog_div"),calTimelogRows=timelogDiv.find(".ZPcalvw-month-wksheet").find("div[jobrowid="+timerTimelog.timelogId+"]");if(0!==calTimelogRows.length){var rowIndex=0;calTimelogRows.each(function(){var txt=Timetracker.timelogs.calendar.getTimelogRowHtmlForCalendar(timerTimelog,hours||Calendar.minstohrs(timerTimelog.hours),!1,today,rowIndex);$(this).parent().replaceWith(txt),timelogDiv.find(".ZPcalvw-month-wksheet").find("div[jobrowid="+timerTimelog.timelogId+"]").find(".ZPcalvwbox-head").attr("onclick","").off("click").on("click",function(e){e.stopPropagation();var x=$(this).offset().left,y=$(this).offset().top;Timetracker.timelogs.calendar.showViewPopup(timerTimelog,x,y)}),rowIndex++})}var calMorePopUpTimelogRows=timelogDiv.find(".ZPcalvw-morepopup").find(".ZPcalvw-morepopup-cnt").find("div[jobrowid="+timerTimelog.timelogId+"]");if(0!==calMorePopUpTimelogRows.length){var index=0;calMorePopUpTimelogRows.each(function(){var moredroptxt=Timetracker.timelogs.calendar.getTimelogRowHtmlForCalendar(timerTimelog,hours||Calendar.minstohrs(timerTimelog.hours),!0,today,index);$(this).parent().replaceWith(moredroptxt),timelogDiv.find(".ZPcalvw-morepopup").find(".ZPcalvw-morepopup-cnt").find("div[jobrowid="+timerTimelog.timelogId+"]").find(".ZPcalvwbox-head").attr("onclick","").off("click").on("click",function(e){e.stopPropagation();var x=$(this).offset().left,y=$(this).offset().top;Timetracker.timelogs.calendar.showViewPopup(timerTimelog,x,y)}),index++})}}},Timetracker.timelogs.bulkView={showDayWeekMonthLogTimeCallback:function(callId){var modal,layout=Layout.Page.container,pageMode=Timetracker.Page.getPageMode();TimetrackerOperations.Filters.isFilterOpen()&&TimetrackerOperations.Filters.toggleFilter();var bulkmodal_id=pageMode+"_timelogs_bulk_view_popup";0==layout.find("#"+bulkmodal_id).length?modal=Timetracker.timelogs.bulkView.constructBulkViewPage():(modal=layout.find("#"+bulkmodal_id),ModuleComp.Modal.show(modal));var viewMode,type,id=callId&&"string"==typeof callId?callId:this.attr("id");switch(id){case"dailylogtime":type=Timetracker.constants.DAY,viewMode=ZPCommonUtil.DateNavigator.TYPE.DAILY;break;case"weeklylogtime":type=Timetracker.constants.WEEK,viewMode=ZPCommonUtil.DateNavigator.TYPE.WEEKLY;break;case"halfmonthlylogtime":type=Timetracker.constants.HALFMONTH,viewMode=ZPCommonUtil.DateNavigator.TYPE.HALFMONTHLY;break;case"monthlylogtime":type=Timetracker.constants.MONTH,viewMode=ZPCommonUtil.DateNavigator.TYPE.MONTHLY}Timetracker.timelogs.bulkView.refreshView=!1;var userdtls=ZPeople.getUserDetailsById(Timetracker.timelogs.tserecno),userName="<em>"+userdtls.empid+" - </em><b>"+userdtls.name+"</b>";modal.find("#tl_uname").html(userName),modal.find("#tl_uimg").attr("src",ZPeople.decodeTxt(userdtls.avatar)),TimelyZComp.select.setValue(layout.find("#"+pageMode+"_logTypeSelect"),id),Timetracker.timelogs.bulkView.destroyZComponents(layout.find("#timelogs_bulk_view .zpl_rgtcnt:not(.DN)")),0==layout.find("#"+id).length&&Timetracker.timelogs.bulkView.constructTableView(id),layout.find("#timelogs_bulk_view").find(".zpl_rgtcnt").addClass("zpl_DNI"),layout.find("#timelogs_bulk_view").find("#"+id).removeClass("zpl_DNI");bulkmodal_id=pageMode+"_timelogs_bulk_view_popup";var dateNavigationDtls={};dateNavigationDtls.mode=pageMode+"_"+viewMode,dateNavigationDtls.containerId=bulkmodal_id,dateNavigationDtls.previousBtnId="goToPreviousBtn",dateNavigationDtls.nextBtnId="goToNextBtn",dateNavigationDtls.displayAreaId="dateNavigatorText",dateNavigationDtls.displayDateAsText=!0,dateNavigationDtls.navigationCallback=Timetracker.timelogs.bulkView.showDayWeekMonthLogTime,dateNavigationDtls.navigateAlertCallback=function(){return Timetracker.timelogs.bulkView.dataChangedCheck()},ZPCommonUtil.DateNavigator.init(dateNavigationDtls),ZPCommonUtil.DateNavigator.setPeriod(dateNavigationDtls.mode,viewMode,ZPCommonUtil.DateNavigator.TENSE.CURRENT),layout.find("#timelogs_bulk_view").find("#tl_datePicker").attr("mode",dateNavigationDtls.mode).attr("viewMode",viewMode).attr("type",type),layout.find("#timelogs_bulk_view").find("#tl_datePicker").off().on("click",function(event){var ele=event.target,viewMode=$(ele).attr("viewMode"),callback=Timetracker.timelogs.bulkView.validateAndNavigateCallback;viewMode==ZPCommonUtil.DateNavigator.TYPE.WEEKLY?Calendar.setUpCalendar(event,this,void 0,void 0,callback,void 0,{weekselection:!0,constructOnWeekstarts:!0}):viewMode==ZPCommonUtil.DateNavigator.TYPE.MONTHLY?Calendar.setUpCalendar(event,this,2,void 0,callback):(ZPCommonUtil.DateNavigator.TYPE.DAILY,Calendar.setUpCalendar(event,this,0,void 0,callback))}),layout.find("#timelogs_bulk_view").removeClass("zpl_DNI"),Timetracker.timelogs.bulkView.showDayWeekMonthLogTime()},validateAndNavigateCallback:function(dateVal,obj,data){if(Timetracker.timelogs.bulkView.dataChangedCheck()){let infoAlertMessage=new InfoAlertMessage("",ZPI18N.getString("zp.cancelconfmsg"));infoAlertMessage.callback=(()=>{Timetracker.timelogs.bulkView.bulkDateNavCallBack(dateVal,obj,data)}),infoAlertMessage.show()}else Timetracker.timelogs.bulkView.bulkDateNavCallBack(dateVal,obj,data)},bulkDateNavCallBack:function(dateVal,obj,data){var layout=Timetracker.Util.getLayout().find("#timelogs_bulk_view");layout.find("#tl_datePicker").html("");var viewType=layout.find("#tl_datePicker").attr("viewmode"),extraDtls={};if(viewType==ZPCommonUtil.DateNavigator.TYPE.WEEKLY)extraDtls.from=data.fromDate,extraDtls.to=data.toDate,extraDtls.type=ZPCommonUtil.DateNavigator.TYPE.WEEKLY;else if(viewType==ZPCommonUtil.DateNavigator.TYPE.DAILY)extraDtls.day=dateVal,extraDtls.type=ZPCommonUtil.DateNavigator.TYPE.DAILY;else if(viewType==ZPCommonUtil.DateNavigator.TYPE.MONTHLY){extraDtls.from=dateVal;var curyear=dateVal.getFullYear(),curmonth=dateVal.getMonth();(toVal=new Date(curyear,curmonth)).setDate(new Date(curyear,curmonth+1,0).getDate()),extraDtls.to=toVal,extraDtls.type=ZPCommonUtil.DateNavigator.TYPE.MONTHLY}else if(viewType==ZPCommonUtil.DateNavigator.TYPE.HALFMONTHLY){var toVal;if(data.selectedDay<=15)extraDtls.from=new Date(data.selectedYear,data.selectedMonth),extraDtls.to=new Date(data.selectedYear,data.selectedMonth,15);else extraDtls.from=new Date(data.selectedYear,data.selectedMonth,16),(toVal=new Date(data.selectedYear,data.selectedMonth)).setDate(new Date(data.selectedYear,data.selectedMonth+1,0).getDate()),extraDtls.to=toVal;extraDtls.type=ZPCommonUtil.DateNavigator.TYPE.HALFMONTHLY}var mode=$(obj).attr("mode");ZPCommonUtil.DateNavigator.setPeriod(mode,extraDtls.type,void 0,!1,extraDtls),Timetracker.timelogs.bulkView.showDayWeekMonthLogTime()},constructBulkViewPage:function(){Layout.Page.container;var pageMode=Timetracker.Page.getPageMode(),topHeader='<div><a class="clsArw"><i class="PI_back" onclick="Timetracker.timelogs.bulkView.checkAndCloseBulkView()" title="'+ZPI18N.getString("zp.back")+'"></i></a><div class="zpl_em"><div class="zpl_emimg"><img id="tl_uimg"></div><div class="zpl_emdts"><div id="tl_uname"></div></div></div></div><a class="_cls PI_cls" title="'+ZPI18N.getString("zp.close")+'"></a>',html='<div class="zpl_container sel_postion"><div class="zpl_iwrpr"><div class="zpl_iwrprrgt"><div class="zpl_act zpl_tblfxd" id="timelogs_bulk_view">'+('<div class="zpl_btnmnu"><div class="zpl_lft"></div><div class="zpl_cntrdv"><div class="zpl_inav"><i class="PI_alft" title="'+ZPI18N.getString("zp.previous")+'" id="goToPreviousBtn"></i><i class="PI_monthly" id="tl_datePicker"></i><i class="PI_argt" title="'+ZPI18N.getString("zp.next")+'" id="goToNextBtn"></i></div><b id="dateNavigatorText"></b></div><div class="zpl_rgt"><div><select id="'+pageMode+'_logTypeSelect"><option value="dailylogtime">'+ZPI18N.getString("zp.dailylog")+'</option><option value="weeklylogtime">'+ZPI18N.getString("zp.weeklylog")+'</option><option value="halfmonthlylogtime">'+ZPI18N.getString("zp.semimonthlylog")+'</option><option value="monthlylogtime">'+ZPI18N.getString("zp.monthlylog")+'</option></select></div><button class="zlabel zlabel--blue zlabel--outline zlabel--medium" id="clone_timelog" onclick="Timetracker.timelogs.bulkView.cloneTimeLogs(type);">'+ZPI18N.getString("zp.clone")+"</button></div></div>")+('<div class="zpl_tblpagination" id="multilog_footer"><div class="zpl_lftpgn"><div><button class="zlabel zlabel--blue zlabel--medium" id="submit_timelog" onclick="Timetracker.timelogs.bulkView.dayWeekMonthLogupdate(null, this)">'+ZPI18N.getString("zp.save")+'</button><button class="zlabel zlabel--outline zlabel--medium" id="reset_timelog" onclick="Timetracker.timelogs.bulkView.showDayWeekMonthLogTime()">'+ZPI18N.getString("zp.reset")+'</button><button class="zlabel zlabel--outline zlabel--medium" id="cancel_timelog" onclick="Timetracker.timelogs.bulkView.checkAndCloseBulkView()">'+ZPI18N.getString("zp.cancel")+'</button></div></div><div class="zpl_rhtpgn"><div class="zpl_viewdays" id="zp_tt_leave"><div class="zpl_dytyp lv_bdr5"><span>'+ZPI18N.getString("zp.unpaidleave")+'</span></div><div class="zpl_dytyp lv_bdr4"><span>'+ZPI18N.getString("zp.absent")+'</span></div><div class="zpl_dytyp lv_bdr7"><span>'+ZPI18N.getString("zp.paidleave")+'</span></div><div class="zpl_dytyp lv_bdr9"><span>'+ZPI18N.getString("zp.weekend")+'</span></div><div class="zpl_dytyp lv_bdr3"><span>'+ZPI18N.getString("zp.onduty")+'</span></div><div class="zpl_dytyp lv_bdr1"><span>'+ZPI18N.getString("zp.holiday")+"</span></div></div></div></div>")+"</div></div></div></div>",bulkmodal_id=pageMode+"_timelogs_bulk_view_popup",modal=ModuleComp.Modal.setup({id:bulkmodal_id,type:1,headerHtml:topHeader,body:html,backdrop:!0,closeOnSubmit:!1,modalClass:"zpl_mfull zpl_ttlogpop",buttonValue:ZPI18N.getString("zp.next"),closeCallback:Timetracker.timelogs.bulkView.checkAndCloseBulkView,deleteOnHide:!0,closeonEsc:!0});return TimelyZComp.select.intialize(modal.find("#"+pageMode+"_logTypeSelect")),modal.find("#"+pageMode+"_logTypeSelect").off().on("zselectchange",function(event,data){if(data.fromUI){if(Timetracker.timelogs.bulkView.dataChangedCheck()){let infoAlertMessage=new InfoAlertMessage("",ZPI18N.getString("zp.cancelconfmsg"));return infoAlertMessage.callback=(()=>{Timetracker.timelogs.bulkView.showDayWeekMonthLogTimeCallback(data.value)}),infoAlertMessage.cancelCallback=(()=>{TimelyZComp.select.setValue(data.element,data.previousValue)}),infoAlertMessage.show(),!1}Timetracker.timelogs.bulkView.showDayWeekMonthLogTimeCallback(data.value)}}),Timetracker.timelogs.bulkView.registerBulkViewEvents(modal),modal},registerBulkViewEvents:function(modalLayout,eventToRegister){0!==modalLayout.length&&modalLayout.is(":visible")&&"bulklog_add_edit"==modalLayout.attr("id")&&($(".zpopover--overley").click(function(event){0==$.find("#bulklog_add_edit").length||$(event.target).closest("#bulklog_add_edit").length||$(event.target).is("#bulklog_add_edit")||(ZPeopleComponents.popover("#bulklog_add_edit").close(),$(".zpopover--overley").remove())}),void 0!==eventToRegister&&"ENTERHRSINPUT"===eventToRegister&&$("body").off("keypress").on("keypress",function(event){var inpTarget=event.target;!$(inpTarget).hasClass("ztextbox__error")&&0!=$.find("#bulklog_add_edit").length&&13==event.keyCode&&modalLayout.find("#bulklog_submit").trigger("click")}))},checkAndCloseBulkView:function(){if(Timetracker.timelogs.bulkView.dataChangedCheck()){let infoAlertMessage=new InfoAlertMessage("",ZPI18N.getString("zp.cancelconfmsg"));infoAlertMessage.callback=(()=>{Timetracker.timelogs.bulkView.closeBulkView()}),infoAlertMessage.show()}else Timetracker.timelogs.bulkView.closeBulkView()},closeBulkView:function(isRefreshNeeded){var layout=Layout.Page.container,pageMode=Timetracker.Page.getPageMode();Timetracker.timelogs.bulkView.destroyZComponents(layout.find("#timelogs_bulk_view"));var bulkmodal_id=pageMode+"_timelogs_bulk_view_popup";ModuleComp.Modal.hide(bulkmodal_id),(isRefreshNeeded=isRefreshNeeded||Timetracker.timelogs.bulkView.refreshView)&&(Timetracker.timelogs.calendar.refreshData=!0,Timetracker.timelogs.showListView(!0))},constructTableView:function(viewType){var layout=Layout.Page.container;if(0==layout.find("#"+viewType).length){var body,pageMode=Timetracker.Page.getPageMode(),foot='<tr><td class="mw60 zpl_psticky" style="z-index: 1; left:0;" id="tfoot_tRow" colspan="4"><div class="d-flexC d-flex-btw"><div class="zpl_lnkbg zpl_drpdwn-js" name="bulkLogAddBtn" id="'+pageMode+"_"+viewType+'Btn">'+ZPI18N.getString("zp.addrow")+'</div><div class="zpl_lnkbg zpl_drpdwn-js zpl_DNI" id="bulk_log_addrow" onclick="Timetracker.timelogs.bulkView.addRowByMenuCallback()">'+ZPI18N.getString("zp.addrow")+"</div><b>"+ZPI18N.getString("zp.total")+"</b></div></td>";if(foot+='<td id="tfoot_excessRow"></td>',"dailylogtime"==viewType){foot+='<td><b id="dailylogtothrs">00:00</b></td></tr>';var dummyRow=Timetracker.timelogs.bulkView.getDummyRow("day");body='<div class="zpl_rgtcnt" id="'+viewType+'"><div class="zpl_tblres"><table class="zpl_tbl zpl_nocrsor zpl_ttbulklog"><thead id="dayheader"><tr><th class="mw60 zpl_psticky" style="z-index: 2; left:0px;">'+ZPI18N.getString("zp.sno")+'</th><th class="mw180 zpl_ellipsis zpl_psticky" style="z-index: 2; left:54px;" id="thead_dayclientselect" title="'+Timetracker.clients.formDetails.labelDetails.CLIENTNAME+'">'+Timetracker.clients.formDetails.labelDetails.CLIENTNAME+'</th><th id="thead_dayprojectselect" class="mw180 zpl_ellipsis zpl_psticky" style="z-index: 2; left:234px;" title="'+Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME+'">'+Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME+'</th><th class="mw180 zpl_ellipsis zpl_psticky" style="z-index: 2; left:414px;" title="'+Timetracker.jobs.formDetails.labelDetails.JOBNAME+'">'+Timetracker.jobs.formDetails.labelDetails.JOBNAME+'</th><th id="thead_dayworkitem" class=" mw180 zpl_ellipsis" title="'+Timetracker.util.workitemDispName+'">'+Timetracker.util.workitemDispName+'</th><th id="thead_daybillselect">'+ZPI18N.getString("zp.billablestatus")+'</th><th id="thead_daydesctxt" class="mw180 zpl_ellipsis" title="'+Timetracker.util.descriptionDispName+'">'+Timetracker.util.descriptionDispName+'</th><th id="day_hrs">'+ZPI18N.getString("zp.hours")+'</th></tr></thead><tbody id="day_viewlist"></tbody><tfoot>'+dummyRow+foot+"</tfoot></table></div></div>"}else if("weeklylogtime"==viewType){dummyRow=Timetracker.timelogs.bulkView.getDummyRow("week");body='<div class="zpl_rgtcnt" id="'+viewType+'"><div class="zpl_tblres"><table class="zpl_tbl zpl_nocrsor zpl_ttbulklog"><thead id="weekheader"><tr><th class="mw60 zpl_psticky" style="z-index: 2; left:0px;" id="weekSno">'+ZPI18N.getString("zp.sno")+'</th><th class="mw180 zpl_ellipsis zpl_psticky" style="z-index: 2; left:54px;" id="thead_weekclientselect" title="'+Timetracker.clients.formDetails.labelDetails.CLIENTNAME+'">'+Timetracker.clients.formDetails.labelDetails.CLIENTNAME+'</th><th id="thead_weekprojectselect" class="mw180 zpl_ellipsis zpl_psticky" style="z-index: 2; left:234px;" title="'+Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME+'">'+Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME+'</th><th class="mw180 zpl_ellipsis zpl_psticky" style="z-index: 2; left:414px;" title="'+Timetracker.jobs.formDetails.labelDetails.JOBNAME+'">'+Timetracker.jobs.formDetails.labelDetails.JOBNAME+'</th><th id="thead_weekworkitem" class="mw180 zpl_ellipsis" title="'+Timetracker.util.workitemDispName+'">'+Timetracker.util.workitemDispName+'</th><th class="mw60" id="thead_weekdesctxt"></th><th id="thead_weekbillselect">'+ZPI18N.getString("zp.billablestatus")+"</th>";for(var i=1;i<8;i++)body+='<th class="text-center W50" id="weekdatevalue'+i+'"></th>',foot+='<td><b id="weekdaytotal'+i+'">00:00</b></td>';foot+='<td><b id="weekdayFulltotal">00:00</b></td></tr>',body+='<th id="thead_weektotal">'+ZPI18N.getString("zp.total")+'</th></tr></thead><tbody id="week_viewlist"></tbody><tfoot>'+dummyRow+foot+"</tfoot></table></div></div>"}else if("halfmonthlylogtime"==viewType){dummyRow=Timetracker.timelogs.bulkView.getDummyRow("halfmonth");body='<div class="zpl_rgtcnt" id="'+viewType+'"><div class="zpl_tblres"><table class="zpl_tbl zpl_nocrsor zpl_ttbulklog"><thead id="halfmonthheader"><tr><th class="mw60 zpl_psticky" style="z-index: 2; left:0px;" id="halfmonthSno">'+ZPI18N.getString("zp.sno")+'</th><th class="mw180 zpl_ellipsis zpl_psticky" style="z-index: 2; left:54px;" id="thead_halfmonthclientselect" title="'+Timetracker.clients.formDetails.labelDetails.CLIENTNAME+'">'+Timetracker.clients.formDetails.labelDetails.CLIENTNAME+'</th><th id="thead_halfmonthprojectselect" class="mw180 zpl_ellipsis zpl_psticky" style="z-index: 2; left:234px;" title="'+Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME+'">'+Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME+'</th><th class="mw180 zpl_ellipsis zpl_psticky" style="z-index: 2; left:414px;" id="thead_halfmonthjobselect" title="'+Timetracker.jobs.formDetails.labelDetails.JOBNAME+'">'+Timetracker.jobs.formDetails.labelDetails.JOBNAME+'</th><th id="thead_halfmonthworkitem" class="mw180 zpl_ellipsis" title="'+Timetracker.util.workitemDispName+'">'+Timetracker.util.workitemDispName+'</th><th class="mw60" id="thead_halfmonthdesctxt"></th><th id="thead_halfmonthbillselect">'+ZPI18N.getString("zp.billablestatus")+"</th>";for(i=1;i<=16;i++)body+='<th class="text-center W50" id="halfmonthdatevalue'+i+'"></th>',foot+='<td><b id="halfmonthdaytotal'+i+'">00:00</b></td>';foot+='<td><b id="halfmonthdayFulltotal">00:00</b></td></tr>',body+='<th id="thead_halfmonthtotal">'+ZPI18N.getString("zp.total")+'</th></tr></thead><tbody id="halfmonth_viewlist"></tbody><tfoot>'+dummyRow+foot+"</tfoot></table></div></div>"}else if("monthlylogtime"==viewType){dummyRow=Timetracker.timelogs.bulkView.getDummyRow("month");body='<div class="zpl_rgtcnt" id="'+viewType+'"><div class="zpl_tblres"><table class="zpl_tbl zpl_nocrsor zpl_ttbulklog"><thead id="monthheader"><tr><th class="mw60 zpl_psticky" style="z-index: 2; left:0px;" id="monthSno">'+ZPI18N.getString("zp.sno")+'</th><th class="mw180 zpl_ellipsis zpl_psticky" style="z-index: 2; left:50px;" id="thead_monthclientselect" title="'+Timetracker.clients.formDetails.labelDetails.CLIENTNAME+'">'+Timetracker.clients.formDetails.labelDetails.CLIENTNAME+'</th><th id="thead_monthprojectselect" class="mw180 zpl_ellipsis zpl_psticky" style="z-index: 2; left:230px;" title="'+Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME+'">'+Timetracker.projects.formDetails.labelDetails.JOBSLISTNAME+'</th><th class="mw180 zpl_ellipsis zpl_psticky" style="z-index: 2; left:410px;" id="thead_monthjobselect" title="'+Timetracker.jobs.formDetails.labelDetails.JOBNAME+'">'+Timetracker.jobs.formDetails.labelDetails.JOBNAME+'</th><th id="thead_monthworkitem" class="mw180 zpl_ellipsis" title="'+Timetracker.util.workitemDispName+'">'+Timetracker.util.workitemDispName+'</th><th class="mw60" id="thead_monthdesctxt"></th><th id="thead_monthbillselect">'+ZPI18N.getString("zp.billablestatus")+"</th>";for(i=1;i<=31;i++)body+='<th class="text-center W50" id="monthdatevalue'+i+'"></th>',foot+='<td><b id="monthdaytotal'+i+'">00:00</b></td>';foot+='<td><b id="monthdayFulltotal">00:00</b></td></tr>',body+='<th id="thead_monthtotal">'+ZPI18N.getString("zp.total")+'</th></tr></thead><tbody id="month_viewlist"></tbody><tfoot>'+dummyRow+foot+"</tfoot></table></div></div>"}layout.find("#timelogs_bulk_view").append(body);var timelogType=[{id:"add_timelog_row",name:ZPI18N.getString("zp.local.TimeLog"),callback:"Timetracker.timelogs.bulkView.addRowByMenuCallback"},{id:"add_breaklog_row",name:ZPI18N.getString("zp.break"),callback:"Timetracker.timelogs.bulkView.addRowByMenuCallback"}],logSelBtnId=pageMode+"_"+viewType,bulkmodal_id=pageMode+"_timelogs_bulk_view_popup";Timetracker.Util.constructMoreOption(timelogType,logSelBtnId,null,null,{skipIcon:!0,direction:"bottom",appendTo:layout.find("#"+bulkmodal_id)})}},showDayWeekMonthLogTime:function(isPrevNext,isClone){var layout=Layout.Page.container.find("#timelogs_bulk_view"),navMode=layout.find("#tl_datePicker").attr("mode"),datePeriod=ZPCommonUtil.DateNavigator.getPeriod(navMode),viewMode=layout.find("#tl_datePicker").attr("viewMode"),type=layout.find("#tl_datePicker").attr("type");if(isClone){datePeriod="day"===type?{day:new Date(datePeriod.day.getTime())}:{from:new Date(datePeriod.from.getTime()),to:new Date(datePeriod.to.getTime())};type===Timetracker.constants.DAY?datePeriod=Calendar.getPreviousDay(datePeriod):type===Timetracker.constants.WEEK?datePeriod=Calendar.getPreviousWeek(datePeriod):type===Timetracker.constants.HALFMONTH?datePeriod=Calendar.getPreviousHalfMonth(datePeriod):type===Timetracker.constants.MONTH&&(datePeriod=Calendar.getPreviousMonth(datePeriod)),layout.find("#clone_timelog").data("datePeriod",datePeriod)}else layout.find("#"+type+"_viewlist").parent().addClass("zpl_DNI"),Timetracker.util.appendLoading(null,{divId:viewMode+"logtime"}),Timetracker.timelogs.bulkView.toSetLeftandWidth(type);switch(viewMode){case ZPCommonUtil.DateNavigator.TYPE.DAILY:type=Timetracker.constants.DAY,layout.find("#day_hrs").attr("date",Timetracker.DateTime.getDateinDBformat(datePeriod.day,!0));break;case ZPCommonUtil.DateNavigator.TYPE.WEEKLY:type=Timetracker.constants.WEEK;for(var weekStarts=new Date(datePeriod.from.getTime()),i=0;i<7;i++){var date=Timetracker.util.convertDateTo2digit(weekStarts.getDate()),wDate=Timetracker.DateTime.getDateinDBformat(weekStarts,!0);isClone?layout.find("#weekdatevalue"+(i+1)).attr("date",wDate):(layout.find("#weekdatevalue"+(i+1)).html('<div class="zpl_tloghdr"><span>'+months[weekStarts.getMonth()]+" "+date+"</span><em>"+days[weekStarts.getDay()]+"</em></div>").attr("date",wDate),layout.find('input[textinput=weeklyLog][id="daytxt'+(i+1)+'"],[id="daytimepicker'+(i+1)+'"],textarea[id="weeklydesctxt'+(i+1)+'"]').attr("actualdate",wDate),layout.find("[id='td_weekdesctxt']").find("#tabs"+(i+1)).html(months[weekStarts.getMonth()]+" "+date)),layout.find('input[textinput=weeklyLog][id="daytxt'+(i+1)+'"],[id="daytimepicker'+(i+1)+'"],textarea[id="weeklydesctxt'+(i+1)+'"],[id^="confirmBtn'+(i+1)+'"]').attr("date",wDate),weekStarts.setDate(weekStarts.getDate()+1)}break;case ZPCommonUtil.DateNavigator.TYPE.HALFMONTHLY:type=Timetracker.constants.HALFMONTH;var month=datePeriod.from.getMonth(),d=new Date(datePeriod.from.getTime()),maxDays=datePeriod.to.getDate()-datePeriod.from.getDate()+1;for(i=0;i<maxDays;i++){date=Timetracker.util.convertDateTo2digit(d.getDate(),!0),wDate=Timetracker.DateTime.getDateinDBformat(d,!0);isClone?layout.find("#halfmonthdatevalue"+(i+1)).attr("date",wDate):(layout.find("#halfmonthdatevalue"+(i+1)).html('<div class="zpl_tloghdr"><span>'+months[d.getMonth()]+" "+date+"</span><em>"+days[d.getDay()]+"</em></div>").attr("date",wDate),layout.find('input[textinput=halfmonthlyLog][id="daytxt'+(i+1)+'"],[id="daytimepicker'+(i+1)+'"],textarea[id="halfmonthlydesctxt'+(i+1)+'"]').attr("actualdate",wDate),layout.find("[id='td_halfmonthdesctxt']").find("#tabs"+(i+1)).html(months[month]+" "+date)),layout.find('input[textinput=halfmonthlyLog][id="daytxt'+(i+1)+'"],[id="daytimepicker'+(i+1)+'"],textarea[id="halfmonthlydesctxt'+(i+1)+'"],[id="confirmBtn'+(i+1)+'"]').attr("date",wDate),d.setDate(d.getDate()+1)}if(!isClone){layout.find("[id^='halfmonthdatevalue']").removeClass("zpl_DNI"),layout.find("[id^='halfmonthdaytotal']").parent().removeClass("zpl_DNI"),layout.find("input[textinput=halfmonthlyLog][id^='daytxt']").parent().parent().removeClass("zpl_DNI"),layout.find("textarea[id^='halfmonthlydesctxt']").parent().parent().removeClass("zpl_DNI"),layout.find("[id^=daytimepicker]").parent().removeClass("zpl_DNI");for(var k=maxDays;k<16;k++)layout.find("#halfmonthdatevalue"+(k+1)).addClass("zpl_DNI"),layout.find("#halfmonthdaytotal"+(k+1)).parent().addClass("zpl_DNI"),layout.find("input[textinput=halfmonthlyLog][id='daytxt"+(k+1)+"']").parent().parent().addClass("zpl_DNI"),layout.find("textarea[id^='halfmonthlydesctxt"+(k+1)+"']").parent().parent().addClass("zpl_DNI"),layout.find("[id='daytimepicker"+(k+1)+"']").parent().addClass("zpl_DNI")}break;case ZPCommonUtil.DateNavigator.TYPE.MONTHLY:type=Timetracker.constants.MONTH;month=datePeriod.from.getMonth();var year=datePeriod.from.getFullYear();for(maxDays=(d=new Date(year,month+1,0)).getDate(),i=1;i<=maxDays;i++){d.setDate(i);date=Timetracker.util.convertDateTo2digit(i),wDate=Timetracker.DateTime.getDateinDBformat(d,!0);isClone?layout.find("#monthdatevalue"+i).attr("date",wDate):(layout.find("#monthdatevalue"+i).html("<span class='DB MB3'>"+months[month]+" "+date+"</span><span class='DB gry S13 ZPregI'>"+days[d.getDay()]+"</span>").attr("date",wDate),layout.find('input[textinput=monthlyLog][id="daytxt'+i+'"],[id="daytimepicker'+i+'"],textarea[id="monthlydesctxt'+i+'"]').attr("actualdate",wDate),layout.find("[id='td_monthdesctxt']").find("#tabs"+i).html(months[month]+" "+date)),layout.find('input[textinput=monthlyLog][id="daytxt'+i+'"],[id="daytimepicker'+i+'"],textarea[id="monthlydesctxt'+i+'"],[id="confirmBtn'+i+'"]').attr("date",wDate)}if(!isClone){layout.find("[id^='monthdatevalue']").removeClass("zpl_DNI"),layout.find("[id^='monthdaytotal']").parent().removeClass("zpl_DNI"),layout.find("input[textinput=monthlyLog][id^='daytxt']").parent().parent().removeClass("zpl_DNI"),layout.find("textarea[id^='monthlydesctxt']").parent().parent().removeClass("zpl_DNI"),layout.find("[id^=daytimepicker]").parent().removeClass("zpl_DNI");for(k=maxDays;k<31;k++)layout.find("#monthdatevalue"+(k+1)).addClass("zpl_DNI"),layout.find("#monthdaytotal"+(k+1)).parent().addClass("zpl_DNI"),layout.find("input[textinput=monthlyLog][id='daytxt"+(k+1)+"']").parent().parent().addClass("zpl_DNI"),layout.find("textarea[id^='monthlydesctxt"+(k+1)+"']").parent().parent().addClass("zpl_DNI"),layout.find("[id='daytimepicker"+(k+1)+"']").parent().addClass("zpl_DNI")}}isClone||Timetracker.timelogs.bulkView.destroyZComponents(layout.find(".zpl_rgtcnt:not(.DN)")),Timetracker.timelogs.bulkView.loadLogsData(type,0,isClone)},loadLogsData:function(type,prenxt,isClone,isPopulateSchedule){var isRefresh=!isClone&&!isPopulateSchedule,fromDate=null,toDate=null,id="";type===Timetracker.constants.DAY?id="dailylogtime":type===Timetracker.constants.WEEK?id="weeklylogtime":type===Timetracker.constants.HALFMONTH?id="halfmonthlylogtime":type===Timetracker.constants.MONTH&&(id="monthlylogtime");var layout=Layout.Page.container.find("#timelogs_bulk_view");if(isClone)layout.find("#clone_timelog").addClass("disabled");else{layout.find("#clone_timelog").removeClass("disabled");var formattedType=ZPI18N.getString((type===Timetracker.constants.DAY?"zp.":"zp.s")+type);formattedType=type===Timetracker.constants.HALFMONTH?ZPI18N.getString("zp.semimonth"):formattedType,layout.find("#clone_timelog").attr("title",ZPI18N.getString("zp.clonelog",[formattedType])),TimetrackerOperations.locationjobSchedule.isLocationJobScheduleAllowed()&&layout.find("#clone_timelog").addClass("zpl_DNI")}Timetracker.timelogs.bulkView.showEditBreakRowInBulkLogs()?(layout.find("#"+id).find("#bulk_log_addrow").addClass("zpl_DNI"),layout.find("#"+id).find("[name='bulkLogAddBtn']").removeClass("zpl_DNI")):(layout.find("#"+id).find("#bulk_log_addrow").removeClass("zpl_DNI"),layout.find("#"+id).find("[name='bulkLogAddBtn']").addClass("zpl_DNI")),layout.find("#"+id).removeClass("zpl_DNI"),isRefresh&&(Timetracker.timelogs.bulkView.showEnabledDayWeekColumns(type),Layout.Page.container.find("#"+type+"_viewlist").html(""));var navMode=layout.find("#tl_datePicker").attr("mode"),datePeriod=isClone?layout.find("#clone_timelog").data("datePeriod"):ZPCommonUtil.DateNavigator.getPeriod(navMode);if(type===Timetracker.constants.DAY)isRefresh&&(layout.find("#dailylogtothrs").html("00:00"),layout.find('th[id="'+type+'_hrs"]').removeAttr("timelogpopulated")),fromDate=Calendar.formatDate(datePeriod.day),toDate=Calendar.formatDate(datePeriod.day);else if(type===Timetracker.constants.WEEK||type===Timetracker.constants.HALFMONTH||type===Timetracker.constants.MONTH){var tmpDate=datePeriod,maxDays=type===Timetracker.constants.WEEK?7:datePeriod.to.getDate()-datePeriod.from.getDate()+1;if(isRefresh){layout.find("#"+type+"dayFulltotal").html("00:00");Timetracker.generalSettings.isOnlyFromToTimeLogAllowed(Timetracker.timelogs.tserecno);for(var dayTotalObj,j=1;j<=maxDays;j++)dayTotalObj=layout.find("#"+type+"daytotal"+j),$(dayTotalObj).html("00:00");layout.find('th[id^="'+type+'datevalue"]').removeAttr("timelogpopulated")}fromDate=Calendar.formatDate(tmpDate.from),toDate=Calendar.formatDate(tmpDate.to),type!==Timetracker.constants.MONTH&&type!==Timetracker.constants.HALFMONTH&&type!==Timetracker.constants.WEEK||("1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Desc?layout.find("#"+type+"_emptd1").removeClass("zpl_DNI"):layout.find("#"+type+"_emptd1").addClass("zpl_DNI"),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Workitem?layout.find("#"+type+"_emptd2").removeClass("zpl_DNI"):layout.find("#"+type+"_emptd2").addClass("zpl_DNI"),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Billable_Show?layout.find("#"+type+"_emptd3").removeClass("zpl_DNI"):layout.find("#"+type+"_emptd3").addClass("zpl_DNI"))}var params={mode:"getTimesheet",userErecNo:Timetracker.timelogs.tserecno,requireClientDetails:!0,fromDate:fromDate,toDate:toDate,includeLeave:!0,conreqcsr:csrfToken,isFromBulk:!0},otherDetails={type:type,id:id,prenxt:prenxt,isClone:isClone,isPopulateSchedule:isPopulateSchedule};Timetracker.timelogs.currentTimelogData&&Timetracker.timelogs.currentTimelogData[fromDate+"_"+toDate]?(Timetracker.generalSettings.isBreakEnabled()&&Timetracker.timelogs.updateBrkCache(null,null,!0),Timetracker.timelogs.bulkView.loadLogsDataCallback(Timetracker.timelogs.currentTimelogData[fromDate+"_"+toDate],params,otherDetails)):(params.includeLeave=!0,0===Object.keys(Timetracker.leave.leaveTypeMap).length&&(params.leaveTypeNeeded=!0),ZPeople.Request.send(Timetracker.constants.URL,params,Timetracker.timelogs.bulkView.loadLogsDataCallback,otherDetails))},showEnabledDayWeekColumns:function(id,layout){null!==Timetracker.generalSettings.timelogEnabledFields&&(layout=layout||Layout.Page.container.find("#timelogs_bulk_view"),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients?layout.find("#thead_"+id+"clientselect,#td_"+id+"clientselect").removeClass("zpl_DNI"):layout.find("#thead_"+id+"clientselect,#td_"+id+"clientselect").addClass("zpl_DNI"),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Projects?layout.find("#thead_"+id+"projectselect,#td_"+id+"projectselect").removeClass("zpl_DNI"):layout.find("#thead_"+id+"projectselect,#td_"+id+"projectselect").addClass("zpl_DNI"),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Workitem?layout.find("#thead_"+id+"workitem,#td_"+id+"workitem").removeClass("zpl_DNI"):layout.find("#thead_"+id+"workitem,#td_"+id+"workitem").addClass("zpl_DNI"),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Desc?layout.find("#thead_"+id+"desctxt,#td_"+id+"desctxt").removeClass("zpl_DNI"):layout.find("#thead_"+id+"desctxt,#td_"+id+"desctxt").addClass("zpl_DNI"),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Billable_Show?layout.find("#thead_"+id+"billselect,#td_"+id+"billselect").removeClass("zpl_DNI"):layout.find("#thead_"+id+"billselect,#td_"+id+"billselect").hide())},checkIfCacheHasBreak:function(workDate){if(Timetracker.timelogs.breakLogsData.hasOwnProperty(workDate)){var dateBrkLogsArr=Timetracker.timelogs.breakLogsData[workDate];for(var brkitr in dateBrkLogsArr){if(dateBrkLogsArr[brkitr].hasOwnProperty("timelogId")){!0;break}}}},processBrkLogCacheData:function(resetBrkCache,resultData,isFromPopulateSch){if(resetBrkCache)Timetracker.timelogs.breakLogsData={};else if(isFromPopulateSch){if(null!=resultData&&0!==resultData.length){var breakTempCache={};for(var tlitr in resultData){if((tldata=resultData[tlitr]).hasOwnProperty("isBreakLog")&&tldata.isBreakLog){var wdate=tldata.db_workDate;if(!Timetracker.timelogs.bulkView.checkIfCacheHasBreak(wdate))if(Timetracker.timelogs.breakLogsData.hasOwnProperty(wdate)){if(breakTempCache.hasOwnProperty(wdate)){var brkTempCacheArr=breakTempCache[wdate];tldata.hasOwnProperty("jschId")&&-1===brkTempCacheArr.indexOf(tldata.jschId)&&Timetracker.timelogs.breakLogsData[wdate].push(tldata)}}else Timetracker.timelogs.breakLogsData[wdate]=[],Timetracker.timelogs.breakLogsData[wdate].push(tldata),breakTempCache[wdate]=[],breakTempCache[wdate].push(tldata.jschId)}}}}else if(null!=resultData.tsArr&&0!==resultData.tsArr.length){breakTempCache={};for(var tlitr in resultData.tsArr){var tldata;wdate=(tldata=resultData.tsArr[tlitr]).db_workDate.split(" ")[0];if(tldata.hasOwnProperty("isBreakLog")&&tldata.isBreakLog)if(Timetracker.timelogs.breakLogsData.hasOwnProperty(wdate)){if(breakTempCache.hasOwnProperty(wdate)){brkTempCacheArr=breakTempCache[wdate];if(tldata.hasOwnProperty("timelogId")&&-1===brkTempCacheArr.indexOf(tldata.timelogId))Timetracker.timelogs.breakLogsData[wdate].push(tldata)}}else Timetracker.timelogs.breakLogsData[wdate]=[],Timetracker.timelogs.breakLogsData[wdate].push(tldata),breakTempCache[wdate]=[],breakTempCache[wdate].push(tldata.timelogId)}}},loadLogsDataCallback:function(resultData,params,otherDetails){void 0===otherDetails&&(otherDetails={}),Timetracker.timelogs.currentTimelogData[params.fromDate+"_"+params.toDate]=resultData,Timetracker.generalSettings.isBreakEnabled()&&Timetracker.timelogs.bulkView.processBrkLogCacheData(!1,resultData);otherDetails.id;var type=otherDetails.type,isClone=!(!otherDetails||!0!==otherDetails.isClone),isPopulateSchedule=!(!otherDetails||!0!==otherDetails.isPopulateSchedule),timelogData=resultData.tsArr?resultData.tsArr:[],leaveData={};if(isClone){var cfromDate=null,ctoDate=null,navMode=Layout.Page.container.find("#timelogs_bulk_view").find("#tl_datePicker").attr("mode"),datePeriod=ZPCommonUtil.DateNavigator.getPeriod(navMode);type===Timetracker.constants.DAY?cfromDate=ctoDate=Calendar.formatDate(datePeriod.day):type!==Timetracker.constants.WEEK&&type!==Timetracker.constants.HALFMONTH&&type!==Timetracker.constants.MONTH||(Timetracker.timelogs.monthtmpDate=type===Timetracker.constants.MONTH||type===Timetracker.constants.HALFMONTH?datePeriod:Timetracker.timelogs.monthtmpDate,cfromDate=Calendar.formatDate(datePeriod.from),ctoDate=Calendar.formatDate(datePeriod.to));var currLeaveData=Timetracker.timelogs.currentTimelogData[cfromDate+"_"+ctoDate];leaveData=currLeaveData&&currLeaveData.leaveData&&currLeaveData.leaveData.leaveJson?currLeaveData.leaveData.leaveJson:{}}else leaveData=resultData.leaveData&&resultData.leaveData.leaveJson?resultData.leaveData.leaveJson:{};if(params.leaveTypeNeeded&&Timetracker.leave.setLeaveTypesMap(resultData.leaveData),isPopulateSchedule){var userdtls=ZPeople.getUserDetailsById(Timetracker.timelogs.tserecno);if(Timetracker.timelogs.locationJobSchedules&&Timetracker.timelogs.locationJobSchedules[userdtls.locId+params.fromDate+params.toDate]){resultData=Timetracker.timelogs.locationJobSchedules[userdtls.locId+params.fromDate+params.toDate];Timetracker.generalSettings.isBreakEnabled()&&Timetracker.timelogs.bulkView.processBrkLogCacheData(!1,resultData,!0),Timetracker.timelogs.bulkView.processLogsData(resultData,type,isClone,isPopulateSchedule).then(function(){Timetracker.timelogs.bulkView.loadLogsDataCallbackActions(params,timelogData,leaveData,otherDetails)})}else{var jobschd_params={mode:"getLocationJobSchedulesForTimelogs",assignedTo:userdtls.locId,fromDate:Timetracker.DateTime.getDateinDBformat(Calendar.parseDate(params.fromDate,uidateFormat),!0),toDate:Timetracker.DateTime.getDateinDBformat(Calendar.parseDate(params.toDate,uidateFormat),!0),conreqcsr:csrfToken};ZPeople.Request.send(Timetracker.constants.URL,jobschd_params,Timetracker.timelogs.bulkView.populateScheduleCallback,{id:type,isClone:isClone,fromDate:params.fromDate,toDate:params.toDate,leaveData:leaveData,timelogData:timelogData,params:params,otherDetails:otherDetails})}}else Timetracker.timelogs.bulkView.processLogsData(timelogData,type,isClone,isPopulateSchedule).then(function(){Timetracker.timelogs.bulkView.loadLogsDataCallbackActions(params,timelogData,leaveData,otherDetails)})},populateScheduleCallback:function(result,params,otherDetails){void 0===otherDetails&&(otherDetails={});var id=otherDetails.id,isClone=!(!otherDetails||!0!==otherDetails.isClone),resultData=[];result&&result.schedules&&(resultData=result.schedules,void 0===Timetracker.timelogs.locationJobSchedules&&(Timetracker.timelogs.locationJobSchedules={}),Timetracker.timelogs.locationJobSchedules[params.assignedTo+otherDetails.fromDate+otherDetails.toDate]=resultData,Timetracker.generalSettings.isBreakEnabled()&&Timetracker.timelogs.bulkView.processBrkLogCacheData(!1,resultData,!0)),Timetracker.timelogs.bulkView.processLogsData(resultData,id,isClone,!0),Timetracker.timelogs.bulkView.loadLogsDataCallbackActions(otherDetails.params,otherDetails.timelogData,otherDetails.leaveData,otherDetails.otherDetails)},resetTimelogForCloning:function(timelog){delete timelog.approvalId,delete timelog.approvalStatus,delete timelog.timelogId,timelog.billingStatus=0;var jobIndex=Timetracker.projects.Operations.findJSONArrayIndex(Timetracker.jobs.jobData,timelog.jobId,"jobId");return-1!==jobIndex&&Timetracker.jobs.jobData[jobIndex]&&Timetracker.jobs.jobData[jobIndex].jobBillableStatus&&(timelog.billableStatus=Timetracker.jobs.jobData[jobIndex].jobBillableStatus),timelog},processLogsData:async function(resultData,id,isClone,isPopulateSchedule){var layout=Layout.Page.container.find("#timelogs_bulk_view"),currow=layout.find("#"+id+"_viewlist").find("tr[populated=true]:last").index()+2;if(isClone||isPopulateSchedule){var ele=layout.find("#"+id+"_viewlist").find("tr").slice(currow-1);ele.find("[comp='select']").each(function(i){ZPeopleComponents.isComponent(this)&&TimelyZComp.select.destroy(this)}),ele.remove()}var isManualLogAllowed=Timetracker.generalSettings.isManualLogAllowed(Timetracker.timelogs.tserecno),isFromToTimeLogAllowed=Timetracker.generalSettings.isFromToTimeLogAllowed(Timetracker.timelogs.tserecno),isOnlyFromToTimeLogAllowed=Timetracker.generalSettings.isOnlyFromToTimeLogAllowed(Timetracker.timelogs.tserecno),defaultBillableStatus=Timetracker.generalSettings.getDefaultBillableStatus(Timetracker.timelogs.tserecno),thead=layout.find("#"+id+"header");for(var rdata of resultData){var data=$.extend(!0,{},rdata),isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",data),freezeBreakRow=isBreakLog&&(data&&data.breakInfo&&data.breakInfo.isBreakAutoDeduct||!Timetracker.timelogs.bulkView.showEditBreakRowInBulkLogs());if(isClone||isPopulateSchedule){if(!data.jobIsActive||data.jobIsCompleted||freezeBreakRow||0==data.type&&!isManualLogAllowed||1==data.type&&!isFromToTimeLogAllowed||2==data.type)return;isClone&&Timetracker.timelogs.bulkView.resetTimelogForCloning(data),isPopulateSchedule&&(void 0!==data.billableStatus&&-1!=data.billableStatus||(data.billableStatus=defaultBillableStatus))}var wrkdate=Calendar.parseDate(data.workDate,uidateFormat);if(isClone)if(id===Timetracker.constants.MONTH){if(null!==Timetracker.timelogs.monthtmpDate&&wrkdate.getDate()>Timetracker.timelogs.monthtmpDate.to.getDate())return}else if(id===Timetracker.constants.HALFMONTH){var dt=wrkdate.getDate()>15?wrkdate.getDate()-15:wrkdate.getDate();if(null!==Timetracker.timelogs.monthtmpDate&&dt>Timetracker.timelogs.monthtmpDate.to.getDate())return}var cmpdt=Timetracker.DateTime.getDateinDBformat(wrkdate,!0);if(isPopulateSchedule){if(id===Timetracker.constants.DAY?$(thead).find('th[id^="'+id+'_hrs"][date='+cmpdt+"]").attr("timelogpopulated"):$(thead).find('th[id^="'+id+'datevalue"][date='+cmpdt+"]").attr("timelogpopulated"))return;var leave=id===Timetracker.constants.DAY?$(thead).find("th[id=day_hrs][date="+cmpdt+"]").attr("leave"):$(thead).find('th[id^="'+id+'datevalue"][date='+cmpdt+"]").attr("leave"),weekend=id===Timetracker.constants.DAY?$(thead).find("th[id=day_hrs][date="+cmpdt+"]").attr("weekend"):$(thead).find('th[id^="'+id+'datevalue"][date='+cmpdt+"]").attr("weekend"),holiday=id===Timetracker.constants.DAY?$(thead).find("th[id=day_hrs][date="+cmpdt+"]").attr("holiday"):$(thead).find('th[id^="'+id+'datevalue"][date='+cmpdt+"]").attr("holiday");if(leave||holiday||weekend)return}var tr,hrs=Calendar.minstohrs(data.hours);data.projectId=void 0==data.projectId||null==data.projectId?0:data.projectId,data.clientId=void 0==data.clientId||null==data.clientId?0:data.clientId;for(var flag=0,l=1;l<currow&&id!==Timetracker.constants.DAY;l++){var tmpdata=layout.find("#"+id+"row"+l).data(),cond=1;if(cond="2"===data.type||void 0!=data.approvalStatus&&-2!=data.approvalStatus||0!=data.billingStatus?cond&&("2"===tmpdata.type||void 0!=tmpdata.approvalStatus&&-2!=tmpdata.approvalStatus||0!=tmpdata.billingStatus):cond&&!("2"===tmpdata.type||void 0!=tmpdata.approvalStatus&&-2!=tmpdata.approvalStatus||0!=tmpdata.billingStatus),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients&&(cond=cond&&tmpdata.clientId===data.clientId),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Projects&&(cond=cond&&tmpdata.projectId===data.projectId),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Workitem&&(cond=cond&&tmpdata.taskName===data.taskName),cond&&tmpdata.jobId==data.jobId&&tmpdata.billableStatus==data.billableStatus){tr=layout.find("#"+id+"_viewlist").find("#"+id+"row"+l);var td=$(tr).find("input[id^=daytxt][date="+cmpdt+"]");if($(td).parents("td").data("isPopulated"))continue;var setLogDetails=0!==$(td).length&&""===$(td).val(),showFromToTime=isOnlyFromToTimeLogAllowed,isDeleteAllowed=data.isEditAllowed&&(-2===data.approvalStatus||void 0===data.approvalStatus)&&0===data.billingStatus;if(showFromToTime&&1!=data.type&&(showFromToTime=!1,$(td).parent().removeClass("zpl_DNI"),$(tr).find("span[id^=daytimepicker][date="+cmpdt+"]").addClass("zpl_DNI")),showFromToTime&&(td=$(tr).find("span[id^=daytimepicker][date="+cmpdt+"]"),0!==$(td).length&&(setLogDetails=""===$(td).find("[id^=timepickerfrom]").val().trim()&&""===$(td).find("[id^=timepickerto]").val().trim())),setLogDetails){if(showFromToTime)$(td).find("[id^=timepickerfrom]").timepicker("setTime",data.fromTimeInTimeFormat),$(td).find("[id^=timepickerto]").timepicker("setTime",data.toTimeInTimeFormat),$(td).find("[id^=time_hours]").html(hrs),$(td).attr("oldfromtime",data.fromTime),$(td).attr("oldtotime",data.toTime),$(td).attr("logtype",1),isDeleteAllowed&&$(td).append('<i class="PI_delete" tlid="'+data.timelogId+'" onclick="Timetracker.timelogs.bulkView.deleteConfirm(this)"></i>');else{if($(td).val(hrs),$(td).attr("logtype",0),1===data.type||"1"===data.type){let title=Timetracker.util.getShiftDatebyTimeStr(data.fromTime,data.workDate,Timetracker.constants.MINUTES)+" - "+Timetracker.util.getShiftDatebyTimeStr(data.toTime,data.workDate,Timetracker.constants.MINUTES);$(td).attr("title",title),$(td).attr("interval",data.fromTime+"T"+data.toTime),isClone||isPopulateSchedule?($(td).attr("newfromtime",data.fromTime),$(td).attr("newtotime",data.toTime)):($(td).attr("oldfromtime",data.fromTime),$(td).attr("oldtotime",data.toTime)),$(td).attr("logtype",1)}isDeleteAllowed&&($(td).after('<i class="PI_delete" tlid="'+data.timelogId+'" onclick="Timetracker.timelogs.bulkView.deleteConfirm(this)"></i>'),$(td).parent().addClass("zpl_flexaligngap3"))}$(td).attr("timelogid",data.timelogId),$(td).attr("logtype",data.type),$(td).attr("billingStatus",data.billingStatus),$(td).attr("oldtime",hrs),$(td).attr("oldbill",data.billableStatus),void 0!=data.approvalId&&($(td).attr("approvalStatus",data.approvalStatus),$(td).attr("approvalid",data.approvalId),$(td).attr("oldhours",data.hours)),data.hasOwnProperty("nonoverlapHours")&&($(td).attr("nonoverlaphours",data.nonoverlapHours),0!=data.type&&data.hours>=data.nonoverlapHours&&$(td).attr("overlaphours",data.hours-data.nonoverlapHours)),data.hasOwnProperty("isBreakLog")&&($(td).attr("isBreakLog",data.isBreakLog),data.isBreakLog&&data.hasOwnProperty("jschId")&&$(td).attr("jschId",data.jschId)),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Desc&&($(tr).find('textarea[id^="'+id+'lydesctxt"][date='+cmpdt+"]").val(ZPeople.decodeTxt(data.description)),""!==ZPeople.decodeTxt(data.description).trim()&&$(tr).find("[name='descIcon']").addClass("blu"),$(tr).find('textarea[id^="'+id+'lydesctxt"][date='+cmpdt+"]").attr("title",ZPeople.decodeTxt(data.description)),$(tr).find('textarea[id^="'+id+'lydesctxt"][date='+cmpdt+"]").attr("desc",ZPeople.decodeTxt(data.description))),$(td).prop("disabled",!1).removeClass("is-disabled"),$(tr).find('textarea[id^="'+id+'lydesctxt"][date='+cmpdt+"]").prop("disabled",!1).removeClass("disabled"),$(tr).find('[id^="confirmBtn"][date="'+cmpdt+'"]').prop("disabled",!1).removeClass("disabled"),Timetracker.timelogs.bulkView.showLogInReadOnlyMode(data.approvalStatus,data.billingStatus,data.type,data.breakInfo,data.jobIsActive)&&($(td).prop("disabled",!0).addClass("is-disabled"),$(tr).find('textarea[id^="'+id+'lydesctxt"][date='+cmpdt+"]").prop("disabled",!0).addClass("disabled"),$(tr).find('[id^="confirmBtn"][date="'+cmpdt+'"]').prop("disabled",!0).addClass("disabled")),Timetracker.timelogs.bulkView.weeklyMonthlyLogHours($(td),id),$(td).parents("td").data("isPopulated",!0),flag=1;break}}}0===flag&&(isBreakLog?await Timetracker.timelogs.bulkView.addDayWeekMonthBreakRow(!1,id,isClone||isPopulateSchedule):await Timetracker.timelogs.bulkView.addDayWeekMonthRow(id,isClone||isPopulateSchedule),tr=layout.find("#"+id+"_viewlist").find("#"+id+"row"+currow),Timetracker.timelogs.bulkView.setLogsData(tr,cmpdt,hrs,data,id,isClone,isPopulateSchedule),$(tr).data(data),currow++),isPopulateSchedule||(id===Timetracker.constants.DAY?$(thead).find('th[id="'+id+'_hrs"][date='+cmpdt+"]").attr("timelogpopulated",!0):$(thead).find('th[id^="'+id+'datevalue"][date='+cmpdt+"]").attr("timelogpopulated",!0))}},loadLogsDataCallbackActions:async function(params,timelogData,leaveData,otherDetails){for(var id=otherDetails.id,type=otherDetails.type,isClone=!(!otherDetails||!0!==otherDetails.isClone),isPopulateSchedule=!(!otherDetails||!0!==otherDetails.isPopulateSchedule),isRefresh=!isClone&&!isPopulateSchedule,layout=Layout.Page.container.find("#timelogs_bulk_view"),i=layout.find("#"+type+"_viewlist").find("tr[populated=true]:last").index()+2;i<=5;i++)await Timetracker.timelogs.bulkView.addDayWeekMonthRow(type);if(isRefresh){var thead=layout.find("#"+type+"header");for(var leave in type===Timetracker.constants.DAY?$(thead).find("th[id=day_hrs]").removeAttr("leave holiday weekend"):$(thead).find('th[id^="'+type+'datevalue"]').removeAttr("leave holiday weekend"),layout.find("#"+id).find("input[date]").parents("td:not(.zpl_DNI)").removeClass(),leaveData){var day=leaveData[leave];if(day.leaves){layout.find("#"+id).find("input[date="+leave+"]").parents("td").removeClass();var leaveType=Timetracker.leave.getlTypeBasedOnPriority(day.leaves);if(Timetracker.leave.hasLeaveOnThatDay(day.leaves)){var fillerClass=Timetracker.leave.getFillerClassByLeaveType(leaveType);""!==fillerClass&&(layout.find("#"+id).find("input[date="+leave+"]").parents("td").addClass(fillerClass),type===Timetracker.constants.DAY?$(thead).find("th[id=day_hrs][date="+leave+"]").attr("leave",!0):$(thead).find('th[id^="'+type+'datevalue"][date='+leave+"]").attr("leave",!0))}else!0===day.isHoliday?(layout.find("#"+id).find("input[date="+leave+"]").parents("td").removeClass(),layout.find("#"+id).find("input[date="+leave+"]").parents("td").addClass(Timetracker.leave.getFillerClassByLeaveType(Timetracker.constants.LEAVE_TYPE.RESTRICTED_HOLIDAY)),type===Timetracker.constants.DAY?$(thead).find("th[id=day_hrs][date="+leave+"]").attr("holiday",!0):$(thead).find('th[id^="'+type+'datevalue"][date='+leave+"]").attr("holiday",!0)):!0===day.isweekend&&(layout.find("#"+id).find("input[date="+leave+"]").parents("td").removeClass(),layout.find("#"+id).find("input[date="+leave+"]").parents("td").addClass(Timetracker.leave.getFillerClassByLeaveType(Timetracker.constants.LEAVE_TYPE.WEEKEND)),type===Timetracker.constants.DAY?$(thead).find("th[id=day_hrs][date="+leave+"]").attr("weekend",!0):$(thead).find('th[id^="'+type+'datevalue"][date='+leave+"]").attr("weekend",!0))}else!0===day.isHoliday?(layout.find("#"+id).find("input[date="+leave+"]").parents("td").removeClass(),layout.find("#"+id).find("input[date="+leave+"]").parents("td").addClass(Timetracker.leave.getFillerClassByLeaveType(Timetracker.constants.LEAVE_TYPE.RESTRICTED_HOLIDAY)),type===Timetracker.constants.DAY?$(thead).find("th[id=day_hrs][date="+leave+"]").attr("holiday",!0):$(thead).find('th[id^="'+type+'datevalue"][date='+leave+"]").attr("holiday",!0)):!0===day.isweekend&&(layout.find("#"+id).find("input[date="+leave+"]").parents("td").removeClass(),layout.find("#"+id).find("input[date="+leave+"]").parents("td").addClass(Timetracker.leave.getFillerClassByLeaveType(Timetracker.constants.LEAVE_TYPE.WEEKEND)),type===Timetracker.constants.DAY?$(thead).find("th[id=day_hrs][date="+leave+"]").attr("weekend",!0):$(thead).find('th[id^="'+type+'datevalue"][date='+leave+"]").attr("weekend",!0))}}if(params.leaveTypeNeeded||""===layout.find("#"+id).find("#zp_tt_leave").html()){var leaveHtml=$("<div/>");for(var lType in Timetracker.leave.leaveTypeMap){var display_name=ZPI18N.getString(lType);ZPI18N.getString(lType)===ZPI18N.getString("zp.holiday")&&(display_name=Timetracker.leave.leaveTypeMap[lType].displayName),leaveHtml.append($('<div class="Dtyps '+Timetracker.leave.leaveTypeMap[lType].borderClass+'"><span class="LH30">'+display_name+"</span></div>"))}layout.find("#"+id).find("#zp_tt_leave").html(leaveHtml)}Timetracker.generalSettings.isFromToTimeLogAllowed(Timetracker.timelogs.tserecno)&&(Timetracker.generalSettings.isManualLogAllowed(Timetracker.timelogs.tserecno)||Timetracker.generalSettings.isAutomaticLogAllowed(Timetracker.timelogs.tserecno))||(Timetracker.generalSettings.isOnlyFromToTimeLogAllowed(Timetracker.timelogs.tserecno)?layout.find("#"+type+"_viewlist").find("[id^=timepickerfrom],[id^=timepickerto]").on("change",function(event){type===Timetracker.constants.DAY?Timetracker.timelogs.bulkView.dailylogHours($(this)):Timetracker.timelogs.bulkView.weeklyMonthlyLogHours($(this),type)}):layout.find("#"+type+"_viewlist").find("[id^=daytxt]").on("keyup",function(event){type===Timetracker.constants.DAY?Timetracker.timelogs.bulkView.dailylogHours($(this)):Timetracker.timelogs.bulkView.weeklyMonthlyLogHours($(this),type)}));var userdtls=ZPeople.getUserDetailsById(Timetracker.timelogs.tserecno),populateLocationJobSchedules=!isPopulateSchedule&&!isClone&&TimetrackerOperations.locationjobSchedule.isLocationJobScheduleAllowed()&&(Timetracker.generalSettings.isManualLogAllowed(Timetracker.timelogs.tserecno)||Timetracker.generalSettings.isFromToTimeLogAllowed(Timetracker.timelogs.tserecno))&&!ZPUtil.Validation.isEmpty(userdtls.locId);if(type===Timetracker.constants.DAY&&(populateLocationJobSchedules=populateLocationJobSchedules&&0===timelogData.length),populateLocationJobSchedules)Timetracker.timelogs.bulkView.populateLocationJobSchedules(type);else{Timetracker.util.removeLoading(),layout.find("#"+type+"_viewlist").parent().removeClass("zpl_DNI"),layout.find("#"+id).find("div.table-responsive").removeClass("zpl_DNI");var showClone=!0;if(isPopulateSchedule&&Timetracker.timelogs.locationJobSchedules&&Timetracker.timelogs.locationJobSchedules[userdtls.locId+params.fromDate+params.toDate])showClone=0===Timetracker.timelogs.locationJobSchedules[userdtls.locId+params.fromDate+params.toDate].length;showClone&&layout.find("#clone_timelog").removeClass("zpl_DNI");var visible_th=layout.find("#"+id).find("thead[staticheader=true]").find("th:visible").length,navMode=layout.find("#tl_datePicker").attr("mode"),datePeriod=ZPCommonUtil.DateNavigator.getPeriod(navMode);if(type===Timetracker.constants.DAY)layout.find("#adddailyLog_foot").attr("colspan",visible_th-2);else if(type===Timetracker.constants.WEEK||type===Timetracker.constants.HALFMONTH||type===Timetracker.constants.MONTH){0===otherDetails.prenxt&&Timetracker.util.handleHeaderForTablePositioning();var colspan=type===Timetracker.constants.WEEK?9:datePeriod.to.getDate()-datePeriod.from.getDate()+1+2;layout.find("#add"+type+"lyLog_foot").attr("colspan",visible_th-colspan)}}},showLogInReadOnlyMode:function(approvalStatus,billingStatus,logType,breakInfo,jobIsActive){return!!(void 0!=approvalStatus&&-2!=approvalStatus||0!=billingStatus||2==logType||breakInfo&&(breakInfo.isBreakAutoDeduct||!Timetracker.timelogs.bulkView.showEditBreakRowInBulkLogs())||!jobIsActive||1==logType&&!Timetracker.generalSettings.isFromToTimeLogAllowed(Timetracker.timelogs.tserecno)||0==logType&&!Timetracker.generalSettings.isManualLogAllowed(Timetracker.timelogs.tserecno))},addDayWeekMonthRow:async function(id,isClone,extaDtls){var layout=Layout.Page.container.find("#timelogs_bulk_view");id=id||layout.find("#tl_datePicker").attr("type");var isBreakLogInEditMode=!!(extaDtls=void 0==extaDtls?{}:extaDtls).isBreakLogInEditMode,isFromAdd=!!extaDtls.isFromAdd,isDelete=void 0!=(rowCount=void 0!=extaDtls.rowCount?extaDtls.rowCount:-1)&&rowCount>0,type="";id===Timetracker.constants.DAY?type="daily":id===Timetracker.constants.WEEK?type="weekly":id===Timetracker.constants.MONTH?type="monthly":id===Timetracker.constants.HALFMONTH&&(type="halfmonthly");var navMode=layout.find("#tl_datePicker").attr("mode"),datePeriod=ZPCommonUtil.DateNavigator.getPeriod(navMode),isOnlyFromToTimeLogAllowed=Timetracker.generalSettings.isOnlyFromToTimeLogAllowed(Timetracker.timelogs.tserecno),rowCount=isDelete?rowCount:layout.find("#"+id+"_viewlist").find("tr").length+1,rowHtml=layout.find("#"+type+"logtime").find("tfoot").find("#dummyRow").html();if(rowHtml=rowHtml.replaceAll("{0}",rowCount),rowHtml=$("<tr>"+rowHtml+"</tr>"),$(rowHtml).attr("id",id+"row"+rowCount),$(rowHtml).attr("rowNo",rowCount),isDelete?layout.find("#"+id+"row"+rowCount).replaceWith(rowHtml):layout.find("#"+id+"_viewlist").append(rowHtml),id===Timetracker.constants.DAY){var date=Timetracker.DateTime.getDateinDBformat(datePeriod.day,!0);$(rowHtml).find("#daytxt").attr("date",date),$(rowHtml).find("#daytxt").attr("actualdate",date),$(rowHtml).find("#daytimepicker").attr("date",date),$(rowHtml).find("#daytimepicker").attr("actualdate",date),isOnlyFromToTimeLogAllowed?($(rowHtml).find("#time_hours").html("00:00"),$(rowHtml).find("#daytimepicker").parent().removeClass("zpl_DNI"),$(rowHtml).find("#daytxt").parent().addClass("zpl_DNI")):($(rowHtml).find("#daytimepicker").addClass("zpl_DNI"),$(rowHtml).find("#daytxt").parent().removeClass("zpl_DNI"))}if(id===Timetracker.constants.WEEK||id===Timetracker.constants.HALFMONTH||id===Timetracker.constants.MONTH){$(rowHtml.find("td#rowtotal")).find("b").text("00:00");var maxDays=id===Timetracker.constants.WEEK?7:datePeriod.to.getDate()-datePeriod.from.getDate()+1;id!==Timetracker.constants.MONTH||isClone?id!==Timetracker.constants.HALFMONTH||isClone||$(rowHtml).find("#td_halfmonthdesctxt").find("[id^=tabs]").addClass("zpl_DNI"):$(rowHtml).find("#td_monthdesctxt").find("[id^=tabs]").addClass("zpl_DNI"),$(rowHtml).find("[id^=daytimepicker]").addClass("zpl_DNI"),$(rowHtml).find("[id^=daytxt]").parent().removeClass("zpl_DNI");for(var i=1;i<=maxDays;i++){var wDate=layout.find("#"+id+"datevalue"+i).attr("date");$(rowHtml).find("#daytxt"+i+",#"+id+"lydesctxt"+i,"#daytimepicker"+i,"#confirmBtn"+i).attr("date",wDate),id!==Timetracker.constants.MONTH||isClone?id!==Timetracker.constants.HALFMONTH||isClone||$(rowHtml).find("#td_halfmonthdesctxt").find("#tabs"+i).removeClass("zpl_DNI"):$(rowHtml).find("#td_monthdesctxt").find("#tabs"+i).removeClass("zpl_DNI"),isOnlyFromToTimeLogAllowed&&(i%2==1&&$(rowHtml).find("#daytimepicker"+i).parents("td").addClass("ZPlgrybg"),$(rowHtml).find("[id^=time_hours]").html("00:00"),$(rowHtml).find("#daytimepicker"+i).removeClass("zpl_DNI"),$(rowHtml).find("#daytxt"+i).parent().addClass("zpl_DNI"))}}var currentRow=layout.find("#"+id+"row"+rowCount);return Timetracker.generalSettings.isFromToTimeLogAllowed(Timetracker.timelogs.tserecno)&&(Timetracker.generalSettings.isManualLogAllowed(Timetracker.timelogs.tserecno)||Timetracker.generalSettings.isAutomaticLogAllowed(Timetracker.timelogs.tserecno))&&$(currentRow).find("[id^=daytxt]").on("click",function(event){Timetracker.timelogs.bulkView.constructBulklogAddEditPopUp(this,id,event)}),isBreakLogInEditMode&&($(currentRow).addClass("breakRow"),isFromAdd&&$(currentRow).attr("isFromAdd",!0),$(currentRow).find("#td_"+id+"workitem").find("input").addClass("zpl_DNI"),$(currentRow).find("#td_"+id+"billselect option").each(function(){$(this).html(ZPI18N.getString(Timetracker.Break.TYPE_STATUS[$(this).val()]))}),$(currentRow).find("[name='job']").on("zselectchange",function(event,data){data.fromUI&&Timetracker.timelogs.jobChange(id,this,{isBreakLog:!0,isEditMode:!0})})),$(currentRow).find("[id^=timepickerfrom],[id^=timepickerto]").timepicker({showMeridian:"hh:mm a"==timeFormat,minuteStep:1,disableMousewheel:!0,defaultTime:""}),isOnlyFromToTimeLogAllowed&&$(currentRow).find("[id^=daytimepicker]").parent().css({width:$(currentRow).find(".stend_tme").width(),"max-width":"inherit"}),id!==Timetracker.constants.WEEK&&id!==Timetracker.constants.HALFMONTH&&id!==Timetracker.constants.MONTH||($(currentRow).find("#tabs1").addClass("zpl_act"),$(currentRow).find("#tab1").addClass("zpl_act")),await Timetracker.timelogs.bulkView.addDayWeekMonthRowSelect(type+"logtime",id+"projectselect"+rowCount,id+"jobselect"+rowCount,id+"jobbillselect",type+"LogTime",id+"clientselect",id+"_viewlist",id+"row"+rowCount,isBreakLogInEditMode),currentRow},showEditBreakRowInBulkLogs:function(){return Timetracker.generalSettings.isBreakConfigured(Timetracker.timelogs.tserecno)&&Timetracker.generalSettings.isFromToTimeLogAllowed(Timetracker.timelogs.tserecno)},addDayWeekMonthBreakRow:async function(isFromAdd,id,isClone){return await Timetracker.timelogs.bulkView.addDayWeekMonthRow(id,isClone,{isBreakLogInEditMode:!0,isFromAdd:isFromAdd})},getDummyRow:function(type){var html="",descHtml=Timetracker.timelogs.bulkView.getDummyDescHtml(type);if("day"==type)html='<tr id="dummyRow" class="zpl_DNI"><td class="mw60 zpl_psticky" style="z-index: 2; left:0px;"><span id="td_sno">{0}</span></td><td class="zpl_psticky" style="z-index: 1; left:54px;" id="td_dayclientselect"><span><input class="ztextbox" name="client" id="dayclientselect{0}" style="width: 150px;" comp="select"></span></td><td class="zpl_psticky" style="z-index: 1; left:234px;" id="td_dayprojectselect"><span><input class="ztextbox" name="project" id="dayprojectselect{0}" style="width: 150px;" comp="select"></span></td><td class="zpl_psticky" style="z-index: 1; left:414px;"><span><input class="ztextbox" name="job" id="dayjobselect{0}" style="width: 150px;" comp="select"></span></td><td id="td_dayworkitem"><span><input class="ztextbox w150" textinput="dailyLog" id="dayworkitem{0}" name="workitem"></span></td><td id="td_daybillselect"><span><select id="dayjobbillselect{0}" name="bill_status" comp="select" style="width: 120px;"><option value="0">'+ZPI18N.getString("zp.billable")+'</option><option value="1">'+ZPI18N.getString("zp.nonbillable")+'</option></select></span></td><td id="td_daydesctxt"><span><input type="text" textinput="dailyLog" class="ztextbox w200" id="daydesctxt" placeholder="'+ZPI18N.getString("zp.enterentity",[Timetracker.util.descriptionDispName])+'"></span></td><td><span><input type="text" class="ztextbox w80" placeholder="00:00" textinput="dailyLog" id="daytxt"></span><span class="d-flexC flexclmcap" id="daytimepicker"><input type="text" class="ztextbox w80" placeholder="00:00" id="timepickerfrom"><em>-</em><input type="text" class="ztextbox w80" placeholder="00:00" id="timepickerto"><span><b id="time_hours">00:00</b></span></span></td></tr>';else if("week"==type){html='<tr id="dummyRow" class="zpl_DNI"><td class="mw60 zpl_psticky" style="z-index: 2; left:0px;"><span id="td_sno">{0}</span></td><td class="zpl_psticky" style="z-index: 1; left:54px;" id="td_weekclientselect"><span><input class="ztextbox" name="client" id="weekclientselect{0}" style="width: 150px;" comp="select"></span></td><td class="zpl_psticky" style="z-index: 1; left:234px;" id="td_weekprojectselect"><span><input class="ztextbox" name="project" id="weekprojectselect{0}" style="width: 150px;" comp="select"></span></td><td class="zpl_psticky" style="z-index: 1; left:414px;"><span><input class="ztextbox" name="job" id="weekjobselect{0}" style="width: 150px;" comp="select"></span></td><td id="td_weekworkitem"><span><input class="ztextbox w150" textinput="weeklyLog" id="weekworkitem{0}" name="workitem"></span></td><td id="td_weekdesctxt"><div class="zpl_hvr zpl_hvrsw"><i class="PI_note" id="'+type+'_icon_descPopup{0}" onclick="Timetracker.timelogs.bulkView.showHideDescPopup(this)" name="descIcon" title="'+Timetracker.util.descriptionDispName+'"></i></div>'+descHtml+'</td><td id="td_weekbillselect"><span><select id="weekjobbillselect{0}" name="bill_status" comp="select" style="width: 120px;"><option value="0">'+ZPI18N.getString("zp.billable")+'</option><option value="1">'+ZPI18N.getString("zp.nonbillable")+"</option></select></span></td>";for(var i=1;i<=7;i++)html+='<td><span class="d-flexC flexclmcap" id="daytimepicker'+i+'"><input type="text" class="ztextbox w80" placeholder="00:00" id="timepickerfrom'+i+'"><em>-</em><input type="text" class="ztextbox w80" placeholder="00:00" id="timepickerto'+i+'"><span><b id="time_hours_'+i+'">00:00</b></span></span>',html+='<span><input type="text" class="ztextbox w80" placeholder="00:00" id="daytxt'+i+'" textinput="weeklyLog"></span></td>';html+='<td id="rowtotal"><b>00:00</b></td></tr>'}else if("halfmonth"==type){html='<tr id="dummyRow" class="zpl_DNI"><td class="mw60 zpl_psticky" style="z-index: 2; left:0px;"><span id="td_sno">{0}</span></td><td class="zpl_psticky" style="z-index: 1; left:54px;" id="td_halfmonthclientselect"><span><input class="ztextbox" name="client" id="halfmonthclientselect{0}" style="width: 150px;" comp="select"></span></td><td class="zpl_psticky" style="z-index: 1; left:234px;" id="td_halfmonthprojectselect"><span><input class="ztextbox" name="project" id="halfmonthprojectselect{0}" style="width: 150px;" comp="select"></span></td><td class="zpl_psticky" style="z-index: 1; left:414px;"><span><input class="ztextbox" name="job" id="halfmonthjobselect{0}" style="width: 150px;" comp="select"></span></td><td id="td_halfmonthworkitem"><span><input class="ztextbox w150" textinput="halfmonthlyLog" id="halfmonthworkitem{0}" name="workitem"></span></td><td id="td_halfmonthdesctxt"><div class="zpl_hvr zpl_hvrsw"><i class="PI_note" id="'+type+'_icon_descPopup{0}" onclick="Timetracker.timelogs.bulkView.showHideDescPopup(this)" name="descIcon" title="'+Timetracker.util.descriptionDispName+'"></i></div>'+descHtml+'</td><td id="td_halfmonthbillselect"><span><select id="halfmonthjobbillselect{0}" name="bill_status" comp="select" style="width: 120px;"><option value="0">'+ZPI18N.getString("zp.billable")+'</option><option value="1">'+ZPI18N.getString("zp.nonbillable")+"</option></select></span></td>";for(i=1;i<=16;i++)html+='<td><span class="d-flexC flexclmcap" id="daytimepicker'+i+'"><input type="text" class="ztextbox w80" placeholder="00:00" id="timepickerfrom'+i+'"><em>-</em><input type="text" class="ztextbox w80" placeholder="00:00" id="timepickerto'+i+'"><span><b id="time_hours_'+i+'">00:00</b></span></span>',html+='<span><input type="text" class="ztextbox w80" placeholder="00:00" id="daytxt'+i+'" textinput="halfmonthlyLog"></span></td>';html+='<td id="rowtotal"><b>00:00</b></td></tr>'}else if("month"==type){html='<tr id="dummyRow" class="zpl_DNI"><td class="mw60 zpl_psticky" style="z-index: 2; left:0px;"><span id="td_sno">{0}</span></td><td class="zpl_psticky" style="z-index: 1; left:50px;" id="td_monthclientselect"><span><input class="ztextbox" name="client" id="monthclientselect{0}" style="width: 150px;" comp="select"></span></td><td class="zpl_psticky" style="z-index: 1; left:230px;" id="td_monthprojectselect"><span><input class="ztextbox" name="project" id="monthprojectselect{0}" style="width: 150px;" comp="select"></span></td><td class="zpl_psticky" style="z-index: 1; left:410px;"><span><input class="ztextbox" name="job" id="monthjobselect{0}" style="width: 150px;" comp="select"></span></td><td id="td_monthworkitem"><span><input class="ztextbox w150" textinput="monthlyLog" id="monthworkitem{0}" name="workitem"></span></td><td id="td_monthdesctxt"><div class="zpl_hvr zpl_hvrsw"><i class="PI_note" id="'+type+'_icon_descPopup{0}" onclick="Timetracker.timelogs.bulkView.showHideDescPopup(this)" name="descIcon" title="'+Timetracker.util.descriptionDispName+'"></i></div>'+descHtml+'</td><td id="td_monthbillselect"><span><select id="monthjobbillselect{0}" name="bill_status" comp="select" style="width: 120px;"><option value="0">'+ZPI18N.getString("zp.billable")+'</option><option value="1">'+ZPI18N.getString("zp.nonbillable")+"</option></select></span></td>";for(i=1;i<=31;i++)html+='<td><span class="d-flexC flexclmcap" id="daytimepicker'+i+'"><input type="text" class="ztextbox w80" placeholder="00:00" id="timepickerfrom'+i+'"><em>-</em><input type="text" class="ztextbox w80" placeholder="00:00" id="timepickerto'+i+'"><span><b id="time_hours_'+i+'">00:00</b></span></span>',html+='<span><input type="text" class="ztextbox w80" placeholder="00:00" id="daytxt'+i+'" textinput="monthlyLog"></span></td>';html+='<td id="rowtotal"><b>00:00</b></td></tr>'}return html},getDummyDescHtml:function(type){if("day"==type)return"0";for(var repCount="week"==type?7:"halfmonth"==type?16:"month"==type?31:0,descId=type+"lydesctxt",html='<div class="zpl_popovr DB zpopover" aria-haspopup="true" aria-expanded="false" name="descPopup" id="'+type+'_descPopup{0}" style="display: none;"><div class="zpopover__content"><div class="zpl_tbvrt"><ul class="zpl_lftnav">',i=1;i<=repCount;i++)html+=' <li id="tabs'+i+'" rowNo="'+i+'" onclick="Timetracker.timelogs.bulkView.weekMonthDescSelectDate(this, \''+i+"');\"></li>";html+='</ul><div class="zpl_rgtlst">';for(i=1;i<=repCount;i++)html+='<div class="zpl_tbpne" id="tab'+i+'"><div class="zpl_lstgrp"><textarea rows="10" class="ztextbox wd100_per" name="descText" placeholder="'+ZPI18N.getString("zp.enterentity",[Timetracker.util.descriptionDispName])+'" id="'+descId+i+'"></textarea></div><div class="zpl_list_btm zpl_whtbg"><div><div id="confirmBtn'+i+'" class="zlabel zlabel--blue zlabel--small" onclick="Timetracker.timelogs.bulkView.weekMonthDescSubmit(\''+type+"', this);\">"+ZPI18N.getString("zp.confirm")+"</div></div></div></div>";return html+="</div></div></div></div>"},destroyZComponents:function(layout,id){layout=void 0!=layout?layout:Layout.Page.container,void 0!=id&&(layout=Layout.Page.container.find("#"+id)),layout.find("input, select").each(function(i){ZPeopleComponents.isComponent(this)&&TimelyZComp.select.destroy(this)});var addbtn=layout.find('[name="bulkLogAddBtn"]');ZPeopleComponents.isComponent(addbtn)&&(addbtn.attr("id"),ZPeopleComponents.menu("#"+addbtn.attr("id")).destroy())},addDayWeekMonthRowSelect:async function(containerId,projectId,jobId,billingId,operation,clientId,tbodyId,rowId,isBreakLog){var rowObj=Layout.Page.container.find("#"+containerId).find("#"+tbodyId).find("[id^='"+rowId+"']:last");if(!0===isBreakLog)Timetracker.jobs.Filters.createJobSelect(Timetracker.timelogs.tserecno,null,operation,$(rowObj).find("#"+projectId),void 0,Timetracker.constants.TTCustomAdmin.EntryView,{isBreakLog:!0});else{if("1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients&&Timetracker.clients.getClients(clientId,"0",$(rowObj).find("[name='client']"),!1,Timetracker.timelogs.tserecno,Timetracker.constants.TTCustomAdmin.EntryView,{isBulkView:!0}),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Projects){var cId=TimelyZComp.select.getValue($(rowObj).find("[name='client']"));await Timetracker.projects.Filters.createProjectSelect(!0,Timetracker.timelogs.tserecno,cId,operation,null,$(rowObj).find("[name='project']"),void 0,Timetracker.constants.TTCustomAdmin.EntryView,{isBulkView:!0})}else await Timetracker.jobs.Filters.createJobSelect(Timetracker.timelogs.tserecno,"0",operation,$(rowObj).find("[name='project']"),void 0,Timetracker.constants.TTCustomAdmin.EntryView,{isBulkView:!0});var clientSel=$(rowObj).find("[name='client']"),projSel=$(rowObj).find("[name='project']"),jobSel=$(rowObj).find("[name='job']");clientSel.off("zselectchange").on("zselectchange",function(event,data){data.fromUI&&(Timetracker.projects.Filters.createProjectSelect(!0,Timetracker.timelogs.tserecno,data.selectedValue,operation,null,projSel,null,null,{isV5:!0,isBulkView:!0}),Timetracker.jobs.Filters.gettitle(clientSel.attr("id"),clientSel.closest("tr").attr("id")))}),projSel.off("zselectchange").on("zselectchange",function(event,data){if(data.fromUI){var cltid=TimetrackerOperations.Filters.getSelectFilterValues(clientSel);data.selectedValue;Timetracker.jobs.Filters.createJobSelect(Timetracker.timelogs.tserecno,"0",operation,projSel,cltid,null,{isV5:!0,isBulkView:!0}),Timetracker.jobs.Filters.gettitle(projSel.attr("id"),projSel.closest("tr").attr("id"))}}),jobSel.off("zselectchange").on("zselectchange",function(event,data){data.fromUI&&Timetracker.timelogs.jobChange(rowId,jobSel,{isBulkView:!0})})}var billingVal=null!==Timetracker.util.defaultbillingType?Timetracker.util.defaultbillingType:"0";if(TimelyZComp.select.intialize($(rowObj).find("[name='bill_status']"),{dropdownList:{appendTo:Layout.Page.container.find("#timelogs_bulk_view"),className:"zpl_z-0"}}),TimelyZComp.select.setValue($(rowObj).find("[name='bill_status']"),billingVal),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Desc){var type="";rowId.indexOf(Timetracker.constants.WEEK)>=0?type=Timetracker.constants.WEEK:rowId.indexOf(Timetracker.constants.HALFMONTH)>=0?type=Timetracker.constants.HALFMONTH:rowId.indexOf(Timetracker.constants.MONTH)>=0&&(type=Timetracker.constants.MONTH),$(rowObj).find("#"+type+"DescIcon").attr("title",ZPeople.decodeTxt(Timetracker.util.descriptionDispName))}if(!0===isBreakLog){var tempObj=$(rowObj).find("[name='client']");TimelyZComp.select.destroy(tempObj),$(tempObj).parents("td").html("");tempObj=$(rowObj).find("[name='project']");TimelyZComp.select.destroy(tempObj),$(tempObj).parents("td").html("")}else Timetracker.timelogs.bulkView.applyDropDownForWorkitemInit(rowId,rowObj)},applyDropDownForWorkitemInit:function(id,rowObj){var extraJson={};void 0!==id&&(id=Layout.Page.container.find("#timelogs_bulk_view").find("#tl_datePicker").attr("type"));var jobId=TimelyZComp.select.getValue($(rowObj).find("[name='job']"));extraJson.jobId=void 0!==jobId?jobId:"0",extraJson.elementId=$(rowObj).find("[name='workitem']").attr("id"),extraJson.layout=$(rowObj).find("#"+extraJson.elementId),extraJson.containerId=$(rowObj).attr("id"),extraJson.isBulkType=!0,Timetracker.timelogs.workItem.checkIfDropDownNeededForWorkitem(extraJson)&&($(rowObj).find("[name='workitem']").attr("comp","select"),Timetracker.timelogs.workItem.createDropdownForWorkitem(extraJson))},applyDropDownWorkitemAfterDataLoad:function(data,rowId){var extraJson={},layout=Layout.Page.container.find("#timelogs_bulk_view"),containerId=rowId,elementId=layout.find("#"+containerId).find("[name='workitem']").attr("id"),jobId="0";data.hasOwnProperty("jobId")&&(jobId=data.jobId),data.hasOwnProperty("taskName")&&""!==data.taskName&&(extraJson.toAppendOption=data.taskName),extraJson.layout=layout.find("#"+containerId).find("#"+elementId),extraJson.elementId=elementId,extraJson.containerId=containerId,extraJson.jobId=jobId,extraJson.isJobWorkItemsExist=data.isJobWorkItemsExist,extraJson.isBulkType=!0,Timetracker.timelogs.workItem.checkIfDropDownNeededForWorkitem(extraJson)&&(layout.find("#"+containerId).find("[name='workitem']").attr("comp","select"),Timetracker.timelogs.workItem.createDropdownForWorkitem(extraJson))},setLogsData:function(tr,cmpdt,hrs,tLog,id,isClone,isPopulateSchedule){var isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",tLog),freezeBreakRow=isBreakLog&&(tLog&&tLog.breakInfo&&tLog.breakInfo.isBreakAutoDeduct||!Timetracker.timelogs.bulkView.showEditBreakRowInBulkLogs()),isOnlyFromToTimeLogAllowed=Timetracker.generalSettings.isOnlyFromToTimeLogAllowed(Timetracker.timelogs.tserecno),isDeleteAllowed=tLog.isEditAllowed&&(-2===tLog.approvalStatus||void 0===tLog.approvalStatus)&&0===tLog.billingStatus,otherdetails={isNewKey:!0,allowAll:!0,isV5:!0};isBreakLog&&(otherdetails.isBreakLog=!0),Timetracker.timelogs.setValuesInSelectInput(tLog,null,$(tr).attr("id"),null,otherdetails);id===Timetracker.constants.DAY||id===Timetracker.constants.WEEK||id===Timetracker.constants.MONTH||Timetracker.constants.HALFMONTH;$(tr).attr("populated",!0),$(tr).attr("orgTaskName",tLog.taskName),$(tr).attr("oldBillableStat",tLog.billableStatus),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Workitem&&$(tr).find("[name='workitem']").val(ZPeople.decodeTxt(tLog.taskName)),tLog.taskName&&""!==tLog.taskName&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Workitem&&$(tr).find("[name='workitem']").attr("title",ZPeople.decodeTxt(tLog.taskName)),isBreakLog||Timetracker.timelogs.bulkView.applyDropDownWorkitemAfterDataLoad(tLog,$(tr).attr("id"));var disabled=!1,billableStatus=tLog.billableStatus,jobBillableStatus=tLog.hasOwnProperty("jobBillableStatus")&&null!==tLog.jobBillableStatus?tLog.jobBillableStatus:null;if(id===Timetracker.constants.WEEK||id===Timetracker.constants.HALFMONTH||id===Timetracker.constants.MONTH){var oldjobid=tLog.jobId;$(tr).find("[name='job']").attr("oldjobid",oldjobid);var td=$(tr).find("input[id^=daytxt][date="+cmpdt+"]"),setLogDetails=0!==$(td).length&&""===$(td).val();if((showFromToTime=isOnlyFromToTimeLogAllowed)&&1!=tLog.type&&(showFromToTime=!1,$(td).parent().removeClass("zpl_DNI"),$(tr).find("span[id^=daytimepicker][date="+cmpdt+"]").addClass("zpl_DNI")),showFromToTime&&(td=$(tr).find("span[id^=daytimepicker][date="+cmpdt+"]"),0!==$(td).length&&(setLogDetails=""===$(td).find("[id^=timepickerfrom]").val().trim()&&""===$(td).find("[id^=timepickerto]").val().trim())),setLogDetails){if(showFromToTime)$(td).find("[id^=timepickerfrom]").timepicker("setTime",tLog.fromTimeInTimeFormat),$(td).find("[id^=timepickerto]").timepicker("setTime",tLog.toTimeInTimeFormat),$(td).find("[id^=time_hours]").html(hrs),$(td).attr("oldfromtime",tLog.fromTime),$(td).attr("oldtotime",tLog.toTime),$(td).attr("logtype",1),isDeleteAllowed&&$(td).append('<i class="PI_delete" tlId="'+tLog.timelogId+'" onclick="Timetracker.timelogs.bulkView.deleteConfirm(this)"></i>');else{if($(td).val(hrs),$(td).attr("logtype",0),1===tLog.type||"1"===tLog.type){let title=Timetracker.util.getShiftDatebyTimeStr(tLog.fromTime,tLog.workDate,Timetracker.constants.MINUTES)+" - "+Timetracker.util.getShiftDatebyTimeStr(tLog.toTime,tLog.workDate,Timetracker.constants.MINUTES);$(td).attr("title",title),$(td).attr("interval",tLog.fromTime+"T"+tLog.toTime),isClone||isPopulateSchedule?($(td).attr("newfromtime",tLog.fromTime),$(td).attr("newtotime",tLog.toTime)):($(td).attr("oldfromtime",tLog.fromTime),$(td).attr("oldtotime",tLog.toTime)),$(td).attr("logtype",1)}isDeleteAllowed&&($(td).after('<i class="PI_delete" tlId="'+tLog.timelogId+'" onclick="Timetracker.timelogs.bulkView.deleteConfirm(this)"></i>'),$(td).parent().addClass("zpl_flexaligngap3"))}$(td).attr("timelogid",tLog.timelogId),$(td).attr("logtype",tLog.type),$(td).attr("billingStatus",tLog.billingStatus),$(td).attr("oldtime",hrs),$(td).attr("oldbill",tLog.billableStatus),void 0!=tLog.approvalId&&($(td).attr("approvalStatus",tLog.approvalStatus),$(td).attr("approvalid",tLog.approvalId),$(td).attr("oldhours",tLog.hours)),tLog.hasOwnProperty("nonoverlapHours")&&($(td).attr("nonoverlaphours",tLog.nonoverlapHours),0!=tLog.type&&tLog.hours>=tLog.nonoverlapHours&&$(td).attr("overlaphours",tLog.hours-tLog.nonoverlapHours)),tLog.hasOwnProperty("isBreakLog")&&($(td).attr("isBreakLog",tLog.isBreakLog),tLog.isBreakLog&&tLog.hasOwnProperty("jschId")&&$(td).attr("jschId",tLog.jschId)),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Desc&&($(tr).find('textarea[id^="'+id+'lydesctxt"][date='+cmpdt+"]").val(ZPeople.decodeTxt(tLog.description)),$(tr).find('textarea[id^="'+id+'lydesctxt"][date='+cmpdt+"]").attr("title",ZPeople.decodeTxt(tLog.description)),$(tr).find('textarea[id^="'+id+'lydesctxt"][date='+cmpdt+"]").attr("desc",ZPeople.decodeTxt(tLog.description)),""!==ZPeople.decodeTxt(tLog.description).trim()&&$(tr).find("[name='descIcon']").addClass("blu")),$(td).prop("disabled",!1),tLog.hasOwnProperty("jobBillableStatus")&&null!==tLog.jobBillableStatus&&("disable",disabled=!0),Timetracker.timelogs.bulkView.weeklyMonthlyLogHours($(td),id),$(td).parents("td").data("isPopulated",!0)}}else if(id===Timetracker.constants.DAY){var showFromToTime;oldjobid=tLog.jobId;if($(tr).find("[name='job']").attr("oldjobid",oldjobid),$(tr).attr("timelogid",tLog.timelogId),$(tr).attr("logtype",tLog.type),$(tr).attr("billingStatus",tLog.billingStatus),$(tr).attr("oldtime",hrs),$(tr).attr("oldbill",tLog.billableStatus),void 0!=tLog.approvalId&&($(tr).attr("approvalStatus",tLog.approvalStatus),$(tr).attr("approvalid",tLog.approvalId),$(tr).attr("oldhours",tLog.hours)),tLog.hasOwnProperty("nonoverlapHours")&&($(tr).attr("nonoverlaphours",tLog.nonoverlapHours),0!=tLog.type&&tLog.hours>=tLog.nonoverlapHours&&$(tr).attr("overlaphours",tLog.hours-tLog.nonoverlapHours)),tLog.hasOwnProperty("isBreakLog")&&($(tr).attr("isBreakLog",tLog.isBreakLog),tLog.isBreakLog&&tLog.hasOwnProperty("jschId")&&$(tr).attr("jschId",tLog.jschId)),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Desc&&(isBreakLog&&!Timetracker.timelogs.bulkView.showEditBreakRowInBulkLogs()?$(tr).find("#daydesctxt").html(tLog.description):($(tr).find("#daydesctxt").val(ZPeople.decodeTxt(tLog.description)),$(tr).find("#daydesctxt").attr("description",ZPeople.decodeTxt(tLog.description)))),(showFromToTime=isOnlyFromToTimeLogAllowed)&&1!=tLog.type&&(showFromToTime=!1,$(tr).find("#daytxt").parent().removeClass("zpl_DNI"),$(tr).find("[id^=daytimepicker]").addClass("zpl_DNI")),showFromToTime)$(tr).find("[id^=timepickerfrom]").timepicker("setTime",tLog.fromTimeInTimeFormat),$(tr).find("[id^=timepickerto]").timepicker("setTime",tLog.toTimeInTimeFormat),$(tr).find("[id^=time_hours]").html(hrs),$(tr).attr("oldfromtime",tLog.fromTime),$(tr).attr("oldtotime",tLog.toTime),$(tr).attr("logtype",1),isDeleteAllowed&&$(tr).find("[id^=daytimepicker]").append('<i class="PI_delete" tlId="'+tLog.timelogId+'" onclick="Timetracker.timelogs.bulkView.deleteConfirm(this)"></i>');else{if($(tr).find("#daytxt").val(hrs),$(tr).attr("logtype",tLog.type),1===tLog.type||"1"===tLog.type){let title=Timetracker.util.getShiftDatebyTimeStr(tLog.fromTime,tLog.workDate,Timetracker.constants.MINUTES)+" - "+Timetracker.util.getShiftDatebyTimeStr(tLog.toTime,tLog.workDate,Timetracker.constants.MINUTES);$(tr).find("#daytxt").attr("title",title),$(tr).find("#daytxt").attr("interval",tLog.fromTime+"T"+tLog.toTime),isClone||isPopulateSchedule?($(tr).attr("newfromtime",tLog.fromTime),$(tr).attr("newtotime",tLog.toTime)):($(tr).attr("oldfromtime",tLog.fromTime),$(tr).attr("oldtotime",tLog.toTime)),$(tr).attr("logtype",1)}isDeleteAllowed&&($(tr).find("#daytxt").after('<i class="PI_delete" tlId="'+tLog.timelogId+'" onclick="Timetracker.timelogs.bulkView.deleteConfirm(this)"></i>'),$(tr).find("#daytxt").parent().addClass("zpl_flexaligngap3"))}tLog.description&&""!==tLog.description&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Desc&&$(tr).find("#daydesctxt").attr("title",ZPeople.decodeTxt(tLog.description)),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Workitem&&$(tr).find("#dayworkitem").val(ZPeople.decodeTxt(tLog.taskName)),tLog.hasOwnProperty("jobBillableStatus")&&null!==tLog.jobBillableStatus&&("disable",disabled=!0),$(tr).attr("billableStatus",billableStatus),isOnlyFromToTimeLogAllowed?dr=$(tr).find("[id^=daytimepicker]"):(dr=$(tr).find("#daytxt"),dr.value=$(dr).val()),Timetracker.timelogs.bulkView.dailylogHours(dr)}isBreakLog&&!Timetracker.timelogs.bulkView.showEditBreakRowInBulkLogs()?$(tr).find("#td_"+id+"billselect").find("#billselect").html(ZPI18N.getString(Timetracker.Break.TYPE_STATUS[""+billableStatus])):(TimelyZComp.select.setValue($(tr).find("[name='bill_status']"),billableStatus),null!==jobBillableStatus&&jobBillableStatus==billableStatus&&TimelyZComp.select.setAttributes($(tr).find("[name='bill_status']"),{disabled:disabled})),Timetracker.timelogs.bulkView.showLogInReadOnlyMode(tLog.approvalStatus,tLog.billingStatus,tLog.type,tLog.breakInfo,tLog.jobIsActive)&&(id===Timetracker.constants.WEEK||id===Timetracker.constants.HALFMONTH||id===Timetracker.constants.MONTH?($(td).prop("disabled",!0),$(td).addClass("is-disabled")):id===Timetracker.constants.DAY&&($(tr).find("#daytxt,#timepickerfrom,#timepickerto").prop("disabled",!0),$(tr).find("#daytxt").addClass("is-disabled"),$(tr).find("#timepickerfrom,#timepickerto").addClass("disabled"))),(tLog.jobIsCompleted||freezeBreakRow)&&id!=Timetracker.constants.DAY&&($(tr).find("[id^=daytxt]:not(#"+$(td).attr("id")+")").prop("disabled",!0).addClass("is-disabled"),$(tr).find("[id^=timepickerfrom]:not(#"+$(td).attr("id")+")").prop("disabled",!0).addClass("disabled"),$(tr).find("[id^=timepickerto]:not(#"+$(td).attr("id")+")").prop("disabled",!0).addClass("disabled"),$(tr).find('textarea[id^="'+id+'lydesctxt"]:not(textarea[id^="'+id+'lydesctxt"][date="'+cmpdt+'"])').prop("disabled",!0).addClass("disabled"),$(tr).find('[id^="confirmBtn"]:not([id^="confirmBtn"][date="'+cmpdt+'"])').prop("disabled",!0).addClass("disabled")),tLog.jobIsActive&&!freezeBreakRow||($(tr).find("[id^=daytxt]").prop("disabled",!0).addClass("is-disabled"),$(tr).find("[id^=timepickerfrom][id^=timepickerto]").prop("disabled",!0).addClass("disabled"),$(tr).find('textarea[id^="'+id+'lydesctxt"][date="'+cmpdt+'"]').prop("disabled",!0).addClass("disabled"),$(tr).find('[id^="confirmBtn"][date="'+cmpdt+'"]').prop("disabled",!0).addClass("disabled"),TimelyZComp.select.setAttributes($(tr).find("[name='bill_status']"),{disabled:"disabled"}),ZPeopleComponents.isComponent($(tr).find("[name='workitem']"))?TimelyZComp.select.setAttributes($(tr).find("[name='workitem']"),{disabled:"disabled"}):$(tr).find("[name='workitem']").prop("disabled",!0).addClass("disabled")),(void 0!=tLog.approvalStatus&&-2!=tLog.approvalStatus||0!=tLog.billingStatus||2==tLog.type||freezeBreakRow)&&(TimelyZComp.select.setAttributes($(tr).find("[name='job']"),{disabled:!0}),Timetracker.jobs.Filters.gettitle($(tr).find("[name='job']").attr("id"),$(tr).attr("id")),TimelyZComp.select.setAttributes($(tr).find("[name='project']"),{disabled:!0}),Timetracker.jobs.Filters.gettitle($(tr).find("[name='project']").attr("id"),$(tr).attr("id")),TimelyZComp.select.setAttributes($(tr).find("[name='client']"),{disabled:!0}),Timetracker.jobs.Filters.gettitle($(tr).find("[name='client']").attr("id"),$(tr).attr("id")),TimelyZComp.select.setAttributes($(tr).find("[name='bill_status']"),{disabled:!0}),$(tr).find('#daydesctxt,textarea[id^="'+id+'lydesctxt"][date="'+cmpdt+'"]').prop("disabled",!0).addClass("disabled"),$(tr).find('[id^="confirmBtn"][date="'+cmpdt+'"]').prop("disabled",!0).addClass("disabled"),ZPeopleComponents.isComponent($(tr).find("[name='workitem']"))?(TimelyZComp.select.setAttributes($(tr).find("[name='workitem']"),{disabled:!0}),Timetracker.jobs.Filters.gettitle($(tr).find("[name='workitem']").attr("id"),$(tr).attr("id"),!1)):$(tr).find("[name='workitem']").prop("disabled",!0).addClass("disabled"))},dailylogHours:function(obj){var isOnlyFromToTimeLogAllowed=Timetracker.generalSettings.isOnlyFromToTimeLogAllowed(Timetracker.timelogs.tserecno);if(!isOnlyFromToTimeLogAllowed&&(Timetracker.util.removeErrorMsg("dailylogtime"),void 0!=obj&&"."===obj.value))return!1;void 0!=obj&&""===obj.value&&($(obj).attr("title",""),$(obj).attr("interval",""));var logRows=Layout.Page.container.find("#day_viewlist").find("tr"),totalHours=0,isBreakEnabled=Timetracker.generalSettings.isBreakEnabled();if(isBreakEnabled){var trdom=$(obj).closest("tr"),dateInp=Layout.Page.container.find("#dailylogtime").find("#day_hrs").attr("date"),isFromAddRow=void 0!==$(trdom).attr("isfromadd")&&$(trdom).attr("isfromadd"),rowId=$(trdom).attr("id");if(isOnlyFromToTimeLogAllowed){var fromTimeVal=$(trdom).find("[id^=timepickerfrom]").val(),toTimeVal=$(trdom).find("[id^=timepickerto]").val();if(""!==fromTimeVal&&""!==toTimeVal||""==fromTimeVal&&""==toTimeVal){var fromTime=""!==fromTimeVal?Timetracker.util.getTotalTimeForHours(fromTimeVal.split(":")):0,toTime=""!=toTimeVal?Timetracker.util.getTotalTimeForHours(toTimeVal.split(":")):0;if(isFromAddRow){var newValuesObj={fromTime:fromTime,toTime:toTime,type:"1",isTempValue:!0,rowId:rowId};Timetracker.timelogs.updateBrkCache(newValuesObj,dateInp),!0}else{if(isBreakLog=$(trdom).attr("isbreaklog")){newValuesObj={};if(void 0!==(jschId=$(trdom).attr("jschId")))newValuesObj={fromTime:fromTime,toTime:toTime,jschId:jschId};else void 0!==(timelogId=$(trdom).attr("timelogId"))&&(newValuesObj={fromTime:fromTime,toTime:toTime,timelogId:timelogId});0!=Object.keys(newValuesObj)&&Timetracker.timelogs.updateBrkCache(newValuesObj,dateInp,!1,!0)}}}}else if(isFromAddRow){var newftime=$(trdom).attr("newfromtime"),newttime=$(trdom).attr("newtotime");if(""!==newftime&&""!==newttime||""==newftime&&""==newttime){newValuesObj={fromTime:Number(newftime),toTime:Number(newttime),type:"1",isTempValue:!0,rowId:rowId};Timetracker.timelogs.updateBrkCache(newValuesObj,dateInp),!0}}else{if(isBreakLog=$(trdom).attr("isbreaklog")){var jschId,timelogId;newValuesObj={},newftime=void 0!==$(trdom).attr("newfromtime")?$(trdom).attr("newfromtime"):$(trdom).attr("oldfromtime"),newttime=void 0!==$(trdom).attr("newtotime")?$(trdom).attr("newtotime"):$(trdom).attr("oldtotime");if(void 0!==(jschId=$(trdom).attr("jschId")))newValuesObj={fromTime:Number(newftime),toTime:Number(newttime),jschId:jschId};else void 0!==(timelogId=$(trdom).attr("timelogId"))&&(newValuesObj={fromTime:Number(newftime),toTime:Number(newttime),timelogId:timelogId});0!=Object.keys(newValuesObj)&&Timetracker.timelogs.updateBrkCache(newValuesObj,dateInp,!1,!0)}}}for(var i=0;i<logRows.length;i++){if(isOnlyFromToTimeLogAllowed){var rowInputLength=(rowInput=$(logRows[i]).find("span[id^=daytimepicker]")).length,hours=(fromTimeVal=$(rowInput[rowInputLength-1]).find("[id^=timepickerfrom]").val().trim(),toTimeVal=$(rowInput[rowInputLength-1]).find("[id^=timepickerto]").val().trim(),0);if(""!==fromTimeVal&&""!==toTimeVal){fromTime=Timetracker.util.getTotalTimeForHours(fromTimeVal.split(":"));hours=(toTime=Timetracker.util.getTotalTimeForHours(toTimeVal.split(":")))>=fromTime?toTime-fromTime:toTime+Timetracker.constants.PER_DAY_MIN-fromTime}dateInp=$(rowInput[rowInputLength-1]).parent().find("input").attr("actualdate");void 0==(logtype=$(rowInput[rowInputLength-1]).closest("tr").attr("logtype"))&&0!=hours&&(logtype="1");var isNonHrsType="1"==logtype||"2"===logtype,isBreakLog=!1;isBreakLog=void 0!==$(logRows[i]).attr("isbreaklog")?$(logRows[i]).attr("isbreaklog"):!!$(rowInput[rowInputLength-1]).closest("tr").hasClass("breakRow");var inpHrs=rowTotal=hours;if(isBreakEnabled&&"1"==logtype)if(Timetracker.timelogs.breakLogsData.hasOwnProperty(dateInp)){var inp_from_mins=fromTime,inp_to_mins=toTime,brkCache=Timetracker.timelogs.breakLogsData[dateInp],currOverlapMins=0;if("false"===isBreakLog||!isBreakLog){for(var brkitr=0;brkitr<brkCache.length;brkitr++){var brkFtime=(brkInfo=brkCache[brkitr]).fromTime,brkTtime=brkInfo.toTime;brkInfo.type;currOverlapMins+=Timetracker.Util.getOverlappingTime(brkFtime,brkTtime,inp_from_mins,inp_to_mins)}currOverlapMins>0?($(rowInput[rowInputLength-1]).closest("tr").attr("overlaphours",currOverlapMins),$(rowInput[rowInputLength-1]).closest("tr").attr("nonoverlaphours",hours-currOverlapMins)):($(rowInput[rowInputLength-1]).closest("tr").attr("overlaphours",0),$(rowInput[rowInputLength-1]).closest("tr").attr("nonoverlaphours",hours))}}else $(rowInput[rowInputLength-1]).closest("tr").attr("overlaphours",0),$(rowInput[rowInputLength-1]).closest("tr").attr("nonoverlaphours",hours);if(isNonHrsType&&(inpHrs="false"!==isBreakLog&&isBreakLog||void 0===$(rowInput[rowInputLength-1]).closest("tr").attr("nonoverlaphours")?hours:Number($(rowInput[rowInputLength-1]).closest("tr").attr("nonoverlaphours"))),$(logRows[i]).find("[id^=time_hours]").html(""===fromTimeVal&&""===toTimeVal?"00:00":Calendar.minstohrs(rowTotal)),totalHours+=inpHrs,isBreakEnabled&&isNonHrsType)continue}var logtype,rowInput=isOnlyFromToTimeLogAllowed&&"1"==logtype?$(logRows[i]).find("input[id=daytxt]:visible"):$(logRows[i]).find("input[id=daytxt]");isNonHrsType="1"==(logtype=$(logRows[i]).attr("logtype"))||"2"==logtype,dateInp=Layout.Page.container.find("#adddailyLog").find("#day_hrs").attr("date"),isBreakLog=!1;if(isBreakLog=void 0!==$(logRows[i]).attr("isbreaklog")?$(logRows[i]).attr("isbreaklog"):!!$(logRows[i]).hasClass("breakRow"),0!=rowInput.length)if(""===$(rowInput[0]).val()||$(rowInput[0]).val().match(Timetracker.util.maxhrsRegex)){var rowval=$(rowInput[0]).val();if(isBreakEnabled&&"1"===logtype&&Timetracker.timelogs.breakLogsData.hasOwnProperty(dateInp)){inp_from_mins=void 0!==$(logRows[i]).attr("newfromtime")?$(logRows[i]).attr("newfromtime"):$(logRows[i]).attr("oldfromtime"),inp_to_mins=void 0!==$(logRows[i]).attr("newtotime")?$(logRows[i]).attr("newtotime"):$(logRows[i]).attr("oldtotime"),brkCache=Timetracker.timelogs.breakLogsData[dateInp],currOverlapMins=0;if("false"===isBreakLog||!isBreakLog){for(brkitr=0;brkitr<brkCache.length;brkitr++){var brkInfo;brkFtime=(brkInfo=brkCache[brkitr]).fromTime,brkTtime=brkInfo.toTime;currOverlapMins+=Timetracker.Util.getOverlappingTime(brkFtime,brkTtime,inp_from_mins,inp_to_mins)}var inpMins=0;if(-1!==rowval.indexOf(":")){var inpHoursSplit=rowval.split(":");inpMins=Number(inpHoursSplit[1])+60*inpHoursSplit[0]}else{inpHoursSplit=Number(rowval).toFixed(2);inpMins=60*Number(rowval)}0!=currOverlapMins?($(logRows[i]).attr("overlaphours",currOverlapMins),$(logRows[i]).attr("nonoverlaphours",inpMins-currOverlapMins)):($(logRows[i]).attr("overlaphours",0),$(logRows[i]).attr("nonoverlaphours",inpMins))}}if(-1!==rowval.indexOf(":")){var rowdata=rowval.split(":");inpHrs=Number(rowdata[1])+60*rowdata[0];if(isBreakEnabled&&("false"===isBreakLog||!isBreakLog)&&isNonHrsType)inpHrs=void 0!==(nonOverlapHours=$(logRows[i]).attr("nonoverlaphours"))?nonOverlapHours:inpHrs;totalHours+=Number(inpHrs)}else{rowval=Number(rowval).toFixed(2);var nonOverlapHours;inpHrs=60*Number(rowval);if(isBreakEnabled&&("false"===isBreakLog||!isBreakLog)&&isNonHrsType)inpHrs=void 0!==(nonOverlapHours=$(logRows[i]).attr("nonoverlaphours"))?nonOverlapHours:inpHrs;totalHours+=Number(inpHrs)}}else $(obj).addClass("ztextbox__error")}totalHours=totalHours.toFixed(0),Layout.Page.container.find("#dailylogtothrs").html(Calendar.minstohrs(totalHours))},weeklyMonthlyLogHours:function(obj,id){Timetracker.util.removeErrorMsg(void 0,$(obj).parent());var layout=Layout.Page.container.find("#timelogs_bulk_view");if(id=id||layout.find("#tl_datePicker").attr("type"),$(obj).is("[id^=daytimepicker]")||$(obj).is("[id^=timepickerfrom]")||$(obj).is("[id^=timepickerto]"))$(obj).is("[id^=daytimepicker]")?Timetracker.timelogs.bulkView.onBulkLogTimePickerChange(obj,id):Timetracker.timelogs.bulkView.onBulkLogTimePickerChange($(obj).parents("[id^=daytimepicker]"),id);else{if("."===obj.val())return!1;if(""!=obj.val()&&!obj.val().match(Timetracker.util.maxhrsRegex))return obj.addClass("ztextbox__error"),!1;""===obj.val()&&($(obj).attr("title",""),$(obj).attr("interval",""));for(var logRows=layout.find("#"+id+"_viewlist").find("tr"),rowtotal=0,navMode=layout.find("#tl_datePicker").attr("mode"),datePeriod=ZPCommonUtil.DateNavigator.getPeriod(navMode),arrlength=id===Timetracker.constants.WEEK?8:datePeriod.to.getDate()-datePeriod.from.getDate()+2,daytotal=new Array(arrlength),arrind=0;arrind<arrlength;arrind++)daytotal[arrind]=0;var fullTotal=0,isBreakEnabled=Timetracker.generalSettings.isBreakEnabled();if(isBreakEnabled){var trdom=$(obj).closest("tr"),dateInp=$(obj).attr("actualdate"),isFromAddRow=void 0!==$(trdom).attr("isfromadd")&&$(trdom).attr("isfromadd"),rowId=$(trdom).attr("id");if(isFromAddRow){var newftime=$(trdom).attr("newfromtime"),newttime=$(trdom).attr("newtotime");if(""!==newftime&&""!==newttime||""==newftime&&""==newttime){var newValuesObj={fromTime:Number(newftime),toTime:Number(newttime),type:"1",isTempValue:!0,rowId:rowId};Timetracker.timelogs.updateBrkCache(newValuesObj,dateInp),!0}}else{if(isBreakLog=$(trdom).attr("isbreaklog")){newValuesObj={},newftime=void 0!==$(trdom).attr("newfromtime")?$(trdom).attr("newfromtime"):$(trdom).attr("oldfromtime"),newttime=void 0!==$(trdom).attr("newtotime")?$(trdom).attr("newtotime"):$(trdom).attr("oldtotime");var jschId=$(trdom).attr("jschId");if(void 0!==jschId)newValuesObj={fromTime:Number(newftime),toTime:Number(newttime),jschId:jschId};else{var timelogId=$(trdom).attr("timelogId");void 0!==timelogId&&(newValuesObj={fromTime:Number(newftime),toTime:Number(newttime),timelogId:timelogId})}0!=Object.keys(newValuesObj)&&Timetracker.timelogs.updateBrkCache(newValuesObj,dateInp,!1,!0)}}}navMode=layout.find("#tl_datePicker").attr("mode"),datePeriod=ZPCommonUtil.DateNavigator.getPeriod(navMode);for(var isOnlyFromToTimeLogAllowed=Timetracker.generalSettings.isOnlyFromToTimeLogAllowed(Timetracker.timelogs.tserecno),i=0;i<logRows.length;i++){rowtotal=0;for(var totOverlapHours=0,rowInput=$(logRows[i]).find("input[textInput="+id+"lyLog]"),j=1;j<rowInput.length&&(id===Timetracker.constants.WEEK||j<datePeriod.to.getDate()-datePeriod.from.getDate()+2);j++)if(""===$(rowInput[j]).val()||$(rowInput[j]).val().match(Timetracker.util.maxhrsRegex)){var rowval=$(rowInput[j]).val(),logtype=(dateInp=$(rowInput[j]).attr("actualdate"),$(rowInput[j]).attr("logtype")),isBreakLog=!1;isBreakLog=void 0!==$(rowInput[j]).attr("isbreaklog")?$(rowInput[j]).attr("isbreaklog"):!!$(rowInput[j]).closest("tr").hasClass("breakRow");var isNonHrsType="1"===logtype||"2"===logtype;if(isBreakEnabled&&isNonHrsType&&Timetracker.timelogs.breakLogsData.hasOwnProperty(dateInp)&&"1"===logtype){var inp_from_mins=void 0!==$(rowInput[j]).attr("newfromtime")?$(rowInput[j]).attr("newfromtime"):$(rowInput[j]).attr("oldfromtime"),inp_to_mins=void 0!==$(rowInput[j]).attr("newtotime")?$(rowInput[j]).attr("newtotime"):$(rowInput[j]).attr("oldtotime"),brkCache=Timetracker.timelogs.breakLogsData[dateInp],currOverlapMins=0;if("false"===isBreakLog||!isBreakLog){for(var brkitr=0;brkitr<brkCache.length;brkitr++){var brkInfo=brkCache[brkitr],brkFtime=brkInfo.fromTime,brkTtime=brkInfo.toTime;brkInfo.type;currOverlapMins+=Timetracker.Util.getOverlappingTime(brkFtime,brkTtime,inp_from_mins,inp_to_mins)}var inpMins=0;if(-1!==rowval.indexOf(":")){var inpHoursSplit=rowval.split(":");inpMins=Number(inpHoursSplit[1])+60*inpHoursSplit[0]}else{inpHoursSplit=Number(rowval).toFixed(2);inpMins=60*Number(rowval)}0!=currOverlapMins?($(rowInput[j]).attr("overlaphours",currOverlapMins),$(rowInput[j]).attr("nonoverlaphours",inpMins-currOverlapMins)):($(rowInput[j]).attr("overlaphours",0),$(rowInput[j]).attr("nonoverlaphours",inpMins))}}if(-1!==rowval.indexOf(":")){var rowdata=rowval.split(":");rowtotal+=Number(rowdata[1])+60*rowdata[0];var inputHrsForTot=Number(rowdata[1])+60*rowdata[0];if(isBreakEnabled&&("false"===isBreakLog||!isBreakLog)&&isNonHrsType){inputHrsForTot=void 0!=$(rowInput[j]).attr("nonoverlaphours")?Number($(rowInput[j]).attr("nonoverlaphours")):inputHrsForTot;var overlapHrs=void 0!==$(rowInput[j]).attr("overlaphours")?$(rowInput[j]).attr("overlaphours"):0;totOverlapHours+=Number(overlapHrs)}daytotal[j]+=inputHrsForTot}else{rowval=Number(rowval).toFixed(2),rowtotal+=60*Number(rowval);inputHrsForTot=60*Number(rowval);if(isBreakEnabled&&("false"===isBreakLog||!isBreakLog)&&isNonHrsType){inputHrsForTot=void 0!=$(rowInput[j]).attr("nonoverlaphours")?Number($(rowInput[j]).attr("nonoverlaphours")):inputHrsForTot;overlapHrs=void 0!==$(rowInput[j]).attr("overlaphours")?$(rowInput[j]).attr("overlaphours"):0;totOverlapHours+=Number(overlapHrs)}daytotal[j]+=inputHrsForTot}}else $(rowInput[j]).addClass("ztextbox__error");if(isOnlyFromToTimeLogAllowed)for(rowInput=$(logRows[i]).find("[id^=daytimepicker]"),arrlength=datePeriod.to.getDate()-datePeriod.from.getDate()+2,j=1;j<rowInput.length&&(id===Timetracker.constants.WEEK||j<datePeriod.to.getDate()-datePeriod.from.getDate()+2);j++){if("1"==(logtype=$(rowInput[j-1]).attr("logtype")))if(isBreakEnabled){rowval=$(rowInput[j-1]).attr("nonoverlaphours");daytotal[j]+=Number(rowval)}else{rowdata=(rowval=$(rowInput[j-1]).attr("oldtime")).split(":");rowtotal+=Number(rowdata[1])+60*rowdata[0];inputHrsForTot=Number(rowdata[1])+60*rowdata[0];daytotal[j]+=inputHrsForTot}}rowtotal=Number(rowtotal).toFixed(0),$(logRows[i]).find("#rowtotal").find("b").html(Calendar.minstohrs(rowtotal)),isBreakEnabled&&totOverlapHours>0&&(rowtotal-=totOverlapHours),fullTotal+=Number(rowtotal)}for(i=1;i<daytotal.length;i++)Layout.Page.container.find("#"+id+"daytotal"+i).html(Calendar.minstohrs(Number(daytotal[i]).toFixed(0)));Layout.Page.container.find("#"+id+"dayFulltotal").html(Calendar.minstohrs(Number(fullTotal).toFixed(0)))}},onBulkLogTimePickerChange:function(timepickerDiv,id){var fromTime,toTime,fromTimeVal=$(timepickerDiv).find("[id^=timepickerfrom]").val().trim(),toTimeVal=$(timepickerDiv).find("[id^=timepickerto]").val().trim(),hours=0,isBreakEnabled=Timetracker.generalSettings.isBreakEnabled();""!==fromTimeVal&&""!==toTimeVal&&(fromTime=Timetracker.util.getTotalTimeForHours(fromTimeVal.split(":")),hours=(toTime=Timetracker.util.getTotalTimeForHours(toTimeVal.split(":")))>=fromTime?toTime-fromTime:toTime+Timetracker.constants.PER_DAY_MIN-fromTime),timepickerDiv.find("[id^=time_hours]").html(""===fromTimeVal&&""===toTimeVal?"00:00":Calendar.minstohrs(hours));for(var logRows=Layout.Page.container.find("#"+id+"_viewlist").find("tr"),rowtotal=0,navMode=Layout.Page.container.find("#timelogs_bulk_view").find("#tl_datePicker").attr("mode"),datePeriod=ZPCommonUtil.DateNavigator.getPeriod(navMode),arrlength=id===Timetracker.constants.WEEK?8:datePeriod.to.getDate()-datePeriod.from.getDate()+2,daytotal=new Array(arrlength),arrind=0;arrind<arrlength;arrind++)daytotal[arrind]=0;if(isBreakEnabled){var trdom=$(timepickerDiv).closest("tr"),dateInp=$(timepickerDiv).attr("actualdate"),isFromAddRow=void 0!==$(trdom).attr("isfromadd")&&$(trdom).attr("isfromadd"),rowId=$(trdom).attr("id");if(""!==fromTimeVal&&""!==toTimeVal||""==fromTimeVal&&""==toTimeVal){var ftime=""!==fromTimeVal?Timetracker.util.getTotalTimeForHours(fromTimeVal.split(":")):0,ttime=""!==toTimeVal?Timetracker.util.getTotalTimeForHours(toTimeVal.split(":")):0;if(isFromAddRow){var newValuesObj={fromTime:ftime,toTime:ttime,type:"1",isTempValue:!0,rowId:rowId};Timetracker.timelogs.updateBrkCache(newValuesObj,dateInp),!0}else{if(isBreakLog=$(timepickerDiv).attr("isbreaklog")){newValuesObj={};var jschId=$(timepickerDiv).attr("jschId");if(void 0!==jschId)newValuesObj={fromTime:ftime,toTime:ttime,jschId:jschId};else{var timelogId=$(timepickerDiv).attr("timelogId");void 0!==timelogId&&(newValuesObj={fromTime:ftime,toTime:ttime,timelogId:timelogId})}0!=Object.keys(newValuesObj)&&Timetracker.timelogs.updateBrkCache(newValuesObj,dateInp,!1,!0)}}}}for(var fullTotal=0,i=0;i<logRows.length;i++){rowtotal=0;for(var rowInput=$(logRows[i]).find("[id^=daytimepicker]"),j=1;id===Timetracker.constants.WEEK?j<rowInput.length+1:j<arrlength;j++){fromTimeVal=$(rowInput[j-1]).find("[id^=timepickerfrom]").val().trim(),toTimeVal=$(rowInput[j-1]).find("[id^=timepickerto]").val().trim(),hours=0,""!==fromTimeVal&&""!==toTimeVal&&(fromTime=Timetracker.util.getTotalTimeForHours(fromTimeVal.split(":")),hours=(toTime=Timetracker.util.getTotalTimeForHours(toTimeVal.split(":")))>=fromTime?toTime-fromTime:toTime+Timetracker.constants.PER_DAY_MIN-fromTime);dateInp=$(rowInput[j-1]).attr("actualdate");var logtype=$(rowInput[j-1]).attr("logtype");void 0===logtype&&0!=hours&&(logtype="1");var isBreakLog=!1;if(isBreakLog=void 0!==$(rowInput[j-1]).attr("isbreaklog")?$(rowInput[j-1]).attr("isbreaklog"):!!$(rowInput[j-1]).closest("tr").hasClass("breakRow"),isBreakEnabled&&Timetracker.timelogs.breakLogsData.hasOwnProperty(dateInp)&&"1"===logtype){var inp_from_mins=fromTime,inp_to_mins=toTime,brkCache=Timetracker.timelogs.breakLogsData[dateInp],currOverlapMins=0;if("false"===isBreakLog||!isBreakLog){for(var brkitr=0;brkitr<brkCache.length;brkitr++){var brkInfo=brkCache[brkitr],brkFtime=brkInfo.fromTime,brkTtime=brkInfo.toTime;brkInfo.type;currOverlapMins+=Timetracker.Util.getOverlappingTime(brkFtime,brkTtime,inp_from_mins,inp_to_mins)}currOverlapMins>0?($(rowInput[j-1]).attr("overlaphours",currOverlapMins),$(rowInput[j-1]).attr("nonoverlaphours",hours-currOverlapMins)):($(rowInput[j-1]).attr("overlaphours",0),$(rowInput[j-1]).attr("nonoverlaphours",hours))}}var inputHrsForTot=hours;!isBreakEnabled||"false"!==isBreakLog&&isBreakLog||(inputHrsForTot=void 0!=$(rowInput[j-1]).attr("nonoverlaphours")?Number($(rowInput[j-1]).attr("nonoverlaphours")):hours),rowtotal+=inputHrsForTot,daytotal[j]+=inputHrsForTot}for(rowInput=$(logRows[i]).find("input[textInput="+id+"lyLog]"),j=1;j<rowInput.length&&(id===Timetracker.constants.WEEK||j<arrlength);j++)if(""===$(rowInput[j]).val()||$(rowInput[j]).val().match(Timetracker.util.maxhrsRegex)){var rowval=$(rowInput[j]).val();if(-1!==rowval.indexOf(":")){var rowdata=rowval.split(":");rowtotal+=Number(rowdata[1])+60*rowdata[0],daytotal[j]+=Number(rowdata[1])+60*rowdata[0]}else rowval=Number(rowval).toFixed(2),rowtotal+=60*Number(rowval),daytotal[j]+=60*Number(rowval)}else $(rowInput[j]).addClass("ztextbox__error");rowtotal=Number(rowtotal).toFixed(0),fullTotal+=Number(rowtotal),$(logRows[i]).find("#rowtotal").find("b").html(Calendar.minstohrs(rowtotal))}for(i=1;i<daytotal.length;i++)Layout.Page.container.find("#"+id+"daytotal"+i).html(Calendar.minstohrs(Number(daytotal[i]).toFixed(0)));Layout.Page.container.find("#"+id+"dayFulltotal").html(Calendar.minstohrs(Number(fullTotal).toFixed(0)))},submitBulkLogAddEditCallback:function(obj,id,modal){var timelogtype=modal.find("#bulk_timelog_type").find("input[name='timelogTime']:checked").val(),loggedHrs=0;if("0"===timelogtype){if(""==(loggedHrs=modal.find("#bulk_timelog_hrstime").val())&&""==modal.find("#bulk_timelog_hrstime").attr("oldValue"))return modal.find("#bulk_timelog_hrstime").addClass("ztextbox__error"),!1;if(modal.find("#bulk_timelog_hrstime").removeClass("ztextbox__error"),$(obj).attr("title",""),$(obj).attr("newfromtime",""),$(obj).attr("newtotime",""),$(obj).attr("interval",""),$(obj).attr("logtype",0),id===Timetracker.constants.DAY){var dom=$(obj).closest("tr");$(dom).attr("newfromtime",""),$(dom).attr("newtotime",""),$(dom).attr("interval",""),$(dom).attr("logtype",0)}$(obj).val(loggedHrs)}else if("1"===timelogtype){modal.find("#bulk_timelog_start_end_time").find("#error_msg").remove();var isShiftEnabled=Timetracker.isTTSthiftEnabled(),fromTimeDt=isShiftEnabled?TimelyZComp.datetimefield.getDateObj(modal.find("#bulk_timelog_fromtime")):TimelyZComp.timeField.getValue(modal.find("#bulk_timelog_fromtime")),toTimeDt=isShiftEnabled?TimelyZComp.datetimefield.getDateObj(modal.find("#bulk_timelog_totime")):TimelyZComp.timeField.getValue(modal.find("#bulk_timelog_totime")),dt=$(obj).attr("date"),logDate=new Date(dt.split("-"));if(void 0!=fromTimeDt&&void 0!=toTimeDt&&void 0!=logDate){var fromTime,toTime;if(isShiftEnabled){if(fromTime=logDate.getDiff(fromTimeDt,Timetracker.constants.MINUTES),toTime=logDate.getDiff(toTimeDt,Timetracker.constants.MINUTES),fromTime<-Timetracker.constants.PER_DAY_MIN||fromTime>=2*Timetracker.constants.PER_DAY_MIN||toTime<-Timetracker.constants.PER_DAY_MIN||toTime>=2*Timetracker.constants.PER_DAY_MIN)return modal.find("#bulk_timelog_start_end_time").append('<span class="ztextbox--error__label" id="error_msg">'+ZPI18N.getString("zp.entervalidtime")+"</span>"),!1;if(toTime-fromTime>Timetracker.constants.PER_DAY_MIN)return modal.find("#bulk_timelog_start_end_time").append('<span class="ztextbox--error__label" id="error_msg">'+ZPI18N.getString("zp.timeexceeded24")+"</span>"),!1;if(toTime<fromTime)return modal.find("#bulk_timelog_start_end_time").append('<span class="ztextbox--error__label" id="error_msg">'+ZPI18N.getString("zp.fromtimegreater")+"</span>"),!1}else fromTime=Timetracker.util.getTotalTimeForHours(fromTimeDt.split(":")),toTime=Timetracker.util.getTotalTimeForHours(toTimeDt.split(":"));loggedHrs=toTime>=fromTime?toTime-fromTime:toTime+Timetracker.constants.PER_DAY_MIN-fromTime,loggedHrs=Calendar.minstohrs(loggedHrs),logDate=Calendar.formatDate(logDate);var title=Timetracker.util.getShiftDatebyTimeStr(fromTime,logDate,Timetracker.constants.MINUTES)+" - "+Timetracker.util.getShiftDatebyTimeStr(toTime,logDate,Timetracker.constants.MINUTES);if($(obj).attr("title",title),$(obj).attr("interval",fromTime+"T"+toTime),$(obj).attr("logtype",1),$(obj).attr("newfromtime",fromTime),$(obj).attr("newtotime",toTime),id===Timetracker.constants.DAY){dom=$(obj).closest("tr");$(dom).attr("logtype",1),$(dom).attr("newfromtime",fromTime),$(dom).attr("newtotime",toTime)}$(obj).val(loggedHrs)}else{if(void 0!=fromTimeDt||void 0!=toTimeDt)return modal.find("#bulk_timelog_start_end_time").append('<span class="ztextbox--error__label" id="error_msg">'+ZPI18N.getString("zp.entervalidtime")+"</span>"),!1;if(loggedHrs="",$(obj).attr("title",""),$(obj).attr("interval",""),$(obj).attr("logtype",1),$(obj).attr("newfromtime",""),$(obj).attr("newtotime",""),id===Timetracker.constants.DAY){dom=$(obj).closest("tr");$(dom).attr("logtype",1),$(dom).attr("newfromtime",""),$(dom).attr("newtotime","")}$(obj).val(loggedHrs)}}id===Timetracker.constants.DAY?Timetracker.timelogs.bulkView.dailylogHours($(obj)):Timetracker.timelogs.bulkView.weeklyMonthlyLogHours($(obj),id)},deleteConfirm:function(ele){var bulkmodal_id=Timetracker.Page.getPageMode()+"_timelogs_bulk_view_popup",layout=Layout.Page.container.find("#"+bulkmodal_id);layout.find("#tl_delete_popup").remove(),delPopup=$('<div id="tl_delete_popup"><div><h5>'+ZPI18N.getString("zp.common.entitydelete",[ZPI18N.getString("zp.stimeLog")])+"</h5><p>"+ZPI18N.getString("zp.common.delEntityInfo2",[ZPI18N.getString("zp.stimeLog")])+'</p></div><div><button type="button" class="zlabel zlabel--red zlabel--medium" id="del_confirm">'+ZPI18N.getString("zp.confirm")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="ZPeopleComponents.popover(\'#tl_delete_popup\').close();">'+ZPI18N.getString("zp.cancel")+"</button></div></div>"),layout.find(".zpl_container").append(delPopup);var tlId=$(ele).attr("tlid");delPopup.find("#del_confirm").off().on("click",function(){Timetracker.timelogs.bulkView.deleteTimelog(tlId,ele),ZPeopleComponents.popover("#tl_delete_popup").close()});var popJson={forElement:ele,closeOnScroll:!0,className:"zpl_logdel-cnfrm",close:function(){Layout.Page.container.find("#tl_delete_popup").remove()}};ZPeopleComponents.popover("#tl_delete_popup",popJson).open()},deleteTimelog:function(timelogId,ele){var params={mode:"deleteTimesheet",sheetId:timelogId,conreqcsr:csrfToken},layout=Layout.Page.container.find("#timelogs_bulk_view");$.post("/timesheet.zp",params,function(resultData){if("true"===resultData||"true_refresh"===resultData){Timetracker.timelogs.bulkView.refreshView=!0;var fromDate,toDate,type=layout.find("#tl_datePicker").attr("type"),navMode=layout.find("#tl_datePicker").attr("mode"),datePeriod=ZPCommonUtil.DateNavigator.getPeriod(navMode);if(type===Timetracker.constants.DAY?(fromDate=Calendar.formatDate(datePeriod.day),toDate=Calendar.formatDate(datePeriod.day)):type!==Timetracker.constants.WEEK&&type!==Timetracker.constants.HALFMONTH&&type!==Timetracker.constants.MONTH||(fromDate=Calendar.formatDate(datePeriod.from),toDate=Calendar.formatDate(datePeriod.to)),Timetracker.timelogs.currentTimelogData&&Timetracker.timelogs.currentTimelogData[fromDate+"_"+toDate]){var logData=Timetracker.timelogs.currentTimelogData[fromDate+"_"+toDate].tsArr,logInd=-1;for(let i=0;i<logData.length;i++)if(logData[i].timelogId===timelogId){logInd=i;break}-1!=logInd&&logData.splice(logInd,1)}var isOnlyFromTo=Timetracker.generalSettings.isOnlyFromToTimeLogAllowed(Timetracker.timelogs.tserecno);if(type===Timetracker.constants.DAY){var td=$(ele).closest("td"),rowCount=(tr=$(td).closest("tr")).attr("rowno");Timetracker.timelogs.bulkView.destroyZComponents(tr),Timetracker.timelogs.bulkView.addRowByMenuCallback("isFromDeleteRow",{rowCount:rowCount}).then(function(tr){var input;isOnlyFromTo?input=$(tr).find("[id^=daytimepicker]"):(input=$(tr).find("#daytxt")).value=$(input).val(),Timetracker.timelogs.bulkView.dailylogHours($(input))})}else{td=$(ele).closest("td");var tr=$(td).closest("tr"),tlog=td.find("[timelogid='"+timelogId+"'"),date=tlog.attr("date");if(1==Timetracker.timelogs.bulkView.getAddedValuesInRowCount(tr,isOnlyFromTo)){rowCount=tr.attr("rowno");Timetracker.timelogs.bulkView.destroyZComponents(tr),Timetracker.timelogs.bulkView.addRowByMenuCallback("isFromDeleteRow",{rowCount:rowCount}).then(function(tr){var input=isOnlyFromTo?$(tr).find("span[id^=daytimepicker][date="+date+"]"):$(tr).find("input[id^=daytxt][date="+date+"]");Timetracker.timelogs.bulkView.weeklyMonthlyLogHours($(input),type)})}else{var logType=tlog.attr("logtype");$(td).find(".PI_delete").remove(),isOnlyFromTo?"0"==logType||"2"==logType?($(tlog).val(""),$(tlog).prop("disabled",!1).removeClass("is-disabled"),$(tlog).parent().addClass("zpl_DNI"),$(td).find("[id^=daytimepicker]").removeClass("zpl_DNI")):($(tlog).find("[id^='timepickerfrom']").val(""),$(tlog).find("[id^='timepickerto']").val("")):($(tlog).val(""),$(tlog).prop("disabled",!1).removeClass("is-disabled"),$(td).find(".zpl_flexaligngap3").removeClass("zpl_flexaligngap3")),$.each(["oldtime","oldbill","billingstatus","title","logtype","newfromtime","newtotime","interval","timelogid","oldfromtime","oldtotime"],function(i,item){tlog.removeAttr(item)}),$(td).removeData("isPopulated");var txtarea=$(tr).find('textarea[date="'+date+'"]');txtarea.val(""),txtarea.prop("disabled",!1).removeClass("disabled"),txtarea.removeAttr("desc").removeAttr("title"),$(tr).find('[id^="confirmBtn"][date="'+date+'"]').prop("disabled",!1).removeClass("disabled");var isDescFound=!1;$(tr).find("textarea").each(function(){if(""!=$(this).val())return isDescFound=!0,!1}),!isDescFound&&$(tr).find("PI_note").removeClass("blu");var input=isOnlyFromTo?$(tr).find("span[id^=daytimepicker][date="+date+"]"):$(tr).find("input[id^=daytxt][date="+date+"]");Timetracker.timelogs.bulkView.weeklyMonthlyLogHours($(input),type)}}Timetracker.timelogs.resetTLFetch(!0)}else if(-1!==resultData.indexOf("TSpayperioderror_")||-1!==resultData.indexOf("TSbudgeterror_")||-1!==resultData.indexOf("TSBreakError_")){var error=resultData.split(":");Timetracker.util.showAlert(1,error.length>1?error[1]:resultData)}else-1!==resultData.indexOf("TimerRunningError")?Timetracker.util.showAlert(1,ZPI18N.getString("zp.timerlogalert7")):Timetracker.util.showAlert(0,ZPI18N.getString("zp.timelogdelerror"))})},getAddedValuesInRowCount:function(row,isOnlyFromToTimeLogAllowed){var cnt=0;return(isOnlyFromToTimeLogAllowed=void 0==isOnlyFromToTimeLogAllowed?Timetracker.generalSettings.isOnlyFromToTimeLogAllowed(Timetracker.timelogs.tserecno):isOnlyFromToTimeLogAllowed)?row.find('[id^="daytimepicker"]').each(function(){var isLogged=$(this).closest("td").data("isPopulated");cnt+=isLogged||""!=$(this).find("[id^=timepickerfrom]").val()||""!=$(this).find("[id^=timepickerto]").val()?1:0}):row.find('[id^="daytxt"]').each(function(){cnt+=""!=$(this).val()?1:0}),cnt},toSetLeftandWidth:function(type){var secondLevelTabLength=160;Timetracker.Page.Timelogs.isSelfServiceListView()?secondLevelTabLength=230:(secondLevelTabLength=200,$("body").hasClass("ZPsbarMini")),$("body").hasClass("ZPsbarMini")&&Timetracker.Page.Timelogs.isSelfServiceListView();var toSetJob,toSetProj,tableId="";"weekly"===type||type===Timetracker.constants.WEEK?("week",tableId="weeklylogtime"):"monthly"===type||type===Timetracker.constants.MONTH?("month",tableId="monthlylogtime"):"halfmonthly"===type||type===Timetracker.constants.HALFMONTH?("halfmonth",tableId="halfmonthlylogtime"):"daily"!==type&&type!==Timetracker.constants.DAY||("day",tableId="dailylogtime"),toSetJob=toSetProj=60;var colspan=0,tColspan=2;"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Projects?(toSetJob=240,toSetProj=60,420,tColspan++,"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Clients&&(toSetJob+=180,toSetProj+=180,180,180,180,tColspan++),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Workitem&&(200,200,colspan++),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Desc&&(60,colspan++)):("1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Workitem?(440,440,colspan++):(240,240),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Desc&&(60,colspan++)),"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Billable_Show&&colspan++;var layout=Layout.Page.container.find("#timelogs_bulk_view"),mRowHtml=layout.find("#"+tableId).find("tr:not(:last)");mRowHtml.find("th:nth-child(2) ,td:nth-child(2)").css({left:"60px",width:"180px"}),mRowHtml.find("th:nth-child(3) ,td:nth-child(3)").css({left:toSetProj+"px",width:"180px"}),mRowHtml.find("th:nth-child(4) ,td:nth-child(4)").css({left:toSetJob+"px","min-width":"180px"}),0==colspan?layout.find("#"+tableId).find("#tfoot_excessRow").addClass("zpl_DNI"):layout.find("#"+tableId).find("#tfoot_excessRow").attr("colspan",colspan),layout.find("#"+tableId).find("#tfoot_tRow").attr("colspan",tColspan)},cloneTimeLogs:function(){Timetracker.timelogs.bulkView.showDayWeekMonthLogTime(!1,!0)},populateLocationJobSchedules:function(type){TimetrackerOperations.locationjobSchedule.isLocationJobScheduleAllowed()&&Timetracker.timelogs.bulkView.loadLogsData(type,null,!1,!0)},addRowByMenuCallback:async function(event,params){var row;if(row=void 0!=params&&params.options&&"add_breaklog_row"==params.options.id?Timetracker.timelogs.bulkView.addDayWeekMonthBreakRow():"isFromDeleteRow"==event?await Timetracker.timelogs.bulkView.addDayWeekMonthRow(void 0,!1,params):await Timetracker.timelogs.bulkView.addDayWeekMonthRow(),!(Timetracker.generalSettings.isFromToTimeLogAllowed(Timetracker.timelogs.tserecno)&&(Timetracker.generalSettings.isManualLogAllowed(Timetracker.timelogs.tserecno)||Timetracker.generalSettings.isAutomaticLogAllowed(Timetracker.timelogs.tserecno)))){var id=Layout.Page.container.find("#timelogs_bulk_view").find("#tl_datePicker").attr("type");Timetracker.generalSettings.isOnlyFromToTimeLogAllowed(Timetracker.timelogs.tserecno)?$(row).find("[id^=timepickerfrom],[id^=timepickerto]").on("change",function(event){id===Timetracker.constants.DAY?Timetracker.timelogs.bulkView.dailylogHours($(this)):Timetracker.timelogs.bulkView.weeklyMonthlyLogHours($(this),id)}):$(row).find("[id^=daytxt]").on("keyup",function(event){id===Timetracker.constants.DAY?Timetracker.timelogs.bulkView.dailylogHours($(this)):Timetracker.timelogs.bulkView.weeklyMonthlyLogHours($(this),id)})}return row},dayWeekMonthLogupdate:function(id,event){Timetracker.util.freezeSubmit("timelogs_bulk_view","submit_timelog"),Timetracker.util.getTTLocation(Timetracker.timelogs.bulkView.dayWeekMonthLogupdateCallback,id,event)},dayWeekMonthLogupdateCallback:function(id,event){var layout=Layout.Page.container.find("#timelogs_bulk_view"),navMode=layout.find("#tl_datePicker").attr("mode"),datePeriod=ZPCommonUtil.DateNavigator.getPeriod(navMode),logRows=(id=layout.find("#tl_datePicker").attr("type"),layout.find("#"+id+"_viewlist").find("tr")),logparams=[],updateStatus=!0,isStartEndTypeAvail=!1,pageMode=Timetracker.Page.getPageMode(),isOnlyFromToTimeLogAllowed=Timetracker.generalSettings.isOnlyFromToTimeLogAllowed(Timetracker.timelogs.tserecno),bulkmodal_id=pageMode+"_timelogs_bulk_view_popup";Timetracker.util.removeErrorMsg(bulkmodal_id);for(var i=0;i<logRows.length;i++){var timelog=$(logRows[i]).data();if(!(isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",timelog))||Timetracker.timelogs.bulkView.showEditBreakRowInBulkLogs()){var param={},isValueChanged=!1,isEntryNewTL=!1,logInputRows=$(logRows[i]).find("input[textinput="+(id===Timetracker.constants.DAY?"dai":id)+"lyLog]");isOnlyFromToTimeLogAllowed&&(logInputRows=$(logRows[i]).find("span[id^=daytimepicker]"));$(logRows[i]).find("select");var fromTimeVal,toTimeVal,workItemDiv=$(logRows[i]).find("input[id$=workitem"+(i+1)+"]"),txtarea=$(logRows[i]).find("textarea"),hrsCellsValid=!1,isValidHours=!1,j=id===Timetracker.constants.DAY?2:1;for(isOnlyFromToTimeLogAllowed&&(j=0);j<logInputRows.length;j++){var newLog=!1,logInputRow=logInputRows[j],showFromToTime=isOnlyFromToTimeLogAllowed,logType=id===Timetracker.constants.DAY?$(logRows[i]).attr("logtype"):$(logInputRow).attr("logtype");showFromToTime&&void 0!==logType&&1!=logType&&(showFromToTime=!1,logInputRow=$(logInputRow).parent().find("input[id^=daytxt]")),showFromToTime?(id===Timetracker.constants.DAY?$(logRows[i]).attr("logtype",1):$(logInputRow).attr("logtype",1),fromTimeVal=$(logInputRow).find("[id^=timepickerfrom]").val().trim(),toTimeVal=$(logInputRow).find("[id^=timepickerto]").val().trim(),(isValidHours=""!==fromTimeVal&&""!==toTimeVal)||(""===fromTimeVal&&""!==toTimeVal?(updateStatus=!1,$(logInputRow).find("[id^=timepickerfrom]").addClass("ztextbox__error")):""!==fromTimeVal&&""===toTimeVal&&(updateStatus=!1,$(logInputRow).find("[id^=timepickerto]").addClass("ztextbox__error")))):(""===$(logInputRow).val()||$(logInputRow).val().match(Timetracker.util.maxhrsRegex)||(updateStatus=!1,$(logInputRow).addClass("ztextbox__error")),isValidHours=""!==$(logInputRow).val());var isTimeChanged=!1,paramIdx=id===Timetracker.constants.DAY?1:isOnlyFromToTimeLogAllowed?j+1:j;if(isValidHours){var currtime,approvalStatus=id===Timetracker.constants.DAY?$(logRows[i]).attr("approvalStatus"):$(logInputRow).attr("approvalStatus"),billingStatus=id===Timetracker.constants.DAY?$(logRows[i]).attr("billingStatus"):$(logInputRow).attr("billingStatus"),currFromTime=(logType=id===Timetracker.constants.DAY?$(logRows[i]).attr("logtype"):$(logInputRow).attr("logtype"),""),currToTime="";if(showFromToTime){var oldFromTime=id===Timetracker.constants.DAY?$(logRows[i]).attr("oldfromtime"):$(logInputRow).attr("oldfromtime"),oldToTime=id===Timetracker.constants.DAY?$(logRows[i]).attr("oldtotime"):$(logInputRow).attr("oldtotime");currFromTime=Timetracker.util.getTotalTimeForHours(fromTimeVal.split(":")),currtime=(currToTime=Timetracker.util.getTotalTimeForHours(toTimeVal.split(":")))>=currFromTime?currToTime-currFromTime:currToTime+Timetracker.constants.PER_DAY_MIN-currFromTime,currtime=Calendar.minstohrs(currtime),isTimeChanged=oldFromTime!=currFromTime||oldToTime!=currToTime,isValueChanged||(isValueChanged=isTimeChanged)}else{var oldtime=id===Timetracker.constants.DAY?$(logRows[i]).attr("oldtime"):$(logInputRow).attr("oldtime");currtime=$(logInputRow).val();var isHrsChanged=!1;if(void 0!==oldtime&&null!=oldtime&&oldtime!==currtime&&(isHrsChanged=!0),1==logType&&(currFromTime=id===Timetracker.constants.DAY?$(logRows[i]).attr("newfromtime"):$(logInputRow).attr("newfromtime"),currToTime=id===Timetracker.constants.DAY?$(logRows[i]).attr("newtotime"):$(logInputRow).attr("newtotime"),void 0!==currFromTime&&void 0!==currToTime)){currFromTime=parseInt(currFromTime),currToTime=parseInt(currToTime);oldFromTime=id===Timetracker.constants.DAY?$(logRows[i]).attr("oldfromtime"):$(logInputRow).attr("oldfromtime"),oldToTime=id===Timetracker.constants.DAY?$(logRows[i]).attr("oldtotime"):$(logInputRow).attr("oldtotime");currtime=currToTime>=currFromTime?currToTime-currFromTime:currToTime+Timetracker.constants.PER_DAY_MIN-currFromTime,currtime=Calendar.minstohrs(currtime),isTimeChanged=oldFromTime!=currFromTime||oldToTime!=currToTime,isValueChanged||(isValueChanged=isTimeChanged)}isStartEndTypeAvail||1!==logType&&"1"!==logType||isHrsChanged&&void 0===currFromTime&&void 0===currFromTime&&(isStartEndTypeAvail=!0,$(logInputRow).attr("showErrLogType","1")),isValueChanged||(isValueChanged=isHrsChanged)}if(approvalStatus&&-2!=approvalStatus||billingStatus&&0!=billingStatus||logType&&"2"===logType){!0;continue}param["day"+paramIdx]=currtime,void 0!==currFromTime&&""!==currFromTime&&void 0!==currToTime&&""!==currToTime&&(param["fromTime"+paramIdx]=currFromTime,param["toTime"+paramIdx]=currToTime);var logId=id===Timetracker.constants.DAY?$(logRows[i]).attr("timelogid"):$(logInputRow).attr("timelogid");void 0!==logId&&null!==logId&&""!==logId?param["timelogId"+paramIdx]=logId:(newLog=!0,isEntryNewTL||(isEntryNewTL=!0)),newLog||1!==logType&&"1"!==logType||isTimeChanged||(param["fromTime"+paramIdx]=id===Timetracker.constants.DAY?$(logRows[i]).attr("oldfromtime"):$(logInputRow).attr("oldfromtime"),param["toTime"+paramIdx]=id===Timetracker.constants.DAY?$(logRows[i]).attr("oldtotime"):$(logInputRow).attr("oldtotime"),param["retainFromToValue"+paramIdx]=!0);var approvalId=id===Timetracker.constants.DAY?$(logRows[i]).attr("approvalid"):$(logInputRow).attr("approvalid");if(void 0!==approvalId&&null!==approvalId&&""!==approvalId){param["approvalId"+paramIdx]=approvalId;var oldhours=id===Timetracker.constants.DAY?$(logRows[i]).attr("oldhours"):$(logInputRow).attr("oldhours");void 0!==oldhours&&null!==oldhours&&""!==oldhours&&(param["oldhours"+paramIdx]=oldhours)}var oldBill=id===Timetracker.constants.DAY?$(logRows[i]).attr("oldbill"):$(logInputRow).attr("oldbill");void 0!==oldBill&&null!==oldBill&&""!==oldBill&&(param["oldBill"+paramIdx]=oldBill),hrsCellsValid=!0}}if(hrsCellsValid){var jobIdObj=$(logRows[i]).find("#"+id+"jobselect"+(i+1)),oldJobId=jobIdObj.attr("oldjobid"),showError=!1,cacheKey=$(jobIdObj).parents("tr").attr("id")+"_"+$(jobIdObj).attr("id"),isBreakLog=(Timetracker.Filters.Configuartion.getProperty(cacheKey+"-job"),$(logRows[i]).hasClass("breakRow")),jobId=TimelyZComp.select.getValue(jobIdObj);if(null===jobId||"0"===jobId||0===jobId||""==jobId?(updateStatus=!1,showError=!0):param.jobId=jobId,showError&&Timetracker.Util.addError(jobIdObj),showError||void 0===oldJobId||null===oldJobId||jobId===oldJobId||isValueChanged||(isValueChanged=!0),!isBreakLog&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Projects){var projObj=$(logRows[i]).find("#"+id+"projectselect"+(i+1)),projectId=0!=projObj.length?TimelyZComp.select.getValue(projObj):"0";if(null!==projectId&&"0"!==projectId&&0!==projectId?param.projectId=projectId:Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.PROJECT)&&(updateStatus=!1,Timetracker.Util.addError(projObj),Timetracker.util.showAlert(0,ZPI18N.getString("zp.entermandatoryfields"))),Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.CLIENT)){var clntObj=$(logRows[i]).find("#"+id+"clientselect"+(i+1)),clientId=0!=clntObj.length?TimelyZComp.select.getValue(clntObj):"0";!Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.CLIENT)||null!==clientId&&"0"!==clientId&&0!==clientId||(updateStatus=!1,Timetracker.Util.addError(clntObj),Timetracker.util.showAlert(0,ZPI18N.getString("zp.entermandatoryfields")))}}if(!isBreakLog&&"1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Workitem){var wItem=$(workItemDiv).val();if(ZPeopleComponents.isComponent(workItemDiv)&&(wItem=ZPeople.decodeTxt(TimelyZComp.select.getValue(workItemDiv))),wItem.length>500&&(updateStatus=!1,Timetracker.Util.addError(workItemDiv),Timetracker.util.showAlert(0,ZPI18N.getString("zp.namecharlimit",[Timetracker.util.workitemDispName,"500"]))),""!==wItem){var oldwiName=ZPeople.decodeTxt($(workItemDiv).parents("tr").attr("orgtaskname"));param.taskName=wItem,void 0!==oldwiName&&""!==oldwiName.trim()?"0"===wItem&&(Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.WORKITEM)?(delete param.taskName,updateStatus=!1,Timetracker.Util.addError(workItemDiv),Timetracker.util.showAlert(0,ZPI18N.getString("zp.entermandatoryfields"))):param.taskName=""):"0"===wItem&&(delete param.taskName,Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.WORKITEM)&&(updateStatus=!1,Timetracker.Util.addError(workItemDiv),Timetracker.util.showAlert(0,ZPI18N.getString("zp.entermandatoryfields")))),param.hasOwnProperty("taskName")&&(void 0!==oldwiName&&null!==oldwiName&&oldwiName!==param.taskName||void 0==oldwiName&&""!=param.taskName)&&(isValueChanged||(isValueChanged=!0))}else Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.WORKITEM)&&(updateStatus=!1,Timetracker.Util.addError(workItemDiv),Timetracker.util.showAlert(0,ZPI18N.getString("zp.entermandatoryfields")))}if("1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Desc)if(id===Timetracker.constants.DAY){var descDiv=$(logRows[i]).find("input[id$=desctxt]"),descVal=$(descDiv).val();descVal.length>15e3&&(updateStatus=!1,Timetracker.Util.addError(descDiv)),""!==descVal?(param.desc=descVal,$(descDiv).attr("description")!=descVal&&(isValueChanged=!0)):Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.DESC)&&(updateStatus=!1,Timetracker.Util.addError(descDiv),Timetracker.util.showAlert(0,ZPI18N.getString("zp.entermandatoryfields")))}else{txtarea.closest("td").find("[name='descIcon']").removeClass("red");var flag=Timetracker.timelogs.bulkView.weekMonthDescSubmit(id,txtarea,param);if(2===flag)return event.stopPropagation(),layout.find("#submit_timelog").removeClass("disabled"),!1;if(3===flag)return updateStatus=!1,txtarea.closest("td").find("[name='descIcon']").addClass("red"),layout.find("#submit_timelog").removeClass("disabled"),Timetracker.util.showAlert(0,ZPI18N.getString("zp.entermandatoryfields")),!1;4===flag&&(txtarea.closest("td").find("[name='descIcon']").addClass("blu"),isValueChanged||(isValueChanged=!0))}if(Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS)){var billDom=$(logRows[i]).find("#"+id+"jobbillselect"+(i+1));param.billStatus=TimelyZComp.select.getValue(billDom);var oldBillStatVal=$(billDom).parents("tr").attr("oldBillableStat");void 0!==oldBillStatVal&&null!==oldBillStatVal&&oldBillStatVal!==param.billStatus&&(isValueChanged||(isValueChanged=!0))}(isEntryNewTL||isValueChanged)&&logparams.push(param)}}}if(0===logparams.length&&updateStatus)return Timetracker.util.showAlert(1,ZPI18N.getString("zp.nochangesmade")),layout.find("#submit_timelog").removeClass("disabled"),!1;if(!updateStatus)return layout.find("#submit_timelog").removeClass("disabled"),!1;var userErecNo=Timetracker.timelogs.tserecno;null!==userErecNo&&void 0!==userErecNo||(userErecNo=erecno),Timetracker.util.freezeSubmit("timelogs_bulk_view","submit_timelog");var params={mode:"addWeekTimesheet",logParams:JSON.stringify(logparams),userErecNo:userErecNo,conreqcsr:csrfToken};if(0!==Object.keys(Timetracker.location.latLongParam).length){var obj=Timetracker.location.latLongParam;obj.hasOwnProperty("latitude")&&null!==obj.latitude&&void 0!==obj.latitude&&!isNaN(obj.latitude)&&obj.hasOwnProperty("longitude")&&null!==obj.longitude&&void 0!==obj.longitude&&!isNaN(obj.longitude)&&obj.hasOwnProperty("accuracy")&&null!==obj.accuracy&&void 0!==obj.accuracy&&!isNaN(obj.accuracy)&&(params.longitude=Timetracker.location.latLongParam.longitude,params.latitude=Timetracker.location.latLongParam.latitude,params.accuracy=Timetracker.location.latLongParam.accuracy)}id===Timetracker.constants.DAY?params.fromDate=Timetracker.DateTime.getDateinDBformat(datePeriod.day):(params.fromDate=Timetracker.DateTime.getDateinDBformat(datePeriod.from),params.toDate=Timetracker.DateTime.getDateinDBformat(datePeriod.to)),Timetracker.timelogs.listId&&(params.listId=Timetracker.timelogs.listId),isStartEndTypeAvail?Timetracker.timelogs.bulkView.constructBulkSaveModalPopup(params,{id:id}):Timetracker.timelogs.bulkView.sendBulkTLRequest(params,{id:id})},constructBulkSaveModalPopup:function(params,otherBulkDetails){var extraDetails={params:params,id:otherBulkDetails.id},header=ZPI18N.getString("zp.savechanges")+"?",body=ZPI18N.getString("zp.confirmsavepopup"),footer='<div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">'+ZPI18N.getString("zp.cancel")+'</button><button type="button" id="zp_modal_blubtn" class="btn btn-primary">'+ZPI18N.getString("zp.submit")+"</button></div>",modalLayout=Layout.Page.container.find("#zp_bulktimelog_type_warn");void 0!==modalLayout&&0!==modalLayout.length&&void 0!==modalLayout.data("extraDetails")&&modalLayout.data("extraDetails",extraDetails),ZPeople.BSModal.setup({id:"zp_bulktimelog_type_warn",type:2,header:header,body:body,footer:footer,buttonValue:ZPI18N.getString("zp.save"),modalClass:"ZPsecModal DelMdl fade",closeOnSubmit:!0,isConfirm:!1,successCallback:Timetracker.timelogs.bulkView.getParamsForBulkTLRequest,hiddenCallback:Timetracker.timelogs.bulkView.confirmSaveCancelCallback,extraDetails:extraDetails||{}})},getParamsForBulkTLRequest:function(modal){var extraDetails=modal.data("extraDetails");params=extraDetails.params;var otherBulkDetails={id:extraDetails.id};Timetracker.timelogs.bulkView.sendBulkTLRequest(params,otherBulkDetails)},confirmSaveCancelCallback:function(){for(var id=Timetracker.timelogs.bulkView.checkAddlogViewType(),typeId=(id===Timetracker.constants.DAY?"dai":id)+"lyLog",toShowErrTds=Layout.Page.container.find("#add"+typeId).find("tr>td>input[id^=daytxt][showerrlogtype='1']"),cnt=0;cnt<toShowErrTds.length;cnt++)""!==$(toShowErrTds[cnt]).val()&&$(toShowErrTds[cnt]).addClass("ztextbox__error");Layout.Page.container.find("#add"+(id===Timetracker.constants.DAY?"dai":id)+"lyLog").find("#submit_timelog").removeClass("disabled")},checkAddlogViewType:function(){return Layout.Page.container.find("#addmonthlyLog").is(":visible")?Timetracker.constants.MONTH:Layout.Page.container.find("#addhalfmonthlyLog").is(":visible")?Timetracker.constants.HALFWEEK:Layout.Page.container.find("#addweeklyLog").is(":visible")?Timetracker.constants.WEEK:Layout.Page.container.find("#adddailyLog").is(":visible")?Timetracker.constants.DAY:"none"},sendBulkTLRequest:function(params,otherBulkDetails){var id=otherBulkDetails.id;$.post("/timesheet.zp",params,function(resultData){var typeId=(id===Timetracker.constants.DAY?"dai":id)+"lyLog";Timetracker.util.unfreezeSubmit("timelogs_bulk_view","submit_timelog");var layout=Layout.Page.container.find("#timelogs_bulk_view").find("#"+id+"_viewlist");Timetracker.util.removeErrorMsg(null,layout);var resCode="",resMsg="",extra_dtl="";null!==resultData&&!resultData.res&&resultData.hasOwnProperty("errorCode")&&(resCode=resultData.errorCode,resultData.hasOwnProperty("extraDtls")&&(extra_dtl=resultData.extraDtls));var iterate=!1;if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_MANUALLOGDISABLED||resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_PERMISSIONDENIED)resMsg=Timetracker.Util.getFailureMessageByCode(resCode,extra_dtl,!0),Timetracker.util.showAlert(0,resMsg);else if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_ESTIMATEDHOURRESTRICT){(error=(resMsg=resultData.message).split(":")).length>1&&(tds=layout.find("select:has(option[value='"+error[1]+"']:selected)").parents("tr").find("td>input[id^=daytxt][textinput='"+typeId+"']"),iterate=!0),Timetracker.util.showAlert(0,ZPI18N.getString("zp.logalert3"))}else if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_MAXLOGHOURRESTRICT){if((error=(resMsg=resultData.message).split(":")).length>1)if(error[1].indexOf("_")>0){var datesplit=error[1].split("_"),dfrom=datesplit[0],dto=datesplit[1],tdsf=layout.find("input[id^=daytxt][textinput='"+typeId+"'][actualdate='"+dfrom+"']"),tdsto=layout.find("input[id^=daytxt][textinput='"+typeId+"'][actualdate='"+dto+"']");if(0!==tdsf.length&&0!==tdsto.length)for(var colstrt=tdsf.attr("id").split("daytxt")[1],colend=tdsto.attr("id").split("daytxt")[1],i=Number(colstrt);i<=Number(colend);i++){var daytxtid="daytxt";0!==i&&(daytxtid="daytxt"+i);for(var allinputs=layout.find("input[id="+daytxtid+"][textinput='"+typeId+"']"),j=0;j<allinputs.length;j++)""!==$(allinputs[j]).val()&&$(allinputs[j]).addClass("ztextbox__error")}}else tds=layout.find("input[id^=daytxt][textinput='"+typeId+"'][actualdate='"+error[1]+"']"),iterate=!0;Timetracker.util.showAlert(0,error[0])}else if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_PAYPERIOD||resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_BUDGET)resMsg=Timetracker.Util.getFailureMessageByCode(resCode,extra_dtl,!0),Timetracker.util.showAlert(0,resMsg);else if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_RESTRICTPASTTIMELOG||resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_LOGHOUREXCEEED24HR){var errorDate=extra_dtl.date,msg=resultData.message;errorDate.length>1&&(tds=layout.find("input[id^=daytxt][textinput='"+typeId+"'][actualdate='"+errorDate+"']"),iterate=!0),Timetracker.util.showAlert(0,msg)}else if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_RESTRICTFUTURETIMELOG){(error=extra_dtl.date).length>1&&(tds=layout.find("input[id^=daytxt][textinput='"+typeId+"'][actualdate='"+error+"']"),iterate=!0),Timetracker.util.showAlert(0,ZPI18N.getString("zp.entrieskippedfuturelog"))}else if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_RESTRICTTIMELOGINLEAVES){(error=extra_dtl.date).length>1&&(tds=layout.find("input[id^=daytxt][textinput='"+typeId+"'][actualdate='"+error+"']"),iterate=!0),Timetracker.util.showAlert(0,ZPI18N.getString("zp.entrieskippedleaves",[holiday_disName]))}else if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_ZEROHOURSRESTRICT){for(i=0;i<extra_dtl.length;i++){var errDate=extra_dtl[i].split(" ")[0],tds=layout.find("input[id^=daytxt][textinput='"+typeId+"'][actualdate='"+errDate+"']");for(j=0;j<tds.length;j++){var hrs=$(tds[j]).val();""!==hrs&&void 0!=hrs&&0==Timetracker.DateTime.convertToMins(hrs)&&$(tds[j]).addClass("ztextbox__error")}}Timetracker.util.showAlert(0,ZPI18N.getString("zp.logalert9"))}else if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_ATTENDANCEHOURS){(error=extra_dtl.date).length>1&&(tds=layout.find("input[id^=daytxt][textinput='"+typeId+"'][actualdate='"+error+"']"),iterate=!0),Timetracker.util.showAlert(0,ZPI18N.getString("zp.entrieskippedattHrs"))}else if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_JOBSCH_TL_RESTRICT){(error=extra_dtl.date).length>1&&(tds=layout.find("input[id^=daytxt][textinput='"+typeId+"'][actualdate='"+error+"']"),iterate=!0),Timetracker.util.showAlert(0,ZPI18N.getString("zp.entrieskippedtljsch"))}else if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_RESTRICTPRESENT_JOBPERIOD){var sdatename=(dateNameJson=Timetracker.util.getStartAndEnddateDisplayName(!0)).sdatename,edatename=dateNameJson.edatename;(error=extra_dtl.date).length>1&&(tds=layout.find("input[id^=daytxt][textinput='"+typeId+"'][actualdate='"+error+"']"),iterate=!0),Timetracker.util.showAlert(0,ZPI18N.getString("zp.logalert7",[Timetracker.util.getJobDisplayName(!0),sdatename,edatename]))}else if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_RESTRICTTIMELOGDATE_JOBPERIOD){var dateNameJson;sdatename=(dateNameJson=Timetracker.util.getStartAndEnddateDisplayName(!0)).sdatename,edatename=dateNameJson.edatename;(error=extra_dtl.date).length>1&&(tds=layout.find("input[id^=daytxt][textinput='"+typeId+"'][actualdate='"+error+"']"),iterate=!0),Timetracker.util.showAlert(0,ZPI18N.getString("zp.logalert6",[Timetracker.util.getJobDisplayName(!0),sdatename,edatename]))}else if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_TIMELOG_ENTRY_OVERLAP){if(resultData.showOverlapWarn)Timetracker.timelogs.constructWarnPopupForOverlap(params,Timetracker.timelogs.bulkView.overlapWarningBulkLogupdateCallback,{otherBulkDetails:otherBulkDetails,message:resultData.message});else(error=extra_dtl.date).length>1&&(tds=layout.find("input[id^=daytxt][textinput='"+typeId+"'][actualdate='"+error+"'],tr>td>[id^=daytimepicker][actualdate='"+error+"']>input[id^=timepickerfrom],tr>td>[id^=daytimepicker][actualdate='"+error+"']>input[id^=timepickerto]"),iterate=!0),Timetracker.util.showAlert(0,resultData.message)}else if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_TIMELOG_ENTRY_BREAK){var jobElement;if((error=extra_dtl.date).length>1)for(tds=layout.find("input[id^=daytxt][textinput='"+typeId+"'][actualdate='"+error+"'],tr>td>[id^=daytimepicker][actualdate='"+error+"']>input[id^=timepickerfrom],tr>td>[id^=daytimepicker][actualdate='"+error+"']>input[id^=timepickerto]"),i=0;i<tds.length;i++)extra_dtl.jobId?(jobElement=$(tds[i]).closest("tr").find("input[name='job']"),TimelyZComp.select.getValue(jobElement)===extra_dtl.jobId&&($(jobElement).addClass("ztextbox__error"),""!==$(tds[i]).val()&&$(tds[i]).addClass("ztextbox__error"))):""!==$(tds[i]).val()&&$(tds[i]).addClass("ztextbox__error");Timetracker.util.showAlert(0,resultData.message)}else if(resCode===Timetracker.constants.ERROR_CODES.TIMELOG.ER_TL_PREDOJ_RESTRICT){var error;(error=extra_dtl.date).length>1&&(tds=layout.find("input[id^=daytxt][textinput='"+typeId+"'][actualdate='"+error+"']"),iterate=!0),Timetracker.util.showAlert(0,ZPI18N.getString("zp.entrieskippedpredoj"))}else resCode===Timetracker.constants.ERROR_CODES.TIMELOG.TIMELOG_NO_NEWROW?Timetracker.util.showAlert(1,resultData.message):(Timetracker.util.showAlert(2,ZPI18N.getString("zp.timelogentryadded")),Timetracker.timelogs.bulkView.closeBulkView(!0),Timetracker.timelogs.resetTLFetch(!0));if(iterate)for(i=0;i<tds.length;i++)""!==$(tds[i]).val()&&$(tds[i]).addClass("ztextbox__error")})},overlapWarningBulkLogupdateCallback:function(extraDetails){var id,reqParams=extraDetails.params;reqParams.skipOverlapValidation=!0,reqParams.isFromWarnPopup=!0,extraDetails.additionalParams&&extraDetails.additionalParams.otherBulkDetails&&(id=extraDetails.additionalParams.otherBulkDetails.id),Timetracker.timelogs.bulkView.sendBulkTLRequest(reqParams,{id:id})},constructBulklogAddEditPopUp:function(obj,id,event){var currLayout=Timetracker.Util.getLayout(),bulklog_modal=currLayout.find("#bulklog_add_edit");0===bulklog_modal.length?(currLayout.append(Timetracker.timelogs.bulkView.constructBulklogAddEditPopUpModal()),bulklog_modal=currLayout.find("#bulklog_add_edit")):(Timetracker.isTTSthiftEnabled()?(TimelyZComp.datetimefield.destroy(bulklog_modal.find("#bulk_timelog_fromtime")),TimelyZComp.datetimefield.destroy(bulklog_modal.find("#bulk_timelog_totime"))):(TimelyZComp.timeField.destroy(bulklog_modal.find("#bulk_timelog_fromtime")),TimelyZComp.timeField.destroy(bulklog_modal.find("#bulk_timelog_totime"))),bulklog_modal.find("#bulk_timelog_hrstime").removeClass("ztextbox__error"),bulklog_modal.find("#bulklog_submit").removeClass("disabled"),bulklog_modal.find("#error_msg").remove()),bulklog_modal.find("#bulk_timelog_hrstime").off("keyup").on("keyup",function(){$(this).removeClass("ztextbox__error"),bulklog_modal.find("#bulklog_submit").removeClass("disabled"),""===$(this).val()||$(this).val().match(Timetracker.util.maxhrsRegex)||($(this).addClass("ztextbox__error"),bulklog_modal.find("#bulklog_submit").addClass("disabled"))}),bulklog_modal.on("zpopoverclose",function(){bulklog_modal.remove()}),bulklog_modal.find("#bulklog_submit").off("click").on("click",function(){0!=Timetracker.timelogs.bulkView.submitBulkLogAddEditCallback(obj,id,bulklog_modal)&&ZPeopleComponents.popover("#bulklog_add_edit").close()}),bulklog_modal.find("#bulk_timelog_hrs").parent().removeClass("zpl_DNI"),bulklog_modal.find("#bulk_timelog_hrs").prop("checked",!0),bulklog_modal.find("#bulk_timelog_hrstime").val("").attr("oldValue",""),bulklog_modal.find("#bulk_timelog_hrs").click();var isShiftEnabled=Timetracker.isTTSthiftEnabled();if(isShiftEnabled){var pickerOptions={},shiftDate=$(obj).attr("date"),logDate=Calendar.parseDate(shiftDate,"%Y-%m-%d"),minMax=new Date(logDate.getTime());minMax.setDate(logDate.getDate()-1),pickerOptions.minDate=Calendar.formatDate(minMax).toString(),minMax.setDate(logDate.getDate()+1),pickerOptions.maxDate=Calendar.formatDate(minMax).toString();var attr={pickerOptions:pickerOptions,value:logDate};TimelyZComp.datetimefield.intialize(bulklog_modal.find("#bulk_timelog_fromtime"),attr),TimelyZComp.datetimefield.intialize(bulklog_modal.find("#bulk_timelog_totime"),attr),bulklog_modal.find(".zpl_breakpop").addClass("zpl_w600")}else{var opt={clearButton:"none",className:"w120"};opt.format=timeFormat.replace("a","tt"),opt.value=Timetracker.DateTime.getUserTimeZoneCurrDateTime(),TimelyZComp.timeField.intialize(bulklog_modal.find("#bulk_timelog_fromtime"),opt),TimelyZComp.timeField.intialize(bulklog_modal.find("#bulk_timelog_totime"),opt)}if(""!==$(obj).val())if($(obj).attr("interval")&&""!==$(obj).attr("interval")){var timeVal=$(obj).attr("interval").split("T");bulklog_modal.find("#bulk_timelog_hrs").prop("checked",!0),bulklog_modal.find("#bulk_timelog_start_end").prop("checked",!1),bulklog_modal.find("#bulk_timelog_start_end").click(),isShiftEnabled?(TimelyZComp.datetimefield.setValue(bulklog_modal.find("#bulk_timelog_fromtime"),Timetracker.util.getShiftDatebyTime(timeVal[0],logDate,Timetracker.constants.MINUTES)),TimelyZComp.datetimefield.setValue(bulklog_modal.find("#bulk_timelog_totime"),Timetracker.util.getShiftDatebyTime(timeVal[1],logDate,Timetracker.constants.MINUTES))):(TimelyZComp.timeField.setValue(bulklog_modal.find("#bulk_timelog_fromtime"),Calendar.minstotimeFormat(timeVal[0])),TimelyZComp.timeField.setValue(bulklog_modal.find("#bulk_timelog_totime"),Calendar.minstotimeFormat(timeVal[1])))}else bulklog_modal.find("#bulk_timelog_hrstime").val($(obj).val()),bulklog_modal.find("#bulk_timelog_hrstime").attr("oldValue",$(obj).val());!$(obj).closest("tr").hasClass("breakRow")&&Timetracker.generalSettings.isManualLogAllowed(Timetracker.timelogs.tserecno)||(bulklog_modal.find("#bulk_timelog_hrs").parent().addClass("zpl_DNI"),bulklog_modal.find("#bulk_timelog_hrs").prop("checked",!1),bulklog_modal.find("#bulk_timelog_start_end").prop("checked",!0),bulklog_modal.find("#bulk_timelog_start_end").click()),bulklog_modal.find("#log_hrs_span").text(""!==$(obj).val()?$(obj).val():"00:00"),$(obj).blur();var popJson={forElement:event.target,type:"modal",open:function(){var hrsInpId="";""!==(hrsInpId=bulklog_modal.find("#bulk_timelog_hrs").is(":visible")?"bulk_timelog_hrstime":"bulk_timelog_start_end_time")&&setTimeout(()=>{bulklog_modal.find("#"+hrsInpId).focus()},100)}};ZPeopleComponents.popover("#bulklog_add_edit",popJson).open(),Timetracker.timelogs.bulkView.setBulklogAddEditPopUpModalPosition(obj,bulklog_modal),Timetracker.timelogs.bulkView.registerBulkViewEvents(bulklog_modal,"ENTERHRSINPUT")},setBulklogAddEditPopUpModalPosition:function(obj,bulklog_modal){var modalWidth=Timetracker.isTTSthiftEnabled()?610:410,top_adjustment=Timetracker.isTTSthiftEnabled()?75:70;"ts_teamuser"===Timetracker.Page.getPageMode()&&(top_adjustment=140),$(document).find("#welcomebanner").is(":visible")&&(top_adjustment+=40);var left=$(obj).offset().left-0-modalWidth;left<0&&(left=$(obj).offset().left-90,$(bulklog_modal).find("#hoursDispBox").css({left:"0px",right:"auto","margin-left":"-1px"}));var top=$(obj).offset().top-top_adjustment;$(bulklog_modal).attr("style",$(bulklog_modal).attr("style")+"; left: "+left+"px; top: "+top+"px !important")},constructBulklogAddEditPopUpModal:function(isLocJobSch){var modal='<div id="bulklog_add_edit" class="zpl_popovr zpl_logcuspopovr zpopover" data-type="modal" data-display-type="box"><div class="zpl_breakpop"><div class="d-flexC"><h5>'+ZPI18N.getString("zp.timelogtype")+'</h5> <div class="MLauto"> </div></div><div id="hoursDispBox" class="zpl_bblpop"><span id="log_hrs_span"></span></div><div class="zpl_crd M0I"> <div class="zpl_crdcnt"> <div><div class="zpl_idiv zradiobutton" id="bulk_timelog_type"><div class="zradiobutton zradiobutton--horizontal"><input name="timelogTime" id="bulk_timelog_hrs" type="radio" value="0" class="zradiobutton__helper" onclick="Timetracker.timelogs.showHideTimeLogTimer(\'0\', \'bulklog_add_edit\');"><label for="bulk_timelog_hrs" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.stotalhours")+'</span></label> </div><div class="zradiobutton zradiobutton--horizontal"><input id="bulk_timelog_start_end" type="radio" name="timelogTime" class="zradiobutton__helper" value="1" onclick="Timetracker.timelogs.showHideTimeLogTimer(\'1\', \'bulklog_add_edit\');"><label for="bulk_timelog_start_end" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.startandend")+'</span></label></div> </div><div class="zpl_gbox" id="bulk_timelog_hours_time"><div><input type="text" id="bulk_timelog_hrstime" class="ztextbox w100" value="00:00" placeholder="00:00"></div></div><div class="zpl_gbox" id="bulk_timelog_start_end_time"><div class="d-flexclmcap5 a-itm-cntr">';return modal+=isLocJobSch?'<div class="zpl_ttlgcustflds"><input id="bulk_timelog_fromtime" type="text" value="00:00"><div class="zpl_ttlgdrpdwn"><span id="bulk_timelog_fromselect" class="w120"></span></div></div><em>-</em><div class="zpl_ttlgcustflds"><input id="bulk_timelog_totime" type="text" value="00:00"><div class="zpl_ttlgdrpdwn"><span id="bulk_timelog_toselect" class="w120"></span></div></div>':'<input id="bulk_timelog_fromtime" type="text" value="00:00"><em>-</em><input id="bulk_timelog_totime" class="form-control" type="text" value="00:00">',modal+='</div></div><div class="zpl_secn"><button type="button" class="zlabel zlabel--blue zlabel--medium" id="bulklog_submit">'+ZPI18N.getString("zp.confirm")+"</button></div></div></div>",$(modal)},showHideDescPopup:function(ele){var td=$(ele).closest("td");td.find('[name="descPopup"]').is(":visible")?Timetracker.timelogs.closeDescPopup():(ZPeopleComponents.isComponent(td.find('[name="descPopup"]'))||ZPeopleComponents.popover(td.find('[name="descPopup"]'),{displayType:"callout",closeOnBodyClick:!0,forElement:ele}),ZPeopleComponents.popover(td.find('[name="descPopup"]')).open())},weekMonthDescSelectDate:function(obj,rowNo){$(obj).parent().find(".zpl_act").removeClass("zpl_act"),$(obj).addClass("zpl_act");var descDiv=$(obj).parent().parent().find("#tab"+rowNo);descDiv.parent().find(".zpl_act").removeClass("zpl_act"),descDiv.addClass("zpl_act")},weekMonthDescSubmit:function(id,obj,param){var layout=Layout.Page.container.find("#timelogs_bulk_view");if(param)desc=obj;else var desc=layout.find(obj).parents(".zpl_rgtlst").find("[id^="+id+"lydesctxt]");for(var td_desc=layout.find(obj).closest("td"),icon=td_desc.find("[name='descIcon']"),flag=0,cont=td_desc.find('[name="descPopup"]'),i=0;i<desc.length;i++){var sub_cont=$(desc[i]).parent().siblings("."+id+"desc_errmsg");if($(desc[i]).val().length>15e3){if(!(param&&!param["day"+(i+1)])){if(param&&!$(icon).parent().hasClass("open")&&$(icon).dropdown("toggle"),!$(sub_cont)[0]){var err_msg='<div class="zpl_list_btm zpl_whtbg '+id+'desc_errmsg"><p class = "ellipsis red W220 PAI">'+ZPI18N.getString("zp.descriptioncharlimit",["15000"])+"</div>";$(err_msg).insertAfter($(desc[i]).parent())}$(cont).find("#tab"+(i+1)).addClass("zpl_act").siblings().removeClass("zpl_act"),$(cont).find("#tabs"+(i+1)).addClass("zpl_act").siblings().removeClass("zpl_act"),$(desc[i]).addClass("ztextbox__error"),$(cont).find("#tabs"+(i+1))[0].scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),flag=2;break}}else{if(""!==$(desc[i]).val().trim()){flag=4===flag?4:1;var des=$(desc[i]).val();param&&param.hasOwnProperty("day"+[i+1])&&(param["desc"+(i+1)]=des,$(desc[i]).attr("desc")!=des&&(flag=4))}else{if(Timetracker.timelogCustomization.isTLFieldMandatory(Timetracker.constants.DESC))if(!(void 0===param||!param["day"+(i+1)]||"00:00"===param["day"+(i+1)])){flag=3;break}param&&param.hasOwnProperty("day"+[i+1])&&void 0!=$(desc[i]).attr("desc")&&""!=$(desc[i]).attr("desc")&&(param["desc"+(i+1)]="",flag=4)}$(desc[i]).hasClass("ztextbox__error")&&$(desc[i]).removeClass("ztextbox__error"),$(sub_cont)[0]&&$(sub_cont).remove()}}if(param)return flag;0===flag?$(icon).removeClass("blu"):$(icon).removeClass("red").addClass("blu"),2!==flag&&ZPeopleComponents.popover(td_desc.find('[name="descPopup"]')).close()},dataChangedCheck:function(){for(var layout=Layout.Page.container.find("#timelogs_bulk_view"),id=layout.find("#tl_datePicker").attr("type"),logRows=layout.find("#"+id+"_viewlist").find("tr"),isOnlyFromToTimeLogAllowed=Timetracker.generalSettings.isOnlyFromToTimeLogAllowed(Timetracker.timelogs.tserecno),defaultbillableStatus=Timetracker.generalSettings.getDefaultBillableStatus(Timetracker.timelogs.tserecno),i=0;i<logRows.length;i++){var timelog=$(logRows[i]).data();if(!Timetracker.BreakTimelogs.isBreakLog("DATA",timelog)||Timetracker.timelogs.bulkView.showEditBreakRowInBulkLogs()){var jobIdObj=$(logRows[i]).find("#"+id+"jobselect"+(i+1)),oldJobId=jobIdObj.attr("oldjobid"),jobId=($(logRows[i]).hasClass("breakRow"),TimelyZComp.select.getValue(jobIdObj));if(void 0!=oldJobId&&oldJobId!=jobId||void 0==oldJobId&&"0"!=jobId)return!0;if(void 0==oldJobId){var proj=$(logRows[i]).find('[name="project"]');if(0!=proj.length&&ZPeopleComponents.isComponent(proj)&&"0"!=TimelyZComp.select.getValue(proj)&&""!=TimelyZComp.select.getValue(proj))return!0;var client=$(logRows[i]).find('[name="client"]');if(0!=client.length&&ZPeopleComponents.isComponent(client)&&"0"!=TimelyZComp.select.getValue(client)&&""!=TimelyZComp.select.getValue(client))return!0;if(0!=(billStatus=$(logRows[i]).find('[name="bill_status"]')).length&&ZPeopleComponents.isComponent(billStatus)&&TimelyZComp.select.getValue(billStatus)!=defaultbillableStatus)return!0;var wrkitem=$(logRows[i]).find('[name="workitem"]');if(0!=billStatus.length){if(ZPeopleComponents.isComponent(wrkitem)&&"0"!=ZPeople.decodeTxt(TimelyZComp.select.getValue(wrkitem))&&""!=ZPeople.decodeTxt(TimelyZComp.select.getValue(wrkitem)))return!0;if(!ZPeopleComponents.isComponent(wrkitem)&&""!=wrkitem.val())return!0}}else{var billStatus,oldBill=$(logRows[i]).attr("oldbillablestat");if(0!=(billStatus=$(logRows[i]).find('[name="bill_status"]')).length&&ZPeopleComponents.isComponent(billStatus)&&TimelyZComp.select.getValue(billStatus)!=oldBill)return!0;var oldtsk=$(logRows[i]).attr("orgtaskname")||"";if(oldtsk=ZPeople.decodeTxt(oldtsk),0!=(wrkitem=$(logRows[i]).find('[name="workitem"]')).length)if(ZPeopleComponents.isComponent(wrkitem)){var wival=ZPeople.decodeTxt(TimelyZComp.select.getValue(wrkitem));if((wival="0"==wival?"":wival)!=oldtsk)return!0}else if(!ZPeopleComponents.isComponent(wrkitem)&&wrkitem.val()!=oldtsk)return!0}var logInputRows=$(logRows[i]).find("input[textinput="+(id===Timetracker.constants.DAY?"dai":id)+"lyLog]");isOnlyFromToTimeLogAllowed&&(logInputRows=$(logRows[i]).find("span[id^=daytimepicker]"));var fromTimeVal,toTimeVal,txtarea=$(logRows[i]).find("textarea"),isValidHours=!1,j=id===Timetracker.constants.DAY?2:1;for(isOnlyFromToTimeLogAllowed&&(j=0);j<logInputRows.length;j++){var newLog=!1,logInputRow=logInputRows[j],showFromToTime=isOnlyFromToTimeLogAllowed,logType=id===Timetracker.constants.DAY?$(logRows[i]).attr("logtype"):$(logInputRow).attr("logtype");showFromToTime&&void 0!==logType&&1!=logType&&(showFromToTime=!1,logInputRow=$(logInputRow).parent().find("input[id^=daytxt]"));var logId=id===Timetracker.constants.DAY?$(logRows[i]).attr("timelogid"):$(logInputRow).attr("timelogid");if(void 0!==logId&&null!==logId&&""!==logId||(newLog=!0),showFromToTime){if(id===Timetracker.constants.DAY?$(logRows[i]).attr("logtype",1):$(logInputRow).attr("logtype",1),fromTimeVal=$(logInputRow).find("[id^=timepickerfrom]").val().trim(),toTimeVal=$(logInputRow).find("[id^=timepickerto]").val().trim(),!(isValidHours=""!==fromTimeVal&&""!==toTimeVal)&&(""===fromTimeVal&&""!==toTimeVal||""!==fromTimeVal&&""===toTimeVal))return!0}else{if(""!==$(logInputRow).val()&&!$(logInputRow).val().match(Timetracker.util.maxhrsRegex))return!0;isValidHours=""!==$(logInputRow).val()}if(newLog&&isValidHours)return!0;if(isValidHours){var currtime,approvalStatus=id===Timetracker.constants.DAY?$(logRows[i]).attr("approvalStatus"):$(logInputRow).attr("approvalStatus"),billingStatus=id===Timetracker.constants.DAY?$(logRows[i]).attr("billingStatus"):$(logInputRow).attr("billingStatus"),currFromTime=(logType=id===Timetracker.constants.DAY?$(logRows[i]).attr("logtype"):$(logInputRow).attr("logtype"),""),currToTime="";if(approvalStatus&&-2!=approvalStatus||billingStatus&&0!=billingStatus||logType&&"2"===logType){!0;continue}if(showFromToTime){var oldFromTime=id===Timetracker.constants.DAY?$(logRows[i]).attr("oldfromtime"):$(logInputRow).attr("oldfromtime"),oldToTime=id===Timetracker.constants.DAY?$(logRows[i]).attr("oldtotime"):$(logInputRow).attr("oldtotime");if(currFromTime=Timetracker.util.getTotalTimeForHours(fromTimeVal.split(":")),currtime=(currToTime=Timetracker.util.getTotalTimeForHours(toTimeVal.split(":")))>=currFromTime?currToTime-currFromTime:currToTime+Timetracker.constants.PER_DAY_MIN-currFromTime,currtime=Calendar.minstohrs(currtime),oldFromTime!=currFromTime||oldToTime!=currToTime)return!0}else{var oldtime=id===Timetracker.constants.DAY?$(logRows[i]).attr("oldtime"):$(logInputRow).attr("oldtime");if(currtime=$(logInputRow).val(),void 0!==oldtime&&null!=oldtime&&oldtime!==currtime)return!0;if(newLog&&""!=currtime)return!0;if(1==logType&&(currFromTime=id===Timetracker.constants.DAY?$(logRows[i]).attr("newfromtime"):$(logInputRow).attr("newfromtime"),currToTime=id===Timetracker.constants.DAY?$(logRows[i]).attr("newtotime"):$(logInputRow).attr("newtotime"),void 0!==currFromTime&&void 0!==currToTime)){currFromTime=parseInt(currFromTime),currToTime=parseInt(currToTime);oldFromTime=id===Timetracker.constants.DAY?$(logRows[i]).attr("oldfromtime"):$(logInputRow).attr("oldfromtime"),oldToTime=id===Timetracker.constants.DAY?$(logRows[i]).attr("oldtotime"):$(logInputRow).attr("oldtotime");if(currtime=currToTime>=currFromTime?currToTime-currFromTime:currToTime+Timetracker.constants.PER_DAY_MIN-currFromTime,currtime=Calendar.minstohrs(currtime),oldFromTime!=currFromTime||oldToTime!=currToTime)return!0}}!0}}if("1"===Timetracker.generalSettings.timelogEnabledFields.TLC_Desc)if(id===Timetracker.constants.DAY){var descDiv=$(logRows[i]).find("input[id$=desctxt]"),descVal=$(descDiv).val();if(descVal.length>15e3)return!0;if(""!==descVal&&$(descDiv).attr("description")!=descVal)return!0}else if(Timetracker.timelogs.bulkView.weekMonthDescChangeCheck(id,txtarea))return!0}}return!1},weekMonthDescChangeCheck:function(id,desc){for(var i=0;i<desc.length;i++){if($(desc[i]).val().length>15e3)return!0;var prevDesc=$(desc[i]).attr("desc");if(""!==$(desc[i]).val().trim()){var des=$(desc[i]).val();if(void 0==prevDesc||void 0!=prevDesc&&prevDesc!=des)return!0}else if(void 0!=prevDesc&&""!=prevDesc)return!0}return!1}},Timetracker.UserSpace={selectedUser:null,isMySpace:function(){return-1!==window.location.hash.indexOf("home/myspace/overview")},isMySpaceTimelogs:function(){return-1!==window.location.hash.indexOf("home/myspace/overview-timelogs")},isMySpaceTimesheets:function(){return-1!==window.location.hash.indexOf("home/myspace/overview-timesheets")},isMySpaceActionList:function(){return-1!==window.location.hash.indexOf("home/myspace/overview-actionlist")},getSelectedUser:function(){return null===Timetracker.UserSpace.selectedUser?erecno:Timetracker.UserSpace.selectedUser},setSelectedUser:function(userId){Timetracker.UserSpace.selectedUser=userId}},Timetracker.UserSpace.Timesheets={firescrollMode:"TT_USERSPACE_TIMESHEETS",firescrollLimit:25,refreshData:!0,init:function(container,params){if(Timetracker.UserSpace.Timesheets.refreshData||"ts_homeuser"==Timetracker.Page.getPageMode()){$(container).html("");let pageContainerId=$(container).attr("id");Timetracker.UserSpace.isMySpaceTimesheets()||Timetracker.Team.setSelectedUser(params.erecno),Timetracker.initSetup(),Timetracker.timesheet.approvalConfig(),Timetracker.Util.showHideNoData({remove:!0}),Timetracker.util.appendLoading(null,{divId:pageContainerId,layout:Layout.Page.parentContainer});let requestParams=Timetracker.UserSpace.Timesheets.getRequestParams(params.erecno);d=Calendar.getCurrentMonth(),requestParams.fromDate=Calendar.formatDate(d.from),requestParams.toDate=Calendar.formatDate(d.to),ZPeople.Request.send(Timetracker.constants.URL,requestParams,function(response){if(ZPeople.FireScroll.setParam("triggered",!0,Timetracker.UserSpace.Timesheets.firescrollMode),Timetracker.util.removeLoading(),response&&response.timesheetArr&&0!==response.timesheetArr.length){let htmlTemplate=$('<div class="zpl_msplst" id="timesheet-listtbody"></div>');$.each(response.timesheetArr,function(index,data){let timesheetDiv=$(Timetracker.UserSpace.Timesheets.constructTimesheetRow(data));timesheetDiv.data("tsval",data),timesheetDiv.on("mouseover",function(){timesheetDiv.find("[name = tsButton]").length>0&&(timesheetDiv.find("[name = tsStatus]").hide(),timesheetDiv.find("[name = tsButton]").removeClass("DN").addClass("d-flex"))}),timesheetDiv.on("mouseleave",function(){timesheetDiv.find("[name = tsButton]").removeClass("d-flex").addClass("DN"),timesheetDiv.find("[name = tsStatus]").show()}),htmlTemplate.append(timesheetDiv)});let tsHeader=$('<div class="zpl_gbox"><span aria-label="'+ZPI18N.getString("zp.timesheets")+" "+ZPI18N.getString("zp.tt_thismonth")+'" tabindex="0"><em><b>'+ZPI18N.getString("zp.timesheets")+'</b></em><em class="zpl_dots sm"></em><em>'+ZPI18N.getString("zp.tt_thismonth")+"</em></span></div>");$(container).append(tsHeader),$(container).append(htmlTemplate),$(container).attr({"aria-label":ZPI18N.getString("zp.common.myspacetab",[ZPI18N.getString("zp.timesheets")]),tabindex:"0"}),$(container).focus(),ZPeople.FireScroll.setRecordCount(response.timesheetArr.length,Timetracker.UserSpace.Timesheets.firescrollMode),response.timesheetArr.length===Timetracker.UserSpace.Timesheets.firescrollLimit&&ZPeople.FireScroll.reset(Timetracker.UserSpace.Timesheets.firescrollMode)}else Timetracker.Util.showHideNoData({appendToDiv:!0,msg:ZPI18N.getString("zp.notaddedforrange",[ZPI18N.getString("zp.stimesheets"),ZPI18N.getString("zp.scurrentmonth")]),layout:container})}),Timetracker.UserSpace.Timesheets.refreshData=!Timetracker.UserSpace.isMySpaceTimesheets()}},timesheetRowReplace:function(oldRow,data){let timesheetDiv=$(Timetracker.UserSpace.Timesheets.constructTimesheetRow(data));timesheetDiv.data("tsval",data),timesheetDiv.on("mouseover",function(){timesheetDiv.find("[name = tsButton]").length>0&&(timesheetDiv.find("[name = tsStatus]").hide(),timesheetDiv.find("[name = tsButton]").removeClass("DN").addClass("d-flex"))}),timesheetDiv.on("mouseleave",function(){timesheetDiv.find("[name = tsButton]").removeClass("d-flex").addClass("DN"),timesheetDiv.find("[name = tsStatus]").show()}),$(oldRow).replaceWith(timesheetDiv)},getRequestParams:function(userId){return{mode:"getTimesheetList",tslstatus:-3,tslerecno:userId,isCountNeeded:!1,sIndex:0,limit:Timetracker.UserSpace.Timesheets.firescrollLimit,conreqcsr:csrfToken}},constructTimesheetRow:function(data){var appClass="",appTitle="";1!==data.status||data.isPartiallyApproved?1===data.status&&data.isPartiallyApproved?(appClass="org",appTitle=ZPI18N.getString("zp.partiallyapproved")):0===data.status?(appClass="red",appTitle=ZPI18N.getString("zp.rejected")):-1===data.status?(appClass="org",appTitle=ZPI18N.getString("zp.pending")):-2===data.status&&(appClass="",appTitle=ZPI18N.getString("zp.draft")):(appClass="grn",appTitle=ZPI18N.getString("zp.approved"));let approvalStatus='<div class="d-flexclmcap10" name="tsStatus">',approveButton="";1===data.status?approvalStatus+='<div class="d-flexclmcap8 d-flexC CP '+appClass+'" onclick="Timetracker.UserSpace.Timesheets.viewTimesheet(\''+data.formId+"', '"+data.recordId+"')\">"+appTitle+"</div>":-1===data.status?approvalStatus+='<div class="d-flexclmcap8 d-flexC CP '+appClass+'" onclick="Timetracker.UserSpace.Timesheets.viewTimesheet(\''+data.formId+"', '"+data.recordId+"')\">"+appTitle+"</div>":(approvalStatus+='<div class="d-flexclmcap8 d-flexC '+appClass+'">'+appTitle+"</div>",ZPeople.Module.MODULE_DATA.timetracker.isApprovalConf&&(approveButton+='<div class="DN" name="tsButton"><button class="zlabel zlabel--outline zlabel--medium zlabel--blue" onclick="Timetracker.UserSpace.Timesheets.viewTimesheet(\''+data.formId+"', '"+data.recordId+"')\">"+(0===data.status?ZPI18N.getString("zp.resendforapproval"):ZPI18N.getString("zp.sendforapproval"))+"</button></div>")),approvalStatus+="</div>";let submittedHours=0,submittedMins=0;data.totalHours&&(submittedMins=data.totalHours%60,submittedHours=(data.totalHours-submittedMins)/60);let approvedHours=0,approvedMins=0;data.approvedTotalHours&&(approvedMins=data.approvedTotalHours%60,approvedHours=(data.approvedTotalHours-approvedMins)/60);let totalHours='<div class="zpl_compoffar w150">';if(-2!==data.status){var approvedHrs=approvedHours+" "+ZPI18N.getString("zp.hrs")+", "+approvedMins+" "+ZPI18N.getString("zp.mins");totalHours+='<span class="zpl_progtitle" aria-label="'+ZPI18N.getString("zp.submittedhrs")+'" tabindex="0"><em>'+ZPI18N.getString("zp.submittedhrs")+"</em></span><div><span><b>"+submittedHours+" "+ZPI18N.getString("zp.hrs")+", "+submittedMins+" "+ZPI18N.getString("zp.mins")+'</b></span></div></div><div class=zpl_compoffar w150"><span class="zpl_progtitle"><em>'+ZPI18N.getString("zp.approvedhrs")+'</em></span><div><span aria-label="'+approvedHrs+'" tabindex="0"><b>'+approvedHrs+"</b></span></div></div>"}else{var submittedHrs=submittedHours+" "+ZPI18N.getString("zp.hrs")+", "+submittedMins+" "+ZPI18N.getString("zp.mins");totalHours+='<span class="zpl_progtitle" aria-label="'+ZPI18N.getString("zp.totalhours")+'" tabindex="0"><em>'+ZPI18N.getString("zp.totalhours")+'</em></span><div><span aria-label="'+submittedHrs+'" tabindex=""><b>'+submittedHrs+"</b></span></div></div>"}return'<div id="list-'+data.recordId+'"><div class="zpl_msp-dts CP" onclick="Timetracker.UserSpace.Timesheets.viewTimesheet(\''+data.formId+"', '"+data.recordId+'\')"><div class="zpl_msp-name"><span class="zpl_msp-title" aria-label="'+data.timesheetName+'" tabindex="0">'+data.timesheetName+'</span></div><div class="d-flexclmcap5" aria-label="'+data.fromDate+"-"+data.toDate+'" tabindex="0"><em>'+data.fromDate+"</em>-<em>"+data.toDate+"</em></div></div>"+totalHours+'<div class="zpl_msp-act">'+approvalStatus+approveButton+"</div>"},viewTimesheet:function(formId,listId){Timetracker.timesheet.getTimesheetDetails(formId,listId)},loadMoreData:function(details){let requestParams=Timetracker.UserSpace.Timesheets.getRequestParams(details.erecno);requestParams.sIndex=ZPeople.FireScroll.getRecordCount(Timetracker.UserSpace.Timesheets.firescrollMode)+1,ZPeople.Request.send(Timetracker.constants.URL,requestParams,function(response){if(response&&response.timesheetArr&&0!==response.timesheetArr.length){var container=details.scrollDiv.find("#"+details.pageContainerId).find(".zpl_msplst");$.each(response.timesheetArr,function(index,data){let timesheetDiv=$(Timetracker.UserSpace.Timesheets.constructTimesheetRow(data));timesheetDiv.data("tsval",data),container.append(timesheetDiv)}),ZPeople.FireScroll.increaseRecordCount(response.timesheetArr.length,Timetracker.UserSpace.Timesheets.firescrollMode),response.timesheetArr.length===Timetracker.UserSpace.Timesheets.firescrollLimit&&ZPeople.FireScroll.reset(Timetracker.UserSpace.Timesheets.firescrollMode)}})}},Timetracker.UserSpace.Jobs={firescrollMode:"TT_USERSPACE_JOBS",firescrollLimit:25,init:function(container,params){$(container).find("#activeJobsDiv").length>0&&$(container).find("#activeJobsDiv").remove(),$(container).find("#overdueJobsDiv").length>0&&$(container).find("#overdueJobsDiv").remove(),$(container).find("#pageloader").length>0&&$(container).find("#pageloader").remove();let pageContainerId=$(container).attr("id");Timetracker.initSetup(),Timetracker.UserSpace.isMySpace()||Timetracker.Team.setSelectedUser(params.erecno),Timetracker.Util.showHideNoData({remove:!0}),Timetracker.util.appendLoading(null,{divId:pageContainerId,layout:Layout.Page.parentContainer});let requestParams=Timetracker.UserSpace.Jobs.getRequestParams(params.erecno);$(container).attr({"aria-label":ZPI18N.getString("zp.common.myspacetab",[ZPeople.decodeTxt(Timetracker.jobs.formDetails.formDispName)]),tabindex:"0"}),$(container).focus(),ZPeople.Request.send(Timetracker.constants.URL,requestParams,function(response){if(ZPeople.FireScroll.setParam("triggered",!0,Timetracker.UserSpace.Jobs.firescrollMode),response&&response.schArr&&0!==response.schArr.length){let htmlTemplate=$('<div class="zpl_msplst"></div>');$.each(response.schArr,function(index,data){let jobDiv=$(Timetracker.UserSpace.Jobs.constructJobRow(data));jobDiv.data("schval",data),htmlTemplate.append(jobDiv)});let jobHeader=$('<div class="zpl_gbox"><span aria-label="'+ZPI18N.getString("zp.active")+" "+Timetracker.util.jobDispName+" "+ZPI18N.getString("zp.thisweek")+'" tabindex="0"><em><b>'+ZPI18N.getString("zp.active")+" "+Timetracker.util.jobDispName+'</b></em><em class="zpl_dots sm"></em><em>'+ZPI18N.getString("zp.thisweek")+"</em></span></div>");Timetracker.util.removeLoading();let activeJobWrapper=$('<div id="activeJobsDiv"></div>');activeJobWrapper.append(jobHeader),activeJobWrapper.append(htmlTemplate),$(container).append(activeJobWrapper),ZPeople.FireScroll.setRecordCount(response.schArr.length,Timetracker.UserSpace.Jobs.firescrollMode),response.schArr.length===Timetracker.UserSpace.Jobs.firescrollLimit&&ZPeople.FireScroll.reset(Timetracker.UserSpace.Jobs.firescrollMode)}let getOverdueJobParams=Timetracker.UserSpace.Jobs.getOverdueJobsParams(params.erecno);ZPeople.Request.send(Timetracker.constants.URL,getOverdueJobParams,function(resp){if(ZPeople.FireScroll.setParam("triggered",!0,Timetracker.UserSpace.Jobs.firescrollMode),Timetracker.util.removeLoading(),resp&&resp.schArr&&0!==resp.schArr.length){let overdueTemplate=$('<div class="zpl_msplst"></div>');$.each(resp.schArr,function(index,data){let overdueJobDiv=$(Timetracker.UserSpace.Jobs.constructJobRow(data));overdueTemplate.append(overdueJobDiv)});let overdueJobHeader=$('<div class="zpl_gbox"><span><em><b>'+ZPI18N.getString("zp.overdue")+" "+Timetracker.util.jobDispName+'</b></em><em class="zpl_dots sm"></em><em>'+ZPI18N.getString("zp.thisweek")+"</em></span></div>"),overdueJobWrapper=$('<div id="overdueJobsDiv"></div>');overdueJobWrapper.append(overdueJobHeader),overdueJobWrapper.append(overdueTemplate),$(container).append(overdueJobWrapper)}else if(!response||!response.schArr||0===response.schArr.length){let activJobDisp=ZPI18N.getString("zp.active").toLowerCase()+" "+(Timetracker.util.jobDispName===ZPI18N.getString("zp.jobs")?Timetracker.util.jobDispName.toLowerCase():Timetracker.util.jobDispName);Timetracker.Util.showHideNoData({appendToDiv:!0,msg:ZPI18N.getString("zp.notfoundforrange",[activJobDisp,ZPI18N.getString("zp.scurrentweek")])})}})})},getRequestParams:function(userId){var d=Calendar.getCurrentWeek();let getActiveJobsInDate={activeJobfDate:Calendar.formatDate(d.from),activeJobtDate:Calendar.formatDate(d.to)};return{mode:"getSchedule",submode:"schedule",jobStatus:"0",projectId:"0",assignedBy:"0",assignedTo:userId,fetchLoggedHrs:!0,getCurrentUserPendingJobCount:!1,getActiveJobsInDate:JSON.stringify(getActiveJobsInDate),sIndex:0,limit:Timetracker.UserSpace.Jobs.firescrollLimit,conreqcsr:csrfToken}},getOverdueJobsParams:function(userId){var d=Calendar.getCurrentWeek();let overDueJobParams={fetchOverdueJobs:!0,overduefDate:Calendar.formatDate(d.from),overduetDate:Calendar.formatDate(d.to)};return{mode:"getSchedule",jobStatus:"0",projectId:"0",assignedTo:userId,fetchLoggedHrs:!0,overDueJobParams:JSON.stringify(overDueJobParams),sIndex:0,limit:Timetracker.UserSpace.Jobs.firescrollLimit,conreqcsr:csrfToken}},constructJobRow:function(data){let period="";(data.fromDate||data.toDate)&&(period='<div class="d-flexclmcap5"><em>'+(data.fromDate?data.fromDate:ZPI18N.getString("zp.nostartdate"))+"</em>-<em>"+(data.toDate?data.toDate:ZPI18N.getString("zp.noenddate"))+"</em></div>");let jobStatus='<div class="d-flexclmcap10 d-flexC'+(0===data.jobStatus?" gry6":"")+'">';0===data.jobStatus?jobStatus+='<i class="CP PI_tick2_fil" onclick="Timetracker.jobs.Operations.changeisCompleted(\''+data.jobId+"', '"+data.jobStatus+'\', this);" title = "'+ZPI18N.getString("zp.inprogresschangestatus")+'"></i><span aria-label="'+ZPI18N.getString("zp.inprogress")+'" tabindex="0">'+ZPI18N.getString("zp.inprogress")+"</span></div>":1===data.jobStatus&&(jobStatus+='<i class="CP PI_tick2_fil grn" onclick="Timetracker.jobs.Operations.changeisCompleted(\''+data.jobId+"', '"+data.jobStatus+'\', this);" title = "'+ZPI18N.getString("zp.completedchangestatus")+'"></i><span aria-label="'+ZPI18N.getString("zp.completed")+'" tabindex="0">'+ZPI18N.getString("zp.completed")+"</span></div>");let estimatedHours=0,estimatedMins=0;data.hours&&(estimatedMins=data.hours%60,estimatedHours=(data.hours-estimatedMins)/60);let loggedHours=0,loggedMins=0;if(data.totalhours&&(loggedMins=data.totalhours%60,loggedHours=(data.totalhours-loggedMins)/60),data.overDueDays){return'<div id="job-'+data.jobId+'"><div class="zpl_msp-dts CP" onclick="Timetracker.jobs.Operations.formAddEditView(undefined ,\''+data.jobId+'\', true)""><div class="zpl_msp-name"><span class="zpl_msp-title" aria-label="'+ZPI18N.getString("zp.jobname")+":"+data.jobName+'" tabindex="0" >'+data.jobName+"</span>"+(void 0!==data.projectName?'<span class="zpl_dots sm" aria-label="'+ZPI18N.getString("zp.projectname")+":"+data.projectName+'" tabindex="0"></span><span>'+data.projectName+"</span>":"")+'</div></div><div class="zpl_msp_act"><span class="zpl_progtitle" aria-label="'+ZPI18N.getString("zp.lms.overdueby")+" "+data.overDueDays+" "+ZPI18N.getString("zp.day.plural")+'" tabindex="0"><em>'+ZPI18N.getString("zp.lms.overdueby")+'</em></span><div><span><b class="red">'+data.overDueDays+" "+ZPI18N.getString("zp.day.plural")+"</b></span></div></div>"}var estimatedHrs=estimatedHours+" "+ZPI18N.getString("zp.hrs")+", "+estimatedMins+" "+ZPI18N.getString("zp.mins"),loggedHrs=loggedHours+" "+ZPI18N.getString("zp.hrs")+", "+loggedMins+" "+ZPI18N.getString("zp.mins");return'<div id="job-'+data.jobId+'"><div class="zpl_msp-dts CP" onclick="Timetracker.jobs.Operations.formAddEditView(undefined ,\''+data.jobId+'\', true)"><div class="zpl_msp-name"><span class="zpl_msp-title" aria-label="'+ZPI18N.getString("zp.jobname")+":"+data.jobName+'" tabindex="0">'+data.jobName+"</span>"+(void 0!==data.projectName?'<span class="zpl_dots sm" aria-label="'+ZPI18N.getString("zp.projectname")+":"+data.projectName+'" tabindex="0"></span><span>'+data.projectName+"</span>":"")+"</div>"+period+'</div><div class="d-flexclm8 w150"><span class="zpl_progtitle" aria-label="'+ZPI18N.getString("zp.estimatedhours")+'" tabindex="0" ><em>'+ZPI18N.getString("zp.estimatedhours")+'</em></span><div><span aria-label="'+estimatedHrs+'" tabindex="0"><b>'+estimatedHrs+'</b></span></div></div><div class="d-flexclm8 w150"><span class="zpl_progtitle" aria-label="'+ZPI18N.getString("zp.loggedhours")+'" tabindex="0"><em>'+ZPI18N.getString("zp.loggedhours")+'</em></span><div><span aria-label="'+loggedHrs+'" tabindex="0" ><b>'+loggedHrs+'</b></span></div></div><div class="zpl_msp-act">'+jobStatus+"</div>"},loadMoreData:function(details){let requestParams=Timetracker.UserSpace.Jobs.getRequestParams(details.erecno);requestParams.sIndex=ZPeople.FireScroll.getRecordCount(Timetracker.UserSpace.Jobs.firescrollMode)+1,ZPeople.Request.send(Timetracker.constants.URL,requestParams,function(response){if(response&&response.schArr&&0!==response.schArr.length){var container=details.scrollDiv.find("#"+details.pageContainerId).find(".zpl_msplst");$.each(response.schArr,function(index,data){let jobDiv=$(Timetracker.UserSpace.Jobs.constructJobRow(data));container.append(jobDiv)}),ZPeople.FireScroll.increaseRecordCount(response.schArr.length,Timetracker.UserSpace.Jobs.firescrollMode),response.schArr.length===Timetracker.UserSpace.Jobs.firescrollLimit&&ZPeople.FireScroll.reset(Timetracker.UserSpace.Jobs.firescrollMode)}})}},Timetracker.UserSpace.Timelogs={firescrollMode:"TT_USERSPACE_TIMELOGS",firescrollLimit:25,isRefreshNeeded:!0,init:async function(container,params){if(Timetracker.initSetup(),Timetracker.setWorkitemCache(),Timetracker.UserSpace.Timelogs.isRefreshNeeded||"ts_homeuser"==Timetracker.Page.getPageMode()){$(container).html("");$(container).attr("id");if(Timetracker.userTSSettings.getUserTSSettings(params.erecno),Timetracker.UserSpace.isMySpaceTimelogs()||Timetracker.Team.setSelectedUser(params.erecno),Timetracker.UserSpace.isMySpaceTimelogs()&&$(container).find("#timerarea").length<=0&&Timetracker.generalSettings.isAutomaticLogAllowed(params.erecno)){var timerBand='<div class="zpl_ttlstvw"><div class="zpl_dfcrd zpl_timeband zpl_tmchkin zpl_psticky" id="timerarea"><div class="d-flex zpl_DNI" id="tt_jobsch_brief_div"><div class="zpl_timebandlft"><b>'+ZPI18N.getString("zp.jobschtoday")+'</b><div class="d-flexclmcap20" id="jsch_brief_divs"></div></div></div><div class="d-flex"><div class="zpl_timebandlft"><div class="zpl_slct" id="divClient"><input id="timerclients" style="width: 120px;"></div><div class="zpl_slct" id="divProject"><Input id="timerprojects" clientId="timerclients" jobId="timerjobs" style="width: 120px;"></div><div class="zpl_slct"><input id="timerjobs" projectId="timerprojects" style="width: 120px;"></div><div class="zpl_slct" id="workitemId"><input id="timertask" style="width: 120px;" class="ztextbox" placeholder="'+ZPI18N.getString("zp.whatareyouworkingon")+'" title="'+ZPI18N.getString("zp.enterentity",[Timetracker.util.getWorkItemDispName(!1,!0)])+'"></div><div class="zpl_slct" id="billStDiv"><select id="timerbill" style="width: 120px;"><option value="0">'+ZPI18N.getString("zp.billable")+'</option><option value="1">'+ZPI18N.getString("zp.nonbillable")+'</option></select></div><span id="timerDesc" class="PI_note icn" ref="showHideDescPopup" title="'+Timetracker.util.getDescriptionDispName()+'" onclick="Timetracker.timelogs.showHideDescPopup()"></span></div><div class="zpl_timebandrgt" style="margin-left: 10px;"><div class="zpl_tmrunmid"><div class="zpl_chk-in" name="timerButton" onclick="Timetracker.timelogs.timer.pauseclock(this)" id="checkInButton"><div><b name="timerButton" id="watch">00:00:00</b></div><span id="timerstart"><i class="PI_timer"></i></span><span class="zpl_DNI" id="timerrunning"><img src="'+ZPeople.getResourceURL(newUIImageUrl+"timer.gif")+'"></span><span class="zpl_DNI" id="timerloading"><div class="zpl_ldngring"><div></div><div></div><div></div><div></div></div></span></div></div></div></div></div>';Timetracker.jobSchedule.hasCustomFields()&&(timerBand+='<div class="zpl_dfcrd zpl_DNI" id="main_jsch_dtl_id"><div class="zpl_ttrstcnhdr opn" id="exp_id"><i class="PI_atop"></i><h5>Schedule</h5></div><div class="zpl_ttrstcnbx zpl_DNI" id="jsch_dtl_div"></div></div>'),timerBand+="</div>";var descPopover='<div id="timerDescPopup" class="zpl_popovr" data-type="popover" style="display: none;"> <div class="zpl_popoverinr"> <div class="text-right"> <a class="_cls PI_cls red" ref="closeDescPopup" onclick="Timetracker.timelogs.closeDescPopup()"></a></div><div id="timerDescInp" class="w250"><div><textarea rows="5" class="ztextbox"></textarea></div><button class="zlabel zlabel--blue zlabel--small" ref="saveDescPopup" onclick="Timetracker.timelogs.saveDescPopup(this)">'+ZPI18N.getString("zp.ok")+'</button></div><div id="timerDescView" class="w250 zpl_DNI"><span></span></div> </div></div>';$(container).append($(timerBand)),$(container).find("#timerDesc").parent().append(descPopover),ZPeopleComponents.popover($(container).find("#timerDescPopup"),{displayType:"callout",closeOnBodyClick:!0,forElement:$(container).find(".zpl_timebandlft").find("#timerDesc")});0!==$(container).find("#timerjobs").length&&ZPeopleComponents.isComponent($(container).find("#timerjobs"))&&TimelyZComp.select.getValue($(container).find("#timerjobs"))}let pagewrap=$('<div id="timelog_pagewrap"></div>');$(container).append(pagewrap),await Timetracker.timelogs.initTimelogs(),Timetracker.generalSettings.isAutomaticLogAllowed(params.erecno)&&(Timetracker.timelogs.showHideTlFieldsInTimer(!1),Timetracker.timelogs.currentTimerJobData?Timetracker.timelogs.timer.setValuesInTimerBand():Timetracker.timelogs.timer.resetTimer()),Timetracker.Util.showHideNoData({remove:!0}),Timetracker.util.appendLoading(null,{divId:"timelog_pagewrap",layout:Layout.Page.parentContainer});let requestParams=Timetracker.UserSpace.Timelogs.getRequestParams(params.erecno);$(container).attr({"aria-label":ZPI18N.getString("zp.common.myspacetab",[ZPI18N.getString("zp.timelogs")]),tabindex:"0"}),$(container).focus(),ZPeople.Request.send(Timetracker.constants.URL,requestParams,function(response){if(ZPeople.FireScroll.setParam("triggered",!0,Timetracker.UserSpace.Timelogs.firescrollMode),pagewrap.find("#myspace_tl_lst").length>0&&(pagewrap.find("#myspace_tl_lst").remove(),pagewrap.find("#myspace_tl_hdr").remove()),Timetracker.util.removeLoading(),response&&null!==response&&response.hasOwnProperty("idSpecificDtlObj")&&Timetracker.jobSchedule.timelogsView.populateJobSchDetailsCache(response),Timetracker.jobSchedule.timelogsView.constructBriefJobSch(),0===response.length)Timetracker.Util.showHideNoData({appendToDiv:!0,msg:ZPI18N.getString("zp.notaddedforrange",[ZPI18N.getString("zp.stimelogs"),ZPI18N.getString("zp.stoday")]),layout:container}),ZPeople.FireScroll.setRecordCount(-1,Timetracker.UserSpace.Timelogs.firescrollMode);else{pagewrap.find("#zp_empty_data").length>0&&pagewrap.find("#zp_empty_data").remove();let htmlTemplate=$('<div class="zpl_msplst" id="myspace_tl_lst"></div>'),timelogHeader=$('<div id="myspace_tl_hdr" class="zpl_gbox"><span aria-label="'+ZPI18N.getString("zp.timelogs")+'" tabindex="0"><em><b>'+ZPI18N.getString("zp.timelogs")+'</b></em><em class="zpl_dots sm" aria-label="'+ZPI18N.getString("zp.today")+'" tabindex="0"></em><em>'+ZPI18N.getString("zp.today")+"</em></span></div>");pagewrap.append(timelogHeader);let tlArr=response.tsArr?response.tsArr:response;$.each(tlArr,function(index,data){let timelogDiv=$(Timetracker.UserSpace.Timelogs.constructTimelogRow(data));timelogDiv.data("tsval",data),timelogDiv.find("#timerEditPopup").on("click",function(){Timetracker.timelogs.timer.showTimerEditModal(data)}),htmlTemplate.append(timelogDiv)}),pagewrap.append(htmlTemplate),ZPeople.FireScroll.setRecordCount(tlArr.length,Timetracker.UserSpace.Timelogs.firescrollMode),response.length===Timetracker.UserSpace.Timelogs.firescrollLimit&&ZPeople.FireScroll.reset(Timetracker.UserSpace.Timelogs.firescrollMode)}}),Timetracker.UserSpace.Timelogs.isRefreshNeeded=!Timetracker.UserSpace.isMySpaceTimelogs()}else await Timetracker.timelogs.initTimelogs(),Timetracker.generalSettings.isAutomaticLogAllowed(params.erecno)&&(Timetracker.timelogs.showHideTlFieldsInTimer(!1),Timetracker.timelogs.currentTimerJobData?Timetracker.timelogs.timer.setValuesInTimerBand():Timetracker.timelogs.timer.resetTimer())},getRequestParams:function(userId){let params={mode:"getTimesheet",isTimerDetails:!0,isCommentsCount:!0,clientId:"0",projectId:"0",jobId:"0",approvalStatus:"0",typeMode:"-1",limit:Timetracker.UserSpace.Timelogs.firescrollLimit,userErecNo:userId,conreqcsr:csrfToken};return Timetracker.generalSettings.isJobSchDatainTLEnabled()&&(params.fetchTLJobschDtls=!0),params},constructTimelogRow:function(data){let billableStatus="";var today=Calendar.getCurrentDay().day;if(Timetracker.isTTSthiftEnabled()){let shiftDate=Timetracker.generalSettings.getTSSettings(Timetracker.timelogs.tserecno).TS_shiftDate;today=Calendar.parseDate(shiftDate,uidateFormat)}var workDate=Calendar.parseDate(data.workDate,uidateFormat),isBreakLog=Timetracker.BreakTimelogs.isBreakLog("DATA",data);billableStatus=0===data.billableStatus?isBreakLog?ZPI18N.getString(Timetracker.Break.TYPE_STATUS[0]):ZPI18N.getString("zp.billable"):isBreakLog?ZPI18N.getString(Timetracker.Break.TYPE_STATUS[1]):ZPI18N.getString("zp.nonbillable");let hourstitle="";"1"!==data.type&&1!==data.type||(hourstitle+=' title="'+(strTimeInterval=data.fromTimeInTimeFormat+"-"+data.toTimeInTimeFormat)+'" ref ="skip"');let showWorkItem=Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.WORKITEM),showBillable=Timetracker.timelogCustomization.isTLFieldEnabled(Timetracker.constants.BILLABLE_STATUS),isEditAllowed=data.isEditAllowed&&(-2===data.approvalStatus||void 0===data.approvalStatus)&&0===data.billingStatus,html='<div id="timelog-'+data.timelogId+'" '+(isEditAllowed?"":'class="zpl_cpd"')+'><div class="zpl_msp-dts CP mw300" onclick="Timetracker.timelogs.Operations.formAddEditView(undefined, \''+data.timelogId+'\', true)" title="'+data.jobName+(void 0!==data.projectName?" . "+data.projectName:"")+'"><div class="zpl_msp-name"><div><span class="zpl_msp-title" aria-label="'+ZPI18N.getString("zp.jobname")+":"+data.jobName+'" tabindex="0">'+data.jobName+"</span>"+(void 0!==data.projectName?'<span class="zpl_dots sm" aria-label="'+ZPI18N.getString("zp.projectname")+":"+data.projectName+'" tabindex="0"></span><span>'+data.projectName+"</span>":"")+"</div></div></div>"+(showBillable?'<div><div class="zpl_compoffar w100"><div class="d-flexclmcap10" aria-label="'+billableStatus+'" tabindex="0"><div><b>'+billableStatus+"</b></div></div></div></div>":"")+(showWorkItem?'<div><div class="zpl_compoffar w150"><div class="txttrim tooltip-js zpl_c-d" data-title-position="bottom" title="'+(data.taskName?data.taskName:"")+'"><span><b>'+(data.taskName?data.taskName:"")+"</b></span></div></div></div>":"");var isCurrentlyRunning=data.isCurrentlyRunning;html+='<div class="zpl_msp-act">',"2"===data.type?isBreakLog?html+='<div class="zpl_hvr zpl_hvrsw zpl_icncont w30"></div>':0!==data.commentsCount?html+='<div id="addNote'+data.timelogId+'" class="zpl_hvr zpl_hvrsw zpl_icncont" title="'+ZPI18N.getString("zp.notes")+'" onclick="Timetracker.timelogs.showNoteEntry(this,event,\''+data.timelogId+"','"+data.workDate+'\');"><i class="PI_note zpl_popovr-js" data-menu-id="addnotes"><sup id="notesCount'+data.timelogId+'">'+data.commentsCount+"</sup></i></div>":isCurrentlyRunning&&0===data.commentsCount&&erecno===Timetracker.timelogs.tserecno?html+='<div id="addNote'+data.timelogId+'" class="zpl_hvr zpl_hvrsw zpl_icncont" title="'+ZPI18N.getString("zp.notes")+'" aria-label="'+ZPI18N.getString("zp.notes")+'" onclick="Timetracker.timelogs.showNoteEntry(this,event,\''+data.timelogId+"','"+data.workDate+'\');"><i class="PI_note zpl_popovr-js" data-menu-id="addnotes"><sup id="notesCount'+data.timelogId+'"><span class="PI_plus wauto zpl_f12"></span></sup></i></div>':html+='<div class="zpl_hvr zpl_hvrsw zpl_icncont w30"></div>':html+='<div class="zpl_hvr zpl_hvrsw zpl_icncont w30"></div>';var timerIcon="";if("2"===data.type){var isTimerflag=!1;if(isCurrentlyRunning){var tempObj=data.timearr[Timetracker.timelogs.getLastTimerIndex(data.timearr)];if(void 0!==tempObj&&tempObj.isRunning)isTimerflag=!0;else for(var arrObj in data.timearr)if(data.timearr[arrObj].isRunning){isTimerflag=!0;break}}isTimerflag?Timetracker.timelogs.tserecno===erecno?timerIcon+='<span><img id="watchstatus'+data.timelogId+'" src="'+ZPeople.getResourceURL(newUIImageUrl+"timelog2.gif")+'" class="tympass CP" title="'+ZPI18N.getString("zp.stoptimer")+'"  aria-label="'+ZPI18N.getString("zp.stoptimer")+'" tabindex="0" onclick="Timetracker.timelogs.timer.pauseclock(this)"></span>':timerIcon+='<span><img src="'+ZPeople.getResourceURL(newUIImageUrl+"timelog2.gif")+'" class="tympass CP" onclick="Timetracker.util.showAlert(1,\''+ZPI18N.getString("zp.timeralert7")+'\');" ref="skip"></span>':!isTimerflag&&Calendar.equalsTo(today,workDate)&&(Timetracker.timelogs.tserecno===erecno?timerIcon+='<span class="PI_fil_play grn zpl_h3 CP" tid="'+data.timelogId+'" id="watchstatus'+data.timelogId+'"  aria-label="'+ZPI18N.getString("zp.resumetimer")+'" tabindex="0" title="'+ZPI18N.getString("zp.resumetimer")+'" onclick="Timetracker.timelogs.timer.nextStart(this)"></span>':timerIcon+='<span class="PI_fil_play grn zpl_h3 CP" onclick="Timetracker.util.showAlert(1,\''+ZPI18N.getString("zp.timeralert7")+'\');" ref="skip"></span>')}if(""==data.timearr||"2"!==data.type||data.isCurrentlyRunning){if(html+='<div class="zpl_msp-tlog j-cnt-rgt">'+timerIcon+'<div class="d-flexC d-flex-btw w60 j-cnt-rgt">',"2"===data.type&&data.isCurrentlyRunning&&Timetracker.timelogs.tserecno===erecno)html+='<span id="watch_time" aria-label="'+Calendar.minstohrs(data.hours)+'" tabindex="0">';else if("1"===data.type||1===data.type){var strTimeInterval;html+='<span class="zpl_cpd" title="'+(strTimeInterval=data.fromTimeInTimeFormat+"-"+data.toTimeInTimeFormat)+'" aria-label="'+strTimeInterval+'" tabindex="0">'}else html+='<span class="zpl_cpd">';html+=Calendar.minstohrs(data.hours)+"</span>"}else html+='<div class="zpl_msp-tlog j-cnt-rgt">'+timerIcon+'<div class="d-flexC d-flex-btw w60 j-cnt-rgt"><span id="timerEditPopup" class="blu CP" ref="timerEditPopup" aria-label="'+Calendar.minstohrs(data.hours)+'" tabindex="0" title="'+ZPI18N.getString("zp.view")+'">'+Calendar.minstohrs(data.hours)+"</span>";return html+="</div></div>",html+=isEditAllowed?'<div class="w100"><div class="zpl_hvr j-cnt-rgt"><i class="PI_edt" title="'+ZPI18N.getString("zp.edit")+'" aria-label="'+ZPI18N.getString("zp.edit")+'" tabindex="0" onclick="Timetracker.timelogs.Operations.formAddEditView(undefined, \''+data.timelogId+'\', false)"></i><i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'"  aria-label="'+ZPI18N.getString("zp.delete")+'" tabindex="0"  onclick="Timetracker.UserSpace.Timelogs.deleteTimelog(\''+data.timelogId+"',"+data.isCurrentlyRunning+')"></i></div></div>':'<div class="w100"></div>',html+="</div>"},deleteTimelog:function(timelogId,isCurrentlyRunning){if(isCurrentlyRunning)Timetracker.util.showAlert(1,ZPI18N.getString("zp.timerlogalert7"));else{var extraDtls={header:ZPI18N.getString("zp.common.entitydelete",[ZPI18N.getString("zp.stimeLog")]),body:ZPI18N.getString("zp.common.delEntityInfo2",[ZPI18N.getString("zp.stimeLog")]),btnVal:ZPI18N.getString("zp.confirm")};Timetracker.Util.confirmpopUp(timelogId,Timetracker.timelogs.deleteTimeLog,timelogId,0,extraDtls)}},loadMoreData:function(details){let requestParams=Timetracker.UserSpace.Timelogs.getRequestParams(details.erecno);requestParams.sIndex=ZPeople.FireScroll.getRecordCount(Timetracker.UserSpace.Timelogs.firescrollMode)+1,Timetracker.UserSpace.isMySpaceTimelogs()&&!isNaN(requestParams.sIndex)&&0===Layout.Page.container.find("#zp_empty_data").length&&ZPeople.Request.send(Timetracker.constants.URL,requestParams,function(response){if(response&&response.schArr&&0!==response.schArr.length){var container=details.scrollDiv.find("#"+details.pageContainerId).find("#timelog_pagewrap").find(".zpl_msplst");let tlArr=response.tsArr?response.tsArr:response;$.each(tlArr,function(index,data){let timelogDiv=$(Timetracker.UserSpace.Timelogs.constructTimelogRow(data));timelogDiv.data("tsval",data),timelogDiv.find("#timerEditPopup").on("click",function(){Timetracker.timelogs.timer.showTimerEditModal(data)}),container.append(timelogDiv)}),ZPeople.FireScroll.increaseRecordCount(response.schArr.length,Timetracker.UserSpace.Timelogs.firescrollMode),response.schArr.length===Timetracker.UserSpace.Timelogs.firescrollLimit&&ZPeople.FireScroll.reset(Timetracker.UserSpace.Timelogs.firescrollMode)}})}},Timetracker.UserSpace.ActionListPendingJobs={construct:function(cardContainer,jobData){if(cardContainer.html(""),$.isEmptyObject(jobData))return!1;Timetracker.initSetup();if(jobData.penJobArr){let pendingJobParent=$('<div class="zpl_msplst zpl_mspgroup"></div>'),pendingJobsDiv=$("<div></div>");pendingJobsDiv.append($('<span class="PI_s_tt icn"></span>'));let jobsWrap=$("<div></div>");jobsWrap.append($('<div class="zpl_msp-dts"><div class="zpl_msp-name"><div class="zpl_msp-title">'+ZPI18N.getString("zp.pendingjobduetoday")+"</div></div></div>"));let jobsList=$('<div class="zpl_msplst"></div>');jobData.penJobArr.forEach(function(data){let jobDiv=$(Timetracker.UserSpace.ActionListPendingJobs.constructJobRow(data));jobDiv.data("schval",data),jobsList.append(jobDiv)}),jobsWrap.append(jobsList),pendingJobsDiv.append(jobsWrap),pendingJobParent.append(pendingJobsDiv),cardContainer.append(pendingJobParent)}},constructJobRow:function(data){let jobRow='<div id="job-'+data.jobId+'"><div class="zpl_msp-dts"><div class="zpl_msp-name"><div><span class="zpl_msp-title zpl_ellipsis">'+data.jobName+"</span>";return data.projectName&&(jobRow+='<em class="zpl_dots sm"></em><em>'+data.projectName+"</em>"),jobRow+="</div></div></div>",jobRow+='<div><div class="zpl_compoffar"><div class="d-flexC d-flexclmcap10">',data.fromDate?jobRow+="<div><b>"+data.fromDate+"</b></div>":jobRow+="<div><em>"+ZPI18N.getString("zp.nostartdate")+"</em></div>",jobRow+='<i class="PI_arw_travl"></i><div><b>'+data.toDate+"</b></div></div></div></div>",jobRow+='<div class="zpl_msp-act"><div class="zpl_msp-tlog">',jobRow+='<i class="PI_tick2_fil gry CP" onclick="Timetracker.jobs.Operations.changeisCompleted(\''+data.jobId+"', '"+data.jobStatus+'\', this);" title = "'+ZPI18N.getString("zp.inprogresschangestatus")+'"></i></div></div>',jobRow+="</div></div></div>",jobRow+="</div>"}},Timetracker.UserSpace.ActionListJobSchedule={construct:function(cardContainer,jobData){if($.isEmptyObject(jobData))return!1;let schJobsWrap=$('<div class="zpl_msplst zpl_mspgroup"></div>'),schJobs=$("<div></div>");var crdHtml='<div><div class="zpl_msp-dts"><div class="zpl_msp-name"><div class="zpl_msp-title">'+ZPI18N.getString("zp.tljobschtdy")+'</div></div></div><div class="zpl_mspace-gap">';jobData.schJobArr.forEach(function(data){let jcColor="0"===data.color?Timetracker.jobs.defJobColor:data.color,ft=Calendar.minstotimeFormat(parseInt(data.fromTime)),tt=Calendar.minstotimeFormat(parseInt(data.toTime)),jobName=data.jobName,title=ft+" - "+tt+" / "+jobName+(data.projectName?" . "+data.projectName:"");crdHtml+='<div class="jbs_wrkitm jc'+jcColor+'" title="'+title+'"><div class="zpl_wrkitmnme"><span>'+jobName,data.projectName&&(crdHtml+='<em class="zpl_dots sm"></em>'+data.projectName),crdHtml+="</span><em>"+ft+" - "+tt+"</em></div></div>"}),crdHtml+="</div></div>",schJobs.append($('<span class="PI_s_tt icn"></span>')),schJobs.append($(crdHtml)),schJobsWrap.append(schJobs),cardContainer.append(schJobsWrap)}},Timetracker.UserSpace.ActionListLogTime={construct:function(cardContainer,timelogData){if(!$.isEmptyObject(timelogData)){Timetracker.initSetup(),Timetracker.setWorkitemCache(),Timetracker.timelogs.initTimelogs();let addtimelog='<div class="zpl_msplst" id="addTlCard"><div>';addtimelog+='<span class="PI_s_tt icn"></span>',addtimelog+='<div class="zpl_msp-dts"><div class="zpl_msp-name"><div><span class="zpl_msp-title zpl_ellipsis">'+ZPI18N.getString("zp.notladdedtoday")+"</span></div></div></div>",addtimelog+='<div class="zpl_msp-act"><div class="zpl_hvr"><button class="zlabel zlabel--blue zlabel--medium zlabel--outline" onclick="Timetracker.UserSpace.ActionListLogTime.showAddtimelogPopup()">'+ZPI18N.getString("zp.logtime")+"</button></div></div>",addtimelog+="</div></div>",cardContainer.append($(addtimelog))}},showAddtimelogPopup:function(){let date=Calendar.getCurrentDate();Timetracker.timelogs.calendar.addTimelog(date.getFullYear(),date.getMonth(),date.getDate())}},Timetracker.UserSpace.ActionListSubmitTimesheet={construct:function(cardContainer,tsData){Timetracker.initSetup(),Timetracker.timesheet.approvalConfig();let fDateStr=Timetracker.DateTime.getDateinTSformat(new Date(tsData.hoursObj.fromDate)),tDateStr=Timetracker.DateTime.getDateinTSformat(new Date(tsData.hoursObj.toDate));Timetracker.UserSpace.Jobs.ts_fromDate=fDateStr,Timetracker.UserSpace.Jobs.ts_toDate=tDateStr;let viewStr="<em>"+fDateStr+"</em> - <em>"+tDateStr+"</em>";Timetracker.UserSpace.Jobs.ts_fromDate===Timetracker.UserSpace.Jobs.ts_toDate&&(viewStr="<em>"+fDateStr+"</em>");let submittedHours=0,submittedMins=0;tsData.hoursObj.hoursToBeSubmitted&&(submittedMins=tsData.hoursObj.hoursToBeSubmitted%60,submittedHours=(tsData.hoursObj.hoursToBeSubmitted-submittedMins)/60);let ts_card='<div class="zpl_msplst" id="createTSCard"><div>';ts_card+='<span class="PI_s_tt icn"></span>',ts_card+='<div class="zpl_msp-dts"><div class="zpl_msp-name"><div class="zpl_msp-title"><span class="zpl_msp-title zpl_ellipsis">'+ZPI18N.getString("zp.submityourtimesheet")+'</span></div><div class="d-flex d-flexclmcap10">'+viewStr+"</div></div></div>",ts_card+='<div class="zpl_compoffar w150"><span class="zpl_progtitle"><em>'+ZPI18N.getString("zp.totalhours")+"</em></span><div><span><b>"+submittedHours+" "+ZPI18N.getString("zp.hrs")+", "+submittedMins+" "+ZPI18N.getString("zp.mins")+"</b></span></div></div>",ts_card+='<div class="zpl_msp-act"><div class="zpl_hvr"><button class="zlabel zlabel--blue zlabel--medium zlabel--outline" onclick="Timetracker.timesheet.getCreateTimesheet();">'+ZPI18N.getString("zp.submit")+"</button></div></div>",ts_card+="</div></div>",cardContainer.append($(ts_card))}},Timetracker.UserSpace.ActionListTimesheets={construct:function(cardContainer,timesheetData){if(Timetracker.initSetup(),Timetracker.timesheet.approvalConfig(),timesheetData.tsData){let timesheetDiv=$(Timetracker.UserSpace.ActionListTimesheets.constructTimesheetRow(timesheetData.tsData));timesheetDiv.data("tsval",timesheetData.tsData),timesheetDiv.on("mouseover",function(){timesheetDiv.find("[name = acTsBtn]").length>0&&(timesheetDiv.find("[name = acTsStatus]").hide(),timesheetDiv.find("[name = acTsBtn]").removeClass("DN").addClass("d-flex"))}),timesheetDiv.on("mouseleave",function(){timesheetDiv.find("[name = acTsBtn]").removeClass("d-flex").addClass("DN"),timesheetDiv.find("[name = acTsStatus]").show()}),cardContainer.append(timesheetDiv)}},timesheetRowReplace:function(tsRecordRow,data){let timesheetDiv=$(Timetracker.UserSpace.ActionListTimesheets.constructTimesheetRow(data));timesheetDiv.data("tsval",data),tsRecordRow.replaceWith(timesheetDiv),timesheetDiv.on("mouseover",function(){timesheetDiv.find("[name = acTsBtn]").length>0&&(timesheetDiv.find("[name = acTsStatus]").hide(),timesheetDiv.find("[name = acTsBtn]").removeClass("DN").addClass("d-flex"))}),timesheetDiv.on("mouseleave",function(){timesheetDiv.find("[name = acTsBtn]").removeClass("d-flex").addClass("DN"),timesheetDiv.find("[name = acTsStatus]").show()})},constructTimesheetRow:function(data){let submittedHours=0,submittedMins=0;data.totalHours&&(submittedMins=data.totalHours%60,submittedHours=(data.totalHours-submittedMins)/60);var appClass="",appTitle="";1!==data.status||data.isPartiallyApproved?1===data.status&&data.isPartiallyApproved?(appClass="org",appTitle=ZPI18N.getString("zp.partiallyapproved")):0===data.status?(appClass="red",appTitle=ZPI18N.getString("zp.rejected")):-1===data.status&&(appClass="org",appTitle=ZPI18N.getString("zp.pending")):(appClass="grn",appTitle=ZPI18N.getString("zp.approved"));let crdHtml='<div class="zpl_msplst" id="list-'+data.recordId+'">';crdHtml+="<div>",crdHtml+='<span class="PI_s_tt icn"></span>',crdHtml+='<div class="zpl_msp-dts CP" onclick="Timetracker.UserSpace.Timesheets.viewTimesheet(\''+data.formId+"', '"+data.recordId+'\')"><div class="zpl_msp-name"><div>',"isAutoApprove"in data?crdHtml+=ZPI18N.getString("zp.timesheetautoappr",[data.timesheetName,appTitle.toLowerCase()]):1===data.status||0===data.status?crdHtml+=ZPI18N.getString("zp.yourtimesheetapproval",[data.timesheetName,appTitle.toLowerCase()]):crdHtml+=ZPI18N.getString("zp.timesheetsentforapproval",[data.timesheetName,data.approver]),crdHtml+="</div></div></div>",crdHtml+='<div class="zpl_compoffar w150"><span class="zpl_progtitle"><em>'+ZPI18N.getString("zp.totalhours")+"</em></span><div><span><b>"+submittedHours+" "+ZPI18N.getString("zp.hrs")+", "+submittedMins+" "+ZPI18N.getString("zp.mins")+"</b></span></div></div>",crdHtml+='<div class="zpl_msp-act">';let statusHtml="";return 1===data.status?statusHtml+='<span class="CP '+appClass+'" onclick="Timetracker.UserSpace.Timesheets.viewTimesheet(\''+data.formId+"', '"+data.recordId+"')\">"+appTitle+"</span>":0===data.status?(statusHtml+='<span class="CP '+appClass+'" name="acTsStatus" onclick="Timetracker.UserSpace.Timesheets.viewTimesheet(\''+data.formId+"', '"+data.recordId+"')\">"+appTitle+"</span>",statusHtml+='<div class="DN" name="acTsBtn"><button class="zlabel zlabel--blue zlabel--medium zlabel--outline" onclick="Timetracker.UserSpace.Timesheets.viewTimesheet(\''+data.formId+"', '"+data.recordId+"')\">"+ZPI18N.getString("zp.resendforapproval")+"</button></div>"):(statusHtml+='<span class="CP '+appClass+'" name="acTsStatus" onclick="Timetracker.UserSpace.Timesheets.viewTimesheet(\''+data.formId+"', '"+data.recordId+"')\">"+appTitle+"</span>",statusHtml+='<div class="DN" name="acTsBtn"><button class="zlabel zlabel--blue zlabel--medium zlabel--outline" onclick="Timetracker.UserSpace.Timesheets.viewTimesheet(\''+data.formId+"', '"+data.recordId+"')\">"+ZPI18N.getString("zp.view")+"</button></div>"),crdHtml+=statusHtml+"</div>",crdHtml+="</div>",crdHtml+="</div>"}};