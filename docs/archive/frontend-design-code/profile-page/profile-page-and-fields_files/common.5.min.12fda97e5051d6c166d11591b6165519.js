if(void 0===zia)var zia={};zia.minimizeChat=function(){ziaPeople.ziaChatClick()},zia.handleResponse=function(functionName,data,element,responseHandled,isFromHistory){var ele=$(element);return ziaPeople.constructResponse(data,ele,isFromHistory),!1},zia.didConnect=function(){$("#ziaLoading").remove()},zia.getClientSessionData=function(isSessionInvocation){if(!isSessionInvocation)return new Promise(function(resolve,reject){if("undefined"!=typeof Storage&&null!==localStorage.getItem("att_LatLonDet")){var latLonnObj=JSON.parse(localStorage.getItem("att_LatLonDet")),lastFetTime=latLonnObj.fetchedTime;if((new Date).getTime()-lastFetTime<=12e4){locStr=latLonnObj.latitude+"_"+latLonnObj.longitude+"_"+latLonnObj.accuracy;var json={location:locStr};resolve(json)}}navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(position){var param={};param.latitude=position.coords.latitude,param.longitude=position.coords.longitude,param.accuracy=position.coords.accuracy;var locStr=position.coords.latitude+"_"+position.coords.longitude+"_"+position.coords.accuracy;Attendance.Entry.storeLatLongInLStore(param),resolve({location:locStr})},function(err){resolve({location:"No location found"})})})},zia.getOnBoardingSentences=function(sentences){var OnBoardsentences=[],param={conreqcsr:csrfToken,method:"getOnboardingSentence"};return ZPeople.Request.sendAsyncPost("/getOnboardingSentence.zp",param,function(data){for(var i=0;i<data.onBoardingSentence.length;i++)OnBoardsentences.push({id:i+1,sentence:data.onBoardingSentence[i],actual_sentence:data.onBoardingSentence[i]})}),OnBoardsentences};var ziaPortalId="",ziaPeople={ziaDataEle:"",isZiaBotEnabled:!1,ziaChatClick:function(){if(""==ziaPortalId){var param={conreqcsr:csrfToken,method:"ziaPortal"};ZPeople.Request.sendAsyncPost("/ziaPortal.zp",param,function(data){ziaPortalId=data.ziaPortalId}),$("body").append('<div class="zp_cAzia"><div id="ziaLoading" class="zp_loads"><img src="'+ZPeople.getResourceURL(newUIImageUrl+"zia-loading.gif")+' " alt=""></div><zia-chat-bot chat-mode="popup" portal-id="'+ziaPortalId+'" show-help="true" show-history="false" show-action-suggestions="false"  show-typing-suggestions="false" skill-name="zohopeople" lt-prop-conversation="true"></zia-chat-bot></div>');var script=document.createElement("script");script.type="text/javascript",script.src=ZPeople.getResourceURL("addons/@zia/ziaSkillsSdk/assets/js/zia-skills-sdk.js"),script.integrity=ZPeople.getResourceChecksum("addons/@zia/ziaSkillsSdk/assets/js/zia-skills-sdk.js"),script.crossOrigin="anonymous",document.getElementsByTagName("head")[0].appendChild(script),script.onload=function(){Layout.PageUtil.loadFiles(ZPLyte.getResource(["lyte_components.js","lyte_dependencies_min.css"]),()=>{ziaskills.init({zia_url:Layout.ZIAURL,static_urls:pplclienturl,fingerprint_json:fingerprintJSON})})}}else $("body").find(".zp_cAzia").toggleClass("clsZia"),$("#faqDetViewBot").addClass("clsZia")},ziaMinimizeChat:function(){$("body").find(".zp_cAzia").addClass("clsZia"),$("#faqDetViewBot").addClass("clsZia")},constructResponse:function(dataObj,ele,isFromHistory){var resObj=dataObj.getResponse,resDiv="Something went wrong";if(resObj.hasOwnProperty("paramLookup"))resDiv=ziaPeople.paramSelectOpt(resObj);else if(resObj.hasOwnProperty("paramType")&&7==resObj.paramType)resDiv=ziaPeople.paramLocation(resObj);else if(resObj.hasOwnProperty("botMessage"))resDiv=resObj.botMessage;else if(resObj.hasOwnProperty("paramConfirm"))resDiv=ziaPeople.paramConfirmation(resObj);else if(resObj.hasOwnProperty("addType")&&!isFromHistory)resDiv=ziaPeople.addInweb(resObj);else if(resObj.hasOwnProperty("report"))resDiv=ziaPeople.constructReport(resObj);else switch(resObj.type){case"faqSearch":resDiv=HRCaseFAQ.listDummy(resObj.data,dataObj.userInput,ele);break;case"task":resDiv=HRCaseFAQ.listTaskBot(resObj.data)}$(ele).parent().parent();resObj.hasOwnProperty("hasFollowupAction")&&resObj.hasOwnProperty("data")&&resObj.data.length<=0&&(resDiv='<div id="parentChatDiv">'+resDiv+"<p>"+resObj.followUpQuestion+'</p><button btype="1" class="yes">Yes</button><button btype="2">No</button></div>'),$(ele).append('<div class="zp_cAZCnt">'+resDiv+"</div>"),setTimeout(function(ele,resObj){if($(ele).parent().parent().removeClass("noPaddingBotTxt"),"true"==resObj.report?$(ele).parent().parent().addClass("zp_cAZfaq"):"faqSearch"==resObj.type||"task"==resObj.type&&resObj.hasOwnProperty("data")&&resObj.data.length>0?($(ele).find("[btype]").length||($(ele).parent().parent().addClass("zp_cAZfaq"),"task"==resObj.type&&$(ele).parent().parent().addClass("zp_cAZtsk")),"faqSearch"==resObj.type?$(ele).find("[faqid]").on("click",{faqData:resObj.data},function(event){$(this).index();HRCaseFAQ.faqViewBot(event.data.faqData[$(this).index()-1])}):($(ele).find('[id="taskRow"]').on("click",{faqData:resObj.data},function(event){$(this).index();ziaPeople.ziaMinimizeChat(),Task.showTaskDetails(event.data.faqData[$(this).index()-1].id,!0)}),$(ele).find('[id="taskBotCmp"]').on("click",{faqData:resObj.data},function(event){event.stopPropagation();$(this).index();var status=$(this).hasClass("grn")?Task.OPEN_SYSVALUE:Task.COMPLETED_SYSVALUE,getThis=$(this),params={taskid:event.data.faqData[$(this).closest("#taskRow").index()-1].id,method:"changeTaskStatus",status:status,conreqcsr:csrfToken};$.post("/changeTasksStatus.zp",params,function(data){"success"==data.Status&&$(getThis).toggleClass("grn")})}))):resObj.hasOwnProperty("module")&&"form"==resObj.module&&($(ele).parent().parent().addClass("zp_cAZfaq"),$(ele).find("[id=formRow]").on("click",{recData:resObj.data},function(event){$(this).index();ziaPeople.openAddRec(event.data.recData[$(this).index()-1])})),"faqSearch"==resObj.type||resObj.hasOwnProperty("paramLookup")||resObj.hasOwnProperty("paramConfirm")){resObj.hasOwnProperty("paramLookup")&&$(ele).parent().parent().addClass("zp_cAZfaq");$(ele).find("button");$(ele).find("button").on("click",function(){ziaPeople.chatButtonClick(this)}),$(ele).find("a").on("click",function(){ziaPeople.dataLookupClick(this)})}else resObj.hasOwnProperty("paramType")&&7==resObj.paramType&&$(ele).find("button").on("click",function(){ziaPeople.getLocationAccess(this)})},10,ele,resObj)},paramSelectOpt:function(resObj){var paramLookup=resObj.paramLookup,selOpt="";for(var paramId in paramLookup){if(paramLookup.hasOwnProperty(paramId))selOpt+="<a valId="+paramId+">"+paramLookup[paramId]+"</a></br>"}return'<div id="parentChatDiv"  class="zp_cAZfaqHd"><p class="mt0 ttl">'+resObj.botMessage+"</p>"+selOpt+'<div class="mt10"><button  btype="1" class="yes">Submit</button></div></div>'},paramLocation:function(resObj){return'<div id="parentChatDiv"><p class="mt0 ttl">'+resObj.botMessage+'</p><div class="mt10"><button  btype="1" class="yes">Ok</button></div></div>'},getLocationAccess:function(getThis){var locStr="";if("undefined"!=typeof Storage&&null!==localStorage.getItem("att_LatLonDet")){var latLonnObj=JSON.parse(localStorage.getItem("att_LatLonDet")),lastFetTime=latLonnObj.fetchedTime;if((new Date).getTime()-lastFetTime<=12e4)return locStr=latLonnObj.latitude+"_"+latLonnObj.longitude+"_"+latLonnObj.accuracy,void ziaskills.sendMessage("Location Accessed",locStr)}navigator.geolocation&&navigator.geolocation.getCurrentPosition(ziaPeople.setLocationBot)},setLocationBot:function(position){var param={};param.latitude=position.coords.latitude,param.longitude=position.coords.longitude,param.accuracy=position.coords.accuracy;var locStr=position.coords.latitude+"_"+position.coords.longitude+"_"+position.coords.accuracy;Attendance.Entry.storeLatLongInLStore(param),ziaskills.sendMessage("Location Accessed",locStr)},dataLookupClick:function(getThis){$(getThis).siblings("a").removeClass("sel"),$(getThis).addClass("sel"),ziaPeople.ziaDataEle=getThis},chatButtonClick:function(getThis){var parentChatDiv=$(getThis).parents("#parentChatDiv");1==$(getThis).attr("btype")&&void 0!=ziaPeople.ziaDataEle.accessKey&&ziaPeople.ziaDataEle.hasAttribute("valId")?(ziaskills.sendMessage($(ziaPeople.ziaDataEle).text(),$(ziaPeople.ziaDataEle).attr("valId")),$(getThis).parents("#parentChatDiv").find("a").off("click"),ziaPeople.ziaDataEle=""):2==$(getThis).attr("btype")?ziaskills.sendMessage($(getThis).text(),"stop_it"):$(getThis)[0].hasAttribute("btext")?ziaskills.sendMessage($(getThis).text(),$(getThis).attr("btext")):ziaskills.sendMessage($(getThis).text()),parentChatDiv.find("button").off("click"),$(getThis).parent().find("button").off("click")},paramConfirmation:function(resObj){var tr="";return $.each(resObj.data,function(i,faqObj){tr+="<em>"+faqObj.paramName+'</em></td><td style="width: 605.25px;"><span>'+("Category"==faqObj.paramName||"Leavetype"==faqObj.paramName?faqObj.paramUserValue:ZPeople.escapeHtml(faqObj.paramUserValue))+"</span>"}),'<div id="parentChatDiv">'+tr+"<p>"+resObj.confirmQn+'</p><button btype="1" class="yes">Yes</button><button btype="2">No</button></div>'},addRecordForForm:function(data,formName){var recListDiv='<div class="ZPNdata"><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><h5 id="zp_views_nodata">'+ZPI18N.getString("zp.nofaqs")+"</h5></div>";return data.length>0&&(recListDiv="",$.each(data,function(i,Obj){var recObj='<div class="zp_Lst" id="formRow"><div><div class="zp_Ldtl "><div class="zp_Tdts"><h3>'+Obj.formLinkName+"</h3></div></div></div></div>";recListDiv+=recObj}),recListDiv='<div class="zp_cAZfaqHd">'+formName+"</div>"+recListDiv),recListDiv},openAddRec:function(obj){var params={formId:obj.formId,formMode:"ADD"};ZPForm.load(params,!1,!0)},addInweb:function(resObj){var resDiv="Opening...";switch(resObj.module){case"cases":HRCaseBand.serviceView();break;case"leave":Leave.add();break;case"form":resDiv=ziaPeople.addRecordForForm(resObj.data,resObj.formName)}return resDiv},constructReport:function(resObj){var clr=["orng","grn","ylw","blu","gylw","sblu"];switch(resObj.action){case"holiday_report":var tr="";return $.each(resObj.data,function(i,faqObj){tr+='<div class="zp_cAinCnt"><div class="rndCr '+clr[i%clr.length]+' "><i>'+CommonTemplates.getAltText(ZPeople.decodeTxt(ZPeople.escapeHtml(faqObj.name)))+'</i></div><div class="mnCdr"><span>'+ZPeople.escapeHtml(faqObj.name)+"</span><em>"+faqObj.from+" - "+faqObj.to+"</em></div></div>"}),'<div id="parentChatDiv" class="zp_cAZfaqHd"><p class="ttl">Holiday Report</p>'+tr+"</div>";case"leave_report":tr="";return $.each(resObj.data,function(i,faqObj){2!=faqObj.type&&(tr+='<div class="zp_cAinCnt"><div class="rndBdr '+clr[i%clr.length]+'"><i>'+faqObj.taken+'</i></div><div class="mnCdr"><span>'+ZPeople.escapeHtml(faqObj.name)+"</span><em>Available "+faqObj.available+" Day(s)</em></div></div>")}),'<div id="parentChatDiv" class="zp_cAZfaqHd"><p class="ttl">Leave Report</p>'+tr+"</div>"}}};ZPFRules={ruleObj:{},conditionObj:{},actionObj:{},params:{},url:"/fieldRules.zp",rulesArray:[],formFields:[],ruleGroupTemplate:'<div class="panel-group dvaddruleacc" id="dvAddruleparent">$RULECONSTRUCT$</div>',errorTemplate:'<div class="dverrormsg DN" errorid="errorDiv"></div>',ruleHeaderTemplate:'<div class="panel clearfix" name="singleRuleDiv"><a name="deleteIcon" class="IC-delete gry FR lnkcls" onclick="ZPFRules.deleteRule({}, {forPost:true}, {obj:this})"></a><div name="ruleToggleDiv" class="GryBG panel-heading PT5 PL10 PB3" data-parent="#dvAddruleparent" data-target="#dvRule$COUNT$" onclick="ZPFRules.collapseElement(this)"><h6 class="ZPbold S16">'+ZPI18N.getString("zp.rule")+' $COUNT$</h6></div><div id="dvRule$COUNT$" $RULEID$ class="panel panel-collapse collapse col-md-12"><div class="dvCriteria clearfix dvfrmaddrule MT35"><div class="clearfix PB5"></div>$RULEDIV$</div><div class="dverrormsg DN" errorid="errorDiv"></div></div></div>',ruleIfDivTemplate:'<div class="form-group spnpostxt" id="$RULEID$"><label>'+ZPI18N.getString("zp.if")+'</label><select class="selectBox" id="ruleOperator"><option value="0" $SELECTED0$>'+ZPI18N.getString("zp.all")+'</option><option value="1" $SELECTED1$>'+ZPI18N.getString("zp.any")+"</option></select><label>"+ZPI18N.getString("zp.followingconditionsmet")+"</label></div>",selectTemplate:'<select class="selectBox" keyname="$KEYNAME$" $DISABLED$ onchange="$METHOD$" $MULTIPLE$>$OPTIONS$</select>',ruleConditionTemplate:'<div class="form-group $CLASS$" id="$ID$" rulenum="$NUM$" name="$NAME$" key="$KEY$">$CONDITION$</div>',addRemoveTemplate:'<div class="form-group col-md-1" name="addRemoveDiv"><div class="dvlist-action MT8"><a class="IC-plus-big S12 MR15 gry" onclick="ZPFRules.addDeleteCondition(this, true)"></a><a class="IC-mins gry S12" onclick="ZPFRules.addDeleteCondition(this, false)"></a></div></div>',optionsTemplate:'<div class="tabvertical tabselect DN" id="conditionDropdownSelection"><div class="rhttablst"><div class="dvPopsearch"><input class="form-control" onkeyup="ZPFRules.searchOptions(this)" type="search" placeholder="'+ZPI18N.getString("zp.search")+'..."></div><ul class="list-group ulRecipient" role="tablist" id="listBody">$LIST$</ul></div></div>',liTemplate:'<li name="list-group-item" class="$CLASS$" onclick="ZPFRules.conditionSelectRecord(this)"><span data-toggle="tab" role="tab" name="mOpt" id="$LISTID$">$LISTVALUE$</span></li>',formActionUsedFields:{},leaveTypes:[],setEmptyFcs:[],count:1},ZPFRules.OPERATOR={SHOW:0,HIDE:1,ALL:0,ANY:1},ZPFRules.ruleCreation=function(obj){var eles=$(obj).parents("#rule").find("[id*=dvRule]"),hasError=!1,isUpdate=!0,rulesArray=[];$(obj).parents("#rule").find("[errorid]").html(),$(obj).parents("#rule").find("[errorid]").hide(),eles.length>0&&$.each(eles,function(index,rule){isUpdate=!0;var ruleObject={},checkRuleObject={},conditionActionArray=[];ruleObject.ruleId=$(rule).attr("ruleid"),ruleObject.operator=$(rule).find("#ruleOperator").val(),void 0!=ruleObject.ruleId&&""!=ruleObject.ruleId&&""!=(checkRuleObject=ZPFRules.findObject(ZPForm.FIELD_RULE_DETAILS[$(obj).parents("#rule").find("#bodyTag").attr("formid")],"ruleId",ruleObject.ruleId))&&void 0!=checkRuleObject&&checkRuleObject.operator==ruleObject.operator&&(isUpdate=!1),$.each($(rule).find("[key=conditionFields]"),function(ind,condition){var checkConditionActionObject={},conditionActionObject={},attrId=$(condition).attr("id").toString();if(null!=attrId.match(/[\d]+$/)&&(conditionActionObject.conditionId=attrId.match(/[\d]+$/).toString(),checkConditionActionObject=ZPFRules.findObject(checkRuleObject.conditionArray,"conditionId",conditionActionObject.conditionId)),conditionActionObject.fcid=$(condition).find("[keyname]").val(),isUpdate||checkConditionActionObject.fcid==conditionActionObject.fcid||(isUpdate=!0),0==conditionActionObject.fcid.trim().length)$(condition).find("[errorid=errorDiv]").html("Please select a field for condition"),$(condition).find("[errorid=errorDiv]").show(),$(rule).addClass("in"),hasError=!0;else{var fieldValueObject=$(condition).next("[key=condition]").next("[key=fieldValue]");conditionActionObject.operator=$(condition).next("[key=condition]").find("[keyname=operator]").val(),conditionActionObject.value=$(fieldValueObject).find("#fieldValue").val();var fieldDtls=ZPForm.Field.getFieldComponent(conditionActionObject.fcid,$(condition).parents("#bodyTag").attr("formid"));if((fieldDtls.fieldType==ZPForm.Field.LOOKUP||fieldDtls.fieldType==ZPForm.Field.PICKLIST||fieldDtls.fieldType==ZPForm.Field.NEW_GENDER||fieldDtls.fieldType==ZPForm.Field.NEW_BLOODGROUP||fieldDtls.fieldType==ZPForm.Field.NEW_COUNTRY)&&$(fieldValueObject).find("#optionsIcon").length>0&&$.inArray(parseInt(conditionActionObject.operator),[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1){var value="";$.each($(fieldValueObject).find("#conditionDropdownSelection #listBody li.sel"),function(){var id=$(this).find("span").attr("id");value+=id+","}),value=value.substring(0,value.length-1),conditionActionObject.value=value}else if(fieldDtls.fieldType==ZPForm.Field.DATE_TIME&&!ZPFRules.checkEmptyValue(conditionActionObject.value)){var val=conditionActionObject.value;Calendar.is12HrFormat()&&(conditionActionObject.value=Calendar.convertHourFormat(val))}if($.inArray(parseInt(conditionActionObject.operator),[ZPNewView.OPERATORS.TRUE,ZPNewView.OPERATORS.FALSE,ZPNewView.OPERATORS.EMPTY,ZPNewView.OPERATORS.NOT_EMPTY])<0&&(void 0==conditionActionObject.value||"null"==conditionActionObject.value||0==conditionActionObject.value.trim().length))$(fieldValueObject).find("[errorid=errorDiv]").html(ZPI18N.getString("zp.entervalueforcondn")),$(fieldValueObject).find("[errorid=errorDiv]").show(),$(rule).addClass("in"),hasError=!0;else{if(void 0!=checkConditionActionObject.operator){var checkValue=checkConditionActionObject.value;fieldDtls.fieldType==ZPForm.Field.DATE&&(checkValue=Calendar.parseDate(checkValue,uidateFormat),checkValue=Calendar.formatDate(checkValue)),isUpdate||checkValue==conditionActionObject.value&&checkConditionActionObject.operator==conditionActionObject.operator||(isUpdate=!0)}else isUpdate||(isUpdate=!0);conditionActionArray.push(conditionActionObject)}}}),isUpdate||checkRuleObject.conditionArray.length==conditionActionArray.length||(isUpdate=!0),ruleObject.conditionArray=conditionActionArray;var showHideArray=[],actionArray=[];if($.each($(rule).find("[key=action]"),function(index1,action){var conditionActionObject={},checkConditionActionObject={};null!=(showHideArray=$(action).next("#actionFields").find("select").val())&&0!=showHideArray.length&&(conditionActionObject.operator=$(action).find("label").attr("saveValue"),void 0!=ruleObject.ruleId&&(void 0==(checkConditionActionObject=ZPFRules.findObject(checkRuleObject.actionArray,"operator",conditionActionObject.operator)).operator?isUpdate=!0:isUpdate||ZPFRules.containsAllElements(checkConditionActionObject.fieldArray,showHideArray)||(isUpdate=!0)),conditionActionObject.fieldArray=showHideArray,actionArray.push(conditionActionObject))}),0==actionArray.length){$(rule).addClass("in"),hasError=!0;var errorAt=$(rule).find("#actionFields").parent().children("[errorid=errorDiv]");$(errorAt).html(ZPI18N.getString("zp.showhidefield")),$(errorAt).show()}isUpdate||checkRuleObject.actionArray.length==actionArray.length||(isUpdate=!0),ruleObject.actionArray=actionArray,isUpdate&&rulesArray.push(ruleObject)}),!hasError&&rulesArray.length>0&&(ZPFRules.params={rulesArray:JSON.stringify(rulesArray),formId:$(obj).parents("#rule").find("#bodyTag").attr("formid"),method:"addUpdate"},$(obj).parents("#rule").find("[buttonname=done]").addClass("disabled"),ZPeople.Request.send(ZPFRules.url,ZPFRules.params,ZPFRules.saveRule))},ZPFRules.saveRule=function(data,params){if(data.hasOwnProperty("msg")){var msg=data.msg.trim();if("success"==msg){var formRuleArray=ZPForm.FIELD_RULE_DETAILS[params.formId],ruleArray=JSON.parse(params.rulesArray),isUpdate=!1;for(index in ruleArray){var ruleObject=ruleArray[index],ruleDiv="",ruleIndex=0,responseRuleObj="",fieldElms=[],actionElms=[];if(responseRuleObj=data.ruleArray[index],ruleObject.hasOwnProperty("ruleId"))ruleIndex=ZPFRules.findObject(formRuleArray,"ruleId",ruleObject.ruleId,"index").index,ruleDiv=Layout.Page.container.find("#dvRule"+(parseInt(ruleIndex)+1)),isUpdate=!0;else ruleIndex=formRuleArray.length,ruleDiv=Layout.Page.container.find("#dvRule"+(parseInt(ruleIndex)+1)),$(ruleDiv).attr("ruleid",responseRuleObj.ruleId);$.each(responseRuleObj.conditionArray,function(i1,v1){fieldElms.push(v1.fcid.toString())}),responseRuleObj.fieldElms=fieldElms,$.each(responseRuleObj.actionArray,function(i1,v1){v1.fieldArray.length>0&&$.each(v1.fieldArray,function(i2,v2){actionElms.push(v1.fieldArray[i2])})}),responseRuleObj.actionElms=actionElms,formRuleArray[ruleIndex]=responseRuleObj,ZPForm.FIELD_RULE_DETAILS[params.formId]=formRuleArray;$(ruleDiv).find("[name=conditionDiv]");var i=0;$.each(data.ruleArray[index].conditionArray,function(index,condition){var conditionId=condition.conditionId;null!=$(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id").match(/[\d]+$/)?($(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id",$(ruleDiv).find("[name=conditionDiv]:eq("+i+++")").attr("id").replace(/[\d]+$/,conditionId)),$(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id",$(ruleDiv).find("[name=conditionDiv]:eq("+i+++")").attr("id").replace(/[\d]+$/,conditionId)),$(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id",$(ruleDiv).find("[name=conditionDiv]:eq("+i+++")").attr("id").replace(/[\d]+$/,conditionId))):($(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id",$(ruleDiv).find("[name=conditionDiv]:eq("+i+++")").attr("id")+conditionId),$(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id",$(ruleDiv).find("[name=conditionDiv]:eq("+i+++")").attr("id")+conditionId),$(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id",$(ruleDiv).find("[name=conditionDiv]:eq("+i+++")").attr("id")+conditionId))}),Layout.Page.container.find("[errorid]").hide(),Layout.Page.container.find("[errorid]").html("")}isUpdate?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.rulesuccessmsg",[ZPI18N.getString("zp.updatedmsg")])):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.rulesuccessmsg",[ZPI18N.getString("zp.addedmsg")])),ZPForm.FIELD_RULE_DETAILS[params.formId].formComponent=[]}else"failure"==msg||""==msg?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror")):ZPeople.confirm(null,"",msg,"",!0,!0)}else data.hasOwnProperty("failure")&&ZPeople.confirm(null,"",data.failure,"",!0,!0);Layout.Page.container.find("#rule").find("[buttonname=done]").removeClass("disabled")},ZPFRules.constructRulesJson=function(data,params,others){if(data.code==zpconst.ResponseCodes.API_ERR_NO_ERROR){if(ZPFRules.rulesArray=[],void 0!=data.ruleArray&&(ZPFRules.rulesArray=data.ruleArray,delete data.ruleArray,$.each(ZPFRules.rulesArray,function(index,val){var fieldElms=[],actionElms=[];$.each(val.conditionArray,function(i1,v1){fieldElms.push(v1.fcid.toString())}),val.fieldElms=fieldElms,$.each(val.actionArray,function(i1,v1){v1.fieldArray.length>0&&$.each(v1.fieldArray,function(i2,v2){actionElms.push(v1.fieldArray[i2])})}),val.actionElms=actionElms})),data.hasOwnProperty("leaveTypes")&&data.leaveTypes.length>0){var leaveTypesData=data.leaveTypes,options=[],option={};$.each(leaveTypesData,function(i,types){(option={}).Id=types.id,option.DISPVALUE=types.name,options.push(option)}),ZPFRules.leaveTypes=options}ZPForm.FIELD_RULE_DETAILS[params.formId]=ZPFRules.rulesArray,ZPForm.FIELD_RULE_DETAILS[params.formId].formComponent=[],void 0!=others&&others.isFromSelfService?ZPForm.CURRFORM_PARAM.formId=params.formId:ZPForm.CURRFORM_PARAM.formId=data.formId,window.location.href.split("#")[1]&&window.location.href.split("#")[1].indexOf("admin/formslayout")>=0&&!ZPForm.isPreviewForm&&!ZPForm.isRoleBasedPreview&&!others.isValidation&&ZPFRules.rulesConstruction(params.formId)}else data.hasOwnProperty("failue")&&ZPeople.confirm(null,"",data.failue.trim(),"",!0,!0)},ZPFRules.evaluateRulesForAllFields=function(isQuickAdd){if(ZPFRules.LAYOUT=ZPForm.PRINT?ZPForm.PRINTPAGE_DATA:ZPForm.LAYOUT,0!=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].length){$.each(ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId],function(i,rule){rule.isExecuted=!1});var formFields=ZPForm.FORM_COMPONENT_DATA[ZPForm.CURRFORM_PARAM.formId].message.formComponentDetails;ZPForm.ISBLUEPRINT&&ZPForm.Blueprint.BLUEPRINT_COMPONENTS[ZPForm.CURRFORM_PARAM.formId].message.formComponentDetails,$.each(formFields,function(index1,section){$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){void 0!=field&&ZPFRules.evaluateRules(field,isQuickAdd)})})}),$.each(ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId],function(i,rule){!rule.isExecuted&&rule.hasNotes&&ZPFRules.evaluateSingleRule(rule,isQuickAdd)})}},ZPFRules.evaluateRules=function(field,isQuickAdd){var fcId=field.formComponentId,type=field.fieldType,obj=ZPFRules.LAYOUT.find("#zp_field_outer_"+fcId);ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[fcId]=[],0!=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].length&&($.each(ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId],function(i,rule){1==isQuickAdd?-1!=$.inArray(fcId,rule.actionElms)&&(rule.isExecuted||ZPFRules.evaluateSingleRule(rule,isQuickAdd),$.each(rule.conditionArray,function(j,condition){var condObj=ZPFRules.LAYOUT.find("[id=zp_field_outer_"+condition.fcid+"]");condObj.length>0&&($(condObj).attr("isconditionfield",!0),void 0==ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[condition.fcid]&&(ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[condition.fcid]=[]),ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[condition.fcid].push(rule))})):-1!=$.inArray(fcId,rule.fieldElms)?(rule.isExecuted||ZPFRules.evaluateSingleRule(rule,isQuickAdd),ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[fcId].push(rule),$(obj).length>0&&$(obj).attr("isconditionfield",!0)):-1!=$.inArray(fcId,rule.actionElms)&&(type==ZPForm.Field.PLAIN_TEXT?void 0==rule.hasNotes&&(rule.hasNotes=!0):rule.hasNotes=!1)}),$(obj).length>0&&(obj=$(obj).find("[id^=zp_field_]").length>0?$(obj).find("[id^=zp_field_]"):obj,void 0!=$(obj).attr("displaytype")?$(obj).attr("displaytype")==ZPForm.Field.RADIO_DISPLYTYPE?($(obj).find("input").off("click",ZPFRules.makeExecutefalse),$(obj).find("input").off("click",ZPFRules.evaluateRulesForField),$(obj).find("input").on("click",function(event){ZPFRules.setEmptyFcs.length>0&&(ZPFRules.setEmptyFcs=[]),ZPFRules.makeExecutefalse(),ZPFRules.evaluateRulesForField(this)})):$(obj).attr("displaytype")==ZPForm.Field.SELECT_DISPLYTYPE&&($(obj).find("select").off("change",ZPFRules.makeExecutefalse),$(obj).find("select").off("change",ZPFRules.evaluateRulesForField),$(obj).find("select").on("change",function(event){ZPFRules.setEmptyFcs.length>0&&(ZPFRules.setEmptyFcs=[]),ZPFRules.makeExecutefalse(),ZPFRules.evaluateRulesForField(this)})):($(obj).off("change",ZPFRules.makeExecutefalse),$(obj).off("change",ZPFRules.evaluateRulesForField),$(obj).on("change",function(event){ZPFRules.setEmptyFcs.length>0&&(ZPFRules.setEmptyFcs=[]),ZPFRules.makeExecutefalse(),ZPFRules.evaluateRulesForField(this)}))))},ZPFRules.evaluateSingleRule=function(rule,isQuickAdd){var str=0,noOfConditions=0;$.each(rule.conditionArray,function(j,condition){var result="",field=ZPForm.Field.getFieldComponent(condition.fcid,ZPForm.CURRFORM_PARAM.formId);if(void 0!=field){var type=field.fieldType;result=type==ZPForm.Field.DATE?ZPFRules.evaluateDateConditions(condition,condition.fcid,field,isQuickAdd):type==ZPForm.Field.DATE_TIME?ZPFRules.evaluateDateConditions(condition,condition.fcid,field,isQuickAdd):ZPFRules.evaluateCondition(condition,condition.fcid,field,isQuickAdd),condition.result=result,str+=result,noOfConditions++}});var result=!1;str>0&&(result=rule.operator==ZPFRules.OPERATOR.ALL?str==noOfConditions:str>0),rule.result=result;var executeRulesFor=[];for(i=0;i<rule.actionArray.length;i++){var actionObj=rule.actionArray[i].fieldArray;if(actionObj.length>0)for(j=0;j<actionObj.length;j++){void 0!=ZPForm.Field.getFieldComponent(actionObj[j],ZPForm.CURRFORM_PARAM.formId)&&(ZPFRules.evaluateAction(rule.actionArray[i].operator,actionObj[j],rule.result),executeRulesFor.push(actionObj[j]))}if(i+1==rule.actionArray.length){var fcsArray=executeRulesFor.slice();for(ZPFRules.makeExecutefalse(fcsArray);executeRulesFor.length>0;)ZPFRules.evaluateRulesForField(executeRulesFor.pop(),!0);rule.isExecuted=!0}}},ZPFRules.getFieldType=function(fcid){return ZPFRules.LAYOUT.find("#zp_field_outer_"+fcid).attr("fieldtype")},ZPFRules.evaluateCondition=function(condition,fcid,field,isQuickAdd,fieldValue){var fcType=field.fieldType;void 0!=fieldValue&&(fcType=field.componentType);var operator=parseInt(condition.operator),inputObject=ZPFRules.LAYOUT;void 0!=inputObject&&(inputObject=ZPFRules.LAYOUT.find("#zp_field_outer_"+fcid));var value="";if(1!=isQuickAdd||void 0!=inputObject&&0!=inputObject.length)if(value=void 0!=fieldValue?fieldValue:ZPFRules.getInputValue(inputObject,fcType,fcid),fcType!=ZPForm.Field.DECIMAL&&fcType!=ZPForm.Field.CURRENCY||ZPFRules.checkEmptyValue(value,fcType)){var dispType=field.hasOwnProperty("displayType")?field.displayType:0;"Select"!=value&&"-Select-"!=value||!($.inArray(fcType,[ZPForm.Field.PICKLIST,ZPForm.Field.LOOKUP])>-1&&$.inArray(parseInt(dispType),[ZPForm.Field.SELECT_DISPLYTYPE,ZPForm.Field.MULTISELECT_DISPLYTYPE])>-1||$.inArray(fcType,[ZPForm.Field.COUNTRY,ZPForm.Field.BLOODGROUP,ZPForm.Field.GENDER,ZPForm.Field.NEW_COUNTRY,ZPForm.Field.NEW_BLOODGROUP,ZPForm.Field.NEW_GENDER])>-1)||(value="")}else{for(value=Number(value).toString();value.length>1&&0==value.indexOf("0");)value=value.substring(1);var decPointIndex=value.indexOf(".");if(decPointIndex>=0){for(var decStr=value.substring(decPointIndex+1,value.length);decStr.length>0&&"0"==decStr.substring(decStr.length-1,decStr.length);)decStr=decStr.substring(0,decStr.length-1);value=""==decStr.trim()?value.substring(0,decPointIndex):value.replace(value.substring(decPointIndex+1,value.length),decStr)}}else value=fcType==ZPForm.Field.CHECK_BOX?"false":"";var conditionResult=!1,conditionValue=condition.value;if(fcType!=ZPForm.Field.DECIMAL&&fcType!=ZPForm.Field.CURRENCY||ZPFRules.checkEmptyValue(conditionValue,fcType)||(conditionValue=Number(conditionValue).toString()),null!=value&&"null"!=value&&""!=value&&(fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST||fcType==ZPForm.Field.NEW_GENDER||fcType==ZPForm.Field.NEW_BLOODGROUP||fcType==ZPForm.Field.NEW_COUNTRY))if($.inArray(operator,[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1&&((void 0!=inputObject?0==$(inputObject).find("input,select").length||!$(inputObject).find("input,select").is(":visible"):fcType==ZPForm.Field.LOOKUP)||fcType==ZPForm.Field.PICKLIST||fcType==ZPForm.Field.NEW_GENDER||fcType==ZPForm.Field.NEW_BLOODGROUP||fcType==ZPForm.Field.NEW_COUNTRY))if(fcType==ZPForm.Field.LOOKUP)if(void 0!=fieldValue&&void 0!=field&&void 0!=field.componentValue_ID)value=field.componentValue_ID;else{var fieldData=ZPForm.Field.getFieldValueData(fcid);value=void 0!=fieldData?fieldData.componentValue_ID:ZPFRules.findOptions(value,fcid,ZPForm.CURRFORM_PARAM.formId,!0)}else void 0!=inputObject&&0!=$(inputObject).find("input,select").length&&$(inputObject).find("input,select").is(":visible")&&fcType!=ZPForm.Field.PICKLIST||(value=ZPFRules.findOptions(value,fcid,ZPForm.CURRFORM_PARAM.formId,!0));else $.inArray(operator,[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])<0&&void 0!=inputObject&&$(inputObject).find("input,select").length>0&&$(inputObject).find("input,select").is(":visible")&&fcType==ZPForm.Field.LOOKUP&&(value=ZPFRules.findOptions(value,fcid,ZPForm.CURRFORM_PARAM.formId).trim());switch(operator){case ZPNewView.OPERATORS.EQUAL:conditionResult=ZPFRules.checkEqual(value,conditionValue,fcType);break;case ZPNewView.OPERATORS.NOT_EQUAL:conditionResult=!ZPFRules.checkEqual(value,conditionValue,fcType);break;case ZPNewView.OPERATORS.EMPTY:conditionResult=ZPFRules.checkEmptyValue(value,fcType,$(inputObject).attr("displaytype"));break;case ZPNewView.OPERATORS.NOT_EMPTY:conditionResult=!ZPFRules.checkEmptyValue(value,fcType,$(inputObject).attr("displaytype"));break;default:if(operator==ZPNewView.OPERATORS.NOT_CONTAINS)conditionResult=!ZPFRules.checkIfContains(value,conditionValue,fcType);else if(null!=value&&"null"!=value)switch(operator){case ZPNewView.OPERATORS.CONTAINS:conditionResult=ZPFRules.checkIfContains(value,conditionValue,fcType);break;case ZPNewView.OPERATORS.STARTS_WITH:conditionResult=0==value.indexOf(conditionValue);break;case ZPNewView.OPERATORS.ENDS_WITH:var startWith=value.length-conditionValue.length;conditionResult=conditionValue==value.substring(startWith,value.length);break;case ZPNewView.OPERATORS.LESS_THAN:conditionResult=ZPFRules.checkLessThan(value,conditionValue);break;case ZPNewView.OPERATORS.GREATER_THAN:conditionResult=ZPFRules.checkGreaterThan(value,conditionValue);break;case ZPNewView.OPERATORS.LESS_EQUAL:conditionResult=ZPFRules.checkLessThan(value,conditionValue)||ZPFRules.checkEqual(value,conditionValue);break;case ZPNewView.OPERATORS.GREATER_EQUAL:conditionResult=ZPFRules.checkGreaterThan(value,conditionValue)||ZPFRules.checkEqual(value,conditionValue);break;case ZPNewView.OPERATORS.TRUE:conditionResult=1==value||"true"==value.trim()||value.trim()==ZPI18N.getString("zp.yes");break;case ZPNewView.OPERATORS.FALSE:conditionResult=0==value||"false"==value.toString().trim()||value.trim()==ZPI18N.getString("zp.no")}}return conditionResult},ZPFRules.getInputValue=function(inputObject,fcType,fcid){if($(inputObject).hasClass("DN")||$(inputObject).parent("div").hasClass("DN"))return"";var inputDiv=$(inputObject).find("[id*=zp_field_]:visible");if($(inputObject).parents("#zp_form_body").siblings("div").length>0&&(0==$(inputObject).find("#zp_fieldedit_comp").length||$(inputObject).find("#zp_fieldedit_comp").not(".DN").length>0)&&(inputDiv=$(inputObject).find("[id*=zp_field_]")),$(inputDiv).length>0){if($(inputObject).find("select").length>0)return $(inputObject).find("select option:selected").val();if($(inputObject).find("input").length>0)return fcType==ZPForm.Field.CHECK_BOX?$(inputObject).find("input").is(":checked")+"":$(inputObject).find("input").length>1?$(inputObject).find("input[name]").val():$(inputObject).find("input").val();if($(inputObject).find("textarea").length>0)return $(inputObject).find("textarea").val()}else{if(void 0==$(inputObject).attr("displaytype")||$(inputObject).attr("displaytype")!=ZPForm.Field.RADIO_DISPLYTYPE){if(ZPForm.ISBLUEPRINT&&fcid)return ZPForm.getSingleRecordFieldValue(fcid);if($(inputObject).find("span:visible").length>0||1===ZPForm.getPaginationType()&&$(inputObject).find("span").length>0){val=$(inputObject).find("span:visible").text();if(0==$(inputObject).find("span:visible").length&&(val=$(inputObject).find("span").text()),"-"==val.trim()){if(ZPForm.isViewMode())if("-"==ZPForm.getSingleRecordFieldValue(fcid).trim())return val;val=""}else!ZPForm.isViewMode()||fcType!=ZPForm.Field.DECIMAL&&fcType!=ZPForm.Field.CURRENCY||(val=ZPForm.getSingleRecordFieldValue(fcid));return val}return $(inputObject).text()}return $(inputObject).find("input[type=radio]:visible").length>0?$(inputObject).find("input[type=radio]:checked").val():("-"==(val=$(inputObject).find("span:first").text()).trim()&&(val=""),val);var val}},ZPFRules.checkEmptyValue=function(value,fcType,dispType){return $.inArray(fcType,[ZPForm.Field.PICKLIST,ZPForm.Field.LOOKUP,ZPForm.Field.NEW_GENDER,ZPForm.Field.NEW_BLOODGROUP,ZPForm.Field.NEW_COUNTRY])>-1&&$.inArray(parseInt(dispType),[ZPForm.Field.SELECT_DISPLYTYPE,ZPForm.Field.MULTISELECT_DISPLYTYPE])>-1||$.inArray(fcType,[ZPForm.Field.COUNTRY,ZPForm.Field.BLOODGROUP,ZPForm.Field.GENDER,ZPForm.Field.NEW_COUNTRY,ZPForm.Field.NEW_BLOODGROUP,ZPForm.Field.NEW_GENDER])>-1?"Select"==value||""==value||"-Select-"==value:null==value||""==value||"null"==value},ZPFRules.checkEqual=function(value1,value2,fcType){if(fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST||fcType==ZPForm.Field.NEW_GENDER||fcType==ZPForm.Field.NEW_BLOODGROUP||fcType==ZPForm.Field.NEW_COUNTRY)return value2.split(",").indexOf(value1+"")>-1;if(fcType==ZPForm.Field.URL){if(value1.indexOf("://")>-1&&value2.indexOf("://")<0)return value1.split("://")[1].trim()==value2.trim();if(value2.indexOf("://")>-1&&value1.indexOf("://")<0)return value2.split("://")[1].trim()==value1.trim()}return value1==value2},ZPFRules.checkLessThan=function(value1,value2){return Number(value1)<Number(value2)},ZPFRules.checkGreaterThan=function(value1,value2){return Number(value1)>Number(value2)},ZPFRules.checkOptionsEmpty=function(value1,value2){return"-Select-"==value},ZPFRules.checkIfContains=function(value1,value2,fcType){return value1.indexOf(value2)>-1},ZPFRules.evaluateAction=function(operator,field,result){var actionFieldObject=ZPFRules.LAYOUT.find("#zp_field_outer_"+field),relatedFieldsObject=ZPFRules.LAYOUT.find("[id*=zp_form_relfield_"+field+"]"),parentSectionDiv=null,hideSection=null,isFieldShow=null,secDtls=ZPFRules.findSec(field);if(operator==ZPFRules.OPERATOR.SHOW&&result||operator==ZPFRules.OPERATOR.HIDE&&!result?(isFieldShow=!0,actionFieldObject.length>0&&($(relatedFieldsObject).removeClass("DN"),$(relatedFieldsObject).attr("isActionHidden",!1))):actionFieldObject.length>0&&($(relatedFieldsObject).addClass("DN"),$(relatedFieldsObject).attr("isActionHidden",!0)),$(actionFieldObject).parent("div").length>0||!secDtls.isTabular){if(parentSectionDiv=$(actionFieldObject).parents("[id^=zp_section_fields_]"),1==isFieldShow)if(void 0==$(actionFieldObject).attr("fieldtype")?$(actionFieldObject).removeClass("DN"):($(actionFieldObject).parent("div").removeClass("DN"),secDtls.isTabular&&ZPFRules.LAYOUT.find("[id=zp_field_outer_"+field+"]").each(function(){$(this).parent("div").removeClass("DN"),$(this).attr("isActionHidden",!1)})),$(actionFieldObject).attr("isActionHidden",!1),$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").not(".DN").length>0)1==$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").not(".DN").length&&(hideSection=!1);else{var notPlainTextFieldsLength=$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").length;$(parentSectionDiv).find("[id*=zp_field_outer_]").not(".DN").length>notPlainTextFieldsLength&&(hideSection=!1)}else if(void 0==$(actionFieldObject).attr("fieldtype")?$(actionFieldObject).addClass("DN"):($(actionFieldObject).parent("div").addClass("DN"),secDtls.isTabular&&ZPFRules.LAYOUT.find("[id=zp_field_outer_"+field+"]").each(function(){$(this).parent("div").addClass("DN"),$(this).attr("isActionHidden",!0)})),$(actionFieldObject).attr("isActionHidden",!0),ZPFRules.setEmptyFcs.push(field),0==$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").not(".DN").length){notPlainTextFieldsLength=$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").length;$(parentSectionDiv).find("[id*=zp_field_outer_]").not(".DN").length==notPlainTextFieldsLength&&(hideSection=!0)}}else if(secDtls.isTabular){var sectionDiv=ZPFRules.LAYOUT.find("#zp_section_fields_"+secDtls.sectionId),resultObj=ZPFRules.findObject(secDtls.column1,"formComponentId",field,"index",!0);0!=resultObj.length&&resultObj.hasOwnProperty("index")||(resultObj=ZPFRules.findObject(secDtls.column2,"formComponentId",field,"index",!0)),parentSectionDiv=sectionDiv;var index=resultObj.index+1,indexChange=!1,headerObject=$(sectionDiv).find("thead th:nth-child("+index+")"),formComp=ZPForm.Field.getFieldComponent(field);if(1==isFieldShow){sectionDiv.find("tbody tr").each(function(){if(formComp.fieldType==ZPForm.Field.ADDRESS){if(formComp.fieldType==ZPForm.Field.ADDRESS)for(var childIndex=0;childIndex<ZPForm.AddressField.COLUMNAMEARRAY.length;childIndex++){var currColumnName=ZPForm.AddressField.COLUMNAMEARRAY[childIndex];$(this).find("td[folabel="+currColumnName+"_"+formComp.labelName+"]").removeClass("DN"),$(this).find("td[folabel="+currColumnName+"_"+formComp.labelName+"]").attr("isActionHidden",!1)}}else{let $element=$(this).find("td[folabel="+formComp.labelName+"]");$element.length>0?(index=$element.index(),indexChange=!0,$element.removeClass("DN"),$element.attr("isActionHidden",!1)):"zp_forms_summationrow"==$(this).attr("id")&&$(this).find("td:nth-child("+(index+1)+")").removeClass("DN")}}),indexChange&&(index+=1,headerObject=$(sectionDiv).find("thead th:nth-child("+index+")"));var tdLen=ZPForm.isViewMode()?1:2;if(formComp.fieldType==ZPForm.Field.ADDRESS)for(var childObject=formComp.childFcObj,childIndex=0;childIndex<ZPForm.AddressField.COLUMNAMEARRAY.length;childIndex++){var currChildDisplayName=childObject[ZPForm.AddressField.COLUMNAMEARRAY[childIndex]].displayName+"("+formComp.displayName+")";$(sectionDiv).find("th:contains("+currChildDisplayName+")").removeClass("DN")}else $(headerObject).removeClass("DN");sectionDiv.find("tr th").not(".DN").length==tdLen&&(hideSection=!1),$(actionFieldObject).attr("isActionHidden",!1)}else{if(0==sectionDiv.find('tbody tr td:contains("No rows found.")').length){formComp=ZPForm.Field.getFieldComponent(field);sectionDiv.find("tbody tr").each(function(){if(formComp.fieldType==ZPForm.Field.ADDRESS)for(var childIndex=0;childIndex<ZPForm.AddressField.COLUMNAMEARRAY.length;childIndex++){var currColumnName=ZPForm.AddressField.COLUMNAMEARRAY[childIndex];$(this).find("td[folabel="+currColumnName+"_"+formComp.labelName+"]").addClass("DN"),$(this).find("td[folabel="+currColumnName+"_"+formComp.labelName+"]").attr("isActionHidden",!0)}else{let $element=$(this).find("td[folabel="+formComp.labelName+"]");$element.length>0?(index=$element.index(),indexChange=!0,$element.addClass("DN"),$element.attr("isActionHidden",!0)):"zp_forms_summationrow"==$(this).attr("id")&&$(this).find("td:nth-child("+(index+1)+")").addClass("DN")}})}indexChange&&(index+=1,headerObject=$(sectionDiv).find("thead th:nth-child("+index+")"));tdLen=ZPForm.isViewMode()?0:1;if(formComp.fieldType==ZPForm.Field.ADDRESS)for(childObject=formComp.childFcObj,childIndex=0;childIndex<ZPForm.AddressField.COLUMNAMEARRAY.length;childIndex++){currChildDisplayName=childObject[ZPForm.AddressField.COLUMNAMEARRAY[childIndex]].displayName+"("+formComp.displayName+")";$(sectionDiv).find("th:contains("+currChildDisplayName+")").addClass("DN")}else $(headerObject).addClass("DN");sectionDiv.find("th").not(".DN").length==tdLen&&(hideSection=!0),ZPFRules.setEmptyFcs.push(field),$(actionFieldObject).attr("isActionHidden",!0)}}if($(parentSectionDiv).length>0){var secId=$(parentSectionDiv).attr("id").split("_").pop();$(parentSectionDiv).is(":visible")||0!=hideSection?1==hideSection&&($(parentSectionDiv).is(":visible")||$(parentSectionDiv).parents("#zp_form_body").siblings().find("li[secid="+secId+"]").is(":visible")||ZPForm.PRINT)&&(1==ZPForm.getPaginationType()&&($(parentSectionDiv).parents("#zp_form_body").siblings().find("li[secid="+secId+"]").hide(),$(parentSectionDiv).parents("#zp_form_body").siblings().find('li[id^="zp_form_section_"]:visible:first').trigger("click")),$(parentSectionDiv).addClass("DN"),ZPForm.PRINT||ZPeople.isZPNewUI()||ZPForm.isEmbedForm||ZPPreboarding.isPreBoarding?ZPForm.PRINT?$(parentSectionDiv).parent().parent().prev("h3").addClass("DN"):$(parentSectionDiv).prev("h3").addClass("DN"):$(parentSectionDiv).prev("h6").addClass("DN")):1==ZPForm.getPaginationType()?($(parentSectionDiv).parents("#zp_form_body").siblings().find("li[secid="+secId+"]").show(),$(parentSectionDiv).parents("#zp_form_body").siblings().find('li[id^="zp_form_section_"].sel').trigger("click")):($(parentSectionDiv).removeClass("DN"),ZPForm.PRINT||ZPeople.isZPNewUI()||ZPForm.isEmbedForm||ZPPreboarding.isPreBoarding?ZPForm.PRINT?$(parentSectionDiv).parent().parent().prev("h3").removeClass("DN"):$(parentSectionDiv).prev("h3").removeClass("DN"):$(parentSectionDiv).prev("h6").removeClass("DN"))}else{secId=ZPFRules.findSecId(ZPForm.CURRFORM_PARAM.formId,field);var secObj=$(actionFieldObject).prevAll("#"+secId);0==secObj.length&&(secObj=$(actionFieldObject).parents("[isallowed]").prevAll("#"+secId)),1==isFieldShow?1==secObj.nextAll("[isallowed]").not(".DN").length&&secObj.removeClass("DN"):0==secObj.nextAll("[isallowed]").not(".DN").length&&secObj.addClass("DN")}},ZPFRules.evaluateRulesForField=function(obj,isFcid){var fcid=obj;if(isFcid||(void 0==obj?obj=ZPFRules.LAYOUT.find("[id^=zp_field_outer_]:active"):obj instanceof Date?obj=$(Calendar.currentObj).parents("[id*=zp_field_outer_]"):$(obj).is(":radio")&&(obj=$(obj).parents("[displaytype]")),fcid=$(obj).attr("id").split("_").pop(),ZPFRules.makeExecutefalse([fcid])),isFcid||$(obj).find("#zp_formedit_cancel").on("click",function(event){ZPFRules.evaluateRulesForField($(this).parents("[id*=zp_field_outer_]"))}),void 0!=ZPForm.CURRFORM_PARAM.formId&&void 0!=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId]){var isRulePresent=!1;if(ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent.hasOwnProperty(fcid)?isRulePresent=!0:void 0!=(fcid=$(isFcid).attr("id"))&&(fcid=fcid.substring(9),ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent.hasOwnProperty(fcid)&&(isRulePresent=!0)),isRulePresent){var rulesArray=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[fcid];rulesArray.length>0&&$.each(rulesArray,function(i,rule){ZPFRules.evaluateSingleRule(rule)})}}},ZPFRules.evaluateDateConditions=function(condition,fcid,field,isQuickAdd){var fcType=field.fieldType,conditionDate=condition.value,inputObject=ZPFRules.LAYOUT.find("#zp_field_outer_"+fcid),value="";1==isQuickAdd&&void 0==inputObject||(value=ZPFRules.getInputValue(inputObject,fcType,fcid)),fcType==ZPForm.Field.DATE?(conditionDate=Calendar.parseDate(conditionDate,uidateFormat),ZPFRules.checkEmptyValue(value)||(value=Calendar.parseDate(value,uidateFormat))):(conditionDate=Calendar.parseDate(conditionDate,uidateFormat,!0,!0),ZPFRules.checkEmptyValue(value)||(value=Calendar.convertHourFormat(value),value=Calendar.parseDate(value,uidateFormat,!0,!0)));var conditionResult=!1;switch(condition.operator){case ZPNewView.OPERATORS.EQUAL:ZPFRules.checkEmptyValue(value)||(conditionResult=Calendar.equalsTo(value,conditionDate));break;case ZPNewView.OPERATORS.NOT_EQUAL:ZPFRules.checkEmptyValue(value)||(conditionResult=!Calendar.equalsTo(value,conditionDate));break;case ZPNewView.OPERATORS.EMPTY:conditionResult=ZPFRules.checkEmptyValue(value);break;case ZPNewView.OPERATORS.NOT_EMPTY:conditionResult=!ZPFRules.checkEmptyValue(value);break;case ZPNewView.OPERATORS.LESS_THAN:ZPFRules.checkEmptyValue(value)||(conditionResult=ZPFRules.checkDateLessThan(value,conditionDate));break;case ZPNewView.OPERATORS.GREATER_THAN:ZPFRules.checkEmptyValue(value)||(conditionResult=ZPFRules.checkDateGreaterThan(value,conditionDate));break;case ZPNewView.OPERATORS.LESS_EQUAL:ZPFRules.checkEmptyValue(value)||(conditionResult=Calendar.equalsTo(value,conditionDate)||ZPFRules.checkDateLessThan(value,conditionDate));break;case ZPNewView.OPERATORS.GREATER_EQUAL:ZPFRules.checkEmptyValue(value)||(conditionResult=Calendar.equalsTo(value,conditionDate)||ZPFRules.checkDateGreaterThan(value,conditionDate))}return conditionResult},ZPFRules.checkDateLessThan=function(date1,date2,isTime){if(date1.getFullYear()<date2.getFullYear())return!0;if(date1.getFullYear()===date2.getFullYear()){if(date1.getMonth()<date2.getMonth())return!0;if(date1.getMonth()===date2.getMonth()){if(date1.getDate()<date2.getDate())return!0;if(date1.getDate()===date2.getDate()){if(date1.getHours()<date2.getHours())return!0;if(date1.getHours()===date2.getHours()&&date1.getMinutes()<date2.getMinutes())return!0}}}return!1},ZPFRules.checkDateGreaterThan=function(date1,date2,isTime){if(date1.getFullYear()>date2.getFullYear())return!0;if(date1.getFullYear()===date2.getFullYear()){if(date1.getMonth()>date2.getMonth())return!0;if(date1.getMonth()===date2.getMonth()){if(date1.getDate()>date2.getDate())return!0;if(date1.getDate()===date2.getDate()){if(date1.getHours()>date2.getHours())return!0;if(date1.getHours()===date2.getHours()&&date1.getMinutes()>date2.getMinutes())return!0}}}return!1},ZPFRules.findOptions=function(value,formComponentID,formId,isId){var formFields=ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails;ZPForm.ISBLUEPRINT&&ZPForm.Blueprint.BLUEPRINT_COMPONENTS[ZPForm.CURRFORM_PARAM.formId].message.formComponentDetails;var fieldOption=null;return $.each(formFields,function(){if(null==(fieldOption=ZPFRules.findOptionValue(this.column1,formComponentID,value,isId,formId))&&(fieldOption=ZPFRules.findOptionValue(this.column2,formComponentID,value,isId,formId)),null!=fieldOption)return!1}),fieldOption},ZPFRules.getAllOptions=function(field){if(field.fieldType===ZPForm.Field.NEW_GENDER||field.fieldType===ZPForm.Field.NEW_BLOODGROUP){if(void 0==field.OptionsWithId){let optionsVal=field.Options,oids=field.oIds,options=[];for(var i=0;i<optionsVal.length;i++){let optObj={Value:optionsVal[i],Id:oids[i]};options.push(optObj)}field.OptionsWithId=options}return field.OptionsWithId}return field.fieldType===ZPForm.Field.LOOKUP&&ZPeople.isZPNewUI()&&Layout.Page.container.find("#rule:visible,#validationrule:visible").length>0?(field.AllOptions||$.ajax({type:"POST",async:!1,url:"/createViewAction.zp",data:{mode:"getLookupList",conreqcsr:csrfToken,selectedLookupType:field.formComponentId,fcType:field.fieldType,isFromRule:!0},success:function(data){field.AllOptions=data.lookupDetailsList}}),field.AllOptions):field.isPrimaryLookup?field.hasOwnProperty("AddOptions")?field.AddOptions:field.EditOptions:field.hasOwnProperty("OptionsWithId")?field.OptionsWithId:field.Options},ZPFRules.findOptionValue=function(col,fcID,value,isId,formId){var optionVal=null;return $.each(col,function(){if(void 0!=this&&this.formComponentId==fcID&&(options=ZPFRules.getAllOptions(this),0==Object.keys(options).length&&"P_ApplyLeave"==ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formName&&"Leavetype"==this.labelName&&(options=ZPFRules.leaveTypes),null!=(optionVal=ZPFRules.findSelectedOptionValue(isId,value,options,fcID))))return!1}),optionVal},ZPFRules.findSelectedOptionValue=function(isId,value,options,fcid){var optionVal=null;return void 0!=(optionVal=ZPForm.select2.ALL_OPTIONS[fcid+"_"+value])&&""!=optionVal.trim()||$.each(options,function(){var valVariable=void 0!=this.name?"name":void 0!=this.DISPVALUE?"DISPVALUE":"Value";if((isId?ZPeople.decodeTxt(this[valVariable]).trim():void 0!=this.code?this.code:this.Id)==value.trim())return optionVal=isId?void 0!=this.code?this.code:this.Id:this[valVariable],!1}),optionVal},ZPFRules.addRule=function(formId){var formCompData=ZPForm.FORM_COMPONENT_DATA[formId];if(void 0==formCompData||ZPForm.isRoleBasedPreview||formCompData.lastprev||void 0==formCompData.refresh)ZPFRules.getFormComponents({},{},{forPost:!0,formId:formId}),ZPForm.isRoleBasedPreview=!1;else{var fc=formCompData.message.formComponentDetails;if(1==fc.length&&0==fc[0].column1.length&&0==fc[0].column2.length){var ruleDiv=ZPeople.createModalPopup("rule",ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName]),"popRgtModel PopMdModel modal-right"),emptyFormDiv='<div class="col-lg-12 text-center"><div id="zp_views_norecclass" class="PArds"></div><h2 id="zp_nodata" class="ZPNdt">'+ZPI18N.getString("zp.emptyform")+"</h2></div>";$(ruleDiv).find("#bodyTag").html(emptyFormDiv)}else void 0!=ZPForm.FIELD_RULE_DETAILS[formId]&&(ZPFRules.formActionUsedFields[formId]=[],ZPFRules.rulesConstruction(formId))}},ZPFRules.auditEnableCheck=function(){var fieldProperties=Layout.Page.container.find("#fieldProperties"),fcid=$(fieldProperties).attr("currentfcid");ZPFRules.formActionUsedFields[formCustom.formid].indexOf(fcid)>-1&&$(fieldProperties).find("input[name=auditfield]").prop("checked",!0)},ZPFRules.rulesConstruction=function(formId){var ruleDiv=ZPeople.createModalPopup("rule",ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName]),"popRgtModel PopMdModel modal-right");$(ruleDiv).find("[buttonname=done]").html(ZPI18N.getString("zp.save")),$(ruleDiv).find("[buttonname=done]").siblings("[buttonaction]").html(ZPI18N.getString("zp.close")),$(ruleDiv).find("[buttonname=done]").off(),$(ruleDiv).find("[buttonname=done]").on("click",function(){ZPFRules.ruleCreation(this)}),$(ruleDiv).find("[buttonname=done]").siblings("[buttonaction]").off(),$(ruleDiv).find("[buttonname=done]").siblings("[buttonaction]").on("click",function(){$(this).parents().find("#rule").removeClass("in"),ZPFRules.auditEnableCheck()}),$(ruleDiv).find(".modal-header").find("a[data-dismiss=modal]").off(),$(ruleDiv).find(".modal-header").find("a[data-dismiss=modal]").on("click",function(){$(this).parents().find("#rule").removeClass("in"),ZPFRules.auditEnableCheck()}),0==$(ruleDiv).find("#addRule").length&&$('<a class="btn btn-default btnaddrule" id="addRule" onclick="ZPFRules.addNewRule(this)">'+ZPI18N.getString("zp.addrule")+"</a>").insertAfter($(ruleDiv).find("[buttonaction]").first()),$(ruleDiv).find("#bodyTag").attr("formId",formId);var ruleHtml="";if(ZPFRules.count=1,ValidationRule.validationType=void 0,ZPForm.FIELD_RULE_DETAILS[formId].length>0?$.each(ZPForm.FIELD_RULE_DETAILS[formId],function(index,rule){ZPFRules.count=parseInt(index)+1,ruleHtml+=ZPFRules.singleRuleAdd(formId,rule)}):ruleHtml=ZPFRules.singleRuleAdd(formId,{}),""==ruleHtml){var emptyFormDiv='<div class="col-lg-12 text-center"><div id="zp_views_norecclass" class="PArds"></div><h2 id="zp_nodata" class="ZPNdt">'+ZPI18N.getString("zp.emptyform")+"</h2></div>";$(ruleDiv).find("h4").replaceWith('<h6 class="modal-title S16">'+ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName])+"</h6>"),$(ruleDiv).find("#bodyTag").html(emptyFormDiv)}else{var ruleGrp=ZPFRules.ruleGroupTemplate;ruleGrp=ruleGrp.replace(/\$RULECONSTRUCT\$/g,ruleHtml),$(ruleDiv).find("#bodyTag").html(ruleGrp),$(ruleDiv).find("[makeEmpty=true]").val(""),$(ruleDiv).find("#dvRule1").addClass("fade in"),$(ruleDiv).find("h4").replaceWith('<h6 class="modal-title S16">'+ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName])+"</h6>"),$(ruleDiv).find("select").select2()}},ZPFRules.singleRuleAdd=function(formId,rule){var mainDiv=ZPFRules.ruleHeaderTemplate;mainDiv=mainDiv.replace(/\$COUNT\$/g,ZPFRules.count);var ruleId=void 0!=rule&&rule.hasOwnProperty("ruleId")?"ruleid="+rule.ruleId:"";mainDiv=mainDiv.replace(/\$RULEID\$/g,ruleId);var ruleDiv='<div class="clearfix">';ruleDiv=(ruleDiv+=ZPFRules.ruleIfDivTemplate).replace(/\$RULEID\$/g,ruleId),ruleDiv=rule.operator==ZPFRules.OPERATOR.ANY?(ruleDiv=ruleDiv.replace(/\$SELECTED1\$/g,"selected")).replace(/\$SELECTED0\$/g,""):(ruleDiv=ruleDiv.replace(/\$SELECTED0\$/g,"selected")).replace(/\$SELECTED1\$/g,"");var fields=ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails,others={fields:fields};others.uniqueFields=ZPForm.FORM_COMPONENT_DATA[formId].message.UniqueFieldDetails;var fcId=ZPFRules.findFirstFcId(fields,formId,ZPForm.FORM_COMPONENT_DATA[formId].formDetails.tableName),conditionArray=rule.hasOwnProperty("conditionArray")?rule.conditionArray:[{fcid:fcId}];if($.each(conditionArray,function(index,condition){others.fieldDtl=ZPForm.Field.getFieldComponent(condition.fcid,formId),void 0==others.fieldDtl&&(others.fieldDtl={}),others.fieldArray=[condition.fcid],others.id=[condition.conditionId],others.formId=formId;var tempDiv;if(""==(tempDiv=ZPFRules.createRuleConditionFromTemplate("col-md-3 ML15","conditionFields",others)))return ruleDiv="",!1;ruleDiv+=tempDiv,others.condition=condition.operator,ruleDiv+=ZPFRules.createRuleConditionFromTemplate("col-md-3","condition",others),others.fieldValue=condition.value,ruleDiv+=ZPFRules.createRuleConditionFromTemplate("col-md-4","fieldValue",others),ruleDiv+=ZPFRules.addRemoveTemplate}),""==ruleDiv)return ruleDiv;ruleDiv+='<div class="clearfix col-md-12"><label class="control-label PL10 PT15 MB10">'+ZPI18N.getString("zp.performactions")+"</label></div>";var actionArray=rule.hasOwnProperty("actionArray")?rule.actionArray:[],showArray=[],hideArray=[];$.each(actionArray,function(index,action){action.operator==ZPFRules.OPERATOR.SHOW?showArray=action.fieldArray:hideArray=action.fieldArray}),others.multiple=!0,delete others.id;var actionArr=[{fieldArray:showArray,value:ZPI18N.getString("zp.show"),saveValue:"0"},{fieldArray:hideArray,value:ZPI18N.getString("zp.hide"),saveValue:"1"}];for(a in actionArr)others.fieldArray=actionArr[a].fieldArray,others.value=actionArr[a].value,others.saveValue=actionArr[a].saveValue,ruleDiv+=ZPFRules.createRuleConditionFromTemplate("col-md-3 ML15","action",others),ruleDiv+=ZPFRules.createRuleConditionFromTemplate("col-md-7","actionFields",others);return ruleDiv+='<div class="dverrormsg DN form-group col-md-7 ML15" errorid="errorDiv"></div>',ruleDiv+="</div>",mainDiv=mainDiv.replace(/\$RULEDIV\$/g,ruleDiv)},ZPFRules.createRuleConditionFromTemplate=function(classname,divtype,others,keyVal,isBlueprint){var ruleDiv=ZPFRules.ruleConditionTemplate;ruleDiv=(ruleDiv=(ruleDiv=ruleDiv.replace(/\$CLASS\$/g,classname)).replace(/\$ID\$/g,divtype+(others.hasOwnProperty("id")?others.id:""))).replace(/\$NUM\$/g,ZPFRules.count),ruleDiv=void 0!=keyVal?ruleDiv.replace(/\$KEY\$/g,keyVal):ruleDiv.replace(/\$KEY\$/g,divtype);var selDiv="";if(divtype.indexOf("Fields")>0){if(ruleDiv=ruleDiv.replace(/\$NAME\$/g,"conditionFields"==divtype?"conditionDiv":"actionDiv"),""==(selDiv=ZPFRules.addFieldsForSelect(others.fields,"conditionFields"==divtype,others,"actionFields"==divtype,isBlueprint)))return"";"actionFields"==divtype&&(selDiv+=ZPFRules.errorTemplate)}else"condition"==divtype?(ruleDiv=ruleDiv.replace(/\$NAME\$/g,"conditionDiv"),selDiv=ZPFRules.addConditionsForField(others.fieldDtl.fieldType,others.condition)):"fieldValue"==divtype?(ruleDiv=ruleDiv.replace(/\$NAME\$/g,"conditionDiv"),selDiv=ZPFRules.changeFieldForValue(others.condition,others.fieldDtl,void 0!=others.fieldValue?others.fieldValue:"",others.formId)):"action"==divtype&&(ruleDiv=ruleDiv.replace(/\$NAME\$/g,"actionDiv"),selDiv='<label saveValue="'+others.saveValue+'" class="form-control spnshwgry">'+others.value+"</label>");return ruleDiv=ruleDiv.replace(/\$CONDITION\$/g,selDiv)},ZPFRules.addFieldsForSelect=function(fields,isRestrict,others,isUniqFielsRes,isBlueprint){var selectDiv=ZPFRules.selectTemplate;selectDiv=(selectDiv=(selectDiv=selectDiv.replace(/\$METHOD\$/g,others.hasOwnProperty("multiple")?"ZPFRules.updateActionArray(event, this)":"ZPFRules.changeConditions(this)")).replace(/\$KEYNAME\$/g,"fcid")).replace(/\$MULTIPLE\$/g,others.hasOwnProperty("multiple")?"multiple":"");var disabled=ValidationRule.validationType==ValidationRule.validationTypes.BLUEPRINT?"disabled":"";selectDiv=(selectDiv=selectDiv.replace(/\$KEYNAME\$/g,"fcid")).replace(/\$DISABLED\$/g,disabled);var options="";if(0==$("#validationrule").length){var actionArray=ZPFRules.formActionUsedFields[others.formId];void 0!=actionArray&&0!=actionArray.length||(actionArray=ZPFRules.getAllActions(ZPForm.FIELD_RULE_DETAILS[others.formId]),ZPFRules.formActionUsedFields[others.formId]=actionArray)}var formTableName=ZPForm.FORM_COMPONENT_DATA[others.formId].formDetails.tableName,noOptions=!0;return $.each(fields,function(index1,section){options+="<optgroup label="+section.sectionName+" secid="+section.sectionId+">",$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){if(void 0!=field&&(!isUniqFielsRes||!ZPUtil.checkIsExistInArray(others.uniqueFields,field.labelName))&&(!isRestrict||!section.isTabular)&&ZPFRules.isFieldAllowed(isRestrict,field,others.fieldArray,formTableName,actionArray,isBlueprint)){noOptions=!1;var selected=$.inArray(field.formComponentId,others.fieldArray)>-1?"selected":"";options+='<option value="'+field.formComponentId+'" '+selected+">"+field.displayName+"</option>"}})}),options+="</optgroup>"}),noOptions&&(isRestrict||!isRestrict&&0==actionArray.length)?"":selectDiv=selectDiv.replace(/\$OPTIONS\$/g,options)},ZPFRules.addConditionsForField=function(fctype,id){var selectDiv=ZPFRules.selectTemplate;selectDiv=(selectDiv=selectDiv.replace(/\$METHOD\$/g,"ZPFRules.changeInput(this)")).replace(/\$KEYNAME\$/g,"operator");var selected=id==ZPNewView.OPERATORS.EQUAL?"selected":"",options='<option value="'+ZPNewView.OPERATORS.EQUAL+'" '+selected+">"+ZPI18N.getString("zp.is")+"</option>";return selected=id==ZPNewView.OPERATORS.NOT_EQUAL?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.NOT_EQUAL+'" '+selected+">"+ZPI18N.getString("zp.isnot")+"</option>",selected=id==ZPNewView.OPERATORS.EMPTY?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.EMPTY+'" '+selected+">"+ZPI18N.getString("zp.isempty")+"</option>",selected=id==ZPNewView.OPERATORS.NOT_EMPTY?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.NOT_EMPTY+'" '+selected+">"+ZPI18N.getString("zp.isnotempty")+"</option>",$.inArray(parseInt(fctype),[ZPForm.Field.DATE,ZPForm.Field.DATE_TIME,ZPForm.Field.NUMBER,ZPForm.Field.CURRENCY,ZPForm.Field.DECIMAL])>-1&&(selected=id==ZPNewView.OPERATORS.GREATER_THAN?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.GREATER_THAN+'" '+selected+">"+ZPI18N.getString("zp.greaterthan")+"</option>",selected=id==ZPNewView.OPERATORS.LESS_THAN?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.LESS_THAN+'" '+selected+">"+ZPI18N.getString("zp.lesserthan")+"</option>",selected=id==ZPNewView.OPERATORS.GREATER_EQUAL?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.GREATER_EQUAL+'" '+selected+">"+ZPI18N.getString("zp.greaterorequalto")+"</option>",selected=id==ZPNewView.OPERATORS.LESS_EQUAL?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.LESS_EQUAL+'" '+selected+">"+ZPI18N.getString("zp.lesserorequalto")+"</option>"),$.inArray(parseInt(fctype),[ZPForm.Field.DATE,ZPForm.Field.DATE_TIME,ZPForm.Field.CHECK_BOX,ZPForm.Field.FILE_UPLOAD,ZPForm.Field.BLOODGROUP,ZPForm.Field.GENDER,ZPForm.Field.COUNTRY,ZPForm.Field.NEW_BLOODGROUP,ZPForm.Field.NEW_GENDER,ZPForm.Field.NEW_COUNTRY])<0?(selected=id==ZPNewView.OPERATORS.CONTAINS?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.CONTAINS+'" '+selected+">"+ZPI18N.getString("zp.contains")+"</option>",selected=id==ZPNewView.OPERATORS.NOT_CONTAINS?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.NOT_CONTAINS+'" '+selected+">"+ZPI18N.getString("zp.notcontains")+"</option>",selected=id==ZPNewView.OPERATORS.STARTS_WITH?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.STARTS_WITH+'" '+selected+">"+ZPI18N.getString("zp.startswith")+"</option>",selected=id==ZPNewView.OPERATORS.ENDS_WITH?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.ENDS_WITH+'" '+selected+">"+ZPI18N.getString("zp.endswith")+"</option>"):fctype==ZPForm.Field.CHECK_BOX?(selected=id==ZPNewView.OPERATORS.TRUE?"selected":"",options='<option value="'+ZPNewView.OPERATORS.TRUE+'" '+selected+">"+ZPI18N.getString("zp.yes")+"</option>",selected=id==ZPNewView.OPERATORS.FALSE?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.FALSE+'" '+selected+">"+ZPI18N.getString("zp.no")+"</option>"):fctype==ZPForm.Field.FILE_UPLOAD&&(selected=id==ZPNewView.OPERATORS.EMPTY?"selected":"",options='<option value="'+ZPNewView.OPERATORS.EMPTY+'" '+selected+">"+ZPI18N.getString("zp.isempty")+"</option>",selected=id==ZPNewView.OPERATORS.NOT_EMPTY?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.NOT_EMPTY+'" '+selected+">"+ZPI18N.getString("zp.isnotempty")+"</option>"),selectDiv=selectDiv.replace(/\$OPTIONS\$/g,options)},ZPFRules.changeFieldForValue=function(condition,fieldDtl,value,formId){var selDiv="",disabledClass="",fcType=parseInt(fieldDtl.fieldType),emptyAttr="";if($.inArray(parseInt(condition),[ZPNewView.OPERATORS.EMPTY,ZPNewView.OPERATORS.NOT_EMPTY])>-1&&(value="",disabledClass="disabled",emptyAttr=" makeEmpty=true"),$.inArray(fcType,[ZPForm.Field.LOOKUP,ZPForm.Field.PICKLIST,ZPForm.Field.NEW_GENDER,ZPForm.Field.NEW_BLOODGROUP,ZPForm.Field.NEW_COUNTRY])>-1){selDiv='<span class="input-group-addon dvSetpopup $DN$" id="optionsIcon" onclick="ZPFRules.openOptionsPopup(this)" data-placement="bottom" data-toggle="popover" aria-expanded="false"><i class="IC-addlist S15"></i></span>',selDiv+=ZPFRules.optionsTemplate;var options=ZPFRules.getAllOptions(fieldDtl);0==Object.keys(options).length&&"P_ApplyLeave"==ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formName&&"Leavetype"==fieldDtl.labelName&&(options=ZPFRules.leaveTypes);var valArr=value.split(",");if(selDiv=selDiv.replace(/\$LIST\$/g,ZPFRules.constructOptions(options,valArr)),void 0==condition&&(condition=ZPNewView.OPERATORS.EQUAL),$.inArray(parseInt(condition),[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL,ZPNewView.OPERATORS.IN,ZPNewView.OPERATORS.NOT_IN])>-1){if(selDiv=selDiv.replace(/\$DN\$/g,""),disabledClass="disabled",""!=value.trim())for(val in value="",valArr){var v=ZPFRules.findSelectedOptionValue(!1,valArr[val],options,fieldDtl.formComponentId);null!=v&&(""!=value.trim()&&(value+=","),value+=v)}}else selDiv=selDiv.replace(/\$DN\$/g,"DN")}else fcType==ZPForm.Field.CHECK_BOX&&(disabledClass="disabled");var dateHtml="";fcType==ZPForm.Field.DATE&&(ZPFRules.checkEmptyValue(value)||(value=Calendar.parseDate(value,uidateFormat),value=Calendar.formatDate(value)),dateHtml='onclick="Calendar.setUpCalendar(event,this)" caltype="popup"'),fcType==ZPForm.Field.DATE_TIME&&(dateHtml='onclick="Calendar.setUpCalendar(event,this,1)" caltype="popup"',Calendar.is12HrFormat()&&(value=Calendar.convertTo12Hours(value)));var inputDiv='<div class="input-group" keyname="value"><input id="fieldValue"'+emptyAttr+' class="form-control" type="text" value="'+ZPeople.decodeTxt(ZPeople.escapeHtml(value))+'" '+disabledClass+" "+dateHtml+">";return inputDiv+=selDiv,inputDiv+="</div>",inputDiv+=ZPFRules.errorTemplate},ZPFRules.constructOptions=function(options,valArr,searchStr){var optionsDiv="";void 0!=searchStr&&searchStr.indexOf("+")>-1&&(searchStr=searchStr.replace(/\+/i,"\\+"));var searchRe=void 0!=searchStr?new RegExp(searchStr,"i"):"";return $.each(options,function(ind,option){var value=void 0!=option.name?option.name:void 0!=option.DISPVALUE?option.DISPVALUE:option.Value,id=void 0!=option.code?option.code:option.Id+"";if(value.search(searchRe)>-1){var temphtml=ZPFRules.liTemplate;temphtml=(temphtml=(temphtml=temphtml.replace(/\$LISTID\$/g,id)).replace(/\$LISTVALUE\$/g,value)).replace(/\$CLASS\$/g,$.inArray(id,valArr)>-1?"sel":""),optionsDiv+=temphtml}}),optionsDiv},ZPFRules.selectJson=function(condition,fieldDtl,value,formId){var fcType=fieldDtl.fieldType,selectJson={disableClass:!1,showIcon:!1};return $.inArray(parseInt(condition),[ZPNewView.OPERATORS.EMPTY,ZPNewView.OPERATORS.NOT_EMPTY])>-1?selectJson.disableClass=!0:$.inArray(fcType,[ZPForm.Field.LOOKUP,ZPForm.Field.PICKLIST,ZPForm.Field.NEW_GENDER,ZPForm.Field.NEW_BLOODGROUP,ZPForm.Field.NEW_COUNTRY])>-1?$.inArray(parseInt(condition),[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1&&(selectJson.showIcon=!0,selectJson.disableClass=!0):fcType==ZPForm.Field.CHECK_BOX&&(selectJson.disableClass=!0),selectJson},ZPFRules.changeConditions=function(obj){var formId=$(obj).parents("#bodyTag").attr("formId"),fieldDtls=ZPForm.Field.getFieldComponent($(obj).val(),formId),a=ZPFRules.addConditionsForField(fieldDtls.fieldType,$(obj).val());$(obj).parents("[id*=conditionFields]").next("[id*=condition]").html(a),$(obj).parents("[id*=conditionFields]").next("[id*=condition]").find("select").select2();var b=selDiv=ZPFRules.changeFieldForValue(ZPNewView.OPERATORS.EQUAL,fieldDtls,"",formId);$(obj).parents("[id*=conditionFields]").next("[id*=condition]").next("[id*=fieldValue]").html(b)},ZPFRules.changeInput=function(obj){var formId=$(obj).parents("#bodyTag").attr("formId"),fcId=$(obj).parents("[id*=condition]").prev("[id*=conditionFields]").find("select").val(),fieldDtls=ZPForm.Field.getFieldComponent(fcId,formId),inputObj=$(obj).parents("[id*=condition]").next("[id*=fieldValue]").find("input#fieldValue"),selJson=ZPFRules.selectJson(parseInt($(obj).val()),fieldDtls,"",formId);if($(inputObj).prop("disabled",selJson.disableClass),selJson.showIcon){if(!$(inputObj).siblings("#optionsIcon").is(":visible")){var val="",length=$(inputObj).siblings("#conditionDropdownSelection").find("#listBody li.sel").length;$.each($(inputObj).siblings("#conditionDropdownSelection").find("#listBody li.sel"),function(ind,option){val+=$(option).find("span").text(),ind+1<length&&(val+=",")}),$(inputObj).val(val)}$(inputObj).siblings("#optionsIcon").removeClass("DN")}else $(inputObj).siblings("#optionsIcon").addClass("DN"),$(inputObj).val("")},ZPFRules.getFormComponents=function(data,params,others){if(others.hasOwnProperty("forPost")){params={formId:others.formId,mode:"getFormComponents",isFormRule:!0};ZPForm.CURRFORM_PARAM.formId=others.formId,others.isRoleBased&&(params.roleId="-1",params.isRoleBased=!0),ZPeople.Request.send(ZPForm.URL,params,ZPFRules.getFormComponents,others),delete others.forPost}else ZPForm.FORM_COMPONENT_DATA[others.formId]=data,data.code!==ZPeople.ResponeCodes.SUCCESS?7040==data.code&&ZPFRules.getFormComponents({},{},{forPost:!0,formId:ZPForm.CURRFORM_PARAM.formId,roleId:"-1",isRoleBased:!0}):(ZPForm.populateFields(data.message),ZPForm.CURRFORM_PARAM.tableName=void 0!==data.formDetails&&data.formDetails.hasOwnProperty("tableName")?data.formDetails.tableName:"","P_EmployeeLeave"===ZPForm.CURRFORM_PARAM.tableName&&(ZPForm.CURRFORM_PARAM.fieldFormat=["Employee_ID","Leavetype","From","To","TeamEmailID","Reasonforleave"]),ZPForm.formatFields(ZPForm.FORM_COMPONENT_DATA[others.formId].message),data.hasOwnProperty("ruleArray")&&(ZPFRules.constructRulesJson(data,params,others),delete data.ruleArray),others.isValidation?ValidationRule.addRule(others.formId,ValidationRule.validationType):others.hasOwnProperty("isBlueprint")&&others.isBlueprint?others.hasOwnProperty("duringClicked")&&others.duringClicked?Blueprint.duringClicked():others.hasOwnProperty("bpValidation")&&others.bpValidation&&Blueprint.Validation.addRule(others.formId,ValidationRule.validationType):ZPFRules.addRule(others.formId))},ZPFRules.conditionSelectRecord=function(obj){$(obj).toggleClass("sel");var id=$(obj).find("span").attr("id"),className=$(obj).hasClass("sel")?"sel":"";$(obj).parents("[keyname=value]").children("#conditionDropdownSelection").find("span#"+id).parent("li").attr("class",className);var input=$(obj).parents("[keyname=value]").find("input").first().val(),val=$(obj).find("span").text();$(obj).hasClass("sel")?(input+=input.trim().length>0?",":"",input+=val):input=0==$(obj).siblings("li.sel").length?"":input.endsWith(val)?input.replace(","+val,""):input.replace(val+",",""),$(obj).parents("[keyname=value]").find("input").first().val(input)},ZPFRules.openOptionsPopup=function(obj){$(obj).siblings("input#fieldValue").val(),$(obj).popover({html:!0,content:function(){return $($(this).siblings("#conditionDropdownSelection")).clone(!0).removeClass("DN")}}),0==$(obj).siblings(".popover:visible").length&&$(obj).trigger("click"),$("body").on("click",function(e){$('[data-toggle="popover"]').each(function(){$(this).is(e.target)||0!==$(this).has(e.target).length||0!==$(".popover").has(e.target).length||$(this).popover("hide")})})},ZPFRules.searchOptions=function(obj){var searchStr=$(obj).val(),conditionId=null!=$(obj).parents("[id*=fieldValue]").attr("id").match(/[\d]+$/)?$(obj).parents("[id*=fieldValue]").attr("id").match(/[\d]+$/).toString():"",fcId=Layout.Page.container.find("#conditionFields"+conditionId).find("select").val(),formId=$(obj).parents("#bodyTag").attr("formid"),fieldDtl=ZPForm.Field.getFieldComponent(fcId,formId),options=ZPFRules.getAllOptions(fieldDtl),valArr=[];if(void 0!=ZPForm.FIELD_RULE_DETAILS[formId]&&$(obj).parents("[ruleid]").length>0){var ruleArr=ZPFRules.findObject(ZPForm.FIELD_RULE_DETAILS[formId],"ruleId",$(obj).parents("[ruleid]").attr("ruleid")),conditionObj=ZPFRules.findObject(ruleArr.conditionArray,"conditionId",conditionId);valArr=$.inArray(parseInt(conditionObj.operator),[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1?conditionObj.value.split(","):[conditionObj.value]}$(obj).parents("#conditionDropdownSelection").find("#listBody").html(ZPFRules.constructOptions(options,valArr,searchStr))},ZPFRules.findObject=function(jsonArray,searchKey,searchValue,returnValue,checkAddressIndex){var resultObject={},addOnIndex=0;return $.each(jsonArray,function(index,json){if(json[searchKey]==searchValue)return void 0==returnValue?resultObject=json:"index"==returnValue&&(resultObject.index=0==addOnIndex?index:index+addOnIndex),!1;checkAddressIndex&&"formComponentId"==searchKey&&json.fieldType==ZPForm.Field.ADDRESS&&"index"==returnValue&&(addOnIndex+=5)}),resultObject},ZPFRules.addNewRule=function(obj){$(obj).parents("#rule").find("#dvAddruleparent [name=singleRuleDiv]").length;var visibleRule=$(obj).parents("#rule").find("#dvAddruleparent [id*=dvRule]:visible");if(0==visibleRule.length||!ZPFRules.validateRuleDiv(visibleRule)){var formId=$(obj).parents("#rule").find("#bodyTag").attr("formid"),cnt=$(obj).parents("#rule").find("#dvAddruleparent [name=singleRuleDiv]").length;ZPFRules.count=++cnt,$(obj).parents("#rule").find("#dvAddruleparent").append(ZPFRules.singleRuleAdd(formId,{})),$(obj).parents("#rule").find("#dvAddruleparent #dvRule"+cnt).find("select").select2(),$(obj).parents("#rule").find("#dvAddruleparent [id*=dvRule]").length>1&&$(obj).parents("#rule").find("#dvAddruleparent #dvRule"+cnt).siblings("[name=ruleToggleDiv]").trigger("click")}},ZPFRules.deleteRule=function(data,params,others){var isRemoved=!1;if(params.hasOwnProperty("forPost")){var ruleParent=$(others.obj).parents("[name=singleRuleDiv]");0==$(ruleParent).find("[ruleid]").length?$(ruleParent).siblings("[name=singleRuleDiv]").length>0&&($(ruleParent).remove(),isRemoved=!0):(delete(params={ruleId:$(ruleParent).find("[ruleid]").attr("ruleid"),formId:$(ruleParent).parents("#bodyTag").attr("formid"),method:"deleteRule"}).forPost,tabCustom.param=[ZPFRules.url,params,ZPFRules.deleteRule,{obj:ruleParent}],ZPeople.confirm(null,"","Are you sure you want to delete this rule",tabCustom.deleteRequest,!1,!0))}else if("success"==data.msg.trim()){$(others.obj).remove(),isRemoved=!0;var formRuleArray=ZPForm.FIELD_RULE_DETAILS[params.formId],index=ZPFRules.findObject(formRuleArray,"ruleId",params.ruleId,"index").index;formRuleArray.splice(index,1),formRuleArray.formComponent=[],ZPForm.FIELD_RULE_DETAILS[params.formId]=formRuleArray,ZPFRules.formActionUsedFields[params.formId]=ZPFRules.getAllActions(formRuleArray),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.rulesuccessmsg",[ZPI18N.getString("zp.deletedmsg")])),""==Layout.Page.container.find("#dvAddruleparent").html().trim()&&Layout.Page.container.find("#rule #addRule").trigger("click")}else""!=data.msg.trim?ZPeople.confirm(null,"",data.message.trim(),"",!0,!0):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"));isRemoved&&$.each(Layout.Page.container.find("#dvAddruleparent [name=singleRuleDiv]"),function(index,ruleDiv){0==index&&$(this).find("[name=ruleToggleDiv]").trigger("click"),$(this).find("[name=ruleToggleDiv] h6").text(ZPI18N.getString("zp.rule")+" "+(index+1));var id=$(this).find("[id*=dvRule]").attr("id");$(this).find("[name=ruleToggleDiv]").attr("data-target","#"+id.replace(/[\d]+$/,index+1)),$(this).find("[id*=dvRule]").attr("id",id.replace(/[\d]+$/,index+1))})},ZPFRules.findFirstFcId=function(fields,formId,tableName,isBlueprint){var fcId=null,returnFlag=!0,fieldArray=ZPFRules.formActionUsedFields[formId];return $.each(fields,function(index1,section){return $.each(["column1","column2"],function(index2,col){return $.each(section[col],function(index3,field){return void 0!=field&&ZPFRules.isFieldAllowed(!0,field,[],tableName,fieldArray,isBlueprint)&&(fcId=field.formComponentId,returnFlag=!1),returnFlag}),returnFlag}),returnFlag}),fcId},ZPFRules.getAllActions=function(rules){var actionArray=[],cnt=0;return $.each(rules,function(index,rule){$.each(rule.actionArray,function(index1,action){$.each(action.fieldArray,function(index2,field){actionArray[cnt++]=field})})}),actionArray},ZPFRules.addDeleteCondition=function(obj,isAdd){var parentDiv=$(obj).parents("#bodyTag"),currentInd=-1;if(isAdd){var formId=parentDiv.attr("formid"),fields=ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails,others={fields:fields},fcId=ZPFRules.findFirstFcId(fields,formId,ZPForm.FORM_COMPONENT_DATA[formId].formDetails.tableName),conditionActionDiv="",keyJson={cf:"conditionFields",con:"condition",fieldVal:"fieldValue"};$(obj).parents("#dvValidruleparent").length>0&&(currentInd=parseInt($(obj).parents("[name=addRemoveDiv]").prevAll("#criteriaInd").first().attr("ind"))+1,conditionActionDiv=(conditionActionDiv=(conditionActionDiv=ValidationRule.andorTemplate+'<label name="conditionDiv" class="FL ML20 PT5" id="criteriaInd" ind='+currentInd+">"+currentInd+"</label>").replace(/\$[a-z]+SELECTED\$/g,"")).replace(/\$(IND|NUM)\$/g,currentInd),keyJson={cf:"formComponentID",con:"Operator",fieldVal:"CrtVal"});var ruleDiv=ZPFRules.ruleConditionTemplate;others.fieldDtl=ZPForm.Field.getFieldComponent(fcId,formId),others.fieldArray=[fcId],others.formId=formId;var selDiv="";conditionActionDiv=(conditionActionDiv=(conditionActionDiv+=(ruleDiv=ruleDiv.replace(/\$NAME\$/g,"conditionDiv")).replace(/\$CLASS\$/g,"col-md-3 ML15")).replace(/\$KEY\$/g,keyJson.cf)).replace(/\$ID\$/g,"conditionFields"),selDiv=ZPFRules.addFieldsForSelect(others.fields,!0,others,!1),conditionActionDiv=conditionActionDiv.replace(/\$CONDITION\$/g,selDiv),conditionActionDiv=(conditionActionDiv=(conditionActionDiv+=ruleDiv.replace(/\$CLASS\$/g,"col-md-3")).replace(/\$KEY\$/g,keyJson.con)).replace(/\$ID\$/g,"condition"),selDiv=ZPFRules.addConditionsForField(others.fieldDtl.fieldType,others.condition),conditionActionDiv=conditionActionDiv.replace(/\$CONDITION\$/g,selDiv),conditionActionDiv=(conditionActionDiv=(conditionActionDiv=(conditionActionDiv+=ruleDiv.replace(/\$CLASS\$/g,"col-md-4")).replace(/\$KEY\$/g,keyJson.fieldVal)).replace(/\$ID\$/g,"fieldValue")).replace(/\$NUM\$/g,currentInd),selDiv=ZPFRules.changeFieldForValue(others.condition,others.fieldDtl,void 0!=others.fieldValue?others.fieldValue:"",others.formId),conditionActionDiv=conditionActionDiv.replace(/\$CONDITION\$/g,selDiv),conditionActionDiv+=ZPFRules.addRemoveTemplate,$(conditionActionDiv).insertAfter($(obj).parents("[name=addRemoveDiv]")),$(obj).parents("#dvValidruleparent").length>0&&2==parentDiv.find("[ind="+currentInd+"]").length&&$(obj).parents("[name=addRemoveDiv]").nextAll("[id=criteriaInd]").first().nextAll("[id=criteriaInd]").each(function(){var ind=$(this).attr("ind");$(this).attr("ind",++ind),$(this).nextAll("[rulenum="+(ind-1)+"]").attr("rulenum",ind),$(this).text(ind)}),-1!=currentInd&&parentDiv.find("[id=criteriaInd]").length>1&&(parentDiv.find("#patternDiv").show(),ValidationRule.constructPatternAdd(parentDiv,currentInd,"and")),$(obj).parents("[id*=dvRule]").find("select").select2()}else $(obj).parents("[id*=dvRule]").find("[name=conditionDiv]").length>5&&($(obj).parents("#dvValidruleparent").length>0&&(currentInd=parseInt($(obj).parents("[name=addRemoveDiv]").prevAll("#criteriaInd").first().attr("ind")),$(obj).parents("[name=addRemoveDiv]").nextAll("[id=criteriaInd]").each(function(){var ind=$(this).attr("ind");$(this).attr("ind",--ind),$(this).nextAll("[rulenum="+(ind+1)+"]").attr("rulenum",ind),$(this).text(ind)})),$(obj).parents("[name=addRemoveDiv]").prev("[name=conditionDiv]").remove(),$(obj).parents("[name=addRemoveDiv]").prev("[name=conditionDiv]").remove(),$(obj).parents("[name=addRemoveDiv]").prev("[name=conditionDiv]").remove(),$(obj).parents("[name=addRemoveDiv]").prev("[name=conditionDiv]").remove(),1==currentInd?(delOp=$(obj).parents("[name=addRemoveDiv]").next("[name=operatorDiv]").find("select").val(),$(obj).parents("[name=addRemoveDiv]").next("[name=operatorDiv]").remove()):(delOp=$(obj).parents("[name=addRemoveDiv]").prev("[name=operatorDiv]").find("select").val(),$(obj).parents("[name=addRemoveDiv]").prev("[name=operatorDiv]").remove()),$(obj).parents("[name=addRemoveDiv]").remove(),-1!=currentInd&&(1==parentDiv.find("[id=criteriaInd]").length?(parentDiv.find("#patternDiv").hide(),parentDiv.find("#patternDiv input[type=text]").val("")):ValidationRule.constructPatternDelete(parentDiv,currentInd,delOp)))},ZPFRules.updateActionArray=function(event,obj,isAdd){var formId=$(obj).parents("#bodyTag").attr("formid"),formActionArray=ZPFRules.formActionUsedFields[formId],length=formActionArray.length,valArr=[],currentObj=$(obj).parents("[key=actionFields]");if("fcid"==$(obj).attr("keyname"))if(event.hasOwnProperty("removed")){if(formActionArray.length>0){valArr[0]=event.removed.id;var ind=$.inArray(event.removed.id,formActionArray);formActionArray.splice(ind,1),ZPFRules.formActionUsedFields[formId]=formActionArray,isAdd=!1}}else ZPFRules.formActionUsedFields[formId][length]=event.added.id,valArr[0]=event.added.id,isAdd=!0;else if($(obj).parents("[name=addRemoveDiv]").length>0)if(1==isAdd)(null==valArr||valArr.length>0)&&(currentObj=$(obj).parents("[name=addRemoveDiv]").next("[name=actionDiv]").next("[name=actionDiv]"),valArr=$(currentObj).find("select").val()),null!=valArr&&valArr.length>0&&(ZPFRules.formActionUsedFields[formId][length]=valArr[0]);else if(currentObj=$(obj).parents("[name=addRemoveDiv]").prev("[name=actionDiv]"),valArr=$(currentObj).find("select").val(),formActionArray.length>0)for(val in valArr)index=$.inArray(valArr[val],formActionArray),formActionArray.splice(ind,1),ZPFRules.formActionUsedFields[formId]=formActionArray;null!=valArr&&valArr.length>0&&(isAdd?$.each($(obj).parents("#bodyTag").find("[key=actionFields]").not(currentObj),function(index,selectDiv){for(val in valArr)$(this).find("[keyname=fcid]").find("option[value="+valArr[val]+"]").remove();$(this).find("[keyname=fcid]").select2()}):$.each($(obj).parents("#bodyTag").find("[key=actionFields]").not(currentObj),function(index,selectDiv){for(val in valArr){var fieldDtl=ZPForm.Field.getFieldComponent(valArr[val],formId),secId=ZPFRules.findSecId(formId,valArr[val]);$(this).find("[keyname=fcid] optgroup[secid="+secId+"]").append('<option value="'+valArr[val]+'">'+fieldDtl.displayName+"</option>")}$(this).find("[keyname=fcid]").select2()}))},ZPFRules.findTabularFieldIndex=function(formId,fcId){var index=0;return $.each(ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails,function(index1,section){$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){if(void 0!=field&&field.formComponentId==fcId)return index=index3,!1})})}),index},ZPFRules.findSecId=function(formId,fcId){var secId=0;return $.each(ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails,function(index1,section){$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){if(void 0!=field&&field.formComponentId==fcId)return secId=section.sectionId,!1})})}),secId},ZPFRules.setEmptyValue=function(){var editId=ZPForm.Field.Edit.FORMCOMP_ID,emptyFcs=ZPFRules.setEmptyFcs,value="";$.each(emptyFcs,function(index){value="";var fcComp=ZPForm.Field.getFieldComponent(emptyFcs[index]);ZPForm.Field.Edit.FORMCOMP_ID=emptyFcs[index],fcComp.fieldType==ZPForm.Field.CHECK_BOX?value="false":fcComp.fieldType!=ZPForm.Field.LOOKUP&&fcComp.fieldType!=ZPForm.Field.PICKLIST&&fcComp.fieldType!=ZPForm.Field.NEW_GENDER&&fcComp.fieldType!=ZPForm.Field.NEW_BLOODGROUP&&fcComp.fieldType!=ZPForm.Field.NEW_COUNTRY||(value=$.inArray(fcComp.displayType,[ZPForm.Field.MULTISELECT_DISPLYTYPE,ZPForm.Field.CHECK_BOXES_DISPLYTYPE])>-1?[]:"-Select-");var secDtls=ZPFRules.findSec(emptyFcs[index]);secDtls.isTabular?ZPFRules.setEmptyValueForTabColumn(emptyFcs[index],secDtls):value=ZPForm.Field.setValue(fcComp,value)}),ZPFRules.setEmptyFcs=[],ZPForm.Field.Edit.FORMCOMP_ID=editId},ZPFRules.isFieldAllowed=function(isRestrict,field,fieldArray,formTableName,actionArray,isBlueprint){if(isRestrict){if(field.isReadOnly)return!1;if(field.hasOwnProperty("displayType")&&$.inArray(field.displayType,[ZPForm.Field.MULTISELECT_DISPLYTYPE,ZPForm.Field.CHECK_BOXES_DISPLYTYPE])>-1)return!1;if((!isBlueprint||field.fieldType!=ZPForm.Field.FILE_UPLOAD)&&$.inArray(field.fieldType,[ZPForm.Field.FILE_UPLOAD,ZPForm.Field.SCRIPT,ZPForm.Field.PLAIN_TEXT,ZPForm.Field.IMAGE,ZPForm.Field.AUTONUMBER,ZPForm.Field.ADDRESS,ZPForm.Field.SOCIAL_SECURITY_NUMBER])>-1)return!1;if("P_TimesheetJob"==formTableName&&$.inArray(field.labelName,["BillableStatus","Hours"])>-1)return!1;if("P_ClientDetails"==formTableName&&$.inArray(field.labelName,["Billing_Method"])>-1)return!1;if("P_PerformanceAppraisal"==formTableName&&$.inArray(field.labelName,["Rating","CurrentCTC"])>-1||"P_SelfAppraisal"==formTableName&&$.inArray(field.labelName,["AppriasalConfiguration","Rating"])>-1)return!1;if("P_EmployeeLeave"==formTableName&&$.inArray(field.labelName,["DateOfRequest","Daystaken","ZP_Leave_Unit"])>-1)return!1;if("P_Employee"==formTableName&&field.isSystem&&$.inArray(field.labelName,["OrganizationTag"])>-1)return!1}else{if(field.isReadOnly||field.isSystemMandatory)return!1;if($.inArray(formTableName,Timetracker.constants.tableNames)>-1&&(field.isSystem||"P_TimesheetJob"==formTableName&&$.inArray(field.labelName,["Reminder","ReminderTime"])>-1))return!1;if("P_Employee"==formTableName&&field.isSystem&&$.inArray(field.labelName,["Second_Reporting_To","Reporting_To","Role","Social_Security_Number"])>-1)return!1;if("P_EmployeeLeave"==formTableName&&field.isSystem&&$.inArray(field.labelName,["TeamEmailID","Reasonforleave"])<0)return!1;if("P_Goals"==formTableName&&field.isSystem&&$.inArray(field.labelName,["UserRating","ManagerRating"])>-1)return!1;if("P_Candidate"==formTableName&&field.isSystem&&$.inArray(field.labelName,["Last_Name","CandidateEntity","Business_unit","CandidateDivision"])>-1)return!1;if("P_Employee"==formTableName&&field.isSystem&&$.inArray(field.labelName,["Entity","Business_unit","Division","OrganizationTag"])>-1)return!1;if($.inArray(field.fieldType,[ZPForm.Field.AUTONUMBER])>-1)return!1;if($.inArray(field.formComponentId,fieldArray)<0&&$.inArray(field.formComponentId,actionArray)>-1)return!1}return!0},ZPFRules.containsAllElements=function(array1,array2){var isContains=!0;return array1.length==array2.length?$.each(array1,function(index){if(array2.indexOf(array1[index])<0)return isContains=!1,!1}):isContains=!1,isContains},ZPFRules.validateRuleDiv=function(obj){var ruleDiv=$(obj),hasError=!1;if($(ruleDiv).find("[errorid]").html(""),$(ruleDiv).find("[errorid]").hide(),$.each($(ruleDiv).find("[id=conditionFields]"),function(ind,condition){var conditionActionObject={};if(conditionActionObject.fcid=$(condition).find("[keyname]").val(),0==conditionActionObject.fcid.trim().length)$(condition).find("[errorid=errorDiv]").html("Please select a field for condition"),$(condition).find("[errorid=errorDiv]").show(),hasError=!0;else{var fieldValueObject=$(condition).next("[id=condition]").next("[id=fieldValue]");if(conditionActionObject.operator=$(condition).next("[id=condition]").find("[keyname]").val(),conditionActionObject.value=$(fieldValueObject).find("#fieldValue").val(),$(fieldValueObject).find("#optionsIcon").length>0&&$.inArray(parseInt(conditionActionObject.operator),[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1){var fieldDtls=ZPForm.Field.getFieldComponent(conditionActionObject.fcid,$(condition).parents("#bodyTag").attr("formid"));if(fieldDtls.fieldType==ZPForm.Field.LOOKUP||fieldDtls.fieldType==ZPForm.Field.PICKLIST||fieldDtls.fieldType==ZPForm.Field.NEW_GENDER||fieldDtls.fieldType==ZPForm.Field.NEW_BLOODGROUP||fieldDtls.fieldType==ZPForm.Field.NEW_COUNTRY){var valArr=$(fieldValueObject).find("#conditionDropdownSelection #listBody li.sel").length>1?conditionActionObject.value.split(","):[conditionActionObject.value],value="";for(val in valArr)value+=ZPFRules.findOptions(valArr[val],conditionActionObject.fcid,$(condition).parents("#bodyTag").attr("formid"),!0)+",";value=value.substring(0,value.length-1),conditionActionObject.value=value}}$.inArray(parseInt(conditionActionObject.operator),[ZPNewView.OPERATORS.TRUE,ZPNewView.OPERATORS.FALSE,ZPNewView.OPERATORS.EMPTY,ZPNewView.OPERATORS.NOT_EMPTY])<0&&(void 0==conditionActionObject.value||"null"==conditionActionObject.value||0==conditionActionObject.value.trim().length)&&($(fieldValueObject).find("[errorid=errorDiv]").html(ZPI18N.getString("zp.entervalueforcondn")),$(fieldValueObject).find("[errorid=errorDiv]").show(),hasError=!0)}}),$(obj).parents("#dvValidruleparent").length=0){var showHideArray=[],actionsCount=0;if($.each($(ruleDiv).find("[id=action]"),function(index1,action){$(action).next("[id=actionFields]").find("[errorid=errorDiv]").hide(),null!=(showHideArray=$(action).next("#actionFields").find("select").val())&&0!=showHideArray.length&&actionsCount++}),0==actionsCount){hasError=!0;var errorAt=$(ruleDiv).find("#actionFields").parent().children("[errorid=errorDiv]");$(errorAt).html(ZPI18N.getString("zp.showhidefield")),$(errorAt).show()}}return hasError},ZPFRules.collapseElement=function(obj){var toggleDiv=$(obj).siblings($(obj).attr("data-target")),ruleDiv=$(obj).parents("#rule:visible,#validationrule:visible").find("[id*=dvRule]:visible");0!=ruleDiv.length&&ZPFRules.validateRuleDiv(ruleDiv)||($(toggleDiv).find("[errorid]").html(""),$(toggleDiv).find("[errorid]").hide(),$(toggleDiv).collapse("show"),$(ruleDiv).collapse("hide"))},ZPFRules.makeExecutefalse=function(fcs){if(void 0!=fcs&&fcs.length>0)for(;fcs.length>0;){var fcid=fcs.pop();if(void 0!=ZPForm.CURRFORM_PARAM.formId&&void 0!=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId]&&ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent.hasOwnProperty(fcid)){var rulesArray=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[fcid];if(rulesArray.length>0)for(ruleIn=0;ruleIn<rulesArray.length;ruleIn++){rulesArray[ruleIn].isExecuted=!1}}}else void 0!=ZPForm.CURRFORM_PARAM.formId&&void 0!=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId]&&$.each(ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent,function(key,rulesArray){if(rulesArray.length>0)for(ruleIn=0;ruleIn<rulesArray.length;ruleIn++){rulesArray[ruleIn].isExecuted=!1}})},ZPFRules.findSec=function(fcId){var sectionDtls={},fields=ZPForm.FORM_COMPONENT_DATA[ZPForm.CURRFORM_PARAM.formId].message.formComponentDetails,returnFlag=!0;return $.each(fields,function(index1,section){return $.each(["column1","column2"],function(index2,col){return $.each(section[col],function(index3,field){if(void 0!=field&&field.formComponentId==fcId)return sectionDtls=section,returnFlag=!1}),returnFlag}),returnFlag}),sectionDtls},ZPFRules.setEmptyValueForTabColumn=function(fcId,secDtls){var fieldObjects=ZPFRules.LAYOUT.find("[id=zp_field_outer_"+fcId+"]"),value="";if(0==fieldObjects.length){var sectionDiv=ZPFRules.LAYOUT.find("#zp_section_fields_"+secDtls.sectionId);0!=(resultObj=ZPFRules.findObject(secDtls.column1,"formComponentId",fcId,"index",!0)).length&&resultObj.hasOwnProperty("index")||(resultObj=ZPFRules.findObject(secDtls.column2,"formComponentId",fcId,"index",!0));var index=resultObj.index+1;fieldObjects=sectionDiv.find("tbody tr td:nth-child("+index+")")}var findProp={},inputObject=fieldObjects.first(),inputDiv=$(inputObject).find("[id*=zp_field_]:visible");$(inputObject).parents("#zp_form_body").siblings("div").length>0&&(0==$(inputObject).find("#zp_fieldedit_comp").length||$(inputObject).find("#zp_fieldedit_comp").not(".DN").length>0)&&(inputDiv=$(inputObject).find("[id*=zp_field_]")),$(inputDiv).length>0?$(inputObject).find("select").length>0?findProp={find:"select option:selected",val:"text"}:$(inputObject).find("input").length>0?findProp=fcType==ZPForm.Field.CHECK_BOX?{find:"input",val:"checked"}:{find:"input",val:"val"}:$(inputObject).find("textarea").length>0&&(findProp={find:"textarea",val:"val"}):void 0!=$(inputObject).attr("displaytype")&&$(inputObject).attr("displaytype")==ZPForm.Field.RADIO_DISPLYTYPE?findProp=$(inputObject).find("input[type=radio]:visible").length>0?{find:"input[type=radio]:checked",val:"checked"}:{find:"span:first",val:"text"}:($(inputObject).find("span:visible").length>0&&(findProp={find:"span:visible",val:"text"}),findProp={val:"text"}),fieldObjects.each(function(){findProp.hasOwnProperty("find")?"text"==findProp.val?findProp.find.indexOf("span")>-1?$(this).find(findProp.find).text("-"):$(this).find(findProp.find).text(""):"val"==findProp.val?$(this).find(findProp.find).val(""):"checked"==findProp.val&&$(this).find(findProp.find).each(function(){$(this).prop("checked",!1),value=!1}):($(this).is("td"),$(this).text("-"))});var fieldValData={};if(secDtls.isGridType){var recordDtls=ZPForm.getSingleRecord();if(void 0!=recordDtls&&void 0!=recordDtls.record){var resultObj,recData=recordDtls.record;$.each(recData.message.recordDetails,function(){if(this.sectionId==secDtls.sectionId&&this.hasOwnProperty("datarows"))return fieldValData=this.datarows,!1}),0!=(resultObj=ZPFRules.findObject(secDtls.column1,"formComponentId",fcId,"index",!0)).length&&resultObj.hasOwnProperty("index")||(resultObj=ZPFRules.findObject(secDtls.column2,"formComponentId",fcId,"index",!0));index=resultObj.index;for(i in fieldValData){fieldValData[i][index]=value}}}else for(i in(fieldValData=ZPForm.Field.getFieldValueData(fcId)).componentValue)fieldValData.componentValue[i]=value},ZPFRules.removeDeletedRows=function(deleteArray){for(i in deleteArray){var deleteRow=deleteArray[i],row=ZPFRules.LAYOUT.find("[rowid="+deleteRow+"]"),secId=row.attr("secid"),recordDtls=ZPForm.getSingleRecord();if(void 0!=recordDtls&&void 0!=recordDtls.record){var recData=recordDtls.record.recordDetails;$.each(recData.message.recordDetails,function(){if(this.isTabular){var fieldValData=this.recordIdArray;for(i in fieldValData)if(fieldValData[i]==deleteRow){if(this.hasOwnProperty("datarows"))this.datarows.splice(i,1);else{if(this.hasOwnProperty("column1"))for(fieldIndex in this.column1){this.column1[fieldIndex].componentValue.splice(i,1)}if(this.hasOwnProperty("column2"))for(fieldIndex in this.column2){this.column2[fieldIndex].componentValue.splice(i,1)}}return fieldValData.splice(i,1),this.noOfRows-=1,this.recordIdArray=fieldValData,!1}}})}0==row.siblings("[secid="+secId+"][row]").length?row.prop("rowid",""):row.remove()}},ZPFRules.hideFields=function(currentRow,prevRow){return prevRow.find("[id*=zp_field_outer_]").not(":visible").each(function(){var id=$(this).attr("id");$(this).is("td")?(currentRow.find("td#"+id).addClass("DN"),currentRow.find("td#"+id).attr("isActionHidden",!0)):(currentRow.find("#"+id).parent("div").addClass("DN"),currentRow.find("#"+id).attr("isActionHidden",!0))}),currentRow},ZPFRules.constructActionElms=function(rulesArray){var responseRuleObj={},actionElms=[],ruleElms=[];return $.each(rulesArray,function(index){var currRule=rulesArray[index];$.each(currRule.actionArray,function(i1,v1){v1.fieldArray.length>0&&$.each(v1.fieldArray,function(i2,v2){actionElms.push(v1.fieldArray[i2]),ruleElms.push(currRule)})})}),responseRuleObj.actionElms=actionElms,responseRuleObj.rules=ruleElms,responseRuleObj},ZPFRules.evaluateRuleForField=function(rule,record,actionFcId){rule.operator;var conditionArray=rule.conditionArray,actionArray=rule.actionArray,str=0,noOfConditions=0;$.each(conditionArray,function(i){var condition=conditionArray[i],fcid=condition.fcid;condition.value;$.each(record,function(index1,section){$.each(["column1","column2"],function(index2,col){void 0!=section[col]&&$.each(section[col],function(index3,field){if(void 0!=field&&fcid==field.formComponentId){var fieldValue=field.componentValue,result=ZPFRules.evaluateCondition(condition,fcid,field,!1,fieldValue);str+=result,noOfConditions++}})})})});var result=!1;str>0&&(result=rule.operator==ZPFRules.OPERATOR.ALL?str==noOfConditions:str>0);var isAllowed=!1;return $.each(actionArray,function(index,action){var actionoper=action.operator,actionFieldArray=action.fieldArray;$.inArray(actionFcId,actionFieldArray)>-1&&(0==actionoper?result&&(isAllowed=!0):result||(isAllowed=!0))}),isAllowed},ZPFRules.getDependentFields=function(critFcid,fields,isFromSelfService){var rules=ZPForm.FIELD_RULE_DETAILS[ZPForm.formid];isFromSelfService&&(rules=ZPForm.FIELD_RULE_DETAILS[ZPeople.EMP_FORMID]),void 0!=rules&&rules.length>0&&$.each(rules,function(index,rule){var fieldElms=rule.fieldElms,actionElms=rule.actionElms;(void 0!=fieldElms&&$.inArray(critFcid,fieldElms)>-1||void 0!=actionElms&&$.inArray(critFcid,actionElms)>-1)&&(void 0!=fieldElms&&fieldElms.length>0&&$.each(fieldElms,function(index2,fieldElm){-1==$.inArray(fieldElm,fields)&&(fields.push(fieldElm),ZPFRules.getDependentFields(fieldElm,fields,isFromSelfService))}),void 0!=actionElms&&actionElms.length>0&&$.each(actionElms,function(index1,actionElm){-1==$.inArray(actionElm,fields)&&(fields.push(actionElm),ZPFRules.getDependentFields(actionElm,fields,isFromSelfService))}))})};var zpMassUpdate={formId:void 0,url:"/massUpdate.zp",params:{},callback:"",firstFieldId:void 0,fieldDetails:void 0,isUser:!1,fieldCount:0,addLinkHtml:'<tr name="addnewlink"><td colspan="4"><a class="btn btn-link ML5" id="addnewLnk" onclick="zpMassUpdate.listBulkUpdateFields(null,null,true)"><span class="IC-add MR5 S12"></span>'+ZPI18N.getString("zp.addnew")+"</a></td></tr>",massUpdateFields:function(isAddNew){this.formId=Layout.Page.urlparam.formId;var isLocationTrackingEnabled=!1;ZPForm.FORM_DETAILS.hasOwnProperty(this.formId)&&(isLocationTrackingEnabled=ZPForm.FORM_DETAILS[this.formId].isLocationTrackingEnabled),isLocationTrackingEnabled&&void 0==ZPForm.isLocationPermissionEnabled?Timetracker.location.getLocation(zpMassUpdate.massUpdateFieldsGeo,isAddNew,this):zpMassUpdate.massUpdateFieldsGeo(isAddNew,this)},massUpdateFieldsGeo:function(isAddNew,ele){ele.formId=Layout.Page.urlparam.formId,Layout.Page.hash.indexOf("performance/salary/employeesalary")>-1&&(ele.formId=Appraisal.Salary.formDetails.formId);var isLocationTrackingEnabled=!1;if(ZPForm.FORM_DETAILS.hasOwnProperty(ele.formId)&&(isLocationTrackingEnabled=ZPForm.FORM_DETAILS[ele.formId].isLocationTrackingEnabled),isLocationTrackingEnabled&&(ZPForm.isLocationPermissionEnabled=!1,0!==Object.keys(Timetracker.location.latLongParam).length)){var location_obj=Timetracker.location.latLongParam;location_obj.hasOwnProperty("latitude")&&null!==location_obj.latitude&&!isNaN(Timetracker.location.latLongParam.latitude)&&location_obj.hasOwnProperty("longitude")&&null!==location_obj.longitude&&!isNaN(Timetracker.location.latLongParam.longitude)&&location_obj.hasOwnProperty("accuracy")&&null!==location_obj.accuracy&&!isNaN(Timetracker.location.latLongParam.accuracy)&&Timetracker.location.latLongParam.accuracy<=1e3&&(ZPForm.isLocationPermissionEnabled=!0)}var pageId=Layout.Page.container;if(void 0===ele.formId&&Layout.Page.hash.indexOf("#onboarding/candidate/cportal")>-1?ele.formId=Layout.Page.container.find("table#candidateListTable").attr("formid"):void 0===ele.formId&&(ele.formId=Layout.Page.container.find("table#userListTable").attr("formid"),ele.isUser=!0),ZPForm.CURRFORM_PARAM={formId:ele.formId},pageId.find("#massUpdatePopup #saveUpdate").removeClass("disabled"),void 0===ZPForm.FORM_COMPONENT_DATA[ele.formId]&&ZPeople.Request.sendAsyncPost(ZPForm.URL,{formId:ele.formId,mode:"getFormComponents"},ele.setFormComponentData),0!=pageId.find("#bulkUpdFieldsTable tbody").children().length&&isLocationTrackingEnabled&&0==ZPForm.isLocationPermissionEnabled?(pageId.find("#errormsg").hide(),pageId.find("div#massUpdatePopup [name=bulkRows]").not("#firstFieldRow").remove(),pageId.find("div#massUpdatePopup #firstFieldRow [name=fieldsSelBox]").val(ele.firstFieldId).trigger("change"),pageId.find("div#massUpdatePopup").modal()):(ele.params={formid:ele.formId,mode:"list"},ele.callback=ele.listBulkUpdateFields,ZPeople.Request.send(ele.url,ele.params,ele.callback,isAddNew)),isLocationTrackingEnabled&&0==ZPForm.isLocationPermissionEnabled&&(ZPForm.showNoData(void 0,pageId.find("div#massUpdatePopup"),1),pageId.find("[id=saveUpdate]").attr("style","display:none")),"P_Goals"==ZPForm.getTableName()){pageId.find("#errormsg").hide();var txt='<a class="btn btn-primary" id="saveUpdate" onclick="zpMassUpdate.updateFields(this)">'+ZPI18N.getString("zp.saveandupdate")+'</a> <a data-dismiss="modal" class="btn btn-default">'+ZPI18N.getString("zp.cancel")+"</a>";pageId.find("div.modal-footer").html(txt)}},setFormComponentData:function(resultObj){resultObj.iCache=!0,ZPForm.formatFields(resultObj.message),ZPForm.FORM_COMPONENT_DATA[zpMassUpdate.formId]=resultObj,ZPForm.populateFields(resultObj.message)},listBulkUpdateFields:function(fieldsDtls,paramsObj,isAddNew){var pageId=Layout.Page.container;if(isAddNew||fieldsDtls.isSuccess)if(isAddNew){newFirstElementObj=(editFieldsObj=zpMassUpdate.constructselectBoxForEditBulkUpd(zpMassUpdate.fieldDetails.sections))[0],initialElm=zpMassUpdate.getInitElementHtml(editFieldsObj);$(initialElm).insertBefore(pageId.find("tr[name=addnewlink]")),pageId.find("#field_"+zpMassUpdate.fieldCount).find("td").last().html('<div class="dvlist-action MT5"><a class="IC-remove" onclick="zpMassUpdate.handleRemoveField(this)"></a></div>'),pageId.find("#field_"+zpMassUpdate.fieldCount).find("#firstFieldSelBox").select2(zpMassUpdate.select2.getSelect2Properties({initseljson:newFirstElementObj,isFieldList:!0})),pageId.find("#field_"+zpMassUpdate.fieldCount).find("#firstFieldSelBox").select2("val",newFirstElementObj.id);selectedFieldDtls=ZPForm.FORM_COMPONENTS[newFirstElementObj.id];pageId.find("#field_"+zpMassUpdate.fieldCount).find("#firstFieldSelBox").attr("labelName",selectedFieldDtls.labelName),zpMassUpdate.fieldCount++;var lastFieldId=zpMassUpdate.fieldCount-1;pageId.find("#field_"+lastFieldId).find("#firstFieldSelBox").trigger("change"),1==editFieldsObj.length?Layout.Page.container.find("tr[name=addnewlink]").remove():Layout.Page.container.find("tr[name=addnewlink]")[0].scrollIntoView({behavior:"smooth",block:"end"})}else{pageId.find("table#bulkUpdFieldsTable tbody").html(""),zpMassUpdate.fieldCount=0,zpMassUpdate.fieldDetails=fieldsDtls;var selectedFieldDtls=ZPForm.FORM_COMPONENTS[fieldsDtls.firstFcid];zpMassUpdate.firstFieldId=selectedFieldDtls.formComponentId;var editFieldsObj=zpMassUpdate.constructselectBoxForEditBulkUpd(fieldsDtls.sections),initialElm=zpMassUpdate.getInitElementHtml(editFieldsObj),newFirstElementObj=editFieldsObj[0];pageId.find("table#bulkUpdFieldsTable tbody").html(initialElm),pageId.find("div#massUpdatePopup").find("#firstFieldSelBox").select2(zpMassUpdate.select2.getSelect2Properties({initseljson:newFirstElementObj,isFieldList:!0})),pageId.find("div#massUpdatePopup").find("#firstFieldSelBox").select2("val",newFirstElementObj.id),zpMassUpdate.fieldCount++,pageId.find("#field_"+(zpMassUpdate.fieldCount-1)).find("#firstFieldSelBox").trigger("change"),pageId.find("div#massUpdatePopup").modal(),fieldsDtls.isCVAvailable?0==pageId.find("table#bulkUpdFieldsTable").siblings("#zp_import_submit_cv").length?$('<div id="zp_import_submit_cv" class="pad form-group"><div class="col-sm-6 col-sm-offset-3"><label class="checkbox DIB MR10"><input type="checkbox" name="customValidationOn" checked="checked"><span class="ML2">'+ZPI18N.getString("zp.executecustomvalidation")+"</span></label></div></div>").insertAfter(pageId.find("table#bulkUpdFieldsTable")):pageId.find("#zp_import_submit_cv [name=customValidationOn]").prop("checked",!0):pageId.find("#zp_import_submit_cv").remove(),fieldsDtls.isWorkFlowAvailable&&0==pageId.find("table#bulkUpdFieldsTable").siblings("#zp_import_submitwork_flow").length&&($('<div id="zp_import_submitwork_flow" class="pad form-group"><div class="col-sm-6 col-sm-offset-3"><label class="checkbox DIB MR10"><input type="checkbox" name="workFlowOn" checked="checked"><span class="ML2">'+ZPI18N.getString("zp.executeeworkflow")+"</span></label></div></div>").insertAfter(pageId.find("table#bulkUpdFieldsTable")),ZPForm.isAdmin()||pageId.find("#zp_import_submitwork_flow").hide()),1==editFieldsObj.length?Layout.Page.container.find("tr[name=addnewlink]").remove():Layout.Page.container.find("tr[name=addnewlink]")[0].scrollIntoView({behavior:"smooth",block:"end"})}else{var msg=ZPI18N.getString("zp.sorryservererror");"NOFIELDS"==fieldsDtls.message&&(msg=ZPI18N.getString("zp.noeditablefields")),ZPForm.showNoData(msg,pageId.find("div#massUpdatePopup")),pageId.find("div#massUpdatePopup").modal(),pageId.find("[id=saveUpdate]").attr("style","display:none")}},constructselectBoxForEditBulkUpd:function(fieldsDtls,searchTerm){var options=[],addedFieldList=zpMassUpdate.getAddedFieldList();return $.each(fieldsDtls,function(index,fcDtls){$.each(fcDtls.fields,function(ind,fieldDtls){if(("P_Employee"===ZPForm.getTableName()||zpMassUpdate.isUser&&Layout.Page.pageId.includes("admin-employeerecords"))&&"Division"==fieldDtls.labelName&&zpMassUpdate.findFCData(zpMassUpdate.formId,fieldDtls.fcId).displayType==ZPForm.Field.MULTISELECT_DISPLYTYPE)return!0;var tempDispName=ZPeople.decodeTxt(fieldDtls.displayName.toUpperCase()),tempSearchTerm=void 0==searchTerm?"":searchTerm.toUpperCase();if(-1==$.inArray(fieldDtls.fcId,addedFieldList)&&(void 0==searchTerm||-1!=tempDispName.indexOf(tempSearchTerm))){var optionObj={id:fieldDtls.fcId,text:ZPeople.decodeTxt(fieldDtls.displayName)};options.push(optionObj)}})}),options},getFcDtlsWhenFieldChange:function(thisObj){Layout.Page.container,thisObj.value;var formId=this.formId;if(void 0!==ZPForm.FORM_COMPONENT_DATA[formId]){parseInt($(thisObj).find("option:selected").parent("optgroup").attr("secNum"));var columnName=$(thisObj).find("option:selected").attr("columnNum"),fcNum=parseInt($(thisObj).find("option:selected").attr("fcNum"));if(2==columnName)fcNum=fcNum-parseInt($(thisObj).find("option:selected").parent("optgroup").find("option[columnnum=1]").last().attr("fcNum"))-1;var fldDtls=this.findFCData(formId,$(thisObj).val());this.changeFields(fldDtls,thisObj)}},changeFields:function(fieldDtlsObj,currElm){var selectFieldDtls=fieldDtlsObj,fields=[];if(ZPForm.Field.Edit.getDependFieldMappingFields(selectFieldDtls.formComponentId,fields),$(currElm).attr("isdependentfield")&&"true"==$(currElm).attr("isdependentfield")){$(currElm).removeAttr("isdependentfield");var prevId=$(currElm).attr("dependentField"),prevFieldDetails=zpMassUpdate.findFCData(zpMassUpdate.formId,prevId);$(currElm).removeAttr("dependentField");var currFields=[];if(ZPForm.Field.Edit.getDependFieldMappingFields(prevId,currFields),prevFieldDetails.dependentFiledList&&prevFieldDetails.dependentFiledList.length>0)for(var i=0;i<prevFieldDetails.dependentFiledList.length;i++)currFields.push(prevFieldDetails.dependentFiledList[i]);zpMassUpdate.dependentFieldHandling(currFields,!0)}var appendHere=$(currElm).closest("tr").find("td#firstEdtbox");if(appendHere.html(zpMassUpdate.constructEditElms(selectFieldDtls)),ZPSetupCommon.isEmpty(selectFieldDtls.autofillvalue)||appendHere.find("*[name=editable]").val(ZPeople.decodeTxt(selectFieldDtls.autofillvalue)),$(currElm).attr("labelName",selectFieldDtls.labelName),$(currElm).attr("isMandatory",selectFieldDtls.isMandatory),$(currElm).parent().find("div.dverrormsg").remove(),appendHere.removeClass("has-error"),ZPeople.isZPNewUI()&&(appendHere.find("[fieldType=26]").select2(zpMassUpdate.select2.getSelect2Properties()),appendHere.find("[fieldType=26]").select2("val","-Select-"),appendHere.find("[fieldType=25]").select2(),appendHere.find("[fieldType=25]").select2("val","-Select-"),appendHere.find("[fieldType=28]").select2(),appendHere.find("[fieldType=28]").select2("val","-Select-"),appendHere.find("[fieldType=27]").select2(),appendHere.find("[fieldType=27]").select2("val","-Select-"),appendHere.find("[fieldType=29]").select2(),appendHere.find("[fieldType=29]").select2("val","-Select-"),appendHere.find("[fieldType=40]").select2(),appendHere.find("[fieldType=40]").select2("val","-Select-"),appendHere.find("[fieldType=41]").select2(),appendHere.find("[fieldType=41]").select2("val","-Select-"),appendHere.find("[fieldType=42]").select2(),appendHere.find("[fieldType=42]").select2("val","-Select-")),fields.length>0&&appendHere.find("[fieldType=26]").attr("onchange","zpMassUpdate.handledependentFieldChange(this)"),selectFieldDtls.dependentFiledList&&selectFieldDtls.dependentFiledList.length>0)for(i=0;i<selectFieldDtls.dependentFiledList.length;i++)fields.push(selectFieldDtls.dependentFiledList[i]);fields.length>0&&($(currElm).attr("isDependentField",!0),$(currElm).attr("dependentField",selectFieldDtls.formComponentId),fields=zpMassUpdate.updateOrderOfFields(fields,selectFieldDtls.formComponentId),zpMassUpdate.dependentFieldHandling(fields,!1,selectFieldDtls.formComponentId))},dependentFieldHandling:function(dependentList,isRemove,fcid){for(var pageId=Layout.Page.container,i=0;i<dependentList.length;i++)if(isRemove)1==Layout.Page.container.find("td[id=firstEdtbox]").find("input[fcid="+dependentList[i]+"]").length&&Layout.Page.container.find("td[id=firstEdtbox]").find("input[fcid="+dependentList[i]+"]").parent().parent().remove();else{for(var editFieldsObj=zpMassUpdate.constructselectBoxForEditBulkUpd(zpMassUpdate.fieldDetails.sections),newFirstElementObj=editFieldsObj[0],j=0;j<editFieldsObj.length;j++){var currObj=editFieldsObj[j];if(currObj.id==dependentList[i]){newFirstElementObj=currObj;break}}if(newFirstElementObj.id==dependentList[i]){var initialElm=zpMassUpdate.getInitElementHtml(editFieldsObj),selectFieldDtls=this.findFCData(zpMassUpdate.formId,newFirstElementObj.id);$(initialElm).insertBefore(pageId.find("tr[name=addnewlink]")),pageId.find("#field_"+zpMassUpdate.fieldCount).find("#firstFieldSelBox").attr("disabled","disabled"),pageId.find("#field_"+zpMassUpdate.fieldCount).find("#firstFieldSelBox").select2(zpMassUpdate.select2.getSelect2Properties({initseljson:newFirstElementObj,isFieldList:!0})),pageId.find("#field_"+zpMassUpdate.fieldCount).find("#firstFieldSelBox").select2("val",newFirstElementObj.id);var appendHere=pageId.find("#field_"+zpMassUpdate.fieldCount).closest("tr").find("td#firstEdtbox");zpMassUpdate.constructEditElms(selectFieldDtls);appendHere.html(zpMassUpdate.constructEditElms(selectFieldDtls)),ZPeople.isZPNewUI()&&(appendHere.find("[fieldType=26]").select2(zpMassUpdate.select2.getSelect2Properties()),appendHere.find("[fieldType=26]").select2("val","-Select-")),appendHere.find("[fieldType=26]").attr("onchange","zpMassUpdate.handledependentFieldChange(this)"),pageId.find("#field_"+zpMassUpdate.fieldCount).find("#firstFieldSelBox").attr("labelName",selectFieldDtls.labelName),pageId.find("#field_"+zpMassUpdate.fieldCount).find("#firstFieldSelBox").attr("isMandatory",selectFieldDtls.isMandatory),zpMassUpdate.fieldCount++,1==editFieldsObj.length&&Layout.Page.container.find("tr[name=addnewlink]").remove()}}},updateOrderOfFields:function(fields,selectedField){var alterTedArray=fields,selectedElementDetails=zpMassUpdate.findFCData(zpMassUpdate.formId,selectedField);if(("P_Employee"===ZPForm.getTableName()||zpMassUpdate.isUser&&Layout.Page.pageId.includes("admin-employeerecords"))&&("Entity"==selectedElementDetails.labelName||"Business_unit"==selectedElementDetails.labelName||"Division"==selectedElementDetails.labelName)||"P_Candidate"===ZPForm.getTableName()&&("CandidateEntity"==selectedElementDetails.labelName||"Business_unit"==selectedElementDetails.labelName||"CandidateDivision"==selectedElementDetails.labelName)){var labelNames="P_Candidate"===ZPForm.getTableName()?["CandidateEntity","Business_unit","CandidateDivision","CandidateDepartment"]:["Entity","Business_unit","Division","Department"];alterTedArray=[];for(var i=0;i<labelNames.length;i++)for(var j=0;j<fields.length;j++){zpMassUpdate.findFCData(zpMassUpdate.formId,fields[j]).labelName==labelNames[i]&&alterTedArray.push(fields[j])}return alterTedArray}return alterTedArray},handledependentFieldChange:function(ele){var elementId=$(ele).attr("fcid"),fields=[],pageId=Layout.Page.container;ZPForm.Field.Edit.getDependFieldMappingFields(elementId,fields);for(var i=0;i<fields.length;i++)if(field[i]!=elementId){var currFcid=fields[i];pageId.find("[name=bulkRows]").find("#firstEdtbox").find("[fcid="+currFcid+"]").select2("val","-Select-")}},constructEditElms:function(selectedFieldDtls){var editElms="",fieldType=selectedFieldDtls.fieldType,lblName=selectedFieldDtls.labelName,fcid=selectedFieldDtls.formComponentId;if(fieldType===ZPForm.Field.PICKLIST||selectedFieldDtls.fieldType==ZPForm.Field.LOOKUP&&!ZPeople.isZPNewUI()||fieldType===ZPForm.Field.BLOODGROUP||fieldType===ZPForm.Field.GENDER||fieldType===ZPForm.Field.COUNTRY||fieldType===ZPForm.Field.NEW_BLOODGROUP||fieldType===ZPForm.Field.NEW_GENDER||fieldType===ZPForm.Field.NEW_COUNTRY){editElms+="<select class='selectBox' name='editable' id='editable"+lblName+"' fieldType = '"+fieldType+"' fcid='"+fcid+"' >",editElms+="<option value='-Select-'>"+ZPI18N.getString("zp.select")+"</option>";var options=selectedFieldDtls.hasOwnProperty("isPrimaryLookup")&&selectedFieldDtls.isPrimaryLookup?selectedFieldDtls.hasOwnProperty("AddOptions")?selectedFieldDtls.AddOptions:selectedFieldDtls.EditOptions:selectedFieldDtls.Options,optionswithids=selectedFieldDtls.OptionsWithId;fieldType!==ZPForm.Field.NEW_BLOODGROUP&&fieldType!==ZPForm.Field.NEW_GENDER&&fieldType!==ZPForm.Field.NEW_COUNTRY&&fieldType!==ZPForm.Field.COUNTRY||(options=selectedFieldDtls.Options),$.each(options,function(index,val){if(fieldType===ZPForm.Field.PICKLIST||fieldType===ZPForm.Field.BLOODGROUP||fieldType===ZPForm.Field.GENDER){var optId=fieldType===ZPForm.Field.PICKLIST&&void 0!=optionswithids?optionswithids[index].Id:"-1";editElms+="<option optId="+optId+" value='"+val+"'>"+val+"</option>"}else if(fieldType===ZPForm.Field.COUNTRY){var name=val.name.toUpperCase();editElms+='<option code="'+val.code+'" value="'+name+'">'+name+"</option>"}else if(fieldType===ZPForm.Field.NEW_COUNTRY||fieldType===ZPForm.Field.COUNTRY){let value=val.name;fieldType===ZPForm.Field.NEW_COUNTRY&&(value=val.code),editElms+='<option code="'+val.code+'" value="'+value+'">'+val.name+"</option>"}else if(fieldType==ZPForm.Field.NEW_BLOODGROUP||fieldType==ZPForm.Field.NEW_GENDER){var optionIds=selectedFieldDtls.oIds;editElms+="<option optId="+optionIds[index]+" value='"+optionIds[index]+"'>"+val+"</option>"}else editElms+="<option value='"+val.Id+"'>"+val.Value+"</option>"}),editElms+="</select>"}else fieldType===DATE||fieldType===DATE_TIME?(editElms+="<div class='btnCal'>",fieldType===DATE?editElms+="<input type='text' class='form-control' name='editable' onclick='Calendar.setUpCalendar(event,this)' id='editable"+lblName+"' fieldType = '"+fieldType+"' caltype='popup' fcid='"+fcid+"' />":editElms+="<input type='text' class='form-control' name='editable' onclick='Calendar.setUpCalendar(event,this,1)' id='editable"+lblName+"' fieldType = '"+fieldType+"' caltype='popup' fcid='"+fcid+"' />",editElms+="</div>"):fieldType===TEXT_AREA?editElms+="<textarea rows='3' class='form-control' name='editable' id='editable"+lblName+"' fieldType = '"+fieldType+"' fcid='"+fcid+"' ></textarea>  ":9===fieldType?editElms+="<input type='checkbox' class='form-control' name='editable' id='editable"+lblName+"' fieldType = '"+fieldType+"' fcid='"+fcid+"' />":selectedFieldDtls.fieldType==ZPForm.Field.LOOKUP?editElms+="<input type='text' id='editable"+lblName+"' name='editable' fcid='"+fcid+"' fieldType = '"+fieldType+"'/>":editElms+="<input type='text' class='form-control' id='editable"+lblName+"' name='editable' fcid='"+fcid+"' fieldType = '"+fieldType+"'/>";return editElms},update:function(obj){var isLocationTrackingEnabled=!1;ZPForm.FORM_DETAILS.hasOwnProperty(zpMassUpdate.formId)&&(isLocationTrackingEnabled=ZPForm.FORM_DETAILS[zpMassUpdate.formId].isLocationTrackingEnabled),isLocationTrackingEnabled&&void 0==ZPForm.isLocationPermissionEnabled?Timetracker.location.getLocation(zpMassUpdate.updateGeo,obj):zpMassUpdate.updateGeo(obj)},updateGeo:function(obj){var params,pageId=Layout.Page.container,formId=zpMassUpdate.formId,tabEleAndPkIds=zpMassUpdate.getPkIds(),pkIds=(tabEleAndPkIds.userTableElm,tabEleAndPkIds.pkIds),fcIds=[],errorRef=[],duplicateErrRef=[];zpMassUpdate.selectedFieldIds=[],$(obj).addClass("disabled"),$.each(pageId.find("input[id='firstFieldSelBox']"),function(index,fields){fcIds[index]=$(fields).val()}),$("div.dverrormsg").remove();var isLocationTrackingEnabled=!1;ZPForm.FORM_DETAILS.hasOwnProperty(formId)&&(isLocationTrackingEnabled=ZPForm.FORM_DETAILS[formId].isLocationTrackingEnabled),params={formid:formId,mode:"edit",fcIds:JSON.stringify(fcIds),pkIds:JSON.stringify(pkIds),loginUserZUID:_LOGGEDIN_ZUID},params=Import.addLatLonParams(isLocationTrackingEnabled,params),pageId.find("#zp_import_submitwork_flow").length>0&&pageId.find("#zp_import_submitwork_flow [name=workFlowOn]").is(":checked")&&(params.isWfTrigger=!0),zpMassUpdate.fieldDetails.isCVAvailable&&(params.customValidationOn=pageId.find("#zp_import_submit_cv [name=customValidationOn]").is(":checked")),$.each(pageId.find("table#bulkUpdFieldsTable tbody").find("tr[name='bulkRows']"),function(index,rowObj){if("bulkRows"===$(rowObj).attr("name")){var value,fieldSelBox=$(rowObj).find("input[id='firstFieldSelBox']"),fcId=fieldSelBox.val(),labelName=fieldSelBox.attr("labelName"),editableElm=fieldSelBox.closest("tr").find("*[name='editable']");let displayType=ZPForm.FORM_COMPONENTS[fcId].displayType;var fieldType=editableElm.attr("fieldType");value="9"!==fieldType?editableElm.val():$(editableElm).is(":checked");var parentErrObj=$(rowObj).find("td#firstEdtbox");let showErr=!1;"true"===fieldSelBox.attr("isMandatory")&&(displayType==ZPForm.Field.RADIO_DISPLYTYPE||displayType==ZPForm.Field.SELECT_DISPLYTYPE?showErr=ZPUtil.Validation.isEmpty(value):fieldType==ZPForm.Field.CHECK_BOX?showErr=!value:void 0===displayType&&(showErr=ZPUtil.Validation.isEmpty(value))),showErr?(parentErrObj.addClass("has-error"),ZPSetupCommon.showErr(ZPI18N.getString("zp.mandatoryfield",new Array(labelName)),parentErrObj,"dverrormsg"),errorRef.push(labelName+index)):fieldType!=ZPForm.Field.EMAIL_ADDRESS||ZPSetupCommon.isEmpty(value)||ZPUtil.Validation.isEmail(value)?(value=fieldType==ZPForm.Field.DATE_TIME?Calendar.convertHourFormat(value):value,fieldType!=ZPForm.Field.PICKLIST||ZPForm.Field.getFieldComponent(fcId).isEmpStatus||(value=$(editableElm).find("option:selected").attr("optid")),params[labelName]=value,parentErrObj.removeClass("has-error"),$("#"+labelName+index).remove(),-1!==errorRef.indexOf(labelName)&&errorRef.pop(labelName+index)):(parentErrObj.addClass("has-error"),ZPSetupCommon.showErr(ZPI18N.getString("zp.validemail",new Array(labelName)),parentErrObj,"dverrormsg"),errorRef.push(labelName+index)),-1===zpMassUpdate.selectedFieldIds.indexOf(fcId)?(duplicateErrRef.length>0&&duplicateErrRef.pop(labelName+index),zpMassUpdate.selectedFieldIds.push(fcId)):(duplicateErrRef.push(labelName+index),ZPSetupCommon.showErr(ZPI18N.getString("zp.duplicatefield"),fieldSelBox.parent(),"dverrormsg"))}}),0===errorRef.length&&0===duplicateErrRef.length?(params.isPicklistIdEnabled=!0,ZPeople.Request.send("/massUpdate.zp",params,zpMassUpdate.handleResponseOfBulkUpdate)):$(obj).removeClass("disabled")},getPkIds:function(){var pageId=Layout.Page.container,pkIds=[];return Layout.Page.container.find("table#userListTable").length>0?(userTableElm=pageId.find("table#userListTable"),$.each(userTableElm.find("input[name='userRowCheck']:checked"),function(index,obj){pkIds[index]=$(obj).closest("tr").attr("emperecno")})):Layout.Page.hash.indexOf("cportal")>-1?(userTableElm=pageId.find("table#candidateListTable"),$.each(userTableElm.find("input[name='userRowCheck']:checked"),function(index,obj){pkIds[index]=$(obj).closest("tr").attr("candidateid")})):Layout.Page.hash.indexOf("performance/salary/employeesalary")>-1&&ZPView.isSystemView()?(pkIds=Appraisal.Salary.employeeArr.slice(0,Appraisal.Salary.employeeArr.length),userTableElm=null):(userTableElm=pageId.find("table#zp_views_records_table:visible"),$.each(userTableElm.find("tbody input#zp_view_sel_record:checked"),function(index,obj){pkIds[index]=$(this).parents("[recordid]").attr("recordid")})),{userTableElm:userTableElm,pkIds:pkIds}},updateFields:function(obj){var pageId=Layout.Page.container,fcIds=[];if($.each(pageId.find("select[name='fieldsSelBox']"),function(index,fields){fcIds[index]=$(fields).val()}),ZPForm.isAllowedToEdit(fcIds,!0)){var key="zp.editapprovalconfirmmsg";ZPForm.CONF.approvalSettingsDetails.isVerifySend&&(key="zp.editapprsendconfirmmsg"),ZPeople.BSModal.confirm(zpMassUpdate.update,ZPI18N.getString("zp.confirm"),ZPI18N.getString(key))}else zpMassUpdate.update(obj)},handleResponseOfBulkUpdate:function(resultObj,paramsObj){var pageId=Layout.Page.container,massUpdateElmId=pageId.find("div#massUpdatePopup");if(resultObj.isSuccess){if("EMPERRORS"===resultObj.errorType)resultObj.hasOwnProperty("activeUserList")?ZPeople.Message.showFailureMsg(resultObj.activeUserList.message):resultObj.hasOwnProperty("closedUserList")?ZPeople.Message.showFailureMsg(resultObj.closedUserList.message):resultObj.hasOwnProperty("dwngrdUserList")?ZPeople.Message.showFailureMsg(resultObj.dwngrdUserList.message):resultObj.hasOwnProperty("invitationInactive")?ZPeople.Message.showFailureMsg(resultObj.invitationInactive.message):resultObj.hasOwnProperty("dupMailIdList")&&ZPeople.Message.showFailureMsg(resultObj.dupMailIdList.message);else{if(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.success")),pageId.find("div#zp_view_close_selection").click(),pageId.find("div#massUpdatePopup").modal("hide"),zpMassUpdate.isUser&&Layout.Page.pageId.includes("admin-employeerecords")){var currMode=Layout.Page.currentmode.split("/")[2];if(paramsObj.hasOwnProperty("Employeestatus")){if("All Status"!=Layout.Page.container.find("#empStatusDtls").val()&&(User.variables[currMode].filterParams.searchByEmpStatus="user"==currMode?paramsObj.Employeestatus:"All Status"),"All Status"!=Layout.Page.container.find("#accStatusDtls").val()){var optionsWithId=null,fcIds=JSON.parse(paramsObj.fcIds);for(var i in fcIds){var fieldComponent=ZPForm.Field.getFieldComponent(fcIds[i]);if("Employeestatus"==fieldComponent.labelName){optionsWithId=fieldComponent.OptionsWithId;break}}var sysVal=null;for(var i in optionsWithId)if(optionsWithId[i].Value==paramsObj.Employeestatus){sysVal=optionsWithId[i].SysValue;break}User.variables[currMode].filterParams.userStatus=User.statusBasedOnSysVal(sysVal)}}else paramsObj.hasOwnProperty("LocationName")&&"0"!=Layout.Page.container.find("#locationsDtls").val()?User.variables[currMode].filterParams.searchByLoc=paramsObj.LocationName:paramsObj.hasOwnProperty("Role")&&"0"!=Layout.Page.container.find("#rolesDtls").val()?User.variables[currMode].filterParams.searchByRole=paramsObj.Role:paramsObj.hasOwnProperty("Department")&&"0"!=Layout.Page.container.find("#deptDtls").val()&&(User.variables[currMode].filterParams.searchByDept=paramsObj.Department);User.variables[currMode].reload=!0,Layout.Page.container.find("div#close_user_options").click(),User.ListUsers.usersListPageInit()}else Layout.Page.hash.indexOf("cportal")>-1?CPortal.User.getUserList():Layout.Page.hash.indexOf("performance/salary/employeesalary")>-1&&ZPView.isSystemView()?(Appraisal.Salary.refreshData=!0,Appraisal.Salary.salaryConstructStart()):ZPView.refresh(!0);var pkIds=resultObj.modifiedPkIds;$.each(pkIds,function(index,val){ZPForm.SINGLE_RECORD_DTL[paramsObj.formid+"_"+index]=void 0,ZPForm.CONF.approvalSettingsDetails.isVerifySend&&ZPApprovals.APPROVAL_DETAILS[index]&&delete ZPApprovals.APPROVAL_DETAILS[index]})}"P_Goals"===ZPForm.getTableName()&&(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.success")),pageId.find("div#massUpdatePopup").modal("hide"))}else{if(resultObj.isLicenseCountExceeded){var errMsg=ZPI18N.getString("zp.licensecountexceeded");ZPeople.Message.showFailureMsg(errMsg)}else{if("VALIDATION"===resultObj.errorType)massUpdateElmId.find("td").removeClass("has-error"),$.each(resultObj.errors,function(labelName,errObj){var errorAppendElm,appendHere=massUpdateElmId.find("#editable"+labelName),fieldType=appendHere.attr("fieldType");$(appendHere).parent().addClass("has-error"),errorAppendElm=fieldType==DATE||fieldType==DATE_TIME?$(appendHere).parent():$(appendHere).closest("td#firstEdtbox");var msg=errObj.message;6919===errObj.code&&(resultObj.isSuperAdmin?msg+=ZPI18N.getString("zp.reports.linktochangeanalyticsdbowner",new Array(window.location.href.split("#")[0]+"#reports/analytics/listReport")):msg+=ZPI18N.getString("zp.reports.contactsuperadmin")),ZPSetupCommon.showErr(msg,errorAppendElm,"dverrormsg")});else if("EMPERRORS"===resultObj.errorType)resultObj.hasOwnProperty("activeUserList")?ZPeople.Message.showFailureMsg(resultObj.activeUserList.message):resultObj.hasOwnProperty("closedUserList")?ZPeople.Message.showFailureMsg(resultObj.closedUserList.message):resultObj.hasOwnProperty("dwngrdUserList")?ZPeople.Message.showFailureMsg(resultObj.dwngrdUserList.message):resultObj.hasOwnProperty("invitationInactive")?ZPeople.Message.showFailureMsg(resultObj.invitationInactive.message):resultObj.hasOwnProperty("dupMailIdList")&&ZPeople.Message.showFailureMsg(resultObj.dupMailIdList.message);else if(7031==resultObj.code)ZPeople.Message.showFailureMsg(resultObj.message);else if("CUSTOMVALIDATIONFAILED"===resultObj.errorType)for(var resutarr=resultObj.errormessage,i=0;resutarr.length>i;i++){var tbodytr=jQuery("<tr />",{class:"ZPLRow"}),recordId=resutarr[i].recordId,message=resutarr[i].message;tbodytr.append(jQuery("<td />").append("<a href='#form/view-formId:"+Layout.Page.urlparam.formId+"/recordId:"+recordId+"' target='_blank'>"+ZPI18N.getString("zp.viewRecord")+"</a>"));for(var td=jQuery("<td />"),keys=Object.keys(message),j=0;j<keys.length;j++){var errObj=message[keys[j]];td.append(ZPeople.decodeTxt(errObj)+"<br><br>")}tbodytr.append(td),massUpdateElmId.find("#errormsg").find("#tablebody").html(tbodytr),massUpdateElmId.find("#errormsg").show()}else if("GOALVALIDATIONFAILED"===resultObj.errorType){pageId.find("#errormsg").hide();resutarr=resultObj.errormessage;massUpdateElmId.find("#errormsg").find("#tablebody").html("");for(i=0;resutarr.length>i;i++){tbodytr=jQuery("<tr />",{class:"ZPLRow"}),recordId=resutarr[i].recordId,message=resutarr[i].message;tbodytr.append(jQuery("<td />").append("<a href='#form/view-formId:"+Layout.Page.urlparam.formId+"/recordId:"+recordId+"' target='_blank'>"+ZPI18N.getString("zp.viewRecord")+"</a>"));for(td=jQuery("<td />"),keys=Object.keys(message),j=0;j<keys.length;j++){errObj=message[keys[j]];td.append(errObj+"<br><br>")}tbodytr.append(td),massUpdateElmId.find("#errormsg").find("#tablebody").append(tbodytr),massUpdateElmId.find("#errormsg").show()}var txt='<button type="button" class="btn btn-default" data-dismiss="modal">'+ZPI18N.getString("zp.close")+"</button>";pageId.find("div.modal-footer").html(txt)}else ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.success")),pageId.find("div#massUpdatePopup").modal("hide");if(resultObj.isSuperAdminChange){var errMap=resultObj.errorMap;ZPSetupCommon.showErr(errMap.message,massUpdateElmId.find("#editable"+errMap.labelName).closest("td#firstEdtbox"),"dverrormsg")}}massUpdateElmId.find("#saveUpdate").removeClass("disabled")}},findFCData:function(formId,fcId){var fldDtls={};return $.each(ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails,function(){var column1=this.column1;for(field in column1)if(column1[field].formComponentId==fcId)return fldDtls=column1[field],!1;var column2=this.column2;for(field in column2)if(column2[field].formComponentId==fcId)return fldDtls=column2[field],!1}),fldDtls}};zpMassUpdate.select2={OPTIONS:{},ALL_OPTIONS:{},getSelect2Properties:function(prop){return{formatNoMatches:function(){return ZPI18N.getString("zp.nomatchesfound")},formatSearching:function(){return ZPI18N.getString("zp.searching")},multiple:prop&&prop.multi,query:function(query){var results=[],term=query.term,fcid=$(query.element).attr("fcid"),key=fcid;results.push({id:"-Select-",text:"-Select-"});var fieldProps=zpMassUpdate.findFCData(zpMassUpdate.formId,fcid);if(fieldProps.dependentFiledList&&fieldProps.dependentFiledList.length>0){var fieldValues=zpMassUpdate.getFieldValuesForSearch(fcid,fieldProps.dependentFiledList);key+=JSON.stringify(fieldValues)}if(void 0==zpMassUpdate.select2.OPTIONS[key]&&(zpMassUpdate.select2.OPTIONS[key]={}),prop&&prop.isFieldList)results=zpMassUpdate.constructselectBoxForEditBulkUpd(zpMassUpdate.fieldDetails.sections,term);else if(zpMassUpdate.select2.OPTIONS[key][term]&&0==zpMassUpdate.select2.OPTIONS[key][term].length)!1;else{if(!(zpMassUpdate.select2.OPTIONS[key][term]&&zpMassUpdate.select2.OPTIONS[key][term].length>0&&zpMassUpdate.select2.OPTIONS[key][term].length>200*(query.page-1)))return void(results=zpMassUpdate.select2.getOptions(fcid,term,query.page,query.callback,prop));for(i=200*(query.page-1);i<200*query.page&&i<zpMassUpdate.select2.OPTIONS[key][term].length;i++)-1==$.inArray(zpMassUpdate.select2.OPTIONS[key][term][i],results)&&results.push(zpMassUpdate.select2.OPTIONS[key][term][i]);!1}query.callback({results:results,more:results.length>=200})},initSelection:function(element,callback){var results=[];results={id:"-Select-",text:"-Select-"},prop&&prop.initseljson&&(results=prop.initseljson),callback(results)}}},getOptions:function(fcid,term,page,successcallback,prop){fields=[fcid];var baseFormId=zpMassUpdate.formId,fieldProps=zpMassUpdate.findFCData(zpMassUpdate.formId,fcid),params={mode:"fetchFormLookupOtions",luFcIds:JSON.stringify(fields),formId:baseFormId};"P_Timesheet"===ZPForm.getTableName()&&(params.selUser=null===Timetracker.timelogs.tserecno||void 0===Timetracker.timelogs.tserecno?ZPeople.CURR_USER.usererec:Timetracker.timelogs.tserecno),"P_PerformanceAppraisal"===ZPForm.getTableName()&&(params.configId=Layout.Page.urlparam.configId),params.searchtxt=term,params.startInd=200*(page-1)+1,params.conreqcsr=csrfToken,params.isfilternotneeded=!1,url=ZPForm.URL;var results=[],key=fcid;if(fieldProps.dependentFiledList&&fieldProps.dependentFiledList.length>0){var fieldValues=zpMassUpdate.getFieldValuesForSearch(fcid,fieldProps.dependentFiledList);jQuery.isEmptyObject(fieldValues)||(params.fieldValues=JSON.stringify(fieldValues)),key+=params.fieldValues}return $.ajax({type:"POST",async:!0,url:url,data:params,success:function(data){data.code==zpconst.ResponseCodes.API_ERR_NO_ERROR&&data.message&&data.message[fcid]&&(results.push({id:"-Select-",text:"-Select-"}),$.each(data.message[fcid],function(ind,val){results.push({id:val.Id,text:ZPeople.decodeTxt(val.Value)}),ZPView.select2.ALL_OPTIONS[fcid+"_"+val.Value]=val.Id})),zpMassUpdate.select2.OPTIONS[key][term]||(zpMassUpdate.select2.OPTIONS[key][term]=[]),$.each(results,function(ind,value){"-Select-"!=value.id&&zpMassUpdate.select2.OPTIONS[key][term].push(value)}),successcallback({results:results,more:results.length>=200})}}),results}},zpMassUpdate.getFieldValuesForSearch=function(fcId,dependentFieldList){var fieldValues={},pageId=Layout.Page.container;return $.each(dependentFieldList,function(key,value){$(pageId).find("td[id=firstEdtbox]").each(function(){if($(this).find("input[fcid="+value+"]").length>0){var selectedValue=$(this).find("input[fcid="+value+"]").val();fieldValues[value]=selectedValue}})}),fieldValues},zpMassUpdate.getAddedFieldList=function(){var addedFieldList=[],ele=Layout.Page.container.find("table#bulkUpdFieldsTable tbody");return $(ele).children("tr[name='bulkRows']").each(function(){var currFcid=$(this).find("#firstFieldSelBox").val();addedFieldList.push(currFcid)}),addedFieldList},zpMassUpdate.getInitElementHtml=function(editFieldsObj){var initialElm="";return initialElm+="<tr id=field_"+zpMassUpdate.fieldCount+' name = "bulkRows">',initialElm+="<td></td>",initialElm+='<td><input type="text"  id="firstFieldSelBox" onchange="zpMassUpdate.getFcDtlsWhenFieldChange(this)" ></td>',initialElm+='<td id="firstEdtbox"></td><td></td></tr>',editFieldsObj.length>1&&0==Layout.Page.container.find("tr[name=addnewlink]").length&&(initialElm+=zpMassUpdate.addLinkHtml),initialElm},zpMassUpdate.handleRemoveField=function(ele){var fieldElement=$(ele).closest("tr"),obj=$(fieldElement).find("#firstEdtbox"),fcid=obj.find("input[id^=editable]").attr("fcid"),fieldType=obj.find("input[id^=editable]").attr("fieldType");ZPUtil.Validation.isEmpty(fcid)&&(fcid=obj.find("select[id^=editable]").attr("fcid"),ZPUtil.Validation.isEmpty(fcid)&&(fcid=obj.find("textarea[id^=editable]").attr("fcid")));var fcDetails=zpMassUpdate.findFCData(zpMassUpdate.formId,fcid),fcidsToRemove=[];void 0!=fcDetails.dependentFiledList&&fcDetails.dependentFiledList.length>0&&(fcidsToRemove=fcDetails.dependentFiledList),ZPForm.Field.Edit.getDependFieldMappingFields(fcid,fcidsToRemove),fcidsToRemove.push(fcid);for(var i=0;i<fcidsToRemove.length;i++){var fieldObj=Layout.Page.container.find("td[id=firstEdtbox]");fcidsToRemove[i]==fcid?fieldType==DATE||fieldType==DATE_TIME?fieldObj.find("input[fcid="+fcid+"]").parent().parent().parent().remove():(fieldObj.find("input[fcid="+fcid+"]").parent().parent().remove(),fieldObj.find("select[fcid="+fcid+"]").parent().parent().remove(),fieldObj.find("textarea[fcid="+fcid+"]").parent().parent().remove()):fieldObj.find("input[fcid="+fcidsToRemove[i]+"]").parent().parent().remove()}0==Layout.Page.container.find("table#bulkUpdFieldsTable tbody").find("#addnewLnk").length&&Layout.Page.container.find("table#bulkUpdFieldsTable tbody").append(zpMassUpdate.addLinkHtml)};var ZPNewView={};ZPNewView={allComponents:{},crtSelectionRecords:{},crtSelectedRecords:{},criteriaCnt:null,fieldOptionConstruction:null,leftSideSelected:null,rightSideSelected:null,leftColumns:null,rightColumns:null,savedComponents:null,LAYOUT:null,INPUT_DROPDOWN:null,LASTVIEWID:null,localValues:null,headerComponents:null,mouseDownFlag:!1,childSelectFlag:!1,removeAscDescFlag:!1,removeGrpFlag:!1,removeSumFlag:!1,pickListComponent:null,isCustomView:!0,allCmpName:null,formName:null,isEdit:!1,formId:null,fieldListCloneDom:{},OPERATORS:{EQUAL:18,NOT_EQUAL:19,LESS_THAN:20,GREATER_THAN:21,LESS_EQUAL:22,GREATER_EQUAL:23,STARTS_WITH:24,ENDS_WITH:25,CONTAINS:26,NOT_CONTAINS:27,EMPTY:29,NOT_EMPTY:30,YESTERDAY:31,TODAY:32,TOMORROW:33,IN:61,NOT_IN:62,LAST_MONTH:44,THIS_MONTH:45,NEXT_MONTH:46,TRUE:49,FALSE:50,LAST_YEAR:51,NEXT_YEAR:53,CURRENT_YEAR:52,LOGIN_USERS_DEPT:63,LOGIN_USER:64,LAST_WEEK:65,THIS_WEEK:66,NEXT_WEEK:67,LOGIN_USERS_DESIG:68,ONLY_PARTICULAR_MONTH:69,LOGIN_USERS_ENTITY:70,LOGIN_USERS_UNIT:71,LOGIN_USERS_DIVISION:72,SUBORDINATES_GOAL:73},init:function(){ZPNewView.isCrtPropagationInit||($(document).on("click",'[isviewcrt="true"]',function(e){e.stopPropagation();var obj=$(e.target);"true"==obj.attr("isCrtFld")&&ZPNewView.fieldChange(obj)}),ZPNewView.isCrtPropagationInit=!0),ZPNewView.LAYOUT=$("<div class='PL30 PR30'><form style='width:70%;' class='form-horizontal pad' role='form'><div id='viewNameSection' class='form-group'><label class='control-label col-sm-3'>"+ZPI18N.getString("zp.specifyviewname")+"</label><div class='col-sm-6'><input type='name' placeholder='"+ZPI18N.getString("zp.enterviewname")+"' class='form-control' id='zp_custom_view_name'><span id='zp_custom_view_name_error' class='error-msg'></span></div></div><div id='defaultViewSection' class='form-group'><div id='defaultViewSection' class='col-sm-6 col-sm-offset-3'><label class='checkbox DIB'><input id='zp_custom_view_default' type='checkbox'><span class='ML2'>"+ZPI18N.getString("zp.setdefaultview")+"</span></label></div></div><div id='view_approval_section' class='form-group'><div class='col-sm-6 col-sm-offset-3'><label class='checkbox DIB'><input id='zp_custom_view_approval' type='checkbox'><span class='ML2'>"+ZPI18N.getString("zp.showApproverDetails")+"</span></label></div></div><div id='viewPremissionSection' class='form-group'><label class='control-label col-sm-3'>"+ZPI18N.getString("zp.viewPerm")+"</label><div class='col-sm-9'><div><label class='radio DIB'><input id='zp_custom_view_only_me' type='radio' name='view' onClick='ZPNewView.sharedTo()' checked><span class='ML2'>"+ZPI18N.getString("zp.onlytome")+"</span></label></div><div class='MT10'><label class='radio DIB'><input id='zp_custom_view_all_employees' type='radio' name='view' onClick='ZPNewView.sharedTo()'><span class='ML2'>"+ZPI18N.getString("zp.allowallemployeetoaccess")+"</span></label></div><div class='MT10'><label class='radio DIB'><input id='zp_custom_view_selected_users' type='radio' name='view' onClick='ZPNewView.sharedTo()'><span class='ML2'>"+ZPI18N.getString("zp.specificuser")+"</span></label></div></div></div><div class='form-group DN' id='zp_custom_view_sharedto'><label class='control-label col-sm-3'>"+ZPI18N.getString("zp.sharedto",new Array(""))+"</label><div id='applicableToComponent' class='col-sm-6'></div></div></form><h5>"+ZPI18N.getString("zp.selectcolumns")+"</h5><div class='row MB20'><div class='col-md-5'><div class='ZPSCdiv'><ul id='zp_custom_view_left_columns' class='list-group'></ul></div></div><div class='col-md-1 MT80'><div class='ZPCVatn'><div class='IC-ar-lft-2 blu S16 CP' onClick='ZPNewView.moveAllLeftToRight()'></div></div><div class='ZPCVatn'><div class='IC-ar-rgt blu S16 CP' onClick='ZPNewView.moveSelectedRowToRight()'></div></div><div class='ZPCVatn'><div class='IC-ar-lft blu S16 CP' onClick='ZPNewView.moveSelectedRowToLeft()'></div></div><div class='ZPCVatn'><div class='IC-ar-rgt-2 blu S16 CP' onClick='ZPNewView.moveAllRightToLeft()'></div></div></div><div class='col-md-6'><div class='ZPSCdiv' id='zp_rightSide'><ul id='zp_custom_view_right_columns' class='list-group'></ul></div><span class='error-msg DN' id='zp_right_column_error'></span></div></div><h5 id='criteriaHeader'>"+ZPI18N.getString("zp.criteria")+"</h5><div id='criteriaSection' style='border-top:1px solid #e9edf3;' class='outcontainer'><table class='table table-hover'><thead><tr><th width='100'>"+ZPI18N.getString("zp.andor")+"</th><th width='200'>"+ZPI18N.getString("zp.fieldname")+"</th><th width='180'>"+ZPI18N.getString("zp.condition")+"</th><th width='300'>"+ZPI18N.getString("zp.value")+"</th><th width='20'></th><th width='100'></th></tr></thead><tbody id='zp_custom_view_criteria_table_body'></tbody></table><span id='zp_criteria_error' class='error-msg'></div></div>"),ZPNewView.criteriaCnt=0,ZPNewView.fieldOptionConstruction=null,ZPNewView.leftSideSelected={},ZPNewView.rightSideSelected={},ZPNewView.leftColumns={},ZPNewView.rightColumns={},ZPNewView.allCmpName={},ZPNewView.savedComponents=null,ZPNewView.localValues={},ZPNewView.headerComponents={},ZPNewView.pickListComponent=null,ZPNewView.formName=null,ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").children().remove(),ZPNewView.FIELDS_DROP_DOWN=null,ZPNewView.formId=ZPView.CURR_VIEWPARAMS.formId,ZPNewView.INPUT_DROPDOWN="<td id='lookupIcon' class='dropup PL0I'><i id='zp_crt_input_dropdown' class='IC-addlist S18 FL MT5 gry CP DN' data-toggle='dropdown' aria-expanded='false'></i><div id='crtDropdownSelection' class='dropdown-menu ZPCusPd ZPappBox ZptxtBox  ZPCmn-Arrow bottom rt gray'><div class='ZPTabVt'><div class='rhttabscrl'><div class='tab-content'><div class='tab-pane active' role='tabpanel'><div><div class='ZPtopSearch'><label class='checkbox DIB FL PT8 MR10'><input id='crtAllCheck' type='checkbox' onclick='ZPNewView.crtAllCheckSelect(this)'><span></span></label><div class='ZPsearch' id='ZPsearch'><div class='dvsearch Dropdown PR'><span class='ZPico-search FL MT2 ML8 ZPtooltip IC-lens S16' zptitle='Search Category'></span></div><input type='search' class='ZPselect' id='crtRecordSearch' placeholder='"+ZPI18N.getString("zp.search")+"' value='' name='Search'></div></div><div class='ZPapplCb'><ul id='ulList'></ul></div></div></div></div></div></div></div></td>"},createView:function(){$(".select2-dropdown-open").select2("close");var formID=ZPView.CURR_VIEWPARAMS.formId;ZPNewView.LASTVIEWID=ZPView.CURR_VIEWPARAMS.viewId,window.location.href="#"+Layout.UrlConf.getFormActionURL("createview")+"-formId:"+formID},editView:function(){var formID=ZPView.CURR_VIEWPARAMS.formId;ZPNewView.LASTVIEWID=ZPView.CURR_VIEWPARAMS.viewId,window.location.href="#"+Layout.UrlConf.getFormActionURL("editview")+"-formId:"+formID+"/viewId:"+ZPNewView.LASTVIEWID},showDelete:function(){ZPeople.BSModal.setup({id:"zp_modal_confirmpop",type:3,iconClass:"IC-alert",iconParenClass:"orgbgi",header:ZPI18N.getString("zp.zpalert"),body:ZPI18N.getString("zp.deleteconfirmmessage"),deleteOnHide:!0,closeOnSubmit:!0,buttonValue:ZPI18N.getString("zp.confirm"),successCallback:ZPNewView.deleteView})},deleteView:function(){var params={mode:"deleteView",formID:ZPView.CURR_VIEWPARAMS.formId,viewID:ZPView.CURR_VIEWPARAMS.viewId};ZPeople.Request.send("/createViewAction.zp",params,ZPNewView.afterDeleteAction)},getCreateViewPage:function(){ZPeople.BSModal.setup({id:"zp_createview",type:2,modalClass:"popRgtModel PopLgModel",header:ZPI18N.getString("zp.createview"),body:ZPeople.LOADING_HTML,buttonValue:ZPI18N.getString("zp.save"),hiddenCallback:ZPNewView.closeCallback,successCallback:ZPNewView.saveAction});var params={mode:"newView",formID:ZPView.CURR_VIEWPARAMS.formId};ZPeople.Request.send("/createViewAction.zp",params,ZPNewView.constructCreateViewPage)},getEditViewPage:function(){ZPeople.BSModal.setup({id:"zp_editview",type:2,modalClass:"popRgtModel PopLgModel",header:ZPI18N.getString("zp.editview"),body:ZPeople.LOADING_HTML,buttonValue:ZPI18N.getString("zp.save"),hiddenCallback:ZPNewView.closeCallback,successCallback:ZPNewView.updateAction});var formID=ZPView.CURR_VIEWPARAMS.formId;ZPNewView.LASTVIEWID=ZPView.CURR_VIEWPARAMS.viewId,void 0===ZPNewView.LASTVIEWID&&(ZPNewView.LASTVIEWID=Layout.Page.childUrlParam.viewId);var params={mode:"getViewDetails",formID:formID,viewID:ZPNewView.LASTVIEWID};ZPeople.Request.send("/createViewAction.zp",params,ZPNewView.constructEditViewPage)},constructCreateViewPage:function(data){if(void 0===data.error){ZPNewView.isEdit=!1,ZPNewView.allComponents=data.formDetailsMap,ZPNewView.init(),ZPNewView.FORM_NAME=data.formName,ZPNewView.isCustomView=!0,$.each(ZPNewView.allComponents,function(key,value){if(void 0!==value.childComponents&&Object.keys(value.childComponents).length>0){var tempObj={formCompID:value.formCompID,childComponents:value.childComponents,formCompName:value.formCompName};ZPNewView.headerComponents[value.formCompID+""]=tempObj}}),ZPNewView.initLeftColumns(),ZPNewView.initRightColumns();var curr_criteria_id=ZPNewView.addCriteria();ZPNewView.defaultActions(),ZPNewView.fieldOptionPopOverInit(curr_criteria_id),Layout.UrlConf.isModuleForm()&&ZPNewView.LAYOUT.find("#defaultViewSection").remove(),ZPForm.isApprovalEnabled()||ZPNewView.LAYOUT.find("#view_approval_section").remove();var mdata=ZPeople.Module.getData();mdata.isAdmin&&!mdata.viewDetails.isLocAdmin&&"P_MultiRater"!=ZPForm.getTableName()&&"P_MultiRater_Approval"!=ZPForm.getTableName()&&"P_Goals"!=ZPForm.getTableName()||ZPNewView.LAYOUT.find("#viewPremissionSection,#zp_custom_view_sharedto").remove(),Layout.Page.container.find("#zp_createview").find(".modal-body").html(ZPNewView.LAYOUT),Layout.Page.container.find("#zp_custom_view_name").trigger("focus"),Layout.Page.container.find(".modal-footer").find("#zp_modal_blubtn").prop("disabled",!1)}else void 0!==data.error.message?Layout.Page.container.find("#zp_createview").find(".modal-body").html("<p class='errorDiv'><b>"+data.error.message+"</b></p>"):void 0!==data.error.exception&&(Layout.Page.container.find("#zp_createview").find(".modal-body").html("<p class='errorDiv'><b>"+ZPI18N.getString("zp.erroroccurredloadingpage")+"</b></p>"),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.erroroccurredloadingpage")))},constructEditViewPage:function(data){if(void 0===data.error){ZPNewView.isEdit=!0;var viewDetails=data.viewDetails;ZPNewView.isCustomView=viewDetails.isCustomView;var viewObj=ZPNewView.getViewDetailByID(viewDetails.viewID);if(void 0!==viewObj&&(""===viewObj.ownerId||viewObj.ownerId.length<=0)&&(ZPNewView.isCustomView=!1),ZPNewView.allComponents=viewDetails.formDetailsMap,ZPNewView.init(),ZPNewView.FORM_NAME=viewDetails.formName,$.each(ZPNewView.allComponents,function(key,value){if(void 0!==value.childComponents&&Object.keys(value.childComponents).length>0){var tempObj={formCompID:value.formCompID,childComponents:value.childComponents,formCompName:value.formCompName};ZPNewView.headerComponents[value.formCompID+""]=tempObj}}),ZPNewView.LAYOUT.find("#zp_custom_view_name").val(viewDetails.viewName),ZPNewView.localValues.viewID=viewDetails.viewID,ZPNewView.localValues.expressionID=void 0===viewDetails.expressionID?0:viewDetails.expressionID,ZPNewView.localValues.reportPermissionID=0,ZPForm.isApprovalEnabled()||ZPNewView.LAYOUT.find("#view_approval_section").remove(),ZPNewView.LAYOUT.find("#zp_custom_view_approval").attr("checked",viewDetails.show_approver),ZPNewView.isCustomView){if(Layout.UrlConf.isModuleForm()&&ZPNewView.LAYOUT.find("#defaultViewSection").remove(),viewDetails.isDefaultView&&ZPNewView.LAYOUT.find("#zp_custom_view_default").attr("checked",!0),viewDetails.shareViewToAll)ZPNewView.LAYOUT.find("#zp_custom_view_all_employees").attr("checked",!0);else if(!viewDetails.shareViewToAll){var reportPermissionID=viewDetails.reportPermissionID;if(void 0!==reportPermissionID&&"0"!==reportPermissionID){ZPNewView.LAYOUT.find("#zp_custom_view_selected_users").attr("checked",!0),ZPNewView.sharedTo(),ZPNewView.localValues.reportPermissionID=reportPermissionID;var reportPermissionData=viewDetails.reportPermissionData;Object.keys(reportPermissionData).length>0&&null!==ZPNewView.pickListComponent&&(ZPPickList.setSelectedUsers(reportPermissionData.empList),ZPPickList.setSelectedDepartments(reportPermissionData.deptList),ZPPickList.setSelectedRoles(reportPermissionData.roleList),ZPPickList.setSelectedLocations(reportPermissionData.locList))}else ZPNewView.LAYOUT.find("#zp_custom_view_only_me").attr("checked",!0)}var savedCriteria=viewDetails.criteria,tempCnt=0;if(0!==Object.keys(savedCriteria).length&&$.each(savedCriteria,function(key,value){var fcID=value.formComponentID,lkFcid=value.lookupFcId,obj=ZPNewView.allComponents[fcID];if(void 0==obj)return!0;var fc=fcID,pfcid=-1;if(void 0!=lkFcid&&!value.isBaseForm){if(void 0==(obj=obj.childComponents[lkFcid]))return!0;pfcid=fcID,fc=lkFcid}var curr_criteria_id=ZPNewView.addCriteria();0!==tempCnt&&ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#operatorSelection").select2("val",value.conjunctiveCondn),ZPNewView.fiedpopoverclback(ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#fieldOpetions"),pfcid,fc,!0),ZPNewView.fieldOptionPopOverInit(curr_criteria_id);var operator=value.Operator;ZPeople.decodeTxt(value.CrtVal);0==ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").find("option[value="+operator+"]").length&&ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").append("<option value='"+operator+"'>"+LookupFilterRule.OPERATORS[operator]+"</option>"),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").select2("val",operator),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").trigger("change");var fcType=obj.fcType;if(fcType!=ZPForm.Field.LOOKUP&&fcType!=ZPForm.Field.PICKLIST&&fcType!=ZPForm.Field.NEW_GENDER&&fcType!=ZPForm.Field.NEW_BLOODGROUP&&fcType!=ZPForm.Field.NEW_COUNTRY||operator!=ZPNewView.OPERATORS.IN&&operator!=ZPNewView.OPERATORS.NOT_IN)ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#txtValue").val(ZPeople.decodeTxt(value.CrtVal));else{ZPNewView.loadCrtRequiredRecords(fc,fcType);var fcRecords1=ZPNewView.crtSelectionRecords[fc];if(void 0!==fcRecords1&&Object.keys(fcRecords1).length>0){var fcRecords=JSON.parse(JSON.stringify(fcRecords1));"";var values=JSON.parse(value.CrtVal),selectedRecords=ZPNewView.crtSelectedRecords[curr_criteria_id];void 0===selectedRecords&&(selectedRecords=[]);var selVals=[];$.each(values,function(key,value){$.each(fcRecords,function(k,v){(value==v.VALUE&&!v.isChecked||value==v.ID)&&(selectedRecords.push(v.ID+""),v.isChecked=!0,selVals.push(ZPeople.decodeTxt(v.DISPVALUE)))})}),ZPNewView.crtSelectedRecords[curr_criteria_id]=selectedRecords,ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#txtValue").val(selVals.toString())}}Timetracker.views.isTimetrackerSpecialFields(obj.tName,obj.labelName)&&ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").select2("val",Timetracker.views.getDefaultValueForSearch(obj.labelName,value)).trigger("change"),tempCnt++}),0==tempCnt){var curr_criteria_id=ZPNewView.addCriteria();ZPNewView.fieldOptionPopOverInit(curr_criteria_id)}}else ZPNewView.LAYOUT.find("#defaultViewSection,#viewPremissionSection,#criteriaHeader,#criteriaSection,#zp_custom_view_sharedto").remove();var selectedComps=viewDetails.components;0!==Object.keys(selectedComps).length&&(ZPNewView.savedComponents=selectedComps,ZPNewView.constructSelectedRightColumn()),ZPNewView.initLeftColumns(),ZPNewView.defaultActions();var mdata=ZPeople.Module.getData();mdata.isAdmin&&!mdata.viewDetails.isLocAdmin&&"P_MultiRater"!=ZPForm.getTableName()&&"P_MultiRater_Approval"!=ZPForm.getTableName()&&"P_Goals"!=ZPForm.getTableName()||ZPNewView.LAYOUT.find("#viewPremissionSection,#zp_custom_view_sharedto").remove(),Layout.Page.container.find("#zp_editview").find(".modal-body").html(ZPNewView.LAYOUT),Layout.Page.container.find(".modal-footer").find("#zp_modal_blubtn").prop("disabled",!1)}else void 0!==data.error.message?Layout.Page.container.find("#zp_editview").find(".modal-body").html("<p class='errorDiv style=''><b>"+data.error.message+"</b></p>"):void 0!==data.error.exception&&(Layout.Page.container.find("#zp_editview").find(".modal-body").html("<p class='errorDiv style=''><b>"+ZPI18N.getString("zp.erroroccurredloadingpage")+"</b></p>"),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.erroroccurredloadingpage")))},defaultActions:function(){Layout.Page.container.find(".modal-body").scrollTop(0),$(document).on("show.bs.dropdown","#lookupIcon",function(event){var inp=$(event.target).parent().find('[iscrtfc="true"]'),pfcid=inp.attr("pfcid"),fcid=inp.attr("fcid"),fcObj=ZPNewView.allComponents[fcid+""];-1!=pfcid&&(fcObj=ZPNewView.allComponents[pfcid+""].childComponents[fcid+""]);var fcType=fcObj.fcType;ZPNewView.loadCrtRequiredRecords(fcid,fcType);var crtID=$(event.target).parent().attr("id");ZPNewView.constructCrtSelectionRecord(crtID,ZPNewView.crtSelectionRecords[fcid],fcType,fcid),void 0!==ZPNewView.crtSelectedRecords[crtID]&&ZPNewView.makeSelectable(crtID,ZPNewView.crtSelectedRecords[crtID]),ZPNewView.LAYOUT.find("#crtRecordSearch").val("")}),$(document).on("keyup","#crtRecordSearch",function(e){var tr=$(this).parent().parent().parent().parent().parent().parent().parent().parent().parent().parent(),fcID=$(tr).find('[iscrtfc="true"]').attr("fcid"),currRecords=ZPNewView.crtSelectionRecords[fcID];if(!(Object.keys(currRecords).length<=0)){var crtID=$(tr).attr("id"),searchStr=$(this).val().trim();if(searchStr.length<=0)return ZPNewView.constructCrtSelectionRecord(crtID,currRecords),void(void 0!==ZPNewView.crtSelectedRecords[crtID]&&ZPNewView.makeSelectable(crtID,ZPNewView.crtSelectedRecords[crtID]));searchStr=searchStr.toLowerCase();var tempList=[];$.each(currRecords,function(key,value){-1!==value.DISPVALUE.toLowerCase().indexOf(searchStr)&&tempList.push(value)}),ZPNewView.constructCrtSelectionRecord(crtID,tempList),void 0!==ZPNewView.crtSelectedRecords[crtID]&&ZPNewView.makeSelectable(crtID,ZPNewView.crtSelectedRecords[crtID])}}),$(document).on("click","#crtDropdownSelection",function(e){$(this).hasClass("ZPCusPd")&&e.stopPropagation()}),ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").sortable({start:function(event,ui){$(ui.item).find("#parentCompDiv").addClass("drag")},stop:function(event,ui){$(ui.item).find("#parentCompDiv").removeClass("drag")},beforeStop:function(event,ui){ZPNewView.mouseDownFlag=!0},update:function(event,ui){ZPNewView.setRightColumns()}}),ZPNewView.LAYOUT.find("#zp_rightSide").on("click",function(event){var focusInID=event.target.id,focusOutID=$(this).find("input").parent().attr("id");focusInID.length>1&&focusInID!==focusOutID&&$(this).find("input").trigger("blur")}),ZPNewView.LAYOUT.find("#zp_custom_view_name").on("keypress",function(){ZPNewView.LAYOUT.find("#zp_custom_view_name").val().length<=0&&ZPNewView.LAYOUT.find("#zp_custom_view_name_error").hide()}),$(document).on("keyup","#fieldSearch",function(e){var parent=$(this).closest('[id^="fcid"]'),data=this.value.split(" "),allDataObj=$(parent).find("[name=list-group-item]");allDataObj.hide(),$.each(data,function(i,v){allDataObj=allDataObj.filter("*:Contains('"+v+"')")}),allDataObj.show()})},closeCallback:function(){if(ZPView.setViewPropertie("refreshStatus",!0),ZPView.setViewPropertie("refreshHeaders",!0),ZPView.removeViewProperty("groupBy"),ZPView.removeViewProperty("sortBy"),void 0===ZPNewView.LASTVIEWID||null===ZPNewView.LASTVIEWID)if(ZPeople.Module.getData().viewDetails.loaded=!1,ZPView.constructViews(),Layout.UrlConf.isModuleForm())ZPNewView.LASTVIEWID="systemview";else{var extOptions=Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2().find("option");ZPNewView.LASTVIEWID=extOptions[0].value}window.location.href=ZPView.getURL(ZPNewView.LASTVIEWID)},initLeftColumns:function(){ZPNewView.constructLeftCoulmns(ZPNewView.allComponents),$.each(ZPNewView.rightColumns,function(key,value){void 0!==ZPNewView.headerComponents[key+""]&&key===ZPNewView.headerComponents[key+""].formCompID||ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").find("#"+key).remove(),delete ZPNewView.leftColumns[key]}),ZPNewView.formatLeftComponents()},initRightColumns:function(){ZPNewView.constructRightColumns()},sort:function(components){var sortResult=Object.keys(components);return sortResult.sort(),sortResult},constructLeftCoulmns:function(components){var sortedComponents=ZPUtil.sortByJSONValue(components,"formCompID",!0);ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").empty();for(var i=0;i<sortedComponents.length;i++){var singleComponent=sortedComponents[i],formCompID=singleComponent.formCompID;void 0===formCompID&&(formCompID=$(singleComponent).attr("id"));var cmpName=singleComponent.formCompName;void 0===cmpName&&(cmpName=ZPNewView.allCmpName[formCompID].data("cmpName"));var parentFCID=singleComponent.parentFCID;void 0===parentFCID&&(parentFCID=$(singleComponent).attr("parentFCID"));var refFormID=singleComponent.refFormID;void 0===refFormID&&(refFormID=$(singleComponent).attr("refFormID"));var childCnt=singleComponent.childCnt;void 0===childCnt&&(childCnt=$(singleComponent).attr("childCnt"));var sumRequired=singleComponent.sumRequired;void 0===sumRequired&&(sumRequired=$(singleComponent).attr("sumRequired"));var row="<li id="+formCompID+" parentFCID="+parentFCID+" refFormID="+refFormID+" sumRequired="+sumRequired+" childCnt="+childCnt+" side=\"left\"class='list-group-item' onclick='ZPNewView.componentSelect(event,\"left\",this,\"parent\")'><div id='parentCompDiv' class='list-child'><div class='IC-drag FL gry MR5'></div><span id='leftFormCompNameID'></span></div></li>",childPresent=ZPNewView.headerComponents[formCompID+""];void 0!==childPresent&&(row=ZPNewView.constructChildComponents(formCompID,parentFCID,refFormID,childCnt,cmpName,childPresent.childComponents)),ZPNewView.leftColumns[formCompID+""]=row,ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").append(row),ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").children("#"+formCompID).find("#leftFormCompNameID").text(cmpName),void 0!==childPresent&&ZPNewView.setChildCompName(formCompID,childPresent.childComponents),ZPNewView.allCmpName.hasOwnProperty(formCompID)||((row=$(row)).data("cmpName",cmpName),row.data("displayName",cmpName),ZPNewView.allCmpName[formCompID]=row)}},setChildCompName:function(parentFormID,childComponents){$.each(childComponents,function(key,value){var childFormCompID=parentFormID+"_"+value.formCompID,childCmpName=value.formCompName;ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").children().find("#"+childFormCompID).find("#childCmpNameID").text(childCmpName)})},constructChildComponents:function(formCompID,parentFCID,refFormID,childCnt,cmpName,childComponents){var row="";if(void 0!==childComponents&&Object.keys(childComponents).length>0){row="<li id="+formCompID+" parentFCID="+parentFCID+" refFormID="+refFormID+" childCnt="+childCnt+" side=\"left\" class='list-group-item'onclick='ZPNewView.componentSelect(event,\"left\",this,\"parent\")'><div id='parentCompDiv' class='list-child'><div id='upAndDwn' class='IC-ar-dwn FL blu MR5 CP' onclick='ZPNewView.toggleLookupComponent(this)'></div><span id='leftFormCompNameID'></span><div class='IC-Lookup2-2x FR blu CP' onclick='ZPNewView.toggleLookupComponent(this)'></div></div>",row+="<ul class='list-group DN'>";var sortedChildComponents=ZPUtil.sortByJSONValue(childComponents,"formCompID",!0);$.each(sortedChildComponents,function(key,value){var childFormCompID=formCompID+"_"+value.formCompID,childCmpName=value.formCompName,subRow="<li id="+childFormCompID+" parentFCID="+value.parentFCID+" refFormID="+value.refFormID+" childCnt=0 side=\"left\"class='list-group-item' onclick='ZPNewView.childComponentSelect(event,\"left\",this,\"child\")'><div id='childCompDiv' class='list-child'><div class='IC-drag FL gry MR5'></div><span id='childCmpNameID'></span></div></li>",tempSubRow=subRow;ZPNewView.allCmpName.hasOwnProperty(childFormCompID)||((tempSubRow=$(tempSubRow)).data("cmpName",childCmpName),tempSubRow.data("displayName",childCmpName),ZPNewView.allCmpName[childFormCompID]=tempSubRow),row+=subRow}),row+="</ul></li>"}return row},constructRightColumns:function(components){ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").empty(),void 0!==components&&$.each(components,function(key,value){var cmpName=ZPNewView.allCmpName[key].data("displayName"),refFormID=$(value).attr("refFormID"),parentFCID=$(value).attr("parentFCID"),childCnt=$(value).attr("childCnt"),sumEnabled=$(value).find("#sumID").attr("value")===ZPI18N.getString("zp.capitalsum"),isAscStr=$(value).find("#asc_desc").attr("value"),isAsc=void 0;isAsc=void 0===isAscStr||isAscStr.length<=0?void 0:"ASC"===isAscStr;var isGrp=$(value).find("#grpBy").attr("value");isGrp=!(void 0===isGrp||isGrp.length<=0||"GRP"!==isGrp);var row=ZPNewView.constructRightSideListComponent(key,parentFCID,refFormID,childCnt,cmpName,isGrp,isAsc,sumEnabled);ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").append(row);var decodeCmpName=cmpName,originalName=ZPNewView.getOriginalName(key);ZPNewView.isEqual(originalName,decodeCmpName)?ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+key).find("#rightFormCompNameID").text(decodeCmpName):(ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+key).find("#editedFormCompNameID").text(decodeCmpName),ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+key).find("#originalFormCompNameID").text(originalName)),void 0!==parentFCID&&"0"!==parentFCID&&ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+key).find("#parentFormCmpNameID").text(ZPNewView.getParentCompNameByID(parentFCID))}),ZPNewView.setRightColumns()},constructSelectedRightColumn:function(){ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").empty();var sortedBySeq=ZPUtil.sortByJSONValue(ZPNewView.savedComponents,"sequenceNo",!0);$.each(sortedBySeq,function(key,value){var fcID=value.referredKey,cmpDisplayName=value.displayName;cmpDisplayName||(cmpDisplayName=ZPNewView.getOriginalName(fcID));var eachRow=ZPNewView.constructRightSideListComponent(fcID,value.parentFCID,value.refFormID,value.childCnt,cmpDisplayName,value.grouping,value.sorting,value.sumEnabled);ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").append(eachRow);var decodeCmpName=cmpDisplayName,originalName=ZPNewView.getOriginalName(fcID);ZPNewView.isEqual(originalName,decodeCmpName)?ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#rightFormCompNameID").text(decodeCmpName):(ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#editedFormCompNameID").text(decodeCmpName),ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#originalFormCompNameID").text(originalName)),void 0!==value.parentFCID&&"0"!==value.parentFCID&&ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#parentFormCmpNameID").text(ZPNewView.getParentCompNameByID(value.parentFCID)),ZPNewView.rightColumns[fcID]=eachRow}),ZPNewView.setRightColumns()},setRightColumns:function(htmlObj){ZPNewView.rightColumns={};var currRightComponents=ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children();$.each(currRightComponents,function(key,value){var id=$(this).attr("id");ZPNewView.rightColumns[id+""]=$(this)})},constructRightSideListComponent:function(key,parentFCID,refFormID,childCnt,cmpName,isGrp,isAsc,sumEnabled){var selected="<li id="+key+" value="+key+"  parentFCID="+parentFCID+" refFormID="+refFormID+" childCnt="+childCnt+" side=\"right\" class='list-group-item' onclick=ZPNewView.componentSelect(event,'right',this)>"+ZPNewView.listDiv(key,cmpName,parentFCID,isGrp,isAsc,sumEnabled),tempObj=selected+="</li>";return(tempObj=$(tempObj)).data("cmpName",cmpName),tempObj.data("displayName",cmpName),ZPNewView.allCmpName[key]=tempObj,selected},listDiv:function(fcID,cmpName,parentFCID,isGrp,isAsc,sumEnabled){var displayName=cmpName,listDiv="<div id='parentCompDiv' class='list-child'><div class='IC-drag FL gry MR5'></div>",originalName=ZPNewView.getOriginalName(fcID);ZPNewView.isEqual(originalName,displayName)?listDiv+="<span id='rightFormCompNameID'></span>":listDiv+="<div class='Edtxt'><span id='editedFormCompNameID'></span><br><font class='S12' id='originalFormCompNameID'></font></div>";var formComp=ZPNewView.allComponents[fcID];if(void 0!==parentFCID&&"0"!==parentFCID&&(listDiv+="<i class='IC-ar-lft gry CP S13 ML5'></i><font id='parentFormCmpNameID'></font>",formComp=ZPNewView.allComponents[parentFCID].childComponents[fcID.split("_")[1]]),listDiv+="<i class='IC-pen gry CP S13 ML8 list-over' onmousedown='ZPNewView.enableTextBox(this)'></i>",ZPNewView.isCustomView&&formComp&&formComp.grpRequired){if(void 0===isAsc||isAsc.length<=0)listDiv+="<div id='asc_desc' class='asdc ML10 list-over' onmousedown='ZPNewView.setAscDesc(this)' value=''>"+ZPI18N.getString("zp.capitalasc")+"</div>";else{var srtValue=ZPI18N.getString("zp.capitalasc");isAsc||(srtValue=ZPI18N.getString("zp.capitaldesc")),listDiv+="<div id='asc_desc' class='asdc ML10' onmousedown='ZPNewView.setAscDesc(this)' value='"+srtValue+"'>"+srtValue+"<i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeAscDesc(this)'></i></div>"}void 0===isGrp||!isGrp||isGrp.length>0?listDiv+="<div id='grpBy' class='asdc ML10 list-over' onmousedown='ZPNewView.setGroupBy(this)' value=''>"+ZPI18N.getString("zp.capitalgrp")+"</div>":listDiv+="<div id='grpBy' class='asdc ML10' onmousedown='ZPNewView.setGroupBy(this)' value='"+ZPI18N.getString("zp.capitalgrp")+"'>"+ZPI18N.getString("zp.capitalgrp")+"<i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeGrpBy(this)'></i></div>"}void 0!==formComp&&(formComp.sumRequired&&(listDiv+=sumEnabled?"<div id='sumID' class='asdc ML10' onmousedown='ZPNewView.setSum(this)' value='"+ZPI18N.getString("zp.capitalsum")+"'>"+ZPI18N.getString("zp.capitalsum")+"<i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeSum(this)'></i></div>":"<div id='sumID' class='asdc ML10 list-over' onmousedown='ZPNewView.setSum(this)' value=''>"+ZPI18N.getString("zp.capitalsum")+"</div>"));return listDiv+="</div>"},setSum:function(obj){if(ZPNewView.mouseDownFlag=!0,ZPNewView.removeSumFlag)ZPNewView.removeSumFlag=!1;else{var liObj=$(obj).parent().parent();$(obj).hasClass("list-over")&&($(liObj).find("#sumID").removeClass("list-over"),$(liObj).find("#sumID").attr("value",ZPI18N.getString("zp.capitalsum")),$(liObj).find("#sumID").html(ZPI18N.getString("zp.capitalsum")+" <i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeSum(this)'></i>"))}},removeSum:function(obj){ZPNewView.mouseDownFlag=!0,ZPNewView.removeSumFlag=!0;var liObj=$(obj).parent().parent().parent();$(liObj).find("#sumID").addClass("list-over"),$(liObj).find("#sumID").attr("value",""),$(liObj).find("#sumID").text(ZPI18N.getString("zp.capitalsum")),$(liObj).find("#sumID").find("i").remove()},setAscDesc:function(obj){if(ZPNewView.mouseDownFlag=!0,ZPNewView.removeAscDescFlag)ZPNewView.removeAscDescFlag=!1;else{var liObj=$(obj).parent().parent();$(obj).hasClass("list-over")?($(liObj).find("#asc_desc").removeClass("list-over"),$(liObj).find("#asc_desc").attr("value",ZPI18N.getString("zp.capitalasc")),$(liObj).find("#asc_desc").html(ZPI18N.getString("zp.capitalasc")+" <i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeAscDesc(this)'></i>")):ZPNewView.toggleAscDesc(obj)}},removeAscDesc:function(obj){ZPNewView.mouseDownFlag=!0,ZPNewView.removeAscDescFlag=!0;var liObj=$(obj).parent().parent().parent();$(liObj).find("#asc_desc").addClass("list-over"),$(liObj).find("#asc_desc").attr("value",""),$(liObj).find("#asc_desc").text(ZPI18N.getString("zp.capitalasc")),$(liObj).find("#asc_desc").find("i").remove();var grpVal=$(liObj).find("#grpBy").attr("value");void 0!==grpVal&&grpVal===ZPI18N.getString("zp.capitalgrp")&&(ZPNewView.removeGrpBy($(liObj).find("#grpBy").find("i")),ZPNewView.removeGrpFlag=!1)},setGroupBy:function(obj){if(ZPNewView.mouseDownFlag=!0,ZPNewView.removeGrpFlag)ZPNewView.removeGrpFlag=!1;else{var liObj=$(obj).parent().parent();if($(obj).hasClass("list-over")){$(liObj).find("#grpBy").removeClass("list-over"),$(liObj).find("#grpBy").attr("value",ZPI18N.getString("zp.capitalgrp")),$(liObj).find("#grpBy").html(ZPI18N.getString("zp.capitalgrp")+" <i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeGrpBy(this)'></i>");var sortVal=$(liObj).find("#asc_desc").attr("value");(void 0===sortVal||sortVal.length<=0)&&ZPNewView.setAscDesc($(liObj).find("#asc_desc"))}}},removeGrpBy:function(obj){ZPNewView.mouseDownFlag=!0,ZPNewView.removeGrpFlag=!0;var liObj=$(obj).parent().parent().parent();$(liObj).find("#grpBy").addClass("list-over"),$(liObj).find("#grpBy").attr("value",""),$(liObj).find("#grpBy").text(ZPI18N.getString("zp.capitalgrp")),$(liObj).find("#grpBy").find("i").remove();var sortVal=$(liObj).find("#asc_desc").attr("value");void 0!==sortVal&&sortVal.length>0&&(ZPNewView.removeAscDesc($(liObj).find("#asc_desc").find("i")),ZPNewView.removeAscDescFlag=!1)},enableTextBox:function(textObj){ZPNewView.mouseDownFlag=!0;var liObj=$(textObj).parent().parent(),fcID=$(liObj).attr("id"),cmpName=ZPNewView.allCmpName[fcID].data("displayName");if(void 0!==$(liObj).find("#grpBy")&&liObj.data("isGrp",$(liObj).find("#grpBy").attr("value")),void 0!==$(liObj).find("#asc_desc")&&liObj.data("isAsc",$(liObj).find("#asc_desc").attr("value")),void 0!==$(liObj).attr("parentFCID")&&liObj.data("parentFCID",$(liObj).attr("parentFCID")),void 0!==$(liObj).find("#sumID")){var sumEnabled=$(liObj).find("#sumID").attr("value")===ZPI18N.getString("zp.capitalsum");liObj.data("sumEnabled",sumEnabled)}$(liObj).html("<div class='IC-drag FL gry MT5 MR5'></div><input type='text' class='form-control table-inpt  input-bb1' onmousedown='ZPNewView.removeSelectOnInputBox()'><i class='IC-tick S15 DIB grn ML5 MR10 MT5 CP' onmousedown='ZPNewView.disableTextBox(this)'></i><i class='IC-cls S12 red DIB  CP MT5' onmousedown='ZPNewView.disableTextBox(this,true)'></i>"),setTimeout(function(){$(liObj).find("input").trigger("focus"),$(liObj).find("input").val(""),$(liObj).find("input").val(cmpName)},0),$(liObj).find("input").on("blur",function(){ZPNewView.disableTextBox($(this).next(),!0)})},disableTextBox:function(obj,isCancel){var liObj=$(obj).parent(),fcID=$(liObj).attr("id"),oldCmpName="";oldCmpName=isCancel?ZPNewView.allCmpName[fcID].data("displayName"):$(liObj).find("input").val();var isGrp=void 0;void 0!==liObj.data("isGrp")&&(isGrp=liObj.data("isGrp")===ZPI18N.getString("zp.capitalgrp"));var isAsc=void 0;void 0!==liObj.data("isAsc")&&(isAsc=(isAsc=liObj.data("isAsc")).length<=0?"":liObj.data("isAsc")===ZPI18N.getString("zp.capitalasc"));var parentFCID=void 0;void 0!==liObj.data("parentFCID")&&(parentFCID=liObj.data("parentFCID"));var sumEnabled=liObj.data("sumEnabled"),decodeCmpName=oldCmpName,originalName=ZPNewView.getOriginalName(fcID);if(void 0!=decodeCmpName&&0!=decodeCmpName.trim().length){ZPNewView.allCmpName[fcID].data("displayName",oldCmpName);var liHTML=ZPNewView.listDiv(fcID,oldCmpName,parentFCID,isGrp,isAsc,sumEnabled);$(liObj).html(liHTML),ZPNewView.isEqual(originalName,decodeCmpName)?ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#rightFormCompNameID").text(decodeCmpName):(ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#editedFormCompNameID").text(decodeCmpName),ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#originalFormCompNameID").text(originalName)),void 0!==parentFCID&&"0"!==parentFCID&&ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#parentFormCmpNameID").text(ZPNewView.getParentCompNameByID(parentFCID)),ZPNewView.mouseDownFlag=!0}else $(liObj).append('<div class="error-msg PL30">'+ZPI18N.getString("zp.relformerrmsg")+"</div>")},removeSelectOnInputBox:function(){ZPNewView.mouseDownFlag=!0},fieldChange:function(obj){var fcid=obj.attr("fcid"),pfcid=obj.attr("pfcid"),crtObj=obj.closest('[id^="zp_criteria"]'),fcObj=(crtObj.find('[iscrtfc="true"]'),ZPNewView.allComponents[fcid+""]),dispName="";-1!=pfcid&&(fcObj=ZPNewView.allComponents[pfcid+""].childComponents[fcid+""],dispName=" ("+ZPNewView.allComponents[pfcid+""].formCompName+" )"),dispName=fcObj.formCompName+dispName,crtObj.find(".error-msg").hide(),crtObj.find("#txtValue").val(""),crtObj.find("#txtValue").prop("disabled",!1),crtObj.find("#txtValue").removeAttr("onclick");var fcType=fcObj.fcType,formulaDType=fcObj.formulaDType;fcType==ZPForm.Field.SCRIPT&&void 0!=formulaDType&&-1!=formulaDType&&(fcType=formulaDType);var isLookup=!1,tName=fcObj.tName;fcObj.columnName;fcType==ZPForm.Field.LOOKUP&&(fcObj.reffColName,tName=fcObj.reffTname);var oprs="",defOptn=ZPNewView.OPERATORS.EQUAL,lkpDefOptn="";fcType==ZPForm.Field.LOOKUP&&(isLookup=!0,void 0==(fcType=fcObj.reffcType)&&(fcType=ZPForm.Field.TEXT),"P_Department"==tName||"P_DepartmentN1"==tName?(oprs+="<option value='"+ZPNewView.OPERATORS.LOGIN_USERS_DEPT+"'>"+ZPI18N.getString("zp.loginUsersDept")+"</option>",lkpDefOptn=defOptn=ZPNewView.OPERATORS.LOGIN_USERS_DEPT):"P_Employee"==tName||"P_EmployeeN1"==tName?(oprs+="<option value='"+ZPNewView.OPERATORS.LOGIN_USER+"'>"+ZPI18N.getString("zp.loginUser")+"</option>",lkpDefOptn=defOptn=ZPNewView.OPERATORS.LOGIN_USER):"P_Legal_Entity"==tName?(oprs+="<option value='"+ZPNewView.OPERATORS.LOGIN_USERS_ENTITY+"'>"+ZPI18N.getString("zp.loginUserEntity")+"</option>",lkpDefOptn=defOptn=ZPNewView.OPERATORS.LOGIN_USERS_ENTITY):"P_Business_Unit"==tName?(oprs+="<option value='"+ZPNewView.OPERATORS.LOGIN_USERS_UNIT+"'>"+ZPI18N.getString("zp.loginUserUnit")+"</option>",lkpDefOptn=defOptn=ZPNewView.OPERATORS.LOGIN_USERS_UNIT):"P_Divisions"==tName?(oprs+="<option value='"+ZPNewView.OPERATORS.LOGIN_USERS_DIVISION+"'>"+ZPI18N.getString("zp.loginUserDivision")+"</option>",lkpDefOptn=defOptn=ZPNewView.OPERATORS.LOGIN_USERS_DIVISION):"P_Goals"==tName&&(oprs+="<option value='"+ZPNewView.OPERATORS.SUBORDINATES_GOAL+"'>"+ZPI18N.getString("zp.subordinatesgoals")+"</option>",lkpDefOptn=defOptn=ZPNewView.OPERATORS.SUBORDINATES_GOAL)),fcObj.isEncrypted&&fcType!=ZPForm.Field.NEW_GENDER&&fcType!=ZPForm.Field.NEW_BLOODGROUP?(oprs="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>",oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",fcType==ZPForm.Field.DATE&&crtObj.find("#txtValue").attr("onclick","Calendar.setUpCalendar(event,this)"),defOptn=ZPNewView.OPERATORS.EQUAL):Timetracker.views.isTimetrackerSpecialFields(tName,fcObj.labelName,fcObj.reffTname)?(oprs+=Timetracker.views.getSearchOperationOptions(fcObj.labelName,!0),defOptn=Timetracker.views.getDefaultValueForSearch(fcObj.labelName)):fcType==ZPForm.Field.TEXT||fcType==ZPForm.Field.EMAIL_ADDRESS||fcType==ZPForm.Field.PHONE_NUMBER||fcType==ZPForm.Field.URL||fcType==ZPForm.Field.TEXT_AREA||fcType==ZPForm.Field.FILE_UPLOAD||fcType==ZPForm.Field.IMAGE||fcType==ZPForm.Field.BLOODGROUP||fcType==ZPForm.Field.GENDER||fcType==ZPForm.Field.COUNTRY||fcType==ZPForm.Field.ADDRESS||fcType==ZPForm.Field.STATES?(isLookup?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.IN):(oprs+="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.EQUAL),oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",fcType!=ZPForm.Field.BLOODGROUP&&fcType!=ZPForm.Field.GENDER&&fcType!=ZPForm.Field.COUNTRY&&(oprs+="<option value='24'>"+ZPI18N.getString("zp.startswith")+"</option>",oprs+="<option value='25'>"+ZPI18N.getString("zp.endswith")+"</option>",oprs+="<option value='26'>"+ZPI18N.getString("zp.contains")+"</option>",oprs+="<option value='27'>"+ZPI18N.getString("zp.notcontains")+"</option>")):fcType==ZPForm.Field.DATE||fcType==ZPForm.Field.DATE_TIME||fcType==ZPForm.Field.FORMULA_DATE?(isLookup?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>"):(oprs+="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>"),oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",oprs+="<option value='20'>"+ZPI18N.getString("zp.before")+"</option>",oprs+="<option value='21'>"+ZPI18N.getString("zp.after")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.YESTERDAY+"'>"+ZPI18N.getString("zp.yesterday")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.TODAY+"'>"+ZPI18N.getString("zp.today")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.TOMORROW+"'>"+ZPI18N.getString("zp.tomorrow")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.LAST_WEEK+"'>"+ZPI18N.getString("zp.lastweek")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.THIS_WEEK+"'>"+ZPI18N.getString("zp.thisweek")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NEXT_WEEK+"'>"+ZPI18N.getString("zp.nextweek")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.LAST_MONTH+"'>"+ZPI18N.getString("zp.lastmonth")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.THIS_MONTH+"'>"+ZPI18N.getString("zp.thismonth")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NEXT_MONTH+"'>"+ZPI18N.getString("zp.nextmonth")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.LAST_YEAR+"'>"+ZPI18N.getString("zp.lastyear")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.CURRENT_YEAR+"'>"+ZPI18N.getString("zp.thisyear")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NEXT_YEAR+"'>"+ZPI18N.getString("zp.nextyear")+"</option>",fcType==ZPForm.Field.DATE_TIME?crtObj.find("#txtValue").attr("onclick","Calendar.setUpCalendar(event,this,1)"):crtObj.find("#txtValue").attr("onclick","Calendar.setUpCalendar(event,this)"),crtObj.find("#txtValue").attr("caltype","popup"),defOptn=ZPNewView.OPERATORS.TODAY):fcType==ZPForm.Field.CHECK_BOX?(oprs+="<option value='49'>"+ZPI18N.getString("zp.yes")+"</option>",oprs+="<option value='50'>"+ZPI18N.getString("zp.no")+"</option>",defOptn=ZPNewView.OPERATORS.TRUE):fcType==ZPForm.Field.NUMBER||fcType==ZPForm.Field.CURRENCY||fcType==ZPForm.Field.DECIMAL?(isLookup?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.IN):(oprs+="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.EQUAL),oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",oprs+="<option value='20'>"+ZPI18N.getString("zp.lesserthan")+"</option>",oprs+="<option value='21'>"+ZPI18N.getString("zp.greaterthan")+"</option>",oprs+="<option value='22'>"+ZPI18N.getString("zp.lesserorequalto")+"</option>",oprs+="<option value='23'>"+ZPI18N.getString("zp.greaterorequalto")+"</option>"):fcType==ZPForm.Field.PICKLIST?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",oprs+="<option value='24'>"+ZPI18N.getString("zp.startswith")+"</option>",oprs+="<option value='25'>"+ZPI18N.getString("zp.endswith")+"</option>",oprs+="<option value='26'>"+ZPI18N.getString("zp.contains")+"</option>",oprs+="<option value='27'>"+ZPI18N.getString("zp.notcontains")+"</option>",oprs+="<option value='20'>"+ZPI18N.getString("zp.lesserthan")+"</option>",oprs+="<option value='21'>"+ZPI18N.getString("zp.greaterthan")+"</option>",oprs+="<option value='22'>"+ZPI18N.getString("zp.lesserorequalto")+"</option>",oprs+="<option value='23'>"+ZPI18N.getString("zp.greaterorequalto")+"</option>",defOptn=ZPNewView.OPERATORS.IN):fcType==ZPForm.Field.NEW_GENDER||fcType==ZPForm.Field.NEW_BLOODGROUP||fcType==ZPForm.Field.NEW_COUNTRY?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",defOptn=ZPNewView.OPERATORS.IN):fcType==ZPForm.Field.TIME?(isLookup?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.IN):(oprs+="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.EQUAL),oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",oprs+="<option value='20'>"+ZPI18N.getString("zp.before")+"</option>",oprs+="<option value='21'>"+ZPI18N.getString("zp.after")+"</option>"):isLookup?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.IN):(oprs+="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",defOptn=ZPNewView.OPERATORS.EQUAL),""!=lkpDefOptn&&(defOptn=lkpDefOptn),crtObj.find("[isopr='true']").html(oprs),crtObj.find("[isopr='true']").attr("disabled",!1),crtObj.find("[isopr='true']").select2(),crtObj.find("[isopr='true']").select2("val",[defOptn]);var criteriaRowId=crtObj.attr("id");(isLookup||fcType==ZPForm.Field.PICKLIST)&&(void 0!==ZPNewView.crtSelectedRecords[criteriaRowId]&&delete ZPNewView.crtSelectedRecords[criteriaRowId]);ZPNewView.addPickListComponent(criteriaRowId,isLookup),isLookup||fcType==ZPForm.Field.PICKLIST||fcType==ZPForm.Field.DATE||fcType==ZPForm.Field.DATE_TIME||fcType==ZPForm.Field.FORMULA_DATE?crtObj.find("#txtValue").on("keydown",function(e){e.preventDefault()}):crtObj.find("#txtValue").off("keydown"),crtObj.find("[isopr='true']").trigger("change")},constructCriteria:function(){var criteriaRow="<tr id='zp_criteria_"+ZPNewView.criteriaCnt+++"' class='ZPLRow ZPLErr'>";return criteriaRow+="<td>",ZPNewView.criteriaCnt>1&&(criteriaRow+="<select id='operatorSelection'><option value='AND'>"+ZPI18N.getString("zp.captialand")+"</option><option value='OR'>"+ZPI18N.getString("zp.captialor")+"</option></select>"),criteriaRow+="</td>",criteriaRow+="<td class='dropdown'><input id='fieldOpetions' value='"+ZPI18N.getString("zp.none")+"' fcid='-1' pfcid='-1' iscrtfc='true' class='form-control'data-placement='bottom' data-toggle='popover'><span class='error-msg DN' id='zp_criteria_field_error'></span></td>",criteriaRow+="<td><select isopr='true' onChange=ZPNewView.onConditionChange(this)><option value='-1'>"+ZPI18N.getString("zp.none")+"</option></select></td>",criteriaRow+="<td id='crtValueTD'><input id='txtValue' type='text' class='form-control'><span class='error-msg DN' id='zp_criteria_error'></span></td>",criteriaRow+=ZPNewView.INPUT_DROPDOWN,criteriaRow+="<td>",criteriaRow+="<div class='IC-plus-fill S16 blu FL MT5 CP' onclick=ZPNewView.addCriteria(this)></div>",criteriaRow+="<div class='IC-cls-fill S16 red FL MT5 ML5 CP' onclick=ZPNewView.removeCriteria(this)></div>",criteriaRow+="</td></tr>"},fieldOptionPopOverInit:function(crtID){var ruleFieldObj=ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").find("#"+crtID).find("#fieldOpetions"),menuBoxContent=ZPNewView.constructFieldOptionsPopover(ruleFieldObj);menuBoxContent.find("#contentDiv").removeClass("ulItemrec"),ZPNewView.defaultActions(),$(ruleFieldObj).setPopOver({callback:ZPNewView.fiedpopoverclback,html:menuBoxContent,targetId:ruleFieldObj,keyname:"name=list-group-item",container:""})},constructFieldOptionsPopover:function(obj){var fieldListClone,formId=ZPNewView.formId,fcid=$(obj).attr("fcid"),pfcid=$(obj).attr("pfcid");if(!ZPNewView.fieldListCloneDom.hasOwnProperty(formId)){var tabLi=(fieldListClone=AutomationCommon.getFormFieldsHtml().clone()).find("#dvRecipient li:first").clone(),contDiv=fieldListClone.find("#contentDiv :first").clone(),contLi=fieldListClone.find("[name=list-group-item]").clone();fieldListClone.find("#dvRecipient").empty(),fieldListClone.find("#contentDiv").empty();var cloneTagLiForBaseForm=tabLi.clone();cloneTagLiForBaseForm.attr({class:"",id:"div"+ZPNewView.formId}),cloneTagLiForBaseForm.find("a").attr({"data-toggle":"tab",href:"#fcid"+ZPNewView.formId}).html(ZSEC.Encoder.encodeForHTML(ZPNewView.FORM_NAME)),fieldListClone.find("#dvRecipient").append(cloneTagLiForBaseForm),$.each(ZPNewView.headerComponents,function(key,value){var cloneTagLi=tabLi.clone();cloneTagLi.attr({class:"",id:"div"+key}),cloneTagLi.find("a").attr({"data-toggle":"tab",href:"#fcid"+key}).text(value.formCompName),fieldListClone.find("#dvRecipient").append(cloneTagLi)});var cloneContDiv=contDiv.clone();cloneContDiv.find("[name=list-group]").empty(),$(cloneContDiv).find("[type=search]").attr("id","fieldSearch"),$(cloneContDiv).attr({class:"tab-pane fade",id:"fcid"+ZPNewView.formId}),$.each(ZPNewView.allComponents,function(key,value){if(!("0"!==value.parentFCID||value.fcType===ZPForm.Field.IMAGE||"P_EmployeeLeave"===ZPForm.getTableName()&&"ZP_Leave_Unit"==value.labelName||"P_Employee"==ZPForm.getTableName()&&"ORGANIZATION_TAG_NAME"==value.columnName)){var li=contLi.clone(),fieldKey=value.formCompID;li.find("[name=optDiv]").attr({id:fieldKey,pfcid:"-1"}),li.find("[name=mOpt]").html(ZSEC.Encoder.encodeForHTML(value.formCompName)),li.find("[name=mOpt]").parent("for",fieldKey),$(cloneContDiv).find("[name=list-group]").append(li)}}),fieldListClone.find("#contentDiv").append(cloneContDiv),$.each(ZPNewView.headerComponents,function(key,value){var cloneContDiv=contDiv.clone();cloneContDiv.find("[name=list-group]").empty(),$(cloneContDiv).find("[type=search]").attr("id","fieldSearch"),$(cloneContDiv).attr({class:"tab-pane fade",id:"fcid"+key}),$.each(value.childComponents,function(k,v){var tName=v.tName,columnName=v.columnName;if(("P_Rating"!=tName||"STARS"!=columnName)&&v.fcType!=ZPForm.Field.IMAGE){var li=contLi.clone(),fieldKey=k;li.find("[name=optDiv]").attr({id:fieldKey,pfcid:value.formCompID}),li.find("[name=mOpt]").html(ZSEC.Encoder.encodeForHTML(v.formCompName)),li.find("[name=mOpt]").parent("for",fieldKey),$(cloneContDiv).find("[name=list-group]").append(li)}}),fieldListClone.find("#contentDiv").append(cloneContDiv)}),ZPNewView.fieldListCloneDom[formId]=$(fieldListClone)}return fieldListClone=ZPNewView.fieldListCloneDom[formId].html(),fieldListClone=jQuery("<div />",{class:"clone"}).append(fieldListClone),-1==fcid&&-1==pfcid?($(fieldListClone).find("#div"+ZPNewView.formId).attr("class","active"),$(fieldListClone).find("#fcid"+ZPNewView.formId).attr("class","tab-pane fade active in")):-1==pfcid&&-1!==fcid?($(fieldListClone).find("#div"+ZPNewView.formId).attr("class","active"),$(fieldListClone).find("#fcid"+ZPNewView.formId).attr("class","tab-pane fade active in"),$(fieldListClone).find("#fcid"+ZPNewView.formId).find('a[id="'+fcid+'"]').parent().attr("class","sel")):-1!==pfcid&&-1!==fcid&&($(fieldListClone).find("#div"+pfcid).attr("class","active"),$(fieldListClone).find("#fcid"+pfcid).attr("class","tab-pane fade active in"),$(fieldListClone).find("#fcid"+pfcid).find('a[id="'+fcid+'"]').parent().attr("class","sel")),fieldListClone},fiedpopoverclback:function(ele,pfcid,fcid,isFromEditView){var obj,dispName="";if(isFromEditView){var fcObj=ZPNewView.allComponents[fcid+""];-1!=pfcid&&(fcObj=ZPNewView.allComponents[pfcid+""].childComponents[fcid+""],dispName=" ("+ZPNewView.allComponents[pfcid+""].formCompName+" )"),dispName=fcObj.formCompName+dispName,obj=$(ele),$(obj).val(dispName),$(obj).attr({fcid:fcid,pfcid:pfcid,iscrtfc:!0})}else{var text=$(ele).find("span").text(),id=$(ele).find("a").attr("id");"-1"!=(pfcid=$(ele).find("a").attr("pfcid"))&&(dispName=" ("+ZPNewView.allComponents[pfcid+""].formCompName+" )"),text+=dispName,obj=$(ele).closest('[id^="popover"]').parent().find("#fieldOpetions"),$(obj).val(text),$(obj).attr({fcid:id,pfcid:pfcid,iscrtfc:!0})}ZPNewView.fieldChange(obj)},addCriteria:function(obj){if(void 0===obj||ZPNewView.validCriteria()){var criteria=ZPNewView.constructCriteria(),curr_criteria_id=$(criteria).attr("id");return ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").append(criteria),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#operatorSelection").select2({minimumResultsForSearch:1/0}),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#fieldSelection").children().length>3?ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#fieldSelection").select2():ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#fieldSelection").select2({minimumResultsForSearch:1/0}),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").children().length>3?ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").select2():ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").select2({minimumResultsForSearch:1/0}),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[iscrtfc='true']").on("keydown",function(e){e.preventDefault()}),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#txtValue").attr("disabled",!0),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").select2(),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").select2("disable"),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find('[isviewcrt="true"]').parent().on("shown.bs.dropdown",function(){var fcid=$(this).find('[iscrtfc="true"]').attr("fcid"),pfcid=$(this).find('[iscrtfc="true"]').attr("pfcid");-1!=fcid?($(this).find('ul[pfcid="'+pfcid+'"]').collapse("show"),$(this).find('[isviewcrt="true"]').scrollTop($(this).find('[isviewcrt="true"]').scrollTop()+$(this).find('ul[pfcid="'+pfcid+'"]').find('a[value="'+fcid+'"]').position().top)):$(this).find('ul[pfcid="-1"]').collapse("show")}),0!=$(obj).length&&ZPNewView.fieldOptionPopOverInit(curr_criteria_id),Layout.Page.container.find(".modal-body").scrollTop(Layout.Page.container.find(".PL30").height()),curr_criteria_id}},removeCriteria:function(obj){var tr=$(obj).parent().parent(),criteriaRowId=tr.attr("id"),firstRowID=ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").children()[0].id;if(tr.remove(),ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").children().length<=0){ZPNewView.criteriaCnt=0;var curr_criteria_id=ZPNewView.addCriteria();ZPNewView.fieldOptionPopOverInit(curr_criteria_id)}else firstRowID===criteriaRowId&&$(ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").children()[0]).find("#operatorSelection").parent().empty()},validCriteria:function(){var isValid=!0;return $.each(ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").children().find('[iscrtfc="true"]'),function(key,value){"-1"==$(value).attr("fcid")&&(isValid=!1,$(this).parent().find("#zp_criteria_field_error").html(ZPI18N.getString("zp.pleaseselectfieldname")).show())}),isValid},validCriteriaValue:function(fcType,tr,operator,crtValue,isFromLookUpFilter){isFromLookUpFilter||(crtValue=$(tr).find("#txtValue").val());var key,isFromLookupFilterResult={},isValid=!0;switch(fcType){case ZPForm.Field.EMAIL_ADDRESS:operator!=ZPNewView.OPERATORS.EQUAL&&operator!=ZPNewView.OPERATORS.NOT_EQUAL||(isValid=ZPUtil.Validation.isEmail(crtValue,!0))||(key=ZPI18N.getString("zp.entervalidemailaddress"));break;case ZPForm.Field.NUMBER:(isValid=ZPUtil.Validation.isNumber(crtValue))||(key=ZPI18N.getString("zp.enteravalidnumber"));break;case ZPForm.Field.DATE:(isValid=ZPUtil.Validation.isDate(crtValue))||(key=ZPI18N.getString("zp.holiday.dateerror"));break;case ZPForm.Field.DECIMAL:case ZPForm.Field.CURRENCY:isValid=!1,"SUCCESS"===ZPUtil.getDecimalLength(crtValue).message&&(isValid=!0),isValid||(key=ZPI18N.getString("zp.enteravalidnumber"))}return(void 0==crtValue||crtValue.length<=0)&&((isValid=!1)||(key=ZPI18N.getString("zp.fieldupdate.specifyfield"))),isFromLookUpFilter?(isFromLookupFilterResult.isValid=isValid,isFromLookupFilterResult.key=key,isFromLookupFilterResult):(isValid?$(tr).find("#zp_criteria_error").hide():$(tr).find("#zp_criteria_error").html(ZPI18N.getString("zp.invalidcriteriavalue")).show(),isValid)},addPickListComponent:function(criteriaRowId,addFlag){addFlag?ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#zp_crt_input_dropdown").removeClass("DN"):ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#zp_crt_input_dropdown").addClass("DN")},onConditionChange:function(obj){var optval=$(obj).val(),criteriaRowId=$(obj).parent().parent().attr("id"),inp=ZPNewView.LAYOUT.find("#"+criteriaRowId).find('[iscrtfc="true"]'),pfcid=inp.attr("pfcid"),fcid=inp.attr("fcid"),fcObj=ZPNewView.allComponents[fcid+""];-1!=pfcid&&(fcObj=ZPNewView.allComponents[pfcid+""].childComponents[fcid+""]);var fcType=fcObj.fcType;if(ZPNewView.LAYOUT.find("#"+criteriaRowId).find(".error-msg").hide(),Timetracker.views.isTimetrackerSpecialFields(fcObj.tName,fcObj.labelName))return ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").val(""),void ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").attr("disabled",!0);if(29==optval||30==optval||optval==ZPNewView.OPERATORS.YESTERDAY||optval==ZPNewView.OPERATORS.TODAY||optval==ZPNewView.OPERATORS.TOMORROW||optval==ZPNewView.OPERATORS.LAST_MONTH||optval==ZPNewView.OPERATORS.THIS_MONTH||optval==ZPNewView.OPERATORS.NEXT_MONTH||optval==ZPNewView.OPERATORS.LAST_YEAR||optval==ZPNewView.OPERATORS.CURRENT_YEAR||optval==ZPNewView.OPERATORS.NEXT_YEAR||optval==ZPNewView.OPERATORS.LOGIN_USERS_DEPT||optval==ZPNewView.OPERATORS.LOGIN_USER||optval==ZPNewView.OPERATORS.THIS_WEEK||optval==ZPNewView.OPERATORS.LAST_WEEK||optval==ZPNewView.OPERATORS.NEXT_WEEK||optval==ZPNewView.OPERATORS.TRUE||optval==ZPNewView.OPERATORS.FALSE||optval==ZPNewView.OPERATORS.LOGIN_USERS_ENTITY||optval==ZPNewView.OPERATORS.LOGIN_USERS_UNIT||optval==ZPNewView.OPERATORS.LOGIN_USERS_DIVISION||optval==ZPNewView.OPERATORS.SUBORDINATES_GOAL)ZPNewView.addPickListComponent(criteriaRowId,!1),ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").val(""),ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").attr("disabled",!0),(fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST)&&void 0!==ZPNewView.crtSelectedRecords[criteriaRowId]&&delete ZPNewView.crtSelectedRecords[criteriaRowId];else if(optval==ZPNewView.OPERATORS.NOT_IN||optval==ZPNewView.OPERATORS.IN){if(fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST||fcType==ZPForm.Field.NEW_GENDER||fcType==ZPForm.Field.NEW_BLOODGROUP||fcType==ZPForm.Field.NEW_COUNTRY)return ZPNewView.addPickListComponent(criteriaRowId,!0),void 0!==ZPNewView.crtSelectedRecords[criteriaRowId]?ZPNewView.displayCrtTxt(criteriaRowId):(delete ZPNewView.crtSelectedRecords[criteriaRowId],ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").val("")),void ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").attr("disabled",!0);ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").prop("disabled",!1)}else fcType!=ZPForm.Field.LOOKUP&&fcType!=ZPForm.Field.PICKLIST||ZPNewView.addPickListComponent(criteriaRowId,!1),ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").prop("disabled",!1);if(fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST){var optVal=ZPNewView.LAYOUT.find("#"+criteriaRowId).find("[isopr='true']").val();optVal==ZPNewView.OPERATORS.NOT_IN||optVal==ZPNewView.OPERATORS.IN?ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").on("keydown",function(e){e.preventDefault()}):ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").off("keydown")}},toggleLookupComponent:function(obj){var upAndDwn=$(obj).parent().find("#upAndDwn");ZPNewView.toggleUpAndDownArrow(upAndDwn)},toggleUpAndDownArrow:function(obj){ZPNewView.mouseDownFlag=!0,$(obj).hasClass("IC-ar-dwn")?($(obj).removeClass("IC-ar-dwn"),$(obj).addClass("IC-ar-top"),$(obj).parent().parent().addClass("subclm"),$(obj).parent().parent().children().next().removeClass("DN")):($(obj).removeClass("IC-ar-top"),$(obj).addClass("IC-ar-dwn"),$(obj).parent().parent().removeClass("subclm"),$(obj).parent().parent().children().next().addClass("DN"))},toggleAscDesc:function(obj){ZPNewView.mouseDownFlag=!0;var value=$(obj).attr("value");value=value===ZPI18N.getString("zp.capitalasc")?ZPI18N.getString("zp.capitaldesc"):ZPI18N.getString("zp.capitalasc"),$(obj).attr("value",value),$(obj).html(value+"<i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeAscDesc(this)'></i>")},isExistInRightSide:function(idx){var isExist=!1,currRightChildrens=ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children();return $.each(currRightChildrens,function(key,value){$(value).attr("id")!==idx||(isExist=!0)}),isExist},componentSelect:function(event,side,obj,part){if("child"!==part)if(ZPNewView.childSelectFlag)ZPNewView.childSelectFlag=!1;else{var idx=$(obj).attr("id");if("left"===side)ZPNewView.isExistInRightSide(idx)&&(ZPNewView.mouseDownFlag=!0);ZPNewView.mouseDownFlag?ZPNewView.mouseDownFlag=!1:ZPNewView.toggleSelectClass(side,idx,obj)}},childComponentSelect:function(event,side,obj,part){if("parent"!==part){var idx=$(obj).attr("id");ZPNewView.childSelectFlag=!0,"left"===side?ZPNewView.leftSideSelected.hasOwnProperty(idx)?($(obj).find("div#childCompDiv").removeClass("sel"),delete ZPNewView.leftSideSelected[idx]):($(obj).find("div#childCompDiv").addClass("sel"),ZPNewView.leftSideSelected[idx]=$(obj)):ZPNewView.rightSideSelected.hasOwnProperty(idx)?($(obj).find("div#childCompDiv").removeClass("sel"),delete ZPNewView.rightSideSelected[idx]):($(obj).find("div#childCompDiv").addClass("sel"),ZPNewView.rightSideSelected[idx]=$(obj))}},toggleSelectClass:function(side,idx,obj){"left"===side?ZPNewView.leftSideSelected.hasOwnProperty(idx)?($(obj).find("div#parentCompDiv").removeClass("sel"),delete ZPNewView.leftSideSelected[idx]):($(obj).find("div#parentCompDiv").addClass("sel"),ZPNewView.leftSideSelected[idx]=$(obj)):ZPNewView.rightSideSelected.hasOwnProperty(idx)?($(obj).find("div#parentCompDiv").removeClass("sel"),delete ZPNewView.rightSideSelected[idx]):($(obj).find("div#parentCompDiv").addClass("sel"),ZPNewView.rightSideSelected[idx]=$(obj))},moveSelectedRowToRight:function(){Object.keys(ZPNewView.leftSideSelected).length<1||($.each(ZPNewView.leftSideSelected,function(key,value){key=$(this).attr("id");ZPNewView.rightColumns[key]=this,delete ZPNewView.leftColumns[key]}),ZPNewView.constructRightColumns(ZPNewView.rightColumns),ZPNewView.LAYOUT.find("#zp_right_column_error").hide(),$.each(ZPNewView.leftSideSelected,function(key,value){var id=$(value).attr("id");void 0===ZPNewView.headerComponents[id+""]||id!==ZPNewView.headerComponents[id+""].formCompID?$(this).remove():$(this).find("div#parentCompDiv").removeClass("sel")}),ZPNewView.leftSideSelected={},ZPNewView.rightSideSelected={},ZPNewView.formatLeftComponents())},formatLeftComponents:function(){var currLeftChildrens=ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").children();$.each(currLeftChildrens,function(key,value){var idx=$(value).attr("id");void 0!==ZPNewView.headerComponents[idx+""]&&idx===ZPNewView.headerComponents[idx+""].formCompID&&($(value).children().next().children().length<=0&&ZPNewView.isExistInRightSide(idx)&&($(this).remove(),delete ZPNewView.leftColumns[idx]))})},moveSelectedRowToLeft:function(){Object.keys(ZPNewView.rightSideSelected).length<1||($.each(ZPNewView.rightSideSelected,function(key,value){$(this).remove(),delete ZPNewView.rightColumns[key],delete ZPNewView.allCmpName[key]}),ZPNewView.rightSideSelected={},ZPNewView.leftSideSelected={},ZPNewView.constructLeftCoulmns(ZPNewView.allComponents),$.each(ZPNewView.rightColumns,function(key,value){void 0!==ZPNewView.headerComponents[key+""]&&key===ZPNewView.headerComponents[key+""].formCompID||ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").find("#"+key).remove(),delete ZPNewView.leftColumns[key]}),ZPNewView.formatLeftComponents())},moveAllLeftToRight:function(){Object.keys(ZPNewView.leftColumns).length<1||($.each(ZPNewView.leftColumns,function(key,value){ZPNewView.rightColumns[key]=value}),ZPNewView.constructRightColumns(ZPNewView.rightColumns),ZPNewView.LAYOUT.find("#zp_right_column_error").hide(),ZPNewView.leftSideSelected={},ZPNewView.rightSideSelected={},ZPNewView.constructLeftCoulmns(ZPNewView.allComponents),$.each(ZPNewView.rightColumns,function(key,value){void 0!==ZPNewView.headerComponents[key+""]&&key===ZPNewView.headerComponents[key+""].formCompID||ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").find("#"+key).remove(),delete ZPNewView.leftColumns[key]}),ZPNewView.formatLeftComponents())},moveAllRightToLeft:function(){Object.keys(ZPNewView.rightColumns).length<1||(ZPNewView.allCmpName={},ZPNewView.constructLeftCoulmns(ZPNewView.allComponents),ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children().remove(),ZPNewView.rightColumns={},ZPNewView.leftSideSelected={},ZPNewView.rightSideSelected={})},updateAction:function(){ZPNewView.saveAction(null,!0)},saveAction:function(modal,isUpdate){var isValid=!0,isFirstErrMsg=!0;ZPNewView.LAYOUT.find(".error-msg").hide();var customViewName=ZPNewView.LAYOUT.find("#zp_custom_view_name").val().trim();(""===customViewName||customViewName.length<=0)&&(ZPNewView.LAYOUT.find("#zp_custom_view_name_error").html(ZPI18N.getString("zp.viewempty")).show(),Layout.Page.container.find(".modal-body").scrollTop(0),isFirstErrMsg=!1,isValid=!1);var rightSideColumns=ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children();if(rightSideColumns.length<=0){if(ZPNewView.LAYOUT.find("#zp_right_column_error").html(ZPI18N.getString("zp.pleaseselectonecolumn",new Array(ZSEC.Encoder.encodeForHTML(ZPNewView.FORM_NAME)))).show(),isFirstErrMsg){var height=Layout.Page.container.find(".modal-body").find(".form-horizontal.pad").height();height+=Layout.Page.container.find(".modal-body").find(".row.MB20").height(),Layout.Page.container.find(".modal-body").scrollTop(height),isFirstErrMsg=!1}isValid=!1}var isDefault=ZPNewView.LAYOUT.find("#zp_custom_view_default").is(":checked"),onlyMe=ZPNewView.LAYOUT.find("#zp_custom_view_only_me").is(":checked"),allEmployee=ZPNewView.LAYOUT.find("#zp_custom_view_all_employees").is(":checked"),show_approver=(ZPNewView.LAYOUT.find("#zp_custom_view_selected_users").is(":checked"),ZPNewView.LAYOUT.find("#zp_custom_view_approval").is(":checked")),shareToAll=null,specificView=null;onlyMe||(shareToAll=allEmployee)||(specificView={},null!==ZPNewView.pickListComponent&&(specificView.employee=ZPPickList.getSelectedUsers().toString(),specificView.department=ZPPickList.getSelectedDepartments().toString(),specificView.role=ZPPickList.getSelectedRoles().toString(),specificView.location=ZPPickList.getSelectedLocations().toString()));var selectedColumnsJsonObj=[],withoutParentFC=!0;if($.each(rightSideColumns,function(key,value){var parentFC=$(value).attr("parentFCID");withoutParentFC&&"0"===parentFC&&(withoutParentFC=!1);var formCompID=$(value).attr("id"),cmpDisplayName=ZPNewView.allCmpName[formCompID].data("displayName"),cmpName=ZPNewView.allCmpName[formCompID].data("cmpName"),refFormID=$(value).attr("refFormID"),grpStr=$(value).find("#grpBy").attr("value"),isGrp=null;void 0!==grpStr&&grpStr===ZPI18N.getString("zp.capitalgrp")&&(isGrp=!0);var ascStr=$(value).find("#asc_desc").attr("value"),asc=null;void 0!==ascStr&&ascStr.length>0&&(asc=!1,ascStr===ZPI18N.getString("zp.capitalasc")&&(asc=!0),null===isGrp&&(isGrp=!1));var column={formCompID:formCompID,refFormID:refFormID,grouping:isGrp,sorting:asc,sumEnabled:$(value).find("#sumID").attr("value")===ZPI18N.getString("zp.capitalsum")};void 0!=parentFC&&"0"!=parentFC&&(column.parentFcType=ZPNewView.allComponents[parentFC+""].fcType),isUpdate&&(ZPNewView.savedComponents&&ZPNewView.savedComponents[formCompID]&&ZPNewView.savedComponents[formCompID].displayName||cmpDisplayName!==cmpName)&&(column.displayName=cmpDisplayName),selectedColumnsJsonObj.push(column)}),withoutParentFC){if(ZPNewView.LAYOUT.find("#zp_right_column_error").html(ZPI18N.getString("zp.pleaseselectonecolumn",new Array(ZSEC.Encoder.encodeForHTML(ZPNewView.FORM_NAME)))).show(),isFirstErrMsg){height=Layout.Page.container.find(".modal-body").find(".form-horizontal.pad").height();height+=Layout.Page.container.find(".modal-body").find(".row.MB20").height(),Layout.Page.container.find(".modal-body").scrollTop(height),isFirstErrMsg=!1}isValid=!1}var isValidCrt=!0,criteriaList=ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").children(),crtJson=[];if($.each(criteriaList,function(key){var conjunctiveCondn;conjunctiveCondn=0===key?"AND":$(this).find("#operatorSelection").val();var formComponentID=$(this).find('[iscrtfc="true"]').attr("fcid"),pfcid=$(this).find('[iscrtfc="true"]').attr("pfcid"),operator=$(this).find("[isopr='true']").val();if("-1"!==formComponentID&&"-1"!==operator){var crtValue=$(this).find("#txtValue").val(),txtValueAttr=$(this).find("#txtValue").attr("disabled"),trObj=$(this).find("#txtValue").parent().parent(),fcObj=ZPNewView.allComponents[formComponentID+""];if(-1!=pfcid&&(fcObj=ZPNewView.allComponents[pfcid+""].childComponents[formComponentID+""]),Timetracker.views.isTimetrackerSpecialFields(fcObj.tName,fcObj.labelName)){var valueJson=Timetracker.views.getValueForField(fcObj.labelName,operator);crtValue=valueJson.value,operator=valueJson.operator}var fcType=fcObj.fcType,formulaDType=fcObj.formulaDType;if(fcType==ZPForm.Field.SCRIPT&&void 0!=formulaDType&&-1!=formulaDType&&(fcType=formulaDType),operator!=ZPNewView.OPERATORS.EMPTY&&operator!=ZPNewView.OPERATORS.NOT_EMPTY&&operator!=ZPNewView.OPERATORS.YESTERDAY&&operator!=ZPNewView.OPERATORS.TODAY&&operator!=ZPNewView.OPERATORS.TOMORROW&&operator!=ZPNewView.OPERATORS.LAST_YEAR&&operator!=ZPNewView.OPERATORS.CURRENT_YEAR&&operator!=ZPNewView.OPERATORS.NEXT_YEAR&&operator!=ZPNewView.OPERATORS.LAST_MONTH&&operator!=ZPNewView.OPERATORS.THIS_MONTH&&operator!=ZPNewView.OPERATORS.NEXT_MONTH&&operator!=ZPNewView.OPERATORS.LOGIN_USERS_DEPT&&operator!=ZPNewView.OPERATORS.LOGIN_USER&&operator!=ZPNewView.OPERATORS.THIS_WEEK&&operator!=ZPNewView.OPERATORS.LAST_WEEK&&operator!=ZPNewView.OPERATORS.NEXT_WEEK&&operator!=ZPNewView.OPERATORS.TRUE&&operator!=ZPNewView.OPERATORS.FALSE&&operator!=ZPNewView.OPERATORS.LOGIN_USERS_ENTITY&&operator!=ZPNewView.OPERATORS.LOGIN_USERS_UNIT&&operator!=ZPNewView.OPERATORS.LOGIN_USERS_DIVISION&&operator!=ZPNewView.OPERATORS.SUBORDINATES_GOAL&&0==crtValue.length&&($(this).find("#zp_criteria_error").html(ZPI18N.getString("zp.invalidcriteriavalue")).show(),isValid=!1),fcType==ZPForm.Field.DATE_TIME&&(operator==ZPNewView.OPERATORS.EQUAL||operator==ZPNewView.OPERATORS.NOT_EQUAL||operator==ZPNewView.OPERATORS.GREATER_THAN||operator==ZPNewView.OPERATORS.LESS_THAN)){var dateValueSplit=crtValue.split(" ");(isValid=ZPUtil.Validation.isDate(dateValueSplit[0]))||$(this).find("#zp_criteria_error").html(ZPI18N.getString("zp.invalidcriteriavalue")).show()}if(void 0!==txtValueAttr||ZPNewView.validCriteriaValue(fcType,this,operator)||($(this).find("#zp_criteria_error").html(ZPI18N.getString("zp.invalidcriteriavalue")).show(),isValid=!1),isValid&&fcObj.isEncrypted&&fcType!=ZPForm.Field.NEW_GENDER&&fcType!=ZPForm.Field.NEW_BLOODGROUP&&operator!=ZPNewView.OPERATORS.EMPTY&&operator!=ZPNewView.OPERATORS.NOT_EMPTY&&operator!=ZPNewView.OPERATORS.EQUAL&&operator!=ZPNewView.OPERATORS.NOT_EQUAL&&($(this).find("#zp_criteria_error").html(ZPI18N.getString("zp.EncryptedCriteriaError")).show(),isValid=!1),isValid){var crt={formComponentID:formComponentID,Operator:operator,CrtVal:crtValue,conjunctiveCondn:conjunctiveCondn};if(-1!=pfcid?(crt.lookupFcId=formComponentID,crt.formComponentID=pfcid,crt.isBaseForm=!1,fcType==ZPForm.Field.LOOKUP&&(crt.lookupFcId2=fcObj.lkpFcid)):fcType==ZPForm.Field.LOOKUP&&(crt.lookupFcId=fcObj.lkpFcid,crt.isBaseForm=!0),!(fcType!=ZPForm.Field.LOOKUP&&fcType!=ZPForm.Field.PICKLIST&&fcType!=ZPForm.Field.NEW_GENDER&&fcType!=ZPForm.Field.NEW_BLOODGROUP&&fcType!=ZPForm.Field.NEW_COUNTRY||operator!=ZPNewView.OPERATORS.NOT_IN&&operator!=ZPNewView.OPERATORS.IN)){var crtValArray=[],crtID=$(trObj).attr("id"),selectedRecords=ZPNewView.crtSelectedRecords[crtID],selectionRecords=ZPNewView.crtSelectionRecords[formComponentID];void 0==selectedRecords||void 0==selectionRecords||selectedRecords.length<=0?($(this).find("#zp_criteria_error").html(ZPI18N.getString("zp.invalidcriteriavalue")).show(),isValid=!1):($.each(selectedRecords,function(key,value){$.each(selectionRecords,function(k,v){value===v.ID+""&&crtValArray.push(v.VALUE)})}),crt.dispVal=crtValArray.toString(),crt.CrtVal=selectedRecords)}crtJson.push(crt)}else isValidCrt=!1}}),isFirstErrMsg&&!isValidCrt){var bodyHeight=Layout.Page.container.find(".modal-body").find(".PL30.PR30").height();Layout.Page.container.find(".modal-body").scrollTop(bodyHeight+100),isFirstErrMsg=!1}if(isValid){var formID=ZPView.CURR_VIEWPARAMS.formId,params={mode:void 0!==isUpdate&&isUpdate?"updateView":"saveView",formID:formID,viewID:void 0!==isUpdate&&isUpdate?ZPNewView.localValues.viewID:0,expressionID:void 0!==isUpdate&&isUpdate?ZPNewView.localValues.expressionID:0,reportPermissionID:void 0!==isUpdate&&isUpdate?ZPNewView.localValues.reportPermissionID:0,viewName:customViewName,isDefaultView:isDefault,show_approver:show_approver,crtJson:JSON.stringify(crtJson),components:JSON.stringify(selectedColumnsJsonObj),shareViewToAll:shareToAll,specificView:JSON.stringify(specificView)};Layout.Page.container.find(".modal-footer").find("#zp_modal_blubtn").attr("disabled",!0),ZPeople.Request.send("/createViewAction.zp",params,ZPNewView.afterSaveAction)}},afterSaveAction:function(data){if(Layout.Page.container.find(".modal-footer").find("#zp_modal_blubtn").prop("disabled",!1),void 0===data.error)if(data.viewDetails.isSuccess||data.viewDetails.isValidCriteria){ZPNewView.LASTVIEWID=data.viewDetails.viewId;var mdata=ZPeople.Module.getData(),viewDetails=mdata.viewDetails.message;if("true"===data.viewDetails.isDefaultView&&$.each(viewDetails,function(key,value){this.isDefaultView=!1}),"ADD"===data.action){var newObj={displayName:data.viewDetails.displayName,isDefaultView:"true"===data.viewDetails.isDefaultView,viewId:data.viewDetails.viewId,viewType:data.viewDetails.viewType,viewName:data.viewName,isCustomView:"true"===data.viewDetails.isCustomView,isSharedView:"true"===data.viewDetails.isSharedView,ownerId:data.viewDetails.ownerId};mdata.viewDetails.message.push(newObj)}else{var oldViewObj=ZPNewView.getViewDetailByID(data.viewDetails.viewId);if(void 0!==oldViewObj){var index=mdata.viewDetails.message.indexOf(oldViewObj);mdata.viewDetails.message.splice(index,1),oldViewObj.displayName=data.viewDetails.displayName,"true"===data.viewDetails.isDefaultView?oldViewObj.isDefaultView=!0:oldViewObj.isDefaultView=!1,"true"===data.viewDetails.isCustomView?oldViewObj.isCustomView=!0:oldViewObj.isCustomView=!1,"true"===data.viewDetails.isSharedView?oldViewObj.isSharedView=!0:oldViewObj.isSharedView=!1,mdata.viewDetails.message.push(oldViewObj)}}mdata.viewDetails.loaded=!1,ZPView.constructViews();var extOptions=Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2().find("option");extOptions.length>3?Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2("destroy").html(extOptions).select2().select2("val",[ZPNewView.LASTVIEWID]):Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2("destroy").html(extOptions).select2({minimumResultsForSearch:1/0}).select2("val",[ZPNewView.LASTVIEWID]),Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").trigger("change"),ZPeople.BSModal.hide()}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.invalidentries"));else ZPNewView.showErrorMessage(data,"zp.addmodifyerror")},afterDeleteAction:function(data){if(void 0===data.error){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.viewdeletedsuccess")),ZPNewView.LASTVIEWID=data.defaultViewID,Layout.UrlConf.isModuleForm()&&(ZPNewView.LASTVIEWID="systemview");for(var extOptions=Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2().find("option"),newOptions="",i=0;i<extOptions.length;i++)extOptions[i].value!==data.deletedViewID&&(newOptions+='<option value="'+extOptions[i].value+'">'+extOptions[i].text+"</option>");var oldViewObj=ZPNewView.getViewDetailByID(data.deletedViewID);if(void 0!==oldViewObj){var mdata=ZPeople.Module.getData(),index=mdata.viewDetails.message.indexOf(oldViewObj);mdata.viewDetails.message.splice(index,1)}extOptions.length-1>3?Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2("destroy").html(newOptions).select2().select2("val",[ZPNewView.LASTVIEWID]):Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2("destroy").html(newOptions).select2({minimumResultsForSearch:1/0}).select2("val",[ZPNewView.LASTVIEWID]),Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").trigger("change"),window.location.href=ZPView.getURL(ZPNewView.LASTVIEWID)}else ZPNewView.showErrorMessage(data,"zp.errordeleteview")},sharedTo:function(){var selectedUsers=ZPNewView.LAYOUT.find("#zp_custom_view_selected_users").is(":checked"),shareToDiv=ZPNewView.LAYOUT.find("#zp_custom_view_sharedto");if(selectedUsers){if(shareToDiv.removeClass("DN"),null===ZPNewView.pickListComponent){var sharedTempTxt=$(ZPPickList.picklistComponentTemplate);ZPNewView.LAYOUT.find("#applicableToComponent").html(sharedTempTxt);var keys=[];keys.push(ZPPickList.CONSTANTS.USERS),keys.push(ZPPickList.CONSTANTS.DEPARTMENTS),keys.push(ZPPickList.CONSTANTS.ROLES),keys.push(ZPPickList.CONSTANTS.LOCATIONS),ZPNewView.pickListComponent=ZPPickList.init(keys)}ZPNewView.LAYOUT.find("#applicableToComponent").html(ZPNewView.pickListComponent),ZPNewView.LAYOUT.find("#applicableToComponent").find("#pickListComp").find(".dropdown-menu").addClass("ZPSchPoP")}else shareToDiv.addClass("DN")},loadCrtRequiredRecords:function(fcID,fcType){void 0===ZPNewView.crtSelectionRecords[fcID]&&void 0!==fcID&&$.ajax({type:"POST",async:!1,url:"/createViewAction.zp",data:{mode:"getLookupList",conreqcsr:csrfToken,selectedLookupType:fcID,fcType:fcType},success:function(data){ZPNewView.crtSelectionRecords[fcID]=data.lookupDetailsList}})},constructCrtSelectionRecord:function(crtID,selectionRecord,fcType,fcId){if(jQuery.isEmptyObject(selectionRecord)||selectionRecord.length<=0)ZPNewView.LAYOUT.find("#"+crtID+" #ulList").html(ZPI18N.getString("zp.norec"));else{var li="";$.each(selectionRecord,function(key,value){li+="<li id='"+value.ID+"'><div class='MT3'><label class='checkbox DIB PT8 MR10'><input id='"+value.ID+"' type='checkbox' onclick='ZPNewView.crtSelectRecord(this)'><span class='ML2'>"+value.DISPVALUE+"</span></label></div></li>"}),ZPNewView.LAYOUT.find("#"+crtID+" #ulList").html(li)}},crtAllCheckSelect:function(obj){var isAllChecked=$(obj).is(":checked"),childList=$(obj).parent().parent().parent().find("#ulList").children(),childLength=childList.length;isAllChecked?childLength>0?($.each(childList,function(key,value){$(this).find("input")[0].checked=!0,ZPNewView.crtSelectRecord($(this).find("input"))}),$(obj)[0].checked=!0):$(obj).prop("checked",!1):childLength>0&&$.each(childList,function(key,value){$(this).find('.checkbox input[type="checkbox"]').prop("checked",!1),ZPNewView.crtSelectRecord($(this).find("input"))})},crtSelectRecord:function(obj){var isChecked=$(obj).is(":checked"),tr=$(obj).parent().parent().parent().parent().parent().parent().parent().parent().parent().parent().parent().parent().parent(),inp=tr.find('[iscrtfc="true"]'),pfcid=inp.attr("pfcid"),fcid=inp.attr("fcid"),fcObj=ZPNewView.allComponents[fcid+""];-1!=pfcid&&(fcObj=ZPNewView.allComponents[pfcid+""].childComponents[fcid+""]);var fcType=fcObj.fcType;if($(tr).find("#crtAllCheck").is(":checked"))$(tr).find("#crtAllCheck").prop("checked",!1);else{var childList=$(tr).find("#ulList").children();childList.length===childList.find(".checkbox input[type='checkbox']:checked").length&&($(tr).find("#crtAllCheck")[0].checked=!0)}var crtID=$(tr).attr("id"),selectedRecords=ZPNewView.crtSelectedRecords[crtID];void 0===selectedRecords&&(selectedRecords=[]);var id=$(obj).attr("id"),index=selectedRecords.indexOf(id);isChecked?-1===index&&selectedRecords.push(id):-1!==index&&selectedRecords.splice(index,1),ZPNewView.crtSelectedRecords[crtID]=selectedRecords,ZPNewView.displayCrtTxt(crtID,fcType)},displayCrtTxt:function(crtID,fcType){ZPNewView.LAYOUT.find("#"+crtID).find("#crtValueTD #txtValue").val(void 0);var fcID=ZPNewView.LAYOUT.find("#"+crtID).find('[iscrtfc="true"]').attr("fcid"),nameArr=ZPNewView.getRecordNamesByFcID(crtID,fcID,fcType);ZPNewView.LAYOUT.find("#"+crtID).find("#crtValueTD #txtValue").val(nameArr.toString())},getRecordNamesByFcID:function(crtID,fcID,fcType){if(void 0===fcID)return null;var selectedRecords=ZPNewView.crtSelectedRecords[crtID],selectionRecords=ZPNewView.crtSelectionRecords[fcID],tempList=[];return void 0===selectedRecords||void 0===selectionRecords?tempList:($.each(selectedRecords,function(key,value){$.each(selectionRecords,function(k,v){value===v.ID+""&&tempList.push(ZPeople.decodeTxt(v.DISPVALUE))})}),tempList)},makeSelectable:function(crtID,selectedRecord){ZPNewView.LAYOUT.find("#"+crtID).find("#crtAllCheck").prop("checked",!1);var fcID=ZPNewView.LAYOUT.find("#"+crtID).find('[iscrtfc="true"]').attr("fcid"),childList=ZPNewView.LAYOUT.find("#"+crtID).find("#ulList").children(),originalTotalLength=ZPNewView.crtSelectionRecords[fcID].length;if(!(originalTotalLength<=0)){selectedRecord.length===originalTotalLength&&(ZPNewView.LAYOUT.find("#"+crtID).find("#crtAllCheck")[0].checked=!0),$.each(selectedRecord,function(key,value){var row=$(childList).find("input#"+value);void 0!==row&&row.length>0&&(row[0].checked=!0)});var checkBoxSelectedCount=ZPNewView.LAYOUT.find("#"+crtID).find("#ulList").children("li").find("input[type='checkbox']:checked").length,currChildlength=$(childList).length;0===checkBoxSelectedCount&&0===currChildlength?ZPNewView.LAYOUT.find("#"+crtID).find("#crtAllCheck").prop("checked",!1):checkBoxSelectedCount===currChildlength?ZPNewView.LAYOUT.find("#"+crtID).find("#crtAllCheck")[0].checked=!0:ZPNewView.LAYOUT.find("#"+crtID).find("#crtAllCheck").prop("checked",!1)}},getViewDetailByID:function(viewID){var viewDetailObj=void 0;return $.each(ZPeople.Module.getData().viewDetails.message,function(key,value){value.viewId!==viewID||(viewDetailObj=value)}),viewDetailObj},showErrorMessage:function(data,msg){void 0!==data.error&&(void 0!==data.error.message?ZPeople.Message.showFailureMsg(data.error.message):void 0!==data.error.exception&&ZPeople.Message.showFailureMsg(ZPI18N.getString(msg)))},getParentCompNameByID:function(parentFCID){var name=void 0;return void 0!==parentFCID&&"0"!==parentFCID&&(name=ZPNewView.headerComponents[parentFCID+""].formCompName),name},getOriginalName:function(fcID){var name=void 0;if(void 0!==fcID)if(-1!==fcID.indexOf("_")){var ids=fcID.split("_");name=ZPNewView.allComponents[ids[0]].childComponents[ids[1]].formCompName}else name=ZPNewView.allComponents[fcID].formCompName;return name},isEqual:function(obj1,obj2){return obj1===obj2}},ValidationRule={baseFCs:{},ruleGroupTemplate:'<div class="panel-group dvvalidruleacc" id="dvValidruleparent">$RULECONSTRUCT$</div>',errorTemplate:'<div class="dverrormsg DN" errorid="errorDiv"></div>',ruleHeaderTemplate:'<div class="panel clearfix" name="singleRuleDiv"><a name="deleteIcon" class="IC-delete gry FR lnkcls" onclick="ValidationRule.deleteRule({}, {forPost:true}, {obj:this})"></a><div name="ruleToggleDiv" class="GryBG panel-heading PT5 PL10 PB3" data-parent="#dvValidruleparent" data-target="#dvRule$COUNT$" ruleid="$RULEID$" onclick="ZPFRules.collapseElement(this)"><h6 class="ZPbold S16">'+ZPI18N.getString("zp.rule")+' $COUNT$</h6></div><div id="dvRule$COUNT$" class="panel panel-collapse collapse"><div class="basefield spnpostxt" baseid="" id="$RULEID$"><label>BASE FC</label>$SELECTBOX$</div><div ruleid="$RULEID$" actionid="$ACTIONID$" class="col-md-12"><div class="dvCriteria clearfix dvfrmaddrule MT35"><div class="clearfix PB5"></div>$RULEDIV$</div><div class="dverrormsg DN" errorid="errorDiv"></div></div></div></div>',ruleBaseFCTemplate:'<div class="form-group" id="$RULEID$"><label>BASE FC</label>$SELECTBOX$</div>',selectTemplate:'<select $DISABLED$ class="selectBox" keyname="$KEYNAME$" onchange="$METHOD$" $MULTIPLE$>$OPTIONS$</select>',ruleConditionTemplate:'<div class="form-group $CLASS$" id="$ID$" name="$NAME$" key="$KEY$">$CONDITION$</div>',addRemoveTemplate:'<div class="form-group col-md-1" name="addRemoveDiv"><div class="dvlist-action MT8"><a class="IC-plus-big S12 MR15 gry" onclick="ZPFRules.addDeleteCondition(this, true)"></a><a class="IC-mins gry S12" onclick="ZPFRules.addDeleteCondition(this, false)"></a></div></div>',optionsTemplate:'<div class="tabvertical tabselect DN" id="conditionDropdownSelection"><div class="rhttablst"><div class="dvPopsearch"><input class="form-control" onkeyup="ZPFRules.searchOptions(this)" type="search" placeholder="'+ZPI18N.getString("zp.search")+'..."></div><ul class="list-group ulRecipient" role="tablist" id="listBody">$LIST$</ul></div></div>',liTemplate:'<li name="list-group-item" class="$CLASS$" onclick="ZPFRules.conditionSelectRecord(this)"><span data-toggle="tab" role="tab" name="mOpt" id="$LISTID$">$LISTVALUE$</span></li>',andorTemplate:'<div class="form-group col-md-12 ML15" key="conjunctiveCondn" name="operatorDiv" rulenum="$NUM$"><div class="input-group"><select class="selectBox" keyname="conjunctiveCondn" onchange="ValidationRule.updateOperatorPattern(this,$IND$)"><option $ANDSELECTED$ value="and">'+ZPI18N.getString("zp.captialand")+'</option><option $ORSELECTED$ value="or">'+ZPI18N.getString("zp.captialor")+"</option></select></div></div>",RULE_DETAILS:{},addRuleMethod:"addUpdate",fetchRule:"fetchRule",deleteRule:"deleteRule",ruleUrl:"/validationRules.zp",formid:"",selectOperator:{},validationType:1,validationTypes:{FORM:1,BLUEPRINT:2}},ValidationRule.validationKeys={fcid:"formComponentID",operator:"Operator",value:"CrtVal",conjunctiveCondn:"conjunctiveCondn"},ValidationRule.selectOperator[ZPNewView.OPERATORS.NOT_EQUAL]=ZPNewView.OPERATORS.NOT_IN,ValidationRule.selectOperator[ZPNewView.OPERATORS.EQUAL]=ZPNewView.OPERATORS.IN,ValidationRule.selectOperator[ZPNewView.OPERATORS.NOT_IN]=ZPNewView.OPERATORS.NOT_EQUAL,ValidationRule.selectOperator[ZPNewView.OPERATORS.IN]=ZPNewView.OPERATORS.EQUAL,ValidationRule.addRule=function(formId,validationType){if(ValidationRule.validationType=void 0!=validationType?validationType:1,ValidationRule.formid=formId,void 0==ZPForm.FORM_COMPONENT_DATA[formId])ZPFRules.getFormComponents({},{},{forPost:!0,formId:formId,isValidation:!0});else{var fc=ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails;if(1==fc.length&&0==fc[0].column1.length&&0==fc[0].column2.length){var ruleDiv=ZPeople.createModalPopup("rule",ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName]),"popRgtModel PopMdModel modal-right"),emptyFormDiv='<div class="col-lg-12 text-center"><div id="zp_views_norecclass" class="PArds"></div><h2 id="zp_nodata" class="ZPNdt">'+ZPI18N.getString("zp.emptyform")+"</h2></div>";$(ruleDiv).find("#bodyTag").html(emptyFormDiv)}else ValidationRule.validationType==ValidationRule.validationTypes.BLUEPRINT?Blueprint.Validation.rulesConstruction(formId,Blueprint.currentValidationJson):void 0==ValidationRule.RULE_DETAILS[formId]?ValidationRule.getRuleDetails({},{},{forPost:!0,formId:formId}):(ValidationRule.baseFCs[formId]=[],ValidationRule.rulesConstruction(formId))}},ValidationRule.getRuleDetails=function(data,params,others){others.hasOwnProperty("forPost")?(delete others.forPost,ZPeople.Request.send(ValidationRule.ruleUrl,{method:ValidationRule.fetchRule,formId:others.formId},ValidationRule.getRuleDetails,others)):(void 0!=data&&data.hasOwnProperty("rulesJson")?ValidationRule.RULE_DETAILS[params.formId]=data.rulesJson:ValidationRule.RULE_DETAILS[params.formId]={},ValidationRule.baseFCs[params.formId]=[],ValidationRule.rulesConstruction(params.formId))},ValidationRule.rulesConstruction=function(formId,validationJson){var ruleDiv=ZPeople.createModalPopup("validationrule",ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName]),"popRgtModel PopMdModel modal-right");$(ruleDiv).find("[buttonname=done]").html(ZPI18N.getString("zp.save")),$(ruleDiv).find("[buttonname=done]").siblings("[buttonaction]").html(ZPI18N.getString("zp.close")),$(ruleDiv).find("[buttonname=done]").unbind(),$(ruleDiv).find("[buttonname=done]").click(function(){ValidationRule.ruleCreation(this)}),0==$(ruleDiv).find("#addRule").length&&ValidationRule.validationType!=ValidationRule.validationTypes.BLUEPRINT&&$('<a class="btn btn-default btnaddrule" id="addRule" onclick="ValidationRule.addNewRule(this)">'+ZPI18N.getString("zp.addrule")+"</a>").insertAfter($(ruleDiv).find("[buttonaction]").first()),$(ruleDiv).find("#bodyTag").attr("formId",formId);var ruleHtml="";if(void 0!=validationJson?(ZPFRules.count=1,ruleHtml+=ValidationRule.singleRuleAdd(formId,validationJson)):ValidationRule.RULE_DETAILS[formId].length>0?$.each(ValidationRule.RULE_DETAILS[formId],function(index,rule){ZPFRules.count=parseInt(index)+1,ruleHtml+=ValidationRule.singleRuleAdd(formId,rule)}):(ZPFRules.count=1,ruleHtml=ValidationRule.singleRuleAdd(formId,{})),""==ruleHtml){var emptyFormDiv='<div class="col-lg-12 text-center"><div id="zp_views_norecclass" class="PArds"></div><h2 id="zp_nodata" class="ZPNdt">'+ZPI18N.getString("zp.emptyform")+"</h2></div>";$(ruleDiv).find("h4").replaceWith('<h6 class="modal-title S16">'+ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName])+"</h6>"),$(ruleDiv).find("#bodyTag").html(emptyFormDiv)}else{var ruleGrp=ValidationRule.ruleGroupTemplate;ruleGrp=ruleGrp.replace(/\$RULECONSTRUCT\$/g,ruleHtml),$(ruleDiv).find("#bodyTag").html(ruleGrp),$(ruleDiv).find("[makeEmpty=true]").val(""),$(ruleDiv).find("#dvRule1").addClass("fade in"),$(ruleDiv).find("h4").replaceWith('<h6 class="modal-title S16">'+ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName])+"</h6>"),$(ruleDiv).find("select").select2()}},ValidationRule.singleRuleAdd=function(formId,rule){var mainDiv=ValidationRule.ruleHeaderTemplate;mainDiv=mainDiv.replace(/\$COUNT\$/g,ZPFRules.count);var ruleId=void 0!=rule&&rule.hasOwnProperty("VALIDATION_RULE_ID")?rule.VALIDATION_RULE_ID:"";mainDiv=mainDiv.replace(/\$RULEID\$/g,ruleId);var ruleDiv='<div class="clearfix">';fields=ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails;var others={fields:fields,formId:formId};void 0!=rule&&Object.keys(rule).length>0&&(others.fieldArray=[rule.BASE_FCID],others.disabled=!0),others.firstFieldFix=!0,selDiv=ValidationRule.addFieldsForSelect(others.fields,others),ruleDiv=ruleDiv.replace("$SELECTBOX$",selDiv),mainDiv=mainDiv.replace("$SELECTBOX$",selDiv);var fcId=ZPFRules.findFirstFcId(fields,formId,ZPForm.FORM_COMPONENT_DATA[formId].formDetails.tableName),conditionArray=rule.hasOwnProperty("baseConditions")?rule.baseConditions:ValidationRule.validationType==ValidationRule.validationTypes.BLUEPRINT?[{formComponentID:rule.BASE_FCID}]:[{formComponentID:fcId}];return $.each(conditionArray,function(index,condition){mainDiv=mainDiv.replace(/\$ACTIONID\$/g,condition.hasOwnProperty("VALIDATION_ACTION_ID")?condition.VALIDATION_ACTION_ID:""),ruleDiv+='<div class="form-group spnpostxt" name="vmsg"><label>Validation Message</label><input id="message" type="text" class="form-control DIB" value="'+(void 0!=condition.VALIDATION_MSG?condition.VALIDATION_MSG:"")+'"/>'+ZPFRules.errorTemplate+"</div>",ruleDiv+=ValidationRule.constructConditions(condition,fcId,formId,others);var DN="DN";val="",condition.hasOwnProperty("PATTERNTEXT")&&""!=condition.PATTERNTEXT.trim()&&(DN="",val=condition.PATTERNTEXT),ruleDiv+='<div class="col-md-7 ML35 PL100 '+DN+'" id="patternDiv"><input value="'+val+'" class="col-md-5" type="text"/><input class="col-md-2 FR"  type="button" onclick="ValidationRule.validatePattern(this)" value="Save"/></div>',ruleDiv+='<div class="dverrormsg DN form-group col-md-7 ML15" errorid="errorDiv"></div>'}),""==ruleDiv?ruleDiv:(ruleDiv+="</div>",mainDiv=mainDiv.replace(/\$RULEDIV\$/g,ruleDiv))},ValidationRule.addFieldsForSelect=function(fields,others){var selectDiv=ValidationRule.selectTemplate;selectDiv=(selectDiv=(selectDiv=(selectDiv=selectDiv.replace(/\$METHOD\$/g,"ValidationRule.updateFirstField(this)")).replace(/\$KEYNAME\$/g,"BASE_FCID")).replace(/\$MULTIPLE\$/g,others.hasOwnProperty("multiple")?"multiple":"")).replace(/\$DISABLED\$/g,others.disabled?"disabled":"");var options="",actionArray=ValidationRule.baseFCs[others.formId],formTableName=ZPForm.FORM_COMPONENT_DATA[others.formId].formDetails.tableName;return $.each(fields,function(index1,section){options+="<optgroup label="+section.sectionName+" secid="+section.sectionId+">",$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){if(void 0!=field&&!ZPUtil.checkIsExistInArray(actionArray,field.formComponentId)&&!section.isTabular&&ZPFRules.isFieldAllowed(!0,field,others.fieldArray,formTableName,actionArray)){!1;var selected=$.inArray(field.formComponentId,others.fieldArray)>-1?"selected":"";options+='<option value="'+field.formComponentId+'" '+selected+">"+field.displayName+"</option>"}})}),options+="</optgroup>"}),selectDiv=selectDiv.replace(/\$OPTIONS\$/g,options)},ValidationRule.constructPatternAdd=function(parentDiv,addInd,addOperator){var patternText=parentDiv.find("#patternDiv input").first().val();if((patternText=patternText.replace(/\s/g,"")).length>0){if((patternText="("+patternText).indexOf(addInd)>-1){var indexValue=(patternText=patternText.replace(/[\d]/g,function(match){return parseInt(match)>=addInd?parseInt(match)+1:parseInt(match)})).indexOf(addInd-1)+(addInd-1).toString().length,updateSubStr=patternText.substr(indexValue);patternText=patternText.substr(0,patternText.indexOf(addInd-1)+1),patternText+=addOperator+addInd+")"+updateSubStr}else patternText+=addOperator+addInd+")";patternText=(patternText=patternText.replace(/and/g," and ")).replace(/or/g," or ")}else patternText="(1 and 2)";parentDiv.find("#patternDiv input").first().val(patternText)},ValidationRule.constructPatternDelete=function(parentDiv,deleteInd,deleteOperator){var patternText=parentDiv.find("#patternDiv input").first().val(),updateSubStr=(patternText=patternText.replace(/\s/g,"")).split(deleteInd)[0],firstInd=patternText.indexOf(deleteInd)+1;if(deleteInd>1){var delOpInd=updateSubStr.lastIndexOf(deleteOperator);patternText=(patternText=(updateSubStr=updateSubStr.substr(0,delOpInd)+updateSubStr.substr(delOpInd+deleteOperator.length))+patternText.substr(firstInd)).replace("()","")}else patternText=(patternText=updateSubStr+patternText.substr(firstInd).replace(deleteOperator,"")).replace("()","");patternText=patternText.replace(/[\d]/g,function(match){return parseInt(match)>deleteInd?parseInt(match)-1:parseInt(match)}),parentDiv.find("#patternDiv input").first().val(patternText)},ValidationRule.updateOperatorPattern=function(obj){var parentDiv=$(obj).parents("#bodyTag").find("[id*=dvRule]:visible"),updateInd=parseInt($(obj).parents("[name=operatorDiv]").next("#criteriaInd").attr("ind")),patternText=parentDiv.find("#patternDiv input").first().val();if((patternText=patternText.replace(/\s/g,"")).length>0){var subStr=patternText.substr(0,patternText.indexOf(updateInd)),prevOperator="and"===$(obj).val()?"or":"and",ind=subStr.lastIndexOf(prevOperator),finalText=subStr.substr(0,ind);finalText+=subStr.substr(ind).replace(prevOperator,$(obj).val()),finalText=(finalText=(finalText+=patternText.substr(patternText.indexOf(updateInd))).replace(/and/g," and ")).replace(/or/g," or "),parentDiv.find("#patternDiv input").first().val(finalText)}},ValidationRule.validatePattern=function(obj){var parentDiv=$(obj).parents("#bodyTag").find("[id*=dvRule]:visible");parentDiv.find("[id*=dvRule]").children("[errorid=errorDiv]").html(""),parentDiv.find("[id*=dvRule]").children("[errorid=errorDiv]").show();var patternText=parentDiv.find("#patternDiv input").first().val(),errorMsg="";if((patternText=patternText.replace(/\s/g,"")).match(/\(/g).length!=patternText.match(/\)/g).length)return errorMsg="Pattern brackets do not match",parentDiv.find("#dvRule1").children("[errorid=errorDiv]").html(errorMsg),!0;var invalid_number,lastInd=parseInt(parentDiv.find("[id=criteriaInd]").last().attr("ind"));for(presentNumbers=patternText.match(new RegExp(/\d/g)),numind=0;numind<presentNumbers.length;numind++)if(presentNumbers[numind]>lastInd){invalid_number=presentNumbers[numind];break}if(void 0!=invalid_number)return errorMsg="Please check the pattern at "+patternDiv.match(invalid_number),parentDiv.find("#dvRule1").children("[errorid=errorDiv]").html(errorMsg),!0;for(var ind=0,numberMatch=patternText.match(/[\d]/g);ind<numberMatch.length;)if(ind+1!=numberMatch[ind++])return errorMsg="Please check the pattern at "+numberMatch[ind-1],parentDiv.find("#dvRule1").children("[errorid=errorDiv]").html(errorMsg),!0;var totalCriterias=parentDiv.find("[id=criteriaInd]").length,operMatch=patternText.match(/and|or/g);if(numberMatch.length!=totalCriterias||operMatch.length!=totalCriterias-1)return errorMsg="The Criteria Pattern does not match the conditions you've chosen.",parentDiv.find("#dvRule1").children("[errorid=errorDiv]").html(errorMsg),!0;for(ind=0;ind<operMatch.length;)parentDiv.find("[name=operatorDiv]").eq(ind).find("select").val(operMatch[ind++]).select2()},ValidationRule.ruleCreation=function(obj){var parentDiv=$(obj).parents("#validationrule").find("#bodyTag [id*=dvRule]:visible");""==parentDiv.find("#message").val().trim()?(hasError=!0,parentDiv.find("[name=vmsg] [errorid=errorDiv]").html(ZPI18N.getString("zp.entervalueforcondn")),parentDiv.find("[name=vmsg] [errorid=errorDiv]").show()):hasError=ZPFRules.validateRuleDiv(parentDiv);var baseFC=parentDiv.find("[baseid] select[keyname=BASE_FCID]").val();if(!hasError&&parentDiv.find("#patternDiv").is(":visible")&&(hasError=ValidationRule.validatePattern(Layout.Page.container.find("#patternDiv input[type=button]"))),!hasError){var validationJson={VALIDATION_MSG:parentDiv.find("#message").val(),VALIDATIONTYPE:ValidationRule.validationType},patternText=parentDiv.find("#patternDiv input").first().val();patternText=patternText.replace(/\s/g,"");for(;null!=patternText.match(/\(/g);){var replaceText="$"+patternText.match(/\(/g).length+"$-",lastInd=patternText.lastIndexOf("("),finalText=patternText.substr(lastInd+1),firstInd=finalText.indexOf(")");finalText=finalText.substr(0,firstInd)+replaceText+finalText.substr(firstInd+1),patternText=patternText.substr(0,lastInd)+replaceText+finalText}patternText=parentDiv.find("[id=criteriaInd]").length>1?ValidationRule.removeDummyBrackets(patternText):"1",validationJson.secondaryConditions=ValidationRule.constructSec(patternText,parentDiv),void 0!=parentDiv.find("[ruleid]").attr("actionid")&&""!=parentDiv.find("[ruleid]").attr("actionid").trim()&&(validationJson.VALIDATION_ACTION_ID=parentDiv.find("[ruleid]").attr("actionid")),validationJson.PATTERNTEXT=patternText.trim().length>1?ValidationRule.convertToBrackets(patternText):"",parentDiv.find("#patternDiv input[type=text]").val(validationJson.PATTERNTEXT);var validationsJson={BASE_FCID:baseFC,baseConditions:[validationJson]};void 0!=parentDiv.find("[ruleid]").attr("ruleid")&&""!=parentDiv.find("[ruleid]").attr("ruleid").trim()&&(validationsJson.VALIDATION_RULE_ID=parentDiv.find("[ruleid]").attr("ruleid")),validationsJson.VALIDATIONTYPE=ValidationRule.validationType,ZPeople.Request.send(ValidationRule.ruleUrl,{method:ValidationRule.addRuleMethod,validationJson:JSON.stringify(validationsJson),formId:$(obj).parents("#validationrule").find("#bodyTag").attr("formid")},ValidationRule.handleResponse)}},ValidationRule.handleResponse=function(data,params){if(data.hasOwnProperty("message")&&data.message==zpconst.CommonMessages.SUCCESSMSG){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful"));var ruleID=data.validationJson.VALIDATION_RULE_ID,index=ZPFRules.findObject(ValidationRule.RULE_DETAILS[params.formId],"VALIDATION_RULE_ID",ruleID,"index").index;void 0==index&&(index=ValidationRule.RULE_DETAILS[params.formId].length),ValidationRule.RULE_DETAILS[params.formId][index]=data.validationJson,ZPFRules.count=++index;var ruleHTml=$(ValidationRule.singleRuleAdd(params.formId,data.validationJson));ruleHTml.find("select").select2(),Layout.Page.container.find("#dvValidruleparent #dvRule"+index).parents("[name=singleRuleDiv]").replaceWith(ruleHTml),Layout.Page.container.find("#dvValidruleparent #dvRule"+index).parents("[name=singleRuleDiv]").find("[name=ruleToggleDiv]").click()}},ValidationRule.constructJson=function(crInd,parentDiv,json,others){parentDiv.find("[rulenum="+crInd+"]").each(function(){var keyname=$(this).attr("key"),keyval=$(this).find("[keyname] input,select[keyname]").val();if(json.hasOwnProperty(keyname)||(json[keyname]=keyval),keyname==ValidationRule.validationKeys.operator&&$.inArray(parseInt(keyval),[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1){var field=ZPForm.Field.getFieldComponent(json[ValidationRule.validationKeys.fcid],ValidationRule.formid);if(field.fieldType==ZPForm.Field.PICKLIST||field.fieldType==ZPForm.Field.LOOKUP){json[keyname]=ValidationRule.selectOperator[keyval],json.dispVal=$(this).next("#fieldValue").find("input#fieldValue").val();var valArr=[];$(this).next("#fieldValue").find("#conditionDropdownSelection #listBody li.sel").each(function(){valArr.push($(this).find("span").attr("id"))}),json[ValidationRule.validationKeys.value]=JSON.stringify(valArr),field.fieldType==ZPForm.Field.LOOKUP&&(json.lookupFcId=field.referredfcId,json.isBaseForm=!0)}}})},ValidationRule.constructSec=function(patternText,parentDiv){var subArr=[],secArr=[];if(null!=patternText.match(/\$[\d]+\$-/g)){var firstBr=patternText.match(/\$[\d]+\$-/g)[0],firstBrLen=patternText.match(/\$[\d]+\$-/g)[0].length;0==patternText.indexOf(firstBr)&&patternText.lastIndexOf(firstBr)==patternText.length-firstBrLen&&(patternText=patternText.substr(firstBrLen,patternText.length-2*firstBrLen))}if(patternText.trim().length>0)if(null!=patternText.match(/\$[\d]+\$-/g)){var halfText,substr=patternText.match(/\$[\d]+\$-/g)[0],stInd=patternText.indexOf(substr),endInd=patternText.lastIndexOf(substr),subLen=substr.length,arrInd=0;if(stInd>0)if(null!=(criterias=(halfText=patternText.substr(0,stInd)).match(/[\d]/g)))for(var cInd=0;cInd<criterias.length;){var criteria=criterias[cInd++],crJson={};ValidationRule.constructJson(criteria,parentDiv,crJson),secArr[arrInd++]=crJson}if(subArr=ValidationRule.constructSec(patternText.substr(stInd+subLen,endInd-stInd-subLen),parentDiv),Object.keys(subArr).length>0&&(secArr[arrInd++]={secondaryConditions:subArr}),null!=(halfText=patternText.substr(endInd+subLen+1)).match(/\$[\d]\$-/))subArr=ValidationRule.constructSec(halfText,parentDiv),Object.keys(subArr).length>0&&(secArr[arrInd++]={secondaryConditions:subArr});else if(null!=(criterias=halfText.match(/[\d]/g)))for(cInd=0,crJson={};cInd<criterias.length;){criteria=criterias[cInd++];ValidationRule.constructJson(criteria,parentDiv,crJson),secArr[arrInd++]=crJson}}else{var criterias;arrInd=0;if(null!=(criterias=patternText.match(/[\d]/g)))for(cInd=0;cInd<criterias.length;){criteria=criterias[cInd++],crJson={};ValidationRule.constructJson(criteria,parentDiv,crJson),secArr[arrInd++]=crJson}}return secArr},ValidationRule.constructConditions=function(condition,fcId,formId,others,index,patternText){void 0==index&&(index=1),ZPFRules.count=index;var tempDiv="",ruleDiv="";if(condition.hasOwnProperty(ValidationRule.validationKeys.conjunctiveCondn)){ruleDiv+=ValidationRule.andorTemplate;var selTxt="and"==condition[ValidationRule.validationKeys.conjunctiveCondn]?"$ANDSELECTED$":"$ORSELECTED$";ruleDiv=(ruleDiv=(ruleDiv=ruleDiv.replace(selTxt,"selected")).replace(/\$[a-z]+SELECTED\$/,"")).replace(/\$(IND|NUM)\$/g,index)}if(condition.hasOwnProperty(ValidationRule.validationKeys.fcid)){if(others.fieldDtl=ZPForm.Field.getFieldComponent(condition[ValidationRule.validationKeys.fcid],formId),void 0==others.fieldDtl&&(others.fieldDtl={}),others.fieldArray=[condition[ValidationRule.validationKeys.fcid]],others.id=[condition.conditionId],others.formId=formId,tempDiv=ZPFRules.createRuleConditionFromTemplate("col-md-3 ML15","conditionFields",others,ValidationRule.validationKeys.fcid),delete others.firstFieldFix,""==tempDiv)return ruleDiv;ruleDiv+='<label name="conditionDiv" class="FL ML20 PT5" ind='+index+' id="criteriaInd">'+index+"</label>",ruleDiv+=tempDiv,others.condition=condition[ValidationRule.validationKeys.operator],ruleDiv+=ZPFRules.createRuleConditionFromTemplate("col-md-3","condition",others,ValidationRule.validationKeys.operator),others.fieldValue=condition.hasOwnProperty(ValidationRule.validationKeys.value)?condition[ValidationRule.validationKeys.value]+"":"",others.fieldValue=others.fieldValue.replace(/\[|\]|"/g,""),ruleDiv+=ZPFRules.createRuleConditionFromTemplate("col-md-4","fieldValue",others,ValidationRule.validationKeys.value),ruleDiv+=ZPFRules.addRemoveTemplate,index++,ZPFRules.count=index}if(condition.hasOwnProperty("secondaryConditions")){var sConditions=condition.secondaryConditions;$.each(sConditions,function(scInd,sCondition){ruleDiv+=ValidationRule.constructConditions(sCondition,fcId,formId,others,ZPFRules.count)})}return ruleDiv},ValidationRule.updatestaticIndex=function(patternText,totalBracket,staticInd,endInd,substr){return totalBracket=null!=patternText.match(/\$[\d]+\$-/g)?patternText.match(/\$[\d]+\$-/g).length/2:1,patternText.lastIndexOf(substr),totalBracket},ValidationRule.updateDollars=function(patternText,ind){var len=0;for(presentNumbers=patternText.match(new RegExp(/\d/g)),numind=0;numind<presentNumbers.length;numind++)presentNumbers[numind]>=ind&&len++;var dollarLen=len/2;for(dInd=0;dInd<dollarLen;dInd++){var reg=new RegExp("\\$"+(ind+1)+"\\$-","g");patternText=patternText.replace(reg,"$"+ind+++"$-")}return patternText},ValidationRule.convertToBrackets=function(patternText){new RegExp("\\$[d]+\\$-","g");for(var ind=1;null!=patternText.match(/\$[\d]+\$-/g);)patternText=(patternText=patternText.replace("$"+ind+"$-","(")).replace("$"+ind+++"$-",")");return patternText},ValidationRule.removeDummyBrackets=function(patternText){for(var staticIndex=1,totalBrackets=patternText.match(/\$[\d]+\$-/g).length/2;staticIndex<=totalBrackets;){var substr="$"+staticIndex+"$-",startIndex=patternText.indexOf(substr),endIndex=patternText.lastIndexOf(substr),nextStr="$"+ ++staticIndex+"$-",nextStart=patternText.indexOf(nextStr),substrLength=substr.length,nextStrLength=nextStr.length;if(nextStart>=0&&nextStart<endIndex)for(;nextStart<endIndex;){var nextEnd=patternText.lastIndexOf(nextStr);if(nextStart!=startIndex+substrLength||nextEnd!=endIndex-nextStrLength){if(nextStart>=0?(checkindex=staticIndex,midString=patternText.substr(nextStart+nextStrLength,nextEnd-nextStart-nextStrLength)):(checkindex=staticIndex-1,midString=patternText.substr(startIndex+substrLength,endIndex-startIndex-substrLength)),null==midString.match(/and|or/g)){regex=new RegExp("\\$"+checkindex+"\\$-","g");for(patternText=patternText.replace(regex,""),presentNumbers=patternText.match(new RegExp(/\d/g)),numind=0;numind<presentNumbers.length;numind++)if(presentNumbers[numind]==checkindex){matching=presentNumbers[numind];break}if(void 0!=matching){index=checkindex;patternText=ValidationRule.updateDollars(patternText,index)}totalBrackets=ValidationRule.updatestaticIndex(patternText,totalBrackets,endIndex,substr),nextStart=patternText.indexOf(nextStr)}break}var matching,regex=new RegExp("\\$"+staticIndex+"\\$-","g");for(patternText=patternText.replace(regex,""),presentNumbers=patternText.match(new RegExp(/\d/g)),numind=0;numind<presentNumbers.length;numind++)if(presentNumbers[numind]==staticIndex){matching=presentNumbers[numind];break}if(void 0!=matching){var index=staticIndex;patternText=ValidationRule.updateDollars(patternText,index)}totalBrackets=ValidationRule.updatestaticIndex(patternText,totalBrackets,endIndex,substr),nextStart=patternText.indexOf(nextStr)}else if(midString=patternText.substr(startIndex+substrLength,endIndex-startIndex-substrLength),null==midString.match(/and|or/g)){regex=new RegExp("\\$"+(staticIndex-1)+"\\$-","g");for(patternText=patternText.replace(regex,""),presentNumbers=patternText.match(new RegExp(/\d/g)),numind=0;numind<presentNumbers.length;numind++)if(presentNumbers[numind]==staticIndex){matching=presentNumbers[numind];break}if(void 0!=matching){index=staticIndex-1;patternText=ValidationRule.updateDollars(patternText,index)}totalBrackets=ValidationRule.updatestaticIndex(patternText,totalBrackets,endIndex,substr)}}return patternText},ValidationRule.addNewRule=function(obj){$(obj).parents("#validationrule").find("#dvValidruleparent [name=singleRuleDiv]").length;var visibleRule=$(obj).parents("#validationrule").find("#dvValidruleparent [id*=dvRule]:visible");if(0==visibleRule.length||!ZPFRules.validateRuleDiv(visibleRule)){var formId=$(obj).parents("#validationrule").find("#bodyTag").attr("formid"),cnt=$(obj).parents("#validationrule").find("#dvValidruleparent [name=singleRuleDiv]").length;ZPFRules.count=++cnt,$(obj).parents("#validationrule").find("#dvValidruleparent").append(ValidationRule.singleRuleAdd(formId,{})),$(obj).parents("#validationrule").find("#dvValidruleparent #dvRule"+cnt).parents("[name=singleRuleDiv]").find("select").select2(),$(obj).parents("#validationrule").find("#dvValidruleparent [id*=dvRule]").length>1&&$(obj).parents("#validationrule").find("#dvValidruleparent #dvRule"+cnt).siblings("[name=ruleToggleDiv]").click()}},ValidationRule.deleteRule=function(data,params,others){var isRemoved=!1;if(params.hasOwnProperty("forPost")){var ruleParent=$(others.obj).parents("[name=singleRuleDiv]");0==$(ruleParent).find("[ruleid]").length||0==$(ruleParent).find("[ruleid]").attr("ruleid").trim().length?$(ruleParent).siblings("[name=singleRuleDiv]").length>0&&($(ruleParent).remove(),isRemoved=!0):(delete(params={ruleId:$(ruleParent).find("[ruleid]").attr("ruleid"),method:"deleteRule"}).forPost,tabCustom.param=[ValidationRule.ruleUrl,params,ValidationRule.deleteRule,{obj:ruleParent}],ZPeople.confirm(null,"","Are you sure you want to delete this rule",tabCustom.deleteRequest,!1,!0))}else if("success"==data.msg.trim()){var formID=$(others.obj).parents("#bodyTag").attr("formid");$(others.obj).remove(),isRemoved=!0;var formRuleArray=ValidationRule.RULE_DETAILS[formID],index=ZPFRules.findObject(formRuleArray,"VALIDATION_RULE_ID",params.ruleId,"index").index;formRuleArray.splice(index,1),ValidationRule.RULE_DETAILS[formID]=formRuleArray,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.rulesuccessmsg",[ZPI18N.getString("zp.deletedmsg")])),""==Layout.Page.container.find("#dvValidruleparent").html().trim()?Layout.Page.container.find("#dvValidruleparent #addRule").click():Layout.Page.container.find("#validationrule:visible #bodyTag [name=ruleToggleDiv]").first().click()}else""!=data.msg.trim?ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"));isRemoved&&$.each(Layout.Page.container.find("#dvValidruleparent [name=singleRuleDiv]"),function(index,ruleDiv){0==index&&$(this).find("[name=ruleToggleDiv]").click(),$(this).find("[name=ruleToggleDiv] h6").text(ZPI18N.getString("zp.rule")+" "+(index+1));var id=$(this).find("[id*=dvRule]").attr("id");$(this).find("[name=ruleToggleDiv]").attr("data-target","#"+id.replace(/[\d]+$/,index+1)),$(this).find("[id*=dvRule]").attr("id",id.replace(/[\d]+$/,index+1))})},ValidationRule.updateFirstField=function(obj){var selectedFC=$(obj).val();$(obj).parents("[name=singleRuleDiv]").find("#conditionFields select").val(selectedFC).select2(),$(obj).parents("[name=singleRuleDiv]").find("#conditionFields select").trigger("change")};var ADMIN_VIEW="adminView";ZPServices.View={multiOrgDiv:'<div class="pp_dd" style="top: 258px; left: 526px; min-width: 148px;"><ul></ul></div>',loadDiv:'<div class="ctcell"> <div class="loader-inner line-scale"><div></div><div></div><div></div><div></div><div></div></div> </div>',closeIcnDiv:'<div class="pp-cls"></div>',assStatus:1,UnavailStatus:0,UnassSingleStatus:2,UnassMultipleStatus:3,createFrshStatus:4,ConflictStatus:5,notAddedServicetoUser:6,PEOPLEPLUSSERVICE_SERVICEUNAVAILBLEFORDADMIN:-1,PEOPLEPLUSSERVICE_SERVICENOTADDEDBYADMIN:-2,paramNames:[],paramVals:[],error:null,PeopleAccountAssaigned:!1,ResultData:null,CountryCode:"",constructHeaderButton:function(hasReference,isAgent,hasFaqList,askUsBtn,isNeedAddRec){$("#"+Layout.Page.pageId);var url=Layout.Page.hash,buttonTag="",buttonhtml="";return hasReference&&(buttonTag+='<button  id="relatedDoc">'+ZPI18N.getString("zp.knowledgebase")+"</button>",buttonhtml+='<button  class="zpthm" id="relatedDoc">'+ZPI18N.getString("zp.knowledgebase")+"</button>"),askUsBtn&&(buttonTag+='<button  onclick="ZPServices.View.showAskUs()">'+ZPI18N.getString("zp.createcase")+"</button>"),buttonhtml+='<button  class="zpthm" onclick="ZPServices.View.showAskUs()">'+ZPI18N.getString("zp.askaquestion")+"</button>",hasFaqList&&(buttonTag+='<button  onclick="ZPServices.View.faqList()">'+ZPI18N.getString("zp.faq")+"</button>"),-1!==url.indexOf("/dashboard")?html='<div class="zp_btn">'+buttonhtml+"</div>":html='<div class="zp_btn">'+buttonTag+"</div>"},showAskUs:function(){$("#"+Layout.Page.pageId);var url=Layout.Page.hash,categoryId=$("#userServiceView").attr("categoryid");categoryId=-1!==url.indexOf("/dashboard")?$("#userServiceView").attr("categoryid"):$("#gotoservicebutton").attr("categoryid");var addcasemode=isadmin?HRCase.AgentAddMode:ZPeople.SUB_USERLIST.length>1?HRCase.ManagerAddMode:"";HRCase.AddCase.addCasePage(addcasemode,categoryId)},serviceViewPage:function(){var pageId=$("#"+Layout.Page.pageId),url=Layout.Page.hashDtl.hash,serviceName=Layout.Page.hash.split("/")[0].substring(1);if(serviceName!=Compensation.CONSTANTS.SERVICENAME)if(Layout.UrlConf.isServiceMode||Layout.UrlConf.isSystemService){var categoryprm={serviceName:serviceName,conreqcsr:csrfToken,mode:"serviceView"};$.ajax({url:"/fetchServiceDetails.zp",type:"POST",data:categoryprm,success:function(data){pageId.find("#serviceView").removeClass("zp_dyn"),"failure"!==data.status&&-1!==url.indexOf(serviceName+"/generalsettings")&&ZPServices.View.adminViewPage(data)}})}else Layout.Page.container.html('<div><div class="profileLft zc-componentBg mt7"><div class="pad20" id="errorDiv"><div class="P20 text-center"><div class="row"><div class="dvNomsg"><div class="PAdms"></div><p class="PT20 S15">'+ZPI18N.getString("zp.securityaccesserr")+"</p></div></div></div></div></div></div>");else window.location="#salarydetails/salarysettings/generalsettings"},getTabId:function(){var id=null,arr=Layout.Page.currentmode.split("/");return null!=ZPServices.SERVICE_JSON&&$.each(ZPServices.SERVICE_JSON,function(ind,val){if(ZPServices.SERVICE_JSON[ind].tabName.toLowerCase()==arr[0].toLowerCase())return id=ZPServices.SERVICE_JSON[ind].id,!1}),id},isServiceAdmin:function(){var serviceAdmin=serviceadminperm,id=ZPServices.View.getTabId();return!(null==serviceAdmin||void 0==id||!serviceAdmin.hasOwnProperty(id))},adminViewPage:function(data){if(isadmin){var pageId=$("#"+Layout.Page.pageId);if(pageId.addClass("services"),pageId.find("#edSrv").off("click").on("click",function(){ZPServices.Edit.editService(data)}),ZPServices.View.basicTabDetails(data),isadmin?(pageId.find("#tgForm").removeClass("zp_dyn"),pageId.find("#tgForm").off("click").on("click",function(){ZPServices.MoveForms.getFormsSlider(ZPServices.SERVICE_JSON,data.id)})):pageId.find("#tgForm").addClass("zp_dyn"),!isPlatformOrg){var formsList=data.formIds;pageId.find("#sfrmList").empty();var addFrm=ZPServices.View.addFormHtml();addfrm=addFrm.replace("$SERVICEID$",data.id);let serviceObj=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",data.tabName);data.isExtensionTab||data.tabName==Compensation.CONSTANTS.TAB_NAME||!serviceObj||serviceObj.isFormAddMoveDisable||pageId.find("#sfrmList").append(addfrm),ZPServices.View.viewFormList(formsList,!1),data.hasOwnProperty("FAQ_LIST")&&pageId.find("#FaqView").empty().append(FAQ.faqList(data.FAQ_LIST,!1,!1,"adminView"))}pageId.find("#serviceView").removeClass("zp_dyn"),pageId.find("#userServiceView").addClass("zp_dyn")}else Layout.Page.container.html('<div><div class="profileLft zc-componentBg mt7"><div class="pad20" id="errorDiv"><div class="P20 text-center"><div class="row"><div class="dvNomsg"><div class="PAdms"></div><p class="PT20 S15">'+ZPI18N.getString("zp.securityaccesserr")+"</p></div></div></div></div></div></div>")},formSettingsList:function(pcId,isActive,isDel,isApprovalAllowed,label,isExtensionForm){var sObj=[];return isActive&&(ZPeople.isDeptDesgRestricted&&("P_Department"==label||"P_Designation"==label)||isExtensionForm||sObj.push({id:"fCus",value:ZPI18N.getString("zp.customize")}),pcId!=ZPeople.EMP_HEALTH_FORMID&&(sObj.push({id:"fPer",value:ZPI18N.getString("zp.permissions")}),isApprovalAllowed&&sObj.push({id:"fApp",value:ZPI18N.getString("zp.approvals")})),sObj.push({id:"fAut",value:ZPI18N.getString("zp.automation")})),isDel&&!isExtensionForm&&sObj.push({id:"delForm",value:ZPI18N.getString("zp.deleteform")}),sObj},settingCallBack:function(dataObj,pcId){switch($(dataObj).attr("id")){case"fCus":window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl(ZPAppConstants.customize,pcId);break;case"fPer":window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl(ZPAppConstants.permissions,pcId);break;case"fApp":window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl(ZPAppConstants.approvals,pcId);break;case"fAut":window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl(ZPAppConstants.automation,pcId);break;case"delForm":ZPeople.BSModal.delete(function(){ZPServices.Configure.deleteForm(pcId)},"",ZPI18N.getString("zp.formdelconfirm"))}},viewFormList:function(formsList,isAddForm){var pageId=$("#"+Layout.Page.pageId);if(void 0!=formsList&&formsList.length>0){isAddForm||pageId.find("#sfrmList").find("[formId]").remove(),$.each(formsList,function(i,v){var formsHtml=ZPServices.View.formLstHtml(),alt=ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(v.dispName)));formsHtml=(formsHtml=(formsHtml=(formsHtml=formsHtml.replace("$PCID$",v.pcId)).replace("$FORMALTTEXT$",alt)).replace("$FORMNAME$",v.dispName)).replace("$FORMCOLOR$",ZPServices.View.getFormBgColor(alt)),pageId.find("#sfrmList").append(formsHtml);var formObj=pageId.find("#sfrmList").find("[formId = "+v.pcId+"]");if(formObj.find("#enbDisForm").attr("checked",v.isActive),v.isActive?formObj.removeClass("zp_dAct"):formObj.addClass("zp_dAct"),v.isExtensionForm&&formObj.find("#enbDisForm").parent().hide(),v.isActive&&"VaccinationStatus"!=v.label){var defAction=ZPAppConstants.customize;(ZPeople.isDeptDesgRestricted&&("P_Department"==v.label||"P_Designation"==v.label)||v.isExtensionForm)&&(defAction=ZPAppConstants.permissions),formObj.off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl(defAction,v.pcId)})}var settingsList=ZPServices.View.formSettingsList(v.pcId,v.isActive,v.isCustom,v.isApprovalAllowed,v.label,v.isExtensionForm);"VaccinationStatus"==v.label&&(settingsList=[]),settingsList.length>0?formObj.find("#formSett").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),$(this).addClass("zp_shw"),$(this).zparrowmenu({id:"fSett",width:155,position:ZPArrow.RIGHT_TOP,data:settingsList,callbackonclose:function(sourceObj){$(sourceObj).removeClass("zp_shw")},callback:function(dataObj,sourceObj){$(sourceObj).removeClass("zp_shw"),ZPServices.View.settingCallBack(dataObj,v.pcId)}})}):formObj.find("#formSett").remove(),v.isEnableDis?formObj.find("#enbDisForm").closest("label").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault();var obj=$(this),isActive=$(obj).find("#enbDisForm").is(":checked");isActive?ZPeople.BSModal.confirm(function(){ZPServices.Configure.enabledisableForm(v,isActive,obj)},"",ZPI18N.getString("zp.disableform")):ZPServices.Configure.enabledisableForm(v,isActive,obj)}):formObj.find(".zp_SFswtch").remove(),1})}},basicTabDetails:function(data){var pageId=$("#"+Layout.Page.pageId);pageId.find("#serviceView").attr("categoryId",data.categoryId),pageId.find("#cgeName").html(data.dispName);var desc=""!=data.desc.trim()?data.desc:CommonTemplates.noDataSVG("cgeDesc",!1,ZPI18N.getString("zp.emptydesc"),!1);pageId.find("#cgeDesc").html(desc);var iconClass=Icons.getIconClass(data.icon).iconClass;if(pageId.find("#srvicon").attr("class","zp_Si "+iconClass),data.hasOwnProperty("enable_hrcase")&&data.enable_hrcase&&!$.isEmptyObject(ZPTabs.getSelectedTab("hrcase"))){var html='<div class="zp_sttl"><span class="nobdr">'+ZPI18N.getString("zp.agent")+"</span></div><div>"+HRCategory.View.cloneAgentRow(data.agentDetails,!0)+"</div>";pageId.find("#enHRcase").html(html)}else pageId.find("#enHRcase").html("");data.hasOwnProperty("assoContents")?pageId.find("#docuList").html(HRCategory.View.cloneContentRow(data.assoContents,data.categoryId)):pageId.find("#docuList").html("")},addFormHtml:function(){return'<div onclick="ZPServices.Configure.addForm(\'$SERVICEID$\');" class="zp_svc SC1"><span><div class="zp_SFOpts"></div><label class="zp_serIcn"><i class="zp_Si zp_app0"></i></label><h3>'+ZPI18N.getString("zp.addnewform")+"</h3></span></div>"},formLstHtml:function(){return'<div formId="$PCID$" class="zp_svc"><span><div class="zp_SFOpts"><label class="zp_SFswtch"><input id="enbDisForm" class="cmn-toggle-small cmn-toggle-round-small" type="checkbox"><span></span></label><i id="formSett" class="IC-setting" title='+ZPI18N.getString("zp.more")+"></i></div>"+'<label class="zp_serIcn $FORMCOLOR$">$FORMALTTEXT$</label><h3>$FORMNAME$</h3></span></div>'},faqList:function(){var pageId=$("#"+Layout.Page.pageId),param={conreqcsr:csrfToken,method:"faqList",index:1,categoryId:pageId.find("#gotoservicebutton").attr("categoryid")};ZPeople.Request.send("/faqList.zp",param,function(data){$("#sliderPopup").length<=0&&$("body").append(CommonTemplates.sliderPop()),$("#sliderPopup").addClass("services zp_shw"),$("#sliderName").append(ZPI18N.getString("zp.faqAbbre")),$("#sliderContent").empty().append(FAQ.faqList(data.FAQ_LIST,!1,!0)),$("[name=closeSlider]").off("click").on("click",function(){CommonTemplates.closeSlider()})})},getRelatedDoc:function(categoryId){$("#"+Layout.Page.pageId);var param={mode:"relatedDoc",conreqcsr:csrfToken,categoryId:categoryId};param.serviceName=CustomServiceResources.SERVICE_NAME,ZPeople.Request.send("/services/references/list",param,function(data){ZPServices.View.showRelatedDoc(data)})},showRelatedDoc:function(data){$("#"+Layout.Page.pageId);$("#sliderPopup").length<=0&&$("body").append(CommonTemplates.sliderPop()),$("#sliderPopup").addClass("services zp_shw"),$("#sliderName").append(ZPI18N.getString("zp.knowledgebase")),$("#sliderContent").empty().append(HRCategory.View.cloneContentRow(data.FilesList,data.categoryId,!0)),$("[name=closeSlider]").off("click").on("click",function(){CommonTemplates.closeSlider()})},getFormBgColor:function(text){for(var len=text.length,code=0,i=0;i<len;i++)code+=text.charCodeAt(i);return"GC"+(code=code%4+1)}},ZPServices.SELECTED_SERVICE={},ZPServices.SERVICE_LIST_DIV='<div class="zp_svc $SERVICECOLOR$" tab="$SERVICELBL$"><span><i id="info" class="IC-info"></i><label class="zp_serIcn"><i class="$SERVICEICON$"></i></label><h3 title="$SERVICENAME$">$SERVICENAME$</h3></span></div>',ZPServices.SERVICE_CLOSE_HTML='<a class="zp_svcls" onclick="ZPServices.resetServicePage(event)"><i class="IC-cls" title='+ZPI18N.getString("zp.close")+"></i></a>",ZPServices.SERVICE_DESC_DIV='<div class="zp_sttl"><span>'+ZPI18N.getString("zp.description")+'</span></div><div class="zp_txt"><p>$SERVICEDESC$</p></div>',ZPServices.SERVICE_GOTO_BTN='<div class="zp_btn"><button class="zpthm" id="gotoservicebutton" onclick="ZPServices.gotoService(this)" categoryId="$CATEGORYID$">$GOTO$</button></div>',ZPServices.SERVICE_HEADER='<div class="zp_sR" id="hrServiceHeader"><div class="zp_sLIn"><h2>'+ZPI18N.getString("zp.allservices")+"</h2></div>",ZPServices.SERVICE_HEADER+='<div class="zp_sRIn"><div class="zp_sRBx"><i class="IC-lens"></i><input placeholder="'+ZPI18N.getString("zp.search")+'" onkeyup="ZPServices.search(this)" type="text"></div>$SETTINGSDIV$</div></div>',ZPServices.PEOPLE_PLUS_SERVICE={recruit:{dispName:"ATS",iconClass:"zp_app2",iconColor:"SC2",desc:ZPI18N.getString("zp.recruitdesc")},connect:{dispName:"Connect",iconClass:"zp_app3",iconColor:"SC3",desc:ZPI18N.getString("zp.connectdesc")},chat:{dispName:"Cliq",iconClass:"zp_app4",iconColor:"SC2",desc:ZPI18N.getString("zp.cliqdesc")},expense:{dispName:"Expense Tracker",iconClass:"zp_app6",iconColor:"SC1",desc:ZPI18N.getString("zp.expensedesc")},payroll:{dispName:"Payroll",iconClass:"zp_app56",iconColor:"SC1",desc:ZPI18N.getString("zp.payrolldesc")},sign:{dispName:"Sign",iconClass:"zp_app7",iconColor:"SC4",desc:ZPI18N.getString("zp.signdesc")},vault:{dispName:"Vault",iconClass:"zp_app49",iconColor:"SC2",desc:ZPI18N.getString("zp.vaultdesc")}},ZPServices.SERVICE_NODATA='<div class="ZPNdata" id="service_nodata"> <i class="CR-nodata"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i> <h5 id="zp_views_nodata">'+ZPI18N.getString("zp.noservice")+"</h5> </div>",ZPServices.constructServicePage=function(){var serviceDv=$("#"+Layout.Page.pageId).find("#serviceMainDv");if(ZPServices.SERVICE_JSON.length>0){serviceDv.find("[name=hrService]").length<1&&serviceDv.append('<div class="zp_sRcnt" name="hrService"></div>');var mainDv=serviceDv.find("[name=hrService]");Layout.isPeoplePlus?serviceDv.find("[name=peopleService]").siblings().remove():(mainDv.empty(),mainDv.siblings(".ZPNdata").remove()),ZPServices.SELECTED_SERVICE={};var settingsDv="";if($.each(ZPServices.SERVICE_JSON,function(index,service){if(void 0!=service.tabName&&service.isActive){var serviceDiv=ZPServices.serviceListRow(service);mainDv.append(serviceDiv),mainDv.find('[tab="'+service.tabName+'"] span').click(function(){ZPServices.SELECTED_SERVICE={},ZPServices.gotoService(this)});var systemService=["organization","timetracker","leavetracker","attendance","files","performance","announcements","lms","hrcase","officereadiness","employeeengagement",Compensation.CONSTANTS.TAB_NAME.toLowerCase()];ZPUtil.checkIsExistInArray(systemService,service.tabName.toLowerCase())?(mainDv.find('[tab="'+service.tabName+'"] span #info').remove(),service.tabName==Compensation.CONSTANTS.TAB_NAME&&mainDv.find('[tab="'+service.tabName+'"] span').attr("tabName",service.tabName)):mainDv.find('[tab="'+service.tabName+'"] span #info').click(function(event){ZPServices.showServiceDtl(this,event)})}}),isadmin){settingsDv='<a href="#admin/formslayout/tabs"><span data-toggle="tooltip" data-placement="bottom" data-original-title="'+ZPI18N.getString("zp.settings")+'"><i class="IC-setting zp_rB"></i></span></a>';var addServiceDV=ZPServices.serviceListRow({dispName:ZPI18N.getString("zp.newservice"),tabName:"",icon:"add"});mainDv.append(addServiceDV),mainDv.find('[tab=""] span').attr("onclick","ZPServices.Configure.addNewService()"),mainDv.find('[tab=""]').addClass("addService"),$("#"+Layout.Page.pageId).find("#serviceMainDv").find(".addService").find(".IC-info").remove(),$("#"+Layout.Page.pageId).find("#serviceMainDv").find(".addService").find(".zp_serIcn").addClass("GC1")}serviceDv.find("#hrServiceHeader").length<1?serviceDv.prepend(ZPServices.SERVICE_HEADER.replace("$SETTINGSDIV$",settingsDv)):serviceDv.find("#hrServiceHeader input").val(""),mainDv.find(".zp_sRBx .IC-lens").on("click",function(){$(this).siblings("input").trigger("focus")})}if(Layout.isPeoplePlus)if(serviceDv.find("[name=peopleService]").length<1){$(".zp_clist").prepend(ZPeople.LOADING_HTML),Layout.Page.container.find("#serviceMainDv").hide(),ZPServices.validateCompanyDetails();mainDv.prepend('<div class="zp_sRcnt zp_pPls zp_svc" name="peopleService" style="width:auto;margin-right:0;margin-bottom: 0;height: auto;max-height: 405px;"></div>');var peopleDv=serviceDv.find("[name=peopleService]");$.each(ZPServices.PEOPLE_PLUS_SERVICE,function(tabName,pplService){pplService.tabName=tabName,peopleDv.append(ZPServices.serviceListRow(pplService,!0)),peopleDv.find("[tab='"+tabName+"']").attr("id",tabName+"_id")}),peopleDv.find("span #info").click(function(event){ZPServices.showServiceDtl(this,event)}),peopleDv.find("span").click(function(){ZPServices.gotoPeopleService(this)})}else ZPServices.getPPServiceStatusCallback(),Layout.Page.container.find("#service_nodata").remove()},ZPServices.addSampleAndRedirect=function(button){var params={issampledatarequired:"addsampledata"===button.id};ZPeople.Request.send("/onboarding/sample/runSampleDataScheduler",params,function(response){var url=window.location.protocol+"//"+window.location.host+"/"+ZPeople.PORTAL_NAME+"/zp"+window.location.hash;params.issampledatarequired&&response.hasOwnProperty("message")?ZPeople.confirm(null,"",response.message,function(){url==window.location.href?window.location.reload():window.location.href=url},!0,!0,ZPI18N.getString("zp.ok")):url!=window.location.href&&(window.location.href=url)}),ZPeople.isSampleDataRequestNotRaised=!1,$("#sampleDiv,.modal-backdrop").remove()},ZPServices.appendSampleDataPopUp=function(){if(0==$("#sampleDiv").length){$("body").removeClass("topZ");var sampleDataPopUp='<div class="tdAcc modalShdw" id="sampleDiv"><span class="modalShdwInner"><em></em></span>';sampleDataPopUp+='<div style="dtable"><div class="lft"><img src="'+ZPeople.getResourceURL(hrImageUrl+"sampleData.png")+'"></div>',sampleDataPopUp+='<div class="rht">',sampleDataPopUp+='<p class="bld">'+ZPI18N.getString("zp.sampledataheader")+"</p>",sampleDataPopUp+="<p>"+ZPI18N.getString("zp.sampledatabody")+"</p>",sampleDataPopUp+='<span class="tdAccBtn" id="dataAccount">',sampleDataPopUp+='<a id="addsampledata" onclick="ZPServices.addSampleAndRedirect(this)">'+ZPI18N.getString("zp.sampledataaccept")+"</a>",sampleDataPopUp+='</span><span class="tdAccBtn">',sampleDataPopUp+='<a id="dontaddsmapledata" onclick="ZPServices.addSampleAndRedirect(this)" class="link">'+ZPI18N.getString("zp.sampledatareject")+"</a>",sampleDataPopUp+='</span></div></div><span class="modalShdwInner flip"><em></em></span></div><div class="modal-backdrop"></div>',$("body").append(sampleDataPopUp),$("#sampleDiv").addClass("in")}};var urlDetails={};ZPServices.serviceList=["recruit","expense","connect","vault","payroll","chat","sign"],ZPServices.getPPServiceStatus=function(serviceName){var disObj=ZPSetupCommon.isEmpty(serviceName)?Layout.Page.container.find("div[name=peopleService]").find("[tab]"):Layout.Page.container.find("#"+serviceName+"_id"),params={action:"getDashBoard"},url="getDashBoard";if(!ZPSetupCommon.isEmpty(serviceName))if(ZPServices.PEOPLE_PLUS_SERVICE[serviceName].hasOwnProperty("status"))if(ZPServices.PEOPLE_PLUS_SERVICE[serviceName].status===ZPServices.View.UnassSingleStatus)params.action="mergeSelectedService",url="mergeSelectedService",params.servicename=serviceName,params.serviceId=ZPServices.PEOPLE_PLUS_SERVICE[serviceName].orgid,ZPServices.PEOPLE_PLUS_SERVICE.expense.tabName==serviceName?params.expenseOrPayrollAppStatus=ZPServices.PEOPLE_PLUS_SERVICE.payroll.status:ZPServices.PEOPLE_PLUS_SERVICE.payroll.tabName==serviceName&&(params.expenseOrPayrollAppStatus=ZPServices.PEOPLE_PLUS_SERVICE.expense.status),ZPServices.PEOPLE_PLUS_SERVICE[serviceName].hasOwnProperty("fromSoftLink")&&(params.fromSoftLink=ZPServices.PEOPLE_PLUS_SERVICE[serviceName].fromSoftLink);else if(ZPServices.PEOPLE_PLUS_SERVICE[serviceName].status===ZPServices.View.createFrshStatus)params.action="createService",url="createService",params.servicename=serviceName,ZPServices.PEOPLE_PLUS_SERVICE.expense.tabName==serviceName?params.expenseOrPayrollAppStatus=ZPServices.PEOPLE_PLUS_SERVICE.payroll.status:ZPServices.PEOPLE_PLUS_SERVICE.payroll.tabName==serviceName&&(params.expenseOrPayrollAppStatus=ZPServices.PEOPLE_PLUS_SERVICE.expense.status);else{if(ZPServices.PEOPLE_PLUS_SERVICE[serviceName].status===ZPServices.View.ConflictStatus&&("paid_account"==ZPServices.PEOPLE_PLUS_SERVICE[serviceName].conflict_type||"already_mapped_account"==ZPServices.PEOPLE_PLUS_SERVICE[serviceName].conflict_type||"non_admin_user"==ZPServices.PEOPLE_PLUS_SERVICE[serviceName].conflict_type)){if("paid_account"==ZPServices.PEOPLE_PLUS_SERVICE[serviceName].conflict_type){var additionalContent=ZPI18N.getString("zpp.upgradetopeopleplusplan");url=(url=$("#subscriptionLink").attr("href")).substr(0,paymentUrl.indexOf("people"))+serviceName}else if("non_admin_user"==ZPServices.PEOPLE_PLUS_SERVICE[serviceName].conflict_type&&void 0!=ZPServices.PEOPLE_PLUS_SERVICE[serviceName].admins)JSON.stringify(ZPServices.PEOPLE_PLUS_SERVICE[serviceName].admins);return void ZPServices.showStatusPopUp(serviceName,ZPServices.View.ConflictStatus,ZPServices.PEOPLE_PLUS_SERVICE[serviceName],additionalContent,url)}if(ZPServices.PEOPLE_PLUS_SERVICE[serviceName].status===ZPServices.View.UnassMultipleStatus)return void ZPServices.showMultiPortalPopUp(ZPServices.PEOPLE_PLUS_SERVICE[serviceName].eachServiceIter,serviceName)}else params.action="createService",url="createService",params.servicename=serviceName;disObj.find("#retry_mode").remove(),ZPeople.Request.send("/pplus/"+url,params,ZPServices.getPPServiceStatusCallback,serviceName)},ZPServices.mergePaidAccount=function(serviceName,serviceId){$("#upgradeSubsButton").val(ZPI18N.getString("zp.pleasewaitmsg")),$("#upgradeSubsButton").attr("disabled",!0);var params={action:"mergeSelectedService"};params.servicename=serviceName,params.serviceId=serviceId,params.conreqcsr=csrfToken,$.post("/pplus/mergeSelectedService",params,function(data){if("Success"==data.result){var paymentUrl=$("#subscriptionLink").attr("href");paymentUrl=paymentUrl.substr(0,paymentUrl.indexOf("people"))+serviceName,window.open(paymentUrl,"_blank"),ZPServices.removeStausDiv()}else{Layout.Page.container.find("#serviceStatusDiv").find("b").html(ZPI18N.getString("zpp.configurationfailure")),$("#upgradeSubsButton").remove()}})},ZPServices.getPPServiceStatusCallback=function(data,params,app_name){var serviceObj,baseDiv=$("div[name=peopleService]");$("#adminConsole").find("div").click(function(){window.open($(this).attr("href"),"_blank")});var isFromScheduler=!1;ZPSetupCommon.isEmpty(app_name)?2===Object.keys(data).length?(app_name=Object.keys(data)[1],isFromScheduler=!0,ZPServices.PEOPLE_PLUS_SERVICE.expense.tabName!=app_name&&ZPServices.PEOPLE_PLUS_SERVICE.expense.tabName!=app_name||$("div#loadingClassPopUp").length>0&&($("div#loadingClassPopUp").remove(),$("div#freezelayerid").remove()),serviceObj=Layout.Page.container.find("#"+app_name+"_id")):serviceObj=Layout.Page.container.find("div[name=peopleService]").find("div[tab]"):serviceObj=Layout.Page.container.find("#"+app_name+"_id");serviceObj.find(".icon-stat").remove(),serviceObj.removeClass("zp_svcDis"),$.each(ZPServices.serviceList,function(index,item){if(!ZPSetupCommon.isEmpty(app_name)&&app_name===item||ZPSetupCommon.isEmpty(app_name)){var eachServiceIter=data[item],status=ZPServices.View.notAddedServicetoUser;void 0!=eachServiceIter?status=eachServiceIter.Status:(status=data.status,eachServiceIter=data);baseDiv.find("#"+item+"_id");var isAlreadyCreated=!0;(!ZPSetupCommon.isEmpty(params)&&params.hasOwnProperty("action")&&"createService"===params.action||null==params)&&(isAlreadyCreated=!1),ZPSetupCommon.isEmpty(app_name)||isFromScheduler||ZPServices.showStatusPopUp(item,status,eachServiceIter),ZPServices.statusAppearance(status,eachServiceIter,item,isAlreadyCreated,app_name),index==ZPServices.serviceList.length-1&&(Layout.Page.container.find("#serviceMainDv").show(),$("#zp-contwrap-services-listing").find("#zp_page_loading").remove())}})},ZPServices.showMultiPortalPopUp=function(eachServiceIter,serviceName){var appName="Zoho Expense",appIcon="lst ze";"payroll"==serviceName?appName="Zoho Payroll":"recruit"==serviceName&&(appName="ATS",appIcon="lst zr");var comDiv='<div class="pp-popup" id="serviceStatusDiv"><a class="zp_svcls FR" onclick="ZPServices.removeStausDiv()"><i class="IC-cls" title="Close"></i></a>';comDiv+='<div class="zpwelmd_bx"><div class="infoPage"><h1>Choose an account to map with Zoho People Plus</h1><div class="zpwelmd_prdt"><div class="'+appIcon+'"><p>'+appName+'</p><select class="selectBox" id="expenseOrg">';for(var ids=Object.keys(eachServiceIter.Orgs),i=0;i<ids.length;i++)comDiv+='<option value="'+ids[i]+'">'+ids[i]+" - "+eachServiceIter.Orgs[ids[i]].display_name+"</option>";comDiv+='</select></div></div></div><div class="button"><input class="button" onclick="ZPServices.submitPortalData(\''+serviceName+'\')" value="Done" type="button"></div></div></div><div class="modal-backdrop fade in"></div>',Layout.Page.container.append(comDiv),Layout.Page.container.find("#expenseOrg").select2()},ZPServices.submitPortalData=function(serviceName){var serviceDiv=$("div[name=peopleService]").find("#"+serviceName+"_id"),expenseOrgId=$("#expenseOrg option:selected").val();if(null!=expenseOrgId&&""!=expenseOrgId&&ZPServices.PEOPLE_PLUS_SERVICE[serviceName].hasOwnProperty("Orgs")&&ZPServices.PEOPLE_PLUS_SERVICE[serviceName].Orgs.hasOwnProperty(expenseOrgId))if(ZPServices.PEOPLE_PLUS_SERVICE[serviceName].Orgs[expenseOrgId].hasOwnProperty("conflict_type")&&"non_admin_user"==ZPServices.PEOPLE_PLUS_SERVICE[serviceName].Orgs[expenseOrgId].conflict_type)ZPServices.PEOPLE_PLUS_SERVICE[serviceName].Orgs[expenseOrgId].hasOwnProperty("admins")&&(ZPServices.removeStausDiv(),ZPServices.PEOPLE_PLUS_SERVICE[serviceName].display_name=ZPServices.PEOPLE_PLUS_SERVICE[serviceName].Orgs[expenseOrgId].display_name,ZPServices.showStatusPopUp(serviceName,ZPServices.View.ConflictStatus,ZPServices.PEOPLE_PLUS_SERVICE[serviceName].Orgs[expenseOrgId]));else{var anotherfinanceSppStatus,item;ZPServices.removeStausDiv(),serviceDiv.find("#retry_mode").remove(),ZPServices.PEOPLE_PLUS_SERVICE.expense.tabName==serviceName?(anotherfinanceSppStatus=ZPServices.PEOPLE_PLUS_SERVICE.payroll.status,item=ZPServices.PEOPLE_PLUS_SERVICE.payroll.tabName):ZPServices.PEOPLE_PLUS_SERVICE.payroll.tabName==serviceName&&(anotherfinanceSppStatus=ZPServices.PEOPLE_PLUS_SERVICE.expense.status,item=ZPServices.PEOPLE_PLUS_SERVICE.expense.tabName);var params={action:"mergeSelectedService",conreqcsr:csrfToken,servicename:serviceName,serviceId:expenseOrgId,fromSoftLink:!1,expenseOrPayrollAppStatus:anotherfinanceSppStatus};$.ajax({type:"POST",async:!0,url:"/pplus/mergeSelectedService",data:params,success:function(data){if("Success"==data.result)(error={}).message=ZPI18N.getString("zp.configurationsucc"),ZPServices.showStatusPopUp(serviceName,ZPServices.View.assStatus,error),data.hasOwnProperty("url")&&(urlDetails.expense=data.url),Layout.Page.container.find("#"+serviceName+"_id .icon-stat").remove(),Layout.Page.container.find("#"+serviceName+"_id").removeClass("zp_svcDis"),setTimeout(function(){-1==ZPServices.PEOPLE_PLUS_SERVICE[item].status&&ZPServices.getPPServiceStatus()},8e3);else if(void 0!=data.result){(error={}).message=data.result,ZPServices.showStatusPopUp(serviceName,ZPServices.View.ConflictStatus,error)}else if("Failure"==data.result){var error;(error={}).message=ZPI18N.getString("zpp.configurationfailure"),ZPServices.showStatusPopUp(serviceName,ZPServices.View.ConflictStatus,error)}}})}},ZPServices.showStatusPopUp=function(item,status,eachServiceIter,additionalContent,url,isRed){if($("#confirmationPopup #textConfirmationPopupHeader").text(""),void 0!=additionalContent&&null!=additionalContent?($("#confirmationPopup #confirmConfirmationPopup").show(),$("#confirmationPopup #confirmConfirmationPopup").text(additionalContent),additionalContent==ZPI18N.getString("zpp.cancelonezohobutton")?$("#confirmationPopup #confirmConfirmationPopup").removeClass("btn-primary").addClass("btn-warning"):$("#confirmationPopup #confirmConfirmationPopup").removeClass("btn-warning").addClass("btn-primary"),$("#confirmationPopup #confirmConfirmationPopup").off().on("click",function(){window.open(url,"_blank")})):$("#confirmationPopup #confirmConfirmationPopup").hide(),status===ZPServices.View.assStatus)$("#confirmationPopup #textConfirmationPopupBody").text(ZPI18N.getString("zp.configurationsucc"));else{if(status===ZPServices.View.PEOPLEPLUSSERVICE_SERVICEUNAVAILBLEFORDADMIN||status===ZPServices.View.notAddedServicetoUser||status===ZPServices.View.PEOPLEPLUSSERVICE_SERVICENOTADDEDBYADMIN){var serviceDiv=$("div[name=peopleService]").find("#"+item+"_id");return void $(serviceDiv).hide()}if(status===ZPServices.View.UnavailStatus)$("#confirmationPopup #textConfirmationPopupBody").html("Coming soon");else if(status===ZPServices.View.createFrshStatus||status===ZPServices.View.ConflictStatus||status===ZPServices.View.UnassSingleStatus)if(eachServiceIter.hasOwnProperty("admins")){$("#confirmationPopup").addClass("ZPmdlnw"),$("#confirmationPopup #textConfirmationPopupHeader").hide();ZPI18N.getString("zpp.noperms");'<p class="dgry">'+ZPI18N.getString("zpp.nopermsMessage",[ZPServices.PEOPLE_PLUS_SERVICE[item].dispName,ZPServices.PEOPLE_PLUS_SERVICE[item].display_name])+"</p>",'<p class="PB20">'+ZPI18N.getString("zpp.selectadmin")+"</p><select id=selectAdmins_"+item+">";for(var jsonadminObj=eachServiceIter.admins[0],ids=Object.keys(eachServiceIter.admins[0]),i=0;i<ids.length;i++)'<option value="'+ids[i]+'">'+jsonadminObj[ids[i]]+"</option>";"</select></div></div>",$("#confirmationPopup").find("#selectAdmins_"+item).select2(),$("#confirmationPopup #confirmConfirmationPopup").show();additionalContent=ZPI18N.getString("zpp.requestaccess");$("#confirmationPopup #confirmConfirmationPopup").text(additionalContent),$("#confirmationPopup #confirmConfirmationPopup").off().on("click",function(){ZPServices.submitAdminRequest(item,eachServiceIter,this)})}else eachServiceIter.hasOwnProperty("message")?$("#confirmationPopup #confirmConfirmationPopup").text(additionalContent):$("#confirmationPopup #textConfirmationPopupBody").html(ZPI18N.getString("zpp.configurationfailure"))}$("#confirmationPopup #cancelConfirmationPopup").show(),$("#confirmationPopup #cancelConfirmationPopup").text(ZPI18N.getString("zp.close")),$("#confirmationPopup").modal("show")},ZPServices.submitAdminRequest=function(serviceName,eachServiceIter,getThis){$("div[name=peopleService]").find("#"+serviceName+"_id");var adminZUID=$("#selectAdmins_"+serviceName).find("option:selected").val();if(null!=adminZUID&&""!=adminZUID){ZPServices.removeStausDiv();var params={action:"mergeSelectedService",conreqcsr:csrfToken,servicename:serviceName,serviceId:eachServiceIter.zaaid,fromSoftLink:!0,adminZUID:adminZUID};$.ajax({type:"POST",async:!0,url:"/pplus/mergeSelectedService",data:params,success:function(data){if("Success"==data.result)(error={}).message=ZPI18N.getString("zp.copycust.sucmsg"),ZPServices.showStatusPopUp(serviceName,ZPServices.View.ConflictStatus,error),ZPServices.getPPServiceStatus();else if("Failure"==data.result){var error;(error={}).message=ZPI18N.getString("zp.serrviceconflict.commonerror",[Layout.ppSupportEmail]),ZPServices.showStatusPopUp(serviceName,ZPServices.View.ConflictStatus,error)}}})}},ZPServices.removeStausDiv=function(){Layout.Page.container.find("#serviceStatusDiv").remove(),Layout.Page.container.find(".modal-backdrop").remove()},ZPServices.validateCompanyDetails=function(){1==ZPeople.showCompanyInfoPopUp&&Layout.isPeoplePLusAdmin?(ZPServices.getPPServiceStatus(),ZPeople.Request.sendAsyncPost("/pplus/getCompanyDetails",{action:"getCompanyDetails"},ZPServices.showCompanyInfo)):ZPServices.getPPServiceStatus()},ZPServices.showCancelTrailPopUp=function(){ZPeople.showLogoutModal();var comDiv='<div class="pp-popup" id="cancelTrail"> <a class="zp_svcls FR" onclick="ZPServices.removeCancelTrailPopUp()"><i class="IC-cls" title="Close"></i></a><div id="CancelTrial"><div class="pp-popTop"></div><h1>Cancel Trial</h1><div class="cancelDiv in" role="dialog" id="PPTrailCancel" aria-hidden="false" data-keyboard="false" data-backdrop="static"><p>'+ZPI18N.getString("zpp.canceltrialmsg")+'</p><ul><li class="mand"><label>'+ZPI18N.getString("zpp.reasonforcancel")+'</label><span><input type="text" id="cancelreason" onfocus="ZPServices.removeErrorDivForCancel();"></span></li></ul><div class="button">  <input type="button" value="'+ZPI18N.getString("zpp.cancelpeopleplus")+'" class="cancel" id="canceltrail" onclick="ZPServices.cancelTrail()"></div></div></div></div><div class="modal-backdrop fade in"></div>';Layout.Page.container.find(".pp-popup").remove(),Layout.Page.container.append(comDiv)},ZPServices.removeCancelTrailPopUp=function(){Layout.Page.container.find("#cancelTrail").remove(),Layout.Page.container.find(".modal-backdrop").remove(),ZPServices.validateCompanyDetails()},ZPServices.removeErrorDivForCancel=function(){Layout.Page.container.find(".dverrormsg").remove(),Layout.Page.container.find(".etxt").remove()},ZPServices.cancelTrail=function(){var cancelreason=$("#cancelreason").val();$("#errorcancelreason").remove(),$("#errorgeneral").remove();var cancelreasonEmpty=ZPUtil.Validation.isEmpty(cancelreason);cancelreasonEmpty?cancelreasonEmpty&&!$("#cancelreason").siblings().hasClass("dverrormsg")&&$("#cancelreason").parent().parent().append("<div class='dverrormsg'  id='errorcancelreason'>"+ZPI18N.getString("zp.invcancelreason")+"</div>"):ZPeople.Request.send("/pplus/cancelTrial",{action:"cancelTrial",reason:cancelreason},ZPServices.TrailStatus)},ZPServices.TrailStatus=function(resultObj){if("success"==resultObj.status)window.location.reload();else{var errMsg=ZPI18N.getString("zp.invcase3");"invalid_password"==resultObj.code?(errMsg=ZPI18N.getString("zp.invalidPassword"),$("#pppwd").parent().parent().append("<div class='dverrormsg'  id='errorpwd'>"+errMsg+"</div>")):$("#CancelTrial").find("h1").after("<div class='etxt'  id='errorgeneral'>"+errMsg+"</div>")}},ZPServices.showCompanyInfo=function(obj){if(0===Layout.Page.container.find(".pp-popup").length){var comDiv='<div class="pp-popup compDtlPop" id="parentClassPopUp"><div id="infoPage"><div class="pp-popTop"></div><h1>'+ZPI18N.getString("zp.compinfo")+"<span>"+ZPI18N.getString("zp.compinfomsg")+"</span>";comDiv+='</h1><ul class="form single"><li class="mand"><label class="S14">'+ZPI18N.getString("zp.companyname")+'<em class="red">*</em></label> <span><input   id="companyname" type="text" autofocus onfocus="ZPServices.removeErrorDiv();"></span> </li>',comDiv+='<li class="mand"><label class="S14" >'+ZPI18N.getString("zp.phone")+'<em class="red">*</em></label><span><input id="mobile" type="text" onfocus="ZPServices.removeErrorDiv();"></span></li>',comDiv+='<li class="othInfoHdr">'+ZPI18N.getString("zp.otherinfo")+"</li>",comDiv+=' <li class="mb5"><label>'+ZPI18N.getString("zp.country")+'</label><div class="othInfo"><div class="select2-container sgnemail "> <abbr class="select2-search-choice-close" style="display:none;"></abbr><select id="country" onchange="ZPServices.GetStateFromCountryCode();" updatekey="basicOrgcountry" name="editable" style="display: block;"></select></div></li></li>',comDiv+=' <li class="mb5"><label>'+ZPI18N.getString("zp.state")+'</label><div class="othInfo"><div class="select2-container sgnemail "> <abbr class="select2-search-choice-close" style="display:none;"></abbr><select id="state" updatekey="basicOrgState" name="editable" style="display: block;"></select></div></li></li>',comDiv+='<li class="mb5"> <label>'+ZPI18N.getString("zp.timezone")+'</label><div class="othInfo"><div class="select2-container sgnemail "> <abbr class="select2-search-choice-close" style="display:none;"></abbr><select  id="timezone" updatekey="basicOrgTimezone" name="editable" style="display: block;"></select></div></li></li>',comDiv+='</ul><div class="button"><input type="button"  id="updBasicCmpInfo" value="'+ZPI18N.getString("zp.update")+'" onclick="ZPServices.UpdateBasicSetupInfo()"></div></div>',comDiv+='</div></form></div></div></div></div></div><div class="modal-backdrop fade in"></div>',Layout.Page.container.append(comDiv),obj.hasOwnProperty("companyName")&&Layout.Page.container.find("#parentClassPopUp #companyname").val(obj.companyName),obj.hasOwnProperty("mobile")&&Layout.Page.container.find("#parentClassPopUp #mobile").val(obj.mobile),void 0!=contextPath&&null!=contextPath&&"null"!=contextPath&&Layout.Page.container.find("#parentClassPopUp #portalname").val(contextPath),ZPServices.settimezoneDetails(obj)}},ZPServices.settimezoneDetails=function(dataObj){var timeZoneList="";$.each(dataObj.timeZoneList,function(index,timeMap){for(timeZoneList+="<optgroup label='"+timeMap.disp+"'>",i=0;i<timeMap.list.length;i++)timeZoneList+="<option value='"+timeMap.list[i].code+"'>"+timeMap.list[i].name+"&nbsp("+timeMap.list[i].code+")</option>";timeZoneList+="</optgroup>"}),Layout.Page.container.find("select[updateKey='basicOrgTimezone']").html(timeZoneList),dataObj.hasOwnProperty("accTimeZone")?Layout.Page.container.find("#timezone").val(dataObj.accTimeZone).select2():Layout.Page.container.find("#timezone").select2();var countryList="";$.each(dataObj.countryList,function(index,country){countryList+="<option value="+country.code+(0===index?' selected="selected">':">")+country.name+"</option>"}),Layout.Page.container.find("select[updateKey='basicOrgcountry']").html(countryList),dataObj.hasOwnProperty("stateList")?(Layout.Page.container.find("#country").val(dataObj.stateList.country_code).select2(),ZPServices.PopulateStatesinUI(dataObj)):Layout.Page.container.find("#country").select2()},ZPServices.GetStateFromCountryCode=function(){var countryCode=Layout.Page.container.find("#country option:selected").val(),params={conreqcsr:csrfToken,action:"getCompanyDetails",countryCode:countryCode};$.ajax({type:"POST",async:!1,url:"/pplus/getCompanyDetails",data:params,success:function(data){ZPServices.PopulateStatesinUI(data)}})},ZPServices.PopulateStatesinUI=function(dataObj){$.each(dataObj.stateList.data,function(index,state){"<option value="+state.state_code+(0===index?' selected="selected">':">")+state.state_name+"</option>"});Layout.Page.container.find("select[updateKey='basicOrgState']");Layout.Page.container.find("#state").select2()},ZPServices.UpdateBasicSetupInfo=function(){var companyName=Layout.Page.container.find("#companyname").val(),companyNameisEmpty=ZPUtil.Validation.isEmpty(companyName),mobileNum=Layout.Page.container.find("#mobile").val(),mobileIsEmpty=ZPUtil.Validation.isEmpty(mobileNum),country=Layout.Page.container.find("#country option:selected").text(),countryisEmpty=ZPUtil.Validation.isEmpty(country),timFmt=Layout.Page.container.find("#timezone").val(),timFmtisEmpty=ZPUtil.Validation.isEmpty(timFmt),GettingStartedJsonObject={},params={},state=Layout.Page.container.find("#state option:selected").text(),stateisEmpty=ZPUtil.Validation.isEmpty(state);companyNameisEmpty||timFmtisEmpty||mobileIsEmpty||countryisEmpty?(companyNameisEmpty&&Layout.Page.container.find("#companyname").parent().parent().addClass("mand err").append("<div class='dverrormsg'  id='errorcompanyName'>"+ZPI18N.getString("zp.organizationemptymsg")+"</div>"),timFmtisEmpty&&Layout.Page.container.find("#timezone").parent().parent().append("<div class='dverrormsg'  id='errortimezone'>"+ZPI18N.getString("zp.timezoneemptymsg")+"</div>"),countryisEmpty&&Layout.Page.container.find("#country").parent().parent().append("<div class='dverrormsg'  id='errorcountry'>"+ZPI18N.getString("zp.countryemptymsg")+"</div>"),mobileIsEmpty&&Layout.Page.container.find("#mobile").parent().parent().addClass("mand err").append("<div class='dverrormsg'  id='errormobile'>"+ZPI18N.getString("zp.mbleemptymsg")+"</div>"),stateisEmpty&&Layout.Page.container.find("#state").parent().parent().append("<div class='dverrormsg'  id='errorstate'>"+ZPI18N.getString("zp.stateemptymsg")+"</div>")):/[^0-9-()+]/.test(mobileNum)?Layout.Page.container.find("#mobile").siblings().hasClass("etxt")?Layout.Page.container.find("#mobile").find("#errormobile").attr("value",ZPI18N.getString("zp.enteravalidnumber")):Layout.Page.container.find("#mobile").parent().append("<div class='etxt'  id='errormobile'>"+ZPI18N.getString("zp.enteravalidnumber")+"</div>"):(GettingStartedJsonObject.country=country,GettingStartedJsonObject.state=state,GettingStartedJsonObject.timezone=timFmt,GettingStartedJsonObject.mobile=mobileNum,GettingStartedJsonObject.companyName=companyName,GettingStartedJsonObject.phone=mobileNum,$("#updBasicCmpInfo").attr("disabled",!0).val(ZPI18N.getString("zp.pleasewaitmsg")),params={conreqcsr:csrfToken,action:"updateCompanyDetails",updateBasicInfoJSON:JSON.stringify(GettingStartedJsonObject)},$.post("/pplus/updateCompanyDetails",params,function(data){"Success"==data.response.message?(Layout.Page.container.find("#updBasicCmpInfo").prop("disabled",!0),ZPeople.showCompanyInfoPopUp=!1,ZPServices.createFinanceServicesLoading()):Layout.Page.container.find("#infoPage").find("h1").append("<div class='dverrormsg' id='errorcompanyName'>"+ZPI18N.getString("zp.internalservererror")+"</div>")}))},ZPServices.createFinanceServicesLoading=function(){if(3!=ZPServices.PEOPLE_PLUS_SERVICE.expense.status&&3!=ZPServices.PEOPLE_PLUS_SERVICE.payroll.status){Layout.Page.container.find(".pp-popup,.modal-backdrop").remove();var loadhtml='<div class="pp-popup loadpop" id="loadingClassPopUp"><div id="infoPage"> <div class="load-hz"></div> <h1>'+ZPI18N.getString("zpp.loadingtext")+"</h1> ";ZPeople.ISUNCONFIRMEDACC&&(loadhtml+="<p> "+ZPI18N.getString("zpp.loadingtext1")+" </p>"),loadhtml+='</div></div><div class="modal-backdrop dark in" id="freezelayerid"></div>',Layout.Page.container.append(loadhtml),$("div#loadingClassPopUp").length>0&&setTimeout(ZPServices.showLoadingPopUp,12e3)}},ZPServices.showLoadingPopUp=function(){ZPServices.getPPServiceStatus(),$("div#loadingClassPopUp").length>0&&setTimeout(ZPServices.showLoadingPopUp,1e3),$("div#loadingClassPopUp").remove(),$("div#freezelayerid").remove()},ZPServices.removeErrorDiv=function(){Layout.Page.container.find(".dverrormsg").remove()},ZPServices.click=function(serviceDiv,message,ServiceName){serviceDiv.find("div").click(function(){void 0==message||null==message?window.open($(this).attr("href"),"_blank"):alert("application not added")})},ZPServices.statusAppearance=function(status,eachServiceIter,item,alreadyCreated,appName){var serviceDiv=$("div[name=peopleService]").find("#"+item+"_id");ZPServices.PEOPLE_PLUS_SERVICE[item].status=status;var isNotAllowedToShowApp=!!eachServiceIter.hasOwnProperty("isNotAllowedToShowApp")&&eachServiceIter.isNotAllowedToShowApp,isAllowedToShowCliq=!("chat"!=item||!eachServiceIter.hasOwnProperty("isAllowedToShowCliq"))&&eachServiceIter.isAllowedToShowCliq,isAllowedToShowSign=!("sign"!=item||!eachServiceIter.hasOwnProperty("isAllowedToShowSign"))&&eachServiceIter.isAllowedToShowSign;if(status==ZPServices.View.assStatus||"chat"!=item&&"sign"!=item||$(serviceDiv).remove(),status===ZPServices.View.assStatus)"chat"!=item&&"sign"!=item||isAllowedToShowCliq||isAllowedToShowSign?isNotAllowedToShowApp?$(serviceDiv).remove():($(serviceDiv).show(),alreadyCreated?(serviceDiv.removeClass("zp_svcConf"),serviceDiv.find("h3").text(ZPServices.PEOPLE_PLUS_SERVICE[item].dispName),serviceDiv.find("span i#succ_ic").remove()):(serviceDiv.addClass("zp_svcConf"),serviceDiv.find("h3").text(ZPI18N.getString("zp.configurationsucc")),serviceDiv.find("span i#succ_ic").remove(),serviceDiv.find("span").append('<i class="IC-IC-task-chk" id="succ_ic"></i>')),eachServiceIter.hasOwnProperty("Orgs")&&eachServiceIter.Orgs.hasOwnProperty("url")?urlDetails[item]=eachServiceIter.Orgs.url:eachServiceIter.hasOwnProperty("url")&&(urlDetails[item]=eachServiceIter.url),serviceDiv.find("span").unbind("click").click(function(){ZPServices.gotoPeopleService(this)}),ZPSetupCommon.isEmpty(appName),ZPServices.removeStatusAppearance(status,serviceDiv,item)):$(serviceDiv).remove();else if(status===ZPServices.View.UnavailStatus)serviceDiv.addClass("zp_svcDis");else if(status===ZPServices.View.UnassMultipleStatus)$(serviceDiv).show(),ZPServices.PEOPLE_PLUS_SERVICE[item].eachServiceIter=eachServiceIter,eachServiceIter.hasOwnProperty("Orgs")&&(ZPServices.PEOPLE_PLUS_SERVICE[item].Orgs=eachServiceIter.Orgs),ZPSetupCommon.isEmpty(appName),ZPServices.removeStatusAppearance(status,serviceDiv,item);else if(status===ZPServices.View.createFrshStatus||status===ZPServices.View.ConflictStatus||status===ZPServices.View.UnassSingleStatus){$(serviceDiv).show(),eachServiceIter.hasOwnProperty("Orgs")&&(ZPServices.PEOPLE_PLUS_SERVICE[item].zaaid=Object.keys(eachServiceIter.Orgs)[0],ZPServices.PEOPLE_PLUS_SERVICE[item].orgid=Object.keys(eachServiceIter.Orgs)[0],eachServiceIter.Orgs[ZPServices.PEOPLE_PLUS_SERVICE[item].orgid].hasOwnProperty("conflict_type")&&(ZPServices.PEOPLE_PLUS_SERVICE[item].conflict_type=eachServiceIter.Orgs[ZPServices.PEOPLE_PLUS_SERVICE[item].orgid].conflict_type,"non_admin_user"==ZPServices.PEOPLE_PLUS_SERVICE[item].conflict_type&&eachServiceIter.Orgs[ZPServices.PEOPLE_PLUS_SERVICE[item].orgid].hasOwnProperty("admins")&&(ZPServices.PEOPLE_PLUS_SERVICE[item].admins=eachServiceIter.Orgs[ZPServices.PEOPLE_PLUS_SERVICE[item].orgid].admins,ZPServices.PEOPLE_PLUS_SERVICE[item].display_name=eachServiceIter.Orgs[ZPServices.PEOPLE_PLUS_SERVICE[item].orgid].display_name)),eachServiceIter.Orgs[ZPServices.PEOPLE_PLUS_SERVICE[item].orgid].hasOwnProperty("fromSoftLink")&&(ZPServices.PEOPLE_PLUS_SERVICE[item].fromSoftLink=!0)),serviceDiv.addClass("zp_svcConf"),eachServiceIter.hasOwnProperty("message")&&(ZPServices.PEOPLE_PLUS_SERVICE[item].message=eachServiceIter.message),ZPSetupCommon.isEmpty(appName),ZPServices.removeStatusAppearance(status,serviceDiv,item),extendedParam={status:"5",result:"Failure"},$.extend(!0,eachServiceIter,extendedParam)}else status!==ZPServices.View.PEOPLEPLUSSERVICE_SERVICEUNAVAILBLEFORDADMIN&&status!==ZPServices.View.notAddedServicetoUser&&status!==ZPServices.View.PEOPLEPLUSSERVICE_SERVICENOTADDEDBYADMIN||$(serviceDiv).remove()},ZPServices.removeStatusAppearance=function(status,serviceDiv,item){status===ZPServices.View.assStatus?(serviceDiv.removeClass("zp_svcConf"),serviceDiv.find("h3").text(ZPServices.PEOPLE_PLUS_SERVICE[item].dispName),serviceDiv.find("span i#succ_ic").remove()):(serviceDiv.removeClass("zp_svcConf"),serviceDiv.addClass("zp_svcDis"),serviceDiv.find("#retry_mode,i#failure_ic").remove(),serviceDiv.find("h3").text(ZPServices.PEOPLE_PLUS_SERVICE[item].dispName),serviceDiv.append('<div class="icon-stat" id="retry_mode"> <div class="ctable"> <div class="ctcell"> <i class="IC-reload" onclick=ZPServices.getPPServiceStatus("'+item+'")></i> <h3>'+ZPI18N.getString("zp.retry")+"</h3> </div> </div> </div>"))},ZPServices.serviceListRow=function(data,isPeoplePlus){var icon,addServiceDV=ZPServices.SERVICE_LIST_DIV;return addServiceDV=(addServiceDV=addServiceDV.replace(/\$SERVICENAME\$/g,data.dispName)).replace(/\$SERVICELBL\$/g,data.tabName),isPeoplePlus?icon={iconClass:"zp_SPls "+data.iconClass,iconColor:data.iconColor}:(icon=Icons.getIconClass(data.icon)).iconClass="zp_Si "+icon.iconClass,addServiceDV=(addServiceDV=addServiceDV.replace(/\$SERVICEICON\$/g,icon.iconClass)).replace(/\$SERVICECOLOR\$/g,icon.iconColor)},ZPServices.resetServicePage=function(event){void 0!=event&&event.preventDefault(),$("#"+Layout.Page.pageId).find("#serviceMainDv .zp_svc").removeClass("zp_sel"),$("#"+Layout.Page.pageId).find("#serviceMainDv .zp_svcpv").remove(),$("#"+Layout.Page.pageId).find("#serviceMainDv .ZPNdata").remove()},ZPServices.showServiceDtl=function(getThis,event){event.preventDefault(),event.stopPropagation();var pageId=$("#"+Layout.Page.pageId);$(getThis).closest(".zp_svc").hasClass("zp_sel")?ZPServices.resetServicePage():(ZPServices.resetServicePage(),setTimeout(function(){var service,descDV;$(getThis).closest(".zp_svc").addClass("zp_sel");var tabName=$(getThis).closest(".zp_svc").attr("tab");if("hrService"===$(getThis).closest(".zp_sRcnt").attr("name"))void 0!=(service=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",tabName,!0))&&(descDV='<div class="zp_svcpv zp_shw" id="serviceDtls">'+ZPServices.constructServiceDtl(service)+"</div>");else if("peopleService"===$(getThis).closest(".zp_sRcnt").attr("name")){var pplService=ZPServices.PEOPLE_PLUS_SERVICE[tabName];pplService&&(descDV='<div class="zp_svcpv zp_shw" id="serviceDtls" style="height: 195px;"><a class="zp_svcls" onclick="ZPServices.resetServicePage(event)"><i class="IC-cls" title="Close"></i></a>'+ZPServices.SERVICE_DESC_DIV.replace(/\$SERVICEDESC\$/g,pplService.desc),descDV+='<div class="zp_btn"><button class="zpthm" onclick="ZPServices.gotoPeopleService(this)">'+ZPI18N.getString("zp.goto",[pplService.dispName])+"</button></div></div>")}if(descDV){var height=parseInt($(getThis).closest(".zp_svc").offset().top+190);$(getThis).closest(".zp_svc").append(descDV),$(getThis).parent().siblings("#serviceDtls").offset({top:height}),pageId.find("#serviceDtls")[0].scrollIntoView({behavior:"smooth"}),ZPServices.SELECTED_SERVICE={},service&&(ZPServices.SELECTED_SERVICE=service,pageId.find("[id=relatedDoc]").off("click").on("click",function(){ZPServices.View.getRelatedDoc(pageId.find("#gotoservicebutton").attr("categoryId"))}))}},200))},ZPServices.constructDesc=function(service){var descDiv="";return void 0!=service.desc&&""!==service.desc&&(descDiv=ZPServices.SERVICE_DESC_DIV.replace(/\$SERVICEDESC\$/g,service.desc)),descDiv='<div class="zp_svcdesc">'+(descDiv+=ZPServices.SERVICE_GOTO_BTN.replace(/\$GOTO\$/g,ZPI18N.getString("zp.goto",[service.dispName])).replace(/\$CATEGORYID\$/g,void 0!=service.categoryid?service.categoryid:"-1"))+"</div>"},ZPServices.constructFormList=function(service){var formList='<div class="zp_flt">';$.each(service.forms,function(index,form){!form.isActive||"true"==is5_0Enabled&&form.isBackend||(formList+='<a onclick="ZPServices.openForm(this,event)" formid="'+form.pcId+'" viewid="'+form.viewId+'">'+form.dispName+(form.isAddPerm?"<span>+</span>":"")+"</a>")}),formList+="</div>";var askUsBtn=!1;return service.hasOwnProperty("enable_hrcase")&&!$.isEmptyObject(ZPTabs.getSelectedTab("hrcase"))&&(askUsBtn=service.enable_hrcase),formList='<div class="zp_svcreq">'+(formList+=ZPServices.View.constructHeaderButton(service.hasReference,service.isServiceAdmin,service.hasFAQList,askUsBtn))+"</div>"},ZPServices.openForm=function(getThis,event){event.preventDefault();var formId=$(getThis).attr("formid");if($(event.target).is("span")){var params={formId:formId,disableUrlTrack:!0};ZPForm.load(params)}else{var viewId=$(getThis).attr("viewid"),serviceName=$(getThis).closest(".zp_svc").attr("tab");window.location.href="#"+ZPServices.getViewFormUrl(serviceName,formId,viewId)}},ZPServices.constructServiceDtl=function(service){var descDiv=ZPServices.SERVICE_CLOSE_HTML;return descDiv+=ZPServices.constructDesc(service),descDiv+=ZPServices.constructFormList(service)},ZPServices.gotoPeopleService=function(getThis){var tabName=$(getThis).closest(".zp_svc").attr("tab");return tabName&&ZPServices.PEOPLE_PLUS_SERVICE[tabName]&&void 0!=urlDetails[tabName]&&window.open(urlDetails[tabName],"_blank","noopener"),!1},ZPServices.gotoService=function(getThis){var tabName=$(getThis).closest(".zp_svc").attr("tab");ZPServices.gotoServicePage(tabName)},ZPServices.gotoServicePage=function(tabName){if(Object.keys(ZPServices.SELECTED_SERVICE).length<1&&(ZPServices.SELECTED_SERVICE=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",tabName,!0)),void 0!=ZPServices.SELECTED_SERVICE&&!ZPServices.setShowMainTab(ZPServices.SELECTED_SERVICE)){ZPTabs.Actions.addTabsInUserTabs(ZPServices.SELECTED_SERVICE);var firstForm=ZPServices.SELECTED_SERVICE.forms[0];window.location.href=void 0==firstForm?"#"+tabName.toLowerCase()+"/generalsettings":"#"+ZPServices.getViewFormUrl(ZPServices.SELECTED_SERVICE.tabName.toLowerCase(),firstForm.pcId,firstForm.viewId)}if(showNewTab){var maintabEle=$("#zp_maintabs");if(0==maintabEle.find('[tabname="'+tabName.toLowerCase()+'"]').length){var tabObj,servicesTab=maintabEle.find('li[tabname="services"]');servicesTab.prev().remove(),$.each(ZPTabs.TAB_JSON,function(idx,tabJSON){tabJSON.name==tabName&&(tabObj=tabJSON)});var tabname=tabObj.name.toLowerCase(),subtabs=ZPTabs.getSubTabs(tabname,tabObj.isSysTab);servicesTab.before($(ZPTabs.getTabHtml(tabname,subtabs,tabObj,{tname:tabname})))}}},ZPServices.setShowMainTab=function(service){var mainTabName=service.tabName;mainTabName=ZPServices.selectTab(mainTabName);var selTab=ZPServices.getObjectFormArray(ZPTabs.TAB_JSON,"name",mainTabName,!0);if(void 0!=selTab){var url=ZPTabs.getMainTabUrl(selTab.subtabs,mainTabName);return void 0!==url&&(window.location.href="#"+url),!0}return!1},ZPServices.getViewFormUrl=function(serviceName,formId,viewId){return void 0!==formId&&void 0!==viewId?serviceName.toLowerCase()+"/form/listview-formId:"+formId+"/viewId:"+viewId:""},ZPServices.search=function(getThis){ZPServices.resetServicePage();var value=$(getThis).val(),searchDiv=Layout.Page.container.find("[tab]");if(ZPUtil.Validation.isEmpty(value))$(searchDiv).show();else{$(searchDiv).hide();for(var servIdx=0;servIdx<ZPServices.SERVICE_JSON.length;servIdx++){var service=ZPServices.SERVICE_JSON[servIdx];if(ZPeople.decodeTxt(service.dispName).match(new RegExp(value,"iu")))Layout.Page.container.find('[tab="'+service.tabName+'"]').show();else{for(var formIdx=0;formIdx<service.forms.length;formIdx++)if(ZPeople.decodeTxt(service.forms[formIdx].dispName).match(new RegExp(value,"iu"))){Layout.Page.container.find('[tab="'+service.tabName+'"]').show();break}if("organization"==service.tabName.toLowerCase()&&service.hasOwnProperty("empHealthFormDetails")&&ZPeople.decodeTxt(service.empHealthFormDetails.dispName).match(new RegExp(value,"iu"))){Layout.Page.container.find('[tab="'+service.tabName+'"]').show();break}}}if(Layout.isPeoplePlus)for(var app in ZPServices.serviceList)ZPeople.decodeTxt(ZPServices.PEOPLE_PLUS_SERVICE[ZPServices.serviceList[app]].dispName).match(new RegExp(value,"iu"))&&Layout.Page.container.find('[tab="'+ZPServices.serviceList[app]+'"]').show();Layout.Page.container.find("[tab]").is(":visible")?Layout.Page.container.find("#serviceMainDv #service_nodata").remove():0===Layout.Page.container.find("#serviceMainDv #service_nodata").length&&Layout.Page.container.find("#serviceMainDv").append(ZPServices.SERVICE_NODATA)}},ZPServices.getNoDataHTML=function(noDataMsg){return'<div class="ZPNdata"><i class="CR-nodata"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><h5 id="zp_views_nodata">'+noDataMsg+"</h5></div>"},ZPServices.addFormInService=function(formsData,isAddForm,serviceName,isActive,serviceId){var currentService;if(void 0!=(currentService=void 0!=serviceName?ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",serviceName,!0):ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"id",serviceId,!0))){var formSubTab,tab=Layout.UrlConf.isSystemService?void 0:ZPServices.getObjectFormArray(ZPTabs.TAB_JSON,"name",serviceName,!0);void 0!=tab&&(formSubTab=tab.subtabs[0],tab.subtabs.length<2&&(formSubTab={isDiretTabs:!0,tabName:"",displayName:ZPI18N.getString("zp.forms"),formArr:[]},tab.subtabs.splice(0,0,formSubTab,{displayName:ZPI18N.getString("zp.analytics"),tabURL:serviceName+"/analytics/list"}),ZPServices.ISTASKTABACTIVE&&tab.subtabs.splice(1,0,{displayName:ZPI18N.getString("zp.tasks"),tabURL:serviceName+"/alltask"})),isAddForm||(formSubTab.formArr=[])),isAddForm||(currentService.forms=[],currentService.activeFormCount=0),$.each(formsData,function(index,form){var formId=form.pcId,formName=form.dispName,viewId=form.viewId;if(void 0==serviceId&&void 0!=$("#accordion")&&$("#accordion").length>0){if(serviceId=currentService.id,0==currentService.activeFormCount){var obj=$("#accordion").find("ul#Tab_"+serviceId);void 0!=obj&&obj.length>0&&obj[0].lastChild.remove()}var formDtls=[{isHidden:!1,isCustom:!0,formId:formId,formName:formName}];tabAndFormsCustom.tabsPageConstruction.formsListConstruction(formDtls,$("#accordion").find("ul#Tab_"+serviceId))}isAddForm?void 0==isActive?currentService.forms.push({dispName:formName,isAddPerm:isadmin,label:form.label,pcId:formId,viewId:viewId,isMoveable:!0,isActive:!0,isEnableDis:!0,isCustom:!0}):(form=formId==ZPeople.EMP_HEALTH_FORMID?currentService.empHealthFormDetails:ZPServices.getObjectFormArray(currentService.forms,"pcId",formId,!0,!0)).isActive=isActive:currentService.forms.push(form);(form.isActive||void 0==isActive)&&(++currentService.activeFormCount,void 0!=formSubTab&&formSubTab.formArr.push({pcId:formId,displayName:formName,tabURL:ZPServices.getViewFormUrl(serviceName,formId,viewId)}))}),ZPTabs.constructSubtabsBasedOnHash(!1,serviceName,"0"===ZPeople.USER_CUST_SETTINGS.USER_TAB_MINIMIZE)}},ZPServices.removeFormInService=function(removeFormIds,serviceName,isActive){var currentService=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",serviceName,!0);if(void 0!=currentService){var tab=Layout.UrlConf.isSystemService?void 0:ZPServices.getObjectFormArray(ZPTabs.TAB_JSON,"name",serviceName,!0),formTabArr=[];void 0!=tab&&void 0!=tab.subtabs[0].formArr&&tab.subtabs[0].formArr.length>0&&(formTabArr=tab.subtabs[0].formArr);var forms=currentService.forms;$.each(removeFormIds,function(index,formId){var form=ZPServices.getObjectFormArray(forms,"pcId",formId,!0,!0);void 0!=form&&(void 0==isActive?forms.splice(form.index,1):form.isActive=isActive,--currentService.activeFormCount);var formTab=ZPServices.getObjectFormArray(formTabArr,"pcId",formId,!0,!0);void 0!=formTab&&formTabArr.splice(formTab.index,1)}),void 0!=tab&&formTabArr.length<1&&tab.subtabs.splice(0,tab.subtabs.length,{displayName:ZPI18N.getString("zp.settings"),tabURL:serviceName+"/generalsettings"}),Layout.CustomizedUrl.getServiceName()===serviceName&&ZPTabs.constructSubtabsBasedOnHash(!1,serviceName,"0"===ZPeople.USER_CUST_SETTINGS.USER_TAB_MINIMIZE)}},ZPServices.addUpdateService=function(serviceId,serviceLName,srName,srSDesc,srvIcon,categoryId,enable_hrcase){var currentService=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",serviceLName,!1);void 0===currentService&&(currentService={categoryid:categoryId,id:serviceId,forms:[],hasFAQList:!1,isApprovalEnabled:!1,icon:"star",isActive:!0,activeFormCount:0},ZPServices.SERVICE_JSON.push(currentService)),currentService.enable_hrcase=enable_hrcase,currentService.tabName=serviceLName,currentService.dispName=srName,currentService.desc=srSDesc;currentService.icon;currentService.icon=srvIcon},ZPServices.updateHasFAQ=function(faqDiv){var service=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",Layout.CustomizedUrl.getServiceName(),!0);void 0!=service&&(service.hasFAQList=faqDiv.find(".zpfaq").length>0)},ZPServices.Configure={addServiceHtml:function(sliderName){return'<div id="newService" class="zp_NSPop active"><div class="zp_popInner"><h4>'+(sliderName=void 0==sliderName?ZPI18N.getString("zp.newservice"):sliderName)+'</h4><i class="IC-cls" onclick="ZPServices.Configure.closeSlide()"></i><div data-placement="bottom" data-toggle="tooltip" data-original-title="'+ZPI18N.getString("zp.chooseicon")+'" class="zp_sIcn"><label id="serIcon" class="zp_serIcn"><i class="zp_Si zp_app0"></i></label></div><div class="zp_formncls"><div id="svNameDiv" class="zp_fm"></div><span class="etxt"></span><div id="svSDescDiv" class="zp_fm"></div><span class="etxt"></span></div><div class="zp_btn"><button class="zpthm zpn_btn" id="svServBtn" onclick="ZPServices.Configure.saveService()"><b>'+ZPI18N.getString("zp.save")+'</b><div class="zp_circular"></div><label>'+ZPI18N.getString("zp.saving")+'</label></button><button onclick="ZPServices.Configure.closeSlide()">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div>"},addNewService:function(){isadmin&&(ZPServices.resetServicePage(),0==$("#"+Layout.Page.pageId).find("#newService").length&&Layout.Page.container.find("#serviceMainDv").append(ZPServices.Configure.addServiceHtml()),ZPServices.Configure.resetPage())},closeSlide:function(){Layout.Page.container.find("#newService").remove()},resetPage:function(){var parentId=$("#"+Layout.Page.pageId).find("#newService");CommonTemplates.removeErrorMessagesinContainerDiv("newService"),CommonTemplates.getInputTextBox({id:"svName",placeholder:ZPI18N.getString("zp.enterservicename")},ZPI18N.getString("zp.name"),!0,parentId.find("[id=svNameDiv]")),parentId.find("[id=serIcon]").off("click").on("click",function(){ZPServices.Configure.chooseIcon(this)}),CommonTemplates.getInputTextBox({id:"svSDesc",placeholder:ZPI18N.getString("zp.enterdesc")},ZPI18N.getString("zp.description"),!0,parentId.find("[id=svSDescDiv]"))},chooseIcon:function(obj){var params=[];$.each(Icons.ICONS_LIST,function(i,v){"add"!=i&&"graduate"!=i&&params.push({iconVal:i,value:"zp_Si "+v})}),$(obj).zparrowmenu({id:"iconsList",data:params,icon:!0,callback:function(listedObj,sourceObj){$(sourceObj).closest("div").attr("class","zp_sIcn "+Icons.getIconClass($(listedObj).attr("iconVal")).iconColor),$(sourceObj).find("i").attr("class",$(listedObj).attr("name"))}})},addNewFormCallBack:function(data){var serviceName=Layout.CustomizedUrl.getServiceName();serviceName==Compensation.CONSTANTS.SERVICENAME&&Layout.CustomizedUrl.refreshTab(!0),ZPServices.View.viewFormList([{pcId:data.formId,dispName:data.formName,isCustom:!0,isEnableDis:!1,label:data.labelName,isExtensionForm:!1}],!0),ZPServices.addFormInService([{pcId:data.formId,dispName:data.formName,label:data.labelName,viewId:data.viewId}],!0,serviceName),window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl("admin/formslayout/formedit",data.formId)},addForm:function(serviceId){AppsCustom.addNewApp({},{tabid:serviceId,successCallback:ZPServices.Configure.addNewFormCallBack})},deleteForm:function(formid){$("#"+Layout.Page.pageId);var params={method:"deleteForm",formid:formid},others={callback:ZPServices.removeFormInService([params.formid],Layout.CustomizedUrl.getServiceName())};ZPeople.Request.send("/formOperations.zp",params,tabCustom.deleteForm,others)},enabledisabelFormCallBack:function(data,others,params){var inObj=others.obj.find("#enbDisForm"),serviceName=(params.hidden,Layout.CustomizedUrl.getServiceName());params.hidden?(inObj.prop("checked",!1),inObj.closest("[formId]").addClass("zp_dAct"),ZPServices.removeFormInService([others.formData.pcId],serviceName,!1)):(inObj.prop("checked",!0),inObj.closest("[formId]").removeClass("zp_dAct"),ZPServices.addFormInService([others.formData],!0,serviceName,!0));var currentService=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",serviceName,!0,!1),forms=$.grep(currentService.forms,function(form){return form});"organization"==currentService.tabName.toLowerCase()&&currentService.hasOwnProperty("empHealthFormDetails")&&forms.push(currentService.empHealthFormDetails),ZPServices.View.viewFormList(forms,!1)},enabledisableForm:function(formData,hidden,obj){var params={method:"formCustOperations",mode:"showhideform",formid:formData.pcId,hidden:hidden},others={formData:formData,obj:obj,successCallback:ZPServices.Configure.enabledisabelFormCallBack};ZPeople.Request.send("/formCustOperations.zp",params,tabCustom.enableDisableForm,others)},validateServiceName:function(headerDiv,excludeName){var data=$.trim($("#"+headerDiv).find("#svName").val());if(excludeName=void 0==excludeName?"":excludeName,$.grep(ZPServices.SERVICE_JSON,function(ele){return decodeHTML(ele.dispName.toLowerCase())==data.toLowerCase()&&data.toLowerCase()!=decodeHTML(excludeName).toLowerCase()}).length>0||""==data||data.length>50){var errorMsg=ZPI18N.getString("zp.serviceavailable");""==data?errorMsg=ZPI18N.getString("zp.serviceempty"):data.length>50&&(errorMsg=ZPI18N.getString("zp.cannotexceedchar",new Array(ZPI18N.getString("zp.hrservicename"),"50"))),CommonTemplates.setErrorMessageinTextBox($("#"+headerDiv).find("#svName"),errorMsg)}else CommonTemplates.removeErrorMessageinTextBox($("#"+headerDiv).find("#svName"))},validateSDesc:function(headerDiv,currentId){var shortDesc=$("#"+headerDiv).find("#"+currentId).val();if(""==$.trim(shortDesc)||shortDesc.length>250){var errorMsg=ZPI18N.getString("zp.servicedesc");shortDesc.length>250&&(errorMsg=ZPI18N.getString("zp.cannotexceedchar",new Array(ZPI18N.getString("zp.description"),"250"))),CommonTemplates.setErrorMessageinTextBox($("#"+headerDiv).find("#"+currentId),errorMsg)}else CommonTemplates.removeErrorMessageinTextBox($("#"+headerDiv).find("#"+currentId))},saveService:function(){var parentId=$("#"+Layout.Page.pageId).find("#newService");CommonTemplates.waitTillSave("svServBtn"),CommonTemplates.removeErrorMessagesinContainerDiv("newService");var servDtl,params={mode:"add"},srName=parentId.find("#svName").val(),srSDesc=parentId.find("#svSDesc").val(),srIcon=parentId.find("#serIcon").find("i").attr("class");srIcon=srIcon.replace("zp_Si",""),servDtl={serviceName:srName,serviceDescription:srSDesc,serviceIcon:Icons.getIconName(srIcon.trim())},params.serviceDtls=JSON.stringify(servDtl),ZPServices.Configure.validateServiceName("newService"),ZPServices.Configure.validateSDesc("newService","svSDesc"),parentId.find("span[class=etxt]:not([class=zp_dyn])").length>0?CommonTemplates.saveComplete("svServBtn"):ZPeople.Request.send("/services.zp",params,function(data){if(CommonTemplates.saveComplete("svServBtn"),"success"==data.status){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.servicesaved")),ZPServices.Configure.closeSlide(),Layout.UrlConf.SERVICE_MODULE.push(data.tabName.toLocaleLowerCase()),ZPServices.addUpdateService(data.id,data.tabName,data.dispName,data.desc,data.icon,data.categoryId,!1);var tabDtls={tabDisplayName:data.dispName,tabName:data.tabName,tabId:data.id,formDetailsMap:[],isLink:!1},switchInfo={isSwitch:!0,switchId:"showhide_"+data.id,isHidden:!1,isCustom:!0,deletemethod:tabAndFormsCustom.tabDeleteMethod,enablemethod:tabAndFormsCustom.tabEnableMethod,title:ZPI18N.getString(Translate.getCurrentUIKey("zp.deletetab","zp.deleteservice")),name:""},tabLen=$("#accordion").find("#tabsPageDiv .col-md-12").length,last=$("#accordion").find("#tabsPageDiv [name=tabDiv] span:contains("+tabLen+")").last();last=$(last).parents("[name=tabDiv]"),$(last).parents("[name=tabColumn]").siblings("[name=tabColumn]").append(tabAndFormsCustom.tabsPageConstruction.tabDiv(tabLen+1,tabDtls,switchInfo)),tabCustom.addNewTabEntry(data.id,data.dispName),window.location.href="#"+data.tabName.toLocaleLowerCase()+"/generalsettings"}else ZPeople.Message.showFailureMsg(data.msg)},"",function(xhr){CommonTemplates.saveComplete("svServBtn");var error_response=xhr.responseText;ZPeople.Message.showFailureMsg(error_response.error)})}},ZPServices.MoveForms={popupHtml:'<div class="zp_whtbg zp_shw" id="moveform"><div class="zp_pop"><div class="zp_Ptl zp_wthBdr"><h3>'+ZPI18N.getString("zp.moveform")+'</h3></div><div id="mvFormCont" class="zp_pcnt">$FORMSDRAGDROP$</div><div class="zp_btn"><button name="closeSlider">'+ZPI18N.getString("zp.close")+'</button></div></div><i name="closeSlider" title='+ZPI18N.getString("zp.close")+' class="IC-cls"></i></div>',dragColumn:'<div name="$ULTYPE$" class="zp_mvFmOut"><div class="zp_ttl">$COLUMNTTL$</div><div class="zp_mvFrm $ALIGN$">$COLFORMS$</div></div>',formsList:'<ul serviceid="$SERVICEID$" isMoveEnable="$ISMOVEABLE$" name="$ULTYPE$" class="zp_fmCont">$FORMSLIST$</ul>',dragableDiv:'<li class="zp_drgBle"></li>',singleForm:'<li $FATTR$ formid="$FORMID$"><i class="$DRAGICON$"></i> $FORMNAME$</li>',noForm:'<li type="noform">'+ZPI18N.getString("zp.noformsavailable")+"</li>",serviceList:'<li serviceid="$SERVICEID$" class=""><span>$SRVDISPNAME$</span>$FRMLST$</li>',allServiceHtml:'<div class="zp_mvSr"><input id="srcTabForm" placeholder="'+ZPI18N.getString("zp.search")+'" type="text"><i class="IC-lens"></i></div><ul>$SRVLIST$</ul>',getFormsAndServices:function(serviceId){ZPeople.Request.send("/getFormAndTabs.zp",{method:"formsAndTabsPage"},function(data){ZPServices.MoveForms.getFormsSlider(data.tabList,serviceId)},"")},search:function(getThis){var parentId=$("#"+Layout.Page.pageId).find("#moveform"),value=$(getThis).val(),searchDiv=parentId.find("li[serviceid]");if(ZPUtil.Validation.isEmpty(value))$(searchDiv).show();else{$(searchDiv).hide();for(var servIdx=0;servIdx<ZPServices.SERVICE_JSON.length;servIdx++){var service=ZPServices.SERVICE_JSON[servIdx];if(ZPeople.decodeTxt(service.dispName).match(new RegExp(value,"iu")))parentId.find('li[serviceid="'+service.id+'"]').show(),parentId.find('li[serviceid="'+service.id+'"]').addClass("zp_heAd");else for(var formIdx=0;formIdx<service.forms.length;formIdx++)if(ZPeople.decodeTxt(service.forms[formIdx].dispName).match(new RegExp(value,"iu"))){parentId.find('li[serviceid="'+service.id+'"]').show(),parentId.find('li[serviceid="'+service.id+'"]').addClass("zp_heAd");break}}}},getFormsSlider:function(data,serviceId){var serviceForms="",allsrvList="";$.each(data,function(i,v){let isMoveEnable=0==v.isFormAddMoveDisable;if(v.id==serviceId){var currForms="";v.hasOwnProperty("forms")&&v.forms.length>0&&(currForms=ZPServices.MoveForms.getFormsList(v.forms));var formsList=ZPServices.MoveForms.formsList;formsList=(formsList=(formsList=formsList.replace("$FORMSLIST$",currForms)).replace("$ULTYPE$","to")).replace("$SERVICEID$",v.id),serviceForms=(serviceForms=(serviceForms=(serviceForms=(serviceForms=(serviceForms=ZPServices.MoveForms.dragColumn).replace("$COLUMNTTL$",v.dispName)).replace("$ALIGN$","zp_aAct")).replace("$COLFORMS$",formsList)).replace("$ULTYPE$","to")).replace("$ISMOVEABLE$",isMoveEnable)}else{var srvHtml=ZPServices.MoveForms.serviceList;srvHtml=(srvHtml=srvHtml.replace("$SRVDISPNAME$",v.dispName)).replace("$SERVICEID$",v.id);var srvForms="";srvForms=v.hasOwnProperty("forms")&&v.forms.length>0?ZPServices.MoveForms.getFormsList(v.forms):ZPServices.MoveForms.noForm,srvHtml=(srvHtml=(srvHtml=(srvHtml=(srvHtml=srvHtml.replace("$FRMLST$",ZPServices.MoveForms.formsList)).replace("$SERVICEID$",v.id)).replace("$FORMSLIST$",srvForms)).replace("$ULTYPE$","from")).replace("$ISMOVEABLE$",isMoveEnable),allsrvList+=srvHtml}});var allForms=ZPServices.MoveForms.dragColumn;allForms=(allForms=(allForms=(allForms=(allForms=allForms.replace("$COLUMNTTL$",ZPI18N.getString("zp.allformsandservices"))).replace("$ALIGN$","")).replace("$COLFORMS$",ZPServices.MoveForms.allServiceHtml)).replace("$SRVLIST$",allsrvList)).replace("$ULTYPE$","from");var sliderHtml=ZPServices.MoveForms.popupHtml;sliderHtml=sliderHtml.replace("$FORMSDRAGDROP$",allForms+serviceForms),Layout.Page.container.append(sliderHtml),Layout.Page.container.find("[name=closeSlider]").off("click").on("click",function(){$(this).closest("#moveform").remove()}),Layout.Page.container.find("li[serviceid]").find("span").off("click").on("click",function(){$(this).closest("li[serviceid]").toggleClass("zp_heAd")}),ZPServices.MoveForms.getDraggableOption(serviceId),Layout.Page.container.find("#srcTabForm").off("keyup").on("keyup",function(){var obj=$(this);setTimeout(function(){ZPServices.MoveForms.search(obj)},500)})},getFormsList:function(formDetailsMap){var currForms="";return $.each(formDetailsMap,function(index,val){var fhtml=ZPServices.MoveForms.singleForm;fhtml=fhtml.replace("$FORMID$",val.pcId);var attribute="";val.isActive||(fhtml=fhtml.replace("$DRAGICON$","IC-lock"),attribute='type="inactive"'),!val.hasOwnProperty("isMoveable")||!val.isMoveable||val.hasOwnProperty("isExtensionForm")&&val.isExtensionForm?fhtml=fhtml.replace("$DRAGICON$","IC-lock"):(fhtml=fhtml.replace("$DRAGICON$","CR-drag"),attribute+=' moveable="true" '),fhtml=(fhtml=fhtml.replace("$FATTR$",attribute)).replace("$FORMNAME$",val.dispName),currForms+=fhtml}),formDetailsMap.length<=0&&(currForms=ZPServices.MoveForms.noForm),currForms},getDraggableOption:function(currentServiceId){var pageId=$("#"+Layout.Page.pageId),isSorted=(pageId.find("#moveform"),!1);pageId.find("ul.zp_fmCont").sortable({handle:".CR-drag",items:"li[formid][moveable=true]",cancel:"li[type=inactive]",connectWith:"[ismoveenable=true]",placeholder:"zp_drgBle",helper:"clone",forceHelperSize:!0,appendTo:"body",containment:"document",dropOnEmpty:!0,distance:.5,scroll:!0,tolerance:"touch",start:function(event,ui){$(ui.helper).addClass("zp_dragList"),$(ui.helper).css({height:"auto"}),startElement=$(this),isSorted=!1,sortType="",senderArray={},receiverArray={}},update:function(ev,ui){endElement=$(this),null==ui.sender?(senderArray.serviceid=$(this).attr("serviceid"),senderArray.forms=[],$.each($(this).find("li"),function(index,obj){senderArray.forms.push($(obj).attr("formid"))}),receiverArray.serviceid=$(this).attr("serviceid"),receiverArray.forms=[],$.each($(this).find("li"),function(index,obj){receiverArray.forms.push($(obj).attr("formid"))}),sortType="reorder"):null!=ui.sender&&(receiverArray.serviceid=$(this).attr("serviceid"),receiverArray.forms=[],$.each($(this).find("li"),function(index,obj){receiverArray.forms.push($(obj).attr("formid"))}),sortType="tag"),isSorted=!0},stop:function(ev,ui){if(isSorted){var formId=$(ui.item).attr("formid"),otherformids=[],currentFormIds=[],receiverserviceName="",receiverlblName="",senderlblName="",formName="";if("reorder"==sortType){if(senderArray.serviceid!=currentServiceId)return $(startElement).sortable("cancel"),void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.moveformnotallowed"));otherformids=senderArray.forms,currentFormIds=senderArray.forms;var currentFormDetails=new Array(currentFormIds.length),otherFormDetails=new Array(otherformids.length);$.each(ZPServices.SERVICE_JSON,function(i,v){if(v.id==currentServiceId)return senderlblName=v.tabName,receiverlblName=v.tabName,receiverserviceName=v.dispName,void $.each(v.forms,function(index,value){var inArray=$.inArray(value.pcId,currentFormIds);-1!=inArray&&(currentFormDetails[inArray]=value,otherFormDetails[inArray]=value)})})}else if("tag"==sortType){if($(endElement).attr("name")==$(startElement).attr("name"))return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.moveformnotallowed")),void $(startElement).sortable("cancel");currentServiceId==receiverArray.serviceid?(currentFormIds=receiverArray.forms,otherformids=senderArray.forms):(currentFormIds=senderArray.forms,otherformids=receiverArray.forms);currentFormDetails=new Array(currentFormIds.length),otherFormDetails=new Array(otherformids.length);var portalerror=!1;if($.each(ZPServices.SERVICE_JSON,function(i,v){if(v.id==senderArray.serviceid||v.id==receiverArray.serviceid){if(v.id==senderArray.serviceid&&(senderlblName=v.tabName),$.each(v.forms,function(index,value){if(formId==value.pcId&&(formName=value.dispName,void 0!=value.isPortal&&1==value.isPortal))return portalerror=!0,!1;var inArray=$.inArray(value.pcId,currentFormIds);-1!=inArray&&(currentFormDetails[inArray]=value);var otherArray=$.inArray(value.pcId,otherformids);-1!=otherArray&&(otherFormDetails[otherArray]=value)}),portalerror)return!1;v.id==receiverArray.serviceid&&(receiverlblName=v.tabName,receiverserviceName=v.dispName)}}),portalerror)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.movecportalformnotallowed")),void $(startElement).sortable("cancel")}var params={method:"formCustOperations",mode:"reorderform",parenttabid:receiverArray.serviceid,formIds:JSON.stringify(receiverArray.forms)};ZPeople.Request.send("/formCustOperations.zp",params,function(data){if("success"==data.msg.trim()){if(ZPServices.View.viewFormList(currentFormDetails,!1),ZPServices.addFormInService(currentServiceId==receiverArray.serviceid?currentFormDetails:otherFormDetails,!1,receiverlblName,!0),receiverlblName!=senderlblName&&ZPServices.removeFormInService([formId],senderlblName.toLowerCase()),"from"==$(endElement).attr("name")){var noform=$(endElement).find("li[type=noform]");noform.length>0&&noform.remove()}"from"==$(startElement).attr("name")&&$(startElement).find("li").length<=0&&$(startElement).html(ZPServices.MoveForms.noForm),"reorder"==sortType?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.reorderformsuccess")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.moveformsuccess",new Array(formName,receiverserviceName)))}else{let errMsg=ZPI18N.getString("zp.ttfailuremsg");"MOVE_RESTRICTED"==data.msg.trim()?($(startElement).sortable("cancel"),errMsg=ZPI18N.getString("zp.cannotmoveformtothisservice")):"extensionservice"==data.msg.trim()&&(errMsg=ZPI18N.getString("zp.extensionservicenoedit")),ZPeople.Message.showFailureMsg(errMsg)}},{},function(resultData){$(startElement).sortable("cancel"),ZPeople.Message.showFailureMsg(resultData.error)})}}})}},ZPServices.Edit={srvHtml:function(){var enableCase="";$.isEmptyObject(ZPTabs.getSelectedTab("hrcase"))||(enableCase='<div class="zp_sttl"><span>'+ZPI18N.getString("zp.addtohrcases")+'</span></div><div class="ZPFnoti zp_addHrC"><div class="FL"><label class="checkbox DIB"><input id="enbHRC" type="checkbox"><span></span></label></div><div class="ZPckmain">'+ZPI18N.getString("zp.enablehrcase")+'<i data-placement="bottom" data-toggle="tooltip" data-original-title="'+ZPI18N.getString("zp.enablehrcaseinfo")+'" class="IC-info"></i></div></div>');var assCont='<div class="zp_sttl"><span>'+ZPI18N.getString("zp.knowledgebase")+"</span></div>"+HRCategory.ConfigureCategory.cloneAddContentsBox();return'<div data-placement="bottom" data-toggle="tooltip" data-original-title="'+ZPI18N.getString("zp.chooseicon")+'" class="zp_sIcn"><label id="serIcon" class="zp_serIcn"><i class=""></i></label></div><div class="zp_formncls"><div id="svNameDiv" class="zp_fm"></div><span class="etxt"></span><div id="svSDescDiv" class="zp_fm"></div><span class="etxt"></span>'+(isPlatformOrg?"":enableCase+'<div id="svAgentDiv" class="zp_fm"></div><span class="etxt"></span>'+assCont)+"</div>"},editService:function(data){var pageId=$("#"+Layout.Page.pageId);pageId.append(CommonTemplates.sliderPop(!0));var parentId=pageId.find("#sliderPopup");if(parentId.find("#sliderContent").html(ZPServices.Edit.srvHtml()),parentId.find("[id=serIcon]").closest("div").addClass(Icons.getIconClass(data.icon).iconColor),parentId.find("[id=serIcon]").find("i").attr("class","zp_Si "+Icons.getIconClass(data.icon).iconClass),parentId.find("[id=serIcon]").off("click").on("click",function(){ZPServices.Configure.chooseIcon(this)}),CommonTemplates.getInputTextBox({id:"svName",value:data.dispName},ZPI18N.getString("zp.name"),!0,parentId.find("[id=svNameDiv]")),CommonTemplates.getInputTextBox({id:"svSDesc",value:data.desc},ZPI18N.getString("zp.description"),!0,parentId.find("[id=svSDescDiv]")),!$.isEmptyObject(ZPTabs.getSelectedTab("hrcase"))){if(parentId.find("#svAgentDiv").addClass("zp_dyn"),CommonTemplates.getSelectMenu(HRCaseDropdown.cgymemberdropdown(),parentId.find("[id=svAgentDiv]"),{id:"svAgent"},{isMandatory:!0,inputHeaderName:ZPI18N.getString("zp.agent")}),data.enable_hrcase&&data.hasOwnProperty("agentDetails")){parentId.find("#svAgentDiv").removeClass("zp_dyn"),parentId.find("#enbHRC").attr("checked","checked"),ownerImage=data.agentDetails.agentTypeId==OWNER_EMPLOYEE.toString()?ZPeople.getUserDetailsById(data.agentDetails.agentValueId).avatar:"";var selectedValObj={id:data.agentDetails.agentValueId,text:data.agentDetails.owner,imageAlt:ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(data.agentDetails.owner))),image:ownerImage};parentId.find("#svAgent").zpselect({selectedVal:[selectedValObj],isMandatory:!0}),parentId.find("#svAgent").attr("agenttype",data.agentDetails.agentTypeId)}else ZPSelect.clearAllValues(parentId.find("#svAgent"));parentId.find("#enbHRC").off("click").on("click",function(){$(this).is(":checked")?parentId.find("#svAgentDiv").removeClass("zp_dyn"):parentId.find("#svAgentDiv").addClass("zp_dyn")})}var referencesObjects;(referencesObjects=data.hasOwnProperty("assoContents")?data.assoContents:[]).length>0&&$.each(referencesObjects,function(i,v){switch(v.formType){case LINK_URL:var linkHtml=HRCategory.ConfigureCategory.cloneAssociatedURLBox("edit");$(linkHtml).insertBefore(parentId.find("div.zp_Add"));var contObj=parentId.find("div[contType]").last();$(contObj).find("#linkUrl").val(decodeURIComponent(v.link));break;case LINK_FILE:var linkName=v.hasOwnProperty("filePath")?v.filePath.split("/")[v.filePath.split("/").length-1]:v.link.split("/")[v.link.split("/").length-1],fileHtml=HRCategory.ConfigureCategory.cloneAssociatedDocumentsBox("edit");$(fileHtml).insertBefore(parentId.find("div.zp_Add"));contObj=parentId.find("div[contType]").last();$(contObj).find("#fName").html(linkName),$(contObj).attr("linkId",v.linkId)}contObj=parentId.find("div[contType]").last();$(contObj).attr("linkId",v.linkId),$(contObj).find("input[type=text]").attr("disabled",!0),""==v.linkName&&$(contObj).find("#linkDispName").closest("div.zp_fm").remove(),$(contObj).find("#linkDispName").val(ZPeople.decodeTxt(v.linkName))}),CommonTemplates.openSlider(ZPI18N.getString("zp.settings")),parentId.find("#submitBtn").off("click"),parentId.find("#submitBtn").on("click",function(){ZPServices.Edit.updateService(data.dispName,data.tabName)}),parentId.find("[name=closeSlider]").off("click").on("click",function(){parentId.remove()})},updateService:function(serviceDispName,serviceLName){var pageId=$("#"+Layout.Page.pageId),parentId=pageId.find("#sliderPopup");CommonTemplates.waitTillSave("submitBtn"),CommonTemplates.removeErrorMessagesinContainerDiv("sliderPopup");var servDtl={},srName=parentId.find("#svName").val(),srSDesc=parentId.find("#svSDesc").val(),sragentTypeId=void 0==parentId.find("#svAgent").attr("agenttype")?"":parentId.find("#svAgent").attr("agenttype"),sragentValueId=void 0==parentId.find("#svAgent").attr("selectedIds")?"":parentId.find("#svAgent").attr("selectedIds"),srIcon=parentId.find("#serIcon").find("i").attr("class");srIcon=srIcon.replace("zp_Si","");var srvIcon=Icons.getIconName(srIcon.trim());servDtl={serviceLName:serviceLName,serviceName:srName,serviceDescription:srSDesc,serviceIcon:srvIcon};var formData=new FormData;formData.append("conreqcsr",csrfToken),$.isEmptyObject(ZPTabs.getSelectedTab("hrcase"))||(parentId.find("#enbHRC").is(":checked")&&""==sragentValueId&&CommonTemplates.setErrorMessageinTextBox(parentId.find("#svAgent"),ZPI18N.getString("zp.selectagent")),servDtl.enable_hrcase=parentId.find("#enbHRC").is(":checked")&&""!=sragentValueId,servDtl.enable_hrcase&&(servDtl.agentType=sragentTypeId,servDtl.agentValue=sragentValueId));var assoContents=[],deleteLinks=[],filecount=0;parentId.find("div[conttype]:not([class=zp_dyn]):not([linkId])").each(function(i){var refObj={};refObj=HRCategory.ConfigureCategory.validateContentBox($(this),filecount,formData),$(this).attr("contType")==LINK_FILE&&(filecount=refObj.file_count),refObj.hasOwnProperty("isError")&&1==refObj.isError?HRCategory.ConfigureCategory.cancelContentBox(this):(refObj.linkOrder=i+1,assoContents.push(refObj))}),parentId.find("div.zp_dyn[linkId]").each(function(i){deleteLinks.push($(this).attr("linkId"))}),servDtl.assoContents=assoContents,servDtl.deleteLinks=deleteLinks.join(","),formData.append("serviceDtls",JSON.stringify(servDtl)),ZPServices.Configure.validateServiceName("sliderPopup",serviceDispName),ZPServices.Configure.validateSDesc("sliderPopup","svSDesc"),parentId.find("span[class=etxt]:not([class=zp_dyn])").length>0?CommonTemplates.saveComplete("submitBtn"):$.ajax({url:"/services.zp?mode=update",type:"POST",data:formData,processData:!1,contentType:!1,async:!1,error:function(xhr){CommonTemplates.saveComplete("submitBtn");var error_response=JSON.parse(xhr.responseText);ZPeople.Message.showFailureMsg(error_response.error)},success:function(data){CommonTemplates.saveComplete("submitBtn"),"success"==data.status?(ZPServices.View.basicTabDetails(data),pageId.find("#edSrv").off("click").on("click",function(){ZPServices.Edit.editService(data)}),ZPServices.addUpdateService(data.id,data.tabName,data.dispName,data.desc,data.icon,data.categoryId,servDtl.enable_hrcase),parentId.find("[name=closeSlider]").trigger("click")):ZPeople.Message.showFailureMsg(data.msg)}})}};var casesFiles={appInfo:{},CURR_UPLOADED_FILES:[],uploadViaXHRs:function(eve,moduleProp){for(var fileStore=eve.files,i=0;i<fileStore.length;i++)CURR_UPLOADED_FILES.push(fileStore[i]),casesFiles.uploadFileByXHR(fileStore[i])},uploadFileByXHR:function(file,moduleProp){var uploadId=(new Date).getTime()+"_"+_LOGGEDIN_ZUID;Layout.ISLOCALIDCSETUP&&(UDS_UPLOAD_SERVICE_CODE=window.location.host.split(".")[0]);var udsUploadApi=UPLOAD_URL+"/"+UDS_UPLOAD_SERVICE_CODE+"/ver1/stream/upload";xhr=new XMLHttpRequest,xhr.instanceKey=xhr.upload.instanceKey=this.instanceKey,xhr.uploadId=xhr.upload.uploadId=uploadId,this.appInfo.portalId=_LOGGEDIN_ACCZSOID,this.appInfo.moduleName="HRCase",this.appInfo.fieldName=moduleProp.fieldName,this.appInfo.formTableName=moduleProp.formTable,xhr.open("post",udsUploadApi,!0),xhr.setRequestHeader("x-assured-response",!0),xhr.setRequestHeader("x-streammode","1"),xhr.setRequestHeader("app-info",JSON.stringify(this.appInfo)),xhr.setRequestHeader("file-info",JSON.stringify({fileName:encodeURIComponent(file.name),contentType:file.type,fileSize:file.size})),xhr.setRequestHeader("upload-id",uploadId),xhr.withCredentials=!0,xhr.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var responseObj=JSON.parse(this.response);casesFiles.uploadCallBack(responseObj,moduleProp)}else 4==this.readyState&&200!=this.status&&(ZPeople.Message.showFailureMsg(uploadedFileInfo.message),void 0!=moduleProp.failureCallback&&"function"==typeof moduleProp.failureCallback&&moduleProp.failureCallback(uploadedFileInfo))},xhr.send(file)},uploadCallBack:function(uploadedFileInfo,moduleProp){if(this.uploadedFileInfo=uploadedFileInfo,uploadedFileInfo.fileInfo){var fileInfo=uploadedFileInfo.fileInfo;void 0!=moduleProp.callback&&"function"==typeof moduleProp.callback&&moduleProp.callback(fileInfo)}else"Failure"==uploadedFileInfo.status&&(ZPeople.Message.showFailureMsg(uploadedFileInfo.message),void 0!=moduleProp.failureCallback&&"function"==typeof moduleProp.failureCallback&&moduleProp.failureCallback(uploadedFileInfo))},generateDownloadURL:function(moduleProp){Layout.ISLOCALIDCSETUP&&(UDS_DOWNLOAD_SERVICE_CODE=window.location.host.split(".")[0]);var obj={portalId:_LOGGEDIN_ACCZSOID,fileId:moduleProp.fileId,submode:moduleProp.fType,recordId:moduleProp.recordId,mode:"HRCase"},eventid=(new Date).getTime()+"_"+_LOGGEDIN_ZUID,myJson=JSON.stringify(obj);return UDS_DOWNLOAD_URL+"/webdownload?x-service="+UDS_DOWNLOAD_SERVICE_CODE+"&event-id="+eventid+"_"+moduleProp.recordId+"&x-cli-msg="+encodeURIComponent(myJson)},getFilePreview:function(fileId,recordId,fileType,displayName,extn,previewFileId){var imgExtn=["jpg","jpeg","gif","png"],textFileExtn=["txt","sql","xml"],zohoDocsFileExtn=["xls","xlsx","sxc","ods","csv","tsv","doc","docx","sxw","odt","rtf","ppt","pptx","pps","odp","sxi"];previewFileId=void 0!=previewFileId?previewFileId:"";var fileParams={fileId:fileId,recordId:recordId,fType:fileType,fileName:unescape(displayName),fileExtn:extn,filePath:previewFileId,allowDownload:!0,fileConfident:0};if(""!=previewFileId&&(fileParams.previewFileId=previewFileId),-1==zohoDocsFileExtn.indexOf(extn)&&-1==imgExtn.indexOf(extn)&&-1==textFileExtn.indexOf(extn)&&"pdf"!=extn)casesFiles.getFileDownload(event,fileId,recordId,fileType,""!=previewFileId);else{Preview.showPreview(fileParams,"HRCase");var pageId=$("#viewPreviewFileDiv"),previewURL="";if(""==previewFileId||"pdf"!=extn&&-1==Files.previewVideoFType.indexOf(extn))if(-1!=zohoDocsFileExtn.indexOf(extn)){$(ZPeople.LOADING_HTML).insertBefore(Layout.Page.container.find(".content-body"));var params={fileId:fileId,recordId:recordId,fileType:fileType,conreqcsr:csrfToken,methodName:"viewCgyFile"};$.ajax({url:"/getCgyFile.zp",type:"POST",data:params,async:!1,success:function(res,textStatus,request){var url=res.url;Files.setUrlIframeToViewFile(url,"HRCase")}})}else{pageId.find(".content-pv").append(ZPeople.LOADING_HTML);var xhr=new XMLHttpRequest,previewData=new FormData;previewData.append("fileId",fileId),previewData.append("recordId",recordId),previewData.append("fileType",fileType),previewData.append("methodName","viewCgyFile"),previewData.append("conreqcsr",csrfToken),xhr.open("post","/getCgyFile.zp"),xhr.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var data_url=URL.createObjectURL(this.response);$(".content-pv").find("#zp_page_loading").remove(),-1!=imgExtn.indexOf(extn)?($("#imageviewFrame").attr("src",data_url),$("#imageviewFrame").off("load"),$("#imageviewFrame").on("load",function(){Files.imgOrgHeight=$("#imageviewFrame").height(),Preview.imgOrgHeight=$("#imageviewFrame").height()})):($("#viewFileFrame").attr("src",data_url),$(window.top.document).find("#viewFileFrame").height($("#viewPreviewFileDiv").height()-120+"px"),-1!=textFileExtn.indexOf(extn)&&$("#preview_body").addClass("pv-txt"))}else 4==this.readyState&&200!=this.status&&ZPeople.Message.showFailureMsg("Error")},xhr.responseType="blob",xhr.send(previewData)}else{previewURL=Files.constructPreviewUrl("HRCase",{filePath:previewFileId,fileId:fileId,recordId:recordId,fType:fileType},extn);Files.setUrlIframeToViewFile(previewURL,"HRCase")}}},getFileDownload:function(event,fileId,recordId,fileType,isUDSUpload){event.stopPropagation(),event.preventDefault(),HRCaseCommon.getFileDownload(event,fileId,recordId,fileType)}},HRCaseFAQ={removeFileDiv:function(obj){Layout.Page.container;var e=window.event;e.cancelBubble=!0,e.stopPropagation(),""!=$(obj).closest("div.attachedFile").attr("fileid")&&void 0!=$(obj).closest("div.attachedFile").attr("fileid")?$(obj).closest("div.attachedFile").addClass("zp_dyn"):$(obj).closest("div.attachedFile").remove()},ziaFaqSearch:function(data,ele){var params={mode:"searchFAQ",conreqcsr:csrfToken};params.searchStr=data.userInput;var faqListDiv="";if(ZPeople.Request.sendAsyncPost("/searchFAQ.zp",params,function(data1){faqListDiv=HRCaseFAQ.listDummy(data1.FAQ_LIST)}),""!=faqListDiv){$(ele).append(faqListDiv);var parent=$(ele).parent();$(parent).attr("style","max-inline-size: 800px; overflow: auto;")}else $(ele).parent().parent().removeClass("noPaddingBotTxt"),$(ele).append("No Results Found")},ziaFaqReport:function(data,ele){var repData={},param={conreqcsr:csrfToken,method:"faqReport"};if(param.faqId=data.faqId,ZPeople.Request.sendAsyncPost("/faqReport.zp",param,function(data1){repData=data1}),jQuery.isEmptyObject(repData)||0==repData.disLikeCount&&0==repData.likeCount)$(ele).parent().parent().removeClass("noPaddingBotTxt"),$(ele).append("No Data Found");else{Solution.constructFaqChart(repData,ele);$(ele).width("400"),$(ele).height("200");var parent=$(ele).parent();$(parent).attr("style","max-inline-size: 800px; overflow: auto;")}},listDummy:function(data,faqQues,ele){var faqListDiv='<div class="ZPNdata"><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><h5 id="zp_views_nodata">'+ZPI18N.getString("zp.nofaqs")+"</h5></div>";return data.length>0&&(faqListDiv="",$.each(data,function(i,faqObj){faqObj='<div class="zp_Lst" id="faqRow" faqId='+faqObj.faqID+'><div><div class="zp_Ldtl "><div class="zp_Tdts"><h3>'+faqObj.query+"</h3><span>"+ZPeople.escapeHtml(ZPFeeds.getTextContent(faqObj.answer))+"</span></div></div></div></div>";faqListDiv+=faqObj}),faqQues=ZSEC.Encoder.encodeForHTML(faqQues),faqListDiv='<div class="zp_cAZfaqHd">'+faqQues+"</div>"+faqListDiv+'<div class="zp_cAZfaqBt"><button btext="yes">'+ZPI18N.getString("zp.notrelevant")+"</button></div>"),faqListDiv},listTaskBot:function(data){return data.length>0&&(faqListDiv="",$.each(data,function(i,taskObj){var rd="";taskObj.endtime==ZPI18N.getString("zp.noduedate")&&(rd="rd");taskObj='<div class="zp_Lst" id="taskRow"><div><div class="zp_Ldtl"><div class="zp_Tdts"><i id="taskBotCmp" class="IC-rou-tik"></i><h3>'+taskObj.name+'</h3></div></div><div class="zp_Lsts"><em class="'+rd+'" title="'+taskObj.endtime+'">'+taskObj.endtime+"</em></div></div></div>";faqListDiv+=taskObj}),faqListDiv='<div class="zp_cAZfaqHd">Pending Task</div>'+faqListDiv),faqListDiv},faqViewBot:function(faqObj){if(faqObj.faqID==$("#faqDetViewBot").attr("faqId"))$("#faqDetViewBot").removeClass("clsZia");else{$("#faqDetViewBot").remove();var param={conreqcsr:csrfToken,method:"singleFAQDetails",faqId:faqObj.faqID,source:"2"};ZPeople.Request.sendAsyncPost("/faqInfoPanel.zp",param,function(data){var v=data[0],grn="",red="",likeHanddisCls="";v.reactObj.hasOwnProperty("isReactedType")&&(likeHanddisCls="cPn",1==v.reactObj.isReactedType?grn="grn":0==v.reactObj.isReactedType&&(red="red"));var moreDiv=faqObj.answer.length>3e3||void 0!=v.filesList&&0!=v.filesList.length?'<div class="zp_txt zp_ln"><a id="faqDetViewBotMor" href="javascript:;">Show More</a></div>':"",mr10=is5_0Enabled?"MR10":"",closeClass=is5_0Enabled?"PI_cls":"IC-cls",faqView='<div id="faqDetViewBot" faqId="'+v.faqID+'" class="zp_cAziaInf"><div class="zp_cAzfIn zp_faqs"><div class="zp_cAzHd"><h3>'+v.query+'</h3><i id="faqDetViewBotCls" class="'+closeClass+'"></i></div><div class="zp_cAzBd"><div id="faqDetViewBotAns" class="zp_txt">'+ZPFeeds.Activity.getRawSmileys(v.answer)+"</div>"+moreDiv+'<div class="zp_pvbt"><div class="zp_txt"><p>'+ZPI18N.getString("zp.helpfull")+'</p><span class="'+likeHanddisCls+" "+mr10+'"><i id="faqDetViewBotLik" class="IC-like '+grn+' "></i><em class="zpl_pl1">'+ZPI18N.getString("zp.yes")+'</em></span><span class="'+likeHanddisCls+'"><i id="faqDetViewBotUnLik" class="IC-unlike '+red+'"></i><em class="zpl_pl1">'+ZPI18N.getString("zp.no")+"</em></span></div></div></div></div></div>";$("body").append(faqView);var faqDetViewBotAns=$("#faqDetViewBotAns");faqDetViewBotAns.height(.7*$("#faqDetViewBot").height()),faqDetViewBotAns.css("overflow","hidden");var removeStyle=faqDetViewBotAns.find("[style]");$(removeStyle).css("line-height","").css("font-weight","").css("font-family","").css("font-size",""),$("#faqDetViewBotCls").off().on("click",function(e){$("#faqDetViewBot").addClass("clsZia")}),$("#faqDetViewBotLik").off().on("click",function(e){FAQ.likeFAQ(this,$("#faqDetViewBot").attr("faqId"),!0)}),$("#faqDetViewBotUnLik").off().on("click",function(e){$(this).hasClass("red")||$("#faqDetViewBotLik").hasClass("grn")||FAQ.disLikeFAQ(this,$("#faqDetViewBot").attr("faqId"),!0)}),$("#faqDetViewBotMor").off().on("click",function(e){var uri=window.location.origin+window.location.pathname;is5_0Enabled?uri+="#hrcase/faq/view-faqId:"+v.faqID:uri+="#hrcase/home/faq-viewid:"+v.faqID,window.open(uri)})})}}},Solution={cgyisAgentKV:{},startFaqList:[],index:1,isNextAvailable:!0,init:function(){var url=Layout.Page.hash,pageDiv=Layout.Page.container;if(-1!==url.indexOf("#hrcase/faq/list/view")){var faqId=Layout.Page.childUrlParam.faqId;Solution.faqDetailedView(faqId)}else-1!==url.indexOf("#hrcase/faq/list")&&(pageDiv.find("#faqDtls").remove(),pageDiv.find("[id=faqRow]").removeClass("sel"))},faqListFireScroll:function(){var pageDiv=Layout.Page.container;pageDiv.find("#faqDtls").remove(),pageDiv.find("[id=faqRow]").removeClass("sel"),Solution.isNextAvailable&&Solution.getFaqList(!0)},reloadSolutionList:function(){var titleDiv=HRCase.Header.headerDiv(ZPI18N.getString("zp.faqAbbre"));titleDiv+='<div class="zp_prvIcns"><ul><li id="faqSchIc"><i class="IC-lens"></i></li></ul></div><div id="faqSearchBar" class="zp_fqSrch DN"><div><label>'+ZPI18N.getString("zp.searchfaq")+'</label><input id="searchFaqInp" type="text"></div></div>',Layout.Page.container.find("[name=headerposition]").empty().append(titleDiv),Solution.getFaqList(!1)},faqToggleSearch:function(){var pageDiv=Layout.Page.container;if(pageDiv.find("#faqSearchBar").toggleClass("DN"),pageDiv.find("#faqSearchBar").hasClass("DN")){if(Solution.startFaqList.length>0){var faqList=pageDiv.find("#faqList");$(faqList).find("[id=faqRow]").remove(),Solution.listRow(Solution.startFaqList,"#faqList"),$(faqList).find(".ZPNdata").remove()}}else pageDiv.find("#searchFaqInp").val(""),pageDiv.find("#searchFaqInp").trigger("focus")},expandCgyDetails:function(getThis){var categoryId=$(getThis).attr("categoryid"),categoryData=HRCategory.userDetails[categoryId];if(void 0==categoryData&&$.isEmptyObject(categoryData)){var categoryprm={method:"fetchCatalogDetails",categoryId:categoryId,conreqcsr:csrfToken,mode:USER_VIEW};$.ajax({url:"/fetchCatalog.zp",type:"POST",data:categoryprm,async:!1,success:function(data){HRCategory.userDetails[categoryId]=data,categoryData=data}})}var pageDiv=Layout.Page.container,faqSideCgyList=pageDiv.find("#faqSideCgyList"),thisCgy=$(faqSideCgyList).find("[cgydetails="+categoryId+"]");if($(faqSideCgyList).find("[categoryid]").not(getThis).removeClass("open"),$(faqSideCgyList).find("[cgydetails]").not(thisCgy).removeClass("open"),$(getThis).addClass("open"),0==$(faqSideCgyList).find("[cgydetails="+categoryId+"]").length){var desc="",agenDetails='<div class="zp_ttl"><span>Agent</span></div>',relContent="";""!=categoryData.description&&"<div><br /></div>"!=categoryData.description&&(desc='<div class="zp_ttl"><span>Descriptions</span><i class="IC-pen-1px"></i></div><div class="zp_txt">'+ZPFeeds.Activity.getSmileys(categoryData.description)+"</div>"),$.each(categoryData.categoryConfiguration,function(i,v){if(agenDetails+=HRCategory.View.cloneAgentRow(v.categoryAgents,!0),0!==v.categoryReferences.length){relContent='<div class="zp_ttl"><span>Related Contents</span></div>';var Agenttag=HRCategory.View.cloneContentRow(v.categoryReferences,categoryId,!0);$(Agenttag).addClass("zp_txt")}});var cgyHtml="<div cgydetails="+categoryId+' class="zp_ctDts open"><div class="zp_Clnd">'+desc+agenDetails+relContent+"</div></div>";$(getThis).after(cgyHtml)}else $(getThis).toggleClass("open"),$(faqSideCgyList).find("[cgydetails="+categoryId+"]").toggleClass("open");var cateDy=pageDiv.find("[cgydetails="+categoryId+"]");$(cateDy).find(".zp_Tg").parent().addClass("zp_txt")},getFaqList:function(isFireScroll){var pageId=Layout.Page.container;pageId.addClass("zp_faqs");if(pageId.find("#faqSchIc").off().on("click",function(e){Solution.faqToggleSearch()}),!isFireScroll){pageId.find("#faqList").addClass("zp_dyn"),pageId.find("#faqRwrap").find(".zp_lwrap").append(ZPeople.LOADING_HTML);var searchFaqInp=pageId.find("#searchFaqInp"),typingTimer=null;$(searchFaqInp).off("keyup").on("keyup",function(e){if(clearTimeout(typingTimer),typingTimer=setTimeout(function(){Solution.searchFAQList()},750),""==pageId.find("#searchFaqInp").val().trim()){var faqList=pageId.find("#faqList");Solution.startFaqList.length>0?($(faqList).find("[id=faqRow]").remove(),Solution.listRow(Solution.startFaqList,"#faqList"),$(faqList).find(".ZPNdata").remove()):(faqListDiv='<div class="ZPNdata"><div><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><label id="zp_views_nodata"><p>'+ZPI18N.getString("zp.nofaqs")+"</p></label></div></div>",$(faqList).append(faqListDiv))}}),$(searchFaqInp).off("keydown").on("keydown",function(e){clearTimeout(typingTimer)})}var param={conreqcsr:csrfToken,method:"faqList",index:Solution.index};ZPeople.Request.send("/faqList.zp",param,function(data){Solution.startFaqList.push.apply(Solution.startFaqList,data.FAQ_LIST),Solution.index+=25,Solution.isNextAvailable=data.isNextAvailable,Solution.listRow(data.FAQ_LIST,"#faqList",!1,!0);var url=Layout.Page.hash;if(pageId.find("#faqList").removeClass("zp_dyn"),pageId.find("#faqRwrap").find("#zp_page_loading").remove(),-1!==url.indexOf("#hrcase/faq/list/view")){var faqId=Layout.Page.childUrlParam.faqId,faqRw=pageId.find("[id=faqRow][faqid="+faqId+"]");$(faqRw).addClass("sel");var topVal=$(faqRw).offset().top;pageId.find("#faqList").scrollTop(topVal-105)}})},searchFAQList:function(){var pageId=Layout.Page.container;if(pageId.find("#searchFaqInp").val().trim().length>=2){Solution.closeSlide(),pageId.find("#faqList").addClass("zp_dyn");var faqList=pageId.find("#faqList");$(faqList).find(".ZPNdata").remove(),pageId.find("#faqRwrap").find(".zp_lwrap").append(ZPeople.LOADING_HTML);var params={mode:"searchFAQ",conreqcsr:csrfToken};params.searchStr=pageId.find("#searchFaqInp").val();faqList=pageId.find("#faqList");$(faqList).find("[id=faqRow]").remove(),ZPeople.Request.send("/searchFAQ.zp",params,function(data){Solution.listRow(data.FAQ_LIST,"#faqList"),pageId.find("#faqList").removeClass("zp_dyn"),pageId.find("#faqRwrap").find("#zp_page_loading").remove()})}},listRow:function(data,id,isDoubleSlider,isFireScroll){var faqListDiv="";if(data.length>0?$.each(data,function(i,faqObj){faqListDiv+='<div class="zp_Lst" id="faqRow" faqId='+faqObj.faqID+'><div><div class="zp_Ldtl "><div class="zp_Tdts"><h3>'+faqObj.query+"</h3><span>"+ZPeople.escapeHtml(ZPFeeds.getTextContent(faqObj.answer))+'</span><em class="red">'+faqObj.catalogName+"</em></div></div></div></div>"}):isFireScroll||(faqListDiv='<div class="ZPNdata"><div><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><label id="zp_views_nodata"><p>'+ZPI18N.getString("zp.nofaqs")+'</p><div id="faqNodataBtn" class="zp_btn"><button id="faqNoBtnAddCase" class="zpthm">'+ZPI18N.getString("zp.askaquestion")+"</button></div></label></div></div>"),faqListDiv=$(faqListDiv),$(id).append(faqListDiv),data.length>0)$.each(faqListDiv,function(i,val){$(val).off().on("click",function(e){isDoubleSlider?HRCaseBand.faqListClick(this,!0):Solution.faqListClick(this)})});else{var faqNoBtn=$(faqListDiv).find("#faqNoBtnAddCase");$(faqNoBtn).off().on("click",function(e){var subject=Layout.Page.container.find("#searchFaqInp").val();Solution.faqNoDataClick(subject)})}},faqNoDataClick:function(subject){Layout.Page.container;HRCaseBand.serviceView(),setTimeout(function(){$("#addHRCase").find("#caseSubject").val(subject)},300)},faqListClick:function(getThis){var faqId=$(getThis).attr("faqid"),url=Layout.Page.hash,pageId=Layout.Page.container;-1!=url.indexOf("#hrcase/faq/list")?(window.location.href="#hrcase/faq/list/view-faqId:"+faqId,pageId.find("#faqDtls").find("#zp_page_loading").remove(),pageId.find("div[faqid]").removeClass("sel"),pageId.find('div[faqid = "'+faqId+'"]').addClass("sel")):-1!=url.indexOf("hrcase/home")?CasesHome.faqListHomeClick(faqId,!0):Solution.faqDetailedView(faqId)},faqDetailedView:function(faqId,id,isDoubleSlider){var pageId=void 0!=id?id:Layout.Page.container,param={conreqcsr:csrfToken,method:"singleFAQDetails",faqId:faqId};ZPeople.Request.sendAsyncPost("/faqInfoPanel.zp",param,function(data){if(pageId.find("#faqDtls").remove(),null!=data&&data.length>0){var v=data[0],iconsHtml=CommonTemplates.getIconMenuBar([{attributes:{onclick:"Solution.copyURL('"+faqId+"')",id:"faqCopyURL"},iconsList:[{class:"IC-url","data-placement":"bottom","data-toggle":"tooltip","data-original-title":ZPI18N.getString("zp.lms.settings.copyurl")}]},{attributes:{onclick:"Solution.closeSlide()",id:"faqClose"},iconsList:[{class:"IC-cls","data-placement":"bottom","data-toggle":"tooltip","data-original-title":ZPI18N.getString("zp.close")}]}]),clearTag=$("<div>"+v.answer+"</div>");$(clearTag).find("[style]").css("font-style","");Solution.cgyisAgentKV[v.categoryId];var fhtml="",filesHtml="";void 0!=v.filesList&&0!=v.filesList.length&&($.each(v.filesList,function(i,val){var extn=val.fileName.substring(val.fileName.lastIndexOf(".")+1),icon=CommonTemplates.getFileIcon(extn);"1"==val.uploadSource||val.filePath.indexOf(workDriveUrl)>-1||val.filePath.indexOf(writerUrl)>-1||val.filePath.indexOf(sheetUrl)>-1||val.filePath.indexOf(showUrl)>-1?(icon="IC-wd",fhtml+='<div class="attachedFile filePosts"  attachcnt="'+i+'1" onclick=window.open("'+val.filePath+'") > <i class="'+icon+' fileType"></i><i onclick=window.open("'+val.filePath+'") class="IC-down"></i><div class="fileNameAndSize" ><label class="fileName" purpose="fileName">'+decodeURIComponent(val.fileName)+'</label> <span purpose="fileSize">'+(null!=val.filesize?val.filesize:"")+"</span> </div></div>"):fhtml+='<div class="attachedFile filePosts"  attachcnt="'+i+'1" onclick="casesFiles.getFilePreview(\''+val.fileUploadId+"','"+v.faqID+"','"+HRCASE_FAQ_ATTACHEMENTS+"','"+escape(val.fileName)+"','"+extn+"','"+(val.hasOwnProperty("previewFileId")?val.previewFileId:"")+'\')"> <i class="'+icon+' fileType"></i><i class="IC-down" onclick="casesFiles.getFileDownload(event,\''+val.fileUploadId+"','"+v.faqID+"','"+HRCASE_FAQ_ATTACHEMENTS+"',"+val.hasOwnProperty("previewFileId")+')"></i><div class="fileNameAndSize" ><label class="fileName" purpose="fileName">'+decodeURIComponent(val.fileName)+'</label> <span purpose="fileSize">'+(null!=val.filesize?val.filesize:"")+"</span> </div> </div>"}),filesHtml='<div class="zp_attach" id="caseAttch"> <div class="zp_pshead">'+ZPI18N.getString("zp.attachment")+'</div><div id="filesAttch" class="zp_Alst">'+fhtml+"</div></div>");var tagsHtml="";if(void 0!=v.tagsArr&&0!=v.tagsArr.length){var singleTag="";$.each(v.tagsArr,function(index,value){singleTag+='<div class="zp_Tg" tagId='+value.tagId+' zpmenu="true">'+value.tagName+"</div>"}),tagsHtml='<div class="zp_pvTgs"><div class="zp_pshead">'+ZPI18N.getString("zp.tags")+' :</div><div class="zp_txt"><div class="zp_Alst">'+singleTag+"</div></div></div>"}var grn="",red="",likeHanddisCls="";v.reactObj.hasOwnProperty("isReactedType")&&(likeHanddisCls="cPn",1==v.reactObj.isReactedType?grn="grn":0==v.reactObj.isReactedType&&(red="red"));var relFaq="";v.hasOwnProperty("relFaqArr")&&(relFaq='<div class="zp_ttl">'+ZPI18N.getString("zp.relfaq")+'</div><div id="relFaqList" class="zp_txt"></div>');var faqReport="";(HRCase.CASES_ADMIN.isAdmin||v.isCgyAgent)&&v.isReportAvailable&&void 0==isDoubleSlider&&(faqReport='<div id="faqReport" class="zp_fQAnls"><i class="IC-chart"></i>'+ZPI18N.getString("zp.analytics")+"</div>");var LikesHtml='<div class="zp_pvbt">'+faqReport+'<div class="zp_txt"><p>'+ZPI18N.getString("zp.helpfull")+' </p><span class="'+likeHanddisCls+'" id="faqLikeIc"><i onclick="FAQ.likeFAQ(this)" id="icLike" class="IC-like '+grn+'"></i><em>'+ZPI18N.getString("zp.yes")+'</em></span><span class="'+likeHanddisCls+'" id="faqDisLikeIc"><i onclick="FAQ.disLikeFAQ(this)" id="icDisLike" class="IC-unlike '+red+'"></i><em>'+ZPI18N.getString("zp.no")+'</em></span></div><div id="faqComDiv" class="zp_txt zp_pvCmts zp_dyn"><p>'+ZPI18N.getString("zp.comment")+'</p><textarea id="faqComment"></textarea><div class="zp_btn"><button onclick="FAQ.disLikeFAQ(this)" class="zpthm">'+ZPI18N.getString("zp.post")+"</button></div></div>"+relFaq+"</div>",faqPwrap='<div id="faqDtlsHeader" class="zp_pvhd"><div class="zp_mark" title="'+v.query+'" id="viewHeader"><span>'+v.query+"</span><div>"+v.catalogName+'</div></div><div class="zp_micn">'+iconsHtml+'</div></div><div class="zp_pvcnt" id="faqPreview"><div class="zp_pvcnt"><div id="faqAnswer"class="zp_Pdesc">'+ZPFeeds.Activity.getRawSmileys(v.answer)+"</div>"+filesHtml+tagsHtml+LikesHtml+"</div></div>",viewPg=void 0!=id?faqPwrap:'<div  id="faqDtls" class="zp_pv zp_faqs"><div id="faqDtlsWrap" class="zp_pwrap">'+faqPwrap+"</div></div>";pageId.append(viewPg),v.hasOwnProperty("relFaqArr")&&Solution.listRow(v.relFaqArr,pageId.find("#relFaqList"),isDoubleSlider);var removeStyle=pageId.find("#faqDtls").find("#faqAnswer").find("[style]");$(removeStyle).css("line-height","").css("font-weight","").css("font-family","").css("font-size",""),pageId.find("#faqReport").off("click").on("click",{faqId:faqId,categoryId:v.categoryId},function(event){Solution.faqReport(event.data.faqId,event.data.categoryId)}),void 0==id&&Layout.Page.container.parent().addClass("zp_Pshw"),-1==Layout.Page.hash.indexOf("#hrcase/faq/list/view")&&pageId.find(".zp_lwrap").addClass("zp_noRwrap");var faqDtls=pageId.find("#faqDtls");$(faqDtls).attr("faqId",faqId)}else ZPeople.Message.showFailureMsg("You don't have permission to view")})},copyURL:function(faqId){var successCopy,tempInput=document.createElement("input"),url="#hrcase/faq/list/view-faqId:"+faqId;tempInput.value=window.location.origin+window.location.pathname+url,document.body.appendChild(tempInput),tempInput.select(),document.execCommand("copy"),document.body.removeChild(tempInput);try{!1===(successCopy=document.execCommand("copy"))?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.copyfailed")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.copysuccess"))}catch(exception){successCopy=!1,ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.copyfailed"))}return successCopy},closeSlide:function(){var pageDiv=Layout.Page.container,pageParenDiv=pageDiv.parent();pageParenDiv.hasClass("zp_Pshw")&&pageParenDiv.removeClass("zp_Pshw"),-1!==Layout.Page.hash.indexOf("#hrcase/faq")&&(window.location.href="#hrcase/faq/list"),pageDiv.find("#faqDtls").remove(),pageDiv.find("#faqList").find("[id=faqRow]").removeClass("sel")},faqReport:function(faqId,categoryId){var pageDiv=Layout.Page.container,param={conreqcsr:csrfToken,method:"faqReport"};param.faqId=faqId,param.categoryId=categoryId,ZPeople.Request.send("/faqReport.zp",param,function(data){var faqRepHtml=Solution.faqReportHtml(data);pageDiv.find("#faqDtls").append(faqRepHtml),0!=data.disLikeCount||0!=data.likeCount?(Solution.constructFaqChart(data,"faqDonutChart"),data.hasOwnProperty("likeEmpArr")&&data.likeEmpArr.length>0?(pageDiv.find("#faqRepWrap").find("[name=faqLikenDisLike][ltype=1]").addClass("sel"),pageDiv.find("#faqDisLikedPpl").addClass("DN"),pageDiv.find("#faqLikedPpl").removeClass("DN")):data.hasOwnProperty("disLikeEmpCmtArr")&&data.disLikeEmpCmtArr.length>0&&(pageDiv.find("#faqRepWrap").find("[name=faqLikenDisLike][ltype=0]").addClass("sel"),pageDiv.find("#faqLikedPpl").addClass("DN"),pageDiv.find("#faqDisLikedPpl").removeClass("DN")),pageDiv.find("#faqDtlsWrap").toggleClass("DN"),pageDiv.find("[name=faqLikenDisLike]").off("click").on("click",function(event){Solution.faqLikenDisLikeToggle($(this).attr("ltype"))})):(pageDiv.find("#faqRepNodata").removeClass("zp_dyn"),pageDiv.find("#faqRepInfo").addClass("DN")),pageDiv.find("#faqRepIcBack").off("click").on("click",function(event){pageDiv.find("#faqRepWrap").remove(),pageDiv.find("#faqDtlsWrap").removeClass("DN")})})},faqLikenDisLikeToggle:function(type){var pageDiv=Layout.Page.container;pageDiv.find("#faqRepWrap").find("[name=faqLikenDisLike]").removeClass("sel"),pageDiv.find("#faqRepWrap").find("[name=faqLikenDisLike][ltype="+type+"]").addClass("sel"),1==type?(pageDiv.find("#faqDisLikedPpl").addClass("DN"),pageDiv.find("#faqLikedPpl").removeClass("DN")):0==type&&(pageDiv.find("#faqLikedPpl").addClass("DN"),pageDiv.find("#faqDisLikedPpl").removeClass("DN"))},faqReportHtml:function(data){var headerDiv='<div class="zp_header"><h2><i id="faqRepIcBack" class="IC-ar-lft"></i><font>'+ZPI18N.getString("zp.analytics")+'</font></h2><div class="zp_prvIcns"><ul><li onclick="Solution.closeSlide()"><i class="IC-cls" data-placement="bottom" data-toggle="tooltip" data-original-title='+ZPI18N.getString("zp.close")+"></i></li></ul></div></div>",noDataHTMl='<div class="ZPNdata zp_dyn" id="faqRepNodata"><div><i class="CR-nodata-rpt"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><label id="zp_views_nodata"><p>'+ZPI18N.getString("zp.nodatafound")+"</p></label></div></div>",faqChartDiv='<div class="zp_FqChrt"><div id="faqDonutChart"></div><div class="zp_rpRts"><ul><li class="grnDt"><span>'+ZPI18N.getString("zp.like")+"</span><em>"+data.likeCount+"</em></li><li><span>"+ZPI18N.getString("zp.dislike")+"</span><em>"+data.disLikeCount+"</em></li></ul></div></div>",likeBar="",likePplHtml="";data.hasOwnProperty("likeEmpArr")&&data.likeEmpArr.length>0&&(likeBar='<li name="faqLikenDisLike" ltype="1"><span> <i class="IC-like"></i> '+ZPI18N.getString("zp.like")+"</span></li>",likePplHtml=Solution.faqLikesPplConstruct(data.likeEmpArr));var disLikeBar="",disLikePplHtml="";return data.hasOwnProperty("disLikeEmpCmtArr")&&data.disLikeEmpCmtArr.length>0&&(disLikeBar='<li name="faqLikenDisLike" ltype="0"><span> <i class="IC-unlike"></i> '+ZPI18N.getString("zp.dislike")+"</span></li>",disLikePplHtml=Solution.faqDisLikesPplConstruct(data.disLikeEmpCmtArr)),'<div id="faqRepWrap" class="zp_pwrap">'+headerDiv+noDataHTMl+'<div class="zp_pvcnt" id="faqRepInfo">'+faqChartDiv+('<div class="zp_csPvTb"><ul>'+likeBar+disLikeBar+"</ul></div>")+likePplHtml+disLikePplHtml+"</div></div>"},faqLikesPplConstruct:function(likeEmpArr){var eachLikeHtml="";return $.each(likeEmpArr,function(key,value){eachLikeHtml+='<li><div class="zp_Tg notg"><div class="ZP_photo pc5" empid='+value.zuid+' popup="user"><img src='+value.employeePhoto+"></div>"+value.name+"</div></li>"}),'<div id="faqLikedPpl" class="zp_TbDts"><ul>'+eachLikeHtml+"</ul></div>"},faqDisLikesPplConstruct:function(disLikeEmpCmtArr){var eachDisLikeHtml="";return $.each(disLikeEmpCmtArr,function(key,value){var comment="";value.hasOwnProperty("comment")&&(comment=value.comment),eachDisLikeHtml+='<div class="zp_TbDslk"><div class="ZP_photo pc5" empid='+value.zuid+' popup="user"><img src='+value.employeePhoto+'></div><div class="zp_tbNdts"><p>'+value.name+"</p><span>"+comment+'</span></div><div class="zp_tbTm">'+value.reactedTime+"</div></div>"}),'<div id="faqDisLikedPpl" class="zp_TbDts">'+eachDisLikeHtml+"</div>"},constructFaqChart:function(data,id){var pageId=Layout.Page.container,chart=new Highcharts.Chart({chart:{renderTo:faqDonutChart,type:"pie"},title:{text:""},credits:{enabled:!1},tooltip:{formatter:function(){return"<b>"+this.point.name+"</b> : "+this.y}},plotOptions:{pie:{showInLegend:!1,states:{hover:{enabled:!0}}},series:{point:{events:{click:function(){0!=this.y&&Solution.faqLikenDisLikeToggle(this.x)}}}}},colors:["#FF7270","#3EE0BA"],series:[{name:"Count",data:[["Dislike",data.disLikeCount],["Like",data.likeCount]],size:"127%",innerSize:"75%",dataLabels:{enabled:!1}}],exporting:{enabled:!1,chartOptions:{title:{text:"Faq Report - "+pageId.find("#faqDtls").attr("faqid")}},plotOptions:{series:{dataLabels:{enabled:!0}}},pie:{showInLegend:!0,dataLabels:{style:{cursor:"pointer"}}},buttons:{contextButton:{theme:{states:{hover:{stroke:"#000000",fill:null},select:{stroke:"#000000",fill:null}}},symbolStroke:"#bfbfbf"}},filename:"Faq Report - "+pageId.find("#faqDtls").attr("faqid")}});chart.innerText=chart.renderer.text("Total User : "+(data.disLikeCount+data.likeCount),120,105).css({fontSize:"16px",textAlign:"center"}).add()}},FAQ={TAGS_LIST:[],relatedFAQ:[],closeFAQSlider:function(){$("#sliderPopup").remove()},showShareFAQSlider:function(obj){var url=Layout.Page.hash,pageId=Layout.Page.container,param={conreqcsr:csrfToken,method:"relatedFAQ"},hasNoti=pageId.find("#zpntfn_modal").length;-1!==url.indexOf("#home/feeds/myfeed")||1==hasNoti?param.caseId=$(obj).closest("#actOuterCont").attr("streamid"):param.caseId=pageId.find("#caseDtls").attr("caseid"),$("#sliderPopup").remove(),$("body").append(CommonTemplates.sliderPop()),$("#sliderName").html(ZPI18N.getString("zp.attachfaq")),$("#sliderPopup").addClass("zp_srchFq zp_shw"),$("#sliderContent").remove(),$("#sliderPopup .zp_pop").append(ZPeople.LOADING_HTML),ZPeople.Request.send("/relatedFAQ.zp",param,function(data){var html="";data.FAQ_LIST.length>0?(html=FAQ.searchFAQList(data.FAQ_LIST,!0),FAQ.relatedFAQ=data.FAQ_LIST):(html='<div class="ZPNdata"><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><h5 id="zp_views_nodata">'+ZPI18N.getString("zp.nosuggestfaq")+"</h5></div>",FAQ.relatedFAQ=[]),FAQ.showFAQ(!0,html);var typingTimer=null;$("#sliderPopup").find("#searchFAQ").off("keyup").on("keyup",function(e){if($("#sliderPopup").find("#searchFAQ").val().trim().length>=3)clearTimeout(typingTimer),typingTimer=setTimeout(function(){FAQ.searchFAQ()},750);else if(""==$("#sliderPopup").find("#searchFAQ").val().trim()&&FAQ.relatedFAQ.length>0){var faqListHtml=FAQ.searchFAQList(FAQ.relatedFAQ,!0);$("#sliderPopup").find("#faqList").empty(),$("#sliderPopup").find("#faqList").append(faqListHtml)}}),$(sliderPopup).find("#searchFAQ").off("keydown").on("keydown",function(e){clearTimeout(typingTimer)})})},showFAQ:function(isSearchInputNeeded,faqListHtml,isCaseId){$("#sliderPopup").find("#zp_page_loading").remove(),$("#sliderPopup").find("#faqList").empty(),void 0!=isCaseId&&$("#sliderPopup").attr("caseId",isCaseId);var html='<div class="zp_pcnt"><div class="zp_Clnd">';isSearchInputNeeded&&(html+='<div class="zp_srchCont"><input type="text" placeholder='+ZPI18N.getString("zp.search")+'  id="searchFAQ"><i class="IC-lens"></i></div>'),html+='<div id="faqList" class="zp_txt">'+faqListHtml+"</div></div></div>",$("#sliderPopup").find(".zp_pop").append(html),$("#sliderPopup").find("#searchFAQ").trigger("focus"),$("#sliderPopup").find("[name=closeSlider]").off("click").on("click",function(){$("#sliderPopup").remove()})},searchFAQList:function(data,isShareButton){var div="";return $.each(data,function(key,value){div+='<div class="zpfaq" faqId='+value.faqID+'><div> <input  type="checkbox">';var toggleClick="";isShareButton&&(div+='<div class="zp_frt zp_micn"><ul><li ><b><div class="zp_hd"></div>  <span onclick ="FAQ.shareFAQ(this)">'+ZPI18N.getString("zp.attachfaq")+"</span></b> </li> </ul></div>",toggleClick='onclick="FAQ.toggleFAQ(this);"'),div+="<label "+toggleClick+' id="faqQuery" >',isShareButton&&(div+='<div class="zp_micn"> <ul> <li><b><div class="zp_hd"></div><span> <i class="IC-ar-rgt"></i></span></b></li></ul></div>'+value.query+"</label>"),div+="<span>"+value.answer,value.hasOwnProperty("filesList")&&(div+='<div class="zp_Alst"><ul>',$.each(value.filesList,function(i,v){"1"==v.uploadSource||v.filePath.indexOf(workDriveUrl)>-1||v.filePath.indexOf(writerUrl)>-1||v.filePath.indexOf(sheetUrl)>-1||v.filePath.indexOf(showUrl)>-1?div+='<li><span onclick=window.open("'+v.filePath+'") ><i class="IC-wd" ></i>'+decodeURIComponent(v.fileName)+"</span></li>":div+="<li><span onclick=\"FAQ.getFileView('"+v.fileUploadId+"','"+value.faqID+"','"+HRCASE_FAQ_ATTACHEMENTS+'\')"><i class="IC-docs"></i>'+decodeURIComponent(v.fileName)+"</span></li>"}),div+="</ul></div>"),div+="</span></div></div>"}),div},shareFAQ:function(ele){var url=Layout.Page.hash;$("#sliderPopup").remove();var faqDiv=$(ele).closest(".zpfaq");if(-1!==url.indexOf("home/feeds/myfeed")){var boxId=$("#actOuterCont").attr("streamid",$(faqDiv).closest("#sliderPopup").attr("caseId")),editor=ZPFeeds.Editor.editorList["cmt_editordiv_"+boxId.find("#cmtlistcont").attr("actfdk")];void 0!==editor&&(ZPFeeds.COMMENTEDITOR=editor)}guru8=ZPFeeds.COMMENTEDITOR;var faqid="sharefaq"+$(faqDiv).attr("faqid"),_faqEle=$(ZPFeeds.COMMENTEDITOR.doc).find("body").html()+'<div class="zp_cVrBx zp_cVfaQ" style="padding: 10px;background-color: #F5F5F5;border-radius: 5px;box-shadow: 0 0 4px rgba(0, 0, 0, 0.1) inset;"><h3 style="margin-top: 5px;"  name="'+faqid+'">'+ZPeople.escapeHtml($(faqDiv).find("#faqQuery").text())+"</h3></div>";ZPFeeds.COMMENTEDITOR.setContent(_faqEle)},searchFAQSlider:function(data){var html='<div class="zp_faqPop"  id="sliderPopup"><div class="zp_popup"> <i class="IC-cls" onclick="FAQ.closeFAQSlider();" ></i>';return 0!=data.length&&$.each(data,function(key,value){html+='<div class="zp_popHd"> <div class="zp_hdtit"><h2> <font>'+value.query+"</font> </h2> </div> </div>"}),html+=' <div class="zp_Pocnt" id="faqList">',html+=" </div> </div> </div>"},searchFAQ:function(faqId){Layout.Page.hash;var params={mode:"searchFAQ",conreqcsr:csrfToken};""!=$("#searchFAQ").val()&&(params.searchStr=$("#searchFAQ").val()),void 0!=faqId&&(params.faqId=faqId),ZPeople.Request.send("/searchFAQ.zp",params,function(data){var html="";0!=data.FAQ_LIST.length?void 0!=faqId?($("body").append(FAQ.searchFAQSlider(data.FAQ_LIST)),html=FAQ.searchFAQList(data.FAQ_LIST,!1)):html=FAQ.searchFAQList(data.FAQ_LIST,!0):void 0!=faqId?($("body").append(FAQ.searchFAQSlider(data.FAQ_LIST)),html='<div class="ZPNdata"><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><h5 id="zp_views_nodata">'+ZPI18N.getString("zp.faqremoved")+"</h5></div>"):html='<div class="ZPNdata"><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><h5 id="zp_views_nodata">'+ZPI18N.getString("zp.nofaqs")+"</h5></div>";var hdheight=$("#sliderPopup").find(".zp_popHd").height();$("#sliderPopup").find("#faqList").css({top:hdheight+"px"}),$("#sliderPopup").find("#faqList").empty().append(html),void 0!=faqId&&$("#sliderPopup").find("#faqList").find(".zpfaq").addClass("zp_drp")})},faqTemplate:function(){var url=Layout.Page.hash,feedSliderObj=Layout.Page.container.find("#zpntfn_modal"),queryHtml='<div class="zp_fm" id="faqQueryDiv"></div><span class="etxt zp_dyn" id="errMsgForQry">'+ZPI18N.getString("zp.mentionthesubject")+"</span>",cancelbtn='<button onclick="FAQ.closeSlider()">'+ZPI18N.getString("zp.cancel")+"</button>",saveAttachbtnHtml="";feedSliderObj.hasClass("in")?saveAttachbtnHtml='<button class="zpthm zpn_btn" id="submitAttachFAQBtn" onclick="FAQ.addFAQ(this)"><b></b><div class="zp_circular"></div><label>'+ZPI18N.getString("zp.saving")+"</label></button>":-1===url.indexOf("#home/feeds/myfeed")&&-1===url.indexOf("#hrcase/list/view")&&-1===url.indexOf("#hrcase/opencases/view")&&-1===url.indexOf("#hrcase/myrequest/view")&&-1===url.indexOf("#hrcase/allcases/view")&&-1===url.indexOf("#hrcase/unassigned/view")&&-1===url.indexOf("#hrcase/watchlist/view")&&-1===url.indexOf("#hrcase/escalation/view")&&-1===url.indexOf("#selfservice/cases/list")&&-1===url.indexOf("#selfservice/mycases/list")&&-1===url.indexOf("#home/dashboard")&&-1===url.indexOf("#hrcase/reports/requestedvsclosed")&&-1===url.indexOf("#hrcase/reports/overallreport")||(saveAttachbtnHtml='<button class="zpthm zpn_btn" id="submitAttachFAQBtn" onclick="FAQ.addFAQ(this)"><b></b><div class="zp_circular"></div><label>'+ZPI18N.getString("zp.saving")+"</label></button>");var saveAndNewBtn="";return-1===url.indexOf("#hrcase/category/view-categoryid")&&-1===url.indexOf("#hrcase/settings/categoryview-categoryid")||(saveAndNewBtn='<button  id="saveAndNewBtn" class="zpthm zpn_btn" saveAndNew="true" onclick="FAQ.addFAQ(this,true)" ><b></b><div class="zp_circular"></div><label>'+ZPI18N.getString("zp.saving")+"</label></button>"),'<div class="zp_whtbg"  id="newFAQ"><div class="zp_pop" id="faqDecEditorContainer"><div class="zp_Ptl"  id="addFaqHeader"><h3  id="faqCgyDiv"></h3></div><form id="addFaqForm" method="POST"  autocomplete="off" enctype="multipart/form-data" target="cgy_file_response" novalidate><div class="zp_pcnt" id="addFaqContent" onscroll="CommonTemplates.scrollfunction(\'addFaqHeader\',\'addFaqContent\')">'+queryHtml+'<div class="zp_fm" id="faqeditor"></div></div></form>'+('<div class="zp_btn"><button  id="submitFAQBtn" class="zpthm zpn_btn"  onclick="FAQ.addFAQ(this,true)" ><b></b><div class="zp_circular"></div><label>'+ZPI18N.getString("zp.saving")+"</label></button>"+saveAndNewBtn+saveAttachbtnHtml+cancelbtn+"</div>")+'</div><i class="IC-cls" title='+ZPI18N.getString("zp.close")+' onclick="FAQ.closeSlider()"></i></div>'},closeSlider:function(){$("body").find("#newFAQ").remove()},showFAQSlider:function(obj){var pageId=Layout.Page.container,url=Layout.Page.hash;$("body").find("#newFAQ").remove(),$("body").append(FAQ.faqTemplate);var cgeName="",cgeId="";pageId.find("#zpntfn_modal").hasClass("in")?(cgeName=$(obj).closest("#actOuterCont").find("#cgyName").text(),cgeId=$(obj).closest("#actOuterCont").find("#cgyName").attr("cgeid")):-1!==url.indexOf("#home/feeds/myfeed")?(cgeName=$(obj).closest("#actOuterCont").find("#cgyName").text(),cgeId=$(obj).closest("#actOuterCont").find("#cgyName").attr("cgeid")):-1!==url.indexOf("#hrcase/settings/categoryview")||-1!==url.indexOf("#hrcase/category/view")?(cgeName="",cgeId=Layout.Page.childUrlParam.categoryid):-1!==url.indexOf("#hrcase/")||-1!==url.indexOf("#selfservice")||-1!==url.indexOf("#home/dashboard")?(cgeName=$("#cgyListInp").prev().text(),cgeId=$("#cgyListInp").attr("selectedids")):(cgeName="",cgeId=pageId.find("#serviceView").attr("categoryid"));var faqHeadingText=""==cgeName?ZPI18N.getString("zp.addfaqbtn"):ZPI18N.getString("zp.addfaq",[cgeName]);$("#faqCgyDiv").text(faqHeadingText),$("#faqCgyDiv").attr("selectedids",cgeId),CommonTemplates.getInputTextBox({id:"faqQueryInput"},ZPI18N.getString("zp.question"),!0,$("#faqQueryDiv")),EditorTemplate.editorConstruct("faqeditor",!0,"addFaqContent"),EditorTemplate.replaceWithEditor("faqDecEditorContainer","descEditor",!0),ZPFeeds.Editor.editorList.descEditor.setContent(""),FAQ.descEditorAfterLoad(),$("#fAtch").remove(),$("#addFaqContent").append(CommonTemplates.chooseFileHtml()),$("#hcDFile").off("click").on("click",function(){HRCaseFileTag.fileUploadfn({id:"0"},$(this),"addFaqContent")}),$("#hcCFile").off("click").on("click",function(){HRCaseFileTag.fileUploadfn({id:"1"},$(this),"addFaqContent")}),$("#hcWFile").off("click").on("click",function(){HRCaseFileTag.fileUploadfn({id:"2"},$(this),"addFaqContent")}),FAQ.addTagsInp(),$("#submitAttachFAQBtn").find("b").html(ZPI18N.getString("zp.saveandattach")),$("#submitFAQBtn").find("b").html(ZPI18N.getString("zp.save")),$("#saveAndNewBtn").find("b").html(ZPI18N.getString("zp.saveNew")),$("#newFAQ").addClass("zp_shw"),setTimeout(function(){$("#addFaqContent").scrollTop($("#faqeditor").offset().top),$("#faqQueryInput").trigger("focus")},300)},editFAQ:function(obj){var pageId=Layout.Page.container,url=Layout.Page.hash;$("body").find("#newFAQ").remove(),$("body").append(FAQ.faqTemplate);var categoryId="";categoryId=-1!==url.indexOf("#hrcase/settings/categoryview")||-1!==url.indexOf("#hrcase/category/view")?Layout.Page.childUrlParam.categoryid:pageId.find("#serviceView").attr("categoryid");var params={mode:"fetchFaq",conreqcsr:csrfToken,faqId:$(obj).closest("div.zpfaq").attr("faqid"),categoryId:categoryId};ZPeople.Request.send("/fetchFaq.zp",params,function(data){CommonTemplates.removeErrorMessagesinContainerDiv("addFaqContent"),$("#addFaqContent").find(".attachedFile").remove(),$("#addFaqContent").attr("deletedfileid",""),$("#addFaqForm").attr("faqId",data.faqId),-1!==url.indexOf("#hrcase/settings/categoryview")||-1!==url.indexOf("#hrcase/category/view")?($("#faqCgyDiv").text(ZPI18N.getString("zp.editfaq")+"'"+pageId.find("#cName").text()+"'"),$("#faqCgyDiv").attr("selectedids",Layout.Page.childUrlParam.categoryid)):($("#faqCgyDiv").text(ZPI18N.getString("zp.editfaq")+"'"+pageId.find("#serviceView").find("#cgeName").text()+"'"),$("#faqCgyDiv").attr("selectedids",data.categoryId)),CommonTemplates.getInputTextBox({id:"faqQueryInput"},ZPI18N.getString("zp.enterquery"),!0,$("#faqQueryDiv")),$("#faqQueryInput").val(data.question),setTimeout(function(){$("#faqQueryInput").trigger("focus")},300),EditorTemplate.editorConstruct("faqeditor",!0,"addFaqContent"),EditorTemplate.replaceWithEditor("faqDecEditorContainer","descEditor",!0),ZPFeeds.Editor.editorList.descEditor.setContent(ZPFeeds.Activity.getRawSmileys(data.answer,!1)),FAQ.descEditorAfterLoad(),$("#fAtch").remove(),$("#addFaqContent").append(CommonTemplates.chooseFileHtml()),$("#hcDFile").off("click").on("click",function(){HRCaseFileTag.fileUploadfn({id:"0"},$(this),"addFaqContent")}),$("#hcCFile").off("click").on("click",function(){HRCaseFileTag.fileUploadfn({id:"1"},$(this),"addFaqContent")}),$("#hcWFile").off("click").on("click",function(){HRCaseFileTag.fileUploadfn({id:"2"},$(this),"addFaqContent")}),$("#addFaqContent").find("div.attachedFile").remove();var fhtml="",filesHtml="";data.hasOwnProperty("Files")&&data.Files.length>0&&($.each(data.Files,function(i,val){var extn=val.fileName.substring(val.fileName.lastIndexOf(".")+1),icon=CommonTemplates.getFileIcon(extn);fhtml+='<div class="attachedFile filePosts" filepath="'+val.filepath+'" fileid="'+val.fileUploadId+'" attachcnt="'+i+'1"  onclick="casesFiles.getFilePreview(\''+val.fileUploadId+"','"+data.faqId+"','"+HRCASE_FAQ_ATTACHEMENTS+"','"+escape(val.fileName)+"','"+extn+"','"+(val.hasOwnProperty("previewFileId")?val.previewFileId:"")+'\')"> <i class="'+icon+' fileType"></i><i onclick="HRCaseFAQ.removeFileDiv(this)" class="IC-cls"></i><div class="fileNameAndSize"><label class="fileName" purpose="fileName">'+decodeURIComponent(val.fileName)+'</label> <span purpose="fileSize">'+(null!=val.filesize?val.filesize:"")+"</span> </div> </div>"}),filesHtml='<div class="zp_attach PL0" id="caseAttch"><div id="attchedFiles" class="zp_Alst clearfix">'+fhtml+"</div></div>"),$("#addFaqContent").append(filesHtml),FAQ.addTagsInp(data.tagsArr),$("#submitFAQBtn").find("b").html(ZPI18N.getString("zp.update")),$("#saveAndNewBtn").addClass("zp_dyn"),$("#newFAQ").addClass("zp_shw"),Solution.closeSlide()})},descEditorAfterLoad:function(){var editor=ZPFeeds.Editor.editorList.descEditor;editor.afterEditorLoad(function(){$(editor.doc).find("body").on("keyup",function(e){var evtobj=window.event?event:e;if(17==evtobj.which||91==evtobj.which||93==evtobj.which||224==evtobj.which){var removeStyle=$(editor.doc).find("body").find("[style]");$(removeStyle).css("line-height","").css("font-weight","").css("font-family","").css("font-size","")}})})},getTagsParamForMenu:function(tagArr){var params=[];return $.each(tagArr,function(index,value){var param1={};param1.text=value.tagName,param1.id=value.tagId,params.push(param1)}),params},addTagsInp:function(selArr){$("#addFaqContent").append('<div class="zp_fm" id="faqTagDiv"></div>');void 0!=selArr&&FAQ.getTagsParamForMenu(selArr);var menuObj={id:"tagsList",data:function(initObj){return FAQ.searchTags($(initObj).val())},enableAddNewItem:!0,checkbox:!0,noDataText:"",addNewData:{callback:function(obj,initobj){$(obj).attr("name").trim().length<2?($(initobj).siblings("div.zp_Tg").find('i[value="'+$(obj).attr("name")+'"]').trigger("click"),ZPeople.Message.showFailureMsg("Tag Length should atleast be 2")):$(obj).attr("name").trim().length>20&&($(initobj).siblings("div.zp_Tg").find('i[value="'+$(obj).attr("name")+'"]').trigger("click"),ZPeople.Message.showFailureMsg("Tag Length should not exceed be 20"))}}};CommonTemplates.getSelectMenu(menuObj,$("#faqTagDiv"),{id:"tagsInp",placeholder:ZPI18N.getString("zp.searchtags")},{isMandatory:!1,inputHeaderName:ZPI18N.getString("zp.tags")}),void 0!=selArr&&selArr.length>0&&$("#tagsInp").zpselect({selectedVal:FAQ.getTagsParamForMenu(selArr),needTag:!0,checkbox:!0,isMandatory:!1})},deleteFAQ:function(obj){var pageId=Layout.Page.container,url=Layout.Page.hash,categoryId="",mode=USER_VIEW;-1!==url.indexOf("#hrcase/settings/categoryview")||-1!==url.indexOf("#hrcase/category/view")?(categoryId=Layout.Page.childUrlParam.categoryid,-1!==url.indexOf("#hrcase/settings/categoryview")&&(mode=ADMIN_VIEW)):categoryId=pageId.find("#serviceView").attr("categoryid"),ZPeople.BSModal.confirm(function(e){var param={mode:"deleteFaq",conreqcsr:csrfToken,faqId:$(obj).closest("div.zpfaq").attr("faqid"),categoryId:categoryId};ZPeople.Request.send("/deleteFAQ.zp",param,function(data){"success"==data.status&&(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.faqdeletesuccessmsg")),HRCategory.View.updateFAQData([{faqID:param.faqId}],categoryId,mode,"delete"),pageId.find("#faqList").find("[faqid="+$(obj).closest("div.zpfaq").attr("faqid")+"]").remove(),!(pageId.find("#faqList").find(".zpfaq").length>0)&&pageId.find("#faqList").append(CommonTemplates.noDataSVG("faqList",!1,ZPI18N.getString("zp.nofaqs"))),Layout.CustomizedUrl.isService()&&ZPServices.updateHasFAQ(pageId.find("#faqList")))})},ZPI18N.getString("zp.deletefaq"),ZPI18N.getString("zp.faqdeletemsg"))},createTagsStr:function(params){var selectedIds=$("#tagsInp").attr("selectedids"),newTags=$("#tagsInp").attr("newvalues");void 0!=selectedIds&&selectedIds.length>0&&(params.tagsIds=selectedIds),void 0!=newTags&&newTags.length>0&&(params.createTags=newTags)},addFAQ:function(ele,isSave){Layout.Page.container,Layout.Page.hash;var isQueryEmpty=!1;if(""!=$("#faqQueryInput").val()&&null!=$("#faqQueryInput").val()&&void 0!=$("#faqQueryInput").val()||(CommonTemplates.setErrorMessageinTextBox($("#faqQueryInput")),isQueryEmpty=!0),!isQueryEmpty){isSave?"saveAndNewBtn"!=$(ele).attr("id")?CommonTemplates.waitTillSave("submitFAQBtn"):CommonTemplates.waitTillSave("saveAndNewBtn"):CommonTemplates.waitTillSave("submitAttachFAQBtn");var editor=ZPFeeds.Editor.editorList.descEditor,faqDesc=ZPFeeds.getSmileysAndMentions(editor.getContent(),!1),params={categoryId:$("#faqCgyDiv").attr("selectedids"),answer:faqDesc,question:$("#faqQueryInput").val()},recordId=$("#addFaqForm").attr("faqId"),deletedFileIds=[],attachment=[];if(void 0!=recordId&&(params.faqId=recordId,$("#addFaqContent div.zp_dyn[fileid]").each(function(i){deletedFileIds.push($(this).attr("fileid"))}),params.deletedFileIds=deletedFileIds.join(",")),FAQ.createTagsStr(params),$("#addFaqContent").find("div.attachedFile:not([fileid])").length>0){var formData=new FormData;formData.append("loginUserZUID",_ZUIDENRYPT),formData.append("formId",0),formData.append("tableName","P_HRCase_FAQ"),formData.append("conreqcsr",csrfToken);var uploadFromCloud=[],uploadFromWD=[],uploadFromDesktop=[];if($("#addFaqContent").find("div.attachedFile:not([fileid])").each(function(i){var uploadMode=$(this).data("uploadMode"),cloudUploadDoc=$(this).data("cloudUploadDoc"),WDUploadDoc=$(this).data("WDUploadDoc"),faqFileUpload=$(this).data("caseFileUpload");"cloudUpload"==uploadMode?uploadFromCloud.push(cloudUploadDoc):"localUpload"==uploadMode&&void 0!==faqFileUpload?uploadFromDesktop.push(faqFileUpload):"workDriveUpload"==uploadMode&&void 0!==WDUploadDoc&&uploadFromWD.push(WDUploadDoc)}),uploadFromDesktop.length>0&&(attachment=uploadFromDesktop,params.attachment=JSON.stringify(uploadFromDesktop),attachment=uploadFromDesktop),uploadFromCloud.length>0||uploadFromWD.length>0)formData.append("uploadFromCloud",JSON.stringify(uploadFromCloud)),formData.append("uploadFromWD",JSON.stringify(uploadFromWD)),formData.append("attachment",JSON.stringify(uploadFromDesktop)),formData.append("needJSONresponse",!0),$.ajax({url:"/fileUploadAction.zp",type:"POST",data:formData,contentType:!1,processData:!1,cache:!1,error:function(err){isSave?CommonTemplates.waitTillSave("submitFAQBtn"):CommonTemplates.waitTillSave("submitAttachFAQBtn");var error_reponse=JSON.parse(err);ZPeople.Message.showFailureMsg(error_reponse.error)},success:function(data){var allFiles=[];7e3==data.code&&$.each(data.message,function(i,v){var fileDetails={filePath:v.filePath,fileName:v.fileName};null==v.uploadSource||ZPSetupCommon.isEmpty(v.uploadSource)?fileDetails.uploadSource=0:fileDetails.uploadSource=v.uploadSource,allFiles.push(fileDetails)});var faqParams=params;faqParams.attachment=JSON.stringify($.merge(allFiles,attachment));var faqParms=[];faqParms.push(faqParams);var pars={faqConf:JSON.stringify(faqParms)};FAQ.addFaqRequest(pars,ele,isSave)}});else{(faqParms=[]).push(params);var pars={faqConf:JSON.stringify(faqParms)};FAQ.addFaqRequest(pars,ele,isSave)}}else{var faqParms;(faqParms=[]).push(params);pars={faqConf:JSON.stringify(faqParms)};FAQ.addFaqRequest(pars,ele,isSave)}}},addFaqRequest:function(object,ele,isSave){var url=Layout.Page.hash,faqParams=JSON.parse(object.faqConf);object.conreqcsr=csrfToken,object.mode="addFaq",$.post("/addFAQ.zp",object,function(data){if("success"==data.status){var isEdit=void 0!=faqParams[0].faqId;if(void 0!=faqParams[0].faqId?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.faqeditsuccessmsg")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.faqsuccessmsg")),"saveAndNewBtn"==$(ele).attr("id")?FAQ.resetFaqSlider():FAQ.closeSlider(),-1!==url.indexOf("#hrcase/settings/categoryview")?(HRCategory.View.updateFAQData(data.FAQLIST,faqParams[0].categoryId,ADMIN_VIEW,isEdit?"edit":"add"),FAQ.singleFaqRecord(data.FAQLIST,data.isAgent,"adminView")):-1!==url.indexOf("#hrcase/category/view")?(HRCategory.View.updateFAQData(data.FAQLIST,faqParams[0].categoryId,USER_VIEW,isEdit?"edit":"add"),FAQ.singleFaqRecord(data.FAQLIST,data.isAgent,"userView")):FAQ.singleFaqRecord(data.FAQLIST,data.isAgent,"adminView"),$(".zp-cmt-faq").remove(),!isSave){if(-1!==url.indexOf("home/feeds/myfeed")){var faqDiv=$(ele).closest(".zpfaq"),boxId=$("#actOuterCont").attr("streamid",$(faqDiv).closest("#sliderPopup").attr("caseId")),editor=ZPFeeds.Editor.editorList["cmt_editordiv_"+boxId.find("#cmtlistcont").attr("actfdk")];void 0!==editor&&(ZPFeeds.COMMENTEDITOR=editor)}$.each(data.FAQLIST,function(key,value){var faqid="sharefaq"+value.faqID,_faqEle=$(ZPFeeds.COMMENTEDITOR.doc).find("body").html()+'<div class="zp_cVrBx zp_cVfaQ" style="padding: 10px;background-color: #F5F5F5;border-radius: 5px;box-shadow: 0 0 4px rgba(0, 0, 0, 0.1) inset;"><h3 style="margin-top: 5px;"  name="'+faqid+'">'+value.query+"</h3></div>";ZPFeeds.COMMENTEDITOR.setContent(_faqEle)})}}else void 0!=faqParams[0].faqId?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.faqeditunsuccessmsg")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.faqunsuccessmsg"))}).fail(function(err){isSave?CommonTemplates.waitTillSave("submitFAQBtn"):CommonTemplates.waitTillSave("submitAttachFAQBtn");var error_reponse=err.responseJSON;"faqConf"==error_reponse.paramName&&"PATTERN_NOT_MATCHED"==error_reponse.code?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.projectattachmentnameerror")):ZPeople.Message.showFailureMsg(error_reponse.error)})},resetFaqSlider:function(){var pageDiv=$("#newFAQ");pageDiv.find("#errMsgForQry").addClass("zp_dyn"),ZPFeeds.Editor.editorList.descEditor.setContent(""),pageDiv.find("#faqTagDiv").find("[zpmenu]").remove(),pageDiv.find("#tagsInp").attr("newvalues","").attr("selectedids",""),pageDiv.find("#attchedFiles").remove(),pageDiv.find("#submitFAQBtn").removeClass("zpn_sbmt").prop("disabled",!1).find("b").html(ZPI18N.getString("zp.save")),pageDiv.find("#saveAndNewBtn").removeClass("zpn_sbmt").prop("disabled",!1).find("b").html(ZPI18N.getString("zp.saveNew")),pageDiv.find("#addFaqForm").removeAttr("zp_recordid"),$("#hcBrowseFile").val(""),pageDiv.find("#faqQueryInput").val(""),setTimeout(function(){pageDiv.find("#faqQueryInput").trigger("focus")},100)},singleFaqRecord:function(data,isAgent,mode){var pageId=Layout.Page.container,faqList=(Layout.Page.hash,""),faqID="";$.each(data,function(key,value){var iconMenu1="adminView"==mode||"userView"==mode&&isAgent?CommonTemplates.getIconMenuBar([{attributes:{onclick:"FAQ.editFAQ(this)"},iconsList:[{class:"IC-pen-1px","data-placement":"bottom","data-toggle":"tooltip","data-original-title":ZPI18N.getString("zp.edit")}]},{attributes:{onclick:"FAQ.deleteFAQ(this)"},iconsList:[{class:"IC-delete","data-placement":"bottom","data-toggle":"tooltip","data-original-title":ZPI18N.getString("zp.delete")}]}]):"",iconMenu2=CommonTemplates.getIconMenuBar([{attributes:{},iconsList:[{class:"IC-ar-rgt"}]}]);if(faqList='<div class="zpfaq" faqid=\''+value.faqID+'\'><div class="bbdr"><input type="checkbox"><div class="zp_frt zp_micn">'+iconMenu1+"</div><label  faqid="+value.faqID+' onclick="Solution.faqListClick(this);" > <div class="zp_micn zp_dyn">'+iconMenu2+"</div>"+value.query+"</label><span >"+value.answer,value.hasOwnProperty("filesList")){faqList+='<div class="zp_Alst zp_hglt"  ><ul>';var fileExtn="";$.each(value.filesList,function(i,v){fileExtn=v.fileName.substring(v.fileName.lastIndexOf(".")+1),faqList+="<li><span onclick=\"casesFiles.getFilePreview('"+v.fileUploadId+"','"+value.faqID+"','"+HRCASE_FAQ_ATTACHEMENTS+"','"+escape(v.fileName)+"','"+fileExtn+"','"+(v.hasOwnProperty("previewFileId")?v.previewFileId:"")+'\')"><i class="IC-docs"></i>'+decodeURIComponent(v.fileName)+"</span></li>"}),faqList+="</ul></div>"}faqList+="</span></div></div>",faqID=value.faqID}),pageId.find("#faqList").find("#noData").remove(),pageId.find("#faqList").find("div[faqid='"+faqID+"']").remove(),pageId.find("#faqList").append(faqList),Layout.CustomizedUrl.isService()&&ZPServices.updateHasFAQ(pageId.find("#faqList"))},faqList:function(data,isAgent,isSlider,mode){Layout.Page.container,Layout.Page.hash;var faqList="";0!=data.length?$.each(data,function(key,value){var iconMenu1="";isSlider||(iconMenu1="adminView"==mode||"userView"==mode&&isAgent?CommonTemplates.getIconMenuBar([{attributes:{onclick:"FAQ.editFAQ(this)"},iconsList:[{class:"IC-pen-1px","data-placement":"bottom","data-toggle":"tooltip","data-original-title":ZPI18N.getString("zp.edit")}]},{attributes:{onclick:"FAQ.deleteFAQ(this)"},iconsList:[{class:"IC-delete","data-placement":"bottom","data-toggle":"tooltip","data-original-title":ZPI18N.getString("zp.delete")}]}]):"");var iconMenu2=CommonTemplates.getIconMenuBar([{attributes:{},iconsList:[{class:"IC-ar-rgt"}]}]),onclick="",togCls="";"adminView"!=mode&&isSlider?onclick="FAQ.toggleFAQ(this);":(onclick="Solution.faqListClick(this);",togCls="zp_dyn");value.faqID;faqList+='<div class="zpfaq"   faqid=\''+value.faqID+'\'><div class="bbdr "><input type="checkbox"><div class="zp_frt zp_micn">'+iconMenu1+"</div><label faqid="+value.faqID+" onclick="+onclick+' > <div class="zp_micn '+togCls+'">'+iconMenu2+"</div>"+value.query+"</label><span>"+value.answer,value.hasOwnProperty("filesList")&&(faqList+='<div class="zp_Alst zp_hglt"><ul>',$.each(value.filesList,function(i,v){"1"==v.uploadSource||v.filePath.indexOf(workDriveUrl)>-1||v.filePath.indexOf(writerUrl)>-1||v.filePath.indexOf(sheetUrl)>-1||v.filePath.indexOf(showUrl)>-1?(icon="IC-wd",faqList+='<li><span onclick=window.open("'+v.filePath+'") ><i class="IC-wd" ></i>'+decodeURIComponent(v.fileName)+"</span></li>"):faqList+="<li><span onclick=\"FAQ.getFileView('"+v.fileUploadId+"','"+value.faqID+"','"+HRCASE_FAQ_ATTACHEMENTS+'\');" ><i class="IC-docs" ></i>'+decodeURIComponent(v.fileName)+"</span></li>"}),faqList+="</ul></div>"),faqList+="</span></div></div>"}):faqList+='<div id="noData" class="ZPNdata"><div><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><label id="zp_views_nodata"><p>'+ZPI18N.getString("zp.nofaqs")+"</p></label></div></div>";var html="";if(isSlider)html=faqList;else{var addIcon="adminView"==mode||"userView"==mode&&isAgent?'<a data-placement="bottom" data-toggle="tooltip" data-original-title='+ZPI18N.getString("zp.add")+' onclick="FAQ.showFAQSlider(this);">'+ZPI18N.getString("zp.add")+"</a>":"";html='<div class="zp_txt" id="faqDiv"  ><div class="zp_ttl">'+ZPI18N.getString("zp.faq")+addIcon+'</div><div id="faqList" class="zp_txt" >'+faqList+"</div></div>"}return html},toggleFAQ:function(obj){var faqDiv=$(obj).parent().parent();$(faqDiv).hasClass("zp_drp")?$(faqDiv).removeClass("zp_drp"):$(faqDiv).addClass("zp_drp")},getFileView:function(fileId,recordId,mode){var params={method:"getFilesDetails",conreqcsr:csrfToken,fileUploadId:fileId,mode:mode};ZPeople.Request.send("/getFileView.zp",params,function(data){$.each(data,function(key,value){var fileExtn=value.fileName.substring(value.fileName.lastIndexOf(".")+1);casesFiles.getFilePreview(value.fileUploadId,recordId,mode,escape(value.fileName),fileExtn,value.hasOwnProperty("previewFileId")?value.previewFileId:"")})})},createUpdateTags:function(tagName,tagId){var tagData={},params={method:"createUpdateTags",tagName:tagName,conreqcsr:csrfToken};return void 0!=tagId&&(params.tagId=tagId),ZPeople.Request.sendAsyncPost("/createUpdateTags.zp",params,function(data){jQuery.isEmptyObject(data)||(tagData.value=data.tagName,tagData.id=data.tagId,FAQ.TAGS_LIST.push(data))}),tagData},LikeOrDisLikeFaq:function(recordId,type,comment){var params={method:"LikeOrDisLikeFaq",recordId:recordId,type:type,conreqcsr:csrfToken};void 0!=comment&&comment.length>0&&(params.comment=comment);var status="";return ZPeople.Request.sendAsyncPost("/LikeOrDisLikeFaq.zp",params,function(data){status=data.status}),status},likeFAQ:function(getThis,faqId,isFromBot){var pageDiv=$(getThis).closest("#faqDtls");$(getThis).hasClass("grn")||$("#faqDetViewBotUnLik").hasClass("red")&&pageDiv.find("#icDisLike").hasClass("red")||(void 0!=faqId&&""!=faqId||(faqId=pageDiv.attr("faqid")),"success"==FAQ.LikeOrDisLikeFaq(faqId,1)&&($(getThis).addClass("grn"),isFromBot||pageDiv.find("#faqComDiv").addClass("zp_dyn")))},disLikeFAQ:function(getThis,faqId,isFromBot){var pageDiv=$(getThis).closest("#faqDtls"),faqComDiv=pageDiv.find("#faqComDiv");if(isFromBot||$(getThis).hasClass("red")||pageDiv.find("#icLike").hasClass("grn")||!$(faqComDiv).hasClass("zp_dyn")){if(isFromBot||!pageDiv.find("#icDisLike").hasClass("red")&&!pageDiv.find("#icLike").hasClass("grn")&&!$(faqComDiv).hasClass("zp_dyn")){void 0!=faqId&&""!=faqId||(faqId=pageDiv.attr("faqid"));var comment="";isFromBot||(comment=pageDiv.find("#faqComment").val()),"success"==FAQ.LikeOrDisLikeFaq(faqId,0,comment)&&(isFromBot?$(getThis).addClass("red"):pageDiv.find("#icDisLike").addClass("red"),isFromBot||$(faqComDiv).addClass("zp_dyn"))}}else $(faqComDiv).removeClass("zp_dyn")},searchTags:function(tagStr,recordId){var tagsArr=[];if((tagStr=void 0==tagStr||""==tagStr?"":tagStr).length>=2){var params={method:"searchTags",conreqcsr:csrfToken};void 0!=tagStr&&(params.tagStr=tagStr.trim()),void 0!=recordId&&(params.recordId=recordId),ZPeople.Request.sendAsyncPost("/searchTags.zp",params,function(data){$.each(data,function(index,value){var param1={};param1.value=value.tagName,param1.id=value.tagId,tagsArr.push(param1)})})}return tagsArr},getAllTags:function(){var params={method:"getAllTags",conreqcsr:csrfToken};ZPeople.Request.sendAsyncPost("/getAllTags.zp",params,function(data){FAQ.TAGS_LIST=data})}},CasesHome={recentFAQ:[],faqMode:"",intialSetup:function(){CasesHome.faqMode="recentFaq";var pageDiv=Layout.Page.container;$.isEmptyObject(HRCase.STATUS)&&HRCases.getStatusList();var intialHtml='<div class="zp_content" id="casesHomeCont"> <div class="zp_cScatUr"> <div class="zp_cScatIn"> <div id="homeCgyPar" class="zp_cScatLst zp_cSUpFrnt"> <div class="zp_cScatLsIn" id="homeCgyList"></div> </div> <div class="zp_cScatSrh" > <h2>'+ZPI18N.getString("zp.gotaquestion")+"</h2> <p>"+ZPI18N.getString("zp.findyouranswers")+'</p> <div class="zp_cScatSrIn" id="faqSearchBar"> <input type="text" placeholder="'+ZPI18N.getString("zp.searchfaq")+'" id="faqSearchInp"> <button id="faqSearchBtn">'+ZPI18N.getString("zp.findhelp")+'</button> </div> <div  id="recentFaqPar" class="zp_cScatSrRt"> <div class="zp_cScatSrRtIn" id="recentFaqDiv"> <h3 id="searchTit">'+ZPI18N.getString("zp.recentfaq")+'</h3><span id="recentFaqCls">'+ZPI18N.getString("zp.close")+'</span><button id="moreFaq">'+ZPI18N.getString("zp.more")+'</button> <ul class="zp_cScatFqLst" id="faqHSearchList"></ul> <div id="notRelAskQue" class="zp_rsNwcs DN"><p><a id="notRelAskQueBtn">'+ZPI18N.getString("zp.notrelevant")+'</a></p></div></div> <div class="zp_pv zp_faqs" id="faqDtls"><div id="faqpwrap" class="zp_pwrap"></div></div> </div> </div> </div> </div>';pageDiv.append(intialHtml);var agentCgyIds=[];HRCategory.USERVIEW_CATEGORY_LIST.length<=0&&HRCategory.getCgyList(USER_CGY_LISTING),$.each(HRCategory.USERVIEW_CATEGORY_LIST,function(i,cgyObj){var iconObj=Icons.getIconClass(cgyObj.categoryIcon),isAgent=cgyObj.hasOwnProperty("isAgent")&&cgyObj.isAgent,agentTag=isAgent?'<i name="cgyAgentMore" class="IC-pen"></i><div class="zp_Tg" zpmenu="true">'+ZPI18N.getString("zp.agent")+"</div>":"",cgyLi='<div class="zp_crd zp_cScatCrd"><div class="zp_crdInn"><div class="zp_licn SC1"><label class="zp_serIcn"><i class="'+iconObj.iconClass+' zp_Si"></i></label>'+agentTag+'</div><div class="zp_dtl"><div class="zp_ctit"><b>'+cgyObj.categoryName+"</b><span>"+cgyObj.categoryShortDescription+'</span><button id="cgyAskUs">'+ZPI18N.getString("zp.askus")+"</button></div></div></div></div>";pageDiv.find("#homeCgyList").append(cgyLi);var addcasemode=cgyObj.hasOwnProperty("isAgent")&&cgyObj.isAgent||HRCase.isCaseAdmin(cgyObj.categoryId)?HRCase.AgentAddMode:ZPeople.SUB_USERLIST.length>1?HRCase.ManagerAddMode:"";pageDiv.find("#homeCgyList").find("[id=cgyAskUs]:last").off("click").on("click",{mode:addcasemode,categoryId:cgyObj.categoryId},function(event){window.location.href="#hrcase/askus-categoryid:"+event.data.categoryId}),isAgent&&(pageDiv.find("[name=cgyAgentMore]:last").on("click",{categoryId:cgyObj.categoryId},function(event){event.stopPropagation(),event.preventDefault(),window.location.href="#hrcase/category/view-categoryid:"+event.data.categoryId}),agentCgyIds.push(cgyObj.categoryId))}),pageDiv.find("#homeCgyPar").data("agentCgyIds",agentCgyIds);var param={conreqcsr:csrfToken,method:"faqList",mode:"recentFaq",index:0};ZPeople.Request.sendAsyncPost("/faqList.zp",param,function(data){data.FAQ_LIST.length>0&&(CasesHome.recentFAQ=data.FAQ_LIST,CasesHome.faqHomeSearchList(data.FAQ_LIST,"recentFaq"))}),pageDiv.find("#moreFaq").on("click",function(e){e.stopPropagation(),pageDiv.find("#faqHSearchList").html(""),pageDiv.find("#recentFaqPar").addClass("toggle fullScreen"),pageDiv.find("#moreFaq").addClass("DN"),CasesHome.faqHomeSearchList(pageDiv.find("#faqSearchInp").data("searchFaq"),"moreFaq")}),pageDiv.find("#faqSearchBtn").on("click",function(e){e.stopPropagation()}),pageDiv.find("#recentFaqPar").on("click",function(e){e.stopPropagation()}),pageDiv.find("#recentFaqCls").on("click",function(e){e.stopPropagation(),CasesHome.recentFaqClose()}),pageDiv.find("#casesHomeCont").on("click",function(e){e.stopPropagation(),CasesHome.recentFaqClose()}),pageDiv.find("#notRelAskQueBtn").off().on("click",function(e){Solution.faqNoDataClick(pageDiv.find("#faqSearchInp").val().trim())});var faqSearchInp=pageDiv.find("#faqSearchInp");$(faqSearchInp).on("click",function(e){e.stopPropagation(),""==$(faqSearchInp).val().trim()&&0!=CasesHome.recentFAQ.length&&(pageDiv.find("#moreFaq").addClass("DN"),pageDiv.find("#notRelAskQue").addClass("DN"),pageDiv.find("#searchTit").text(ZPI18N.getString("zp.recentfaq")),pageDiv.find("#homeCgyPar").removeClass("zp_cSUpFrnt"),pageDiv.find("#faqHSearchList").html(""),CasesHome.faqHomeSearchList(CasesHome.recentFAQ,"recentFaq"),pageDiv.find("#recentFaqPar").addClass("toggle"))});var typingTimer=null;pageDiv.find("#faqSearchInp").off("keyup").on("keyup",function(e){if(clearTimeout(typingTimer),typingTimer=setTimeout(function(){CasesHome.searchHomeFAQList()},750),""==pageDiv.find("#faqSearchInp").val().trim()){var faqList=pageDiv.find("#faqHSearchList");$(faqList).find(".ZPNdata").remove(),$(faqList).find("li").remove(),pageDiv.find("#faqHSearchList").find("[id=zp_page_loading]").remove(),pageDiv.find("#searchTit").text(ZPI18N.getString("zp.recentfaq")),pageDiv.find("#moreFaq").addClass("DN"),pageDiv.find("#notRelAskQue").addClass("DN"),CasesHome.recentFAQ.length>0?($(faqList).find("li").remove(),CasesHome.faqHomeSearchList(CasesHome.recentFAQ,"recentFaq"),$(faqList).find(".ZPNdata").remove()):(faqListDiv='<div class="ZPNdata"><div><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><label id="zp_views_nodata"><p>'+ZPI18N.getString("zp.nofaqs")+'</p><div id="faqNodataBtn" class="zp_btn"><button id="faqNoBtnAddCase" class="zpthm">'+ZPI18N.getString("zp.askaquestion")+"</button></div></label></div></div>",$(faqList).append(faqListDiv),CasesHome.faqNoDataClick())}}),pageDiv.find("#faqSearchInp").off("keydown").on("keydown",function(e){clearTimeout(typingTimer)})},recentFaqClose:function(){var pageDiv=Layout.Page.container;pageDiv.find("#recentFaqPar").hasClass("fullScreen")?(pageDiv.find("#faqHSearchList").html(""),pageDiv.find("#recentFaqPar").removeClass("fullScreen"),pageDiv.find("#moreFaq").removeClass("DN"),CasesHome.faqHomeSearchList(pageDiv.find("#faqSearchInp").data("searchFaq"),"searchFaq")):(pageDiv.find("#faqSearchInp").val(""),CasesHome.faqMode="recentFaq",pageDiv.find("#recentFaqPar").removeClass("toggle zp_Pshw fullScreen"),setTimeout(function(){pageDiv.find("#homeCgyPar").addClass("zp_cSUpFrnt")},200))},init:function(){var pageDiv=Layout.Page.container,url=Layout.Page.hash;if("#hrcase/home"!=url&&-1===url.indexOf("#hrcase/askus")||CasesHome.recentFaqClose(),$("#sliderPopup").remove(),$("#newFAQ").remove(),-1!==url.indexOf("#hrcase/askus")){var categoryId=Layout.Page.childUrlParam.categoryid,addcasemode=pageDiv.find("#homeCgyPar").data("agentCgyIds").includes(categoryId)||HRCase.isCaseAdmin(categoryId)?HRCase.AgentAddMode:ZPeople.SUB_USERLIST.length>1?HRCase.ManagerAddMode:"";HRCase.AddCase.addCasePage(addcasemode,categoryId)}else if(-1!==url.indexOf("#hrcase/home/faq")){var faqId=Layout.Page.childUrlParam.viewid;pageDiv.find("#faqSearchInp").trigger("click"),CasesHome.faqListHomeClick(faqId,!1),pageDiv.find("#homeCgyPar").removeClass("zp_cSUpFrnt")}},searchHomeFAQList:function(){var pageId=Layout.Page.container;if(pageId.find("#faqSearchInp").val().trim().length>=2){var faqList=pageId.find("#faqHSearchList");$(faqList).find(".ZPNdata").remove(),$(faqList).find("li").remove(),pageId.find("#faqHSearchList").find("[id=zp_page_loading]").remove(),pageId.find("#faqHSearchList").append(ZPeople.LOADING_HTML),pageId.find("#searchTit").text(ZPI18N.getString("zp.searchfaq"));var params={mode:"searchFAQ",conreqcsr:csrfToken};params.searchStr=pageId.find("#faqSearchInp").val(),ZPeople.Request.send("/searchFAQ.zp",params,function(data){$(faqList).find(".ZPNdata").remove(),$(faqList).find("li").remove(),pageId.find("#faqHSearchList").find("[id=zp_page_loading]").remove(),data.FAQ_LIST.length>0?(data.FAQ_LIST.length>5?pageId.find("#moreFaq").removeClass("DN"):pageId.find("#moreFaq").addClass("DN"),pageId.find("#notRelAskQue").removeClass("DN"),CasesHome.faqHomeSearchList(data.FAQ_LIST,"searchFaq")):(pageId.find("#homeCgyPar").removeClass("zp_cSUpFrnt"),pageId.find("#recentFaqPar").addClass("toggle"),pageId.find("#moreFaq").addClass("DN"),pageId.find("#notRelAskQue").addClass("DN"),faqListDiv='<div class="ZPNdata"><div><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><label id="zp_views_nodata"><p>'+ZPI18N.getString("zp.nofaqavail")+'</p><div id="faqNodataBtn" class="zp_btn"><button id="faqNoBtnAddCase" class="zpthm">'+ZPI18N.getString("zp.askaquestion")+"</button></div></label></div></div>",$(faqList).append(faqListDiv),CasesHome.faqNoDataClick()),pageId.find("#faqHSearchList").find("[id=zp_page_loading]").remove()})}},faqNoDataClick:function(){var pageDiv=Layout.Page.container;pageDiv.find("#faqNoBtnAddCase").off().on("click",function(e){var subject=pageDiv.find("#faqSearchInp").val();Solution.faqNoDataClick(subject)})},faqListHomeClick:function(faqId,isRelatedFaq){var pageDiv=Layout.Page.container,url=Layout.Page.hash,recentFaqPar=pageDiv.find("#recentFaqPar"),recentClass=pageDiv.find("#faqClose").data("class");pageDiv.find("#faqpwrap").html(""),Solution.faqDetailedView(faqId,pageDiv.find("#faqpwrap"),!1),pageDiv.find("#faqDtls").attr("faqid",faqId);var faqClose=pageDiv.find("#faqClose");isRelatedFaq||(recentClass=$(recentFaqPar).attr("class")),faqClose.data("class",recentClass),faqClose.removeAttr("onclick"),faqClose.on("click",function(e){e.stopPropagation(),$(recentFaqPar).attr("class",pageDiv.find("#faqClose").data("class")),-1!==url.indexOf("#hrcase/home/faq")&&(window.location.href="#hrcase/home")}),$(recentFaqPar).addClass("zp_Pshw fullScreen")},faqHomeSearchList:function(faqList,mode){var pageDiv=Layout.Page.container,faqSearchInp=pageDiv.find("#faqSearchInp");"searchFaq"!=mode&&"recentFaq"!=mode||(CasesHome.faqMode=mode),$(faqSearchInp).data(mode,faqList),$.each(faqList,function(i,faqObj){if(null!=faqObj&&void 0!=faqObj&&""!=faqObj){var faqLi="<li><p>"+faqObj.query+'</p><a href="javascript:;">'+faqObj.catalogName+"</a></li>";pageDiv.find("#faqHSearchList").append(faqLi);var li=pageDiv.find("#faqHSearchList").find("li:last");if($(li).on("click",{faqId:faqObj.faqID},function(event){event.stopPropagation(),CasesHome.faqListHomeClick(event.data.faqId,!1)}),"searchFaq"==mode||"recentFaq"==mode)return CasesHome.faqMode=mode,i<4}})}},Profile={};Profile={PROFILE_COMPONENTS:{},CURR_COMPONENT:{},COMPONENT:null,init:function(){var editMode=!1,recordId=erecno;if(void 0!==Layout.Page.urlparam.id?recordId=Layout.Page.urlparam.id:void 0!==Layout.Page.urlparam.editId&&(recordId=Layout.Page.urlparam.editId,editMode=!0),Profile.populateUserInfoCont(),Layout.Page.container.find("#zp_selfservice_profilepage").addClass("DN"),void 0===Profile.PROFILE_COMPONENTS[recordId]&&(Profile.PROFILE_COMPONENTS[recordId]={isRefresh:!0}),Profile.COMPONENT=Profile.PROFILE_COMPONENTS[recordId],Profile.setUserComponent(recordId),editMode)Layout.Page.container.find("#zp_profile_print, #zp_profile_edit").addClass("DN");else{var permission=ZPForm.Permission.getEditPerm(),allowedpersons=ZPForm.Permission.isAllowed([Layout.Page.urlparam.id],permission);isadmin||allowedpersons?Layout.Page.container.find("#zp_profile_edit").removeClass("DN"):Layout.Page.container.find("#zp_profile_edit").addClass("DN"),void 0===Layout.Page.urlparam.id||erecno===Layout.Page.urlparam.id||isadmin?Layout.Page.container.find("#zp_profile_print").removeClass("DN"):Layout.Page.container.find("#zp_profile_print").addClass("DN")}Layout.Page.container.find("#zp_profilergt_container").empty(),Profile.CURR_COMPONENT={formId:ZPeople.EMP_FORMID,recordId:recordId,isPageMode:!0,isProfile:!0,formMode:editMode?"EDIT":"VIEW",containerId:"zp_selfservice_profilepage",callback:Profile.get,loadingContainer:"zp_selfservice_page_container",onloadProfileCallback:Profile.setFavorites},ZPForm.load(Profile.CURR_COMPONENT),editMode?Layout.Page.container.find("#zp_profilergt_container").hide():Layout.Page.container.find("#zp_profilergt_container").show()},get:function(erec,mode){"edit"===mode?(void 0===(erec=Layout.Page.urlparam.id)&&(erec=erecno),window.location.href="#selfservice/profile-editId:"+erec):(void 0===erec&&(erec=void 0!==Layout.Page.urlparam.editId?Layout.Page.urlparam.editId:void 0!==Layout.Page.urlparam.id?Layout.Page.urlparam.id:erecno),window.location.href="#selfservice/profile-id:"+erec)},setUserComponent:function(usererec){var userDtl=ZPeople.CURR_USER;usererec!==erecno&&(userDtl=ZPeople.getUserDetailsById(usererec));Layout.Page.pageContWrapper.find("#zp_profile_image");Layout.Page.pageContWrapper.find("#zp_profile_image").attr("src",userDtl.avatar).attr("empid",userDtl.usererec),Layout.Page.pageContWrapper.find("#zp_profile_username").html(userDtl.name+",&nbsp;"+userDtl.empid),"NOT_IN_CONTACT"!==(chatStatus=ZPUserList.getChatStatusClass(userDtl.id))||"NO_CLASS"===chatStatus?Layout.Page.pageContWrapper.find("#zp_profile_chatstatus").attr("class",chatStatus).show():Layout.Page.pageContWrapper.find("#zp_profile_chatstatus").hide();var contObj=Layout.Page.pageContWrapper.find("#zp_profile_deptanddesi").empty();if(void 0!==userDtl.designation&&""!==userDtl.designation.trim()||void 0!==userDtl.deptName&&""!==userDtl.deptName.trim()){var isDesi=!1;void 0!==userDtl.designation&&""!==userDtl.designation.trim()&&(contObj.append("<strong>"+userDtl.designation+"</strong>"),isDesi=!0),void 0!==userDtl.deptName&&""!==userDtl.deptName.trim()&&(isDesi&&contObj.append("&nbsp;-&nbsp;"),"true"===ZPeople.isDepartmentDatasAllowed?contObj.append('<a href="javascript:void(0);" onclick="ZPUserList.showDeptById('+userDtl.deptId+')">'+userDtl.deptName+"</a>"):contObj.append("<a href='javascript:;'>"+userDtl.deptName+"</a>")),contObj.show()}else contObj.hide();ZPUtil.Validation.isEmpty(userDtl.email)?Layout.Page.pageContWrapper.find("#zp_profile_email").hide():Layout.Page.pageContWrapper.find("#zp_profile_email").html("<a href='mailto:"+userDtl.email+"'>"+userDtl.email+"</a>").show(),ZPUtil.Validation.isEmpty(userDtl.extension)?Layout.Page.pageContWrapper.find("#zp_profile_extn").hide():Layout.Page.pageContWrapper.find("#zp_profile_extn").html('<div class="IC-exten S18 FL gry MR10"></div>'+userDtl.extension).show(),ZPUtil.Validation.isEmpty(userDtl.workLoc)?Layout.Page.pageContWrapper.find("#zp_profile_worklocation").hide():Layout.Page.pageContWrapper.find("#zp_profile_worklocation").html('<div class="IC-chair S18 FL gry MR10"></div>'+userDtl.workLoc).show(),ZPUtil.Validation.isEmpty(userDtl.mobile)?Layout.Page.pageContWrapper.find("#zp_profile_mobile").hide():Layout.Page.pageContWrapper.find("#zp_profile_mobile").html('<div class="IC-mobi S18 FL gry MR10"></div>'+userDtl.mobile).show();var profRgtTopCont=Layout.Page.pageContWrapper.find("#zp_profilergt_container_repto").empty();if(!ZPUtil.Validation.isEmpty(userDtl.reportingTo)&&(void 0!==(userDtl=ZPeople.getUserDetailsById(userDtl.reportingTo))&&"true"===userDtl.isLogEnb&&"Unknown"!==userDtl.name)){profRgtTopCont.append("<h6>"+ZPI18N.getString("zp.reportingto")+"</h6>");var chatStatus=ZPUserList.getChatStatusClass(userDtl.id),userCont=$('<div class="ZPrto MB0I CP"><div class="FL PR"><img src="'+userDtl.avatar+'"><div class="'+chatStatus+'"></div></div><div class="det"><span>'+userDtl.name+"</span>"+(ZPUtil.Validation.isEmpty(userDtl.email)?"":'<a href="mailto:'+userDtl.email+'">'+userDtl.email+"</a>")+'</div><div class="bak DN"><div class="IC-back-ar-2 gry"></div></div></div>');profRgtTopCont.append(userCont),userCont.click(function(){void 0===ZPForm.CURRFORM_PARAM.profileCallback?Profile.get(userDtl.usererec):ZPForm.CURRFORM_PARAM.profileCallback(ZPForm.CURRFORM_PARAM.formId,userDtl.usererec)})}Layout.Page.pageContWrapper.find("#selfservice_userinfo").removeClass("DN")},setFavorites:function(){var favObj=Layout.Page.pageContWrapper.find("#zp_profile_favorite");favObj.attr("title"),favObj.attr("name"),favObj.attr("erecno"),favObj.removeClass("org gry");var userDtl=ZPForm.getSingleRecord().record;ZPForm.CURRFORM_PARAM.recordId===erecno?favObj.hide():userDtl.isFavorites?(favObj.attr("title",ZPI18N.getString("zp.unmarkfromfavorites")),favObj.attr("name","removemyFavorites"),favObj.attr("erecno",ZPForm.CURRFORM_PARAM.recordId),favObj.addClass("org"),favObj.show()):(favObj.attr("title",ZPI18N.getString("zp.markasfavorite")),favObj.attr("name","markasFav"),favObj.attr("erecno",ZPForm.CURRFORM_PARAM.recordId),favObj.addClass("gry"),favObj.show())},favoriteSuccessCallback:function(resultData,params){var successMsg,favObj=$("#zp_profile_favorite"),objClass=favObj.attr("class");void 0!=objClass&&-1==objClass.search("gry")?(ZPForm.getSingleRecord().record.isFavorites=!1,favObj.attr("title",ZPI18N.getString("zp.markasfavorite")),favObj.attr("name","markasFav"),favObj.attr("erecno",params.erecnos),favObj.addClass("gry"),favObj.removeClass("org"),successMsg="zp.removedfromfavoritemsgsuccess"):(ZPForm.getSingleRecord().record.isFavorites=!0,favObj.attr("title",ZPI18N.getString("zp.unmarkfromfavorites")),favObj.attr("name","removemyFavorites"),favObj.attr("erecno",params.erecnos),favObj.addClass("org"),favObj.removeClass("gry"),successMsg="zp.addedasfavoritemsgsuccess"),ZPeople.Message.showSuccessMsg(ZPI18N.getString(successMsg))},populateUserInfoCont:function(){var userDetails='<div class="ZPSSlft"><div class="FL MR20 PR optZoom"><i class="IC-lens"></i><img id="zp_profile_image" class="ZPSSimg" src="" empid=""><div id="zp_profile_chatstatus" class=""></div><i id="zp_profile_favorite" class="OnFav IC-star" onclick="ZPUserList.favouriteAction(this, Profile.favoriteSuccessCallback)"></i></div>';userDetails+='<div class="ZPUinf"><b id="zp_profile_username"></b><span id="zp_profile_deptanddesi"></span><span id="zp_profile_email"></span></div>',userDetails+='<div class="ZPUinf"><div class="ZPSSinfo" id="zp_profile_extn"></div>',userDetails+='<div class="ZPSSinfo MT10" id="zp_profile_worklocation"></div>',userDetails+='<div class="ZPSSinfo MT10" id="zp_profile_mobile"></div></div></div><div class="ZPSSrgt" id="zp_profilergt_container_repto"></div>',$("#selfservice_userinfo").empty().append(userDetails)},loadTree:function(treeData){var profRgtCont=Layout.Page.container.find("#zp_profilergt_container").empty();if(treeData.noTree)profRgtCont.addClass("DN");else{if(void 0!==treeData.drRepList&&treeData.drRepList.length>0&&(profRgtCont.append("<h6>"+ZPI18N.getString("zp.directreports")+"</h6>"),profRgtCont.append("<div class='Dmems' id='zp_profilergt_directrep'></div>"),Profile.constructUserList(treeData.drRepList,"zp_profilergt_directrep")),void 0!==treeData.depMemList&&treeData.depMemList.length>0){var depMemList=treeData.depMemList;ZPForm.isRefresh()&&(depMemList=ZPUtil.mergeArrays(treeData.drRepList,treeData.depMemList,!0,!0),void 0!==treeData.repoList&&treeData.repoList.length>0&&-1===depMemList.indexOf(treeData.repoList[0])&&depMemList.unshift(treeData.repoList[0])),profRgtCont.append("<h6>"+ZPI18N.getString("zp.deptmem")+"</h6>"),profRgtCont.append("<div class='Dmems' id='zp_profilergt_depmem'></div>"),Profile.constructUserList(depMemList,"zp_profilergt_depmem")}profRgtCont.removeClass("DN")}},constructUserList:function(list,id){var rowCnt=0,listObj=Layout.Page.container.find("#"+id).empty().append($("<ul></ul>")),userDataDtl=ZPeople.getUserDetailsByIds(list);$.each(userDataDtl,function(){"true"!==this.isLogEnb&&"true"!==this.isNonUser||(0!==i&&i%5==0&&(rowCnt++,listObj.append($('<ul class="'+(rowCnt>1?"DN":"")+'"></ul>'))),1===rowCnt&&i%5==4?listObj.find("ul:last").append('<li class="mor" onclick="Profile.showMoreUsers(this);"><div class="IC-more gry"></div></li><li class="DN" id="'+this.usererec+'" title="'+this.name+'"><img src="'+this.avatar+'"></li>'):listObj.find("ul:last").append('<li id="'+this.usererec+'" title="'+this.name+'"><img src="'+this.avatar+'"></li>'))}),listObj.find("li").click(function(){var erecno=$(this).attr("id");void 0===ZPForm.CURRFORM_PARAM.profileCallback?Profile.get(erecno):ZPForm.CURRFORM_PARAM.profileCallback(ZPForm.CURRFORM_PARAM.formId,erecno)})},showMoreUsers:function(Obj){$(Obj).siblings("li:hidden").removeClass("DN"),$(Obj).parent().siblings("ul:hidden").removeClass("DN"),$(Obj).remove()},getRelatedFormsData:function(Obj){var isCollapse=$(this).find("#zp_profile_expandcola").hasClass("IC-mini");if($(this).find("#zp_profile_expandcola").toggleClass("IC-expnd IC-mini"),isCollapse)$(this).next().slideUp();else{$(this).parent().find("[id^=zp_prof_relform_]:visible").slideUp().prev().find("#zp_profile_expandcola").addClass("IC-expnd").removeClass("IC-mini"),$(this).next().slideDown();var data=$(this).data();if(0===$(this).siblings("#zp_prof_relform_"+data.formId).length){var html=$('<div class="ZPSScont" id="zp_prof_relform_'+data.formId+'"><div class="table-responsive" id="zp_views_container"><table class="table table-hover Vlis" id="zp_views_records_table"><thead id="zp_views_recordheader"></thead></table></div></div>');$(this).after(html)}var relatedRecFor=erecno;void 0!=User.currentErecNo&&null!=User.currentErecNo&&(relatedRecFor=User.currentErecNo),ZPView.init({formId:data.formId,viewId:data.viewId,isrelatedform:!0,relformfcid:data.formCompid,relformconfigformid:ZPForm.CURRFORM_PARAM.formId,relformrecid:ZPForm.CURRFORM_PARAM.recordId,linkedFcid:data.linked_fcid,isEmbed:!0,container:"zp_prof_relform_"+data.formId,uniqueKey:Layout.Page.urlmode+"_"+relatedRecFor,recViewCallback:Profile.showRelatedRecordByMode,recEditCallback:Profile.showRelatedRecordByMode})}},showRelatedRecordByMode:function(formId,recordId,mode,formdisplayName,extraParam){var loadJson={formId:formId,recordId:recordId,formMode:void 0!==mode?mode:"VIEW",formdisplayName:formdisplayName,disableUrlTrack:!0,editCallback:Profile.showRelatedRecord,viewRefresh:!0,parent:Profile.CURR_COMPONENT};void 0!==extraParam&&(extraParam.hasOwnProperty("createFldFunctions")?(loadJson.createFldFunctions=extraParam.createFldFunctions,loadJson.onloadCallback=Timetracker.forms.formOnLoadCallback):extraParam.hasOwnProperty("fieldFormat")&&(loadJson.fieldFormat=extraParam.fieldFormat)),ZPForm.load(loadJson)},showRelatedRecord:function(formId,recordId){var mode="EDIT";void 0===recordId&&(mode="ADD"),Profile.showRelatedRecordByMode(formId,recordId,mode)}},ToNumber=function(obj1){return("boolean"==typeof obj1?obj1?1:0:parseFloat(obj1))||0},Equals=function(obj1,obj2){return obj1==obj2},If=function(obj1,obj2,obj3){var myVar;return void 0!==(myVar=obj1?obj2:obj3)?myVar:" "},And=function(){for(var obj=arguments[0],i=1;i<arguments.length;i++)obj=obj&&arguments[i];return obj},Or=function(){for(var obj=arguments[0],i=1;i<arguments.length;i++)obj=obj||arguments[i];return obj},Not=function(obj){return!obj},Contains=function(obj1,obj2){return obj1.indexOf(obj2)>-1},StartsWith=function(obj1,obj2){return 0==obj1.indexOf(obj2)},EndsWith=function(obj1,obj2){return obj1.lastIndexOf(obj2)==obj1.length-obj2.length},Find=function(obj1,obj2,obj3){var res=obj1.split(obj2,obj3).join(obj2).length+1;return res==obj1.length+1&&(res=-1),res},Replace=function(obj,obj1,obj2){var re=new RegExp(obj1,"g");return obj.replace(re,obj2)},Lower=function(obj){return obj.toLowerCase()},Trim=function(obj){return obj.replace(/^\\s+|\\s+$/g,"")},Concat=function(){var obj="";x=0;for(var i=0;i<arguments.length;i++)obj+=arguments[i];return obj},Upper=function(obj){return obj.toUpperCase()},SubString=function(obj1,obj2,obj3){return obj1.substring(obj2-1,obj3)},ToString=function(obj,obj1){if(obj1>=0){var dat=new Date(obj),dres=dat.toDateString(),tres=dat.toTimeString().substring(0,8);return 1==obj1?dres+" "+tres:2==obj1?tres:3==obj1?dres:obj.toString()}return obj.toString()},Length=function(obj){return obj.length},AddDate=function(obj1,obj2,obj3){return obj3=Trim(obj3.toUpperCase()),dateTimefuncs.updateDate(obj1,obj2,obj3)},SubDate=function(obj1,obj2,obj3){return obj3=Trim(obj3.toUpperCase()),dateTimefuncs.updateDate(obj1,-1*obj2,obj3)},GetTime=function(obj){return dateTimefuncs.getDateOrTimeOfDateTime(obj,"TIME")},GetDate=function(obj){return dateTimefuncs.getDateOrTimeOfDateTime(obj,"DATE")},DateDiff=function(obj1,obj2,obj3){return obj3=Trim(obj3.toUpperCase()),dateTimefuncs.dateDiff(obj1,obj2,obj3)},NewDateTime=function(){return dateTimefuncs.newDateTime(arguments[0],arguments[1]-1,arguments[2],arguments[3],arguments[4],arguments[5])},GetYears=function(obj){return dateTimefuncs.getPartOfDateTime(obj,"YEAR")},GetWeekday=function(obj){return dateTimefuncs.getPartOfDateTime(obj,"WEEKDAY")},GetDays=function(obj){return dateTimefuncs.getPartOfDateTime(obj,"DAY")},GetMonths=function(obj){return dateTimefuncs.getPartOfDateTime(obj,"MONTH")},GetHours=function(obj){return dateTimefuncs.getPartOfDateTime(obj,"HOUR")},GetSeconds=function(obj){return dateTimefuncs.getPartOfDateTime(obj,"SECOND")},GetMinutes=function(obj){return dateTimefuncs.getPartOfDateTime(obj,"MINUTE")},Sum=function(){x=0;for(var i=0;i<arguments.length;i++)x+=arguments[i];return x},Avg=function(){x=0;for(var i=0;i<arguments.length;i++)x+=arguments[i];return x/arguments.length},Min=function(){x=arguments[0];for(var i=0;i<arguments.length;i++)arguments[i]<x&&(x=arguments[i]);return x},Max=function(){x=arguments[0];for(var i=0;i<arguments.length;i++)arguments[i]>x&&(x=arguments[i]);return x},Now=function(){return dateTimefuncs.now()},CurrentDate=function(){return dateTimefuncs.now()},GetExperience=function(mode,doj,doe){return dateTimefuncs.getExperience(mode,doj,doe)},convertDate=function(newdate){return dat=newdate.split("-"),dateval=new Date(dat[1]+", "+dat[0]+", "+dat[2]),dateval.getTime()},incrementTime=function(x){for(y=x.split(":"),""==y&&(y[0]=x),t=0,i=0;i<y.length;i++)val=y[i],-1!=val.indexOf("W")&&(conversion=val.split("W"),t+=6048e5*conversion[0]),-1!=val.indexOf("w")&&(conversion=val.split("w"),t+=6048e5*conversion[0]),-1!=val.indexOf("D")&&(conversion=val.split("D"),t+=864e5*conversion[0]),-1!=val.indexOf("d")&&(conversion=val.split("d"),t+=864e5*conversion[0]),-1!=val.indexOf("H")&&(conversion=val.split("H"),t+=36e5*conversion[0]),-1!=val.indexOf("h")&&(conversion=val.split("h"),t+=36e5*conversion[0]),-1!=val.indexOf("M")&&(conversion=val.split("M"),t+=6e4*conversion[0]),-1!=val.indexOf("m")&&(conversion=val.split("m"),t+=6e4*conversion[0]),-1!=val.indexOf("S")&&(conversion=val.split("S"),t+=1e3*conversion[0]),-1!=val.indexOf("s")&&(conversion=val.split("s"),t+=1e3*conversion[0]);return t},IsEmptyString=function(str){return 0==Length(Trim(str))},IsEmptyDate=function(sec){return 0==sec};var dateTimefuncs={updateDate:function(time,duration,mode){var cal=new Date(time);return"YEAR"==mode?cal.setFullYear(cal.getFullYear()+duration):"MONTH"==mode?cal.setMonth(cal.getMonth()+duration):"DAY"==mode?cal.setDate(cal.getDate()+duration):"HOUR"==mode?cal.setHours(cal.getHours()+duration):"MINUTE"==mode?cal.setMinutes(cal.getMinutes()+duration):"SECOND"==mode&&cal.setSeconds(cal.getSeconds()+duration),cal.getTime()},getPartOfDateTime:function(time,mode){var cal=new Date(time);return"YEAR"==mode?cal.getFullYear():"MONTH"==mode?cal.getMonth()+1:"DAY"==mode?cal.getDate():"HOUR"==mode?cal.getHours():"MINUTE"==mode?cal.getMinutes():"SECOND"==mode?cal.getSeconds():"WEEKDAY"==mode?cal.getDay()+1:0},newDateTime:function(year,month,day,hour,minute,second){return new Date(year,month,day,hour,minute,second).getTime()},getDateOrTimeOfDateTime:function(time,mode){var cal=new Date(time);return"DATE"==mode?(cal.setHours(0),cal.setMinutes(0),cal.setSeconds(0),cal.setMilliseconds(0)):"TIME"==mode&&(cal.setFullYear(0),cal.setMonth(0),cal.setDate(1)),cal.getTime()},dateDiff:function(time1,time2,mode){var endCal=new Date(time1),startCal=new Date(time2),dur=1,diff=0;if(time2>time1){var temp=startCal;startCal=endCal,endCal=temp,dur=-1}if("YEAR"==mode)for(startCal.setFullYear(startCal.getFullYear()+1);startCal<=endCal;)diff++,startCal.setFullYear(startCal.getFullYear()+1);else if("MONTH"==mode)for(startCal.setMonth(startCal.getMonth()+1);startCal<=endCal;)diff++,startCal.setMonth(startCal.getMonth()+1);else diff=endCal.getTime()-startCal.getTime(),diff/=1e3,"MINUTE"==mode?diff/=60:"HOUR"==mode?diff/=3600:"DAY"==mode&&(diff/=86400),diff=Math.floor(diff);return diff*dur},getExperience:function(mode,doj,doe){var exp=0;return 0!=doj&&(exp=0==doe||doe>dateTimefuncs.now()?dateTimefuncs.dateDiff(dateTimefuncs.updateDate(dateTimefuncs.getDateOrTimeOfDateTime(dateTimefuncs.now(),"DATE"),1,"DAY"),doj,mode.toUpperCase()):dateTimefuncs.dateDiff(dateTimefuncs.updateDate(dateTimefuncs.getDateOrTimeOfDateTime(doe,"DATE"),1,"DAY"),doj,mode.toUpperCase())),exp},now:function(){return new Date},convertLongToDateTime:function(value){var dateObj=new Date(value),formatDate=Calendar.formatDate(dateObj),hrs=dateObj.getHours();if(Calendar.is12HrFormat()){var amPm=hrs>11?"PM":"AM";hrs>12&&(hrs%=12),formatDate+=" "+Calendar.twoDig(hrs)+":"+Calendar.twoDig(dateObj.getMinutes())+" "+amPm}else formatDate+=" "+Calendar.twoDig(hrs)+":"+Calendar.twoDig(dateObj.getMinutes())+":"+Calendar.twoDig(dateObj.getSeconds());return formatDate},convertLongToDate:function(value){var dateObj=new Date(value);return Calendar.formatDate(dateObj)},convertLongToTime:function(value){var dateObj=new Date(value),formatDate="",hrs=dateObj.getHours();if(Calendar.is12HrFormat()){var amPm=hrs>11?"PM":"AM";hrs>12&&(hrs%=12),formatDate+=" "+Calendar.twoDig(hrs)+":"+Calendar.twoDig(dateObj.getMinutes())+" "+amPm}else formatDate+=" "+Calendar.twoDig(hrs)+":"+Calendar.twoDig(dateObj.getMinutes())+":"+Calendar.twoDig(dateObj.getSeconds());return formatDate}},formulaUtil={executeFormula:function(parserLabels,formula,values){}},transfers={isTransfer:!1,isTransferMandateFields:!1,isTransferRaised:!1,listViewRefresh:!1,URL:"/transfers.zp",fieldList:null,recrodIds:[],emptyColumns:[],headerDetails:null,transferId:null,transferName:"",index:0,properties:{},PARAM_VAL:{},transferDiv:'<div id="transferButton" class="btn-group dropdown MR15"><a data-toggle="dropdown" class="dropdown-toggle" aria-expanded="false">'+ZPI18N.getString("zp.raisetranfer")+'<span class="IC-ar-dwn S11 ML8"></span></a><ul role="menu" class="dropdown-menu bullet" id="transferOptns"></ul></div>',transferPopUp:'<div class="modal popRgtModel empTransferModal" id="transferDiv"><div class="modal-dialog" role="document"><div class="modal-content" id="headerParent"><div class="modal-header" id="zp_form_header"><a class="close IC-cls" data-dismiss="modal" id="empTransferCls" onclick="transfers.closeTransferPopUp()"></a></div><div class="modal-body" id="zp_form_outer_container"></div><div class="modal-footer text-left"><button type="button" class="btn btn-primary" id="transferSubmit" onclick=" ZPForm.IS_SUBMITNEW=false;ZPForm.Record.validateAndSubmit();">'+ZPI18N.getString("zp.next")+'</button><button type="button" class="btn btn-default" id="transferClose" data-dismiss="modal" onclick="transfers.closeTransferPopUp();">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div></div>",fieldsAdd:'<div class="empTadd open"><a data-toggle="dropdown" class="btn-link" aria-expanded="true">'+ZPI18N.getString("zp.transfer.addchange")+'<i class="IC-add"></i></a><ul class="dropdown-menu ZPCmn-Arrow top gray"></ul></div>',transImpExpDiv:'<div class="FR dropdown MT7 PR ZPCusDrs impexp ZPPdrop cust-dm"><i class="IC-more  S18 gry  CP ML20 dropdown-toggle" data-toggle="dropdown" id = "zp_views_impexp"></i><ul class="dropdown-menu ZPCmn-Arrow top gray TBDD"><li id="zp_views_imp" class="DN"><a href="javascript:;" onclick="ZPForm.showForm(\'import\')"><i class="IC-imprt DIB gry MR10"></i>'+ZPI18N.getString("zp.import")+'</a></li><li id="zp_views_exp" class="DN"><a href="javascript:;"><i class="IC-exprt DIB gry MR10"></i>'+ZPI18N.getString("zp.export")+"</a></li></ul></div>",addToRecordSelectionActions:function(actionsDiv,className,dataChangeForms,isSingleView,isSpan,isUserMode){if(0==dataChangeForms.length)actionsDiv.find("[name=transfer]").remove();else if(0==actionsDiv.find("[name=transfer]").length)if(1!=dataChangeForms.length||isSingleView){var transferDiv=$(transfers.transferDiv);transferDiv.find("a").addClass(className);var transferList=isSingleView?actionsDiv:transferDiv.find("#transferOptns");$.each(dataChangeForms,function(i,dataChangeForm){var textDiv=$(isSpan?"<span></span>":"<a></a>").text(dataChangeForm.labelName);"ZP_Form_MoreOpt"===actionsDiv.parent().attr("id")&&textDiv.prepend($("<i></i>").addClass("CR-edit"));var liDiv=$("<li></li>").on("click",{dataChangeFormId:dataChangeForm.formId,isSingleView:isSingleView},transfers.getTransferDetails).attr("name","transfer").append(textDiv);"ZP_Form_MoreOpt"===actionsDiv.parent().attr("id")?transferList.prepend(liDiv):transferList.append(liDiv)}),isSingleView||actionsDiv.append(transferDiv)}else{var transferEle=$(isSpan?"<span></span>":"<a></a>").on("click",{dataChangeFormId:dataChangeForms[0].formId,isSingleView:isSingleView},transfers.getTransferDetails).addClass(className).attr("name","transfer").text(dataChangeForms[0].labelName);"usersOptions"==actionsDiv.parent().attr("id")?isUserMode?$("#transferForUser").prepend(transferEle):$("#transferForEmpProfile").prepend(transferEle):actionsDiv.append(transferEle)}},getTransferDetails:function(transferConfig){if($("[name=transfer]").attr("disabled","disabled"),transfers.isSingleView=transferConfig.data.isSingleView,transfers.recordIds=transfers.isSingleView?[ZPForm.CURRFORM_PARAM.recordId]:zpMassUpdate.getPkIds().pkIds,transfers.recordIds.length>0){var params={dataChangeFormId:transferConfig.data.dataChangeFormId,recordIds:JSON.stringify(transfers.recordIds),mode:"getTransferDetails"};ZPeople.Request.send(transfers.URL,params,transfers.openTransfer)}},openTransfer:function(transferData,params){transfers.isTransfer=!0;var dataObject={formId:params.dataChangeFormId};ZPForm.previousLayout=ZPForm.LAYOUT,ZPForm.LAYOUT=$(transfers.transferPopUp);var transferHeader=ZPForm.LAYOUT.find("#zp_form_header");if(transfers.headerDetails=transferData.recordDetails.headerDetails,transfers.employeeDetails=transferData.employeeDetails,ZPForm.preparam=ZPForm.CURRFORM_PARAM,ZPForm.CURRFORM_PARAM={},ZPForm.premode=ZPForm.MODE,transferHeader.append($("<h6></h6>").addClass("modal-title").text(ZPI18N.getString("zp.transfer.initiate")+" "+transferData.transferDetails.formDetails.formdisplayName)),1===transfers.recordIds.length){var headerDetails=transferData.recordDetails.headerDetails[transfers.recordIds[0]];7e3===transferData.recordDetails.singRecordDetails.code?(ZPForm.MODE="EDIT",ZPForm.CURRFORM_PARAM.formId=params.dataChangeFormId,ZPForm.CURRFORM_PARAM.recordId=transfers.recordIds[0],ZPForm.setSingleRecordDetail(transferData.recordDetails.singRecordDetails)):ZPForm.MODE="ADD",transferHeader.append('<div class="MT10 oHide">\t\t\t\t    \t<div class="BGtxt MT5">\t\t\t\t\t\t\t<img src="'+headerDetails.photo+'">\t\t        \t\t</div>\t\t        \t\t<div class="DIB">\t\t        \t\t\t<span class="bld">'+ZSEC.Encoder.encodeForHTML(headerDetails.id)+"-"+headerDetails.name+'</span>\t\t        \t\t\t<span class="DB S13 MT5">\t\t            \t\t\t<em class="FL dgry">'+(""==headerDetails.designation?headerDetails.mailId:headerDetails.designation)+"</em>\t\t            \t\t</span>\t\t            \t</div>\t\t            </div>")}else ZPForm.MODE="ADD",transferHeader.addClass("empMT"),transferHeader.append($("<div></div>").addClass("empMTph").append($("<img>").attr("src",ZPeople.getResourceURL(hrImageUrl+"massTransfer.svg"))));transfers.fieldList=$(transfers.fieldsAdd),ZPForm.constructFields(transferData.transferDetails,dataObject),$("#wrapper #transferDiv").remove(),$("#wrapper").append(ZPForm.LAYOUT),ZPForm.LAYOUT=$("#wrapper #transferDiv"),ZPForm.LAYOUT.find("#zp_transfer_fields").children(".zp-label").hide(),ZPForm.LAYOUT.find("#zp_transfer_fields").append(transfers.fieldList),$("#transferDiv").modal("show"),$("[name=transfer]").removeAttr("disabled")},addTransferResponse:function(response,params){transfers.isTransferRaised=!0,ZPForm.LAYOUT.find(".empTgrp .zp-label").addClass("zp-rdonly"),ZPForm.LAYOUT.find("#transferSubmit").hide(),ZPForm.LAYOUT.find("#transferClose").text(ZPI18N.getString("zp.close")),0==ZPForm.LAYOUT.find("#zp_tranfer_result").length&&ZPForm.LAYOUT.find("#zp_form_body").append($("<div></div>").attr("id","zp_tranfer_result")),ZPForm.LAYOUT.find("#zp_tranfer_result").empty(),ZPForm.LAYOUT.find("#zp_transfer_summary").hide(),ZPForm.LAYOUT.find("#zp_tranfer_result").show(),ZPForm.LAYOUT.find("#zp_transfer_fields").hide();var resultDiv=$("<ul></ul>").addClass("empTview");1==transfers.recordIds.length?transfers.appendField(response,params,resultDiv,transfers.recordIds[0],!1,"result"):$.each(transfers.recordIds,function(index,recordId){transfers.appendField(response,params,resultDiv,recordId,!0,"result")}),ZPForm.LAYOUT.find("#zp_form_header").hasClass("err")||ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.transfer.initiated")),ZPForm.LAYOUT.find("#zp_tranfer_result").append(resultDiv)},appendField:function(response,params,resultDiv,recordId,isMulti,mode){var list=$("<li></li>");if(isMulti){list.addClass("empTlist").attr("baseRecord",recordId);var headerDetails=transfers.headerDetails[recordId];list.append($("<div></div>").addClass("empThdr").append($("<div></div>").addClass("BGtxt").append($("<img>").attr("src",headerDetails.photo))).append($("<b></b>").html(ZSEC.Encoder.encodeForHTML(headerDetails.id)+" - "+headerDetails.name)).append($("<span></span>").html(headerDetails.designation)))}if("summary"==mode)return transfers.constructTransferRecordView(response,isMulti,resultDiv,void 0,list,!0,recordId);var message,successObj=response.recordResponse[recordId][0];if(7e3==successObj.code)transfers.constructTransferRecordView(response.recordDetails[recordId],isMulti,resultDiv,params,list,!1,recordId);else if(message="permission_denied"===successObj.message?ZPI18N.getString("zp.permissiondenied"):"MR_ERROR"===successObj.code||7400===successObj.code||7040===successObj.code||7105===successObj.code||7029===successObj.code||successObj.code===zpconst.ResponseCodes.PERMISSION_DENIED_TO_ADD_OR_EDIT_DATA||7478===successObj.code?successObj.message:successObj.hasOwnProperty("message")&&successObj.message.hasOwnProperty("Reporting_To")?successObj.message.Reporting_To:successObj.hasOwnProperty("message")&&successObj.message.hasOwnProperty("transferError")?successObj.message.transferError:ZPI18N.getString("zp.transfererror",[ZPeople.peopleSupportEmail]),isMulti){ZPForm.LAYOUT.find("#zp_form_header").hasClass("err")||($("<div></div>").addClass("ZPednote").text(ZPI18N.getString("zp.transfer.errorspresent")).append($("<i></i>").addClass("IC-alert")).insertAfter(ZPForm.LAYOUT.find(".modal-title")),ZPForm.LAYOUT.find("#zp_form_header").addClass("err")),ZPForm.LAYOUT.find("#zp_form_outer_container").hasClass("err")||ZPForm.LAYOUT.find("#zp_form_outer_container").addClass("err");var recordDiv=ZPForm.LAYOUT.find("#zp_transfer_summary").find(".empTlist[baserecord="+recordId+"]");list.append(recordDiv.children(".DB, .MT10")),list.addClass("sel").prepend($("<p></p>").addClass("red").text(message)).append($("<i></i>").addClass("IC-alert")),resultDiv.append(list)}else ZPForm.LAYOUT.find("#zp_transfer_summary").show(),ZPForm.LAYOUT.find("#zp_tranfer_result").hide(),$("<div></div>").addClass("ZPednote").text(message).append($("<i></i>").addClass("IC-alert")).insertAfter(ZPForm.LAYOUT.find(".modal-title")),ZPForm.LAYOUT.find("#zp_form_header").addClass("err"),ZPForm.LAYOUT.find(".modal-footer").prepend('<button type="button" class="btn btn-default" id="transferBack" onclick="transfers.showFormFields();">'+ZPI18N.getString("zp.back")+"</button>")},constructTransferRecordView:function(record,isMulti,resultDiv,params,list,isSummary,recordId){var diffExists=!1;return $.each(Object.keys(record),function(index,fieldLabelName){if(-1==fieldLabelName.indexOf(".")&&(void 0==params||params.hasOwnProperty(fieldLabelName))&&"ApprovalStatus"!==fieldLabelName&&"TransferEffectiveDate"!==fieldLabelName&&"TransferReason"!==fieldLabelName&&"ApprovalTime"!==fieldLabelName){var oldValue=isSummary?transfers.employeeDetails[recordId][fieldLabelName]:record[fieldLabelName+".PREVIOUS"];if(""!=record[fieldLabelName]||""!=oldValue){if(""==record[fieldLabelName]&&(record[fieldLabelName]=ZPI18N.getString("zp.transfer.novalue")),oldValue!=record[fieldLabelName])diffExists=!0;else if(void 0==recordId)return;var field=isMulti?list:$("<li></li>");field.append($("<div></div>").addClass(isMulti&&index>0?"DB PT10":"DB").append($("<i></i>").addClass(transfers.getFieldClass(fieldLabelName))).append($("<span></span>").addClass("dgry").text(record[fieldLabelName+".Name"]))),""==oldValue&&(oldValue=ZPI18N.getString("zp.transfer.novalue")),field.append($("<div></div>").addClass("MT10").append($("<span></span>").text(oldValue)).append($("<img>").attr("src",ZPeople.getResourceURL(hrImageUrl+"arrow-rgt.svg"))).append($("<span></span>").text(record[fieldLabelName]))),isMulti||resultDiv.append(field)}}}),isMulti&&resultDiv.append(list),!(isSummary&&!diffExists)},getFieldClass:function(lableName){switch(lableName){case"LocationName":return"IC-location-1px";case"Department":return"CR-orgdpt";case"Entity":return"CR-entity";case"Business_unit":return"CR-business";case"Division":return"CR-division";case"Employee_type":return"CR-emptype";default:return"CR-orgdpt"}},addFormComponents:function(details){var formComp=ZPForm.FIELD_LAYOUT.find("#zp_field_outer_"+details.data.fieldId).parent();details.data.isDependent?formComp.find("#removeDiv").remove():0==formComp.find("#removeDiv").length&&formComp.append($("<i></i>").attr("id","removeDiv").addClass("IC-mins").on("click",{fieldId:details.data.fieldId},transfers.removeFormComponents)),formComp.show(),ZPForm.LAYOUT.find(".empTadd #zp_field_id_"+details.data.fieldId).attr("fieldSelect","true").hide(),ZPForm.LAYOUT.find(".empTadd a:Visible").length<=1?ZPForm.LAYOUT.find(".empTadd").hide():ZPForm.LAYOUT.find(".empTadd").show(),void 0!=ZPForm.FORM_COMPONENT_DATA[ZPForm.CURRFORM_PARAM.formId].message.dependntFieldMappings[details.data.fieldId]&&$.each(ZPForm.FORM_COMPONENT_DATA[ZPForm.CURRFORM_PARAM.formId].message.dependntFieldMappings[details.data.fieldId],function(index,fieldId){transfers.addFormComponents({data:{fieldId:fieldId,isDependent:!0}})})},removeFormComponents:function(details){ZPForm.FIELD_LAYOUT.find("#zp_field_outer_"+details.data.fieldId).parent().hide(),ZPForm.LAYOUT.find(".empTadd #zp_field_id_"+details.data.fieldId).attr("fieldSelect","false").show(),ZPForm.LAYOUT.find(".empTadd").show(),void 0!=ZPForm.FORM_COMPONENT_DATA[ZPForm.CURRFORM_PARAM.formId].message.dependntFieldMappings[details.data.fieldId]&&$.each(ZPForm.FORM_COMPONENT_DATA[ZPForm.CURRFORM_PARAM.formId].message.dependntFieldMappings[details.data.fieldId],function(index,fieldId){transfers.removeFormComponents({data:{fieldId:fieldId}})})},closeTransferPopUp:function(){transfers.isTransfer=!1,transfers.recrodIds=[],transfers.headerDetails=null,transfers.isTransferRaised&&(transfers.isTransferRaised=!1,transfers.listViewRefresh=!0,0==Layout.Page.pageId.indexOf("admin-employeerecords-")&&Layout.Page.container.find("#close_user_options").trigger("click"),Layout.Page.container.find("#zp_view_close_selection").trigger("click")),-1==Layout.Page.pageId.indexOf("transfer-transferId")?(ZPForm.LAYOUT=ZPForm.previousLayout,ZPForm.CURRFORM_PARAM=ZPForm.preparam,"ProfilePic"!==Layout.Page.urlparam.mode&&(ZPForm.MODE=ZPForm.premode)):Layout.Page.urlparam.hasOwnProperty("recordId")&&(delete Layout.Page.urlparam.recordId,window.location.href="#"+Layout.UrlConf.generatePageHash()),"Transfer"!==Layout.Page.urlparam.mode&&"ProfilePic"!==Layout.Page.urlparam.mode||ZPApprovals.closePopCallback()},initListView:function(){if(transfers.transferId=Layout.Page.urlparam.transferId,$("#page-wrapper").removeClass("Abar1"),null!=transfers.transferId){ZPForm.CURRFORM_PARAM.formId=transfers.transferId,ZPView.CURR_VIEWPARAMS={formId:transfers.transferId,viewId:ZPeople.Module.MODULE_DATA[ZPeople.Module.getModuleKey()].viewDetails.message[0].viewId,isEmbed:!1};var propParam=ZPView.getViewPropertie();transfers.listViewRefresh&&(void 0!=propParam&&(propParam.startInd=1,propParam.refreshStatus=!0,ZPeople.FireScroll.reset()),transfers.listViewRefresh=!1),ZPView.init(),(0==Layout.Page.container.find("#zp_views_list_container").find(".ZPListingUL").length||void 0===propParam||propParam.refreshStatus)&&transfers.constructImpExpDiv();var recordId=Layout.Page.urlparam.recordId;null!=recordId&&transfers.showTransferRecord({data:{transferId:transfers.transferId,recordId:recordId}}),void 0!=Layout.Page.urlparam.action&&(action=Layout.Page.urlparam.action,transfers.initAction(action))}},initAction:function(action){"import"==action&&Layout.Page.container.find("#transMiscDiv #zp_views_imp").length>0&&Import.init(transfers.transferId,void 0,Layout.Page.hash.substring(0,Layout.Page.hash.indexOf("/action:import")))},constructImpExpDiv:function(){if(ZPForm.Permission.isImportAllowed()||ZPForm.Permission.isExportAllowed()){var transMiscDiv=Layout.Page.container.find("#transMiscDiv");0==transMiscDiv.find("#zp_views_impexp").length&&transMiscDiv.append(transfers.transImpExpDiv),ZPForm.Permission.isImportAllowed()&&transMiscDiv.find("#zp_views_imp").removeClass("DN"),ZPForm.Permission.isExportAllowed()&&(transMiscDiv.find("#zp_views_exp").removeClass("DN"),transMiscDiv.find("#zp_views_exp a").attr("onclick","ZPExport.showExportContainer(transfers.exportTransfer, 'transfer')"))}},constructListView:function(headers,records){var listDiv=ZPView.VIEW_CONTAINER.find("#zp_views_container"),propParam=ZPView.getViewPropertie();return void 0!=propParam&&1==propParam.startInd&&Layout.Page.container.find("#zp_views_container .ZPListingUL").remove(),$.each(records,function(recordNo,record){var recordDiv=$("<li></li>").addClass("nameL").append($("<div></div>").addClass("fileType BGtxt").append($("<img>").attr("src",record.headerDetails.photo))).append($("<div></div>").addClass("DIB").append($("<ul></ul>").append($("<li></li>").addClass("bld").html(ZSEC.Encoder.encodeForHTML(record.headerDetails.id)+"-"+record.headerDetails.name)).append($("<li></li>").addClass("mail").append($("<a></a>").html(record.headerDetails.mailId)).append(""==record.headerDetails.designation&&""!=record.headerDetails.mailId?"":$("<span></span>").addClass("dgry").html(record.headerDetails.designation))).append($("<li></li>").addClass("date").append($("<span></span>").addClass("gry").text(ZPI18N.getString("zp.transfer.effectivedate"))).append($("<span></span>").attr("name","effectivedate"))))),changes=0;if($.each(headers,function(headerNo,header){if("DATACHANGE_DATE"==header.columnName)recordDiv.find("[name=effectivedate]").html(record.fieldDetails[headerNo]);else if(header.isDataChangeEnabled&&changes<4){var value=record.fieldDetails[headerNo],prevValue=record.fieldPreviousValues[headerNo];if(value!=prevValue){if(4==++changes)return recordDiv.find("[name=showMoreRecords]").removeClass("hide"),!0;value=""===value?ZPI18N.getString("zp.transfer.novalue"):value,prevValue=""===prevValue?ZPI18N.getString("zp.transfer.novalue"):prevValue;var field=$("<ul></ul>");field.append($("<li></li>").addClass("empTorg").append($("<i></i>").addClass(transfers.getFieldClass(header.labelName))).append($("<em></em>").addClass("gry").html(header.displayName))).append($("<li></li>").addClass("empTdtl").append($("<span></span>").html(prevValue)).append($("<img>").addClass("arw").attr("src",ZPeople.getResourceURL(hrImageUrl+"arrow-rgt.svg"))).append($("<span></span>").html(value))),3==changes&&field.append($("<li></li>").append($("<a></a>").attr("name","showMoreRecords").addClass("CP hide").text(ZPI18N.getString("zp.transfer.more")).on("click",function(){delete Layout.Page.urlparam.recordId,Layout.Page.urlparam.recordId=record.recordId,window.location.href="#"+Layout.UrlConf.generatePageHash()}))),recordDiv.find(".DIB").append(field)}}}),0!=changes){var actionDiv=$("<li></li>").addClass("actions");if(ZPForm.isApprovalEnabled()){var approvalStatus=record.approvalStatus;"1"==approvalStatus?actionDiv.append($("<span></span>").attr("id","approvalStatus").addClass("grn").text(ZPI18N.getString("zp.approved"))):"0"==approvalStatus?actionDiv.append($("<span></span>").attr("id","approvalStatus").addClass("red").text(ZPI18N.getString("zp.rejected"))):"-2"!=approvalStatus&&actionDiv.append($("<span></span>").attr("id","approvalStatus").addClass("ylw").text(ZPI18N.getString("zp.approvalpending")))}!isadmin||0!==record.dataChangeStatus&&1!==record.dataChangeStatus&&3!==record.dataChangeStatus||actionDiv.append($("<i></i>").addClass("IC-delete-1px").on("click",transfers.confirmDeleteRecord)),actionDiv.append($("<i></i>").addClass("IC-ar-rgt").on("click",function(){delete Layout.Page.urlparam.recordId,Layout.Page.urlparam.recordId=record.recordId,window.location.href="#"+Layout.UrlConf.generatePageHash()})),listDiv.append($("<ul></ul>").addClass("ZPListingUL").attr("id","zp_view_record_"+record.recordId).attr("recordid",record.recordId).append(recordDiv).append(actionDiv))}}),30==records.length&&ZPeople.FireScroll.reset(),0==listDiv.find(".ZPListingUL").length&&ZPView.showNoDataPage(ZPI18N.getString("zp.lookup.norecfound")),listDiv},showTransferRecord:function(details){if(!transfers.isTransfer||details.data.isProfilePic){if(ZPForm.CURRFORM_PARAM={formId:transfers.transferId,recordId:details.data.recordId},transfers.isTransfer=!0,ZPApprovals.FORMID=details.data.transferId,ZPApprovals.RECORDID=details.data.recordId,!details.data.isProfilePic){var popUp=$(transfers.transferPopUp);$("#wrapper").find("div#transferDiv").remove(),$("#wrapper").append(popUp),popUp.find("#zp_form_outer_container").append(ZPeople.LOADING_HTML),popUp.find("#zp_form_header").append($("<h6></h6>").addClass("modal-title").text(transfers.transferName)),popUp.find("#transferSubmit").hide(),popUp.find("#transferClose").text(ZPI18N.getString("zp.close")),$("#transferDiv").modal("show")}var params={transferId:details.data.transferId,recordId:details.data.recordId,mode:"fetchTransferRecord"};ZPeople.Request.send(transfers.URL,params,transfers.openTransferPopUpView,{isApprovalAction:details.data.isApprovalAction})}},openTransferPopUpView:function(response,params,otherDetails){if("dc_EmployeePhotoChanges"===response.transferDetails.formDetails.tableName)return ZPForm.preparam=ZPForm.CURRFORM_PARAM,ZPForm.CURRFORM_PARAM.formId=transfers.transferId,ZPForm.CURRFORM_PARAM.tableName=response.transferDetails.formDetails.tableName,ZPForm.updateFormConf(response.transferDetails.formDetails),ZPForm.SINGLE_RECORD_DTL[ZPApprovals.FORMID+"_"+ZPApprovals.RECORDID]={record:{message:response.recordDetails[0]}},ZPForm.SINGLE_RECORD_DTL[ZPApprovals.FORMID+"_"+ZPApprovals.RECORDID].tableName="dc_EmployeePhotoChanges",void ZPApprovals.getApprovalDetails(!0);-1==Layout.Page.pageId.indexOf("transfer-transferId")&&(ZPForm.preparam=ZPForm.CURRFORM_PARAM,ZPForm.CURRFORM_PARAM.formId=transfers.transferId,ZPForm.CURRFORM_PARAM.tableName=response.transferDetails.formDetails.tableName,ZPForm.updateFormConf(response.transferDetails.formDetails),ZPForm.FORM_COMPONENT_DATA[transfers.transferId]=response.transferDetails,ZPForm.populateFields(response.transferDetails.message)),ZPForm.LAYOUT=$("#transferDiv"),ZPForm.LAYOUT.find("#zp_form_outer_container").empty(),ZPForm.LAYOUT.find("#headerApprovalBtn").attr("name","appr_status_"+ZPApprovals.RECORDID);var transferHeader=ZPForm.LAYOUT.find("#zp_form_header"),headerDetails=response.baseRecordDetails[response.recordDetails[0]["DatachangeBaseRecord.ID"]];transferHeader.append('<div class="MT10 oHide"><div class="BGtxt MT5"><img src="'+headerDetails.photo+'"></div><div class="DIB"><span class="bld">'+ZSEC.Encoder.encodeForHTML(headerDetails.id)+"-"+headerDetails.name+'</span><span class="DB S13 MT5"><em class="FL dgry">'+(""==headerDetails.designation?headerDetails.mailId:headerDetails.designation)+'</em></span></div><div class="empTstats zp-recordsts success zp_dyn" id="headerApprovalBtn"><span class="msg">'+ZPI18N.getString("zp.approved")+'</span><a id="zp_appproval_comment_btn" onclick="ZPApprovals.getApprovalDetails()">'+ZPI18N.getString("zp.view")+'</a><a id="showApprBtn" class="zp_aPrvWait zp_dyn">'+ZPI18N.getString("zp.viewapprovers")+"</a></div></div>"),ZPForm.LAYOUT.find("#zp_form_outer_container").append($("<div></div>").addClass("Scrcount").attr("id","zp_form_body"));var transferBody=ZPForm.LAYOUT.find("#zp_form_body");transferBody.append('<div class="row empTgrp"><div class="zp-label zp-rdonly"><label class="zplt-label">'+response.recordDetails[0]["TransferEffectiveDate.Name"]+'</label><div class="zprt-label"><div class="zpcal"><input class="form-control zptxt-edit"></div></div></div><div class="zp-label zp-rdonly"><label class="zplt-label">'+response.recordDetails[0]["TransferReason.Name"]+'</label><div class="zprt-label"><textarea class="form-control zptxtarea-edit" style="height: 75px;" spellcheck="false"></textarea></div></div></div>'),transferBody.find("input").val(response.recordDetails[0].TransferEffectiveDate),transferBody.find("textarea").text(decodeHTML(response.recordDetails[0].TransferReason));var resultDiv=$("<ul></ul>").addClass("empTview");transfers.constructTransferRecordView(response.recordDetails[0],!1,resultDiv),transferBody.append(resultDiv),ZPForm.isApprovalEnabled()&&(ZPApprovals.showApprovalHeader(response.recordDetails[0].ApprovalStatus,response.isRecordApprover,response.isPrimaryAppr,{isTransfer:!0}),otherDetails.isApprovalAction&&ZPForm.LAYOUT.find("#zp_appproval_comment_btn").is(":visible")&&ZPForm.LAYOUT.find("#zp_appproval_comment_btn").trigger("click"))},scrollEvent:function(){var props=ZPView.getViewPropertie();props.startInd=props.startInd+props.limit,ZPView.refresh(!0)},getCurrentProperties:function(){return transfers.properties[transfers.transferId]},updateApprovalStatus:function(recordId,approvalStatus){var recordDiv=Layout.Page.container.find("[recordId="+recordId+"]");recordDiv.find("#approvalStatus").remove(),"1"==approvalStatus?recordDiv.find(".actions").append($("<span></span>").attr("id","approvalStatus").addClass("grn").text(ZPI18N.getString("zp.approved"))):"0"==approvalStatus?recordDiv.find(".actions").append($("<span></span>").attr("id","approvalStatus").addClass("red").text(ZPI18N.getString("zp.rejected"))):"-2"!=approvalStatus&&recordDiv.find(".actions").append($("<span></span>").attr("id","approvalStatus").text(ZPI18N.getString("zp.approvalpending")))},valueParsing:function(formComp,value){var returnVal,fieldType=formComp.fieldType;if("TransferEffectiveDate"!=formComp.labelName&&"TransferReason"!=formComp.labelName)return fieldType==ZPForm.Field.LOOKUP||fieldType==ZPForm.Field.PICKLIST?"-Select-"==value?ZPI18N.getString("zp.transfer.novalue"):(101===formComp.displayType||formComp.displayType==ZPForm.Field.CHECK_BOXES_DISPLYTYPE?(returnVal="",$.each(ZPForm.FIELD_LAYOUT.find("[folabel="+formComp.labelName+"]").find("input:checked"),function(index,obj){returnVal=""==returnVal?$(obj).siblings("span").text():returnVal+","+$(obj).siblings("span").text()})):(returnVal="",formComp.displayType===ZPForm.Field.SELECT_DISPLYTYPE?returnVal=ZPForm.FIELD_LAYOUT.find("[name="+formComp.labelName+"]").select2("data").text:$.each(ZPForm.FIELD_LAYOUT.find("[name="+formComp.labelName+"]").select2("data"),function(index,obj){returnVal=""==returnVal?obj.text:returnVal+","+obj.text})),"Select"==returnVal?ZPI18N.getString("zp.transfer.novalue"):returnVal):value},showDiff:function(url,params,callBack){ZPForm.LAYOUT.find(".empTgrp .zp-label").addClass("zp-rdonly").removeClass("zp-err");var canShowSubmit=!0;0==ZPForm.LAYOUT.find("#zp_transfer_summary").length&&ZPForm.LAYOUT.find("#zp_form_body").append($("<div></div>").attr("id","zp_transfer_summary")),ZPForm.LAYOUT.find("#zp_transfer_summary").empty(),ZPForm.LAYOUT.find("#zp_transfer_summary").show(),ZPForm.LAYOUT.find("#zp_tranfer_result").hide(),ZPForm.LAYOUT.find("#zp_transfer_fields").hide();var resultDiv=$("<ul></ul>").addClass("empTview");if(1==transfers.recordIds.length)(canShowSubmit=transfers.appendField(transfers.PARAM_VAL[ZPForm.CURRFORM_PARAM.formId],params,resultDiv,transfers.recordIds[0],!1,"summary"))||($("<div></div>").addClass("ZPednote").text(ZPI18N.getString("zp.transfer.nodiff")).append($("<i></i>").addClass("IC-alert")).insertAfter(ZPForm.LAYOUT.find(".modal-title")),ZPForm.LAYOUT.find("#zp_form_header").addClass("err"));else{var isDiffpresentForOne=!1;$.each(transfers.recordIds,function(index,recordId){transfers.appendField(transfers.PARAM_VAL[ZPForm.CURRFORM_PARAM.formId],params,resultDiv,recordId,!0,"summary")?isDiffpresentForOne=!0:(ZPForm.LAYOUT.find("#zp_form_header").hasClass("err")||($("<div></div>").addClass("ZPednote").text(ZPI18N.getString("zp.transfer.errorspresent")).append($("<i></i>").addClass("IC-alert")).insertAfter(ZPForm.LAYOUT.find(".modal-title")),ZPForm.LAYOUT.find("#zp_form_header").addClass("err")),ZPForm.LAYOUT.find("#zp_form_outer_container").hasClass("err")||ZPForm.LAYOUT.find("#zp_form_outer_container").addClass("err"),resultDiv.find(".empTlist[baserecord="+recordId+"]").addClass("sel").prepend($("<p></p>").addClass("red").text(ZPI18N.getString("zp.transfer.nodiff"))).append($("<i></i>").addClass("IC-alert")).append($("<a></a>").attr("removeId","true").addClass("btn-link").on("click",transfers.removeBaseRecordId).text(ZPI18N.getString("zp.remove"))))}),canShowSubmit=isDiffpresentForOne}ZPForm.LAYOUT.find("#zp_transfer_summary").append(resultDiv),canShowSubmit?ZPForm.LAYOUT.find("#transferSubmit").removeAttr("onclick").off().on("click",{url:url,params:params,callBack:callBack},transfers.submitTransfer).removeAttr("disabled").text(ZPI18N.getString("zp.transfer.initiate")+ZPForm.FORM_DETAILS[ZPForm.CURRFORM_PARAM.formId].formdisplayName):ZPForm.LAYOUT.find("#transferSubmit").hide(),ZPForm.LAYOUT.find(".modal-footer").prepend('<button type="button" class="btn btn-default" id="transferBack" onclick="transfers.showFormFields();">'+ZPI18N.getString("zp.back")+"</button>")},removeBaseRecordId:function(details){if(transfers.recordIds.splice(transfers.recordIds.indexOf($(details.currentTarget.parentNode).attr("baserecord")),1),$(details.currentTarget.parentNode).remove(),1===transfers.recordIds.length){ZPForm.LAYOUT.find("[removeId=true]").remove();var transferHeader=ZPForm.LAYOUT.find("#zp_form_header");transferHeader.hasClass("empMT")&&(transferHeader.find("div.empMTph").remove(),transferHeader.removeClass("empMT"),headerDetails=transfers.headerDetails[transfers.recordIds[0]],transferHeader.append('<div class="MT10 oHide">\t\t\t\t\t\t    \t<div class="BGtxt MT5">\t\t\t\t\t\t\t\t\t<img src="'+headerDetails.photo+'">\t\t\t\t        \t\t</div>\t\t\t\t        \t\t<div class="DIB">\t\t\t\t        \t\t\t<span class="bld">'+ZSEC.Encoder.encodeForHTML(headerDetails.id)+"-"+headerDetails.name+'</span>\t\t\t\t        \t\t\t<span class="DB S13 MT5">\t\t\t\t            \t\t\t<em class="FL dgry">'+(""==headerDetails.designation?headerDetails.mailId:headerDetails.designation)+"</em>\t\t\t\t            \t\t</span>\t\t\t\t            \t</div>\t\t\t\t            </div>"))}0==ZPForm.LAYOUT.find("#zp_transfer_summary").find(".empTlist.sel").length&&(ZPForm.LAYOUT.find("#zp_form_outer_container").removeClass("err"),ZPForm.LAYOUT.find("#zp_form_header").removeClass("err").find(".ZPednote").remove())},showFormFields:function(){ZPForm.LAYOUT.find("#zp_form_header").removeClass("err").find(".ZPednote").remove(),ZPForm.LAYOUT.find(".empTgrp .zp-label").removeClass("zp-rdonly"),ZPForm.LAYOUT.find("#transferBack").remove(),ZPForm.LAYOUT.find("#zp_transfer_summary").hide(),ZPForm.LAYOUT.find("#zp_tranfer_result").hide(),ZPForm.LAYOUT.find("#zp_transfer_fields").show(),ZPForm.LAYOUT.find("#transferSubmit").removeAttr("onclick").off().removeAttr("disabled").show().text(ZPI18N.getString("zp.next")).on("click",function(){ZPForm.IS_SUBMITNEW=!1,ZPForm.Record.validateAndSubmit()})},submitTransfer:function(details){ZPForm.LAYOUT.find("#zp_transfer_summary").hide(),ZPForm.LAYOUT.find("#transferSubmit").hide(),ZPForm.LAYOUT.find(".empTgrp .zp-label").addClass("zp-rdonly"),ZPForm.LAYOUT.find("#transferBack").remove(),0==ZPForm.LAYOUT.find("#zp_tranfer_result").length&&ZPForm.LAYOUT.find("#zp_form_body").append($("<div></div>").attr("id","zp_tranfer_result")),ZPForm.LAYOUT.find("#zp_tranfer_result").empty(),ZPForm.LAYOUT.find("#zp_tranfer_result").append(ZPeople.LOADING_HTML),details.data.params.dataChangeBaseRecordIds=JSON.stringify(transfers.recordIds),ZPeople.Request.send(details.data.url,details.data.params,details.data.callBack)},confirmDeleteRecord:function(details){ZPeople.BSModal.confirm(function(){var params={mode:"deleteRecords",recordIds:details.currentTarget.parentElement.parentElement.getAttribute("recordid"),formId:ZPView.CURR_VIEWPARAMS.formId};ZPeople.Request.send(ZPForm.URL,params,transfers.deleteRecResponse)})},deleteRecResponse:function(response,params){7e3===response.code?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.recorddeletedsuccessfully")),Layout.Page.container.find("#zp_view_record_"+params.recordIds).remove()):void 0!==response.message?ZPeople.Message.showFailureMsg(response.message):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"))},exportTransfer:function(){var formObj=$("#zp_export_form").html(""),exportCont=$("#zp_export_container"),ftype=exportCont.find("[name=zp_ftype]:checked").val();formObj.attr("action","transfers.zp"),exportCont.find("#zp_export_incapprovaldata").length>0&&formObj.append('<input type="hidden" value="'+exportCont.find("#zp_export_incapprovaldata").find("[type=checkbox]").is(":checked")+'" name="includeApproval">'),formObj.append('<input type="hidden" value="'+csrfToken+'" name="'+csrfParamName+'">'),formObj.append('<input type="hidden" value="'+ZPeople.Module.MODULE_DATA[ZPeople.Module.getModuleKey()].viewDetails.message[0].viewId+'" name="viewId">'),formObj.append('<input type="hidden" value="'+transfers.transferId+'" name="transferId">'),formObj.append('<input type="hidden" value="'+ftype+'" name="exportType">'),formObj.append('<input type="hidden" value="exportTransferRecords" name="mode">');var viewProp=ZPView.getViewPropertie();viewProp.searchBy&&(formObj.append('<input type="hidden" value="" name="searchBy">'),formObj.find("input[name=searchBy]").val(JSON.stringify(viewProp.searchBy))),viewProp.empstatus&&formObj.append('<input type="hidden" value="'+viewProp.empstatus+'" name="employeeStatus">'),viewProp.approval&&formObj.append('<input type="hidden" value="'+viewProp.approval+'" name="approvalStatus">'),viewProp.orgStructureFilter&&(formObj.append('<input type="hidden" value="" name="orgStructureFilter">'),formObj.find("input[name=orgStructureFilter]").val(JSON.stringify(viewProp.orgStructureFilter))),formObj.submit(),formObj.attr("action",'ExportData.zp"')},addProfilePicRecord:function(erecno,photoId){$("#zp_profilephoto #addProfilePic").attr("disabled","disabled");var params={mode:"addProfilePicRow",recordId:erecno,photoId:photoId};ZPeople.Request.sendAsyncPost(transfers.URL,params,ZPeople.showuploadedPhoto)},showProfilePic:function(viewButton,formId,recordId){$("#zp_profilephotoDisp").remove();var src=viewButton.parentElement.parentElement.getElementsByTagName("img")[0].getAttribute("src"),userId=ZPForm.SINGLE_RECORD_DTL[formId+"_"+recordId].record.message["DatachangeBaseRecord.ID"],userDtl=ZPeople.getUserDetailsById(userId);$("body").append('<div class="modal fade ZPPmdl" role="dialog" id="zp_profilephotoDisp" aria-hidden="true" style="z-index: 930"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header PR"><button type="button" id="closebutton" class="close" data-dismiss="modal" aria-label="Close" onclick=""><span aria-hidden="true"><div class="IC-cls-1px red S21 CP"></div></span></button><h6 id="zp_modal_header">'+userDtl.name+" , "+userDtl.empid+'</h6></div><div id="zp_modal_body" class="modal-body P0I"><img src="'+src+'"></div></div></div></div>'),$("#zp_profilephotoDisp").modal()}};