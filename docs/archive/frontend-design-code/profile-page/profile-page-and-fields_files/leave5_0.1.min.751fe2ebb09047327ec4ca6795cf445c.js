var Leave={};Leave.View={SELECTED_USER:{},url:"/leave_view_actions.zp",exporturl:"leave_view_export.zp",EDITABLE_PAGES:["#leavetracker/view","#leavetracker/views/applications/view","#selfservice/leave/list"],CANCEL_INFO_TEMPLATE:$('<ul class="dropdown-menu info-drop ZPCmn-Arrow top rt gray" style="display: block;"><li id="reason_row" class="DN"><span class="lvcanlPoptop_hed">Reason :</span><span class="gry" id="reason"></span></li><li><span class="lvcanlPoptop_hed">Cancelled by :</span><span class="gry" id="user"></span></li><li><span class="lvcanlPoptop_hed">Cancelled on :</span><span class="gry" id="time"></span></li></ul>'),isEditAllowedInPage:()=>{var pageUrl=Layout.Page.hash.split("-")[0];return-1!=!Leave.View.EDITABLE_PAGES.indexOf(pageUrl)||-1!=!LVUtil.urls.ListView.VIEW().indexOf(pageUrl)||-1!=!LVUtil.urls.Applications.VIEW().indexOf(pageUrl)},selectModeOfView:isList=>{isList?(Layout.Page.container.find(".PI_listview").addClass("zpl_act"),Layout.Page.container.find(".PI_monthly").removeClass("zpl_act")):(Layout.Page.container.find(".PI_listview").removeClass("zpl_act"),Layout.Page.container.find(".PI_monthly").addClass("zpl_act"))},lswitchListView:function(){Leave.View.selectModeOfView(!0),window.location=LVUtil.urls.getUrlAsHash(LVUtil.Tab.isUserPage()?LVUtil.urls.ListView.TEAMUSERHOME():LVUtil.Tab.isOpersUserPage()?LVUtil.urls.ListView.OPERUSERHOME():LVUtil.urls.ListView.HOME())},lswitchCalendarView:function(){Leave.View.selectModeOfView(),window.location=LVUtil.urls.getUrlAsHash(LVUtil.Tab.isUserPage()?LVUtil.urls.Calendar.TEAMUSERHOME():LVUtil.Tab.isOpersUserPage()?LVUtil.urls.Calendar.OPERUSERHOME():LVUtil.urls.Calendar.HOME())},constructMoreOption:()=>{var pageId=Layout.Page.pageId;$("#moreoptionmenu_"+pageId).length>0&&(ZPeopleComponents.menu($("#moreoptionmenu_"+pageId)).destroy(),$("#moreoptionmenu_"+pageId).remove());let type=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.CalendarSync_Data.type;var text=ZPI18N.getString("zp.leave.calendarsync.init"),callback="Leave.CalSync.init()";1==type?(text=ZPI18N.getString("zp.leave.calendarsync.push",["Microsoft 365"]),callback="Leave.CalSync.Office365.init()"):2==type&&(text=ZPI18N.getString("zp.leave.calendarsync.push",["Google"]),callback="Leave.CalSync.Google.init()");var moreopt=[{id:"ZP-Sync",iClass:"PI_reload",name:text,callback:callback}];ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.allowImport&&moreopt.push({id:"import",iClass:"PI_imprt",name:ZPI18N.getString("zp.import"),callback:"LeaveApplications.Import.construct()"}),ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.allowExport&&(LVUtil.Tab.isCalendar()?moreopt.push({id:"export",iClass:"PI_exprt",name:ZPI18N.getString("zp.export"),callback:"LeaveAdminOpers.Util.exportICS()"}):moreopt.push({id:"export",iClass:"PI_exprt",name:ZPI18N.getString("zp.export"),callback:"LeaveAdminOpers.Util.showExport(this)"}));var mhtml='<div id="moreoptionmenu_'+pageId+'" class="zpl_drpdwn zmenu zmenu--iconwithtext" data-type="list" data-content-type="icon-text" role="menu"><ul data-body="true" class="zmenu__body">';$.each(moreopt,function(indx,value){value.iClass&&(mhtml+='<li onclick="'+value.callback+'" data-action="'+value.callback+'" data-icon-class="'+value.iClass+'" id="'+value.id+'" class="zmenu__item">',mhtml+='<div class="zmenu__iconcontainer"><i class="zmenu__icon '+value.iClass+'"></i></div>'),mhtml+='<span class="zmenu__text">'+value.name+"</span></li>"}),mhtml+="</ul></div>",Layout.Page.container.append(mhtml),ZPeopleComponents.menu("#moreoptionmenu_"+pageId,{forElement:Layout.Page.container.find("#moreoptionmenuBtn_"+pageId),appendTo:Layout.Page.container})}},Leave.View.Calendar={refresh:!0,key:"calendar_view",mode:"user",isFromSearch:!1,departmentData:{},initHTML:function(){let btn_name=ZPI18N.getString("zp.leave.apply");Leave.Util.getfilterOptions().formdisplayName!==ZSEC.Encoder.encodeForHTML(ZPI18N.getString("zp.leave"))&&(btn_name=ZPI18N.getString("zp.apply")+" "+Leave.Util.getfilterOptions().formdisplayName);let html='<div id="zp_lvCalOutCont"><div class="zpl_btnmnu"> <div class="zpl_lft"></div> <div class="zpl_cntrdv ZP-YearPager"> <div class="zpl_inav"><i class="PI_alft" aria-label="'+ZPI18N.getString("zp.common.previousmon")+'" tabindex="0"></i> <i class="PI_monthly"></i><i class="PI_argt" aria-label="'+ZPI18N.getString("zp.common.nextmon")+'" tabindex="0"></i> </div> <div><b class="ZPCalNav mon" id="calmonth"></b></div> </div> <div class="zpl_rgt"><div class="grpbtn"><i class="PI_listview" title="'+ZPI18N.getString("zp.listview")+'" onclick="Leave.View.lswitchListView();"></i><i class="PI_monthly" title="'+ZPI18N.getString("zp.calendarview")+'" onclick="Leave.View.lswitchCalendarView();"></i></div><button class="zlabel zlabel--blue zlabel--medium ZP-Add DN" >'+btn_name+'</button><i class="zpl_ibg PI_more" id="moreoptionmenuBtn_'+Layout.Page.pageId+'" title="'+ZPI18N.getString("zp.more")+'"></i></div> </div>';html+='<div class="zpl_rgtcnt" id="zp_lvCalOutCont"><div id="caldiv" class="zpl_calndrvw"></div></div></div>',Layout.Page.container.html(html)},initPage:function(){LVUtil.Tab.InitPage(Leave.View.Calendar.init,LVUtil.Tab.isTeamPage()),Leave.View.selectModeOfView()},init:function(isFromSearch){var calObj=showNewTab?void 0:Leave.View.Calendar.calObj;if(LVUtil.Tab.isMyPage()?Leave.View.Calendar.mode="user":LVUtil.Tab.isTeamPage()&&(Leave.View.Calendar.mode="department"),LVUtil.urls.Calendar.isView())LVUtil.Tab.isNewTabPage()?(new LeaveForm).view(Layout.Page.urlparam.recordId):Leave.viewRec();else if(LVUtil.urls.Calendar.isHome()||LVUtil.urls.OnLeave.isHome())if(calObj)1==isFromSearch?Leave.View.Calendar.get():NewCalendar.constructCalendar(Leave.View.Calendar.calObj);else{(calObj=new NewCalendar.calObj).curYear=(new Date).getFullYear(),calObj.curMonth=(new Date).getMonth(),calObj.calcontId="monthcalendardiv",calObj.outerdivId="zp_lvCalOutCont",calObj.daysObj={empty:"zpcalempty",weekend:"zpcalweek",day:"zpcaldays",today:"zpcaltoday",leave:"zpcalholi"},calObj.callback=_.debounce(Leave.View.Calendar.get,200),calObj.divid="caldiv",calObj.mode="leave",calObj.tdonclick=null,calObj.totaldata=!1,calObj.prearrow="PI_alft",calObj.nextarrow="PI_argt",Leave.Util.reg(),Leave.View.Calendar.calObj=calObj,NewCalendar.initCalendar(calObj);var calDateRangeDiv=Layout.Page.container.find("#calmonth"),date=months[calObj.curMonth]+" "+calObj.curYear;calDateRangeDiv.attr({"aria-label":ZPI18N.getString("zp.common.period")+date,tabindex:"0"})}},get:function(){var params={mode:Leave.View.Calendar.mode,month:Leave.View.Calendar.calObj.curMonth,year:Leave.View.Calendar.calObj.curYear};params.key=-1!==Layout.Page.hash.indexOf("#leavetracker/views/calendar/department")?"department_calendar":"calendar_view",LVUtil.urls.OnLeave.isHome()&&(params.key="department_calendar"),"department"==Leave.View.Calendar.mode&&Leave.View.Calendar.departmentData.hasOwnProperty(Leave.View.Calendar.calObj.curMonth+"-"+Leave.View.Calendar.calObj.curYear)?Leave.View.Calendar.construct(Leave.View.Calendar.departmentData[Leave.View.Calendar.calObj.curMonth+"-"+Leave.View.Calendar.calObj.curYear]):("calendar_view"==params.key?Leave.Util.filterCrt(params):LeaveAdminOpers.Util.filterParams(params),ZPeople.Request.send(Leave.View.url,params,Leave.View.Calendar.construct,{},Leave.View.Calendar.showErrorMsg))},construct:function(dataArr,params){if(Leave.View.Calendar.calObj.curMonth==params.month&&Leave.View.Calendar.calObj.curYear==params.year){var leaves=dataArr.data;"department"==Leave.View.Calendar.mode&&(leaves=Leave.View.Calendar.constructDepartmentViewForV5(dataArr.data)),dataArr.allowAdd?Layout.Page.container.find(".ZP-Add").removeClass("DN"):Layout.Page.container.find(".ZP-Add").addClass("DN"),NewCalendar.populateData(Leave.View.Calendar.calObj,leaves),Layout.Page.container.find(".calbrmre").on("click",function(){Leave.View.Calendar.showDateCardForV5($(this))}),TimelyZComp.toolTip.intiliaze()}},constructDepartmentView:function(leaves){var calendar2={};for(var date in leaves){for(var date_detail=leaves[date],leave_count=date_detail.count,display_leave_count=leave_count>3?2:leave_count,cal_date_txt="",cal_date=date.slice(-2),i=0;i<display_leave_count;i++){var leave=date_detail[i],bar_class=(leave.leave_count,Leave.View.Calendar.getBarClass(ZP.optValue(leave,"leave_count",1),ZP.optValue(leave,"leave_session",1)));cal_date_txt+='<div class="ZPcalvw-month-item ZPcalvwlebor calusnme LT'+leave.leavetype_color+'" data-toggle="tooltip" data-placement="top" title="" data-original-title="'+leave.emp_name+'"><span class="ZPcalvwlebg '+bar_class+'"></span><strong><small>'+leave.emp_id+" - </small>"+leave.emp_name+"</strong></div>"}leave_count>3&&(cal_date_txt+='<a class="calbrmre" date="'+date+'">'+(leave_count-2)+" more</a>"),calendar2[cal_date]={date:cal_date,txt:cal_date_txt}}return calendar2},getBarClass:function(count,session){var bar_class="ZPcalvw-Full";return.5==count?bar_class=2==session?"ZPcalvw-Wshlf":"ZPcalvw-Wfhlf":.25==count&&(bar_class=2==session?"ZPcalvw-Wsqtd":3==session?"ZPcalvw-Wtqtd":4==session?"ZPcalvw-Wfqtd":"ZPcalvw-Wqtd"),bar_class},showDateCard:function(more_tag){Layout.Page.container.find("[id*=leave_dep_]").addClass("DN");var date=more_tag.attr("date"),params={key:"calendar_department_date"};if(Leave.Util.filterCrt(params),params.date=date,Layout.Page.container.find("[id=leave_dep_"+date+"]")[0]){var card=Layout.Page.container.find("[id=leave_dep_"+date+"]");card.removeClass("DN"),Leave.View.Calendar.setPositionForCard(card)}else ZPeople.Request.send(Leave.View.url,params,function(resp){var exist_leavetypes=[],card=Leave.View.Calendar.constructDateCard(resp.data,date,0,exist_leavetypes);more_tag.after(card),(card=more_tag.parent().find("#leave_dep_"+date)).find(".caldprtmntmdl_lst").on("scroll",Leave.View.Calendar.showMore),Leave.View.Calendar.setPositionForCard(card),card.data("data",{sIndx:0,date:date,exist_leavetypes:exist_leavetypes,fetch_more:!0}),more_tag.parent().find(".IC-cls").on("click",function(){$(this).parent().addClass("DN")})},{},Leave.View.Calendar.showErrorMsg)},setPositionForCard:function(card){var calendar=$(".ZPcalvw-box"),appear_top=card.offset().top+340>calendar.height()+calendar.offset().top,appear_right=card.offset().left+290>calendar.width();card.css("bottom",appear_top?"20px":"").css("right",appear_right?"20px":"")},constructDateCard:function(data,date,sIndx,exist_leavetypes){var leavetypes=data.leavetypes,ltyp_vs_employees=data.ltyp_vs_employees,display_date=Calendar.parseDate(date,Calendar.DB_DATEFORMAT),card=0==sIndx?'<div class="caldprtmntmdl active" id="leave_dep_'+date+'"><a class="IC-cls"></a><h2>'+daysFull[display_date.getDay()]+", "+display_date.getDate()+'</h2><div class="caldprtmntmdl_lst">':"";return _.forEach(leavetypes,function(ltyp,ltyp_id){ltyp_id=ltyp.ltyp_id,-1==exist_leavetypes.indexOf(ltyp_id)&&(card+='<div class="clrlvelst"><span class="LT'+ltyp.color+'"></span> '+ZPeople.escapeHtml(ltyp.name)+"</div>",exist_leavetypes.push(ltyp_id));var employees=ltyp_vs_employees[ltyp_id];_.each(employees,function(employee){card+='<div class="zpusImg ZP-Employee"><img class="img-26" src="'+employee.photo+'"><div class="zpusImg_nme"><span data-toggle="tooltip" data-placement="top" title="" data-original-title="'+ZP.optValue(employee,"name","")+'"><b>'+ZPeople.escapeHtml(ZP.optValue(employee,"id",""))+" - </b>  "+ZPeople.escapeHtml(ZP.optValue(employee,"name",""))+"</span></div></div>"})}),card+=card=0==sIndx?" </div></div>":""},showMore:function(){var card=$(this),card_data=card.parent().data("data"),scrolled_length=card.scrollTop()+card.height(),emp_count=card.find(".ZP-Employee").length;if(card_data.fetch_more&&scrolled_length>=card[0].scrollHeight&&emp_count%30==0){var params={key:"calendar_department_date"};Leave.Util.filterCrt(params),params.date=card_data.date,params.sIndx=emp_count+1,card_data.fetch_more=!1,ZPeople.Request.send(Leave.View.url,params,function(resp){var more_date=Leave.View.Calendar.constructDateCard(resp.data,params.date,params.sIndx,card_data.exist_leavetypes);card.append(more_date),card_data.fetch_more=_.size(resp.data.ltyp_vs_employees)>0},{},Leave.View.Calendar.showErrorMsg)}},showErrorMsg:function(){ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.leave.view.calendar.errormsg")),Leave.Util.removeLoading()},constructDepartmentViewForV5(leaves){var calendar2={};for(var date in leaves){for(var date_detail=leaves[date],leave_count=date_detail.count,display_leave_count=leave_count>3?3:leave_count,cal_date_txt="",cal_date=date.slice(-2),i=0;i<display_leave_count;i++){var leave=date_detail[i],bar_class=Leave.View.Calendar.getBarClassForV5(ZP.optValue(leave,"leave_count",1),ZP.optValue(leave,"leave_session",1));cal_date_txt+='<div class="zpl_shftdts '+(leave.ltyp_color?"lv_bgbdrs"+leave.ltyp_color:"lv_bgbdrsgenrl")+" "+bar_class+' zpl_orgemplst"><small><img src="'+leave.emp_photo+'" alt=""></small><span class="tooltip-js" data-title-position="bottom" title="'+leave.emp_id+" - "+leave.emp_name+" &#10; "+(leave.ltyp_name?ZSEC.Encoder.encodeForHTML(leave.ltyp_name):"")+'">'+leave.emp_id+" - "+leave.emp_name+"</span></div>"}leave_count>3&&(cal_date_txt+='<a class="calbrmre" date="'+date+'">'+(leave_count-3)+" more</a>"),calendar2[cal_date]={date:cal_date,txt:cal_date_txt}}return calendar2},getBarClassForV5:function(count,session){var bar_class="";return.5==count?bar_class=2==session?"zpl_halfsec":"zpl_halffst":.25==count&&(bar_class=2==session?"zpl_qrtrsec":3==session?"zpl_qrtrthrd":4==session?"zpl_qrtrfour":"zpl_qrtrfst"),bar_class},showDateCardForV5(more_tag){var date=more_tag.attr("date"),params={key:"calendar_department_date"};LeaveAdminOpers.Util.filterParams(params),params.date=date,ZPeople.Request.send(Leave.View.url,params,function(resp){var exist_leavetypes=[],modalParams={};modalParams.id="leave_dep_"+date,modalParams.cardId="leave_dep_"+date+"_cont";var display_date=Calendar.formatDate(Calendar.parseDate(date,Calendar.DB_DATEFORMAT)),addModal=new sliderModal(display_date,modalParams);addModal.construct(),addModal.setCloseCallback(function(){addModal.remove()}),Leave.View.Calendar.constructDateCardForV5(resp.data,date,0,exist_leavetypes);var modal=Layout.Page.container.find("#leave_dep_"+date);modal.find("#leave_dep_"+date+"_cont").on("scroll",function(){Leave.View.Calendar.showMoreV5($(this))}),modal.data("data",{sIndx:0,date:date,exist_leavetypes:exist_leavetypes,fetch_more:!0}),Leave.View.Calendar.showMoreV5(modal.find("#leave_dep_"+date+"_cont"))})},constructDateCardForV5(data,date,sIndx,exist_leavetypes){var modal=$("#leave_dep_"+date,Layout.Page.container);modal.find("#sliFootDiv").remove();var modalCont=$("#leave_dep_"+date+"_cont",modal),leavetypes=data.leavetypes;if(void 0!==leavetypes){var ltyp_vs_employees=data.ltyp_vs_employees;_.forEach(leavetypes,function(ltyp,ltyp_id){if(ltyp_id=ltyp.ltyp_id,-1==exist_leavetypes.indexOf(ltyp_id)){var card='<div class="zpl_flexcolumngap2"  id="lt_'+ltyp_id+'">';card+='<div class="d-flexclmcap10 a-itm-cntr"><span class="zpl_lbdr _bx lv_bg'+ltyp.color+'"></span><div class="d-flexC"><span>'+ZPeople.escapeHtml(ltyp.name)+"</span></div></div>",card+='<div class="zpl_crdlst "></div>',card+="</div>",modalCont.append(card),exist_leavetypes.push(ltyp_id)}var employees=ltyp_vs_employees[ltyp_id],empCard="";_.each(employees,function(employee){var dept=ZPeople.escapeHtml(ZP.optValue(employee,"department","-"));empCard+='<div class="zpl_catlst" data-popup-open="courseinfo"><div class="d-flexC d-flexclmcap10"><div class="flex-grow0 zpl_em"><div class="zpl_emimg"><img src="'+employee.photo+'"></div><div class="zpl_emdts"><div><em>'+ZPeople.escapeHtml(ZP.optValue(employee,"id",""))+" - </em><b>"+ZPeople.escapeHtml(ZP.optValue(employee,"name",""))+"</b></div><div><em>"+ZPeople.escapeHtml(ZP.optValue(employee,"designation",""))+"</em></div><div><em>"+ZPeople.escapeHtml(ZP.optValue(employee,"mail",""))+'</em></div></div></div></div><div class="zpl_catlstrgt"><div class="zpl_tg '+(dept.length<=0?"DNI":"")+'"><span>'+dept+"</span></div></div></div>"}),empCard.length>0&&modalCont.find("#lt_"+ltyp_id).find(".zpl_crdlst").append(empCard)})}else{var employees=data.employees,card='<div class="zpl_flexcolumngap2">';card+='<div class="d-flexclmcap10 a-itm-cntr"></div>',card+='<div class="zpl_crdlst "></div>',card+="</div>",modalCont.append(card);var empCard="";_.each(employees,function(employee){var dept=ZPeople.escapeHtml(ZP.optValue(employee,"department","-"));empCard+='<div class="zpl_catlst" ><div class="d-flexC d-flexclmcap10"><div class="flex-grow0 zpl_em"><div class="zpl_emimg"><img src="'+employee.photo+'"></div><div class="zpl_emdts"><div><em>'+ZPeople.escapeHtml(ZP.optValue(employee,"id",""))+" - </em><b>"+ZPeople.escapeHtml(ZP.optValue(employee,"name",""))+"</b></div><div><em>"+ZPeople.escapeHtml(ZP.optValue(employee,"designation",""))+"</em></div><div><em>"+ZPeople.escapeHtml(ZP.optValue(employee,"mail",""))+'</em></div></div></div></div><div class="zpl_catlstrgt"><div class="zpl_tg '+(dept.length<=0?"DNI":"")+'"><span>'+dept+"</span></div></div></div>"}),empCard.length>0&&modalCont.find(".zpl_flexcolumngap2").find(".zpl_crdlst").append(empCard)}},showMoreV5(Obj){var card=$(Obj),card_data=card.parent().parent().data("data"),scrolled_length=card.scrollTop()+card.height(),divheight=card[0].scrollHeight-100,emp_count=card.find(".zpl_catlst").length;if(card_data.fetch_more&&divheight<scrolled_length&&emp_count>0&&emp_count%30==0){var params={key:"calendar_department_date"};Leave.Util.filterCrt(params),params.date=card_data.date,params.sIndx=emp_count+1,card_data.fetch_more=!1,ZPeople.Request.send(Leave.View.url,params,function(resp){Leave.View.Calendar.constructDateCardForV5(resp.data,params.date,params.sIndx,card_data.exist_leavetypes),card_data.fetch_more=_.size(resp.data.ltyp_vs_employees)>0})}}},Leave.View.List={url:"/leave_view_actions.zp",employee:"",refresh:!0,key:"newlist_view",initHTML:function(){var form_name=Leave.Util.getfilterOptions().formdisplayName;let btn_name=ZPI18N.getString("zp.leave.apply");form_name!==ZSEC.Encoder.encodeForHTML(ZPI18N.getString("zp.leave"))&&(btn_name=ZPI18N.getString("zp.apply")+" "+form_name);let html="";Leave.Util.isDashboardUser()||(LVUtil.Tab.isGlobalSearchUserPage()?html+='<div class="zpl_dtlviewsec"><span class="d-flexC"> <b>'+ZPI18N.getString("zp.thisyear")+' </b><span class="zpl_dots"></span><div id="bookedlvinfo" class="tooltip-js" data-title-position="bottom" title="'+ZPI18N.getString("zp.leave.exludeODandRH")+'"><em> '+ZPI18N.getString("zp.leavebooked")+' : </em><span>0</span></div><div class="gry8">&nbsp;|&nbsp;</div> <div id="bookedabsinfo"><em>'+ZPI18N.getString("zp.absent")+' : </em><span>0</span></div></span>  <div class="zpl_flexaligngap2 zpl_ml-auto"> </div> </div>':html+='<div class="zpl_btnmnu"> <div class="zpl_lft"> <div id="bookedlvinfo" class="tooltip-js" data-title-position="bottom" title="'+ZPI18N.getString("zp.leave.exludeODandRH")+'"><em>'+ZPI18N.getString("zp.leavebookedyear")+' : </em><span>0</span></div><div class="gry8">|</div> <div id="bookedabsinfo"><em>'+ZPI18N.getString("zp.absent")+" : </em><span>0</span></div> </div> "+(Leave.Util.isDashboardUser()?"":'<div class="zpl_cntrdv ZP-YearPager"> <div class="zpl_inav"><i class="PI_alft" aria-label="'+ZPI18N.getString("zp.common.previousyr")+'" tabindex="0"></i> <i class="PI_monthly"></i><i class="PI_argt" aria-label="'+ZPI18N.getString("zp.common.nextyr")+'" tabindex="0"></i> </div> <div><b class="ZPCalNav"></b></div> </div>')+'<div class="zpl_rgt"><div class="grpbtn"><i class="PI_listview" title="'+ZPI18N.getString("zp.listview")+'" onclick="Leave.View.lswitchListView();"></i><i class="PI_monthly" title="'+ZPI18N.getString("zp.calendarview")+'" onclick="Leave.View.lswitchCalendarView();"></i></div><button class="zlabel zlabel--blue zlabel--medium ZP-Add DN" tabindex="0" aria-label="'+btn_name+'" >'+btn_name+'</button><i class="zpl_ibg PI_more" tabindex="0" aria-label="'+ZPI18N.getString("zp.more")+'" id="moreoptionmenuBtn_'+Layout.Page.pageId+'" title="'+ZPI18N.getString("zp.more")+'"></i></div> </div>'),html+='<div class="zpl_rgtcnt">',Leave.Util.isDashboardUser()?html+='<div class="zpl_lvelstprnt zpl_lvcrdsplit" tabindex="0" aria-label="'+ZPI18N.getString("zp.leave.leavetypesCont")+'"><div class="zpl_crd" id="ZPleave_reportcard_1"> <div class="zpl_crdcnt"><div class="d-flexM flexclmcap ZP-YearPager"> <div class="zpl_inav" id="ZPleave_yearnav"><i class="PI_alft"></i> <i class="PI_monthly"></i><i class="PI_argt"></i> </div> <div elem="dateNavigator" ><b id="ZPleave_yearnavtxt"></b> </div> </div><div class="zpl_lvcrdttl"> <b>'+ZPI18N.getString("zp.leavetype")+"</b> <b>"+ZPI18N.getString("zp.available")+"</b> <b>"+ZPI18N.getString("zp.leave.view.taken")+'</b> </div><div class="zpl_emcrdlst zpl_lvhmecrd" id="ZPleave_reportcard_1_body"> </div><div class="d-flexM flexclmcap12"> <a class="clsArw lftarw disabled"><i class="PI_alft"></i></a> <a class="clsArw rgtarw"><i class="PI_argt"></i></a> </div></div> </div><div class="zpl_crd" id="ZPleave_reportcard_2"> <div class="zpl_crdcnt"><div class="d-flexM flexclmcap ZP-YearPager"> <div class="zpl_inav"></div> </div><div class="zpl_emcrdlst zpl_lvhmecrd" id="ZPleave_reportcard_2_body"> </div><div class="d-flexM flexclmcap12"> <a class="clsArw lftarw disabled"><i class="PI_alft"></i></a> <a class="clsArw rgtarw"><i class="PI_argt"></i></a> </div></div> </div></div>':(html+='<div class="zpl_lvelstprnt" tabindex="0" aria-label="'+ZPI18N.getString("zp.leave.leavetypesCont")+'"><div class="zpl_lvcrdlft lft" style="display:none;"><a class="clsArw"  onclick="Leave.View.List.sliderClick(this)"><i class="PI_alft"></i> </a></div><div class="zpl_lvcrdlft rgt"  style="display:none;"> <a class="clsArw" onclick="Leave.View.List.sliderClick(this)"><i class="PI_argt" ></i> </a></div> <div class="zpl_emcrdlst zpl_lvhmecrd"></div>',html+="</div>"),html+='<div class="zpl_secn">',html+='<div class="zpl_crd wd100_per M0I" id="ZP_Absent_Container"  style="display:none;"><div class="zpl_crdhdr"> <div> <span class="d-flexC"><b>'+ZPeople.Module.getData("leavetracker").leave_filterops.absentDisplayName+'</b><span class="zpl_dots"></span><em id="absent_count">0</em></span> </div> </div><div class="zpl_crdcnt"> <div class="zpl_tblres zpl_lvmdltbl"> <table class="zpl_tbl wd100_per zpl_nocrsor" aria-label="'+ZPI18N.getString("zp.leave.absentdays")+'" tabindex="0"> <tbody id="ZP_Leave_ab"> </tbody> </table> </div> </div></div>',Leave.Util.isDashboardUser()||(html+='<div class="zpl_crd wd100_per" id="zp_bradford_container"><div class="zpl_crdhdr"> <div> <span class="d-flexC"><b>'+ZPI18N.getString("zp.bradfordfactor.bradfordscore")+'</b><span class="zpl_dots"></span><em id="zp_bradford_date"></em></span> </div> <div> <div> <button class="zlabel zlabel--blue zlabel--outline zlabel--medium" onclick="Leave.View.List.Bradford.detailedView();">'+ZPI18N.getString("zp.bradfordfactor.viewetailscore")+'</button> </div> </div> </div><div class="zpl_crdcnt" id="zp_bradford_score_list"> <div class="zpl_tblres zpl_lvmdltbl"> <table class="zpl_tbl wd100_per zpl_nocrsor"> <tbody id="zp_bradford_score_body"> </tbody> </table> </div> </div></div>'),html+='<div class="zpl_crd wd100_per" id="zp_leavelist_container" style="display:none;"><div class="zpl_crdhdr"> <div><select id="lvdtType" class="select w250" style="display: none;"> <option value="0">'+ZPI18N.getString("zp.upcoming")+" "+form_name+" & "+holiday_disName+'</option> <option value="1">'+ZPI18N.getString("zp.upcoming")+" "+form_name+'</option> <option value="2">'+ZPI18N.getString("zp.upcoming")+" "+holiday_disName+"</option> </select>",html+='</div> </div> <div class="zpl_crdcnt" id="ZP_Leave_lhtable"> <div class="zpl_tblres zpl_lvmdltbl"> <table class="zpl_tbl wd100_per zpl_nocrsor"> <tbody id="ZP_Leave_lh"> </tbody> </table> </div> </div></div>',html+='<div class="zpl_crd wd100_per" id="zp_leavelist_container1" style="display:none;"><div class="zpl_crdhdr"> <div><select id="lvdtType1" class="select w250" style="display: none;"> <option value="0">'+ZPI18N.getString("zp.leavetype.v2.restrictions.pastfuture.past")+" "+form_name+" & "+holiday_disName+'</option> <option value="1">'+ZPI18N.getString("zp.leavetype.v2.restrictions.pastfuture.past")+" "+form_name+'</option> <option value="2">'+ZPI18N.getString("zp.leavetype.v2.restrictions.pastfuture.past")+" "+holiday_disName+"</option> </select>",html+='</div> </div> <div class="zpl_crdcnt" id="ZP_Leave_lhtable1"> <div class="zpl_tblres zpl_lvmdltbl"> <table class="zpl_tbl wd100_per zpl_nocrsor"> <tbody id="ZP_Leave_lh1"> </tbody> </table> </div> </div></div>',html+="</div>",Layout.Page.container.parent().parent().attr({"aria-label":ZPI18N.getString("zp.common.tabname",[ZPI18N.getString("zp.leavesummary")]),tabindex:"0"}),Layout.Page.container.html(html);var lyJson=Leave.Util.getCurrentLYear(ZPeople.Module.getData("leavetracker").leave_filterops.curuser.location);void 0!=lyJson&&Layout.Page.container.find(".zpl_cntrdv.ZP-YearPager .ZPCalNav").attr({"aria-label":ZPI18N.getString("zp.common.period")+":"+lyJson.from+" - "+lyJson.to,tabindex:"0"})},initPage:function(){LVUtil.Tab.InitPage(Leave.View.List.init,!1),Leave.View.selectModeOfView(!0)},init:function(){if((LVUtil.urls.ListView.isHome()||LVUtil.Tab.isGlobalSearchUserPage())&&(showNewTab||Leave.View.List.refresh))Layout.Page.container.find("#ZPLeave_list").addClass("btn-primary"),Layout.Page.container.find("#ZPLeave_calendar").addClass("btn-default"),Leave.Util.reg(),Leave.View.List.get(),Leave.View.List.refresh=!1;else if(LVUtil.urls.ListView.isAdd())showNewTab?(new LeaveForm).add():Leave.add();else if(LVUtil.urls.ListView.isConvert())Leave.convert();else if(LVUtil.urls.ListView.isEdit())Leave.editRec();else if(LVUtil.urls.ListView.isView())(new LeaveForm).view(Layout.Page.childUrlParam.recordId);else if("#leavetracker/import"===Layout.Page.hash){var leaveObj=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops;Import.init(leaveObj.formid,void 0,Layout.Page.hash)}else LVUtil.urls.BradFord.isListView()&&(Leave.Util.isBradfordFactorEnabled()?(Leave.Report.Bradford.DetailView.regModal(Layout.Page.childUrlParam.id,LVUtil.urls.getUrlAsHash(LVUtil.urls.BradFord.LISTVIEW()),!0,!1,LVUtil.urls.getUrlAsHash(LVUtil.urls.ListView.HOME())),Leave.Report.Bradford.DetailView.get()):(ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.bradfordfactor.error.enableerror")),window.location.href=LVUtil.urls.getUrlAsHash(LVUtil.urls.ListView.HOME())))},checkAndSetInitEmployee:function(){if(""!=Leave.View.List.employee){var empObj=ZP.getUserDetailsById(Leave.View.List.employee);Leave.View.SELECTED_USER=empObj;var loc="null"!=empObj.location?empObj.location:"-1";Leave.Util.populateDateBasedOnLocation(loc),Leave.View.List.employee=""}},get:function(reloadOnlyApplications,isFromUpcoming){if(Leave.View.List.checkAndSetInitEmployee(),Leave.Util.isDashboardUser())reloadOnlyApplications?Leave.View.List.Widgets.Applications.get(isFromUpcoming):Leave.View.List.Widgets.load();else{var params={key:Leave.View.List.key};Leave.Util.filterCrt(params),params.dataType=isFromUpcoming?Layout.Page.container.find("select#lvdtType").length>0?parseInt(ZPeopleComponents.select(Layout.Page.container.find("select#lvdtType")).getValue()):0:Layout.Page.container.find("select#lvdtType1").length>0?parseInt(ZPeopleComponents.select(Layout.Page.container.find("select#lvdtType1")).getValue()):0,params.upcoming=void 0!=isFromUpcoming?isFromUpcoming:void 0,params.reloadOnlyApplications=reloadOnlyApplications;var loc=ZP.getUserDetailsById(params.employee).location;if(params.location=loc+""=="null"?-1:loc,reloadOnlyApplications||(Leave.Util.appendLoading(),Layout.Page.container.find(".Scrcont").css("overflow","initial"),$(".zpl_lvelstprnt,#ZP_Absent_Container,#zp_leavelist_container,#zp_leavelist_container1,#zp_bradford_container",Layout.Page.container).hide()),LVUtil.Tab.isGlobalSearchUserPage()){let url=LVUtil.urls.ListView.HOME();LVUtil.Tab.isGlobalSearchUserPage()&&(url=ZPeople.isOperationAllowed?LVUtil.urls.ListView.OPERUSERHOME():LVUtil.urls.ListView.TEAMUSERHOME()),Layout.Page.container.find(".zpl_dtlviewsec").find(".dtl_view").on("click",function(){window.location.hash=LVUtil.urls.getUrlAsHash(url)})}ZPeople.Request.send(Leave.View.List.url,params,reloadOnlyApplications?Leave.View.List.populateAbsentAndLeaves:Leave.View.List.construct,{})}let modeofview=Layout.Page.urlparam.key;Leave.View.List.scrollToDiv(modeofview)},scrollToDiv:mode=>{var div,top=0;"absent"==mode&&(top=(div=Layout.Page.container.find("#ZP_Absent_Container")).offset().top,div.addClass("zpl_crdblink"),setTimeout(function(){div.removeClass("zpl_crdblink")},3e3)),Layout.Page.container.scrollTop(top)},header:function(params,allowAdd){var data_thead=$("#ZP_Leave_Listview_header",Layout.Page.container);if(data_thead.length>0){ZP.create("tr",{class:"ZPERow"});var id=params.leaveyear,filterObj=Leave.Util.getfilterOptions(),location=params.location,leaveyrObj=filterObj.leaveyear,yrArr=leaveyrObj.hasOwnProperty(location)?leaveyrObj[location]:leaveyrObj[-1];for(var indx in yrArr)if(yrArr[indx].id==id)var from=yrArr[indx].from,to=yrArr[indx].to;var fromSplitted=from.split("-"),toSplitted=to.split("-"),fromDate=Calendar.parseDate(fromSplitted[0]+"-"+fromSplitted[1]+"-"+fromSplitted[2],uidateFormat),toDate=Calendar.parseDate(toSplitted[0]+"-"+toSplitted[1]+"-"+toSplitted[2],uidateFormat),header_txt="",formName=ZPeople.decodeTxt(filterObj.formdisplayName);header_txt=1==fromDate.getDate()&&0==fromDate.getMonth()&&31==toDate.getDate()&&11==toDate.getMonth()?formName+" "+ZPI18N.getString("zp.year")+"  "+fromDate.getFullYear():formName+" "+ZPI18N.getString("zp.year")+"  "+from+" - "+to,data_thead.text(header_txt)}allowAdd?Layout.Page.container.find(".ZP-Add").removeClass("DN"):Layout.Page.container.find(".ZP-Add").addClass("DN")},sliderClick:function(obj){var slideMode=$(obj).children("i").attr("class"),w=Layout.Page.container.find(".zpl_emcrd").outerWidth(),pw=Layout.Page.container.find(".zpl_lvelstprnt").width();if(-1!==slideMode.indexOf("PI_argt")){var scrollLeft=Layout.Page.container.find("div.zpl_emcrdlst").scrollLeft()+pw-(w-1);Layout.Page.container.find("div.zpl_emcrdlst").animate({scrollLeft:scrollLeft},1e3),Layout.Page.container.find(".zpl_lvelstprnt .zpl_lvcrdlft.lft").show()}else if(-1!==slideMode.indexOf("PI_alft")){scrollLeft=Layout.Page.container.find("div.zpl_emcrdlst").scrollLeft()-(pw-w-1);Layout.Page.container.find("div.zpl_emcrdlst").animate({scrollLeft:scrollLeft},1e3),Layout.Page.container.find(".zpl_lvelstprnt .zpl_lvcrdlft.rgt").show(),scrollLeft<=0&&Layout.Page.container.find(".zpl_lvelstprnt .zpl_lvcrdlft.lft").hide()}Layout.Page.container.find("div.zpl_emcrdlst")[0].scrollWidth===Layout.Page.container.find("div.zpl_emcrdlst")[0].offsetWidth&&(Layout.Page.container.find(".zpl_lvelstprnt .zpl_lvcrdlft.lft").hide(),Layout.Page.container.find(".zpl_lvelstprnt .zpl_lvcrdlft.rgt").hide())},initSelectedUserInApplyLeave:function(){LVUtil.urls.ListView.isHome()&&Leave.View.SELECTED_USER.employee&&Layout.Page.container.find("input[name=Employee_ID]").select2("val",Leave.View.SELECTED_USER.employee)},sliderScroll:function(){Layout.Page.container.find("div.zpl_emcrdlst").data("isreg")||(Layout.Page.container.find("div.zpl_emcrdlst").data("isreg",!0),Layout.Page.container.find("div.zpl_emcrdlst").on("scroll",function(){var clientWidth=Math.round(Layout.Page.container.find("div.zpl_emcrdlst").outerWidth()),widthDiff=Math.round(Layout.Page.container.find("div.zpl_emcrdlst")[0].scrollWidth-Layout.Page.container.find("div.zpl_emcrdlst").scrollLeft());Layout.Page.container.find("div.zpl_emcrdlst").scrollLeft()>0&&(clientWidth-widthDiff==1||widthDiff==clientWidth)?Layout.Page.container.find(".zpl_lvelstprnt .zpl_lvcrdlft.rgt").hide():Layout.Page.container.find("div.zpl_emcrdlst")[0].scrollWidth!=Layout.Page.container.find("div.zpl_emcrdlst").outerWidth()&&Layout.Page.container.find(".zpl_lvelstprnt .zpl_lvcrdlft.rgt").show(),0===Layout.Page.container.find("div.zpl_emcrdlst").scrollLeft()?Layout.Page.container.find(".zpl_lvelstprnt .zpl_lvcrdlft.lft").hide():Layout.Page.container.find(".zpl_lvelstprnt .zpl_lvcrdlft.lft").show()}))},constructSliderBox:function(){Layout.Page.container.find(".zpl_emcrd").length,Layout.Page.container.find(".zpl_emcrd").outerWidth(),Layout.Page.container.find(".zpl_rgtcnt").width();Layout.Page.container.find("div.zpl_emcrdlst")[0].scrollWidth!=Layout.Page.container.find("div.zpl_emcrdlst").outerWidth()&&Layout.Page.container.find(".zpl_lvelstprnt .zpl_lvcrdlft.rgt").show(),setTimeout(function(){var slr=Layout.Page.container.find("div.zpl_emcrdlst");slr[0]&&slr[0].scrollWidth===slr[0].offsetWidth&&(Layout.Page.container.find(".zpl_lvelstprnt .zpl_lvcrdlft").hide(),Layout.Page.container.find(".zpl_lvelstprnt .zpl_lvcrdlft.rgt").hide())},200)},construct:function(dataArr,params){if(dataArr.possible_errors){if("empDOJMissing"==dataArr.possible_errors){var paramArr=['<a href="#operations/organization/employee/view-recordId:'+params.employee+'">'+ZPI18N.getString("zp.dateofjoining")+"</a>"],errorMsg=ZPI18N.getString("zp.leave.dojusererror",paramArr);if(params.employee!=erecno)if(isadmin)errorMsg=ZPI18N.getString("zp.leave.dojadminerror",paramArr);else if(ZPUtil.checkIsExistInArray(ZPeople.SUB_USERLIST,params.employee));else errorMsg=ZPI18N.getString("zp.leave.dojrpmanagererror");else errorMsg=isadmin?ZPI18N.getString("zp.leave.dojadminerror",paramArr):ZPI18N.getString("zp.leave.dojrpmanagererror");return Leave.Util.removeLoading(),void(-1!=Layout.Page.hash.indexOf("selfservice/leave/list")?(Layout.Page.container.find(".zplveyear").find("#leave_errorinfo").remove(),Layout.Page.container.find(".zplveyear").html('<div class="nonactemp text-center" id="leave_errorinfo"> <h6></h6> <p class="MB0">'+errorMsg+"</p></div>")):(Layout.Page.container.find(".zpl_btnmnu").children().hide(),Layout.Page.container.find(".zpl_lvelstprnt").hide(),Layout.Page.container.find(".zpl_rgtcnt").find(".zpl_secn").hide(),Layout.Page.container.find(".zpl_rgtcnt").find(".zpl_Emptydata").remove(),Layout.Page.container.find(".zpl_rgtcnt").append('<div class="zpl_Emptydata"><div><div class="zpl_emptimg zp_nd_checkin"></div><p>'+errorMsg+"</p></div></div>")))}}else Layout.Page.container.find(".zpl_btnmnu").children().show(),Layout.Page.container.find(".zpl_rgtcnt").find("#leave_errorinfo").remove(),Layout.Page.container.find(".zpl_rgtcnt").find(".zpl_lvelstprnt").show(),Layout.Page.container.find(".zpl_rgtcnt").find(".zpl_secn").show();var lh=dataArr.data,lhCount=lh?lh.length:0,reportCount=dataArr.report.length;if(0==lhCount&&0==reportCount)return Leave.Util.removeLoading(),$("#zp_leavelist_container",Layout.Page.container).show(),Leave.Util.showHideNoData(!0,"",Layout.Page.container.find(".zpl_rgtcnt")),null;if(dataArr.historydata&&dataArr.historydata.length>0&&$("#zp_leavelist_container1",Layout.Page.container).show(),void 0!=dataArr.report[0]){var report=dataArr.report[0],lst=report.leavetypes;let text=(report.bookedLeavesDays&&report.bookedLeavesDays>0?"<b>"+report.bookedLeavesDays+"</b> <span>"+ZPI18N.getString("zp.leavetype.daysinfo")+"</span>":"")+" "+(report.bookedLeavesDays&&report.bookedLeavesDays>0&&report.bookedLeavesHours&&report.bookedLeavesHours>0?"<span>"+ZPI18N.getString("zp.and",[""])+"</span>":"")+" "+(report.bookedLeavesHours&&report.bookedLeavesHours>0?"<b>"+report.bookedLeavesHours+"</b> <span>"+ZPI18N.getString("zp.leavetype.hoursinfo")+"</span>":""),abstext=(report.absentDays&&report.absentDays>0?"<b>"+report.absentDays+"</b> <span>"+ZPI18N.getString("zp.leavetype.daysinfo")+"</span>":"")+" "+(report.absentDays&&report.absentDays>0&&report.absentHours&&report.absentHours>0?"<span>"+ZPI18N.getString("zp.and",[""])+"</span>":"")+" "+(report.absentHours&&report.absentHours>0?"<b>"+report.absentHours+"</b> <span>"+ZPI18N.getString("zp.leavetype.hoursinfo")+"</span>":"");text=text.trim().length>0?text:"<span>0</span>",abstext=abstext.trim().length>0?abstext:"<span>0</span>",Layout.Page.container.find("#bookedlvinfo > em").siblings().remove(),Layout.Page.container.find("#bookedlvinfo").append(text),Layout.Page.container.find("#bookedabsinfo > em").siblings().remove(),Layout.Page.container.find("#bookedabsinfo").append(abstext);var lstCount=lst.length;Leave.View.List.header(params,dataArr.allowAdd),Leave.Util.isV1User=dataArr.isV1User;Leave.Util.getfilterOptions();for(var tempDoc=document.createDocumentFragment(),index=0;index<lstCount;index++){var lstJson=lst[index];if(2!=lstJson.type){if(lst[index].showMore)detailsDiv=$('<div class="zpl_dfcrd zpl_emcrd zpl_lveanlrpts" id="leaveType_lstbox_'+lstJson.leavetypeid+'"> <div> <div class="d-flexC flexclmcap"> <span class="PI_onduty icn lv_bgclr'+lstJson.color+'"></span> <b title="'+lst[index].name+'">'+lst[index].name+'</b> </div> <table class="zpl_itbl"></table> </div> </div>');else{var img=ZP.create("span",{class:"lv_bgclr"+lstJson.color+" ZP-AddLeave icn"});if(lstJson.icon)img=ZP.create("span",{class:"icn ZP-AddLeave lv_bgclr"+lstJson.color+" "+Leave.Util.getLVtypeClass(lstJson.icon)});else if(lstJson.code&&lstJson.code.trim().length>0)img.append(lstJson.code.toUpperCase());else{for(var words=ZPeople.decodeTxt(lstJson.name).replace(/[!@#$%^&*(),.?":{}|<>]/g,"").split(" "),initials="",i=0;i<words.length;i++){if(2==(initials+=words[i].charAt(0).toUpperCase()).length)break}initials=0==initials.trim().length?"L":initials,img.append(document.createTextNode(initials))}detailsDiv=$('<div class="CP zpl_dfcrd zpl_emcrd" id="leaveType_lstbox_'+lstJson.leavetypeid+'"> <div class="zpl_emcrdcnt"> <div class="a-itm-cntr d-flexclmcap"> <b title="'+lst[index].name+'">'+lst[index].name+"</b>"+$(img)[0].outerHTML+"</div> </div> </div>")}var doNotDisplayBalance=lst[index].doNotDisplayBalance,curMeta=Leave.View.List;if(lst[index].hasOwnProperty("showMore")){var tbody=ZP.create("tbody");doNotDisplayBalance||(tbody.appendChild(curMeta.constructEntityInfo(ZPI18N.getString("zp.allowance"),lst[index].allowance)),tbody.appendChild(curMeta.constructEntityInfo(holiday_disName,lst[index].holidayDeducibles)),tbody.appendChild(curMeta.constructEntityInfo(ZPI18N.getString("zp.leave.availableforbooking"),lst[index].bookableAllowance)),tbody.appendChild(curMeta.constructEntityInfo(ZPI18N.getString("zp.leave.availabletobebooked"),lst[index].available))),tbody.appendChild(curMeta.constructEntityInfo(ZPI18N.getString("zp.leave.prevbooked"),lst[index].booked)),detailsDiv.find(".zpl_itbl").append(tbody)}else{let html=$('<div class="zpl_emcrdftr"> <div class="zpl_tmlvestus"> </div> </div> ');if(!doNotDisplayBalance){let available=lst[index].available?lst[index].available:0;html.find(".zpl_tmlvestus").append(" <span>"+ZPI18N.getString("zp.available")+' <b class="'+(available>0?"grn":available<0?"red":"")+'">'+available+"</b></span>"),detailsDiv.attr({"aria-label":ZPeople.decodeTxt(lst[index].name)+" "+ZPI18N.getString("zp.available")+" "+available+" "+ZPI18N.getString("zp.leave.view.booked")+" "+lst[index].taken,tabindex:"0"})}if(html.find(".zpl_tmlvestus").append("<span>"+ZPI18N.getString("zp.leave.view.booked")+" <b>"+lst[index].taken+"</b></span>"),void 0!==lst[index].used&&void 0!==lst[index].planned){var popover='<div class="zpl_popoverinr" id="lvcrdpop" data-position="top" style="display:none;"> <table class="zpl_itbl M0I"> <tbody> <tr> <td width="80"><span>'+ZPI18N.getString("zp.Used")+"</span></td> <td> <span>"+lst[index].used+"</span> </td> </tr> <tr> <td><span>"+ZPI18N.getString("zp.Planned")+"</span></td> <td> <span>"+lst[index].planned+"</span> </td> </tr> </tbody> </table> </div>";html.find(".zpl_tmlvestus").append(popover),html.find(".zpl_tmlvestus").append('<i class="PI_info zpl_icinfogry zpl_popovr-js" id="lvrptpopup" ></i>');let position="top";index+1==lstCount&&(position="left"),ZPeopleComponents.popover(html.find(".zpl_tmlvestus").find("#lvcrdpop"),{displayType:"callout",closeOnBodyClick:!0,forElement:html.find(".zpl_tmlvestus").find("#lvrptpopup"),position:position})}detailsDiv.append(html)}tempDoc.append(detailsDiv[0])}else{var days=lst[index].taken>1?ZPI18N.getString("zp.leavetype.smalldays"):ZPI18N.getString("zp.day"),absCntDiv=Layout.Page.container.find("#absent_count");absCntDiv.text(lst[index].taken+" "+days);var absentName=ZPeople.Module.getData("leavetracker").leave_filterops.absentDisplayName;absCntDiv.parent().attr("aria-label",ZPI18N.getString("zp.common.totalno",[" "])+days+" "+absentName+" are "+lst[index].taken)}}var data_tbody=Layout.Page.container.find("div.zpl_emcrdlst");data_tbody.find(".zpl_emcrd").remove(),data_tbody.append(tempDoc),data_tbody.find("[id='lvrptpopup']").on("mouseover",function(){ZPeopleComponents.popover($(this).parent().find(".zpl_popoverinr")).open()}),data_tbody.find("[id='lvrptpopup']").on("mouseout",function(){ZPeopleComponents.popover($(this).parent().find(".zpl_popoverinr")).close()}),dataArr.allowAdd?data_tbody.find(".zpl_emcrd").on("click",function(){var leavetype=$(this).attr("id").split("_")[2];if(LeaveForm.initLeaveType=leavetype,LVUtil.urls.ListView.isHome()){let url=LVUtil.urls.ListView.ADD();LVUtil.Tab.isGlobalSearchUserPage()&&(url=ZPeople.isOperationAllowed?LVUtil.urls.ListView.ADD(5):LVUtil.urls.ListView.ADD(3)),window.location.hash=LVUtil.urls.getUrlAsHash(url)}else if(-1!=Layout.Page.hash.indexOf("selfservice/leave/list")){if(dataArr.allowAdd){var params={lookupValue:SelfService.getUserId()};Leave.add(params)}}else Leave.add()}):data_tbody.find(".CP.zpl_emcrd").removeClass("CP"),Leave.View.List.constructSliderBox(),Leave.View.List.sliderScroll(),Layout.Page.container.find(".zpl_rgtcnt").show();var delay=50,browser=navigator.userAgent.toLowerCase();-1!=browser.indexOf("safari")&&-1==browser.indexOf("chrome")?$(".zpl_emcrd",Layout.Page.container).show():$(".zpl_emcrd",Layout.Page.container).each(function(){$(this).delay(delay).fadeIn(10),delay+=50})}Leave.Util.removeLoading(),Leave.View.List.populateAbsentAndLeaves(dataArr,params),Layout.Page.container.find(".zpl_rgtcnt").hide().fadeIn("fast")},populateAbsentAndLeaves:function(dataArr,params){var filterObj=Leave.Util.getfilterOptions(),lh=dataArr.data;let report=void 0!=dataArr.report?dataArr.report[0]:void 0,showAvail=!(!report||!report.restrictedBalAvil);var lhCount=lh?lh.length:0,bindClick=-1!=Layout.Page.hash.indexOf("#selfservice/leave/list");if(0==lh.length)Leave.Util.removeLoading(),Layout.Page.container.find(".Scrcont").css("overflow","auto"),(void 0==params.upcoming||params.upcoming)&&params.leaveyear>=0&&(Layout.Page.container.find("#zp_leavelist_container",Layout.Page.container).show(),Leave.Util.showHideNoData(!0,"",Layout.Page.container.find("#ZP_Leave_lhtable"))),void 0!=params.upcoming&&params.upcoming||params.leaveyear<=0&&(Layout.Page.container.find("#zp_leavelist_container1",Layout.Page.container).show(),Leave.Util.showHideNoData(!0,"",Layout.Page.container.find("#ZP_Leave_lhtable1"))),void 0==params.upcoming&&Layout.Page.container.find("#ZP_Absent_Container",Layout.Page.container).hide();else{for(var tempDoc=document.createDocumentFragment(),tempHistoryDoc=document.createDocumentFragment(),tempAbDoc=document.createDocumentFragment(),displayName=Leave.Util.getfilterOptions().formdisplayName,index=0;index<lhCount;index++){var lhJson=lh[index];if(lhJson.isHoliday&&!lhJson.isLeave){var detailsTr=ZP.create("tr",{"aria-label":ZPI18N.getString("zp.date")+" "+lhJson.disDate+" "+ZSEC.Encoder.encodeForHTML(lhJson.name)+(lhJson.isOptional&&void 0!=lhJson.holidayClassification?"("+ZSEC.Encoder.encodeForHTML(lhJson.holidayClassification)+")":""),tabindex:"0"});if($(detailsTr).append("<td><span>"+lhJson.disDate+", "+lhJson.day+"</span></td>"),$(detailsTr).append('<td><div class="d-flexclmcap10 a-itm-cntr"><i class="PI_monthly"></i><div class="d-flexC"><span>'+ZSEC.Encoder.encodeForHTML(lhJson.name)+" "+(void 0!=lhJson.holidayClassification&&lhJson.isOptional?"("+ZSEC.Encoder.encodeForHTML(lhJson.holidayClassification)+")":"")+" </span></div></div></td>"),$(detailsTr).append("<td><span>"+ZSEC.Encoder.encodeForHTML(lhJson.desc)+"</span></td>"),dataArr.allowAdd&&lhJson.isOptional&&!lhJson.isTaken&&!lhJson.isPresent&&showAvail){let td=$("<td></td>"),availtd=$('<button onclick="Leave.viewRecord.applyOptionalHoliday(this);" class="availtd zlabel zlabel--blue zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.leave.avail")+"</button>").data("date",lhJson.disDate);td.append(availtd),$(detailsTr).append(td)}else $(detailsTr).append("<td></td>");lhJson.isUpcoming?tempDoc.appendChild(detailsTr):tempHistoryDoc.appendChild(detailsTr)}else{var ltDiv,daysDetails=lhJson.dayDetails,detailsAbTr=(detailsTr=ZP.create("tr",{class:"zpl_c-p"}),ZP.create("tr")),dateTd=ZP.create("td",{class:"w300"}),leaveTypeTd=ZP.create("td"),daysCountTd=ZP.create("td"),reasonTd=ZP.create("td"),approvalTd=ZP.create("td"),dateAbTd=ZP.create("td"),noOfData=daysDetails.length,date_diff=daysDetails.date_diff,viewparams=(Calendar.parseDate(lhJson.from,uidateFormat),Calendar.parseDate(lhJson.to,uidateFormat),{formid:filterObj.formid,recid:lhJson.recordId});if(noOfData>1||date_diff&&date_diff>1)if(11!==lhJson.approvalStatus&&14!==lhJson.approvalStatus){let outer=ZP.create("div",{class:"zpl_compoffar"}),date=ZP.create("div",{class:"d-flexC d-flexclmcap10",html:"<div> <span>"+lhJson.fromDate+", "+lhJson.disfromDay+'</span> </div> <i class="PI_arw_travl"></i> <div> <span>'+lhJson.toDate+", "+lhJson.distoDay+" </span> </div>","aria-label":lhJson.fromDate+" - "+lhJson.toDate,tabindex:"0"});detailsTr.onclick=bindClick?Leave.viewRecord.bind(viewparams):Leave.viewRecordWithURL.bind({recordId:lhJson.recordId,mode:"LIST"}),outer.appendChild(date),dateTd.appendChild(outer)}else dateTd.appendChild(ZP.create("span",{text:lhJson.toDate,"aria-label":lhJson.toDate,tabindex:0}));else if(11!==lhJson.approvalStatus&&14!==lhJson.approvalStatus){let date=ZP.create("span",{text:lhJson.fromDate+", "+lhJson.disfromDay,"aria-label":lhJson.fromDate,tabindex:0});detailsTr.onclick=bindClick?Leave.viewRecord.bind(viewparams):Leave.viewRecordWithURL.bind({recordId:lhJson.recordId,mode:"LIST"}),dateTd.appendChild(date)}else dateTd.appendChild(ZP.create("span",{text:lhJson.toDate+", "+lhJson.distoDay,"aria-label":lhJson.toDate,tabindex:0}));if(lhJson.hasOwnProperty("approvalStatus")&&(11===lhJson.approvalStatus||14===lhJson.approvalStatus)){var leaveDate=lhJson.from+" , "+lhJson.disfromDay,fromdate=ZP.create("span",{"aria-label":leaveDate,tabindex:0,text:leaveDate}),leaveWidUnits=lhJson.leaveTaken+" "+lhJson.leaveUnit;if(daysCountTd.appendChild(ZP.create("span",{tabindex:0,"aria-label":ZPI18N.getString("zp.noofgoals",[""])+ZPeople.decodeTxt(displayName)+ZPI18N.getString("zp.leave.view.taken")+":"+leaveWidUnits,text:leaveWidUnits})),dateAbTd.appendChild(fromdate),detailsAbTr.appendChild(dateAbTd),detailsAbTr.appendChild(daysCountTd),dataArr.allowAdd){var convertTd=ZP.create("td",{class:"text-right"}),ele=ZP.create("span");ele.onclick=bindClick?Leave.convertToLeave.bind(viewparams):Leave.viewRecordWithURL.bind({recordId:lhJson.recordId,mode:"CONVERT"});var applyLeaveDispN=ZPI18N.getString("zp.apply")+" "+ZPeople.decodeTxt(displayName);ele.appendChild(ZP.create("button",{tabindex:0,"aria-label":applyLeaveDispN,text:applyLeaveDispN,class:"zlabel zlabel--blue zlabel--outline zlabel--medium"})),convertTd.appendChild(ele),detailsAbTr.appendChild(convertTd)}tempAbDoc.appendChild(detailsAbTr);continue}if(!lhJson.isHoliday&&lhJson.isLeave){let statusi="";-1==lhJson.approvalStatus?statusi='<span class="org">'+lhJson.approvalStatusDisplay+"</span>":1==lhJson.approvalStatus?statusi='<span class="grn">'+lhJson.approvalStatusDisplay+"</span>":0==lhJson.approvalStatus?statusi='<span class="red">'+lhJson.approvalStatusDisplay+"</span>":2==lhJson.approvalStatus?statusi='<span class="red">'+lhJson.approvalStatusDisplay+"</span>":-4==lhJson.approvalStatus&&(statusi='<span class="org">'+lhJson.approvalStatusDisplay+"</span>"),""!=statusi&&approvalTd.append($(statusi)[0])}else lhJson.isHoliday&&lhJson.isLeave&&(-2==lhJson.approvalStatus||1==lhJson.approvalStatus)&&approvalTd.append($('<span class="grn">'+ZPI18N.getString("zp.leave.availed")+"</span>")[0]);ltDiv=lhJson.isHoliday&&lhJson.isLeave?$('<div class="d-flexclmcap10 a-itm-cntr"><i class="PI_monthly"></i><div class="d-flexC" aria-label="'+ZSEC.Encoder.encodeForHTML(lhJson.name)+(lhJson.isOptional?"("+ZPI18N.getString("zp.restrictedholiday")+")":"")+lhJson.leaveTaken+" "+lhJson.leaveUnit+'" tabindex="0"> <span>'+ZSEC.Encoder.encodeForHTML(lhJson.name)+" "+(lhJson.isOptional?"("+ZPI18N.getString("zp.restrictedholiday")+")":"")+'</span><span class="zpl_dots"></span><em>'+lhJson.leaveTaken+" "+lhJson.leaveUnit+"</em></div> </div>"):$('<div class="d-flexclmcap10 a-itm-cntr"> <span class="zpl_lbdr _bx lv_bg'+lhJson.leavecolorValue+'"></span> <div class="d-flexC"><span data-toggle="tooltip" data-placement="bottom" title="'+ZSEC.Encoder.encodeForHTML(lhJson.leavetype)+'" tabindex="0" aria-label="'+ZSEC.Encoder.encodeForHTML(lhJson.leavetype)+" "+lhJson.leaveTaken+" "+lhJson.leaveUnit+'">'+ZSEC.Encoder.encodeForHTML(lhJson.leavetype)+'</span><span class="zpl_dots"></span><em>'+lhJson.leaveTaken+" "+lhJson.leaveUnit+"</em></div> </div>"),leaveTypeTd.append(ltDiv[0]),reasonTd.append(lhJson.reason),detailsTr.appendChild(dateTd),detailsTr.appendChild(leaveTypeTd),detailsTr.appendChild(reasonTd),detailsTr.appendChild(approvalTd),lhJson.isUpcoming?tempDoc.appendChild(detailsTr):tempHistoryDoc.appendChild(detailsTr)}}if(void 0==params.upcoming){var data_tbody;(data_tbody=Layout.Page.container.find("tbody#ZP_Leave_ab",Layout.Page.container).show()).html(""),data_tbody.append(tempAbDoc);var showAbsent=!1;(showAbsent=!Layout.Page.container.find("tbody#ZP_Leave_ab",Layout.Page.container).is(":empty"))&&!params.reloadOnlyApplications&&Layout.Page.container.find("#ZP_Absent_Container",Layout.Page.container).delay(200).fadeIn(200)}if(void 0==params.upcoming||params.upcoming)(data_tbody=Layout.Page.container.find("tbody#ZP_Leave_lh",Layout.Page.container)).html(""),params.reloadOnlyApplications&&data_tbody.hide().fadeIn("fast"),data_tbody.append(tempDoc),Layout.Page.container.find("tbody#ZP_Leave_lh",Layout.Page.container).is(":empty")?Leave.Util.showHideNoData(!0,"",Layout.Page.container.find("#ZP_Leave_lhtable")):Leave.Util.showHideNoData(!1,"",Layout.Page.container.find("#ZP_Leave_lhtable")),params.leaveyear>=0&&!params.reloadOnlyApplications&&Layout.Page.container.find("#zp_leavelist_container",Layout.Page.container).delay(showAbsent?400:200).fadeIn(200);if(void 0==params.upcoming||!params.upcoming){var data_Histtbody=Layout.Page.container.find("tbody#ZP_Leave_lh1",Layout.Page.container);data_Histtbody.html(""),params.reloadOnlyApplications&&data_Histtbody.hide().fadeIn("fast"),data_Histtbody.append(tempHistoryDoc),Layout.Page.container.find("tbody#ZP_Leave_lh1",Layout.Page.container).is(":empty")?Leave.Util.showHideNoData(!0,"",Layout.Page.container.find("#ZP_Leave_lhtable1")):Leave.Util.showHideNoData(!1,"",Layout.Page.container.find("#ZP_Leave_lhtable1")),params.leaveyear<=0&&!params.reloadOnlyApplications&&Layout.Page.container.find("#zp_leavelist_container1",Layout.Page.container).delay(showAbsent?400:200).fadeIn(200)}}!params.reloadOnlyApplications&&Leave.View.List.Bradford.get()},constructEntityInfo:function(label,value){var td,tr=ZP.create("tr");return(td=ZP.create("td",{width:"140"})).append(ZP.create("em",{text:label})),tr.appendChild(td),(td=ZP.create("td",{width:"50"})).append(ZP.create("b",{text:value})),tr.appendChild(td),tr},createDateTr:function(leaveJson,dateDetails){var dateTable=ZP.create("table",{width:"100%"}),dateTBody=ZP.create("tbody"),noOfData=dateDetails.length,fullday=leaveJson.fullday;if(0===noOfData){var dateTr=ZP.create("tr",{class:"Lrow"}),barTd=ZP.create("td",{width:"75%"}),barPDiv=ZP.create("div",{class:"progress Pbar"}),barDiv=ZP.create("div",{class:"progress-bar ZPC"+leaveJson.leavecolor+" PR",style:"width:100%;","aria-valuemax":"100","aria-valuemin":"0","aria-valuenow":"20",role:"progressbar"}),lftCrn=ZP.create("div",{class:"lf"}),rgtCrn=ZP.create("div",{class:"rg"});barDiv.appendChild(lftCrn),barDiv.appendChild(rgtCrn),barDiv.appendChild(ZP.create("span",{class:"label ZPC"+leaveJson.leavecolor+" LTpo1",text:leaveJson.leavetype,"data-toggle":"tooltip","data-placement":"top",title:leaveJson.leavetype})),barPDiv.appendChild(barDiv),barTd.appendChild(barPDiv),dateTr.appendChild(barTd),dateTBody.appendChild(dateTr)}else{noOfData>1&&Math.round(noOfData/2);for(var leave_span_pos=Math.round(noOfData/2)-1,indx=0;indx<noOfData;indx++){var dateData=dateDetails[indx],leavecolor="ZPC"+leaveJson.leavecolor,startTime=void 0!=dateData.startTime?Leave.Util.convertMinutestoTime(dateData.startTime):void 0,endTime=void 0!=dateData.endTime?Leave.Util.convertMinutestoTime(dateData.endTime):void 0,leaveSession=dateData.leaveSession,barDiv2=(dateTr=ZP.create("tr",{class:"Lrow"}),barTd=ZP.create("td",{width:"75%"}),barPDiv=ZP.create("div",{class:"progress Pbar"}),barDiv="","");if(2==leaveJson.type)leavecolor="ZPLAbst",width=(width=100*parseFloat(leaveJson.leavetaken))>100?100:width,barDiv=Leave.Util.progressBar(2,leavecolor,width,dateData.leaveSession);else if(dateData.ishalfday&&(!leaveJson.isDayLeave||"0.5"!=dateData.leavecount)||dateData.ishalfholiday){var width="0.25"==dateData.leavecount?25:50;leaveJson.isDayLeave||(width=(width=(width=100*parseFloat(dateData.leavecount)/60/fullday)>50?50:width)<25?25:width);var firstBarType=width<50?2:0;if(dateData.isLeaveFirst){firstBarType=width<50&&(25!=width||2!=leaveSession)?2:0;barDiv=Leave.Util.progressBar(firstBarType,leavecolor,width,leaveSession,startTime,endTime,!leaveJson.isDayLeave,50),barDiv2=Leave.Util.progressBar(1,"ZPLHoli",50,2,firstBarType?void 0:endTime,void 0,!leaveJson.isDayLeave,width)}else{firstBarType=4==leaveSession?2:0;var tempSession=leaveSession>2?leaveSession-2:leaveSession;barDiv=Leave.Util.progressBar(firstBarType,"ZPLHoli",50,1,void 0,firstBarType?void 0:startTime),barDiv2=Leave.Util.progressBar(1,leavecolor,width,tempSession,startTime,endTime,!leaveJson.isDayLeave,50)}}else if("0.0"==dateData.leavecount||"0"==dateData.leavecount)barDiv=Leave.Util.progressBar(2,"ZPLHoli",100);else{width=100*parseFloat(dateData.leavecount);width=(width=(width=leaveJson.isDayLeave?width:0==dateData.leaveSession?100:width/60/fullday)>100?100:width)<25?25:width,barDiv=Leave.Util.progressBar(2,leavecolor,width,dateData.leaveSession,startTime,endTime,!leaveJson.isDayLeave)}if(indx==leave_span_pos){var pos=noOfData%2;pos=0==pos?2:pos;var ele=""!==barDiv2?barDiv2:barDiv;(ele=dateData.isLeaveFirst?barDiv:ele).appendChild(ZP.create("span",{class:"label "+leavecolor+" LTpo"+pos,text:leaveJson.leavetype,"data-toggle":"tooltip","data-placement":"bottom",title:leaveJson.leavetype,style:25==width?"max-width:70px":""}))}barPDiv.appendChild(barDiv),""!==barDiv2&&barPDiv.appendChild(barDiv2),barTd.appendChild(barPDiv),dateTr.appendChild(barTd),dateTBody.appendChild(dateTr)}}return dateTable.appendChild(dateTBody),dateTable},report_html:function(data_arr){var data_obj=data_arr[0],leaves=data_obj?data_obj.leavetypes:[];if(leaves.length>0){$(".ZPDat",Layout.Page.container).show();var totalleave=leaves.length>6?5:leaves.length,temp_doc=document.createDocumentFragment(),report_parent=$("#ZP_Leave_List_Report",Layout.Page.container);if(report_parent.data("reportdata",data_arr),temp_doc.appendChild(this.report_rec(leaves,totalleave)),leaves.length>6){var more=ZP.create("div",{class:"Dtyps ZPBC1"});more.appendChild(ZP.create("i",{class:"IC-more S21 gry CP FR MT5"})),temp_doc.appendChild(more),more.onclick=function(){Leave.View.List.detailed_report(leaves).modal("show")}}report_parent.html(""),report_parent.append(temp_doc)}else $(".ZPDat",Layout.Page.container).hide()},detailed_report:function(leaves){var isV1User=ZPeople.Module.getData("leavetracker")?ZPeople.Module.getData("leavetracker").leave_filterops.isV1User:Leave.Util.isV1User,customtab='<div class="custom-tab"><ul role="tablist" class="show-grid"><li class="col-sm-6  active"><a data-toggle="tab" href="#LR_Days">'+ZPI18N.getString("zp.days")+'</a></li><li class="col-sm-6"><a data-toggle="tab" href="#LR_Hours">'+ZPI18N.getString("zp.hours")+'</a></li><div class="clearfix"></div></ul></div>',modal_cont=ZPeople.BSModal.get({id:Layout.Page.pageId+"_report_view",type:2,tabs:customtab,modalClass:"popRgtModel PopSmModel tabPopModel",bodyClass:"ZPRPbody",deleteOnHide:!0}),data_body=$(".modal-body",modal_cont);$(".modal-dialog",modal_cont).addClass("ZPRMpnl"),$(".modal-footer",modal_cont).remove(),$(".modal-header h6",modal_cont).text(ZPI18N.getString("zp.leavereport")+(isV1User?"":" ("+ZPI18N.getString("zp.leave.view.booked")+"/"+ZPI18N.getString("zp.leave.view.balance")+")"));for(var data_outer=ZP.create("div",{class:"PL20 PR20 tab-content"}),days=ZP.create("div",{class:"tab-pane",id:"LR_Days"}),hours=ZP.create("div",{class:"tab-pane",id:"LR_Hours"}),total=leaves.length,dayCnt=0,hourCnt=0,indx=0;indx<total;indx++){var leave=leaves[indx],color_class="Dtyps "+(2==leave.type?"absent-border":"ZPBC"+leave.color),parent=ZP.create("div",{class:color_class});parent.appendChild(ZP.create("span",{text:ZPeople.decodeTxt(leave.name)}));var reportTxt=isV1User?leave.taken+"/"+leave.allowed:leave.taken+"/"+ZP.optValue(leave,"available","-");if(leave.isdayleave){var div=ZP.create("div",{class:"Avadat",text:reportTxt+" "+ZPI18N.getString("zp.days")});parent.appendChild(div),days.appendChild(parent),dayCnt++}else{div=ZP.create("div",{class:"Avadat",text:reportTxt+" "+ZPI18N.getString("zp.hours")});4==leave.type&&leave.expired_count>0&&div.appendChild(ZP.create("small",{class:"dgry PL10",text:"("+ZPI18N.getString("zp.leave.report.expiredcount")+" -"+leave.expired_count+")"})),parent.appendChild(div),hours.appendChild(parent),hourCnt++}}return 0!==dayCnt&&0!==hourCnt||(modal_cont.find(".custom-tab").remove(),modal_cont.removeClass("tabPopModel")),data_outer.appendChild(days),data_outer.appendChild(hours),dayCnt>0?$(days).addClass("active"):$(hours).addClass("active"),data_body.append(data_outer),modal_cont},report_rec:function(leaves,records){var isV1User=ZPeople.Module.getData("leavetracker")?ZPeople.Module.getData("leavetracker").leave_filterops.isV1User:Leave.Util.isV1User,total=records||leaves.length,temp_doc=document.createDocumentFragment();!isV1User&&$(temp_doc).html($('<div class="Dtyps"><span>'+ZPI18N.getString("zp.leavetype")+'</span><div class="Avadat"><b>'+ZPI18N.getString("zp.leave.view.booked")+"/"+ZPI18N.getString("zp.leave.view.balance")+"</b></div></div>"));for(var indx=0;indx<total;indx++){var leave=leaves[indx],unit=ZPI18N.getString("zp.hours"),color_class="Dtyps "+(2==leave.type?"absent-border":"ZPBC"+leave.color),parent=ZP.create("div",{class:color_class,"data-toggle":"tooltip","data-placement":"top",title:ZPeople.decodeTxt(leave.name)});parent.appendChild(ZP.create("span",{text:ZPeople.decodeTxt(leave.name)})),leave.isdayleave&&(unit=ZPI18N.getString("zp.days")),isV1User?parent.appendChild(ZP.create("div",{class:"Avadat",text:leave.taken+"/"+leave.allowed+" "+unit})):parent.appendChild(ZP.create("div",{class:"Avadat",text:leave.taken+"/"+ZP.optValue(leave,"available","-")+" "+unit})),temp_doc.appendChild(parent)}return temp_doc}},Leave.View.List.Bradford={key:"employee_bradford",initPage:()=>{if(LVUtil.urls.BradFord.isHome())if(Leave.Util.isBradfordFactorEnabled()){let emp=void 0!=Layout.Page.urlparam.id?Layout.Page.urlparam.id:erecno;Leave.Report.Bradford.DetailView.regModal(emp,LVUtil.urls.getUrlAsHash(LVUtil.urls.BradFord.HOME()),!0,!1),Leave.Report.Bradford.DetailView.get()}else ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.bradfordfactor.error.enableerror")),window.location.href=LVUtil.urls.getUrlAsHash(LVUtil.urls.ListView.HOME());else ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.bradfordfactor.error.enableerror")),window.location.href=LVUtil.urls.getUrlAsHash(LVUtil.urls.ListView.HOME())},get:function(){if(Leave.Util.isBradfordFactorEnabled()){var params={key:Leave.View.List.Bradford.key};Leave.Util.filterCrt(params),params.employee=void 0==params.employee?erecno:params.employee,-1!==Layout.Page.hash.indexOf("#selfservice/leave/list")?(params.leaveyear=0,params.employee=SelfService.getUserId()):showNewTab&&LVUtil.urls.BradFord.isHome()&&(params.leaveyear=0),0==params.leaveyear&&(Leave.Util.appendLoading({containerId:"zp_bradford_score_list",placement:"before"}),$("#zp_bradford_score_list",Layout.Page.container).hide(),Leave.Report.Bradford.emp_score_json.emp_json[params.employee]&&delete Leave.Report.Bradford.emp_score_json.emp_json[params.employee],ZPeople.Request.send(Leave.View.List.url,params,Leave.View.List.Bradford.construct))}},construct:function(result,params){if($("tbody#zp_bradford_score_body",Layout.Page.container).html(""),"success"===result.status&&result.data){var bf_scores=result.data.bradford_details||{};Leave.View.List.Bradford.populateData(bf_scores,params),$("#zp_bradford_date",$("#zp_bradford_container",Layout.Page.container)).text(result.from+" - "+result.to),$("#zp_bradford_date",$("#zp_bradford_container",Layout.Page.container)).attr({"aria-label":ZPI18N.getString("zp.bradfordfactor.bradfordscore")+":"+result.from+" - "+result.to,tabindex:"0"})}else Leave.Util.showHideNoData(!0,"",$("#zp_bradford_container",Layout.Page.container));Leave.Util.removeLoading()},populateData:function(bf_scores,params){var tempDoc=document.createDocumentFragment();$.each(bf_scores,function(idx,bf_json){var detailsTr=ZP.create("tr"),nametd=ZP.create("td",{"aria-label":bf_json.settingName,tabindex:"0"});nametd.appendChild(ZP.create("span",{html:bf_json.settingName})),detailsTr.appendChild(nametd);var scoreTd=ZP.create("td",{"aria-label":ZPI18N.getString("zp.bradfordfactor.bradfordscore")+" "+bf_json.score+" "+ZPI18N.getString("zp.Level")+" "+bf_json.level,tabindex:"0"});scoreTd.appendChild(ZP.create("span",{class:"MR10",html:ZPI18N.getString("zp.bradfordfactor.bradfordscore")+" - "})),scoreTd.appendChild(ZP.create("b",{html:bf_json.score})),scoreTd.appendChild(ZP.create("span",{class:"dgry ML10",html:"("+ZPI18N.getString("zp.Level")+" "+bf_json.level+")"})),detailsTr.appendChild(scoreTd),tempDoc.appendChild(detailsTr)}),tempDoc.hasChildNodes()?($("tbody#zp_bradford_score_body",Layout.Page.container).append(tempDoc),$("#zp_bradford_score_list",Layout.Page.container).show(),Leave.Util.showHideNoData(!1,"",$("#zp_bradford_container",Layout.Page.container)),$("#zp_bradford_container",Layout.Page.container).fadeIn(200)):Leave.Util.showHideNoData(!0,"",$("#zp_bradford_container",Layout.Page.container))},detailedView:function(){if(-1!==Layout.Page.hash.indexOf("#selfservice/leave/list"))Leave.Report.Bradford.DetailView.redirect(SelfService.getUserId(),Layout.Page.hash,!1,!1);else{let emp=showNewTab?void 0==Layout.Page.urlparam.id?erecno:Layout.Page.urlparam.id:$("input[id='ZP_Leave_View_EmpSearch'][name='employee']",Layout.Page.container).val(),url=LVUtil.urls.BradFord.HOME();LVUtil.Tab.isGlobalSearchUserPage()&&(url=ZPeople.isOperationAllowed?LVUtil.urls.BradFord.OPERUSERBRADFORD():LVUtil.urls.BradFord.TEAMUSERBRADFORD()),LVUtil.Tab.isList()?Leave.Report.Bradford.DetailView.redirect(emp,LVUtil.urls.getUrlAsHash(url),!0,!1,url):Leave.Report.Bradford.DetailView.redirect(emp,LVUtil.urls.getUrlAsHash(url),!0,!1)}}},Leave.View.List.Widgets={FILTEROPTIONS:void 0,ISSELFSERVICE:void 0,load:function(){Leave.View.List.Widgets.FILTEROPTIONS=Leave.Util.getfilterOptions(),Leave.View.List.Widgets.ISSELFSERVICE=-1!=Layout.Page.pageId.indexOf("selfservice"),Leave.View.List.Widgets.ReportCard1.init(),Leave.View.List.Widgets.ReportCard2.init()},getUser:function(){return Leave.View.List.Widgets.ISSELFSERVICE?SelfService.getUserId():Leave.Util.filterCrt({}).employee},ReportCard1:{CONTAINER:void 0,setContainer:function(){this.CONTAINER=Layout.Page.container.find("#ZPleave_reportcard_1"),Leave.View.List.Widgets.ReportCard1.CONTAINER.hide()},getLeaveYear:function(){return this.CONTAINER.find(".ZP-YearPager").data("year")?this.CONTAINER.find(".ZP-YearPager").data("year"):0},init:function(){Leave.View.List.Widgets.ReportCard1.setContainer(),Leave.View.List.Widgets.ReportCard1.regDateNavigation(),Leave.View.List.Widgets.ReportCard1.get()},regDateNavigation:function(){var yearEle=Leave.View.List.Widgets.ReportCard1.CONTAINER.find(".ZP-YearPager");if(!yearEle.data("isreg")){var lyJson=Leave.Util.getCurrentLYear(ZP.getUserDetailsById(Leave.View.List.Widgets.getUser()).location);$(yearEle).data("date",lyJson.from+" - "+lyJson.to),$(yearEle).data("year",0),yearEle.data("isreg",!0),Leave.Util.addOrReduceDate(yearEle,"ZP-YearPager",0),Leave.Util.checkNavigation(0);var prev=$(yearEle).find(".PI_alft"),next=$(yearEle).find(".PI_argt");$(prev).on("click",function(){Leave.Util.addOrReduceDate(yearEle,"ZP-YearPager",-1),Leave.View.List.Widgets.ReportCard1.get()}),$(next).on("click",function(){Leave.Util.addOrReduceDate(yearEle,"ZP-YearPager",1),Leave.View.List.Widgets.ReportCard1.get()})}},get:function(userInfo,isFromUpcoming){var params={key:"newquick_list_view"};Leave.Util.filterCrt(params),params.employee=Leave.View.List.Widgets.getUser();var loc=ZP.getUserDetailsById(params.employee).location;params.location=loc+""=="null"?-1:loc,params.leaveyear=this.getLeaveYear();var reportParams={key:"report_user_summary",skipOLT:!0,employee:params.employee,leaveyear:params.leaveyear};ZPeople.Request.send(Leave.Report.url2,reportParams,function(resp){var report=resp.data;Leave.View.List.Widgets.ReportCard1.populate(report),0==params.leaveyear?Layout.Page.container.find("#upcominghistorymenu").show():Layout.Page.container.find("#upcominghistorymenu").hide(),params.upcoming=void 0!=isFromUpcoming?isFromUpcoming:void 0,ZPeople.Request.send(Leave.View.List.url,params,function(resp){Leave.View.List.Widgets.Applications.populate(resp.data,resp.allowAdd,Leave.View.List.Widgets.ReportCard1.getAbsentCount(report),params)},{})},{})},getAbsentCount:function(report){var count=0;return report&&report[0]&&report[0].leavetypes&&0!=report[0].leavetypes.length?(report=report[0].leavetypes,$.each(report,function(idx,data){2==data.type&&(count=data.taken)}),count):count},hasNoReport:function(report){return!(report&&report[0]&&report[0].leavetypes&&0!=report[0].leavetypes.length)||1==report[0].leavetypes.length&&2==(report=report[0].leavetypes)[0].type},populate:function(report){Leave.View.List.Widgets.ReportCard1.CONTAINER.find("#ZPleave_reportcard_1_body").html("");var allowadd=!1;if(report&&report[0]&&((allowadd=report[0].allowAdd)?Layout.Page.container.find(".ZP-Add").removeClass("DN"):Layout.Page.container.find(".ZP-Add").addClass("DN")),Leave.View.List.Widgets.ReportCard1.hasNoReport(report))Leave.Util.showHideNoData(!0,"",Leave.View.List.Widgets.ReportCard1.CONTAINER.find(".zpl_emcrdlst"));else{Leave.Util.showHideNoData(!1,"",Leave.View.List.Widgets.ReportCard1.CONTAINER.find(".zpl_emcrdlst")),report=report[0].leavetypes;var html="";$.each(report,function(idx,data){2!=data.type&&(html+='<div class="CP zpl_dfcrd zpl_emcrd" > <div class="zpl_emcrdcnt"> <div class="a-itm-cntr d-flexclmcap"> <b title="'+data.name+'" data-toggle="tooltip" data-placement="top">'+data.name+'</b><div class="zpl_lvavailSts" id="'+data.leavetypeid+'"> '+(data.doNotDisplayBalance?'<div class="zpl_lvtypeAdd"><i class="PI_plus grn zpl_selfadd"></i></div>':"<b>"+data.available+"</b> <em>"+Leave.Util.getDispUnit(data.available,data.unit)+'</em> <span class="zpl_lvtypeclr lv_bg'+data.color+' "></span>'+(allowadd?'<div class="zpl_lvtypeAdd"><i class="PI_plus grn zpl_selfadd"></i></div>':""))+'  </div><span id="'+data.leavetypeid+'" class="lv_taken">'+(data.taken&&data.taken>0?data.taken+"&nbsp;"+Leave.Util.getDispUnit(data.taken,data.unit):"-")+"</span></div> </div> </div>")}),Leave.View.List.Widgets.ReportCard1.CONTAINER.find("#ZPleave_reportcard_1_body").append(html),Leave.View.List.Widgets.ReportCard1.CONTAINER.show(),Leave.View.List.Widgets.ReportCard1.CONTAINER.find(".zpl_lvavailSts").on("click",function(){var leavetype=$(this).attr("id");LeaveForm.initLeaveType=leavetype,LVUtil.Tab.isGlobalSearchUserPage()?Leave.viewRecord.applyLeaveWithoutURL(leavetype):LVUtil.urls.ListView.isHome()?window.location.hash=LVUtil.urls.ListView.ADD():Leave.add()}),Leave.View.List.Widgets.ReportCard1.initNavigation()}},CANSCROLLEFT:!1,CANSCROLLRIGHT:!0,initNavigation:function(){var container=Leave.View.List.Widgets.ReportCard1.CONTAINER;container.find("#ZPleave_reportcard_1_body")[0].scrollWidth>container.find("#ZPleave_reportcard_1_body").innerWidth()&&(container.find("#ZPleave_reportcard_1_body").off("scroll").on("scroll",function(){Leave.View.List.Widgets.ReportCard1.checkNavigation()}),container.find(".lftarw").off("click").on("click",function(){Leave.View.List.Widgets.ReportCard1.CANSCROLLEFT?container.find("#ZPleave_reportcard_1_body").animate({scrollLeft:container.find("#ZPleave_reportcard_1_body").scrollLeft()-container.find("#ZPleave_reportcard_1_body").innerWidth()+50},500,function(){Leave.View.List.Widgets.ReportCard1.checkNavigation()}):Leave.View.List.Widgets.ReportCard1.checkNavigation()}),container.find(".rgtarw").off("click").on("click",function(){Leave.View.List.Widgets.ReportCard1.CANSCROLLRIGHT?Leave.View.List.Widgets.ReportCard1.CONTAINER.find("#ZPleave_reportcard_1_body").animate({scrollLeft:Leave.View.List.Widgets.ReportCard1.CONTAINER.find("#ZPleave_reportcard_1_body").scrollLeft()+container.find("#ZPleave_reportcard_1_body").innerWidth()-50},500,function(){Leave.View.List.Widgets.ReportCard1.checkNavigation()}):Leave.View.List.Widgets.ReportCard1.checkNavigation()}))},checkNavigation:function(){var container=Leave.View.List.Widgets.ReportCard1.CONTAINER;Leave.View.List.Widgets.ReportCard1.CANSCROLLEFT=container.find("#ZPleave_reportcard_1_body").scrollLeft()>0,Leave.View.List.Widgets.ReportCard1.CANSCROLLRIGHT=container.find("#ZPleave_reportcard_1_body")[0].scrollWidth-container.find("#ZPleave_reportcard_1_body").scrollLeft()-50>container.find("#ZPleave_reportcard_1_body").innerWidth(),Leave.View.List.Widgets.ReportCard1.CANSCROLLEFT&&Leave.View.List.Widgets.ReportCard1.CANSCROLLRIGHT?(container.find(".lftarw").removeClass("disabled"),container.find(".rgtarw").removeClass("disabled")):Leave.View.List.Widgets.ReportCard1.CANSCROLLEFT?Leave.View.List.Widgets.ReportCard1.CANSCROLLRIGHT?(container.find(".lftarw").removeClass("disabled"),container.find(".rgtarw").removeClass("disabled")):(container.find(".lftarw").removeClass("disabled"),container.find(".rgtarw").addClass("disabled")):(container.find(".lftarw").addClass("disabled"),container.find(".rgtarw").removeClass("disabled"))}},ReportCard2:{CONTAINER:void 0,setContainer:function(){this.CONTAINER=Layout.Page.container.find("#ZPleave_reportcard_2"),Leave.View.List.Widgets.ReportCard2.CONTAINER.hide()},init:function(){Leave.View.List.Widgets.ReportCard2.setContainer(),Leave.View.List.Widgets.ReportCard2.get()},get:function(){var params={key:"report_user_summary",OTLonly:!0};Leave.Util.filterCrt(params),params.employee=Leave.View.List.Widgets.getUser(),ZPeople.Request.send(Leave.Report.url2,params,function(resp){Leave.View.List.Widgets.ReportCard2.populate(resp.data)},{})},populate:function(report){if(Leave.View.List.Widgets.ReportCard2.CONTAINER.find("#ZPleave_reportcard_2_body").html(""),!report||!report[0]||!report[0].leavetypes||0==report[0].leavetypes.length)return Leave.View.List.Widgets.ReportCard2.CONTAINER.addClass("DN"),Leave.View.List.Widgets.ReportCard1.CONTAINER.addClass("zp-sm-12").removeClass("zp-sm-8"),void Leave.View.List.Widgets.ReportCard1.initNavigation();Leave.View.List.Widgets.ReportCard1.CONTAINER.removeClass("zp-sm-12").addClass("zp-sm-8");var allowadd=report[0].allowAdd;report=report[0].leavetypes;var html="";$.each(report,function(idx,data){html+='<div class="CP zpl_dfcrd zpl_emcrd"> <div class="zpl_emcrdcnt"> <div class="zpl_emrole a-itm-cntr"> <b title="'+data.name+'" data-toggle="tooltip" data-placement="top">'+data.name+'</b><div class="zpl_lvavailSts" id="'+data.leavetypeid+'"> '+(data.doNotDisplayBalance?'<div class="zpl_lvtypeAdd"><i class="PI_plus grn zpl_selfadd"></i></div>':"<b>"+data.available+"</b> <em>"+Leave.Util.getDispUnit(data.available,data.unit)+'</em> <span class="zpl_lvtypeclr lv_bg'+data.color+' "></span>'+(allowadd?'<div class="zpl_lvtypeAdd"><i class="PI_plus grn zpl_selfadd"></i></div>':""))+' </div><span id="'+data.leavetypeid+'" class="lv_taken">'+(data.taken&&data.taken>0?data.taken+"&nbsp;"+Leave.Util.getDispUnit(data.taken,data.unit):"-")+"</span> </div></div> </div> </div>"}),Leave.View.List.Widgets.ReportCard2.CONTAINER.find("#ZPleave_reportcard_2_body").append(html),Leave.View.List.Widgets.ReportCard2.CONTAINER.show(),Leave.View.List.Widgets.ReportCard2.CONTAINER.removeClass("DN"),Leave.View.List.Widgets.ReportCard2.CONTAINER.find(".zpl_lvavailSts").on("click",function(){var leavetype=$(this).attr("id");LeaveForm.initLeaveType=leavetype,LVUtil.Tab.isGlobalSearchUserPage()?Leave.viewRecord.applyLeaveWithoutURL(leavetype):LVUtil.urls.ListView.isHome()?window.location.hash=LVUtil.urls.ListView.ADD():Leave.add()}),Leave.View.List.Widgets.ReportCard2.initNavigation()},CANSCROLLEFT:!1,CANSCROLLRIGHT:!0,initNavigation:function(){var container=Leave.View.List.Widgets.ReportCard2.CONTAINER;container.find("#ZPleave_reportcard_2_body")[0].scrollWidth>container.find("#ZPleave_reportcard_2_body").innerWidth()&&(container.find(".lftarw").on("click",function(){Leave.View.List.Widgets.ReportCard2.CANSCROLLEFT?container.find("#ZPleave_reportcard_2_body").animate({scrollLeft:container.find("#ZPleave_reportcard_2_body").scrollLeft()-container.find("#ZPleave_reportcard_2_body").innerWidth()+50},500,function(){Leave.View.List.Widgets.ReportCard2.checkNavigation()}):Leave.View.List.Widgets.ReportCard2.checkNavigation()}),container.find(".rgtarw").on("click",function(){Leave.View.List.Widgets.ReportCard2.CANSCROLLRIGHT?container.find("#ZPleave_reportcard_2_body").animate({scrollLeft:Leave.View.List.Widgets.ReportCard2.CONTAINER.find("#ZPleave_reportcard_2_body").scrollLeft()+container.find("#ZPleave_reportcard_2_body").innerWidth()-50},500,function(){Leave.View.List.Widgets.ReportCard2.checkNavigation()}):Leave.View.List.Widgets.ReportCard2.checkNavigation()}))},checkNavigation:function(){var container=Leave.View.List.Widgets.ReportCard2.CONTAINER;Leave.View.List.Widgets.ReportCard2.CANSCROLLEFT=container.find("#ZPleave_reportcard_2_body").scrollLeft()>0,Leave.View.List.Widgets.ReportCard2.CANSCROLLRIGHT=container.find("#ZPleave_reportcard_2_body")[0].scrollWidth-container.find("#ZPleave_reportcard_2_body").scrollLeft()>container.find("#ZPleave_reportcard_2_body").innerWidth(),Leave.View.List.Widgets.ReportCard2.CANSCROLLEFT&&Leave.View.List.Widgets.ReportCard2.CANSCROLLRIGHT?(container.find(".lftarw").removeClass("disabled"),container.find(".rgtarw").removeClass("disabled")):Leave.View.List.Widgets.ReportCard2.CANSCROLLEFT?Leave.View.List.Widgets.ReportCard2.CANSCROLLRIGHT?(container.find(".lftarw").removeClass("disabled"),container.find(".rgtarw").removeClass("disabled")):(container.find(".lftarw").removeClass("disabled"),container.find(".rgtarw").addClass("disabled")):(container.find(".lftarw").addClass("disabled"),container.find(".rgtarw").removeClass("disabled"))},Applications:{isOnDisplay:function(leavetype){return Leave.View.List.Widgets.ReportCard2.CONTAINER.find("#ZPleave_reportcard_2_applications").is(":visible")&&Leave.View.List.Widgets.ReportCard2.CONTAINER.find("#ZPleave_reportcard_2_applications").attr("leavetype")+""==leavetype},get:function(leavetype){if(Leave.View.List.Widgets.ReportCard2.Applications.isOnDisplay(leavetype))return Leave.View.List.Widgets.ReportCard2.CONTAINER.find(".lv_crds.active").removeClass("active"),void Leave.View.List.Widgets.ReportCard2.CONTAINER.find("#ZPleave_reportcard_2_applications").toggle("slide",{direction:"up"},250);var params={key:"otl_applications",leavetype:leavetype};Leave.Util.filterCrt(params);var loc=ZP.getUserDetailsById(params.employee).location;params.location=loc+""=="null"?-1:loc,ZPeople.Request.send(Leave.View.List.url,params,function(resp){Leave.View.List.Widgets.ReportCard2.Applications.populate(resp.data,leavetype)},{})},populate:function(data,leavetype){var html="";$.each(data,function(idx,record){html+='<div class="lv-aplcinhd ">Leave Applications</div><div class="lv-aplcinscrl"><div class="lv-aplcintxt "><div><div><span class="DIB ZPbold"><small class="DB MB10 ZP_Font">From</small>'+record.from+'</span> <small> &nbsp;&nbsp; - &nbsp;&nbsp;</small> <span class="DIB ZPbold"><small class="DB MB10 ZP_Font">To</small>'+record.to+'</span></div><span class="MT15 DB"><small>Total day(s) : </small> &nbsp; <strong>'+record.leavetaken+'</strong></span></div><div class="text-center">'+Leave.View.List.Widgets.ReportCard2.Applications.getStatusIcon(record.approval_status)+"</div></div></div>"}),Leave.View.List.Widgets.ReportCard2.CONTAINER.find("#ZPleave_reportcard_2_applications").attr("leavetype",leavetype+"").html(""),Leave.View.List.Widgets.ReportCard2.CONTAINER.find("#ZPleave_reportcard_2_applications").append(html),Leave.View.List.Widgets.ReportCard2.CONTAINER.find("#ZPleave_reportcard_2_applications").is(":visible")||Leave.View.List.Widgets.ReportCard2.CONTAINER.find("#ZPleave_reportcard_2_applications").toggle("slide",{direction:"up"},250)},getStatusIcon:function(approvalStatus){return-2==approvalStatus?"":-1==approvalStatus?'<i class="IC-pending org S16">':1==approvalStatus?'<i class="IC-like grn S16">':0==approvalStatus?'<i class="IC-unlike red S16">':2==approvalStatus?'<i class="IC-rejected red S16">':void 0}}},Applications:{get:function(isFromUpcoming){var params={key:"newquick_list_view"};Leave.Util.filterCrt(params),params.employee=Leave.View.List.Widgets.getUser();var loc=ZP.getUserDetailsById(params.employee).location;params.location=loc+""=="null"?-1:loc,params.dataType=isFromUpcoming?Layout.Page.container.find("select#lvdtType").length>0?parseInt(ZPeopleComponents.select(Layout.Page.container.find("select#lvdtType")).getValue()):0:Layout.Page.container.find("select#lvdtType1").length>0?parseInt(ZPeopleComponents.select(Layout.Page.container.find("select#lvdtType1")).getValue()):0,params.leaveyear=Leave.View.List.Widgets.ReportCard1.getLeaveYear(),0==params.leaveyear?Layout.Page.container.find("#upcominghistorymenu").show():Layout.Page.container.find("#upcominghistorymenu").hide(),params.upcoming=void 0!=isFromUpcoming?isFromUpcoming:void 0,ZPeople.Request.send(Leave.View.List.url,params,function(resp){Leave.View.List.Widgets.Applications.populate(resp.data,resp.allowAdd,Leave.View.List.Widgets.ReportCard1.getAbsentCount(resp.report),params)},{})},populate:function(data,allowAdd,absentCount,params){var lh=data,lhCount=lh?lh.length:0,bindClick=-1!=Layout.Page.hash.indexOf("#selfservice/leave/list");if(!lh||0==lh.length)return Leave.Util.removeLoading(),(void 0==params.upcoming||params.upcoming)&&params.leaveyear>=0&&(Layout.Page.container.find("#zp_leavelist_container",Layout.Page.container).show(),Leave.Util.showHideNoData(!0,"",Layout.Page.container.find("#ZP_Leave_lhtable"))),void 0!=params.upcoming&&params.upcoming||params.leaveyear<=0&&(Layout.Page.container.find("#zp_leavelist_container1",Layout.Page.container).show(),Leave.Util.showHideNoData(!0,"",Layout.Page.container.find("#ZP_Leave_lhtable1"))),void(void 0==params.upcoming&&$("#ZP_Absent_Container",Layout.Page.container).hide());for(var displayName=Leave.Util.getfilterOptions().formdisplayName,filterObj=Leave.Util.getfilterOptions(),tempDoc=document.createDocumentFragment(),tempHistoryDoc=document.createDocumentFragment(),tempAbDoc=document.createDocumentFragment(),index=0;index<lhCount;index++){var lhJson=lh[index];if(lhJson.isHoliday&&!lhJson.isLeave){var detailsTr=ZP.create("tr");if($(detailsTr).append('<td tabindex="0" aria-label="'+ZPI18N.getString("zp.date")+" "+lhJson.disDate+'"><span>'+lhJson.disDate+"</span></td>"),$(detailsTr).append('<td><div class="d-flexclmcap10 a-itm-cntr"><i class="PI_monthly"></i><span>'+ZSEC.Encoder.encodeForHTML(lhJson.name)+" "+(lhJson.isOptional?"("+ZPI18N.getString("zp.restrictedholiday")+")":"")+"</span></div></td>"),$(detailsTr).append("<td><span>"+ZSEC.Encoder.encodeForHTML(lhJson.desc)+"</span></td>"),allowAdd&&lhJson.isOptional&&!lhJson.isTaken&&!lhJson.isPresent){let td=$("<td></td>"),availtd=$('<button onclick="Leave.viewRecord.applyOptionalHoliday(this);" class="availtd zlabel zlabel--blue zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.leave.avail")+"</button>").data("date",lhJson.disDate);td.append(availtd),$(detailsTr).append(td)}else $(detailsTr).append("<td></td>");lhJson.isUpcoming?tempDoc.appendChild(detailsTr):tempHistoryDoc.appendChild(detailsTr)}else{var ltDiv,daysDetails=lhJson.dayDetails,detailsAbTr=(detailsTr=ZP.create("tr",{}),ZP.create("tr")),dateTd=ZP.create("td",{class:"w300"}),leaveTypeTd=ZP.create("td"),daysCountTd=ZP.create("td"),reasonTd=ZP.create("td"),approvalTd=ZP.create("td"),dateAbTd=ZP.create("td"),noOfData=daysDetails.length,date_diff=daysDetails.date_diff,viewparams={formid:filterObj.formid,recid:lhJson.recordId};if(noOfData>1||date_diff&&date_diff>1)if(11!==lhJson.approvalStatus&&14!==lhJson.approvalStatus){let outer=ZP.create("div",{class:"zpl_compoffar"}),date=ZP.create("div",{class:"d-flexC d-flexclmcap10",html:"<div> <span>"+lhJson.fromDate+'</span> </div> <i class="PI_arw_travl"></i> <div> <span>'+lhJson.toDate+" </span> </div>"});detailsTr.onclick=bindClick?Leave.viewRecord.bind(viewparams):Leave.viewRecordWithURL.bind({recordId:lhJson.recordId,mode:"LIST"}),outer.appendChild(date),dateTd.appendChild(outer)}else dateTd.appendChild(ZP.create("span",{text:lhJson.toDate}));else if(11!==lhJson.approvalStatus&&14!==lhJson.approvalStatus){let date=ZP.create("span",{text:lhJson.fromDate});detailsTr.onclick=bindClick?Leave.viewRecord.bind(viewparams):Leave.viewRecordWithURL.bind({recordId:lhJson.recordId,mode:"LIST"}),dateTd.appendChild(date)}else dateTd.appendChild(ZP.create("span",{text:lhJson.toDate}));if(lhJson.hasOwnProperty("approvalStatus")&&(11===lhJson.approvalStatus||14===lhJson.approvalStatus)){var fromdate=ZP.create("span",{text:lhJson.from+", "+lhJson.disfromDay});if(daysCountTd.appendChild(ZP.create("span",{text:lhJson.leaveTaken+" "+lhJson.leaveUnit})),dateAbTd.appendChild(fromdate),detailsAbTr.appendChild(dateAbTd),detailsAbTr.appendChild(daysCountTd),allowAdd){var convertTd=ZP.create("td",{class:"texst-right"}),ele=ZP.create("span");ele.onclick=bindClick?Leave.convertToLeave.bind(viewparams):Leave.viewRecordWithURL.bind({recordId:lhJson.recordId,mode:"CONVERT"}),ele.appendChild(ZP.create("button",{text:ZPI18N.getString("zp.apply")+" "+ZPeople.decodeTxt(displayName),class:"zlabel zlabel--blue zlabel--outline zlabel--medium"})),convertTd.appendChild(ele),detailsAbTr.appendChild(convertTd)}tempAbDoc.appendChild(detailsAbTr);continue}if(!lhJson.isHoliday&&lhJson.isLeave){let statusi="";-1==lhJson.approvalStatus?statusi='<span class="org">'+lhJson.approvalStatusDisplay+"</span>":1==lhJson.approvalStatus?statusi='<span class="grn">'+lhJson.approvalStatusDisplay+"</span>":0==lhJson.approvalStatus?statusi='<span class="red">'+lhJson.approvalStatusDisplay+"</span>":2==lhJson.approvalStatus?statusi='<span class="red">'+lhJson.approvalStatusDisplay+"</span>":-4==lhJson.approvalStatus&&(statusi='<span class="org">'+lhJson.approvalStatusDisplay+"</span>"),""!=statusi&&approvalTd.append($(statusi)[0])}else lhJson.isHoliday&&lhJson.isLeave&&approvalTd.append($('<span class="grn">'+ZPI18N.getString("zp.leave.availed")+"</span>")[0]);ltDiv=lhJson.isHoliday&&lhJson.isLeave?$('<div class="d-flexclmcap10 a-itm-cntr"> <span>'+ZSEC.Encoder.encodeForHTML(lhJson.name)+" "+(lhJson.isOptional?"("+ZPI18N.getString("zp.restrictedholiday")+")":"")+'</span><span class="zpl_dots"></span><em>'+lhJson.leaveTaken+" "+lhJson.leaveUnit+"</em> </div>"):$('<div class="d-flexclmcap10 a-itm-cntr"> <span class="zpl_lbdr _bx lv_bg'+lhJson.leavecolorValue+'"></span> <div class="d-flexC"><span data-toggle="tooltip" data-placement="bottom" title="'+ZSEC.Encoder.encodeForHTML(lhJson.leavetype)+'">'+ZSEC.Encoder.encodeForHTML(lhJson.leavetype)+'</span><span class="zpl_dots"></span><em>'+lhJson.leaveTaken+" "+lhJson.leaveUnit+"</em></div> </div>"),leaveTypeTd.append(ltDiv[0]),reasonTd.append(lhJson.reason),detailsTr.appendChild(dateTd),detailsTr.appendChild(leaveTypeTd),detailsTr.appendChild(reasonTd),detailsTr.appendChild(approvalTd),lhJson.isUpcoming?tempDoc.appendChild(detailsTr):tempHistoryDoc.appendChild(detailsTr)}}if(void 0==params.upcoming){var data_tbody;(data_tbody=$("tbody#ZP_Leave_ab",Layout.Page.container).show()).html(""),data_tbody.append(tempAbDoc);var absentDay=absentCount>1?ZPI18N.getString("zp.leavetype.smalldays"):ZPI18N.getString("zp.day"),absentName=ZPeople.Module.getData("leavetracker").leave_filterops.absentDisplayName;Layout.Page.container.find("#absent_count").text(absentCount+" "+absentDay),Layout.Page.container.find("#absent_count").parent().attr("aria-label",ZPI18N.getString("zp.common.totalno",[""])+absentDay+absentName+" are "+absentCount),$("tbody#ZP_Leave_ab",Layout.Page.container).is(":empty")?$("#ZP_Absent_Container",Layout.Page.container).hide():$("#ZP_Absent_Container",Layout.Page.container).is(":visible")||$("#ZP_Absent_Container",Layout.Page.container).fadeIn(200)}if((void 0==params.upcoming||params.upcoming)&&((data_tbody=Layout.Page.container.find("tbody#ZP_Leave_lh",Layout.Page.container)).html(""),data_tbody.hide().fadeIn("fast"),data_tbody.append(tempDoc),Layout.Page.container.find("tbody#ZP_Leave_lh",Layout.Page.container).is(":empty")?Leave.Util.showHideNoData(!0,"",Layout.Page.container.find("#ZP_Leave_lhtable")):Leave.Util.showHideNoData(!1,"",Layout.Page.container.find("#ZP_Leave_lhtable")),params.leaveyear>=0&&Layout.Page.container.find("#zp_leavelist_container",Layout.Page.container).delay(200).fadeIn(200)),void 0==params.upcoming||!params.upcoming){var data_Histtbody=Layout.Page.container.find("tbody#ZP_Leave_lh1",Layout.Page.container);data_Histtbody.html(""),data_Histtbody.hide().fadeIn("fast"),data_Histtbody.append(tempHistoryDoc),Layout.Page.container.find("tbody#ZP_Leave_lh1",Layout.Page.container).is(":empty")?Leave.Util.showHideNoData(!0,"",Layout.Page.container.find("#ZP_Leave_lhtable1")):Leave.Util.showHideNoData(!1,"",Layout.Page.container.find("#ZP_Leave_lhtable1")),params.leaveyear<=0&&Layout.Page.container.find("#zp_leavelist_container1",Layout.Page.container).delay(200).fadeIn(200)}Leave.Util.removeLoading()}},construct:function(dataArr,params){var lh=dataArr.data,lhCount=lh?lh.length:0,reportCount=dataArr.report.length;if($("#zp_leavelist_container",Layout.Page.container).show(),$("#zp_leavelist_container1",Layout.Page.container).show(),0==lhCount&&0==reportCount)return Leave.Util.removeLoading(),Layout.Page.container.find(".Scrcont").css("overflow","auto"),Leave.Util.showHideNoData(!0,"",Layout.Page.container.find(".Scrcont")),null;var isApprovalEnabled=Leave.Util.getfilterOptions().approval_configured;isApprovalEnabled?(Layout.Page.container.find("tr#approval_enabled_header").removeClass("DN"),Layout.Page.container.find("tr#approval_disabled_header").addClass("DN")):(Layout.Page.container.find("tr#approval_disabled_header").removeClass("DN"),Layout.Page.container.find("tr#approval_enabled_header").addClass("DN"));dataArr.report[0].leavetypes.length;var bindClick=-1!=Layout.Page.hash.indexOf("#selfservice/leave/list");Leave.Util.isV1User=dataArr.isV1User;var filterObj=Leave.Util.getfilterOptions();if((data_tbody=Layout.Page.container.find("li#ZP_Leave_lst")).html("").css("width",""),data_tbody.append(tempDoc),Leave.View.List.constructSliderBox(),Leave.View.List.sliderScroll(),lh&&0!=lh.length){for(var tempDoc=document.createDocumentFragment(),tempAbDoc=document.createDocumentFragment(),displayName=Leave.Util.getfilterOptions().formdisplayName,index=0;index<lhCount;index++){var lhJson=lh[index],daysDetails=lhJson.dayDetails,detailsTr=ZP.create("tr",{class:"ZPLRow"}),detailsAbTr=ZP.create("tr",{class:"ZPLRow"}),dateTd=ZP.create("td",{class:"zptbbor-fl",width:isApprovalEnabled?"17%":"20%"}),leaveTypeTd=ZP.create("td",{width:isApprovalEnabled?"23%":"30%"}),daysCountTd=ZP.create("td",{width:isApprovalEnabled?"15%":"20%"}),reasonTd=ZP.create("td",{width:"30%",class:"WBBW"}),approvalTd=ZP.create("td",{class:"zptbbor-fr",width:"15%"}),dateAbTd=ZP.create("td",{class:"zptbbor-fl",width:"180px"}),noOfData=daysDetails.length,date_diff=daysDetails.date_diff,viewparams=(Calendar.parseDate(lhJson.from,uidateFormat),Calendar.parseDate(lhJson.to,uidateFormat),{formid:filterObj.formid,recid:lhJson.recordId});if(11!==lhJson.approvalStatus&&14!==lhJson.approvalStatus){var fromdate=ZP.create("a",{text:lhJson.fromDay+" "+lhJson.from});bindClick?fromdate.onclick=Leave.viewRecord.bind(viewparams):fromdate.href=LVUtil.urls.ListView.VIEW()+":"+lhJson.recordId,dateTd.appendChild(fromdate)}else dateTd.appendChild(ZP.create("span",{text:lhJson.toDay+" "+lhJson.to}));if(noOfData>1||date_diff&&date_diff>1)if(dateTd.appendChild(ZP.create("br")),dateTd.appendChild(ZP.create("span",{class:"PT10 PB10 ZPwf",text:ZPI18N.getString("zp.sto")})),11!==lhJson.approvalStatus&&14!==lhJson.approvalStatus){Calendar.parseDate(lhJson.to,uidateFormat);var todate=ZP.create("a",{text:lhJson.toDay+" "+lhJson.to});bindClick?todate.onclick=Leave.viewRecord.bind(viewparams):todate.href=LVUtil.urls.ListView.VIEW()+":"+lhJson.recordId,dateTd.appendChild(todate)}else dateTd.appendChild(ZP.create("span",{text:lhJson.to+" - "+lhJson.toDay}));if(daysCountTd.append(lhJson.leaveTaken+" "+lhJson.leaveUnit),11!==lhJson.approvalStatus&&14!==lhJson.approvalStatus)Leave.Util.getStatusTd(approvalTd,lhJson.approvalStatus,!0),approvalTd.append(lhJson.approvalStatusDisplay),leaveTypeTd.append(ZP.create("span",{class:"zptb-brdr ZPBC"+lhJson.leavecolorValue})),leaveTypeTd.append(ZP.create("span",{class:"zplvehd",text:lhJson.leavetype,"data-toggle":"tooltip","data-placement":"bottom",title:lhJson.leavetype})),reasonTd.append(lhJson.reason),detailsTr.appendChild(dateTd),detailsTr.appendChild(leaveTypeTd),detailsTr.appendChild(daysCountTd),isApprovalEnabled?(detailsTr.appendChild(reasonTd),detailsTr.appendChild(approvalTd)):($(reasonTd).addClass("zptbbor-fr"),detailsTr.appendChild(reasonTd)),tempDoc.appendChild(detailsTr);else{fromdate=ZP.create("span",{text:lhJson.fromDay+" "+lhJson.from});if($(dateAbTd).attr("width","33.33%"),$(daysCountTd).attr("width","33.33%"),dateAbTd.appendChild(fromdate),detailsAbTr.appendChild(dateAbTd),detailsAbTr.appendChild(daysCountTd),dataArr.allowAdd){var convertTd=ZP.create("td",{class:"zptbbor-fr text-right",width:"33.33%"}),ele=ZP.create("a");bindClick?ele.onclick=Leave.convertToLeave.bind(viewparams):ele.href=LVUtil.urls.ListView.CONVERT()+":"+lhJson.recordId,ele.appendChild(ZP.create("button",{text:ZPI18N.getString("zp.apply")+" "+ZPeople.decodeTxt(displayName),class:"btn-default-brdr"})),convertTd.appendChild(ele),detailsAbTr.appendChild(convertTd)}tempAbDoc.appendChild(detailsAbTr)}}var data_tbody;if((data_tbody=$("tbody#ZP_Leave_ab",Layout.Page.container)).html(""),data_tbody.append(tempAbDoc),$(".zplveyear,#ZP_Absent_Container",Layout.Page.container).show(),$("tbody#ZP_Leave_ab",Layout.Page.container).is(":empty")&&$("#ZP_Absent_Container",Layout.Page.container).hide(),(data_tbody=$("tbody#ZP_Leave_lh",Layout.Page.container)).html(""),data_tbody.append(tempDoc),void 0==params.upcoming||params.upcoming)(data_tbody=Layout.Page.container.find("tbody#ZP_Leave_lh",Layout.Page.container)).html(""),data_tbody.append(tempDoc),Layout.Page.container.find("tbody#ZP_Leave_lh",Layout.Page.container).is(":empty")?Leave.Util.showHideNoData(!0,"",Layout.Page.container.find("#ZP_Leave_lhtable")):Leave.Util.showHideNoData(!1,"",Layout.Page.container.find("#ZP_Leave_lhtable")),0==params.leaveyear&&Layout.Page.container.find("#zp_leavelist_container",Layout.Page.container).delay(200).fadeIn(200);if(void 0==params.upcoming||!params.upcoming){var data_Histtbody=Layout.Page.container.find("tbody#ZP_Leave_lh1",Layout.Page.container);data_Histtbody.html(""),data_Histtbody.hide().fadeIn("fast"),data_Histtbody.append(tempHistoryDoc),Layout.Page.container.find("tbody#ZP_Leave_lh1",Layout.Page.container).is(":empty")?Leave.Util.showHideNoData(!0,"",Layout.Page.container.find("#ZP_Leave_lhtable1")):Leave.Util.showHideNoData(!1,"",Layout.Page.container.find("#ZP_Leave_lhtable1")),Layout.Page.container.find("#zp_leavelist_container1",Layout.Page.container).delay(200).fadeIn(200)}Leave.Util.removeLoading(),Layout.Page.container.find(".zplveyear").hide().fadeIn("fast")}else Leave.Util.removeLoading(),Layout.Page.container.find(".Scrcont").css("overflow","auto"),Leave.Util.showHideNoData(!0,"",Layout.Page.container.find("#ZP_Leave_lhtable")),(void 0==params.upcoming||params.upcoming)&&(Layout.Page.container.find("#zp_leavelist_container",Layout.Page.container).show(),Leave.Util.showHideNoData(!0,"",Layout.Page.container.find("#ZP_Leave_lhtable"))),void 0!=params.upcoming&&params.upcoming||(Layout.Page.container.find("#zp_leavelist_container1",Layout.Page.container).show(),Leave.Util.showHideNoData(!0,"",Layout.Page.container.find("#ZP_Leave_lhtable1"))),$("#ZP_Absent_Container").hide()}},Leave.SelfService={},Leave.SelfService.View={init:function(){var form_name=Leave.Util.getfilterOptions().formdisplayName,applyLeave=ZPeople.decodeTxt(form_name)==ZPI18N.getString("zp.leave")?ZPI18N.getString("zp.leave.apply"):ZPI18N.getString("zp.apply.context.leave")+" "+form_name;Leave.Util.isDashboardUser()?Layout.Page.container.html("").append('<div class="MT10 lvType"><div class="zplveyear zplveyear_hlyday"><div class="well ZPPhed lv-cont" ><div class="row"><div class="col-sm-4"><h5><b id="ZP_Leave_Listview_header"></b></h5></div><div class="col-sm-4"></div><div class="col-sm-4"><button type="button" id="Self-ApplyLeave" class="btn btn-primary btn-md ZP-Add FR DN">'+applyLeave+'</button></div></div></div><div class="zprow"><div class="zp-sm-8" id="ZPleave_reportcard_1"> <div class="card MB0I"> <div class="card-body lv_crdsDvarw"> <div class="topCalNav d-flex a-itm-cntr j-cnt-cntr pager ZP-YearPager" id="ZPleave_yearnav"> <i class="IC-ar-lft"></i> <i class="IC-ar-rgt"></i> <span id="ZPleave_yearnavtxt"></span></div> <div class="lv_txthd"><div>'+ZPI18N.getString("zp.leavetype")+"</div><div>"+ZPI18N.getString("zp.available")+"</div><div>"+ZPI18N.getString("zp.leave.view.booked")+'</div></div><div class="lv_crdsDv" id="ZPleave_reportcard_1_body"></div> <div class="arw_actns "><i class="IC-ar-lft "></i><i class="IC-ar-rgt "></i></div> </div> </div> </div><div class="zp-sm-4" id="ZPleave_reportcard_2"> <div class="card MB0I lv-aplcin card-height-fluid active"> <div class="card-body P0I lv_crdsDvarw"> <div class="lv_crdsDv" id="ZPleave_reportcard_2_body"></div> <div class="arw_actns "><i class="IC-ar-lft "></i><i class="IC-ar-rgt "></i></div> <div id="ZPleave_reportcard_2_applications" class="lv-aplcinLst" style="display:none"> </div> </div> </div> </div> </div><div class="zplveyear_ab" id="ZP_Absent_Container" style="min-height:240px"><h6>'+ZPeople.Module.MODULE_DATA.selfservice.leave_filterops.absentDisplayName+'<small><i>:</i><em id="absent_count"></em></small></h6><div class="table-responsive"><table class="table table-hover"><tbody id="ZP_Leave_ab"></tbody></table></div></div><div class="zplveyear_lh"><h6 class="PR lvhl-slct"><select class="W200" tabindex="-1" title="" id="lvdtType"><option value="0" selected="">'+ZPI18N.getString("zp.leave.allleaveandholiday",[form_name,holiday_disName])+'/></option><option value="1">'+ZPI18N.getString("zp.leave.only",[form_name])+'</option><option value="2">'+ZPI18N.getString("zp.leave.only",[holiday_disName])+'</option></select><div class="grybtnBg" id="upcominghistorymenu"><a id="zplist_upcoming" class="active" href="javascript:void(0);" onclick="Leave.SelfService.View.switchTabs(0)">'+ZPI18N.getString("zp.upcoming")+'</a><a id="zplist_history" href="javascript:void(0);" onclick="Leave.SelfService.View.switchTabs(1)">'+ZPI18N.getString("zp.history")+'</a></div></h6><div id="ZP_Leave_lhtable"><table class="table table-hover"></table><div class="table-responsive"><table class="table table-hover"><tbody id="ZP_Leave_lh"></tbody></table></div></div></div></div></div></div>'):Layout.Page.container.html("").append('<div class="MT10"><div class="zplveyear zplveyear_hlyday"><div class="well ZPPhed lv-cont" ><div class="row"><div class="col-sm-4"><h5><b id="ZP_Leave_Listview_header"></b></h5></div><div class="col-sm-4"></div><div class="col-sm-4"><button type="button" id="Self-ApplyLeave" class="btn btn-primary btn-md ZP-Add FR DN">'+applyLeave+'</button></div></div></div><div class="zplveyear_lst"><ul class="zplveyear_slr"><li class="sliderbox" id="ZP_Leave_lst" style="width:8500%"></li></ul><div class="zplveyear_slar"><a class="FL IC-ar-lft" style="display: none;" onclick="Leave.View.List.sliderClick(this)"></a><a class="FR IC-ar-rgt" style="display: block;"onclick="Leave.View.List.sliderClick(this)"></a></div><div class="zplveyear_ab" id="ZP_Absent_Container"><h6>'+ZPeople.Module.MODULE_DATA.selfservice.leave_filterops.absentDisplayName+'<small><i>:</i><em id="absent_count"></em></small></h6><div class="table-responsive"><table class="table table-hover"><tbody id="ZP_Leave_ab"></tbody></table></div></div><div class="brdfrd_Scrd DN" id="zp_bradford_container"><h6 class="PR">'+ZPI18N.getString("zp.bradfordfactor.bradfordscore")+'<span class="timelg-dot DI">.</span><span class="dgry ML5 S14 ZP_Font" id="zp_bradford_date"></span><div class="FR S14 ZP_Font MR15"><a onclick="Leave.View.List.Bradford.detailedView();">'+ZPI18N.getString("zp.bradfordfactor.viewetailscore")+'</a></div></h6><div id="zp_bradford_score_list" class="table-responsive"><table class="table table-hover"><tbody id="zp_bradford_score_body"></tbody></table></div></div><div class="zplveyear_lh"><h6 class="PR lvhl-slct"><select class="W200" tabindex="-1" title="" id="lvdtType"><option value="0" selected="">'+ZPI18N.getString("zp.leave.allleaveandholiday",[form_name,holiday_disName])+'</option><option value="1">'+ZPI18N.getString("zp.leave.only",[form_name])+'</option><option value="2">'+ZPI18N.getString("zp.leave.only",[holiday_disName])+'</option></select><div class="grybtnBg" id="upcominghistorymenu"><a id="zplist_upcoming" class="active" href="javascript:void(0);" onclick="Leave.SelfService.View.switchTabs(0)">'+ZPI18N.getString("zp.upcoming")+'</a><a id="zplist_history" href="javascript:void(0);" onclick="Leave.SelfService.View.switchTabs(1)">'+ZPI18N.getString("zp.history")+'</a></div></h6><div id="ZP_Leave_lhtable"><table class="table table-hover"></table><div class="table-responsive"><table class="table table-hover"><tbody id="ZP_Leave_lh"></tbody></table></div></div></div></div></div></div>'),Layout.Page.container.find("#Self-ApplyLeave").on("click",function(){var params={lookupValue:SelfService.getUserId()};Leave.add(params)});var sel=Layout.Page.container.find("select#lvdtType");sel.select2(),sel.on("change",function(){Leave.SelfService.View.get(void 0,!0)})},switchTabs:function(tab){$(0==tab?"#zplist_upcoming":"#zplist_history",Layout.Page.container).addClass("active"),$(0==tab?"#zplist_history":"#zplist_upcoming",Layout.Page.container).removeClass("active"),Leave.SelfService.View.get(void 0,!0)},get:function(location,reloadOnlyApplications){if(Leave.Util.isDashboardUser())reloadOnlyApplications?Leave.View.List.Widgets.Applications.get():Leave.View.List.Widgets.load();else{var userInfo=SelfService.getUserInfo(),params={key:Leave.View.List.key,leaveyear:0};params.employee=userInfo.usererec,params.location=userInfo.locId||-1,ZPUtil.checkIsOtherUserProfile()&&(params.isFmSService=!0),params.upcoming=!0,params.dataType=parseInt(Layout.Page.container.find("select#lvdtType").val()),params.reloadOnlyApplications=reloadOnlyApplications,Leave.Util.appendLoading(),!params.reloadOnlyApplications&&$(".zpl_lvelstprnt,#zp_leavelist_container,#zp_leavelist_container1,#zp_bradford_container,#ZP_Absent_Container",Layout.Page.container).hide(),ZPeople.Request.send(Leave.View.List.url,params,reloadOnlyApplications?Leave.View.List.populateAbsentAndLeaves:Leave.View.List.construct,{})}}},Leave.View.Applications={url:"/leave_view_actions.zp",key:"applications_view",sortBy:0,sortType:0,get:function(){LVUtil.Tab.InitPage(Leave.View.Applications.getPage,!1)},getPage:function(){0==$("tbody#ZP_Leave_RecordsView",Layout.Page.container).length&&Leave.Util.SystemView.construct();var params={key:Leave.View.Applications.key};Leave.Util.filterCrt(params),Leave.Util.sortParams(params),Leave.Util.SystemView.getStaticParams(params);var data_footer=$("#systemview_pagination.ZPAct",Layout.Page.container),getMore=$(".navi",data_footer),recordLimit=$(".Recrd",data_footer);params.sIndx=getMore.find("span").data("sIndx"),params.limit=getMore.find("span").data("eIndx");var rowCnt=0;Leave.Util.appendLoading(),ZPeople.Request.send(Leave.View.Applications.url,params,function(resp){Leave.View.Applications.construct(resp),Leave.Util.removeLoading(),resp.count&&(data_footer.find("a#recCount").data("totalCount",resp.count),resp.count<=recordLimit.find("select").val()&&data_footer.find("a#recCount").text(resp.count)),rowCnt=params.sIndx+resp.data.length-1,Leave.Util.Footer.setNavi(params.sIndx,rowCnt)},{},Leave.View.Applications.showErrorMsg)},construct:function(response){var data_arr=response.data,show_approval=(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isdataadmin,ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.approval_configured);if($("#page-wrapper").removeClass("Abar1"),0==data_arr.length)Leave.Util.showHideNoRecord(!0,!1),$(".ZPAct#systemview_pagination",Layout.Page.container).addClass("DN");else{var tempDoc=document.createDocumentFragment();$.each(data_arr,function(){var detailsTr=ZP.create("tr",{class:"ZPLRow"}),action={viewOpt:function(ele){Leave.Util.SystemView.changeURL(void 0,$(ele).closest("tr").data("id"),"VIEW")}};this.allowedit&&(action.editOpt=function(ele){Leave.Util.SystemView.changeURL(void 0,$(ele).closest("tr").data("id"),"EDIT")}),this.allowdelete&&(action.deleteOpt=Leave.Util.Row.deleteWarning),detailsTr.appendChild(Leave.Util.getDropDownActionsTD(action));var chxTd=ZP.create("td"),chxLabel="";if(this.allowdelete?(chxLabel=ZP.create("div",{class:"checkbox ML2"})).appendChild(ZP.create("input",{type:"checkbox"})):(chxLabel=ZP.create("div",{class:"checkbox disabled ML2"})).appendChild(ZP.create("input",{type:"checkbox",disabled:!0})),chxLabel.appendChild(ZP.create("label")),chxTd.appendChild(chxLabel),detailsTr.appendChild(chxTd),show_approval){var approvalTd=ZP.create("td");Leave.Util.getStatusTd(approvalTd,this.approval_status),detailsTr.appendChild(approvalTd)}var nameTd=ZP.create("td",{style:"padding:6px 10px"});nameTd.appendChild(ZP.create("img",{class:"FL",src:this.photo}));var nameDiv=ZP.create("div",{class:"ZPusrName","data-toggle":"tooltip","data-placement":"top",title:this.emp_name,style:"padding-top:6px"}),nameSpan=ZP.create("span",{class:"ellipsis W120 CP"});nameSpan.appendChild(ZP.create("b",{text:this.emp_id})),ZP.setAtt(nameSpan,{text:this.emp_name}),nameDiv.appendChild(nameSpan),nameTd.appendChild(nameDiv),detailsTr.appendChild(nameTd),detailsTr.appendChild(ZP.create("td",{text:ZPeople.decodeTxt(this.ltyp_name)})),detailsTr.appendChild(ZP.create("td",{text:Leave.Type.text(this.ltyp_type)}));var recordView=ZP.create("td");recordView.appendChild(document.createTextNode(this.from+" - "+this.to)),detailsTr.appendChild(recordView),detailsTr.appendChild(ZP.create("td",{text:this.leavetaken+" "+this.leaveunit})),detailsTr.appendChild(ZP.create("td",{text:this.dateofrequest?this.dateofrequest:""})),$(detailsTr).data("id",this.rec_id),tempDoc.appendChild(detailsTr)});var data_tbody=$("tbody#ZP_Leave_RecordsView",Layout.Page.container);data_tbody.html(""),data_tbody.append(tempDoc),Leave.Util.showHideNoRecord(!1,!1),$("#page-wrapper").addClass("Abar1"),$(".ZPAct#systemview_pagination",Layout.Page.container).removeClass("DN")}},showErrorMsg:function(){ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.leave.view.applications.errormsg")),Leave.Util.removeLoading()}},Leave.hideApproval=function(){"APPROVER_CHOOSEN_BY_USER"===LVUtil.Form.getApproverType()?LVUtil.Form.getFormLayout().find("[name=submitForApproval]").parent().parent().addClass("DN"):LVUtil.Form.getFormLayout().find("#zp_form_submitappr_cont").parent().hide(),LVUtil.Form.getFormLayout().find(".modal-header #zp_lcancel").remove()},Leave.add=function(params){if(params=params||{},Leave.Form.setInitialSelection(params),!ZPeople.Module.leave_formid)if(params.formId)ZPeople.Module.leave_formid=params.formId;else{if(!ZPeople.Module.MODULE_DATA.hasOwnProperty("leavetracker")){var featch_params={key:"filter_options"};return featch_params[csrfParamName]=csrfToken,featch_params.data_required="formid",void Leave.Util.Init(featch_params,ZPeople.Module,"leave_formid",function(){Leave.add(params)},!1)}ZPeople.Module.leave_formid=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.formid}let form_json={formId:ZPeople.Module.leave_formid,fieldCallback:{Employee_ID:Leave.Form.getApplicable,Leavetype:Leave.Form.getDetails,From:Leave.Form.getDetails,To:Leave.Form.getDetails},fieldFormat:["Employee_ID","Leavetype","From","To","Daystaken","TeamEmailID","Reasonforleave"],modalPopupView:!!params.modalPopupView&&params.modalPopupView,lookupValue:params.lookupValue?params.lookupValue:void 0,onloadCallback:function(){Leave.View.List.initSelectedUserInApplyLeave(),Leave.hideApproval(),Leave.Form.addReport(),Leave.Form.getApplicable(params),params.defaultDateValue&&Leave.Form.setDate(params.defaultDateValue,params.defaultDateValue)},callback:params.callback?params.callback:Leave.Form.switchToRecView,embedCallback:params.embedCallback?params.embedCallback:void 0,isfromProjects:!!params.isfromProjects,formMode:"ADD",isLeave:!0};LVUtil.Form.loadForm(form_json)},Leave.convertToLeave=function(){Leave.convert(this.formid,this.recid)},Leave.convert=function(formid,recid){let form_json={formId:formid||ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.formid,fieldCallback:{Employee_ID:Leave.Form.getApplicable,Leavetype:Leave.Form.getDetails,From:Leave.Form.getDetails,To:Leave.Form.getDetails},fieldFormat:["Employee_ID","Leavetype","From","To","Daystaken","TeamEmailID","Reasonforleave"],tableName:"P_EmployeeLeave",onloadCallback:function(){Leave.Form.getAbsentDetails(recid)},callback:Leave.Form.switchToRecView,formMode:"EDIT",isLeave:!0};LVUtil.Form.loadForm(form_json)},Leave.editRec=function(formid,recid){var disableUrlTrack="leavetracker-reports-yearly"===Layout.Page.pageId;let form_json={formId:formid||ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.formid,recordId:recid,fieldCallback:{Employee_ID:Leave.Form.getApplicable,Leavetype:Leave.Form.getDetails,From:Leave.Form.getDetails,To:Leave.Form.getDetails},fieldFormat:["Employee_ID","Leavetype","From","To","Daystaken","TeamEmailID","Reasonforleave"],callback:Leave.Form.switchToRecView,onloadCallback:Leave.Form.regViewEdit,disableUrlTrack:disableUrlTrack,formMode:"EDIT",isLeave:!0};LVUtil.Form.loadForm(form_json)},Leave.viewRecord=function(){Leave.viewRec(this.formid,this.recid)},Leave.viewRecord.applyOptionalHoliday=function(ele){let date=$(ele).data("date"),emp=void 0;(LVUtil.Tab.isUserPage()||LVUtil.Tab.isOpersUserPage()||LVUtil.Tab.isGlobalSearchUserPage())&&void 0==(emp=LVUtil.urls.getCurrentPageUser())&&(emp=LVUtil.Team.SELECTED_USER),new LeaveForm({initApplyLvDate:date,isRestrictedDate:!0,initEmployee:emp}).add()},Leave.viewRecord.applyLeaveWithoutURL=function(leavetype){(LVUtil.Tab.isUserPage()||LVUtil.Tab.isOpersUserPage()||LVUtil.Tab.isGlobalSearchUserPage())&&(emp=LVUtil.urls.getCurrentPageUser(),void 0==emp&&(emp=LVUtil.Team.SELECTED_USER)),new LeaveForm({initEmployee:emp,initLeaveType:leavetype||void 0}).add()},Leave.viewRecordWithURL=function(){if(this.recordId){let url=LVUtil.urls.ListView.HOME();"LIST"==this.mode?url=LVUtil.urls.ListView.VIEW():"CONVERT"==this.mode&&(url=LVUtil.urls.ListView.CONVERT()),LVUtil.Tab.isGlobalSearchUserPage()&&(ZPeople.isOperationAllowed?"LIST"==this.mode?url=LVUtil.urls.ListView.OPERUSERHOME():"CONVERT"==this.mode&&(url=LVUtil.urls.ListView.OPERUSERCONVERT()):"LIST"==this.mode?url=LVUtil.urls.ListView.TEAMUSERHOME():"CONVERT"==this.mode&&(url=LVUtil.urls.ListView.TEAMUSERCONVERT())),url+=":"+this.recordId,window.location.href=LVUtil.urls.getUrlAsHash(url)}},Leave.viewRec=function(formid,recid,params){params=params||{};var form_json={formId:formid||ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.formid,recordId:recid,callback:Leave.Form.switchToRecView,parent:{formId:formid},fieldFormat:["Employee_ID","Leavetype","From","To","Daystaken","TeamEmailID","DateOfRequest","Reasonforleave"],onloadCallback:Leave.Form.regViewEdit,editCallback:params.editCallback?params.editCallback:Leave.Form.switchToEdit,disableUrlTrack:!!params.disableUrlTrack&&params.disableUrlTrack,disableSingleEdit:!0,isEditDisabled:Leave.View.isEditAllowedInPage(),formMode:"VIEW",isLeave:!0};LVUtil.Form.loadForm(form_json)},Leave.View.allowedit=!1,Leave.Form={fullDayMins:480,setInitialSelection:function(params){return Leave.Form.initLeaveType&&(params.leavetype=Leave.Form.initLeaveType,params.onloadCallback=function(params){LVUtil.Form.getFormLayout().find("[name='Leavetype']").select2("val",params.leavetype).trigger("change")},delete Leave.Form.initLeaveType),params},addReport:function(){var icondiv=ZP.create("div",{class:"ZPrport",style:"bottom:76px"});icondiv.appendChild(ZP.create("i",{class:"IC-chart CP"})),icondiv.appendChild(ZP.create("span",{text:ZPI18N.getString("zp.report")})),LVUtil.Form.getFormLayout().find(".modal-footer").append(icondiv),LVUtil.Form.getFormLayout().find(".ZPrport").on("click",function(){var leaves=LVUtil.Form.getFormLayout().data("report").leavetypes,modalcnt=Leave.View.List.detailed_report(leaves);modalcnt.removeClass("PopSmModel"),modalcnt.addClass("PopMdModel"),modalcnt.css("z-index","1000");var title=ZP.create("h2",{class:"ZPbgblue"});title.appendChild(ZP.create("span",{text:"Leave Report"})),title.appendChild(ZP.create("i",{class:"iconbck IC-ar-lft","data-dismiss":"modal"})),modalcnt.find(".modal-header").css("background-color","#f4f8fb").addClass("ZPbgblue").append('<i class="iconbck IC-ar-lft DI" style="margin-top:7px;"  data-dismiss="modal"></i>'),modalcnt.find(".modal-header > h6").addClass("DI"),modalcnt.find(".modal-header > [aria-label=Close]").remove(),modalcnt.find(".modal-body").after(ZP.create("div",{class:"modal-footer text-left","data-dismiss":"modal"})),modalcnt.find(".modal-footer").append(ZP.create("button",{class:"btn btn-default",type:"button",text:ZPI18N.getString("zp.close")})),modalcnt.modal("show")})},adjustReportHeight:function(){},getReportData:function(){var emprecno="";if(LVUtil.Form.isViewMode())emprecno=LVUtil.Form.getFormLayout().data("record").extraDetails.dayDetails.employee;else{var leaveForm=$("Form#zp_form_container",Layout.Page.container);emprecno=$("[name=Employee_ID]",leaveForm).val()}if(!ZPUtil.Validation.isEmpty(emprecno)){var params={key:"leavetype_appl",employee:emprecno,isView:LVUtil.Form.isViewMode()};params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(result){if("success"===result.status){var leavetype=$("select[name=Leavetype]",Layout.Page.container);Leave.Form.changeLeaveTypes(leavetype,result.leave_data.Options),Leave.Form.populateCompoffLookup(result.leave_data.workedDates),LVUtil.Form.getFormLayout().data("report",result.leave_data.leave_report[0]),LVUtil.Form.getFormLayout().data("applyDates",result.leave_data.applyDates),Leave.Util.isV1User=result.leave_data.isV1User}})}},QuickListView:{init:function(){var icondiv=ZP.create("div",{id:"ZP_QuickListView",class:"ZPrport",style:"bottom : 120px"});icondiv.appendChild(ZP.create("i",{class:"IC-list-v CP"})),icondiv.appendChild(ZP.create("span",{text:"Applications"})),LVUtil.Form.getFormLayout().find(".modal-footer").append(icondiv),LVUtil.Form.getFormLayout().find("#ZP_QuickListView").on("click",function(){if(LVUtil.Form.getFormLayout().data("listviewdata_"+LVUtil.Form.getCurrFormParam().recordId))Leave.Form.QuickListView.populate(LVUtil.Form.getFormLayout().data("listviewdata_"+LVUtil.Form.getCurrFormParam().recordId));else{var params={key:"quick_list_view",employee:LVUtil.Form.getFormLayout().data("record").extraDetails.dayDetails.employee},loc=ZP.getUserDetailsById(params.employee).location;params.location=loc+""=="null"?-1:loc,Leave.Util.appendLoading(),ZPeople.Request.send(Leave.View.List.url,params,function(resp){Leave.Form.QuickListView.populate(resp),Leave.Util.removeLoading(),LVUtil.Form.getFormLayout().data("listviewdata_"+LVUtil.Form.getCurrFormParam().recordId,resp)},{})}})},populate:function(resp){var modal=ZPeople.BSModal.get({id:Layout.Page.pageId+"_quick_list_view",type:2,modalClass:"popRgtModel PopMdModel",body:'<div id="zp_quicklistview_container"><table class="table table-hover"> <thead id="ZP_Leave_lh_header"> <tr id="approval_enabled_header"> <th class="zptbbor-fl" width="17%">Date</th> <th width="23%">Leave Type</th> <th width="15%">Count</th> <th width="25%">Reason</th> <th class="zptbbor-fr" width="15%"><span>Approval Status</span></th> </tr> <tr id="approval_disabled_header" class="DN"> <th class="zptbbor-fl" width="20%">Date</th> <th width="30%">Leave Type</th> <th width="20%">Count</th> <th class="zptbbor-fr" width="25%"><span>Reason</span></th> </tr> </thead> </table><div class="table-responsive"> <table class="table table-hover"><tbody id="zp_quicklistview_body"></tbody></table> </div></div>',bodyClass:"ZPLAbody",disableFooter:!0,deleteOnHide:!0});modal.find(".modal-dialog").addClass("ZPLApnl"),modal.css("z-index","1000");var title=ZP.create("h2",{class:"ZPbgblue"});if(title.appendChild(ZP.create("span",{text:"Applications"})),title.appendChild(ZP.create("i",{class:"iconbck IC-ar-lft","data-dismiss":"modal"})),modal.find(".modal-header").css("background-color","#f4f8fb").addClass("ZPbgblue").append('<i class="iconbck IC-ar-lft DI" style="margin-top:7px;"  data-dismiss="modal"></i>'),modal.find(".modal-header").append('<h6 class="addPopTitle DI">'+resp.formdisplayName+" Applications</h6>"),modal.find(".modal-header > h6").addClass("DI"),modal.find(".modal-header > [aria-label=Close]").remove(),modal.find(".modal-body").after(ZP.create("div",{class:"modal-footer text-left","data-dismiss":"modal"})),modal.find(".modal-footer").append(ZP.create("button",{class:"btn btn-default",type:"button",text:ZPI18N.getString("zp.close")})),resp.error)return Leave.Util.removeLoading(),Leave.Util.showHideNoRecord4_0(!0,!1,Layout.Page.container.find("#zp_quicklistview_container"),void 0,resp.error),modal.modal("show"),modal;var lh=resp.data;if(modal.find("#approval_disabled_header").addClass("DN"),modal.find("#approval_enabled_header").removeClass("DN"),0==lh.length)Leave.Util.removeLoading(),Leave.Util.showHideNoRecord(!0,!1,Layout.Page.container.find("#zp_quicklistview_container"));else{for(var tempDoc=document.createDocumentFragment(),index=(document.createDocumentFragment(),resp.formdisplayName,0);index<lh.length;index++){var lhJson=lh[index];if(!lhJson.isHoliday&&11!=lhJson.approvalStatus&&14!=lhJson.approvalStatus){var daysDetails=lhJson.dayDetails,detailsTr=ZP.create("tr",{class:"ZPLRow"}),dateTd=(ZP.create("tr",{class:"ZPLRow"}),ZP.create("td",{class:"zptbbor-fl",width:"17%"})),leaveTypeTd=ZP.create("td",{width:"23%"}),daysCountTd=ZP.create("td",{width:"15%"}),reasonTd=ZP.create("td",{width:"25%",class:"WBBW"}),approvalTd=ZP.create("td",{class:"zptbbor-fr",width:"15%"}),noOfData=(ZP.create("td",{class:"zptbbor-fl",width:"180px"}),daysDetails.length),date_diff=daysDetails.date_diff,dateFrom=Calendar.parseDate(lhJson.from,uidateFormat),dateTo=Calendar.parseDate(lhJson.to,uidateFormat);if(11!==lhJson.approvalStatus&&14!==lhJson.approvalStatus){var fromdate=ZP.create("a",{text:lhJson.from+", "+days[dateFrom.getDay()]});dateTd.appendChild(fromdate)}else dateTd.appendChild(ZP.create("a",{text:lhJson.to+", "+days[dateTo.getDay()],href:"javascript:void(0)"}));if(noOfData>1||date_diff&&date_diff>1)if(dateTd.appendChild(ZP.create("br")),dateTd.appendChild(ZP.create("span",{class:"PT10 PB10 ZPwf",text:ZPI18N.getString("zp.sto")})),11!==lhJson.approvalStatus&&14!==lhJson.approvalStatus){dateTo=Calendar.parseDate(lhJson.to,uidateFormat);var todate=ZP.create("a",{text:lhJson.to+", "+days[dateTo.getDay()]});dateTd.appendChild(todate)}else dateTd.appendChild(ZP.create("a",{text:lhJson.to+" - "+lhJson.toDay,href:"javascript:void(0)"}));daysCountTd.append(lhJson.leavetaken+" "+lhJson.leaveunit),Leave.Util.getStatusTd(approvalTd,lhJson.approvalStatus,!0),approvalTd.append(lhJson.approvalStatusDisplay),leaveTypeTd.append(ZP.create("span",{class:"zptb-brdr ZPBC"+lhJson.leavecolorValue})),leaveTypeTd.append(ZP.create("span",{class:"zplvehd",text:lhJson.leavetype,"data-toggle":"tooltip","data-placement":"bottom",title:lhJson.leavetype})),reasonTd.append(lhJson.reason),detailsTr.appendChild(dateTd),detailsTr.appendChild(leaveTypeTd),detailsTr.appendChild(daysCountTd),detailsTr.appendChild(reasonTd),detailsTr.appendChild(approvalTd),tempDoc.appendChild(detailsTr)}}var data_tbody=$("tbody#zp_quicklistview_body",Layout.Page.container);data_tbody.html(""),data_tbody.append(tempDoc),$("tbody#zp_quicklistview_body",Layout.Page.container).is(":empty")?Leave.Util.showHideNoRecord(!0,!1,Layout.Page.container.find("#zp_quicklistview_container")):Leave.Util.showHideNoRecord(!1,!1),Leave.Util.removeLoading()}return modal.modal("show"),modal}},regViewEdit:function(){var record=LVUtil.Form.getFormLayout().data("record"),leaveData=record?record.extraDetails:{},dayDetails=leaveData.dayDetails?leaveData.dayDetails:[];Leave.Form.fullDayMins=leaveData.fullDayMins,dayDetails.isDayAndHourAllowed?(ZPeople.isZPNewUI()?Leave.Form.ShowHideUnitField(!0,!dayDetails.isDayBased):Leave.Form.createUnitSelectField(!dayDetails.isDayBased),ZPeople.isZPNewUI()?Leave.Form.ShowHideUnitField(!1):$("div#leaveunitSelect",LVUtil.Form.getFormLayout()).addClass("DN"),ZPeople.isZPNewUI()&&Leave.Form.showHideTimeInputByField(!1)):dayDetails.isDayAndHourAllowed||dayDetails.isDayBased||LVUtil.Form.isViewMode()||ZPeople.isZPNewUI()&&Leave.Form.showHideTimeInputByField(!0),Leave.Form.showCompensatedDate(dayDetails),Leave.Form.setDayDetails(dayDetails),LVUtil.Form.getFormLayout().find(".modal-header #zp_lcancel").remove(),LVUtil.Form.isViewMode()?(Leave.View.allowedit=leaveData.allowEdit,leaveData.approvalStatus=record.message.approvalStatus,Leave.Form.showhidefooterAction(leaveData.recordImmutable,leaveData.showCancel),-1==record.message.approvalStatus&&(Leave.Form.addReport(),Leave.Form.getReportData(),656250178!=_LOGGEDIN_ZSOID&&670195449!=_LOGGEDIN_ZSOID&&55013116!=_LOGGEDIN_ZSOID||Leave.Form.QuickListView.init()),-1==record.message.approvalStatus&&(record.isRecordAdmin||record.isPrimaryAppr)&&Leave.Form.QuickLinks.init(),Leave.Form.changeDateDiv()):LVUtil.Form.isEditMode()&&(Leave.Form.addReport(),Leave.Form.getApplicable(void 0,!0))},changeDateDiv:function(){var leaveBody=LVUtil.Form.getFormLayout(),fromDiv=$("[folabel=From]",leaveBody),toDiv=$("[folabel=To]",leaveBody),fromDate=fromDiv.find("span").text(),toDate=toDiv.find("span").text(),is4_0=ZPeople.isZPNewUI();if(fromDate&&toDate&&""!=fromDate&&""!=toDate){fromDiv.hide(),toDiv.hide();var div,dateDiv=fromDiv.parents(ZPeople.isZPNewUI()?"div.zprt-label":"div.form-group");if(is4_0)(div=ZP.create("span")).appendChild(document.createTextNode(fromDate)),fromDate!=toDate&&(div.appendChild(ZP.create("span",{class:"ZPuscr",text:"-"})),div.appendChild(document.createTextNode(toDate))),dateDiv.append(div);else(div=ZP.create("div",{class:"col-sm-6 PT10"})).appendChild(document.createTextNode(fromDate)),fromDate!=toDate&&(div.appendChild(ZP.create("span",{class:"ZPuscr",text:"-"})),div.appendChild(document.createTextNode(toDate))),dateDiv.append(div)}},showhideHeaderAction:function(leavedata){document.createDocumentFragment();if(2==leavedata.approvalStatus&&!leavedata.isCancelledAfterApproval){var cancel=ZP.create("div",{id:"zp_lcancel",class:"cancel zp-recordsts dropdown ZPcusPos1 ZPCusDrs lvcanlPoptop"});if(cancel.appendChild(ZP.create("span",{id:"cancel_status",class:"msg",text:ZPI18N.getString("zp.cancelled")})),!_.isEmpty(leavedata.cancelInfo)){var cancelInfo=Leave.View.CANCEL_INFO_TEMPLATE.clone();cancelInfo.find("#user").text(leavedata.cancelInfo.cancelledBy),cancelInfo.find("#time").text(ZPDateTime.getDateDisplayFormat(leavedata.cancelInfo.cancelledTime)),leavedata.cancelInfo.cancelReason&&""!=leavedata.cancelInfo.cancelReason?cancelInfo.find("#reason").text(leavedata.cancelInfo.cancelReason):cancelInfo.find("#reason_row").css("display","none"),cancel.appendChild(ZP.create("a",{"data-toggle":"dropdown",text:ZPI18N.getString("zp.view")})),cancel.appendChild(cancelInfo[0])}LVUtil.Form.getFormLayout().find(".modal-header #zp_cbutton").after(cancel)}},showhidefooterAction:function(recordImmutable,showCancel){recordImmutable&&LVUtil.Form.getFormLayout().find(".modal-footer").find("button").hide();var displayName=LVUtil.Form.getCurrFormConf().formdisplayName,footer=LVUtil.Form.getFormLayout().find(".modal-footer").find("button").parent();if(LVUtil.Form.getFormLayout().find(".modal-footer").find("#zp_appproval_container"),showCancel){$(footer).find("button.cancel-model").remove();var cancelbtn=ZP.create("button",{class:"btn btn-cancel btn-default ML8 FR",id:"zp_cancelleave_btn",onclick:"Leave.Form.cancelLeaveWarning();"});$(cancelbtn).html(ZPI18N.getString("zp.cancel")+" "+displayName),$(footer).append(cancelbtn)}LVUtil.Form.getFormLayout().find(".modal-footer").hasClass("DN")&&LVUtil.Form.getFormLayout().find(".modal-footer").removeClass("DN")},recordImmutableFooter:function(approvalDetails){var footer=LVUtil.Form.getFormLayout().find(".modal-footer"),apprejHtmlList=$('<div class="col-sm-12" id="zp_appproval_container"><i class="IC-info gry S16"></i>&nbsp;'+ZPI18N.getString("zp.leave.record.approval.immutableinfo")+"</div>");footer.find(".row").append(apprejHtmlList).append(status)},showHideCancelReason:function(){LVUtil.Form.getCurrFormParam().recordId;var leaveData=LVUtil.Form.getFormLayout().data("record")?LVUtil.Form.getFormLayout().data("record").extraDetails:{},cancelView=Leave.View.CANCEL_INFO_TEMPLATE.clone();cancelView.find("#user").text(leaveData.cancelInfo.CANCEL_BY_NAME),cancelView.find("#time").text(ZPDateTime.getDateDisplayFormat(leaveData.cancelInfo.CANCEL_TIME)),leaveData.cancelInfo.CANCEL_REASON?cancelView.find("#reason_row").addClass("DN"):cancelView.find("reason_row").removeClass("DN").find("#reason").text(leaveData.cancelInfo.CANCEL_REASON)},regConvertLeave:function(dataObj){var absentObj=dataObj;dataObj||(absentObj=LVUtil.Form.getCurrFormCompData()[LVUtil.Form.getCurrFormParam().formId]),LVUtil.Form.getFormLayout().data("absent_"+Layout.Page.childUrlParam.recordId,absentObj);var leaveForm=$("Form#zp_form_container",Layout.Page.container),employee=$("[name=Employee_ID]",leaveForm);Leave.Form.initEmployeeLkp(absentObj.employee,employee),$(employee).select2("disable"),Leave.Form.setDate(absentObj.absent_from,absentObj.absent_to,leaveForm),Leave.hideApproval()},setDate:function(from,to,leaveForm){leaveForm=leaveForm||$("Form#zp_form_container",Layout.Page.container);$("input[name=From]",leaveForm).val(from),$("input[name=To]",leaveForm).val(to)},getAbsentDetails:function(absentId){var leaveForm=$("Form#zp_form_container",Layout.Page.container),leavetype=$("select[name=Leavetype]",leaveForm),params={key:"leavetype_appl",absentId:absentId||Layout.Page.hash.split(":")[1],isView:LVUtil.Form.isViewMode()};params[csrfParamName]=csrfToken,Leave.Form.addReport(),$.post("/leave_common_action.zp",params,function(result){if("success"===result.status){var leavetypeArr=result.leave_data.Options;Leave.Form.changeLeaveTypes(leavetype,leavetypeArr),result.leave_data.hasOwnProperty("absent_data")&&(Leave.Form.regConvertLeave(result.leave_data.absent_data),LVUtil.Form.getFormLayout().data("leavetypedata",result.leave_data),Leave.Form.populateCompoffLookup(result.leave_data.workedDates),LVUtil.Form.getFormLayout().data("report",result.leave_data.leave_report[0]),LVUtil.Form.getFormLayout().data("applyDates",result.leave_data.applyDates),Leave.Util.isV1User=result.leave_data.isV1User)}})},getCompOffDetails:function(){var params={key:"bookcompoff"};LVUtil.urls.CompOff.isBook()&&(params.compoffId=Layout.Page.hash.split(":")[1]),params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(result){if("success"===result.status){var cmpOffData=result.compoff_data,cmpOffLt=result.compofflt_data;Leave.Form.setCompOffDetails(cmpOffData,cmpOffLt)}})},setCompOffDetails:function(dataObj,ltDObj){var leaveForm=$("Form#zp_form_container",Layout.Page.container),employee=$("[name=Employee_ID]",leaveForm);Leave.Form.initEmployeeLkp(dataObj.employee,employee),$(employee).select2("disable");var leavetype=$("select[name=Leavetype]",leaveForm);leavetype.html(""),leavetype.append(ZP.create("option",{html:ltDObj.name,value:ltDObj.Id,selected:"selected"})),$(leavetype).select2("val",ltDObj.Id),$(leavetype).select2("disable"),LVUtil.Form.getFormLayout().data("leavetypedata",{compoffLeave:ltDObj.Id,isHour:dataObj.isHourType,isOnlyHourLeavesAllowed:ltDObj.isOnlyHourLeavesAllowed,Options:[{Id:ltDObj.Id,value:ltDObj.name,isDayAndHourAllowed:ltDObj.isDayAndHourAllowed}]});var from=$("input[name=From]",leaveForm);from.val(ZPeople.Module.getData("leavetracker").leave_filterops.cur_period.cur_date),from.data("duration",dataObj.balance),from.data("isHourType",dataObj.isHourType),from.data("expiry",dataObj.expiry);$("input[name=To]",leaveForm);Leave.Form.getDetails()},switchToEdit:function(formId,recordId){-1!==Layout.Page.hash.indexOf("selfservice/leave/list")?Leave.editRec(formId,recordId):LVUtil.urls.Applications.isHome()?window.location.href=LVUtil.urls.Applications.EDIT()+":"+recordId:LVUtil.urls.ListView.isHome()&&(window.location.href=LVUtil.urls.ListView.EDIT()+":"+recordId)},switchToRecView:function(recordId){if(recordId)-1!==Layout.Page.hash.indexOf("#operations/leavetracker/applications/")?window.location.href="#operations/leavetracker/applications/view-recordId:"+recordId:LVUtil.urls.Applications.isHome()?window.location.href=LVUtil.urls.Applications.VIEW()+":"+recordId:LVUtil.urls.ListView.isHome()?window.location.href=LVUtil.urls.ListView.VIEW()+":"+recordId:Leave.viewRec(Leave.Util.getfilterOptions().formid,recordId);else if(-1!==Layout.Page.hash.indexOf("#leavetracker/views/calendar/view-"))window.location.href=LVUtil.urls.Calendar.HOME();else if(LVUtil.urls.Applications.isHome()){var viewId=ZPView.isSystemView()?"systemview":Layout.Page.urlparam.viewId;ZPView.toggleView(viewId)}else-1!==Layout.Page.hash.indexOf("#approvals/myapproval")?window.location.href="#approvals/myapproval":-1!==Layout.Page.hash.indexOf("#approvals/myrequest")?window.location.href="#approvals/myrequest":-1!==Layout.Page.hash.indexOf("#home/dashboard/feeds")?window.location.href="#home/dashboard/feeds":-1!==Layout.Page.hash.indexOf("#leavetracker/")&&(window.location.href=LVUtil.urls.getUrlAsHash(LVUtil.urls.ListView.HOME()))},getApplicable:function(callback_params,skipSetDayDetails){var leaveForm=$("Form#zp_form_container",Layout.Page.container),employee=$("[name=Employee_ID]",leaveForm),leavetype=$("select[name=Leavetype]",leaveForm),team_mail=($("input[name=From]",leaveForm),$("input[name=To]",leaveForm),$("input[name=TeamEmailID]",leaveForm));if($("#error_message",leaveForm).remove(),ZPUtil.Validation.isEmpty(employee.val()))LVUtil.Form.markFieldAsError("Employee_ID",{Employee_ID:ZPI18N.getString("zp.selvalforfield",["Employee ID"])});else{var params={key:"leavetype_appl",employee:employee.val(),isView:LVUtil.Form.isViewMode()};LVUtil.Form.isEditMode()&&(params.recordId=Layout.Page.childUrlParam.recordId),params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(result){var leavetypeid=LVUtil.Form.isEditMode()?LVUtil.Form.getFormLayout().data("record").extraDetails.dayDetails.leavetypeId:leavetype.val();if("success"===result.status){Leave.Form.changeLeaveTypes(leavetype,result.leave_data.Options);var isCompoff=leavetypeid==result.leave_data.compoffLeave,showLookup=(result.leave_data.RHtype,isCompoff&&LVUtil.Form.isEditMode());Leave.Form.populateCompoffLookup(result.leave_data.workedDates,showLookup),leavetype.select2("val",leavetypeid),LVUtil.Form.isAddMode()&&team_mail.val(result.team_mailid).trigger("change"),LVUtil.Form.getFormLayout().data("leavetypedata",result.leave_data),LVUtil.Form.getFormLayout().data("report",result.leave_data.leave_report[0]),LVUtil.Form.getFormLayout().data("applyDates",result.leave_data.applyDates),Leave.Form.showHideApplyDates(leavetypeid),Leave.Util.isV1User=result.leave_data.isV1User;Calendar.formatDate(new Date);Leave.Form.showHideLeaveBalance(),callback_params&&callback_params.onloadCallback&&callback_params.onloadCallback(callback_params),!skipSetDayDetails&&Leave.Form.getDetails()}})}},initEmployeeLkp:function(employee,ele){if(ZPeople.isZPNewUI()){if(Leave.Util.isLeavePage())var prop={initseljson:{id:(empObj=ZP.getUserDetailsById(employee)).id,text:empObj.name}};else{var empObj;prop={initseljson:{id:(empObj=ZPeople.getUserDetailsById(employee)).usererec,text:ZPeople.decodeTxt(empObj.name)}}}$(ele).select2("destroy").select2(ZPForm.select2.getSelect2Properties(prop)).select2("val",empObj.id)}else $(ele).select2("val",employee)},changeLeaveTypes:function(leavetypeEle,leavetypes){var ltypeOptions=document.createDocumentFragment(),leavetypeArr=leavetypes||[];for(var indx in ltypeOptions.appendChild(ZP.create("option",{text:ZPI18N.getString("zp.select"),value:"-Select-"})),leavetypeArr){var leaveJson=leavetypeArr[indx];ltypeOptions.appendChild(ZP.create("option",{text:ZPeople.decodeTxt(leaveJson.Value),value:leaveJson.Id}))}leavetypeEle.html(""),leavetypeEle.append(ltypeOptions)},fillWithInitialSuggestions:function(){var data=LVUtil.Form.getFormLayout().data("leavetypedata"),date=Calendar.formatDate(new Date),leaveForm=$("Form#zp_form_container",Layout.Page.container);data.hasOwnProperty("RHdate")&&data.RHtype?(Leave.Form.fillFromTo(data),$("select[name=Leavetype]",leaveForm).select2("val",data.RHtype).trigger("change")):data.suggestedLT&&(ZPUtil.Validation.isEmpty($("input[name=From]",leaveForm).val())&&$("input[name=From]",leaveForm).val(date),$("select[name=Leavetype]",leaveForm).select2("val",data.suggestedLT).trigger("change"))},checkAndSuggestApplyDate:function(){var leaveForm=$("Form#zp_form_container",Layout.Page.container),applyDates=$("div#applyDates div.leave-panel",leaveForm);if(0!=applyDates.find("tr").length){var closestTr,closestDiff,today=new Date,rangeFrm=(new Date).setDate(today.getDate()-7),rangeTo=(new Date).setDate(today.getDate()+7),rows=_.filter(applyDates.find("tr"),function(tr){return Leave.Util.isBetween(Calendar.parseDate($(tr).attr("date"),uidateFormat),rangeFrm,rangeTo)});if(rows&&rows.length>0)rows.forEach(function(tr){var d=Calendar.parseDate($(tr).attr("date"),uidateFormat),diff=d<today?Leave.Util.getDateDiff(d,today):Leave.Util.getDateDiff(today,d);(void 0==closestDiff||closestDiff>diff)&&(closestDiff=diff,closestTr=$(tr))}),$("input[name=From]",leaveForm).val(closestTr.attr("date")),$("input[name=To]",leaveForm).val(closestTr.attr("date")),applyDates.animate({scrollTop:closestTr.offset().top-applyDates.offset().top},300,function(){closestTr.effect("highlight",{color:"#eef6f8"},2e3)})}},fillFromTo:function(data){var leaveForm=$("Form#zp_form_container",Layout.Page.container),from=$("input[name=From]",leaveForm),to=$("input[name=To]",leaveForm);from.val(data.RHdate),to.val(data.RHdate);var rhlist=$("div#optional-leave div.leave-panel",leaveForm),height=0,isFound=!1;rhlist.find("tr").each(function(){$(this).attr("date")==data.RHdate&&(isFound=!0),height+=isFound?0:$(this).height()}),rhlist.animate({scrollTop:height},200)},TeamMembersOnLeave:{init:function(){if(LVUtil.Form.getFormLayout().data("teammembersdata_"+LVUtil.Form.getCurrFormParam().recordId))Leave.Form.TeamMembersOnLeave.populate(LVUtil.Form.getFormLayout().data("teammembersdata_"+LVUtil.Form.getCurrFormParam().recordId));else{var employee=LVUtil.Form.getFormLayout().data("record").extraDetails.dayDetails.employee,from=LVUtil.Form.getFormLayout().data("record").extraDetails.dayDetails.from,to=LVUtil.Form.getFormLayout().data("record").extraDetails.dayDetails.to;ZPeople.Request.send("leave_common_action.zp",{key:"getTeamMembersOnLeave",employee:employee,from:from,to:to},function(resp){resp&&resp.data?(Leave.Form.TeamMembersOnLeave.populate(resp.data),LVUtil.Form.getFormLayout().data("teammembersdata_"+LVUtil.Form.getCurrFormParam().recordId,resp.data)):ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.problemoccured"))},function(){ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.problemoccured"))})}},populate:function(data){var from=LVUtil.Form.getFormLayout().data("record").extraDetails.dayDetails.from,to=LVUtil.Form.getFormLayout().data("record").extraDetails.dayDetails.to,fromDt=Calendar.parseDate(from,uidateFormat),toDt=Calendar.parseDate(to,uidateFormat),dateDiff=Leave.Util.getDateDiff(fromDt,toDt),header=0==dateDiff?ZPI18N.getString("zp.leave.employeesonleave.singledate",[from]):1==dateDiff?ZPI18N.getString("zp.leave.employeesonleave.doubledate",[from,to]):ZPI18N.getString("zp.leave.employeesonleave.period",[from,to]),modal=ZPeople.BSModal.get({id:Layout.Page.pageId+"_teammembers_onleave",type:2,modalClass:"popRgtModel PopMdModel",headerClass:"ZPbgblue",header:header,body:'<div class="lvmemMdl_tbl" id="teammembers_onleave_container"><table class="table MB0I PR"><tbody><tr id="teammembers_onleave_header"><th>'+ZPI18N.getString("zp.employee")+"</th><th>"+ZPI18N.getString("zp.leavetype")+"</th><th>"+ZPI18N.getString("zp.from")+"</th><th>"+ZPI18N.getString("zp.to")+"</th><th>"+ZPI18N.getString("zp.count")+"</th><th>"+ZPI18N.getString("zp.approvalstatus")+'</th></tr></tbody></table><div class="lvmemMdl_tblcnt"><table class="table"><tbody id="teammembers_onleave_body"></tbody></table></div></div></div>',bodyClass:"lvmemMdl",disableFooter:!0,closeOnEsc:!0,deleteOnHide:!0});modal.css("z-index","1000").attr("tabindex","-1"),modal.find(".modal-dialog").addClass("ZPRMpnl"),modal.find(".modal-header").addClass("ZPbgblue").append('<i class="iconbck IC-ar-lft DI" style="margin-top:7px;"  data-dismiss="modal"></i>'),modal.find(".modal-header > h6").addClass("DI"),modal.find(".modal-header > [aria-label=Close]").remove(),modal.find(".modal-body").after(ZP.create("div",{class:"modal-footer text-left","data-dismiss":"modal"})),modal.find(".modal-footer").append(ZP.create("button",{class:"btn btn-default",type:"button",text:ZPI18N.getString("zp.close")}));var tbody=modal.find("#teammembers_onleave_body");tbody.find("tr:not(#teammembers_onleave_header)").remove(),0==data.length?Leave.Util.showHideNoRecord4_0(!0,!1,Layout.Page.container.find("#teammembers_onleave_container"),void 0,"No team members are on leave in this period"):(Leave.Util.showHideNoRecord4_0(!1),$.each(data,function(idx,obj){var tr=obj.LEAVES.length>1?ZP.create("tr",{class:"lvmemMdl_col"}):ZP.create("tr"),empTd=ZP.create("td"),empDiv=ZP.create("div",{class:"zpusImg"}),photosrc=obj.photo?obj.photo:ZP.getUserDetailsById(obj.erecno).photo;empDiv.appendChild(ZP.create("img",{class:"img-26",src:photosrc}));var nameDiv=ZP.create("div",{class:"zpusImg_nme"}),nameSpan=ZP.create("span",{"data-toggle":"tooltip","data-placement":"bottom",title:ZPeople.getUserDisplayName(obj.fname,obj.lname)});nameSpan.appendChild(ZP.create("b",{text:obj.id})),nameSpan.appendChild(document.createTextNode(" ")),nameSpan.appendChild(document.createTextNode(ZPeople.getUserDisplayName(obj.fname,obj.lname))),nameDiv.appendChild(nameSpan),empDiv.appendChild(nameDiv),empTd.appendChild(empDiv),tr.appendChild(empTd),$.each(obj.LEAVES,function(idx2,obj2){idx2>0&&(tr=ZP.create("tr")).appendChild(ZP.create("td"));var td=ZP.create("td");td.appendChild(ZP.create("span",{text:obj2.leavetype,"data-toggle":"tooltip","data-placement":"bottom",title:obj2.leavetype})),tr.appendChild(td),tr.appendChild(ZP.create("td",{class:"PL0",text:obj2.from})),tr.appendChild(ZP.create("td",{class:"PL0",text:obj2.to})),td=ZP.create("td"),obj2.session?td.appendChild(ZP.create("span",{text:obj2.count+" "+Leave.Util.getDispUnit(obj2.count,obj2.unit),"data-toggle":"tooltip","data-placement":"right",title:obj2.session})):td.appendChild(ZP.create("span",{text:obj2.count+" "+Leave.Util.getDispUnit(obj2.count,obj2.unit)})),tr.appendChild(td);var appTd=ZP.create("td");$(appTd).html(Leave.Form.TeamMembersOnLeave.getStatusIcon(obj2.approvalstatus)),tr.appendChild(appTd),tbody.append(tr)})})),modal.modal("show")},getStatusIcon:function(approvalStatus){return-2==approvalStatus?"":-1==approvalStatus?'<i class="IC-pending org S18 ML40">':1==approvalStatus?'<i class="IC-like grn S18 ML40">':0==approvalStatus?'<i class="IC-unlike red S18 ML40">':2==approvalStatus?'<i class="IC-rejected red S18 ML40">':void 0}},QuickLinks:{init:function(){$(LVUtil.Form.getFormLayout().find("#LEAVE_QUICK_LINKS")).remove(),$(LVUtil.Form.getFormLayout().find(".row").children(".col-sm-6")[0]).after($("<div class='lveble' id='LEAVE_QUICK_LINKS'>"+'<div class="ZPrportVw MT20" id="TEAM_MEMBERS_ON_LEAVE"><a style="color:#458bd6!important"><i class="IC-ar-rgt"></i></a> </div></div>'));var quickLinkParent=LVUtil.Form.getFormLayout().find("#LEAVE_QUICK_LINKS"),teamMembersOnLeave=LVUtil.Form.getFormLayout().data("record").extraDetails.dayDetails.teamMembersOnLeave;if(teamMembersOnLeave){quickLinkParent.find("#TEAM_MEMBERS_ON_LEAVE").on("click",Leave.Form.QuickLinks.showTeamMembers);var txt=1==teamMembersOnLeave?ZPI18N.getString("zp.leave.oneemployeeonleave"):ZPI18N.getString("zp.leave.xemployeesonleave",[teamMembersOnLeave+""]);quickLinkParent.find("#TEAM_MEMBERS_ON_LEAVE i").before(txt)}else quickLinkParent.find("#TEAM_MEMBERS_ON_LEAVE").addClass("DN")},showSummary:function(){Leave.Form.QuickListView.init()},showTeamMembers:function(){Leave.Form.TeamMembersOnLeave.init()}},Summary:{init:function(data){if(0==LVUtil.Form.getFormLayout().find(".lveble#CURRENT_LEAVETYPE_INFO").length){var container="<div class='lveble' id='CURRENT_LEAVETYPE_INFO' style='display:none'><div class=\"lveblelst\" id=\"bradford_summary\"></div><div class='lveblelst' id='ZP_LEAVE_ADVANCED_SUMMARY'>"+'<div class="lveble_txtlst"><span class="lveble_txt"><b id="ZP_LEAVE_RANGE"></b></span><span class="lveble_day"><b id="ZP_LEAVE_UNIT"></b></span></div><div class="lveble_txtlst"><span class="lveble_txt">'+ZPI18N.getString("zp.leavetype.v2.entitlement.openbalance")+'</span><span class="lveble_day" id="YEARSTARTINGBALANCE"></span></div><div class="lveble_txtlst"><span class="lveble_txt">'+ZPI18N.getString("zp.leave.entity.accruedtill",[""])+' <em id="ZP_LEAVE_DATE"></em></span><span class="lveble_day" id="ACCRUEDTILLDATE"></span></div><div class="lveble_txtlst"><span class="lveble_txt">'+ZPI18N.getString("zp.leave.entity.totalbalance")+'</span><span class="lveble_day" id="YSB_PLUS_ATD"></span></div><div class="lveble_txtlst"><span class="lveble_txt">'+ZPI18N.getString("zp.leave.entity.leavetakentill",[""])+' <em id="ZP_LEAVE_DATE"></em></span><span class="lveble_day" id="AVAILEDTILLDATE"></span></div></div><div class=\'lveblelst\' id=\'ZP_LEAVE_BASIC_SUMMARY\'><div class="lveble_txtlst"><span class="lveble_txt"><b>'+ZPI18N.getString("zp.leave.entity.header.asof",[""])+' <em id="ZP_LEAVE_DATE"></em></b></span></div><div class="lveble_txtlst"><span class="lveble_txt">'+ZPI18N.getString("zp.leave.entity.availablebalance")+'</span><span class="lveble_day" id="CURRENTBALANCE"></span></div><div class="lveble_txtlst"><span class="lveble_txt">'+ZPI18N.getString("zp.leave.entity.currentbooking")+'</span><span class="lveble_day" id="CURRENTBOOKING"></span></div><div class="lveble_txtlst lnkhvrtxt" id="ZP_LEAVE_VIEW_TRANSACTIONS" onclick="Leave.Form.Summary.loadTransactions()"><span class="lveble_txt">'+ZPI18N.getString("zp.leave.entity.balanceafterbooking",["",""])+'</span><span class="lveble_day" id="BALANCE_AFTER_BOOKING"></span></div></div><div class=\'lveblelst\' id=\'ZP_LEAVE_YEAR_END_SUMMARY\'><div class="lveble_txtlst"><span class="lveble_txt"><b>'+ZPI18N.getString("zp.leave.entity.header.asof",[""])+' <em id="ZP_LEAVE_YEAR"></em></b></span></div><div class="lveble_txtlst"><span class="lveble_txt">'+ZPI18N.getString("zp.leave.entity.endestimate")+'</span><span class="lveble_day" id="YEARENDBALANCE"></span></div></div></div>';LVUtil.Form.getFormLayout().find("#LEAVE_QUICK_LINKS").length>0?LVUtil.Form.getFormLayout().find("#LEAVE_QUICK_LINKS").after($(container)):$(LVUtil.Form.getFormLayout().find(".row").children(".col-sm-6")[0]).after($(container))}data.reportsummary||data.bradford_summary?(this.load(data),LVUtil.Form.getFormLayout().find(".lveble#CURRENT_LEAVETYPE_INFO").fadeIn("fast")):LVUtil.Form.getFormLayout().find(".lveble#CURRENT_LEAVETYPE_INFO").hide()},loadHeaders:function(reportSummary){var summaryContainer=LVUtil.Form.getFormLayout().find(".lveble#CURRENT_LEAVETYPE_INFO");if(reportSummary.hasOwnProperty("showAdvancedInfo")&&!reportSummary.showAdvancedInfo){summaryContainer.find("#ZP_LEAVE_ADVANCED_SUMMARY").hide();var basicSummaryHeader=$(summaryContainer.find("#ZP_LEAVE_BASIC_SUMMARY").find(".lveble_txtlst")[0]);0==basicSummaryHeader.find(".lveble_day").length&&basicSummaryHeader.append('<span class="lveble_day"><b id="ZP_LEAVE_UNIT"></b></span>')}reportSummary.hasOwnProperty("IS_ACCUMULATED_BALANCE")&&reportSummary.IS_ACCUMULATED_BALANCE&&(summaryContainer.find("#ACCRUEDTILLDATE").siblings(".lveble_txt").text(ZPI18N.getString("zp.leave.entity.accruedsofar")),summaryContainer.find("#AVAILEDTILLDATE").attr("id","AVAILED_PRESET_AND_FUTURE"),summaryContainer.find("#AVAILED_PRESET_AND_FUTURE").siblings(".lveble_txt").text(ZPI18N.getString("zp.leave.entity.totaltaken")),summaryContainer.find("#ZP_LEAVE_YEAR_END_SUMMARY").hide()),reportSummary.YEAR_START&&reportSummary.YEAR_END&&summaryContainer.find("#ZP_LEAVE_RANGE").text(reportSummary.YEAR_START+" "+ZPI18N.getString("zp.sto")+" "+reportSummary.YEAR_END),reportSummary.LEAVE_DATE&&summaryContainer.find("em#ZP_LEAVE_DATE").text(reportSummary.LEAVE_DATE),reportSummary.YEAR_END&&summaryContainer.find("#ZP_LEAVE_YEAR").html(reportSummary.YEAR_END),reportSummary.UNIT_TXT&&summaryContainer.find("b#ZP_LEAVE_UNIT").text(reportSummary.UNIT_TXT),reportSummary.hasOwnProperty("CHANGESINPOLICY")&&(0==reportSummary.CHANGESINPOLICY?summaryContainer.find("div#ZP_LEAVE_CHANGESINPOLICY").addClass("DNI"):summaryContainer.find("div#ZP_LEAVE_CHANGESINPOLICY").removeClass("DNI")),reportSummary.hasOwnProperty("IS_ALLOWED_TO_VIEW_TRANSACTIONS")&&(reportSummary.IS_ALLOWED_TO_VIEW_TRANSACTIONS?(summaryContainer.find("div#ZP_LEAVE_VIEW_TRANSACTIONS").addClass("lnkhvrtxt"),summaryContainer.find("span#BALANCE_AFTER_BOOKING").addClass("CP")):(summaryContainer.find("div#ZP_LEAVE_VIEW_TRANSACTIONS").removeClass("lnkhvrtxt"),summaryContainer.find("span#BALANCE_AFTER_BOOKING").removeClass("CP")))},loadBradford:function(bradford_details){var bradfordSummaryEle=LVUtil.Form.getFormLayout().find(".lveble#CURRENT_LEAVETYPE_INFO").find(".lveblelst#bradford_summary");bradfordSummaryEle.html(""),bradfordSummaryEle.append('<div class="lveble_txtlst"><span class="lveble_txt"><b>'+ZPI18N.getString("zp.bradfordfactor.bradfordscore")+'</b> <span class="timelg-dot DI">.</span> <span class="S12 dgry">'+bradford_details.from+" - "+bradford_details.to+'</span></span></div><div class="lveble_txtlst"><span class="lveble_txt">'+bradford_details.settingName+'</span><span class="lveble_day"><b>'+bradford_details.projected_score+'</b> <span class="dgry ML5">('+ZPI18N.getString("zp.Level")+" "+bradford_details.projected_level+")</span></span></div>"),bradfordSummaryEle.show()},load:function(data,isRefresh){var summaryContainer=LVUtil.Form.getFormLayout().find(".lveble#CURRENT_LEAVETYPE_INFO");if(summaryContainer.data("data",data),isRefresh||summaryContainer.find(".lveblelst").hide(),data.reportsummary){var reportSummary=data.reportsummary;for(var key in isRefresh||summaryContainer.find(".lveblelst[id!='bradford_summary']").show(),this.loadHeaders(reportSummary),reportSummary)if(value=reportSummary[key],""==summaryContainer.find("#"+key).text().trim())summaryContainer.find("#"+key).text(value),value<0?summaryContainer.find("#"+key).addClass("red"):summaryContainer.find("#"+key).removeClass("red");else{var existingVal=parseFloat(summaryContainer.find("#"+key).text()),newVal=parseFloat(value);Math.abs(newVal-existingVal)>0&&(summaryContainer.find("#"+key).hide().text(newVal).fadeIn(200),newVal<0?summaryContainer.find("#"+key).addClass("red"):summaryContainer.find("#"+key).removeClass("red"))}LVUtil.Form.getFormLayout().find("#lopnote").remove(),reportSummary.LOP_IN_CURRENTBOOKING&&reportSummary.LOP_IN_CURRENTBOOKING>0&&LVUtil.Form.getFormLayout().find("#zp_formleave_daylist").append($('<div id="lopnote" class="label-message label-note lvavalnote"><p class="S13">'+ZPI18N.getString("zp.leave.apply.info.lop2",[reportSummary.LOP_IN_CURRENTBOOKING+" "+Leave.Util.getDispUnit(reportSummary.LOP_IN_CURRENTBOOKING,reportSummary.UNIT)])+"</p></div>"))}data.bradford_summary&&data.bradford_summary.success&&(summaryContainer.data("bradford_summary",data),this.loadBradford(data.bradford_summary.bradford_details))},refresh:function(){this.refreshReportSummary(),this.refreshBradfordSummary()},refreshReportSummary:function(){var params={employee:LVUtil.Form.getFormLayout().find("[name=Employee_ID]").val(),leavetype:LVUtil.Form.getFormLayout().find("[name=Leavetype]").val(),from:LVUtil.Form.getFormLayout().find("[name=From]").val(),to:LVUtil.Form.getFormLayout().find("[name=To]").val()};LVUtil.Form.isEditMode()&&(params.rec_id=LVUtil.Form.getCurrFormParam().recordId),Leave.Form.getDayDetailsForParam(LVUtil.Form.getFormLayout(),params,!0);params.Daystaken;delete params.Daystaken,delete params.isDayBased,ZPeople.Request.send("leave_common_action.zp",{key:"getPreview",previewParams:JSON.stringify(params)},function(data){data&&data.reportsummary&&Leave.Form.Summary.load(data,!0)})},refreshBradfordSummary:function(){var summaryContainer=LVUtil.Form.getFormLayout().find(".lveble#CURRENT_LEAVETYPE_INFO");if(0!==summaryContainer.length){var data=summaryContainer.data("bradford_summary");if(data&&data.bradford_summary&&data.bradford_summary.success){var bradford_details=JSON.parse(JSON.stringify(data.bradford_summary.bradford_details)),att_day_hours=data.bradford_summary.att_day_hours,params={};Leave.Form.getDayDetailsForParam(LVUtil.Form.getFormLayout(),params,!0);var no_of_instances=bradford_details.no_of_instances,no_of_days=bradford_details.no_of_days,loc_no_of_days=0,isHour=params.isHour,isDayBased=params.isDayBased;$.each(params,function(key){if(ZPUtil.Validation.isDate(key)){var cnt=parseFloat(params[key].count);att_day_hours[key]?loc_no_of_days+=!isDayBased||isDayBased&&isHour?cnt/att_day_hours[key]:cnt:loc_no_of_days+=1}}),bradford_details.projected_no_of_instances=no_of_instances+(!LVUtil.Form.isEditMode()||LVUtil.Form.isEditMode()&&no_of_instances!==bradford_details.projected_no_of_instances?1:0),bradford_details.projected_no_of_days=no_of_days+loc_no_of_days,bradford_details.projected_score=this.computeBradfordScore(bradford_details.projected_no_of_instances,bradford_details.projected_no_of_days);var bradfordLevels=bradford_details.empBradfordLevels?bradford_details.empBradfordLevels:bradford_details.bradfordLevels;bradford_details.projected_level=this.getEmployeeBradfordLevel(bradfordLevels,bradford_details.projected_score),this.loadBradford(bradford_details)}}},computeBradfordScore:function(instances,days){return(instances*instances*days).toFixed(2)},getEmployeeBradfordLevel:function(bradfordLevels,bradford_score){for(var prev_threshold=0,prev_level=0,i=0;i<bradfordLevels.length;i++){var levelJson=bradfordLevels[i],curr_threshold=levelJson.threshold;if(bradford_score>(prev_threshold=0==i?-1:prev_threshold)&&bradford_score<=curr_threshold)return levelJson.level;prev_threshold=curr_threshold,prev_level=levelJson.level}return prev_level+1},getOdometerSpecs:function(diff){var increment=1,msPerFrame=1;return diff>=1?(increment=1,diff>50?(increment=parseInt(diff/50)+1,msPerFrame=1):msPerFrame=parseInt(300/diff)):(increment=1/diff,msPerFrame=parseInt(100/(1/diff))),{increment:increment,msPerFrame:msPerFrame=Math.max(msPerFrame,1)}},odometer:function(id,msPerFrame,isInit){setTimeout(function(){var summaryContainer=LVUtil.Form.getFormLayout().find(".lveble#CURRENT_LEAVETYPE_INFO"),curVal=parseFloat(summaryContainer.find("#"+id).text()),existingValue=parseFloat(summaryContainer.find("#"+id).data("existingValue")),newVal=parseFloat(summaryContainer.find("#"+id).data("newValue")),newValDec=-1!=(newVal+"").indexOf(".")?(newVal+"").split(".")[1].length:0,curValDec=-1!=(curVal+"").indexOf(".")?(curVal+"").split(".")[1].length:0,numOfDecimals=Math.max(newValDec,curValDec),diff=Math.abs(newVal-curVal);if(diff>0){var specs=Leave.Form.Summary.getOdometerSpecs(diff);existingValue<newVal?curVal<newVal?(summaryContainer.find("#"+id).text(parseFloat(curVal+specs.increment).toFixed(numOfDecimals)),parseFloat(summaryContainer.find("#"+id).text())<0?summaryContainer.find("#"+id).addClass("red"):summaryContainer.find("#"+id).removeClass("red"),Leave.Form.Summary.odometer(id,msPerFrame)):(summaryContainer.find("#"+id).text(newVal),parseFloat(summaryContainer.find("#"+id).text())<0?summaryContainer.find("#"+id).addClass("red"):summaryContainer.find("#"+id).removeClass("red")):curVal>newVal?(summaryContainer.find("#"+id).text(parseFloat(curVal-specs.increment).toFixed(numOfDecimals)),parseFloat(summaryContainer.find("#"+id).text())<0?summaryContainer.find("#"+id).addClass("red"):summaryContainer.find("#"+id).removeClass("red"),Leave.Form.Summary.odometer(id,msPerFrame)):(summaryContainer.find("#"+id).text(newVal),parseFloat(summaryContainer.find("#"+id).text())<0?summaryContainer.find("#"+id).addClass("red"):summaryContainer.find("#"+id).removeClass("red"))}},isInit?1:msPerFrame)},loadTransactions:function(){var data=LVUtil.Form.getFormLayout().find(".lveble#CURRENT_LEAVETYPE_INFO").data("data");if(data.transactions){var modal=ZPeople.BSModal.setup({id:"ZP_ApplyLeave_Transaction",type:2,header:ZPI18N.getString("zp.leave.entity.balanceafterbooking",["",""]),body:'<div class="table-responsive"><table class="table table-hover Tlis" style="display: table;"><thead><tr class="TblGryBg"><th class="PL20I" style="width:25%">'+ZPI18N.getString("zp.date")+'</th><th style="width:25%">'+ZPI18N.getString("zp.type")+'</th><th style="width:15%">'+ZPI18N.getString("zp.added")+'</th><th style="width:15%">'+ZPI18N.getString("zp.Used")+'</th><th style="width:15%">'+ZPI18N.getString("zp.leave.view.balance")+"</th></tr></thead><tbody></tbody></table></div>",modalClass:"modal popRgtModel PopSmModel",bodyClass:"P0I",footer:'<div class="modal-footer text-left"></div>',closeonEsc:!0,deleteOnHide:!0}),tbody=modal.find("tbody"),transactions=data.transactions,showEntriesAsDisabled=!1;$.each(transactions,function(indx,obj){var tr=ZP.create("tr",{class:"ZPLRow "+(showEntriesAsDisabled||obj.isArchive?"dgry":obj.isCurrentBooking?"hvrtbleactve":"")});tr.appendChild(ZP.create("td",{class:"PL20I",style:"font-size: 13px;",text:obj.date}));var added="-",used="-",runningbalance="-";obj.isArchive||(added=obj.added?parseFloat(obj.added):0,used=obj.used?parseFloat(obj.used):0,runningbalance=obj.runningbalance?parseFloat(obj.runningbalance):0,added=added%1==0?parseInt(added):added,used=used%1==0?parseInt(used):used,runningbalance=runningbalance%1==0?parseInt(runningbalance):runningbalance,added=0==added?"-":added,used=0==used?"-":used),obj.isEmpExitEntry?(tr.appendChild(ZP.create("td",{style:"font-size: 13px;",text:ZPI18N.getString("zp.leave.transaction.employeeexited")})),showEntriesAsDisabled=!0):tr.appendChild(ZP.create("td",{style:"font-size: 13px;",text:obj.isCurrentBooking?ZPI18N.getString("zp.leave.entity.currentbooking"):Leave.Policy.ENTRYTYPE.get(obj.type,obj.isArchive)})),tr.appendChild(ZP.create("td",{style:"font-size: 13px;",text:added})),tr.appendChild(ZP.create("td",{style:"font-size: 13px;",text:used})),tr.appendChild(ZP.create("td",{style:"font-size: 13px;",text:runningbalance})),tbody.append(tr)}),modal.modal("show")}}},showHideLeaveBalance:function(){if(LVUtil.Form.getFormLayout().data("report")&&!LVUtil.Form.isViewMode()){var leaveForm=$("Form#zp_form_container",Layout.Page.container),employee=$("[name=Employee_ID]",leaveForm),leavetype=$("select[name=Leavetype]",leaveForm),from=$("input[name=From]",leaveForm),balanceNote=$("span#balancealert",leaveForm),report=LVUtil.Form.getFormLayout().data("report").leavetypes;if(ZPUtil.Validation.isEmpty(employee.val())||ZPUtil.Validation.isEmpty(leavetype.val()))balanceNote.parents("#available").addClass("DN");else for(var indx in balanceNote.parents("#available").removeClass("DN"),report){var obj=report[indx];if(obj.leavetypeid==leavetype.val()){if(!obj.isV2&&obj.hasOwnProperty("available")){var unit="";if(4==obj.type&&obj.isV2){unit=obj.isAppliedInHours?ZPI18N.getString("zp.hours"):ZPI18N.getString("zp.days");var balance=obj.isAppliedInHours?obj.availableInHours:obj.availableInDays;ZPUtil.Validation.isEmpty(from.val())&&balanceNote.text(balance+" "+unit),balanceNote.data("availableInDays",obj.availableInDays+" "+ZPI18N.getString("zp.days")),balanceNote.data("availableInHours",obj.availableInHours+" "+ZPI18N.getString("zp.hours"))}else unit=obj.isdayleave?ZPI18N.getString("zp.days"):ZPI18N.getString("zp.hours"),(!obj.isV2||ZPUtil.Validation.isEmpty(from.val()))&&balanceNote.text(obj.available+" "+unit);balanceNote.data("unit",unit)}else balanceNote.parents("#available").addClass("DN");break}}}},showCompensatedDate:function(dayDetails){if(dayDetails.hasOwnProperty("mappedDates")&&dayDetails.mappedDates.length>0){var dates=dayDetails.mappedDates,daydetails=$("#zp_formleave_daylist",LVUtil.Form.getFormLayout()),lookup="";ZPeople.isZPNewUI()?(daydetails=$("#leaveDays",LVUtil.Form.getFormLayout()),lookup='<div class="zp-label" id="comp_view" style="border-bottom:none;"><label class="zplt-label">'+ZPI18N.getString("zp.leave.compensatory.compensatedwith",[""])+'</label><div class="zprt-label"><div class="CRmain" id="compensated_dates"></div></div></div></div>'):lookup='<div class="form-group" id="comp_view"><label class="control-label col-sm-3">'+ZPI18N.getString("zp.leave.compensatory.compensatedwith",[""])+'</label><div class="col-sm-6"><div class="CRmain" id="compensated_dates"></div></div></div>',daydetails.before($(lookup));lookup=$("div#compensated_dates",LVUtil.Form.getFormLayout());$.each(dates,function(indx){var obj=dates[indx],div=ZP.create("div",{class:"CReports",id:obj.id});div.appendChild(ZP.create("span",{class:"CRdate MT0I",text:obj.date})),div.appendChild(ZP.create("span",{class:"CRdays",text:obj.taken})),lookup.append(div)})}},createCompOffLookup:function(show){var leaveForm=$("Form#zp_form_container",Layout.Page.container),isnewUI=ZPeople.isZPNewUI();if($("div#comp_view",leaveForm).remove(),!$("div#compofflookup",leaveForm).data("isreg")){var main_class=isnewUI?"zp-label zp-multi-2":"form-group",lft_lable=isnewUI?"zplt-label":"control-label col-sm-3",rt_lable=isnewUI?"zprt-label":"col-sm-6",daydetails=$("#leaveDays",LVUtil.Form.getFormLayout()),lookup='<div class="'+main_class+" "+(show?"":"DN")+'" id="compofflookup"><label class="'+lft_lable+'">'+ZPI18N.getString("zp.leave.compensatory.compensatewith",[""])+'</label><div class="'+rt_lable+'"><div class="CRmain" id="worked_date"></div><div class="MT5 dgry DN" id="noOptions">'+ZPI18N.getString("zp.lookup.norecfound")+"</div></div></div>";LVUtil.Form.getCurrFormParam().modalPopupView&&(lookup='<div class="'+main_class+" "+(show?"":"DN")+'" id="compofflookup"><label class="'+lft_lable+'">'+ZPI18N.getString("zp.leave.compensatory.compensatewith",[""])+'</label><div class="col-sm-7"><div class="CRmain" id="worked_date"></div><div class="MT5 dgry DN" id="noOptions">'+ZPI18N.getString("zp.lookup.norecfound")+"</div></div></div>"),daydetails.before($(lookup)),$("#compofflookup",LVUtil.Form.getFormLayout()).data("isreg",!0);lookup=$("div#worked_date",LVUtil.Form.getFormLayout());$(lookup).on("click","div.CReports",function(){$(this).hasClass("active")?$(this).removeClass("active"):$(this).addClass("active")})}},populateCompoffLookup:function(bookable,show){Leave.Form.createCompOffLookup(show);var field=$("#compofflookup",LVUtil.Form.getFormLayout()),lookup=$("div#worked_date",LVUtil.Form.getFormLayout());lookup.html(""),$.each(bookable,function(indx){var obj=bookable[indx],div=ZP.create("div",{class:"CReports CP "+(obj.isMapped?"active":""),id:obj.id});div.appendChild(ZP.create("span",{class:"CRdate",text:obj.date})),div.appendChild(ZP.create("span",{class:"CRdays",text:obj.balance})),lookup.append(div)}),0==bookable.length?field.find("#noOptions").removeClass("DN"):field.find("#noOptions").addClass("DN")},showHideApplyDates:function(ltypeId){try{var applyDateDiv=$("div#applyDates",LVUtil.Form.getFormLayout()),applyDateslabel=$("div#applyDateslabel",LVUtil.Form.getFormLayout()),ul=applyDateDiv.find("ul").empty(),ltypeObj=_.find(LVUtil.Form.getFormLayout().data("report").leavetypes,function(obj){return obj.leavetypeid==ltypeId});if(ltypeObj&&ltypeObj.applyDateFields){var applyDateFields=ltypeObj.applyDateFields,applyDates=LVUtil.Form.getFormLayout().data("applyDates");-1!=applyDateFields.indexOf("1")&&(applyDateFields=_.without(applyDateFields,"1")).push("1"),applyDateFields.forEach(function(val){if("1"==val){var rh=applyDates.RH;$.each(rh,function(indx){var obj=rh[indx],li=ZP.create("li",{date:obj.date}),outer=ZP.create("div",{class:"inr_div"}),tic=ZP.create("i",{class:"IC-tick"}),name=ZP.create("b",{text:obj.name}),date=ZP.create("span",{text:"("+obj.date+")"});outer.appendChild(tic),outer.appendChild(name),outer.appendChild(date),li.appendChild(outer),ul.append(li)})}else if(applyDates[val]){var field=applyDates[val],li=ZP.create("li",{date:field.date}),outer=ZP.create("div",{class:"inr_div"}),tic=ZP.create("i",{class:"IC-tick"}),name=ZP.create("b",{text:field.name}),date=ZP.create("span",{text:"("+field.date+")"});outer.appendChild(tic),outer.appendChild(name),outer.appendChild(date),li.appendChild(outer),ul.append(li)}})}0==(ul=$(ul)).find("li").length?(applyDateDiv.hide(),applyDateslabel.hide()):(ul.find("li").on("click",function(){$(this).parent("ul").children("li").removeClass("actv");var date=$(this).attr("date");LVUtil.Form.getFormLayout().find('[name="To"]').val(date),LVUtil.Form.getFormLayout().find('[name="From"]').val(date).change(),$(this).addClass("actv")}),applyDateDiv.fadeIn("100"),applyDateslabel.fadeIn("100"))}catch(e){return}},createUnitSelectField:function(isHour){if(!$("div#leaveunitSelect",LVUtil.Form.getFormLayout()).data("isreg")){$("#zp_formleave_daylist",LVUtil.Form.getFormLayout());var ltype=$("[folabel=Leavetype]",LVUtil.Form.getFormLayout()),field='<div id="leaveunitSelect"><select class="W100A DIB" name="leaveunit" onchange="Leave.Form.switchUnit(this)"><option value="day">'+ZPI18N.getString("zp.day.plural")+'</option><option value="hour">'+ZPI18N.getString("zp.hourslog")+"</option></select></div>";ltype.after($(field)),$("[name=leaveunit]",LVUtil.Form.getFormLayout()).select2({minimumResultsForSearch:1/0});var unitSelect=ltype.siblings("div#leaveunitSelect");unitSelect.data("isreg",!0),isHour?unitSelect.find("select").select2("val","hour"):unitSelect.find("select").select2("val","day")}},ShowHideUnitField:function(show,isHour,onlyHour){if(show){if($("[name=leaveunit]",LVUtil.Form.getFormLayout()).data("isreg"))return $("#leaveunitSelect",LVUtil.Form.getFormLayout()).css("display",onlyHour?"none":"inline"),onlyHour?$("select[name=leaveunit]",LVUtil.Form.getFormLayout()).attr("disabled","true"):$("select[name=leaveunit]",LVUtil.Form.getFormLayout()).prop("disabled",!1),void(isHour?$("[name=leaveunit]").select2("val","hour").trigger("change"):$("[name=leaveunit]").select2("val","day"));var ltype=$("[folabel=Leavetype]",LVUtil.Form.getFormLayout()),field='<div id="leaveunitSelect" style="display:'+(onlyHour?"none":"inline")+'"><select class="select-opt2"'+(onlyHour?'disabled="true"':"")+' id="#leaveunitSelect" name="leaveunit" onchange="Leave.Form.switchUnit(this)">'+(onlyHour?"":'<option value="day">'+ZPI18N.getString("zp.day.plural")+"</option>")+'<option value="hour">'+ZPI18N.getString("zp.hourslog")+"</option></select></div>";ltype.append($(field)).find("[name=Leavetype]").addClass("select-opt1").select2(),$("[name=leaveunit]",LVUtil.Form.getFormLayout()).data("isreg",!0).select2({minimumResultsForSearch:1/0}),ltype.parent(".zp-label").addClass("zp-leave-col2"),isHour?$("[name=leaveunit]").select2("val","hour").trigger("change"):$("[name=leaveunit]").select2("val","day")}else $("#leaveunitSelect,#s2id_#leaveunitSelect",LVUtil.Form.getFormLayout()).hide(),$("[folabel=Leavetype]",LVUtil.Form.getFormLayout()).parent(".zp-label").removeClass("zp-leave-col2")},showHideTimeInputByField:function(show){var ltype=$("[id=leavetimeinputby]",LVUtil.Form.getFormLayout()),obj=ltype.find("input[type='radio']"),isAnythgSlted=!1;if(obj.length>0)for(var i=0;i<obj.length;i++)$(obj[i]).is(":checked")&&(isAnythgSlted=!0);show?(ltype.show(),isAnythgSlted||ltype.find("[name='startendhour']").prop("checked",!0)):(ltype.hide(),ltype.find("input").prop("checked",!1))},getTimeInputType:function(){var ltype=$("[id=leavetimeinputby]",LVUtil.Form.getFormLayout());return ltype.find("[name='startendhour']").is(":checked")&&!ltype.find("[name='startendtime']").is(":checked")?1:!ltype.find("[name='startendhour']").is(":checked")&&ltype.find("[name='startendtime']").is(":checked")?2:1},switchTimeinputUnit:function(Obj){var ltype=$("[id=leavetimeinputby]",LVUtil.Form.getFormLayout());"startendtime"==$(Obj).attr("name")?ltype.find("[name='startendhour']").prop("checked",!1):ltype.find("[name='startendtime']").prop("checked",!1),Leave.Form.switchUnit($("#leaveunitSelect",LVUtil.Form.getFormLayout()).find("[name='leaveunit']"))},isDayAndHourAllowed:function(ltypeId,ltData){return ltData&&_.filter(ltData.Options,function(opt){return opt.Id==ltypeId&&opt.isDayAndHourAllowed}).length>0},isHourly:function(ltypeId,ltData){return ltData&&_.filter(ltData.Options,function(opt){return opt.Id==ltypeId&&opt.isHourly}).length>0},switchUnit:function(ele){var value=$(ele).val(),daydetails=$("#zp_formleave_daylist",LVUtil.Form.getFormLayout()),dataObj=daydetails.data("details");if("day"==value)Leave.Form.showHideTimeInputByField(!1),daydetails.find("div.row").each(function(){0==$(this).find("input").length&&(2==$(this).find("div.progress-bar").length?$(this).find("div.progress-bar:nth-child(2)").css({width:"50%"}):$(this).find("div.progress-bar").css({width:"100%"}))}),daydetails.find(".dayinput").removeClass("DN"),daydetails.find(".hourinput").addClass("DN"),daydetails.find(".fromToTime").addClass("DN").removeClass("DIB"),daydetails.find(".ttlhrs").addClass("DN"),dataObj&&(dataObj.isDayBased=!0);else{Leave.Form.showHideTimeInputByField(!0);var timeInputType=Leave.Form.getTimeInputType();daydetails.find(".hourinput").each(function(){$(this).find("input").trigger("change")}),1==timeInputType?(daydetails.find(".choose-leave-type").find(".row").removeClass("fmtorw"),daydetails.find(".choose-leave-type").find(".row").find("#dtDiv").addClass("col-sm-4"),daydetails.find(".choose-leave-type").find(".row").find("#dtDiv").removeClass("col-sm-8"),daydetails.find(".choose-leave-type").find("[id='div2_dropdown']").removeClass("DN"),daydetails.find(".hourinput").removeClass("DN"),daydetails.find(".fromToTime").addClass("DN").removeClass("DIB"),daydetails.find(".ttlhrs").addClass("DN")):(daydetails.find(".choose-leave-type").find(".row").addClass("fmtorw"),daydetails.find(".choose-leave-type").find(".row").find("#dtDiv").addClass("col-sm-8"),daydetails.find(".choose-leave-type").find(".row").find("#dtDiv").removeClass("col-sm-4"),daydetails.find(".choose-leave-type").find("[id='div2_dropdown']").addClass("DN"),daydetails.find(".fromToTime").removeClass("DN").addClass("DIB"),daydetails.find(".hourinput").addClass("DN"),daydetails.find(".ttlhrs").removeClass("DN")),daydetails.find(".dayinput").addClass("DN"),dataObj&&(dataObj.isDayBased=!1)}dataObj&&(Leave.Util.updateTotal(),Leave.Form.Summary.refresh());var balanceNote=$("span#balancealert",LVUtil.Form.getFormLayout()),ltData=LVUtil.Form.getFormLayout().data("leavetypedata");ltData&&(LVUtil.Form.getFormLayout().find("[name=Leavetype]").val()==ltData.compoffLeave&&balanceNote.text(balanceNote.data("day"==value?"availableInDays":"availableInHours")));LVUtil.urls.CompOff.isBook()&&dataObj&&Leave.Form.switchCompoffMessage(dataObj,value)},switchCompoffMessage:function(dataObj,unit){var leaveForm=$("Form#zp_form_container",Layout.Page.container),daydetails=$("#zp_formleave_daylist",LVUtil.Form.getFormLayout()),ishour=$("input[name=From]",leaveForm).data("isHourType"),avail=$("input[name=From]",leaveForm).data("duration"),expiry=$("input[name=From]",leaveForm).data("expiry"),fullday=dataObj.dateArr[0].max_mins?dataObj.dateArr[0].max_mins:480,duration="",unitTxt="";if("day"==unit)duration=ishour?(avail/fullday).toFixed(2):avail,unitTxt=ZPI18N.getString("zp.leavetype.daysinfo");else{var mins=(avail=ishour?avail:(avail*fullday).toFixed(2))>fullday?fullday:avail,defaultvalue=Leave.Util.convertToHoursandMinutes(parseInt(mins));daydetails.find("input.picker").timepicker("remove"),daydetails.find("input.picker").timepicker({maxHours:parseInt(mins/60)+1,showMeridian:!1}),daydetails.find("input.picker").val(defaultvalue).trigger("change"),duration=Leave.Util.convertToHoursandMinutes(parseInt(avail)),unitTxt=ZPI18N.getString("zp.shours")}dataObj.message=ZPI18N.getString("zp.leave.apply.info.bookcompoff",[duration+" "+unitTxt,expiry]),LVUtil.Form.getFormLayout().find("em#info_message").html(dataObj.message)},getDetails:function(){var leaveForm=$("Form#zp_form_container",Layout.Page.container),employee=$("[name=Employee_ID]",leaveForm),leavetype=$("select[name=Leavetype]",leaveForm),from=$("input[name=From]",leaveForm),to=$("input[name=To]",leaveForm),errors=$(".zp-err-msg,.ERR",leaveForm);errors.parents(".zp-label.zp-err").removeClass("zp-err"),errors.remove();var leavetypeData=LVUtil.Form.getFormLayout().data("leavetypedata");if($(leavetype).parents("[isconditionfield=true]").length>0&&ZPFRules.evaluateRulesForField(leavetype),$(from).parents("[isconditionfield=true]").length>0&&ZPFRules.evaluateRulesForField(from),$(to).parents("[isconditionfield=true]").length>0&&ZPFRules.evaluateRulesForField(to),ZPUtil.Validation.isEmpty(from.val())&&Leave.Form.showHideLeaveBalance(),ZPUtil.Validation.isEmpty(employee.val())||ZPUtil.Validation.isEmpty(leavetype.val()))Leave.Form.showHideTimeInputByField(!1);else{if(ZPUtil.Validation.isEmpty(from.val())&&Leave.Form.showHideApplyDates(leavetype.val()),LVUtil.Form.isAddMode()&&ZPUtil.Validation.isEmpty(from.val())&&Leave.Form.checkAndSuggestApplyDate(),leavetypeData&&leavetypeData.compoffLeave==leavetype.val()?$("div#compofflookup",leaveForm).removeClass("DN"):$("div#compofflookup",leaveForm).addClass("DN"),Leave.Form.isDayAndHourAllowed(leavetype.val(),leavetypeData)){if(ZPeople.isZPNewUI()){var ltData=LVUtil.Form.getFormLayout().data("leavetypedata"),isCompOff=leavetype.val()==ltData.compoffLeave;Leave.Form.showHideTimeInputByField(!1),Leave.Form.ShowHideUnitField(!0,isCompOff&&ltData.isOnlyHourLeavesAllowed,isCompOff&&ltData.isOnlyHourLeavesAllowed)}else Leave.Form.createUnitSelectField();LVUtil.Form.getCurrFormParam().modalPopupView&&$(leavetype).parent().removeClass("col-sm-9").addClass("col-sm-7")}else LVUtil.Form.getCurrFormParam().modalPopupView&&$(leavetype).parent().removeClass("col-sm-7").addClass("col-sm-9"),$("div#leaveunitSelect",leaveForm).remove(),ZPeople.isZPNewUI()&&Leave.Form.ShowHideUnitField(!1),Leave.Form.isHourly(leavetype.val(),leavetypeData)?ZPeople.isZPNewUI()&&Leave.Form.showHideTimeInputByField(!0):ZPeople.isZPNewUI()&&Leave.Form.showHideTimeInputByField(!1);if(ZPUtil.Validation.isEmpty(from.val())){if(ZPUtil.Validation.isEmpty(from.val())||ZPUtil.Validation.isEmpty(to.val()))return}else{if(ZPUtil.Validation.isEmpty(to.val()))to.val(from.val());else{var fromDate=Calendar.parseDate(from.val(),uidateFormat),toDate=Calendar.parseDate(to.val(),uidateFormat);if(toDate<fromDate&&to.val(from.val()),from.data("expiry")&&Calendar.isvalidDate(from.data("expiry"))){var expiry=Calendar.parseDate(from.data("expiry"),uidateFormat);(fromDate>expiry||toDate>expiry)&&(from.val(Calendar.formatDate(expiry)),to.val(from.val()).trigger("change"))}}if(!ZPUtil.Validation.isDate(from.val())||!ZPUtil.Validation.isDate(to.val()))return}var params={key:"leave_daydetails"};params.employee=employee.val(),params.leavetype=leavetype.val(),params.from=from.val(),params.to=to.val(),1==$("[name=leaveunit]",LVUtil.Form.getFormLayout()).length&&(params.isAppliedInHours="hour"==$("[name=leaveunit]",LVUtil.Form.getFormLayout()).val()),params.rec_id=LVUtil.Form.getCurrFormParam().recordId,params.fetchBradfordSummary=Leave.Util.isBradfordFactorEnabled(),params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(result){if("success"===result.status){if(result.data.dayCntExceeded)return void ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.leave.apply.error.daterangeexceeded"));else if(result.data.dateInvalid)return void ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.validinitaldateval",[dateFmt]));Leave.Form.setDayDetails(result.data)}})}},getRHType:function(){var ltname;if(void 0!=LVUtil.Form.getFormLayout().data("report")){var leaves=LVUtil.Form.getFormLayout().data("report").leavetypes;for(var indx in leaves){var obj=leaves[indx];5==obj.type&&parseFloat(obj.available)>0&&(ltname=obj.name)}return ltname}},setDayDetails:function(dataObj){var isnewUI=ZPeople.isZPNewUI();if(!$.isEmptyObject(dataObj)){var isreg=$(".choose-leave-type",LVUtil.Form.getFormLayout()).children().length,daydetails=$("#zp_formleave_daylist",LVUtil.Form.getFormLayout());daydetails.parent().removeClass("DN"),daydetails.addClass(isnewUI?"zprt-label applied-date MB0I collapse in":"applied-date MB0I col-sm-offset-3"),isnewUI||(LVUtil.Form.getCurrFormParam().modalPopupView?daydetails.removeClass("col-sm-6").addClass("col-sm-9"):daydetails.removeClass("col-sm-6").addClass("col-sm-7")),daydetails.removeClass("DN"),daydetails.data("details",dataObj),daydetails.find(".choose-leave-type , .leave-type-foot").removeClass("DN").html(""),0==isreg&&daydetails.on("change","select[name],input[name]",function(){Leave.Util.updateTotal(),Leave.Util.refreshBtwnHrs(this)});var dateArr=dataObj.dateArr,isDayBased=dataObj.isDayBased,type=1;(isDayBased||dataObj.isDayAndHourAllowed)&&(type=0,dataObj.isHalfDayAllowed&&dataObj.isQuarterDayAllowed?type=3:dataObj.isQuarterDayAllowed&&!dataObj.isHalfDayAllowed?type=1:dataObj.isHalfDayAllowed&&!dataObj.isQuarterDayAllowed?type=2:dataObj.isDayAndHourAllowed&&(type=-1),0==type&&(LVUtil.Form.getCurrFormParam().modalPopupView||LVUtil.Form.getCurrFormParam().isfromProjects?!isnewUI&&daydetails.removeClass("col-sm-9").addClass("col-sm-6"):!isnewUI&&daydetails.removeClass("col-sm-7").addClass("col-sm-6")));var temp_doc=document.createDocumentFragment(),timeInputType=Leave.Form.getTimeInputType();for(var indx in dateArr){var dateObj=dateArr[indx];temp_doc.appendChild(Leave.Util.leaveDays.html(dateObj,isDayBased,type,dataObj.isDayAndHourAllowed,dataObj.disableFullDay,timeInputType))}daydetails.find(".choose-leave-type").append(temp_doc);var absentRecId=-1!=Layout.Page.hash.indexOf("convert")&&Layout.Page.childUrlParam.recordId;absentRecId&&LVUtil.Form.getFormLayout().data("absent_"+absentRecId).ishalfday&&daydetails.find("select#periods").each(function(){$(this).find('option[value="0.5"]').length>0&&$(this).val("0.5").trigger("change")}),Leave.Util.leaveDays.lazyLoad(daydetails.find(".choose-leave-type")),LVUtil.Form.getFormLayout().find("div[folabel=ZP_Leave_File_Upload]").data("showFileUploadAfter",dataObj.showFileUploadAfter),daydetails.find(".choose-leave-type").data("leavetaken",dataObj.leavetaken),daydetails.find(".choose-leave-type").data("takenBeforeAfter",dataObj.takenBeforeAfter),Leave.Util.updateTotal(dataObj.daysTaken,type),!LVUtil.Form.isViewMode()&&dataObj.isDayAndHourAllowed&&$("[name=leaveunit]").trigger("change");var unitSelect=$("div#leaveunitSelect",LVUtil.Form.getFormLayout());if(!LVUtil.Form.isViewMode()&&0==isreg&&unitSelect.find("select").trigger("change"),LVUtil.urls.CompOff.isBook()){var ishour=$("input[name=From]",LVUtil.Form.getFormLayout()).data("isHourType");dataObj.isDayAndHourAllowed?0==isreg&&(ishour?unitSelect.find("select").select2("val","hour").trigger("change"):unitSelect.find("select").select2("val","day").trigger("change")):Leave.Form.switchCompoffMessage(dataObj,"day")}else dataObj.isAppliedInHours&&unitSelect.find("select").select2("val","hour").trigger("change");if(daydetails.collapse("show"),!ZPForm.PRINT){if(dataObj.suggestRH){var ltype=Leave.Form.getRHType();ltype&&(dataObj.message=ZPI18N.getString("zp.leave.apply.info.suggestleavetype",[ltype]))}if(dataObj.exceed_count_handling&&!dataObj.exceed_count_handling.hasOwnProperty("exceed_ERROR")){var lop=dataObj.exceed_count_handling.mark_lop_count,curAvail=dataObj.exceed_count_handling.available,balanceNote=$("span#balancealert",LVUtil.Form.getFormLayout());delete dataObj.exceed_count_handling.mark_lop_count,delete dataObj.exceed_count_handling.available;var message="";lop>0&&(message+=ZPI18N.getString("zp.leave.apply.info.lop")),balanceNote.text(curAvail+" "+balanceNote.data("unit")),dataObj.message?dataObj.message2=message:dataObj.message=message}Leave.Form.DayDetailsBalance(dataObj),LVUtil.Form.getCurrFormParam().isfromProjects||Leave.isEmbed||Leave.Form.Summary.init(dataObj)}Leave.Form.setFooter(dataObj)}},DayDetailsBalance:function(dataObj){if(!dataObj.hasOwnProperty("balance")||LVUtil.Form.isViewMode()||LVUtil.urls.CompOff.isBook())LVUtil.Form.getFormLayout().find("#available").addClass("DN");else{var balanceNote=$("span#balancealert",LVUtil.Form.getFormLayout());balanceNote.parents("#available").removeClass("DN");var unit=!dataObj.isDayBased&&!dataObj.isDayAndHourAllowed||4==dataObj.type&&dataObj.isAppliedInHours?ZPI18N.getString("zp.hours"):ZPI18N.getString("zp.days");balanceNote.text(dataObj.balance+" "+unit),balanceNote.data("unit",unit),4==dataObj.type&&(balanceNote.data("availableInDays",dataObj.balanceInDays+" "+ZPI18N.getString("zp.days")),balanceNote.data("availableInHours",dataObj.balanceInHours+" "+ZPI18N.getString("zp.hours")))}},setFooter:function(dataObj){LVUtil.Form.getFormLayout().find(".modal-footer #leaveinfo").remove(),dataObj.message?(LVUtil.Form.getFormLayout().find(".ZPrport").animate({bottom:"150px"},120,function(){}),dataObj.message2?LVUtil.Form.getFormLayout().find(".modal-footer").append('<div class="label-message ZPAltmsg label-note" id="leaveinfo"><p class="S13"><b>'+ZPI18N.getString("zp.note")+'1 :</b>&nbsp;<em id="info_message"> '+dataObj.message+"<br><b>"+ZPI18N.getString("zp.note")+'2 :</b>&nbsp;<em id="info_message"> '+dataObj.message2+"</em></p></div>"):LVUtil.Form.getFormLayout().find(".modal-footer").append('<div class="label-message ZPAltmsg label-note" id="leaveinfo"><p class="S13"><b>'+ZPI18N.getString("zp.note")+' :</b>&nbsp;<em id="info_message"> '+dataObj.message+"</em></p></div>"),LVUtil.Form.getFormLayout().find(".modal-body").addClass("MB30")):(LVUtil.Form.getFormLayout().find(".modal-body").removeClass("MB30"),LVUtil.Form.getFormLayout().find(".ZPrport").animate({bottom:"76px"},120,function(){}))},getDayDetailsForParam:function(formObj,params,skipStringify){var dayDetails=$("#zp_formleave_daylist",formObj),leaveDays=dayDetails.find(".choose-leave-type"),dataObj=dayDetails.data("details"),isDayBased=dataObj.isDayBased,leavetaken=0;leaveDays.find("input[name]:visible,select[name]").length>0?$.each(leaveDays.children(),function(indx,ele){if(isDayBased){var countEle=$($(ele).find("select#periods")),sessionEle=$($(ele).find("select#sessions")),count=countEle.val(),session=sessionEle.val();if(count){var name=countEle.attr("name");params[name]=1==count?skipStringify?{count:1,session:0}:JSON.stringify({count:1,session:0}):skipStringify?{count:count,session:session}:JSON.stringify({count:count,session:session}),leavetaken+=parseFloat(count)}}else{var dataele=$($(ele).find("input[name]:visible"));if(void 0!==(name=dataele.attr("name")))if(dataele.hasClass("fromToTime")){var fromTime=$(ele).find(".fromToTime").find("input#from_time").val(),toTime=$(ele).find(".fromToTime").find("input#to_time").val(),minApplied=Leave.Util.getTimeDiff(fromTime,toTime);params[name]=skipStringify?{count:minApplied,startTime:Leave.Util.convertTimetoMinutes(fromTime),endTime:Leave.Util.convertTimetoMinutes(toTime)}:JSON.stringify({count:minApplied,startTime:Leave.Util.convertTimetoMinutes(fromTime),endTime:Leave.Util.convertTimetoMinutes(toTime)}),leavetaken+=minApplied}else if("from_time"==dataele[0].id&&"time_taken"==dataele[1].id){var stTime=$(ele).find(".hourinput").find("input#from_time").val(),hrs=$(ele).find(".hourinput").find("input#time_taken").val(),edTime=(fromTime=Leave.Util.convertTimetoMinutes(stTime))+Leave.Util.convertHourstoMinutes(hrs);edTime>=1440&&(edTime-=1440);toTime=Leave.Util.convertMinutestoTime(edTime);fromTime=Leave.Util.convertMinutestoTime(fromTime);minApplied=Leave.Util.getTimeDiff(fromTime,toTime);params[name]=skipStringify?{count:minApplied,startTime:Leave.Util.convertTimetoMinutes(fromTime),endTime:Leave.Util.convertTimetoMinutes(toTime)}:JSON.stringify({count:minApplied,startTime:Leave.Util.convertTimetoMinutes(fromTime),endTime:Leave.Util.convertTimetoMinutes(toTime)}),leavetaken+=minApplied}else{var data=dataele.val();if(data){var hourMin=data.split(":"),mins=60*parseInt(hourMin[0])+parseInt(hourMin[1]);params[name]=skipStringify?{count:parseFloat(data)}:JSON.stringify({count:parseFloat(data)}),leavetaken+=mins}}}}):leavetaken=leaveDays.data("leavetaken"),LVUtil.urls.CompOff.isBook()&&(params.compoffId=Layout.Page.hash.split(":")[1]),params.isHour=dataObj.isDayAndHourAllowed&&!isDayBased,params.isDayBased=isDayBased,params.Daystaken=isDayBased?leavetaken:leavetaken/60;var total=isDayBased?leavetaken:Leave.Util.convertToHoursandMinutes(leavetaken),workedDate=$("div#worked_date",formObj);if($(workedDate).is(":visible")){var booked=workedDate.find(".CReports.active"),ids="";$(booked).each(function(){ids+=$(this).attr("id")+","}),ids.length>0&&(params.compoffId=ids)}return total},cancelLeaveWarning:function(){ZPeople.BSModal.setup({id:"zp_confirmation_pop",type:1,header:'<div class="Icn grni"><i class="IC-tick whi S24"></i></div><h4 id="gridSystemModalLabel" class="modal-title">'+ZPI18N.getString("zp.confirm")+"</h4>",body:'<div class="form-group"><p class="text-center MB15">'+ZPI18N.getString("zp.leave.cancelleavewarning")+'</p></div><div class="form-group" id="cancel_reason" style="height:90px"><div class="col-sm-12"><textarea class="form-control ZP-Input mandatory" style="width: 340px;margin: 0 auto;" name="remark" rows="5" placeholder="Reason For Cancellation"></textarea><span class="ERR text-center MT5 DN" id="cancel_reason_error" style="width: 100%;"></span></div></div>',modalClass:"modal fade ZPmdl in",buttonValue:ZPI18N.getString("zp.yes"),successCallback:Leave.Form.cancelLeave,hiddenCallback:ZPApprovals.approveOrRejectActionHidden}).find(".btn-default").text(ZPI18N.getString("zp.no"))},cancelLeave:function(){(params={key:"cancel_leave",id:LVUtil.Form.getCurrFormParam().recordId})[csrfParamName]=csrfToken;var params,reason=Layout.Page.container.find("#cancel_reason textarea").val();if(void 0==ZPeople.Module.isLeaveCancelReasonMandatory&&void 0==ZPeople.Module.MODULE_DATA.leavetracker)return(params={})[csrfParamName]=csrfToken,params.key="is_cancel_reason_mandatory",void $.post("/leave_common_action.zp",params,function(result){ZPeople.Module.isLeaveCancelReasonMandatory=result.isCancelReasonMandatory,Leave.Form.cancelLeave()});!(ZPeople.Module.isLeaveCancelReasonMandatory||ZPeople.Module.MODULE_DATA.leavetracker&&ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isCancelReasonMandatory)||reason&&""!=reason.trim()?reason&&reason.length>250?Layout.Page.container.find("#cancel_reason_error").text(ZPI18N.getString("zp.leave.cancell.error.reasonlength")).removeClass("DN"):(params.reason=reason,Layout.Page.container.find("#cancel_reason_error").addClass("DN"),$.post("/leave_common_action.zp",params,function(result){if("success"===result.status){LVUtil.urls.ListView.isHome()?Leave.View.List.refresh=!0:Leave.View.Calendar.refresh=!0;var recordDtl=ZPForm.getSingleRecord();recordDtl&&(recordDtl.record.approvalDetails&&(recordDtl.record.approvalDetails.canceledRecord=!0,recordDtl.record.approvalDetails&&(recordDtl.record.approvalDetails.canceledRecord=!0)),recordDtl.record.message.approvalStatus=result.approvalStatus.approverDetails?result.approvalStatus.approverDetails.currentApprovalStatus:result.approvalStatus.currentApprovalStatus,2==recordDtl.record.message.approvalStatus?ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.leave.cancelled")):ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.sentapprsuccessmsg"))),ZPForm.Record.cancelRecCBforModule(recordDtl.record.message.approvalStatus,{},recordDtl.record.approvalDetails),LVUtil.Form.toggleFormPage(),Leave.Form.switchToRecView()}else ModuleComp.Msg.showFailureMsg(result.message?result.message:ZPI18N.getString("zp.notallowedtoedit"));var record=LVUtil.Form.getFormLayout().data("record");(record?record.extraDetails:{}).showCancel=!1,ZPeople.BSModal.hide("zp_confirmation_pop")})):Layout.Page.container.find("#cancel_reason_error").text(ZPI18N.getString("zp.leave.cancell.error.providereason")).removeClass("DN")},loadTemplate:function(){var formObj=$("<form id='ZPLeave_exp_form' action='leave_common_action.zp' method='post' target='exportresp1' style='display:none'/>").html("");formObj.append('<input type="hidden" value="'+csrfToken+'" name="conreqcsr"/>'),formObj.append('<input type="hidden" value="import_template" name="key"/>'),$("body").append(formObj),formObj.trigger("submit")}},Leave.Compensatory={refresh:!0,recordData:{},initPage:function(){LVUtil.Tab.InitPage(Leave.Compensatory.init,!1)},init:function(){LVUtil.urls.CompOff.isHome()?(Leave.Util.reg(),Leave.Util.regFooter(),Leave.Compensatory.View.get(),Leave.Compensatory.refresh=!1):LVUtil.urls.CompOff.isAdd()?Leave.Compensatory.Add.html():LVUtil.urls.CompOff.isEdit()?Leave.Compensatory.Edit.get():LVUtil.urls.CompOff.isView()?Leave.Compensatory.RecordView.get():LVUtil.urls.CompOff.isBook()&&Leave.Compensatory.bookCompOff()},bookCompOff:function(){let form_json={formId:ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.formid,fieldCallback:{From:Leave.Form.getDetails},fieldFormat:["Employee_ID","Leavetype","From","To","Daystaken","TeamEmailID","Reasonforleave"],tableName:"P_EmployeeLeave",onloadCallback:function(){Leave.hideApproval(),Leave.Form.getCompOffDetails()},callback:function(){Leave.Compensatory.refresh=!0,Leave.Compensatory.View.changeUrl()}};LVUtil.Form.loadForm(form_json)},changeViewEditURL:function(ele){var rec_id=$(ele).closest("tr").data("id");"viewOpt"==ele.id?window.location.href=LVUtil.urls.CompOff.VIEW()+":"+rec_id:window.location.href=LVUtil.urls.CompOff.EDIT()+":"+rec_id},View:{changeUrl:function(){Leave.Util.isLeavePage()?(Leave.Compensatory.recordData={},window.location.href=LVUtil.urls.CompOff.HOME()):-1!==Layout.Page.hash.indexOf("#approvals/myapproval")?window.location.href="#approvals/myapproval":-1!==Layout.Page.hash.indexOf("#approvals/myrequest")&&(window.location.href="#approvals/myrequest")},get:function(){var params={key:"compensatory_view"};ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.compApprovalEnabled?params.status=Layout.Page.container.find("select[name=status]").val():$("#approval_fil,#approval_col",Layout.Page.container).hide(),Leave.Util.filterCrt(params),Leave.Util.sortParams(params),params.dataSelect=Layout.Page.container.find("select[name=dataSelect]").val();var data_footer=$(".ZPAct",Layout.Page.container),recordLimit=$(".Recrd",data_footer),getMore=$(".navi",data_footer);params.sIndx=getMore.find("span").data("sIndx"),params.limit=getMore.find("span").data("eIndx"),Leave.Util.appendLoading();var rowCnt=0;ZPeople.Request.send(Leave.View.url,params,function(resp){Leave.Compensatory.View.html(resp),resp.count&&data_footer.find("a#recCount").data("totalCount",resp.count),resp.count<=recordLimit.find("select").val()&&data_footer.find("a#recCount").text(resp.count),rowCnt=params.sIndx+resp.data.length-1,Leave.Util.Footer.setNavi(params.sIndx,rowCnt)},{});var tbody=Layout.Page.container.find("div.Scrcont table tbody");tbody.data("registeredClicksAndPopovers")||($(tbody).on("click","td",function(){if(0==$(this).find("#moreActions,.checkbox,.btn,[data-toggle=popover]").length){var rec_id=$(this).closest("tr").data("id");window.location.href=LVUtil.urls.CompOff.VIEW()+":"+rec_id}}),tbody.popover({selector:"[data-toggle=popover]",trigger:"click hover",placement:function(context,source){try{var rowPosition=$(source).parent().position(),tableContainer=Layout.Page.container.find(".table-responsive");return rowPosition.top-tableContainer.scrollTop()>tableContainer.height()/2?"top":"bottom"}catch(e){return"bottom"}},delay:{show:50,hide:10},animation:!1}),tbody.data("registeredClicksAndPopovers",!0))},html:function(result,isscroll){var show_approval=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.compApprovalEnabled;if("success"===result.status){var tbody=Layout.Page.container.find("div.Scrcont table tbody");1!==isscroll&&tbody.html(""),Leave.Util.removeLoading();var dataArr=result.data;if(_.isEmpty(dataArr))return Leave.Util.showHideNoRecord(!0,!1),void $(".ZPAct",Layout.Page.container).addClass("DN");Leave.Util.showHideNoRecord(!1,!1),$(".ZPAct",Layout.Page.container).removeClass("DN");var temp_doc=document.createDocumentFragment();for(var indx in dataArr){var recJson=dataArr[indx],tr=ZP.create("tr",{class:"ZPLRow"});$(tr).data("id",recJson.rec_id);var options={viewOpt:Leave.Compensatory.changeViewEditURL};recJson.isbookable&&(options.bookOpt=function(ele){window.location.hash="leavetracker/compensatory/book-recordId:"+$(ele).parents("tr").data("id")}),recJson.allowedit&&(options.editOpt=Leave.Compensatory.changeViewEditURL),recJson.allowdelete&&(options.deleteOpt=Leave.Util.Row.deleteWarning),tr.appendChild(Leave.Util.getDropDownActionsTD(options));var chxTd=ZP.create("td",{style:"padding:6px 10px"});if(recJson.allowdelete?(chxLabel=ZP.create("label",{class:"checkbox"}),chxLabel.appendChild(ZP.create("input",{type:"checkbox"}))):(chxLabel=ZP.create("label",{class:"checkbox disabled"}),chxLabel.appendChild(ZP.create("input",{type:"checkbox",disabled:!0}))),chxLabel.appendChild(ZP.create("span")),chxTd.appendChild(chxLabel),tr.appendChild(chxTd),show_approval){var approvalTd=ZP.create("td",{class:"ZPThumb",style:"padding:6px 10px"});show_approval&&Leave.Util.getStatusTd(approvalTd,recJson.approval_status),tr.appendChild(approvalTd)}var nameTd=ZP.create("td",{style:"padding:6px 10px"});nameTd.appendChild(ZP.create("img",{class:"FL",src:recJson.empphoto}));var nameDiv=ZP.create("div",{class:"ZPusrName","data-toggle":"tooltip","data-placement":"top",title:recJson.name,style:"padding-top:6px"}),nameSpan=ZP.create("span",{class:"ellipsis W120 CP"});nameSpan.appendChild(ZP.create("b",{text:recJson.empid})),ZP.setAtt(nameSpan,{text:recJson.name}),nameDiv.appendChild(nameSpan),nameTd.appendChild(nameDiv),tr.appendChild(nameTd),tr.appendChild(ZP.create("td",{text:recJson.reportingTo,style:"padding:6px 10px"}));var dateTd=ZP.create("td",{text:recJson.date,style:"padding:6px 10px"});dateTd.appendChild(ZP.create("br")),tr.appendChild(dateTd);(recJson.startTime>0||recJson.endTime>0)&&Leave.Util.convertMinutestoTime(recJson.startTime)+" - "+Leave.Util.convertMinutestoTime(recJson.endTime),tr.appendChild(ZP.create("td",{text:recJson.expiry,style:"padding:6px 10px"}));var availTd=ZP.create("td",{style:"padding:6px 10px"});availTd.appendChild(Leave.Compensatory.View.showCompOffStatus(recJson)),tr.appendChild(availTd);var unit=recJson.isHourType?ZPI18N.getString("zp.shours"):ZPI18N.getString("zp.leavetype.daysinfo"),report=["credited","availed","balance"];for(var key in report){var field=report[key],td=ZP.create("td",{style:"padding:6px 10px"}),info=ZP.create("span"),txt="-";txt=recJson.isHourType?recJson[field]&&2!=recJson.approval_status&&0!=recJson.approval_status?Leave.Util.convertToHoursandMinutes(recJson[field])+" ":"-":recJson[field]&&2!=recJson.approval_status&&0!=recJson.approval_status?recJson[field]+" ":"-",info.appendChild(ZP.create("em",{text:txt})),"-"!=txt&&info.appendChild(ZP.create("small",{text:unit})),td.appendChild(info),tr.appendChild(td)}if(tr.appendChild(td),recJson.desc){var descTd=ZP.create("td",{class:"ZPExpd"});descTd.appendChild(ZP.create("div",{class:"popHover DIB",text:recJson.desc,"data-toggle":"popover","data-content":recJson.desc})),tr.appendChild(descTd)}else tr.appendChild(ZP.create("td",{text:""}));temp_doc.appendChild(tr)}tbody.append(temp_doc)}},showCompOffStatus:function(recJson){if(recJson.is_leave_taken)return ZP.create("font",{text:ZPI18N.getString("zp.leave.availed")});if(recJson.isexpired)return ZP.create("font",{text:ZPI18N.getString("zp.expired")});if(recJson.isbookable){var ele=ZP.create("a",{href:LVUtil.urls.CompOff.BOOK()+":"+recJson.rec_id});return ele.appendChild(ZP.create("button",{text:ZPI18N.getString("zp.leave.compensatory.bookcompoff"),class:"btn btn-default btn-sm"})),ele}return 1==recJson.approval_status||-2==recJson.approval_status?ZP.create("font",{text:ZPI18N.getString("zp.approved")}):0==recJson.approval_status?ZP.create("font",{text:ZPI18N.getString("zp.rejected")}):2==recJson.approval_status?ZP.create("font",{text:ZPI18N.getString("zp.cancelled")}):-3==recJson.approval_status?ZP.create("font",{text:ZPI18N.getString("zp.leave.compensatory.notsubmitted")}):ZP.create("font",{text:ZPI18N.getString("zp.waitingmsg")})}},Add:{expiresAfter:0,expiryUnit:"",html:function(){var modalhtml=ZPeople.BSModal.get({id:Layout.Page.pageId+"-addeditview",type:2,header:ZPI18N.getString("zp.addrequests"),modalClass:"popRgtModel PopMdModel",bodyClass:"ZPRPbody",body:$(Leave.Compensatory.form_modal.replace("**HOLIDAY_DISPLAYNAME**",holiday_disName).replace("**COMPENSATORY_DISPLAYNAME**",ZPeople.Module.getData("leavetracker").leave_filterops.Compensatory_DisplayName)),deleteOnHide:!0,hiddenCallback:Leave.Compensatory.View.changeUrl}),modalbody=modalhtml.find("#zp_modal_body"),config=ZPeople.Module.getData("leavetracker").leave_filterops.Compensatory_Configuration;Leave.Util.regFilters(modalbody),$("#"+Layout.Page.pageId+"-addeditview").popover({selector:"[data-popover].popHover",trigger:"click hover",placement:"right",delay:{show:50,hide:50}});var location=(filterObj=ZPeople.Module.getData("leavetracker").leave_filterops).curuser.location,employee=(filterObj.leaveyear,$("[name=employee]",modalhtml)),date=$("[name=date]",modalhtml);$("[name=compoff_type]",modalhtml).select2(),$(".credited_field",modalhtml).addClass("DN"),Leave.Compensatory.Add.pageInit(config,modalbody),Leave.Compensatory.Add.regTimePicker(modalhtml),$("[name=employee]",modalhtml).on("change",function(){$("[name=expiry]",modalhtml).val(Leave.Util.getCurrentLYear(ZP.getUserDetailsById($(this).val()).location).to)});location=(filterObj=ZPeople.Module.getData("leavetracker").leave_filterops).curuser.location;var filterObj,expiry=$("[name=expiry]",modalhtml);expiry.val(Leave.Util.getCurrentLYear(location).to),filterObj.isdataadmin||expiry.attr("disabled","disabled"),modalhtml.find("#zp_modal_blubtn").on("click",function(){Leave.Compensatory.Add.save()}),$(employee).on("change",function(){Leave.Compensatory.Add.suggestWorkedDate($(this),$(date),modalhtml)}),$(employee).trigger("change"),modalhtml.modal("show")},pageInit:function(config,modalhtml,record){var duration_component=$("[name=compoff_type]",modalhtml),time_component=$(".time_component",modalhtml);"both"==config.unit||"hour"==config.unit?$(".busdays_icon").removeClass("DN"):$(".busdays_icon").addClass("DN"),"both"==config.unit?($("#unit_choice",modalhtml).removeClass("DN"),$("#unit_fixed",modalhtml).addClass("DN")):($("#unit_choice",modalhtml).addClass("DN"),$("#unit_fixed",modalhtml).removeClass("DN").html("<em>"+("hour"==config.unit?ZPI18N.getString("zp.leavetype.hour"):ZPI18N.getString("zp.cday"))+"</em>"),"hour"==config.unit&&($("[value=Hours][type=radio]",modalhtml).trigger("click"),$("#duration_choice",modalhtml).removeClass("DN"),$("#duration_fixed",modalhtml).addClass("DN"))),record?($("#duration_fixed",modalhtml).addClass("DN"),$("#duration_choice",modalhtml).removeClass("DN")):"both"!=config.unit&&"day"!=config.unit||(config.ishalfday_allowed||config.isquarterday_allowed?config.isfullday_allowed||config.isquarterday_allowed?config.isfullday_allowed||config.ishalfday_allowed?($("#duration_choice",modalhtml).removeClass("DN"),$("#duration_fixed",modalhtml).addClass("DN"),config.isfullday_allowed||duration_component.find("[value=0]").remove(),config.ishalfday_allowed||duration_component.find("[value=1]").remove(),config.isquarterday_allowed||duration_component.find("[value=2]").remove(),duration_component.select2()):($("#duration_fixed",modalhtml).removeClass("DN").html("<em>"+ZPI18N.getString("zp.quarterday")+"</em><span class='ERR MT5'></span>"),$("#duration_choice",modalhtml).addClass("DN"),duration_component.select2("val","2")):($("#duration_fixed",modalhtml).removeClass("DN").html("<em>"+ZPI18N.getString("zp.halfday")+"</em><span class='ERR MT5'></span>"),$("#duration_choice",modalhtml).addClass("DN"),duration_component.select2("val","1")):($("#duration_fixed",modalhtml).removeClass("DN").html("<em>"+ZPI18N.getString("zp.fullday")+"</em><span class='ERR MT5'></span>"),$("#duration_choice",modalhtml).addClass("DN"))),config.time?time_component.removeClass("DN"):time_component.addClass("DN");var reason_component=$("#reasonLabel",modalhtml);config.mandate_reason&&reason_component.addClass("zp_mdt")},regTimePicker:function(ele,fromTime,toTime){(ele=$(ele)).find("[name=comp_fromtime]").timepicker({maxHours:Leave.Util.is24HrTimeFormat()?24:13,showMeridian:!Leave.Util.is24HrTimeFormat(),defaultTime:fromTime||""}),ele.find("[name=comp_totime]").timepicker({maxHours:Leave.Util.is24HrTimeFormat()?24:13,showMeridian:!Leave.Util.is24HrTimeFormat(),defaultTime:toTime||""});var hours=ele.find("[name=compoff_hours]");$(hours).timepicker({maxHours:24,showMeridian:!1,defaultTime:"00:00"}),ele.find("[name=comp_fromtime],[name=comp_totime]").on("change",function(){var hours=ele.find("[name=compoff_hours]"),from=ele.find("[name=comp_fromtime]").val(),to=ele.find("[name=comp_totime]").val(),mins=Leave.Util.getTimeDiff(from,to);hours.val(Leave.Util.convertToHoursandMinutes(mins))})},switchDuration:function(ele){var modal=$("#"+Layout.Page.pageId+"-addeditview"),type=$("[name=type]",modal).parent(),duration=$("[name=duration]",modal).parent();"day"==$(ele).attr("id")?(type.removeClass("DN"),!duration.hasClass("DN")&&duration.addClass("DN")):(duration.removeClass("DN"),!type.hasClass("DN")&&type.addClass("DN"))},suggestWorkedDate:function(employee,date,modal){var params={key:"suggestDate"};params.employee=$(employee).select2("val");var loc=ZP.getUserDetailsById(params.employee).location;params.location=loc+""=="null"?-1:loc,ZPeople.Request.send("/leave_common_action.zp",params,function(resp){Leave.Compensatory.Add.expiresAfter=parseInt(resp.expiresAfter),Leave.Compensatory.Add.expiryUnit=resp.expiryUnit,date.val(resp.date),Leave.Compensatory.showAttendanceDetails(resp.attendance_details,modal),Leave.Compensatory.Add.changeExpiry(date)})},changeExpiry:function(ele){if(!(Leave.Compensatory.Add.expiresAfter<=0)){var dateStr=$(ele).val();if("M"==Leave.Compensatory.Add.expiryUnit||"D"==Leave.Compensatory.Add.expiryUnit){var date=Calendar.parseDate(dateStr,uidateFormat);"D"==Leave.Compensatory.Add.expiryUnit?date.setDate(date.getDate()+Leave.Compensatory.Add.expiresAfter):date.setMonth(date.getMonth()+Leave.Compensatory.Add.expiresAfter),date=Calendar.formatDate(date),$("#"+Layout.Page.pageId+"-addeditview").find("input[name=expiry]").val(date+"")}else if("WD"==Leave.Compensatory.Add.expiryUnit){var modal=$("#"+Layout.Page.pageId+"-addeditview"),params={key:"get_compoff_expirydate"},isEdit=$("#zp_modal_body",modal).data("rec_id");params.employee=isEdit?$("#zp_modal_body",modal).data("employee"):$("[name=employee]",modal).select2("val");var loc=ZP.getUserDetailsById(params.employee).location;params.location=loc+""=="null"?-1:loc,params.date=dateStr,ZPeople.Request.send("/leave_common_action.zp",params,function(resp){modal.find("input[name=expiry]").val(resp.date)})}}},save:function(){var modal=$("#"+Layout.Page.pageId+"-addeditview");modal.find("#zp_modal_blubtn").prop("disabled",!0);var employee=$("[name=employee]",modal).val(),date=$("[name=date]",modal).val(),unit=$("[name=unit]:checked",modal).attr("id"),type=$("[name=compoff_type]",modal).select2("val"),duration=$("[name=compoff_hours]",modal).val(),startTime=$("[name=comp_fromtime]",modal).val(),endTime=$("[name=comp_totime]",modal).val(),credited=$("[name=credited]",modal).val(),expiry=$("[name=expiry]",modal).val(),description=$("[name=description]",modal).val(),params={key:"compensatory_add"},rec_id=$("#zp_modal_body",modal).data("rec_id");employee=rec_id?$("#zp_modal_body",modal).data("employee"):employee;var count=1;if(params.rec_id=rec_id,!(date&&Calendar.isvalidDate(date)&&expiry&&Calendar.isvalidDate(expiry)))return expiry&&Calendar.isvalidDate(expiry)?void $("[name=date]",modal).siblings("span.ERR").text(ZPI18N.getString("zp.validdateerr")).show():void $("[name=expiry]",modal).siblings("span.ERR").text(ZPI18N.getString("zp.validdateerr")).show();if(Leave.Compensatory.Add.hideError(modal),"day"==unit)"1"==type?count=.5:"2"==type&&(count=.25);else{if(0==(count=Leave.Util.convertHourstoMinutes(duration)))return void $("[name=duration]",modal).find("span.ERR").text(ZPI18N.getString("zp.leave.compensatory.hourseerr")).show();type="3"}params.type=parseInt(type),params.date=date,params.count=count;var start=0,end=0;if(ZPUtil.Validation.isEmpty(startTime)&&ZPUtil.Validation.isEmpty(endTime))$("[name=timeDiv]",modal).siblings("span.ERR").text("");else{if(ZPUtil.Validation.isEmpty(startTime)||ZPUtil.Validation.isEmpty(endTime)||startTime==endTime)return void $("[name=timeDiv]",modal).siblings("span.ERR").text(ZPI18N.getString("zp.entervalidtime")).show();$("[name=timeDiv]",modal).siblings("span.ERR").text(""),start=Leave.Util.convertTimetoMinutes(startTime),end=Leave.Util.convertTimetoMinutes(endTime)}params.startTime=start,params.endTime=end,!ZPUtil.Validation.isEmpty(credited)&&(params.credited=credited),params.employee=employee,params.description=description,params.expiry=expiry,params[csrfParamName]=csrfToken,params.save_expiry_only=modal.find(".modal-body").data("save_expiry_only"),params.save_expiry_only=!!params.save_expiry_only&&params.save_expiry_only,Leave.Compensatory.Add.validateData(params)?ZPeople.Request.send(Leave.View.url,params,Leave.Compensatory.Add.onResponse,{}):modal.find("#zp_modal_blubtn").prop("disabled",!1)},validateData:function(params){var errors={};if(ZPeople.Module.getData("leavetracker").leave_filterops.Compensatory_Configuration.mandate_reason&&(""!=params.description&&""!=params.description.trim()||(errors.description=ZPI18N.getString("zp.enterareason"))),_.size(errors)>0){var modalhtml=$("#"+Layout.Page.pageId+"-addeditview");return Leave.Compensatory.Add.showError(errors,modalhtml),!1}return!0},onResponse:function(result){if("success"===result.status)Leave.Compensatory.refresh=!0,window.location.href=LVUtil.urls.CompOff.VIEW()+":"+result.rec_id;else if("VALIDATIONERROR"===result.status){var errors=result.error,modalhtml=$("#"+Layout.Page.pageId+"-addeditview");Leave.Compensatory.Add.showError(errors,modalhtml),modalhtml.find("#zp_modal_blubtn").prop("disabled",!1)}},showError:function(errors,parent){for(var elename in errors)if("showInfo"==elename)parent.find("i.IC-info").siblings("div.popover").is(":visible")||parent.find("i.IC-info").trigger("click");else{var errortxt=errors[elename];(eles=parent.find("[name="+elename+"]:visible")).siblings("span.ERR").text(errortxt).show(),eles.trigger("focus")}if(errors.hasOwnProperty("duration")){var eles=parent.find("[name="+elename+"]:visible");$("#hour_duration_choice, #duration_choice, #hour_duration_fixed, #duration_fixed",parent).find("span.ERR").text(errortxt).show(),eles.find("input").trigger("focus")}},hideError:function(parent){parent.find("span.ERR").hide()}},Edit:{get:function(){if($.isEmptyObject(Leave.Compensatory.recordData)){var params={key:"compensatory_record"},recordId=Layout.Page.hash.split(":")[1];params.rec_id=recordId,params[csrfParamName]=csrfToken,ZPeople.Request.send(Leave.View.url,params,Leave.Compensatory.Edit.html,{})}else Leave.Compensatory.Edit.html(Leave.Compensatory.recordData)},html:function(result){var modalhtml=ZPeople.BSModal.get({id:Layout.Page.pageId+"-addeditview",type:2,header:ZPI18N.getString("zp.editrequest"),modalClass:"popRgtModel PopMdModel",bodyClass:"ZPRPbody",body:$(Leave.Compensatory.form_modal.replace("**HOLIDAY_DISPLAYNAME**",holiday_disName).replace("**COMPENSATORY_DISPLAYNAME**",ZPeople.Module.getData("leavetracker").leave_filterops.Compensatory_DisplayName)),hiddenCallback:Leave.Compensatory.View.changeUrl,deleteOnHide:!0});Leave.Compensatory.Add.expiresAfter=parseInt(result.expiresAfter),Leave.Compensatory.Add.expiryUnit=result.expiryUnit;var record=result.data,modalbody=modalhtml.find("#zp_modal_body"),config=ZPeople.Module.getData("leavetracker").leave_filterops.Compensatory_Configuration;if(!record.allowEdit)return record.error_msg?modalbody.html('<div class="col-lg-12 text-center"><div class="PArds"></div><h2 id="zp_nodata" class="ZPNdt">'+record.error_msg+"</h2></div>"):modalbody.html('<div class="col-lg-12 text-center"><div class="PArds"></div><h2 id="zp_nodata" class="ZPNdt">'+ZPI18N.getString("zp.leave.compensatory.editerror")+"</h2></div>"),modalhtml.modal("show"),void(Leave.Compensatory.recordData={});Leave.Util.regFilters(modalbody,record),$("#"+Layout.Page.pageId+"-addeditview").popover({selector:"[data-popover].popHover",trigger:"click hover",placement:"right",delay:{show:50,hide:50}}),modalbody.data("rec_id",record.rec_id),modalbody.data("employee",record.employee),modalbody.find(".form-group").addClass("PT5");var employee=$("[name=employee]",modalhtml).parent();employee.html("").addClass("PT5"),employee.append(ZP.create("span",{name:"employee",text:record.empname}));var type=$("[name=compoff_type]",modalhtml);type.select2(),record.type<3?type.select2().select2("val",record.type):"day"!=config.unit&&$("[name=unit][id=hour]",modalhtml).trigger("click");var hours=modalbody.find("[name=compoff_hours]"),hasTime=record.startTime>0||record.endTime>0,startTime=hasTime?Leave.Util.convertMinutestoTime(record.startTime):void 0,endTime=hasTime?Leave.Util.convertMinutestoTime(record.endTime):void 0;Leave.Compensatory.Add.regTimePicker(modalbody,startTime,endTime),Leave.Compensatory.Edit.pageInit(record,config,modalbody),record.isHourType&&hours.val(Leave.Util.convertToHoursandMinutes(record.applied)),$("[name=date]",modalhtml).val(record.date),$("[name=date]",modalhtml).parents(".form-group").removeClass("PT5").addClass("PT8"),$("[name=credited]",modalhtml).val(3==record.type?record.credited/60:record.credited),$("[name=expiry]",modalhtml).val(record.expiry),$("[name=description]",modalhtml).val(record.description),modalhtml.find("#zp_modal_blubtn").on("click",function(){Leave.Compensatory.Add.save()}),Leave.Compensatory.showAttendanceDetails(result.attendanceDetails,modalhtml),Leave.Compensatory.recordData={},modalhtml.modal("show")},pageInit:function(record,config,modalbody){if("both"==config.unit||"day"==config.unit&&record.type<3||"hour"==config.unit&&3==record.type)Leave.Compensatory.Add.pageInit(config,modalbody);else{$("[name=compoff_type]",modalbody);var time_component=$(".time_component",modalbody);if(3==record.type&&$("[value=Hours][type=radio]",modalbody).trigger("click"),"both"==config.unit||"hour"==config.unit?$(".busdays_icon").removeClass("DN"):$(".busdays_icon").addClass("DN"),$("#unit_choice, #duration_choice, #hour_duration_choice, #date_choice",modalbody).addClass("DN"),$("#date_fixed",modalbody).removeClass("DN").html("<em>"+record.date+"</em>"),$("#unit_fixed",modalbody).removeClass("DN").html("<em>"+(record.isHourType?ZPI18N.getString("zp.leavetype.hour"):ZPI18N.getString("zp.cday"))+"</em>"),$("#hour_duration_fixed, #duration_fixed",modalbody).removeClass("DN").html("<em>"+Leave.Compensatory.getDurationText(record)+"</em><span class='ERR MT5'></span>"),config.time){var txt="-";(record.startTime>0||record.endTime>0)&&(txt=Leave.Util.convertMinutestoTime(record.startTime)+" - "+Leave.Util.convertMinutestoTime(record.endTime)),time_component.removeClass("DN"),time_component.find("[name=fromtoTime]").remove(),time_component.append('<div class="col-sm-6 hrsDts PT5" name="fromtoTime"><span>'+txt+"</span></div>")}else time_component.addClass("DN");modalbody.data("save_expiry_only",!0)}}},RecordView:{recordId:{},get:function(recordId){var params={key:"compensatory_record"};recordId=recordId||Layout.Page.hash.split(":")[1];params.rec_id=recordId,params[csrfParamName]=csrfToken,ZPeople.Request.send(Leave.View.url,params,Leave.Compensatory.RecordView.html,{})},html:function(result){var fields=["employee","date","fromtoTime","type","credited","expiry","description"],config=result.Compensatory_Configuration,modalhtml=ZPeople.BSModal.get({id:Layout.Page.pageId+"-addeditview",type:2,header:result.formDisName,modalClass:"popRgtModel PopMdModel",bodyClass:"ZPRPbody",hiddenCallback:Leave.Compensatory.View.changeUrl,deleteOnHide:!0});modalhtml.find("h6").addClass("FL"),!config.time&&delete fields[2];var record=result.data;Leave.Compensatory.recordData=result;var approval=result.approvalDetails;record.allowEdit&&-1!=Layout.Page.pageId.indexOf("leavetracker")&&Leave.Compensatory.RecordView.addEditIcon(modalhtml,record.rec_id);var refBody=$(Leave.Compensatory.form_modal.replace("**HOLIDAY_DISPLAYNAME**",holiday_disName).replace("**COMPENSATORY_DISPLAYNAME**",result.formDisName));for(var field in refBody.find("#compoff_header").removeClass("DN").width("calc(100% - 250px)"),refBody.find("[name=duration],[name=unit]").parents("div.form-group").remove(),fields){var name=fields[field],eleparent=refBody.find("[name="+name+"]").closest("div.col-sm-5");if("employee"!==name&&"description"!==name&&"fromtoTime"!=name&&(eleparent=refBody.find("[name="+name+"]").closest("div.col-sm-3")),eleparent.parents("div.form-group").removeClass("PT5").addClass("PT10"),eleparent.removeClass("W60").addClass("PT5").html(""),eleparent.siblings("label").addClass("ZPbold"),"employee"===name)eleparent.append(ZP.create("span",{text:record.empname}));else if("date"===name)eleparent.append(ZP.create("span",{text:record.date}));else if("fromtoTime"===name){var txt="-";(record.startTime>0||record.endTime>0)&&(txt=Leave.Util.convertMinutestoTime(record.startTime)+" - "+Leave.Util.convertMinutestoTime(record.endTime)),eleparent.parents("div.form-group").show(),eleparent.append(ZP.create("span",{text:txt}))}else"type"==name?(eleparent.parents("div.form-group").removeClass("DN"),eleparent.siblings("div.col-sm-3").remove(),eleparent.append(ZP.create("em",{text:Leave.Compensatory.getDurationText(record)}))):"credited"==name?eleparent.append(ZP.create("span",{text:2==record.approvalStatus||0==record.approvalStatus?"-":3==record.type?record.credited/60:record.credited})):eleparent.append(ZP.create("span",{text:record[name]?record[name]:"-"}))}modalhtml.find("#zp_modal_body").html(""),Leave.Compensatory.Add.pageInit(config,refBody,record),modalhtml.find("#zp_modal_body").append(refBody),Leave.Compensatory.showAttendanceDetails(result.attendanceDetails,modalhtml);var leavebody=modalhtml.find("#zp_modal_body #zp_leave_details"),leavedata=record.leavedata,last_hr=ZP.create("hr",{class:"ZPwf"});if($.each(leavedata,function(indx){var data=leavedata[indx],taken=data.isHour?parseFloat(data.taken/60).toFixed(2)+" "+ZPI18N.getString("zp.shours"):data.taken+" "+ZPI18N.getString("zp.leavetype.daysinfo"),date=ZP.create("div",{class:"ZPwf cmreqlvdtsLst MB20"}),fromto=ZP.create("div",{class:"ZPbold"}),count=ZP.create("div",{class:"ZPwf cmreqlvdtsLst MB20"}),status=ZP.create("div",{class:"ZPwf cmreqlvdtsLst MB20"});last_hr=ZP.create("hr",{class:"ZPwf"}),data.from!=data.to?(date.appendChild(ZP.create("span",{class:"dgry LH18I",text:ZPI18N.getString("zp.leaveperiod")})),date.classList.add("LH18I"),fromto.classList.add("LH18I"),fromto.appendChild(ZP.create("em",{text:data.from})),fromto.appendChild(ZP.create("br")),fromto.appendChild(ZP.create("b",{class:"dgry",text:ZPI18N.getString("zp.to")})),fromto.appendChild(ZP.create("br")),fromto.appendChild(ZP.create("em",{text:data.to}))):(date.appendChild(ZP.create("span",{class:"dgry",text:ZPI18N.getString("zp.leaveperiod")})),fromto.appendChild(ZP.create("span",{class:"ZPbold",text:data.from}))),date.appendChild(fromto),count.appendChild(ZP.create("span",{class:"dgry",text:ZPI18N.getString("zp.count")})),count.appendChild(ZP.create("span",{class:"ZPbold",text:taken})),status.appendChild(ZP.create("span",{class:"dgry",text:ZPI18N.getString("zp.status")})),status.appendChild(ZP.create("span",{class:Leave.Util.getStatusColor(data.approvalStatus)+" ZPbold",text:Leave.Util.getStatusText(data.approvalStatus)})),leavebody.append(date),leavebody.append(count),leavebody.append(status),leavebody.append(last_hr)}),leavebody.find("hr:last-child").remove(),leavedata.length>0&&modalhtml.find("#zp_modal_body #zp_leave_details").removeClass("DN"),modalhtml.find("#zp_modal_blubtn").hide(),modalhtml.find(".btn.btn-default").text(ZPI18N.getString("zp.close")),modalhtml.modal("show"),record.allowCancel){var cancelbtn=ZP.create("button",{class:"btn btn-cancel btn-default ML8 FR",onclick:"Leave.Compensatory.cancelCompoffWarning();"});$(cancelbtn).html(ZPI18N.getString("zp.cancelrecord")),modalhtml.find(".modal-footer").append(cancelbtn)}2!=record.approvalStatus||void 0!=approval&&!approval.systemApproved||modalhtml.find(".modal-footer").append(ZP.create("button",{class:"btn NM btn-dgray ML8 FR",text:ZPI18N.getString("zp.cancelledrecord")})),Leave.Compensatory.RecordView.recordId=record.rec_id,approval&&(2!=record.approvalStatus&&(ZPForm.LAYOUT=modalhtml,ZPApprovals.FORMID=approval.formId,LVUtil.Form.getCurrFormParam().tableName="P_Compensatory",ZPApprovals.RECORDID=record.rec_id,ZPForm.RecordApproval.CREATE_ERECNO=record.employee,ZPForm.RecordApproval.OWNER_ERECNO=approval.recOwner,ZPApprovals.MODAL_CLASS="modal popRgtModel ZPsecModal",ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID]=approval,modalhtml.find(".modal-header").append($('<div class="FR MT1 MR10"><div class="zp-recordsts FR MT2" id="headerApprovalBtn" name="appr_status_'+record.rec_id+'"><span class="msg"></span><a id="zp_appproval_comment_btn" onclick="ZPApprovals.getApprovalDetails()">'+ZPI18N.getString("zp.view")+'</a><a id="showApprBtn" class="zp_dyn">'+ZPI18N.getString("zp.viewapprovers")+"</a></div></div>")),modalhtml.find(".modal-footer").append($('<div class="col-sm-6" id="zp_appproval_container"></div></div>')),ZPApprovals.showApprovalHeader(record.approvalStatus,approval.isOwner,approval.isPrimaryAppr)),modalhtml.find(".btn.btn-default").hide(),record.allowCancel?modalhtml.find(".modal-footer").append('<div class="col-sm-6 text-right FR"><button class="btn btn-cancel btn-default" type="button" onclick="Leave.Compensatory.cancelCompoffWarning();" approvaltype="2">'+ZPI18N.getString("zp.cancelrecord")+"</button></div>"):modalhtml.find(".modal-footer").append('<div class="col-sm-6 text-right FR"><button class="btn btn-default cancel-model" data-dismiss="modal" type="button" >'+ZPI18N.getString("zp.close")+"</button></div>"),(approval.canceledRecord||2==approval.currentApprovalStatus)&&(modalhtml.find(".modal-footer").find(".text-right").remove(),modalhtml.find(".modal-footer").append('<div class="col-sm-8 text-left"><button class="btn btn-default cancel-model" data-dismiss="modal" type="button">'+ZPI18N.getString("zp.close")+"</button></div>"),modalhtml.find(".modal-footer").append(ZP.create("button",{class:"btn NM btn-dgray ML8 FR",text:ZPI18N.getString("zp.cancelledrecord")}))))},addEditIcon:function(modalhtml,rec_id){var tempdiv=ZP.create("div",{class:"FR MR20 MT5",id:"edit_icon"}),edit=ZP.create("a",{class:"FL MR10",href:LVUtil.urls.CompOff.EDIT()+":"+rec_id});edit.appendChild(ZP.create("i",{class:"IC-pen S18 gry CP"})),tempdiv.appendChild(edit),modalhtml.find(".modal-header").find("#edit_icon").remove(),modalhtml.find(".modal-header").append(tempdiv)}},fetchAndShowAttendanceDetails:function(){var modal=$("#"+Layout.Page.pageId+"-addeditview"),employee=$("#zp_modal_body",modal).data("rec_id")?$("#zp_modal_body",modal).data("employee"):$("[name=employee]",modal).val(),params={key:"fetch_attendance_info",date:$("[name=date]",modal).val(),employee:employee};ZPeople.Request.send("/leave_common_action.zp",params,function(resp){Leave.Compensatory.showAttendanceDetails(resp.data,modal)})},showAttendanceDetails:function(attendanceDetails,modalhtml){attendanceDetails=attendanceDetails;var attedanceHtml=modalhtml.find("#zp_modal_body #attendance_detail"),firstIn="-",lastOut="-",overTime="-",totalHours="-";void 0!=attendanceDetails&&null!=attendanceDetails?(_.isEmpty(attendanceDetails)||(firstIn=attendanceDetails.fromDate?attendanceDetails.fromDate+" "+attendanceDetails.firstIn:ZP.optValue(attendanceDetails,"firstIn","-"),lastOut=attendanceDetails.toDate?attendanceDetails.toDate+" "+attendanceDetails.lastOut:ZP.optValue(attendanceDetails,"lastOut","-"),overTime=attendanceDetails.overTime?attendanceDetails.overTime+" "+ZPI18N.getString("zp.hours"):"-",totalHours=attendanceDetails.totalHours?attendanceDetails.totalHours+" "+ZPI18N.getString("zp.hours"):"-"),attedanceHtml.find("#firstIn").text(firstIn),attedanceHtml.find("#lastOut").text(lastOut),attedanceHtml.find("#overTime").text(overTime),attedanceHtml.find("#totalHours").text(totalHours),attedanceHtml.removeClass("DN")):attedanceHtml.addClass("DN")},cancelCompoffWarning:function(){ZPeople.BSModal.setup({id:"zp_confirmation_pop",type:4,header:'<div class="Icn grni"><i class="IC-tick whi S24"></i></div><h4 id="gridSystemModalLabel" class="modal-title">'+ZPI18N.getString("zp.confirm")+"</h4>",body:'<div class="form-group"><p class="text-center MB15">'+ZPI18N.getString("zp.confirmcancelrecord")+"</p></div></div>",modalClass:"modal fade ZPmdl DelMdl in",buttonValue:ZPI18N.getString("zp.confirm"),successCallback:Leave.Compensatory.cancelCompoff,hiddenCallback:ZPApprovals.approveOrRejectActionHidden})},cancelCompoff:function(){$(".modal-footer").find("#zp_modal_blubtn").attr("disabled","disabled");var params={key:"cancel_compoff",id:Leave.Compensatory.RecordView.recordId};params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(result){"success"===result.status&&(result.data?(ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.cancelmsg")),Leave.Compensatory.switchToRecView()):(ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.notallowedtoedit")),Layout.Page.container.find(".modal-footer").find("#zp_modal_blubtn").prop("disabled",!1))),Layout.Page.container.find(".modal-footer").find("#zp_modal_blubtn").prop("disabled",!1),ZPeople.BSModal.hide("zp_confirmation_pop"),ZPeople.BSModal.hide(Layout.Page.pageId+"-addeditview"),$(".modal-backdrop").remove()})},switchToRecView:function(){LVUtil.urls.CompOff.isView()?(Leave.Compensatory.refresh=!0,window.location.href=LVUtil.urls.CompOff.HOME()):-1!==Layout.Page.hash.indexOf("#home/dashboard/approvals-formId")?window.location.href="#home/dashboard/approvals":-1!==Layout.Page.hash.indexOf("#home/dashboard")&&(window.location.href="#home/dashboard")},loadExtraInfo:function(){var data=LVUtil.Form.getFormLayout().data("record").extraDetails,extrainfo=$("#zp_formcompoff_extrainfo",LVUtil.Form.getFormLayout()),fields=["duration"];LVUtil.Form.getCurrFormConf().time_enabled&&(fields[1]="time"),$(fields).each(function(indx){var field=ZP.create("div",{class:"form-group",id:fields[indx]}),div=ZP.create("div",{class:"col-sm-6 PT5"}),label=ZP.create("label",{class:"control-label col-sm-3 MT1 zp_mdt"});if("duration"==fields[indx])label.appendChild(ZP.create("font",{text:document.createTextNode(ZPI18N.getString("zp.duration"))})),div.appendChild(ZP.create("span",{text:Leave.Compensatory.getDurationText(data)}));else{label.appendChild(document.createTextNode(ZPI18N.getString("zp.time")));var txt="-";(data.fromTime>0||data.toTime>0)&&(txt=Leave.Util.convertMinutestoTime(data.fromTime)+" - "+Leave.Util.convertMinutestoTime(data.toTime)),div.appendChild(ZP.create("span",{text:txt}))}field.appendChild(label),field.appendChild(div),extrainfo.append(field)}),LVUtil.Form.getFormLayout().find("#zp_form_editin_singlerec").hide()},getDurationText:function(data){return 0==data.type?ZPI18N.getString("zp.fullday"):1==data.type?ZPI18N.getString("zp.halfday"):2==data.type?ZPI18N.getString("zp.quarterday"):Leave.Util.convertToHoursandMinutes(data.applied)+" "+ZPI18N.getString("zp.shours")},Form:{initRename:function(){Layout.Page.container.find("#Compoff_LT.Header").addClass("DN"),Layout.Page.container.find("#Compoff_LT.Editable-Header").removeClass("DN")},saveName:function(){var dis_name=Layout.Page.container.find("[name=comp_disname]").val();if(dis_name&&dis_name.trim().length>0&&dis_name.length<50){var params={key:"renameCompOffForm"};params.name=dis_name,ZPeople.Request.send("/leave_common_action.zp",params,function(response){ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful")),Layout.Page.container.find("span#Compoff_LT.Header").text(response.display_name),Layout.Page.container.find("#Compoff_LT[name=comp_disname]").val(response.display_name),Layout.Page.container.find("#Compoff_LT.Header").removeClass("DN"),Layout.Page.container.find("#Compoff_LT.Editable-Header").addClass("DN")})}else ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.entervalidinput"))}},form_modal:'<div id="Dummy" class=""><form  class="form-horizontal pad" role="form"><h6 class="ZPbld MT0I DN" id="compoff_header">**COMPENSATORY_DISPLAYNAME** '+ZPI18N.getString("zp.Details")+'</h6><div class="form-group"><label class="control-label col-sm-2 zp_mdt"><font>'+ZPI18N.getString("zp.employeename")+'</font></label><div class="col-sm-5"><input name="employee" class="ZP-Select" type="hidden" value="0" ignore="true" issingleemp="true" searchmode="DATAADD" /><span class="ERR MT5"></span></div></div><div class="form-group PT5"><label class="control-label col-sm-2 zp_mdt"><font>'+ZPI18N.getString("zp.leave.workeddate")+'</font></label><div class="col-sm-3"><div class="btnCal" id="date_choice"><input type="text" class="form-control ZP-Date W100I" caltype="filter" name="date" placeholder="'+ZPI18N.getString("zp.date")+'"><i class="IC-info S18 gry popHover form-icon ML5 MT1 DN busdays_icon" data-popover="true" data-html="true" data-content="<p class=\'LH18I\'><b>'+ZPI18N.getString("zp.leavetype.busdays")+"</b><br>"+ZPI18N.getString("zp.leave.compensatory.businessdayhelp")+"</p><br><p class='LH18I'><b>**HOLIDAY_DISPLAYNAME**"+ZPI18N.getString("zp.leave.compensatory.holidayweekend")+"</b><br>"+ZPI18N.getString("zp.leave.compensatory.holidayhelp")+'</p>" data-original-title="" title=""></i><span class="ERR MT5"></span></div><div class="col-sm-5\t PT5" id="date_fixed"></div></div></div><div class="form-group PT5"><label class="control-label col-sm-2 zp_mdt"><font>'+ZPI18N.getString("zp.unit")+'</font></label><div class="col-sm-5 DN" id="unit_choice"><label class="radio DIB MR8"><input type="radio" id="day" name="unit" value="Days" checked="checked" onclick="Leave.Compensatory.Add.switchDuration(this)"><span class="ML2">'+ZPI18N.getString("zp.day.plural")+'</span></label><label class="radio DIB MR8 restricted"><input type="radio" id="hour" name="unit" value="Hours" onclick="Leave.Compensatory.Add.switchDuration(this)"><span class="ML2">'+ZPI18N.getString("zp.hourslog")+'</span></label></div><div class="col-sm-5 PT5" id="unit_fixed"></div></div><div class="form-group PT10"><label class="control-label col-sm-2 zp_mdt"><font>'+ZPI18N.getString("zp.duration")+'</font></label><div class="col-sm-3 DN" name="type" id="duration_choice" name="duration"><select name="compoff_type" class="MB5"><option value="0">'+ZPI18N.getString("zp.fullday")+'</option><option value="1">'+ZPI18N.getString("zp.halfday")+'</option><option value="2">'+ZPI18N.getString("zp.quarterday")+'</option></select><span class="ERR MT5 W150"></span></div><div class="col-sm-5 PT5" id="duration_fixed"><span class="ERR MT5 W150"></span></div></div><div class="form-group PT10 DN"><label class="control-label col-sm-2 zp_mdt"><font>'+ZPI18N.getString("zp.duration")+'</font></label><div class="col-sm-3 hrsDts W60 timePopover" name="duration"  id="hour_duration_choice"><div class="input-group bootstrap-timepicker timepicker MR5 W60" name="hourpicker" style="width:35%"><input type="text" maxlength="5" class="form-control picker" name="compoff_hours"></div><span class="ERR MT5 W150"></span></div><div class="col-sm-5 PT5" id="hour_duration_fixed"><span class="ERR MT5 W150"></span></div></div><div class="form-group PT5 time_component"><label class="control-label col-sm-2">'+ZPI18N.getString("zp.leave.workedtime")+'</label><div class="col-sm-5 hrsDts" name="fromtoTime"><div class="input-group bootstrap-timepicker timepicker" style="width:35%" name="timeDiv"><input type="text" name="comp_fromtime" class="form-control" placeholder="'+ZPI18N.getString("zp.from")+'"><span class="input-group-addon"><div class="IC-clock gry CP"></div></span></div><span class="hyphen">-</span><div class="input-group bootstrap-timepicker timepicker" style="width:35%"><input type="text" name="comp_totime" class="form-control" placeholder="'+ZPI18N.getString("zp.to")+'"><span class="input-group-addon"><div class="IC-clock gry CP"></div></span></div><span class="ERR MT5"></span></div></div><div class="form-group PT5 credited_field"><label class="control-label col-sm-2">'+ZPI18N.getString("zp.leave.customform.credited")+'</label><div class="col-sm-3"><input class="form-control ZP-Input W60" name="credited"/></div></div><div class="form-group PT5"><label class="control-label col-sm-2 zp_mdt"><font>'+ZPI18N.getString("zp.expirydate")+'</font></label><div class="col-sm-3"><div class="btnCal"><input type="text" class="form-control ZP-Date W100I" caltype="popup" name="expiry" placeholder="'+ZPI18N.getString("zp.expiry")+'"><span class="ERR MT5"></span></div></div></div><div class="form-group PT5"><label class="control-label col-sm-2" id="reasonLabel"><font>'+ZPI18N.getString("zp.reason")+'</font></label><div class="col-sm-5"><textarea  class="form-control ZP-Textarea" name="description" rows="5"></textarea><span class="ERR MT5"></span></div></div><div class="clearfix"></div><div class="comreqadinfo"><div class="attmdldtals ZPwf MB25" id="attendance_detail"><div class="ZPbold S16 text-center MB20">'+ZPI18N.getString("zp.leave.compensatory.attendancedetails")+'</div><div class="ZPwf MB40">  <div class="Dtyps present-border">    <span class="dgry S12">'+ZPI18N.getString("zp.firstin")+'</span>    <div class="Avadat ZPwf ZPbold PT3" id="firstIn"></div>  </div>  <div class="Dtyps absent-border">    <span class="dgry S12">'+ZPI18N.getString("zp.lastout")+'</span>    <div class="Avadat ZPwf ZPbold PT3" id="lastOut"></div>  </div></div><div class="ZPwf MB15">  <div class="task-cont dgry">'+ZPI18N.getString("zp.overtime")+'</div>  <div class="task-cont ZPbold" id="overTime" ></div></div><div class="ZPwf">  <div class="task-cont dgry">'+ZPI18N.getString("zp.totalhours")+'</div>  <div class="task-cont ZPbold" id="totalHours"></div></div></div><div class="cmreqlvdts ZPwf DN" id="zp_leave_details"><div class="ZPbold S16 LH20 MB20 text-center" style="width: 128px;margin: 0 auto 20px;">'+ZPI18N.getString("zp.leave.compensatory.leavedetails")+"</div></div></form></div>"},Leave.CalSync=function(){"use strict";var MODE,list_grpHTML,list_calHTML,show_authorisation,open_authorise,open_reauthorise,list_groups,get_calendars,list_calendars,push_leave,process_resp,URL="/leave_sync_actions.zp",close_popup_errors=[1002],popup_HTML='<form id="configuration"> <div class="zpl_crd"> <div class="zpl_crdcnt"> <div class="zpl_secn"> <table class="zpl_itbl"> <tbody> <tr> <td > <span id="account_lable"></span> </td> <td><em id="account_id"></em></td> <td><a class="ZP-Revoke">Revoke</a></td> </tr> <tr id="select_grp"></tr>  <tr id="select_cal"></tr> </tbody> </table><div class="zpl_info"> <b>'+ZPI18N.getString("zp.note")+" : </b> "+ZPI18N.getString("zp.leave.calendarsync.office365.syncinfo")+" </div> </div> </div> </div> </form>",process_push_request=function(modal,mode,process_resp){modal.find("#zp_modal_blubtn").attr("disable","disabled").addClass("disabled");var view_params={};Leave.Util.filterCrt(view_params),view_params.leaveyear=Leave.Util.getLYear(ZP.getUserDetailsById(view_params.employee).location,view_params.leaveyear);var req_params={};if(req_params.employee=view_params.employee,req_params.from=view_params.leaveyear.from,req_params.to=view_params.leaveyear.to,req_params.calendar_id=modal.find("[name=calendar_id]").length>0?ZPeopleComponents.select(modal.find("[name=calendar_id]")).getValue():null,0==modal.find("[name=calendar_id]").length&&0==modal.find('[name="group"]').length||"--Select--"!=req_params.calendar_id&&null!=req_params.calendar_id){var params={key:"push_leave"};params.mode=mode,params.req_params=JSON.stringify(req_params),ZPeople.Request.send(URL,params,function(resp){process_resp(resp,!0)&&(modal.find(".conf_data").remove(),modal.find(".zpl_mcnt").css("height","70px")),modal.find("#zp_modal_blubtn").removeAttr("disable").removeClass("disabled"),0==ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.CalendarSync_Data.type&&(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.CalendarSync_Data.type="Office365"==mode?1:2,ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.CalendarSync_Data.gcal_old_integration_exist=!1,Leave.CalSync.assign_integ(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.CalendarSync_Data.type)),"Google"==mode?(ModuleComp.Modal.hide("google_calendar_list"),ModuleComp.Modal.hide("google_pop_up"),ModuleComp.Modal.hide("google_calendar_authorise")):"Office365"==mode&&(ModuleComp.Modal.hide("office365_calendar_list"),ModuleComp.Modal.hide("office365_pop_up")),ModuleComp.Modal.hide("calendar_integration")})}else ModuleComp.Msg.showWarningMsg("Select Calendar id to push leave"),modal.find("#zp_modal_blubtn").removeAttr("disable").removeClass("disabled")},revoke_confirmation=function(mode,process_resp){ModuleComp.Modal.confirm(function(){revoke_integration(mode,process_resp)},"",ZPI18N.getString("zp.leave.calendarsync.revoke.confirm",["Office365"==mode?"Microsoft 365":mode]),ZPI18N.getString("zp.confirm"),void 0,void 0,ZPApprovals.approveOrRejectActionHidden)},revoke_integration=function(mode,process_resp){var params={key:"revoke"},idname="Office365"==mode?"office365":"google";params.mode=mode,ZPeople.Request.send(URL,params,function(resp){process_resp(resp,!0)&&(ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.leave.calendarsync.revoked")),ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.CalendarSync_Data.type=0,Leave.CalSync.assign_integ(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.CalendarSync_Data.type),Layout.Page.container.find("#"+idname+"_pop_up,#"+idname+"_calendar_list").remove(),ModuleComp.Modal.hide("zp_confirmation_pop",!0),"Office365"==mode&&204==resp.statusCode&&IntegrationSettings.msIntegrations.open_InfoPopup())})};return{assign_integ:function(type){var sync=$(".ZP-Sync",Layout.Page.container),text=ZPI18N.getString("zp.leave.calendarsync.init"),callback=Leave.CalSync.init;1==type?(text=ZPI18N.getString("zp.leave.calendarsync.push",["Microsoft 365"]),callback=Leave.CalSync.Office365.init):2==type&&(text=ZPI18N.getString("zp.leave.calendarsync.push",["Google"]),callback=Leave.CalSync.Google.init),sync.off("click"),sync.on("click",function(){callback()}),sync.find("a").html('<span class="IC-sync DIB gry MR5"></span>'+text)},Auth:{open:function(authURL){ModuleComp.Modal.hide("office365_calendar_authorise",!0),Layout.Page.container;var width=.7*screen.width,height=.7*screen.height,left=(screen.width-width)/2,top=(screen.height-.8*screen.height)/2;window.open(authURL,"AuthFromZP","width="+width+",height="+height+",left="+left+",top="+top+",screenX="+left+",screenY="+top)},close:close},init:function(){var modal=ModuleComp.Modal.setup({id:"calendar_integration",type:3,header:ZPI18N.getString("zp.leave.calendarsync.choose"),body:'<div class="zpl_crd"> <div class="zpl_crdcnt"> <div class="d-flexM"> <div class="zpl_synccal logo1" id="Office365"> <span>Microsoft 365</span> </div> <div class="zpl_synccal logo2" id="Google"> <span>Google</span> </div> </div> </div> </div>',buttonValue:ZPI18N.getString("zp.push"),deleteOnHide:!0,closeOnSubmit:!0,disableFooter:!0});modal.find("#Office365")[0].onclick=Leave.CalSync.Office365.init,modal.find("#Google")[0].onclick=Leave.CalSync.Google.init},Office365:(MODE="Office365",list_grpHTML="<td> <span>"+ZPI18N.getString("zp.leave.calendarsync.office365.choosegroup")+'</span> </td> <td> <div class="Select-Grp"></div> </td> <td></td>',list_calHTML="<td> <span>"+ZPI18N.getString("zp.leave.calendarsync.office365.choosecal")+'</span> </td> <td> <div class="Select-Cal"></div> </td> <td></td>',show_authorisation=function(reauthorise){ModuleComp.Modal.hide("office365_pop_up",!0),Layout.Page.container.find("#office365_calendar_authorise").remove(),ModuleComp.Modal.setup({id:"office365_calendar_authorise",type:3,header:ZPI18N.getString("zp.leave.calendarsync.authorise",["Office365"]),successCallback:reauthorise?open_reauthorise:open_authorise,buttonValue:"Authorise",deleteOnHide:!0})},open_authorise=function(){Leave.CalSync.Auth.open(ZPeople.Module.getData("leavetracker").ofc365Calurl)},open_reauthorise=function(){Leave.CalSync.Auth.open(ZPeople.Module.getData("leavetracker").ofc365CalReAuthurl)},list_groups=function(groups,modal){if(groups){modal.find("#configuration").find("table").find("tr#select_grp").append(list_grpHTML);var select=$("<select name='group' class='select-js'><option>--Select--</option></select>");Leave.Util.populate_select(select,groups),modal.find(".Select-Grp").append(select),ZPeopleComponents.select($(modal.find("select[name='group']")),{dropdownList:{appendTo:modal}}),$(modal.find("select[name='group']")).on("zselectchange",function(){get_calendars()})}},get_calendars=function(){var popup=Layout.Page.container.find("#office365_calendar_list .zpl_mcnt"),group_id=ZPeopleComponents.select(popup.find("select[name=group]")).getValue();if(group_id){var params={key:"get_calendars"};params.req_params=JSON.stringify({group_id:group_id}),ZPeople.Request.send(URL,params,list_calendars)}},list_calendars=function(resp){var modal=Layout.Page.container.find("#office365_calendar_list .zpl_mcnt");if(resp.calendars){modal.find("#zp_page_loading").remove(),modal.find("#configuration").find("table").find("tr#select_cal").html(""),modal.find("#configuration").find("table").find("tr#select_cal").append(list_calHTML);var select=$("<select class='select-js' name='calendar_id'></select>");Leave.Util.populate_select(select,resp.calendars),modal.find(".Select-Cal").append(select),ZPeopleComponents.select($(modal.find("select[name='calendar_id']")),{dropdownList:{appendTo:modal}}),$(modal.find("select[name='calendar_id']")).trigger("zselectchange")}},push_leave=function(modal){process_push_request(modal,MODE,process_resp)},process_resp=function(resp,close_popup){if(resp.hasOwnProperty("error_code")){if(1001==resp.error_code)show_authorisation(!1);else{if(1005==resp.error_code)return!1;1003==resp.error_code?function(){Layout.Page.container.find("#office365_calendar_list").remove(),ModuleComp.Modal.hide("office365_pop_up",!0);var modal=ModuleComp.Modal.setup({id:"office365_calendar_list",type:3,header:"",successCallback:push_leave,buttonValue:ZPI18N.getString("zp.push"),deleteOnHide:!0});modal.find("select[name=group]")[0]||(!modal.find(".ctable")[0]&&modal.find(".zpl_mcnt").append(ZPeople.LOADING_HTML),ZPeople.Request.send(URL,{key:"get_groups"},function(resp){var modal=Layout.Page.container.find("#office365_calendar_list .zpl_mcnt");process_resp(resp)&&(modal.find("#zp_page_loading").remove(),modal.append(popup_HTML),modal.find("#account_lable").text(ZPI18N.getString("zp.leave.calendarsync.account",["Microsoft 365"])),modal.find("#account_id").append(resp.user_detail.emailId),modal.find(".ZP-Revoke").on("click",function(){revoke_confirmation(MODE,process_resp)}),list_groups(resp.groups,modal))}))}():1006==resp.error_code?show_authorisation(!0):(ModuleComp.Msg.showWarningMsg(resp.error_msg),-1!=close_popup_errors.indexOf(resp.error_code)&&ModuleComp.Modal.hide("office365_calendar_list"),-1!=close_popup_errors.indexOf(resp.error_code)&&ModuleComp.Modal.hide("office365_pop_up"))}return!1}if(resp.hasOwnProperty("status")&&"success"==resp.status)return resp.success_msg&&ModuleComp.Msg.showSuccessMsg(resp.success_msg),close_popup&&ModuleComp.Modal.hide("office365_calendar_list"),close_popup&&ModuleComp.Modal.hide("office365_pop_up"),!0},{init:function(){ModuleComp.Modal.hide("calendar_integration"),ModuleComp.Modal.hide("office365_pop_up",!0);var params={key:"authorise"};params.mode=MODE;var modal=ModuleComp.Modal.get({id:"office365_pop_up",type:3,header:"",successCallback:push_leave,buttonValue:ZPI18N.getString("zp.push"),deleteOnHide:!0});modal.find("#account_id").text()||(modal.find(".zpl_mcnt").append(ZPeople.LOADING_HTML),ZPeople.Request.send(URL,params,function(resp){var modal=Layout.Page.container.find("#office365_pop_up .zpl_mcnt");ModuleComp.Modal.show(Layout.Page.container.find("#office365_pop_up")),process_resp(resp)?(modal.find("#zp_page_loading").remove(),modal.append(popup_HTML),modal.find("#account_lable").text(ZPI18N.getString("zp.leave.calendarsync.account",["Microsoft 365"])),modal.find("#account_id").text(resp.user_detail.emailId),modal.find(".ZP-Revoke").on("click",function(){revoke_confirmation(MODE,process_resp)})):1005==resp.error_code&&(modal.find("#zp_page_loading").remove(),ModuleComp.Modal.hide("office365_pop_up"),function(resp){Leave.CalSync.Auth.open(ZPeople.Module.getData("leavetracker").ofc365Calurl+"&login_hint="+resp.email)}(resp))})),0==ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.CalendarSync_Data.type&&(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.CalendarSync_Data.type=1,ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.CalendarSync_Data.gcal_old_integration_exist=!1)},show_authorisation:show_authorisation}),Google:function(){var MODE="Google",list_calHTML="<td> <span>"+ZPI18N.getString("zp.leave.calendarsync.office365.choosecal")+'</span> </td> <td> <div class="Select-Cal"></div> </td> <td></td>',show_new_integ_migration=function(){ModuleComp.Modal.hide("google_miration_pop_up",!0),ModuleComp.Modal.setup({id:"google_miration_pop_up",type:3,header:ZPI18N.getString("zp.leave.calendarsync.google.pushtoold"),body:ZPI18N.getString("zp.leave.calendarsync.google.extendingold"),successCallback:migrate_integration,deleteOnHide:!0,buttonValue:ZPI18N.getString("zp.proceed")})},migrate_integration=function(){var params={key:"migrate_gcal_integ"},view_params={};Leave.Util.filterCrt(view_params),view_params.leaveyear=Leave.Util.getLYear(ZP.getUserDetailsById(view_params.employee).location,view_params.leaveyear);var req_params={};req_params.employee=view_params.employee,req_params.from=view_params.leaveyear.from,req_params.to=view_params.leaveyear.to,params.req_params=JSON.stringify(req_params),ZPeople.Request.send(URL,params,process_resp)},show_authorisation=function(){Layout.Page.container.find("#google_calendar_authorise").remove(),ModuleComp.Modal.hide("google_pop_up",!0),ModuleComp.Modal.setup({id:"google_calendar_authorise",type:3,header:ZPI18N.getString("zp.leave.calendarsync.authorise",["Google"]),successCallback:open_authorise,deleteOnHide:!0,buttonValue:"Authorise"})},open_authorise=function(){Leave.CalSync.Auth.open(ZPeople.Module.getData("leavetracker").googleCalurl)},list_calendars=function(resp,modal){if(resp.calendars){modal.find("#configuration").find("table").find("tr#select_cal").html(""),modal.find("#configuration").find("table").find("tr#select_cal").append(list_calHTML);var select=$("<select name='calendar_id'></select>");$.each(resp.calendars,function(idx,opt){select.append($("<option></option>").attr("value",opt.id).attr("opttext",opt.summary).text(opt.summary))}),modal.find(".Select-Cal").append(select),ZPeopleComponents.select($(modal.find("select[name='calendar_id']")),{dropdownList:{appendTo:modal}})}},push_leave=function(modal){process_push_request(modal,MODE,process_resp)},process_resp=function(resp,close_popup){return resp.hasOwnProperty("error_code")?(1001==resp.error_code?show_authorisation():1003==resp.error_code?function(){var params={key:"get_calendars"};params.mode=MODE,ModuleComp.Modal.hide("google_pop_up",!0),Layout.Page.container.find("#google_calendar_list").remove(),ModuleComp.Modal.hide("google_calendar_authorise",!0);var modal=ModuleComp.Modal.setup({id:"google_calendar_list",type:3,header:ZPI18N.getString("zp.gcalsync.syncwithgooglecalendar"),successCallback:push_leave,deleteOnHide:!0,buttonValue:ZPI18N.getString("zp.push")});modal.find("select[name=calendar_id]")[0]||(!modal.find(".ctable")[0]&&modal.find(".zpl_mcnt").append(ZPeople.LOADING_HTML),ZPeople.Request.send(URL,params,function(resp){var modal=Layout.Page.container.find("#google_calendar_list .zpl_mcnt");process_resp(resp)&&(modal.find("#zp_page_loading").remove(),modal.append(popup_HTML),modal.find("#account_lable").text(ZPI18N.getString("zp.leave.calendarsync.account",["Google"])),modal.find("#account_id").text(resp.user_detail.emailId),modal.find(".ZP-Revoke").on("click",function(){revoke_confirmation(MODE,process_resp)}),list_calendars(resp,modal))}))}():1011==resp.error_code?show_new_integ_migration():1006==resp.error_code?resp.email?function(emailId){ModuleComp.Modal.hide("google_pop_up",!0),Layout.Page.container.find("#google_calendar_list").remove(),ModuleComp.Modal.hide("google_calendar_authorise",!0),ModuleComp.Modal.setup({id:"google_calendar_reauthorise",type:3,header:ZPI18N.getString("zp.leave.calendarsync.google.reauthorise"),deleteOnHide:!0,disableFooter:!0});var reauthorise_html='<form> <div class="zpl_crd"> <div class="zpl_crdcnt"> <div class="zpl_secn"> <table class="zpl_itbl"> <tbody> <tr> <td > <span id="account_lable"></span> </td> <td><em id="account_id"></em></td> <td><a class="ZP-Revoke">'+ZPI18N.getString("zp.reauthorize")+'</a></td> </tr> <tr></tr>  <tr></tr> </tbody> </table><div class="zpl_info"> <b>'+ZPI18N.getString("zp.note")+" : </b> "+ZPI18N.getString("zp.leave.calendarsync.google.reauthoriseinfo")+" </div> </div> </div> </div> </form>";let modalPopup=Layout.Page.container.find("#google_calendar_reauthorise .zpl_mcnt");modalPopup.append(reauthorise_html),modalPopup.find("#account_lable").text("Google"+ZPI18N.getString("zp.account")),modalPopup.find("#account_id").text(emailId),modalPopup.find(".ZP-Revoke").on("click",function(){open_authorise()})}(resp.email):show_authorisation():(ModuleComp.Msg.showWarningMsg(resp.error_msg),-1!=close_popup_errors.indexOf(resp.error_code)&&ModuleComp.Modal.hide("google_calendar_list"),-1!=close_popup_errors.indexOf(resp.error_code)&&ModuleComp.Modal.hide("google_pop_up")),!1):resp.hasOwnProperty("status")&&"success"==resp.status?(resp.success_msg&&ModuleComp.Msg.showSuccessMsg(resp.success_msg),close_popup&&ModuleComp.Modal.hide("google_calendar_list"),close_popup&&ModuleComp.Modal.hide("google_pop_up"),!0):void 0};return{init:function(){ModuleComp.Modal.hide("calendar_integration"),ModuleComp.Modal.hide("google_pop_up",!0);var params={key:"authorise"};params.mode=MODE;var modal=ModuleComp.Modal.get({id:"google_pop_up",type:3,header:ZPI18N.getString("zp.gcalsync.syncwithgooglecalendar"),successCallback:push_leave,deleteOnHide:!0,buttonValue:ZPI18N.getString("zp.push")});modal.find("#account_id").text()||(modal.find(".zpl_mcnt").append(ZPeople.LOADING_HTML),ZPeople.Request.send(URL,params,function(resp){var modal=Layout.Page.container.find("#google_pop_up .zpl_mcnt");ModuleComp.Modal.show(Layout.Page.container.find("#google_pop_up")),Layout.Page.container.find("#google_calendar_reauthorise").remove(),process_resp(resp)&&(modal.find("#zp_page_loading").remove(),modal.append(popup_HTML),modal.find("#account_lable").text(ZPI18N.getString("zp.leave.calendarsync.account",["Google"])),modal.find("#account_id").text(resp.user_detail.emailId),modal.find(".ZP-Revoke").on("click",function(){revoke_confirmation(MODE,process_resp)}))})),0==ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.CalendarSync_Data.type&&(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.CalendarSync_Data.type=2,ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.CalendarSync_Data.gcal_old_integration_exist=!1)},initialise_integration:function(){ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.CalendarSync_Data.gcal_old_integration_exist?show_new_integ_migration():Leave.CalSync.Auth.open(ZPeople.Module.getData("leavetracker").ofc365Calurl)},show_authorisation:show_authorisation,delete_authorisation:function(){var params={key:"delete_authorisation"};params.mode=MODE,ZPeople.Request.send(URL,params,process_resp)}}}()}}();var ZP=ZP||{};ZP.create=function(tag,attributes){var ele=document.createElement(tag);for(var att in attributes)"text"===att?ele.appendChild(document.createTextNode(attributes[att])):"html"===att?ele.innerHTML=attributes[att]:ele.setAttribute(att,attributes[att]);return ele},ZP.select=function(options,selected){var select=ZP.create("select",{class:"ZP_Select"});for(var indx in options){var option=options[indx];option.id===selected&&select.appendChild(ZP.create("option",{value:option.id,text:option.text}))}return select},ZP.multiselect=function(options,selected){var select=ZP.create("select",{class:"ZP_MultiSelect",multiple:"multiple"});for(var indx in options){var option=options[indx];option.id===selected&&select.appendChild(ZP.create("option",{value:option.id,text:option.text}))}return select},ZP.date=function(defaultvalue){return ZP.create("div",{class:"btnCal"}).appendChild(ZP.create("input",{class:"form-control",type:"text",value:defaultvalue||""}))},ZP.setAtt=function(ele,attributes){for(var att in attributes)"text"===att?ele.appendChild(document.createTextNode(attributes[att])):ele.setAttribute(att,attributes[att])},ZP.optValue=function(obj,key,defaultvalue){if(void 0!==obj){var data=obj[key];if(void 0!==data)return data}return defaultvalue},ZP.getEmpRow=function(emp_detail,row_class){var row_tr=ZP.create("tr",{class:row_class});return row_tr.appendChild(ZP.getEmpTD(emp_detail.erecno,emp_detail.id,emp_detail.name,emp_detail.photo,!1,emp_detail)),row_tr},ZP.getEmpTD=function(erecno,id,name,photosrc,noCP,emp_detail){var emp_td=ZP.create("td",{name:"employee",class:"fxdtd P_AM",style:"max-width:300px;width:300px;"}),name_tag=ZP.create("span",{class:"ellipsis W200 "+(noCP?"":"CP"),"data-toggle":"tooltip","data-placement":"bottom",title:name});name_tag.appendChild(ZP.create("b",{text:id})),name_tag.appendChild(document.createTextNode(name)),photosrc=photosrc||ZP.getUserDetailsById(erecno).photo;var emp_div=ZP.create("div",{class:"ZPusrName"});return emp_div.appendChild(ZP.create("img",{class:"FL",src:photosrc})),emp_div.appendChild(name_tag),emp_detail.emp_disabled&&emp_div.appendChild(ZP.create("em",{text:"( "+ZPI18N.getString("zp.exitdate")+" - "+emp_detail.doe+" )",class:"ZPsecName"})),emp_td.appendChild(emp_div),emp_td},ZP.getUserDetailsById=function(id){if(id+""!="null"&&id+""!="undefined"&&id+""!="0"){if("-1"==id)return{};var empObj=ZPeople.getUserDetailsById(id),loc=""==empObj.locId?"null":empObj.locId,dept=""==empObj.deptId?"null":empObj.deptId,desg=""==empObj.desiId?"null":empObj.desiId;return{id:id,employee:id,name:decodeHTML(empObj.empid+" "+empObj.name),location:loc,department:dept,photo:empObj.thumb,designation:desg}}},ZP.setToolTipForSelectedOption=function(ele){},ZP.approvalText={"-1":"pending",0:"rejected",1:"approved",2:"cancelled",20:"all"},ZP.dataSelect={1:"self",2:"mydep",3:"all",4:"sub",loc:"5"},Leave.Type={type_txt:{0:ZPI18N.getString("zp.leavetype.paid"),1:ZPI18N.getString("zp.onduty"),2:ZPI18N.getString("zp.leavetype.unpaid"),3:ZPI18N.getString("zp.leavetype.unpaid"),4:ZPI18N.getString("zp.leavetype.compoff"),6:ZPI18N.getString("zp.partiallypaid")},text:function(type){return"5"==type?ZPI18N.getString("zp.restricted")+" "+Holidays.optDisplayNameInSingularForm():this.type_txt[type]}},Leave.period_options={day:{0:ZPI18N.getString("zp.yesterday"),1:ZPI18N.getString("zp.today")},week:{7:ZPI18N.getString("zp.lastweek"),8:ZPI18N.getString("zp.thisweek")},month:{30:ZPI18N.getString("zp.lastmonth"),31:ZPI18N.getString("zp.onlyparticularmonth")},year:{365:ZPI18N.getString("zp.lastyear"),366:ZPI18N.getString("zp.thisyear")},leaveyear:{375:ZPI18N.getString("zp.leave.lastyear"),376:ZPI18N.getString("zp.leave.thisyear")}},Leave.importHelp='<div class="MT30" id="leaveImportHelp"><p><b class="DB dgry">'+ZPI18N.getString("zp.example")+'</b></p><table class="table table-hover S13"><tbody><tr class="TblGryBg "><th class="PL12I" width="50"></th><th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th></tr><tr class="ZPLRow"><th class="PL12I">1</th><td>'+ZPI18N.getString("zp.employeeid")+"</td><td>"+ZPI18N.getString("zp.leavetype")+"</td><td>"+ZPI18N.getString("zp.from")+"</td><td>"+ZPI18N.getString("zp.to")+"</td><td>"+ZPI18N.getString("zp.leave.taken")+'</td><td>Reason for Leave</td></tr><tr class="ZPLRow"><th class="PL12I">2</th><td>Employee 1</td><td>Sick Leave</td><td class="IMPORT_DATE">22-Sep-2016</td><td class="IMPORT_DATE">23-Sep-2016</td><td>2</td><td></td></tr><tr class="ZPLRow"><th class="PL12I">3</th><td>Employee 47</td><td>Casual Hours</td><td class="IMPORT_DATE">02-Dec-2016</td><td class="IMPORT_DATE">02-Dec-2016</td><td>2.30</td><td>Personal Reasons</td></tr><tr class="ZPLRow"><th class="PL12I" colspan="7">*&nbsp&nbsp&nbsp'+ZPI18N.getString("zp.leave.import.help")+"</th>  </tr></tbody></table></div>",Leave.processImportHelp=function(help){return help.find(".IMPORT_DATE").each(function(idx,element){(element=$(element)).text(Calendar.formatDate(Calendar.parseDate(element.text(),"%d-%b-%Y"),uidateFormat))}),help},Leave.Util={classname:{1:"PI_matlv1",2:"PI_btrip",3:"PI_optlv",4:"PI_prvlv",5:"PI_emglv1",6:"PI_caslv1",7:"PI_sicklv",8:"PI_voclv",9:"PI_patlv",10:"PI_tmtrip",11:"PI_compoff",12:"PI_compoff",13:"PI_caslv",14:"PI_erndlv",15:"PI_onduty"},getLVtypeClass:function(code){return Leave.Util.classname[code]},reg:function(){this.regHeader(),this.regBody()},regHeader:function(){var header_cnt=$(".zpl_btnmnu",Layout.Page.container),is4_0=ZPeople.isZPNewUI();if(!header_cnt.data("isreg")){header_cnt.data("isreg",!0);var page_wrap=$("#page-wrapper"),isModuleForm=Layout.UrlConf.isModuleForm(),filter_icon=$(".IC-filter",header_cnt),filter_cnt=$(".ZPFilMain,.ZPPhed",Layout.Page.container),filter_div=filter_cnt.filter(".ZPFilMain");filter_cnt.find("[version="+(is4_0?"3":"4")+"]").remove(),is4_0&&filter_cnt.find("[ignore]").removeAttr("ignore"),Leave.Util.regFilters(filter_cnt),(isModuleForm?$(".IC-cls-1px",filter_cnt):$(".IC-filter,.IC-cls-1px",filter_cnt)).on("click",function(){Leave.Util.toggleFilters(filter_icon,filter_div,page_wrap)});var search_but=$("button.btn-primary",filter_div),reset_but=$("button.btn-default",filter_div),search_callback=Leave.Util.getsearch_callback();if(search_but.on("click",Leave.Util.Search),reset_but.on("click",function(){Leave.Util.resetdata(filter_div)}),filter_cnt.find("select[name=dataSelect],select[name=status],select[name=requestType]").on("change",function(){ZPView.isSystemView()&&search_callback()}),$(".ZP-AdvanceFilter",filter_cnt).on("click",function(){Leave.Util.toggleAdvance()}),$("#syncWithGCalBtn",filter_cnt)[0]&&!ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.CalendarSync_Data.gcal_old_integration_exist&&$("#syncWithGCalBtn",filter_cnt).hide(),-1!=Layout.Page.pageId.indexOf("leavetracker")){var units=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.leaveunit;units&&1!=units.length||"leavetracker-settings"===Layout.Page.pageId||filter_cnt.find("div[name=switchUnit]").remove()}if(-1!=Layout.Page.hash.indexOf("#leavetracker/reports/lop")&&!Leave.Util.isCurPageAdmin()||(LVUtil.urls.CompOff.isHome()||LVUtil.urls.Applications.isHome()||LVUtil.urls.ListView.isHome())&&!ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.allowImport?$(".ZP-Import",header_cnt).remove():($(".ZP-Import",header_cnt).on("click",function(){Leave.Util.importData()}),$(".ZP-Import-ICS",header_cnt).on("click",function(){Holiday.Import.html(),Holiday.Import.showImport()})),$(".ZP-Sync",header_cnt)[0]){$(".ZP-Sync",header_cnt),ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.CalendarSync_Data.type;Leave.CalSync.assign_integ(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.CalendarSync_Data.type)}if(!LVUtil.urls.Applications.isHome()&&!LVUtil.urls.ListView.isHome()||ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.allowExport?isModuleForm||$(".ZP-Export,.ZP-Export-ICS",header_cnt).on("click",function(){Leave.Util.showExport(this)}):$(".ZP-Export",header_cnt).remove(),0===$(".ZP-Export,.ZP-Import,.ZP-Import-ICS,.ZP-ExportPdf,.ZP-ExportIcs,.ZP-Export-ICS,.ZP-Print,.ZP-Sync",header_cnt).length&&$(".impexp",header_cnt).hide(),!isModuleForm){if($(".ZP-ExportPdf",header_cnt).on("click",function(){Leave.Util.exportPdf()}),$(".ZP-ExportIcs",header_cnt).on("click",function(){Leave.Util.exportIcs()}),$(".ZP-Print",header_cnt).on("click",function(){Leave.Util.printReport()}),Layout.Page.container.find(".PI_more").length>0){var pageId=Layout.Page.pageId;Layout.Page.container.find(".PI_more").off("click").on("click",function(){Leave.View.constructMoreOption(),ZPeopleComponents.menu("#moreoptionmenu_"+pageId).show()})}$(".btn-group",filter_div).on("click","button",function(){$(this).removeClass("btn-default").addClass("btn-primary"),$(this).siblings().removeClass("btn-primary").addClass("btn-default"),Layout.Page.call(Layout.Page.hashDtl.callback,{periodchange:!0})});var pager=$(".zpl_cntrdv",header_cnt);if(pager&&Leave.Util.regPager(pager),Leave.Util.add(header_cnt),Layout.Page.container.find("select#lvdtType").length>0){ZPeopleComponents.select(Layout.Page.container.find("select#lvdtType"),{randomDropdownListId:!0,dropdownList:{appendTo:Layout.Page.container}});Layout.Page.container.find("select#lvdtType").on("zselectchange",function(event,edata){Leave.Util.getsearch_callback()(!0,!0)})}if(Layout.Page.container.find("select#lvdtType1").length>0){ZPeopleComponents.select(Layout.Page.container.find("select#lvdtType1"),{randomDropdownListId:!0,dropdownList:{appendTo:Layout.Page.container}});Layout.Page.container.find("select#lvdtType1").on("zselectchange",function(event,edata){Leave.Util.getsearch_callback()(!0,!1)})}$(".btn-warning",header_cnt).on("click",function(){LVUtil.urls.Grant.isHome()?ZPLTGrant.delete():Leave.Util.Row.deleteBulkWarning()}),Layout.Page.container.find("[statictable=true]:visible")&&ZPView.handleTablePosition();var bodyHeader=$(".table-responsive > table > thead",Layout.Page.container);if($(".Tclr",bodyHeader).on("click",function(){Leave.Util.toggleSort(this,bodyHeader),-1!=Layout.Page.pageId.indexOf("leavetracker-reports-user")?Leave.Report.V2.User.get(!0):search_callback()}),showNewTab){let dataselect=filter_cnt.find("select[name=dataSelect]");dataselect.length>0&&(LVUtil.Tab.isMyPage()?(dataselect.find("option[value=1]").siblings().remove(),dataselect.select2("val","1")):LVUtil.Tab.isTeamPage()?(dataselect.find("option[value=2]").siblings().remove(),dataselect.select2("val","2")):LVUtil.Tab.isUserPage()&&(dataselect.find("option[value=2]").siblings().remove(),dataselect.hide(),dataselect.select2("val","2")))}}}},regBody:function(){var data_body=$(".Scrcont",Layout.Page.container);if(!data_body.data("isreg")){var data_table=$("div.table-responsive",data_body).children("table"),header=$("thead",data_table),databody=$("tbody",data_table);$("input:checkbox.headerSelect",header).on("click",function(){Leave.Util.Row.checkAll()}),databody.on("mouseenter","tr",function(){$(this).find("#moreActions,#zpltActions").fadeIn(100)}),databody.on("mouseleave","tr",function(){$(this).find("#moreActions,#zpltActions").parent().removeClass("open"),$(this).find("#moreActions,#zpltActions").fadeOut(100)}),databody.on("click","i,button,label.checkbox,div.checkbox,a",function(){if($(this).hasClass("IC-rou-tik"))Leave.Util.Row.toggleRow(this);else if(!$(this).hasClass("IC-delete")||"leavetracker-settings-leavetype"!==Layout.Page.pageId&&"leavetracker-settings-leavepolicy"!==Layout.Page.pageId){if($(this).hasClass("IC-delete"))Leave.Util.Row.showConfirmMsg(this);else if($(this).hasClass("IC-pen"))Leave.Util.Row.edit(this);else if($(this).hasClass("btn-danger"))Leave.Util.Row.remove(this);else if($(this).hasClass("btn-default")&&LVUtil.urls.ListView.isHome())Leave.Util.Row.hideConfirmMsg(this);else if($(this).hasClass("checkbox"))Leave.Util.Row.selectCheck();else if($(this).hasClass("IC-rfesh")){curTr=this;Leave.Util.Row.restore(curTr)}}else{var curTr=this;ZPeople.BSModal.confirm(function(){Leave.Util.Row.remove(curTr)},ZPI18N.getString("zp.alert"),ZPI18N.getString("zp.leave.leavetype.deletemsg"))}}),data_body.data("isreg",!0)}},regFooter:function(){var data_footer=$("#systemview_pagination.ZPAct",Layout.Page.container);if(!data_footer.data("isreg")){var recordLimit=$(".Recrd",data_footer),getMore=$(".navi",data_footer);recordLimit.find("select").select2(),Leave.Util.Footer.setIndx(1,recordLimit.find("select").val()),data_footer.find("select").on("change",function(){Leave.Util.Footer.changeRecLimit()}),data_footer.find("a#recCount").on("click",function(){$(this).text($(this).data("totalCount"))}),getMore.find("#prevapp").on("click",function(){if($(this).hasClass("CP")){var limit=parseInt(recordLimit.find("select").val()),start=parseInt(getMore.find("span").data("sIndx"))-limit;start=start<1?1:start,Leave.Util.Footer.getMore(start,limit)}}),getMore.find("#nextapp").on("click",function(){if($(this).hasClass("CP")){var limit=parseInt(recordLimit.find("select").val()),start=parseInt(getMore.find("span").data("sIndx"))+limit;Leave.Util.Footer.getMore(start,limit)}}),data_footer.data("isreg",!0)}}},Leave.Util.color3_0={"#2112f5":"#64d5fd","#3399ff":"#5895ff","#7700ff":"#ab4afc","#ff0015":"#cb3888","#ff0000":"#e05654","#ff7f00":"#e87347","#0000ff":"#ee9307","#ff0077":"#cb3888","#feff00":"#f2d613","#00ff00":"#96bc42"},Leave.Util.Search=function(){Leave.Util.getsearch_callback()(),ZPeople.isZPNewUI()&&Leave.Util.showFilters(!1)},Leave.Util.Footer={changeRecLimit:function(){var data_footer=$("#systemview_pagination.ZPAct",Layout.Page.container),recordLimit=($(".navi",data_footer),$(".Recrd",data_footer));Leave.Util.Footer.setIndx(1,recordLimit.find("select").val()),LVUtil.urls.CompOff.isHome()?(Leave.Compensatory.refresh=!0,Layout.Page.call(Layout.Page.hashDtl.callback)):LVUtil.urls.Grant.isHome()?ZPLTGrant.list():LVUtil.urls.Applications.isHome()&&Leave.View.Applications.get()},getMore:function(start,limit){Leave.Util.Footer.setIndx(start,limit),LLVUtil.urls.CompOff.isHome()?(Leave.Compensatory.refresh=!0,Layout.Page.call(Layout.Page.hashDtl.callback)):LVUtil.urls.Grant.isHome()?ZPLTGrant.list():LVUtil.urls.Applications.isHome()&&Leave.View.Applications.get()},onData:function(totalCount,currentPageCount){var data_footer=$("#systemview_pagination.ZPAct",Layout.Page.container),recordLimit=$(".Recrd",data_footer);totalCount&&data_footer.find("a#recCount").data("totalCount",totalCount),totalCount<=recordLimit.find("select").val()&&data_footer.find("a#recCount").text(totalCount);var startIndx=this.getIndx(),endIndx=startIndx+currentPageCount;Leave.Util.Footer.setNavi(startIndx,endIndx)},setNavi:function(start,end){var data_footer=$("#systemview_pagination.ZPAct",Layout.Page.container),getMore=$(".navi",data_footer),next=getMore.find("#nextapp"),prev=getMore.find("#prevapp");parseInt(data_footer.find("select").val());getMore.find("span").html(""),getMore.find("span").append(document.createTextNode(start+" - "+end)),end<data_footer.find("a#recCount").data("totalCount")?Leave.Util.Footer.setClass(next,"blu CP","gry"):Leave.Util.Footer.setClass(next,"gry","blu CP"),start>1?Leave.Util.Footer.setClass(prev,"blu CP","gry"):Leave.Util.Footer.setClass(prev,"gry","blu CP")},setClass:function(ele,add,remove){var data_footer=$("#systemview_pagination.ZPAct",Layout.Page.container);$(".navi",data_footer);ele.addClass(add),ele.removeClass(remove)},getIndx:function(){var data_footer=Layout.Page.container.find(".ZPAct");data_footer.find(".Recrd");return $(".navi",data_footer).find("span").data("sIndx")},setIndx:function(start,limit){var data_footer=$("#systemview_pagination.ZPAct",Layout.Page.container),getMore=$(".navi",data_footer);getMore.find("span").data("sIndx",start),getMore.find("span").data("eIndx",limit)},searchcallback:function(){var data_footer=$("#systemview_pagination.ZPAct",Layout.Page.container),recordLimit=$(".Recrd",data_footer);data_footer.find("a#recCount").text("#"),Leave.Util.Footer.setIndx(1,recordLimit.find("select").val()),LVUtil.urls.Grant.isHome()?ZPLTGrant.list():LVUtil.urls.CompOff.isHome()?Leave.Compensatory.View.get():LVUtil.urls.Applications.isHome()&&Leave.View.Applications.get()}},Leave.Util.getsearch_callback=function(){var search_callback=ZPUtil.getFun(Layout.Page.hashDtl.callback);return LVUtil.urls.ListView.isHome()?search_callback=Leave.View.List.get:LVUtil.urls.Grant.isHome()||LVUtil.urls.CompOff.isHome()||LVUtil.urls.Applications.isHome()?search_callback=Leave.Util.Footer.searchcallback:-1!=Layout.Page.hash.indexOf("#leavetracker/reports/lbalance")?search_callback=Leave.Report.V2.Balance.get:-1!=Layout.Page.hash.indexOf("/views/holiday/")||-1!=Layout.Page.hash.indexOf("/team/holiday/")?search_callback=Holiday.View.list:-1!=Layout.Page.hash.indexOf("holidaycalendar/holidays/list")?search_callback=Holiday.View.list:-1!=Layout.Page.hash.indexOf("workingday/list")?search_callback=Workingday.View.list:-1!=Layout.Page.hash.indexOf("#leavetracker/reports/lop")?search_callback=Leave.Report.LOP.get:-1!=Layout.Page.hash.indexOf("leave/lop")?search_callback=Leave.Reports.lopReport.generateReport:-1!=Layout.Page.hash.indexOf("#leavetracker/reports/bradford")?search_callback=Leave.Report.Bradford.search:-1!=Layout.Page.hash.indexOf("#leavetracker/settings/leavepolicy")?search_callback=Leave.Policy.LT.View.get:-1!=Layout.Page.hash.indexOf("#leavetracker/settings/customizepolicy")?search_callback=Leave.Policy.Customize.View.get:-1!=Layout.Page.hash.indexOf("#leavetracker/settings/customizebalance")&&(search_callback=Leave.Policy.CZBalance.get),search_callback},Leave.Util.MAX_REC=30,Leave.Util.Row={},Leave.Util.Row.checkAll=function(){var data_body=$(".Scrcont",Layout.Page.container),status=$(Layout.Page.container.find(".headerSelect")[0]).is(":checked");data_body.find("input:checkbox").each(function(){$(this).parent().hasClass("disabled")||(this.checked=status)}),Leave.Util.Row.showBulkDelete(status)},Leave.Util.Row.selectCheck=function(){var status=!0,showDelete=!1;$("tbody",Layout.Page.container).find("input:checkbox").each(function(){$(this).is(":checked")?showDelete=!0:status=!1}),status?$(Layout.Page.container.find(".headerSelect")).attr("checked","checked").prop("checked",!0):$(Layout.Page.container.find(".headerSelect")).attr("checked","").prop("checked",!1),Leave.Util.Row.showBulkDelete(showDelete)},Leave.Util.Row.onClick=function(onClick){var data_body=$("tbody",Layout.Page.container);$(data_body).off("click.row").on("click.row","td",function(){if(0==$(this).find("#moreActions,#zpltActions,.checkbox,.btn").length){var rec_id=$(this).closest("tr").attr("_id");onClick(rec_id)}})},Leave.Util.Row.deleteWarning=function(ele){ZPeople.BSModal.setup({id:"zp_confirmation_pop",type:4,header:'<div class="Icn orgbgi"><i class="IC-alert whi S24"></i></div><h4 id="gridSystemModalLabel" class="modal-title ML5">'+ZPI18N.getString("zp.alert")+"</h4>",body:'<div class="form-group"><p class="text-center MB15 PL10">'+ZPI18N.getString("zp.deleteconfirmmessage")+"</p></div></div>",modalClass:"modal fade ZPmdl DelMdl in",buttonValue:ZPI18N.getString("zp.confirm"),successCallback:function(){Leave.Util.Row.remove(ele),ZPeople.BSModal.hide("zp_confirmation_pop"),-1!=Layout.Page.pageId.indexOf("customizebalance")&&Layout.Page.call(Layout.Page.hashDtl.callback)},hiddenCallback:ZPApprovals.approveOrRejectActionHidden,deleteOnHide:!0})},Leave.Util.Row.deleteBulkWarning=function(){ZPeople.BSModal.setup({id:"zp_confirmation_pop",type:4,header:'<div class="Icn orgbgi"><i class="IC-alert whi S24"></i></div><h4 id="gridSystemModalLabel" class="modal-title">'+ZPI18N.getString("zp.confirm")+"</h4>",body:'<div class="form-group"><p class="text-center MB15">'+ZPI18N.getString("zp.leave.deletebulkwarning")+"</p></div></div>",modalClass:"modal fade ZPmdl DelMdl in",buttonValue:ZPI18N.getString("zp.confirm"),successCallback:Leave.Util.Row.deleteBulkRec,hiddenCallback:ZPApprovals.approveOrRejectActionHidden})},Leave.Util.Row.deleteBulkRec=function(){var deleteIds=[],checkedRows=$(".Scrcont",Layout.Page.container).find("tbody input:checkbox:checked");checkedRows.each(function(){var data_rec_id=$(this).closest("tr").data("id");data_rec_id&&deleteIds.push(data_rec_id)});var page=LVUtil.urls.CompOff.isHome()?"compensatory":Layout.Page.pageId.split("-")[2],params={key:"delete",id:deleteIds.join(","),page:page};params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(data){"success"===data.status&&(checkedRows.each(function(){$(this).parents("tr").remove()}),Leave.Util.Row.showBulkDelete(!1),ZPeople.BSModal.hide("zp_confirmation_pop"))})},Leave.Util.add=function(header_cnt){$("button.btnPlus,button.ZP-Add",header_cnt).on("click",function(){var pageid=Layout.Page.pageId;"leavetracker-settings-customizeleave"===pageid?Leave.Settings.CZ.Modify.init():"leavetracker-settings-initialbalance"===pageid?Leave.Settings.IB.Modify.init():"leavetracker-settings-leavetype"===pageid?Leave.Settings.LT.addhtml():"leavetracker-settings-customizebalance"==pageid?Leave.Policy.Transaction.add():LVUtil.urls.ListView.isHome()||LVUtil.urls.Calendar.isHome()?(LVUtil.urls.prevUrl.setHash(),window.location.href=LVUtil.urls.getUrlAsHash(LVUtil.urls.ListView.ADD())):LVUtil.urls.CompOff.isHome()?window.location.href=LVUtil.urls.getUrlAsHash(LVUtil.urls.CompOff.ADD()):"leavetracker-holiday-list"===pageid||"leavetracker-views-holiday"===pageid?window.location.href="#leavetracker/holiday/add":"admin-organization-holidaycalendar-holidays-list"===pageid?window.location.href="#admin/organization/holidaycalendar/holidays/add":"admin-organization-holidaycalendar-workingday-list"===pageid?window.location.href="#admin/organization/holidaycalendar/workingday/add":"leavetracker-settings-workingday-list"===pageid?window.location.href="#leavetracker/settings/workingday/add":"leavetracker-settings-bradford-list"===pageid?window.location.href="#leavetracker/settings/bradford/add":LVUtil.urls.Grant.isHome()&&(window.location.href=LVUtil.urls.getUrlAsHash(LVUtil.urls.Grant.ADD()))})},Leave.Util.toggleAdvance=function(){var filterArea=$(".ZPFil",Layout.Page.container),advanceLink=$(".ZP-AdvanceFilter",filterArea);if(void 0!==advanceLink){var decided_class=$("#page-wrapper").hasClass("Nbar2F")?"Nbar2F2":"Nbar1F2",filterEles=$('[class^="col-md-"]',filterArea);filterEles=filterEles.not(".period_custom"),advanceLink.hide(),filterEles.removeClass("DN"),filterEles.find("input,select").each(function(){$(this).removeAttr("ignore")}),$("#page-wrapper").removeClass("Nbar2F Nbar1F").addClass(decided_class),filterArea.parent(".ZPFilMain").removeClass("TEbnd").addClass("TEbnd1")}},Leave.Util.handleTableHeader=function(){if(Layout.Page.container.find(".Scrcont").hasClass("fixTable")){var bodyTd,tableCont=Layout.Page.container.find(".Scrcont table:first"),headerCont=tableCont.find("thead:visible"),layoutLefPos=Layout.Page.container.offset().left,bodyLeft=tableCont.offset().left;headerCont.css("left",bodyLeft+"px"),headerCont.find("th:first").css("left",layoutLefPos+"px"),headerCont.find(".thMe").each(function(idx,td){td.style.left=layoutLefPos+"px",layoutLefPos+=td.offsetWidth}),tableCont.parent().off("scroll").on("scroll",function(){headerCont.css("left",tableCont.parent().offset().left-$(this).scrollLeft()+"px")}),0!==tableCont.find("tbody[bodyCont=true]").length?(bodyTd=tableCont.find("[bodyCont=true] tr:first > td").not(":first"),headerCont.find("tr:first > th:visible").not(":first").each(function(ind){var width=bodyTd.eq(ind).width()+1;$(this).css("min-width",width+"px").css("max-width","initial"),$(this).css("width",width+"px")})):(bodyTd=tableCont.find("tbody:first tr:first-child").children().not(":first"),headerCont.find("tr").children().not(":first,.thMe").each(function(ind){$(this).css("min-width",bodyTd.eq(ind).width()+9+"px").css("max-width","initial")}))}},Leave.Util.resetdata=function(filter){$(".ZP-Select,.ZP-Input,.ZP-Date,.ZP-Period,.ZP-Checkbox",filter).each(function(){var value=$(this).data("default_val"),name=$(this).attr("name");$(this).is("select")?$(this).select2("val",value):!$(this).is("input")||"incDateOfExit"!==name&&"incDReportsOnly"!==name?$(this).val(value):($(this).parent().removeClass("DNI"),"incDateOfExit"===name?$(this).attr("checked",void 0==value||value):"incDReportsOnly"===name?($(this).attr("checked",void 0!=value&&value),ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?$(this).parent().removeClass("DNI"):$(this).parent().addClass("DNI")):$(this).attr("checked",void 0!=value&&value)),$(this).hasClass("ZP-Date")&&"leavetracker-reports-daily"==Layout.Page.pageId?Leave.Report.Day.dateChange($(this)):"leavetracker-reports-availability"==Layout.Page.pageId&&$(this).is(".ZP-Date,.ZP-Period")&&Leave.Util.changePager($(this)),$(this).is("input")&&"employee"==name&&($(this).data("isreg",!1),Leave.Util.userInputSelect2($(this))),"location"!=name&&"period"!=name&&"leaveyear"!=name&&"period_v2"!=name||$(this).trigger("change")})},Leave.Util.importData=function(){if("leavetracker-holiday-list"===Layout.Page.pageId||"admin-organization-holidaycalendar-holidays-list"===Layout.Page.pageId)Holiday.Import.XLS.importPage();else if(LVUtil.urls.ListView.isHome()||LVUtil.urls.Applications.isHome()){var leaveObj=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops;Import.init(leaveObj.formid,void 0,Layout.Page.hash)}else LVUtil.urls.CompOff.isHome()?Leave.Compensatory.Import.importPage():"leavetracker-settings-customizeleave"===Layout.Page.pageId||"leavetracker-settings-initialbalance"===Layout.Page.pageId?Leave.Settings.Import.importPage():"leavetracker-reports-lop"===Layout.Page.pageId?Leave.Report.LOP.Import.importPage():-1!=Layout.Page.pageId.indexOf("leave-lop")?Leave.Reports.lopReport.Import.importPage():"leavetracker-settings-customizebalance"===Layout.Page.pageId&&Leave.Policy.Transaction.Import.importPage()},Leave.Util.showExport=function(ele){var filters=ZPeople.Module.getData("leavetracker").leave_filterops,showEmpFields="leavetracker-reports-user"!=Layout.Page.pageId&&"leavetracker-settings-customizepolicy"!=Layout.Page.pageId&&(filters.isadmin||filters.isdataadmin||filters.territoryadmin||ZPeople.SUB_USERLIST.length>1),empSelectionHTML='<div class="ZPwf FL PT25" id="emp_fields_select" onclick=Leave.Util.showFieldsForExport(this)><label class="checkbox DIB"><input type="checkbox" name="includeAll"><span>'+ZPI18N.getString("zp.incempfields")+'</span></label></div><div class="chkbx_lsts" style="display: none;"><label class="checkbox DIB"><input type="checkbox" name="empField_4"><span>'+ZPI18N.getString("zp.reportingto")+"</span></label>";filters.entity&&filters.entity.length>0&&(empSelectionHTML=empSelectionHTML+'<label class="checkbox DIB"><input type="checkbox" name="empField_5"><span>'+(ZPeople.orgStructureDispNameMap.hasOwnProperty("entity")?ZPeople.orgStructureDispNameMap.entity:ZPI18N.getString("zp.legalentityname"))+"</span></label>");filters.businessUnit&&filters.businessUnit.length>0&&(empSelectionHTML=empSelectionHTML+'<label class="checkbox DIB"><input type="checkbox" name="empField_6"><span>'+(ZPeople.orgStructureDispNameMap.hasOwnProperty("unit")?ZPeople.orgStructureDispNameMap.unit:ZPI18N.getString("zp.addbusinessunit"))+"</span></label>");filters.division&&filters.division.length>0&&(empSelectionHTML=empSelectionHTML+'<label class="checkbox DIB"><input type="checkbox" name="empField_7"><span>'+(ZPeople.orgStructureDispNameMap.hasOwnProperty("division")?ZPeople.orgStructureDispNameMap.division:ZPI18N.getString("zp.divisionname"))+"</span></label>");filters.department&&filters.department.length>0&&(empSelectionHTML=empSelectionHTML+'<label class="checkbox DIB"><input type="checkbox" name="empField_8"><span>'+ZPI18N.getString("zp.department")+"</span></label>"),empSelectionHTML=empSelectionHTML+'<label class="checkbox DIB"><input type="checkbox" name="empField_9"><span>'+ZPI18N.getString("zp.designation")+"</span></label>",filters.location&&filters.location.length>0&&(empSelectionHTML=empSelectionHTML+'<label class="checkbox DIB"><input type="checkbox" name="empField_10"><span>'+ZPI18N.getString("zp.location")+"</span></label>"),Leave.organizationTag.isEnabled()&&filters.orgTag&&filters.orgTag.length>0&&(empSelectionHTML=empSelectionHTML+'<label class="checkbox DIB"><input type="checkbox" name="empField_11"><span>'+ZPeople.orgTagDisplayName+"</span></label>");var header=Layout.Page.container.find(".ZPPhed"),display_ele=$(".btn-primary i",header);if($(ele).hasClass("ZP-Export-ICS"))Leave.Util.exportICSData();else if(LVUtil.urls.ListView.isHome()||LVUtil.urls.Applications.isHome())ZPExport.showExportContainer(Leave.View.List.exportleave),Leave.Util.showHideExportContainer(!0);else if("leavetracker-reports-lop"===Layout.Page.pageId){var lop_report_crt='<label class="control-label col-sm-3 zp_mdt MT5"><font> Data Details</font></label><div class="col-sm-6"><select id="lop_report_crt"><option value="0">'+ZPI18N.getString("zp.alldata")+'</option><option value="1">'+ZPI18N.getString("zp.leave.lopreport.exportlop")+'</option><option value="2">'+ZPI18N.getString("zp.leave.lopreport.exportadjust")+'</option><option value="3">'+ZPI18N.getString("zp.leave.lopreport.exportloporadj")+"</option></select></div>";if(showEmpFields&&filters.isV2User)lop_report_crt=lop_report_crt+empSelectionHTML;var extr_info={additionalHtml:lop_report_crt,processSelect2:!0};ZPExport.showExportContainer(Leave.Util.exportData,void 0,void 0,extr_info)}else if(showEmpFields&&filters.isV2User&&"leavetracker-reports-daily"===Layout.Page.pageId)if(display_ele.hasClass("IC-chart"))ZPExport.showExportContainer(Leave.Util.exportData);else{extr_info={additionalHtml:empSelectionHTML};ZPExport.showExportContainer(Leave.Util.exportData,void 0,void 0,extr_info)}else if(showEmpFields&&filters.isV2User){extr_info={additionalHtml:empSelectionHTML};ZPExport.showExportContainer(Leave.Util.exportData,void 0,void 0,extr_info)}else ZPExport.showExportContainer(Leave.Util.exportData,void 0,void 0)},Leave.Util.selectAllFieldsForExport=function(ele){var selectAll=$(ele).find("input[name=includeAll]").prop("checked");$(".chkbx_lsts input").prop("checked",selectAll)},Leave.Util.showFieldsForExport=function(ele){var showFields=$(ele).find("input[name=includeAll]").prop("checked");showFields?$(".chkbx_lsts").css("display",""):($(".chkbx_lsts input").prop("checked",showFields),$(".chkbx_lsts").css("display","none"))},Leave.Util.showHideExportContainer=function(show){var exportCont=$("#zp_export_container");show?(exportCont.find("#zp_export_inctabularsec").hide(),exportCont.modal("show")):(exportCont.modal("hide"),exportCont.find("#zp_export_inctabularsec").show())},Leave.Util.exportPdf=function(){var exportForm=$("#zp_export_form","#wrapper").html("");Layout.Page.container.find("#ZPLeave_exp_form").length>0&&(exportForm=Layout.Page.container.find("#ZPLeave_exp_form").html(""));var url,params={};if(Leave.Util.filterCrt(params),params[csrfParamName]=csrfToken,params.exporttype=4,"leavetracker-reports-daily"===Layout.Page.pageId){var header=Layout.Page.container.find(".ZPPhed"),pager_date=$(".ZPCalNav",header).data("date"),date_to_fetch=Calendar.formatDate(pager_date,uidateFormat);params.date=date_to_fetch,params.display=1,url=Leave.Report.exporturl,params.key=Leave.Report.Day.key}else if("leavetracker-reports-availability"===Layout.Page.pageId)url=Leave.Report.exporturl,params.key=Leave.Report.Department.key;else if("leavetracker-reports-balance"===Layout.Page.pageId)url=Leave.Report.exporturl,params.key=Leave.Report.Balance.key;else if("leavetracker-reports-leavetaken"===Layout.Page.pageId)url=Leave.Report.exporturl,params.key=Leave.Report.LTaken.key;else if("leavetracker-reports-payroll"===Layout.Page.pageId){url=Leave.Report.exporturl,delete params[csrfParamName];var parameters={};parameters[csrfParamName]=csrfToken,parameters.key=Leave.Report.Payroll.key,parameters.leaveFilter=JSON.stringify(params),parameters.report_type=$("select[name=report_type]",Layout.Page.container).val(),(params=parameters).key=Leave.Report.Payroll.key}else"leavetracker-reports-rollover"===Layout.Page.pageId?(url=Leave.Report.exporturl,params.key=Leave.Report.Encash.key):"leavetracker-settings-initialbalance"===Layout.Page.pageId?(url=Leave.Settings.exporturl,params.key="list_initialbalance"):"leavetracker-settings-customizeleave"===Layout.Page.pageId?(url=Leave.Settings.exporturl,params.key="list_customizeleave"):"leavetracker-settings-customizebalance"===Layout.Page.pageId?(url=Leave.Policy.exporturl,params.key=Leave.Policy.CZBalance.key):"leavetracker-reports-lbalance"===Layout.Page.pageId?(url=Leave.Report.exporturl2,params.key=Leave.Report.V2.Balance.key):"leavetracker-reports-summary"===Layout.Page.pageId?(url=Leave.Report.exporturl2,params.key=Leave.Report.V2.Summary.key):"leavetracker-reports-bradford"===Layout.Page.pageId&&(url=Leave.Report.exporturl,params.key=Leave.Report.Bradford.key,params.to=params.date,delete params.date,0==params.level&&delete params.level);for(var param in exportForm.attr("action",url),params)exportForm.append(ZP.create("input",{type:"hidden",name:param,value:params[param]}));exportForm.trigger("submit")},Leave.Util.exportData=function(containerId){var exportForm=$("#zp_export_form","#wrapper").html("");Layout.Page.container.find("#ZPLeave_exp_form").length>0&&(exportForm=Layout.Page.container.find("#ZPLeave_exp_form").html(""));var exportcontainer=$(containerId?"#"+containerId:"#zp_export_container"),params={};Leave.Util.filterCrt(params),params[csrfParamName]=csrfToken,params.exporttype=1;var url,fieldsSelected=[];if($(".chkbx_lsts input").each(function(){!0===$(this).prop("checked")&&fieldsSelected.push($(this).attr("name").split("_")[1])}),params.fieldsSelected=fieldsSelected,exptype=$(exportcontainer.find("[name=zp_ftype]:checked")).val(),"xlsx"==exptype?params.exporttype=6:"csv"==exptype?params.exporttype=2:"tsv"==exptype&&(params.exporttype=3),LVUtil.urls.ListView.isHome())url=Leave.View.exporturl,params.key=Leave.View.List.key;else if(LVUtil.urls.Calendar.isHome())url=Leave.View.exporturl,params.key=Leave.View.Calendar.key,params.mode=Leave.View.Calendar.mode,params.month=Leave.View.Calendar.calObj.curMonth,params.year=Leave.View.Calendar.calObj.curYear;else if("leavetracker-reports-daily"===Layout.Page.pageId){url=Leave.Report.exporturl,params.key=Leave.Report.Day.key;var header=Layout.Page.container.find(".ZPPhed"),display_ele=$(".btn-primary i",header);params.display=display_ele.hasClass("IC-chart")?0:1}else if("leavetracker-reports-availability"===Layout.Page.pageId)url=Leave.Report.exporturl,params.key=Leave.Report.Department.key;else if("leavetracker-reports-balance"===Layout.Page.pageId)url=Leave.Report.exporturl,params.key=Leave.Report.Balance.key;else if("leavetracker-reports-leavetaken"===Layout.Page.pageId)url=Leave.Report.exporturl,params.key=Leave.Report.LTaken.key;else if("leavetracker-settings-initialbalance"===Layout.Page.pageId)url=Leave.Settings.exporturl,params.key="list_initialbalance";else if("leavetracker-settings-customizeleave"===Layout.Page.pageId)url=Leave.Settings.exporturl,params.key="list_customizeleave";else if(LVUtil.urls.CompOff.isHome())url=Leave.View.exporturl,params.key="compensatory_view";else if("leavetracker-reports-rollover"===Layout.Page.pageId)url=Leave.Report.exporturl,params.key=Leave.Report.Encash.key;else if("leavetracker-reports-payroll"===Layout.Page.pageId){url=Leave.Report.exporturl,delete params[csrfParamName],(parameters={})[csrfParamName]=csrfToken,parameters.key=Leave.Report.Payroll.key,parameters.leaveFilter=JSON.stringify(params),parameters.report_type=$("select[name=report_type]",Layout.Page.container).val(),params=parameters}else if("leavetracker-reports-user"===Layout.Page.pageId){url=Leave.Report.exporturl2,params.key="view_transactions",params.leavetypeid=Leave.Policy.Transaction.View.ltId;var exportParams=Leave.Policy.Transaction.View.getParams(params.employee,Leave.Policy.Transaction.View.ltId);params.from=exportParams.from,params.to=exportParams.to}else if("leavetracker-reports-lop"===Layout.Page.pageId){var parameters;url=Leave.Report.exporturl,(parameters={})[csrfParamName]=csrfToken,parameters.key=Leave.Report.LOP.key,delete params[csrfParamName],parameters.data_filter=exportcontainer.find("#lop_report_crt").val(),parameters.leaveFilter=JSON.stringify(params),params=parameters}else if("leavetracker-reports-lbalance"===Layout.Page.pageId)url=Leave.Report.exporturl2,params.key=Leave.Report.V2.Balance.key;else if("leavetracker-reports-summary"===Layout.Page.pageId)url=Leave.Report.exporturl2,params.key=Leave.Report.V2.Summary.key;else if("leavetracker-reports-bradford"===Layout.Page.pageId)url=Leave.Report.exporturl,params.key=Leave.Report.Bradford.key,params.to=params.date,delete params.date,0==params.level&&delete params.level;else if("leavetracker-settings-customizebalance"===Layout.Page.pageId)url=Leave.Policy.exporturl,params.key=Leave.Policy.CZBalance.key;else if("leavetracker-settings-customizepolicy"===Layout.Page.pageId){url=Leave.Report.exporturl2,params.key="view_transactions",params.leavetypeid=Leave.Policy.Transaction.View.ltId;exportParams=Leave.Policy.Transaction.View.getParams(params.employee,Leave.Policy.Transaction.View.ltId);params.from=exportParams.from,params.to=exportParams.to}else LVUtil.urls.Grant.isHome()&&(url="zpleave/grant/export",params.listParams=LeaveParams.list({approval:ZPLTGrant.isApprovalConfigured(),dataSelect:!0,footer:!0,sort:!0}).listParams);for(var param in params.fieldsSelected&&(params.fieldsSelected=JSON.stringify(fieldsSelected)),exportForm.attr("action",url),params)exportForm.append(ZP.create("input",{type:"hidden",name:param,value:params[param]}));""!==url&&void 0!==url&&exportForm.trigger("submit")},Leave.Util.exportICSData=function(){"leavetracker-holiday-list"===Layout.Page.pageId||"admin-organization-holidaycalendar-holidays-list"===Layout.Page.pageId?Holiday.Export.ics():Leave.Util.exportData()},Leave.Util.showExportMobileUserError=function(message){ModuleComp.Msg.showFailureMsg(message)},Leave.Util.showBulkExportMsg=function(){setTimeout(function(){if(is5_0Enabled){var infoAlertMessage=new InfoAlertMessage;infoAlertMessage.needButton=!1,infoAlertMessage.title=ZPI18N.getString("zp.leave.report.exportscheduled"),infoAlertMessage.despcription=ZPI18N.getString("zp.leave.report.exportviamail"),infoAlertMessage.setContainerAsBody(!0),infoAlertMessage.show()}else{var modal=parent.ZPeople.BSModal.setup({id:"zp_leaveexport_msg",type:3,modalClass:"modal fade ZPmdl DelMdl in",header:'<div class="Icn orgbgi"><i class="IC-alert whi S24"></i></div><h4 id="gridSystemModalLabel" class="modal-title">'+ZPI18N.getString("zp.leave.report.exportscheduled")+"</h4>",body:ZPI18N.getString("zp.leave.report.exportviamail")});modal.find("p#zp_confirm_body").addClass("MR15"),modal.find(".btn-primary").remove(),modal.find(".btn-default").text(ZPI18N.getString("zp.close"))}},500)},Leave.Util.printReport=function(){var reportStyle="width:2000px;zoom:80%;";-1!=Layout.Page.pageId.indexOf("leavetracker-reports-availability")?reportStyle="width:2000px;zoom:70%;":-1!=Layout.Page.pageId.indexOf("leavetracker-reports-yearly")||-1!=Layout.Page.pageId.indexOf("leavetracker-reports-user")||-1!=Layout.Page.pageId.indexOf("leavetracker-reports-daily")?reportStyle="width:1200px;zoom:80%;":(LVUtil.urls.Calendar.isHome()||-1!=Layout.Page.pageId.indexOf("leavetracker-reports-rollover"))&&(reportStyle="zoom:80%;");var newWindow=window.open();newWindow.focus();var newContent='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html>',copyhead=$("head").clone();copyhead.find("script").each(function(){$(this).remove()});var wholeCont=$("#"+Layout.Page.pageId).clone(),ele=$(wholeCont).find(".ZPPhed").find(".col-md-4")[2]?$(wholeCont).find(".ZPPhed").find(".col-md-4")[2]:$(wholeCont).find(".ZPPhed").find(".col-md-4");$(ele).remove(),$(wholeCont).find(".ZPFil").remove(),$(wholeCont).find("iframe").remove(),$(wholeCont).find("form").remove(),$(wholeCont).find("#ZP_Leave_Reports_Yearly_Chart_Parent").removeClass("tabcont"),$(wholeCont).find(".Scrcont")[0]&&($(wholeCont).find(".Scrcont").children(":eq(0)").removeClass("H100"),$(wholeCont).find(".Scrcont").children(":eq(0)").removeClass("RHLtbl RHFixed"),$(wholeCont).find(".ZPPhed").find(".col-md-8").removeClass("col-md-8").addClass("text-center"),$(wholeCont).find(".ZPPhed").find(".open").removeClass("open"),$(wholeCont).find(".Scrcont").find("li").removeAttr("class"),$(wholeCont).find(".Scrcont").find("a").removeAttr("href"),$(wholeCont).find(".Scrcont").find("a").removeAttr("data-toggle"),$(wholeCont).find(".ZPFilMain").remove(),$(wholeCont).find(".Scrcont").find("i.IC-pen").remove(),$(wholeCont).find("i.IC-ar-lft,i.IC-ar-rgt").remove(),$(wholeCont).find(".Scrcont").find("desc").removeClass("CP"),$(wholeCont).find(".Scrcont").find("table").removeClass("table-hover"),$(wholeCont).find(".Scrcont").find("table").css("page-break-after","auto"),$(wholeCont).find(".Scrcont").find("thead").css("display","table-header-group")),wholeCont.find(".tabcont")[0]&&(wholeCont.find(".tabcont").children(":eq(0)").remove(),wholeCont.find(".tabcont").children(":eq(0)").removeClass("Tlis FLhead"),wholeCont.find(".tabcont").children(":eq(0)").show(),wholeCont.find(".tabcont").children(":eq(0)").find("thead th").each(function(){$(this).html($(this).find("span").html())}),wholeCont.find(".tabcont").css("width","inherit"),wholeCont.find(".tabcont").removeClass("tabcont")),$(wholeCont).find(".ZPDat")[0]&&($(wholeCont).find(".ZPDat").css("left","0px"),$(wholeCont).find(".ZPDat").css("bottom","inherit"),$("#"+Layout.Page.pageId).find(".ZPDat").find("li")[0]&&($(wholeCont).find(".ZPDat").css("right","inherit"),$(wholeCont).find(".ZPDat").css("height","112px"),$(wholeCont).find(".ZPDat").find("li").children().first().removeAttr("style"),$($(wholeCont).find(".ZPDat").find("li")[0].children).css("padding-bottom","15px"),$($(wholeCont).find(".ZPDat").find("li")[0].children).css("padding-top","25px"),$($(wholeCont).find(".ZPDat").find("li")[1].children).css("padding-bottom","23px"),$($(wholeCont).find(".ZPDat").find("li")[1].children).css("padding-top","18px")));var logoCont=$(".ZPHeadLft").clone();$(logoCont).find("i").remove(),newContent+=copyhead.html(),newContent+='<body onload="self.print()" style="overflow:scroll;'+reportStyle+'background: #fff"><div class="ZPHeadLft">',newContent+=logoCont.html(),newContent+='</div><div class="clearfix"></div><hr>',newContent+=wholeCont.html(),newWindow.document.write(newContent),newWindow.document.close()},Leave.Util.printModal=function(ele){var modal=$(ele).parents(".modal"),newWindow=window.open();newWindow.focus();var newContent='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html>',copyhead=$("head").clone();copyhead.find("script").each(function(){$(this).remove()});var modalhtml=$(modal).clone(),body=$(modalhtml).find(".modal-body"),title=ZPI18N.getString("zp.calendarSettings");body.find(".col-sm-offset-4").removeClass("col-sm-offset-4").addClass("col-sm-6"),body.find("h6").removeClass("PL20"),newContent+=copyhead.html(),newContent+='<body style="display: block; overflow: auto; background: rgb(255, 255, 255);" onload="self.print()"><div><nav class="navbar navbar-print-header"><div class="navbar-header ZPwf"><div class="ZPHeadLft">',newContent+=$(".ZPHeadLft").clone().html(),newContent+='</div></div></nav></div><div id="page-wrapper" class="Nbar2"><div class="cont-wrp"><div class="main-wrp"><div style="left:0px;top:105px;"><div class="ZPSSlft P20"><h3 class="MT20">'+title+'</h3><div class="form-horizontal ZPviw  pad MT20" id="zp_form_container"><div class="ZPSScont">',newContent+=body.find(".row").html(),newContent+="</div></div></body></html>",newWindow.document.write(newContent),newWindow.document.close()},Leave.Util.toggleSort=function(curEle,bodyHeader){(curEle=$(curEle)).addClass("ignore"),curEle.hasClass("sort-d")?(curEle.addClass("sort-u"),curEle.removeClass("sort-d")):(curEle.addClass("sort-d"),curEle.removeClass("sort-u")),$(".Tclr:not(.ignore)",bodyHeader).removeClass("Tclr IC-ar-sel sort-d sort-u").addClass("Tclr"),curEle.removeClass("ignore")},Leave.Util.sortParams=function(params){var bodyHeader=$(".table-responsive > table > thead",Layout.Page.container),sortEle=$(".sort-d , .sort-u",bodyHeader);if(sortEle&&sortEle.is(":visible")){var sortBy=sortEle.attr("id");params.sortType=sortEle.hasClass("sort-d")?0:1,params.sortBy=1,"Leavetype"===sortBy?params.sortBy=2:"FromTo"===sortBy?params.sortBy=3:"WorkedDate"===sortBy?params.sortBy=5:"ExpiryDate"===sortBy?params.sortBy=6:"ReportingTo"===sortBy?params.sortBy=7:"Balance"===sortBy?params.sortBy=8:"GrantDate"===sortBy&&(params.sortBy=9)}},Leave.Util.footerParams=function(params){var data_footer=Layout.Page.container.find(".ZPAct"),getMore=(data_footer.find(".Recrd"),$(".navi",data_footer));params.sIndx=getMore.find("span").data("sIndx"),params.limit=getMore.find("span").data("eIndx")},Leave.Util.getMultiLocationLeaveYear=function(location){var lyears=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.leaveyear;if(location){for(var loc_data=lyears[location[0]],isSame_lyear=!0,i=1;i<location.length;i++)if(JSON.stringify(loc_data)!=JSON.stringify(lyears[location[i]])){isSame_lyear=!1;break}loc_data=isSame_lyear?Leave.Util.getLeaveYear(location[0]):Leave.Util.getLeaveYear(-1)}return loc_data},Leave.Util.getLeaveYear=function(key){var lyear_obj=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.leaveyear,arr=[];if(lyear_obj.hasOwnProperty(key)){var years=lyear_obj[key];if("leavetracker-reports-rollover"===Layout.Page.pageId){var obj={id:"all",name:ZPI18N.getString("zp.allyears")};arr.push(obj)}for(var indx in years)"leavetracker-reports-rollover"===Layout.Page.pageId&&years[indx].id>0||arr.push(years[indx]);return arr}years=lyear_obj[-1];if("leavetracker-reports-rollover"===Layout.Page.pageId){obj={id:"all",name:ZPI18N.getString("zp.allyears")};arr.push(obj)}for(var indx in years)"leavetracker-reports-rollover"===Layout.Page.pageId&&years[indx].id>0||arr.push(years[indx]);return arr},Leave.Util.getCurrentLYear=function(key){return Leave.Util.getLYear(key,0)},Leave.Util.getLYear=function(key,lyear){var lyear_obj=Leave.Util.getfilterOptions().leaveyear,lyArr=[];for(var indx in lyArr=lyear_obj.hasOwnProperty(key)?lyear_obj[key]:lyear_obj[-1]){var data_json=lyArr[indx];if(data_json.id==lyear){var url=window.location.href;if(!url||-1===url.indexOf("leavetracker/holiday/gallery")&&-1===url.indexOf("operations/leavetracker/holiday/gallery"))return data_json;if(0==lyear||1==lyear)return data_json}}},Leave.Util.getMultiLocationLYear=function(location,nav){var loc_data=null;if(location){loc_data=Leave.Util.getLYear(location[0],nav);for(var isSame_lyear=!0,i=1;i<location.length;i++)if(JSON.stringify(loc_data)!=JSON.stringify(Leave.Util.getLYear(location[i],nav))){isSame_lyear=!1;break}isSame_lyear||(loc_data=Leave.Util.getLYear(-1,nav))}else loc_data=Leave.Util.getLYear(location,nav);return loc_data},Leave.Util.getLocation=function(employee){var empArr=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.employee;for(var indx in empArr){var data_json=empArr[indx];if(data_json.employee==employee)return data_json.location}},Leave.Util.showFilters=function(show){var header_cnt=$(".ZPPhed",Layout.Page.container),filter_icon=$(".IC-filter",header_cnt),filter_div=$(".ZPFilMain,.ZPPhed",Layout.Page.container).filter(".ZPFilMain");show^filter_icon.hasClass("ZPFilsel")&&Leave.Util.toggleFilters(filter_icon,filter_div,$("#page-wrapper"))},Leave.Util.toggleFilters=function(filter_ele,filter_cnt,page_wrap){var decided_class=showNewTab?"Nbar2":$("#page-wrapper").hasClass("Nbar2")?"Nbar2F":"Nbar1F";decided_class+=$("#page-wrapper").hasClass("THF-2")?" THF-bdgt":"";var filters_parent=filter_cnt.find(".ZPFil").find(".row"),filterChilds=filters_parent.children("[class^=col-md-]:visible"),noOfChilds=filterChilds?filterChilds.length:0,open_class=(noOfChilds+=filters_parent.children(".col-md-3:visible").length/2)>6?decided_class+"2":decided_class,open_class_main=noOfChilds>6?"TEbnd1":"TEbnd";filter_cnt.hasClass(open_class_main)?(filter_ele.removeClass("blu ZPFilsel"),page_wrap.removeClass("Nbar2F2 Nbar2F Nbar1F THF-bdgt").addClass(LVUtil.urls.Applications.isHome()?"Nbar2 Abar1":Layout.Page.hashDtl.wrapperClass),filter_cnt.removeClass(open_class_main)):(filter_ele.addClass("blu ZPFilsel"),page_wrap.removeClass("Nbar2 Nbar5 THF-2").addClass(open_class),filter_cnt.addClass(open_class_main))},Leave.Util.regFilters=function(filter_cnt,record){var data=record||ZPeople.Module.getData("leavetracker").leave_filterops;if(data){$(".ZP-Select,.ZP-Input,.ZP-Date,.ZP-Period,.ZP-Checkbox,.ZP-SwitchCalendar,.ZP-SwitchUnit",filter_cnt).each(function(){var cur_element=$(this),name=cur_element.attr("name");if("employee"===name&&cur_element.parents(".ZPFilMain").length&&cur_element.attr("ismultiple",!0),cur_element.hasClass("ZP-Select"))Leave.Util.regSelect(this,data),cur_element.data("default_val",cur_element.val()),"period"===name&&"leavetracker-reports-balance"===Layout.Page.pageId&&cur_element.select2("val",1);else if(cur_element.hasClass("ZP-Input"))cur_element.val(data[name]),cur_element.data("default_val",data[name]);else if(!cur_element.hasClass("ZP-Date")||"leavetracker-reports-bradford"!==Layout.Page.pageId&&"leavetracker-reports-daily"!==Layout.Page.pageId&&"leavetracker-settings-customizebalance"!==Layout.Page.pageId)if(cur_element.hasClass("ZP-Date"))Leave.Util.regDate(this,data);else if(cur_element.hasClass("ZP-Period"))Leave.Util.regPeriod(this,data,"leavetracker-reports-availability"===Layout.Page.pageId);else if(cur_element.hasClass("ZP-Checkbox")){var val=data[name];val&&cur_element.attr("checked",val),cur_element.data("default_val",val)}else cur_element.hasClass("ZP-SwitchCalendar")?cur_element.on("click",Leave.Util.switchCal):cur_element.hasClass("ZP-SwitchUnit")?(cur_element.on("click",Leave.Util.switchUnit),Layout.Page.container.find("em.leaveunit").text(ZPI18N.getString("Days"==Layout.Page.container.find("li.active.ZP-SwitchUnit").attr("value")?"zp.day.plural":"zp.hourslog"))):cur_element.hasClass("ZP-SwitchCalendar")&&cur_element.on("change",function(){Leave.Util.getsearch_callback()()});else{cur_element.attr("value",ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date),cur_element.data("default_val",ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date);var date_ele=cur_element;cur_element.on("click",function(event){"leavetracker-reports-bradford"!==Layout.Page.pageId?Calendar.setUpCalendar(event,this,void 0,void 0,function(){Leave.Report.Day.dateChange(date_ele)}):Calendar.setUpCalendar(event,this)}),"leavetracker-reports-bradford"!==Layout.Page.pageId&&cur_element.on("input",function(){Leave.Report.Day.dateChange(date_ele)})}cur_element.hasClass("ZP-PayPeriod")&&cur_element.on("change",function(){Leave.Report.LOP.validate_period=!0,Leave.Util.loadPayPeriod();var filters=Layout.Page.container.find("select[name=location]");Leave.Util.regSelect(filters[0],data);var curJson=ZPComponents.Search.Configuration.getJSON();ZPComponents.Search.reset(curJson,!0),Layout.Page.container.find("input[name=employee]").select2("data","").trigger("change"),ZPComponents.Search.create(curJson),Leave.Util.getsearch_callback()(),Leave.Report.LOP.show_generate()})});var period=filter_cnt.find("select[name=period_v2]");period[0]&&period.val(period.attr("default")).trigger("change").data("default_val",period.attr("default")),Layout.Page.container.popover({selector:"[data-popover]",trigger:"click hover",placement:"bottom",delay:{show:50,hide:50}})}},Leave.Util.regSelect=function(ele,data){var name=$(ele).attr("name"),isMultiple=!!$(ele).attr("multiple"),moduleData=ZPeople.Module.getData("leavetracker"),curuser_json=moduleData.leave_filterops.curuser,data_arr=data[name],deptViewPerm=moduleData.leave_filterops.deptViewPerm,temp_doc=document.createDocumentFragment();if(void 0!=name){if("leaveyear"==name)$(".ZPPhed",Layout.Page.container).data("isreg")?data_arr=Leave.Util.getMultiLocationLeaveYear(Layout.Page.container.find("[name=location]").select2("val")):(data_arr=Leave.Util.getLeaveYear(curuser_json.location),curuser_json.leaveyear=0);else if("period"==name)curuser_json.period=1;else if("period_v2"==name)Leave.Util.regPeriod_v2(ele);else if("leavetracker-reports-availability"!==Layout.Page.pageId||Leave.Util.isCurPageAdmin()||"0"!=deptViewPerm&&"1"!=deptViewPerm&&"2"!=deptViewPerm)if("leavetracker-reports-lop"!==Layout.Page.pageId&&"leavetracker-reports-payroll"!==Layout.Page.pageId||"location"!==name)"employeeStatus"==name&&LVUtil.urls.Applications.isHome()?((data_arr=[]).push({id:"3",name:ZPI18N.getString("zp.userandemployeeprofile")}),data_arr.push({id:"1",name:ZPI18N.getString("zp.users")}),data_arr.push({id:"-2",name:ZPI18N.getString("zp.employeeprofile")}),data_arr.push({id:"0",name:ZPI18N.getString("zp.logindisableduser")}),data_arr.push({id:"-1",name:ZPI18N.getString("zp.allemployees")})):"location"==name?$(ele).on("change",function(){var period=Layout.Page.container.find("[name=period_v2]").select2("val"),leaveyear=Layout.Page.container.find("[name=leaveyear]");period?"366"!==period&&"365"!==period&&"367"!==period||Layout.Page.container.find("[name=period_v2]").trigger("change"):leaveyear.length>0&&Leave.Util.regSelect(leaveyear[0],data)}):"org_report_setting"===name&&(data_arr=[],_.each(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.payPeriod,function(rs,idx){data_arr.push({id:rs.rsID,name:ZPeople.escapeHtml(rs.rsName)})}));else{var cur_pp=$(".ZPPhed",Layout.Page.container).find("#org_report_setting").val(),payPeriods=data.payPeriod;for(idx in payPeriods)payPeriods[idx].rsID==cur_pp&&(data_arr=[],$(data[name]).each(function(){var id=$(this)[0].id,name=$(this)[0].name;payPeriods[idx].rsLocations.hasOwnProperty(id)&&data_arr.push({id:id,name:name})}),payPeriods[idx].isAllLocation&&data_arr.push({id:"-2",name:ZPI18N.getString("zp.notspecified")}))}else"department"==name&&moduleData.leave_filterops.depPermDepartments?data_arr=moduleData.leave_filterops.depPermDepartments:"location"==name&&moduleData.leave_filterops.depPermLocs&&(data_arr=moduleData.leave_filterops.depPermLocs),void 0!=data_arr&&""!=data_arr||$(ele).parent().parent().remove();if($(ele).is("input")&&"employee"==name){var isSingleEmp=$(ele).attr("issingleemp"),hasSearchCallBack=$(ele).attr("searchcallback");if(isSingleEmp){var obj=moduleData.leave_filterops.curuser;(LVUtil.urls.ListView.isHome()||LVUtil.urls.Calendar.isHome()||"leavetracker-reports-yearly"===Layout.Page.pageId)&&(obj=$.isEmptyObject(Leave.View.SELECTED_USER)?ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.curuser:Leave.View.SELECTED_USER),$(ele).attr("emp")&&Layout.Page.hash&&(-1!==Layout.Page.hash.indexOf("/reports/bradford/employee")||LVUtil.urls.BradFord.isEmpView())&&(obj=ZP.getUserDetailsById($(ele).attr("emp")));var userObj={id:obj.employee,text:obj.name,html:ZPUtil.escapeHtml(obj.name),photo:obj.photo};$(ele).siblings("img").attr("src",ZP.getUserDetailsById(obj.employee).photo),Leave.Util.userInputSelect2(ele,userObj)}else{Leave.Util.userInputSelect2(ele);var showDRepInpCon=$(Layout.Page.container.find("[name=incDReportsOnly]")[0]);void 0!==showDRepInpCon&&(showDRepInpCon.prop("checked",!1),ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?showDRepInpCon.parent().removeClass("DNI"):showDRepInpCon.parent().addClass("DNI"))}$(ele).attr("ignore")||$(ele).on("change",function(){var selectedVal=$(this).val(),empObj=ZP.getUserDetailsById(selectedVal);Layout.Page.container.find(".Usrimg").attr("src",empObj.photo),(LVUtil.urls.ListView.isHome()||LVUtil.urls.Calendar.isHome()||"leavetracker-reports-yearly"===Layout.Page.pageId)&&(Leave.View.SELECTED_USER=empObj);var dept="-1"!=selectedVal&&"null"!=empObj.department?empObj.department:"-1",loc="-1"!=selectedVal&&"null"!=empObj.location?empObj.location:"-1";if(Layout.Page.container.find("[name=department]").select2("val",dept),Layout.Page.container.find("[name=location]").select2("val",loc),"leavetracker-reports-balance"===Layout.Page.pageId){var period=Layout.Page.container.find("[name=period]")[0]?Layout.Page.container.find("[name=period]").val():Layout.Page.container.find("[name=period_v2]").val(),year=void 0!=period&&period<1?period:0;Leave.Util.populateDateBasedOnLocation(loc,year)}else Layout.Page.container.find("[name=period],[name=period_v2]").trigger("change",[!0]);var showDRepInpCon=$(Layout.Page.container.find("[name=incDReportsOnly]")[0]);void 0!==showDRepInpCon&&(showDRepInpCon.prop("checked",!1),ZPeople.SUB_USERLIST&&ZPeople.SUB_USERLIST.length>1?(showDRepInpCon.parent().removeClass("DNI"),""==selectedVal?showDRepInpCon.parent().removeClass("DNI"):showDRepInpCon.parent().addClass("DNI")):showDRepInpCon.parent().addClass("DNI")),hasSearchCallBack&&(LVUtil.urls.ListView.isHome()?Leave.View.List.get():LVUtil.urls.Calendar.isHome()?(Leave.View.Calendar.calObj=void 0,Leave.View.Calendar.init()):LVUtil.urls.CompOff.isHome()?Leave.Compensatory.View.get():Leave.Util.getsearch_callback()())})}else if("applicableFor"===name)$(ele).children().each(function(){var optname=$(this).attr("name");data_arr=data[optname],"location"===optname&&void 0!==(spocJson=moduleData.leave_filterops.spocReportJson)&&void 0!==spocJson[optname]&&(data_arr=Leave.SPOCSettings.mergeJsonWithoutDuplicates(data_arr,spocJson[optname])),data_arr&&Leave.Util.populate_select($(this),data_arr,void 0,void 0,!0)}),$(ele).select2();else{if(data_arr){if("leavetype"!=name||-1==Layout.Page.pageId.indexOf("leavetracker-settings")&&-1==Layout.Page.pageId.indexOf("leavetracker-reports-summary")&&!LVUtil.urls.Grant.isHome()){if((data_arr.length>1||Leave.Util.isCurPageAdmin())&&"employee"===name&&(temp_doc.appendChild(ZP.create("option",{selected:"selected",text:ZPI18N.getString("zp.allemployees"),value:"-1"})),$(ele).on("change",function(){var erecno=$(this).val();if("-1"!=erecno){var emp_data=ZP.getUserDetailsById(erecno);Layout.Page.container.find("[name=department]").select2("val","null"!=emp_data.department?emp_data.department:"-1"),Layout.Page.container.find("[name=location]").select2("val","null"!=emp_data.location?emp_data.location:"-1").trigger("change")}})),!(data_arr.length>1||Leave.Util.isCurPageAdmin())||"location"!==name||-1==Layout.Page.pageId.indexOf("leavetracker-reports-balance")&&-1==Layout.Page.pageId.indexOf("leavetracker-reports-leavetaken")||$(ele).on("change",function(){var loc=$(this).val(),period=Layout.Page.container.find("[name=period]").val(),year=void 0!=period&&period<1?period:0;Leave.Util.populateDateBasedOnLocation(loc,year)}),"period"===name?$(ele).on("change",function(){var type=$(this).val(),loc=Layout.Page.container.find("[name=location]").val();1==type?(Leave.Util.populateDateBasedOnLocation(loc,0),Layout.Page.container.find("[name=to]").val(moduleData.leave_filterops.cur_period.cur_date).prop("disabled",!1)):(Leave.Util.populateDateBasedOnLocation(loc,type),Layout.Page.container.find("[name=to]").attr("disabled","disabled"))}):"employeeStatus"===name&&$(ele).on("change",function(){var flt_cnt=$(".ZPFil",Layout.Page.container);if(null!=ZPComponents.Search.Configuration.getJSON()&&(ZPComponents.Search.reset(ZPComponents.Search.Configuration.getJSON(),!0),flt_cnt.find("[name=employee]").select2("val","").trigger("change"),ZPComponents.Search.create(ZPComponents.Search.Configuration.getJSON())),isMultiple){var selectedStatus=$(ele).val(),incDtOfExitInp=$(Layout.Page.container.find("[name=incDateOfExit]")[0]);null!=selectedStatus&&-1!=selectedStatus.indexOf("18")?incDtOfExitInp.parent().removeClass("DNI"):incDtOfExitInp.parent().addClass("DNI")}}),0==data_arr.length)return void $(ele).parent().parent().remove();if("department"===name||"location"===name||"designation"===name){var spocJson,isEntryAllowed=moduleData.leave_filterops.isSPOCLvViewEnabled,isReportAllowed=moduleData.leave_filterops.isSPOCLvReportViewEnabled;-1!=Layout.Page.pageId.indexOf("leavetracker-reports-")?isReportAllowed&&void 0!==(spocJson=moduleData.leave_filterops.spocReportJson)&&void 0!==spocJson[name]&&(data_arr=Leave.SPOCSettings.mergeJsonWithoutDuplicates(data_arr,spocJson[name])):-1==Layout.Page.pageId.indexOf("leavetracker-settings-")&&isEntryAllowed&&void 0!==(spocJson=moduleData.leave_filterops.spocViewJson)&&void 0!==spocJson[name]&&(data_arr=Leave.SPOCSettings.mergeJsonWithoutDuplicates(data_arr,spocJson[name]))}for(var indx in data_arr){var data_json=data_arr[indx],opttext=ZPeople.decodeTxt(data_json.name);"leavetracker-settings-leavetype"===Layout.Page.pageId?-1==data_json.id&&"employee"!==name?temp_doc.appendChild(ZP.create("option",{selected:"selected",text:opttext,value:data_json.id})):"-1"==data_json.id&&isMultiple||temp_doc.appendChild(ZP.create("option",{text:opttext,value:data_json.id})):(!Leave.Util.isCurPageAdmin()||"leaveyear"===name||"period"===name||LVUtil.urls.Calendar.isHome()&&"department"==name||"leavetracker-reports-availability"===Layout.Page.pageId&&("department"==name||"location"==name))&&data_json.id===curuser_json[name]&&"employee"!==name&&"designation"!==name?temp_doc.appendChild(ZP.create("option",{selected:"selected",text:opttext,value:data_json.id})):"-1"==data_json.id&&isMultiple||temp_doc.appendChild(ZP.create("option",{text:opttext,value:data_json.id}))}}else{var optionCnt=0;$.each(data_arr,function(idx,opt){($(ele).attr("skipAll")||"-1"!=opt.id)&&(2==opt.type||4==opt.type||$(ele).attr("isV2")&&!opt.isV2||$(ele).attr("isgrantbased")&&!opt.isGrantBased)||(temp_doc.appendChild(ZP.create("option",{text:ZPeople.decodeTxt(opt.name),value:opt.id})),optionCnt++)}),0==optionCnt&&temp_doc.appendChild(ZP.create("option",{text:"-Select-",value:"0"})),$(ele).attr("searchcallback")&&$(ele).on("change",Leave.Util.getsearch_callback())}ele.innerHTML="",ele.appendChild(temp_doc)}if(("leavetracker-reports-lop"===Layout.Page.pageId||"leavetracker-reports-payroll"===Layout.Page.pageId)&&"org_report_setting"===name){var locPP=Leave.Util.getReportSetingsConfByLoc(curuser_json.location);locPP&&$("[name=org_report_setting]",Layout.Page.container).select2("val",locPP.rsID)}$(ele).select2({closeOnSelect:!isMultiple}),"employeeStatus"===name&&(isMultiple?$(ele).select2("val",[19,-2,18]):$(ele).select2("val",3))}}},Leave.Util.regPeriod_v2=function(ele){var load=ele.getAttribute("load");-1!=(load=""==load?["day","month","year"]:load.split(",")).indexOf("leaveyear")&&ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.period.length<3&&delete Leave.period_options.leaveyear[365],load.forEach(function(loadFor){var options=Leave.period_options[loadFor];for(var id in options)ele.appendChild(ZP.create("option",{text:options[id],value:id}))}),ele.appendChild(ZP.create("option",{text:ZPI18N.getString("zp.custom"),value:"1000"})),$(ele).on("change",function(event,isFromEmpChange){var from=Layout.Page.container.find("[name=from]").val(),to=Layout.Page.container.find("[name=to]").val();if(Leave.Util.populateDateFilter(ele.value),1!=isFromEmpChange&&(from!==Layout.Page.container.find("[name=from]").val()||to!==Layout.Page.container.find("[name=to]").val())&&$("input[name=employee]",Layout.Page.container)[0]){ZPComponents.Search.reset(ZPComponents.Search.Configuration.getJSON(),!0);var empData=Layout.Page.container.find("input[name=employee]").select2("data");Layout.Page.container.find("input[name=employee]").select2("data",""),ZPComponents.Search.create(ZPComponents.Search.Configuration.getJSON()),Layout.Page.container.find("input[name=employee]").select2("data",empData)}})},Leave.Util.populateDateFilter=function(period){var dateFields=$(".ZP-Date",Layout.Page.container);if(1e3!=period){dateFields.attr("disabled",!0);var date=Leave.Util.getPeriod(period);if(dateFields[0]){var first_name=dateFields[0].getAttribute("name");"date"==first_name?(dateFields[0].value=Calendar.formatDate(date.from,uidateFormat),Layout.Page.container.find(".ZPCalNav")&&(Layout.Page.container.find(".ZPCalNav").text(Leave.Util.pagerDisplayDate(date.from,"Day")).data("date",date.from),Layout.Page.container.find(".ZP-DayPager").data("date",date.from))):"from"==first_name&&dateFields[1]&&"to"==dateFields[1].getAttribute("name")&&(dateFields[0].value=Calendar.formatDate(date.from,uidateFormat),dateFields[1].value=Calendar.formatDate(date.to,uidateFormat),Layout.Page.container.find(".ZPCalNav")[0]&&Leave.Util.changePager(dateFields[0]))}}else dateFields.prop("disabled",!1)},Leave.Util.getPeriod=function(period){var from,to,cur_period=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period;switch(period){case"0":from=Calendar.parseDate(cur_period.cur_date,uidateFormat),to=from=new Date(from.setDate(from.getDate()-1));break;case"1":to=from=Calendar.parseDate(cur_period.cur_date,uidateFormat);break;case"2":from=Calendar.parseDate(cur_period.cur_date,uidateFormat),to=from=new Date(from.setDate(from.getDate()+1));break;case"7":(from=Calendar.parseDate(cur_period.cur_date,uidateFormat)).setDay(weekstarts-7),(to=new Date(from)).setDay(weekstarts+6);break;case"8":(from=Calendar.parseDate(cur_period.cur_date,uidateFormat)).setDay(weekstarts),(to=new Date(from)).setDay(weekstarts+6);break;case"9":(from=Calendar.parseDate(cur_period.cur_date,uidateFormat)).setDay(weekstarts+7),(to=new Date(from)).setDay(weekstarts+6);break;case"30":(from=Calendar.parseDate(cur_period.month_start,uidateFormat)).setMonth(from.getMonth()-1),(to=Calendar.parseDate(cur_period.month_end,uidateFormat)).setDate(1),to.setDate(0);break;case"31":from=Calendar.parseDate(cur_period.month_start,uidateFormat),to=Calendar.parseDate(cur_period.month_end,uidateFormat);break;case"32":(from=Calendar.parseDate(cur_period.month_start,uidateFormat)).setMonth(from.getMonth()+1),(to=new Date(from)).setMonth(to.getMonth()+1),to.setDate(0);break;case"365":var location=$("[name=location]",Layout.Page.container).val(),loc_data=Leave.Util.getMultiLocationLYear(location,-1);from=Calendar.parseDate(loc_data.from,uidateFormat),to=Calendar.parseDate(loc_data.to,uidateFormat);break;case"366":location=$("[name=location]",Layout.Page.container).val(),loc_data=Leave.Util.getMultiLocationLYear(location,0);from=Calendar.parseDate(loc_data.from,uidateFormat),to=Calendar.parseDate(loc_data.to,uidateFormat);break;case"367":location=$("[name=location]",Layout.Page.container).val(),loc_data=Leave.Util.getMultiLocationLYear(location,1);from=Calendar.parseDate(loc_data.from,uidateFormat),to=Calendar.parseDate(loc_data.to,uidateFormat)}return{from:from,to:to}},Leave.Util.switchCal=function(){var switchMode=$(this).attr("value");if(switchMode!==Leave.View.Calendar.mode){$(this).addClass("active");var filter_icon=$(".IC-filter",Layout.Page.container);if("department"===switchMode)Leave.View.Calendar.mode="department",filter_icon.removeClass("DN"),Layout.Page.container.find("#employeeSearch").addClass("DN"),Layout.Page.container.find("li[value=user]").removeClass("active");else if(Leave.View.Calendar.mode="user",filter_icon.addClass("DN"),Layout.Page.container.find("#employeeSearch").removeClass("DN"),Layout.Page.container.find("li[value=department]").removeClass("active"),filter_icon.hasClass("ZPFilsel")){var page_wrap=$("#page-wrapper"),filter_div=$(".ZPFilMain,.ZPPhed",Layout.Page.container).filter(".ZPFilMain");Leave.Util.toggleFilters(filter_icon,filter_div,page_wrap)}Layout.Page.call(Layout.Page.hashDtl.callback,{periodchange:!0})}},Leave.Util.switchUnit=function(){$(this).hasClass("active")||($(this).addClass("active"),$(this).siblings("li").removeClass("active"),Layout.Page.call(Layout.Page.hashDtl.callback),Layout.Page.container.find("em.leaveunit").text(ZPI18N.getString("Days"==this.getAttribute("value")?"zp.day.plural":"zp.hourslog")))},Leave.Util.regPeriod=function(period_ele,data,regPager,isFromHistory){var value="",year_end=(period_ele=$(period_ele)).attr("year_end");if(void 0!=$(period_ele).val()&&(value=$(period_ele).val()),!isFromHistory){var cur_period=Holiday.isHolidayPage()?"":ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period;if(Holiday.isHolidayPage()){var duration=ZPeople.Module.getData("leavetracker").leave_filterops;value=duration.from+"-"+duration.to}else if("leavetracker-reports-availability"===Layout.Page.pageId)value=cur_period.month_start+"-"+cur_period.month_end;else{var lyJson=Leave.Util.getCurrentLYear(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.curuser.location);value=year_end?lyJson.from+"-"+lyJson.to:lyJson.from+"-"+cur_period.cur_date}}period_ele.val(value),period_ele.data("default_val",value),period_ele.on("click",function(event){regPager?Calendar.setUpDoubleCalendar(event,this,void 0,void 0,function(){Leave.Util.changePager(period_ele);var dates=Leave.Util.getDoubleCalFromTo(period_ele.val());Leave.Util.Validate.noofDays(dates.from,dates.to,30,ZPI18N.getString("zp.datewithindays",["31"]))}):Calendar.setUpDoubleCalendar(event,this)})},Leave.Util.regDate=function(ele,data){var name=$(ele).attr("name"),value="";if("leavetracker-reports-availability"===Layout.Page.pageId&&"from"==name)value=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.month_start;else if("leavetracker-reports-availability"===Layout.Page.pageId&&"to"==name)value=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.month_end;else if("leaveyear_from"===name||"from"===name){value=Leave.Util.getCurrentLYear(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.curuser.location).from}else if("leaveyear_to"===name||"to"===name){value=Leave.Util.getCurrentLYear(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.curuser.location).to}else"cur_date"===name?(value=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date,$(ele).attr("name","to")):value=data[name];$(ele).val(value),$(ele).data("default_val",value),$(ele).on("click",function(event){Calendar.setUpCalendar(event,this,void 0,void 0,function(){-1==Layout.Page.hash.indexOf("leavetracker/compensatory/add")&&-1==Layout.Page.hash.indexOf("leavetracker/compensatory/edit")||"date"!=name?-1!=Layout.Page.hash.indexOf("leavetracker/reports/availability")&&Leave.Util.changePager(ele):(Leave.Compensatory.Add.changeExpiry($(ele)),Leave.Compensatory.fetchAndShowAttendanceDetails())})})},Leave.Util.populateLeaveYear=function(location){var ele=Layout.Page.container.find("select[name=leaveyear]");ele.find("option").remove();var data_arr=Leave.Util.getLeaveYear(location),temp_doc=document.createDocumentFragment();for(var indx in data_arr){var data_json=data_arr[indx],opttext=data_json.name;0==data_json.id?temp_doc.appendChild(ZP.create("option",{selected:"selected",text:opttext,value:data_json.id})):temp_doc.appendChild(ZP.create("option",{text:opttext,value:data_json.id}))}ele.append(temp_doc),ele.select2("val","0")},Leave.Util.populateDateBasedOnLocation=function(loc,lyear){var yr=lyear||0,loc_data=Leave.Util.getMultiLocationLYear(loc,yr);if(Layout.Page.container.find("[name=leaveyear_from]").val(loc_data.from),Layout.Page.container.find("[name=from]").val(loc_data.from),LVUtil.urls.ListView.isHome()||"leavetracker-reports-yearly"===Layout.Page.pageId){var header_cnt=$(".ZPPhed",Layout.Page.container);$(".ZPCalNav",header_cnt).data("date",loc_data.from+" - "+loc_data.to),$(".ZPCalNav",header_cnt).data("year",yr),Leave.Util.checkNavigation(yr),$("b.ZPCalNav",header_cnt).text(loc_data.from+" - "+loc_data.to)}var todate=1==Layout.Page.container.find("[name=period]").val()?ZPeople.Module.getData("leavetracker").leave_filterops.cur_period.cur_date:loc_data.to;Layout.Page.container.find("[name=to]").val(todate),Layout.Page.container.find("[name=fromto]").val(loc_data.from+"-"+loc_data.to),Leave.Util.populateLeaveYear(loc)},Leave.Util.regPager=function(ele){if($(ele).hasClass("ZP-DayPager")||$(ele).hasClass("ZP-WeekSEPager")||$(ele).hasClass("ZP-MonthPager")||$(ele).hasClass("ZP-MonthSEPager")||$(ele).hasClass("ZP-YearPager")||$(ele).hasClass("ZP-PayPeriodPager")){var prev=$(ele).find(".PI_alft"),next=$(ele).find(".PI_argt"),pagetype=$(ele).attr("class"),cur_period=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period;if("pager ZP-MonthSEPager"==pagetype){if($(ele).find("#pager_from").data("date",Calendar.parseDate(cur_period.month_start,uidateFormat)),$(ele).find("#pager_to").data("date",Calendar.parseDate(cur_period.month_end,uidateFormat)),"leavetracker-reports-availability"===Layout.Page.pageId){var fromtext=$(ele).find("#pager_from"),month=fromtext.data("date");fromtext.text(Leave.Util.pagerDisplayDate(month,"Month")),$(ele).find("#pager_to,#pager_split").hide()}else Leave.Util.addOrReduceDates(ele,0);$(prev).on("click",function(){Leave.Util.navDecider($(ele),pagetype,-1)}),$(next).on("click",function(){Leave.Util.navDecider($(ele),pagetype,1)})}if("pager ZP-PayPeriodPager"==pagetype)Leave.Util.loadPayPeriod(),$(prev).on("click",function(){Leave.Util.navPayPeriod(ele,-1)}),$(next).on("click",function(){Leave.Util.navPayPeriod(ele,1)});else{if("zpl_cntrdv ZP-YearPager"==pagetype){var lyJson=Leave.Util.getCurrentLYear(void 0!=LVUtil.urls.getCurrentPageUser()?ZPeople.getUserDetailsById(LVUtil.urls.getCurrentPageUser()).locId:ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.curuser.location);$(ele).data("date",lyJson.from+" - "+lyJson.to),$(ele).data("year",0),Leave.Util.checkNavigation(0)}else"zpl_cntrdv ZP-WeekSEPager"==pagetype?($(ele).find("#pager_from").data("date",Calendar.parseDate(cur_period.week_start,uidateFormat)),$(ele).find("#pager_to").data("date",Calendar.parseDate(cur_period.week_end,uidateFormat))):$(ele).data("date",Calendar.parseDate(cur_period.cur_date,uidateFormat));Leave.Util.addOrReduceDate(ele,pagetype,0),$(prev).on("click",function(){if(!$(prev).hasClass("gry")){if(Leave.Util.addOrReduceDate(ele,pagetype,-1),"leavetracker-reports-daily"===Layout.Page.pageId)Leave.Report.Day.dateChange(ele);else if("leavetracker-reports-yearly"===Layout.Page.pageId&&!Leave.Report.LYear.refresh)return;if(showNewTab&&LVUtil.Tab.isResAvail()){var filCont=Layout.Page.container.find("#lvfilter");ZPeopleComponents.select(Layout.Page.container.find("#lvfilter").find("[name=periodV2]")).setValue("1000"),ZPeopleComponents.datefield(filCont.find("[name=lvfrom]")).setValue($(ele).find("#pager_from").data("date"),uidateFormat),ZPeopleComponents.datefield(filCont.find("[name=lvto]")).setValue($(ele).find("#pager_to").data("date"),uidateFormat)}Layout.Page.container.find("[name=period_v2]").val("1000").trigger("change"),Leave.Util.changeField(ele,"Year"),Layout.Page.call(Layout.Page.hashDtl.callback,{periodchange:!0})}}),$(next).on("click",function(){if(!$(next).hasClass("gry")){if(Leave.Util.addOrReduceDate(ele,pagetype,1),"leavetracker-reports-daily"===Layout.Page.pageId)Leave.Report.Day.dateChange(ele);else if("leavetracker-reports-yearly"===Layout.Page.pageId&&!Leave.Report.LYear.refresh)return;if(showNewTab&&LVUtil.Tab.isResAvail()){var filCont=Layout.Page.container.find("#lvfilter");ZPeopleComponents.select(Layout.Page.container.find("#lvfilter").find("[name=periodV2]")).setValue("1000"),ZPeopleComponents.datefield(filCont.find("[name=lvfrom]")).setValue($(ele).find("#pager_from").data("date"),uidateFormat),ZPeopleComponents.datefield(filCont.find("[name=lvto]")).setValue($(ele).find("#pager_to").data("date"),uidateFormat)}Layout.Page.container.find("[name=period_v2]").val("1000").trigger("change"),Leave.Util.changeField(ele,"Year"),Layout.Page.call(Layout.Page.hashDtl.callback,{periodchange:!0})}})}}},Leave.Util.navDecider=function(ele,pagetype,count){var fromtext=ele.find("#pager_from"),totext=ele.find("#pager_to"),from_date=fromtext.data("date"),to_date=totext.data("date"),monthStart=new Date(from_date.getFullYear(),from_date.getMonth(),1),monthEnd=new Date(from_date.getFullYear(),from_date.getMonth()+1,0);if(from_date.getTime()===monthStart.getTime()&&to_date.getTime()===monthEnd.getTime())Leave.Util.addOrReduceDates(ele,count,"Month"),Leave.Util.changeField(ele,"Month");else if(from_date.getTime()<=to_date.getTime()){var noofdays=Leave.Util.getDateDiff(from_date,to_date);Leave.Util.addOrReduceDates(ele,noofdays*count,"Day",count),Leave.Util.changeField(ele,"Day")}else ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.datewithinonemonth"));Layout.Page.container.find("[name=period_v2]").val("1000").trigger("change"),Layout.Page.call(Layout.Page.hashDtl.callback,{periodchange:!0})},Leave.Util.addOrReduceDates=function(ele,count,cAttr,prevNxt){var process_from,process_to,fromtext=ele.find("#pager_from"),totext=ele.find("#pager_to"),from_date=fromtext.data("date"),to_date=totext.data("date");"Month"==cAttr?(process_from=new Date(from_date.getFullYear(),from_date.getMonth()+count,1),process_to=new Date(from_date.getFullYear(),from_date.getMonth()+(count+1),0),fromtext.text(Leave.Util.pagerDisplayDate(process_from,"Month"))):"Day"==cAttr&&(count>0?(process_from=new Date(from_date.getFullYear(),from_date.getMonth(),from_date.getDate()+count),process_to=new Date(process_from.getFullYear(),process_from.getMonth(),process_from.getDate()+count)):count<0?(process_to=new Date(to_date.getFullYear(),to_date.getMonth(),to_date.getDate()+count-1),process_from=new Date(process_to.getFullYear(),process_to.getMonth(),process_to.getDate()+count)):0==count&&(process_from=new Date(from_date.getFullYear(),from_date.getMonth(),from_date.getDate()+prevNxt),process_to=new Date(to_date.getFullYear(),to_date.getMonth(),to_date.getDate()+prevNxt)),fromtext.text(Leave.Util.pagerDisplayDate(process_from,"Day")),totext.text(Leave.Util.pagerDisplayDate(process_to,"Day"))),fromtext.data("date",process_from),totext.data("date",process_to)},Leave.Util.addOrReduceDate=function(ele,pagertype,count){var process_date=new Date(curdate,curmonth,curyear),pagedate=$(ele).data("date"),year=$(ele).data("year"),datetext=0==$(ele).find(".ZPCalNav").length?$(ele).find("#ZPleave_yearnavtxt"):$(ele).find(".ZPCalNav");if(-1!=pagertype.indexOf("ZP-DayPager"))process_date=new Date(pagedate.setDate(pagedate.getDate()+count)),datetext.text(Leave.Util.pagerDisplayDate(pagedate,"Day"));else if(-1!=pagertype.indexOf("ZP-MonthPager"))process_date=new Date(pagedate.setMonth(pagedate.getMonth()+count)),datetext.text(Leave.Util.pagerDisplayDate(pagedate,"Month"));else if(-1!=pagertype.indexOf("ZP-WeekSEPager")){var week_count=0;-1==count?week_count=-7:1==count&&(week_count=7);var from_date=$(ele).find("#pager_from").data("date"),to_date=$(ele).find("#pager_to").data("date");from_date=new Date(from_date.setDate(from_date.getDate()+week_count)),to_date=new Date(to_date.setDate(to_date.getDate()+week_count)),$(ele).find("#pager_from").text(Calendar.formatDate(from_date,uidateFormat)),$(ele).find("#pager_to").text(Calendar.formatDate(to_date,uidateFormat))}else if(-1!=pagertype.indexOf("ZP-YearPager")){var empObj=-1!=Layout.Page.hash.indexOf("selfservice")?ZP.getUserDetailsById(SelfService.getUserId()):ZP.getUserDetailsById(LVUtil.urls.getCurrentPageUser()),loc="null"!=(empObj=empObj||ZP.getUserDetailsById(erecno)).location?empObj.location:"-1",lyJson=Leave.Util.getLYear(loc,year+count);Leave.Util.checkNavigation(year+count),lyJson&&($(ele).data("year",year+count),$(ele).data("fromDate",lyJson.from),$(ele).data("toDate",lyJson.to),datetext.text(lyJson.from+" - "+lyJson.to),LVUtil.urls.ListView.isHome()?Leave.View.List.refresh=!0:"leavetracker-reports-yearly"===Layout.Page.pageId?Leave.Report.LYear.refresh=!0:"leavetracker-holiday-list"===Layout.Page.pageId&&(Holiday.View.refresh=!0))}return $(ele).data("date",process_date),process_date},Leave.Util.checkNavigation=function(count){var pager=Layout.Page.container.find(".ZP-YearPager");Leave.Util.getLYear(void 0,count-1)?(pager.find(".IC-ar-lft").removeClass("gry"),pager.find(".IC-ar-lft").addClass("blu CP"),pager.find(".PI_alft").removeClass("gry"),pager.find(".PI_alft").addClass("blu CP")):(pager.find(".IC-ar-lft").removeClass("blu CP"),pager.find(".IC-ar-lft").addClass("gry"),pager.find(".PI_alft").removeClass("blu CP"),pager.find(".PI_alft").addClass("gry")),Leave.Util.getLYear(void 0,count+1)?(pager.find(".IC-ar-rgt").removeClass("gry"),pager.find(".IC-ar-rgt").addClass("blu CP"),pager.find(".PI_argt").removeClass("gry"),pager.find(".PI_argt").addClass("blu CP")):(pager.find(".IC-ar-rgt").removeClass("blu CP"),pager.find(".IC-ar-rgt").addClass("gry"),pager.find(".PI_argt").removeClass("blu CP"),pager.find(".PI_argt").addClass("gry"))},Leave.Util.pagerDisplayDate=function(date,pagertype){return"Day"===pagertype?date.getDate()+" "+months[date.getMonth()]+" "+date.getFullYear():"Month"===pagertype?months[date.getMonth()]+" "+date.getFullYear():void 0},Leave.Util.changePager=function(ele){var name,dateEle=$(ele);if("fromto"===(name=dateEle.attr("name")))var dates=Leave.Util.getDoubleCalFromTo(dateEle.val()),from=Calendar.parseDate(dates.from,uidateFormat),to=Calendar.parseDate(dates.to,uidateFormat);else"from"!==name&&"to"!==name||(from=Calendar.parseDate($("[name=from]",Layout.Page.container).val(),uidateFormat),to=Calendar.parseDate($("[name=to]",Layout.Page.container).val(),uidateFormat));Layout.Page.container.find("#pager_from").text(Leave.Util.pagerDisplayDate(from,"Day")).data("date",from),Layout.Page.container.find("#pager_split").show(),Layout.Page.container.find("#pager_to").text(Leave.Util.pagerDisplayDate(to,"Day")).data("date",to).show()},Leave.Util.changeField=function(pager,cAttr){var pagerEle=$(pager);if(pagerEle.hasClass("ZP-MonthSEPager")){var from=pagerEle.find("#pager_from").data("date"),to=pagerEle.find("#pager_to").data("date");Layout.Page.container.find("[name=fromto]").val(Calendar.formatDate(from,uidateFormat)+"-"+Calendar.formatDate(to,uidateFormat)),Layout.Page.container.find("[name=from]").val(Calendar.formatDate(from,uidateFormat)),Layout.Page.container.find("[name=to]").val(Calendar.formatDate(to,uidateFormat)),Layout.Page.container.find("[name=period_v2]").val("1000").trigger("change"),"Month"==cAttr?pagerEle.find("#pager_split, #pager_to").hide():pagerEle.find("#pager_split, #pager_to").show()}else if(pagerEle.hasClass("ZP-YearPager")){var fromField=Layout.Page.container.find("[name=from]"),toField=Layout.Page.container.find("[name=to]");if(fromField[0]&&toField[0]){from=pagerEle.data("fromDate"),to=pagerEle.data("toDate");Layout.Page.container.find("[name=from]").val(from),Layout.Page.container.find("[name=to]").val(to)}}},Leave.Util.getEmpFilterValue=function(){return $(".ZPFil,.ZPPhed",Layout.Page.container).find("[name=employee]").val()},Leave.Util.filterCrt=function(params){var filter_cnt=$(".ZPFil,.ZPPhed,.zpl_btnmnu",Layout.Page.container);Leave.Util.params(filter_cnt,params);var flt_cnt=$(".ZPFil",Layout.Page.container);return filter_cnt.hasClass("ZPFil")?"leavetracker-reports-lop"==Layout.Page.pageId||"leavetracker-reports-payroll"==Layout.Page.pageId?params.employee&&$("[name=employee]",flt_cnt).length>0&&(params.employee=params.employee.split(",")):(params.department&&(params.department=JSON.stringify(params.department)),params.designation&&"object"==typeof params.designation&&(params.designation=JSON.stringify(params.designation)),params.location&&(params.location=JSON.stringify(params.location)),params.orgTag&&(params.orgTag=JSON.stringify(params.orgTag)),params.employee&&$("[name=employee]",flt_cnt).length>0&&(params.employee=JSON.stringify(params.employee.split(","))),params.leavetype&&"leavetracker-reports-summary"!=Layout.Page.pageId&&(params.leavetype=JSON.stringify(params.leavetype)),params.entity&&(params.entity=JSON.stringify(params.entity)),params.businessUnit&&(params.businessUnit=JSON.stringify(params.businessUnit)),params.division&&(params.division=JSON.stringify(params.division)),params.bradford&&(params.bradford=JSON.stringify(params.bradford)),LVUtil.urls.Applications.isHome()||params.employeeStatus&&(params.employeeStatus=JSON.stringify(params.employeeStatus))):params.isExportFromLeave&&params.employee&&(params.employee=JSON.stringify(params.employee.split(","))),params},Leave.Util.params=function(parent,params){if($("select:not([name=report_type],[name=period_v2]),input",parent).each(function(){var ele=$(this),name=ele.attr("name"),isMultiple=!!$(ele).attr("multiple"),ignore=ele.attr("ignore");if(name&&!ignore)if(ele.is("input:checkbox"))ele.is(":checked")?params[name]=!0:params[name]=!1;else if("fromto"===name){var dates=Leave.Util.getDoubleCalFromTo(ele.val(),!0);params.from=dates.from,params.to=dates.to}else"cur_date"===name&&-1!=Layout.Page.pageId.indexOf("customizebalance")?params.to=ele.val():"employeeStatus"===name?ele.val()?params[name]=ele.val():isMultiple&&(params[name]=[19,-2,18]):ele.val()&&(isMultiple?null!=ele.val()&&ele.val().length>0&&(params[name]=ele.val()):params[name]=ele.val())}),1==parent.find("div.ZP-YearPager").length?params.leaveyear=parent.find("div.ZP-YearPager").data("year"):params.leaveyear=0,1==parent.find("li.active[name=leaveunit]").length&&(params.leaveunit=parent.find("li.active[name=leaveunit]").attr("value")),1==parent.find("li.active[name=unit]").length&&(params.unit=parent.find("li.active[name=unit]").attr("value")),showNewTab&&!LVUtil.Tab.isTeamPage()&&(void 0==params.employee&&void 0!==Layout.Page.urlparam.id?params.employee=Layout.Page.urlparam.id:params.employee=erecno),1==parent.find("ul.ZP-PayPeriodPager").length){var filterpayperiod=$(".ZP-PayPeriodPager",Layout.Page.container).data("payperiod");filterpayperiod&&(params.from=Calendar.formatDate(filterpayperiod.start),params.to=Calendar.formatDate(filterpayperiod.end))}},Leave.Util.getDoubleCalFromTo=function(dateval,isSearch,isFromHistory){var dates={};if(!isFromHistory){var cur_period=ZPeople.Module.getData("leavetracker").leave_filterops.cur_period;dates={from:cur_period.month_start,to:cur_period.month_end}}var splted=dateval.split("-");return""==dateval&&isSearch?dates:(-1==uidateFormat.indexOf("-")?(dates.from=splted[0],dates.to=1==splted.length?dates.from:splted[1]):(dates.from=splted[0]+"-"+splted[1]+"-"+splted[2],dates.to=3==splted.length?dates.from:splted[3]+"-"+splted[4]+"-"+splted[5]),dates)},Leave.Util.bar=function(details,isDay){var formdiv=ZP.create("div",{class:"row"}),datediv=ZP.create("div",{class:" col-sm-offset-3 col-sm-3"});datediv.appendChild(ZP.create("a",{text:details.day+"  "+details.date,date:details.date})),formdiv.appendChild(datediv);var progressparent=ZP.create("div",{class:"col-sm-5 col-progrs"}),progressbarouter=ZP.create("div",{class:"progress Pbar"}),barwidth=details.ishalfday&&details.isquarterday?"75":details.ishalfday&&!details.isquarterday?"50":!details.ishalfday&&details.isquarterday?"25":"100";if(!isDay&&!details.isholiday){var fullDayHrs=Leave.Form.fullDayMins/60,hours=parseInt(details.defaultValue.split(":")[0])+parseInt(details.defaultValue.split(":")[1])/60;barwidth=100*hours/fullDayHrs>100?100:100*hours/fullDayHrs}var lcolor=details.color;if("object"==typeof lcolor&&2===lcolor.length){var width="50";for(var indx in lcolor)progressbarouter.appendChild(Leave.Util.progressBar(indx,lcolor[indx],width)),width=details.isquarterday?"25":width}else progressbarouter.appendChild(Leave.Util.progressBar(void 0,details.color,barwidth));return progressparent.appendChild(progressbarouter),formdiv.appendChild(progressparent),formdiv},Leave.Util.progressBar=function(count,color,barwidth,session,leftTime,rightTime,isHourLeave,initialWidth){var progressbar=ZP.create("div",{class:"progress-bar "+color+" PR",role:"progressbar","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":barwidth,style:"width:"+barwidth+"%;"});if(0==count?progressbar.appendChild(ZP.create("div",{class:"lf CP","data-toggle":"tooltip","data-placement":"top",title:leftTime||""})):1==count?(progressbar.appendChild(ZP.create("div",{class:"md CP","data-toggle":"tooltip","data-placement":"top",title:leftTime||""})),progressbar.appendChild(ZP.create("div",{class:"rg CP","data-toggle":"tooltip","data-placement":"top",title:rightTime||""}))):(progressbar.appendChild(ZP.create("div",{class:"lf CP","data-toggle":"tooltip","data-placement":"top",title:leftTime||""})),progressbar.appendChild(ZP.create("div",{class:"rg CP","data-toggle":"tooltip","data-placement":"top",title:rightTime||""}))),session>1){var left=isHourLeave?25*(session-1):barwidth*(session-1);initialWidth=initialWidth||0;var total=parseFloat(initialWidth)+parseFloat(barwidth)+parseFloat(left);left-=total>100?total-100:0,$(progressbar).css("left",left+"%")}return progressbar},Leave.Util.leaveDays={html:function(details,isDay,type,includeHourFields,disableFullDay,timeInputType){var formdiv=ZP.create("div",{class:"row"+(isDay||2!=timeInputType?"":" fmtorw")}),datediv=null;(datediv=LVUtil.Form.getCurrFormParam().isfromProjects?ZP.create("div",{class:"col-sm-4",style:"width:30%"}):ZP.create("div",{class:LVUtil.Form.isViewMode()?"col-sm-5":"col-sm-4"})).appendChild(ZP.create("a",{class:"MT8 DB",text:details.day+"  "+details.date,date:details.date})),formdiv.appendChild(datediv);var div1=null,div2=null;LVUtil.Form.getCurrFormParam().isfromProjects?(div1=ZP.create("div",{class:"col-sm-4",style:"width:140px"}),div2=ZP.create("div",{class:"col-sm-4",id:"div2_dropdown",style:"width:140px; padding:0 0 0 42px"})):(div2=ZP.create("div",{class:"col-sm-4",id:"div2_dropdown"}),div1=2==timeInputType?ZP.create("div",{class:"col-sm-8",id:"dtDiv"}):ZP.create("div",{class:"col-sm-4",id:"dtDiv"}));ZP.create("div",{class:"col-sm-5"});return LVUtil.Form.isViewMode()?(div1=ZP.create("div",{class:"col-sm-7 col-progrs"}),Leave.Util.leaveDays.view(div1,isDay,details)):Leave.Util.leaveDays.add(div1,div2,isDay,details,type,includeHourFields,disableFullDay,timeInputType),formdiv.appendChild(div1),0!=type||LVUtil.Form.isViewMode()?formdiv.appendChild(div2):($(datediv).removeClass("col-sm-4").addClass("col-sm-6"),$(div1).removeClass("col-sm-4").addClass("col-sm-6"),$(div1).hasClass("col-sm-8")&&$(div1).removeClass("col-sm-8").addClass("col-sm-6")),formdiv},view:function(durationDiv,isDay,details){var text="";isDay?(text="1",details.isholiday?text="0":details.ishalfday?text="0.5":details.isquarterday&&(text="0.25")):text=details.defaultValue;var progressbarouter=ZP.create("div",{class:"progress Pbar"}),barwidth=details.ishalfday?"50":details.isquarterday?"25":"100",startTime=Leave.Util.convertMinutestoTime(details.startTime),endTime=Leave.Util.convertMinutestoTime(details.endTime);if(!isDay&&!details.isholiday){var fullDayHrs=details.max_mins/60,hours=parseInt(details.defaultValue.split(":")[0])+parseInt(details.defaultValue.split(":")[1])/60;barwidth=100*hours/fullDayHrs>100?100:100*hours/fullDayHrs}var lcolor=details.color;if("object"==typeof lcolor&&2===lcolor.length){var leaveWidth=details.isquarterday?"25":"50";if("ZPLHoli"==lcolor[0]){var firstBarType=4==details.leaveSession?2:0,leaveSession=details.leaveSession>2?details.leaveSession-2:details.leaveSession;progressbarouter.appendChild(Leave.Util.progressBar(firstBarType,lcolor[0],50,1,void 0,firstBarType?void 0:startTime)),progressbarouter.appendChild(Leave.Util.progressBar(1,lcolor[1],leaveWidth,leaveSession,startTime,endTime,!isDay,50))}else{firstBarType=leaveWidth<50&&(25!=leaveWidth||2!=details.leaveSession)?2:0;progressbarouter.appendChild(Leave.Util.progressBar(firstBarType,lcolor[0],leaveWidth,details.leaveSession,startTime,endTime,!isDay,50)),progressbarouter.appendChild(Leave.Util.progressBar(1,lcolor[1],50,2,firstBarType?void 0:endTime,void 0,!isDay,leaveWidth))}}else progressbarouter.appendChild(Leave.Util.progressBar(void 0,details.color,barwidth,details.leaveSession,startTime,endTime,!isDay));if(durationDiv.appendChild(progressbarouter),"0"!=text){var countDiv=ZP.create("div",{class:"tot-prgtime"});countDiv.appendChild(ZP.create("span",{text:text})),isDay?countDiv.appendChild(document.createTextNode(" "+ZPI18N.getString("zp.days"))):countDiv.appendChild(document.createTextNode(" "+ZPI18N.getString("zp.leavetype.hrs"))),durationDiv.appendChild(countDiv)}},add:function(div1,div2,isDay,details,type,includeHourFields,disableFullDay,timeInputType){if(details.isholiday){var dropDown=ZP.create("select",{class:"W100 table-select selct-wdth",name:details.date,disabled:"disabled",style:"display:none"}),text=1==details.holidayWeekend||details.isweekend?ZPI18N.getString("zp.weekend"):Holiday.optDisplayNameInSingularForm();dropDown.appendChild(ZP.create("option",{value:"0",text:text})),div1.appendChild(dropDown),div2.appendChild(ZP.create("select",{class:"W100 table-select selct-wdth",name:details.date,disabled:"disabled",style:"display:none"})),2==timeInputType&&div2.classList.add("DN")}else if(isDay||includeHourFields){var periodEle=ZP.create("select",{class:"W100 table-select selct-wdth dayinput",name:details.date,id:"periods",style:"display:none",onchange:"Leave.Util.leaveDays.addSessions(this);Leave.Form.Summary.refresh()"}),sessionEle=ZP.create("select",{class:"W100 table-select selct-wdth dayinput",name:details.date,id:"sessions",style:"display:none",onchange:"Leave.Form.Summary.refresh()"});if(div1.appendChild(periodEle),div2.appendChild(sessionEle),$(periodEle).data("details",details),Leave.Util.leaveDays.addPeriods(periodEle,type,details,disableFullDay),Leave.Util.leaveDays.addSessions(periodEle,sessionEle,!0),isDay||($(div1).empty(),$(div2).empty()),includeHourFields){var hide=1!=timeInputType;isDay&&(hide=!0),div1.appendChild(Leave.Util.leaveDays.startTime(details,hide)),div2.appendChild(Leave.Util.leaveDays.hours(details,hide)),div1.appendChild(Leave.Util.leaveDays.startTime(details,hide,!0)),div1.appendChild(Leave.Util.leaveDays.hyphen(hide)),div1.appendChild(Leave.Util.leaveDays.endTime(details,hide,!0)),div1.appendChild(Leave.Util.leaveDays.calculateHours(div1,hide))}}else{hide=1!=timeInputType;div1.appendChild(Leave.Util.leaveDays.startTime(details,hide)),div2.appendChild(Leave.Util.leaveDays.hours(details,hide)),div1.appendChild(Leave.Util.leaveDays.startTime(details,!hide,!0)),div1.appendChild(Leave.Util.leaveDays.hyphen(!hide)),div1.appendChild(Leave.Util.leaveDays.endTime(details,!hide,!0)),div1.appendChild(Leave.Util.leaveDays.calculateHours(div1,!hide))}},addPeriods:function(ele,type,details,disableFullDay){details.ishalfholiday||disableFullDay||ele.appendChild(ZP.create("option",{value:"1",text:ZPI18N.getString("zp.fullday"),selected:"selected"})),(2==type||3==type||details.ishalfholiday)&&ele.appendChild(ZP.create("option",{value:"0.5",text:ZPI18N.getString("zp.halfday")})),1!=type&&3!=type||ele.appendChild(ZP.create("option",{value:"0.25",text:ZPI18N.getString("zp.quarterday")})),details.ishalfday?$(ele).val("0.5"):details.isquarterday&&$(ele).val("0.25")},addSessions:function(periodEle,sessionEle,skipDefault){var period=$(periodEle).val(),details=$(periodEle).data("details");if(sessionEle=sessionEle||$(periodEle).parents(".choose-leave-type>.row").find("#sessions"),$(sessionEle).prop("disabled",!1).empty(),"1"==period)$(sessionEle).attr("disabled","disabled");else if("0.5"==period){for(var i=1;i<=2;i++)if(details.holidaySession!=i){var option=this.session(i,.5);details.leaveSession==i&&$(option).attr("selected","selected"),$(sessionEle).append(option)}}else if("0.25"==period)for(i=1;i<=4;i++)if(!(1==details.holidaySession&&-1!=[1,2].indexOf(i)||2==details.holidaySession&&-1!=[3,4].indexOf(i))){option=this.session(i,.25);details.leaveSession==i&&$(option).attr("selected","selected"),$(sessionEle).append(option)}(!details.leaveSession||!skipDefault)&&$(sessionEle).select2("val",$(sessionEle).find("option").eq(0).val())},session:function(sessionNum,value){var key="zp."+Leave.Util.getDateWithSuffix(sessionNum+"");return key+="0.25"==value?"quarter":"half",ZP.create("option",{value:sessionNum,count:value,daysession:sessionNum,text:ZPI18N.getString(key)})},startTime:function(details,hide,isFromto){var showhide=hide?"DN":isFromto?"DIB":"",startTime=details&&details.startTime?details.startTime:0,classname=(details.max_mins,details.defaultValue,isFromto?"fromToTime":"hourinput"),timeparent=ZP.create("div",{class:"MB0I VM "+showhide+" "+classname}),timeDiv=ZP.create("div",{class:"input-group bootstrap-timepicker timepicker selected-hrs"}),timeEle=ZP.create("input",{type:"text",class:(LVUtil.Form.getCurrFormParam().isfromProjects?"form-control":"form-control W90")+" "+(isFromto?"fromToTime":""),val:Leave.Util.convertMinutestoTime(startTime),name:details?details.date:"",id:"from_time"});return timeDiv.appendChild(timeEle),timeparent.appendChild(timeDiv),$(timeEle).timepicker({showMeridian:!Leave.Util.is24HrTimeFormat(),disableMousewheel:!1,minuteStep:1,defaultTime:Leave.Util.convertMinutestoTime(startTime)}),isFromto&&$(timeEle).on("changeTime.timepicker",function(e){Leave.Form.Summary.refresh()}),timeparent},endTime:function(details,hide,isFromto){var showhide=hide?"DN":isFromto?"DIB":"",startTime=details&&details.startTime?details.startTime:0,maxMins=details.max_mins,toTime=(details.defaultValue,details&&details.endTime?details.endTime:0),classname=isFromto?"fromToTime":"hourinput",timeparent=ZP.create("div",{class:"MB0I VM "+showhide+" "+classname}),timeDiv=ZP.create("div",{class:"input-group bootstrap-timepicker timepicker selected-hrs"}),timeEle=ZP.create("input",{type:"text",class:(LVUtil.Form.getCurrFormParam().isfromProjects?"form-control":"form-control W90")+" "+(isFromto?"fromToTime":""),val:Leave.Util.convertMinutestoTime(toTime),name:details?details.date:"",id:"to_time"}),rmMin=0,temp=maxMins,isDef=!0;if(details.default_mins||(temp=toTime,isDef=!1),startTime>toTime)if(!Leave.Util.is24HrTimeFormat()&&startTime+temp>=1440)rmMin=temp-(1440-startTime);else rmMin=temp;else rmMin=isDef?startTime+temp:temp;return timeDiv.appendChild(timeEle),timeparent.appendChild(timeDiv),$(timeEle).timepicker({showMeridian:!Leave.Util.is24HrTimeFormat(),disableMousewheel:!1,minuteStep:1,defaultTime:Leave.Util.convertMinutestoTime(rmMin)}),isFromto&&$(timeEle).on("changeTime.timepicker",function(e){var from=$(this).parents(".col-sm-8").find(".fromToTime").find("input#from_time").val(),to=$(this).val(),temp=Leave.Util.getTimeDiff(from,to);if((temp=temp%1==0?parseInt(temp):temp)>maxMins)return $(this).val(from).trigger("change"),void $(this).timepicker("setTime",from);Leave.Form.Summary.refresh()}),timeparent},hyphen:function(hide){var showhide=hide?"DN":"DIB";return ZP.create("div",{class:"MB0I VM PL10 PR10 fromToTime "+showhide,text:"-"})},calculateInBtwHrs:function(div1){var fromTime=$(div1).find(".fromToTime").find("input#from_time").val(),toTime=$(div1).find(".fromToTime").find("input#to_time").val(),inbtwnhrs=0,temp=Leave.Util.getTimeDiff(fromTime,toTime);return temp=temp%1==0?parseInt(temp):inbtwnhrs,(inbtwnhrs=Leave.Util.convertToHoursandMinutes(temp))+" "+ZPI18N.getString("zp.leavetype.hrs")},calculateHours:function(div1,hide){var inbtwnhrs=Leave.Util.leaveDays.calculateInBtwHrs(div1),showhide=hide?"DN":"",div=ZP.create("div",{class:"ttlhrs "+showhide,text:inbtwnhrs});return LVUtil.Form.getCurrFormParam().isfromProjects,div},hours:function(details,hide,timeInputType){var hour=details.defaultValue,maxMins=details.max_mins,showhide=hide?"DN":"",labelDiv=ZP.create("label",{class:"MB0I VM hourinput "}),hrsDiv=ZP.create("div",{class:"input-group bootstrap-timepicker timepicker selected-hrs hourinput "+showhide}),hrsTaken=ZP.create("input",{type:"text",class:"form-control",name:"hrs",value:hour,id:"time_taken"}),spn=ZP.create("span",{class:"input-group-addon gry",text:"Hrs"});return hrsDiv.appendChild(hrsTaken),hrsDiv.appendChild(spn),$(hrsTaken).timepicker({maxHours:details.max_mins/60+1,showMeridian:!1,disableMousewheel:!1,minuteStep:1,defaultTime:hour}),$(hrsTaken).on("changeTime.timepicker",function(e){Attendance.changeToMin(e.time.hours,e.time.minutes)>maxMins?$(this).val(hour).trigger("change"):Leave.Form.Summary.refresh()}),LVUtil.Form.getCurrFormParam().isfromProjects?(labelDiv.appendChild(hrsDiv),labelDiv):hrsDiv},timepicker:function(details,hide){var showhide=hide?"DN":"",timeparent=ZP.create("label",{class:"MB0I VM hourinput "+showhide}),timeDiv=ZP.create("div",{class:"input-group bootstrap-timepicker timepicker selected-hrs"}),timeEle=ZP.create("input",{type:"text",maxlength:5,class:"form-control picker",name:details?details.date:""});timeDiv.appendChild(timeEle),timeDiv.appendChild(ZP.create("span",{class:"input-group-addon gry",text:ZPI18N.getString("zp.leavetype.hrs")}));var dfltval=details&&details.defaultValue?details.defaultValue:"8:00";return $(timeEle).timepicker({maxHours:details.max_mins/60+1,showMeridian:!1,defaultTime:dfltval}),timeparent.appendChild(timeDiv),timeparent},lazyLoad:function(parent){parent.off("scroll"),parent[0].scrollTo(0,0);var rowLen=parent.find(".row").length;parent.find(".row:lt(25)").find("select[name]").select2({minimumResultsForSearch:1/0});var loadedRowLen=25,loadedAllRows=loadedRowLen>=rowLen;if(!loadedAllRows){var loadPerTrigger=parseInt(rowLen/10);parent.on("scroll",function(e){!loadedAllRows&&$(e.target).scrollTop()>30*loadedRowLen&&(parent.find(".row:gt("+(loadedRowLen-1)+")").slice(0,loadPerTrigger).find("select[name]").select2({minimumResultsForSearch:1/0}),loadedAllRows=(loadedRowLen+=loadPerTrigger)>=rowLen)})}}},Leave.Util.refreshBtwnHrs=function(Obj){var timeInputType=Leave.Form.getTimeInputType(),name=$(Obj).attr("id");if(void 0!==Obj&&("from_time"==name||"to_time"==name)&&2==timeInputType){var hrs=Leave.Util.leaveDays.calculateInBtwHrs($(Obj).parents(".fmtorw"));$(Obj).parents(".fmtorw").find(".ttlhrs").length>0&&$(Obj).parents(".fmtorw").find(".ttlhrs").text(hrs)}},Leave.Util.updateTotal=function(taken,type){var isDayBased=$("#zp_formleave_daylist",LVUtil.Form.getFormLayout()).data("details").isDayBased,daysTaken=isDayBased?taken:Leave.Util.convertToHoursandMinutes((60*taken).toFixed(0));LVUtil.Form.isViewMode()||(daysTaken=Leave.Form.getDayDetailsForParam(LVUtil.Form.getFormLayout(),{})),daysTaken=isDayBased&&daysTaken%1==0?parseInt(daysTaken):daysTaken;var total=$(".leave-type-foot",LVUtil.Form.getFormLayout()).html(""),row=ZP.create("div",{class:"row"}),label="";taken="";if(LVUtil.Form.isViewMode())0==type?(label=ZP.create("div",{class:"col-sm-6"}),taken=ZP.create("div",{class:"col-sm-6 dgry text-right"})):(label=ZP.create("div",{class:"col-sm-5"}),taken=ZP.create("div",{class:"col-sm-7 dgry text-right"})),$(label).html("<a><b>"+ZPI18N.getString("zp.total")+"</b></a>"),taken.appendChild(ZP.create("b",{class:"ML10 blk",text:daysTaken})),taken.appendChild(document.createTextNode(" "+(isDayBased?ZPI18N.getString("zp.days"):ZPI18N.getString("zp.leavetype.hrs"))));else{var timeInputType=Leave.Form.getTimeInputType();0==type||LVUtil.Form.getCurrFormParam().isfromProjects?(label=ZP.create("div",{class:LVUtil.Form.getCurrFormParam().isfromProjects&&0==type?"col-sm-6 W200":LVUtil.Form.getCurrFormParam().isfromProjects?"col-sm-6 W400":"col-sm-6"}),taken=ZP.create("div",{class:"col-sm-6"})):(label=ZP.create("div",{class:"col-sm-8"}),taken=ZP.create("div",{class:"col-sm-4"})),$(label).html("<a><b>"+ZPI18N.getString("zp.total")+"</b></a>"),taken.appendChild(ZP.create("b",{class:"ML10"+(2==timeInputType?" FR":""),text:daysTaken+" "+(isDayBased?ZPI18N.getString("zp.days"):ZPI18N.getString("zp.leavetype.hrs"))}))}row.appendChild(label),row.appendChild(taken),total.append(row),Leave.Util.showHideDocument(daysTaken)},Leave.Util.updateLeaveTaken=function(){var formObj=LVUtil.Form.getFormLayout(),params={};Leave.Form.getDayDetailsForParam(formObj,params);var daysTaken=parseFloat(params.Daystaken);daysTaken=daysTaken%1==0?daysTaken:daysTaken.toFixed(2),daysTaken=isNaN(daysTaken)?"":daysTaken;var leaveForm=$("Form#zp_form_container",Layout.Page.container);$("input[name=Daystaken]",leaveForm).val(daysTaken),Leave.Util.showHideDocument()},Leave.Util.userInputSelect2=function(ele,initialSel,skipDefaultValues){var eleId=$(ele).attr("id"),mode=$(ele).attr("searchmode")?$(ele).attr("searchmode"):-1==Layout.Page.pageId.indexOf("leavetracker-reports-")?"DATAVIEW":"REPORTDATA_VIEW",isMultiple=$(ele).attr("ismultiple");if(void 0==eleId||""==eleId){var maxIndx=0;$.each(Layout.Page.container.find("[id^="+Layout.Page.pageId+"_empsearch_]"),function(){var indx=$(this).attr("id").split("_")[2];maxIndx=Math.max(indx,maxIndx)}),eleId=Layout.Page.pageId+"_empsearch_"+(maxIndx+1),$(ele).attr("id",eleId)}var defaultValue={id:"-1",text:ZPI18N.getString("zp.allemployees"),html:ZPI18N.getString("zp.allemployees")},json={id:eleId,inpFormat:"select",isMultiple:isMultiple,initCurrentUser:!1,type:1,limit:10,searchMode:"LEAVE_"+mode,searchType:"emp",initialSelection:initialSel||defaultValue,defaultOption:defaultValue,initDefaultValues:!skipDefaultValues};return"employee"===$(ele).attr("name")&&isMultiple&&(json.placeHolder=ZPI18N.getString("zp.allemployees"),json.initialSelection=null,json.defaultOption=null),$(ele).attr("issingleemp")&&(defaultValue.id=ZPeople.CURR_USER.usererec,defaultValue.text=ZPeople.decodeTxt(ZPeople.CURR_USER.empid+" "+ZPeople.CURR_USER.name),defaultValue.html=ZPeople.CURR_USER.empid+" "+ZPeople.CURR_USER.name,defaultValue.photo=ZPeople.CURR_USER.thumb,json.initCurrentUser=!0),json.extraParamCallback=Leave.Util.employeeSearchExtraParams,ZPComponents.Search.reset(json,!0),ZPComponents.Search.create(json),json},Leave.Util.User={search:function(query){return Leave.Util.User.searchInCache(query)},searchFromServer:function(query){var responseData=[],data={skey:query.term,type:"ListAllUser",usingCaseEx:!0,conreqcsr:csrfToken,mode:"getEmpListByKey"};$.post("/AttendanceAction.zp",data,function(results){ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.emptocache[query.term]=results,responseData=Attendance.getInputsforSelect2(results,void 0,"ZPAtt_entry_empName"),query.callback({results:responseData})})},searchInCache:function(query){var responseData=[],noOfItem=0;return _.filter(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.employee,function(item){if(noOfItem<4&&void 0!==item.name&&item.name.toLowerCase().indexOf(query.term.toLowerCase())>-1){var record={id:item.id,text:item.name,html:ZPUtil.escapeHtml(item.name)};responseData.push(record),noOfItem++}}),responseData}},Leave.Util.employeeSearchExtraParams=function(){var extra_params={employeeStatus:3,employeeStatusarr:[19,-2,18],incDateOfExit:!0},emp_status=Layout.Page.container.find("[name=employeeStatus]")[0],isMultiple=!!$(emp_status).attr("multiple"),incDtOFExit=$(Layout.Page.container.find("[name=incDateOfExit]")[0]).is(":checked");if(extra_params.incDateOfExit=incDtOFExit,void 0!==emp_status&&null!=$(emp_status).val()&&(Layout.Page.container.find("[name=from]")[0]?(extra_params.from=Layout.Page.container.find("[name=from]").val(),extra_params.to=to=Layout.Page.container.find("[name=to]").val()):Layout.Page.container.find("[name=leaveyear_from]")[0]&&(extra_params.from=Layout.Page.container.find("[name=leaveyear_from]").val(),extra_params.to=to=Layout.Page.container.find("[name=to]").val()),isMultiple?extra_params.employeeStatusarr=$(emp_status).val():extra_params.employeeStatus=$(emp_status).val()),isMultiple||(extra_params.employeeStatusarr=void 0),"leavetracker-reports-lop"===Layout.Page.pageId||"leavetracker-reports-payroll"===Layout.Page.pageId){var locids=[],includeUnmapped=!1,payPeriods=ZPeople.Module.getData("leavetracker").leave_filterops.payPeriod,cur_pp=$(".ZPPhed",Layout.Page.container).find("#org_report_setting").val();for(idx in payPeriods)if(payPeriods[idx].rsID==cur_pp){locids=Object.keys(payPeriods[idx].rsLocations),payPeriods[idx].isAllLocation&&(includeUnmapped=!0);break}locids.length>0&&(extra_params.locids=JSON.stringify(locids),extra_params.includeUnmapped=includeUnmapped)}return LVUtil.Tab.isTeamPage()&&(extra_params.pageMode="LEAVE_TEAM"),extra_params},Leave.Util.showHideNoRecord4_0=function(show,isreport,parent,path,text,html){var img_path=path||(isreport?"path6":void 0),container=parent?parent.find(".ZPNdata"):Layout.Page.container.find("div.Scrcont").find(".ZPNdata");container[0]||(container=$(ZPUtil.newNoDataHTML(isreport?"CR-nodata-rpt":void 0,img_path,text,void 0,void 0,html)),parent?parent.append(container):Layout.Page.container.find("div.Scrcont").append(container)),show?(container.removeClass("DNI"),container.siblings().addClass("DN")):(container.addClass("DNI"),container.siblings().removeClass("DN"))},Leave.Util.showHideNoRecord=function(show,isreport,parent,isscheduler,path,text,html){var infoTxt=text||(isreport?ZPI18N.getString("zp.noreportsmsg"):ZPI18N.getString("zp.nodatafound"));if(ZPeople.isZPNewUI())Leave.Util.showHideNoRecord4_0(show,isreport,parent,path,infoTxt,html);else{infoTxt=isscheduler?ZPI18N.getString("zp.noscheduleconfigured"):infoTxt;var imageUrl=newUIImageUrl;imageUrl+=isreport?"svg/no-reports.svg":"svg/no-data.svg";var parent_div=parent||Layout.Page.container.find("div.Scrcont"),noRecEle=parent_div.find(".ZPNdata");if(0===noRecEle.length){var noRecId=parent?parent.attr("id"):Layout.Page.pageId;noRecId+=isreport?"_No_Report":"_No_Data";var noDataPar=ZP.create("div",{class:"ZPNdata"});noDataPar.appendChild(ZP.create("div",{id:noRecId})),noDataPar.appendChild(ZP.create("h5",{text:infoTxt})),parent_div.append(noDataPar),noRecEle=$(noDataPar),ZPUtil.noDataSVG(noRecId,ZPeople.getResourceURL(imageUrl),void 0)}show?(noRecEle.removeClass("DNI"),noRecEle.siblings().addClass("DN")):(noRecEle.addClass("DNI"),noRecEle.siblings().removeClass("DN"))}},Leave.Util.showHideNoData=function(showNoData,errorMsg,cont){var empDiv=(cont=void 0!==cont?cont:Layout.Page.container).find("#zp_empty_data");if(showNoData){0===cont.find("#zp_empty_data").length&&(cont.append("<div id='zp_empty_data'></div>"),empDiv=cont.find("#zp_empty_data"));var emptyhtml=new EmptyPages("zp_nd_record",errorMsg||ZPI18N.getString("zp.nodatafound"),"",empDiv);0===cont.find("#zp_nd_record").length?(emptyhtml.show(),empDiv.siblings().hide()):(cont.find("#zp_empty_data").show(),empDiv.siblings().hide())}else empDiv.siblings().show(),empDiv.remove()},Leave.Util.showNoPermission=function(){var imageUrl=newUIImageUrl+"svg/no-permission.svg",pageId=Layout.Page.pageId;pageId+="_No_Data";var noDataPar=ZP.create("div",{class:"ZPNdata"}),infoTxt=ZPI18N.getString("zp.permissiondeniedtoaccessthispage");noDataPar.appendChild(ZP.create("div",{id:pageId})),noDataPar.appendChild(ZP.create("p",{class:"no-para",text:infoTxt})),Layout.Page.container.html(noDataPar),ZPUtil.noDataSVG(pageId,ZPeople.getResourceURL(imageUrl),void 0)},Leave.Util.Row.create=function(data_row,headers,action){var dateTr=ZP.create("tr",{class:"ZPLRow"});for(header in $(dateTr).data("id",data_row.id),headers){var ele_data=data_row.hasOwnProperty(header)?data_row[header]:headers[header],td_data=ZP.create("td");"name"==header?(td_data.appendChild(ZP.create("div",{class:"ZPLtyp CL"+data_row.color})),td_data.appendChild(document.createTextNode(ZPeople.decodeTxt(ele_data))),data_row.isdeleted&&$(dateTr).addClass("ZPDRow")):"type"==header?(ele_data=Leave.Type.text(data_row.type),td_data.appendChild(document.createTextNode(ele_data))):td_data.appendChild(document.createTextNode(ele_data)),dateTr.appendChild(td_data)}if(action.isbackupData){(statusTd=ZP.create("td")).appendChild(ZP.create("i",{class:"IC-rfesh S20 gry","data-toggle":"tooltip",title:"Restore","data-placement":"right"})),dateTr.appendChild(statusTd),dateTr.appendChild(ZP.create("td"))}else{var statusTd=ZP.create("td"),statuscls=data_row.isactive?"IC-rou-tik grn S20":"IC-rou-tik gry S20";statusTd.appendChild(ZP.create("i",{class:statuscls})),dateTr.appendChild(statusTd),dateTr.appendChild(Leave.Util.getActionTD(action))}return dateTr},Leave.Util.getDropDownActionsTD=function(action){var options={bookOpt:ZPI18N.getString("zp.leave.compensatory.book"),viewOpt:ZPI18N.getString("zp.view"),editOpt:ZPI18N.getString("zp.edit"),deleteOpt:ZPI18N.getString("zp.delete"),addtaskOpt:ZPI18N.getString("zp.addtask"),resetDefaultOpt:ZPI18N.getString("zp.leavetype.v2.resettodefault"),rerunOpt:ZPI18N.getString("zp.leavetype.v2.rerun"),viewsummary:ZPI18N.getString("zp.leavetype.v2.viewsummary"),viewtransaction:ZPI18N.getString("zp.leavetype.v2.viewhistory")},icons={resetDefaultOpt:"IC-rfesh rfrsh_rev",rerunOpt:"IC-sync",viewsummary:"IC-pln-note",viewtransaction:"CR-audit"},actionTd=ZP.create("td",{class:"PL20 dropdown ZPCusDrs fxdtd",width:"30px"});actionTd.appendChild(ZP.create("div",{id:"moreActions","data-toggle":"dropdown",class:"IC-more S16 gry DN CP dropdown-toggle"}));var actionList=ZP.create("ul",{class:"dropdown-menu ZPCmn-Arrow top gray MorDD MorDDT40",style:"width: max-content;width: -moz-max-content;top:35px;"});return $.each(action,function(indx,value){var list=ZP.create("li"),a=ZP.create("a",{href:"javascript:void(0)",id:indx,onclick:"Leave.Util.executeAction("+value+",this)"});icons[indx]&&a.appendChild(ZP.create("i",{class:icons[indx]+" S13 FL MR5 VM"})),a.appendChild(document.createTextNode(options[indx])),list.appendChild(a),actionList.appendChild(list)}),actionTd.appendChild(actionList),actionTd},Leave.Util.executeAction=function(value,ele){value(ele)},Leave.Util.getActionTD=function(action){var actionTd=ZP.create("td",{class:"over-display P0",width:"155px"});if(action.deleteopt|action.editopt|action.cloneopt|action.attachopt|action.viewtransaction|action.rerun){var actionDiv=ZP.create("div");if(action.deleteopt){actionDiv.appendChild(ZP.create("i",{class:"IC-delete S14 gry FR MR15 CP"}));var confirmDiv=ZP.create("div",{class:"ZP-Confirm collapse"});confirmDiv.appendChild(ZP.create("button",{class:"btn btn-default btn-sm FR MR15",text:ZPI18N.getString("zp.cancel")})),confirmDiv.appendChild(ZP.create("button",{class:"btn btn-danger btn-sm FR MR15",text:ZPI18N.getString("zp.confirm")})),actionTd.appendChild(confirmDiv)}action.editopt&&actionDiv.appendChild(ZP.create("i",{class:"IC-pen S14 gry FR MR15 CP",style:action.hideEdit?"display:none":""})),action.cloneopt&&actionDiv.appendChild(ZP.create("i",{class:"IC-clone gry S17 FR MR15 CP",onclick:"Leave.Policy.LT.clone(this)",title:ZPI18N.getString("zp.clone")})),action.attachopt&&actionDiv.appendChild(ZP.create("i",{class:"IC-usr-fill gry S17 FR MR15 CP",onclick:"Leave.Policy.LT.attachPopUp(this)",style:"display:none"})),action.viewtransaction&&actionDiv.appendChild(ZP.create("i",{class:"IC-pln-note gry S17 FR MR15 CP",onclick:"Leave.Policy.Customize.viewTransaction(this)"})),action.rerun&&actionDiv.appendChild(ZP.create("i",{class:"IC-play gry S17 FR MR15 CP",onclick:"Leave.Policy.Customize.rerun(this)"})),actionTd.appendChild(actionDiv)}return actionTd},Leave.Util.getStatusTd=function(td,approvalStatus,noToolTip){if(-1==approvalStatus)td.appendChild(noToolTip?ZP.create("i",{class:"IC-pending org S18"}):ZP.create("i",{class:"IC-pending org S18","data-toggle":"tooltip","data-placement":"top",title:ZPI18N.getString("zp.pending")}));else if(1==approvalStatus)td.appendChild(noToolTip?ZP.create("i",{class:"IC-like grn S21"}):ZP.create("i",{class:"IC-like grn S21","data-toggle":"tooltip","data-placement":"top",title:ZPI18N.getString("zp.approved")}));else if(0==approvalStatus)td.appendChild(noToolTip?ZP.create("i",{class:"IC-unlike red S21"}):ZP.create("i",{class:"IC-unlike red S21","data-toggle":"tooltip","data-placement":"top",title:ZPI18N.getString("zp.rejected")}));else if(2==approvalStatus)td.appendChild(noToolTip?ZP.create("i",{class:"IC-rejected red S18"}):ZP.create("i",{class:"IC-rejected red S18","data-toggle":"tooltip","data-placement":"top",title:ZPI18N.getString("zp.cancelled")}));else if(-4==approvalStatus){var app_status_i=noToolTip?ZP.create("i",{class:"CR-pending-cancel org S18 FL"}):ZP.create("i",{class:"CR-pending-cancel org S18","data-toggle":"tooltip","data-placement":"top",title:ZPI18N.getString("zp.cancellationpending")});app_status_i.appendChild(ZP.create("i",{class:"path1"})),app_status_i.appendChild(ZP.create("i",{class:"path2"})),td.appendChild(app_status_i)}},Leave.Util.getStatusColor=function(status){switch(status){case-1:return"org";case 1:return"grn";case 0:case 2:return"red"}},Leave.Util.getStatusText=function(status){switch(status){case-1:return ZPI18N.getString("zp.pending");case 1:return ZPI18N.getString("zp.approved");case 0:return ZPI18N.getString("zp.rejected");case 2:return ZPI18N.getString("zp.cancelled")}},Leave.Util.Row.showBulkDelete=function(show){if(show)$("#header_options,#zp_views_formrecactions",Layout.Page.container).hide(),$("#delete_options",Layout.Page.container).show();else{var data_body=$(".Scrcont",Layout.Page.container);$("#header_options,#zp_views_formrecactions",Layout.Page.container).show(),$("#delete_options,#zp_view_record_delete",Layout.Page.container).hide(),data_body.find("input:checkbox").each(function(){this.checked=!1})}},Leave.Util.appendinfomsg=function(ele,msg){var para=ZP.create("p",{class:"gry MT5"});para.appendChild(ZP.create("small",{text:msg})),ele.appendChild(para)},Leave.Util.Row.actionTd=function(hasdelete,hasedit){var actionTd=ZP.create("td",{class:"over-display P0",width:"155px"});if(hasdelete|hasedit){var actionDiv=ZP.create("div");if(hasdelete){actionDiv.appendChild(ZP.create("i",{class:"IC-delete S14 gry FR MR15 CP"}));var confirmDiv=ZP.create("div",{class:"ZP-Confirm collapse"});confirmDiv.appendChild(ZP.create("button",{class:"btn btn-default btn-sm FR MR15",text:ZPI18N.getString("zp.cancel")})),confirmDiv.appendChild(ZP.create("button",{class:"btn btn-danger btn-sm FR MR15",text:ZPI18N.getString("zp.confirm")})),actionTd.appendChild(confirmDiv)}hasedit&&actionDiv.appendChild(ZP.create("i",{class:"IC-pen S14 gry FR MR15 CP"})),actionTd.appendChild(actionDiv)}return actionTd},Leave.Util.Row.toggleRow=function(ele){var params={key:"toggle",id:$(ele).closest("tr").data("id"),page:Layout.Page.pageId.split("-")[2]};params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(data){if("success"===data.status)if($(ele).hasClass("grn")){if($(ele).removeClass("grn").addClass("gry").closest("tr").find(".IC-pen").css("display","none"),data.hasNoV1LeaveTypes)return void Leave.Util.confirmation(void 0,"upgradeversion")}else $(ele).removeClass("gry").addClass("grn").closest("tr").find(".IC-pen").css("display","")})},Leave.Util.Row.edit=function(ele){if("leavetracker-settings-customizeleave"===Layout.Page.pageId){var empJson=$(ele).closest("tr").data("empJson");Leave.Settings.CZ.Modify.init(empJson)}else if("leavetracker-settings-initialbalance"===Layout.Page.pageId){var erecno=$(ele).closest("tr").data("erecno");Leave.Settings.IB.Modify.init(erecno)}else if("leavetracker-settings-leavetype"===Layout.Page.pageId)Leave.Settings.LT.edit(ele);else if("leavetracker-settings-leavepolicy"===Layout.Page.pageId)Leave.Policy.LT.edit(ele);else if("leavetracker-settings-customizepolicy"===Layout.Page.pageId)Leave.Policy.Customize.editPolicy(ele);else if(LVUtil.urls.Applications.isHome()){var rec_id=$(ele).closest("tr").data("id");window.location.href=LVUtil.urls.Applications.EDIT()+":"+rec_id}else"admin-organization-holidaycalendar-Calendarsettings"!==Layout.Page.pageId&&"leavetracker-settings-calendar"!==Layout.Page.pageId||Leave.Settings.Calendar.getParent(ele,!0)},Leave.Util.Row.showConfirmMsg=function(ele){var deletepar=$(ele).closest("div");deletepar.siblings("div.ZP-Confirm").collapse("show"),deletepar.addClass("DN")},Leave.Util.Row.hideConfirmMsg=function(ele){var deletepar=$(ele).closest("div");deletepar.siblings("div").removeClass("DN"),deletepar.collapse("hide")},Leave.Util.Row.remove=function(ele){var page=LVUtil.urls.CompOff.isHome()?"compensatory":Layout.Page.pageId.split("-")[2],data_tr=$(ele).closest("tr"),params={key:"delete",id:data_tr.data("id"),page:page};params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(data){"success"===data.status&&(ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.deletesuccessful")),data_tr.remove(),"leavetype"==page&&data.hasNoV1LeaveTypes)&&Leave.Util.confirmation(void 0,"upgradeversion")})},Leave.Util.Row.restore=function(ele){var page=Layout.Page.pageId.split("-")[2],data_tr=$(ele).closest("tr"),params={key:"restore",id:data_tr.data("id"),page:page};params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(data){"success"===data.status?(data_tr.removeClass("ZPDRow"),data_tr.find(".IC-rfesh").removeClass("IC-rfesh gry").addClass("IC-rou-tik grn").removeAttr("data-toggle"),data_tr.find(".tooltip").remove(),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.restoredsuccessfully"))):"ERROR"===data.status&&ModuleComp.Msg.showFailureMsg(data.ERROR)})},Leave.Util.Field={parent_html:'<div class="form-group"></div>',label_html:'<label class="control-label col-sm-3"></label>',right_parent:'<div class="col-sm-6"></div>',inputgroup:'<div class="input-group"></div>',errspan:'<span class="ERR MT5" style="display:none;"></span>',get:function(prop){var rightele,parent=$(this.parent_html).append($(this.label_html).text(prop.labelname));$(this.right_parent);return"text"===prop.type?rightele=Leave.Util.Field.text(prop):"empsearch"===prop.type?rightele=Leave.Util.Field.empsearch(prop):"number"===prop.type?rightele=Leave.Util.Field.number(prop):"date"===prop.type&&(rightele=Leave.Util.Field.date(prop)),rightele.append($(this.errspan)),parent.append(rightele),parent}},Leave.Util.Field.text=function(prop){var input=$("<input>",{type:"text",value:prop.value,name:prop.name,class:"form-control ZP-Input"});return $(this.right_parent).append(input)},Leave.Util.Field.date=function(prop){var parentDiv=$("<div>",{class:"btnCal"}),dateinput=$("<input>",{type:"text",value:prop.value,name:prop.name,class:"form-control ZP-Date"});return parentDiv.append(dateinput),Calendar.setUpCalendar(event,dateinput),$(this.right_parent).append(parentDiv)},Leave.Util.Field.number=function(prop){var input=$("<input>",{type:"text",value:prop.value,name:prop.name,class:"form-control ZP-Number"});return input.on("keyup",function(){isNaN($(this).val())?$(this).siblings("span.ERR").show().html("Enter valid number"):$(this).siblings("span.ERR").hide()}),$(this.right_parent).append(input)},Leave.Util.Field.empsearch=function(prop){var input=$("<input>",{type:"hidden",name:prop.name,value:prop.value,class:"ZP-Select"});input.on(prop.event,function(){prop.eventfunction(input)});var parent=$(this.right_parent).append(input);return Leave.Util.userInputSelect2(input,{id:prop.value,text:prop.nametext,html:ZPUtil.escapeHtml(prop.nametext)}),parent},Leave.Util.pickList={LAYOUT:'<div class="leavetypes-pickList"><div class="input-group dropdown AJDrop" id="pickListComp_leave"><div id="key_list" class="form-control DN input-lbltags" data-toggle="dropdown" style="min-height:30px"><span class="clearfix DN" style="display: inline;"></span><div id="leavetype_header" class="appltagh"><span class="clearfix"><p id="header_name"><i class="IC-mini S10" onclick="Leave.Util.pickList.expandCollapseHeader(event,this)"></i>'+ZPI18N.getString("zp.leavetypes")+'</p><button class="btn btn-default btn-sm FR MT3 DN" id="clear_list" type="button" onClick="Leave.Util.pickList.clearList(event,this)">'+ZPI18N.getString("zp.clear")+'</button><div class="clearfix"></div></div><div><div id="leaveTypes_selected" class="cust-labelTags MT3 MB10"></div></div></div><span class="input-group-addon BL0I" data-toggle="dropdown"><i class="IC-addlist gry CP"></i></span><div class="dropdown-menu ZPCusPd ZPappBox ZPCmn-Arrow top gray ZptxtBox rt" onclick="Leave.Util.pickList.disableEvent(event)"><div class="ZPTabVt"><div class="rhttabscrl"><div class="tab-content"><div class="tab-pane active" role="tabpanel"><div><div class="ZPtopSearch"><label class="checkbox DIB FL PT8 MR10"><input type="checkbox" id="allLT" onclick="Leave.Util.pickList.checkAll(this)"/><span></span></label><div class="ZPsearch"><div class="dvsearch Dropdown PR"><span class="ZPico-search FL MT2 ML8 ZPtooltip IC-lens S16" zptitle="Search Category"></span></div><input type="search" class="ZPselect" id="LT_search" placeholder="Search" value="" name="Search" oninput="Leave.Util.pickList.populate(this)"></div></div><div class="ZPapplCb"><ul id="leaveTypes_List"></ul></div></div></div></div></div></div></div></div></div>',LEAVETYPES:[],init:function(ltypeList){return Leave.Util.pickList.LEAVETYPES=ltypeList,Leave.Util.pickList.LAYOUT},setSelectedTypes:function(arr){Layout.Page.container.find("div#leaveTypes_selected").empty();var LTlist=Layout.Page.container.find("ul#leaveTypes_List");for(var indx in Layout.Page.container.find("#LT_search").val(""),Leave.Util.pickList.populate(Layout.Page.container.find("#LT_search")),arr)LTlist.find("input#"+arr[indx]).trigger("click");arr.length>0?(Layout.Page.container.find("#pickListComp_leave #key_list").addClass("input-lbltags"),Layout.Page.container.find("#clear_list,#leavetype_header").removeClass("DN")):(Layout.Page.container.find("#pickListComp_leave #key_list").removeClass("input-lbltags"),Layout.Page.container.find("#clear_list,#leavetype_header").addClass("DN"))},getSelectedTypes:function(){var ltypes=[],div=Layout.Page.container.find("#leaveTypes_selected");return $(div).children().each(function(){ltypes.push($(this).attr("id"))}),ltypes},populate:function(ele){var text=(ele=ele?$(ele):void 0)?ele.val():"",container=Layout.Page.container,LTlist=container.find("ul#leaveTypes_List");LTlist.empty();var hasNorec=!1;if(""==text)for(var indx in Leave.Util.pickList.LEAVETYPES){var ltobj=Leave.Util.pickList.LEAVETYPES[indx];LTlist.append($('<li id="'+ltobj.id+'"><div class="MT3"><label class="checkbox DIB PT8 MR10"><input type="checkbox" id="'+ltobj.id+'" onclick=Leave.Util.pickList.pick(this)><span class="ML2" id="ltype_name"></span></label></div></li>')),LTlist.find("li[id="+ltobj.id+"]").find("#ltype_name").append(ltobj.name)}else{for(var indx in Leave.Util.pickList.LEAVETYPES){ltobj=Leave.Util.pickList.LEAVETYPES[indx];-1!=ZPeople.decodeTxt(ltobj.name).toLowerCase().indexOf(text.toLowerCase())&&(LTlist.append($('<li id="'+ltobj.id+'"><div class="MT3"><label class="checkbox DIB PT8 MR10"><input type="checkbox" id="'+ltobj.id+'" onclick=Leave.Util.pickList.pick(this)><span class="ML2" id="ltype_name"></span></label></div></li>')),LTlist.find("li[id="+ltobj.id+"]").find("#ltype_name").append(ltobj.name))}""==LTlist.html()&&(hasNorec=!0,LTlist.append(ZP.create("span",{text:ZPI18N.getString("zp.norec")})),container.find("input#allLT").prop("checked",!1))}var selectedLT=container.find("#leaveTypes_selected");if($(selectedLT).children().each(function(){var id=$(this).attr("id");LTlist.find("input#"+id).prop("checked",!0)}),!hasNorec){var isAll=!0;$(LTlist).find("input:checkbox").each(function(){$(this).is(":checked")||(isAll=!1)}),container.find("input#allLT").prop("checked",isAll)}},findLT:function(id){for(var indx in Leave.Util.pickList.LEAVETYPES){var ltobj=Leave.Util.pickList.LEAVETYPES[indx];if(ltobj.id==id)return ltobj.name}return""},checkAll:function(ele){var LTlist=Layout.Page.container.find("ul#leaveTypes_List"),ischecked=$(ele).is(":checked");0==LTlist.find("input:checkbox").length&&$(ele).prop("checked",!1),LTlist.find("input:checkbox").each(function(){ischecked?$(this).is(":checked")||($(this).prop("checked",ischecked),Leave.Util.pickList.pick($(this),!0)):$(this).is(":checked")&&($(this).prop("checked",ischecked),Leave.Util.pickList.pick($(this),!0))})},pick:function(ele,flag){ele=$(ele);var LTObj=Layout.Page.container.find("div#leaveTypes_selected"),id=ele.attr("id");if(ele.is(":checked")&&!LTObj.find("span#"+id).is(":visible"))LTObj.append($('<span class="label label-primary FL MR5" id="'+id+'"><i class="IC-cls S8 ML5" id="'+id+'" onclick="Leave.Util.pickList.uncheckAndremove(event,this)"></i></span>')),LTObj.find("i#"+id).before(Leave.Util.pickList.findLT(id));else{var item=Layout.Page.container.find("i#"+id);Leave.Util.pickList.removeItem(item)}if(!flag){var LTlist=Layout.Page.container.find("ul#leaveTypes_List"),isAll=!0;$(LTlist).find("input:checkbox").each(function(){$(this).is(":checked")||(isAll=!1)}),Layout.Page.container.find("input#allLT").prop("checked",isAll)}Leave.Util.pickList.getSelectedTypes().length>0?(Layout.Page.container.find("#pickListComp_leave #key_list").addClass("input-lbltags"),Layout.Page.container.find("#clear_list,#leavetype_header").removeClass("DN")):(Layout.Page.container.find("#pickListComp_leave #key_list").removeClass("input-lbltags"),Layout.Page.container.find("#clear_list,#leavetype_header").addClass("DN")),Layout.Page.container.find(".IC-expnd").trigger("click")},uncheckAndremove:function(event,ele){var id=$(ele).attr("id");Layout.Page.container.find("ul#leaveTypes_List").find("input#"+id).trigger("click"),Leave.Util.pickList.disableEvent(event)},removeItem:function(ele){$(ele).parents("span#"+$(ele).attr("id")).remove()},expandCollapseHeader:function(event,obj){Leave.Util.pickList.disableEvent(event),$(obj).hasClass("IC-mini")?($(obj).removeClass("IC-mini"),$(obj).addClass("IC-expnd")):($(obj).removeClass("IC-expnd"),$(obj).addClass("IC-mini"));$(obj).parent().parent().parent();var recordObj=Layout.Page.container.find("#leaveTypes_selected");$(recordObj).slideToggle("fast")},clearList:function(event){Leave.Util.pickList.disableEvent(event),Leave.Util.pickList.setSelectedTypes([])},disableEvent:function(event){void 0!==event&&event.stopPropagation()}},Leave.Util.resetPage=function(container){var filtericon=container.find("i.IC-filter");filtericon.hasClass("ZPFilsel")&&(filtericon.removeClass("blu ZPFilsel"),$(".ZPFilMain",container).removeClass("TEbnd1").removeClass("TEbnd"));var isreg=$(".ZPPhed",container).data("isreg"),empSearch=$(".ZPPhed",container).find("input.ZP-Select"),selectedEmp=$(empSearch).val(),initialSel=selectedEmp;(LVUtil.urls.ListView.isHome()||LVUtil.urls.Calendar.isHome()||"leavetracker-reports-yearly"===Layout.Page.pageId||"leavetracker-reports-user"===Layout.Page.pageId)&&isreg&&($.isEmptyObject(Leave.View.SELECTED_USER)||selectedEmp==Leave.View.SELECTED_USER.employee||(initialSel=Leave.View.SELECTED_USER.employee,container.find("#s2id_ZP_Leave_View_EmpSearch span").text(Leave.View.SELECTED_USER.name),container.find("#ZP_Leave_View_EmpSearch").val(Leave.View.SELECTED_USER.employee),container.find(".Usrimg").attr("src",Leave.View.SELECTED_USER.photo),LVUtil.urls.ListView.isHome()?Leave.View.List.refresh=!0:Leave.View.Calendar.refresh=!0));var empObj=ZP.getUserDetailsById(initialSel);if(isreg&&empObj&&Leave.Util.userInputSelect2(empSearch,{id:empObj.employee,text:empObj.name,html:ZPUtil.escapeHtml(empObj.name),photo:empObj.photo}),-1==Layout.Page.pageId.indexOf("grant")){var multiEmpSearch=$(".ZPFilMain",container).find("input[name=employee]"),selectedEmps=$(multiEmpSearch).select2("data");isreg&&multiEmpSearch.length>0&&(Leave.Util.userInputSelect2(multiEmpSearch),multiEmpSearch.select2("data",selectedEmps))}},Leave.Util.isCurPageAdmin=function(){return 0===Layout.Page.pageId.indexOf("leavetracker-settings")?ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.issettingsadmin:ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isdataadmin?ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isdataadmin:!(0!==Layout.Page.pageId.indexOf("leavetracker-reports")&&0!==Layout.Page.pageId.indexOf("reports-admin-leave")&&0!==Layout.Page.pageId.indexOf("reports-team-leave")&&0!==Layout.Page.pageId.indexOf("reports-my-leave")||!ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isSPOCLvReportViewEnabled)||(!!ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isSPOCLvViewEnabled||ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isdataadmin)},Leave.Util.isAllDataAdmin=function(){return ZPeople.Module.MODULE_DATA.leavetracker?ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isAllDataAdmin:!(!ZPeople.Module.MODULE_DATA.selfservice||!ZPeople.Module.MODULE_DATA.selfservice.leave_filterops)&&ZPeople.Module.MODULE_DATA.selfservice.leave_filterops.isAllDataAdmin},Leave.Util.isApprovalConfigured=function(){return ZPeople.Module.MODULE_DATA.leavetracker?ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.approval_configured:!(!ZPeople.Module.MODULE_DATA.selfservice||!ZPeople.Module.MODULE_DATA.selfservice.leave_filterops)&&ZPeople.Module.MODULE_DATA.selfservice.leave_filterops.approval_configured},Leave.Util.populate_select=function(ele,data,skippId,i18nObj,decode){$.each(data,function(idx,opt){var text=i18nObj?i18nObj[opt.name]:opt.name;skippId!=opt.id&&ele.append($("<option></option>").attr("value",opt.id).attr("opttext",opt.name).text(decode?ZPeople.decodeTxt(text):text))})},Leave.Util.showHideDocument=function(daysTaken,show){var fileUpload=LVUtil.Form.getFormLayout().find("[folabel=ZP_Leave_File_Upload]");if(LVUtil.Form.isViewMode()){var fcId=fileUpload.attr("id")?fileUpload.attr("id").split("zp_field_outer_")[1]:"";if(""!=fcId){var document=ZPForm.Field.getFieldValueData(fcId).componentValue;document&&""!=document&&(show=!0)}}else{var showFileUploadAfter=parseFloat(fileUpload.data("showFileUploadAfter")),takenBeforeAfter=LVUtil.Form.getFormLayout().find(".choose-leave-type").data("takenBeforeAfter");show=takenBeforeAfter?showFileUploadAfter>0&&daysTaken+takenBeforeAfter>showFileUploadAfter:showFileUploadAfter>0&&daysTaken>showFileUploadAfter}show?fileUpload.parent("div.form-group,div.zp-label").removeClass("DN"):fileUpload.parent("div.form-group,div.zp-label").addClass("DN")},Leave.Util.Validate={},Leave.Util.Validate.fromtoValidation=function(from,to){return!!Leave.Util.Validate.toafterfrom(from,to)||(ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.greaterfromdate")),!1)},Leave.Util.Validate.toafterfrom=function(from,to){return!(Calendar.parseDate(from,uidateFormat)>Calendar.parseDate(to,uidateFormat))},Leave.Util.Validate.noofDays=function(from,to,restrict_days,msg){if(!Leave.Util.Validate.fromtoValidation(from,to))return!1;var from_dt=Calendar.parseDate(from,uidateFormat),to_dt=Calendar.parseDate(to,uidateFormat);return Leave.Util.getDateDiff(from_dt,to_dt)<=restrict_days||(ModuleComp.Msg.showFailureMsg(msg),!1)},Leave.Util.Validate.currentyear=function(to,location){var lyJson=location?Leave.Util.getMultiLocationLYear(location,0):Leave.Util.getCurrentLYear(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.curuser.location);return Calendar.parseDate(to,uidateFormat)<=Calendar.parseDate(lyJson.to,uidateFormat)||(ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.datewithincurrentyear")),!1)},Leave.Util.Validate.number=function(number,isOnlyPositive,isInteger){return!isNaN(number)&&(!(isOnlyPositive&&number<0)&&(!isInteger||number%1==0))},Leave.Util.Validate.isReasonTooLarge=function(str){if(str&&str.length>500)return!0},Leave.Util.convertToHoursandMinutes=function(value){if(!value)return"0:00";var hour=parseInt(value/60),min=parseInt(value%60);return hour+":"+(min=min<10?"0"+min:min)},Leave.Util.convertHourstoMinutes=function(value){if(void 0==value||""==value)return 0;var minutes=60*parseInt(value.split(":")[0]);return minutes+=parseInt(value.split(":")[1])},Leave.Util.convertMinutestoTime=function(value){if(isNaN(value))return"";var time="";if(Leave.Util.is24HrTimeFormat()){time=(hrs=1==(hrs=(hrs=parseInt(value/60)+"")>=24?0:hrs).length?"0"+hrs:hrs)+":"+(mins=1==(mins=parseInt(value%60)+"").length?"0"+mins:mins)}else{var hrs,mins,isPM=value>=720;value-=isPM?720:0,time=(hrs=1==(hrs=0==(hrs=parseInt(value/60)+"")?12:hrs).length?"0"+hrs:hrs)+":"+(mins=1==(mins=parseInt(value%60)+"").length?"0"+mins:mins)+" ",time+=isPM?"PM":"AM"}return time},Leave.Util.convertTimetoMinutes=function(value){if(!value)return 0;var mins=0;if(Leave.Util.is24HrTimeFormat()){var hoursPart=value.split(":")[0],minsPart=value.split(":")[1];mins=(hoursPart>=24?0:parseInt(60*hoursPart))+parseInt(minsPart)}else{var time=value.split(" ")[0];mins+="PM"==value.split(" ")[1]?720:0;hoursPart=time.split(":")[0],minsPart=time.split(":")[1];hoursPart="12"==hoursPart?0:hoursPart,mins+=parseInt(60*hoursPart)+parseInt(minsPart)}return mins},Leave.Util.convertHourstoMinutes=function(value){if(!value)return 0;var mins=0,time=value.split(" ")[0],hoursPart=time.split(":")[0],minsPart=time.split(":")[1];return mins+=parseInt(60*hoursPart)+parseInt(minsPart)},Leave.Util.getTimeDiff=function(from,to){var mins=0;if(from&&to){var fromMins=Leave.Util.convertTimetoMinutes(from),toMins=Leave.Util.convertTimetoMinutes(to);fromMins>toMins&&(toMins+=1440),mins=(mins=toMins-fromMins)<0?0:mins}return mins},Leave.Util.getDateDiff=function(from,to){for(var count=0;from<to;)count+=1,from=new Date(from.setDate(from.getDate()+1));return count},Leave.Util.getLeaveunitID=function(lunit){var resArr=_.filter(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.leaveunit,function(obj){return obj.id==lunit});return resArr.length>0?resArr[0].optionID:""},Leave.Util.getLeaveunitTxt=function(optionID){var resArr=_.filter(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.leaveunit,function(obj){return obj.optionID==optionID});return resArr.length>0?resArr[0].name:""},Leave.Util.getLeaveTypeObj=function(ltypeId){var resArr=_.filter(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.leavetype,function(obj){return obj.id==ltypeId});return resArr.length>0?resArr[0]:""},Leave.Util.getLeaveTypeName=function(ltypeId){var resArr=_.filter(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.leavetype,function(obj){return obj.id==ltypeId});return resArr.length>0?resArr[0].name:""},Leave.Util.isCompOff=function(ltypeId){return 1==_.filter(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.leavetype,function(obj){return obj.id==ltypeId&&4==obj.type}).length},Leave.Util.getDispUnit=function(val,unit){return 1==unit?val&&val>0&&Math.abs(val)<=1?ZPI18N.getString("zp.leavetype.hour.singular"):ZPI18N.getString("zp.leavetype.hour.plural"):val&&val>0&&Math.abs(val)<=1?ZPI18N.getString("zp.day"):ZPI18N.getString("zp.leavetype.smalldays")},Leave.Util.fillLeaveType=function(lType,data,isOnlyIds){if(0==data.length)$(lType).append($("<option></option>").attr("value","0").text("N/A")),$(lType).select2("val","0");else for(var indx in data){var leavetype=data[indx],ltId="";isOnlyIds?(ltId=leavetype,$(lType).append($("<option></option>").attr("value",ltId).text(Leave.Util.getLeaveTypeName(ltId)))):(ltId=leavetype.id,$(lType).append($("<option></option>").attr("value",ltId).text(leavetype.name))),0==indx&&($(lType).select2("val",ltId).trigger("change"),$(lType).data("default_val",ltId))}},Leave.Util.getDateWithSuffix=function(date){return date%20==1||31==date?date+"st":date%20==2?date+"nd":date%20==3?date+"rd":date+"th"},Leave.Util.stringToArray=function(dataStr){var arr=[];if(dataStr){var dataArr=dataStr.split(",");for(var indx in dataArr)""!=dataArr[indx]&&arr.push(dataArr[indx])}return arr},Leave.Util.arrayToString=function(arr){var str="";for(var indx in arr)str+=arr[indx]+",";return str},Leave.Util.isBetween=function(arg,lftrange,rightrange){return arg>=lftrange&&arg<=rightrange},Leave.Util.isLeavePage=function(){return 0==Layout.Page.pageId.indexOf("leavetracker-")},Leave.Util.isLeaveViewPage=function(){return LVUtil.urls.ListView.isHome()||LVUtil.urls.Calendar.isHome()},Leave.Util.getReportSetingsConf=function(id){var rsConf,payPeriods=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.payPeriod;for(idx in payPeriods){var report=payPeriods[idx];id===report.rsID&&(rsConf=report)}return rsConf&&(rsConf.rsPayrollClosure&&-1!=rsConf.rsPayrollClosure||(rsConf.rsPayrollClosure=rsConf.rsClosureDay,rsConf.payrollClosureNotConfigured=!0,4==rsConf.rsFrequency&&(rsConf.rsSecPayrollClosure=rsConf.rsSecClosureDay))),rsConf},Leave.Util.getReportSetingsConfByLoc=function(location){var locationReport,payPeriods=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.payPeriod;for(idx in payPeriods){var report=payPeriods[idx];report.isAllLocation&&(locationReport=report);var locFlag=!0;for(indx in location)if(!report.rsLocations.hasOwnProperty(location[indx])){locFlag=!1;break}if(locFlag){locationReport=report;break}}return locationReport&&(locationReport.rsPayrollClosure&&-1!=locationReport.rsPayrollClosure||(locationReport.rsPayrollClosure=locationReport.rsClosureDay,locationReport.payrollClosureNotConfigured=!0,4==locationReport.rsFrequency&&(locationReport.rsSecPayrollClosure=locationReport.rsSecClosureDay))),locationReport},Leave.Util.SystemView={requestType:{all:"2",activeemprecord:"1",exitemprecord:"0"},status:{pending:"-1",rejected:"0",approved:"1",cancelled:"2",all:"20"},dataSelect:{all:"3",mydep:"2",self:"1",sub:"4",dataadmin:"5",dirsub:"6",leaveadmin:"7"},init:function(){var allowImport=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.allowImport,allowExport=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.allowExport,allowReportExport=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.allowReportExport;-1!=Layout.Page.pageId.indexOf("leavetracker-reports")&&(allowExport=allowExport||allowReportExport);var header='<div class="FR dropdown PR ZPCusDrs impexp ZPPdrop cust-dm" id="systemview_header">';return(allowImport||allowExport)&&(header+='<div class="IC-more S18 gry CP FR ML20 MT8 dropdown-toggle" data-toggle="dropdown"></div><ul class="dropdown-menu ZPCmn-Arrow top gray TBDD">'+(allowImport?'<li class="ZP-Import"><a><span class="IC-imprt DIB gry MR5"></span>'+ZPI18N.getString("zp.import")+"</a></li>":"")+(allowExport?'<li class="ZP-Export"><a onclick="ZPExport.exportData();"><span class="IC-exprt DIB gry MR5"></span>'+ZPI18N.getString("zp.export")+"</a></li>":"")+"</ul>"),{header:header+='</div><div id="leaveFilter" title="Filter" onclick="'+(1==ZPeople.isZPNewUI()?"ZPView.Search.actionsearch(true);":"ZPView.Search.toggleSearch();")+'"><i class="IC-filter S18 gry CP FR ML20 MT8" id="filter_icon"></i></div><select class="FR selct-wdth MR10 ZP-Select" id="zp_views_typeofviews" name="dataSelect" reqtype="typeOfView">'+Leave.Util.SystemView.getViewOptions()+"</select>"+(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.approval_configured?'<select class="FR selct-wdth MR10 ZP-Select" id="zp_views_approvaltypes" name="status" reqtype="approval"><option value="all">'+ZPI18N.getString("zp.allrequest")+'</option><option value="approved">'+ZPI18N.getString("zp.approved")+'</option><option value="rejected">'+ZPI18N.getString("zp.rejected")+'</option><option value="pending">'+ZPI18N.getString("zp.pending")+'</option><option value="cancelled">'+ZPI18N.getString("zp.cancelled")+"</option></select>":""),wrapperClass:ZPeople.isZPNewUI()?"Nbar5":"Nbar2",dataCallback:Leave.View.Applications.get,formId:ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.formid,formLoadCallback:Leave.Util.SystemView.switchViewEdit,searchCallback:Leave.Util.SystemView.toggleFilter,selActionHTML:Leave.Util.SystemView.getMultiSelectHtml,recDeleteCallback:Leave.Util.SystemView.deleteRecordsforCustomView,systemViewName:ZPeople.Module.MODULE_DATA.leavetracker.formDisplayName,exportCallback:Leave.Util.showExport,onchangeCallback:Leave.Util.SystemView.toggleView,tableName:"P_EmployeeLeave"}},getViewOptions:function(){var optVal="",viewPerm=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.viewperm;return(0!==viewPerm||ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isterritoryadmin||ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isOperationalRoleAdmin||ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isSPOCLvViewEnabled)&&(3===viewPerm?optVal='<option value="all">'+ZPI18N.getString("zp.alldata")+'</option><option value="mydep">'+ZPI18N.getString("zp.teamdata")+'</option><option value="sub">'+ZPI18N.getString("zp.subdata")+"</option>":2===viewPerm?optVal='<option value="mydep">'+ZPI18N.getString("zp.teamdata")+'</option><option value="sub">'+ZPI18N.getString("zp.subdata")+"</option>":4===viewPerm&&(optVal='<option value="sub">'+ZPI18N.getString("zp.subdata")+"</option>"),0!==viewPerm&&1!==viewPerm&&(optVal+='<option value="dirsub">'+ZPI18N.getString("zp.dirsubdata")+"</option>"),4!==viewPerm&&0!==viewPerm&&(optVal+='<option value="self">'+ZPI18N.getString("zp.mydata")+"</option>"),(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isterritoryadmin||ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isOperationalRoleAdmin)&&(optVal+='<option value="dataadmin">'+ZPI18N.getString("zp.orgStructuredata")+"</option>"),ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isSPOCLvViewEnabled&&(optVal+='<option value="leaveadmin">'+ZPI18N.getString("zp.leaveadmindata")+"</option>")),optVal},construct:function(){Leave.Util.SystemView.constructFilters(),Leave.Util.SystemView.constructHeaderFooter(),$(".Scrcont",Layout.Page.container).data("isreg",!1),$("#systemview_pagination",Layout.Page.container).data("isreg",!1),Leave.Util.reg(),Leave.Util.regFooter();var theader=$(".table-responsive > table > thead",Layout.Page.container);$(".ZPFilMain",Layout.Page.container);if($(".Tclr",theader).on("click",function(){Leave.Util.toggleSort(this,theader),Leave.Util.Footer.searchcallback()}),$("tbody#ZP_Leave_RecordsView",Layout.Page.container).on("click","td",function(){var recid=$(this).closest("tr").data("id");recid&&0==$(this).find("#moreActions,.checkbox").length&&Leave.Util.SystemView.changeURL(void 0,recid,"VIEW")}),showNewTab){let select=Layout.Page.container.find("#zp_views_typeofviews");LVUtil.Tab.isMyPage()?(select.find("option[value=self]").siblings().remove(),select.select2("val","self")):LVUtil.Tab.isTeamPage()&&(select.find("option[value=mydep]").siblings().remove(),select.select2("val","mydep"))}},constructFilters:function(){if(0==Layout.Page.container.find("#leave_filter").length){var filterHtml='<div class="ZPFilMain" id="leave_filter"><div class="well ZPFil flterHd"><span class="flterHdTxt">'+ZPI18N.getString("zp.filter")+'</span><i class="IC-cls-1px S14 red CP"></i><div class="mor ZP-AdvanceFilter">'+ZPI18N.getString("zp.advanced")+'</div><div class="row"><div class="col-md-2"><div class="form-group"><label>'+ZPI18N.getString("zp.period")+'</label><select class="ZP-Select" name="period_v2" load="day,month,year" default="366" ignore="true"></select></div></div><div class="col-md-2" version="4"> <div class="form-group"> <label>'+ZPI18N.getString("zp.from")+'</label> <div class="btnCal ZPft"> <input type="text" caltype="filter" class="ZP-Date form-control" name="from"> </div> </div> </div><div class="col-md-2" version="4"> <div class="form-group"> <label>'+ZPI18N.getString("zp.to")+'</label> <div class="btnCal ZPft"> <input type="text" caltype="filter" class="ZP-Date form-control" name="to"> </div> </div> </div><div class="col-md-2"><div class="form-group"><label>'+ZPI18N.getString("zp.type")+'</label><select class="ZP-Select" name="typeofleave"></select></div></div><div class="col-md-2 DN"><div class="form-group"><label>'+ZPI18N.getString("zp.local.Leavetype")+'</label><select multiple="multiple" class="ZP-Select" name="leavetype" ignore="true" placeholder="'+ZPI18N.getString("zp.allleavetypes")+'"></select></div></div><div class="col-md-2"><div class="form-group"><label>'+ZPI18N.getString("zp.employee")+'</label><input class="ZP-Select" name="employee"></input></div><div class="form-group"> <label class="checkbox DIB MB20I popHover" data-popover="true" data-placement="bottom" data-toggle="popover" data-html="true" data-content="'+ZPI18N.getString("zp.showdirectreportees")+'"> <input type="checkbox" name=incDReportsOnly class="ZP-Checkbox"> <span> <small class="dgry S14">'+ZPI18N.getString("zp.showdirectreportees")+"</small> </span> </label> </div></div>"+(isOrgStructureEnabled?'<div class="col-md-2"><div class="form-group"><label>'+(ZPeople.orgStructureDispNameMap?ZPeople.orgStructureDispNameMap.entity:ZPI18N.getString("zp.legalentityname"))+'</label><select multiple="multiple" class="ZP-Select" name="entity"  placeholder="'+ZPI18N.getString("zp.all")+'"></select></div></div><div class="col-md-2"><div class="form-group"><label>'+(ZPeople.orgStructureDispNameMap?ZPeople.orgStructureDispNameMap.unit:ZPI18N.getString("zp.businessunitname"))+'</label><select multiple="multiple" class="ZP-Select" name="businessUnit"  placeholder="'+ZPI18N.getString("zp.all")+'"></select></div></div><div class="col-md-2"><div class="form-group"><label>'+(ZPeople.orgStructureDispNameMap?ZPeople.orgStructureDispNameMap.division:ZPI18N.getString("zp.divisionname"))+'</label><select multiple="multiple" class="ZP-Select" name="division"  placeholder="'+ZPI18N.getString("zp.all")+'"></select></div></div>':"")+'<div class="col-md-2"><div class="form-group"><label>'+ZPI18N.getString("zp.department")+'</label><select multiple="multiple" class="ZP-Select" name="department"  placeholder="'+ZPI18N.getString("zp.alldepartment")+'"></select></div></div><div class="col-md-2"><div class="form-group"><label>'+ZPI18N.getString("zp.designation")+'</label><select multiple="multiple" class="ZP-Select" name="designation"  placeholder="'+ZPI18N.getString("zp.alldesignation")+'"></select></div></div><div class="col-md-2 DN"><div class="form-group"><label>'+ZPI18N.getString("zp.location")+'</label><select multiple="multiple" class="ZP-Select" name="location" ignore="true" placeholder="'+ZPI18N.getString("zp.alllocations")+'"></select></div></div>'+(Leave.organizationTag.isEnabled()?'<div class="col-md-2 DN"><div class="form-group"><label>'+ZPeople.orgTagDisplayName+'</label><select multiple="multiple" class="ZP-Select" name="orgTag" ignore="true" placeholder="'+ZPI18N.getString("zp.all")+'"></select></div></div>':"")+'<div class="col-md-2 DN"><div class="form-group"><label>'+ZPI18N.getString("zp.useremployeeprofile")+'</label><select class="ZP-Select" name="employeeStatus" ignore="true"></select></div></div><div class="col-md-2"><div class="form-group ZP-Search"><button class="btn btn-primary btn-md MT20 MR10" type="button">'+ZPI18N.getString("zp.search")+'</button><button class="btn btn-default btn-md MT20" type="button">'+ZPI18N.getString("zp.reset")+"</button></div></div></div></div></div>";Layout.Page.container.find(".well.ZPPhed").after(filterHtml)}},constructHeaderFooter:function(){var container=Layout.Page.container,isadmin=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isdataadmin,tableheader='<div class="table-responsive H100"><table class="table table-hover Vlis" statictable=true><thead staticheader=true><tr class="ZPLHRow"><th width="30"></th><th width="30"><div><label class="checkbox '+(isadmin?"":"disabled")+'"><input type="checkbox" class="headerSelect" '+(isadmin?"":'disabled="true"')+'><span></span></label></div></th><th id="approval_col" class="ZPThumb" width="30"></th><th style="min-width:175px"><span class="Stxt">'+ZPI18N.getString("zp.employee")+'</span><i class="Tclr sort-img" id="EmployeeeName"></i></th><th style="min-width:175px"><span class="Stxt">'+ZPI18N.getString("zp.local.Leavetype")+'</span><i class="Tclr sort-img" id="Leavetype"></i></th><th style="min-width:100px"><span>'+ZPI18N.getString("zp.type")+'</span></th><th style="min-width:200px"><span class="Stxt">'+ZPI18N.getString("zp.leaveperiod")+'</span><i class="Tclr sort-img" id="FromTo"></i></th><th style="min-width:175px"><span>'+ZPI18N.getString("zp.leave.taken")+'</span></th><th style="min-width:175px"><span>'+ZPI18N.getString("zp.leave.dateofrequest")+'</span></th></tr></thead><tbody id="ZP_Leave_RecordsView"></tbody></table></div>',tablefooter='<div class="well ZPAct DN" id="systemview_pagination"><div class="RecCnt">'+ZPI18N.getString("zp.totalrecordcount")+' : <a id="recCount" href="javascript:void(0)">#</a></div><div class="Recrd" ><select><option value="20">20</option><option value="30">30</option><option value="40">40</option><option value="50">50</option><option value="75">75</option><option value="100">100</option><option value="200">200</option></select><span>'+ZPI18N.getString("zp.records")+'</span></div><div class="navi"><div id="prevapp" class="IC-ar-lft S16 FL"></div><span id="zp_view_page_cnt">1-10</span><div id="nextapp" class="IC-ar-rgt S16 FL"></div></div></div>';container.find(".Scrcont").html(tableheader),container.find(".Scrcont").after(tablefooter),ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.approval_configured||container.find(".Scrcont").find("#approval_col").hide(),container.find("#zp_view_pagination").hide(),ZPView.handleTablePosition(void 0,!0);var deleteoptions='<div class="row DN" id="delete_options"><div class="col-md-8"><button type="button" class="btn btn-warning btn-md MT3" onclick="Leave.Util.Row.deleteBulkWarning();">'+ZPI18N.getString("zp.delete")+'</button><div class="btn-group ML5 MT3" id="merge_template" onclick="MMtemplte.constructTemplateList(\'form\', null, null,null,\'Merge\')"> <a class="btn btn-default massUpdate"><span class="IC-mail MR5 hide"></span>'+ZPI18N.getString("zp.mailmerge")+'</a> </div></div><div class="col-md-4 MT8"><div class="IC-cls S12 gry ZPVAcls" onclick="Leave.Util.Row.showBulkDelete(false);"></div></div></div>';0==container.find("#delete_options").length&&container.find(".well.ZPPhed").append(deleteoptions)},toggleFilter:function(){var page_wrap=$("#page-wrapper"),header_cnt=$(".ZPPhed",Layout.Page.container),filter_icon=$(".IC-filter",header_cnt),filter_div=$(".ZPFilMain,.ZPPhed",Layout.Page.container).filter(".ZPFilMain");Leave.Util.toggleFilters(filter_icon,filter_div,page_wrap)},toggleView:function(){$(".IC-filter",Layout.Page.container).hasClass("ZPFilsel")&&($(".ZPFilMain",Layout.Page.container).removeClass("TEbnd1"),$(".IC-filter",Layout.Page.container).attr("class","IC-filter S18 gry CP FR ML20 MT8"),$("#page-wrapper").attr("class","Abar1 Nbar1F2 Nbar2")),ZPView.Search.resetAfterClose()},switchViewEdit:function(){LVUtil.urls.Applications.isEdit()?Leave.editRec(void 0,Layout.Page.childUrlParam.recordId):LVUtil.urls.Applications.isView()&&Leave.viewRec(void 0,Layout.Page.childUrlParam.recordId)},getMultiSelectHtml:function(){return(!(ZPView.isApproverViewType(Layout.Page.urlparam.viewId)&&!ZPView.isAdmin())?'<button class="btn btn-warning btn-md MT3" type="button" title="'+ZPI18N.getString("zp.delete")+'" onclick="ZPForm.Record.deleteRecord();">'+ZPI18N.getString("zp.delete")+"</button>":"")+'<div class="btn-group ML5 MT3 DN" id="approve_reject_button"> <a class="btn btn-default massUpdate"><span class="IC-mail MR5 hide"></span>'+ZPI18N.getString("zp.clicktoapprovereject")+"</a></div>"},deleteRecordsforCustomView:function(recIds){ZPeople.BSModal.confirm(function(){Leave.Util.SystemView.deleteRecords(recIds)},ZPI18N.getString("zp.alert"),ZPI18N.getString("zp.leave.deletebulkwarning"))},deleteRecords:function(recIds){var params={key:"delete",id:recIds,page:"applications"};params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(data){"success"===data.status&&(ZPView.isSystemView()&&$("#delete_options",Layout.Page.container).hide(),ZPView.refresh(!0,Layout.Page.urlparam.viewId),Leave.Util.Row.showBulkDelete(!1),ZPeople.BSModal.hide("zp_modal_confirmpop"))})},changeURL:function(formId,recordId,mode){mode="EDIT"===mode?"edit":"VIEW"===mode?"view":"",window.location.href="#"+Layout.Page.currentmode+"/"+mode+"-recordId:"+recordId},getStaticParams:function(params){var header=$(".ZPPhed",Layout.Page.container);$(header).find("select[name]").each(function(){var name=$(this).attr("name"),filter=Leave.Util.SystemView[name];filter&&(params[name]=filter[$(this).val()])})}},Leave.Util.loadPayPeriod=function(){var cur_period=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period,pager=$(".ZP-PayPeriodPager",Layout.Page.container),payperiod=Leave.Util.getPayPeriod(cur_period.cur_date);payperiod.conf?(pager.find("#payperiod").text(Calendar.formatDate(payperiod.start)+" - "+Calendar.formatDate(payperiod.end)),pager.find("#payperiod_name").text(payperiod.conf.rsName),pager.data("payperiod",payperiod).css("display","inline-block")):pager.data("payperiod","").css("display","none")},Leave.Util.getPayPeriod=function(curDate){var rsID=$("[name=org_report_setting]",Layout.Page.container).val(),reportConf=Leave.Util.getReportSetingsConf(rsID),payperiod={conf:reportConf,cur_date:curDate=Calendar.parseDate(curDate,uidateFormat)},period_pos=1,reportEnd=new Date(curDate),reportStart=new Date(curDate),reportClosure=new Date(curDate),payrollReportClosure=new Date(curDate);if(reportConf){if(1==reportConf.rsFrequency)(reportClosure=32==reportConf.rsClosureDay?new Date(reportClosure.getFullYear(),reportClosure.getMonth()+1,0):new Date(reportClosure.setDate(reportConf.rsClosureDay)))<curDate&&reportClosure.setMonth(reportClosure.getMonth()+1),32==reportConf.rsToDay?(reportEnd=(reportEnd=new Date(reportClosure.getFullYear(),reportClosure.getMonth()+1,0))>reportClosure?new Date(reportEnd.getFullYear(),reportEnd.getMonth(),0):reportEnd,reportStart=new Date(reportEnd.getFullYear(),reportEnd.getMonth(),1)):(reportEnd=(reportEnd=new Date(reportClosure.getFullYear(),reportClosure.getMonth(),reportConf.rsToDay))>reportClosure?new Date(reportEnd.setMonth(reportEnd.getMonth()-1)):reportEnd,reportStart=new Date(reportEnd.getFullYear(),reportEnd.getMonth()-1,reportEnd.getDate()+1)),payrollReportClosure=new Date(reportClosure),ZPUtil.setDate(payrollReportClosure,reportConf.rsPayrollClosure),payrollReportClosure<reportClosure&&(payrollReportClosure.setMonth(payrollReportClosure.getMonth()+1),ZPUtil.setDate(payrollReportClosure,reportConf.rsPayrollClosure));else if(2==reportConf.rsFrequency){(reportClosure=new Date(curDate)).setDay(reportConf.rsClosureDay),reportClosure<curDate&&reportClosure.setDate(reportClosure.getDate()+7),(reportEnd=new Date(reportClosure)).setDay(reportConf.rsToDay),reportEnd=reportEnd>reportClosure?new Date(reportEnd.setDate(reportEnd.getDate()-7)):reportEnd;reportStart=new Date(reportEnd);reportStart=new Date(reportStart.setDate(reportStart.getDate()-6)),(payrollReportClosure=new Date(reportClosure)).setDay(reportConf.rsPayrollClosure),payrollReportClosure<reportClosure&&payrollReportClosure.setDate(payrollReportClosure.getDate()+7)}else if(3==reportConf.rsFrequency||4==reportConf.rsFrequency){var cur_payperiod=Attendance.Report.getFromToForPayPeriod(1,reportConf.rsFrequency,reportConf.rsClosureDay,reportConf.rsSecClosureDay,reportConf.rsToDay,reportConf.lastScheRunTime,reportConf.rsPayrollClosure,reportConf.rsSecPayrollClosure);reportClosure<cur_payperiod.closureDay._d&&(period_pos=2,cur_payperiod=Attendance.Report.getFromToForPayPeriod(2,reportConf.rsFrequency,reportConf.rsClosureDay,reportConf.rsSecClosureDay,reportConf.rsToDay,reportConf.lastScheRunTime,reportConf.rsPayrollClosure,reportConf.rsSecPayrollClosure)),reportStart=cur_payperiod.fromDay._d,reportEnd=cur_payperiod.toDay._d,reportClosure=cur_payperiod.closureDay._d,payrollReportClosure=cur_payperiod.payrollclosureDay._d}payperiod.start=reportStart,payperiod.end=reportEnd,payperiod.closure=reportClosure,payperiod.period_pos=period_pos,payperiod.payroll_closure=payrollReportClosure}return payperiod},Leave.Util.navPayPeriod=function(pager,input){var payperiod=pager.data("payperiod"),reportConf=payperiod.conf;if(1==input){if(payperiod.end>=payperiod.cur_date||payperiod.closure>=payperiod.cur_date)return;if("leavetracker-reports-payroll"===Layout.Page.pageId&&"leavetracker-reports-encashment"===Layout.Page.pageId){var checkPeriod=Leave.Util.getPayPeriod(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date),cur_payperiod=Attendance.Report.getFromToForPayPeriod(payperiod.period_pos+input,reportConf.rsFrequency,reportConf.rsClosureDay,reportConf.rsSecClosureDay,reportConf.rsToDay,reportConf.lastScheRunTime,reportConf.rsPayrollClosure,reportConf.rsSecPayrollClosure),last_end=new Date(checkPeriod.start.setDate(checkPeriod.start.getDate()-1));new Date(checkPeriod.start);if(last_end<=payperiod.end)return}}if(3==payperiod.conf.rsFrequency||4==payperiod.conf.rsFrequency){payperiod.period_pos+=input;cur_payperiod=Attendance.Report.getFromToForPayPeriod(payperiod.period_pos,reportConf.rsFrequency,reportConf.rsClosureDay,reportConf.rsSecClosureDay,reportConf.rsToDay,reportConf.lastScheRunTime,reportConf.rsPayrollClosure,reportConf.rsSecPayrollClosure);payperiod.start=cur_payperiod.fromDay._d,payperiod.end=cur_payperiod.toDay._d,payperiod.closure=cur_payperiod.closureDay._d,payperiod.payroll_closure=cur_payperiod.payrollclosureDay._d}else Leave.Util.addorReducePayPeriod(payperiod,input);pager.data("payperiod",payperiod),pager.find("#payperiod").text(Calendar.formatDate(payperiod.start)+" - "+Calendar.formatDate(payperiod.end)),Leave.Util.getsearch_callback()()},Leave.Util.addorReducePayPeriod=function(modifiedPP,input){var reportEnd=modifiedPP.end,reportStart=modifiedPP.start,reportClosure=modifiedPP.closure,payrollReportClosure=modifiedPP.closure;1==modifiedPP.conf.rsFrequency?(input<0?(reportEnd=32==modifiedPP.conf.rsToDay?new Date(reportEnd.getFullYear(),reportEnd.getMonth(),0):new Date(reportEnd.setMonth(reportEnd.getMonth()-1)),reportStart=new Date(reportStart.setMonth(reportStart.getMonth()-1)),modifiedPP.conf.rsFromDay!=reportStart.getDate()&&2!=reportEnd.getMonth()&&(reportStart=new Date(reportStart.setMonth(reportEnd.getMonth()-1)),reportStart=new Date(reportStart.setDate(modifiedPP.conf.rsFromDay))),reportClosure=32==modifiedPP.conf.rsClosureDay?new Date(reportClosure.getFullYear(),reportClosure.getMonth(),0):new Date(reportClosure.setMonth(reportClosure.getMonth()-1))):(reportEnd=32==modifiedPP.conf.rsToDay?new Date(reportEnd.getFullYear(),reportEnd.getMonth()+2,0):new Date(reportEnd.setMonth(reportEnd.getMonth()+1)),reportStart=new Date(reportStart.setMonth(reportStart.getMonth()+1)),modifiedPP.conf.rsFromDay!=reportStart.getDate()&&2!=reportEnd.getMonth()&&(reportStart=new Date(reportStart.setMonth(reportEnd.getMonth()-1)),reportStart=new Date(reportStart.setDate(modifiedPP.conf.rsFromDay))),reportClosure=32==modifiedPP.conf.rsClosureDay?new Date(reportClosure.getFullYear(),reportClosure.getMonth()+2,0):new Date(reportClosure.setMonth(reportClosure.getMonth()+1))),modifiedPP.conf.rsPayrollClosure&&modifiedPP.conf.rsPayrollClosure>-1?(payrollReportClosure=new Date(reportClosure),ZPUtil.setDate(payrollReportClosure,modifiedPP.conf.rsPayrollClosure),payrollReportClosure<reportClosure&&(payrollReportClosure.setMonth(payrollReportClosure.getMonth()+1),ZPUtil.setDate(payrollReportClosure,modifiedPP.conf.rsPayrollClosure))):payrollReportClosure=new Date(reportClosure)):(input<0?(reportEnd=new Date(reportEnd.setDate(reportEnd.getDate()-7)),reportClosure=new Date(reportClosure.setDate(reportClosure.getDate()-7))):(reportEnd=new Date(reportEnd.setDate(reportEnd.getDate()+7)),reportClosure=new Date(reportClosure.setDate(reportClosure.getDate()+7))),reportStart=new Date(reportEnd),reportStart=new Date(reportStart.setDate(reportStart.getDate()-6)),modifiedPP.conf.rsPayrollClosure&&modifiedPP.conf.rsPayrollClosure>-1?((payrollReportClosure=new Date(reportClosure)).setDay(modifiedPP.conf.rsPayrollClosure),payrollReportClosure<reportClosure&&payrollReportClosure.setDate(payrollReportClosure.getDate()+7)):payrollReportClosure=new Date(reportClosure)),modifiedPP.start=reportStart,modifiedPP.end=reportEnd,modifiedPP.closure=reportClosure,modifiedPP.payroll_closure=payrollReportClosure},Leave.Util.Init=function(params,reservePlace,reserveName,callback,reg_filter){reservePlace[reserveName]?(reg_filter&&Leave.Util.reg(),callback()):$.ajax({url:"leave_common_action.zp",type:"POST",async:!1,data:params,success:function(resp){"success"===resp.status&&("payPeriod"==reserveName&&_.each(resp.data,function(pp){pp.rsName=decodeHTML(pp.rsName)}),reservePlace[reserveName]=resp.data,reg_filter&&Leave.Util.reg(),callback())}})},Leave.Tab={SKIPPAGES:["leavetracker-settings-generalsettings","leavetracker-settings-compensatoryoffschedule"],InitPage:function(callback,reg_filter,cacheObj){var topics=this.getCurPageTopics();!topics||this.CACHE.getStatus(topics)?(reg_filter&&Leave.Util.reg(),callback()):(this.CACHE.setStatus(topics),$.ajax({url:"leave_common_action.zp",type:"POST",async:!1,data:{key:"init_page",topics:topics,conreqcsr:csrfToken},success:function(resp){if("success"===resp.status){var moduleData=cacheObj||ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops;$.each(resp.data,function(key,obj){"payPeriod"==key&&_.each(obj,function(pp){pp.rsName=decodeHTML(pp.rsName)}),moduleData[key]=obj}),reg_filter&&Leave.Util.reg(),callback()}}}))},InitLitePage:function(){var topics=this.getCurPageTopics();topics&&!this.CACHE.getStatus(topics)&&(this.CACHE.setStatus(topics),$.ajax({url:"leave_common_action.zp",type:"POST",async:!1,data:{key:"init_page",topics:topics,conreqcsr:csrfToken},success:function(resp){if("success"===resp.status){var moduleData=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops;$.each(resp.data,function(key,obj){"payPeriod"==key&&_.each(obj,function(pp){pp.rsName=decodeHTML(pp.rsName)}),moduleData[key]=obj})}}}))},getCurPageTopics:function(){var pageId=Layout.Page.currentmode;if(-1==this.SKIPPAGES.indexOf(pageId))switch(pageId=-1!=pageId.indexOf("compensatory")?"compensatory":-1!=pageId.indexOf("selfservice")?"selfservice":pageId){case"selfservice":return"SELFSERVICE";case"compensatory":return this.CACHE.FILTEROPTIONS?"COMPOFF":"FILTEROPTIONS,COMPOFF";case"leavetracker/views/list":case"leavetracker/mydata/summary":case"leavetracker/team/user/summary":return this.CACHE.FILTEROPTIONS?"CALENDAR_SYNC":"FILTEROPTIONS,CALENDAR_SYNC";case"reports/my/leave/availability":case"reports/team/leave/availability":case"reports/admin/leave/availability":case"leavetracker/team/availability":case"leavetracker/reports/availability":return this.CACHE.FILTEROPTIONS?"DEPTREPORT":"FILTEROPTIONS,DEPTREPORT";case"reports/team/leave/lop":case"reports/admin/leave/lop":case"leavetracker/reports/lop":case"leavetracker/reports/encashment":case"reports/admin/leave/payroll":case"leavetracker/reports/payroll":return this.CACHE.FILTEROPTIONS?"PAYPERIOD":"FILTEROPTIONS,PAYPERIOD";case"leavetracker/holiday/list":case"leavetracker/views/holiday":case"leavetracker/holiday":return this.CACHE.FILTEROPTIONS?"CALENDAR_SYNC":"FILTEROPTIONS,CALENDAR_SYNC";case"leavetracker/settings/leavetype":case"leavetracker/settings/leavepolicy":return this.CACHE.FILTEROPTIONS?"SETTINGS":"FILTEROPTIONS,SETTINGS";default:return"FILTEROPTIONS"}},CACHE:{FILTEROPTIONS:!1,COMPOFF:!1,SETTINGS:!1,PAYPERIOD:!1,SELFSERVICE:!1,setStatus:function(topics){for(var arr=topics.split(","),i=0;i<arr.length;i++)this[arr[i]]=!0},getStatus:function(topics){for(var arr=topics.split(","),i=0;i<arr.length;i++)if(!this[arr[i]])return!1;return!0}}},Leave.Util.getPreviousPayPeriod=function(payperiod,cur_date,count){if(3==payperiod.conf.rsFrequency||4==payperiod.conf.rsFrequency){var reportConf=payperiod.conf,prev_payperiod=Attendance.Report.getFromToForPayPeriod(count+1,reportConf.rsFrequency,reportConf.rsClosureDay,reportConf.rsSecClosureDay,reportConf.rsToDay,reportConf.lastScheRunTime);return{from:prev_payperiod.fromDay._d,to:prev_payperiod.toDay._d,closure:prev_payperiod.closureDay._d,payroll_closure:prev_payperiod.payrollclosureDay?prev_payperiod.payrollclosureDay._d:void 0}}return(count<-1||!payperiod.closure<Calendar.parseDate(cur_date,uidateFormat))&&Leave.Util.addorReducePayPeriod(payperiod,count),{from:payperiod.start,to:payperiod.end,closure:payperiod.closure,payroll_closure:payperiod.payroll_closure}},Leave.Util.generateLOP_popup=function(){var msg,cur_date=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date,payperiod=Leave.Util.getPayPeriod(cur_date);Leave.Util.getPreviousPayPeriod(payperiod,-1);msg=ZPI18N.getString("zp.leave.lopreport.regeneratereport",[Calendar.formatDate(payperiod.from),Calendar.formatDate(payperiod.to)]),ZPeople.BSModal.confirm(Leave.Util.generate_LOP_report,ZPI18N.getString("zp.alert"),msg)},Leave.Util.getGenerateReportPeriod=function(){var cur_date=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date,payperiod=Leave.Util.getPayPeriod(cur_date),period=("leavetracker-reports-lop"==Layout.Page.pageId?ZPI18N.getString("zp.leave.lopreport"):ZPI18N.getString("zp.payrollreport"),Leave.Util.getPreviousPayPeriod(payperiod,cur_date,-1));return period.payroll_closure&&"leavetracker-reports-payroll"==Layout.Page.pageId&&period.payroll_closure>Calendar.parseDate(cur_date,uidateFormat)&&(period=Leave.Util.getPreviousPayPeriod(payperiod,cur_date,-2)),period},Leave.Util.generateReportPopup=function(){var cur_date=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date,msg=(Leave.Util.getPayPeriod(cur_date),"leavetracker-reports-lop"==Layout.Page.pageId?ZPI18N.getString("zp.leave.lopreport"):ZPI18N.getString("zp.payrollreport")),period=Leave.Util.getGenerateReportPeriod();msg=ZPI18N.getString("zp.leave.lopreport.regeneratereport",[Calendar.formatDate(period.from),Calendar.formatDate(period.to),msg]),ZPeople.BSModal.confirm(Leave.Util.generate_LOP_report,ZPI18N.getString("zp.alert"),msg)},Leave.Util.generate_LOP_report=function(){var rsid=$("[name=org_report_setting]",Layout.Page.container).val(),period=Leave.Util.getGenerateReportPeriod(),page="leavetracker-reports-lop"==Layout.Page.pageId?"lop":"payroll",params={key:"generate_report",rsid:rsid,page:page,from:Calendar.formatDate(period.from),to:Calendar.formatDate(period.to)};params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(data){"success"===data.status?(ModuleComp.Msg.showSuccessMsg(data.success?data.success:"Successfull!"),"lop"==page&&Leave.Util.getsearch_callback()()):ModuleComp.Msg.showFailureMsg(data.failure?data.failure:ZPI18N.getString("zp.exceptionmessage",[ZPeople.peopleSupportEmail]))})},Leave.Util.confirmation=function(ele,actionId){var id=actionId||$(ele).attr("id"),info="";"rerunOpt"==id?info="This will rerun the report based on the existing policy. Do you wish to proceed ?":"resetDefaultOpt"==id?info="This will undo all the customizations done for this leave type for this employee and will be configured based on the general settings. Do you wish to proceed?":"refreshpolicy"==id?info="This will check for any eligibility mismatch for this employee and correct them accordingly. Do you wish to proceed? ":"upgradeversion"==id&&(info="Do you wish to upgrade to the new version ?"),ZPeople.BSModal.setup({id:"zp_confirmation_pop",type:4,header:'<div class="Icn grni"><i class="IC-tick whi S24"></i></div><h4 id="gridSystemModalLabel" class="modal-title">'+ZPI18N.getString("zp.confirm")+"</h4>",body:'<div class="form-group"><p class="text-center MB15">'+info+"</p></div></div>",modalClass:"modal fade ZPmdl DelMdl in",buttonValue:ZPI18N.getString("zp.confirm"),successCallback:function(){"rerunOpt"==id?Leave.Policy.Customize.rerun(ele):"resetDefaultOpt"==id?Leave.Policy.Customize.resetToDefault(ele):"refreshpolicy"==id?Leave.Policy.Customize.refreshAttachments():"upgradeversion"==id&&Leave.Util.upgradeVersion(),ZPeople.BSModal.hide("zp_confirmation_pop")},deleteOnHide:!0})},Leave.Util.fixHeaderInModal=function(tableCont){tableCont.siblings("div.ZPfhlin").remove(),tableCont.parent().css("width",""),tableCont.addClass("FLhead").parent().addClass("tabcont"),tableCont.find("th").each(function(){if(this.childNodes.length>0){var textNode=this.childNodes[0];3===textNode.nodeType&&$(textNode).replaceWith($("<span></span>").text(textNode.nodeValue))}var innerHtml=$(this).html();0===$(this).children("div").length&&$(this).html("<div>"+innerHtml+"</div>"+innerHtml)});var tableWidth=tableCont.parents("modal-body").outerWidth();tableCont.siblings("div.ZPfhlin").length>0?tableCont.siblings("div.ZPfhlin").replaceWith('<div class="ZPfhlin" style="width:'+tableWidth+'px;"></div>'):tableCont.before('<div class="ZPfhlin" style="width:'+tableWidth+'px;"></div>'),tableCont.parent().css("width",tableWidth+"px")},Leave.Util.upgradeVersion=function(){ZPeople.Request.send("/leave_common_action.zp",{key:"upgradeversion"},function(resp){"success"===resp.status?(ModuleComp.Msg.showSuccessMsg("Version upgraded !"),location.reload()):(ModuleComp.Msg.showFailureMsg("Error while processing"),$("#zp_modal_blubtn",Layout.Page.container).prop("disabled",!1))},void 0,function(){ModuleComp.Msg.showFailureMsg("Error while processing"),$("#zp_modal_blubtn",Layout.Page.container).prop("disabled",!1)})},Leave.Util.getfilterOptions=function(){return ZPeople.Module.getData("leavetracker").leave_filterops},Leave.Util.isDashboardUser=function(){return!(!Leave.Util.getfilterOptions()||!Leave.Util.getfilterOptions().isDashboardUser)},Leave.Util.isPayPeriodNull=function(){return!Leave.Util.getReportSetingsConfByLoc(Layout.Page.container.find("[name=location]").val())},Leave.Util.getCurrDateFromFilterOptions=function(){var filterOptions=Leave.Util.getfilterOptions();if(filterOptions&&filterOptions.cur_period)return filterOptions.cur_period.cur_date},Leave.Util.is24HrTimeFormat=function(){return"HH:mm"==timeFormat},Leave.Util.appendLoading=function(json){if(-1===Layout.Page.hash.indexOf("selfservice/leave/list")){var layout=(json=json||{}).type&&"popup"===json.type?Layout.Page.container:Layout.Page.container.find(".Scrcont:visible");json.containerId&&(layout=layout.find("#"+json.containerId)),json.containerClass&&(layout=layout.find("."+json.containerClass)),json.placement&&"before"===json.placement?layout.before(ZPeople.LOADING_HTML):json.placement&&"append"===json.placement?layout.append(ZPeople.LOADING_HTML):layout.prepend(ZPeople.LOADING_HTML)}else Layout.Page.container.find(".ZP-selfcont>.MT10").append(ZPeople.LOADING_HTML)},Leave.Util.removeLoading=function(){Layout.Page.container.find("[id=zp_page_loading]").remove()},Leave.Util.isBradfordFactorEnabled=function(){var isBradfordFactorEnabled=!1;if(ZPeople.Module.MODULE_DATA.leavetracker)isBradfordFactorEnabled=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isBradfordFactorEnabled;else if(ZPeople.Module.MODULE_DATA.selfservice&&ZPeople.Module.MODULE_DATA.selfservice.leave_filterops)isBradfordFactorEnabled=ZPeople.Module.MODULE_DATA.selfservice.leave_filterops.isBradfordFactorEnabled;else if(ZPeople.Module.hasOwnProperty("isBradfordFactorEnabled"))isBradfordFactorEnabled=ZPeople.Module.isBradfordFactorEnabled;else{var params={key:"filter_options",conreqcsr:csrfToken,data_required:"bradfordfactor"};Leave.Util.Init(params,ZPeople.Module,"isBradfordFactorEnabled",function(){Leave.Util.isBradfordFactorEnabled()},!1),isBradfordFactorEnabled=ZPeople.Module.isBradfordFactorEnabled}return isBradfordFactorEnabled},Leave.Util.toggleButton=function(json){var layout=Layout.Page.container;(json=json||{}).containerId&&(layout=layout.find("#"+json.containerId)),json.buttonClass&&layout.find("."+json.buttonClass).toggleClass("disabled"),json.buttonId&&layout.find("#"+json.buttonId).toggleClass("disabled")},Leave.Util.conLettersOfNumbers=function(number){let suffixes=["th","st","nd","rd"],mod=number%100;return mod>=11&&mod<=13?number+suffixes[0]:number+(suffixes[number%10]||suffixes[0])},Leave.SPOCSettings={entryViewChange:function(isV5){var layout=isV5?$(settingsPage.mainWrapId).find("#cardmoduleSettingsPopUP"):Layout.Page.container,editButt=layout.find("#ZPLveEntry_EditEnabled");editButt.prop("disabled",!1),layout.find("#ZPLveEntry_ViewEnabled").is(":checked")||(editButt.prop("checked",!1),editButt.prop("disabled",!0))},mergeJsonWithoutDuplicates:function(dataArr,spocObj){var tempArr=[];for(var indx in spocObj){var data_json=spocObj[indx];if(-1!=data_json.id){var isFound=!1;for(var data in dataArr){if(dataArr[data].id==data_json.id){isFound=!0;break}}isFound||tempArr.push(data_json)}}return dataArr.concat(tempArr)}};var useWrapper=function(fx,module){fx(module||window)},LVUtil={getCurrentPage:()=>{let split=Layout.Page.currentmode.split("/");return split[split.length-1]},addLoading:function(){var cont=settingsPage.container,currentPage=LVUtil.getCurrentPage();cont.find("#nodatadiv").remove(),cont.find(".zpl_tblres").length>0&&("leavetracker"!=currentPage&&"leavepolicy"!=currentPage||!(0==cont.find(".zpl_tblres").find("div.zpl_dtbl").length||cont.find(".zpl_tblres").find("div.zpl_dtbl").length>0)?"leavetracker"!=currentPage&&"leavepolicy"!=currentPage&&(0==cont.find(".zpl_tblres").find("table.zpl_tbl").length||cont.find(".zpl_tblres").find("table.zpl_tbl").length>0)?cont.find(".zpl_tblres").find("table.zpl_tbl").find("tbody").find("tr").length>0?cont.find(".zpl_tblres").find("table.zpl_tbl").find("tbody").hide():cont.find(".zpl_tblres").find("div.zpl_tbl").hide():cont.find(".zpl_tblres").hide():cont.find(".zpl_tblres").find("div.zpl_dtbl").find("#listbody").find("ul").length>0?cont.find(".zpl_tblres").find("div.zpl_dtbl").find("#listbody").hide():cont.find(".zpl_tblres").find("div.zpl_dtbl").hide()),0==cont.find(".zpl_rgtcnt").find("#zp_page_loading").length&&(cont.find(".zpl_rgtcnt").css("height","100%"),cont.find(".zpl_rgtcnt").append(ZPeople.LOADING_HTML),cont.find(".zpl_rgtcnt").find("#zp_page_loading").css("height","100%"))},removeLoading:function(){var cont=settingsPage.container,currentPage=LVUtil.getCurrentPage();cont.find(".zpl_tblres").length>0&&("leavetracker"!=currentPage&&"leavepolicy"!=currentPage||!(0==cont.find(".zpl_tblres").find("div.zpl_dtbl").length||cont.find(".zpl_tblres").find("div.zpl_dtbl").length>0)?"leavetracker"!=currentPage&&"leavepolicy"!=currentPage&&(0==cont.find(".zpl_tblres").find("table.zpl_tbl").length||cont.find(".zpl_tblres").find("table.zpl_tbl").length>0)?cont.find(".zpl_tblres").find("table.zpl_tbl").find("tbody").find("tr").length>0?cont.find(".zpl_tblres").find("table.zpl_tbl").find("tbody").show():cont.find(".zpl_tblres").find("div.zpl_tbl").show():cont.find(".zpl_tblres").show():cont.find(".zpl_tblres").find("div.zpl_dtbl").find("#listbody").find("ul").length>0?cont.find(".zpl_tblres").find("div.zpl_dtbl").find("#listbody").show():cont.find(".zpl_tblres").find("div.zpl_dtbl").show()),cont.find(".zpl_rgtcnt").css("height",""),cont.find(".zpl_rgtcnt").find("#zp_page_loading").css("height",""),cont.find(".zpl_rgtcnt").find("#zp_page_loading").remove()},showHideNoData:function(onlyimage){var cont=settingsPage.container,json={},currentPage=LVUtil.getCurrentPage(),emptyhtml=new EmptyPages("zp_nd_nodata",json.desc?json.desc:ZPI18N.getString("zp.nodatafound"),"",cont.find(".zpl_tblres"));cont.find(".zpl_tblres").length>0&&(("leavetracker"!=currentPage&&"leavepolicy"!=currentPage&&"leavetype"!=currentPage||!(0==cont.find(".zpl_tblres").find("div.zpl_dtbl").length||cont.find(".zpl_tblres").find("div.zpl_dtbl").length>0&&0==cont.find(".zpl_tblres").find("div.zpl_dtbl").find("#listbody").find("ul").length))&&("customizeentitlement"!=currentPage&&"userspecificpolicy"!=currentPage&&"compensatoryoffscheduler"!=currentPage||!(0==cont.find(".zpl_tblres").find("table.zpl_tbl").length||cont.find(".zpl_tblres").find("table.zpl_tbl").length>0&&0==cont.find(".zpl_tblres").find("table.zpl_tbl").find("tbody").find("tr").length))?emptyhtml.remove():emptyhtml.show())},userInputSelect2:function(ele,initialSel,skipDefaultValues,pModal,defvalnotnneded){var pageId=Layout.Page.hash,mode=$(ele).attr("searchmode")?$(ele).attr("searchmode"):"SETTINGS",isMultiple=$(ele).prop("multiple"),defaultValue=(pModal=void 0!=pModal?pModal:$(ele).closest(".zpl_crd").length>0?$(ele).closest(".zpl_crd"):$(ele).closest(".zpl_mcnt"),null);void 0==defvalnotnneded&&(defaultValue={id:"-1",text:LVUtil.Tab.isTeamPage()?ZPI18N.getString("zp.select"):ZPI18N.getString("zp.allemployees"),html:LVUtil.Tab.isTeamPage()?ZPI18N.getString("zp.select"):ZPI18N.getString("zp.allemployees"),value:"-1",photo:"/images/user.png"});var json={ele:ele,inpFormat:isMultiple?"token":"select",isMultiple:!!isMultiple,initCurrentUser:!1,type:1,limit:10,searchMode:"LEAVE_"+mode,searchType:"emp",initialSelection:initialSel||defaultValue,defaultOption:defaultValue,initDefaultValues:!skipDefaultValues,pModal:pModal.length>0?pModal:void 0},name=$(ele).attr("name");return("employeesearch"===name||"employee"==name||"-1"!=pageId.indexOf("operations/leavetracker")&&"employee"==name)&&isMultiple&&(json.placeHolder=ZPI18N.getString("zp.allemployees"),json.initialSelection=null,json.defaultOption=null),$(ele).attr("issingleemp")&&!LVUtil.Tab.isTeamPage()&&(defaultValue.zuid=ZPeople.CURR_USER.id,defaultValue.id=ZPeople.CURR_USER.usererec,defaultValue.text=ZPeople.decodeTxt(ZPeople.CURR_USER.empid+" "+ZPeople.CURR_USER.name),defaultValue.html=ZPeople.CURR_USER.empid+" "+ZPeople.CURR_USER.name,defaultValue.photo=ZPeople.CURR_USER.thumb,json.initCurrentUser=!0),json.extraParamCallback="-1"!=!pageId.indexOf("operations/leavetracker")?LVUtil.employeeSearchExtraParams:LeaveAdminOpers.Util.employeeSearchExtraParams,LVUtil.Tab.isTeamPage()&&(json.extraParamCallback=LeaveAdminOpers.Util.employeeSearchExtraParams),ModuleComp.Search.reset(json,!0),ModuleComp.Search.create(json)},employeeSearchExtraParams:function(){var extra_params={employeeStatus:3,employeeStatusarr:[19,-2,18],incDateOfExit:!0},emp_status=settingsPage.container.find("[name=employeeStatus]")[0],isMultiple=!!$(emp_status).attr("multiple"),incDtOFExit=$(settingsPage.container.find("[name=incDateOfExit]")[0]).is(":checked");(extra_params.incDateOfExit=incDtOFExit,void 0!==emp_status)&&(null!=(isMultiple?LVUtil.TokenField.getValues($(emp_status)):ZPeopleComponents.select($(emp_status)).getValue())&&(settingsPage.container.find("[name=from]")[0]?(extra_params.from=ZPeopleComponents.datefield(settingsPage.container.find("[name=from]")).getValue().dateString,extra_params.to=to=ZPeopleComponents.datefield(settingsPage.container.find("[name=to]")).getValue().dateString):settingsPage.container.find("[name=leaveyear_from]")[0]&&(extra_params.from=ZPeopleComponents.datefield(settingsPage.container.find("[name=leaveyear_from]")).getValue().dateString,extra_params.to=to=ZPeopleComponents.datefield(settingsPage.container.find("[name=to]")).getValue().dateString),isMultiple?extra_params.employeeStatusarr=LVUtil.TokenField.getValues($(emp_status)):extra_params.employeeStatus=ZPeopleComponents.select($(emp_status)).getValue()));return isMultiple||(extra_params.employeeStatusarr=void 0),extra_params},TokenField:{initialize:function(obj,dtlsObj){var options=LVUtil.TokenField.getDefaultInzKeys(dtlsObj,obj);return ZPeopleComponents.tokenfield(obj,options)},getDefaultInzKeys:function(dtlsObj,ele){dtlsObj=dtlsObj||{};var options={dropdownList:{closeOnSelect:!1,fitForElement:!0,hideItemOnSelect:!0,isTextHTMLEncoded:!0,appendTo:ele.parents(".zpl_crd").length>0?ele.parents(".zpl_crd"):ele.parents(".zpl_mdl").length>0?ele.parents(".zpl_mdl"):settingsPage.container},data:[],contentType:"text",dataMapping:LVUtil.Tab.isOpersPage()||LVUtil.Tab.isNewTabPage()?{value:"value",text:"label",id:"value",informativeText:"label",titleText:"label",groupLabel:"groupLabel"}:{value:"id",text:"name",id:"id",informativeText:"name",titleText:"name",groupLabel:"groupLabel"},search:LVUtil.Tab.isOpersPage()||LVUtil.Tab.isNewTabPage()?{by:"label"}:{by:"name"},allowDuplicateValues:!1,placeholder:void 0!=dtlsObj.placeholder?dtlsObj.placeholder:ZPI18N.getString("zp.select"),isLabelHTMLEncoded:!0};return void 0!=dtlsObj.attviewport&&(options.dropdownList.viewport=dtlsObj.attviewport),$.extend(options,dtlsObj),options},setValues:function(obj,arr){ZPeopleComponents.tokenfield(obj).setValuesById(arr)},addValues:function(obj,arr){ZPeopleComponents.tokenfield(obj).setAttribute("values",arr)},getValues:function(obj){return ZPeopleComponents.tokenfield(obj).getSelectedValuesId()},destroy:function(obj){ZPeopleComponents.tokenfield(obj).destroy()},removeAllTokens:function(obj){ZPeopleComponents.tokenfield(obj).removeAllTokens()},removeTokens:function(obj,arr){ZPeopleComponents.tokenfield(obj).removeTokens(arr)},addOptions:function(obj,arr){ZPeopleComponents.tokenfield(obj).setAttribute("data",arr)},getOptions:function(obj){return ZPeopleComponents.tokenfield(obj).getAttribute("data")},setAttributes:function(obj,data){ZPeopleComponents.tokenfield(obj).setAttributes(data)},deSelectAll:function(obj){ZPeopleComponents.tokenfield(obj).setAttribute("values",[])}},getParamsForLvReqs:()=>({modulePrefix:"leavetracker",formId:ZPeople.LEAVE_FORMID,submode:"leavetracker-views-applications"}),Tab:{getLeaveModuleData:function(){if(void 0==ZPeople.Module.MODULE_DATA.leavetracker){var params={initmodule:JSON.stringify({modulePrefix:"leavetracker"})};ZPeople.Request.sendAsyncPost("/gettabdetails/initpage",params,function(result){result.initmodule&&void 0==ZPeople.Module.MODULE_DATA.leavetracker&&(ZPeople.Module.MODULE_DATA.leavetracker=result.initmodule)})}},InitPage:function(callback,reg_filter,cacheObj){void 0==ZPeople.Module.MODULE_DATA.leavetracker&&LVUtil.Tab.getLeaveModuleData();var topics=LVUtil.Tab.getCurPageTopics();(topics=LVUtil.Tab.CACHE.filterTopics(topics))?(LVUtil.Tab.CACHE.setStatus(topics),$.ajax({url:"leave_common_action.zp",type:"POST",async:!1,data:{key:"init_page",topics:topics,conreqcsr:csrfToken},success:function(resp){if("success"===resp.status){if(resp.data.APPLICATIONS){var moduleData=ZPeople.Module.MODULE_DATA.leavetracker;$.each(resp.data.APPLICATIONS,function(key,obj){moduleData[key]=obj})}else{(moduleData=cacheObj||ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops)&&$.each(resp.data,function(key,obj){"payPeriod"==key&&_.each(obj,function(pp){pp.rsName=decodeHTML(pp.rsName)}),moduleData[key]=obj})}reg_filter&&Leave.Util.reg(),callback&&callback()}}})):(reg_filter&&Leave.Util.reg(),callback&&callback())},InitLitePage:function(){var topics=LVUtil.Tab.getCurPageTopics();(topics=LVUtil.Tab.CACHE.filterTopics(topics))&&(LVUtil.Tab.CACHE.setStatus(topics),$.ajax({url:"leave_common_action.zp",type:"POST",async:!1,data:{key:"init_page",topics:topics,conreqcsr:csrfToken},success:function(resp){if("success"===resp.status){var moduleData=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops;$.each(resp.data,function(key,obj){"payPeriod"==key&&_.each(obj,function(pp){pp.rsName=decodeHTML(pp.rsName)}),moduleData[key]=obj})}}}))},getCurPageTopics:function(){var pageId=Layout.Page.currentmode;let topicName="";if(pageId){if(-1!=pageId.indexOf("reports/"))switch(pageId){case"reports/my/leave/availability":case"reports/team/leave/availability":case"reports/admin/leave/availability":topicName+="FILTEROPTIONS,DEPTREPORT,";case"reports/team/leave/lop":case"reports/admin/leave/lop":case"reports/admin/leave/payroll":topicName+="FILTEROPTIONS,PAYPERIOD,";default:topicName+="FILTEROPTIONS,"}else-1!=pageId.indexOf("operations/leavetracker")?topicName="COMPOFF,CALENDAR_SYNC,":-1!=pageId.indexOf("settings/service/leavetracker")&&(topicName="SETTINGS,CALENDAR_SYNC,"),-1!=pageId.indexOf("leavetracker/")&&-1!=pageId.indexOf("compensatory")?topicName+="COMPOFF,":-1!=pageId.indexOf("leavetracker/")&&-1!=pageId.indexOf("holiday")||-1!=pageId.indexOf("leavetracker/")&&-1!=pageId.indexOf("summary")||LVUtil.Tab.isGlobalSearchUserPage()?(topicName+="CALENDAR_SYNC,FILTEROPTIONS,",LVUtil.Tab.isCompOff()&&(topicName+="COMPOFF,")):LVUtil.urls.OnLeave.isHome()&&(topicName+="TEAMREPORT,"),LVUtil.Tab.isTeamPage()||LVUtil.Tab.isUserPage()||LVUtil.Tab.isOpersPage()?topicName+="FILTEROPTIONS,":-1!=pageId.indexOf("settings/service/leavetracker")?topicName+="FILTEROPTIONS,":LVUtil.Tab.isMyPage()&&(LVUtil.Tab.isCompOff()||LVUtil.Tab.isGrant())?topicName+="EXPORT,":LVUtil.Tab.isMyPage()&&LVUtil.Tab.isApplications()&&(topicName+="FILTEROPTIONS,");return topicName}},CACHE:{FILTEROPTIONS:!1,COMPOFF:!1,SETTINGS:!1,PAYPERIOD:!1,SELFSERVICE:!1,CALENDAR_SYNC:!1,APPLICATIONS:!1,EXPORT:!1,DEPT_CAL:!1,setStatus:function(topics){for(var arr=topics.split(","),i=0;i<arr.length;i++)void 0!=LVUtil.Tab.CACHE[arr[i]]&&(LVUtil.Tab.CACHE[arr[i]]=!0)},getStatus:function(topics){for(var arr=topics.split(","),i=0;i<arr.length;i++)if(!LVUtil.Tab.CACHE[arr[i]])return!1;return!0},filterTopics:topics=>{let newarr="";var arr=topics.split(",");let moduleData=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops;for(var i=0;i<arr.length;i++)if(void 0!=arr[i]&&""!=arr[i])if(LVUtil.Tab.CACHE[arr[i]]||-1!=newarr.indexOf(arr[i])){let isRefetchNeeded=!1;"COMPOFF"==arr[i]&&moduleData&&void 0==moduleData.Compensatory_Configuration?isRefetchNeeded=!0:"SETTINGS"==arr[i]&&moduleData&&void 0==moduleData.configuration?isRefetchNeeded=!0:"PAYPERIOD"==arr[i]&&moduleData&&void 0==moduleData.payPeriod?isRefetchNeeded=!0:"CALENDAR_SYNC"==arr[i]&&moduleData&&void 0==moduleData.CalendarSync_Data?isRefetchNeeded=!0:"FILTEROPTIONS"==arr[i]&&moduleData&&void 0==moduleData.leavetype?isRefetchNeeded=!0:"DEPT_CAL"==arr[i]&&moduleData&&void 0==moduleData.deptViewPerm&&(isRefetchNeeded=!0),isRefetchNeeded&&(newarr=newarr.concat(arr[i]).concat(","))}else newarr=newarr.concat(arr[i]).concat(",");return newarr}},isMyPage:function(){return-1!=Layout.Page.hash.indexOf("/mydata/")||-1!=Layout.Page.hash.indexOf("/views/")},isUserPage:function(){return-1!=Layout.Page.hash.indexOf("/team/user/")},isTeamPage:function(){return-1==Layout.Page.hash.indexOf("/team/user/")&&-1!=Layout.Page.hash.indexOf("/team/")},isNewTabPage:function(){return!!(LVUtil.Tab.isMyPage()||LVUtil.Tab.isTeamPage()||LVUtil.Tab.isUserPage()||LVUtil.Tab.isOpersUserPage())},isSettingsPage:function(){return-1!=Layout.Page.hash.indexOf("settings/service/leavetracker/")},isOpersPage:function(){return-1!=Layout.Page.hash.indexOf("operations/leavetracker/")},isOpersUserPage:function(){return-1!=Layout.Page.hash.indexOf("operations/leavetracker/user/")},isMySpace:function(){return-1!=Layout.Page.hash.indexOf("home/myspace/overview")},isGlobalSearchUserPage:()=>-1!==Layout.Page.hash.indexOf("#home/user/leave"),getCurPageId:function(){var pageId="";return LVUtil.Tab.isApplications()?pageId="applications":LVUtil.Tab.isCompOff()?pageId="compensatory":LVUtil.Tab.isHoliday()?pageId="holiday":LVUtil.Tab.isGrant()&&(pageId="grant"),pageId},isGrant:()=>-1!=Layout.Page.hash.indexOf("leavetracker/")&&-1!=Layout.Page.hash.indexOf("/grant"),isCompOff:()=>-1!=Layout.Page.hash.indexOf("leavetracker/")&&-1!=Layout.Page.hash.indexOf("/compensatory"),isList:()=>(-1!=Layout.Page.hash.indexOf("leavetracker/")&&-1!=Layout.Page.hash.indexOf("/summary-mode:list")||-1!=Layout.Page.hash.indexOf("/summary")&&-1==Layout.Page.hash.indexOf("reports")&&void 0==Layout.Page.urlparam.mode||-1!=Layout.Page.hash.indexOf("/applyleave")||-1!=Layout.Page.hash.indexOf("/convert")||-1!=Layout.Page.hash.indexOf("/edit")||-1!=Layout.Page.hash.indexOf("/view"))&&-1==Layout.Page.hash.indexOf("/balance")&&-1==Layout.Page.hash.indexOf("/grant")&&-1==Layout.Page.hash.indexOf("/compensatory")&&-1==Layout.Page.hash.indexOf("/holiday")&&-1==Layout.Page.hash.indexOf("/applications")&&-1==Layout.Page.hash.indexOf("/calendar"),isCalendar:()=>-1!=Layout.Page.hash.indexOf("leavetracker/")&&-1!=Layout.Page.hash.indexOf("/summary-mode:calendar"),isBalance:()=>-1!=Layout.Page.hash.indexOf("leavetracker/")&&-1!=Layout.Page.hash.indexOf("/balance"),isResAvail:()=>-1!=Layout.Page.hash.indexOf("leavetracker/")&&-1!=Layout.Page.hash.indexOf("/availability"),isApplications:()=>-1!=Layout.Page.hash.indexOf("leavetracker/")&&-1!=Layout.Page.hash.indexOf("/applications")&&-1==Layout.Page.hash.indexOf("/compensatory"),isHoliday:()=>-1!=Layout.Page.hash.indexOf("leavetracker/")&&-1!=Layout.Page.hash.indexOf("/holiday"),isHolidayCalendar:()=>-1!=Layout.Page.hash.indexOf("leavetracker/")&&-1!=Layout.Page.hash.indexOf("/holiday-mode:calendar"),isExpWorkingDay:()=>-1!=Layout.Page.hash.indexOf("leavetracker/")&&-1!=Layout.Page.hash.indexOf("/workingday"),isCZBalance:()=>-1!=Layout.Page.hash.indexOf("leavetracker/")&&-1!=Layout.Page.hash.indexOf("/customizebalance"),isInitialBalance:()=>-1!=Layout.Page.hash.indexOf("leavetracker/")&&-1!=Layout.Page.hash.indexOf("/initialbalance"),isCZPolicy:()=>-1!=Layout.Page.hash.indexOf("leavetracker/")&&-1!=Layout.Page.hash.indexOf("/userspecificpolicy"),isHolidayGallery:()=>-1!=Layout.Page.hash.indexOf("leavetracker/")&&-1!=Layout.Page.hash.indexOf("/holiday/gallery"),initPage:extraparam=>{-1!=Layout.Page.hash.indexOf("#leavetracker/convert")?(new LeaveForm).convert(Layout.Page.urlparam.recordId?Layout.Page.urlparam.recordId:Layout.Page.childUrlParam.recordId):LVUtil.Tab.isList()?(void 0!=extraparam&&extraparam.periodchange||Leave.View.List.initHTML(),Leave.View.List.initPage()):LVUtil.Tab.isCalendar()?(void 0!=extraparam&&extraparam.periodchange||Leave.View.Calendar.initHTML(),Leave.View.Calendar.initPage()):LVUtil.Tab.isHolidayGallery()?void 0!=extraparam&&extraparam.periodchange?Holidays.Gallery.load():LeaveAdminOpers.initComponents():LVUtil.Tab.isCompOff()||LVUtil.Tab.isGrant()||LVUtil.Tab.isHoliday()||LVUtil.Tab.isCZBalance()||LVUtil.Tab.isCZPolicy()?LeaveAdminOpers.initComponents():LVUtil.Tab.isBalance()?Leave.Reports.balanceReportV1.initPage():LVUtil.Tab.isResAvail()?TeamLeave.initPage():LVUtil.Tab.isGlobalSearchUserPage()&&(LVUtil.Tab.InitPage(Leave.View.List.initHTML,!1),Leave.View.List.init(),Leave.View.selectModeOfView(!0))}},urls:{getCurrentUrlParams:()=>{let urlparams={},url=Layout.Page.hash.split("-");if(url[1]){let paramArr=url[1].split("/");return paramArr&&$.each(paramArr,function(idx,val){let value=val.split(":");urlparams[value[0]]=value[1]}),urlparams}return urlparams},getCurrentPageUser:()=>{let user=void 0;if(LVUtil.Tab.isUserPage()||LVUtil.Tab.isOpersUserPage()||LVUtil.Tab.isGlobalSearchUserPage()){let url=Layout.Page.hash.split("-");if(url[1]){let paramArr=url[1].split("/");paramArr&&$.each(paramArr,function(idx,val){let value=val.split(":");"id"!=value[0]||(user=value[1])})}}else if(LVUtil.Tab.isMyPage()||LVUtil.Tab.isMySpace())return erecno;return user},getOfc360Url:()=>(void 0==ZPeople.Module.getData("leavetracker")&&LVUtil.Tab.InitPage(),ZPeople.Module.getData("leavetracker").ofc365Calurl),getGoogleUrl:()=>(void 0==ZPeople.Module.getData("leavetracker")&&LVUtil.Tab.InitPage(),ZPeople.Module.getData("leavetracker").googleCalurl),Approval:{MYAPPROVALS:"#approvals/myapproval",MYREQUESTS:"#approvals/myrequest"},setModeOfViewInUrl:(url,mode)=>{let prefix="#leavetracker";return showNewTab&&(void 0==mode?LVUtil.Tab.isMyPage()?prefix+="/mydata":LVUtil.Tab.isUserPage()?prefix+="/team/user":LVUtil.Tab.isTeamPage()?prefix+="/team":LVUtil.Tab.isOpersPage()&&!LVUtil.Tab.isOpersUserPage()?prefix="#operations/leavetracker":LVUtil.Tab.isOpersUserPage()?prefix="#operations/leavetracker/user":LVUtil.Tab.isGlobalSearchUserPage()?prefix="#home/user/leave":LVUtil.Tab.isSettingsPage()?prefix="#settings/service/leavetracker":void 0!=url&&-1==url.indexOf("/holiday")&&(prefix+="/mydata"):1==mode?prefix+="/mydata":2==mode?prefix+="/team":3==mode?prefix+="/team/user":5==mode?prefix="#operations/leavetracker/user":6==mode?prefix="#settings/service/leavetracker":7==mode?prefix="#home/user/leave":void 0!=url&&-1==url.indexOf("/holidays")&&(prefix+="/mydata")),prefix+url},prevUrl:{hash:"",setHash:()=>{LVUtil.urls.prevUrl.resetHash();var url=Layout.Page.hash;-1!=Layout.Page.hash.indexOf("/id:")&&(url=Layout.Page.hash.substring(0,Layout.Page.hash.indexOf("/id:"))),LVUtil.urls.prevUrl.hash=url},getHash:()=>LVUtil.urls.prevUrl.hash,resetHash:()=>{LVUtil.urls.prevUrl.hash=""}},getUrlAsHash:url=>{if(LVUtil.Tab.isUserPage()||LVUtil.Tab.isOpersUserPage()||LVUtil.Tab.isGlobalSearchUserPage()){let Id=LVUtil.urls.getCurrentPageUser();if(void 0==Id&&(Id=LVUtil.Team.SELECTED_USER),-1!=url.indexOf("-mode:"))return url+(-1!=url.indexOf(":")?"/":"-")+"id:"+Id;if(-1==url.indexOf("-id:"))return url+(-1!=url.indexOf(":")?"/":"-")+"id:"+Id}return url},Grant:{HOME:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/grant"):"#leavetracker/grant",OPERUSERHOME:()=>LVUtil.urls.setModeOfViewInUrl("/grant",5),ADD:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/grant/add"):"#leavetracker/grant/add",EDIT:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/grant/edit-recordId"):"#leavetracker/grant/edit-recordId",VIEW:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/grant/view-recordId"):"#leavetracker/grant/view-recordId",isHome:()=>(-1!=Layout.Page.hash.indexOf(LVUtil.urls.Grant.HOME())||-1!=Layout.Page.hash.indexOf("leavetracker/team/grant")||-1!=Layout.Page.hash.indexOf("leavetracker/team/user/grant")||-1!=Layout.Page.hash.indexOf(LVUtil.urls.Grant.OPERUSERHOME))&&-1==Layout.Page.hash.indexOf("/grant/"),isAdd:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Grant.ADD())||-1!=Layout.Page.hash.indexOf("leavetracker/team/grant/add")||-1!=Layout.Page.hash.indexOf("leavetracker/team/user/grant/add"),isEdit:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Grant.EDIT())||-1!=Layout.Page.hash.indexOf("leavetracker/team/grant/edit")||-1!=Layout.Page.hash.indexOf("leavetracker/team/user/grant/edit"),isView:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Grant.VIEW())||-1!=Layout.Page.hash.indexOf("leavetracker/team/grant/view")||-1!=Layout.Page.hash.indexOf("leavetracker/team/user/grant/view")},CompOff:{HOME:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/compensatory"):"#leavetracker/compensatory/applications",OPERUSERHOME:()=>LVUtil.urls.setModeOfViewInUrl("/compensatory",5),ADD:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/compensatory/add"):"#leavetracker/compensatory/add",EDIT:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/compensatory/edit-recordId"):"#leavetracker/compensatory/edit-recordId",VIEW:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/compensatory/view-recordId"):"#leavetracker/compensatory/view-recordId",BOOK:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/compensatory/book-recordId"):"#leavetracker/compensatory/book-recordId",isHome:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.CompOff.HOME())||-1!=Layout.Page.hash.indexOf("leavetracker/team/compensatory")||-1!=Layout.Page.hash.indexOf("leavetracker/team/user/compensatory")||-1!=Layout.Page.hash.indexOf("leavetracker/compensatory/application")||-1!=Layout.Page.hash.indexOf(LVUtil.urls.CompOff.OPERUSERHOME()),isAdd:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.CompOff.ADD())||-1!=Layout.Page.hash.indexOf("leavetracker/team/compensatory/add")||-1!=Layout.Page.hash.indexOf("leavetracker/team/user/compensatory/add"),isEdit:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.CompOff.EDIT())||-1!=Layout.Page.hash.indexOf("leavetracker/team/compensatory/edit")||-1!=Layout.Page.hash.indexOf("leavetracker/team/user/compensatory/edit"),isView:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.CompOff.VIEW())||-1!=Layout.Page.hash.indexOf("leavetracker/team/compensatory/view")||-1!=Layout.Page.hash.indexOf("leavetracker/team/user/compensatory/view"),isBook:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.CompOff.BOOK())||-1!=Layout.Page.hash.indexOf("leavetracker/team/compensatory/book")||-1!=Layout.Page.hash.indexOf("leavetracker/team/user/compensatory/book")},ListView:{HOME:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/summary-mode:list"):"#leavetracker/views/list",TEAMUSERHOME:()=>LVUtil.urls.setModeOfViewInUrl("/summary-mode:list",3),OPERUSERHOME:()=>LVUtil.urls.setModeOfViewInUrl("/summary-mode:list",5),SEARCHUSERHOME:()=>LVUtil.urls.setModeOfViewInUrl("",7),ADD:mode=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/applyleave",mode):"#leavetracker/applyleave",EDIT:mode=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/edit-recordId",mode):"#leavetracker/edit-recordId",VIEW:mode=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/view-recordId",mode):"#leavetracker/view-recordId",CONVERT:mode=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/convert-recordId",mode):"#leavetracker/convert-recordId",TEAMUSERCONVERT:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/convert-recordId",3):"#leavetracker/convert-recordId",OPERUSERCONVERT:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/convert-recordId",5):"#leavetracker/convert-recordId",isHome:()=>(-1!=Layout.Page.hash.indexOf(LVUtil.urls.ListView.HOME())||-1!=Layout.Page.hash.indexOf(LVUtil.urls.ListView.TEAMUSERHOME())||-1!=Layout.Page.hash.indexOf(LVUtil.urls.ListView.OPERUSERHOME())||-1!=Layout.Page.hash.indexOf(LVUtil.urls.ListView.SEARCHUSERHOME())||-1!=Layout.Page.hash.indexOf("/summary")&&-1==Layout.Page.hash.indexOf("reports")&&void 0==Layout.Page.urlparam.mode)&&-1==Layout.Page.hash.indexOf("/summary/"),isAdd:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.ListView.ADD()),isEdit:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.ListView.EDIT()),isView:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.ListView.VIEW()),isConvert:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.ListView.CONVERT())},BradFord:{HOME:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/bradford"):"#leavetracker/views/list",TEAMUSERBRADFORD:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/bradford",3):"#leavetracker/views/list",OPERUSERBRADFORD:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/bradford",5):"#leavetracker/views/list",LISTVIEW:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/list/employee"):"#leavetracker/views/list/employee-id",isHome:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.BradFord.HOME()),isListView:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.BradFord.LISTVIEW())},Calendar:{HOME:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/summary-mode:calendar"):"#leavetracker/views/calendar",TEAMHOME:()=>LVUtil.urls.setModeOfViewInUrl("/calendar",2),TEAMUSERHOME:()=>LVUtil.urls.setModeOfViewInUrl("/summary-mode:calendar",3),OPERUSERHOME:()=>LVUtil.urls.setModeOfViewInUrl("/summary-mode:calendar",5),VIEW:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/summary-mode:calendar/recordId"):"#leavetracker/views/calendar/view",isHome:()=>(-1!=Layout.Page.hash.indexOf(LVUtil.urls.Calendar.HOME())||-1!=Layout.Page.hash.indexOf(LVUtil.urls.Calendar.TEAMUSERHOME()))&&-1==Layout.Page.hash.indexOf("/summary/"),isView:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Calendar.VIEW())||-1!=Layout.Page.hash.indexOf("leavetracker/team/calendar/view")},Applications:{HOME:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/applications"):"#leavetracker/views/applications",TEAMHOME:()=>LVUtil.urls.setModeOfViewInUrl("/applications",2),TEAMUSERHOME:()=>LVUtil.urls.setModeOfViewInUrl("/applications",3),OPERUSERHOME:()=>LVUtil.urls.setModeOfViewInUrl("/applications",5),VIEW:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/applications/view-recordId"):"#leavetracker/views/applications/view-recordId",EDIT:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/applications/edit-recordId"):"#leavetracker/views/applications/edit-recordId",isHome:()=>(-1!=Layout.Page.hash.indexOf(LVUtil.urls.Applications.HOME())||-1!=Layout.Page.hash.indexOf("leavetracker/team/applications")||-1!=Layout.Page.hash.indexOf("leavetracker/team/user/applications")||-1!=Layout.Page.hash.indexOf(LVUtil.urls.Applications.OPERUSERHOME()))&&-1==Layout.Page.hash.indexOf("/applications/"),isView:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Applications.VIEW())||-1!=Layout.Page.hash.indexOf("leavetracker/team/applications/view")||-1!=Layout.Page.hash.indexOf("leavetracker/team/user/applications/view"),isEdit:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Applications.EDIT())||-1!=Layout.Page.hash.indexOf("leavetracker/team/applications/edit")||-1!=Layout.Page.hash.indexOf("leavetracker/team/user/applications/edit")},Holiday:{HOME:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/holiday"):"#leavetracker/holiday/list",ADD:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/holiday/add"):"#leavetracker/holiday/add",EDIT:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/holiday/edit-recordId"):"#leavetracker/holiday/edit-recordId",VIEW:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/holiday/view-recordId"):"#leavetracker/holiday/view-recordId",isHome:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Holiday.HOME())||-1!=Layout.Page.hash.indexOf("leavetracker/holiday"),isAdd:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Holiday.ADD())||-1!=Layout.Page.hash.indexOf("leavetracker/holiday/add"),isEdit:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Holiday.EDIT())||-1!=Layout.Page.hash.indexOf("leavetracker/holiday/edit"),isView:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Holiday.VIEW())||-1!=Layout.Page.hash.indexOf("leavetracker/holiday/view")},HolidayList:{HOME:()=>showNewTab?"#leavetracker/holiday":"#leavetracker/holiday/list",ADD:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/holiday/add"):"#leavetracker/holiday/add",EDIT:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/holiday/edit-recordId"):"#leavetracker/holiday/edit-recordId",VIEW:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/holiday/view-recordId"):"#leavetracker/holiday/view-recordId",isHome:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Holiday.HOME())||-1!=Layout.Page.hash.indexOf("leavetracker/holiday"),isAdd:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Holiday.ADD())||-1!=Layout.Page.hash.indexOf("leavetracker/holiday/add"),isEdit:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Holiday.EDIT())||-1!=Layout.Page.hash.indexOf("leavetracker/holiday/edit"),isView:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Holiday.VIEW())||-1!=Layout.Page.hash.indexOf("leavetracker/holiday/view")},HolidayCalendar:{HOME:()=>showNewTab?"#leavetracker/holiday-mode:calendar":"#leavetracker/holiday/list",OPERHOME:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/holiday-mode:calendar"):"#leavetracker/holiday/list",ADD:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/holiday/add"):"#leavetracker/holiday/add",EDIT:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/holiday/edit-recordId"):"#leavetracker/holiday/edit-recordId",VIEW:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/holiday/view-recordId"):"#leavetracker/holiday/view-recordId",isHome:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Holiday.HOME())||-1!=Layout.Page.hash.indexOf("leavetracker/holiday"),isAdd:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Holiday.ADD())||-1!=Layout.Page.hash.indexOf("leavetracker/holiday/add"),isEdit:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Holiday.EDIT())||-1!=Layout.Page.hash.indexOf("leavetracker/holiday/edit"),isView:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Holiday.VIEW())||-1!=Layout.Page.hash.indexOf("leavetracker/holiday/view")},czBalance:{HOME:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/customizebalance"):"#leavetracker/settings/customizebalance",OPERUSERHOME:()=>LVUtil.urls.setModeOfViewInUrl("/customizebalance",5),isHome:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.czBalance.HOME())||Layout.Page.hash.indexOf(LVUtil.urls.czBalance.OPERUSERHOME())},policy:{HOME:()=>LVUtil.urls.setModeOfViewInUrl("/leavepolicy"),isHome:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.policy.HOME())},czPolicy:{HOME:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/userspecificpolicy"):"#leavetracker/settings/customizepolicy",OPERUSERHOME:()=>LVUtil.urls.setModeOfViewInUrl("/userspecificpolicy",5),isHome:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.czPolicy.HOME())||-1!=Layout.Page.hash.indexOf(LVUtil.urls.czPolicy.OPERUSERHOME())},expWorkingDay:{HOME:()=>showNewTab?LVUtil.urls.setModeOfViewInUrl("/workingday"):"#leavetracker/settings/workingday/list",isHome:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.expWorkingDay.HOME())},Balance:{HOME:()=>LVUtil.urls.setModeOfViewInUrl("/balance"),isHome:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.Balance.HOME())},CompOffSchl:{HOME:()=>LVUtil.urls.setModeOfViewInUrl("/compensatoryoffscheduler"),isHome:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.CompOffSchl.HOME())},OnLeave:{HOME:()=>LVUtil.urls.setModeOfViewInUrl("/availability"),isHome:()=>-1!=Layout.Page.hash.indexOf(LVUtil.urls.OnLeave.HOME())},getPageBackUrl:()=>(url="#",LVUtil.Tab.isUserPage()?url="#leavetracker/team/members":Layout.previosHash&&-1!=Layout.previosHash.indexOf(LVUtil.urls.ListView.SEARCHUSERHOME())?url=LVUtil.urls.getUrlAsHash("#home/user/leave"):LVUtil.Tab.isOpersUserPage()&&(url="#operations/leavetracker/searchuser"),url)},Team:{SELECTED_USER:void 0,navigateUserView:function(userId){userId=void 0!==userId?userId:LVUtil.urls.getCurrentPageUser(),window.location.href="#leavetracker/team/user/summary-mode:list/id:"+userId},goToTeamPage:()=>{window.location.href="#leavetracker/team/members"},setSelectedUser:function(){let urluserId=LVUtil.urls.getCurrentPageUser();void 0==urluserId&&(urluserId=LVUtil.Team.SELECTED_USER),LVUtil.Team.SELECTED_USER=urluserId||erecno},getSelectedUser:function(){return LVUtil.Team.SELECTED_USER},isNewUserSelected:function(){let urluserId=LVUtil.urls.getCurrentPageUser();return!(!urluserId||urluserId==LVUtil.Team.SELECTED_USER)},updateUserDetail:()=>{let urluser=LVUtil.urls.getCurrentPageUser(),userId=urluser||LVUtil.Team.SELECTED_USER;if(userId){var userDtls=ZPeople.getUserDetailsById(userId);return userDtls&&userDtls.usererec?'<div class="zpl_usrprfdv" name="header-profile">'+Layout.Page.Header.getUser(userDtls,"TAMS.Team.goBackFromView")+"</div>":'<div class="zpl_usrprfdv" name="header-profile">'+Layout.Page.Header.getUser(ZPeople.CURR_USER,"TAMS.Team.goBackFromView")+"</div>"}},replaceUserDetails:()=>{let userId=void 0!==LVUtil.Team.SELECTED_USER?LVUtil.Team.SELECTED_USER:LVUtil.urls.getCurrentPageUser();userId&&Layout.Page.Header.updateUser(userId,"TAMS.Team.goBackFromView")},addThirdLevelTabParam:function(params){LVUtil.Team.setSelectedUser();let userId=LVUtil.Team.getSelectedUser();userId&&(params.userErecno=userId)},updateThirdLevelURLs:hash=>{LVUtil.Team.setSelectedUser();let user=LVUtil.Team.getSelectedUser();if(void 0!=user&&"undefined"!=user)return-1==hash.indexOf("/id:")&&-1==hash.indexOf("-id:")?-1!=hash.indexOf(":")?hash+"/id:"+user:hash+"-id:"+user:hash}},Form:{loadForm:json=>{if(showNewTab)if(LVUtil.urls.ListView.isConvert())(new LeaveForm).convert(LVUtil.urls.getCurrentUrlParams().recordId);else{ZP5Form._toForm(json).init()}else json.parent=json,ZPForm.load(json)},isAddMode:()=>showNewTab?ZP5Form.getFormClassObj().isAddMode():ZPForm.isAddMode(),isViewMode:()=>showNewTab?ZP5Form.getFormClassObj().isViewMode():ZPForm.isViewMode(),isEditMode:()=>showNewTab?ZP5Form.getFormClassObj().isEditMode():ZPForm.isEditMode(),getCurrFormParam:()=>showNewTab?ZP5Form.getFormClassObj().getParams():ZPForm.CURRFORM_PARAM,getFormLayout:()=>showNewTab?ZP5Form.getLayout():ZPForm.LAYOUT,getCurrFormConf:()=>showNewTab?ZP5Form.getFormsOperation().getFormsDetailsMap():ZPForm.CONF,getCurrFormCompData:()=>showNewTab?ZP5Form.getFormsOperation().getFormComponentData():ZPForm.FORM_COMPONENT_DATA,getApproverType:()=>showNewTab?ZP5Form.getFormsOperation().getApproverType():ZPForm.getApproverType(),markFieldAsError:(label,Obj)=>{showNewTab?ZP5Form.Field.markFieldAsError(label,Obj):ZPForm.Field.markFieldAsError(label,Obj)},toggleFormPage:()=>{showNewTab?ZP5Form.getFormClassObj().close():ZPForm.toggleFormPage()}},showAllDataForNonAdmin:function(){var showAllDataForNonAdmin=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.showAllDataForNonAdmin;return showAllDataForNonAdmin||!1},isSettingsAdmin:function(){return!!isadmin||(LVUtil.Tab.getLeaveModuleData(),ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.issettingsadmin)}};Leave.Settings={},Leave.Settings.Bradford={initPage:function(){Leave.Util.isBradfordFactorEnabled()?-1!==Layout.Page.hash.indexOf("#leavetracker/settings/bradford/list")?Leave.Settings.Bradford.List.get():-1!==Layout.Page.hash.indexOf("#leavetracker/settings/bradford/add")?Leave.Settings.Bradford.Operations.add():-1!==Layout.Page.hash.indexOf("#leavetracker/settings/bradford/edit")&&Leave.Settings.Bradford.Operations.view():Leave.Util.showHideNoRecord(!0,!1,void 0,!1,void 0,ZPI18N.getString("zp.bradfordfactor.error.enableerror"))},Util:{isSuccessResponse:function(result){return result&&"success"===result.status},getBradfordAllLeaveTypes:function(){return ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.bradfordLeaveTypes||[]}},List:{key:"list_bradford",bradford_details:{},data_loaded:!1,MAX_LIMIT:25,get:function(){if(!Leave.Settings.Bradford.List.data_loaded){var params={key:Leave.Settings.Bradford.List.key,sIndex:0};params.limit=Leave.Settings.Bradford.List.MAX_LIMIT,Leave.Util.regHeader(),Leave.Util.appendLoading(),ZPeople.FireScroll.init(Leave.Settings.Bradford.List.getMore),ZPeople.Request.send(Leave.Settings.url,params,Leave.Settings.Bradford.List.construct)}},getMore:function(limit){var params={key:Leave.Settings.Bradford.List.key};params.sIndex=ZPeople.FireScroll.getRecordCount()+1,params.limit=limit||Leave.Settings.Bradford.List.MAX_LIMIT,Leave.Util.appendLoading({containerId:"bf_setting_div",placement:"append"}),ZPeople.Request.send(Leave.Settings.url,params,Leave.Settings.Bradford.List.construct,{isFirescroll:!0})},construct:function(result,params,other_dtls){other_dtls&&other_dtls.isFirescroll?Leave.Settings.Bradford.Util.isSuccessResponse(result)&&result.data&&result.data.length>0&&(Leave.Settings.Bradford.List.populateData(result.data,!0),result.data.length>=params.limit&&ZPeople.FireScroll.reset()):(Leave.Settings.Bradford.List.bradford_details={},Leave.Settings.Bradford.List.data_loaded=!0,Leave.Settings.Bradford.Util.isSuccessResponse(result)?result.data&&0!==result.data.length?(ZPeople.FireScroll.setRecordCount(0),Leave.Settings.Bradford.List.populateData(result.data),ZPeople.FireScroll.setParam("triggered",!0),result.data.length>=params.limit&&ZPeople.FireScroll.reset()):Leave.Util.showHideNoRecord(!0,!1):(result.message?ModuleComp.Msg.showFailureMsg(result.message):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.bradfordfactor.error.list")),Leave.Util.showHideNoRecord(!0,!1))),Leave.Util.removeLoading()},populateData:function(dataArr,isFirescroll){for(var tempDoc=document.createDocumentFragment(),record_cnt=dataArr.length,bf_idx=0;bf_idx<record_cnt;bf_idx++)if(!Leave.Settings.Bradford.List.bradford_details||!Leave.Settings.Bradford.List.bradford_details[dataArr[bf_idx].bradfordId]){var bf_json=dataArr[bf_idx],detailsTr=Leave.Settings.Bradford.List.addBradfordRow(bf_json);tempDoc.appendChild(detailsTr),Leave.Settings.Bradford.List.bradford_details[bf_json.bradfordId]=bf_json}var tBody=$("tbody#bf_setting_tbody",Layout.Page.container);!isFirescroll&&tBody.html(""),tBody.append(tempDoc),isFirescroll||(Leave.Util.showHideNoRecord(!1,!1),$("#bf_setting_table",Layout.Page.container).delay(200).fadeIn(200).removeClass("DN")),ZPView.handleTablePosition(),ZPeople.FireScroll.increaseRecordCount(record_cnt)},addBradfordRow:function(bf_json){var detailsTr=ZP.create("tr",{class:"ZPLRow",bradfordId:bf_json.bradfordId,bf_json:bf_json});detailsTr.appendChild(ZP.create("td",{class:"CP",html:bf_json.settingName,clickable:"true"}));for(var leaveTd=ZP.create("td"),applicable_leaves=bf_json.appForLeaveTypes,moreContent="",leave_idx=0;leave_idx<applicable_leaves.length;leave_idx++){var leave_dtl=applicable_leaves[leave_idx];leave_idx<3?leaveTd.appendChild(ZP.create("div",{class:"lv_Tpes",html:leave_dtl.leaveTypeName})):moreContent+='<div class="lv_Tpes">'+leave_dtl.leaveTypeName+"</div>"}return""!==moreContent&&leaveTd.appendChild(ZP.create("a",{class:"popHover blu","data-popover":"true","data-content":moreContent,"data-placement":"bottom","data-html":"true",text:"+ "+(applicable_leaves.length-3)+" "+ZPI18N.getString("zp.more")})),detailsTr.appendChild(leaveTd),detailsTr.appendChild(Leave.Settings.Bradford.List.get_editdeleteTD(!0,bf_json.bradfordId,Leave.Settings.Bradford.Operations.deleteRec)),$(detailsTr).find(".popHover").popover().on("show.bs.popover",function(){$(this).closest("tr").siblings().find(".popover.in").popover("hide")}),$(detailsTr).find("td[clickable='true']").on("click",function(){window.location.href="#leavetracker/settings/bradford/edit-recordId:"+bf_json.bradfordId}),detailsTr},get_editdeleteTD:function(allowedit_delete,bradfordId,deleteRec){var td=ZP.create("td");if(allowedit_delete){var actionDiv=ZP.create("div",{class:"over-display FR"}),edit=$(ZP.create("a",{href:"#leavetracker/settings/bradford/edit-recordId:"+bradfordId})).append(ZP.create("i",{class:"IC-pen-1px dgry MR5 CP"})),del=ZP.create("i",{class:"IC-delete-1px dgry CP"});$(del).on("click",function(){Leave.Settings.Bradford.Operations.deleteConfirmMsg($(this).parent())}),$(actionDiv).append(edit),actionDiv.appendChild(del);var confirmDiv=ZP.create("div",{class:"ZP-Confirm collapse DN"});confirmDiv.appendChild(ZP.create("button",{class:"btn btn-default btn-sm FR MR15",text:ZPI18N.getString("zp.cancel")})),confirmDiv.appendChild(ZP.create("button",{class:"btn btn-danger btn-sm FR MR15",text:ZPI18N.getString("zp.confirm")})),$(".btn-danger",confirmDiv).on("click",function(){Leave.Settings.Bradford.Operations.deleteRec($(this))}),$(".btn-default",confirmDiv).on("click",function(){Leave.Settings.Bradford.Operations.deleteConfirmMsg($(this).parent())}),td.appendChild(actionDiv),td.appendChild(confirmDiv)}return td}},Operations:{add_update_key:"update_bradford",delete_key:"delete_bradford",list_key:"list_bradford",leavetypes_key:"leavetypes_bradford",construct:function(){var headerHtml='<div class="zp-back" data-dismiss="modal"><i class="IC-ar-lft"></i></div><div class="row"><div class="zp-sm-4 PT15"><h5>'+ZPI18N.getString("zp.bradfordfactor.addsetting")+'</h5></div><div class="zp-sm-4 PT15"></div></div><a data-dismiss="modal" class="IC-cls close"></a>',body='<div class="main-wrp"><form class="form-horizontal pad"><div class="Brdfd-wrpr"><div class="form-group"><label class="col-sm-12 zp_SubTtl">'+ZPI18N.getString("zp.bradfordfactor.settingname")+' </label><div class="col-sm-3"><input id="zp_bf_settingname" type="text" class="form-control"></div></div><div class="form-group"><label class="col-sm-12 zp_SubTtl">'+ZPI18N.getString("zp.bradfordfactor.applicableleave")+' </label><div class="col-sm-3"><select id="zp_bf_appleaves" multiple></select></div></div><div class="form-group"><label class="col-sm-12 zp_SubTtl">'+ZPI18N.getString("zp.bradfordfactor.numberoflevels")+' </label><div class="col-sm-3"><input id="zp_bf_nooflevels" class="form-control" type="number" min="2" max="5"></div></div><div class="form-group"><label class="col-sm-12 zp_SubTtl">'+ZPI18N.getString("zp.bradfordfactor.levelthreshold")+' </label><div class="col-sm-5"><table class="table thrshld_tbl"><thead><tr class="zp"><th>'+ZPI18N.getString("zp.bradfordfactor.threslevel")+"</th><th>"+ZPI18N.getString("zp.bradfordfactor.thresrange")+'</th></tr></thead><tbody id="zp_bf_levels"></tbody></div></div></div></div>';return ZPeople.BSModal.get({id:"zp_addedit_bradford",type:2,modalClass:"popRgtModel PopSsModel PopSgModel brd-addscr",headerHtml:headerHtml,body:body,deleteOnHide:!1,closeOnSubmit:!1,successCallback:Leave.Settings.Bradford.Operations.save})},add:function(){var modal=$("#zp_addedit_bradford",Layout.Page.Container);0===modal.length&&(modal=Leave.Settings.Bradford.Operations.construct()),modal.find(".modal-header h5").text(ZPI18N.getString("zp.bradfordfactor.addsetting")),Leave.Settings.Bradford.Operations.resetValues(modal),ZPeople.BSModal.show(modal,{backdrop:!1})},getCurrentBradfordId:function(){if(Layout.Page.childUrlParam&&Layout.Page.childUrlParam.recordId)return Layout.Page.childUrlParam.recordId},view:function(){var bradfordId=Leave.Settings.Bradford.Operations.getCurrentBradfordId();if(Leave.Settings.Bradford.List.bradford_details&&Leave.Settings.Bradford.List.bradford_details[bradfordId])Leave.Settings.Bradford.Operations.update(Leave.Settings.Bradford.List.bradford_details[bradfordId]);else{Leave.Util.appendLoading();var params={key:Leave.Settings.Bradford.Operations.list_key,bradfordId:bradfordId};ZPeople.Request.send(Leave.Settings.url,params,Leave.Settings.Bradford.Operations.viewCallback)}},viewCallback:function(result,params){Leave.Settings.Bradford.Util.isSuccessResponse(result)&&result.data&&result.data.length>0?Leave.Settings.Bradford.Operations.update(result.data[0]):(result.message?ModuleComp.Msg.showFailureMsg(result.message):(ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.bradfordfactor.error.list")),Leave.Util.showHideNoRecord(!0,!1)),Leave.Util.removeLoading())},update:function(bf_json){var modal=$("#zp_addedit_bradford",Layout.Page.Container);0===modal.length&&(modal=Leave.Settings.Bradford.Operations.construct()),modal.find(".modal-header h5").text(ZPI18N.getString("zp.bradfordfactor.editsetting")),Leave.Settings.Bradford.Operations.resetValues(modal),Leave.Settings.Bradford.Operations.populateValues(modal,bf_json),ZPeople.BSModal.show(modal,{backdrop:!1}),Leave.Util.removeLoading()},resetValues:function(modal){$(".error-clr",modal).removeClass(),$(".error-msg",modal).remove(),$("#zp_bf_settingname",modal).val("");var optionsHtml=$("#zp_bf_appleaves",modal).html();if(""===optionsHtml){for(var leaveArr=Leave.Settings.Bradford.Util.getBradfordAllLeaveTypes(),leaveTypeTxt=$("<div></div>"),i=0;i<leaveArr.length;i++){var leaveJson=leaveArr[i];leaveTypeTxt.append($('<option value="'+leaveJson.leaveTypeId+'">'+leaveJson.leaveTypeName+"</option>"))}optionsHtml=$(leaveTypeTxt).html()}$("#zp_bf_appleaves",modal).html(optionsHtml).val("").select2({placeholder:ZPI18N.getString("zp.select"),maximumSelectionSize:25,closeOnSelect:!1}),$("#zp_bf_nooflevels",modal).val(2),$("#zp_bf_levels",modal).html(Leave.Settings.Bradford.Operations.getThresholdTBodyDefaultHtml()),$("#zp_bf_nooflevels",modal).on("change",function(){Leave.Settings.Bradford.Operations.onLevelChange(this)}),$("input#zp_level1",modal).on("keyup",function(){Leave.Settings.Bradford.Operations.onThresholdChange(this)}),$(".modal-header>.close,.modal-header>.zp-back,#zp_modal_whitebtn",modal).on("click",function(){Leave.Settings.Bradford.Operations.hideModal()})},populateValues:function(modal,bf_json){$("#zp_bf_settingname",modal).val(ZPeople.decodeTxt(bf_json.settingName));for(var selectLeaveTypes=new Array,appForLeaveTypes=bf_json.appForLeaveTypes,i=0;i<appForLeaveTypes.length;i++)selectLeaveTypes.push(appForLeaveTypes[i].leaveTypeId);$("#zp_bf_appleaves",modal).val(selectLeaveTypes).select2(),$("#zp_bf_nooflevels",modal).val(bf_json.noOfLevels);var bradfordLevels=bf_json.bradfordLevels,tbody=$("#zp_bf_levels",modal),rows=Leave.Settings.Bradford.Operations.getLevelRows(bradfordLevels);$(tbody).html(""),$(tbody).append($(rows).children())},onLevelChange:function(ele){var noOfLevels=$(ele).val();if($(ele).removeClass("error-clr"),$(ele).siblings(".error-msg").remove(),$(ele).parents("#zp_addedit_bradford").find(".btn-primary.disabled").removeClass("disabled"),ZPUtil.Validation.isEmpty(noOfLevels)||!ZPUtil.Validation.isNumber(noOfLevels))return $(ele).addClass("error-clr"),void Leave.Util.toggleButton({containerId:"zp_addedit_bradford",buttonClass:"btn-primary"});if((noOfLevels=parseInt(noOfLevels))<2||noOfLevels>5)return $(ele).addClass("error-clr"),Leave.Settings.Bradford.Operations.appendErrorMsg({noOfLevels:noOfLevels<2?ZPI18N.getString("zp.bradfordfactor.error.validlevelthreshold"):ZPI18N.getString("zp.bradfordfactor.error.maxlevelthreshold")}),void Leave.Util.toggleButton({containerId:"zp_addedit_bradford",buttonClass:"btn-primary"});var tbody=$("#zp_bf_levels",Layout.Page.Container),lastLevelTr=$(tbody).find("tr[level='last']");$(tbody).find("tr").length>noOfLevels&&$(tbody).find("input[id=zp_level"+(noOfLevels-1)+"]").closest("tr").nextUntil(lastLevelTr).remove();for(var i=2;i<noOfLevels;i++){$(tbody).find("input[id=zp_level"+i+"]").closest("tr");if(0===$(tbody).find("input[id=zp_level"+i+"]").length){var prev_val=$(tbody).find("input[id=zp_level"+(i-1)+"]").val(),newLevelRow=$('<tr level="'+i+'"><td>'+ZPI18N.getString("zp.Level")+" "+i+'</td><td><span id="zp_level'+i+'" class="thsval_frm W80"> &gt; '+prev_val+'</span> - <input id="zp_level'+i+'" level="'+i+'" type="text" class="form-control W80"></td></tr>');$(lastLevelTr).before($(newLevelRow))}}$(tbody).find("tr input[id^='zp_level']").on("keyup",function(){Leave.Settings.Bradford.Operations.onThresholdChange(this)}),$(lastLevelTr).find("#zp_lastlevel_label").html(ZPI18N.getString("zp.Level")+" "+i),$(lastLevelTr).find("span#zp_lastlevel").text(" > "+$(tbody).find("input[id=zp_level"+(i-1)+"]").val())},getLevelRows:function(bradfordLevels){for(var rows=$("<div></div>"),level=0,prev_val=0,i=0;i<bradfordLevels.length;i++){var leveljson=bradfordLevels[i],threshold=(level=leveljson.level,leveljson.threshold);$(rows).append($('<tr level="'+level+'"><td>'+ZPI18N.getString("zp.Level")+" "+level+'</td><td><span id="zp_level'+level+'" class="thsval_frm W80"> &gt; '+prev_val+'</span> - <input id="zp_level'+level+'" level="'+level+'" type="text" value="'+threshold+'" class="form-control W80"></td></tr>')),prev_val=threshold}return $(rows).find("tr input[id^='zp_level']").on("keyup",function(){Leave.Settings.Bradford.Operations.onThresholdChange(this)}),$(rows).append('<tr level="last"><td id="zp_lastlevel_label">'+ZPI18N.getString("zp.Level")+" "+(level+1)+'</td><td><span id="zp_lastlevel" level="last" class="thsval_frm"> &gt; '+prev_val+"</span></td></tr>"),rows},onThresholdChange:function(ele){var threshold=$(ele).val();if($(ele).removeClass("error-clr"),$(ele).parents("table").siblings(".error-msg").remove(),$(ele).parents("#zp_addedit_bradford").find(".btn-primary.disabled").removeClass("disabled"),"SUCCESS"!==ZPUtil.Validation.isDecimal(threshold).message)return $(ele).addClass("error-clr"),void Leave.Util.toggleButton({containerId:"zp_addedit_bradford",buttonClass:"btn-primary"});$(ele).attr("level");var nextleveltr=$(ele).closest("tr").next();"last"===nextleveltr.attr("level")?nextleveltr.find("span#zp_lastlevel").text(" > "+threshold):nextleveltr.find("span").text(" > "+threshold)},getThresholdTBodyDefaultHtml:function(){return'<tr level="1"><td>'+ZPI18N.getString("zp.Level")+' 1</td><td><span id="zp_level1" class="thsval_frm W80">0</span> - <input id="zp_level1" level="1" type="text" class="form-control W80"></td></tr><tr level="last"><td id="zp_lastlevel_label">'+ZPI18N.getString("zp.Level")+' 2</td><td><span id="zp_lastlevel" level="last" class="thsval_frm"> > </span></td></tr>'},validate:function(modal,params){$(".error-clr",modal).removeClass("error-clr"),$(".error-msg",modal).remove();var settingName=$("#zp_bf_settingname",modal).val();if(ZPUtil.Validation.isEmpty(settingName))return $("#zp_bf_settingname",modal).addClass("error-clr"),Leave.Settings.Bradford.Operations.appendErrorMsg({settingName:ZPI18N.getString("zp.bradfordfactor.error.validscorename")},modal),!1;if(settingName.length>255)return $("#zp_bf_settingname",modal).addClass("error-clr"),Leave.Settings.Bradford.Operations.appendErrorMsg({settingName:ZPI18N.getString("zp.bradfordfactor.error.scorenamelen")},modal),!1;params.settingName=settingName;var appForLeaveTypes=$("#zp_bf_appleaves",modal).val();if(void 0===appForLeaveTypes||null===appForLeaveTypes||""===appForLeaveTypes||appForLeaveTypes.length<1)return $("#zp_bf_appleaves",modal).addClass("error-clr"),Leave.Settings.Bradford.Operations.appendErrorMsg({appForLeaveTypes:ZPI18N.getString("zp.bradfordfactor.error.validapplicableleave")},modal),!1;params.appForLeaveTypes=JSON.stringify(appForLeaveTypes);var noOfLevels=$("#zp_bf_nooflevels",modal).val();if(ZPUtil.Validation.isEmpty(noOfLevels)||!ZPUtil.Validation.isNumber(noOfLevels))return $("#zp_bf_nooflevels",modal).addClass("error-clr"),Leave.Settings.Bradford.Operations.appendErrorMsg({noOfLevels:ZPI18N.getString("zp.bradfordfactor.error.validnooflevels")},modal),!1;if((noOfLevels=parseInt(noOfLevels))<2||noOfLevels>5)return $("#zp_bf_nooflevels",modal).addClass("error-clr"),Leave.Settings.Bradford.Operations.appendErrorMsg({noOfLevels:noOfLevels<2?ZPI18N.getString("zp.bradfordfactor.error.validlevelthreshold"):ZPI18N.getString("zp.bradfordfactor.error.maxlevelthreshold")},modal),!1;params.noOfLevels=noOfLevels;for(var thresholdValues="",thresholdArr=new Array,leveltrs=$("#zp_bf_levels",modal).find("tr"),i=0;i<leveltrs.length-1;i++){var threshold=$("input#zp_level"+(i+1),leveltrs[i]).val();if(ZPUtil.Validation.isEmpty(threshold)||"SUCCESS"!==ZPUtil.Validation.isDecimal(threshold).message)return $("input#zp_level"+(i+1),leveltrs[i]).addClass("error-clr"),Leave.Settings.Bradford.Operations.appendErrorMsg({bradfordLevels:ZPI18N.getString("zp.bradfordfactor.error.validthreshold")},modal),!1;if(parseFloat(threshold)<=0)return $("input#zp_level"+(i+1),leveltrs[i]).addClass("error-clr"),Leave.Settings.Bradford.Operations.appendErrorMsg({bradfordLevels:ZPI18N.getString("zp.bradfordfactor.error.validthreshold")},modal),!1;for(var j=0;j<i;j++)if(parseFloat(threshold)<=thresholdArr[j])return $("input#zp_level"+(i+1),leveltrs[i]).addClass("error-clr"),Leave.Settings.Bradford.Operations.appendErrorMsg({bradfordLevels:parseFloat(threshold)==thresholdArr[j]?ZPI18N.getString("zp.bradfordfactor.error.dupthreshold"):ZPI18N.getString("zp.bradfordfactor.error.minprevlevelthreshold")},modal),!1;thresholdArr.push(parseFloat(threshold)),thresholdValues+=threshold+","}if(ZPUtil.Validation.isEmpty(thresholdValues))return Leave.Settings.Bradford.Operations.appendErrorMsg({bradfordLevels:ZPI18N.getString("zp.bradfordfactor.error.validlevelthreshold")},modal),!1;if(params.bradfordLevels=thresholdValues,params.bradfordId){var bf_json=Leave.Settings.Bradford.List.bradford_details[params.bradfordId];if(bf_json){var noChanges=params.settingName===ZPeople.decodeTxt(bf_json.settingName)&&appForLeaveTypes.length===bf_json.appForLeaveTypeIds.length&&params.noOfLevels===bf_json.noOfLevels&&thresholdArr.length===bf_json.bradfordLevels.length;if(noChanges)for(i=0;i<appForLeaveTypes.length;i++)if(-1===bf_json.appForLeaveTypeIds.indexOf(appForLeaveTypes[i])){noChanges=!1;break}if(noChanges){var bradfordLevels=bf_json.bradfordLevels;for(i=0;i<bradfordLevels.length;i++){var level=bradfordLevels[i].level;if(bradfordLevels[i].threshold!==thresholdArr[level-1]){noChanges=!1;break}}}if(noChanges)return ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.nochangesmade")),!1}}return!0},save:function(modal){Leave.Util.toggleButton({containerId:"zp_addedit_bradford",buttonClass:"btn-primary"});var params={key:Leave.Settings.Bradford.Operations.add_update_key},bradfordId=Leave.Settings.Bradford.Operations.getCurrentBradfordId();bradfordId&&(params.bradfordId=bradfordId),Leave.Settings.Bradford.Operations.validate(modal,params)?(Leave.Util.appendLoading({type:"popup",containerId:"zp_addedit_bradford",containerClass:"main-wrp"}),modal.find(".main-wrp form").hide(),ZPeople.Request.send(Leave.Settings.url,params,Leave.Settings.Bradford.Operations.addUpdateCallback)):Leave.Util.toggleButton({containerId:"zp_addedit_bradford",buttonClass:"btn-primary"})},addUpdateCallback:function(result,params){var isUpdate=params.bradfordId&&!0;if(Leave.Settings.Bradford.Util.isSuccessResponse(result)){ModuleComp.Msg.showSuccessMsg(isUpdate?ZPI18N.getString("zp.bradfordfactor.success.update"):ZPI18N.getString("zp.bradfordfactor.success.add"));var bf_json=result.bradford_details;Leave.Settings.Bradford.List.bradford_details[bf_json.bradfordId]=bf_json;var detailsTr=Leave.Settings.Bradford.List.addBradfordRow(bf_json);if(isUpdate){$("tbody#bf_setting_tbody>tr[bradfordId="+params.bradfordId+"]",Layout.Page.container).replaceWith(detailsTr)}else{var tBodyEle=$("tbody#bf_setting_tbody",Layout.Page.container);tBodyEle.append(detailsTr),tBodyEle.parents("div#bf_setting_div").is(":visible")||(Leave.Util.showHideNoRecord(!1,!1),ZPView.handleTablePosition())}Leave.Settings.Bradford.Operations.hideModal()}else result&&"VALIDATIONERROR"===result.status?(Leave.Settings.Bradford.Operations.appendErrorMsg(result.error),Leave.Util.toggleButton({containerId:"zp_addedit_bradford",buttonClass:"btn-primary"})):(result&&result.message?ModuleComp.Msg.showFailureMsg(result.message):ModuleComp.Msg.showFailureMsg(isUpdate?ZPI18N.getString("zp.bradfordfactor.error.update"):ZPI18N.getString("zp.bradfordfactor.error.add")),Leave.Settings.Bradford.Operations.hideModal());Leave.Util.removeLoading(),Layout.Page.container.find("#zp_addedit_bradford").find(".main-wrp form").show()},appendErrorMsg:function(errorjson,modal){(modal=modal||$("#zp_addedit_bradford",Layout.Page.Container)).find(".error-msg").remove(),$.each(errorjson,function(label){var id,msg=errorjson[label],errorDiv=$('<div class="error-msg">'+msg+"</div>");"settingName"===label?id="zp_bf_settingname":"appForLeaveTypes"===label?id="zp_bf_appleaves":"noOfLevels"===label?id="zp_bf_nooflevels":"bradfordLevels"===label&&(id="zp_bf_levels"),id?"zp_bf_levels"===id?$("#zp_bf_levels",modal).parents(".thrshld_tbl").after(errorDiv):$("#"+id,modal).after(errorDiv):ModuleComp.Msg.showFailureMsg(msg)})},hideModal:function(){ZPeople.BSModal.hide("zp_addedit_bradford");var modal=Layout.Page.container.find("#zp_addedit_bradford");modal.find(".main-wrp form").show(),modal.find(".btn-primary").removeClass("disabled"),window.location.href="#leavetracker/settings/bradford/list"},deleteConfirmMsg:function(ele){$(ele).css("overflow-x","hidden"),$(ele).toggle("drop",{direction:"right"},200,function(){$(ele).siblings().toggle("drop",200),$(ele).css("overflow-x","")})},deleteRec:function(ele){var tr=$(ele).closest("tr"),bradfordId=$(tr).attr("bradfordId"),params={key:Leave.Settings.Bradford.Operations.delete_key,bradfordId:bradfordId};Leave.Util.appendLoading(),ZPeople.Request.send(Leave.Settings.url,params,Leave.Settings.Bradford.Operations.deleteCallback,{row:tr})},deleteCallback:function(result,params,other_dtls){Leave.Settings.Bradford.Util.isSuccessResponse(result)?(ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.bradfordfactor.success.delete")),$(other_dtls.row).remove(),delete Leave.Settings.Bradford.List.bradford_details[params.bradfordId],ZPeople.FireScroll.setRecordCount(ZPeople.FireScroll.getRecordCount()-1),0===$("tbody#bf_setting_tbody",Layout.Page.Container).find("tr").length?Leave.Util.showHideNoRecord(!0,!1):ZPeople.FireScroll.getFireScrollPropertie().triggered||Leave.Settings.Bradford.List.getMore(1)):result&&result.message?ModuleComp.Msg.showFailureMsg(result.message):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.bradfordfactor.error.delete")),Leave.Util.removeLoading()}}},Leave.Policy={url:"leave_v2_settings_actions.zp",exporturl:"leave_v2_settings_export.zp"},Leave.Policy.ENTRYTYPE={1:ZPI18N.getString("zp.leave.transaction.reportstart"),2:ZPI18N.getString("zp.leavetype.v2.entitlement.carryprevbalance"),3:ZPI18N.getString("zp.leave.openingbalance"),4:ZPI18N.getString("zp.leave.transaction.carryfwdexpiry"),6:ZPI18N.getString("zp.reset"),9:ZPI18N.getString("zp.leave.openingbalance"),12:ZPI18N.getString("zp.leave.granted"),15:ZPI18N.getString("zp.leavetype.accrual"),16:ZPI18N.getString("zp.leavetype.accrual"),18:ZPI18N.getString("zp.leave.transaction.manual"),19:ZPI18N.getString("zp.leave.transaction.deductholidays"),21:ZPI18N.getString("zp.leave.transaction.leavetaken"),22:ZPI18N.getString("zp.leave.transaction.leavetaken"),23:ZPI18N.getString("zp.leave.transaction.leavetaken"),31:ZPI18N.getString("zp.leave.transaction.leavetaken"),32:ZPI18N.getString("zp.leave.transaction.leavetaken"),33:ZPI18N.getString("zp.leave.transaction.leavetaken"),41:ZPI18N.getString("zp.leave.transaction.leaverejected"),51:ZPI18N.getString("zp.leave.transaction.lopadjustments"),61:ZPI18N.getString("zp.leave.transaction.graceperiod"),71:ZPI18N.getString("zp.leave.transaction.carryfwdexpiry")+" ("+ZPI18N.getString("zp.leavetype.v2.entitlement.endofday")+")",73:ZPI18N.getString("zp.reset")+" ("+ZPI18N.getString("zp.leavetype.v2.entitlement.endofday")+")",get:function(type,isArchive){return isArchive&&-1!=["21","22","23","31","31","33"].indexOf(type+"")?ZPI18N.getString("zp.leave.transaction.leavetakenrejected"):Leave.Policy.ENTRYTYPE[type]}},Leave.Policy.Transaction={},Leave.Policy.Transaction.View={name:void 0,ltId:void 0,init:function(ele,id,name){if(ele){var parentTr=$(ele).parents("tr");Leave.Policy.Transaction.View.ltId=parentTr.data("id"),Leave.Policy.Transaction.View.name=parentTr.data("name"),Leave.Policy.Transaction.View.get(Leave.Util.getEmpFilterValue(),parentTr.data("id"))}else Leave.Policy.Transaction.View.ltId=id,Leave.Policy.Transaction.View.name=name,Leave.Policy.Transaction.View.get(Leave.Util.getEmpFilterValue(),id)},get:function(employee,leavetype,isRgtModal){var ele=Layout.Page.container.find("#ZP_Transaction_popup"),params={key:"viewtransaction"};params.employee=employee,params.leavetypeid=leavetype,$(ele).length>0&&(params.from=ele.find("[name=from]").val(),params.to=ele.find("[name=to]").val()),params.hasOwnProperty("from")&&params.hasOwnProperty("to")&&!Leave.Util.Validate.noofDays(params.from,params.to,3650,ZPI18N.getString("zp.leavetype.v2.error.daterange"))||ZPeople.Request.send("/leave_common_action.zp",params,function(response,param){Leave.Policy.Transaction.View.construct(response,param,isRgtModal)})},getParams:function(employee,leavetype,isRgtModal){var ele=Layout.Page.container.find("#ZP_Transaction_popup"),params={key:"viewtransaction"};return params.employee=employee,params.leavetypeid=leavetype,$(ele).length>0&&(params.from=ele.find("[name=from]").val(),params.to=ele.find("[name=to]").val()),!(params.hasOwnProperty("from")&&params.hasOwnProperty("to")&&!Leave.Util.Validate.noofDays(params.from,params.to,3650,ZPI18N.getString("zp.leavetype.v2.error.daterange")))&&params},construct:function(resp,params,isrgtmodal){var employee=params.employee,leavetype=params.leavetypeid,ltName=this.name?this.name:Leave.Util.getLeaveTypeName(leavetype);if(0==Layout.Page.container.find("#ZP_Transaction_popup").length){var template=$('<div class="modal ZPsecModal '+(isrgtmodal?"popRgtModel PopLgModel":"fade")+'" role="dialog" data-keyboard="true" tabindex="-1" id="ZP_Transaction_popup"><div class="modal-dialog '+(isrgtmodal?"":'calwkpop calpluspop ZPCLmdl" role="document" style="width:'+.65*$(window).width()+'px"')+'"><div class="modal-content"><div class="modal-header '+(isrgtmodal?"PR ZPbgblue":"")+'" id="heading" style="border-bottom: 1px solid #e5e5e5;"><div class="ZP-UserProfPop"><div class="col-sm-4">'+(isrgtmodal?'<i class="iconbck IC-ar-lft DI PR10" style="margin-top:7px;" data-dismiss="modal"></i>':"")+'<h6 class="addPopTitle pull-left W250 ellipsis" data-toggle="tooltip" data-placement="bottom" title="'+ltName+'">'+ltName+'</h6></div><div class="btnCal ZPft DIB ML10"><input type="text" caltype="filter" class="ZP-Date form-control W120" name="from" placeholder='+ZPI18N.getString("zp.from")+'></div>&nbsp; - <div class="btnCal ZPft ML5 DIB"><input type="text" caltype="filter" class="ZP-Date form-control W120" name="to" placeholder='+ZPI18N.getString("zp.to")+"></div>"+(isrgtmodal?"":'<button aria-label="Close" data-dismiss="modal" class="close" type="button"><span aria-hidden="true"><div class="IC-cls-1px MR10 MT8 red S21 CP"></div></span></button>')+(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.allowExport?'<span class="IC-exprt blu MR5 FR MT7 S15 CP" onclick="Leave.Util.showExport(this)" data-toggle="tooltip" data-placement="bottom" title="'+ZPI18N.getString("zp.export")+'"></span>':"")+'</div></div><div class="modal-body P0I" id="ZP_Transaction_popup_body" style="padding-top:40px!important;'+(isrgtmodal?"bottom:0px;":"height:"+.75*$(window).height()+"px")+'"></div></div></div></div>'),table=$('<div class="table-responsive"><table class="table table-hover Tlis" style="display: table;"><thead><tr class="ZPLHRow TblGryBg"><th style="width:25%">'+ZPI18N.getString("zp.date")+'</th><th style="width:25%">'+ZPI18N.getString("zp.type")+'</th><th style="width:15%">'+ZPI18N.getString("zp.added")+'</th><th style="width:15%">'+ZPI18N.getString("zp.Used")+'</th><th style="width:15%">'+ZPI18N.getString("zp.leave.view.balance")+"</th></tr></thead><tbody></tbody></table></div>"),tbody=table.find("tbody");table.find("tbody").append(tbody),template.find(".modal-body").append(table),template.on("hidden.bs.modal",function(){setTimeout(function(){Layout.Page.container.find("#ZP_Transaction_popup").remove()},500)}),Layout.Page.container.append(template);var ele=Layout.Page.container.find("#ZP_Transaction_popup");ele.modal({backdrop:"static"}),setTimeout(function(){ele.removeClass("fade")},500);ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date;ele.find("[name=from]").val(Calendar.formatDate(new Date((new Date).getFullYear(),0,1),uidateFormat)),ele.find("[name=to]").val(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date),ele.find("[name=from],[name=to]").on("click",function(event){Calendar.setUpCalendar(event,this,void 0,void 0,function(){Leave.Policy.Transaction.View.get(employee,leavetype)})}),ele.find("[name=from],[name=to]").on("change",function(){Leave.Policy.Transaction.View.get(employee,leavetype)})}tbody=Layout.Page.container.find("#ZP_Transaction_popup").find("tbody").empty();if(_.isEmpty(resp.data))Leave.Util.showHideNoRecord(!0,!1,Layout.Page.container.find("#ZP_Transaction_popup").find(".modal-body"));else{var showEntriesAsDisabled=!1;$.each(resp.data,function(indx,obj){var tr=ZP.create("tr",{class:"ZPLRow "+(showEntriesAsDisabled||obj.isArchive?"dgry":"")});tr.appendChild(ZP.create("td",{text:obj.date}));var added="-",used="-",runningbalance="-";if(obj.isArchive||(added=obj.added?parseFloat(obj.added):0,used=obj.used?parseFloat(obj.used):0,runningbalance=obj.runningbalance?parseFloat(obj.runningbalance):0,added=added%1==0?parseInt(added):added,used=used%1==0?parseInt(used):used,runningbalance=runningbalance%1==0?parseInt(runningbalance):runningbalance,added=0==added?"-":added,used=0==used?"-":used),obj.isEmpExitEntry)tr.appendChild(ZP.create("td",{text:ZPI18N.getString("zp.leave.transaction.employeeexited")})),showEntriesAsDisabled=!0;else if(51==obj.type){var loptd=ZP.create("td",{class:"calemdlic",text:Leave.Policy.ENTRYTYPE.get(obj.type,obj.isArchive)+""});obj.reason&&loptd.appendChild(Leave.Policy.Transaction.View.getInfoHTMl(obj)),tr.appendChild(loptd)}else if(18==obj.type){var td=ZP.create("td",{class:"calemdlic",text:obj.reason&&obj.reason.trim().length>0?obj.reason:Leave.Policy.ENTRYTYPE.get(obj.type,obj.isArchive)});td.appendChild(Leave.Policy.Transaction.View.getInfoHTMl(obj,!0)),tr.appendChild(td)}else tr.appendChild(ZP.create("td",{text:obj.reason&&obj.reason.trim().length>0?obj.reason:Leave.Policy.ENTRYTYPE.get(obj.type,obj.isArchive)}));tr.appendChild(ZP.create("td",{text:added})),tr.appendChild(ZP.create("td",{text:used})),tr.appendChild(ZP.create("td",{text:runningbalance})),$(tr).data("id",obj.pkId),tbody.append(tr),tbody.find("[data-popover=true]").popover()}),Leave.Util.showHideNoRecord(!1,!1,Layout.Page.container.find("#ZP_Transaction_popup").find(".modal-body")),Leave.Util.fixHeaderInModal(Layout.Page.container.find("#ZP_Transaction_popup table"))}},getInfoHTMl({type:type,reason:reason,modified:modified},skipReason){var info=!skipReason&&reason&&reason.trim().length>0?`<p class='LH18I'><b>${ZPI18N.getString("zp.reason")} : </b> ${ZPeople.escapeHtml(reason)}</p>`:"";return modified&&(info+=`<p class='LH18I'><b>${51==type?ZPI18N.getString("zp.modifiedby"):ZPI18N.getString("zp.addedby")} : </b> ${ZPeople.escapeHtml(modified.by)}</p>\n\t\t\t\t \t\t  <p class='LH18I'><b>${51==type?ZPI18N.getString("zp.modifiedon"):ZPI18N.getString("zp.addedon")} : </b> ${modified.at}</p>`),ZP.create("i",{class:"CR-info popHover","data-html":"true","data-popover":"true","data-placement":"bottom","data-content":info,"data-original-title":"",title:""})}},Leave.organizationTag={isOrgTagEnabled:void 0,isEnabled:function(){return void 0==this.isOrgTagEnabled&&(this.isOrgTagEnabled=ZPeople.Module.MODULE_DATA.leavetracker&&ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops&&ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isOrgTagEnabled),this.isOrgTagEnabled},fetchParams:function(filterDiv,params){if(!this.isEnabled())return params;let filterData=ZPLite.Filters.getValues(filterDiv.find('[name="orgTagFilter"]'));if(void 0!==filterData&&filterData.length>0){var orgTagId=[];$.each(filterData,function(index,options){orgTagId.push(options.id)}),params.orgTag=JSON.stringify(orgTagId)}return params},constructOptions:function(result,cache){if(!this.isEnabled()||!result.orgTagList)return cache;let orgTagList=result.orgTagList,orgTagOption="";for(var orgTagId in orgTagList)-1===(orgTagId+"").indexOf("_notEnc")&&(orgTagOption+="<option value="+orgTagId+">"+orgTagList[orgTagId]+"</option>");cache.orgTagOption=orgTagOption}},Leave.roleFilter={isEnabled:()=>ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isRoleFilEnabled},Leave.exportForm={getHTMLFormDataObj:function(id,formParentId,action,method,target,params){params=params||{};let formObj,getInputOutline=(formObj,name,value)=>{formObj.append('<input type="hidden" name="'+name+'" value="" />'),formObj.find("input[name="+name+"]").val(value)},attrs={action:action,method:method};return target&&(attrs.target=target),0==(formObj=""!==formParentId?$("#"+id,"#"+formParentId).html(""):$("#"+id).html("")).length&&(formObj=$("<form id='"+id+"' action='"+action+"' method='"+method+"' target='"+target+"' style='display:none'/>").html(""),""!==formParentId?$("#"+formParentId).append(formObj):$("body").append(formObj)),formObj.attr(attrs),method&&"post"==method.toLowerCase()&&!params.hasOwnProperty(csrfParamName)&&getInputOutline(formObj,csrfParamName,csrfToken),Object.keys(params).forEach(name=>{getInputOutline(formObj,name,params[name])}),formObj}};var TAMSUtil={};TAMSUtil.UserSpace={HoliDays:{construct:function(cardContainer,holidayReport){if($.isEmptyObject(holidayReport))return!1;var param={header:ZPI18N.getString("zp.leave.dashboard.upholiday"),class:"zpl_mspace-gap",ICNclass:"PI_s_leave"},content=ActionList.Component.actionlistcontainer(param),contentwrap=content.find("#action_list_wrap"),list=$('<div class="zpl_mspace-gap"></div>');contentwrap.append(list),holidayReport.hasOwnProperty("holidayList")&&(holidayReport.holidayList.forEach(function(holidayData){var daydetails=holidayData.daydetails,classificationName=holidayData.classification,classificationType=holidayData.classificationType;daydetails.forEach(function(detail){var date=Calendar.parseDate(detail.dis_date,uidateFormat),HolidayName=holidayData.name,holidayDate=date.getDate()+" - "+months[date.getMonth()],holidayDay=daysFull[date.getDay()];list.append(TAMSUtil.UserSpace.HoliDays.holidayCard(HolidayName,holidayDate,holidayDay,holidayData.isoptional,detail.dis_date,detail.isAvailed,holidayReport.allowAdd,classificationType,classificationName))})}),list.append($('<div class="d-flexC"><a>'+ZPI18N.getString("zp.viewall")+"</a></div>").on("click",function(){window.location.href=LVUtil.urls.Holiday.HOME()})),cardContainer.append(content))},holidayCard:function(holiday,date,day,type,hdate,isAvailed,allowAdd,classificationType,classificationName){var homeDtls=ZPeople.Module.MODULE_DATA.home,restrictedHolidayName=void 0!=homeDtls?homeDtls.holiday.restrictedHolidayName:void 0;classificationType=void 0!=classificationType?classificationType:0,classificationName=void 0!=classificationName?classificationName:"",classificationName=1===classificationType&&void 0!==restrictedHolidayName?restrictedHolidayName:2==classificationType?classificationName:"";let hliday=$('<div class="zpl_mspace-lvecrd '+(1===classificationType?"zpl_seclr_bdr9 hldbdrbg_rstrc":"zpl_seclr_bdr1 hldbdrbg_hld")+' "><div class="d-flexC"><div>'+holiday+"</div>"+(""!=classificationName?'<span class="zpl_dots"></span><div>'+ZSEC.Encoder.encodeForHTML(classificationName)+"</div>":"")+"</div");return hliday.append($("<p>"+date+", "+day+"</p></div>")),1===classificationType&&1!=isAvailed&&allowAdd&&hliday.append($('<div class="zpl_msphvr"> <button class="zlabel zlabel--blue zlabel--small zlabel--outline">'+ZPI18N.getString("zp.leave.avail")+"</button> </div></div>").data("date",hdate).on("click",function(){Leave.viewRecord.applyOptionalHoliday($(this))})),hliday}},Absent:{construct:function(cardContainer,data){if("undefined"!=typeof ActionList&&void 0==ActionList.Card.wrapperEle)return;ActionList.Card.wrapperEle.find("#allabsent_card").remove(),ActionList.Card.wrapperEle.find("#prevday_absentcard").remove();let absData=data.absdata;if(absData&&absData.length>0){var form_name=ZPeople.Module.MODULE_DATA.home.form_name.leave;let btn_name=ZPI18N.getString("zp.apply")+" "+form_name;cardContainer.addClass("zpl_msplst zpl_mspgroup"),cardContainer.attr("id","allabsent_card");let html='<div><span class="PI_s_leave icn"></span> <div><div class="zpl_msp-dts"><div class="zpl_msp-name"><div class="zpl_msp-title">'+ZPI18N.getString("zp.myspaceabsdesc")+"</div></div></div>";html+='<div class="zpl_mspace-gap">';let currDateObj=new Date;currDateObj.setTime(ZPDateTime.convertToTimezone(currDateObj.getTime()));let currMonth=currDateObj.getUTCMonth();currDateObj.setTime(currDateObj.setDate(currDateObj.getUTCDate()-1));let prevDate=currDateObj.getUTCDate(),prevMonth=currDateObj.getUTCMonth(),len=absData.length>5?5:absData.length;for(let i=0;i<len;i++){let absRec=absData[i],postedDateObj=new Date(absRec.fromDate),recDate=postedDateObj.getDate(),recMonth=postedDateObj.getMonth();prevDate!==recDate||recMonth!==currMonth&&recMonth!==prevMonth||TAMSUtil.UserSpace.Absent.addOneDayCard(cardContainer,btn_name,absRec.recordId,data.allowAdd),html+='<div class="zpl_mspace-lvecrd"> <span> <b>'+absRec.from+", "+absRec.fromDay+"</b> </span> <p>"+absRec.leaveTaken+" "+absRec.leaveUnit+'</p><div class="zpl_msphvr" recordId="'+absRec.recordId+'">'+(data.allowAdd?' <button class="zlabel zlabel--blue zlabel--small" id="zp_conlv" title="'+btn_name+'">'+btn_name+"</button>":"")+(data.regAllowed?' <button class="zlabel zlabel--blue zlabel--small zlabel--outline" fromDate="'+absRec.fromDate+'" id="zp_reglv">'+ZPI18N.getString("zp.regularize")+"</button>":"")+"</div> </div>"}absData.length>5&&(html+='<div class="zpl_mspace-lvecrd-more"> <a>'+ZPI18N.getString("zp.viewmore")+"</a> </div> </div> </div>"),html+="</div></div>",cardContainer.append(html),cardContainer.find("[id='zp_conlv']").on("click",function(){LVUtil.urls.prevUrl.setHash();let recordId=$(this).parents(".zpl_msphvr").attr("recordId");void 0==recordId&&(recordId=$(this).parents(".zpl_hvr").attr("recordId")),window.location.href=LVUtil.urls.ListView.CONVERT()+":"+recordId}),cardContainer.find("[id='zp_reglv']").on("click",function(){let fromDate=$(this).attr("fromDate"),postedDateObj=new Date(fromDate),recDate=postedDateObj.getDate(),recMonth=postedDateObj.getMonth(),recyear=postedDateObj.getFullYear();regularization_operation.constructRegPopUpfromLeave(recDate,recMonth+1,recyear,LVUtil.urls.getCurrentPageUser())}),cardContainer.find(".zpl_mspace-lvecrd-more").on("click",function(){window.location.href=LVUtil.urls.ListView.HOME()+"/key:absent"})}},addOneDayCard:(cardContainer,btn_name,recordId,allowAdd)=>{let html=$('<div class="zpl_msplst" id="prevday_absentcard"> <div> <span class="PI_s_leave icn"></span> <div class="zpl_msp-dts"> <div class="zpl_msp-name"> <div class="zpl_msp-title">'+ZPI18N.getString("zp.youwereabsentyesterday")+"</div> </div> <div> <em>"+ZPI18N.getString("zp.myspacelopdesc")+"</em> </div> </div> "+(allowAdd?'<div class="zpl_msp-act"> <div class="zpl_hvr" recordId="'+recordId+'"> <button class="zlabel zlabel--blue zlabel--medium zlabel--outline" id="zp_conlv">'+btn_name+"</button> </div> </div>":"")+"</div> </div>");html.find("[id='zp_conlv']").on("click",function(){LVUtil.urls.prevUrl.setHash();let recordId=$(this).parents(".zpl_msphvr").attr("recordId");void 0==recordId&&(recordId=$(this).parents(".zpl_hvr").attr("recordId")),window.location.href=LVUtil.urls.ListView.CONVERT()+":"+recordId}),cardContainer.before(html)}},Leave:{init:function(container,params){$(container).html(ZPeople.LOADING_HTML);let emp=ZPUserProfile.Page.isMyspace()?erecno:ZPUserProfile.info.getUserId();(params={key:"report_yearly",leaveyear:0}).employee=emp,params.repType="dashboard",ZPeople.Request.send(Leave.Report.url,params,function(resp){"success"==resp.status?($(container).html(""),$(container).attr({"aria-label":ZPI18N.getString("zp.common.myspacetab",[ZPI18N.getString("zp.leave")]),tabindex:"0"}),$(container).focus(),resp.data&&resp.data.report&&!_.isEmpty(resp.data.report[0].leavetypes)?TAMSUtil.UserSpace.Leave.construct(resp.data.report[0],resp.data.allowAdd,container,resp.data.absdata,resp.data.regAllowed):Leave.Util.showHideNoData(!0,"",container)):($(container).html(""),Leave.Util.showHideNoData(!0,"",container))},{})},construct:(report,allowAdd,container,absdata,regAllowed)=>{var form_name=LVUtil.Tab.isBalance()?ZPeople.Module.getData().formDisplayName:ZPeople.Module.getData().form_name.leave;report.leavetypes.forEach(function(leavetype,idx){2==leavetype.type?container.prepend(TAMSUtil.UserSpace.Leave.constructAbsentRow(leavetype,allowAdd,form_name,absdata,regAllowed)):container.append(TAMSUtil.UserSpace.Leave.constructReportRow(leavetype,allowAdd,form_name))}),container.find("[id='zp_apllv']").on("click",function(){let leavetype=$(this).parents(".zpl_msplst").attr("lvtypeid");if(2==$(this).parents(".zpl_msplst").attr("type"))window.location.href=LVUtil.urls.ListView.HOME();else if(LVUtil.Tab.isBalance())LVUtil.urls.prevUrl.setHash(),MyLvBalance.initLeaveType=leavetype,window.location.href=LVUtil.urls.Balance.HOME()+"/add";else{new LeaveForm({initLeaveType:leavetype,initEmployee:LVUtil.urls.getCurrentPageUser()}).add()}}),container.find("[id='zp_conlv']").on("click",function(){-1==Layout.Page.hash.indexOf("home/myspace/leave")&&LVUtil.urls.prevUrl.setHash();let recordId=$(this).parents(".zpl_msphvr").attr("recordId"),url=LVUtil.urls.ListView.CONVERT();LVUtil.Tab.isGlobalSearchUserPage()&&void 0!==ZPUserProfile.Page.id()&&(url=ZPeople.isOperationAllowed?LVUtil.urls.ListView.OPERUSERCONVERT():LVUtil.urls.ListView.TEAMUSERCONVERT()),url+=":"+recordId,window.location.href=LVUtil.urls.getUrlAsHash(url)}),container.find("[id='zp_reglv']").on("click",function(){let fromDate=$(this).attr("fromDate"),postedDateObj=new Date(fromDate),recDate=postedDateObj.getDate(),recMonth=postedDateObj.getMonth(),recyear=postedDateObj.getFullYear();regularization_operation.constructRegPopUpfromLeave(recDate,recMonth+1,recyear,LVUtil.urls.getCurrentPageUser())}),container.find(".zpl_mspace-lvecrd-more").on("click",function(){let url=LVUtil.urls.ListView.HOME();LVUtil.Tab.isUserPage()?url=LVUtil.urls.getUrlAsHash(LVUtil.urls.ListView.TEAMUSERHOME()):LVUtil.Tab.isOpersUserPage()?url=LVUtil.urls.getUrlAsHash(LVUtil.urls.ListView.OPERUSERHOME()):LVUtil.Tab.isGlobalSearchUserPage()&&void 0!==ZPUserProfile.Page.id()&&(url=ZPeople.isOperationAllowed?LVUtil.urls.getUrlAsHash(LVUtil.urls.ListView.OPERUSERHOME()):LVUtil.urls.getUrlAsHash(LVUtil.urls.ListView.TEAMUSERHOME())),url+="/key:absent",window.location.href=url})},constructAbsentRow:(lstJson,allowAdd,form_name,absData,regAllowed)=>{let html="";if(lstJson&&void 0!=lstJson.taken&&lstJson.taken>0){let btn_name=ZPI18N.getString("zp.apply")+" "+form_name;var yetToApplyLeave=(void 0!=lstJson.taken?lstJson.taken:"0")+" "+(lstJson.isdayleave?" "+(lstJson.taken&&lstJson.taken>1?ZPI18N.getString("zp.leavetype.smalldays"):ZPI18N.getString("zp.leavetype.day.singular")):" "+ZPI18N.getString("zp.hours"));if(html+='<div class="zpl_msplst zpl_mspgroup" aria-label="'+ZPI18N.getString("zp.leave.applyleavetxt")+"."+ZPI18N.getString("zp.leave.view.yettoapply")+" for "+yetToApplyLeave+'" tabindex="0" lvtypeid="'+lstJson.leavetypeid+'" type="'+lstJson.type+'"> <div> ',lstJson.icon)html+='<span class="'+Leave.Util.getLVtypeClass(lstJson.icon)+" icn lv_bgclr"+lstJson.color+'"></span>';else if(lstJson.code&&lstJson.code.trim().length>0)html+='<span class="icn lv_bgclr'+lstJson.color+'">'+lstJson.code.toUpperCase()+"</span>";else{for(var words=ZPeople.decodeTxt(lstJson.name).replace(/[!@#$%^&*(),.?":{}|<>]/g,"").split(" "),initials="",i=0;i<words.length;i++){if(2==(initials+=words[i].charAt(0).toUpperCase()).length)break}initials=0==initials.trim().length?"L":initials,html+='<span class="icn lv_bgclr'+lstJson.color+'">'+initials+"</span>"}if(html+='<div> <div class="zpl_mspacts_rht"> <em>'+ZPI18N.getString("zp.leave.view.yettoapply")+"</em><b>"+yetToApplyLeave+'</b></div> <div class="zpl_msp-dts"> <div class="zpl_msp-name"> <span class="zpl_msp-title">'+lstJson.name+"</span></div> <div><em>"+ZPI18N.getString("zp.myspaceabsdesc")+"</em></div> </div>",html+='<div class="zpl_mspace-gap">',absData&&absData.length>0){let len=absData.length>5?5:absData.length;for(let i=0;i<len;i++){let absRec=absData[i];html+='<div class="zpl_mspace-lvecrd"> <span aria-label="'+ZPI18N.getString("zp.date")+":"+absRec.from+","+absRec.fromDay+" "+ZPI18N.getString("zp.leave.noofleave")+":"+absRec.leaveTaken+" "+absRec.leaveUnit+'" tabindex="0"> <b>'+absRec.from+", "+absRec.fromDay+"</b> </span> <p>"+absRec.leaveTaken+" "+absRec.leaveUnit+'</p><div class="zpl_msphvr" recordId="'+absRec.recordId+'">'+(allowAdd?'  <button class="zlabel zlabel--blue zlabel--small" id="zp_conlv" aria-label="'+btn_name+'" tabindex="0" title="'+btn_name+'">'+btn_name+"</button>":"")+(regAllowed?' <button class="zlabel zlabel--blue zlabel--small zlabel--outline" fromDate="'+absRec.fromDate+'" id="zp_reglv">'+ZPI18N.getString("zp.regularize")+"</button>":"")+"</div> </div>"}absData.length>5&&(html+='<div class="zpl_mspace-lvecrd-more"> <a>+'+(absData.length-5)+" More</a> </div> </div> </div>")}html+="</div> </div>"}return html},constructReportRow:(lstJson,allowAdd,form_name)=>{let btn_name=ZPI18N.getString("zp.leave.apply");form_name!==ZSEC.Encoder.encodeForHTML(ZPI18N.getString("zp.leave"))&&(btn_name=ZPI18N.getString("zp.apply")+" "+form_name);var availableDay=(void 0!=lstJson.available?lstJson.available:"0")+(lstJson.isdayleave?" "+(lstJson.available&&lstJson.available>1?ZPI18N.getString("zp.leavetype.smalldays"):ZPI18N.getString("zp.day")):" "+(lstJson.available&&lstJson.available>1?ZPI18N.getString("zp.leavetype.hour.plural"):ZPI18N.getString("zp.leavetype.hour.singular"))),bookedDay=(void 0!=lstJson.taken?lstJson.taken:"0")+(lstJson.isdayleave?" "+(lstJson.taken&&lstJson.taken>1?ZPI18N.getString("zp.leavetype.smalldays"):ZPI18N.getString("zp.day")):" "+(lstJson.taken&&lstJson.taken>1?ZPI18N.getString("zp.leavetype.hour.plural"):ZPI18N.getString("zp.leavetype.hour.singular")));let html='<div class="zpl_msplst" aria-label="'+lstJson.name+" "+ZPI18N.getString("zp.available")+" "+availableDay+" "+ZPI18N.getString("zp.leave.view.booked")+" "+bookedDay+'" tabindex="0" lvtypeid="'+lstJson.leavetypeid+'" type="'+lstJson.type+'">';if(html+="<div>",lstJson.icon)html+='<span class="'+Leave.Util.getLVtypeClass(lstJson.icon)+" icn lv_bgclr"+lstJson.color+'"></span>';else if(lstJson.code&&lstJson.code.trim().length>0)html+='<span class="icn lv_bgclr'+lstJson.color+'">'+lstJson.code.toUpperCase()+"</span>";else{for(var words=ZPeople.decodeTxt(lstJson.name).replace(/[!@#$%^&*(),.?":{}|<>]/g,"").split(" "),initials="",i=0;i<words.length;i++){if(2==(initials+=words[i].charAt(0).toUpperCase()).length)break}initials=0==initials.trim().length?"L":initials,html+='<span class="icn lv_bgclr'+lstJson.color+'">'+initials+"</span>"}return html+='<div class="zpl_msp-dts"> <div class="zpl_msp-name"> <div class="zpl_msp-title">'+lstJson.name+"</div> </div></div> ",html+='<div class="zpl_compoffar w100">'+(void 0!=lstJson.available?'<span class="zpl_progtitle"><em>'+ZPI18N.getString("zp.available")+'</em></span> <div> <span><b class="'+(lstJson.available>0?"grn":lstJson.available<0?"red":"")+'">'+(void 0!=lstJson.available?lstJson.available:"0")+" </b>"+(lstJson.isdayleave?" "+(lstJson.available&&lstJson.available>1?ZPI18N.getString("zp.leavetype.smalldays"):ZPI18N.getString("zp.day")):" "+(lstJson.available&&lstJson.available>1?ZPI18N.getString("zp.leavetype.hour.plural"):ZPI18N.getString("zp.leavetype.hour.singular")))+"</span></div> </span> ":"")+" </div>",html+='<div class="zpl_compoffar w100"> <span class="zpl_progtitle"><em>'+ZPI18N.getString("zp.leave.view.booked")+"</em></span> <div> <span><b>"+bookedDay+"</span> </div> </div>",allowAdd&&(html+='<div class="zpl_msp-act"> <div class="zpl_hvr"> <button class="zpl_btnellips zlabel zlabel--blue zlabel--medium zlabel--outline w150" id="zp_apllv" aria-label="'+btn_name+'"  tabindex="0" title="'+btn_name+'"><span>'+btn_name+"</span></button> </div> </div>"),html+="</div>",html+="</div>"},createTeamMateLeaveCard:(wrap,param)=>{let cont=wrap.find("[divtype=container]");ZPeople.Request.send("/leave_view_actions.zp",{key:"teammates_onLeave_Today"},function(response){if("success"==response.status){let data=response.data,empList=data.empList;if(data.count>0){wrap.removeClass("zpl_DNI"),cont.html("<h5>"+param.header+"</h5>");let html='<div class="zpl_avatarimg">',i=0;$.each(empList,function(key,value){if((data.count<=5||i<=3)&&(html+='<div class="zpl_em" popup="user" empid="'+value.emp_eno+'" isusrzuid="false"><div class="zpl_emimg"><img src="'+value.photo+'"></div></div>'),++i>4&&data.count>5)return html+='<span class="zpl_totaltxt">+ '+(data.count-4)+"</span>",!1}),html+="</div>",(html=$(html)).find(".zpl_totaltxt").on("click",function(){TAMSUtil.UserSpace.Leave.showMoreUsers(param,wrap)}),cont.append(html)}}},{})},showMoreUsers:(param,wrap)=>{wrap.find(".zpl_totaltxt").addClass("disabled");ZPeople.Request.send("/leave_view_actions.zp",{key:"teammates_onLeave_Today",allData:!0},function(response){if("success"==response.status){let users=response.data.empList,model=$('<div id="'+param.widid+'" class="zpl_mdl zpl_mcenter zpl_servcicn zpl_mopen" ><div class="zpl_minr"><div class="zpl_mhder"><div><h4>'+param.header+'</h4></div><a class="_cls PI_cls"></a></div><div class="zpl_mcnt"><div class="zpl_crd"><div class="zpl_crdcnt">'+(param.needSearch?'<div class="zpl_secn zpl_tblfxd"><div class="zpl_btnmnu P0I"><div><div class="zpl_search zpl_srchsml"><input placeholder="'+ZPI18N.getString("zp.searchemployee")+'" class="searchuser ztextbox"><i class="PI_lens"></i><i id="clsSearch" class="PI_cls"></i></div></div></div></div>':"")+'<div class="zpl_tblres mdl_maxhgt" scroll="enabled"><table class="zpl_tbl wd100_per"><tbody></tbody></table></div></div></div></div><div class="zpl_mfoter"><button type="button" class="zlabel zlabel--outline zlabel--medium cancel">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div>");model.find("._cls.PI_cls, button.cancel").on("click",function(){model.remove()});let html="";$.each(users,function(key,value){html+='<tr fieldid="'+value.emp_eno+'"><td><div class="zpl_em"><div class="zpl_emimg"><img src="'+value.photo+'"><span cstus="true" uid="'+value.emp_zuid+'"></span></div><div class="zpl_emdts zpl_ellipsis"><div><em>'+ZSEC.Encoder.encodeForHTML(value.emp_id)+" - </em><b>"+ZSEC.Encoder.encodeForHTML(value.emp_name)+"</b></div><div><em>"+ZSEC.Encoder.encodeForHTML(value.emp_email)+"</em></div></div></div></td>"+(value.emp_zuid!==_LOGGEDIN_ZUID&&"true"==ZPeople.ISCHAT?'<td><div class="zpl_hvr"><i data-title-position="right" title="'+ZPI18N.getString("zp.chatsettings.chat")+'" onclick="ZPeople.initUserChat(event, \''+value.emp_zuid+'\')" class="PI_s_cliq"></i></div></td>':"")+"</tr>"}),model.find(".zpl_mcnt").find("tbody").html(html),Layout.Page.parentContainer.append(model)}wrap.find(".zpl_totaltxt").removeClass("disabled")})}},Attendance:{teamcontructionInProgress:!1,dataSelect:void 0,updateAttTeamSpaceCards:function(forceUpdate,fromDropDown,dataSelect){if(!(forceUpdate||ZPeople.TeamSpace&&ZPeople.TeamSpace.Page&&"messages"==Layout.Page.container[0].id))return void clearInterval(TAMSUtil.Attendance.setAttTeamUpdateInterval);if(TAMSUtil.UserSpace.Attendance.teamcontructionInProgress)return;TAMSUtil.UserSpace.Attendance.teamcontructionInProgress=!0;var container=$("#depRecentIN").find(".zpl_msp-crdcnt");let param={type:"list",mode:"DEP_RECENT_IN",header:ZPI18N.getString("zp.widget.recently_checkin"),containerConstructed:!0};param.container=container,UserWidget.cardsView.createCard($("#depRecentIN"),param),param={},fromDropDown&&(TAMSUtil.UserSpace.Attendance.dataSelect=dataSelect),void 0!=TAMSUtil.UserSpace.Attendance.dataSelect&&(param.dataSelect=TAMSUtil.UserSpace.Attendance.dataSelect);param.mode="DEPSPACEATTSTATUS";let card=$("#teamAvailability");ZPeople.Request.send("/teamspaceAction.zp",param,function(response){if(card.find("#zp_page_loading").remove(),response.teamCount){let cardcont=card.find('[field="statusCountList"]');ZPeople.TeamSpace.STATUSLIST.forEach(function(currStat,index){let currStatData=response.teamCount[ZSEC.Encoder.encodeForHTML(currStat)];void 0!=currStatData?cardcont.find("#attStatus_"+index).length>0?cardcont.find("#attStatus_"+index).find('[type="team_count"]').html(currStatData):(cardcont.append(ZPeople.TeamSpace.createTeamCountTag(currStat,currStatData,ZPeople.TeamSpace.colourCLass[index],index)),cardcont.find("#attStatus_"+index).find('[type="team_count"]').on("click",function(){ZPeople.TeamSpace.showUserList({header:ZSEC.Encoder.encodeForHTML($(this).attr("header")),status:ZSEC.Encoder.encodeForHTML($(this).attr("header")),mode:"GETUSERLISTBYSTATUS"})})):void 0==currStatData&&cardcont.find("#attStatus_"+index).length>0&&cardcont.find("#attStatus_"+index).remove()})}TAMSUtil.UserSpace.Attendance.teamcontructionInProgress=!1,card.find("#statusCountFilter").removeAttr("disabled")},Layout.Page.container)},setTimeOutforTeamSpaceCards:function(){if(document.removeEventListener("visibilitychange",TAMSUtil.UserSpace.Attendance.setTimeOutforTeamSpaceCards),document.visibilityState&&"hidden"===document.visibilityState||!ZPeople.TeamSpace||!ZPeople.TeamSpace.Page||"messages"!=Layout.Page.container[0].id)return clearInterval(TAMSUtil.UserSpace.Attendance.setAttTeamUpdateInterval),void document.addEventListener("visibilitychange",TAMSUtil.UserSpace.Attendance.setTimeOutforTeamSpaceCards);TAMSUtil.UserSpace.Attendance.updateAttTeamSpaceCards(!0),TAMSUtil.UserSpace.Attendance.setAttTeamUpdateInterval=setInterval(TAMSUtil.UserSpace.Attendance.updateAttTeamSpaceCards,9e5),document.addEventListener("visibilitychange",TAMSUtil.UserSpace.Attendance.setTimeOutforTeamSpaceCards)},showModel:function(mode,response){let extdtls={},param={},confDtls=UserWidget.cardsView.modalCof[mode],model=Layout.Page.parentContainer.find("#"+mode);0==model.length&&(model=confDtls.callback()(confDtls.header,mode,confDtls.searchNeeded,UserWidget.Actions.searchUser,extdtls),confDtls.params&&(param={...confDtls.params}),Layout.Page.parentContainer.append(model),param.mode=mode,extdtls.param=param,extdtls.container=model.find("tbody"),extdtls.mode=mode,response&&UserWidget.cardsView.constructList(response.result,extdtls,response)),model.addClass("zpl_mopen")},userListRow:function(userData,callback,param,id,html,skipChat){let locDetails="";userData.locName&&(locDetails="<span >"+userData.locName+"</span>");let userObj=$('<tr><td><div class="zpl_em"><div class="zpl_emimg"><img src="'+userData.photo+'"><span cstus="true" uid="'+userData.zuid+'"></span></div><div class="zpl_emdts zpl_ellipsis"><div><em>'+userData.eid+" - </em><b>"+userData.name+"</b></div>"+locDetails+(html||"")+"</div></div></td>"+(!skipChat&&userData.zuid&&userData.zuid!==_LOGGEDIN_ZUID&&"true"==ZPeople.ISCHAT?'<td><div class="zpl_hvr"><i chat_comm="true" uid="'+userData.zuid+'" data-title-position="right" title="'+ZPI18N.getString("zp.chatandcall")+'" class="PI_pharw" tabindex="0"></i></div></td>':"")+"</tr>");return id&&userObj.attr("fieldid",id),ZPUtil.Validation.isFunction(callback)&&userObj.find(".zpl_emimg,.zpl_emdts").off("click").on("click",function(){callback(param)}),userObj},showHideStatusFilter:function(){void 0==$("#teamAvailability").find("#statusCountFilter").attr("disabled")&&ZPeopleComponents.menu("#statusCountFilterOptions").show()},getTeamMembersCount:function(){let card=$("#teamAvailability");card.find('[field="statusCountList"]').empty(),card.find("#statusCountFilter").attr("disabled",!0),TAMSUtil.UserSpace.Attendance.updateAttTeamSpaceCards(!1,!0,void 0),card.find("#statusCountFilter").html('<h5><a class="d-inle-flex zpl_drpdwn-js">'+ZPI18N.getString("zp.teamavail")+"</a></h5>")},getDirectReporteesCount:function(){let card=$("#teamAvailability");card.find('[field="statusCountList"]').empty(),card.find("#statusCountFilter").attr("disabled",!0),TAMSUtil.UserSpace.Attendance.updateAttTeamSpaceCards(!1,!0,1),$("#teamAvailability").find("#statusCountFilter").html('<h5><a class="d-inle-flex zpl_drpdwn-js">'+ZPI18N.getString("zp.drepavail")+"</a></h5>")},getAllReporteesCount:function(){let card=$("#teamAvailability");card.find('[field="statusCountList"]').empty(),card.find("#statusCountFilter").attr("disabled",!0),TAMSUtil.UserSpace.Attendance.updateAttTeamSpaceCards(!1,!0,2),$("#teamAvailability").find("#statusCountFilter").html('<h5><a class="d-inle-flex zpl_drpdwn-js">'+ZPI18N.getString("zp.arepavail")+"</a></h5>")},buildingInfoHTMl:function(leaveStatus,buildingInfo,userid,colourClass,isbulkUpdate){let buildingInfoHtml="<span "+(isbulkUpdate?'autorefresh="true" uid="'+userid+'"':'id="att_status"')+' class="zpl_msp-status '+colourClass+' zpl_nowrap">'+leaveStatus+"</span>";return void 0!=buildingInfo&&""!=buildingInfo&&(buildingInfoHtml+='<em class="zpl_dots sm" id="checkInBuildingIN_Dot"></em>',buildingInfoHtml+='<div class="grn zpl_ellipsis zpl_flexgap2" id="checkInBuildingIN_Div">',buildingInfoHtml+='<i class="PI_building grn tooltip-js" id="checkInBuildingIN_Icon" title="'+buildingInfo+'"></i>',buildingInfoHtml+='<span class="zpl_ellipsis" id="checkInBuildingIN_Label" title="'+buildingInfo+'">'+buildingInfo+"</span>",buildingInfoHtml+="</div>"),buildingInfoHtml}}},TAMSUtil.OrgCal={Leave:{construct:(div,obj,isall,parentDiv)=>{if(1==isall){var exist_leavetypes=[];let date=obj.date;var modal=Layout.Page.container.find("#more_day");modal.find(".zpl_mcnt").attr("id","leave_dep_"+date+"_cont"),TAMSUtil.OrgCal.Leave.constructDateCardForV5(obj,date,0,exist_leavetypes),modal.find("#leave_dep_"+date+"_cont").on("scroll",function(){TAMSUtil.OrgCal.Leave.showMoreV5($(this))}),modal.data("data",{sIndx:0,date:date,exist_leavetypes:exist_leavetypes,fetch_more:!0}),TAMSUtil.OrgCal.Leave.showMoreV5(modal.find("#leave_dep_"+date+"_cont"))}else if(obj.emp_id){let sessionclass=" ";if(.5==obj.leave_count?(sessionclass="  ",1==obj.leave_session?sessionclass+="  zpl_halffst ":2==obj.leave_session&&(sessionclass+="  zpl_halfsec ")):.25==obj.leave_count&&obj.leave_session>0&&(sessionclass="  ",2==obj.leave_session?sessionclass+="  zpl_qrtrsec ":3==obj.leave_session?sessionclass+="  zpl_qrtrthrd ":4==obj.leave_session?sessionclass+="  zpl_qrtrfour ":sessionclass+="  zpl_qrtrfst "),div.addClass("zpl_shftdts "+(obj.ltyp_color?("0.5"!=obj.leave_count&&"0.25"!=obj.leave_count?"lv_bgbdr":"lv_bgbdrs")+obj.ltyp_color:" lv_bgbdrsgenrl ")+" "+sessionclass),obj.ltyp_name){var empTitle=obj.emp_id+" - "+obj.emp_name+" &#10; "+ZSEC.Encoder.encodeForHTML(obj.ltyp_name),html='<small> <img src="'+obj.emp_photo+'" alt=""> </small> <span title="'+empTitle+'" id="empName">'+obj.emp_id+" - "+obj.emp_name+"</span>";div.append(html)}else div.append('<small> <img src="'+obj.emp_photo+'" alt=""> </small> <span title="'+ZPeople.decodeTxt(obj.emp_name)+'">'+obj.emp_id+" - "+obj.emp_name+"</span>")}},constructDateCardForV5(data,date,sIndx,exist_leavetypes){var modal=$("#more_day",Layout.Page.container);modal.find("#sliFootDiv").remove();var modalCont=$("#leave_dep_"+date+"_cont",modal),leavetypes=data.leavetypes;if(void 0!=leavetypes){var ltyp_vs_employees=data.ltyp_vs_employees;_.forEach(leavetypes,function(ltyp,ltyp_id){if(ltyp_id=ltyp.ltyp_id,-1==exist_leavetypes.indexOf(ltyp_id)){var card='<div class="zpl_flexcolumngap2"  id="lt_'+ltyp_id+'">';card+='<div class="d-flexclmcap10 a-itm-cntr"><span class="zpl_lbdr _bx lv_bg'+ltyp.color+'"></span><div class="d-flexC"><span>'+ZPeople.escapeHtml(ltyp.name)+"</span></div></div>",card+='<div class="zpl_crdlst "></div>',card+="</div>",modalCont.append(card),exist_leavetypes.push(ltyp_id)}var employees=ltyp_vs_employees[ltyp_id],empCard="";_.each(employees,function(employee){var dept=ZPeople.escapeHtml(ZP.optValue(employee,"department","-"));empCard+='<div class="zpl_catlst" ><div class="d-flexC d-flexclmcap10"><div class="flex-grow0 zpl_em"><div class="zpl_emimg"><img src="'+employee.photo+'"></div><div class="zpl_emdts"><div><em>'+ZPeople.escapeHtml(ZP.optValue(employee,"id",""))+" - </em><b>"+ZPeople.escapeHtml(ZP.optValue(employee,"name",""))+"</b></div><div><em>"+ZPeople.escapeHtml(ZP.optValue(employee,"designation",""))+"</em></div><div><em>"+ZPeople.escapeHtml(ZP.optValue(employee,"mail",""))+'</em></div></div></div></div><div class="zpl_catlstrgt"><div class="zpl_tg '+(dept.length<=0?"DNI":"")+'"><span>'+dept+"</span></div></div></div>"}),empCard.length>0&&modalCont.find("#lt_"+ltyp_id).find(".zpl_crdlst").append(empCard)})}else{var employees=data.employees,card='<div class="zpl_flexcolumngap2">';card+='<div class="d-flexclmcap10 a-itm-cntr"></div>',card+='<div class="zpl_crdlst "></div>',card+="</div>",modalCont.append(card);var empCard="";_.each(employees,function(employee){var dept=ZPeople.escapeHtml(ZP.optValue(employee,"department","-"));empCard+='<div class="zpl_catlst" ><div class="d-flexC d-flexclmcap10"><div class="flex-grow0 zpl_em"><div class="zpl_emimg"><img src="'+employee.photo+'"></div><div class="zpl_emdts"><div><em>'+ZPeople.escapeHtml(ZP.optValue(employee,"id",""))+" - </em><b>"+ZPeople.escapeHtml(ZP.optValue(employee,"name",""))+"</b></div><div><em>"+ZPeople.escapeHtml(ZP.optValue(employee,"designation",""))+"</em></div><div><em>"+ZPeople.escapeHtml(ZP.optValue(employee,"mail",""))+'</em></div></div></div></div><div class="zpl_catlstrgt"><div class="zpl_tg '+(dept.length<=0?"DNI":"")+'"><span>'+dept+"</span></div></div></div>"}),empCard.length>0&&modalCont.find(".zpl_flexcolumngap2").find(".zpl_crdlst").append(empCard)}},showMoreV5(Obj){var card=$(Obj),card_data=card.parent().parent().data("data"),scrolled_length=card.scrollTop()+card.height(),divheight=card[0].scrollHeight-100,emp_count=card.find(".zpl_catlst").length;if(card_data.fetch_more&&divheight<scrolled_length&&emp_count>0&&emp_count%30==0){var params={key:"calendar_department_date"};let filterParam=ModuleCalendar.util.getFilterParams(ModuleCalendar.calendarType);params.department=void 0!=filterParam&&filterParam.department?JSON.stringify(filterParam.department):void 0,params.date=card_data.date,params.sIndx=emp_count+1,params.page="org",card_data.fetch_more=!1,ZPeople.Request.send(Leave.View.url,params,function(resp){TAMSUtil.OrgCal.Leave.constructDateCardForV5(resp.data,params.date,params.sIndx,card_data.exist_leavetypes),card_data.fetch_more=_.size(resp.data.ltyp_vs_employees)>0})}}}},TAMSUtil.Attendance={addsecs:0,hasaddsecs:!0,currDayData:null,display_sec:0,getCurrDayStatus:function(pageContainer,isTimer,callback){if("undefined"==typeof ActionList||ActionList.Card.AttStatus.isFirstTimeLoad||ActionList.Card.AttStatus.countReload(),isTimer&&ZPUtil.Validation.isFunction(callback))callback();else{var layout=Layout.Page.parentContainer,param={mode:"getStatus",conreqcsr:csrfToken};Attendance.Entry.allDataList&&Attendance.Entry.allDataList.breakList||(param.isMySpaceView=!0),$.post("/AttendanceAction.zp",param,function(rdata){layout.find("#shiftName").text(rdata.shiftName);var punchbtn=layout.find("#ZPAtt_check_in_out");punchbtn.find("#zpl_loading_icon").hide();var brkBtn=layout.find("#myspaceBrkIcon");if(punchbtn.removeAttr("disabled"),punchbtn.hide().prev().hide(),layout.find("#breakSelDiv").hide(),!1===rdata.allowedToCheckIn&&!rdata.isBreakRunning){var entries=rdata.response,finVal=rdata.statusInfo;void 0!==finVal.totalSecs&&(TAMSUtil.Attendance.display_sec=finVal.totalSecs),entries.length>0&&void 0!==finVal.addSecs?(TAMSUtil.Attendance.addsecs=finVal.addSecs,TAMSUtil.Attendance.temp_tsecs=0,TAMSUtil.Attendance.hasaddsecs=!1):(TAMSUtil.Attendance.addsecs=finVal.tsecs,TAMSUtil.Attendance.hasaddsecs=!0)}if(TAMSUtil.Attendance.currDayData=rdata.response,!rdata.allowUIEntry){if(punchbtn.show().prev().show(),rdata.curDayBreakDetails&&(Attendance.Entry.curDayBreakDetails=rdata.curDayBreakDetails),rdata.breakList&&(Attendance.Entry.allDataList.breakList=rdata.breakList),!1!==rdata.allowedToCheckIn||rdata.isBreakRunning){punchbtn.removeClass("zlabel--red"),punchbtn.find("p").text(ZPI18N.getString("zp.checkin"));var lastEntryObj={};if((entries=rdata.response).length>0){var displayLastRow=entries[entries.length-1];lastEntryObj=1==entries.length?displayLastRow:entries[displayLastRow.lastRowIndex]}if(entries.length>0&&lastEntryObj.runningBreakId){var checkInFdate=(lastEntryObj.breakFromTime?lastEntryObj.breakFromTime:lastEntryObj.fdate).slice(0,11);"-"===checkInFdate[checkInFdate.length-1]&&(checkInFdate=checkInFdate.slice(0,10)),Attendance.Entry.latestCheckinDate=checkInFdate,Attendance.Entry.showBreakRunner(lastEntryObj)}else Attendance.Entry.showOrHideBreakSelect(!1)}else punchbtn.addClass("zlabel--red"),punchbtn.find("p").text(ZPI18N.getString("zp.checkout")),rdata.curDayBreakDetails&&rdata.curDayBreakDetails.shiftBreakDets&&(brkBtn.show(),layout.find("#breakSelDiv").show()),Attendance.Entry.showOrHideBreakSelect(!0,Attendance.Entry.curDayBreakDetails.shiftBreakDets);Attendance.isWebCoOrdMandatory=void 0!==rdata.isWebCoOrdMandatory&&rdata.isWebCoOrdMandatory,Attendance.isTrackLocationEnabled=void 0!==rdata.isTrackLocationEnabled&&rdata.isTrackLocationEnabled,Attendance.isAllowToCapturePhotoInWeb=void 0!==rdata.isAllowToCapturePhotoInWeb&&rdata.isAllowToCapturePhotoInWeb,Attendance.isAllowToVerifyUserInWeb=void 0!==rdata.isAllowToVerifyUserInWeb&&rdata.isAllowToVerifyUserInWeb}rdata.hideAttRunningTimer?layout.find("#totalInTime").hide():(layout.find("#totalInTime").show(),TAMSUtil.Attendance.DashboardTimer=void 0,TAMSUtil.Attendance.getCurrRunningTime(TAMSUtil.Attendance.addsecs,TAMSUtil.Attendance.hasaddsecs,rdata.allowedToCheckIn,rdata.isBreakRunning)),ZPUtil.Validation.isFunction(callback)&&callback(),ZPUserProfile.status.update(rdata,pageContainer)}).fail(function(data){Attendance.Entry.refreshPage(data)})}},punch:function(){var punchbtn=Layout.Page.parentContainer.find("#ZPAtt_check_in_out");punchbtn[0].hasAttribute("disabled")||(punchbtn.attr("disabled",!0),punchbtn.find("#zpl_loading_icon").show(),punchbtn.hasClass("zlabel--red")?Attendance.Entry.punchOut():Attendance.Entry.punchIn())},setMyTime:function(){var mins=(new Date).getMinutes()+60*(new Date).getHours();Layout.Page.parentContainer.find("#myspaceMyTime").html(Attendance.disTime(mins)),clearInterval(TAMSUtil.Attendance.myTimeInterval),TAMSUtil.Attendance.myTimeInterval=setInterval(TAMSUtil.Attendance.setMyTime,1e3)},temp_tsecs:0,display_sec:0,lastRefTime:0,getCurrRunningTime:function(addSecs,store,allowedToCheckIn,isBreakRunning){clearInterval(TAMSUtil.Attendance.setCurrTime);var curTime=(new Date).getTime();if(!(addSecs<0)){if(!addSecs&&0!==addSecs){var diffSec=void 0!=TAMSUtil.Attendance.DashboardTimer?(curTime-TAMSUtil.Attendance.DashboardTimer)/1e3:0;addSecs=diffSec>1?diffSec-1+1:1}store?(TAMSUtil.Attendance.totalsecs=addSecs,TAMSUtil.Attendance.display_sec=addSecs,TAMSUtil.Attendance.temp_tsecs=0):(TAMSUtil.Attendance.temp_tsecs+=addSecs,TAMSUtil.Attendance.totalsecs=TAMSUtil.Attendance.display_sec+TAMSUtil.Attendance.temp_tsecs);var sec=parseInt(TAMSUtil.Attendance.totalsecs%60),min=parseInt((TAMSUtil.Attendance.totalsecs-sec)/60%60),hrs=parseInt((TAMSUtil.Attendance.totalsecs-min)/3600),time="<span>"+Attendance.disTwoDigit(hrs)+"</span><span>"+Attendance.disTwoDigit(min)+"</span><span>"+Attendance.disTwoDigit(sec),layout=Layout.Page.parentContainer;if(allowedToCheckIn||isBreakRunning||!ZPUserProfile.Page.isMyspace()){var totSecs=0;TAMSUtil.Attendance.currDayData[TAMSUtil.Attendance.currDayData.length-1]&&(totSecs=TAMSUtil.Attendance.currDayData[TAMSUtil.Attendance.currDayData.length-1].totalSecs),sec=parseInt(totSecs%60),min=parseInt((totSecs-sec)/60%60),hrs=parseInt((totSecs-min)/3600),time="<span>"+Attendance.disTwoDigit(hrs)+"</span><span>"+Attendance.disTwoDigit(min)+"</span><span>"+Attendance.disTwoDigit(sec),layout.find("#totalInTime").html(time)}else if(parseInt(TAMSUtil.Attendance.totalsecs)>=86400){var temp=Math.round((curTime-TAMSUtil.Attendance.lastRefTime)/1e3);if(0==TAMSUtil.Attendance.lastRefTime||temp>=36e3)return TAMSUtil.Attendance.lastRefTime=curTime,void TAMSUtil.Attendance.getCurrDayStatus()}else layout.find("#totalInTime").html(time),TAMSUtil.Attendance.setCurrTime=setInterval(TAMSUtil.Attendance.getCurrRunningTime,1e3),Attendance.Entry.checkForAccrualBreak(TAMSUtil.Attendance.totalsecs);if(TAMSUtil.Attendance.DashboardTimer=curTime,ZPUserProfile.Page.isMyspace()&&Layout.Page.container[0].id==="home_myspace_overview_myshift_"+ZPeople.CURR_USER.usererec+"-contentWrp"&&(time=Attendance.disTwoDigit(hrs)+":"+Attendance.disTwoDigit(min)+" "+ZPI18N.getString("zp.hrs"),layout.find(".Cl-today #totHrsSpan").html(time)),ZPUserProfile.Page.isMyspace()){if(time=Attendance.disTwoDigit(hrs)+":"+Attendance.disTwoDigit(min)+" "+ZPI18N.getString("zp.hrs"),layout.find("#actionList_SHIFT").length>0){var isEmptyHrs=void 0==time||null==time||time.includes("00:00");layout.find("#actionList_SHIFT").find("#shiftCard_curtotHrsSpn").html(isEmptyHrs?"":time)}layout.find("#actionList_ATTENDANCE").find("#reminder_totalHours").length>0&&layout.find("#actionList_ATTENDANCE").find("#reminder_totalHours").html(time)}}},setFunctionInOrOut:function(){TAMSUtil.Attendance.getCurrDayStatus()},attInfoProfileViewHtml:function(leaveAttStat,result){let attInfoHtml="";result.inTime?attInfoHtml+="<span>"+ZPI18N.getString("zp.profileInfo.checkedIn")+" "+result.inTime+"</span>":result.outTime&&(attInfoHtml+="<span>"+ZPI18N.getString("zp.profileInfo.checkedOut")+" "+result.outTime+"</span>");let isYetToCheckin=leaveAttStat==ZPI18N.getString("zp.yetToCheckIn");if(result.attpredictions&&(isYetToCheckin||result.isUserAvailable)){let predictTime=isYetToCheckin?result.attpredictions.intime:result.attpredictions.outtime;if(predictTime){""!=attInfoHtml&&(attInfoHtml+='<em class="zpl_dots sm"></em>'),attInfoHtml+='<i class="PI_prediction"></i>';var predictInfo=(isYetToCheckin?ZPI18N.getString("zp.predict.att.predict.checkIn"):ZPI18N.getString("zp.predict.att.predict.checkOut"))+" "+predictTime;attInfoHtml+='<span class="zpl_dib zpl_ellipsis200 zpl_va-top" title=" '+predictInfo+'">'+predictInfo+"</span></div>"}}return attInfoHtml},attStatusProfileViewHtml:function(usererec,colourClass,leaveStatus,result){var attStatustitle=leaveStatus,buildingIngHTML="";void 0!=result.checkInBuilding&&""!=result.checkInBuilding&&(attStatustitle+="("+result.checkInBuilding+")",buildingIngHTML='<em class="zpl_dots sm" id="attStatus_Profile_dot"></em>',buildingIngHTML+='<span class="'+colourClass+'" id="attStatus_Profile_Icon_span" title="'+result.checkInBuilding+'"><i class="PI_building '+colourClass+' tooltip-js" id="attStatus_Profile_Icon"></i>',buildingIngHTML+='<span class="zpl_ellipsis zpl_pl1" id="attStatus_Profile_Building"></span>'+result.checkInBuilding+"</span>");let attStatusHtml='<span id="attStatus_Profile" autorefresh="true" uid="'+usererec+'" class="'+colourClass+' zpl_dib zpl_ellipsis100 zpl_va-top" title="'+attStatustitle+'">'+leaveStatus+"</span>";return attStatusHtml+=buildingIngHTML}};var ModuleComp={};function LeaveForm(options){this.options=options||{},void 0==ZPeople.Module.MODULE_DATA.leavetracker&&LVUtil.Tab.getLeaveModuleData(),this.formId=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.formid,options&&(options.initEmployee&&(LeaveForm.initEmployee=options.initEmployee),options.initLeaveType&&(LeaveForm.initLeaveType=options.initLeaveType),options.initApplyLvDate&&(LeaveForm.initApplyLvDate=options.initApplyLvDate),options.isFromFeeds&&(LeaveForm.isFromFeeds=options.isFromFeeds),options.isRestrictedDate&&(LeaveForm.isRestrictedDate=options.isRestrictedDate),options.leaveTypeMode&&(LeaveForm.myspaceLeaveType=options.leaveTypeMode)),this.isEditOnLoad=!1}ModuleComp.Modal={MODAL_FOOTER:'<div class="zpl_mfoter"> </div>',FOOTERBTN:'<button type="button" class="zlabel zlabel--blue zlabel--medium" id="zp_modal_blubtn">'+ZPI18N.getString("zp.submit")+'</button> <button type="button" class="zlabel zlabel--outline zlabel--medium" id="zp_modal_whitebtn">'+ZPI18N.getString("zp.cancel")+"</button>",MODAL_1:'<div class="zpl_mdl"> <div class="zpl_minr"> <div class="zpl_mhder "> <div> <h4 id="zp_modal_header"></h4> </div><span id="headeropt" class="zpl_mhderrgt"></span> <a class="_cls PI_cls tooltip-js" data-title-position="bottom" title="'+ZPI18N.getString("zp.close")+'"></a> </div> <div class="zpl_mcnt zpl_fm"> </div> </div> </div>',MODAL_2:'<div class="zpl_mdl zpl_malrtmsg "> <div class="zpl_minr"> <a class="_cls PI_cls tooltip-js" data-title-position="bottom" title="'+ZPI18N.getString("zp.close")+'"></a> <div class="zpl_mcnt"> <i id="iconclass"></i> <h3 id="zp_modal_title"></h3> <p id="zp_modal_content"></p> </div></div> </div>',MODAL_3:'<div class="zpl_mdl zpl_mcenter"> <div class="zpl_minr"> <div class="zpl_mhder "> <div> <h4  id="zp_modal_header"></h4> </div> <span id="headeropt" class="zpl_mhderrgt"></span><a class="_cls PI_cls tooltip-js" data-title-position="bottom" title="'+ZPI18N.getString("zp.close")+'"></a> </div> <div class="zpl_mcnt zpl_fm"></div> </div> </div>',MODAL_4:'<div class="zpl_mdl zpl_mlg"><div class="zpl_minr"><div class="zpl_mhder "><div><h4 id="zp_modal_header"></h4></div><span id="headeropt" class="zpl_mhderrgt"></span><a class="_cls PI_cls tooltip-js" data-title-position="bottom" title="'+ZPI18N.getString("zp.close")+'"></a></div><div class="zpl_mcnt zpl_fm"> </div></div></div>',setup:function(json){var modal=ModuleComp.Modal.get(json);return ModuleComp.Modal.show(modal,json),modal},get:function(json){var modal;return 0===(modal=void 0!==json.LayerId?$("#"+json.LayerId).find("#"+json.id):$(settingsPage.container).find("#"+json.id)).length&&(modal=$(this["MODAL_"+json.type]),!0===json.isWrapperAppend?$("#wrapper").append(modal):void 0===json.LayerId?$(settingsPage.container).append(modal):$("#"+json.LayerId).append(modal),modal.on("click","._cls,#zp_modal_whitebtn",function(){void 0!==json.closeCallback&&"function"==typeof json.closeCallback?json.closeCallback():ModuleComp.Modal.hide(json.id,json.deleteOnHide)}),modal.find(".zpl_mcnt").on("scroll",function(){let header=modal.find(".zpl_mhder");$(this).scrollTop()>10?header.addClass("scrlshdw"):header.removeClass("scrlshdw")})),modal.data("modal",json),json.extraDetails&&modal.data("extraDetails",json.extraDetails),json.disableHeader&&modal.find(".zpl_mhder").remove(),json.headerClass&&modal.find(".zpl_mhder").addClass(json.headerClass),json.removeHeaderClass&&modal.find(".zpl_mhder").removeClass(json.removeHeaderClass),json.modalClass&&modal.addClass(json.modalClass),json.removeModalClass&&modal.removeClass(json.removeModalClass),json.bodyClass&&modal.find(".zpl_mcnt").addClass(json.bodyClass),json.customBodyAttr&&$.each(json.customBodyAttr,function(key,value){modal.find(".zpl_mcnt").attr(key,value)}),json.disableFooter||(json.footer&&0===modal.find(".zpl_mfoter").length?modal.find(".zpl_mcnt").after(json.footer):0===modal.find(".zpl_mfoter").length&&(modal.find(".zpl_mcnt").after(ModuleComp.Modal.MODAL_FOOTER),json.buttonHtml?modal.find(".zpl_mfoter").append(json.buttonHtml):json.footersec?(modal.find(".zpl_mfoter").append('<div class="zpl_secn">'+json.footersec+"</div>"),modal.find(".zpl_mfoter").append('<div class="zpl_secn">'+ModuleComp.Modal.FOOTERBTN+"</div>")):modal.find(".zpl_mfoter").append(ModuleComp.Modal.FOOTERBTN))),!json.disableFooter&&modal.find("#zp_modal_blubtn").length>0&&(json.disableSubmitButton?modal.find("#zp_modal_blubtn").hide():void 0!==json.successCallback&&"function"==typeof json.successCallback&&(modal.find("#zp_modal_blubtn")[0].onclick=function(){json.successCallback(modal,json,$(this)),json.closeOnSubmit&&(json.deleteOnHide&&setTimeout(function(){$(modal).remove()},500),ModuleComp.Modal.hide(json.id))})),modal.attr("id",json.id),1===json.type||json.isConfirm||void 0!==json.iconClass&&modal.find("#iconclass").addClass(json.iconClass),json.disableHeader?modal.find("#zp_modal_header").remove():(2!=json.type||json.isConfirm?json.headerHtml?modal.find(".zpl_mhder").html(json.headerHtml):void 0!==json.header&&modal.find("#zp_modal_header").html(json.header):void 0!==json.header&&modal.find(".zpl_mcnt").find("#zp_modal_title").html(json.header),json.headeroptions&&modal.find(".zpl_mhder").find(".zpl_mhderrgt").html(json.headeroptions)),void 0!==json.body&&(2!=json.type||json.isConfirm?modal.find(".zpl_mcnt").html(json.body):modal.find(".zpl_mcnt").find("#zp_modal_content").html(json.body)),json.searchHtml&&modal.find(".zpl_mcnt").prepend(json.searchHtml),!json.disableFooter&&json.buttonValue&&modal.find("#zp_modal_blubtn").html(json.buttonValue),""!=json.whitebtnvalue&&void 0!=json.whitebtnvalue&&modal.find("#zp_modal_whitebtn").html(json.whitebtnvalue),json.removeBodyClass&&modal.find(".zpl_mcnt").removeClass(json.removeBodyClass),json.confirmButtonClass&&modal.find("#zp_modal_blubtn").addClass(json.confirmButtonClass),json.removeConfirmButtonClass&&modal.find("#zp_modal_blubtn").removeClass(json.removeConfirmButtonClass),json.cancelButtonClass&&modal.find("#zp_modal_whitebtn").addClass(json.cancelButtonClass),json.removeCancelButtonClass&&modal.find("#zp_modal_whitebtn").removeClass(json.removeCancelButtonClass),json.footerClass&&modal.find(".zpl_mfoter").addClass(json.footerClass),json.removeFooterClass&&modal.find(".zpl_mfoter").removeClass(json.removeFooterClass),modal.find(".tooltip-js[title]").ztooltip(),modal},show:function(modal,options){void 0!==options&&options.backdrop,modal.addClass("zpl_mopen"),modal.find(".zpl_mcnt").scrollTop(0)},hide:function(id,isremove){var modal;void 0===id?modal=$(settingsPage.mainWrapId).find(".zpl_mopen"):0==(modal=$(settingsPage.mainWrapId).find("#"+id)).length&&(modal=$("#"+id));let json=$(modal).data("modal");json&&void 0!==json.hiddenCallback&&"function"==typeof json.hiddenCallback&&json.hiddenCallback(modal,json),void 0!==modal&&modal.length>0&&(modal.removeClass("zpl_mopen"),isremove&&modal.fadeOut(500,function(){modal.remove()}))},centerModal:function(callback,header,body,btnVal,extraDtls,whitebtnvalue,hiddenCallback,id,modalClass,buttonHtml,disableFooter){header=void 0===header?"":header,body=void 0===body?"":body,extraDtls=void 0===extraDtls?"":extraDtls,ModuleComp.Modal.setup({id:id||"zp_modal_centerpop",type:3,modalClass:modalClass||"",header:header,body:body,deleteOnHide:!0,closeOnSubmit:!extraDtls||void 0==extraDtls.closeOnSubmit||extraDtls.closeOnSubmit,disableFooter:disableFooter||!1,isConfirm:!1,buttonValue:ZPUtil.Validation.isEmpty(btnVal)?ZPI18N.getString("zp.confirm"):btnVal,backdrop:!1,successCallback:callback,extraDetails:extraDtls,hiddenCallback:hiddenCallback,whitebtnvalue:whitebtnvalue,footerClass:"j-cnt-cntr",buttonHtml:buttonHtml})},info:function(header,body,extraDtls){header=void 0===header?ZPI18N.getString("zp.alert"):header,body=void 0===body?"":body,ModuleComp.Modal.setup({id:"zp_modal_infopop",type:2,header:header,body:body,deleteOnHide:!0,closeOnSubmit:!0,isConfirm:!1,extraDetails:extraDtls,iconClass:"ico info",backdrop:!1,disableFooter:!0})},confirm:function(callback,header,body,btnVal,extraDtls,whitebtnvalue,hiddenCallback){header=void 0===header?ZPI18N.getString("zp.confirm"):header,body=void 0===body?"Do you wish to proceed ?":body,ModuleComp.Modal.setup({id:"zp_modal_confirmpop",type:2,header:header,body:body,deleteOnHide:!0,closeOnSubmit:!0,isConfirm:!1,removeConfirmButtonClass:"zlabel--blue",confirmButtonClass:"zlabel--green",buttonValue:ZPUtil.Validation.isEmpty(btnVal)?ZPI18N.getString("zp.confirm"):btnVal,iconClass:"success",backdrop:!1,successCallback:callback,extraDetails:extraDtls,hiddenCallback:hiddenCallback,whitebtnvalue:whitebtnvalue})},delete:function(callback,header,body,btnVal,extraDtls,whitebtnvalue,hiddenCallback){header=void 0===header?ZPI18N.getString("zp.zpalert"):header,body=void 0===body?ZPI18N.getString("zp.deleteconfirmmessage"):body,ModuleComp.Modal.setup({id:"zp_modal_deletepop",type:2,header:header,body:body,deleteOnHide:!0,closeOnSubmit:!0,isConfirm:!1,removeConfirmButtonClass:"zlabel--blue",confirmButtonClass:"zlabel--red",buttonValue:ZPI18N.getString("zp.confirm"),iconClass:"delete",backdrop:!1,successCallback:callback,extraDetails:extraDtls,hiddenCallback:hiddenCallback,whitebtnvalue:whitebtnvalue})},export:function(callback,exptypes,btnVal,extraDtls,whitebtnvalue,hiddenCallback){var exportOptions="";void 0==exptypes&&(exptypes={1:ZPI18N.getString("zp.xls"),2:ZPI18N.getString("zp.xlsx"),3:ZPI18N.getString("zp.csv"),4:ZPI18N.getString("zp.tsv"),5:ZPI18N.getString("zp.pdf")}),exptypes&&Object.keys(exptypes).length>0&&$.each(exptypes,function(key,value){exportOptions+='<div class="zradiobutton zradiobutton--horizontal"><input id="expopt_'+key+'" type="radio" name="expopt" class="zradiobutton__helper"><label for="expopt_'+key+'" class="zradiobutton__label"><span class="zradiobutton__text">'+value+"</span></label> </div>"});let modal=ModuleComp.Modal.setup({id:"zp_modal_exportpop",type:3,body:'<div class="zpl_crd "><div class="zpl_crdcnt"><div class="zpl_Emptydata"><div><div class="zpl_mdexprtimg smll"></div><h4>'+ZPI18N.getString("zp.choosefileformat")+'</h4><div class="zpl_secn" id="expoptions"><div></div></div></div></div></div>',deleteOnHide:!0,closeOnSubmit:!0,isConfirm:!1,header:ZPI18N.getString("zp.export"),buttonValue:ZPUtil.Validation.isEmpty(btnVal)?ZPI18N.getString("zp.export"):btnVal,backdrop:!0,successCallback:callback,extraDetails:extraDtls,hiddenCallback:hiddenCallback,whitebtnvalue:whitebtnvalue});modal.find("#expoptions").html(exportOptions),modal.find("#expoptions").find("#expopt_1").prop("checked",!0),modal.find("#expoptions").find("[name=expopt]").on("change",function(){$(this).is(":checked")&&($(this).parents(".zpl_secn").find("input[name=expopt]").prop("checked",!1),$(this).prop("checked",!0))})}},ModuleComp.FullModal={MODAL:'<div class="zpl_mdl zpl_mfull"><div class="zpl_minr"><div class="zpl_mhder"><div><span class="clsArw" id="zp_modal_closebtn"><i class="PI_back"></i></span><h4 id="headertitle"></h4></div><span id="headeropt" class="zpl_mhderrgt"></span><a class="_cls PI_cls tooltip-js" data-title-position="bottom" title="'+ZPI18N.getString("zp.close")+'" id="zp_modal_closebtn"></a></div><div class="zpl_mcnt"><div class="zpl_mmnu"><div class="zpl_mmnulft"><ul></ul></div><div class="zpl_mmnurgt"></div></div></div><div class="zpl_mfoter zpl_btnsplt"><div><button type="button" id="zp_modal_blubtn"  class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.save")+'</button><button type="button" id="zp_modal_closebtn"  class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.cancel")+'</button></div><div><button type="button" id="zp_modal_prvbtn"  class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.previous")+'</button><button type="button" id="zp_modal_nxtbtn"  class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.next")+"</button></div></div></div></div>",setup:function(json){var modal=ModuleComp.FullModal.get(json);return ModuleComp.Modal.show(modal,json),modal.ztooltip(),modal},get:function(json){var modal;if(0===(modal=void 0!==json.LayerId?$("#"+json.LayerId).find("#"+json.id):$(settingsPage.container).find("#"+json.id)).length){(modal=$(ModuleComp.FullModal.MODAL)).attr("id",json.id),!0===json.isWrapperAppend?$("#wrapper").append(modal):void 0===json.LayerId?$(settingsPage.container).append(modal):$("#"+json.LayerId).append(modal),modal.on("click","#zp_modal_prvbtn",function(){ModuleComp.FullModal.traverse(modal,!1)}),modal.on("click","#zp_modal_nxtbtn",function(){ModuleComp.FullModal.traverse(modal,!0)}),modal.on("click","[id='zp_modal_closebtn']",function(){ModuleComp.Modal.hide(json.id,json.deleteOnHide)}),json.headertitle&&modal.find("#headertitle").html(json.headertitle),json.successbuttonValue&&modal.find("#zp_modal_blubtn").html(json.successbuttonValue),void 0!==json.successCallback&&"function"==typeof json.successCallback&&(modal.find("#zp_modal_blubtn")[0].onclick=function(){json.successCallback(modal,json,$(this)),json.closeOnSubmit&&ModuleComp.Modal.hide(json.id)}),1==json.removeCancelBtn&&modal.find("button#zp_modal_closebtn").remove(),modal.data("modal",json),json.extraDetails&&modal.data("extraDetails",json.extraDetails);var tabArray=json.tabArray;if(tabArray&&tabArray.length>0){let tempTabProp,leftmenu=modal.find(".zpl_mmnulft").find("ul"),rgtCont=modal.find(".zpl_mmnurgt"),actTabIndx=0;$.each(tabArray,function(indx,value){leftmenu.append($("<li id="+value.id+' class="tabnav '+(0==indx?"zpl_act":"")+'" ><b>'+(indx+1)+'</b><a href="javascript:;" class="tabnav">'+value.name+"</a></li>").data("tabProp",value)),rgtCont.append('<div id="'+value.id+'" class="parentdiv '+(0==indx?"zpl_act":"")+'">'+(void 0==value.nobodyhtml?'<div class="zpl_crd"><div class="zpl_crdhdr"><div><h4>'+value.name+'</h4><p id="tabdesc">'+(value.desc?value.desc:" ")+'</p></div></div><div class="zpl_crdcnt"></div></div>':"")+"</div>"),actTabIndx=value.actTab||0==indx?indx:actTabIndx,tempTabProp=value.actTab||0==indx?value:tempTabProp}),$.each(tabArray,function(indx,value){value.actTab&&(leftmenu.find("li.zpl_act").removeClass("zpl_act"),rgtCont.find("div.zpl_act").removeClass("zpl_act"),leftmenu.find("#"+value.id).addClass("zpl_act"),rgtCont.find("div#"+value.id).addClass("zpl_act"))}),tempTabProp&&void 0!==tempTabProp.tabChangeCallBack&&"function"==typeof tempTabProp.tabChangeCallBack&&tempTabProp.tabChangeCallBack(tempTabProp.id,modal),leftmenu.find("li.tabnav").on("click",function(){ModuleComp.FullModal.goToTab(modal,$(this).attr("id"))}),ModuleComp.FullModal.enbDisablePrevNextBtn(modal,actTabIndx),void 0!==json.modalConstructCallBack&&"function"==typeof json.modalConstructCallBack&&json.modalConstructCallBack(modal)}tabArray&&tabArray.length<=1&&(modal.find("#zp_modal_prvbtn").addClass("DNI"),modal.find("#zp_modal_nxtbtn").addClass("DNI"),modal.find("button#zp_modal_closebtn").removeClass("DNI"))}return modal},enbDisablePrevNextBtn:function(modal,indx){let totaltabLen=modal.find(".zpl_mmnulft").find("ul").find("li").length-1;modal.find("#zp_modal_prvbtn").removeAttr("disabled"),modal.find("#zp_modal_nxtbtn").removeAttr("disabled"),0==indx?modal.find("#zp_modal_prvbtn").attr("disabled",!0):indx>=totaltabLen&&modal.find("#zp_modal_nxtbtn").attr("disabled",!0)},setAsActiveTab:function(modal,tabId){let leftmenu=modal.find(".zpl_mmnulft").find("ul"),rgtCont=modal.find(".zpl_mmnurgt");$.each(leftmenu.find("li"),function(indx,ele){if($(ele).attr("id")==tabId)return leftmenu.find("li.zpl_act").removeClass("zpl_act"),rgtCont.find("div.zpl_act").removeClass("zpl_act"),leftmenu.find("#"+tabId).addClass("zpl_act"),rgtCont.find("div#"+tabId).addClass("zpl_act"),!1})},traverse:function(modal,isNext){let actTab=modal.find(".zpl_mmnulft").find("ul"),indx=(actTab.find("li").length,actTab.find("li.zpl_act").index());indx>=0&&(isNext?indx+=1:indx-=1),ModuleComp.FullModal.enbDisablePrevNextBtn(modal,indx);var tabId=$(actTab.find("li")[indx]).attr("id");ModuleComp.FullModal.goToTab(modal,tabId)},goToTab:function(modal,tabId){let leftmenu=modal.find(".zpl_mmnulft").find("ul"),rgtCont=modal.find(".zpl_mmnurgt");leftmenu.children().removeClass("zpl_act"),rgtCont.children().removeClass("zpl_act");let indx=leftmenu.find("li#"+tabId).index();void 0!==tabId&&(leftmenu.find("li#"+tabId).addClass("zpl_act"),rgtCont.find("div#"+tabId).addClass("zpl_act")),ModuleComp.FullModal.enbDisablePrevNextBtn(modal,indx);let tabProp=modal.data("modal");void 0!==tabProp.tabChangeCallBack&&"function"==typeof tabProp.tabChangeCallBack&&tabProp.tabChangeCallBack(tabId,modal)}},ModuleComp.Search={URL:"/commonAction.zp",SEARCH_DETAILS:{},ResposeFormat:{0:{1:"id",2:"name",3:"empid",4:"photo",5:"zuid"},1:{1:"id",2:"html",3:"empid",4:"photo",5:"zuid",6:"text"},2:{1:"id",2:"html",3:"text"},3:{1:"usererec",2:"name",3:"empid",4:"avatar",5:"id"},4:{1:"eNo",2:"fName",3:"eId",4:"photo"},handleSpecialFormats:function(result,data,type){return 1===type?(result.text=ZPeople.decodeTxt(data[1]+" "+result.html),result.html=data[1]+" "+result.html):2===type&&(result.text=ZPeople.decodeTxt(result.html)),result}},getDataMappingByType:function(type){if(void 0!==type){return{0:{value:"id",label:"name",image:"photo",id:"id",text:"name",titleText:"name"},1:{value:"id",label:"html",image:"photo",id:"id",text:"html",titleText:"html",disabled:"disabled"},2:{value:"id",label:"text",id:"id",text:"html",titleText:"html"},3:{value:"usererec",label:"name",image:"avatar",id:"id",text:"name",titleText:"name"},4:{value:"eNo",label:"fName",image:"photo",id:"eId",text:"fName",titleText:"fName"}}[type]}return{label:text,value:html}},Configuration:{JSON:null,LAST_RESPONSE:null,getJSON:function(){return ModuleComp.Search.Configuration.JSON},setJSON:function(json){ModuleComp.Search.Configuration.JSON=json},setExtraSearchParams:function(){var json=ModuleComp.Search.Configuration.getJSON();if(null!=json&&ZPUtil.Validation.isFunction(json.extraParamCallback))return json.extraParamCallback()},getSelectedValues:function(){var json=ModuleComp.Search.Configuration.getJSON();return ZPUtil.Validation.isFunction(json.selectedValFun)?json.selectedValFun():void 0!==json.selectedVals?json.selectedVals:[]},checkIsSelected:function(id){var arr=this.getSelectedValues();return!(null==arr||!ZPUtil.checkIsExistInArray(arr,id))},change:function(event){var resp=void 0,json=$(this).data("searchJson");"select"===json.inpFormat?resp=ZPeopleComponents.select($(this)).getValue():"token"===json.inpFormat&&(resp=ZPeopleComponents.tokenfield($(this)).getSelectedValuesId()),ModuleComp.Search.Configuration.isReturnWithDetail()&&(resp=ModuleComp.Search.Configuration.getUserDetails(resp)),json&&json.changeCallback&&json.changeCallback(resp,event)},isReturnWithDetail:function(){var json=ModuleComp.Search.Configuration.getJSON();return null!==json&&void 0!==json.fullResponse&&json.fullResponse},getLastResult:function(){return null!==ModuleComp.Search.Configuration.LAST_RESPONSE&&ModuleComp.Search.Configuration.LAST_RESPONSE.length>0?ModuleComp.Search.Configuration.LAST_RESPONSE:[]},getUserDetails:function(id){var returnVal,result=ModuleComp.Search.Configuration.getLastResult();return result.length>0&&$.each(result,function(){if(this.id===id)return returnVal=this,!1}),returnVal},getDefaultOption:function(){var json=ModuleComp.Search.Configuration.getJSON();if(json.defaultOption)return json.defaultOption},alwaysShowDefOpt:function(){var json=ModuleComp.Search.Configuration.getJSON();return!!json.alwaysShowDefOpt&&json.alwaysShowDefOpt},getInitialSelection:function(json){var result;return void 0===json&&(json=ModuleComp.Search.Configuration.getJSON()),json.initialSelection&&Object.keys(json.initialSelection).length>0?result=json.initialSelection:json.initCurrentUser&&((result={}).id=ZPeople.CURR_USER.usererec,result.zuid=ZPeople.CURR_USER.id,result.text=ZPeople.decodeTxt(ZPeople.CURR_USER.empid)+" "+ZPeople.decodeTxt(ZPeople.CURR_USER.name),result.html=ZPeople.CURR_USER.empid+" - "+ZPeople.CURR_USER.name,result.photo=ZPeople.CURR_USER.thumb),void 0!=result&&(result.defaultvalue=!0),result}},create:function(json){var inpObj;if(ModuleComp.Search.Configuration.JSON=json,json.id?0==(inpObj=Layout.Page.parentContainer.find("#"+json.id)).length&&(inpObj=$("#"+json.id)):json.ele&&json.ele.length>0&&(inpObj=$(json.ele)),void 0==inpObj||0==inpObj.length)return;inpObj.data("searchJson",json),ZPUtil.Validation.isFunction(json.changeCallback)&&(inpObj.off("change"),inpObj.on("change",ModuleComp.Search.Configuration.change));var initSel=ModuleComp.Search.Configuration.getInitialSelection();let selectComp;void 0===json.scrollStart&&(json.scrollStart=1),void 0!==json.initDefaultValues&&1==json.initDefaultValues?ModuleComp.Search.getDefaultValues(json):json.needScrolledValues&&(json.initDefaultValues=!0);let configObj={dataSource:{search:function(params){return new Promise(function(search,reject){var query={term:params.query,page:params.pages},respObj={results:[]};if(0===query.term.length){if(query.page<=1){var tempjson=inpObj.data("searchJson");ModuleComp.Search.reset(tempjson),ModuleComp.Search.Configuration.JSON=tempjson}var defValues,defOpt=ModuleComp.Search.Configuration.getDefaultOption();inpObj.val();if(void 0!==json.initDefaultValues&&1==json.initDefaultValues){if(query.page<=1){var ans=Object.assign([],json.defaultInitValues);json.defaultValues=ans,defValues=json.defaultValues}else query.page>1&&(json.scrollStart=json.scrollStart+25,ModuleComp.Search.getDefaultValues(json),defValues=json.defaultValues);query.page<=1&&void 0!==defValues&&defValues.length>0?(query.page<=1&&void 0!==defOpt&&void 0!==defValues[0]&&defValues[0].id!==defOpt.id&&defValues.unshift(defOpt),defOpt=defValues[0]):void 0!==defValues&&defValues.length>0&&(defOpt=defValues[0]),inpObj.data("searchJson",json)}defOpt&&(void 0!==defValues?(0==defValues.length&&(defValues=[defOpt]),respObj={results:defValues,more:void 0==json.isNextAvailable||1==json.isNextAvailable}):query.page<=1&&(respObj={results:[defOpt]})),search(respObj)}else{var selJ=inpObj.data("searchJson");selJ.isMultiple&&(selJ.selectedVals=ZPeopleComponents.tokenfield(inpObj).getSelectedValuesId()),selJ.respfun=ModuleComp.Search.getResult,selJ.internalsearchcallback=search,ModuleComp.Search.get(query.term,selJ)}})},paginated:!0},dropdownList:{appendTo:void 0===json.pModal?settingsPage.container:json.pModal,contentType:json.selecttype?json.selecttype:"image-text",isTextHTMLEncoded:!0,fitForElement:!0},serverSearch:!0,isLabelHTMLEncoded:!0,dataMapping:json.dataMapping?json.dataMapping:ModuleComp.Search.getDataMappingByType(json.type),lazyLoading:!0,selectionLimit:json.maximumSelectionSize?json.maximumSelectionSize:void 0,search:{minKeywordLength:json.minimumInputLength?json.minimumInputLength:0,highlightKeyword:!0,showNoResultsMessage:!0,retainKeyword:!0,delay:20},change:ModuleComp.Search.Configuration.change,placeholder:json.placeHolder,messages:{noResults:void 0===json.noMatchMessage?ZPI18N.getString("zp.nomatchesfound"):json.noMatchMessage},viewPerPage:10};if("select"===json.inpFormat){json.height&&(configObj.dropdownList.height=json.height),configObj.contentType=json.selecttype?json.selecttype:"image-text",ZPeopleComponents.select(inpObj).destroy(),configObj.showSearchField=!0,configObj.randomDropdownListId=!0,json.isMultiple&&(configObj.clearButton=!0),selectComp=ZPeopleComponents.select(inpObj,configObj);try{initSel&&initSel.id&&selectComp.setValue(initSel)}catch(e){}}else if("token"===json.inpFormat){let tokenObj={};tokenObj.contentType=json.selecttype?json.selecttype:"image-text",configObj.tokens=tokenObj,configObj.allowDuplicateValues=!1,configObj.data=[initSel],ZPeopleComponents.tokenfield(inpObj).destroy(),configObj.dropdownList.closeOnSelect=!1,configObj.dropdownList.hideItemOnSelect=!0,json.closeOnScroll&&(configObj.dropdownList.closeOnScroll=json.closeOnScroll),json.fitForElement&&(configObj.dropdownList.fitForElement=json.fitForElement),void 0!==json.className&&""!==json.className&&(configObj.dropdownList.className=json.className),json.maxAllowedValues&&(configObj.maxAllowedValues=json.maxAllowedValues),configObj.randomDropdownListId=void 0===json.randomDropdownListId||json.randomDropdownListId;let values=[];initSel&&values.push(initSel.id),selectComp=ZPeopleComponents.tokenfield(inpObj,configObj),ZPeopleComponents.tokenfield(inpObj).setValuesById(values)}return selectComp},getDefaultValues:function(json){void 0!==json&&void 0!==json.type&&(ModuleComp.Search.responseType=json.type);var params={mode:"SEARCH",isDef:!0,start:json.scrollStart,searchType:json.searchType};void 0!==json.searchMode&&(params.searchMode=json.searchMode);var extraParam=ModuleComp.Search.Configuration.setExtraSearchParams(params);if(void 0!==extraParam)if(extraParam.projectManagerPerm||extraParam.customAdminAction){var isProjectManagerKey=extraParam.projectManagerPerm;if(extraParam.projectManagerPerm&&(delete extraParam.projectManagerPerm,params.extraparam=JSON.stringify(extraParam)),extraParam.customAdminAction){var actionType=extraParam.customAdminAction;delete extraParam.customAdminAction,params.extraparam=JSON.stringify(extraParam),extraParam.customAdminAction=actionType}isProjectManagerKey&&(extraParam.projectManagerPerm=!0)}else params.extraparam=JSON.stringify(extraParam);var result={matches:[],ids:[]};json.defaultValuesCache?(ModuleComp.Search.setDefaultValues(json,json.defaultValuesCache,result),delete json.defaultValuesCache):ZPeople.Request.sendAsyncPost(ModuleComp.Search.URL,params,function(data){ModuleComp.Search.setDefaultValues(json,data,result),void 0!==json.setDefaultValueCacheFun&&1===params.start&&(json.setDefaultValueCacheFun(json,params,data),delete json.setDefaultValueCacheFun)})},setDefaultValues:function(json,data,result){var matchlist=[];if(void 0!==data.results&&data.results.length>0?matchlist=data.results:void 0!==data.matches&&data.matches.length>0&&(matchlist=data.matches),matchlist.length>0){for(var uLen=matchlist.length,dfOption=ModuleComp.Search.Configuration.getDefaultOption(),uCnt=0;uCnt<uLen;uCnt++){var list=matchlist[uCnt],dtl=ModuleComp.Search.convertUserDataToJson(list,result);void 0===dtl||void 0!==dfOption&&dtl.id===dfOption.id||ModuleComp.Search.Configuration.checkIsSelected(list[0])||result.matches.push(dtl)}return void 0!==result.matches?(1==json.scrollStart&&(json.defaultInitValues=result.matches),json.defaultValues=result.matches,json.isNextAvailable=data.isNextAvailable,1!=json.scrollStart&&(json.defaultInitValues=json.defaultInitValues.concat(json.defaultValues))):(json.defaultValues=[],1==json.scrollStart&&(json.defaultInitValues=[]),json.isNextAvailable=!1),void("ZPAtt_SPOCUser_AppField_Final"===json.id&&(ModuleAdmin.empCrtiDefVal=json))}json.defaultValues=[],1==json.scrollStart&&(json.defaultInitValues=[]),json.isNextAvailable=!1,"ZPAtt_SPOCUser_AppField_Final"===json.id&&(ModuleAdmin.empCrtiDefVal=json)},getResult:function(data,json){void 0!==json&&void 0!==json.modulesearchcallback&&json.modulesearchcallback(data),void 0!==json&&void 0!==json.internalsearchcallback&&json.internalsearchcallback({results:data})},INITIATEDKEYS:{},isInitiated:function(key){var keys=this.INITIATEDKEYS[this.getSearchType()];return void 0!==keys&&-1!==keys.indexOf(key)},updateInitiate:function(key){void 0===this.INITIATEDKEYS[this.getSearchType()]&&(this.INITIATEDKEYS[this.getSearchType()]=keys=[]),void 0!=key&&1===key.length&&-1===this.INITIATEDKEYS[this.getSearchType()].indexOf(key)&&this.INITIATEDKEYS[this.getSearchType()].push(key)},isNextAvailable:function(key){var json=ModuleComp.Search.getData(key);return void 0==json||void 0===json.isNextAvailable||json.isNextAvailable},getStartIndex:function(key){var json=ModuleComp.Search.getData(key);return void 0!=json&&void 0!==json.start&&1===ModuleComp.Search.getSearchSequence(key)?json.start:1},getSearchSequence:function(key){var json=ModuleComp.Search.getData(key);if(void 0!=json&&void 0!==json.searchSeq)return json.searchSeq},key:null,responseType:null,JSON:null,getSearchType:function(){return null!==ModuleComp.Search.Configuration.JSON&&void 0!==ModuleComp.Search.Configuration.JSON.searchType?ModuleComp.Search.Configuration.JSON.searchType:"emp"},isEmpSearch:function(){return"emp"===ModuleComp.Search.getSearchType()},getPrefixKey:function(key){return key.trim().slice(0,1).toLowerCase()},get:function(key,json,needsearch){if(void 0!=key&&key.trim().length>0){key=key.toLowerCase(),!1!==needsearch&&key.trim().length<=1&&ModuleComp.Search.reset(json),ModuleComp.Search.Configuration.JSON=json,ModuleComp.Search.key=key;var result,dtl=ModuleComp.Search.getSearchDetails(key);ModuleComp.Search.updateInitiate(key),dtl.hasResult&&0===(result=ModuleComp.Search.matchData(key,json.limit)).length&&(dtl.doSearch=!0);var keyPref=ModuleComp.Search.getPrefixKey(key);if(void 0!==json&&void 0!==json.type&&(ModuleComp.Search.responseType=json.type),(void 0===result||result.length<json.limit)&&dtl.doSearch&&void 0===needsearch){var params={mode:"SEARCH",key:encodeURIComponent(key),start:ModuleComp.Search.getStartIndex(keyPref),searchSeq:ModuleComp.Search.getSearchSequence(keyPref),searchType:json.searchType};void 0!==json.searchMode&&(params.searchMode=json.searchMode);var extraParam=ModuleComp.Search.Configuration.setExtraSearchParams(params);void 0===extraParam?-1!==Layout.Page.hash.indexOf("timetracker/scheduler/projectdashboard/feeds")&&(extraParam={projectId:Layout.Page.urlparam.id}):!extraParam.projectManagerPerm&&!extraParam.customAdminAction||void 0!==key&&""!==key||(extraParam.projectManagerPerm&&delete extraParam.projectManagerPerm,extraParam.customAdminAction&&delete extraParam.customAdminAction),void 0!==extraParam&&(params.extraparam=JSON.stringify(extraParam)),ZPeople.Request.send(ModuleComp.Search.URL,params,ModuleComp.Search.response,json)}else ModuleComp.Search.loadResponse(json,result)}},response:function(data,param,json){150!==data.totalCnt&&2===data.searchSeq?ModuleComp.Search.setSearchDone(!0):ModuleComp.Search.setSearchDone(!1),param.key=decodeURIComponent(param.key);var prefix=ModuleComp.Search.getPrefixKey(param.key);ModuleComp.Search.setData(data,prefix);var matches=ModuleComp.Search.matchData(param.key,json.limit);void 0!==matches&&ModuleComp.Search.loadResponse(json,matches)},getData:function(key){if(void 0!==key){var type=ModuleComp.Search.getSearchType();if(void 0!==ModuleComp.Search.SEARCH_DETAILS[type])return ModuleComp.Search.SEARCH_DETAILS[type][key]}},setData:function(data,prefix){var type=ModuleComp.Search.getSearchType();if(void 0===ModuleComp.Search.SEARCH_DETAILS[type]&&(ModuleComp.Search.SEARCH_DETAILS[type]={}),data.results){var oldData=ModuleComp.Search.SEARCH_DETAILS[type][prefix];void 0!==oldData&&(data.results=oldData.results.concat(data.results)),ModuleComp.Search.SEARCH_DETAILS[type][prefix]=data}void 0!==data.matches&&(ModuleComp.Search.updateMatches(data.matches),delete data.matches)},setDataProperty:function(prefix,name,value){ModuleComp.Search.getData(prefix)[name]=value},MATCH_DATA:{},updateMatches:function(matches){var type=ModuleComp.Search.getSearchType();void 0===ModuleComp.Search.MATCH_DATA[type]&&(ModuleComp.Search.MATCH_DATA[type]={ids:[],details:[]}),$.each(matches,function(){-1===ModuleComp.Search.MATCH_DATA[type].ids.indexOf(this[0])&&(ModuleComp.Search.MATCH_DATA[type].ids.push(this[0]),ModuleComp.Search.MATCH_DATA[type].details.push(this))})},getMatches:function(){var type=ModuleComp.Search.getSearchType();return ModuleComp.Search.MATCH_DATA[type]},SEARCHES:{},getLastSearchDetails:function(){var type=this.getSearchType();return void 0===this.SEARCHES[type]&&(this.SEARCHES[type]={keys:[],isSearchDone:!1}),this.SEARCHES},isSearchDone:function(){return this.getLastSearchDetails().isSearchDone},setSearchDone:function(val){return this.getLastSearchDetails().isSearchDone=val},getSearchKeys:function(){var type=this.getSearchType();if(void 0===this.SEARCHES[type])return this.SEARCHES[type].keys},updateSearchKey:function(key){var keys=this.getSearchKeys();void 0!==keys&&-1===keys.indexOf(key)&&keys.push(key)},getSearchDetails:function(key){var isSearchDone=ModuleComp.Search.isSearchDone(),result={};if(ModuleComp.Search.isInitiated(ModuleComp.Search.getPrefixKey(key))&&isSearchDone){var keys=ModuleComp.Search.getSearchKeys();if(void 0!==keys&&keys.length>0)if(result.doSearch=!1,-1!==keys.indexOf(key.toLowerCase()))result.hasResult=!0;else{var lastSearchedKey=keys[keys.length-1];0===key.toLowerCase().indexOf(lastSearchedKey)&&key.length===lastSearchedKey.length+1||(result.doSearch=!0),result.hasResult=!0,ModuleComp.Search.updateSearchKey(key)}else isSearchDone?result.hasResult=!0:result.doSearch=!0}else ModuleComp.Search.updateSearchKey(key),result.doSearch=!0,ModuleComp.Search.isInitiated(ModuleComp.Search.getPrefixKey(key))&&(result.hasResult=!0);return result},matchData:function(key,limit){if(ModuleComp.Search.key===key){limit=void 0===limit?10:limit;for(var matches,result={matches:[],ids:[]},keySrt=ModuleComp.Search.getPrefixKey(key),isNxtAv=(key.toLowerCase(),ModuleComp.Search.isNextAvailable(keySrt)),isInitiated=ModuleComp.Search.isInitiated(keySrt),matchData=ModuleComp.Search.getMatches(),itrCnt=1;itrCnt<=2;itrCnt++){if(1===itrCnt)void 0!=(data=ModuleComp.Search.getData(keySrt))&&data.results.length>0&&(matches=data.results);else void 0!==matchData&&(matches=matchData.details);if(void 0!=matches&&matches.length>0){-1!==key.indexOf("@")&&(result=ModuleComp.Search.iterateData(3,matches,limit,result));var sLoop=1;ModuleComp.Search.isEmpSearch()&&(sLoop=2);for(var typeCnt=1;typeCnt<=sLoop;typeCnt++){var moreCnt=limit-result.matches.length;if((result=ModuleComp.Search.iterateData(typeCnt,matches,moreCnt,result)).matches.length===limit||isNxtAv&&1===itrCnt&&isInitiated&&result.matches.length>0)return result.matches;if(2==itrCnt&&0==result.matches.length)return result.matches=[]}}}if(ModuleComp.Search.isEmpSearch()&&void 0!==result.matches&&0===result.matches.length){var data;moreCnt=limit;if(void 0!=(data=ModuleComp.Search.getData(keySrt))&&data.results.length>0&&(result=ModuleComp.Search.iterateData(3,data.results,moreCnt,result)),result.matches.length<limit&&void 0!==matchData&&matchData.details.length>0){moreCnt=limit-result.matches.length;result=ModuleComp.Search.iterateData(3,matches,moreCnt,result)}}return result.matches}},iterateData:function(type,list,limit,result){for(var lkey=ModuleComp.Search.key.toLowerCase(),selectArr=[],order1=[],order2=[],order3=[],uLen=list.length,isEmpSearch=ModuleComp.Search.isEmpSearch(),uCnt=0;uCnt<uLen;uCnt++){var data=list[uCnt];if(-1===result.ids.indexOf(data[0])&&!ModuleComp.Search.Configuration.checkIsSelected(data[0])){if(1===type){if(searchName=isEmpSearch?ZPeople.getUserDisplayName(data[2],data[3]):data[1],(name=ZPeople.decodeTxt(searchName).toLowerCase().trim())===lkey||-1!==name.indexOf(" ")&&0===name.split(" ").indexOf(lkey))result.matches.push(ModuleComp.Search.convertUserDataToJson(data,result));else if(-1!==name.indexOf(" ")&&-1!==name.split(" ").indexOf(lkey)&&-1==selectArr.indexOf(data[0]))order1.push(ModuleComp.Search.convertUserDataToJson(data,result)),selectArr.push(data[0]);else if(0===name.indexOf(lkey)&&-1==selectArr.indexOf(data[0]))order2.push(ModuleComp.Search.convertUserDataToJson(data,result)),selectArr.push(data[0]);else if(isEmpSearch){(empid=ZPeople.decodeTxt(data[1]).toLowerCase().trim())!==lkey&&0!==empid.indexOf(lkey)&&-1===empid.indexOf(lkey)||-1!=selectArr.indexOf(data[0])||(result.ids.push(data[0]),order3.push(ModuleComp.Search.convertUserDataToJson(data,result)),selectArr.push(data[0]))}}else if(2===type&&isEmpSearch){var empid=ZPeople.decodeTxt(data[1]).toLowerCase().trim(),name=ZPeople.decodeTxt(ZPeople.getUserDisplayName(data[2],data[3])).toLowerCase().trim();0===empid.indexOf(lkey)?result.matches.push(ModuleComp.Search.convertUserDataToJson(data,result)):-1!==name.indexOf(lkey)&&-1==selectArr.indexOf(data[0])?(order2.push(ModuleComp.Search.convertUserDataToJson(data,result)),selectArr.push(data[0])):-1!==empid.indexOf(lkey)&&-1==selectArr.indexOf(data[0])&&(order3.push(ModuleComp.Search.convertUserDataToJson(data,result)),selectArr.push(data[0]))}else if(3===type&&isEmpSearch){var email=ZPeople.decodeTxt(data[4]).toLowerCase().trim();""!==email&&(email===lkey?result.matches.push(ModuleComp.Search.convertUserDataToJson(data,result)):0===email.indexOf(lkey)&&-1==selectArr.indexOf(data[0])?(order2.push(ModuleComp.Search.convertUserDataToJson(data,result)),selectArr.push(data[0])):-1!==email.indexOf(lkey)&&-1==selectArr.indexOf(data[0])&&(order3.push(ModuleComp.Search.convertUserDataToJson(data,result)),selectArr.push(data[0])))}if(result.matches.length===limit)break}}if(result.matches.length===limit)return result;if(0===result.matches.length)for(uCnt=0;uCnt<uLen;uCnt++){data=list[uCnt];if(-1===result.ids.indexOf(data[0])&&!ModuleComp.Search.Configuration.checkIsSelected(data[0])&&1===type){var searchName;searchName=isEmpSearch?ZPeople.getUserDisplayName(data[2],data[3]):data[1];for(var spltname=(name=ZPeople.decodeTxt(searchName).toLowerCase().trim()).split(" "),i=0;i<spltname.length;i++)-1!==name.indexOf(" ")&&-1!==spltname[i].indexOf(lkey)&&-1==selectArr.indexOf(data[0])&&(order3.push(ModuleComp.Search.convertUserDataToJson(data,result)),selectArr.push(data[0]))}}if(result.matches.length<limit){var moreCnt=limit-result.matches.length;order1.length>0&&(order1.length<=moreCnt?(result.matches=result.matches.concat(order1),moreCnt=limit-result.matches.length):ModuleComp.Search.moveValuesInArray(result.matches,order1,moreCnt)),order2.length>0&&(order2.length<=moreCnt?(result.matches=result.matches.concat(order2),moreCnt=limit-result.matches.length):ModuleComp.Search.moveValuesInArray(result.matches,order2,moreCnt)),order3.length>0&&(order3.length<=moreCnt?result.matches=result.matches.concat(order3):ModuleComp.Search.moveValuesInArray(result.matches,order3,moreCnt))}return result},convertUserDataToJson:function(data,userData){var result={};if(void 0!==data){userData.ids.push(data[0]);var format=ModuleComp.Search.ResposeFormat[ModuleComp.Search.responseType];void 0===format&&(ModuleComp.Search.responseType=0,format=ModuleComp.Search.ResposeFormat[0]),result[format[1]]=data[0],ModuleComp.Search.isEmpSearch()?(result[format[2]]=" - "+ZPeople.getUserDisplayName(data[2],data[3]),void 0!==format[3]&&(result[format[3]]=data[1]),""===data[6].trim()?""===data[5].trim()?result[format[4]]="/images/user.png":result[format[4]]=contactUrl+"/file?ID="+data[5]+"&fs=thumb":0==data[6].indexOf("/newhr/images/sampleemployeephotos/")?result[format[4]]=data[6]:settingsPage&&settingsPage.isFromEmbedAddReq?result[format[4]]="/viewPhoto?filename="+data[6]:result[format[4]]="viewPhoto?filename="+data[6],void 0!=format[5]&&(result[format[5]]=data[5]),void 0!==data[7]&&(result.mobile=ZPUtil.getNoValueString(data[7])),void 0!==data[8]&&(result.workphone=ZPUtil.getNoValueString(data[8]))):result[format[2]]=data[1],result=ModuleComp.Search.ResposeFormat.handleSpecialFormats(result,data,ModuleComp.Search.responseType)}return result},loadResponse:function(json,result){ZPUtil.Validation.isFunction(json.respfun)&&(ModuleComp.Search.Configuration.alwaysShowDefOpt()&&result.unshift(ModuleComp.Search.Configuration.getDefaultOption()),ModuleComp.Search.Configuration.LAST_RESPONSE=result,json.respfun(result,json))},moveValuesInArray:function(a1,a2,count){for(var i=0;i<count;i++)a1.push(a2[i])},reset:function(json,isEmpty,resetDefaultValues){(void 0!=json&&void 0!==json.id&&null!==ModuleComp.Search.Configuration.JSON&&json.id!==ModuleComp.Search.Configuration.JSON.id||isEmpty)&&(ModuleComp.Search.MATCH_DATA={},ModuleComp.Search.SEARCHES={},ModuleComp.Search.SEARCH_DETAILS[json.searchType]={},void 0!==json&&1==resetDefaultValues&&(json.defaultInitValues=[],json.defaultValues=[]),ModuleComp.Search.setSearchDone(!1))}},ModuleComp.Msg={showSuccessMsg:function(msg){ZPeople.Message.success(msg)},showWarningMsg:function(msg){ZPeople.Message.warning(msg)},showFailureMsg:function(msg){ZPeople.Message.failure(msg)}},ModuleComp.ZPPickList={allData:null,APPLICABLE_FOR_KEYS:["dept","desg","loc","role","user","group","shifts"],getAllData:function(){null===ModuleComp.ZPPickList.allData&&$.ajax({type:"POST",async:!1,url:"/createViewAction.zp",data:{mode:"getAllRecords",conreqcsr:csrfToken},success:function(data){ModuleComp.ZPPickList.allData=data}})},getAppKeys:function(mode){var keys=[],pageId=void 0===mode||"module"===mode?settingsPage.container[0].id:mode,constants=ModuleComp.ZPPickList.CONSTANTS;return"settings-service-attendance-absentscheduler"===pageId||"settings-service-shift-rotation"===pageId?keys=[constants.ROLES,constants.DEPARTMENTS,constants.DESIGNATIONS,constants.LOCATIONS,constants.GROUPS,constants.USERS]:LVUtil.urls.CompOffSchl.isHome()?keys=[constants.USERS,constants.DEPARTMENTS,constants.DESIGNATIONS,constants.ROLES,constants.LOCATIONS,constants.GROUPS]:LVUtil.urls.Holiday.isHome()?keys=[constants.LOCATIONS,constants.SHIFTS]:"settings-service-timetracker-timesheetscheduler"===pageId?keys=[constants.USERS,constants.DEPARTMENTS,constants.DESIGNATIONS,constants.ROLES,constants.LOCATIONS,constants.GROUPS]:"settings-service-timetracker-specificpolicies"===pageId?keys=[constants.USERS,constants.LOCATIONS]:"settings-service-shift-manage"===pageId?keys=[constants.DEPARTMENTS,constants.LOCATIONS,constants.DIVISIONS]:"settings-service-attendance-defaultpresent"===pageId||"operations-shift-mapshiftpattern"===pageId?keys=[constants.USERS]:"FormViewPermission"===pageId?keys=[constants.USERS,constants.DEPARTMENTS,constants.ROLES,constants.LOCATIONS]:"settings-service-shifts-manageshifts"===pageId?keys=[constants.DEPARTMENTS,constants.LOCATIONS,constants.DIVISIONS]:"tab-shifts-employeeshiftmapping"!==pageId&&"tab-shifts-shiftchangerequests"!==pageId||(keys=[constants.USERS,constants.LOCATIONS]),keys},changeNotifierCallback:function(pageId){if("FormViewPermission"===pageId)return()=>{FrameworkCommon.madeChanges.set(ZP5ViewActions.Modal,!0)}},isSelectAllOption:function(pageId){return!("settings-service-attendance-absentscheduler"!==pageId&&"settings-service-attendance-attspecificpolicy"!==pageId&&"settings-service-timetracker-timesheetscheduler"!==pageId&&"settings-service-timetracker-specificpolicies"!==pageId&&"settings-service-shift-manage"!==pageId&&"settings-service-shift-rotation"!==pageId&&"settings-service-attendance-defaultpresent"!==pageId&&!LVUtil.urls.CompOffSchl.isHome())},isShowAllOption:function(pageId){return"settings-service-attendance-absentscheduler"===pageId||"settings-service-timetracker-timesheetscheduler"===pageId||"settings-service-shift-rotation"===pageId||"settings-service-attendance-defaultpresent"===pageId},openTabPanel:function(mode,appendTo,excludeCurrUser){ModuleComp.ZPPickList.getAllData();var tabs=[],keys=ModuleComp.ZPPickList.getAppKeys(mode),constants=ModuleComp.ZPPickList.CONSTANTS,pageId=void 0===mode?settingsPage.container[0].id:mode;void 0===mode?settingsPage.container.find("#moduleCards").attr("style","position: relative;"):settingsPage.container.find(appendTo).attr("style","position: relative;"),keys.forEach(function(curKey){let tabObj={};tabObj.label=constants.getI18NValue(curKey),tabObj.panelId=curKey.toLowerCase()+"_panel",tabObj.id=constants.APPFOR_AND_TABID[curKey];var tabItems=[];if(curKey!==ModuleComp.ZPPickList.CONSTANTS.USERS){var data=ModuleComp.ZPPickList.allData[curKey];Object.keys(data).forEach(function(value){var item={};item.Id=data[value].recID,item.Value=data[value].recName,tabItems.push(item)})}else{var userList=ZPeople.getUserListData();$.each(userList,function(index,userData){if(!excludeCurrUser||erecno!=userData.usererec){let item={};item.Id=userData.usererec,item.Value=userData.name+" "+userData.empid,tabItems.push(item)}})}if(tabItems.length>0&&ModuleComp.ZPPickList.isSelectAllOption(pageId)&&(tabObj.selectAll=!0,ModuleComp.ZPPickList.isShowAllOption(pageId))){let item={Id:"0"};item.Value=ModuleComp.ZPPickList.CONSTANTS.getAllOptionI18NValue(curKey),tabItems.push(item)}tabObj.items=tabItems,tabs.push(tabObj)});var tabPanelProps={tabs:tabs,id:"modToTabPanel",forElement:"#modToPop",targetId:"modToList",appendTo:void 0!==appendTo?appendTo:"#moduleCards",select:ZPA_TabbedListBox.selectCallback,deselect:ZPA_TabbedListBox.deselectCallback,selectall:ZPA_TabbedListBox.selectAllCallback,isSelectAll:ModuleComp.ZPPickList.isSelectAllOption(pageId),showSelectAllOption:ModuleComp.ZPPickList.isShowAllOption(pageId),changeNotifierCallback:ModuleComp.ZPPickList.changeNotifierCallback(pageId),pointer:!0};tabPanelProps.listboxOptions={dataMapping:{id:"Id",value:"Id",text:"Value"},showSearchField:!0,search:{by:"Value",criteria:"contains"},searchFieldOptions:{placeholder:ZPI18N.getString("zp.search")},messages:{noResults:ZPI18N.getString("zp.noresults")},isTextHTMLEncoded:!0},ZPeopleComponents.tabbedlistboxpopup("#modToTabPanel",tabPanelProps)},getData:function(pageOrModal,mode){var appFor=ZPA_TabbedListBox.getTagConfig(pageOrModal.find("#modToGrp")),appKeys=ModuleComp.ZPPickList.getAppKeys(mode),appOrTabId=ModuleComp.ZPPickList.CONSTANTS.APPFOR_AND_TABID;return 0===Object.keys(appFor).length?appFor.isNoValAvail=!0:appKeys.forEach(function(curKey){void 0===appFor[appOrTabId[curKey]]&&(appFor[appOrTabId[curKey]]=[])}),appFor},consAppData:function(settings,pageOrModal){ModuleComp.ZPPickList.getAllData();var appOrTabId=ModuleComp.ZPPickList.CONSTANTS.APPFOR_AND_TABID;Object.keys(appOrTabId).forEach(function(curKey){var appForKey=appOrTabId[curKey],valuesOfCurKey=ModuleComp.ZPPickList.allData[curKey],parentTagJson={id:appForKey,value:ModuleComp.ZPPickList.CONSTANTS.getI18NValue(curKey)};if(settings[appForKey]&&settings[appForKey].length>0&&0===settings[appForKey].indexOf("0")){var childTagJson={id:"0",value:ModuleComp.ZPPickList.CONSTANTS.getAllOptionI18NValue(curKey)};ZPA_TabbedListBox.appendRecipientTag("modToTabPanel",pageOrModal.find("#modToList"),parentTagJson,childTagJson)}else if(settings[appForKey]&&settings[appForKey].length>0)if(curKey!==ModuleComp.ZPPickList.CONSTANTS.USERS){settings[appForKey].forEach(function(value){var childTagJson={id:value,value:valuesOfCurKey[value].recName};ZPA_TabbedListBox.appendRecipientTag("modToTabPanel",pageOrModal.find("#modToList"),parentTagJson,childTagJson)})}else{var userList=ZPeople.getUserListData();$.each(userList,function(index,userData){if(settings[appForKey].includes(userData.usererec)){0;var childTagJson={id:userData.usererec,value:userData.name+" "+userData.empid};ZPA_TabbedListBox.appendRecipientTag("modToTabPanel",pageOrModal.find("#modToList"),parentTagJson,childTagJson)}settings[appForKey].length})}})},getHtml:function(header,errormsg,id,isAppForMan){var html='<div class="zpl_secn">';return html+=isAppForMan?'<label class="zp_mdt"><font>'+(header||ZPI18N.getString("zp.lms.settings.applicableto"))+"</font></label>":"<label>"+(header||ZPI18N.getString("zp.lms.settings.applicableto"))+"</label>",html+='<div><div id="modToGrp" class="zpl_inpgrp">',html+='<div class="zpl_frmctrl" id="modToList"></div>',html+='<a class="grp_add" title="'+(header||ZPI18N.getString("zp.lms.settings.applicableto"))+'" id="modToPop" targetid="modToGrp" onclick="ZPA_TabbedListBox.initializeTabPanel(this, \'module\', \'modToTabPanel\', \'modToPop\', \'modToList\')"><i class="PI_addlist"></i></a>',html+='<div id="modToTabPanel"></div>',html+="</div></div>",html+='<span class="ztextbox--error__label" style="display: none;"',html+=id?' id="'+id+'"':' id="appForEmpty"',html+=">"+(errormsg||ZPI18N.getString("zp.selectonecri"))+"</span>",html+="</div>"},showEmptyErrorMsg:function(modal){modal.find("#appForEmpty").show(),modal.find("#modToGrp").addClass("ztextbox__error")}},ModuleComp.ZPPickList.CONSTANTS={USERS:"Users",DEPARTMENTS:"Departments",DESIGNATIONS:"Designations",ROLES:"Roles",LOCATIONS:"Locations",SHIFTS:"Shifts",GROUPS:"Groups",DIVISIONS:"Divisions",APPFOR_AND_TABID:{Roles:"role",Departments:"dept",Designations:"desg",Locations:"loc",Groups:"group",Users:"user",Shifts:"shift",Divisions:"div"},ALLOPTION:{Roles:"roles",Departments:"department",Designations:"designation",Locations:"location",Groups:"groups",Users:"users",Shifts:"shift",Divisions:"divisions"},getAllOptionI18NValue:function(key){return ZPI18N.getString("zp.all"+ModuleComp.ZPPickList.CONSTANTS.ALLOPTION[key])},getI18NValue:function(key){var name=ZPI18N.getString("zp."+key.toLowerCase());return key===ZPPickList.CONSTANTS.DIVISIONS&&ZPeople.orgStructureDispNameMap.hasOwnProperty("division")&&(name=ZPeople.orgStructureDispNameMap.division),ZPUtil.Validation.isEmpty(name)?key:name}},LeaveForm.INSTANCE=void 0,LeaveForm.fullDayMins=void 0,LeaveForm.getInstance=function(){return LeaveForm.INSTANCE},LeaveForm.isLvViewAllowEdit=!1,LeaveForm.initLeaveType=void 0,LeaveForm.initEmployee=void 0,LeaveForm.initApplyLvDate=void 0,LeaveForm.isFromFeeds=void 0,LeaveForm.isRestrictedDate=!1,LeaveForm.myspaceLeaveType=1,LeaveForm.isViewMode=function(){return"VIEW"==LeaveForm.mode},LeaveForm.isEditMode=function(){return"EDIT"==LeaveForm.mode},useWrapper(function(exports){var Utils={EDITABLE_PAGES:["#operations/leavetracker/applications/view","#operations/leavetracker/user/applications/view","#operations/leavetracker/user/view","#leavetracker/mydata/applications/view","#leavetracker/mydata/view","#leavetracker/team/applications/view","#leavetracker/team/user/view","#leavetracker/team/user/applications/view"],isEditAllowedInPage:function(){var pageUrl=Layout.Page.hash.split("-")[0];return-1!=this.EDITABLE_PAGES.indexOf(pageUrl)}};var LeaveDay=function(props){return ZPCreateDOM("tr",{name:props.details.date},props.showCheckbox?ZPCreateDOM("td",null,ZPCreateDOM("div",{class:"zcheckbox",name:"cancelCheckBox"},ZPCreateDOM("input",{type:"checkbox",id:"checkBox"+props.index,class:"zcheckbox__helper",onChange:LeaveForm.getInstance().onToggleCheckbox,name:"inactive",checked:"true",isCheckBox:"true"}),ZPCreateDOM("label",{for:"checkBox"+props.index,class:"zcheckbox__label"}))):null,ZPCreateDOM("td",null,ZPCreateDOM("div",{date:props.details.date},props.details.day+"  "+props.details.date)),LeaveForm.isViewMode()?ZPCreateDOM(LeaveDay.View,props):ZPCreateDOM(LeaveDay.Add,props))};LeaveDay.Add=function(_ref){let{details:details,type:type,isDay:isDay,includeHourFields:includeHourFields,timeInputType:timeInputType,...props}=_ref;if(details.isholiday){var selectElement=ZPCreateDOM("td",null,ZPCreateDOM("div",null,2!=timeInputType&&ZPCreateDOM("select",{sessions:!0,name:details.date,disabled:!0})));return $(selectElement).addClass(0===type?"DNI":""),ZPCreateDOM("fragment",null,0===type?selectElement:null,ZPCreateDOM("td",null,ZPCreateDOM("div",null,ZPCreateDOM("select",{periods:!0,name:details.date,disabled:!0},ZPCreateDOM("option",{value:"0"},1==details.holidayWeekend||details.isweekend?ZPI18N.getString("zp.weekend"):ZPeople.decodeTxt(Holidays.optDisplayNameInSingularForm()))))),0!=type?selectElement:null)}if(isDay||includeHourFields){var periodEle=ZPCreateDOM("select",{periods:!0,name:details.date});$(periodEle).data("details",details),LeaveDay.Add.Util.addPeriods(periodEle,type,details,props.disableFullDay);var column2,column3,sessionEle=ZPCreateDOM("select",{sessions:!0,name:details.date,placeholder:ZPI18N.getString("zp.select")});return LeaveDay.Add.Util.addSessions(void 0,periodEle,sessionEle,!0),column2=ZPCreateDOM("td",null,ZPCreateDOM("div",null,periodEle)),column3=ZPCreateDOM("td",null,ZPCreateDOM("div",null,sessionEle)),0===type?($(column3).addClass("DNI"),ZPCreateDOM("fragment",null,column3,column2)):ZPCreateDOM("fragment",null,column2,column3)}var fragment1=ZPCreateDOM("td",null,ZPCreateDOM("div",{class:"hourinput"},LeaveDay.Add.Util.startTime(details),2==timeInputType&&ZPCreateDOM("fragment",null,LeaveDay.Add.Util.hyphen(),LeaveDay.Add.Util.endTime(details,!0)))),fragment2=ZPCreateDOM("td",null,ZPCreateDOM("div",null,1==timeInputType?LeaveDay.Add.Util.hours(details):ZPCreateDOM("div",{className:"zpl_tg"},ZPCreateDOM("span",null,details&&LeaveDay.Add.Util.getInBtwHrs(void 0!=$(fragment1).find("input[id=from_time]").data("valueinmin")?$(fragment1).find("input[id=from_time]").data("valueinmin"):"0",void 0!=$(fragment1).find("input[id=from_time]").data("valueinmin")?$(fragment1).find("input[id=to_time]").data("valueinmin"):"0")))));return ZPCreateDOM("fragment",null,fragment1,fragment2)},LeaveDay.Add.Util={addPeriods:function(ele,type,details,disableFullDay){details.ishalfholiday||disableFullDay||ele.appendChild(ZP.create("option",{value:"1",text:ZPI18N.getString("zp.fullday"),selected:"selected"})),(2==type||3==type||details.ishalfholiday)&&ele.appendChild(ZP.create("option",{value:"0.5",text:ZPI18N.getString("zp.halfday")})),1!=type&&3!=type||ele.appendChild(ZP.create("option",{value:"0.25",text:ZPI18N.getString("zp.quarterday")})),details.ishalfday?$(ele).val("0.5"):details.isquarterday&&$(ele).val("0.25")},addSessions:function(row,periodEle,sessionEle,skipDefault){row&&(periodEle=$(row).find("[periods]"),sessionEle=$(row).find("[sessions]"));var details=$(periodEle).data("details"),period=$(periodEle).val();if($(sessionEle).prop("disabled",!1).empty(),"1"==period||"0"==period)$(sessionEle).attr("disabled","disabled");else if("0.5"==period){for(var i=1;i<=2;i++)if(details.holidaySession!=i){var option=this.session(i,.5);details.leaveSession==i&&$(option).attr("selected","selected"),$(sessionEle).append(option)}}else if("0.25"==period)for(i=1;i<=4;i++)if(!(1==details.holidaySession&&-1!=[1,2].indexOf(i)||2==details.holidaySession&&-1!=[3,4].indexOf(i))){option=this.session(i,.25);details.leaveSession==i&&$(option).attr("selected","selected"),$(sessionEle).append(option)}},session:function(sessionNum,value){var key="zp."+Leave.Util.getDateWithSuffix(sessionNum+"");return key+="0.25"==value?"quarter":"half",ZP.create("option",{value:sessionNum,count:value,daysession:sessionNum,text:ZPI18N.getString(key)})},startTime:function(details,hide){var startTime=details&&details.startTime?details.startTime:0;return ZPCreateDOM("input",{className:"ztextbox ".concat(hide?"DN":""),"data-value":Leave.Util.convertMinutestoTime(startTime),"data-valueinmin":startTime,name:details?details.date:"",isTime:!0,id:"from_time"})},endTime:function(details){var startTime=details&&details.startTime?details.startTime:0,maxMins=details.max_mins,toTime=(details.defaultValue,details&&details.endTime?details.endTime:0),rmMin=0,temp=maxMins,isDef=!0;if(details.default_mins||(temp=toTime,isDef=!1),startTime>toTime)if(!Leave.Util.is24HrTimeFormat()&&startTime+temp>=1440)rmMin=temp-(1440-startTime);else rmMin=temp;else rmMin=isDef?startTime+temp:temp;return ZPCreateDOM("input",{className:"ztextbox","data-value":Leave.Util.convertMinutestoTime(rmMin),"data-valueinmin":rmMin,name:details?details.date:"",isTime:!0,id:"to_time"})},hyphen:function(hide){var showhide=hide?"DN":"DIB";return ZP.create("span",{class:"fromToTime "+showhide,text:" - "})},calculateInBtwHrs:function(tr){var fromTime=ZPeopleComponents.timefield($(tr).find("input#from_time")).getValue().dateString,toTime=ZPeopleComponents.timefield($(tr).find("input#to_time")).getValue().dateString,inbtwnhrs=0,temp=Leave.Util.getTimeDiff(fromTime,toTime);return temp=temp%1==0?parseInt(temp):inbtwnhrs,(inbtwnhrs=Leave.Util.convertToHoursandMinutes(temp))+" "+ZPI18N.getString("zp.leavetype.hrs")},getInBtwHrs:function(){let fromMins=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,toMins=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;fromMins>toMins&&(toMins+=1440);var mins=Math.max(0,toMins-fromMins);return Leave.Util.convertToHoursandMinutes(mins)+" "+ZPI18N.getString("zp.leavetype.hrs")},hours:function(details){var hour=details.defaultValue;return ZPCreateDOM("input",{className:"ztextbox","data-value":hour,maxHours:details.max_mins/60+1,name:details?details.date:"",id:"time_taken"})},refreshBtwnHrs:function(element){var timeInputType=LeaveForm.getInstance().getTimeInputType(),name=$(element).attr("id");if(element&&("from_time"==name||"to_time"==name)&&2==timeInputType){var tr=$(element).parents("tr"),hrs=LeaveDay.Add.Util.calculateInBtwHrs(tr);tr.find(".zpl_tg span").length>0&&tr.find(".zpl_tg span").text(hrs)}},ShowHideUnitField:function(show,isHour,onlyHour){if(show){if($("[name=leaveunit]",LeaveForm.LAYOUT).data("isreg"))return $("#leaveunitSelect",LeaveForm.LAYOUT).css("display",onlyHour?"none":"inline"),onlyHour?$("select[name=leaveunit]",LeaveForm.LAYOUT).attr("disabled","true"):$("select[name=leaveunit]",LeaveForm.LAYOUT).prop("disabled",!1),ZPeopleComponents.select($("[name=leaveunit]",LeaveForm.LAYOUT)).setValue(isHour?"hour":"day"),$("[folabel=Leavetype]",LeaveForm.LAYOUT).addClass("zpl_ilnegap"),void(onlyHour&&LeaveDay.Add.Util.switchUnit({detail:{value:"hour"}}));var ltype=$("[folabel=Leavetype]",LeaveForm.LAYOUT),field=ZPCreateDOM("div",{id:"leaveunitSelect",class:"w100 zpl_lvfrmhrsec",style:{display:onlyHour?"none":"inline"}},ZPCreateDOM("select",{class:"select-js",disabled:onlyHour?"true":void 0,name:"leaveunit"}));ltype.parent().append($(field));var unitOpts=[];onlyHour||unitOpts.push({label:ZPI18N.getString("zp.day.plural"),value:"day"}),unitOpts.push({label:ZPI18N.getString("zp.hourslog"),value:"hour"}),LeaveAdminOpers.ZPeopleComponents.Select.init({container:LeaveForm.LAYOUT.find("[name=leaveunit]"),optArray:unitOpts,onChangeCb:LeaveDay.Add.Util.switchUnit}),ZPeopleComponents.select(LeaveForm.LAYOUT.find("[name=leaveunit]")).setValue(isHour?"hour":"day"),$("[name=leaveunit]",LeaveForm.LAYOUT).data("isreg",!0),ltype.parent(".zp-label").addClass("zp-leave-col2"),LeaveDay.Add.Util.switchUnit({detail:{value:isHour?"hour":"day"}})}else $("#leaveunitSelect",LeaveForm.LAYOUT).hide(),$("[folabel=Leavetype]",LeaveForm.LAYOUT).removeClass("zpl_ilnegap")},switchUnit:function(event){var value=event.detail.value,dataObj=LeaveForm.LAYOUT.find("#zp_formleave_daylist").data("details");"day"==value?(LeaveForm.getInstance().showHideTimeInputByField(!1),dataObj&&(dataObj.isDayBased=!0),LeaveForm.getInstance().setDayDetails(dataObj,!0)):(LeaveForm.getInstance().showHideTimeInputByField(!0),dataObj&&(dataObj.isDayBased=!1),LeaveForm.getInstance().setDayDetails(dataObj,!0)),dataObj&&(LeaveForm.getInstance().updateTotal(),LeaveForm.Summary.refresh());var balanceNote=$("#balancealert",LeaveForm.LAYOUT),ltData=LeaveForm.LAYOUT.data("leavetypedata");ltData&&(LeaveForm.LAYOUT.find("[name=Leavetype]").val()==ltData.compoffLeave&&balanceNote.text(balanceNote.data("day"==value?"availableInDays":"availableInHours")));LVUtil.urls.CompOff.isBook()&&dataObj&&LeaveForm.getInstance().switchCompoffMessage(dataObj,value)}},LeaveDay.View=function(_ref2){let{isDay:isDay,details:details}=_ref2;var text="";isDay?(text="1",details.isholiday?text="0":details.ishalfday?text="0.5":details.isquarterday&&(text="0.25")):text=details.defaultValue;var progressbar=ZP.create("div",{class:"w200 zpl_btncnt"}),progressbarouter=ZP.create("div",{class:"zpl_lvprogress zpl_lvPbar"}),barwidth=details.ishalfday?"50":details.isquarterday?"25":"100",startTime=Leave.Util.convertMinutestoTime(details.startTime),endTime=Leave.Util.convertMinutestoTime(details.endTime);if(!isDay&&!details.isholiday){var fullDayHrs=details.max_mins/60,hours=parseInt(details.defaultValue.split(":")[0])+parseInt(details.defaultValue.split(":")[1])/60;barwidth=100*hours/fullDayHrs>100?100:100*hours/fullDayHrs}var lcolor=details.color;if("object"!=typeof lcolor||2!==lcolor.length||void 0==details.inactive||details.inactive)progressbarouter.appendChild(LeaveDay.View.Util.progressBar(void 0,details.color,barwidth,details.leaveSession,startTime,endTime,!isDay));else{var leaveWidth=details.isquarterday?"25":"50";if("ZPLHoli"==lcolor[0]){var firstBarType=4==details.leaveSession?2:0,leaveSession=details.leaveSession>2?details.leaveSession-2:details.leaveSession;progressbarouter.appendChild(LeaveDay.View.Util.progressBar(firstBarType,lcolor[0],50,1,void 0,firstBarType?void 0:startTime)),progressbarouter.appendChild(LeaveDay.View.Util.progressBar(1,lcolor[1],leaveWidth,leaveSession,startTime,endTime,!isDay,50))}else{firstBarType=leaveWidth<50&&(25!=leaveWidth||2!=details.leaveSession)?2:0;progressbarouter.appendChild(LeaveDay.View.Util.progressBar(firstBarType,lcolor[0],leaveWidth,details.leaveSession,startTime,endTime,!isDay,50)),progressbarouter.appendChild(LeaveDay.View.Util.progressBar(1,lcolor[1],50,2,firstBarType?void 0:endTime,void 0,!isDay,leaveWidth))}text=details.ishalfday?"0.5":"0.25"}progressbar.appendChild(progressbarouter);var progresstd=ZP.create("td");progresstd.appendChild(progressbar);var takentd=ZP.create("td"),totalOuter=ZP.create("div");if(details.inactive)$(totalOuter).removeClass("zpl_tg"),totalOuter.appendChild($("<span class='red'><i class='PI_cancl_req'></i>"+ZPI18N.getString("zp.cancelled")+"</span>")[0]);else if(0!=text){var span=ZP.create("span",{text:text+" "+(isDay?ZPI18N.getString("zp.days"):ZPI18N.getString("zp.leavetype.hrs"))});$(totalOuter).addClass("zpl_tg"),totalOuter.appendChild(span)}return takentd.appendChild(totalOuter),ZPCreateDOM("fragment",null,progresstd,takentd)},LeaveDay.View.Util={progressBar:function(count,color,barwidth,session,leftTime,rightTime,isHourLeave,initialWidth){color&&"ZPLHoli"!=color&&(color="lv_bg"+color.substring(3,color.length));var progressbar=ZP.create("div",{class:"zpl_lvprogressbar "+color+" PR",role:"progressbar","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":barwidth,style:"width:"+barwidth+"%;"});if(0==count?progressbar.appendChild(ZP.create("div",{class:"lf CP tooltip-js","data-title-position":"top",title:leftTime||""})):1==count?(progressbar.appendChild(ZP.create("div",{class:"md CP tooltip-js","data-title-position":"top",title:leftTime||""})),progressbar.appendChild(ZP.create("div",{class:"rg CP tooltip-js","data-title-position":"top",title:rightTime||""}))):(progressbar.appendChild(ZP.create("div",{class:"lf CP tooltip-js","data-title-position":"top",title:leftTime||""})),progressbar.appendChild(ZP.create("div",{class:"rg CP tooltip-js","data-title-position":"top",title:rightTime||""}))),session>1){var left=isHourLeave?25*(session-1):barwidth*(session-1);initialWidth=initialWidth||0;var total=parseFloat(initialWidth)+parseFloat(barwidth)+parseFloat(left);left-=total>100?total-100:0,$(progressbar).css("left",left+"%")}return $(progressbar).ztooltip(),progressbar}};var LeaveFormProto={view:function(recordId){LeaveForm.mode="VIEW",this.recordId=recordId;var json={formId:this.formId,recordId:recordId,callback:this.switchToRecView,parent:{formId:recordId},fieldFormat:["Employee_ID","Leavetype","From","To","Daystaken","TeamEmailID","DateOfRequest","Reasonforleave"],onloadCallback:this.onLoad.bind(this),editCallback:this.options.editCallback?this.options.editCallback:this.switchToEdit,disableUrlTrack:!!this.options.disableUrlTrack&&this.options.disableUrlTrack,disableSingleEdit:!0,isEditDisabled:!Utils.isEditAllowedInPage(),formMode:"VIEW",isLeave:!0};if(LVUtil.Tab.isMySpace()||ZPFeeds.SINGLEPOP){let form=ZP5Form._toForm(json);form.setFormContainer($("body").find("#modal_Container")),form.init()}else ZP5Form.load(json)},add:function(params){params=void 0==params?{}:params,LeaveForm.mode="ADD",ZP5Form.MODE="ADD";var json={formId:this.formId,callback:params.callback?params.callback:this.switchToRecView,fieldFormat:["Employee_ID","Leavetype","From","To","Daystaken","TeamEmailID","Reasonforleave"],onloadCallback:this.onAddLoad.bind(this),disableSingleEdit:!0,isEditDisabled:!Utils.isEditAllowedInPage(),formMode:"ADD",isLeave:!0};ZP5Form.load(json)},convert:function(){LeaveForm.mode="ADD",ZP5Form.MODE="ADD";var _getApplicable=this.getApplicable.bind(this),_getDetails=this.getDetails.bind(this),json={formId:this.formId,callback:this.switchToRecView,fieldFormat:["Employee_ID","Leavetype","From","To","Daystaken","TeamEmailID","DateOfRequest","Reasonforleave"],fieldCallback:{Employee_ID:_getApplicable,Leavetype:_getDetails,From:_getDetails,To:_getDetails},tableName:"P_EmployeeLeave",onloadCallback:this.onConvertLoad.bind(this),isLeave:!0,moduleParamsHandler:this.getFormParams};ZP5Form.load(json)},edit:function(recordId){LeaveForm.mode="EDIT",ZP5Form.MODE="EDIT",this.recordId=recordId;var _getApplicable=this.getApplicable.bind(this),_getDetails=this.getDetails.bind(this),json={formId:this.formId,recordId:recordId,callback:this.switchToRecView,parent:{formId:recordId},fieldFormat:["Employee_ID","Leavetype","From","To","Daystaken","TeamEmailID","DateOfRequest","Reasonforleave"],fieldCallback:{Employee_ID:_getApplicable,Leavetype:_getDetails,From:_getDetails,To:_getDetails},onloadCallback:this.onLoad.bind(this),editCallback:this.options.editCallback?this.options.editCallback:this.switchToEdit,disableUrlTrack:!!this.options.disableUrlTrack&&this.options.disableUrlTrack,disableSingleEdit:!0,isEditDisabled:!Utils.isEditAllowedInPage(),formMode:"EDIT",isLeave:!0};ZP5Form.load(json)},bookCompoff:function(recordId){LeaveForm.mode="ADD";var _getDetails=this.getDetails.bind(this),json={formId:ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.formid,formMode:LeaveForm.mode,recordId:recordId,fieldFormat:["Employee_ID","Leavetype","From","To","Daystaken","TeamEmailID","Reasonforleave"],fieldCallback:{From:_getDetails,To:_getDetails},tableName:"P_EmployeeLeave",onloadCallback:this.onCompoffLoad.bind(this),callback:function(){LeaveCompensatory.recordData={},LeaveForm.getInstance().switchToRecView(),LeaveCompensatory.refresh=!1}};ZP5Form.load(json)},getFormParams:function(params){return params.absentId=LVUtil.urls.getCurrentUrlParams().recordId,params.subMode=LeaveForm.mode,params},setLeaveType:function(){LeaveForm.initLeaveType&&ZPeopleComponents.select($("input[name=Leavetype]",LeaveForm.LAYOUT)).setValue(LeaveForm.initLeaveType)},postFormConsCallback:function(){if("VIEW"!=LeaveForm.mode){if("ADD"==LeaveForm.mode){if((LVUtil.Tab.isUserPage()||LVUtil.Tab.isOpersUserPage()||LVUtil.Tab.isGlobalSearchUserPage())&&void 0!=LVUtil.Team.SELECTED_USER&&""!=LVUtil.Team.SELECTED_USER){var emp=LVUtil.Team.SELECTED_USER;void 0!=(empObj=ZP.getUserDetailsById(emp))&&ZPeopleComponents.select(LeaveForm.LAYOUT.find("[name=Employee_ID]")).setValue({id:empObj.id,text:empObj.name})}var empObj;if(LVUtil.Tab.isTeamPage()&&ZPeopleComponents.select(LeaveForm.LAYOUT.find("[name=Employee_ID]")).setValue({id:-1,text:ZPI18N.getString("zp.select")}),LeaveForm.initEmployee)void 0!=(empObj=ZP.getUserDetailsById(LeaveForm.initEmployee))&&ZPeopleComponents.select(LeaveForm.LAYOUT.find("[name=Employee_ID]")).setValue({id:empObj.id,text:empObj.name}),LeaveForm.initEmployee="";LeaveForm.LAYOUT.find("[name=Employee_ID]").trigger("change"),ZPCal.Calendar.applyLvDate&&(ZPeopleComponents.datefield(LeaveForm.LAYOUT.find('input[name="From"]')).setValue(ZPCal.Calendar.applyLvDate),ZPeopleComponents.datefield(LeaveForm.LAYOUT.find('input[name="To"]')).setValue(ZPCal.Calendar.applyLvDate)),LeaveForm.initApplyLvDate&&(ZPeopleComponents.datefield(LeaveForm.LAYOUT.find('input[name="From"]')).setValue(LeaveForm.initApplyLvDate),ZPeopleComponents.datefield(LeaveForm.LAYOUT.find('input[name="To"]')).setValue(LeaveForm.initApplyLvDate),LeaveForm.initApplyLvDate="")}Layout.ISDEV||!(LVUtil.Tab.isMyPage()||LVUtil.Tab.isUserPage()||LVUtil.Tab.isOpersUserPage()||LVUtil.Tab.isMySpace()||LVUtil.Tab.isGlobalSearchUserPage()||-1!=Layout.Page.hash.indexOf("attendance")&&-1!=Layout.Page.hash.indexOf("summary-mode"))||"ADD"!=LeaveForm.mode&&"EDIT"!=LeaveForm.mode||(ZPeopleComponents.select(LeaveForm.LAYOUT.find("[name=Employee_ID]")).setAttributes({disabled:!0}),LeaveForm.LAYOUT.find("[name=Employee_ID]").parent().parent().parent().hide())}},onAddLoad:function(){if(LeaveForm.INSTANCE=this,LeaveForm.LAYOUT=ZP5Form.getLayout(),LeaveForm.hideApproval(),LeaveForm.LAYOUT.find("#bodyparent").addClass("zpl_frmclmsingle"),void 0!=Leave&&Leave.isEmbed){var modal=$(".zpl_mopen");modal.find(".zpl_mmnurgt").removeClass("zpl_frmclmsingle"),modal.find(".zpl_mmnurgt").addClass("wd100_per"),modal.find("[folabel~='From']").find(".zinputfield").css("width",""),modal.find("[folabel~='To']").find(".zinputfield").css("width",""),modal.addClass("zpl_mfull").css({top:0,bottom:0,left:0,right:0,padding:0}),modal.find(".PI_cls").remove(),modal.find("#RSFooter").removeClass("MLauto")}},onCompoffLoad:function(){LeaveForm.INSTANCE=this,LeaveForm.LAYOUT=ZP5Form.getLayout(),LeaveForm.hideApproval(),this.getCompOffDetails(),LeaveForm.LAYOUT.find("#bodyparent").addClass("zpl_frmclmsingle"),this.showHideLvExtraDetails()},onConvertLoad:function(){LeaveForm.INSTANCE=this,LeaveForm.LAYOUT=ZP5Form.getLayout(),LeaveForm.LAYOUT.find("#bodyparent").addClass("zpl_frmclmsingle");var leavetype=$("input[name=Leavetype]",LeaveForm.LAYOUT),params={key:"leavetype_appl",absentId:LVUtil.urls.getCurrentUrlParams().recordId,isView:LeaveForm.isViewMode()};params[csrfParamName]=csrfToken,this.addReport(),$.post("/leave_common_action.zp",params,function(result){if("success"===result.status){var leavetypeArr=result.leave_data.Options;LeaveForm.getInstance().changeLeaveTypes(leavetype,leavetypeArr),result.leave_data.hasOwnProperty("absent_data")&&(LeaveForm.getInstance().regConvertLeave(result.leave_data.absent_data),LeaveForm.LAYOUT.data("leavetypedata",result.leave_data),LeaveForm.getInstance().populateCompoffLookup(result.leave_data.workedDates),LeaveForm.LAYOUT.data("report",result.leave_data.leave_report[0]),LeaveForm.LAYOUT.data("applyDates",result.leave_data.applyDates),Leave.Util.isV1User=result.leave_data.isV1User,LeaveForm.getInstance().showHideLvExtraDetails())}})},regConvertLeave:function(dataObj){var absentObj=dataObj;LeaveForm.LAYOUT.data("absent_"+LVUtil.urls.getCurrentUrlParams().recordId,absentObj);var empObj=ZP.getUserDetailsById(absentObj.employee);void 0!=empObj&&(ZPeopleComponents.select(LeaveForm.LAYOUT.find("[name=Employee_ID]")).setValue({id:empObj.id,text:empObj.name}),ZPeopleComponents.select(LeaveForm.LAYOUT.find("[name=Employee_ID]")).setAttributes({disabled:!(!LVUtil.Tab.isMyPage()&&!LVUtil.Tab.isUserPage())})),ZPeopleComponents.datefield(LeaveForm.LAYOUT.find("[name=From]")).setValue(absentObj.absent_from,uidateFormat),ZPeopleComponents.datefield(LeaveForm.LAYOUT.find("[name=To]")).setValue(absentObj.absent_to,uidateFormat),LeaveForm.LAYOUT.find("[name=Employee_ID]").parent().parent().parent().hide(),LeaveForm.hideApproval()},onLoad:function(){var record=this.getRecordData();LeaveForm.INSTANCE=this,LeaveForm.LAYOUT=ZP5Form.getLayout(),LeaveForm.LAYOUT.data("record",record),LeaveForm.LAYOUT.find("#bodyparent").addClass("zpl_frmclmsingle"),LeaveForm.isFromFeeds&&LeaveForm.LAYOUT.addClass("zpl_ntzindx");var leaveData=record?record.extraDetails:{},dayDetails=leaveData.dayDetails?leaveData.dayDetails:[];if(LeaveForm.fullDayMins=leaveData.fullDayMins,leaveData.isInactiveRecord&&LeaveForm.isViewMode()){var inactiveRecMsg=ZPI18N.getString("zp.leave.record.error.disable.immutableinfo");dayDetails.message?dayDetails.message2=inactiveRecMsg:dayDetails.message=inactiveRecMsg}dayDetails.isDayAndHourAllowed?(!LeaveForm.isViewMode()&&LeaveDay.Add.Util.ShowHideUnitField(!0,!dayDetails.isDayBased),LeaveDay.Add.Util.ShowHideUnitField(!1),LeaveForm.getInstance().showHideTimeInputByField(!dayDetails.isDayBased)):dayDetails.isDayAndHourAllowed||dayDetails.isDayBased||LeaveForm.isViewMode()||LeaveForm.getInstance().showHideTimeInputByField(!0),dayDetails.showCheckbox=void 0==dayDetails.showCheckbox&&void 0,LeaveForm.getInstance().isCancelMode=0,this.showCompensatedDate(dayDetails),this.setDayDetails(dayDetails),LeaveForm.isViewMode()?(LeaveForm.isLvViewAllowEdit=leaveData.allowEdit,leaveData.approvalStatus=record.message.approvalStatus,this.showhidefooterAction(leaveData.recordImmutable,leaveData.showCancel),1!=record.message.approvalStatus&&-2!=record.message.approvalStatus||settingsPage.container.find("#detailedReport").hide(),-1==record.message.approvalStatus&&(this.addReport(),this.getReportData(),656250178!=_LOGGEDIN_ZSOID&&670195449!=_LOGGEDIN_ZSOID&&55013116!=_LOGGEDIN_ZSOID||LeaveForm.QuickListView.getHtml()),-1==record.message.approvalStatus&&(record.isRecordAdmin||record.isPrimaryAppr)&&LeaveForm.QuickLinks.init(),function(){var leaveBody=LeaveForm.LAYOUT,fromDiv=$("[folabel=From]",leaveBody),toDiv=$("[folabel=To]",leaveBody),fromDate=fromDiv.find("span").text(),toDate=toDiv.find("span").text();if(fromDate&&toDate&&""!=fromDate&&""!=toDate){fromDiv.find("span").html(""),toDiv.find("span").html(""),fromDiv.hide(),toDiv.hide();var dateDiv=fromDiv.parent(),div=ZP.create("span");div.appendChild(document.createTextNode(fromDate)),fromDate!=toDate&&(div.appendChild(ZP.create("span",{class:"ZPuscr",text:"-"})),div.appendChild(document.createTextNode(toDate))),dateDiv.append(div)}}(),LeaveDay.Add.Util.ShowHideUnitField(!1),LeaveForm.getInstance().showHideTimeInputByField(!1),record.extraDetails.isabsentRecord&&(LeaveForm.LAYOUT.find(".zpl_frminfopanel").remove(),LeaveForm.LAYOUT.find("#zp_form_outer_container").find("#sectionsparent").addClass("wd100_per"))):LeaveForm.isEditMode()&&(this.addReport(),this.getApplicable(void 0,!0),LeaveDay.Add.Util.ShowHideUnitField(!1),LeaveForm.LAYOUT.find("[folabel=DateOfRequest]").css("margin-top","20px")),this.showHideLvExtraDetails()},setDayDetails:function(dataObj,prevLoopCB){if(!$.isEmptyObject(dataObj)){var daydetailsRows=$("#zp_formleave_daylist .chslvtype table tbody",LeaveForm.LAYOUT).children(),isreg=daydetailsRows?daydetailsRows.length:0,daydetails=$("#zp_formleave_daylist",LeaveForm.LAYOUT);daydetails.parent().removeClass("DNI"),daydetails.removeClass("DN"),daydetails.data("details",dataObj),daydetails.find(".chslvtype").removeClass("DN"),daydetails.find(".chslvtype tbody").html(""),daydetails.find(".lvtypefoot").removeClass("DN");var dateArr=dataObj.dateArr,isDayBased=dataObj.isDayBased,type=1;(isDayBased||dataObj.isDayAndHourAllowed)&&(type=0,dataObj.isHalfDayAllowed&&dataObj.isQuarterDayAllowed?type=3:dataObj.isQuarterDayAllowed&&!dataObj.isHalfDayAllowed?type=1:dataObj.isHalfDayAllowed&&!dataObj.isQuarterDayAllowed?type=2:dataObj.isDayAndHourAllowed&&(type=-1));var temp_doc=document.createDocumentFragment(),timeInputType=LeaveForm.getInstance().getTimeInputType();for(var indx in dateArr){var dateObj=dateArr[indx],dayRow=ZPCreateDOM(LeaveDay,{details:dateObj,isDay:isDayBased,type:type,isDayAndHourAllowed:dataObj.isDayAndHourAllowed,disableFullDay:dataObj.disableFullDay,timeInputType:timeInputType,index:indx,showCheckbox:dataObj.showCheckbox});LeaveForm.isViewMode()&&($(dayRow).data("inactive",dateObj.inactive),$(dayRow).data("count",LeaveForm.getInstance().getAvailed(dateObj,isDayBased)),$(dayRow).data("session",dateObj.leaveSession)),temp_doc.appendChild(dayRow)}daydetails.find(".chslvtype tbody").append(temp_doc),daydetails.find("#day_details_header").length>0&&daydetails.find("#day_details_header").remove(),LeaveForm.isViewMode()&&daydetails.find(".chslvtype table").prepend($('<thead id = "day_details_header"><tr><th>'+ZPI18N.getString("zp.date")+'</th><th></th><th style="text-align:right">'+ZPI18N.getString("zp.duration")+"</th></tr></thead>"));var leaveForm=this;daydetails.find(".chslvtype tbody input").not("[isCheckBox=true]").each(function(){var _this=this;const onChange=function(event){var maxMins=+event.target.attr("maxMins");if("from_time"==event.target.attr("id")&&LeaveDay.Add.Util.refreshBtwnHrs(event.target),"to_time"==event.target.attr("id")){var from=ZPeopleComponents.timefield(event.target.parents("tr").find("input#from_time")).getValue().dateString,to=ZPeopleComponents.timefield($(_this)).getValue().dateString,temp=Leave.Util.getTimeDiff(from,to);if((temp=temp%1==0?parseInt(temp):temp)>maxMins)return void event.target.trigger("ztimefieldchange");LeaveDay.Add.Util.refreshBtwnHrs(event.target)}"time_taken"==event.target.attr("id")&&Leave.Util.convertHourstoMinutes(event.detail.value)>maxMins&&event.target.val(event.target.data("value")).trigger("change"),LeaveForm.getInstance().updateTotal(),LeaveForm.Summary.refresh()};LeaveAdminOpers.ZPeopleComponents.TimeField.init({container:$(this),format:$(this).attr("isTime")&&!Leave.Util.is24HrTimeFormat()?"hh:mm tt":"HH:mm",onChangeCB:_.debounce(onChange,500),spinendCB:_.debounce(onChange,500),width:"120px"})}),LeaveForm.getInstance().lazyLoad(daydetails.find(".chslvtype")),daydetails.find(".chslvtype tbody select").each(function(){$(this).on("zselectchange",function(event){!function(event){if(event.target.attr("periods")){LeaveDay.Add.Util.addSessions(event.target.parents("tr"));var s=event.target.parents("tr").find("[sessions]");s.zselect("destroy"),s.zselect(),leaveForm.updateTotal(),LeaveForm.Summary.refresh()}else event.target.attr("sessions")&&(leaveForm.updateTotal(),LeaveForm.Summary.refresh())}(event)}),$(this).trigger("change")});var absentRecId=-1!=Layout.Page.hash.indexOf("convert")&&LVUtil.urls.getCurrentUrlParams().recordId;absentRecId&&LeaveForm.LAYOUT.data("absent_"+absentRecId).ishalfday&&ZPeopleComponents.select(daydetails.find("select[periods][name="+LeaveForm.LAYOUT.data("absent_"+absentRecId).absent_from+"]")).setValue("0.5"),LeaveForm.LAYOUT.find("div[folabel=ZP_Leave_File_Upload]").data("showFileUploadAfter",dataObj.showFileUploadAfter),daydetails.find(".chslvtype").data("leavetaken",dataObj.leavetaken),daydetails.find(".chslvtype").data("takenBeforeAfter",dataObj.takenBeforeAfter),this.updateTotal(dataObj.daysTaken);var unitSelect=$("div#leaveunitSelect",LeaveForm.LAYOUT);if(LVUtil.urls.CompOff.isBook()){var ishour=$("input[name=From]",LeaveForm.LAYOUT).data("isHourType");dataObj.isDayAndHourAllowed?(0==isreg&&(ishour?(ZPeopleComponents.select(unitSelect.find("select")).setValue("hour"),(void 0==prevLoopCB||0==prevLoopCB)&&LeaveDay.Add.Util.switchUnit({detail:{value:"hour"}})):(ZPeopleComponents.select(unitSelect.find("select")).setValue("day"),(void 0==prevLoopCB||0==prevLoopCB)&&LeaveDay.Add.Util.switchUnit({detail:{value:"day"}}))),LeaveForm.getInstance().switchCompoffMessage(dataObj,ishour?"hour":"day")):LeaveForm.getInstance().switchCompoffMessage(dataObj,"day")}else LeaveForm.isViewMode()||dataObj.isAppliedInHours&&(ZPeopleComponents.select(unitSelect.find("select")).setValue("hour"),(void 0==prevLoopCB||0==prevLoopCB)&&LeaveDay.Add.Util.switchUnit({detail:{value:"hour"}}));if(daydetails.collapse("show"),!ZP5Form.PRINT){if(dataObj.suggestRH){var ltype=LeaveForm.getInstance().getRHType();ltype&&(dataObj.message=ZPI18N.getString("zp.leave.apply.info.suggestleavetype",[ltype]))}if(dataObj.exceed_count_handling&&!dataObj.exceed_count_handling.hasOwnProperty("exceed_ERROR")){var lop=dataObj.exceed_count_handling.mark_lop_count,curAvail=dataObj.exceed_count_handling.available,balanceNote=$("#balancealert",LeaveForm.LAYOUT);delete dataObj.exceed_count_handling.mark_lop_count,delete dataObj.exceed_count_handling.available;var message="";lop>0&&(message+=ZPI18N.getString("zp.leave.apply.info.lop")),balanceNote.text(curAvail+" "+balanceNote.data("unit")),dataObj.message?dataObj.message2=message:dataObj.message=message}!function(dataObj){if(!dataObj.hasOwnProperty("balance")||LeaveForm.isViewMode()||LVUtil.urls.CompOff.isBook())LeaveForm.LAYOUT.find("#available").addClass("DNI");else{var balanceNote=$("#balancealert",LeaveForm.LAYOUT);balanceNote.parents("#available").removeClass("DNI");var unit=!dataObj.isDayBased&&!dataObj.isDayAndHourAllowed||4==dataObj.type&&dataObj.isAppliedInHours?ZPI18N.getString("zp.hours"):ZPI18N.getString("zp.days");balanceNote.text(dataObj.balance+" "+unit),balanceNote.data("unit",unit),4==dataObj.type&&(balanceNote.data("availableInDays",dataObj.balanceInDays+" "+ZPI18N.getString("zp.days")),balanceNote.data("availableInHours",dataObj.balanceInHours+" "+ZPI18N.getString("zp.hours")))}}(dataObj);var isV1User=ZPeople.Module.MODULE_DATA.leavetracker?ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isV1User:Leave.Util.isV1User;ZP5Form.getFormClassObj().getParams().isfromProjects||Leave.isEmbed||isV1User||LeaveForm.Summary.init(dataObj)}LeaveForm.getInstance().setFooter(dataObj)}},lazyLoad:function(parent){parent.off("scroll"),parent[0].scrollTo(0,0);var rowLen=parent.find("tr").length;$.each(parent.find("tr:lt(25)").find("select[name]"),function(){LeaveAdminOpers.ZPeopleComponents.Select.init({container:$(this)})});var loadedRowLen=25,loadedAllRows=loadedRowLen>=rowLen;if(!loadedAllRows){parent.on("scroll",function(e){if(!loadedAllRows&&$(e.target).scrollTop()>50*(loadedRowLen-1)){var selects=parent.find("tr:gt("+(loadedRowLen-1)+")").slice(0,25).find("select[name]");$.each(selects,function(){LeaveAdminOpers.ZPeopleComponents.Select.init({container:$(this)})}),loadedAllRows=(loadedRowLen+=25)>=rowLen}})}},getAvailed:function(details,isDay){var count=0;return isDay?(count=1,details.isholiday?count=0:details.ishalfday?count=.5:details.isquarterday&&(count=.25)):count=Leave.Util.convertHourstoMinutes(details.defaultValue),count},getDetails:function(){var leaveForm=LeaveForm.LAYOUT,employee=$("[name=Employee_ID]",leaveForm),leavetype=$("input[name=Leavetype]",leaveForm),from=$("input[name=From]",leaveForm),to=$("input[name=To]",leaveForm);$.each(leaveForm.find(".ztextbox__error"),function(){$(this).removeClass("ztextbox__error")}),$.each(leaveForm.find("span.ztextbox--error__label"),function(){$(this).text("")});var leavetypeData=LeaveForm.LAYOUT.data("leavetypedata");if($(leavetype).parents("[isconditionfield=true]").length>0&&ZPFRulesNew.Evaluation.evaluateRulesForField(leavetype),$(from).parents("[isconditionfield=true]").length>0&&ZPFRulesNew.Evaluation.evaluateRulesForField(from),$(to).parents("[isconditionfield=true]").length>0&&ZPFRulesNew.Evaluation.evaluateRulesForField(to),ZPUtil.Validation.isEmpty(ZPeopleComponents.datefield(from).getValue().dateString)&&LeaveForm.getInstance().showHideLeaveBalance(),ZPUtil.Validation.isEmpty(ZPeopleComponents.select(employee).getValue())||ZPUtil.Validation.isEmpty(ZPeopleComponents.select(leavetype).getValue()))LeaveForm.getInstance().showHideTimeInputByField(!1);else{if(ZPUtil.Validation.isEmpty(ZPeopleComponents.datefield(from).getValue().dateString)&&LeaveForm.getInstance().showHideApplyDates(ZPeopleComponents.select(leavetype).getValue()),ZP5Form.getFormClassObj().isAddMode()&&ZPUtil.Validation.isEmpty(ZPeopleComponents.datefield(from).getValue().dateString)&&LeaveForm.getInstance().checkAndSuggestApplyDate(),leavetypeData&&leavetypeData.compoffLeave==ZPeopleComponents.select(leavetype).getValue()?$("div#compofflookup",leaveForm).removeClass("DNI"):$("div#compofflookup",leaveForm).addClass("DNI"),LeaveForm.getInstance().isDayAndHourAllowed(ZPeopleComponents.select(leavetype).getValue(),leavetypeData)){var ltData=LeaveForm.LAYOUT.data("leavetypedata"),isCompOff=ZPeopleComponents.select(leavetype).getValue()==ltData.compoffLeave;LeaveForm.getInstance().showHideTimeInputByField(!1),LeaveDay.Add.Util.ShowHideUnitField(!0,isCompOff&&ltData.isOnlyHourLeavesAllowed,isCompOff&&ltData.isOnlyHourLeavesAllowed)}else $("div#leaveunitSelect",leaveForm).remove(),LeaveDay.Add.Util.ShowHideUnitField(!1),LeaveForm.getInstance().isHourly(ZPeopleComponents.select(leavetype).getValue(),leavetypeData)?LeaveForm.getInstance().showHideTimeInputByField(!0):LeaveForm.getInstance().showHideTimeInputByField(!1);if(ZPUtil.Validation.isEmpty(ZPeopleComponents.datefield(from).getValue().dateString)){if(ZPUtil.Validation.isEmpty(ZPeopleComponents.datefield(from).getValue().dateString)||ZPUtil.Validation.isEmpty(ZPeopleComponents.datefield(to).getValue().dateString))return}else{if(ZPUtil.Validation.isEmpty(ZPeopleComponents.datefield(to).getValue().dateString))ZPeopleComponents.datefield(to).setValue(ZPeopleComponents.datefield(from).getValue().dateString);else{var fromDate=Calendar.parseDate(ZPeopleComponents.datefield(from).getValue().dateString,uidateFormat),toDate=Calendar.parseDate(ZPeopleComponents.datefield(to).getValue().dateString,uidateFormat);if(toDate<fromDate&&ZPeopleComponents.datefield(to).setValue(ZPeopleComponents.datefield(from).getValue().dateString),from.data("expiry")&&Calendar.isvalidDate(from.data("expiry"))){var expiry=Calendar.parseDate(from.data("expiry"),uidateFormat);(fromDate>expiry||toDate>expiry)&&(ZPeopleComponents.datefield(from).setValue(Calendar.formatDate(expiry)),ZPeopleComponents.datefield(to).setValue(ZPeopleComponents.datefield(from).getValue().dateString))}}if(!ZPUtil.Validation.isDate(ZPeopleComponents.datefield(from).getValue().dateString)||!ZPUtil.Validation.isDate(ZPeopleComponents.datefield(to).getValue().dateString))return}if(LeaveForm.isEditMode()&&LeaveForm.getInstance().isEditOnLoad)LeaveForm.getInstance().isEditOnLoad=!1;else{var params={key:"leave_daydetails"};params.employee=ZPeopleComponents.select(employee).getValue(),params.leavetype=ZPeopleComponents.select(leavetype).getValue(),params.from=ZPeopleComponents.datefield(from).getValue().dateString,params.to=ZPeopleComponents.datefield(to).getValue().dateString,1==$("[name=leaveunit]",LeaveForm.LAYOUT).length&&(params.isAppliedInHours="hour"==$("[name=leaveunit]",LeaveForm.LAYOUT).val()),params.rec_id=ZP5Form.getFormClassObj().getParams().recordId,params.fetchBradfordSummary=Leave.Util.isBradfordFactorEnabled(),params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(result){if("success"===result.status){if(result.data.dayCntExceeded)return void ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.leave.apply.error.daterangeexceeded"));if(result.data.dateInvalid)return void ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.validinitaldateval",[dateFmt]));LeaveForm.getInstance().setDayDetails(result.data)}})}}},updateTotal:function(taken){var isDayBased=$("#zp_formleave_daylist",LeaveForm.LAYOUT).data("details").isDayBased,daysTaken=isDayBased?taken:Leave.Util.convertToHoursandMinutes((60*taken).toFixed(0));LeaveForm.isViewMode()&&!LeaveForm.getInstance().isCancelMode&&void 0!=taken||(daysTaken=this.getDayDetailsForParam({})),daysTaken=isDayBased&&daysTaken%1==0?parseInt(daysTaken):daysTaken;taken="";taken=(LeaveForm.isViewMode(),daysTaken+" "+(isDayBased?ZPI18N.getString("zp.days"):ZPI18N.getString("zp.leavetype.hrs"))),LeaveForm.LAYOUT.find("#_lform_total").text(taken),this.showHideDocument(daysTaken)},updateLeaveTaken:function(){var params={};this.getDayDetailsForParam(params);var daysTaken=parseFloat(params.Daystaken);daysTaken=daysTaken%1==0?daysTaken:daysTaken.toFixed(2),daysTaken=isNaN(daysTaken)?"":daysTaken,LeaveForm.LAYOUT.find("input[name=Daystaken]").val(daysTaken),this.showHideDocument()},showhidefooterAction:function(recordImmutable,showCancel){recordImmutable&&LeaveForm.LAYOUT.find(".zpl_frm_mfoter").find("button").hide();var displayName=ZP5Form.getCurrFormsOperation().getFormDisplayName(),footer=LeaveForm.LAYOUT.find("#zp_appproval_container").length>0?LeaveForm.LAYOUT.find("#zp_appproval_container"):LeaveForm.LAYOUT.find("#RSFooter");if(showCancel){$(footer).find("button#zp_cancelleave_btn").remove();var cancelbtn=ZP.create("button",{class:"zlabel zlabel--red zlabel--outline zlabel--medium ML10",id:"zp_cancelleave_btn",onclick:"LeaveForm.getInstance().setCancelMode(true)"});$(cancelbtn).html(ZPI18N.getString("zp.cancelleave",[displayName])),$(footer).append(cancelbtn)}LeaveForm.LAYOUT.find(".zpl_frm_mfoter").hasClass("DN")&&LeaveForm.LAYOUT.find(".zpl_frm_mfoter").removeClass("DN")},getRHType:function(){var ltname;if(void 0!=LeaveForm.LAYOUT.data("report")){var leaves=LeaveForm.LAYOUT.data("report").leavetypes;for(var indx in leaves){var obj=leaves[indx];5==obj.type&&parseFloat(obj.available)>0&&(ltname=obj.name)}return ltname}},switchCompoffMessage:function(dataObj,unit){var leaveForm=$("#zp_form_outer_container"),ishour=$("input[name=From]",leaveForm).data("isHourType"),avail=$("input[name=From]",leaveForm).data("duration"),expiry=$("input[name=From]",leaveForm).data("expiry"),fullday=dataObj.dateArr[0].max_mins?dataObj.dateArr[0].max_mins:480,duration="",unitTxt="";"day"==unit?(duration=ishour?(avail/fullday).toFixed(2):avail,unitTxt=ZPI18N.getString("zp.leavetype.daysinfo")):(avail=ishour?avail:(avail*fullday).toFixed(2),duration=Leave.Util.convertToHoursandMinutes(parseInt(avail)),unitTxt=ZPI18N.getString("zp.shours")),dataObj.message=ZPI18N.getString("zp.leave.apply.info.bookcompoff",[duration+" "+unitTxt,expiry]),LeaveForm.LAYOUT.find("#info_message").html(dataObj.message)},DayDetailsBalance:function(dataObj){if(!dataObj.hasOwnProperty("balance")||LeaveForm.isViewMode()||LVUtil.urls.CompOff.isBook())LeaveForm.LAYOUT.find("#available").addClass("DNI");else{var balanceNote=$("#balancealert",LeaveForm.LAYOUT);balanceNote.parents("#available").removeClass("DNI");var unit=!dataObj.isDayBased&&!dataObj.isDayAndHourAllowed||4==dataObj.type&&dataObj.isAppliedInHours?ZPI18N.getString("zp.hours"):ZPI18N.getString("zp.days");balanceNote.text(dataObj.balance+" "+unit),balanceNote.data("unit",unit),4==dataObj.type&&(balanceNote.data("availableInDays",dataObj.balanceInDays+" "+ZPI18N.getString("zp.days")),balanceNote.data("availableInHours",dataObj.balanceInHours+" "+ZPI18N.getString("zp.hours")))}},addCancelPopUp:function(){var cancelPopUp='<div class="zpl_mfoter" id="leave_cancel_popup"><div class="d-flexC flexclmcap12"><div><label>'+ZPI18N.getString("zp.reasonforcancel")+'</label></div><div class="flex-grow"><textarea type="text" name="description" placeholder="'+ZPI18N.getString("zp.reasonforcancel")+'" rows="4" class="ztextbox" onchange = "{e=>(reason.text=e.target.value)}" oninput = "LeaveForm.getInstance().changeCancelReasonTextArea()"></textarea></div></div><div class="zpl_secn text-left"><div><button type="button" class="zlabel zlabel--red zlabel--outline zlabel--medium" id="cancel_confirm_btn" onclick = "LeaveForm.getInstance().cancelLeave()">'+ZPI18N.getString("zp.cancel")+'<button type="button" class="zlabel zlabel--outline zlabel--medium" onclick ="LeaveForm.getInstance().rerenderDayDetails(false)" >'+ZPI18N.getString("zp.close")+"</button></div></div></div>";LeaveForm.LAYOUT.find(".zpl_minr").append(cancelPopUp),LeaveForm.LAYOUT.find("#zp_cancelleave_btn").addClass("DN")},closeCancelPopUp:function(){LeaveForm.getInstance().isCancelMode=0,LeaveForm.LAYOUT.find("#leave_cancel_popup").remove(),LeaveForm.LAYOUT.find("#zp_cancelleave_btn").removeClass("DN")},setCancelMode:function(isCancel){if(isCancel){var data=$("#zp_formleave_daylist",LeaveForm.LAYOUT).data("details"),isPartialCancelAllowed=!data.isCompoff&&data.isPartialCancelAllowed;LeaveForm.getInstance().isCancelMode=isPartialCancelAllowed?2:1,LeaveForm.getInstance().rerenderDayDetails(isPartialCancelAllowed),0==LeaveForm.LAYOUT.find(".zpl_minr").find("#leave_cancel_popup").length&&LeaveForm.getInstance().addCancelPopUp(),LeaveForm.getInstance().updateTotal(),LeaveForm.Summary.refresh()}else LeaveForm.getInstance().closeCancelPopUp(),LeaveForm.Summary.refresh(),LeaveForm.getInstance().updateTotal()},rerenderDayDetails:function(showCheckbox){var container=$("#zp_formleave_daylist",LeaveForm.LAYOUT),data=container.data("details");data&&(2===LeaveForm.getInstance().isCancelMode&&(container.find(".chslvtype tbody").empty(),data.showCheckbox=showCheckbox,LeaveForm.getInstance().setDayDetails(data)),container.find("#day_details_header").length>0&&container.find("#day_details_header").remove(),showCheckbox?container.find(".chslvtype table").prepend($('<thead id = "day_details_header"><tr><th><div class="zcheckbox"><input type="checkbox" id="check0" name="check_all" value="" class="zcheckbox__helper" checked="" onclick = "LeaveForm.getInstance().toggleAll(this)"><label for="check0" class="zcheckbox__label"></label></div></th><th>'+ZPI18N.getString("zp.date")+"</th><th></th><th>"+ZPI18N.getString("zp.duration")+"</th></tr></thead>")):container.find(".chslvtype table").prepend($('<thead id = "day_details_header"><tr><th>'+ZPI18N.getString("zp.date")+"</th><th></th><th>"+ZPI18N.getString("zp.duration")+"</th></tr></thead>")),LeaveForm.LAYOUT.find("#leave_cancel_popup").length>0?(LeaveForm.LAYOUT.find(".zpl_mfoter.zpl_btnsplt").removeClass("zpl_DNI"),LeaveForm.getInstance().setCancelMode(!1)):LeaveForm.LAYOUT.find(".zpl_mfoter.zpl_btnsplt").addClass("zpl_DNI"))},toggleAll:function(ele){var isChecked=$(ele).is(":checked");$("#zp_formleave_daylist .chslvtype",LeaveForm.LAYOUT).find("input[type=checkbox]").prop("checked",isChecked),LeaveForm.Summary.refresh(),LeaveForm.getInstance().updateTotal()},onToggleCheckbox:function(){var header=$("#zp_formleave_daylist #day_details_header",LeaveForm.LAYOUT),body=$("#zp_formleave_daylist .chslvtype",LeaveForm.LAYOUT);header.find("input[name=check_all]").prop("checked",body.find("input:checked[name=inactive]").length==body.find("input[type=checkbox][name=inactive]").length),LeaveForm.Summary.refresh(),LeaveForm.getInstance().updateTotal()},cancelLeave:function(){LeaveForm.LAYOUT.find("#leave_cancel_popup").find("#cancel_confirm_btn").attr("disabled","true");var reason=LeaveForm.LAYOUT.find("#leave_cancel_popup").find('[name="description"]').val(),container=$("#zp_formleave_daylist",LeaveForm.LAYOUT),params={},isFullCancel=!container.data("details").isPartialCancelAllowed||container.find("[name=check_all]").is(":checked"),popup=LeaveForm.LAYOUT.find("#leave_cancel_popup");LeaveForm.getInstance().getDayDetailsForParam(params,!0);var numberOfCancelledDays=Object.keys(params).filter(function(k){return params[k]&&"object"==typeof params[k]&&params[k].inactive}).length;if(0!=numberOfCancelledDays){if(void 0==ZPeople.Module.isLeaveCancelReasonMandatory)return(params={})[csrfParamName]=csrfToken,params.key="is_cancel_reason_mandatory",void $.post("/leave_common_action.zp",params,function(result){ZPeople.Module.isLeaveCancelReasonMandatory=result.isCancelReasonMandatory,LeaveForm.getInstance().cancelLeave()});if((ZPeople.Module.isLeaveCancelReasonMandatory||ZPeople.Module.MODULE_DATA.leavetracker&&ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isCancelReasonMandatory)&&(!reason||""==reason.trim()))return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.leave.cancell.error.providereason")),popup.find("#cancel_confirm_btn").removeAttr("disabled"),void popup.find("textarea").addClass("redbdr1");if(reason&&reason.length>250)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.leave.cancell.error.reasonlength")),popup.find("#cancel_confirm_btn").removeAttr("disabled"),void popup.find("textarea").addClass("redbdr1");popup.find("textarea").removeClass("redbdr1")}if(isFullCancel)(params={}).key="cancel_leave",params.id=ZP5Form.getFormClassObj().getParams().recordId,params[csrfParamName]=csrfToken,params.reason=reason,$.post("/leave_common_action.zp",params,function(result){if("success"===result.status){try{var recordDtl=ZP5Form.getSingleRecord();recordDtl&&(recordDtl.record.approvalDetails&&(recordDtl.record.approvalDetails.canceledRecord=!0),recordDtl.record.message.approvalStatus=result.approvalStatus.approverDetails?result.approvalStatus.approverDetails.currentApprovalStatus:result.approvalStatus.currentApprovalStatus),ZP5Form.Record.cancelRecCBforModule(recordDtl.record.message.approvalStatus,{},recordDtl.record.approvalDetails)}catch(e){console.log(e)}LeaveForm.getInstance().setCancelMode(!1);var record=LeaveForm.LAYOUT.data("record"),leaveData=record?record.extraDetails:{};leaveData.showCancel=!1,(leaveData.dayDetails?leaveData.dayDetails:[]).showCheckbox=!1,-4==recordDtl.record.message.approvalStatus?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.sentapprsuccessmsg")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.leave.cancelled")),LeaveApplications.refresh=!0,ZP5Form.getForm(formId).setRecordDetails(recordId,void 0),LeaveForm.getInstance().switchToRecView()}else ZPeople.Message.showFailureMsg(result.message?result.message:ZPI18N.getString("zp.notallowedtoedit")),popup.find("#cancel_confirm_btn").removeAttr("disabled")});else{if(0==numberOfCancelledDays)return void LeaveForm.getInstance().rerenderDayDetails(!1);params.rec_id=ZP5Form.getFormClassObj().getParams().recordId;params.Daystaken;delete params.Daystaken,delete params.isDayBased,ZPeople.Request.send("leave_common_action.zp",{key:"modify_leave",reason:reason,params:JSON.stringify(params)},function(result){if("success"===result.status){try{var record=LeaveForm.LAYOUT.data("record"),leaveData=container.data("details");if(leaveData.dateArr)for(var i=0;i<leaveData.dateArr.length;i++)params[leaveData.dateArr[i].date].inactive&&(leaveData.dateArr[i].inactive=!0);var recordDtl=ZP5Form.getSingleRecord();if(recordDtl){if(recordDtl.record.extraDetails&&recordDtl.record.extraDetails.dayDetails){var dArr=recordDtl.record.extraDetails.dayDetails.dateArr;for(i=0;i<dArr.length;i++)params[dArr[i].date].inactive&&(dArr[i].inactive=!0);recordDtl.record.extraDetails.dayDetails.leavetaken=result.leavetaken,recordDtl.record.extraDetails.dayDetails.daysTaken=result.leavetaken}recordDtl.record.approvalDetails&&(recordDtl.record.approvalDetails.canceledRecord=!0),recordDtl.record.message.approvalStatus=result.approvalStatus.approverDetails?result.approvalStatus.approverDetails.currentApprovalStatus:result.approvalStatus.currentApprovalStatus,-4==recordDtl.record.message.approvalStatus?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.sentapprsuccessmsg")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.recordupdatedsuccessfully"))}}catch(e){console.log(e)}var leaveRecordData=record?record.extraDetails:{};leaveRecordData.showCancel=!1,(leaveRecordData.dayDetails?leaveRecordData.dayDetails:[]).showCheckbox=!1,LeaveForm.getInstance().rerenderDayDetails(!1),LeaveForm.LAYOUT.find("#zp_cancelleave_btn").remove(),LeaveApplications.refresh=!0,ZP5Form.getForm(formId).setRecordDetails(recordId,void 0)}else ZPeople.Message.showFailureMsg(result.message?result.message:ZPI18N.getString("zp.notallowedtoedit")),popup.find("#cancel_confirm_btn").removeAttr("disabled")})}},changeCancelReasonTextArea:function(e){LeaveForm.LAYOUT.find("#leave_cancel_popup").find("textarea").removeClass("redbdr1")},setFooter:function(dataObj){LeaveForm.LAYOUT.find(".zpl_mfoter #leaveinfo").remove(),dataObj.message?(LeaveForm.LAYOUT.find(".zpl_mfoter").addClass("a-itm-left d-flexclmcap"),dataObj.message2?LeaveForm.LAYOUT.find(".zpl_mfoter").prepend('<div class="zpl_info text-left wd50_per" id="leaveinfo"> <h6>'+ZPI18N.getString("zp.note")+'</h6><ul><li id="info_message">'+dataObj.message+'</li><li id="info_message">'+dataObj.message2+"</li></ul></div>"):LeaveForm.LAYOUT.find(".zpl_mfoter").prepend('<div class="zpl_info text-left wd50_per" id="leaveinfo"> <h6>'+ZPI18N.getString("zp.note")+'</h6><ul><li id="info_message">'+dataObj.message+"</li></ul></div>")):LeaveForm.LAYOUT.find(".zpl_mfoter").removeClass("a-itm-left d-flexclmcap")},showHideDocument:function(daysTaken,show){var fileUpload=LeaveForm.LAYOUT.find("[folabel=ZP_Leave_File_Upload]");if(LeaveForm.isViewMode()){var fcId=fileUpload.attr("id")?fileUpload.attr("id").split("zp_field_outer_")[1]:"";if(""!=fcId){var document=ZP5Form.Field.getFieldValueData(fcId).componentValue;document&&""!=document&&(show=!0)}}else{var showFileUploadAfter=parseFloat(fileUpload.data("showFileUploadAfter")),takenBeforeAfter=LeaveForm.LAYOUT.find("#zp_formleave_daylist .chslvtype").data("takenBeforeAfter");show=takenBeforeAfter?showFileUploadAfter>0&&daysTaken+takenBeforeAfter>showFileUploadAfter:showFileUploadAfter>0&&daysTaken>showFileUploadAfter}show?fileUpload.parent().removeClass("DNI"):fileUpload.parent().addClass("DNI")},getDayDetailsForParam:function(params,skipStringify){var dayDetails=LeaveForm.LAYOUT.find("#zp_formleave_daylist"),leaveDays=dayDetails.find(".chslvtype tbody"),dataObj=dayDetails.data("details"),isDayBased=dataObj.isDayBased,leavetaken=0;LeaveForm.isViewMode()?$.each(leaveDays.children(),function(indx,ele){var isInactive,name=$(ele).attr("name");isInactive=1===LeaveForm.getInstance().isCancelMode||(2===LeaveForm.getInstance().isCancelMode?$($(ele).find("input[name=inactive]")).length>0&&$($(ele).find("input[name=inactive]")).is(":checked"):$(ele).data("inactive")),params[name]={count:isInactive?0:$(ele).data("count"),session:$(ele).data("session")?$(ele).data("session"):0,inactive:isInactive},leavetaken+=isInactive?0:$(ele).data("count")}):leaveDays.find("tr input[name],select[name]").length>0?$.each(leaveDays.children(),function(indx,ele){if(isDayBased){var countEle=$($(ele).find("select[periods]")),sessionEle=$($(ele).find("select[sessions]")),count=ZPeopleComponents.isComponent(countEle)?ZPeopleComponents.select(countEle).getValue():countEle.val(),session=ZPeopleComponents.isComponent(sessionEle)?ZPeopleComponents.select(sessionEle).getValue():sessionEle.val();if(session=""==session||void 0==session?0:session,count){var name=countEle.attr("name");params[name]=1==count?skipStringify?{count:1,session:0,inactive:!1}:JSON.stringify({count:1,session:0}):skipStringify?{count:count,session:session,inactive:!1}:JSON.stringify({count:count,session:session,inactive:!1}),leavetaken+=parseFloat(count)}}else{var dataele=$($(ele).find("input[name]"));if(name=dataele.attr("name"))if(2==LeaveForm.getInstance().getTimeInputType()){var fromTime=ZPeopleComponents.timefield($(ele).find("input#from_time")).getValue().dateString,toTime=ZPeopleComponents.timefield($(ele).find("input#to_time")).getValue().dateString,minApplied=Leave.Util.getTimeDiff(fromTime,toTime);params[name]=skipStringify?{count:minApplied,startTime:Leave.Util.convertTimetoMinutes(fromTime),endTime:Leave.Util.convertTimetoMinutes(toTime),inactive:!1}:JSON.stringify({count:minApplied,startTime:Leave.Util.convertTimetoMinutes(fromTime),endTime:Leave.Util.convertTimetoMinutes(toTime),inactive:!1}),leavetaken+=minApplied}else if("from_time"==dataele[0].id&&"time_taken"==dataele[1].id){var stTime=ZPeopleComponents.timefield($(ele).find("input#from_time")).getValue().dateString,hrs=ZPeopleComponents.timefield($(ele).find("input#time_taken")).getValue().dateString,edTime=(fromTime=Leave.Util.convertTimetoMinutes(stTime))+Leave.Util.convertHourstoMinutes(hrs);edTime>=1440&&(edTime-=1440);toTime=Leave.Util.convertMinutestoTime(edTime);fromTime=Leave.Util.convertMinutestoTime(fromTime);minApplied=Leave.Util.getTimeDiff(fromTime,toTime);params[name]=skipStringify?{count:minApplied,startTime:Leave.Util.convertTimetoMinutes(fromTime),endTime:Leave.Util.convertTimetoMinutes(toTime),inactive:!1}:JSON.stringify({count:minApplied,startTime:Leave.Util.convertTimetoMinutes(fromTime),endTime:Leave.Util.convertTimetoMinutes(toTime),inactive:!1}),leavetaken+=minApplied}else{var data=dataele.val();if(data){var hourMin=data.split(":"),mins=60*parseInt(hourMin[0])+parseInt(hourMin[1]);params[name]=skipStringify?{count:parseFloat(data),inactive:!1}:JSON.stringify({count:parseFloat(data)}),leavetaken+=mins}}}}):leavetaken=leaveDays.data("leavetaken"),LVUtil.urls.CompOff.isBook()&&(params.compoffId=Layout.Page.hash.split(":")[1]),params.isHour=dataObj.isDayAndHourAllowed&&!isDayBased,params.isDayBased=isDayBased,params.Daystaken=isDayBased?leavetaken:leavetaken/60;var total=isDayBased?leavetaken:Leave.Util.convertToHoursandMinutes(leavetaken),workedDate=LeaveForm.LAYOUT.find("div#worked_date");if($(workedDate).is(":visible")){var booked=workedDate.find(".cmpof_rpts.sel"),ids="";$(booked).each(function(){ids+=$(this).attr("id")+","}),ids.length>0&&(params.compoffId=ids)}return total},getRecordData:function(){return ZP5Form.getFormsOperation(this.formId).getRecordDetails(this.recordId).record},checkAndSuggestApplyDate:function(){var leaveForm=LeaveForm.LAYOUT,applyDates=$("div#applyDates div.leave-panel",leaveForm);if(0!=applyDates.find("tr").length){var closestTr,closestDiff,today=new Date,rangeFrm=(new Date).setDate(today.getDate()-7),rangeTo=(new Date).setDate(today.getDate()+7),rows=_.filter(applyDates.find("tr"),function(tr){return Leave.Util.isBetween(Calendar.parseDate($(tr).attr("date"),uidateFormat),rangeFrm,rangeTo)});if(rows&&rows.length>0)rows.forEach(function(tr){var d=Calendar.parseDate($(tr).attr("date"),uidateFormat),diff=d<today?Leave.Util.getDateDiff(d,today):Leave.Util.getDateDiff(today,d);(void 0==closestDiff||closestDiff>diff)&&(closestDiff=diff,closestTr=$(tr))}),$("input[name=From]",leaveForm).val(closestTr.attr("date")),$("input[name=To]",leaveForm).val(closestTr.attr("date")),applyDates.animate({scrollTop:closestTr.offset().top-applyDates.offset().top},300,function(){closestTr.effect("highlight",{color:"#eef6f8"},2e3)})}},addReport:function(){LeaveForm.LAYOUT.find("#detailedReport").show()},getReportData:function(){var emprecno="";if(LeaveForm.isViewMode())emprecno=LeaveForm.LAYOUT.data("record").extraDetails.dayDetails.employee;else{var leaveForm=$("#zp_form_outer_container",LeaveForm.LAYOUT);emprecno=ZPeopleComponents.select(leaveForm.find("[name=Employee_ID]")).getValue()}if(!ZPUtil.Validation.isEmpty(emprecno)){var params={key:"leavetype_appl",employee:emprecno,isView:LeaveForm.isViewMode()};params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(result){if("success"===result.status){var leavetype=$("select[name=Leavetype]",LeaveForm.LAYOUT);LeaveForm.getInstance().changeLeaveTypes(leavetype,result.leave_data.Options),!LeaveForm.isViewMode()&&LeaveForm.getInstance().populateCompoffLookup(result.leave_data.workedDates),LeaveForm.LAYOUT.data("report",result.leave_data.leave_report[0]),LeaveForm.LAYOUT.data("applyDates",result.leave_data.applyDates),Leave.Util.isV1User=result.leave_data.isV1User}})}},getRestrictedLeaveType:function(leavetypes){var leavetypeArr=leavetypes||[];for(var indx in leavetypeArr){var leaveJson=leavetypeArr[indx];if(5==leaveJson.type)return leaveJson.Id}return""},changeLeaveTypes:function(leavetypeEle,leavetypes,initialVal){if(!LeaveForm.isViewMode()){LeaveForm.isEditMode()&&(LeaveForm.getInstance().isEditOnLoad=!0);var ltypeOptions=[],leavetypeArr=leavetypes||[];for(var indx in ltypeOptions.push({text:ZPI18N.getString("zp.select"),id:"-Select-"}),leavetypeArr){var leaveJson=leavetypeArr[indx];ltypeOptions.push({text:ZPeople.decodeTxt(leaveJson.Value),id:leaveJson.Id})}ZPeopleComponents.select(leavetypeEle).destroy(),LeaveAdminOpers.ZPeopleComponents.Select.init({container:leavetypeEle,optArray:ltypeOptions,dataMapping:{label:"text",value:"id"},isTextHTMLEncoded:!1,onChangeCb:ZP5Form.fieldChangeCalback}),void 0!=initialVal&&""!=initialVal&&ZPeopleComponents.select(leavetypeEle).setValue(initialVal),leavetypeEle.on("zselectchange",function(event){LeaveForm.getInstance().getDetails()})}},getApplicable:function(callback_params,skipSetDayDetails){var leaveForm=LeaveForm.LAYOUT,employee=$("[name=Employee_ID]",leaveForm),leavetype=$("input[name=Leavetype]",leaveForm),team_mail=($("input[name=From]",leaveForm),$("input[name=To]",leaveForm),$("input[name=TeamEmailID]",leaveForm));$("#error_message",leaveForm).remove();var emp=ZPeopleComponents.select(employee).getValue();if(ZPUtil.Validation.isEmpty(emp))ZP5Form.Field.markFieldAsError("Employee_ID",{Employee_ID:ZPI18N.getString("zp.selvalforfield",["Employee ID"])});else{var params={key:"leavetype_appl",employee:emp,isView:LeaveForm.isViewMode()};LeaveForm.isEditMode()&&(params.recordId=ZP5Form.getFormClassObj().getParams().recordId),params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(result){var leavetypeid="";if(LeaveForm.initLeaveType&&""!=LeaveForm.initLeaveType?(leavetypeid=LeaveForm.initLeaveType,LeaveForm.initLeaveType=""):leavetypeid=LeaveForm.isEditMode()?LeaveForm.LAYOUT.data("record").extraDetails.dayDetails.leavetypeId:ZPeopleComponents.select(leavetype).getValue(),"success"===result.status){1==LeaveForm.isRestrictedDate&&(leavetypeid=LeaveForm.getInstance().getRestrictedLeaveType(result.leave_data.Options),LeaveForm.isRestrictedDate=!1),LeaveForm.getInstance().changeLeaveTypes(leavetype,result.leave_data.Options,leavetypeid);var isCompoff=leavetypeid==result.leave_data.compoffLeave,showLookup=(result.leave_data.RHtype,isCompoff&&LeaveForm.isEditMode());LeaveForm.getInstance().populateCompoffLookup(result.leave_data.workedDates,showLookup),ZP5Form.getFormClassObj().isAddMode()&&team_mail.val(result.team_mailid).trigger("change"),LeaveForm.LAYOUT.data("leavetypedata",result.leave_data),LeaveForm.LAYOUT.data("report",result.leave_data.leave_report[0]),LeaveForm.LAYOUT.data("applyDates",result.leave_data.applyDates),LeaveForm.getInstance().showHideApplyDates(leavetypeid),Leave.Util.isV1User=result.leave_data.isV1User;Calendar.formatDate(new Date);LeaveForm.getInstance().showHideLeaveBalance(),callback_params&&callback_params.onloadCallback&&callback_params.onloadCallback(callback_params),!skipSetDayDetails&&LeaveForm.getInstance().getDetails(),2==LeaveForm.myspaceLeaveType&&ZPeopleComponents.select(LeaveForm.LAYOUT.find("[name=Leavetype]")).setValue(result.leave_data.compoffLeave)}})}},showHideLeaveBalance:function(){if(LeaveForm.LAYOUT.data("report")&&!LeaveForm.isViewMode()){var leaveForm=LeaveForm.LAYOUT,employee=$("[name=Employee_ID]",leaveForm),leavetype=$("[name=Leavetype]",leaveForm),from=$("input[name=From]",leaveForm),balanceNote=$("#balancealert",leaveForm),report=LeaveForm.LAYOUT.data("report").leavetypes;if(ZPUtil.Validation.isEmpty(ZPeopleComponents.select(employee).getValue())||ZPUtil.Validation.isEmpty(ZPeopleComponents.select(leavetype).getValue()))balanceNote.parents("#available").addClass("DNI");else for(var indx in balanceNote.parents("#available").removeClass("DNI"),report){var obj=report[indx],ltVal=ZPeopleComponents.select(leavetype).getValue();if(obj.leavetypeid==ltVal){if(!obj.isV2&&obj.hasOwnProperty("available")){var unit="";if(4==obj.type&&obj.isV2){unit=obj.isAppliedInHours?ZPI18N.getString("zp.hours"):ZPI18N.getString("zp.days");var balance=obj.isAppliedInHours?obj.availableInHours:obj.availableInDays;ZPUtil.Validation.isEmpty(ZPeopleComponents.datefield(from).getValue().dateString)&&balanceNote.text(balance+" "+unit),balanceNote.data("availableInDays",obj.availableInDays+" "+ZPI18N.getString("zp.days")),balanceNote.data("availableInHours",obj.availableInHours+" "+ZPI18N.getString("zp.hours"))}else unit=obj.isdayleave?ZPI18N.getString("zp.days"):ZPI18N.getString("zp.hours"),(!obj.isV2||ZPUtil.Validation.isEmpty(ZPeopleComponents.datefield(from).getValue().dateString))&&balanceNote.text(obj.available+" "+unit);balanceNote.data("unit",unit)}else balanceNote.parents("#available").addClass("DNI");break}}}},showCompensatedDate:function(dayDetails){if(dayDetails.hasOwnProperty("mappedDates")&&dayDetails.mappedDates.length>0){var dates=dayDetails.mappedDates,daydetails=$("#zp_formleave_daylist",LeaveForm.LAYOUT);daydetails=$("#leaveDays",LeaveForm.LAYOUT);var lookup='<div class="zpl_secn" id="comp_view"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.leave.compensatory.compensatedwith",[""])+'</label></div><div class="appld_dte" id="compensated_dates"><div class="chslvtype"><div class="zpl_tblres"><table class="zpl_tbl wd100_per"><tbody></tbody></table></div></div></div></div>';daydetails.before($(lookup));lookup=$("div#compensated_dates",LeaveForm.LAYOUT).find("tbody");var length=dates.length,tr="";$.each(dates,function(indx){var obj=dates[indx];indx%2==0&&(tr=ZP.create("tr"));var td=ZP.create("td",{id:obj.id}),compOffDiv=ZP.create("div",{class:"cmpof_rpts"});$(compOffDiv).append(ZP.create("div",{text:obj.date})),$(compOffDiv).append(ZP.create("div",{text:obj.taken})),$(td).append(compOffDiv),$(tr).append(td),(indx%2==1||indx%2==0&&length-1==indx)&&(lookup.append(tr),tr="",1==length&&$("div#compensated_dates",LeaveForm.LAYOUT).find(".chslvtype").addClass("wd50_per"))})}},createCompOffLookup:function(show){var leaveForm=LeaveForm.LAYOUT;if($("div#comp_view",leaveForm).remove(),!$("div#compofflookup",leaveForm).data("isreg")){var daydetails=$("#leaveDays",LeaveForm.LAYOUT),lookup='<div class="zpl_secn '+(show?"":"DNI")+'" id="compofflookup"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.leave.compensatory.compensatedwith",[""])+'</label></div><div class="appld_dte" id="worked_date"><div class="chslvtype"><div class="zpl_tblres"><table class="zpl_tbl wd100_per"><tbody></tbody></table></div></div></div></div>';daydetails.before($(lookup)),$("#compofflookup",LeaveForm.LAYOUT).data("isreg",!0);lookup=$("div#worked_date",LeaveForm.LAYOUT);$(lookup).on("click","div.cmpof_rpts",function(){$(this).hasClass("sel")?$(this).removeClass("sel"):$(this).addClass("sel")})}},populateCompoffLookup:function(bookable,show){this.createCompOffLookup(show);var field=$("#compofflookup",LeaveForm.LAYOUT),lookup=$("div#worked_date",LeaveForm.LAYOUT).find("table>tbody");lookup.html("");var length=bookable.length,tr="";$.each(bookable,function(indx){var obj=bookable[indx];indx%2==0&&(tr=ZP.create("tr"));var td=ZP.create("td",{id:obj.id}),compOffDiv=ZP.create("div",{class:"cmpof_rpts CP"+(obj.isMapped?"sel":""),id:obj.id});$(compOffDiv).append(ZP.create("div",{text:obj.date})),$(compOffDiv).append(ZP.create("div",{text:obj.balance})),$(td).append(compOffDiv),$(tr).append(td),indx%2!=1&&indx!=length-1||(lookup.append(tr),tr="",1==length?$("div#worked_date",LeaveForm.LAYOUT).find(".chslvtype").addClass("wd50_per"):$("div#worked_date",LeaveForm.LAYOUT).find(".chslvtype").removeClass("wd50_per"))}),0==length?(lookup.append('<tr class="DN" id="noOptions"><td style="text-align:left">'+ZPI18N.getString("zp.leave.apply.info.compoffnorecinfo")+"</td></tr>"),field.find("#noOptions").removeClass("DN")):field.find("#noOptions").addClass("DN")},switchToRecView:function(recordId){if(LeaveForm.LAYOUT=void 0,recordId)if(LVUtil.urls.ListView.isAdd()||LVUtil.urls.Balance.isHome()||LVUtil.urls.ListView.isConvert())window.location.href=LVUtil.urls.ListView.VIEW()+":"+recordId;else if(LVUtil.Tab.isApplications())window.location.href=LVUtil.urls.Applications.VIEW()+":"+recordId;else{(new LeaveForm).view(recordId)}else if(LVUtil.Tab.isOpersPage()&&LVUtil.Tab.isApplications())void 0==(viewId=ZP5Views.CURR_VIEWPARAMS.viewId)||"systemView"==viewId?window.location.href=LVUtil.urls.getUrlAsHash(LVUtil.urls.Applications.HOME()):LVUtil.Tab.isOpersUserPage()?window.location.href="#operations/leavetracker/user/applications-viewId:"+viewId+"/id:"+LVUtil.Team.SELECTED_USER:window.location.href="#operations/leavetracker/applications-formId:"+ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.formid+"/viewId:"+viewId;else if(LVUtil.Tab.isList()&&LVUtil.Tab.isMyPage())ZPCal.Calendar&&ZPCal.Calendar.applyLvDate&&(ZPCal.Calendar.applyLvDate=void 0),window.location.href=LVUtil.urls.getUrlAsHash(""!=LVUtil.urls.prevUrl.getHash()?LVUtil.urls.prevUrl.getHash():LVUtil.urls.ListView.HOME()),LVUtil.urls.prevUrl.resetHash();else if(LVUtil.Tab.isList()&&LVUtil.Tab.isUserPage())ZPCal.Calendar&&ZPCal.Calendar.applyLvDate&&(ZPCal.Calendar.applyLvDate=void 0),window.location.href=LVUtil.urls.getUrlAsHash(""!=LVUtil.urls.prevUrl.getHash()?LVUtil.urls.prevUrl.getHash():LVUtil.urls.ListView.TEAMUSERHOME()),LVUtil.urls.prevUrl.resetHash();else if(LVUtil.Tab.isList()&&LVUtil.Tab.isTeamPage())window.location.href=LVUtil.urls.getUrlAsHash(LVUtil.urls.Calendar.HOME());else if(LVUtil.Tab.isOpersUserPage()&&LVUtil.urls.ListView.isConvert())window.location.href=LVUtil.urls.getUrlAsHash(LVUtil.urls.Balance.HOME());else if(LVUtil.Tab.isList()&&LVUtil.Tab.isOpersUserPage())ZPCal.Calendar&&ZPCal.Calendar.applyLvDate&&(ZPCal.Calendar.applyLvDate=void 0),window.location.href=LVUtil.urls.getUrlAsHash(""!=LVUtil.urls.prevUrl.getHash()?LVUtil.urls.prevUrl.getHash():LVUtil.urls.ListView.OPERUSERHOME()),LVUtil.urls.prevUrl.resetHash();else if(LVUtil.Tab.isApplications()&&(LVUtil.Tab.isMyPage()||LVUtil.Tab.isTeamPage())){var viewId=ZP5Views.CURR_VIEWPARAMS.viewId;window.location.href=void 0==viewId||"systemView"==viewId?LVUtil.urls.getUrlAsHash(LVUtil.urls.Applications.HOME()):LVUtil.Tab.isMyPage()?"#leavetracker/mydata/applications-viewId:"+viewId:"#leavetracker/team/applications-viewId:"+viewId}else if(LVUtil.Tab.isApplications()&&LVUtil.Tab.isUserPage()){viewId=ZP5Views.CURR_VIEWPARAMS.viewId;window.location.href=void 0==viewId||"systemView"==viewId?LVUtil.urls.getUrlAsHash(LVUtil.urls.Applications.TEAMUSERHOME()):"#leavetracker/team/user/applications-viewId:"+viewId+"/id:"+LVUtil.Team.SELECTED_USER}else LVUtil.Tab.isCalendar()?window.location.href=LVUtil.urls.getUrlAsHash(LVUtil.urls.Calendar.HOME()):LVUtil.urls.ListView.isConvert()||LVUtil.urls.ListView.isView()?window.location.href=LVUtil.urls.getUrlAsHash(LVUtil.urls.ListView.HOME()):LVUtil.Tab.isCompOff()?window.location.href=LVUtil.urls.getUrlAsHash(LVUtil.urls.CompOff.HOME()):-1!==Layout.Page.hash.indexOf("#approvals/myapproval")?window.location.href="#approvals/myapproval":-1!==Layout.Page.hash.indexOf("#approvals/myrequest")?window.location.href="#approvals/myrequest":-1!=Layout.Page.hash.indexOf("#home/organization/dashboard")?Leave.Dashboard.LeaveReport.get():LVUtil.Tab.isBalance()?window.location.href=LVUtil.urls.getUrlAsHash(LVUtil.urls.Balance.HOME()):-1!=Layout.Page.hash.indexOf("#leavetracker/applications/view")||-1!=Layout.Page.hash.indexOf("#leavetracker/applications/edit")||-1!=Layout.Page.hash.indexOf("#leavetracker/convert")?window.location.href=LVUtil.urls.ListView.HOME():Att_Common_Operations.isMySpaceMyShiftPage()&&MySpaceShift.init()},showHideApplyDates:function(ltypeId){try{var applyDateDiv=$("div#applyDates",LeaveForm.LAYOUT),applyDateslabel=$("div#applyDateslabel",LeaveForm.LAYOUT);applyDateDiv.empty();var ltypeObj=_.find(LeaveForm.LAYOUT.data("report").leavetypes,function(obj){return obj.leavetypeid==ltypeId});if(ltypeObj&&ltypeObj.applyDateFields){var applyDateFields=ltypeObj.applyDateFields,applyDates=LeaveForm.LAYOUT.data("applyDates");-1!=applyDateFields.indexOf("1")&&(applyDateFields=_.without(applyDateFields,"1")).push("1"),applyDateFields.forEach(function(val){if("1"==val){var rh=applyDates.RH;$.each(rh,function(indx){var obj=rh[indx],outer=ZP.create("div",{class:"zradiobutton",date:obj.date});let selFromdate=ZPeopleComponents.datefield(LeaveForm.LAYOUT.find('input[name="From"]')).getValue().dateString,selTodate=ZPeopleComponents.datefield(LeaveForm.LAYOUT.find('input[name="To"]')).getValue().dateString;var radio;radio=selFromdate==obj.date&&selTodate==obj.date?ZP.create("input",{type:"radio",name:"",class:"zradiobutton__helper",checked:"checked"}):ZP.create("input",{type:"radio",name:"",class:"zradiobutton__helper"});var label=ZP.create("label",{class:"zradiobutton__label"});label.appendChild(ZP.create("span",{class:"zradiobutton__text",text:obj.name+" ("+obj.date+")"})),outer.appendChild(radio),outer.appendChild(label),$(applyDateDiv).append(outer)})}else{var field=applyDates[val],date=Calendar.parseDate(field.date,uidateFormat),ltValidFrom=ltypeObj.validFrom&&Calendar.parseDate(ltypeObj.validFrom,uidateFormat),ltValidTo=ltypeObj.validTo&&Calendar.parseDate(ltypeObj.validTo,uidateFormat);if(ltValidFrom){var recurringDateObj=field.recurringDates,tDate=date;if(recurringDateObj&&!(date=recurringDateObj.map(function(d){return Calendar.parseDate(d,uidateFormat)}).filter(function(d){return(!ltValidFrom||ltValidFrom<=d)&&(!ltValidTo||ltValidTo>=d)&&tDate<=d})[0]))return}date=Calendar.formatDate(date,uidateFormat);var outer=ZP.create("div",{class:"zradiobutton",date:date}),radio=ZP.create("input",{type:"radio",name:"",class:"zradiobutton__helper"}),label=ZP.create("label",{class:"zradiobutton__label"});label.appendChild(ZP.create("span",{class:"zradiobutton__text",text:field.name+" ("+date+")"})),outer.appendChild(radio),outer.appendChild(label),$(applyDateDiv).append(outer)}})}0==applyDateDiv.find("div.zradiobutton").length?applyDateslabel.parent().addClass("DNI").hide():(applyDateDiv.find("div.zradiobutton").on("click",function(){$(this).parent().find("input[type=radio]").removeAttr("checked"),$(this).find("input").attr("checked","checked");var date=$(this).attr("date");LeaveForm.LAYOUT.find('input[name="To"]').attr("isRH_Prevent_Change_Event",!0),ZPeopleComponents.datefield(LeaveForm.LAYOUT.find('input[name="To"]')).setValue(date),ZPeopleComponents.datefield(LeaveForm.LAYOUT.find('input[name="From"]')).setValue(date),LeaveForm.getInstance().getDetails()}),applyDateslabel.parent().removeClass("DNI").fadeIn("100"))}catch(e){return}},showHideTimeInputByField:function(show){var ltype=$("[id=leavetimeinputby]",LeaveForm.LAYOUT),obj=ltype.find("input[type='radio']"),isAnythgSlted=!1;if(obj.length>0)for(var i=0;i<obj.length;i++)$(obj[i]).is(":checked")&&(isAnythgSlted=!0);show?(ltype.show(),isAnythgSlted||ltype.find("[name='startendhour']").prop("checked",!0)):(ltype.hide(),ltype.find("input").prop("checked",!1))},getTimeInputType:function(){var ltype=$("[id=leavetimeinputby]",LeaveForm.LAYOUT);return ltype.find("[name='startendhour']").is(":checked")&&!ltype.find("[name='startendtime']").is(":checked")?1:!ltype.find("[name='startendhour']").is(":checked")&&ltype.find("[name='startendtime']").is(":checked")?2:1},isDayAndHourAllowed:function(ltypeId,ltData){return ltData&&_.filter(ltData.Options,function(opt){return opt.Id==ltypeId&&opt.isDayAndHourAllowed}).length>0},isHourly:function(ltypeId,ltData){return ltData&&_.filter(ltData.Options,function(opt){return opt.Id==ltypeId&&opt.isHourly}).length>0},getCompOffDetails:function(){var params={key:"bookcompoff"};LVUtil.urls.CompOff.isBook()&&(params.compoffId=Layout.Page.hash.split(":")[1]),params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(result){if("success"===result.status){var cmpOffData=result.compoff_data,cmpOffLt=result.compofflt_data;LeaveForm.getInstance().setCompOffDetails(cmpOffData,cmpOffLt)}})},setCompOffDetails:function(dataObj,ltDObj){var leaveForm=LeaveForm.LAYOUT,employee=$("[name=Employee_ID]",leaveForm);LeaveForm.getInstance().initEmployeeLkp(dataObj.employee,employee),$(employee).next().addClass("disabled");var leavetype=$("input[name=Leavetype]",leaveForm);ZPeopleComponents.select(leavetype).removeAllOptions();var ltypeOptions=[];ltypeOptions.push({text:ZPeople.decodeTxt(ltDObj.name),id:ltDObj.Id}),ZPeopleComponents.select(leavetype).destroy(),LeaveAdminOpers.ZPeopleComponents.Select.init({container:leavetype,optArray:ltypeOptions,dataMapping:{label:"text",value:"id"},onChangeCb:ZP5Form.fieldChangeCalback}),ZPeopleComponents.select(leavetype).setValue(ltDObj.Id),$(leavetype).next().addClass("disabled"),LeaveForm.LAYOUT.data("leavetypedata",{compoffLeave:ltDObj.Id,isHour:dataObj.isHourType,isOnlyHourLeavesAllowed:ltDObj.isOnlyHourLeavesAllowed,Options:[{Id:ltDObj.Id,value:ltDObj.name,isDayAndHourAllowed:ltDObj.isDayAndHourAllowed}]});var from=$("input[name=From]",leaveForm);ZPeopleComponents.datefield(from).setValue(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date),from.data("duration",dataObj.balance),from.data("isHourType",dataObj.isHourType),from.data("expiry",dataObj.expiry),LeaveForm.getInstance().getDetails()},switchToEdit:function(recordId){void 0!=recordId&&""!=recordId&&(LVUtil.Tab.isOpersPage()?LVUtil.Tab.isOpersUserPage()?window.location.href="#operations/leavetracker/user/applications/edit-recordId:"+recordId:window.location.href="#operations/leavetracker/applications/edit-recordId:"+recordId:LVUtil.Tab.isMyPage()?window.location.href="#leavetracker/mydata/applications/edit-recordId:"+recordId:LVUtil.Tab.isTeamPage()?window.location.href="#leavetracker/team/applications/edit-recordId:"+recordId:LVUtil.Tab.isUserPage()&&(window.location.href="#leavetracker/team/user/applications/edit-recordId:"+recordId))},setDate:function(){var leaveForm=leaveForm||$("#zp_form_outer_container",LeaveForm.LAYOUT);ZPeopleComponents.datefield($("input[name=From]",leaveForm)).setValue(from),ZPeopleComponents.datefield($("input[name=To]",leaveForm)).setValue(to)},initEmployeeLkp:function(employee,ele){var empObj="";empObj=LVUtil.Tab.isOpersPage()||LVUtil.Tab.isNewTabPage()?ZP.getUserDetailsById(employee):ZPeople.getUserDetailsById(employee);var empData=[];empData.push({text:empObj.name,id:empObj.id}),ZPeopleComponents.select(ele).destroy(),LeaveAdminOpers.ZPeopleComponents.Select.init({container:ele,optArray:empData,dataMapping:{label:"text",value:"id"}}),ZPeopleComponents.select(ele).setValue(empObj.id)},showHideLvExtraDetails:function(){var extraOpts=settingsPage.container.find(".zpl_frminfopanel");extraOpts.find("#LEAVE_QUICK_LINKS").is(":visible")||extraOpts.find("#CURRENT_LEAVETYPE_INFO").is(":visible")||extraOpts.find("#detailedReport").is(":visible")?extraOpts.removeClass("DNI"):extraOpts.addClass("DNI")}};exports.prototype=LeaveFormProto},LeaveForm),LeaveForm.loadTemplate=function(){Leave.exportForm.getHTMLFormDataObj("ZPLeave_exp_form","","leave_common_action.zp?key=import_template","post","exportresp1",null).submit()},LeaveForm.recordImmutableFooter=function(approvalDetails){var footer=LeaveForm.LAYOUT.find(".zpl_frm_mfoter"),apprejHtmlList=$('<div class="col-sm-12" id="zp_appproval_container"><i class="IC-info gry S16"></i>&nbsp;'+ZPI18N.getString("zp.leave.record.approval.immutableinfo")+"</div>");footer.find(".row").append(apprejHtmlList)},LeaveForm.hideApproval=function(){},LeaveForm.postApprRejCallback=function(obj){LeaveApplications.refresh=!0,OPApprovals.Forms.listCallBack(recordId,obj.getApprovalParam().getApprovalStatus()),obj.getApprovalParam().recordStatus==zpconst.ApprovalStatus.Rejected&&obj.getLayoutParams().getLayout().find(".zpl_mfoter #zp_cancelleave_btn").remove()},LeaveForm.switchTimeinputUnit=function(element){var field=LeaveForm.LAYOUT.find("#leavetimeinputby");"startendtime"==$(element).attr("name")?field.find("[name='startendhour']").prop("checked",!1):field.find("[name='startendtime']").prop("checked",!1),LeaveForm.switchUnit({detail:{value:"hour"}})},LeaveForm.switchUnit=function(event){var value=event.detail.value,dataObj=LeaveForm.LAYOUT.find("#zp_formleave_daylist").data("details");"day"==value?(LeaveForm.getInstance().showHideTimeInputByField(!1),dataObj&&(dataObj.isDayBased=!0),LeaveForm.getInstance().setDayDetails(dataObj,!0)):(LeaveForm.getInstance().showHideTimeInputByField(!0),dataObj&&(dataObj.isDayBased=!1),LeaveForm.getInstance().setDayDetails(dataObj,!0)),dataObj&&(LeaveForm.getInstance().updateTotal(),LeaveForm.Summary.refresh());var balanceNote=$("#balancealert",LeaveForm.LAYOUT),ltData=LeaveForm.LAYOUT.data("leavetypedata");ltData&&(LeaveForm.LAYOUT.find("[name=Leavetype]").val()==ltData.compoffLeave&&balanceNote.text(balanceNote.data("day"==value?"availableInDays":"availableInHours")));LVUtil.urls.CompOff.isBook()&&dataObj&&LeaveForm.getInstance().switchCompoffMessage(dataObj,value)},LeaveForm.TeamMembersOnLeave={init:function(){if(settingsPage.container.find("#operations-leave-applications_teammembers_onleave").remove(),LeaveForm.LAYOUT.data("teammembersdata_"+ZP5Form.getFormClassObj().getParams().recordId))LeaveForm.TeamMembersOnLeave.populate(LeaveForm.LAYOUT.data("teammembersdata_"+ZP5Form.getFormClassObj().getParams().recordId));else{var employee=LeaveForm.LAYOUT.data("record").extraDetails.dayDetails.employee,from=LeaveForm.LAYOUT.data("record").extraDetails.dayDetails.from,to=LeaveForm.LAYOUT.data("record").extraDetails.dayDetails.to;ZPeople.Request.send("leave_common_action.zp",{key:"getTeamMembersOnLeave",employee:employee,from:from,to:to},function(resp){resp&&resp.data?(LeaveForm.TeamMembersOnLeave.populate(resp.data),LeaveForm.LAYOUT.data("teammembersdata_"+ZP5Form.getFormClassObj().getParams().recordId,resp.data)):ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.problemoccured"))},function(){ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.problemoccured"))})}},populate:function(data){var from=LeaveForm.LAYOUT.data("record").extraDetails.dayDetails.from,to=LeaveForm.LAYOUT.data("record").extraDetails.dayDetails.to,fromDt=Calendar.parseDate(from,uidateFormat),toDt=Calendar.parseDate(to,uidateFormat),dateDiff=Leave.Util.getDateDiff(fromDt,toDt),header=0==dateDiff?ZPI18N.getString("zp.leave.employeesonleave.singledate",[from]):1==dateDiff?ZPI18N.getString("zp.leave.employeesonleave.doubledate",[from,to]):ZPI18N.getString("zp.leave.employeesonleave.period",[from,to]),modalParams={id:"operations-leave-applications_teammembers_onleave"},tempMemsOnLvModal=new sliderModal(header,modalParams);tempMemsOnLvModal.mediumSize=!0,tempMemsOnLvModal.construct(),tempMemsOnLvModal.setCloseCallback(function(){tempMemsOnLvModal.remove()});var modal=settingsPage.container.find("#operations-leave-applications_teammembers_onleave");modal.find(".zpl_mfoter").find("#sliderSbt").remove();var html='<div class="zpl_crdcnt"><div class="zpl_tblres" id="teammembers_onleave_container"><table class="zpl_tbl wd100_per"><thead><tr id="teammembers_onleave_header"><th>'+ZPI18N.getString("zp.employee")+"</th><th>"+ZPI18N.getString("zp.leave.context.lvpolicy")+"</th><th>"+ZPI18N.getString("zp.from")+"</th><th>"+ZPI18N.getString("zp.to")+"</th><th>"+ZPI18N.getString("zp.count")+"</th><th>"+ZPI18N.getString("zp.leave.operations.approvalstaus")+'</th></tr></thead><tbody id="teammembers_onleave_body"></tbody></table></div></div>';modal.find(".zpl_mcnt").append($(html));var tbody=modal.find("#teammembers_onleave_body");0==data.length?LeaveAdminOpers.Util.showHideNoData(!0,"No team members are on leave in this period",modal.find(".zpl_mcnt")):(LeaveAdminOpers.Util.showHideNoData(!1),$.each(data,function(idx,obj){var tr=ZP.create("tr"),emp_td=ZP.create("td"),emp_div=ZP.create("div",{class:"zpl_em"}),emp_imgdiv=ZP.create("div",{class:"zpl_emimg"});emp_imgdiv.appendChild(ZP.create("img",{class:"FL",src:obj.photo?obj.photo:""}));var emp_dtsdiv=ZP.create("div",{class:"zpl_emdts"}),tempDiv=ZP.create("div",{class:"tooltip-js","data-title-position":"top",title:ZPeople.getUserDisplayName(obj.fname,obj.lname)});tempDiv.appendChild(ZP.create("em",{text:obj.id+" - "})),tempDiv.appendChild(ZP.create("b",{text:ZPeople.getUserDisplayName(obj.fname,obj.lname)})),emp_dtsdiv.appendChild(tempDiv),emp_div.appendChild(emp_imgdiv),emp_div.appendChild(emp_dtsdiv),emp_td.appendChild(emp_div),tr.appendChild(emp_td),$.each(obj.LEAVES,function(idx2,obj2){idx2>0&&(tr=ZP.create("tr")).appendChild(ZP.create("td"));var td=ZP.create("td");td.appendChild(ZP.create("span",{text:obj2.leavetype,class:"tooltip-js","data-title-position":"top",title:obj2.leavetype})),tr.appendChild(td),tr.appendChild(ZP.create("td",{class:"",text:obj2.from})),tr.appendChild(ZP.create("td",{class:"",text:obj2.to})),td=ZP.create("td"),obj2.session?td.appendChild(ZP.create("span",{text:obj2.count+" "+Leave.Util.getDispUnit(obj2.count,obj2.unit),class:"tooltip-js","data-title-position":"right",title:obj2.session})):td.appendChild(ZP.create("span",{text:obj2.count+" "+Leave.Util.getDispUnit(obj2.count,obj2.unit)})),tr.appendChild(td);var appTd=ZP.create("td");$(appTd).html(LeaveForm.TeamMembersOnLeave.getStatusIcon(obj2.approvalstatus)),tr.appendChild(appTd),tbody.append(tr)})})),(LVUtil.Tab.isMySpace()||ZPFeeds.SINGLEPOP)&&tempMemsOnLvModal.sliderDiv.addClass("zpl_ntzindx"),tempMemsOnLvModal.open(),modal.ztooltip()},getStatusIcon:function(approvalStatus){return-2==approvalStatus?"":-1==approvalStatus?'<i class="PI_ap_pending">':1==approvalStatus?'<i class="PI_ap_approved">':0==approvalStatus?'<i class="PI_ap_reject">':2==approvalStatus?'<i class="PI_ap_cancel">':void 0}},LeaveForm.QuickLinks={init:function(){if(0==LeaveForm.LAYOUT.find(".zpl_frminfopanel").length){(container=$(LeaveForm.Summary.getHeaderHtml())).append(LeaveForm.QuickLinks.getQuickLinksHtml()),container.append(LeaveForm.Summary.getReportHtml()),LeaveForm.LAYOUT.append($(container))}else{$(LeaveForm.LAYOUT.find("#LEAVE_QUICK_LINKS")).remove();var container=$(LeaveForm.QuickLinks.getQuickLinksHtml());LeaveForm.LAYOUT.find("#CURRENT_LEAVETYPE_INFO").before($(container))}var quickLinkParent=LeaveForm.LAYOUT.find("#LEAVE_QUICK_LINKS"),teamMembersOnLeave=LeaveForm.LAYOUT.data("record").extraDetails.dayDetails.teamMembersOnLeave;if(teamMembersOnLeave){quickLinkParent.find("#TEAM_MEMBERS_ON_LEAVE,.zpl_emlvergt").on("click",LeaveForm.QuickLinks.showTeamMembers);var txt=1==teamMembersOnLeave?ZPI18N.getString("zp.leave.oneemployeeonleave"):ZPI18N.getString("zp.leave.xemployeesonleave",[teamMembersOnLeave+""]);quickLinkParent.find("#TEAM_MEMBERS_ON_LEAVE a").html(txt),quickLinkParent.removeClass("DNI")}else quickLinkParent.find("#TEAM_MEMBERS_ON_LEAVE").addClass("DNI")},getQuickLinksHtml:function(){return'<div class="zpl_emlve zpl_whtbg DNI" data-popup-open="emplevlst" id="LEAVE_QUICK_LINKS"><div id="TEAM_MEMBERS_ON_LEAVE"><a></a></div><div class="zpl_emlvergt"><div class="zpl_em"><div class="zpl_emdts"><i class="PI_argt gry"></i></div></div></div></div>'},showSummary:function(){LeaveForm.QuickListView.init()},showTeamMembers:function(){LeaveForm.TeamMembersOnLeave.init()}},LeaveForm.QuickListView={getHtml:function(){var applHtml='<div class="zpl_secn" id="ZP_QuickListView"><div class="zlabel zlabel--blue zlabel--outline zlabel--medium" data-popup-open="lvreport" onclick="LeaveForm.QuickListView.init()">'+ZPI18N.getString("zp.view")+" "+ZPI18N.getString("zp.leave.customform.applications")+"</div></div>";$(".zpl_rgtcnt").append(applHtml)},init:function(){if(LeaveForm.LAYOUT.data("listviewdata_"+ZP5Form.getFormClassObj().getParams().recordId))LeaveForm.QuickListView.populate(LeaveForm.LAYOUT.data("listviewdata_"+ZP5Form.getFormClassObj().getParams().recordId));else{var params={key:"quick_list_view",employee:LeaveForm.LAYOUT.data("record").extraDetails.dayDetails.employee},loc=ZP.getUserDetailsById(params.employee).location;params.location=loc+""=="null"?-1:loc,ZPeople.Request.send(LeaveAdminOpers.viewUrl,params,function(resp){LeaveForm.QuickListView.populate(resp),LeaveAdminOpers.Util.removeLoading(),LeaveForm.LAYOUT.data("listviewdata_"+ZP5Form.getFormClassObj().getParams().recordId,resp)},{})}},populate:function(resp){var modalParams={id:"operations-leave-applications_quick_list_view"},quickListModal=new sliderModal(resp.formdisplayName+" "+ZPI18N.getString("zp.leave.customform.applications"),modalParams);quickListModal.mediumSize=!0,quickListModal.construct(),quickListModal.setCloseCallback(function(){quickListModal.remove()});var modal=settingsPage.container.find("#operations-leave-applications_quick_list_view");modal.find(".zpl_mfoter").find("#sliderSbt").remove();var html='<div class="zpl_crd"> <div class="zpl_crdcnt"><div class="zpl_tblres" id="zp_quicklistview_container"><table class="zpl_tbl wd100_per"><thead id="ZP_Leave_lh_header"><tr id="approval_enabled_header"><th style="width:17%%">'+ZPI18N.getString("zp.date")+'</th><th style="width:23%">'+ZPI18N.getString("zp.leavetype")+'</th><th style="width:15%">'+ZPI18N.getString("zp.count")+'</th><th style="width:25%">'+ZPI18N.getString("zp.reason")+'</th><th style="width:15%">'+ZPI18N.getString("zp.approvalstatus")+'</th></tr><tr id="approval_disabled_header" class="DN"> <th class="zptbbor-fl" width="20%">'+ZPI18N.getString("zp.date")+'</th> <th width="30%">'+ZPI18N.getString("zp.leavetype")+'</th> <th width="20%">'+ZPI18N.getString("zp.count")+'</th> <th class="zptbbor-fr" width="25%"><span>'+ZPI18N.getString("zp.reason")+'</span></th> </tr></thead><tbody id="zp_quicklistview_body"></tbody></table></div></div></div>';if(modal.find(".zpl_mcnt").html(html),resp.error)return LeaveAdminOpers.Util.removeLoading(),LeaveAdminOpers.Util.showHideNoData(!0,resp.error,modal.find("#zp_quicklistview_container")),modal.modal("show"),modal;var lh=resp.data;if(modal.find("#approval_disabled_header").addClass("DN"),modal.find("#approval_enabled_header").removeClass("DN"),0==lh.length)LeaveAdminOpers.Util.removeLoading(),LeaveAdminOpers.Util.showHideNoData(!0,"",modal.find("#zp_quicklistview_container"));else{for(var tempDoc=document.createDocumentFragment(),index=0;index<lh.length;index++){var lhJson=lh[index];if(!lhJson.isHoliday&&11!=lhJson.approvalStatus&&14!=lhJson.approvalStatus){var daysDetails=lhJson.dayDetails,detailsTr=ZP.create("tr",{class:""}),dateTd=ZP.create("td",{class:"",width:"23%"}),leaveTypeTd=ZP.create("td",{width:"23%"}),daysCountTd=ZP.create("td",{width:"15%"}),reasonTd=ZP.create("td",{width:"25%",class:""}),approvalTd=ZP.create("td",{class:"",width:"15%"}),noOfData=daysDetails.length,date_diff=daysDetails.date_diff,dateFrom=Calendar.parseDate(lhJson.from,uidateFormat),dateTo=Calendar.parseDate(lhJson.to,uidateFormat);if(11!==lhJson.approvalStatus&&14!==lhJson.approvalStatus){var fromdate=ZP.create("a",{text:lhJson.from+", "+days[dateFrom.getDay()]});dateTd.appendChild(fromdate)}else dateTd.appendChild(ZP.create("a",{text:lhJson.to+", "+days[dateTo.getDay()],href:"javascript:void(0)"}));if(noOfData>1||date_diff&&date_diff>1)if($(dateTd).find("a").append(" "+ZPI18N.getString("zp.sto")+" "),11!==lhJson.approvalStatus&&14!==lhJson.approvalStatus){dateTo=Calendar.parseDate(lhJson.to,uidateFormat);var todate=lhJson.to+", "+days[dateTo.getDay()];$(dateTd).find("a").append(todate)}else dateTd.appendChild(ZP.create("a",{text:lhJson.to+" - "+lhJson.toDay,href:"javascript:void(0)"}));daysCountTd.append(lhJson.leavetaken+" "+lhJson.leaveunit),LeaveAdminOpers.Util.getStatusTd(approvalTd,lhJson.approvalStatus,!0),approvalTd.append(lhJson.approvalStatusDisplay),leaveTypeTd.append(ZP.create("span",{class:"zptb-brdr ZPBC"+lhJson.leavecolorValue})),leaveTypeTd.append(ZP.create("span",{class:"zplvehd",text:lhJson.leavetype,"data-toggle":"tooltip","data-placement":"bottom",title:lhJson.leavetype})),reasonTd.append(lhJson.reason),detailsTr.appendChild(dateTd),detailsTr.appendChild(leaveTypeTd),detailsTr.appendChild(daysCountTd),detailsTr.appendChild(reasonTd),detailsTr.appendChild(approvalTd),tempDoc.appendChild(detailsTr)}}var data_tbody=$("tbody#zp_quicklistview_body",modal);data_tbody.html(""),data_tbody.append(tempDoc),$("tbody#zp_quicklistview_body",modal).is(":empty")?LeaveAdminOpers.Util.showHideNoData(!0,"",modal.find("#zp_quicklistview_container")):LeaveAdminOpers.Util.showHideNoData(!1),LeaveAdminOpers.Util.removeLoading()}return quickListModal.open(),modal}},LeaveForm.Summary={init:function(data){var pageId=LeaveForm.LAYOUT.find(".zpl_mcnt");if(0==pageId.find(".zpl_lvecrdlst#CURRENT_LEAVETYPE_INFO").length){var container="";if(pageId.find("#LEAVE_QUICK_LINKS").length>0)container=LeaveForm.Summary.getDetailsHtml(),pageId.find("#LEAVE_QUICK_LINKS").after($(container));else{container=LeaveForm.Summary.getHtml();pageId.find("#bodyparent").append($(container))}}data.reportsummary||data.bradford_summary?(this.load(data),pageId.find(".zpl_lvecrdlst#CURRENT_LEAVETYPE_INFO").fadeIn("fast")):(pageId.find(".zpl_lvecrdlst#CURRENT_LEAVETYPE_INFO").hide(),pageId.find("#detailedReport").hide())},getHeaderHtml:function(){return'<div class="zpl_frminfopanel"></div>'},getDetailsHtml:function(){return'<div class="zpl_lvecrdlst" id="CURRENT_LEAVETYPE_INFO"><div class="zpl_dfcrd zpl_lvecrd lvecstrip1" id="bradford_summary"><div class="zpl_tmlvestus"></div></div><div class="zpl_dfcrd zpl_lvecrd lvecstrip1" id="ZP_LEAVE_ADVANCED_SUMMARY"><div class="zpl_tmlvestus"><b id="ZP_LEAVE_RANGE"><em id="ZP_LEAVE_UNIT" class="DNI"></em></b><span>'+ZPI18N.getString("zp.leavetype.v2.entitlement.openbalance")+' <b class="grn" id="YEARSTARTINGBALANCE"></b></span><span><p>'+ZPI18N.getString("zp.leave.entity.accruedtill",[""])+'</p> <em id="ZP_LEAVE_DATE"></em> <b class="grn" id="ACCRUEDTILLDATE"></b></span><span><p>'+ZPI18N.getString("zp.leave.entity.totalbalance")+'</p> <b id="YSB_PLUS_ATD"></b></span><span><p>'+ZPI18N.getString("zp.leave.entity.leavetakentill",[""])+'</p> <em id="ZP_LEAVE_DATE"></em> <b id="AVAILEDTILLDATE"></b></span></div></div><div class="zpl_dfcrd zpl_lvecrd lvecstrip2" id="ZP_LEAVE_BASIC_SUMMARY"><div class="zpl_tmlvestus"><b>'+ZPI18N.getString("zp.leave.filter.ason",[""])+'&nbsp<em id="ZP_LEAVE_DATE" class="MRauto"></em></b><span>'+ZPI18N.getString("zp.leave.entity.availablebalance")+' <b class="grn" id="CURRENTBALANCE"></b></span><span>'+ZPI18N.getString("zp.leave.entity.currentbooking")+' <b id="CURRENTBOOKING"></b></span><span data-popup-open="balncbkd" id="ZP_LEAVE_VIEW_TRANSACTIONS" onclick="LeaveForm.Summary.loadTransactions()"><a>'+ZPI18N.getString("zp.leave.entity.balanceafterbooking",["",""])+' </a><b id="BALANCE_AFTER_BOOKING"></b></span></div></div><div class="zpl_dfcrd zpl_lvecrd lvecstrip2" id="ZP_LEAVE_YEAR_END_SUMMARY"><div class="zpl_tmlvestus"><b>'+ZPI18N.getString("zp.leave.filter.ason",[""])+' &nbsp<em id="ZP_LEAVE_YEAR" class="MRauto"></em></b><span>'+ZPI18N.getString("zp.leave.entity.endestimate")+' <b id="YEARENDBALANCE"></b></span></div></div></div>'},getReportHtml:function(){return'<div class="zpl_secn" id="detailedReport"><div class="zlabel zlabel--blue zlabel--outline zlabel--medium" data-popup-open="lvreport" onclick="LeaveDetailedReport.html()">'+ZPI18N.getString("zp.view")+" "+ZPI18N.getString("zp.leavereport")+"</div></div>"},getHtml:function(){var container=$(LeaveForm.Summary.getHeaderHtml());return container.append(LeaveForm.Summary.getDetailsHtml()),container.append(LeaveForm.Summary.getReportHtml()),container},loadHeaders:function(reportSummary){var summaryContainer=LeaveForm.LAYOUT.find(".zpl_mcnt").find(".zpl_lvecrdlst#CURRENT_LEAVETYPE_INFO");if(reportSummary.hasOwnProperty("showAdvancedInfo")&&!reportSummary.showAdvancedInfo){summaryContainer.find("#ZP_LEAVE_ADVANCED_SUMMARY").hide();var basicSummaryHeader=$(summaryContainer.find("#ZP_LEAVE_BASIC_SUMMARY").find("b")[0]);0==basicSummaryHeader.find("#ZP_LEAVE_UNIT").length&&basicSummaryHeader.append('<em id="ZP_LEAVE_UNIT" class="DNI"></em>')}reportSummary.hasOwnProperty("IS_ACCUMULATED_BALANCE")&&reportSummary.IS_ACCUMULATED_BALANCE&&(summaryContainer.find("#ACCRUEDTILLDATE").closest("p").text(ZPI18N.getString("zp.leave.entity.accruedsofar")),summaryContainer.find("#AVAILEDTILLDATE").attr("id","AVAILED_PRESET_AND_FUTURE"),summaryContainer.find("#AVAILED_PRESET_AND_FUTURE").closest("p").text(ZPI18N.getString("zp.leave.entity.totaltaken")),summaryContainer.find("#ZP_LEAVE_YEAR_END_SUMMARY").hide()),reportSummary.YEAR_START&&reportSummary.YEAR_END&&summaryContainer.find("#ZP_LEAVE_RANGE").text(reportSummary.YEAR_START+" "+ZPI18N.getString("zp.sto")+" "+reportSummary.YEAR_END),reportSummary.LEAVE_DATE&&summaryContainer.find("em#ZP_LEAVE_DATE").text(reportSummary.LEAVE_DATE),reportSummary.YEAR_END&&summaryContainer.find("#ZP_LEAVE_YEAR").html(reportSummary.YEAR_END),reportSummary.UNIT_TXT&&(summaryContainer.find("#ZP_LEAVE_UNIT").removeClass("DNI"),summaryContainer.find("em#ZP_LEAVE_UNIT").text(reportSummary.UNIT_TXT)),reportSummary.hasOwnProperty("CHANGESINPOLICY")&&(0==reportSummary.CHANGESINPOLICY?summaryContainer.find("div#ZP_LEAVE_CHANGESINPOLICY").addClass("DNI"):summaryContainer.find("div#ZP_LEAVE_CHANGESINPOLICY").removeClass("DNI")),reportSummary.hasOwnProperty("IS_ALLOWED_TO_VIEW_TRANSACTIONS")&&(reportSummary.IS_ALLOWED_TO_VIEW_TRANSACTIONS?(summaryContainer.find("#ZP_LEAVE_VIEW_TRANSACTIONS").on("click"),summaryContainer.find("b#BALANCE_AFTER_BOOKING").addClass("CP")):(summaryContainer.find("#ZP_LEAVE_VIEW_TRANSACTIONS").off("click"),summaryContainer.find("b#BALANCE_AFTER_BOOKING").removeClass("CP")))},loadBradford:function(bradford_details){var bradfordSummaryEle=LeaveForm.LAYOUT.find(".zpl_mcnt").find(".zpl_lvecrdlst#CURRENT_LEAVETYPE_INFO").find(".zpl_lvecrd#bradford_summary");bradfordSummaryEle.html("");var bfHtml='<div class="zpl_tmlvestus"><span class="crd_lgttl"><b>'+ZPI18N.getString("zp.bradfordfactor.bradfordscore")+"</b><em>"+bradford_details.from+" - "+bradford_details.to+"</em></span><span>"+bradford_details.settingName+"<b>"+bradford_details.projected_score+"</b><em>("+ZPI18N.getString("zp.Level")+" "+bradford_details.projected_level+")</em></span></div>";bradfordSummaryEle.append(bfHtml),bradfordSummaryEle.show()},load:function(data,isRefresh){LeaveForm.LAYOUT=void 0==LeaveForm.LAYOUT?ZP5Form.getLayout():LeaveForm.LAYOUT;var pageId=LeaveForm.LAYOUT.find(".zpl_mcnt"),summaryContainer=pageId.find(".zpl_lvecrdlst#CURRENT_LEAVETYPE_INFO");if(summaryContainer.data("data",data),isRefresh||summaryContainer.find(".zpl_lvecrd").hide(),data.reportsummary){var reportSummary=data.reportsummary;for(var key in isRefresh||summaryContainer.find(".zpl_lvecrd[id!='bradford_summary']").show(),this.loadHeaders(reportSummary),reportSummary)if(value=reportSummary[key],""==summaryContainer.find("#"+key).text().trim())summaryContainer.find("#"+key).text(value),value<0?summaryContainer.find("#"+key).addClass("red"):summaryContainer.find("#"+key).removeClass("red");else{var existingVal=parseFloat(summaryContainer.find("#"+key).text()),newVal=parseFloat(value);Math.abs(newVal-existingVal)>0&&(summaryContainer.find("#"+key).hide().text(newVal).fadeIn(200),newVal<0?summaryContainer.find("#"+key).addClass("red"):summaryContainer.find("#"+key).removeClass("red"))}pageId.find("#lopnote").remove(),reportSummary.LOP_IN_CURRENTBOOKING&&reportSummary.LOP_IN_CURRENTBOOKING>0&&pageId.find("#zp_formleave_daylist").append($('<div id="lopnote" class="label-message label-note lvavalnote"><p class="S13">'+ZPI18N.getString("zp.leave.apply.info.lop2",[reportSummary.LOP_IN_CURRENTBOOKING+" "+Leave.Util.getDispUnit(reportSummary.LOP_IN_CURRENTBOOKING,reportSummary.UNIT)])+"</p></div>"))}else pageId.find("#detailedReport").hide();data.bradford_summary&&data.bradford_summary.success&&(summaryContainer.data("bradford_summary",data),this.loadBradford(data.bradford_summary.bradford_details))},refresh:function(){this.refreshReportSummary(),this.refreshBradfordSummary()},refreshReportSummary:function(){var params={};if(LeaveForm.isViewMode()){var details=LeaveForm.LAYOUT.find("#zp_formleave_daylist").data("details");params={rec_id:ZP5Form.getFormClassObj().getParams().recordId,employee:details.employee,leavetype:details.leavetypeId,from:details.from,to:details.to}}else params.employee=ZPeopleComponents.select(LeaveForm.LAYOUT.find("[name=Employee_ID]")).getValue(),params.leavetype=ZPeopleComponents.select(LeaveForm.LAYOUT.find("[name=Leavetype]")).getValue(),params.from=ZPeopleComponents.datefield(LeaveForm.LAYOUT.find("[name=From]")).getValue().dateString,params.to=ZPeopleComponents.datefield(LeaveForm.LAYOUT.find("[name=To]")).getValue().dateString;LeaveForm.isEditMode()&&(params.rec_id=ZP5Form.getFormClassObj().getParams().recordId),LeaveForm.getInstance().getDayDetailsForParam(params,!0),params.compoffId&&(params.rec_id=params.compoffId,delete params.compoffId),delete params.Daystaken,delete params.isDayBased,ZPeople.Request.send("leave_common_action.zp",{key:"getPreview",previewParams:JSON.stringify(params)},function(data){data&&data.reportsummary&&LeaveForm.Summary.load(data,!0)})},refreshBradfordSummary:function(){var summaryContainer=LeaveForm.LAYOUT.find(".zpl_lvecrdlst#CURRENT_LEAVETYPE_INFO");if(0!==summaryContainer.length){var data=summaryContainer.data("bradford_summary");if(data&&data.bradford_summary&&data.bradford_summary.success){var bradford_details=JSON.parse(JSON.stringify(data.bradford_summary.bradford_details)),att_day_hours=data.bradford_summary.att_day_hours,params={};LeaveForm.getInstance().getDayDetailsForParam(params,!0);var no_of_instances=bradford_details.no_of_instances,no_of_days=bradford_details.no_of_days,loc_no_of_days=0,isHour=params.isHour,isDayBased=params.isDayBased;$.each(params,function(key){if(ZPUtil.Validation.isDate(key)){var cnt=parseFloat(params[key].count);att_day_hours[key]?loc_no_of_days+=!isDayBased||isDayBased&&isHour?cnt/att_day_hours[key]:cnt:loc_no_of_days+=1}}),bradford_details.projected_no_of_instances=no_of_instances+(!LeaveForm.isEditMode()||LeaveForm.isEditMode()&&no_of_instances!==bradford_details.projected_no_of_instances?1:0),bradford_details.projected_no_of_days=no_of_days+loc_no_of_days,bradford_details.projected_score=this.computeBradfordScore(bradford_details.projected_no_of_instances,bradford_details.projected_no_of_days);var bradfordLevels=bradford_details.empBradfordLevels?bradford_details.empBradfordLevels:bradford_details.bradfordLevels;bradford_details.projected_level=this.getEmployeeBradfordLevel(bradfordLevels,bradford_details.projected_score),this.loadBradford(bradford_details)}}},computeBradfordScore:function(instances,days){return(instances*instances*days).toFixed(2)},getEmployeeBradfordLevel:function(bradfordLevels,bradford_score){for(var prev_threshold=0,prev_level=0,i=0;i<bradfordLevels.length;i++){var levelJson=bradfordLevels[i],curr_threshold=levelJson.threshold;if(bradford_score>(prev_threshold=0==i?-1:prev_threshold)&&bradford_score<=curr_threshold)return levelJson.level;prev_threshold=curr_threshold,prev_level=levelJson.level}return prev_level+1},loadTransactions:function(){LeaveForm.LAYOUT.find("#ZP_ApplyLeave_Transaction").remove();var data=LeaveForm.LAYOUT.find(".zpl_mcnt").find(".zpl_lvecrdlst#CURRENT_LEAVETYPE_INFO").data("data");if(data.transactions){var modalParams={id:"ZP_ApplyLeave_Transaction"},ltName="";ltName=LeaveForm.isViewMode()?ZSEC.Encoder.encodeForHTML(settingsPage.container.find('[folabel="Leavetype"]').text()):ZPeopleComponents.select(settingsPage.container.find("[name=Leavetype]"))&&ZPeopleComponents.select(settingsPage.container.find("[name=Leavetype]"))._data.label;var transactionModal=new sliderModal(ZPI18N.getString("zp.leave.entity.balanceafterbooking",["-",ltName]),modalParams);transactionModal.construct(),transactionModal.setCloseCallback(function(){transactionModal.remove()});var modal=settingsPage.container.find("#ZP_ApplyLeave_Transaction");modal.find(".zpl_mfoter").find("#sliderSbt").remove(),modal.find("#sliderCancel").text(ZPI18N.getString("zp.close"));var html='<div class="zpl_crd"> <div class="zpl_crdcnt"><div class="zpl_tblres"><table class="zpl_tbl wd100_per"><thead><tr><th style="width:25%">'+ZPI18N.getString("zp.date")+'</th><th style="width:25%">'+ZPI18N.getString("zp.type")+'</th><th style="width:15%">'+ZPI18N.getString("zp.added")+'</th><th style="width:15%">'+ZPI18N.getString("zp.Used")+'</th><th style="width:15%">'+ZPI18N.getString("zp.leave.view.balance")+"</th></tr></thead><tbody></tbody></table></div></div></div>";modal.find(".zpl_mcnt").html(html);var tbody=modal.find("tbody"),transactions=data.transactions,showEntriesAsDisabled=!1;$.each(transactions,function(indx,obj){var tr=ZP.create("tr",{class:" "+(showEntriesAsDisabled||obj.isArchive?"dgry":obj.isCurrentBooking?"disabledbg":"")});tr.appendChild(ZP.create("td",{class:"",style:"",text:obj.date}));var added="-",used="-",runningbalance="-";obj.isArchive||(added=obj.added?parseFloat(obj.added):0,used=obj.used?parseFloat(obj.used):0,runningbalance=obj.runningbalance?parseFloat(obj.runningbalance):0,added=added%1==0?parseInt(added):added,used=used%1==0?parseInt(used):used,runningbalance=runningbalance%1==0?parseInt(runningbalance):runningbalance,added=0==added?"-":added,used=0==used?"-":used),obj.isEmpExitEntry?(tr.appendChild(ZP.create("td",{style:"",text:ZPI18N.getString("zp.leave.transaction.employeeexited")})),showEntriesAsDisabled=!0):tr.appendChild(ZP.create("td",{style:"",text:obj.isCurrentBooking?ZPI18N.getString("zp.leave.entity.currentbooking"):Leave.Policy.ENTRYTYPE.get(obj.type,obj.isArchive)})),tr.appendChild(ZP.create("td",{style:"",text:added})),tr.appendChild(ZP.create("td",{style:"",text:used})),tr.appendChild(ZP.create("td",{style:"",text:runningbalance})),tbody.append(tr)}),(LVUtil.Tab.isMySpace()||ZPFeeds.SINGLEPOP)&&transactionModal.sliderDiv.addClass("zpl_ntzindx"),transactionModal.open()}}};var LeaveDetailedReport={classname:{1:"PI_matlv1",2:"PI_btrip",3:"PI_optlv",4:"PI_prvlv",5:"PI_emglv1",6:"PI_caslv1",7:"PI_sicklv",8:"PI_voclv",9:"PI_patlv",10:"PI_tmtrip",11:"PI_compoff",12:"PI_compoff",13:"PI_caslv",14:"PI_erndlv",15:"PI_onduty"},html:function(){var leaves=LeaveForm.LAYOUT.data("report").leavetypes;if(!(leaves.length<=0)){$("#operation-leave-applications_report_view").remove();var isV1User=ZPeople.Module.MODULE_DATA.leavetracker?ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isV1User:Leave.Util.isV1User,reportHtml='<div class="zpl_mdl zpl_msm" data-modal-box="lvreport" id="operation-leave-applications_report_view"><div class="zpl_minr"><div class="zpl_mhder"><div><h4>'+ZPI18N.getString("zp.leave.operations.leavereport")+(isV1User?"":" ("+ZPI18N.getString("zp.leave.view.booked")+"/"+ZPI18N.getString("zp.leave.view.balance")+")")+'</h4></div><a class="_cls PI_cls" onclick="LeaveDetailedReport.hideModal();"></a></div><div class="zpl_mcnt"><div class="tab_strctr"><div class="zpl_hdcnt" style="margin: 0;"><ul class="zpl_tabpane"><li listid="" value="0" class="zpl_act"><a>'+ZPI18N.getString("zp.leavetype.days")+'</a></li><li listid="" value="1" class=""><a >'+ZPI18N.getString("zp.leavetype.hours")+'</a></li></ul></div></div><div class="zpl_tabcnt"></div></div><div class="zpl_mfoter"><button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="LeaveDetailedReport.hideModal();">'+ZPI18N.getString("zp.close")+"</button></div></div></div>",pageId=settingsPage.container;(LVUtil.Tab.isMySpace()||ZPFeeds.SINGLEPOP)&&(pageId=$("body").find("#modal_Container")),pageId.append($(reportHtml)),pageId.find("#operation-leave-applications_report_view").find(".zpl_mcnt").find("ul > li > a").off("click").on("click",function(){var val=$(this).parent("li").val();LeaveDetailedReport.switchUnit(0==val?"LR_Days":"LR_Hours",this)});var days=ZP.create("div",{class:"",id:"LR_Days"});days.appendChild(ZP.create("div",{class:"zpl_lvecrdlst"}));var hours=ZP.create("div",{class:"",id:"LR_Hours"});hours.appendChild(ZP.create("div",{class:"zpl_lvecrdlst"}));for(var total=leaves.length,dayCnt=0,hourCnt=0,indx=0;indx<total;indx++){var leave=leaves[indx],color_class="lvecstrip"+(leave.color?leave.color+"":"");if(2!=leave.type){var parent=ZP.create("div",{class:"zpl_dfcrd zpl_lvecrd "+color_class});if(parent.appendChild(ZP.create("div",{class:"zpl_tmlvestus"})),$(parent).find(".zpl_tmlvestus").append(ZP.create("b",{text:ZPeople.decodeTxt(leave.name)})),LeaveDetailedReport.consIconCont(leave,parent),leave.isdayleave){(avail=ZP.create("span",{text:ZPI18N.getString("zp.available")})).appendChild(ZP.create("b",{class:"grn",text:isV1User?leave.allowed:ZP.optValue(leave,"available","-")})),$(parent).find(".zpl_tmlvestus").append(avail),(booked=ZP.create("span",{text:ZPI18N.getString("zp.leave.view.booked")})).appendChild(ZP.create("b",{text:leave.taken})),$(parent).find(".zpl_tmlvestus").append(booked),$(days).find(".zpl_lvecrdlst").append(parent),dayCnt++}else{var avail,booked;if((avail=ZP.create("span",{text:ZPI18N.getString("zp.available")})).appendChild(ZP.create("b",{class:"grn",text:isV1User?leave.allowed:ZP.optValue(leave,"available","-")})),$(parent).find(".zpl_tmlvestus").append(avail),(booked=ZP.create("span",{text:ZPI18N.getString("zp.leave.view.booked")})).appendChild(ZP.create("b",{text:leave.taken})),$(parent).find(".zpl_tmlvestus").append(booked),4==leave.type&&leave.expired_count>0){var expired=ZP.create("small",{class:"dgry PL10",text:"("+ZPI18N.getString("zp.leave.report.expiredcount")+" -"+leave.expired_count+")"});$(parent).find(".zpl_tmlvestus").append(expired)}$(hours).find(".zpl_lvecrdlst").append(parent),hourCnt++}}else{var absentParent=ZP.create("div",{class:"zpl_dfcrd lit_bg1 zpl_lvecrd "+color_class});absentParent.appendChild(ZP.create("div",{class:"zpl_tmlvestus"})),$(absentParent).find(".zpl_tmlvestus").append(ZP.create("b",{text:ZPI18N.getString("zp.absent")})),LeaveDetailedReport.consIconCont(leave,absentParent),$(absentParent).find(".lvec").attr("style","margin-top:-3px");var abs=ZP.create("span",{text:ZPI18N.getString("zp.leave.view.yettoapply")});abs.appendChild(ZP.create("b",{class:"red",text:leave.taken})),$(absentParent).find(".zpl_tmlvestus").append(abs),$(days).find(".zpl_lvecrdlst").append(absentParent),dayCnt++}}0!==dayCnt&&0!==hourCnt||pageId.find(".zpl_hdcnt").remove(),pageId.find(".zpl_tabcnt").append(days),pageId.find(".zpl_tabcnt").append(hours);var dayHourSwitch=pageId.find("#operation-leave-applications_report_view").find(".zpl_mcnt").find("ul > li");dayCnt>0&&void 0!=dayHourSwitch[0]?$(dayHourSwitch[0]).find("a").trigger("click"):void 0!=dayHourSwitch[1]&&$(dayHourSwitch[1]).find("a").trigger("click"),pageId.find("#operation-leave-applications_report_view").addClass("zpl_mopen")}},consIconCont:function(leave,parent){var iconCont=ZP.create("span",{class:"lvec"});if(leave.icon)iconCont.appendChild(ZP.create("i",{class:LeaveDetailedReport.classname[leave.icon]}));else if(leave.code&&leave.code.trim().length>0)$(iconCont).text(leave.code.toUpperCase());else{for(var words=ZPeople.decodeTxt(leave.name).replace(/[!@#$%^&*(),.?":{}|<>]/g,"").split(" "),initials="",i=0;i<words.length;i++){if(2==(initials+=words[i].charAt(0).toUpperCase()).length)break}initials=0==initials.trim().length?"L":initials,$(iconCont).text(initials)}parent.appendChild(iconCont)},switchUnit:function(element,obj){var cont=settingsPage.container.find("#operation-leave-applications_report_view");(LVUtil.Tab.isMySpace()||ZPFeeds.SINGLEPOP)&&(cont=$("body").find("#modal_Container").find("#operation-leave-applications_report_view")),cont.find("#"+element).closest(".zpl_tabcnt").find(">div").addClass("DN"),cont.find("#"+element).removeClass("DN"),cont.find(obj).closest(".zpl_tabpane").find("li").removeClass("zpl_act"),cont.find(obj).parent("li").addClass("zpl_act")},hideModal:function(){$("#operation-leave-applications_report_view").hide()}},LeaveAdminOpers={};(LeaveAdminOpers={isV1User:!1,v1SettingsUrl:"leave_settings_actions.zp",v1ExportUrl:"leave_settings_export.zp",settingsUrl:"leave_v2_settings_actions.zp",exporturl:"leave_v2_settings_export.zp",viewUrl:"/leave_view_actions.zp",isModuleDataLoaded:!1,formDisplayName:"",ISFILTER_APPLIED:!1,initComponents:function(extraparams){LVUtil.Tab.isHolidayGallery()&&extraparams?Holidays.Gallery.load():LeaveAdminOpers.getLeaveModuleData()},getLeaveModuleData:function(){LVUtil.Tab.InitPage(),LeaveAdminOpers.formDisplayName=ZPeople.Module.MODULE_DATA.leavetracker.formDisplayName,LeaveAdminOpers.initPageComponents()},initApplications:()=>{LVUtil.Tab.InitPage(),LeaveAdminOpers.formDisplayName=ZPeople.Module.MODULE_DATA.leavetracker.formDisplayName},getPageDetails:function(){LeaveAdminOpers.ISFILTER_APPLIED=!1;var moduleData=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops,currentPage=settingsUrlProps.niceUrlArr[settingsUrlProps.niceUrlArr.length-1],params={seqList:[1,2],currentPage:currentPage},isFromMyTab=LVUtil.Tab.isMyPage(),isFromUserTab=LVUtil.Tab.isUserPage(),isFromOpersUserTab=LVUtil.Tab.isOpersUserPage(),allowImport=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.allowImport,allowExport=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.allowExport;return"applications"===currentPage?(params.parentClass="zpl_tblfxd",params.headeraction={attr:{status:"true"}},params.topright={},params.topleft={},moduleData.approval_configured&&(params.topright.status={attr:{name:"status",click:"",class:"select"}}),LVUtil.Tab.isTeamPage()&&!LVUtil.showAllDataForNonAdmin()?params.topright.togglebutton={status:!0,defVal:"6"}:params.topright.dataSelect={attr:{name:"dataSelect",click:"",class:"select"}},params.topright.button={text:ZPI18N.getString("zp.addrequests"),attr:{name:"addrequest","aria-label":ZPI18N.getString("zp.addrequests"),tabindex:"0",click:"",class:"addact_btn permbased",title:ZPI18N.getString("zp.addrequests"),style:"display:none;"}},params.topright.filter={attr:{click:"",class:"",tabindex:"0","aria-label":ZPI18N.getString("zp.filter"),title:ZPI18N.getString("zp.filter")}},params.filteropt={periodV2:{single:!0,label:ZPI18N.getString("zp.period"),load:"day,month,year",defaultVal:"366"},lvfrom:{type:"input",label:ZPI18N.getString("zp.from"),disabled:!0,date:!0,attributes:{parent:"periodV2",needremove:!1}},lvto:{type:"input",label:ZPI18N.getString("zp.to"),disabled:!0,date:!0,attributes:{parent:"periodV2",needremove:!1}},typeofleave:{single:!0,defaultVal:-1,label:ZPI18N.getString("zp.type")},leavetype:{single:!1,label:ZPI18N.getString("zp.leavetype")}},isFromMyTab||isFromUserTab||isFromOpersUserTab||(params.filteropt.employee={single:!1,searchmode:"DATAVIEW",label:ZPI18N.getString("zp.employee")},params.filteropt.incDReportsOnly={type:"checkbox",label:ZPI18N.getString("zp.showdirectreportees"),attributes:{defval:"false"},title:ZPI18N.getString("zp.showdirectreportees")},isOrgStructureEnabled&&(params.filteropt.entity={},params.filteropt.businessUnit={},params.filteropt.division={},params.filteropt.entity={single:!1,label:ZPeople.orgStructureDispNameMap.hasOwnProperty("entity")?ZPeople.orgStructureDispNameMap.entity:ZPI18N.getString("zp.legalentityname")},params.filteropt.businessUnit={single:!1,label:ZPeople.orgStructureDispNameMap.hasOwnProperty("unit")?ZPeople.orgStructureDispNameMap.unit:ZPI18N.getString("zp.addbusinessunit")},params.filteropt.division={single:!1,label:ZPeople.orgStructureDispNameMap.hasOwnProperty("division")?ZPeople.orgStructureDispNameMap.division:ZPI18N.getString("zp.divisionname")}),params.filteropt.department={single:!1,label:ZPI18N.getString("zp.department")},params.filteropt.designation={single:!1,label:ZPI18N.getString("zp.designation"),isAll:!1},params.filteropt.location={single:!1,label:ZPI18N.getString("zp.location")},Leave.organizationTag.isEnabled()&&(params.filteropt.orgTag={},params.filteropt.orgTag={single:!1,label:ZPeople.orgTagDisplayName}),params.filteropt.employeeStatus={single:!0,label:ZPI18N.getString("zp.useremployeeprofile"),defaultVal:"3"}),(allowImport||allowExport)&&(params.topright.more={attr:{click:"",id:"moreoptionmenuBtn_applications",class:"",title:ZPI18N.getString("zp.more"),"aria-label":ZPI18N.getString("zp.more"),tabindex:"0"},options:[]},allowImport&&params.topright.more.options.push({id:"import",iClass:"PI_imprt",name:ZPI18N.getString("zp.import"),callback:"LeaveApplications.Import.construct()"}),allowExport&&params.topright.more.options.push({id:"export",iClass:"PI_exprt",name:ZPI18N.getString("zp.export"),callback:"LeaveAdminOpers.Util.showExport(this)"})),params.pageNaviFooter={status:"true"}):"compensatory"===currentPage?(params.parentClass="zpl_tblfxd",params.headeraction={attr:{status:"true"}},params.topright={},params.topleft={},moduleData.compApprovalEnabled&&(params.topright.status={attr:{name:"status",click:"",class:"select"}}),LVUtil.Tab.isTeamPage()?params.topright.togglebutton={status:!0,defVal:"6"}:params.topright.dataSelect={attr:{name:"dataSelect",click:"",class:"select"}},moduleData.isCompOffManualAddAllowed&&(params.topright.button={text:ZPI18N.getString("zp.addrequests"),attr:{name:"addrequest","aria-label":ZPI18N.getString("zp.addrequests"),tabindex:"0",click:"",class:"addact_btn",title:ZPI18N.getString("zp.addrequests")}}),params.topright.filter={attr:{click:"",class:"",tabindex:"0","aria-label":ZPI18N.getString("zp.filter"),title:ZPI18N.getString("zp.filter")}},params.filteropt={periodV2:{single:!0,label:ZPI18N.getString("zp.period"),load:"day,month,year",defaultVal:"366"},from:{type:"input",label:ZPI18N.getString("zp.from"),disabled:!0,date:!0,attributes:{parent:"periodV2",needremove:!1}},to:{type:"input",label:ZPI18N.getString("zp.to"),disabled:!0,date:!0,attributes:{parent:"periodV2",needremove:!1}}},isFromMyTab||isFromUserTab||isFromOpersUserTab||(params.filteropt.employee={single:!1,searchmode:"DATAVIEW",label:ZPI18N.getString("zp.employee")},isOrgStructureEnabled&&(params.filteropt.entity={},params.filteropt.businessUnit={},params.filteropt.division={},params.filteropt.entity={single:!1,label:ZPeople.orgStructureDispNameMap.hasOwnProperty("entity")?ZPeople.orgStructureDispNameMap.entity:ZPI18N.getString("zp.legalentityname")},params.filteropt.businessUnit={single:!1,label:ZPeople.orgStructureDispNameMap.hasOwnProperty("unit")?ZPeople.orgStructureDispNameMap.unit:ZPI18N.getString("zp.addbusinessunit")},params.filteropt.division={single:!1,label:ZPeople.orgStructureDispNameMap.hasOwnProperty("division")?ZPeople.orgStructureDispNameMap.division:ZPI18N.getString("zp.divisionname")}),params.filteropt.department={single:!1,label:ZPI18N.getString("zp.department")},params.filteropt.location={single:!1,label:ZPI18N.getString("zp.location")},Leave.organizationTag.isEnabled()&&(params.filteropt.orgTag={},params.filteropt.orgTag={single:!1,label:ZPeople.orgTagDisplayName}),params.filteropt.bookingstatus={single:!0,label:ZPI18N.getString("zp.status")},params.filteropt.employeeStatus={single:!1,label:ZPI18N.getString("zp.useremployeeprofile"),defaultVal:["19","-2","18"]}),(allowImport||allowExport)&&(params.topright.more={attr:{click:"",id:"moreoptionmenuBtn_compensatory",class:"",title:ZPI18N.getString("zp.more"),"aria-label":ZPI18N.getString("zp.more"),tabindex:"0"},options:[]},allowImport&&params.topright.more.options.push({id:"import",iClass:"PI_imprt",name:ZPI18N.getString("zp.import"),callback:"LeaveCompensatory.Import.construct()"}),allowExport&&params.topright.more.options.push({id:"export",iClass:"PI_exprt",name:ZPI18N.getString("zp.export"),callback:"LeaveAdminOpers.Util.showExport(this)"})),moduleData.issettingsadmin&&(params.topright.more=void 0==params.topright.more?{attr:{click:"",id:"moreoptionmenuBtn_compensatory",class:"",title:ZPI18N.getString("zp.more")},options:[]}:params.topright.more,params.topright.more.options.push({id:"settings",iClass:"PI_setting",name:ZPI18N.getString("zp.settings"),callback:"LeaveCompensatory.Settings.loadPage()"})),params.pageNaviFooter={status:"true"}):"grant"===currentPage?(params.parentClass="zpl_tblfxd",params.headeraction={attr:{status:"true"}},params.topright={},params.topleft={},void 0!=moduleData.grantApprovalEnabled&&moduleData.grantApprovalEnabled&&(params.topright.status={attr:{name:"status",click:"",class:"select"}}),LVUtil.Tab.isTeamPage()?params.topright.togglebutton={status:!0,defVal:"6"}:params.topright.dataSelect={attr:{name:"dataSelect",click:"",class:"select"}},params.topright.button={text:ZPI18N.getString("zp.addrequests"),attr:{name:"addrequest",tabindex:"0","aria-label":ZPI18N.getString("zp.addrequests"),click:"",class:"addact_btn",title:ZPI18N.getString("zp.addrequests")}},params.topright.filter={attr:{click:"",tabindex:"0","aria-label":ZPI18N.getString("zp.filter"),class:"",title:ZPI18N.getString("zp.filter")}},params.filteropt={periodV2:{single:!0,label:ZPI18N.getString("zp.period"),load:"day,month,year",defaultVal:"366"},from:{type:"input",label:ZPI18N.getString("zp.from"),disabled:!0,date:!0,attributes:{parent:"periodV2",needremove:!1}},to:{type:"input",label:ZPI18N.getString("zp.to"),disabled:!0,date:!0,attributes:{parent:"periodV2",needremove:!1}},leavetype:{single:!1,label:ZPI18N.getString("zp.leavetype")}},isFromMyTab||isFromUserTab||isFromOpersUserTab||(params.filteropt.employee={single:!1,searchmode:"DATAVIEW",label:ZPI18N.getString("zp.employee")},isOrgStructureEnabled&&(params.filteropt.entity={},params.filteropt.businessUnit={},params.filteropt.division={},params.filteropt.entity={single:!1,label:ZPeople.orgStructureDispNameMap.hasOwnProperty("entity")?ZPeople.orgStructureDispNameMap.entity:ZPI18N.getString("zp.legalentityname")},params.filteropt.businessUnit={single:!1,label:ZPeople.orgStructureDispNameMap.hasOwnProperty("unit")?ZPeople.orgStructureDispNameMap.unit:ZPI18N.getString("zp.addbusinessunit")},params.filteropt.division={single:!1,label:ZPeople.orgStructureDispNameMap.hasOwnProperty("division")?ZPeople.orgStructureDispNameMap.division:ZPI18N.getString("zp.divisionname")}),params.filteropt.department={single:!1,label:ZPI18N.getString("zp.department")},params.filteropt.location={single:!1,label:ZPI18N.getString("zp.location")},Leave.organizationTag.isEnabled()&&(params.filteropt.orgTag={},params.filteropt.orgTag={single:!1,label:ZPeople.orgTagDisplayName})),allowExport&&(params.topright.more={attr:{click:"",id:"moreoptionmenuBtn_grant",class:"",title:ZPI18N.getString("zp.more"),tabindex:"0","aria-label":ZPI18N.getString("zp.more")},options:[{id:"export",iClass:"PI_exprt",name:ZPI18N.getString("zp.export"),callback:"LeaveAdminOpers.Util.showExport(this)"}]}),params.pageNaviFooter={status:"true"}):"customizebalance"===currentPage?(params.parentClass="zpl_tblfxd",params.topright={},params.topleft={},params.topright.button={text:ZPI18N.getString("zp.customize"),attr:{name:"addcustomize",click:"",class:"addact_btn",title:ZPI18N.getString("zp.customize")}},params.topright.filter={attr:{click:"",class:"",title:ZPI18N.getString("zp.filter")}},params.filteropt={cur_date:{type:"input",label:ZPI18N.getString("zp.leave.balanceason",[""]),date:!0},typeofleave:{single:!0,label:ZPI18N.getString("zp.type")},leavetype:{single:!1,label:ZPI18N.getString("zp.leavetype")},employee:{single:!1,searchmode:"DATAVIEW",label:ZPI18N.getString("zp.employee")},incDReportsOnly:{type:"checkbox",label:ZPI18N.getString("zp.showdirectreportees"),attributes:{defval:"false"},title:ZPI18N.getString("zp.showdirectreportees")}},isOrgStructureEnabled&&(params.filteropt.entity={},params.filteropt.businessUnit={},params.filteropt.division={},params.filteropt.entity={single:!1,label:ZPeople.orgStructureDispNameMap.hasOwnProperty("entity")?ZPeople.orgStructureDispNameMap.entity:ZPI18N.getString("zp.legalentityname")},params.filteropt.businessUnit={single:!1,label:ZPeople.orgStructureDispNameMap.hasOwnProperty("unit")?ZPeople.orgStructureDispNameMap.unit:ZPI18N.getString("zp.addbusinessunit")},params.filteropt.division={single:!1,label:ZPeople.orgStructureDispNameMap.hasOwnProperty("division")?ZPeople.orgStructureDispNameMap.division:ZPI18N.getString("zp.divisionname")}),params.filteropt.department={single:!1,label:ZPI18N.getString("zp.department")},params.filteropt.designation={single:!1,label:ZPI18N.getString("zp.designation"),isAll:!1},params.filteropt.location={single:!1,label:ZPI18N.getString("zp.location")},params.filteropt.employeeStatus={single:!1,label:ZPI18N.getString("zp.useremployeeprofile"),defaultVal:["19","-2","18"]},params.filteropt.incDateOfExit={type:"checkbox",checked:!0,label:ZPI18N.getString("zp.exitdatewithinrepdate"),attributes:{defval:"true"}},params.topright.more={attr:{click:"",id:"moreoptionmenuBtn_customizebalance",class:"",title:ZPI18N.getString("zp.more")},options:[{id:"import",iClass:"PI_imprt",name:ZPI18N.getString("zp.import"),callback:"LeavePolicy.Transaction.Import.construct()"},{id:"export",iClass:"PI_exprt",name:ZPI18N.getString("zp.export"),callback:"LeaveAdminOpers.Util.showExport(this)"},{id:"exportPDF",iClass:"PI_imprt",name:ZPI18N.getString("zp.downloadpdf"),callback:"LeavePolicy.Transaction.ExportPDF.construct()"},{id:"print",iClass:"PI_print",name:ZPI18N.getString("zp.print"),callback:"LeavePolicy.Transaction.Print()"}]}):"userspecificpolicy"===currentPage?LVUtil.Tab.isOpersUserPage()?(params.parentClass="zpl_tblfxd",params.topright={},params.topleft={},params.topright.filter={attr:{click:"",class:"",title:ZPI18N.getString("zp.filter")}},params.filteropt={isActive:{single:!0,label:ZPI18N.getString("zp.status"),defaultVal:"1"}}):(params.parentClass="zpl_tblfxd zpl_act",params.topright={},params.topleft={},params.topright.button={text:ZPI18N.getString("zp.leave.customizepolicy"),attr:{name:"addcustomize",click:"",class:"addact_btn",title:ZPI18N.getString("zp.customize")}}):"initialbalance"===currentPage?(params.parentClass="zpl_tblfxd",params.topright={},params.topleft={},params.topright.button={text:ZPI18N.getString("zp.add"),attr:{name:"add",click:"",class:"addact_btn",title:ZPI18N.getString("zp.add")}},params.topright.rolloverbutton={text:ZPI18N.getString("zp.leave.rollover.generate"),attr:{name:"rollover",click:"",class:"",title:ZPI18N.getString("zp.leave.rollover.generate")}},params.topright.filter={attr:{click:"",class:"",title:ZPI18N.getString("zp.filter")}},params.filteropt={leavetype:{single:!1,label:ZPI18N.getString("zp.leavetype")},employee:{single:!1,searchmode:"DATAVIEW",label:ZPI18N.getString("zp.employee")}},isOrgStructureEnabled&&(params.filteropt.entity={},params.filteropt.businessUnit={},params.filteropt.division={},params.filteropt.entity={single:!1,label:ZPeople.orgStructureDispNameMap.hasOwnProperty("entity")?ZPeople.orgStructureDispNameMap.entity:ZPI18N.getString("zp.legalentityname")},params.filteropt.businessUnit={single:!1,label:ZPeople.orgStructureDispNameMap.hasOwnProperty("unit")?ZPeople.orgStructureDispNameMap.unit:ZPI18N.getString("zp.addbusinessunit")},params.filteropt.division={single:!1,label:ZPeople.orgStructureDispNameMap.hasOwnProperty("division")?ZPeople.orgStructureDispNameMap.division:ZPI18N.getString("zp.divisionname")}),params.filteropt.department={single:!1,label:ZPI18N.getString("zp.department")},params.filteropt.location={single:!1,label:ZPI18N.getString("zp.location")},params.filteropt.employeeStatus={single:!1,label:ZPI18N.getString("zp.useremployeeprofile"),defaultVal:["19","-2","18"]},params.filteropt.incDateOfExit={type:"checkbox",checked:!0,label:ZPI18N.getString("zp.exitdatewithinrepdate"),attributes:{defval:"true"}},params.topright.more={attr:{click:"",id:"moreoptionmenuBtn_initialbalance",class:"",title:ZPI18N.getString("zp.more")},options:[{id:"import",iClass:"PI_imprt",name:ZPI18N.getString("zp.import"),callback:"LeaveIB.Import.construct()"},{id:"export",iClass:"PI_exprt",name:ZPI18N.getString("zp.export"),callback:"LeaveAdminOpers.Util.showExport(this)"},{id:"exportPDF",iClass:"PI_imprt",name:ZPI18N.getString("zp.downloadpdf"),callback:"LeaveIB.ExportPDF.construct()"}]}):"holiday"===currentPage?(params.parentClass="zpl_tblfxd",params.topright={},params.topleft={},params.center={},!ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.isChinaDC&&moduleData.CalendarSync_Data.gcal_old_integration_exist&&(params.topright.pushgcal={text:ZPI18N.getString("zp.gcalsync.syncwithgooglecalendar"),attr:{name:"pushgcal",click:"",class:"",title:ZPI18N.getString("zp.gcalsync.syncwithgooglecalendar")}}),params.topright.viewswitcher=[{label:ZPI18N.getString("zp.listview"),onclick:"Holidays.View.switchView();",className:"PI_listview zpl_act"},{label:ZPI18N.getString("zp.calendarview"),onclick:"Holidays.View.switchView(true);",className:"PI_monthly"}],params.topright.applFor={attr:{name:"applFor",click:"",class:"select"}},moduleData.isadmin&&(params.topright.splitbutton={text:ZPI18N.getString("zp.addcomponents",[ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name]),attr:{name:"addholidays",click:"",title:ZPI18N.getString("zp.addcomponents",[ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name])}}),params.topright.filter={attr:{click:"",class:"",title:ZPI18N.getString("zp.filter")}},params.filteropt={periodV2:{single:!0,label:ZPI18N.getString("zp.period"),load:"month,year",defaultVal:"366"},from:{type:"input",label:ZPI18N.getString("zp.from"),date:!0,attributes:{parent:"periodV2",needremove:!1}},to:{type:"input",label:ZPI18N.getString("zp.to"),date:!0,attributes:{parent:"periodV2",needremove:!1}},holidayClassification:{single:!1,label:Holidays.optDisplayNameInSingularForm()+" "+ZPI18N.getString("zp.classification")}},params.topright.more={attr:{click:"",id:"moreoptionmenuBtn_holiday","aria-label":ZPI18N.getString("zp.more"),tabindex:"0",class:"",title:ZPI18N.getString("zp.more")},options:[]},moduleData.isadmin&&params.topright.more.options.push({id:"import",iClass:"PI_imprt",name:ZPI18N.getString("zp.import"),callback:"Holidays.Import.construct()"},{id:"importIcs",iClass:"PI_imprt",name:ZPI18N.getString("zp.importics"),callback:"Holidays.ImportICS.construct()"}),params.topright.more.options.push({id:"export",iClass:"PI_exprt",name:ZPI18N.getString("zp.export"),callback:"LeaveAdminOpers.Util.showExport(this)"}),moduleData.isadmin&&params.topright.more.options.push({id:"cuzTemplate",iClass:"PI_setting",name:ZPI18N.getString("zp.holiday.customizereminder"),callback:"Holidays.Settings.loadPage()"}),params.center={navi:"true"}):"workingday"===currentPage&&(params.parentClass="zpl_tblfxd",params.topright={},params.topleft={},params.topright.button={text:ZPI18N.getString("zp.add"),attr:{name:"addExpWD",click:"",class:"addact_btn",title:ZPI18N.getString("zp.add")}},params.topright.filter={attr:{click:"",class:"",title:ZPI18N.getString("zp.filter")}},params.filteropt={periodV2:{single:!0,label:ZPI18N.getString("zp.period"),load:"month,year",defaultVal:"366"},from:{type:"input",label:ZPI18N.getString("zp.from"),disabled:!0,date:!0,attributes:{parent:"periodV2",needremove:!1}},to:{type:"input",label:ZPI18N.getString("zp.to"),disabled:!0,date:!0,attributes:{parent:"periodV2",needremove:!1}},applFor:{single:!0,label:ZPI18N.getString("zp.applicablefor",[""]),defaultVal:0}}),params},initPageComponents:function(){settingsPage.container.data("isreg")&&!LeaveAdminOpers.Router.isApplications()&&(LVUtil.Tab.isCompOff()||LVUtil.Tab.isGrant())&&settingsPage.container.parents().find("#page-wrapper").addClass("zpl_btmpgn");var pageId=settingsUrlProps.niceUrlArr[settingsUrlProps.niceUrlArr.length-1];if(-1!=Layout.Page.hash.indexOf("leavetracker/compensatory/view")?pageId="compensatory":-1!=Layout.Page.hash.indexOf("leavetracker/grant/view")&&(pageId="grant"),-1!=Layout.Page.hash.indexOf("/applications"))settingsPage.container.parent().parent().attr({"aria-label":ZPI18N.getString("zp.common.tabname",[ZPI18N.getString("zp.leave.others.header")]),tabindex:"0"});else{var tabName=pageId;"grant"==pageId&&(tabName=ZPI18N.getString("zp.leave.grant.camelcase")),settingsPage.container.parent().parent().attr({"aria-label":ZPI18N.getString("zp.common.tabname",[tabName]),tabindex:"0"})}if(LeaveAdminOpers.Router.isRecord()||LeaveAdminOpers.Router.isRecordAdd())if(LeaveAdminOpers.Router.isApplications()){var leaveForm=new LeaveForm;LeaveAdminOpers.Router.isRecordAdd()?leaveForm.add():LeaveAdminOpers.Router.isRecordView()?leaveForm.view(Layout.Page.urlparam.recordId):LeaveAdminOpers.Router.isRecordEdit()&&leaveForm.edit(Layout.Page.urlparam.recordId)}else if(LeaveAdminOpers.Router.isCompensatory()){if(LeaveAdminOpers.Router.isBookCompOff())(leaveForm=new LeaveForm).bookCompoff(Layout.Page.urlparam.recordId);else-1!=Layout.Page.hash.indexOf("leavetracker/compensatory/view")?LeaveCompensatory.RecordView.get(Layout.Page.urlparam.recordId?Layout.Page.urlparam.recordId:Layout.Page.childUrlParam.recordId):-1!=Layout.Page.hash.indexOf("leavetracker/compensatory/edit")&&LeaveCompensatory.Edit.get(Layout.Page.urlparam.recordId?Layout.Page.urlparam.recordId:Layout.Page.childUrlParam.recordId)}else LeaveAdminOpers.Router.isGrant()&&(-1!=Layout.Page.hash.indexOf("leavetracker/grant/view")?LeaveGrant.RecordView.get(Layout.Page.urlparam.recordId?Layout.Page.urlparam.recordId:Layout.Page.childUrlParam.recordId):-1!=Layout.Page.hash.indexOf("leavetracker/grant/edit")&&LeaveGrant.Edit.get(Layout.Page.urlparam.recordId?Layout.Page.urlparam.recordId:Layout.Page.childUrlParam.recordId));else{LeaveAdminOpers.Router.isApplications()||settingsPage.container.html("");var params=LeaveAdminOpers.getPageDetails();if(params.parentClass&&settingsPage.container.addClass(params.parentClass),$.each(params.seqList,function(key,seq){"1"==seq?LeaveAdminOpers.Router.isApplications()?settingsPage.container.find("#viewActionsContainer").append(LeaveAdminOpers.constructSystemViewTopDiv(params)):settingsPage.container.append(LeaveAdminOpers.constructTopDiv(params)):"2"==seq?!LeaveAdminOpers.Router.isApplications()&&settingsPage.container.append(LeaveAdminOpers.constructListDiv(params)):"3"==seq?settingsPage.container.append(LeaveAdminOpers.constructBoxDiv(params)):"4"==seq&&settingsPage.container.append(LeaveAdminOpers.constructRgtDiv(params))}),0==settingsPage.container.find("#zp_brdcrum_filterview").length&&settingsPage.container.find(".zpl_btnmnu").after('<div class="zpl_fltrvw" id="zp_brdcrum_filterview" style="display:none;"></div>'),settingsPage.container.find(".zpl_rgt[systemviewonly],.zpl_rgt").find(".PI_fltr").off("click").on("click",function(){LeaveAdminOpers.toggleFilter()}),params.top&&params.top.header&&LeaveAdminOpers.constructContHeader(params),settingsPage.container.find(".zpl_rgt:not(.DNI)").length>0){if(params.topright&&params.topright.viewswitcher&&settingsPage.container.find(".zpl_rgt").prepend(LeaveAdminOpers.constructViewSwitcher(params.topright.viewswitcher)),params.topright&&params.topright.applFor&&(optArray=LeaveAdminOpers.getOptionsForFilter("applFor",ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops,params),settingsPage.container.find("[name=applFor]").attr("defval",1),LeaveAdminOpers.ZPeopleComponents.Select.init({container:settingsPage.container.find("[name=applFor]"),optArray:optArray,defVal:1,groupBy:!0,ddHeight:"500px"})),params.topright&&params.topright.dataSelect)if(LVUtil.Tab.isUserPage()||LVUtil.Tab.isMyPage()||LVUtil.Tab.isOpersUserPage())settingsPage.container.find(".zpl_rgt:not(.DNI)").find("[name=dataSelect]").remove();else{var optArray=LeaveAdminOpers.getOptionsForFilter("dataSelect",ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops,params);ZPeopleComponents.select(settingsPage.container.find(".zpl_rgt:not(.DNI)").find("[name=dataSelect]")).removeAllOptions(),LeaveAdminOpers.ZPeopleComponents.Select.init({container:settingsPage.container.find(".zpl_rgt:not(.DNI)").find("[name=dataSelect]"),defVal:optArray.length>0?optArray[0].value:"",optArray:optArray})}if(params.topright&&params.topright.status){optArray=LeaveAdminOpers.getOptionsForFilter("status",ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops,params);ZPeopleComponents.select(settingsPage.container.find(".zpl_rgt:not(.DNI)").find("[name=status]")).removeAllOptions(),LeaveAdminOpers.ZPeopleComponents.Select.init({container:settingsPage.container.find(".zpl_rgt:not(.DNI)").find("[name=status]"),defVal:optArray.length>0?optArray[0].value:"",optArray:optArray})}if(params.topright&&params.topright.togglebutton){optArray=LeaveAdminOpers.getOptionsForFilter("toggleDataSelect",ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops,params);LeaveAdminOpers.constructToggleDataSelect(optArray,params.topright.togglebutton.defVal)}}if(params.topright&&params.topright.more&&settingsPage.container.find(".PI_more").off("click").on("click",function(){LeaveAdminOpers.constructMoreOption(params.topright),ZPeopleComponents.menu("#moreoptionmenu_"+pageId).show()}),params.pageNaviFooter&&params.pageNaviFooter.status&&(void 0==$("#systemview_pagination",settingsPage.container)||!$("#systemview_pagination",settingsPage.container).data("isreg"))){0==settingsPage.container.find("#systemview_pagination").length&&settingsPage.container.append(LeaveAdminOpers.constructPageFooter(params));optArray=[{label:"20",value:"20"},{label:"30",value:"30"},{label:"40",value:"40"},{label:"50",value:"50"},{label:"75",value:"75"},{label:"100",value:"100"},{label:"200",value:"200"}];ZPeopleComponents.select(settingsPage.container.find(".zpl_tblpagination#systemview_pagination").find(".zpl_rhtpgn").find("select")).removeAllOptions(),LeaveAdminOpers.ZPeopleComponents.Select.init({container:settingsPage.container.find(".zpl_tblpagination#systemview_pagination").find(".zpl_rhtpgn").find("select"),optArray:optArray}),ZPeopleComponents.select(settingsPage.container.find(".zpl_tblpagination#systemview_pagination").find(".zpl_rhtpgn").find("select")).setValue(optArray[0].value),LeaveAdminOpers.Util.Footer.regFooter()}LeaveAdminOpers.constructTableHeader(),LeaveAdminOpers.constructFilter(params),LeaveAdminOpers.getData(),TimelyZComp.toolTip.intiliaze()}},getData:function(){LVUtil.Tab.isApplications()?(settingsPage.container.parents().find("#page-wrapper").addClass("zpl_btmpgn"),LeaveApplications.regEvents()):LVUtil.Tab.isCompOff()?(settingsPage.container.parents().find("#page-wrapper").addClass("zpl_btmpgn"),LeaveCompensatory.regEvents(),LeaveCompensatory.View.get()):LVUtil.Tab.isGrant()?(settingsPage.container.parents().find("#page-wrapper").addClass("zpl_btmpgn"),LeaveGrant.regEvents(),LeaveGrant.View.list()):LVUtil.Tab.isCZBalance()?(LeavePolicy.CZBalance.regEvents(),LeavePolicy.CZBalance.get()):LVUtil.Tab.isCZPolicy()?(UserSpecificPolicy.regEvents(),UserSpecificPolicy.get()):LVUtil.Tab.isInitialBalance()?(LeaveIB.regEvents(),LeaveIB.get()):LVUtil.Tab.isHolidayGallery()?Holidays.Gallery.html():LVUtil.Tab.isHoliday()?(Holidays.regEvents(),Holidays.appendMoreOptionMenu(),Holidays.View.get()):LVUtil.Tab.isExpWorkingDay()&&(ExpWorkingDay.regEvents(),ExpWorkingDay.View.list())},constructFilter:function(params){if(!(settingsPage.container.find("#lvfilter").length>0)){var fHtml='<div class="zpl_fltr DNI" id="lvfilter">';fHtml+='<div> <div class="zpl_fltrhd"> <h5>'+ZPI18N.getString("zp.filter")+'</h5> <i class="PI_cls" onclick="LeaveAdminOpers.toggleFilter()"></i> </div>',fHtml+="</div>",fHtml+='<div class="zpl_fltrcnt" style="position: relative;"> <div> ',fHtml+='<div class="zpl_fltclps fltopn"> <div class="zpl_fltrlst">',params.filteropt&&$.each(params.filteropt,function(key,value){fHtml+='<div class="zpl_secn">',"checkbox"!==value.type&&(fHtml+="<div> <label>"+value.label+"</label> </div>");let attr="";value.attributes&&Object.keys(value.attributes).length>0&&$.each(value.attributes,function(atkey,atval){attr+=" "+atkey+"="+atval+" "}),void 0==value.type?"employee"==key?fHtml+='<div> <input class="token" name="'+key+'"'+(value.single?" ":"multiple=true")+' searchmode="'+(value.searchmode?value.searchmode:"")+'" '+attr+'></input><span class="ztextbox--error__label DNI"></span> </div>':value.single?fHtml+='<div> <select class="select-js '+(value.className?value.className:"")+'" name="'+key+'"'+(value.single?" ":"multiple")+" "+(value.load?"load="+value.load:"")+" "+attr+'></select><span class="ztextbox--error__label DNI"></span> </div>':fHtml+='<div> <input class="token" multiple="true" filterId="'+key+'"'+(value.name?'name="'+value.name+'"':'name="'+key+'"')+" "+attr+'/><span class="ztextbox--error__label DNI"></span></div>':"input"==value.type&&value.date?fHtml+="<div> <input name="+key+' class="datepicker'+(value.className?" "+value.className:"")+'" datefmt='+dateFmt+" "+(value.disabled?"disabled":"")+" "+attr+"></div>":"checkbox"==value.type&&(fHtml+='<div class="zcheckbox zcheckbox--horizontal"><input type="checkbox" name="'+key+'" '+(value.checked?"checked":"")+' value="" class="zcheckbox__helper"  '+attr+'><label class="zcheckbox__label" class="tooltip-js" data-title-position="top" '+(value.title?' title="'+value.title+'"':"")+"  "+attr+">"+value.label+"</label></div>"),fHtml+=" </div>"}),fHtml+="</div> </div> ",fHtml+="</div> </div> ",fHtml+="<div>",fHtml+='<button name="applyFilter" type="button" class="zlabel zlabel--blue zlabel--medium" onclick="LeaveAdminOpers.applyFilter();">'+ZPI18N.getString("zp.apply")+"</button>",fHtml+='<button name="resetFilter"  type="button" class="zlabel zlabel--outline zlabel--medium" onclick="LeaveAdminOpers.resetFilter();">'+ZPI18N.getString("zp.reset")+"</button>",fHtml+="</div></div>",settingsPage.container.append(fHtml),LeaveAdminOpers.setDefFilVal(params)}},setDefFilVal:function(params){params=params||LeaveAdminOpers.getPageDetails();var cont=settingsPage.container.find("#lvfilter"),filterOpts=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops,optArray=[];(LVUtil.Tab.isCZBalance()&&(LVSettings.Util.createDatePicker(cont),cont.find("[name=cur_date]").attr("defval",ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date),ZPeopleComponents.datefield(cont.find("[name=cur_date]")).setValue(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date,uidateFormat)),cont.find("[name=typeofleave]").length>0&&(optArray=LeaveAdminOpers.getOptionsForFilter("typeofleave",filterOpts,params),cont.find("[name=typeofleave]").attr("defval","-1"),LeaveAdminOpers.ZPeopleComponents.Select.init({container:cont.find("[name=typeofleave]"),optArray:optArray,defVal:"-1",isFieldHideForNodata:!0})),cont.find("[name=leavetype]").length>0&&(optArray=LeaveAdminOpers.getOptionsForFilter("leavetype",filterOpts,params),LeaveAdminOpers.ZPeopleComponents.TokenField.init({container:cont.find("[name=leavetype]"),optArray:optArray,placeholder:ZPI18N.getString("zp.allleavetypes"),isFieldHideForNodata:!0})),isOrgStructureEnabled&&(cont.find("[name=entity]").length>0&&(optArray=LeaveAdminOpers.getOptionsForFilter("entity",filterOpts,params),LeaveAdminOpers.ZPeopleComponents.TokenField.init({container:cont.find("[name=entity]"),optArray:optArray,placeholder:ZPI18N.getString("zp.all"),isFieldHideForNodata:!0})),cont.find("[name=businessUnit]").length>0&&(optArray=LeaveAdminOpers.getOptionsForFilter("businessUnit",filterOpts,params),LeaveAdminOpers.ZPeopleComponents.TokenField.init({container:cont.find("[name=businessUnit]"),optArray:optArray,placeholder:ZPI18N.getString("zp.all"),isFieldHideForNodata:!0})),cont.find("[name=division]").length>0&&(optArray=LeaveAdminOpers.getOptionsForFilter("division",filterOpts,params),LeaveAdminOpers.ZPeopleComponents.TokenField.init({container:cont.find("[name=division]"),optArray:optArray,placeholder:ZPI18N.getString("zp.all"),isFieldHideForNodata:!0}))),Leave.organizationTag.isEnabled()&&cont.find("[name=orgTag]").length>0&&(optArray=LeaveAdminOpers.getOptionsForFilter("orgTag",filterOpts,params),LeaveAdminOpers.ZPeopleComponents.TokenField.init({container:cont.find("[name=orgTag]"),optArray:optArray,placeholder:ZPI18N.getString("zp.all"),isFieldHideForNodata:!0})),cont.find("[name=department]").length>0)&&(optArray=LVUtil.urls.OnLeave.isHome()?LeaveAdminOpers.getOptionsForFilter("teamAllowedDept",filterOpts,params):LeaveAdminOpers.getOptionsForFilter("department",filterOpts,params),"select-one"!=cont.find("[name=department]").prop("type")?LeaveAdminOpers.ZPeopleComponents.TokenField.init({container:cont.find("[name=department]"),optArray:optArray,placeholder:ZPI18N.getString("zp.selDepartment")+""}):LeaveAdminOpers.ZPeopleComponents.Select.init({container:cont.find("[name=department]"),optArray:optArray,isFieldHideForNodata:!0}));(cont.find("[name=designation]").length>0&&(optArray=LeaveAdminOpers.getOptionsForFilter("designation",filterOpts,params),LeaveAdminOpers.ZPeopleComponents.TokenField.init({container:cont.find("[name=designation]"),optArray:optArray,placeholder:ZPI18N.getString("zp.alldesignation")+"",isFieldHideForNodata:!0})),cont.find("[name=location]").length>0)&&(optArray=LeaveAdminOpers.getOptionsForFilter("location",filterOpts,params),"select-one"!=cont.find("[name=location]").prop("type")?LeaveAdminOpers.ZPeopleComponents.TokenField.init({container:cont.find("[name=location]"),optArray:optArray,placeholder:LVUtil.Tab.isHoliday()||LVUtil.Tab.isExpWorkingDay()?"":ZPI18N.getString("zp.alllocaction")+"",isFieldHideForNodata:!0}):LeaveAdminOpers.ZPeopleComponents.Select.init({container:cont.find("[name=location]"),optArray:optArray,isFieldHideForNodata:!0}));cont.find("[name=shift]").length>0&&(optArray=LeaveAdminOpers.getOptionsForFilter("shift",filterOpts,params),"select-one"!=cont.find("[name=shift]").prop("type")?LeaveAdminOpers.ZPeopleComponents.TokenField.init({container:cont.find("[name=shift]"),optArray:optArray,placeholder:LVUtil.Tab.isHoliday()||LVUtil.Tab.isExpWorkingDay()?"":ZPI18N.getString("zp.allshift")+"",isFieldHideForNodata:!0}):LeaveAdminOpers.ZPeopleComponents.Select.init({container:cont.find("[name=shift]"),optArray:optArray,isFieldHideForNodata:!0}));if(cont.find("[name=bookingstatus]").length>0&&(optArray=LeaveAdminOpers.getOptionsForFilter("bookingstatus",filterOpts,params),cont.find("[name=bookingstatus]").attr("defval","-1"),LeaveAdminOpers.ZPeopleComponents.Select.init({container:cont.find("[name=bookingstatus]"),optArray:optArray,defVal:"-1"})),cont.find('[name="periodV2"]').length>0){LVSettings.Util.createDatePicker(cont);optArray=LeaveAdminOpers.getOptionsForFilter("periodV2",filterOpts,params);LeaveAdminOpers.ZPeopleComponents.Select.init({container:cont.find("[name=periodV2]"),optArray:optArray,onChangeCb:LeaveAdminOpers.Util.regFilterOnchangeEvents,isFieldHideForNodata:!0}),cont.find("[name=periodV2]").attr("defval",params.filteropt.periodV2.defaultVal),ZPeopleComponents.select(cont.find("[name=periodV2]")).setValue(params.filteropt.periodV2.defaultVal)}if(cont.find("[name=employee]").length>0&&LeaveAdminOpers.ZPeopleComponents.TokenField.empFieldInit(cont),cont.find("[name=employeeStatus]").length>0)if(LVUtil.Tab.isApplications())(optArray=[]).push({value:3,label:ZPI18N.getString("zp.userandemployeeprofile")}),optArray.push({value:1,label:ZPI18N.getString("zp.users")}),optArray.push({value:-2,label:ZPI18N.getString("zp.employeeprofile")}),optArray.push({value:0,label:ZPI18N.getString("zp.logindisableduser")}),optArray.push({value:-1,label:ZPI18N.getString("zp.allemployees")}),cont.find("[name=employeeStatus]").attr("defval",3),LeaveAdminOpers.ZPeopleComponents.Select.init({container:cont.find("[name=employeeStatus]"),optArray:optArray,defVal:3,isFieldHideForNodata:!0}),cont.find("[name=employeeStatus]").on("zselectchange",LeaveAdminOpers.Util.regFilterOnchangeEvents);else{optArray=LeaveAdminOpers.getOptionsForFilter("employeeStatus",filterOpts,params);var empStaOnChangeCb=function(){var empStatus=LVSettings.Util.TokenField.getValues(cont.find("[name=employeeStatus]")),incDoE=cont.find("[name=incDateOfExit]").parent().parent();-1!=empStatus.indexOf("18")?incDoE.removeClass("DNI"):incDoE.addClass("DNI"),LeaveAdminOpers.Util.regFilterOnchangeEvents()},opt=LVSettings.Util.TokenField.getDefaultInzKeys({data:optArray,tokenadd:empStaOnChangeCb,tokenremove:empStaOnChangeCb},cont);LVSettings.Util.TokenField.setAttributes(cont.find("[name=employeeStatus]"),opt),cont.find("[name=employeeStatus]").attr("defval",'["19","-2","18"]'),LVSettings.Util.TokenField.setValues(cont.find("[name=employeeStatus]"),["19","-2","18"])}cont.find("[name=applFor]").length>0&&(optArray=LeaveAdminOpers.getOptionsForFilter("applFor",filterOpts,params),cont.find("[name=applFor]").attr("defval",params.filteropt.applFor.defaultVal),LeaveAdminOpers.ZPeopleComponents.Select.init({container:cont.find("[name=applFor]"),optArray:optArray,defVal:params.filteropt.applFor.defaultVal,groupBy:!0})),cont.find("[name=isActive]").length>0&&(optArray=LeaveAdminOpers.getOptionsForFilter("isActive",filterOpts,params),cont.find("[name=isActive]").attr("defval","1"),LeaveAdminOpers.ZPeopleComponents.Select.init({container:cont.find("[name=isActive]"),optArray:optArray,defVal:"1",isFieldHideForNodata:!0})),cont.find("[name=holidayClassification]").length>0&&(params.isDecodeTxt=!1,optArray=LeaveAdminOpers.getOptionsForFilter("holidayClassification",ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops,params),LeaveAdminOpers.ZPeopleComponents.TokenField.init({container:cont.find("[name=holidayClassification]"),optArray:optArray,placeholder:ZPI18N.getString("zp.all")+" "+ZPeople.decodeTxt(Holidays.optDisplayNameInSingularForm())+" "+ZPI18N.getString("zp.classification"),isFieldHideForNodata:!0,defVal:"1"})),$(cont.find(".zcheckbox")).on("click",function(){let swtched=$(this).find("input[type=checkbox]");swtched.prop("checked",!swtched.prop("checked"))})},getOptionsForFilter:function(key,data,filParamsData){var optArray=data[key],moduleData=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops,isFromOpers=LVUtil.Tab.isOpersPage(),isFromMyTab=LVUtil.Tab.isMyPage(),isFromTeamTab=LVUtil.Tab.isTeamPage();if(void 0===optArray){if("periodV2"==key){optArray=[];var load=filParamsData.filteropt.periodV2.load?filParamsData.filteropt.periodV2.load:"";(load=""==load?["day","month","year"]:load.split(",")).forEach(function(loadFor){var options=Leave.period_options[loadFor];for(var id in options)optArray.push({label:options[id],value:id})}),optArray.push({label:ZPI18N.getString("zp.custom"),value:"1000"})}else if("applFor"==key){if(LVUtil.Tab.isHoliday()||LVUtil.Tab.isExpWorkingDay()){optArray=LVUtil.Tab.isHoliday()?[{label:ZPI18N.getString("zp.myfb",[ZPeople.decodeTxt(ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name)]),value:"1",groupBy:""}]:[],moduleData.isadmin&&optArray.push({label:LVUtil.Tab.isHoliday()?ZPI18N.getString("zp.AllOrgStructureElements",[ZPeople.decodeTxt(ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name)]):ZPI18N.getString("zp.all"),value:"0",groupBy:""}),filParamsData.isDecodeTxt=!0;var locArr=this.getOptionsForFilter("location",data,filParamsData);locArr.forEach(obj=>{obj.groupBy=ZPI18N.getString("zp.location")}),Array.prototype.push.apply(optArray,locArr);var shiftArr=this.getOptionsForFilter("shift",data,filParamsData);shiftArr.forEach(obj=>{obj.groupBy=ZPI18N.getString("zp.shiftsig")}),Array.prototype.push.apply(optArray,shiftArr)}}else if("dataSelect"==key){optArray=[];var viewPerm=moduleData.viewperm;LVUtil.Tab.isApplications()?isFromTeamTab?LVUtil.showAllDataForNonAdmin()?(optArray.push({label:ZPI18N.getString("zp.dirsubdata"),value:"dirsub"}),optArray.push({label:ZPI18N.getString("zp.subdata"),value:"sub"}),optArray.push({label:ZPI18N.getString("zp.alldata"),value:"all"})):(optArray.push({label:ZPI18N.getString("zp.dirsubdata"),value:"dirsub"}),optArray.push({label:ZPI18N.getString("zp.teamdata"),value:"mydep"})):isFromMyTab?optArray.push({label:ZPI18N.getString("zp.mydata"),value:"self"}):(0!==viewPerm||moduleData.isterritoryadmin||moduleData.isOperationalRoleAdmin||moduleData.isSPOCLvViewEnabled)&&(3===viewPerm?(optArray.push({label:ZPI18N.getString("zp.alldata"),value:"all"}),optArray.push({label:ZPI18N.getString("zp.teamdata"),value:"mydep"}),optArray.push({label:ZPI18N.getString("zp.subdata"),value:"sub"})):2===viewPerm?(optArray.push({label:ZPI18N.getString("zp.teamdata"),value:"mydep"}),optArray.push({label:ZPI18N.getString("zp.subdata"),value:"sub"})):4===viewPerm&&optArray.push({label:ZPI18N.getString("zp.subdata"),value:"sub"}),0!==viewPerm&&1!==viewPerm&&optArray.push({label:ZPI18N.getString("zp.dirsubdata"),value:"dirsub"}),4!==viewPerm&&0!==viewPerm&&optArray.push({label:ZPI18N.getString("zp.mydata"),value:"self"}),(moduleData.isterritoryadmin||moduleData.isOperationalRoleAdmin)&&optArray.push({label:ZPI18N.getString("zp.orgStructuredata"),value:"dataadmin"}),moduleData.isSPOCLvViewEnabled&&optArray.push({label:ZPI18N.getString("zp.leaveadmindata"),value:"leaveadmin"})):isFromTeamTab?(optArray.push({label:ZPI18N.getString("zp.dirsubdata"),value:"6"}),optArray.push({label:ZPI18N.getString("zp.teamdata"),value:"2"})):isFromMyTab?optArray.push({label:ZPI18N.getString("zp.mydata"),value:"1"}):((moduleData.isadmin||3==viewPerm)&&isFromOpers&&optArray.push({label:ZPI18N.getString("zp.alldata"),value:"3"}),(moduleData.isterritoryadmin||moduleData.isOperationalRoleAdmin)&&isFromOpers&&optArray.push({label:ZPI18N.getString("zp.orgStructuredata"),value:"5"}),!moduleData.isdataadmin&&2!=viewPerm&&3!=viewPerm||!isFromOpers&&!isFromTeamTab||optArray.push({label:ZPI18N.getString("zp.teamdata"),value:"2"}),4==viewPerm&&isFromOpers&&optArray.push({label:ZPI18N.getString("zp.subdata"),value:"2"}),4!=viewPerm&&(isFromOpers||isFromMyTab)&&optArray.push({label:ZPI18N.getString("zp.mydata"),value:"1"}),moduleData.isSPOCLvViewEnabled&&isFromOpers&&optArray.push({label:ZPI18N.getString("zp.leaveadmindata"),value:"7"}))}else if("status"==key)optArray=LVUtil.Tab.isApplications()?[{label:ZPI18N.getString("zp.allrequest"),value:"all"},{label:ZPI18N.getString("zp.approved"),value:"approved"},{label:ZPI18N.getString("zp.rejected"),value:"rejected"},{label:ZPI18N.getString("zp.pending"),value:"pending"},{label:ZPI18N.getString("zp.cancelled"),value:"cancelled"}]:[{label:ZPI18N.getString("zp.allrequest"),value:"20"},{label:ZPI18N.getString("zp.approved"),value:"1"},{label:ZPI18N.getString("zp.rejected"),value:"0"},{label:ZPI18N.getString("zp.pending"),value:"-1"},{label:ZPI18N.getString("zp.cancelled"),value:"2"}];else if("bookingstatus"===key)optArray=[{label:ZPI18N.getString("zp.leave.allrecords"),value:"-1"},{label:ZPI18N.getString("zp.leave.compensatory.bookable"),value:"0"},{label:ZPI18N.getString("zp.leave.availed"),value:"1"},{label:ZPI18N.getString("zp.expired"),value:"2"}];else if("isActive"==key)optArray=[{label:ZPI18N.getString("zp.active"),value:"1"},{label:ZPI18N.getString("zp.deleted"),value:"0"}];else{if("toggleDataSelect"!==key)return[];LVUtil.Tab.isCZPolicy()?optArray=[{label:ZPI18N.getString("zp.all"),value:"0"},{label:ZPI18N.getString("zp.customize"),value:"1"}]:(LVUtil.Tab.isApplications()||LVUtil.Tab.isCompOff()||LVUtil.Tab.isGrant())&&(optArray=[{label:ZPI18N.getString("zp.local.Direct"),value:"6"},{label:ZPI18N.getString("zp.all"),value:"2"}])}return optArray}if(optArray&&optArray.length>0){var optData=[],isAll=filParamsData.filteropt[key]?filParamsData.filteropt[key].isAll:void 0;if(LVUtil.Tab.isGrant()&&"leavetype"==key)return $.each(optArray,function(i,value){value.isGrantBased&&optData.push({label:value.name,value:value.id})}),optData;var isDecodeTxt=filParamsData.isDecodeTxt;return $.each(optArray,function(i,value){(!LVUtil.Tab.isCZBalance()||"leavetype"!=key||2!=value.type&&4!=value.type)&&optData.push({label:isDecodeTxt?ZPeople.decodeTxt(value.name):value.name,value:value.id})}),void 0==isAll||isAll||delete optData[0],optData}return[]},filterValueChange:(isfrombreadcrumb,fieldname)=>{LeaveAdminOpers.ISFILTER_APPLIED=!0,LeaveAdminOpers.resetFilter(isfrombreadcrumb,fieldname),LeaveAdminOpers.applyFilter(isfrombreadcrumb,!0)},applyFilter:function(isfrombreadcrumb,needref){0!=isfrombreadcrumb&&(LeaveAdminOpers.ISFILTER_APPLIED=!0),void 0!=isfrombreadcrumb&&1!=needref||(BrdCrumbFilterView.create(settingsPage.container.find("#lvfilter"),LeaveAdminOpers.toggleFilter,LeaveAdminOpers.filterValueChange,LeaveAdminOpers.resetFilter),settingsPage.container.find("#lvfilter").find(".PI_cls").trigger("click"));var tableCont=settingsPage.container.find(".zpl_rgtcnt").find(".zpl_tblres");LVUtil.Tab.isApplications()?LeaveAdminOpers.Util.Footer.searchcallback():LVUtil.Tab.isResAvail()?TeamLeave.init():LVUtil.Tab.isCompOff()?(0==tableCont.find(".zpl_tbl").length&&LeaveAdminOpers.constructTableHeader(),LeaveAdminOpers.Util.Footer.searchcallback()):LVUtil.Tab.isGrant()?(0==tableCont.find(".zpl_tbl").length&&LeaveAdminOpers.constructTableHeader(),LeaveAdminOpers.Util.Footer.searchcallback()):LVUtil.Tab.isCZBalance()?(0==tableCont.find(".zpl_tbl").length&&LeaveAdminOpers.constructTableHeader(),LeavePolicy.CZBalance.get()):LVUtil.Tab.isCZPolicy()?(0==tableCont.find(".zpl_tbl").length&&LeaveAdminOpers.constructTableHeader(),UserSpecificPolicy.get()):LVUtil.Tab.isInitialBalance()?(0==tableCont.find(".zpl_tbl").length&&LeaveAdminOpers.constructTableHeader(),LeaveIB.get()):LVUtil.Tab.isHoliday()?(0==tableCont.find(".zpl_tbl").length&&LeaveAdminOpers.constructTableHeader(),Holidays.View.get()):LVUtil.Tab.isExpWorkingDay()&&(0==tableCont.find(".zpl_tbl").length&&LeaveAdminOpers.constructTableHeader(),ExpWorkingDay.View.list())},resetFilter:function(isfrombreadcrumb,fieldname){1!=isfrombreadcrumb&&(LeaveAdminOpers.ISFILTER_APPLIED=!1);var params=LeaveAdminOpers.getPageDetails(),cont=settingsPage.container.find("#lvfilter");void 0==fieldname&&BrdCrumbFilterView.reset(settingsPage.container),void 0!=fieldname&&"cur_date"!=fieldname||cont.find("[name=cur_date]").length>0&&ZPeopleComponents.datefield(cont.find("[name=cur_date]")).setValue(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date,uidateFormat),void 0!=fieldname&&"periodV2"!=fieldname||(LVUtil.Tab.isResAvail()?cont.find('[name="periodV2"]').length>0&&ZPeopleComponents.select(cont.find('[name="periodV2"]')).setValue("8"):cont.find('[name="periodV2"]').length>0&&void 0!=params.filteropt.periodV2.defaultVal&&ZPeopleComponents.select(cont.find('[name="periodV2"]')).setValue(params.filteropt.periodV2.defaultVal)),void 0!=fieldname&&"typeofleave"!=fieldname||cont.find('[name="typeofleave"]').length>0&&LeaveAdminOpers.ZPeopleComponents.resetSelectOrTokenFieldForFields({container:cont.find("[name=typeofleave]"),defVal:"-1"}),void 0!=fieldname&&"leavetype"!=fieldname||cont.find('[name="leavetype"]').length>0&&LeaveAdminOpers.ZPeopleComponents.resetSelectOrTokenFieldForFields({container:cont.find("[name=leavetype]")}),void 0!=fieldname&&"employee"!=fieldname||cont.find('[name="employee"]').length>0&&LeaveAdminOpers.ZPeopleComponents.resetSelectOrTokenFieldForFields({container:cont.find("[name=employee]")}),void 0!=fieldname&&"incDReportsOnly"!=fieldname||(cont.find("[name=incDReportsOnly]").length>0&&cont.find("[name=incDReportsOnly]").prop("checked",!1),cont.find("[name=incDReportsOnly]").parent().parent().removeClass("DNI")),void 0!=fieldname&&"department"!=fieldname||cont.find('[name="department"]').length>0&&LeaveAdminOpers.ZPeopleComponents.resetSelectOrTokenFieldForFields({container:cont.find("[name=department]")}),void 0!=fieldname&&"designation"!=fieldname||cont.find('[name="designation"]').length>0&&LeaveAdminOpers.ZPeopleComponents.resetSelectOrTokenFieldForFields({container:cont.find("[name=designation]")}),void 0!=fieldname&&"location"!=fieldname||cont.find('[name="location"]').length>0&&LeaveAdminOpers.ZPeopleComponents.resetSelectOrTokenFieldForFields({container:cont.find("[name=location]")}),void 0!=fieldname&&"bookingstatus"!=fieldname||cont.find('[name="bookingstatus"]').length>0&&LeaveAdminOpers.ZPeopleComponents.resetSelectOrTokenFieldForFields({container:cont.find("[name=bookingstatus]"),defVal:"-1"}),void 0!=fieldname&&"employeeStatus"!=fieldname||cont.find("[name=employeeStatus]").length>0&&LeaveAdminOpers.ZPeopleComponents.resetSelectOrTokenFieldForFields({container:cont.find("[name=employeeStatus]"),defVal:params.filteropt.employeeStatus.defaultVal}),void 0!=fieldname&&"incDateOfExit"!=fieldname||cont.find("[name=incDateOfExit]").length>0&&cont.find("[name=incDateOfExit]").prop("checked",!0),void 0!=fieldname&&"applFor"!=fieldname||cont.find("[name=applFor]").length>0&&LeaveAdminOpers.ZPeopleComponents.resetSelectOrTokenFieldForFields({container:cont.find("[name=applFor]"),defVal:params.filteropt.applFor.defaultVal}),void 0!=fieldname&&"isActive"!=fieldname||cont.find("[name=isActive]").length>0&&LeaveAdminOpers.ZPeopleComponents.resetSelectOrTokenFieldForFields({container:cont.find("[name=isActive]"),defVal:params.filteropt.isActive.defaultVal}),isOrgStructureEnabled&&(void 0!=fieldname&&"entity"!=fieldname||cont.find("[name=entity]").length>0&&LeaveAdminOpers.ZPeopleComponents.resetSelectOrTokenFieldForFields({container:cont.find("[name=entity]")}),void 0!=fieldname&&"businessUnit"!=fieldname||cont.find("[name=businessUnit]").length>0&&LeaveAdminOpers.ZPeopleComponents.resetSelectOrTokenFieldForFields({container:cont.find("[name=businessUnit]")}),void 0!=fieldname&&"division"!=fieldname||cont.find("[name=division]").length>0&&LeaveAdminOpers.ZPeopleComponents.resetSelectOrTokenFieldForFields({container:cont.find("[name=division]")})),void 0!=fieldname&&"holidayClassification"!=fieldname||cont.find("[name=holidayClassification]").length>0&&LeaveAdminOpers.ZPeopleComponents.resetSelectOrTokenFieldForFields({container:cont.find("[name=holidayClassification]")}),1==isfrombreadcrumb?LeaveAdminOpers.applyFilter(isfrombreadcrumb,!0):LeaveAdminOpers.applyFilter(!1,!1)},toggleFilter:function(isShow){settingsPage.container.find("#lvfilter").length>0&&(settingsPage.container.find("#lvfilter").hasClass("DNI")||1==isShow?(settingsPage.container.find("#lvfilter").removeClass("DNI"),settingsPage.container.addClass("zpl_fltr_flt")):(settingsPage.container.find("#lvfilter").addClass("DNI"),settingsPage.container.removeClass("zpl_fltr_flt")))},constructTableHeader:function(){var isAdmin=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isdataadmin;if(LVUtil.Tab.isApplications()){0==(table=settingsPage.container.find("#viewsContainer")).find("#systemview_header_row").length&&table.find("thead").append('<tr id="systemview_header_row"><th style="min-width:60px"><i class="zpl_popovr-js" data-menu-id="FormColview"></i></th><th style="min-width:40px;text-align:center;" ><div class="zcheckbox '+(isAdmin?"":"disabled")+'"><input type="checkbox" name="check" value="" class="headerSelect zcheckbox__helper"><label class="zcheckbox__label"></label></div></th><th id="approval_col" class="w60">'+ZPI18N.getString("zp.status")+'</th><th style="min-width:200px">'+ZPI18N.getString("zp.employeename")+' <div class="zpl_icncnt"><i class="PI_sort tooltip-js" id="EmployeeeName" title='+ZPI18N.getString("zp.sort")+'></i></div></th><th style="min-width:200px">'+ZPI18N.getString("zp.local.Leavetype")+' <div class="zpl_icncnt"><i class="PI_sort tooltip-js" id="Leavetype" title='+ZPI18N.getString("zp.sort")+'></i></div></th><th style="min-width:100px">'+ZPI18N.getString("zp.type")+'</th><th style="min-width:200px">'+ZPI18N.getString("zp.local.Leaveperiod")+'<div class="zpl_icncnt"><i class="PI_sort desc tooltip-js" id="FromTo" title='+ZPI18N.getString("zp.sort")+'></i></div></th><th style="min-width:100px">'+ZPI18N.getString("zp.leavetype.days")+"/"+ZPI18N.getString("zp.leavetype.hour.plural")+" "+ZPI18N.getString("zp.leave.operations.taken")+'</th><th style="min-width:100px">'+ZPI18N.getString("zp.local.Dateofrequest")+"</th></tr>"),0==table.find("tbody").length&&table.append('<tbody id="recordContainer"></tbody>')}else{var table=$('<table class="zpl_tbl clm40" role="grid" ><thead></thead><tbody></tbody></table>');if(LVUtil.Tab.isCompOff())table.find("tbody").attr("id","compRecordContainer"),table.find("thead").append('<tr><th scope="col" style="min-width:60px"><i class="zpl_popovr-js" data-menu-id="FormColview"></i></th><th style="min-width:40px" scope="col"><div class="zcheckbox"><input type="checkbox" name="check" value="" class="headerSelect zcheckbox__helper" '+(isAdmin?"":"disabled")+'><label class="zcheckbox__label"></label></div></th><th id="approval_col"  scope="col" style="min-width:60px">'+ZPI18N.getString("zp.status")+'</th><th style="min-width:250px" scope="col">'+ZPI18N.getString("zp.employee")+'<div class="zpl_icncnt"><i class="PI_sort tooltip-js" id="EmployeeeName" title='+ZPI18N.getString("zp.sort")+'></i></div></th><th style="min-width:250px" id="repTo" scope="col">'+ZPI18N.getString("zp.leave.operations.reportingto",[""])+'<div class="zpl_icncnt"><i class="PI_sort tooltip-js" id="ReportingTo" title="'+ZPI18N.getString("zp.sort")+'"></i></div></th><th style="min-width:140px" scope="col">'+ZPI18N.getString("zp.worked",[""])+" "+ZPI18N.getString("zp.leave.operations.sdate")+'<div class="zpl_icncnt"><i class="PI_sort desc tooltip-js" id="WorkedDate" title="'+ZPI18N.getString("zp.sort")+'"></i></div></th><th style="min-width:140px" scope="col">'+ZPI18N.getString("zp.local.Expirydate")+'<div class="zpl_icncnt"><i class="PI_sort tooltip-js" id="ExpiryDate" title="'+ZPI18N.getString("zp.sort")+'"></i></div></th><th id="approval_status" scope="col" style="min-width:160px">'+ZPI18N.getString("zp.status")+'</th><th style="min-width:120px" scope="col">'+ZPI18N.getString("zp.leave.customform.credited")+'</th><th style="min-width:120px" scope="col">'+ZPI18N.getString("zp.leave.view.taken")+'</th><th style="min-width:120px" scope="col">'+ZPI18N.getString("zp.leave.view.balance")+'</th><th style="min-width:200px" scope="col">'+ZPI18N.getString("zp.reason")+"</th>");else if(LVUtil.Tab.isGrant())table.find("tbody").attr("id","grantRecordContainer"),table.find("thead").append('<tr><th scope="col" style="min-width:60px"><i class="zpl_popovr-js" data-menu-id="FormColview"></i></th><th scope="col" style="min-width:40px"><div class="zcheckbox"><input type="checkbox" name="check" value="" class="headerSelect zcheckbox__helper" '+(isAdmin?"":"disabled")+'><label class="zcheckbox__label"></label></div></th><th scope="col" id="approval_col" style="min-width:60px">'+ZPI18N.getString("zp.status")+'</th><th style="min-width:250px" scope="col">'+ZPI18N.getString("zp.employee")+'<div class="zpl_icncnt"><i class="PI_sort tooltip-js" title='+ZPI18N.getString("zp.sort")+' id="EmployeeeName"></i></div></th><th style="min-width:250px" scope="col">'+ZPI18N.getString("zp.local.Leavetype")+'<div class="zpl_icncnt"><i class="PI_sort tooltip-js" title='+ZPI18N.getString("zp.sort")+' id="Leavetype"></i></div></th><th style="min-width:150px" scope="col">'+ZPI18N.getString("zp.effectfrom",[""])+'<div class="zpl_icncnt"><i class="PI_sort tooltip-js desc" title='+ZPI18N.getString("zp.sort")+' id="GrantDate"></i></div></th><th style="min-width:150px" scope="col">'+ZPI18N.getString("zp.leavetype.v2.entitlement.typeofcredit.grant")+'</th><th style="min-width:200px" scope="col">'+ZPI18N.getString("zp.reason")+'</th><th style="min-width:175px" scope="col">'+ZPI18N.getString("zp.lms.document")+"</th>");else if(LVUtil.Tab.isCZBalance())table.attr("id","ZP_CustomizeBalance"),table.find("tbody").attr("id","ZP_CustomizeRecordContainer");else if(LVUtil.Tab.isCZPolicy())table.attr("id","ZP_CustomizePolicy"),table.find("tbody").attr("id","ZP_CZPolicyRecordContainer"),LVUtil.Tab.isOpersUserPage()&&table.find("thead").append('<tr><th style="width:20%">'+ZPI18N.getString("zp.leave.context.lvpolicy")+'</th><th style="width:20%">'+ZPI18N.getString("zp.type")+'</th><th style="width:10%">'+ZPI18N.getString("zp.unit")+'</th><th style="width:10%">'+ZPI18N.getString("zp.leave.view.balance")+'</th><th style="width:40%"></th></tr>');else if(LVUtil.Tab.isInitialBalance())table.attr("id","ZP_Leave_Settings_IB_View"),table.find("tbody").attr("id","ZP_Leave_Settings_IB_View_Container");else if(LVUtil.Tab.isHoliday()||LVUtil.Tab.isExpWorkingDay()){table.removeClass("clm40"),table.find("tbody").attr("id",LVUtil.Tab.isHoliday()?"holidaysRecordContainer":"workingdayRecordContainer");var tableHead='<tr><th scope="col" style="width:300px">'+ZPI18N.getString("zp.name")+'</th><th scope="col">'+ZPI18N.getString("zp.date")+'</th><th scope="col">'+ZPI18N.getString("zp.location")+'</th><th scope="col">'+ZPI18N.getString("zp.shifts")+"</th>";LVUtil.Tab.isHoliday()&&(tableHead+='<th scope="col">'+ZPI18N.getString("zp.classification")+"</th>"),tableHead+='<th scope="col">'+ZPI18N.getString("zp.description")+'</th><th scope="col" style="width:100px"></th></tr>',table.find("thead").append(tableHead)}table.find("thead").hide(),settingsPage.container.find(".zpl_tblres").append(table)}0==settingsPage.container.find(".zpl_tblres").find("#zp_empty_data").length&&$(settingsPage.container.find(".zpl_tblres")[0]).append('<div id="zp_empty_data" systemviewonly /></div>')},constructContHeader:function(params){var html='<div class="zpl_crd wd100_per"><div class="zpl_crdhdr"><div><h4>';html+=params.top.header.header+"</h4>",html+="<p>"+params.top.header.text+"</p></div></div></div>",settingsPage.container.find(".zpl_rgtcnt").prepend(html)},constructSystemViewTopDiv:function(params){var html="";return void 0!=params.headeraction&&"true"==params.headeraction.attr.status&&0==settingsPage.container.find("#viewActionsContainer").find(".actn_ovrly[systemviewonly]").length&&(html+=LeaveAdminOpers.constrctHeaderActionOvrly(!0)),void 0!==params.topright&&Object.keys(params.topright).length>0&&0==settingsPage.container.find("#viewActionsContainer").find(".zpl_rgt[systemviewonly]").length&&(html+='<div class="zpl_rgt" systemviewonly>',$.each(params.topright,function(tagName,tagValue){var prefix,suffix;"button"==tagName?(tagValue.attr.class=tagValue.attr.class+"  zlabel zlabel--blue zlabel--medium",prefix="<button ",suffix="</button>"):"filter"==tagName?(prefix="<i",tagValue.attr.class="zpl_ibg PI_fltr",suffix="</i>"):"dataSelect"==tagName||"status"==tagName?(prefix="<div><select",tagValue.attr.class="select-js",suffix="</select></div>"):"pushgcal"==tagName?(tagValue.attr.class="zlabel zlabel--outline zlabel--medium",prefix="<button ",suffix="</button>"):"togglebutton"==tagName&&(html+='<ul class="zpl_grpmnu"></ul>'),"more"==tagName&&(tagValue.attr.class="zpl_ibg PI_more",prefix="<i ",suffix="</i>"),"togglebutton"!=tagName&&(html+=prefix+" "+LVSettings.putAttrinTags(tagValue.attr)+" >"+("pushgcal"==tagName?'<i class="PI_calen_push IC-sync MR2 S12"></i>':"")+(tagValue.text?tagValue.text:"")+suffix)}),html+="</div>"),html},constructTopDiv:function(params){var html='<div id="topOpersMenu" class="zpl_btnmnu">';return html+='<div class="zpl_lft">',html+="</div>",void 0!=params.headeraction&&"true"==params.headeraction.attr.status&&(html+=LeaveAdminOpers.constrctHeaderActionOvrly()),params.center&&params.center.navi&&(html+=LeaveAdminOpers.constructDateNavigation()),void 0!==params.topright&&Object.keys(params.topright).length>0&&(html+='<div class="zpl_rgt">',$.each(params.topright,function(tagName,tagValue){var prefix,suffix;"button"==tagName||"rolloverbutton"==tagName?(tagValue.attr.class=tagValue.attr.class+" zlabel zlabel--blue zlabel--medium",prefix="<button ",suffix="</button>"):"filter"==tagName?(prefix="<i",tagValue.attr.class="zpl_ibg PI_fltr",suffix="</i>"):"dataSelect"==tagName||"status"==tagName||"applFor"==tagName?(prefix="<div><select",tagValue.attr.class="select-js",suffix="</select></div>"):"pushgcal"==tagName?(tagValue.attr.class="zlabel zlabel--outline zlabel--medium",prefix="<button ",suffix="</button>"):"togglebutton"==tagName?html+='<ul class="zpl_grpmnu"></ul>':"splitbutton"==tagName&&(html+='<div role="splitbutton" aria-label="Add Holidays" id="addHolidaysOpts"  class="zbutton--split zbutton--splitprimary"><button aria-label="Add Holidays" name="addholidays" tabindex="0" role="button" class="zbutton zbutton--medium zbutton--primary zbutton--action" type="button"><span class="zbutton__text">'+ZPI18N.getString("zp.addcomponents",[ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name])+'</span></button><button id="holidayMoreOptnBtn" aria-haspopup="true" aria-expanded="false" onclick="Holidays.showAddHolidaysMoreOptn()" aria-controls="patternTemplateList" tabindex="0" role="button" class="zbutton zbutton--menu zbutton--medium zbutton--primary" type="button"><i class="zbutton__icon zh-floatright"><svg class="zbutton__svg zbutton__menuarrow" focusable="false"> <use xlink:href="#zc__svg--downarrow"></use></svg></i></button></div>'),"more"==tagName&&(tagValue.attr.class="zpl_ibg PI_more",prefix="<i ",suffix="</i>"),"togglebutton"!=tagName&&"viewswitcher"!=tagName&&"splitbutton"!=tagName&&(html+=prefix+" "+LVSettings.putAttrinTags(tagValue.attr)+" >"+("pushgcal"==tagName?'<i class="PI_calen_push MR2 S12"></i>':"")+(tagValue.text?tagValue.text:"")+suffix)}),html+="</div>"),html+="</div>"},constructToggleDataSelect(optArray,defVal){var toggleDiv=settingsPage.container.find(".zpl_rgt:not(.DNI)").find(".zpl_grpmnu");toggleDiv.empty(),$.each(optArray,function(i,opt){toggleDiv.append('<li class="'+(opt.value==defVal?"zpl_act":"")+'" aria-label ="'+opt.label+'" tabindex="0" value="'+opt.value+'">'+opt.label+"</li>")})},constructPageFooter:function(){var html='<div class="zpl_tblpagination" id="systemview_pagination">';return html+='<div class="zpl_lftpgn"><span><label>'+ZPI18N.getString("zp.totalrecordcount")+' : </label> <a id="recCount" href="javascript:void(0)">#</a></span></div>',html+='<div class="zpl_rhtpgn"><select data-width="70" class="zselectbox select-js"></select>',html+='<div class="pagecount"><p>'+ZPI18N.getString("zp.records")+'</p><a class="zpl_prev tooltip-js" id="prevapp" title="'+ZPI18N.getString("zp.previous")+'"></a><span id="zp_view_page_cnt">1 - 10</span><a id="nextapp" class="zpl_nxt" title="'+ZPI18N.getString("zp.next")+'"></a></div>',html+="</div></div>"},constrctHeaderActionOvrly:function(isSystemView){var mhtml='<div class="actn_ovrly"'+(isSystemView?"systemviewonly":"")+"><div>";return mhtml+='<button class="zlabel zlabel--red zlabel--medium" onclick="LeaveAdminOpers.Util.deleteBulkWarning()">'+ZPI18N.getString("zp.delete")+"</button>",LVUtil.Tab.isApplications()&&ZP5Views.getModuleData().formDetailsMap.hasMMTForm&&(mhtml+='<button class="zlabel zlabel--outline zlabel--medium" id="merge_template" onclick="ZP_Mailmerge.constructMMTempList(\'form\', null, null,null,\'Merge\')">'+ZPI18N.getString("zp.mailmerge")+"</button>"),mhtml+='</div><i class="PI_cls" onclick="LeaveAdminOpers.Util.showBulkDelete(false);"></i></div>'},constructMoreOption:function(params){var pageId=settingsUrlProps.niceUrlArr[settingsUrlProps.niceUrlArr.length-1];$("#moreoptionmenu_"+pageId).length>0&&(ZPeopleComponents.menu($("#moreoptionmenu_"+pageId)).destroy(),$("#moreoptionmenu_"+pageId).remove());var moreopt=params.more.options,mhtml='<div id="moreoptionmenu_'+pageId+'" class="zpl_drpdwn zmenu zmenu--iconwithtext" data-type="list" data-content-type="icon-text" role="menu"><ul data-body="true" class="zmenu__body">';$.each(moreopt,function(indx,value){value.iClass&&(mhtml+='<li onclick="'+value.callback+'" data-action="'+value.callback+'" data-icon-class="'+value.iClass+'" id="'+value.id+'" class="zmenu__item">',mhtml+='<div class="zmenu__iconcontainer"><i class="zmenu__icon '+value.iClass+'"></i></div>'),mhtml+='<span class="zmenu__text">'+value.name+"</span></li>"}),mhtml+="</ul></div>",settingsPage.container.append(mhtml),ZPeopleComponents.menu("#moreoptionmenu_"+pageId,{forElement:settingsPage.container.find("#moreoptionmenuBtn_"+pageId)}),ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isadmin&&"holiday"==pageId&&ZPeopleComponents.menu($("#moreoptionmenu_"+pageId)).setAttribute("width",250)},constructDateNavigation:function(){var html='<div class="zpl_cntrdv"><div class="zpl_inav ZP-YearPagerUnTie">';return html+='<i class="PI_alft tooltip-js blu" title="'+ZPI18N.getString("zp.previous")+'" aria-label="'+ZPI18N.getString("zp.common.previousyr")+'" tabindex="0"></i>  <i class="PI_monthly"></i><i class="PI_argt tooltip-js blu" title="'+ZPI18N.getString("zp.next")+'" aria-label="'+ZPI18N.getString("zp.common.nextyr")+'" tabindex="0"></i></div><b id="ZPCalNavTxt"></b></div>'},constructViewSwitcher:function(options){return`<div class="grpbtn">${options.map(o=>`<i class="${o.className}" title="${o.label}" onclick="${o.onclick}"></i>`).join("")}</div>`},constructBoxDiv:function(params,data){return'<div class="zpl_crd"></div>'},constructListDiv:function(params,data){var page=settingsUrlProps.niceUrlArr[settingsUrlProps.niceUrlArr.length-1];return"customizebalance"==page?LVUtil.Tab.isOpersUserPage()?'<div class="zpl_rgtcnt"><div class="zpl_tblres"></div></div>':'<div class="zpl_tbllftfxd"><div class="zpl_rgtcnt"><div class="zpl_tblres"></div></div></div>':"compensatory"==page?'<div class="zpl_tbllftfxd lft3"><div class="zpl_rgtcnt"><div class="zpl_tblres"></div></div></div>':'<div class="zpl_rgtcnt"><div class="zpl_tblres"></div></div>'},constructRgtDiv:function(){return'<div class="zpl_rgtcnt"></div>'}}).Tab={InitPage:function(callback){var topics=this.getCurPageTopics();!topics||this.CACHE.getStatus(topics)?callback():(this.CACHE.setStatus(topics),$.ajax({url:"leave_common_action.zp",type:"POST",async:!1,data:{key:"init_page",topics:topics,conreqcsr:csrfToken},success:function(resp){if("success"===resp.status){var moduleData=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops;$.each(resp.data,function(key,obj){"payPeriod"==key&&_.each(obj,function(pp){pp.rsName=decodeHTML(pp.rsName)}),moduleData[key]=obj}),callback()}}}))},getCurPageTopics:function(){var pageId=Layout.Page.hash,pageArr=pageId.split("/");switch("-1"!=(pageId=pageArr[pageArr.length-1]).indexOf("-")&&(pageId=pageId.substring(0,pageId.indexOf("-"))),pageId){case"compensatory":return this.CACHE.FILTEROPTIONS?"COMPOFF":"FILTEROPTIONS,COMPOFF";case"holiday":return this.CACHE.FILTEROPTIONS?"CALENDAR_SYNC":"FILTEROPTIONS,CALENDAR_SYNC";default:return"FILTEROPTIONS"}},CACHE:{FILTEROPTIONS:!1,COMPOFF:!1,PAYPERIOD:!1,setStatus:function(topics){for(var arr=topics.split(","),i=0;i<arr.length;i++)this[arr[i]]=!0},getStatus:function(topics){for(var arr=topics.split(","),i=0;i<arr.length;i++)if(!this[arr[i]])return!1;return!0}}},LeaveAdminOpers.Router={isApplications:()=>LVUtil.Tab.isApplications(),isCompensatory:()=>LVUtil.Tab.isCompOff(),isGrant:()=>LVUtil.Tab.isGrant(),isRecord:()=>-1!=settingsUrlProps.url.indexOf("recordId:")||-1!=settingsUrlProps.url.indexOf("formId:")||-1!=settingsUrlProps.url.indexOf("viewId:"),isRecordAdd:()=>-1!=settingsUrlProps.url.indexOf("/applications/add"),isRecordView:()=>LeaveAdminOpers.Router.isRecord()&&-1!=settingsUrlProps.niceUrl.indexOf("/view"),isRecordEdit:()=>LeaveAdminOpers.Router.isRecord()&&-1!=settingsUrlProps.niceUrl.indexOf("/edit"),isBookCompOff:()=>LeaveAdminOpers.Router.isRecord()&&-1!=settingsUrlProps.niceUrl.indexOf("/book"),getRecordUrl(mode,id){var url=settingsUrlProps.niceUrlArr.slice(0,settingsUrlProps.niceUrlArr.length).join("/");return"add"==mode?"#"+url+"/"+mode:"#"+url+"/"+mode+"-recordId:"+id}},LeaveAdminOpers.Util={regFilterOnchangeEvents:function(event){var name=$(this).attr("name");if("periodV2"==name){var dateFields=settingsPage.container.find(".datepicker"),perVal=ZPeopleComponents.select(settingsPage.container.find("[name=periodV2]")).getValue(),disabled=!0,from="",to="";let showfilteropt=!1;if("1000"!=perVal){var date=LeaveAdminOpers.Util.getPeriod(perVal);from=date.from,to=date.to,showfilteropt=!1}else showfilteropt=!0,disabled=!1,from=ZPeopleComponents.datefield(settingsPage.container.find(".datepicker")[0]).getValue().dateObject,to=ZPeopleComponents.datefield(settingsPage.container.find(".datepicker")[1]).getValue().dateObject;ZPeopleComponents.datefield(dateFields[0]).setValue(Calendar.formatDate(from,uidateFormat)),ZPeopleComponents.datefield(dateFields[1]).setValue(Calendar.formatDate(to,uidateFormat)),$(dateFields[0]).attr("showfilteropt",showfilteropt),$(dateFields[1]).attr("showfilteropt",showfilteropt),ZPeopleComponents.datefield(dateFields[0]).setAttributes({disabled:disabled}),ZPeopleComponents.datefield(dateFields[1]).setAttributes({disabled:"leavetracker-team-availability"==Layout.Page.pageId||disabled})}else if("applFor"==name){var val=ZPeopleComponents.select(settingsPage.container.find("[name=applFor]")).getValue();"1"==val||"0"==val?(settingsPage.container.find("[name=location]").parent().parent().addClass("DNI"),settingsPage.container.find("[name=shift]").parent().parent().addClass("DNI")):(ZPeopleComponents.select(settingsPage.container.find("[name=location]")).deselectAllOptions(),ZPeopleComponents.select(settingsPage.container.find("[name=shift]")).deselectAllOptions(),"2"==val?(settingsPage.container.find("[name=location]").parent().parent().removeClass("DNI"),settingsPage.container.find("[name=shift]").parent().parent().addClass("DNI")):"3"==val?(settingsPage.container.find("[name=location]").parent().parent().addClass("DNI"),settingsPage.container.find("[name=shift]").parent().parent().removeClass("DNI")):(settingsPage.container.find("[name=location]").parent().parent().removeClass("DNI"),settingsPage.container.find("[name=shift]").parent().parent().removeClass("DNI")))}else if(name="employeeStatus"){var cont=settingsPage.container.find("#lvfilter");ZPeopleComponents.tokenfield(cont.find("[name=employee]")).destroy(),ZPeopleComponents.tokenfield(cont.find("[name=employee]")).refresh(),LVSettings.Util.userInputSelect2(cont.find("[name=employee]"),!1,void 0,cont.find(".zpl_fltrlst")),cont.find("[name=employee]").off("ztokenfieldchange").on("ztokenfieldchange",function(event){var empSelLen=LVSettings.Util.TokenField.getValues(cont.find("[name=employee]")).length,incDRep=cont.find("[name=incDReportsOnly]").parent().parent();0==empSelLen?incDRep.removeClass("DNI"):incDRep.addClass("DNI")})}},getEmpRow:function(empJson){var row_tr=ZP.create("tr"),emp_td=ZP.create("td",{"aria-label":empJson.name,tabindex:"0"}),emp_div=ZP.create("div",{class:"zpl_em"}),emp_imgdiv=ZP.create("div",{class:""});emp_imgdiv.appendChild(ZP.create("img",{class:"zpl_emimg",src:empJson.photo?empJson.photo:ZPeople.CURR_USER.thumb}));var emp_dtsdiv=ZP.create("div",{class:"zpl_emdts"}),tempDiv=ZP.create("div",{class:"tooltip-js","data-title-position":"bottom",title:empJson.name+""});return tempDiv.appendChild(ZP.create("em",{text:empJson.id+" - "})),tempDiv.appendChild(ZP.create("b",{text:empJson.name})),emp_dtsdiv.appendChild(tempDiv),emp_div.appendChild(emp_imgdiv),emp_div.appendChild(emp_dtsdiv),emp_td.appendChild(emp_div),row_tr.appendChild(emp_td),row_tr},showHideNoData:function(showNoData,errorMsg,cont){var empDiv=(cont=void 0!==cont?cont:settingsPage.container).find("#zp_empty_data");if(showNoData)if(LeaveAdminOpers.Util.removeLoading(),0===cont.find("#zp_empty_data").length&&cont.find(".zpl_rgtcnt").append("<div id='zp_empty_data'></div>"),empDiv.siblings().hide(),empDiv.show(),cont.find("#emptPage").remove(),0===cont.find("#emptPage").length){let image=LeaveAdminOpers.ISFILTER_APPLIED?"zp_nd_nodata":"zp_nd_record",message=LeaveAdminOpers.ISFILTER_APPLIED?ZPI18N.getString("zp.searchnodata",[ZPI18N.getString("zp.sresult")]):errorMsg||ZPI18N.getString("zp.nodatafound");var emptyhtml=new EmptyPages(image,message,"",empDiv);if(!LeaveAdminOpers.ISFILTER_APPLIED){let btnEle=settingsPage.container.find(".addact_btn");settingsPage.container.find(".addact_btn").hide(),emptyhtml.setButton(btnEle.text(),function(){btnEle.trigger("click")})}emptyhtml.show()}else cont.find("#emptPage").show();else empDiv.siblings().show(),settingsPage.container.find(".addact_btn").is(":visible")||settingsPage.container.find(".addact_btn").hasClass("permbased")||settingsPage.container.find(".addact_btn").show(),cont.find("#emptPage").hide(),cont.find("#viewEmptPage")&&cont.find("#viewEmptPage").hide()},appendLoading:function(){settingsPage.container.find(".zpl_rgtcnt").append(ZPeople.LOADING_HTML)},removeLoading:function(){settingsPage.container.find(".zpl_rgtcnt").find("#zp_page_loading").remove()},returnUsersOptions:function(){var options=[];return ZPForm.getPrimaryLookupValues(3).forEach(function(currUser){var obj={};obj.label=decodeHTML(currUser.Value),obj.value=currUser.Id,options.push(obj)}),options},getCurrentLYear:function(key){return LeaveAdminOpers.Util.getLYear(key,0)},getLYear:function(key,lyear){var lyear_obj=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.leaveyear,lyArr=[];for(var indx in lyArr=lyear_obj.hasOwnProperty(key)?lyear_obj[key]:lyear_obj[-1]){var data_json=lyArr[indx];if(data_json.id==lyear)return data_json}},getHyear:function(currentYear,loc,navCount){navCount=navCount||0;var fromDate=new Date(Calendar.parseDate(currentYear.from,uidateFormat));fromDate=new Date(fromDate.setFullYear(fromDate.getFullYear()+navCount));var toDate=new Date(fromDate);toDate=new Date(toDate.setFullYear(toDate.getFullYear()+1)),1==(toDate=new Date(toDate.setDate(toDate.getDate()-1))).getMonth()&&1==fromDate.getDate()&&(moment(toDate).isLeapYear()?toDate.setDate(29):toDate.setDate(28));var year={};return year.from=Calendar.formatDate(new Date(fromDate),uidateFormat),year.to=Calendar.formatDate(new Date(toDate),uidateFormat),year.name=year.fromDate+" - "+year.toDate,year},getMultiLocationLYear:function(location,nav){var loc_data=null;if(location){loc_data=LeaveAdminOpers.Util.getLYear(location[0],nav);for(var isSame_lyear=!0,i=1;i<location.length;i++)if(JSON.stringify(loc_data)!=JSON.stringify(LeaveAdminOpers.Util.getLYear(location[i],nav))){isSame_lyear=!1;break}isSame_lyear||(loc_data=LeaveAdminOpers.Util.getLYear(-1,nav))}else loc_data=LeaveAdminOpers.Util.getLYear(location,nav);return loc_data},getPeriod:function(period){var from,to,cur_period=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period,loc="";switch(LVUtil.Tab.isTeamPage()||LVUtil.Tab.isMyPage()||LVUtil.Tab.isUserPage()||LVUtil.Tab.isOpersUserPage()||(loc=LVUtil.Tab.isHoliday()||LVUtil.Tab.isExpWorkingDay()?(loc=ZPeopleComponents.select(settingsPage.container.find("[name=location]")))?loc.getValue():"":LVSettings.Util.TokenField.getValues(settingsPage.container.find("[name=location]"))),period){case"0":from=Calendar.parseDate(cur_period.cur_date,uidateFormat),to=from=new Date(from.setDate(from.getDate()-1));break;case"1":to=from=Calendar.parseDate(cur_period.cur_date,uidateFormat);break;case"2":from=Calendar.parseDate(cur_period.cur_date,uidateFormat),to=from=new Date(from.setDate(from.getDate()+1));break;case"7":(from=Calendar.parseDate(cur_period.cur_date,uidateFormat)).setDay(weekstarts-7),(to=new Date(from)).setDay(weekstarts+6);break;case"8":(from=Calendar.parseDate(cur_period.cur_date,uidateFormat)).setDay(weekstarts),(to=new Date(from)).setDay(weekstarts+6);break;case"9":(from=Calendar.parseDate(cur_period.cur_date,uidateFormat)).setDay(weekstarts+7),(to=new Date(from)).setDay(weekstarts+6);break;case"30":(from=Calendar.parseDate(cur_period.month_start,uidateFormat)).setMonth(from.getMonth()-1),(to=Calendar.parseDate(cur_period.month_end,uidateFormat)).setDate(1),to.setDate(0);break;case"31":from=Calendar.parseDate(cur_period.month_start,uidateFormat),to=Calendar.parseDate(cur_period.month_end,uidateFormat);break;case"32":(from=Calendar.parseDate(cur_period.month_start,uidateFormat)).setMonth(from.getMonth()+1),(to=new Date(from)).setMonth(to.getMonth()+1),to.setDate(0);break;case"365":var location=loc||"",loc_data=LeaveAdminOpers.Util.getMultiLocationLYear(location,-1);from=Calendar.parseDate(loc_data.from,uidateFormat),to=Calendar.parseDate(loc_data.to,uidateFormat);break;case"366":location=loc||"",loc_data=LeaveAdminOpers.Util.getMultiLocationLYear(location,0);from=Calendar.parseDate(loc_data.from,uidateFormat),to=Calendar.parseDate(loc_data.to,uidateFormat);break;case"367":location=loc||"",loc_data=LeaveAdminOpers.Util.getMultiLocationLYear(location,1);from=Calendar.parseDate(loc_data.from,uidateFormat),to=Calendar.parseDate(loc_data.to,uidateFormat)}return{from:from,to:to}},showBulkDelete:function(show){show?$(".actn_ovrly",settingsPage.container).addClass("opn"):($(".actn_ovrly",settingsPage.container).removeClass("opn"),$(".zpl_tblres",settingsPage.container).find("input:checkbox").each(function(){$(this).parent().hasClass("disabled")||(this.checked=!1)}))},deleteWarning:function(ele){var header,info;header=ZPI18N.getString("zp.delete")+" "+ZPI18N.getString("zp.sleave")+"?",info=ZPI18N.getString("zp.leave.operations.deleteinfo",[ZPI18N.getString("zp.sleave")])+"";var deleteModal=new DeleteAlertMessage;deleteModal.title=header,deleteModal.despcription=info,deleteModal.yesButtonText=ZPI18N.getString("zp.confirm"),deleteModal.cancelButtonText=ZPI18N.getString("zp.cancel"),deleteModal.callback=function(){var pageId=LVUtil.Tab.getCurPageId(),rec_id=$(ele).closest("div").attr("id").split("_").pop();if("grant"!=pageId){var params={key:"delete",id:rec_id,page:pageId};params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(data){"success"===data.status&&($("#zp_confirmation_pop").hide(),ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.leave")+" "+ZPI18N.getString("zp.deleted.successfully.msg",[""])),"applications"==pageId?LeaveApplications.View.get():"compensatory"==pageId&&LeaveCompensatory.View.get())})}else LeaveGrant.Delete.deleteRecord(rec_id)},deleteModal.show()},deleteBulkWarning:function(){var header,info;header=ZPI18N.getString("zp.delete")+" "+ZPI18N.getString("zp.sleave")+"?",info=ZPI18N.getString("zp.leave.operations.deleteinfo",[ZPI18N.getString("zp.leave")])+"";var bulkDeleteModal=new DeleteAlertMessage;bulkDeleteModal.title=header,bulkDeleteModal.despcription=info,bulkDeleteModal.yesButtonText=ZPI18N.getString("zp.confirm"),bulkDeleteModal.cancelButtonText=ZPI18N.getString("zp.cancel"),bulkDeleteModal.callback=function(){LVUtil.Tab.isGrant()?LeaveGrant.Delete.deleteRecords():LeaveAdminOpers.Util.deleteBulkRec()},bulkDeleteModal.show()},deleteBulkRec:function(){var deleteIds=[],checkedRows=$(".zpl_rgtcnt",settingsPage.container).find("tbody input:checkbox:checked");checkedRows.each(function(){var data_rec_id=$(this).closest("tr").data("id");data_rec_id&&deleteIds.push(data_rec_id)});var page=LVUtil.Tab.getCurPageId(),params={key:"delete",id:deleteIds.join(","),page:page};params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(data){"success"===data.status&&(checkedRows.each(function(){$(this).parents("tr").remove()}),LeaveAdminOpers.Util.showBulkDelete(!1)),LVUtil.Tab.isApplications()?LeaveApplications.View.get():LeaveAdminOpers.getData()})}},LeaveAdminOpers.Util.filterParams=function(params){var filter_cnt=$("#lvfilter",settingsPage.container);return LeaveAdminOpers.Util.params(filter_cnt,params),params.department&&(params.department=JSON.stringify(params.department)),params.designation&&"object"==typeof params.designation&&(params.designation=JSON.stringify(params.designation)),params.location&&(params.location=JSON.stringify(params.location)),params.orgTag&&(params.orgTag=JSON.stringify(params.orgTag)),params.employee&&(params.employee=JSON.stringify(params.employee)),params.leavetype&&(params.leavetype=JSON.stringify(params.leavetype)),params.entity&&(params.entity=JSON.stringify(params.entity)),params.businessUnit&&(params.businessUnit=JSON.stringify(params.businessUnit)),params.division&&(params.division=JSON.stringify(params.division)),params.bradford&&(params.bradford=JSON.stringify(params.bradford)),LVUtil.Tab.isApplications()||params.employeeStatus&&(params.employeeStatus=JSON.stringify(params.employeeStatus)),params},LeaveAdminOpers.Util.params=function(parent,params){$("select:not([name=periodV2]),input",parent).each(function(){var ele=$(this),name=ele.attr("name"),isMultiple=!!$(ele).attr("multiple"),ignore=ele.attr("ignore");if(name&&!ignore)if(ele.is("input:checkbox"))ele.is(":checked")?params[name]=!0:params[name]=!1;else if("from"==name||"to"==name)params[name]=ZPeopleComponents.datefield(parent.find("[name="+name+"]")).getValue().dateString;else if("lvfrom"==name||"lvto"==name){var val=ZPeopleComponents.datefield(parent.find("[name="+name+"]")).getValue().dateString;params["lvfrom"==name?"from":"to"]=val}else if("cur_date"==name)params.to=ZPeopleComponents.datefield(parent.find("[name=cur_date]")).getValue().dateString;else{var eleVal;isMultiple?(eleVal=LVSettings.Util.TokenField.getValues(parent.find("[name="+name+"]")))&&eleVal.length>0&&(params[name]=eleVal):(eleVal=ZPeopleComponents.select(parent.find("[name="+name+"]")).getValue())&&(params[name]=eleVal)}}),!showNewTab||LVUtil.Tab.isTeamPage()||LVUtil.Tab.isOpersPage()&&!LVUtil.Tab.isOpersUserPage()||(void 0==params.employee&&void 0!==Layout.Page.urlparam.id?params.employee=[Layout.Page.urlparam.id]:params.employee=[erecno])},LeaveAdminOpers.Util.employeeSearchExtraParams=function(){var extra_params={employeeStatus:3,employeeStatusarr:[19,-2,18],incDateOfExit:!0},emp_status=settingsPage.container.find("[name=employeeStatus]")[0],isMultiple=!!$(emp_status).attr("multiple"),incDtOFExit=$(settingsPage.container.find("[name=incDateOfExit]")[0]).is(":checked");return extra_params.incDateOfExit=incDtOFExit,void 0!==emp_status&&ZPeopleComponents.isComponent($(emp_status))&&(settingsPage.container.find("[name=from]")[0]?(extra_params.from=ZPeopleComponents.datefield(settingsPage.container.find("[name=from]")).getValue().dateString,extra_params.to=to=ZPeopleComponents.datefield(settingsPage.container.find("[name=to]")).getValue().dateString):settingsPage.container.find("[name=leaveyear_from]")[0]?(extra_params.from=ZPeopleComponents.datefield(settingsPage.container.find("[name=leaveyear_from]")).getValue().dateString,extra_params.to=to=ZPeopleComponents.datefield(settingsPage.container.find("[name=to]")).getValue().dateString):settingsPage.container.find("[name=lvfrom]")[0]&&(extra_params.from=ZPeopleComponents.datefield(settingsPage.container.find("[name=lvfrom]")).getValue().dateString,extra_params.to=ZPeopleComponents.datefield(settingsPage.container.find("[name=lvto]")).getValue().dateString),isMultiple?extra_params.employeeStatusarr=LVSettings.Util.TokenField.getValues($(emp_status)):extra_params.employeeStatus=ZPeopleComponents.select($(emp_status)).getValue()),isMultiple||(extra_params.employeeStatusarr=void 0),!LVUtil.Tab.isTeamPage()||LVUtil.showAllDataForNonAdmin()&&LVUtil.Tab.isApplications()||(extra_params.pageMode="LEAVE_TEAM"),(LVUtil.Tab.isCZBalance()||LVUtil.Tab.isCZPolicy())&&(extra_params.ignoreReportees=!0),extra_params},LeaveAdminOpers.Util.regPager=function(ele){var prev=$(ele).find(".PI_alft"),next=$(ele).find(".PI_argt"),pagetype=$(ele).attr("class"),currentPage=settingsUrlProps.niceUrlArr[settingsUrlProps.niceUrlArr.length-1],lyJson=LeaveAdminOpers.Util.getCurrentLYear(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.curuser.location);$(ele).data("date",lyJson.from+" - "+lyJson.to),$(ele).data("year",0),LeaveAdminOpers.Util.addOrReduceDate(ele,pagetype,0),$(prev).off("click").on("click",function(){if(-1!=$(prev).attr("class").indexOf("gry"))return-1;LeaveAdminOpers.Util.addOrReduceDate(ele,pagetype,-1),ZPeopleComponents.select(settingsPage.container.find("[name=periodV2]")).setValue("1000");var fromField=settingsPage.container.find("[name=from]"),toField=settingsPage.container.find("[name=to]");if(fromField[0]&&toField[0]){var from=ele.data("fromDate"),to=ele.data("toDate");ZPeopleComponents.datefield(settingsPage.container.find("[name=from]")).setValue(from,uidateFormat),ZPeopleComponents.datefield(settingsPage.container.find("[name=to]")).setValue(to,uidateFormat)}"holiday"==currentPage&&Holidays.View.get()}),$(next).off("click").on("click",function(){if(-1!=$(next).attr("class").indexOf("gry"))return-1;LeaveAdminOpers.Util.addOrReduceDate(ele,pagetype,1),ZPeopleComponents.select(settingsPage.container.find("[name=periodV2]")).setValue("1000");var fromField=settingsPage.container.find("[name=from]"),toField=settingsPage.container.find("[name=to]");if(fromField[0]&&toField[0]){var from=ele.data("fromDate"),to=ele.data("toDate");ZPeopleComponents.datefield(settingsPage.container.find("[name=from]")).setValue(from,uidateFormat),ZPeopleComponents.datefield(settingsPage.container.find("[name=to]")).setValue(to,uidateFormat)}"holiday"==currentPage&&Holidays.View.get()})},LeaveAdminOpers.Util.checkNavigation=function(count){var pager=settingsPage.container.find(".ZP-YearPager");LeaveAdminOpers.Util.getLYear(void 0,count-1)?(pager.find(".PI_alft").removeClass("gry"),pager.find(".PI_alft").addClass("blu CP")):(pager.find(".PI_alft").removeClass("blu CP"),pager.find(".PI_alft").addClass("gry")),LeaveAdminOpers.Util.getLYear(void 0,count+1)?(pager.find(".PI_argt").removeClass("gry"),pager.find(".PI_argt").addClass("blu CP")):(pager.find(".PI_argt").removeClass("blu CP"),pager.find(".PI_argt").addClass("gry"))},LeaveAdminOpers.Util.checkNavigationHoliday=function(count){settingsPage.container.find(".ZP-YearPagerUnTie")},LeaveAdminOpers.Util.addOrReduceDate=function(ele,pagertype,count){var process_date=new Date(curdate,curmonth,curyear),year=($(ele).data("date"),$(ele).data("year")),datetext=$(ele).parent().find("#ZPCalNavTxt"),empObj=ZP.getUserDetailsById(erecno),loc="null"!=empObj.location?empObj.location:"-1",lyJson=LeaveAdminOpers.Util.getCurrentLYear(loc,year+count);return(lyJson=LeaveAdminOpers.Util.getHyear(lyJson,loc,year+count))&&($(ele).data("year",year+count),$(ele).data("fromDate",lyJson.from),$(ele).data("toDate",lyJson.to),datetext.text(lyJson.from+" - "+lyJson.to),datetext.parent().attr({"aria-label":ZPI18N.getString("zp.common.period")+lyJson.from+" - "+lyJson.to,tabindex:"0"})),$(ele).data("date",process_date),process_date},LeaveAdminOpers.Util.Footer={regFooter:function(){var data_footer=$("#systemview_pagination",settingsPage.container);if(!data_footer.data("isreg")){var getMore=$(".pagecount",data_footer);LeaveAdminOpers.Util.Footer.setIndx(1,ZPeopleComponents.select(data_footer.find("select")).getValue()),data_footer.find("select").on("zselectchange",function(){""!=ZPeopleComponents.select(data_footer.find("select")).getValue()&&LeaveAdminOpers.Util.Footer.changeRecLimit()}),data_footer.find("a#recCount").on("click",function(){$(this).text($(this).data("totalCount"))}),getMore.find("#prevapp").on("click",function(){if($(this).hasClass("CP")){var limit=parseInt(ZPeopleComponents.select(data_footer.find("select")).getValue()),start=parseInt(getMore.find("span").data("sIndx"))-limit;start=start<1?1:start,LeaveAdminOpers.Util.Footer.getMore(start,limit)}}),getMore.find("#nextapp").on("click",function(){if($(this).hasClass("CP")){var limit=parseInt(ZPeopleComponents.select(data_footer.find("select")).getValue()),start=parseInt(getMore.find("span").data("sIndx"))+limit;LeaveAdminOpers.Util.Footer.getMore(start,limit)}}),data_footer.data("isreg",!0)}},changeRecLimit:function(){var data_footer=$("#systemview_pagination",settingsPage.container);LeaveAdminOpers.Util.Footer.setIndx(1,ZPeopleComponents.select(data_footer.find("select")).getValue());var pageId=LVUtil.Tab.getCurPageId();"applications"==pageId?LeaveApplications.View.get():"compensatory"==pageId?(LeaveCompensatory.refresh=!0,LeaveCompensatory.View.get()):"grant"==pageId&&LeaveGrant.View.list()},getMore:function(start,limit){LeaveAdminOpers.Util.Footer.setIndx(start,limit);var page=LVUtil.Tab.getCurPageId();"applications"==page?LeaveApplications.View.get():"compensatory"==page?(LeaveCompensatory.refresh=!0,LeaveCompensatory.View.get()):"grant"==page&&LeaveGrant.View.list()},setNavi:function(start,end){var data_footer=$("#systemview_pagination",settingsPage.container),getMore=$(".pagecount",data_footer),next=getMore.find("#nextapp"),prev=getMore.find("#prevapp");getMore.find("span").html(""),getMore.find("span").append(document.createTextNode(start+" - "+end)),end<data_footer.find("a#recCount").data("totalCount")?LeaveAdminOpers.Util.Footer.setClass(next,"CP"):LeaveAdminOpers.Util.Footer.setClass(next),start>1?LeaveAdminOpers.Util.Footer.setClass(prev,"CP"):LeaveAdminOpers.Util.Footer.setClass(prev)},setClass:function(ele,add){void 0!=add?(ele.addClass(add),ele.attr("style","color:#0088ff")):(ele.removeClass("CP"),ele.removeAttr("style"))},setIndx:function(start,limit){var data_footer=$("#systemview_pagination",settingsPage.container),getMore=$(".pagecount",data_footer);getMore.find("span").data("sIndx",start),getMore.find("span").data("eIndx",limit)},searchcallback:function(){var data_footer=$("#systemview_pagination",settingsPage.container),recordLimit=$(".zpl_rhtpgn",data_footer);data_footer.find("a#recCount").text("#"),LeaveAdminOpers.Util.Footer.setIndx(1,ZPeopleComponents.select(recordLimit.find("select")).getValue()),LVUtil.Tab.isGrant()?LeaveGrant.View.list():LVUtil.Tab.isCompOff()?LeaveCompensatory.View.get():LVUtil.Tab.isApplications()&&LeaveApplications.View.get()}},LeaveAdminOpers.Util.toggleSort=function(curEle){var bodyHeader=settingsPage.container.find(".zpl_rgtcnt").find("table").find("thead");(curEle=$(curEle)).addClass("ignore"),curEle.hasClass("asc")?(curEle.addClass("desc"),curEle.removeClass("asc")):(curEle.addClass("asc"),curEle.removeClass("desc")),$(".PI_sort:not(.ignore)",bodyHeader).removeClass("asc desc"),curEle.removeClass("ignore"),LVUtil.Tab.isApplications()?LeaveApplications.View.get():LVUtil.Tab.isCompOff()?LeaveCompensatory.View.get():LVUtil.Tab.isGrant()&&LeaveGrant.View.list()},LeaveAdminOpers.Util.sortParams=function(params){var bodyHeader=settingsPage.container.find(".zpl_rgtcnt").find("table").find("thead"),sortEle=$(".asc , .desc",bodyHeader);if(sortEle){var sortBy=sortEle.attr("id");params.sortType=sortEle.hasClass("asc")?0:1,params.sortBy=1,"Leavetype"===sortBy?params.sortBy=2:"FromTo"===sortBy?params.sortBy=3:"WorkedDate"===sortBy?params.sortBy=5:"ExpiryDate"===sortBy?params.sortBy=6:"ReportingTo"===sortBy?params.sortBy=7:"Balance"===sortBy?params.sortBy=8:"GrantDate"===sortBy&&(params.sortBy=9)}},LeaveAdminOpers.Util.exportPdf=function(){let formId="zp_export_form";Layout.Page.container.find("#ZPLeave_exp_form").length>0&&(formId="ZPLeave_exp_form");var url,params={};LVUtil.Tab.isCZBalance()?(url=LeaveAdminOpers.exporturl,params=LeavePolicy.CZBalance.getParams()):LVUtil.Tab.isInitialBalance()&&(url=LeaveAdminOpers.v1ExportUrl,params=LeaveIB.getParams()),params[csrfParamName]=csrfToken,params.exporttype=4;let keyValue=params.key;delete params.key,""!==keyValue&&void 0!==keyValue&&(url=url+"?key="+keyValue),Leave.exportForm.getHTMLFormDataObj(formId,"",url,"post",null,params).submit()},LeaveAdminOpers.Util.getDropDownActionsTD=function(action,id){var pageId=settingsUrlProps.niceUrlArr[settingsUrlProps.niceUrlArr.length-1],options={};"applications"==pageId?options={viewOpt:ZPI18N.getString("zp.view"),editOpt:ZPI18N.getString("zp.edit"),deleteOpt:ZPI18N.getString("zp.delete"),addtaskOpt:ZPI18N.getString("zp.addtask")}:"compensatory"==pageId?options={bookOpt:ZPI18N.getString("zp.leave.compensatory.book"),viewOpt:ZPI18N.getString("zp.view"),editOpt:ZPI18N.getString("zp.edit"),deleteOpt:ZPI18N.getString("zp.delete")}:"grant"==pageId&&(options={viewOpt:ZPI18N.getString("zp.view"),editOpt:ZPI18N.getString("zp.edit"),deleteOpt:ZPI18N.getString("zp.delete")});var moreIconId="#rowMoreIcon_",moreMenuOptsId="#rowMenuOpts_";LVUtil.Tab.isMyPage()?(moreIconId+="MyTab_"+id,moreMenuOptsId+="MyTab_"+id):LVUtil.Tab.isTeamPage()?(moreIconId+="TeamTab_"+id,moreMenuOptsId+="TeamTab_"+id):LVUtil.Tab.isUserPage()?(moreIconId+="UserTab_"+id,moreMenuOptsId+="UserTab_"+id):LVUtil.Tab.isOpersUserPage()?(moreIconId+="Opers_UsersTab_"+id,moreMenuOptsId+="Opers_UsersTab_"+id):LVUtil.Tab.isOpersPage()?(moreIconId+="OpersTab_"+id,moreMenuOptsId+="OpersTab_"+id):(moreIconId+=id,moreMenuOptsId+=id);var moreTd=ZP.create("td"),icMoreDiv=ZP.create("div",{class:"zpl_hvr"});return icMoreDiv.appendChild(ZP.create("i",{id:moreIconId.substring(1,moreIconId.length),"data-menu-id":"menutxt",class:"PI_more tooltip-js",onclick:"",title:ZPI18N.getString("zp.more")})),moreTd.appendChild(icMoreDiv),$(moreTd).find(moreIconId).off("click").on("click",function(){if(0==$(moreMenuOptsId).length){var mhtml="<div id='"+moreMenuOptsId.substring(1,moreMenuOptsId.length)+"'><ul>";$.each(action,function(indx,value){mhtml+="<li recordId="+id+" onclick='Leave.Util.executeAction("+value+",this)' id='"+indx+"'>"+options[indx]+"</li>"}),mhtml+="</ul></div>",settingsPage.container.append(mhtml),ZPeopleComponents.menu(moreMenuOptsId,{forElement:moreIconId})}ZPeopleComponents.menu(moreMenuOptsId).show()}),moreTd},LeaveAdminOpers.Util.getStatusTd=function(td,approvalStatus,noToolTip){if(-1==approvalStatus)td.appendChild(noToolTip?ZP.create("i",{class:"PI_ap_pending"}):ZP.create("i",{class:"PI_ap_pending","data-toggle":"tooltip","data-placement":"top",title:ZPI18N.getString("zp.pending")}));else if(1==approvalStatus)td.appendChild(noToolTip?ZP.create("i",{class:"PI_ap_approved"}):ZP.create("i",{class:"PI_ap_approved","data-toggle":"tooltip","data-placement":"top",title:ZPI18N.getString("zp.approved")}));else if(0==approvalStatus)td.appendChild(noToolTip?ZP.create("i",{class:"PI_ap_reject"}):ZP.create("i",{class:"PI_ap_reject","data-toggle":"tooltip","data-placement":"top",title:ZPI18N.getString("zp.rejected")}));else if(2==approvalStatus)td.appendChild(noToolTip?ZP.create("i",{class:"PI_ap_cancel"}):ZP.create("i",{class:"PI_ap_cancel","data-toggle":"tooltip","data-placement":"top",title:ZPI18N.getString("zp.cancelled")}));else if(-4==approvalStatus){var app_status_i=noToolTip?ZP.create("i",{class:"PI_ap_canclpend"}):ZP.create("i",{class:"PI_ap_canclpend","data-toggle":"tooltip","data-placement":"top",title:ZPI18N.getString("zp.cancellationpending")});app_status_i.appendChild(ZP.create("i",{class:"path1"})),app_status_i.appendChild(ZP.create("i",{class:"path2"})),td.appendChild(app_status_i)}},LeaveAdminOpers.Util.getAddlExpContainer=function(cont){if(-1==Layout.Page.pageId.indexOf("reports")||-1==Layout.Page.pageId.indexOf("leave-user")){var filters=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops,empSelectionHTML='<div class="zpl_secn" id="emp_fields_select" onclick=Leave.Util.showFieldsForExport(this)><div class="zcheckbox"><input type="checkbox" name="includeAll" class="zcheckbox__helper" id="includeAll"><label for="includeAll" class="zcheckbox__label">'+ZPI18N.getString("zp.incempfields")+'</label></div></div><div class="chkbx_lsts" style="display: none;"><div class="zcheckbox zcheckbox--horizontal"><input type="checkbox" name="empField_4" class="zcheckbox__helper"><label class="zcheckbox__label">'+ZPI18N.getString("zp.reportingto")+"</label></div>";if(filters.entity&&filters.entity.length>0)empSelectionHTML=empSelectionHTML+'<div class="zcheckbox zcheckbox--horizontal"><input type="checkbox" name="empField_5" class="zcheckbox__helper"><label class="zcheckbox__label">'+(ZPeople.orgStructureDispNameMap.hasOwnProperty("entity")?ZPeople.orgStructureDispNameMap.entity:ZPI18N.getString("zp.legalentityname"))+"</label></div>";if(filters.businessUnit&&filters.businessUnit.length>0)empSelectionHTML=empSelectionHTML+'<div class="zcheckbox zcheckbox--horizontal"><input type="checkbox" name="empField_6" class="zcheckbox__helper"><label class="zcheckbox__label">'+(ZPeople.orgStructureDispNameMap.hasOwnProperty("unit")?ZPeople.orgStructureDispNameMap.unit:ZPI18N.getString("zp.addbusinessunit"))+"</label></div>";if(filters.division&&filters.division.length>0)empSelectionHTML=empSelectionHTML+'<div class="zcheckbox zcheckbox--horizontal"><input type="checkbox" name="empField_7" class="zcheckbox__helper"><label class="zcheckbox__label">'+(ZPeople.orgStructureDispNameMap.hasOwnProperty("division")?ZPeople.orgStructureDispNameMap.division:ZPI18N.getString("zp.divisionname"))+"</label></div>";if(filters.department&&filters.department.length>0&&(empSelectionHTML=empSelectionHTML+'<div class="zcheckbox zcheckbox--horizontal"><input type="checkbox" name="empField_8" class="zcheckbox__helper"><label class="zcheckbox__label">'+ZPI18N.getString("zp.department")+"</label></div>"),empSelectionHTML=empSelectionHTML+'<div class="zcheckbox zcheckbox--horizontal"><input type="checkbox" name="empField_9" class="zcheckbox__helper"><label class="zcheckbox__label">'+ZPI18N.getString("zp.designation")+"</label></div>",filters.location&&filters.location.length>0&&(empSelectionHTML=empSelectionHTML+'<div class="zcheckbox zcheckbox--horizontal"><input type="checkbox" name="empField_10" class="zcheckbox__helper"><label class="zcheckbox__label">'+ZPI18N.getString("zp.location")+"</label></div>"),filters.orgTag&&filters.orgTag.length>0&&(empSelectionHTML=empSelectionHTML+'<div class="zcheckbox zcheckbox--horizontal"><input type="checkbox" name="empField_11" class="zcheckbox__helper"><label class="zcheckbox__label">'+ZPeople.orgTagDisplayName+"</label></div>"),-1!=Layout.Page.pageId.indexOf("reports")&&Leave.roleFilter.isEnabled()&&filters.role&&filters.role.length>0&&(empSelectionHTML=empSelectionHTML+'<div class="zcheckbox zcheckbox--horizontal"><input type="checkbox" name="empField_12" class="zcheckbox__helper"><label class="zcheckbox__label">'+ZPI18N.getString("zp.role")+"</label></div>"),empSelectionHTML+="</div>",cont.append(empSelectionHTML),$(cont.find(".zcheckbox")).on("click",function(){let swtched=$(this).find("input[type=checkbox]");swtched.prop("checked",!swtched.prop("checked"))}),-1!=Layout.Page.pageId.indexOf("leave-lop")){lop_report_crt="<div> <label>"+ZPI18N.getString("zp.data")+ZPI18N.getString("zp.Details")+'</label><select class="select-js" name="lop_report_crt"></select> </div>',cont.find("#emp_fields_select").prepend(lop_report_crt);var optArray=[{label:ZPI18N.getString("zp.alldata"),value:"0"},{label:ZPI18N.getString("zp.leave.lopreport.exportlop"),value:"1"},{label:ZPI18N.getString("zp.leave.lopreport.exportadjust"),value:"2"},{label:ZPI18N.getString("zp.leave.lopreport.exportloporadj"),value:"3"}];LeaveAdminOpers.ZPeopleComponents.Select.init({container:cont.find("[name=lop_report_crt]"),optArray:optArray,defVal:0,ddHeight:"500px"})}}},LeaveAdminOpers.Util.showExport=function(ele){var mode="";LVUtil.Tab.isCompOff()?mode="compensatory":LVUtil.Tab.isCZBalance()?mode="czbalance":LVUtil.Tab.isGrant()?mode="grant":-1!=Layout.Page.hash.indexOf("reports")&&-1!=Layout.Page.hash.indexOf("leave")?mode="leaveReports":LVUtil.Tab.isCalendar()?mode="leavetracker_ICS":LVUtil.Tab.isInitialBalance()&&(mode="initialbalance");var filters=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops,showEmpFields=filters.isadmin||filters.isdataadmin||filters.territoryadmin||ZPeople.SUB_USERLIST.length>1;$(ele).hasClass("ZP-Export-ICS")?"leaveReports"!=mode?Leave.Util.exportICSData():Leave.Reports.Export.exportData():LVUtil.Tab.isApplications()?ZP5Export.init("leavetracker",{moduleSysViewCallback:LeaveAdminOpers.Util.exportLeave,submitCallback:LeaveAdminOpers.Util.exportLeave}):LVUtil.Tab.isList()?ZP5Export.init("leavetracker",{submitCallback:LeaveAdminOpers.Util.exportLeave}):LVUtil.Tab.isCalendar()?ZP5Export.init("leavetracker_ICS",{submitCallback:LeaveAdminOpers.Util.exportLeave}):LVUtil.Tab.isHoliday()?ZP5Export.init("holiday",{submitCallback:LeaveAdminOpers.Util.exportData}):"leaveReports"==mode?Layout.Page.pageId.indexOf("leave-lop")>-1?ZP5Export.init(mode,{submitCallback:Leave.Reports.Export.exportData}):showEmpFields&&filters.isV2User&&Layout.Page.pageId.indexOf("leave-daily")>-1?Layout.Page.container.find(".lt_nav").find(".crd").hasClass("sel")?ZP5Export.init(mode+"_hideEmpFields",{submitCallback:Leave.Reports.Export.exportData}):ZP5Export.init(mode,{submitCallback:Leave.Reports.Export.exportData}):showEmpFields&&filters.isV2User?ZP5Export.init(mode,{submitCallback:Leave.Reports.Export.exportData}):ZP5Export.init(mode+"_hideEmpFields",{submitCallback:Leave.Reports.Export.exportData}):(showEmpFields&&filters.isV2User,ZP5Export.init(mode,{submitCallback:LeaveAdminOpers.Util.exportData}))},LeaveAdminOpers.Util.exportLeave=function(){var exportCont=ZP5Export.getCurrContainer(),params={isExportFromLeave:!0};let ftype=ZP5Export.getCurrContainer().find("[name=exportFileType]:checked").val();if(void 0!==ftype&&""!==ftype.trim()||(ftype=ZPUtil.checkValueInArray(ExportNew.ALLOWED_FORMAT,ftype,"all")),"ics"===ftype&&LVUtil.Tab.isCalendar())return void LeaveAdminOpers.Util.exportICS();let formParams={isExportFromLeave:"true",ftype:ftype,viewID:ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.viewId};if(LVUtil.Tab.isApplications()){(params=LeaveApplications.View.getParams()).key="applications_view",LVUtil.Tab.isMyPage()&&(params.typeOfView="self",params.employeeStatus="3"),(LVUtil.Tab.isTeamPage()||LVUtil.Tab.isUserPage())&&(params.typeOfView="sub",params.employeeStatus="3"),ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.approval_configured&&(params.status=ZPeopleComponents.select(settingsPage.container.find(".zpl_rgt:not(.DNI)").find("[name=status]")).getValue()),params.employee&&(formParams.ERECNO=params.employee),formParams.employeeStatus=params.hasOwnProperty("employeeStatus")?params.employeeStatus:"activeemprecord",formParams.fromDate=params.from,formParams.toDate=params.to,params.department&&(formParams.depID=params.department),formParams.typeOfLeave=params.typeofleave,!LVUtil.Tab.isMyPage()&&(formParams.typeOfLeave=params.typeofleave),LVUtil.Tab.isMyPage()?formParams.typeOfView="self":LVUtil.Tab.isTeamPage()||LVUtil.Tab.isUserPage()?formParams.typeOfView="sub":LVUtil.Tab.isOpersUserPage()?formParams.typeOfView="all":formParams.typeOfView=params.dataSelect,params.status&&(formParams.approvalStatus=params.status),params.designation&&(formParams.designation=params.designation),params.location&&(formParams.location=params.location),params.leavetype&&(formParams.leavetype=params.leavetype),params.entity&&(formParams.LT_entity=params.entity),params.businessUnit&&(formParams.LT_businessUnit=params.businessUnit),params.orgTag&&(formParams.LT_businessUnit=params.orgTag),params.division&&(formParams.LT_division=params.division)}else{var empId=LVUtil.Tab.isMyPage()?erecno:LVUtil.Team.getSelectedUser();formParams.ERECNO=JSON.stringify([empId]),formParams.employeeStatus="all",formParams.leaveyear=Layout.Page.container.find(".ZP-YearPager").data("year"),ZPeople.CURR_USER.usererec==empId?params.dataSelect="self":-1!=ZPeople.SUB_USERLIST.indexOf(empId)?params.dataSelect="sub":ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isdataadmin?params.dataSelect="dataadmin":params.dataSelect="all",formParams.typeOfView=params.dataSelect}Leave.exportForm.getHTMLFormDataObj("zp_export_form","","ExportData.zp","post",null,formParams).submit(),exportCont.modal("hide")},LeaveAdminOpers.Util.exportData=function(exportcontainer,params,fileType){exportcontainer=LVUtil.Tab.isHoliday()?ZP5Export.getCurrContainer():exportcontainer;var exptype=$(exportcontainer.find("[type=radio]:checked")).val();if("ics"!=exptype){var url;params={};if(LVUtil.Tab.isCompOff())url=Leave.View.exporturl+"?key=compensatory_view",delete(params=LeaveCompensatory.View.getParams()).key,ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.compApprovalEnabled&&(params.status=ZPeopleComponents.select(settingsPage.container.find("[name=status]")).getValue());else if(LVUtil.Tab.isGrant()){url="zpleave/grant/export",params=LeaveGrant.View.getParams(),ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.grantApprovalEnabled&&(params.status=ZPeopleComponents.select(settingsPage.container.find("[name=status]")).getValue());var listParams=JSON.stringify(params);(params={}).listParams=listParams,params.conreqcsr=csrfToken}else LVUtil.Tab.isCZBalance()?(delete(params=LeavePolicy.CZBalance.getParams()).key,url=LVSettings.exporturl+"?key="+LeavePolicy.CZBalance.key):LVUtil.Tab.isInitialBalance()?(delete(params=LeaveIB.getParams()).key,url=LeaveAdminOpers.v1ExportUrl+"?key="+LeaveIB.key):LVUtil.Tab.isHoliday()&&(params=Holidays.View.getParams(params),url="export_holiday.zp?method=export");params[csrfParamName]=csrfToken,params.exporttype=1,"xlsx"==exptype?params.exporttype=6:"csv"==exptype?params.exporttype=2:"tsv"==exptype&&(params.exporttype=3),LVUtil.Tab.isHoliday()&&(params.filetype=params.exporttype);var fieldsSelected=[];if($(".chkbx_lsts input").each(function(){!0===$(this).prop("checked")&&fieldsSelected.push($(this).attr("name").split("_")[1])}),fieldsSelected&&(params.fieldsSelected=JSON.stringify(fieldsSelected)),""!==url&&void 0!==url){Leave.exportForm.getHTMLFormDataObj("zp_export_form","",url,"post",null,params).submit()}}else LVUtil.Tab.isHoliday()&&Holidays.Export.ics()},LeaveAdminOpers.Util.exportICS=function(){if(LVUtil.Tab.isCalendar()){var params={},empId=LVUtil.Tab.isMyPage()?erecno:LVUtil.Team.getSelectedUser();params.employee=empId,params.conreqcsr=csrfToken,params.exporttype=1,params.mode="user",params.month=Leave.View.Calendar.calObj.curMonth,params.year=Leave.View.Calendar.calObj.curYear}Leave.exportForm.getHTMLFormDataObj("zp_export_form","",Leave.View.exporturl+"?key=calendar_view","post",null,params).submit()},LeaveAdminOpers.ZPeopleComponents={resetSelectOrTokenFieldForFields(fieldObj){var fieldCont=fieldObj.container;if(fieldCont){var isMultiple="select-one"!=fieldCont.prop("type"),defVal=fieldObj.defVal;isMultiple?(LVSettings.Util.TokenField.removeAllTokens(fieldCont),void 0!=defVal&&LVSettings.Util.TokenField.setValues(fieldCont,defVal)):(ZPeopleComponents.select(fieldCont).deselectAllOptions(),void 0!=defVal&&ZPeopleComponents.select(fieldCont).setValue(defVal))}}},LeaveAdminOpers.ZPeopleComponents.Select={init:function(fieldObj){if(fieldObj&&fieldObj.container){var fieldCont=fieldObj.container,optArray=void 0!=fieldObj.optArray?fieldObj.optArray:[],placeholder=fieldObj.placeholder?fieldObj.placeholder:"",defVal=fieldObj.defVal,onChangeCb=void 0!=fieldObj.onChangeCb?fieldObj.onChangeCb:"",appendTo=fieldObj.appendTo,isFieldHideForNodata=fieldObj.isFieldHideForNodata,dataMapping=fieldObj.dataMapping,isTextHTMLEncoded=isTextHTMLEncoded||!0,groupBy=!!fieldObj.groupBy&&fieldObj.groupBy,ddHeight=fieldObj.ddHeight?fieldObj.ddHeight:void 0;if(isFieldHideForNodata&&optArray.length<=0)fieldCont.parents().closest(".zpl_secn").addClass("DNI");else{void 0==appendTo&&(appendTo=fieldCont.parents(".zpl_mdl").length>0?fieldCont.parents(".zpl_mdl"):settingsPage.container),void 0==dataMapping&&((dataMapping={}).label="label",dataMapping.value="value",groupBy&&(dataMapping.optgroupLabel="groupBy"));var options={};options.placeholder=placeholder,"function"==typeof onChangeCb&&(options.change=onChangeCb),options.dataMapping={label:dataMapping.label,value:dataMapping.value},groupBy&&(options.dataMapping.optgroupLabel=dataMapping.optgroupLabel),options.dropdownList={appendTo:appendTo,fitForElement:!0},ddHeight&&(options.dropdownList.height=ddHeight),options.isTextHTMLEncoded=isTextHTMLEncoded,void 0!=defVal&&(options.selectedValue=defVal),options.search={by:"label",highlightKeyword:!0},options.showSearchField=!0,options.randomDropdownListId=!0,optArray.length>0?ZPeopleComponents.select(fieldCont,options).addOption(optArray):ZPeopleComponents.select(fieldCont,options),ZPeopleComponents.select(fieldCont).setValue(defVal)}}}},LeaveAdminOpers.ZPeopleComponents.TokenField={init(fieldObj){if(fieldObj&&fieldObj.container){var fieldCont=fieldObj.container,optArray=void 0!=fieldObj.optArray?fieldObj.optArray:[],placeholder=fieldObj.placeholder?fieldObj.placeholder:"",defVal=fieldObj.defVal,onChangeCb=void 0!=fieldObj.onChangeCb?fieldObj.onChangeCb:"";if(fieldObj.isFieldHideForNodata&&optArray.length<=0)fieldCont.parents().closest(".zpl_secn").addClass("DNI");else{var options={};options.data=optArray,options.placeholder=placeholder,"function"==typeof onChangeCb&&(options.change=onChangeCb),LVSettings.Util.TokenField.initialize(fieldCont,options),void 0!=defVal&&LVSettings.Util.TokenField.setValues(fieldCont,defVal)}}},empFieldInit(cont){LVSettings.Util.userInputSelect2(cont.find("[name=employee]"),!1,void 0,cont.find(".zpl_fltrlst")),cont.find("[name=employee]").off("ztokenfieldchange").on("ztokenfieldchange",function(event){var empSelLen=LVSettings.Util.TokenField.getValues(cont.find("[name=employee]")).length,incDRep=cont.find("[name=incDReportsOnly]").parent().parent();0==empSelLen?incDRep.removeClass("DNI"):incDRep.addClass("DNI")})}},LeaveAdminOpers.ZPeopleComponents.TimeField={init(fieldObj){if(fieldObj&&fieldObj.container){var fieldCont=fieldObj.container,onChangeCB=fieldObj.onChangeCB,spinendCB=fieldObj.spinendCB,minStep=fieldObj.minStep,width=fieldObj.width,format=fieldObj.format,appendTo=void 0!=fieldObj.appendTo?fieldObj.appendTo:fieldCont.parents(".zpl_mdl").length>0?fieldCont.parents(".zpl_mdl"):settingsPage.container,options={width:void 0==width?100:width,clearButton:"none",format:void 0!=format?format:fieldCont.attr("isTime")&&!Leave.Util.is24HrTimeFormat()?"hh:mm tt":"HH:mm",placeholder:{hour:"00",minute:"00"},pickerOptions:{appendTo:appendTo},max:fieldCont.attr("isTime")?void 0:Leave.Util.convertMinutestoTime(fieldCont.attr("maxmins"))};void 0!=fieldCont.data("value")&&(options.value=fieldCont.data("value")),!isNaN(minStep)&&(options.minuteStep=minStep),"function"==typeof onChangeCB&&(options.change=function(event){onChangeCB(event)}),"function"==typeof spinendCB&&(options.spinend=function(event){spinendCB(event)}),ZPeopleComponents.timefield(fieldCont,options)}}},LeaveAdminOpers.ZPeopleComponents.DateField={init(fieldObj){if(fieldObj&&fieldObj.container){var fieldCont=fieldObj.container,pickerDateCB=fieldObj.pickerDateCB,appendTo=void 0!=fieldObj.appendTo?fieldObj.appendTo:fieldCont.parents(".zpl_mdl").length>0?fieldCont.parents(".zpl_mdl"):settingsPage.container,value=fieldObj.value,dateOptions={calendarIcon:!0,format:dateFmt,picker:!0,spinButtons:"none",clearButton:"none",placeholder:ZPI18N.getString("zp.date"),pickerOptions:{appendTo:appendTo}};void 0!=value&&(dateOptions.value=value),"function"==typeof pickerDateCB&&(dateOptions.pickerdateselect=function(){pickerDateCB(this)}),ZPeopleComponents.datefield(fieldCont,dateOptions)}}},LeaveAdminOpers.ZPeopleComponents.DateRangePicker={init(fieldObj){if(fieldObj&&fieldObj.container){var fieldCont=fieldObj.container,onChangeCB=fieldObj.onChangeCB,fromvalueselectCB=fieldObj.fromvalueselectCB,beforeopenCB=fieldObj.beforeopenCB,clearCB=fieldObj.clearCB,appendTo=void 0!=appendTo?appendTo:fieldCont.parents(".zpl_mdl").length>0?fieldCont.parents(".zpl_mdl"):settingsPage.container,selectionType=fieldObj.selectionType,rangePickerOpts={forElement:"#rangePicker",format:dateFmt,pickerOptions:{appendTo:appendTo},selectionType:void 0!=selectionType?selectionType:"continuous"};"function"==typeof onChangeCB&&(rangePickerOpts.change=function(event,ui){onChangeCB(event,ui)}),"function"==typeof fromvalueselectCB&&(rangePickerOpts.fromvalueselect=function(event,ui){fromvalueselectCB(event,ui)}),"function"==typeof beforeopenCB&&(rangePickerOpts.beforeopen=function(event){beforeopenCB(event)}),"function"==typeof clearCB&&(rangePickerOpts.clear=function(){clearCB(event)}),ZPeopleComponents.daterangepicker(fieldCont,rangePickerOpts)}}};var LeaveApplications={};(LeaveApplications={refresh:void 0,sortBy:0,sortType:0,status:{pending:"-1",rejected:"0",approved:"1",cancelled:"2",all:"20"},dataSelect:{all:"3",mydep:"2",self:"1",sub:"4",dataadmin:"5",dirsub:"6",leaveadmin:"7"},regEvents:function(){settingsPage.container.find(".zpl_rgt[systemviewonly]:not(.DNI)").find("[name=dataSelect],[name=status]").off("zselectchange").on("zselectchange",function(ele,data){data.fromUI&&LeaveAdminOpers.Util.Footer.searchcallback()}),settingsPage.container.find(".zpl_rgt[systemviewonly]:not(.DNI)").find("ul>li").off("click").on("click",function(ele,data){$(this).siblings().removeClass("zpl_act"),$(this).addClass("zpl_act"),LeaveAdminOpers.Util.Footer.searchcallback()}),settingsPage.container.find(".zpl_rgt[systemviewonly]:not(.DNI)").find("[name=addrequest]").off("click").on("click",function(){window.location.href=LeaveAdminOpers.Router.getRecordUrl("add",void 0)}),settingsPage.container.find(".zpl_icncnt").find("i").off("click").on("click",function(){LeaveAdminOpers.Util.toggleSort(this)}),settingsPage.container.find("#lvfilter").find("[name=employeeStatus]").off("zselectchange").on("zselectchange",LeaveAdminOpers.Util.regFilterOnchangeEvents)},View:{getParams:function(){var params={key:"applications_view"};let dataele=settingsPage.container.find(".zpl_rgt:not(.DNI)").find("[name=dataSelect]");return LVUtil.Tab.isMyPage()?params.viewMode=1:LVUtil.Tab.isTeamPage()?LVUtil.showAllDataForNonAdmin()?params.dataSelect=dataele.length>0?ZPeopleComponents.select(dataele).getValue():3:(params.dataSelect=settingsPage.container.find(".zpl_rgt:not(.DNI)").find("ul>li.zpl_act").attr("value"),2==params.dataSelect?params.viewMode=4:params.viewMode=3):LVUtil.Tab.isUserPage()||LVUtil.Tab.isOpersUserPage()?params.viewMode=5:params.dataSelect=dataele.length>0?ZPeopleComponents.select(dataele).getValue():3,LeaveAdminOpers.Util.filterParams(params),LVUtil.Tab.isOpersPage()&&!LVUtil.Tab.isOpersUserPage()||delete params.dataSelect,params.conreqcsr=csrfToken,params},getStaticParams:function(params){var header=$(".zpl_rgt",settingsPage.container);$(header).find("select[name]").each(function(){var name=$(this).attr("name"),filter=LeaveApplications[name];filter&&(params[name]=filter[ZPeopleComponents.select($(this)).getValue()])})},get:function(){LeaveApplicationListing.prepareView(!0);var params=LeaveApplications.View.getParams();ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.approval_configured?params.status=ZPeopleComponents.select(settingsPage.container.find(".zpl_rgt:not(.DNI)").find("[name=status]")).getValue():($("#approval_col",settingsPage.container).remove(),$("[name=status]",settingsPage.container).next().hide()),LeaveAdminOpers.Util.sortParams(params),LeaveApplications.View.getStaticParams(params);var data_footer=$("#systemview_pagination",settingsPage.container),getMore=($(data_footer.find("select")),$(".pagecount",data_footer));params.sIndx=getMore.find("span").data("sIndx"),params.limit=getMore.find("span").data("eIndx"),LeaveAdminOpers.Util.showHideNoData(!1),$("tbody#recordContainer",settingsPage.container).empty(),LeaveAdminOpers.Util.removeLoading(),LeaveAdminOpers.Util.appendLoading();var rowCnt=0;ZPeople.Request.send(LeaveAdminOpers.viewUrl,params,function(resp){LeaveApplications.refresh=!1,LeaveApplications.View.construct(resp),LeaveAdminOpers.Util.removeLoading(),resp.count&&(data_footer.find("a#recCount").data("totalCount",resp.count),resp.count<=ZPeopleComponents.select(data_footer.find("select")).getValue()&&data_footer.find("a#recCount").text(resp.count)),rowCnt=params.sIndx+resp.data.length-1,LeaveAdminOpers.Util.Footer.setNavi(params.sIndx,rowCnt)},{},LeaveApplications.View.showErrorMsg)},construct:function(response){var data_arr=response.data;let addbtn=settingsPage.container.find(".zpl_rgt[systemviewonly]:not(.DNI)").find("[name=addrequest]");response.allowAdd?addbtn.show():addbtn.hide();ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isdataadmin;var show_approval=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.approval_configured;if(data_arr&&0!=data_arr.length){var tempDoc=document.createDocumentFragment();$.each(data_arr,function(){var tr=ZP.create("tr",{class:"CP"});$(tr).data("id",this.rec_id+"");var action={viewOpt:function(ele){window.location.href=LeaveAdminOpers.Router.getRecordUrl("view",ele.getAttribute("recordId"))}};this.allowedit&&(action.editOpt=function(ele){window.location.href=LeaveAdminOpers.Router.getRecordUrl("edit",ele.getAttribute("recordId"))}),this.allowdelete&&(action.deleteOpt=LeaveAdminOpers.Util.deleteWarning),tr.appendChild(LeaveAdminOpers.Util.getDropDownActionsTD(action,this.rec_id));var chxTd=ZP.create("td",{style:"text-align: center"}),chxLabel="";if(this.allowdelete?(chxLabel=ZP.create("div",{class:"zcheckbox"})).appendChild(ZP.create("input",{type:"checkbox",name:"check",class:"zcheckbox__helper"})):(chxLabel=ZP.create("div",{class:"zcheckbox disabled"})).appendChild(ZP.create("input",{type:"checkbox",name:"check",class:"zcheckbox__helper",disabled:!0})),chxLabel.appendChild(ZP.create("label",{class:"zcheckbox__label"})),chxTd.appendChild(chxLabel),tr.appendChild(chxTd),show_approval){var approvalTd=ZP.create("td");LeaveAdminOpers.Util.getStatusTd(approvalTd,this.approval_status),tr.appendChild(approvalTd)}var nameTd=ZP.create("td"),nameDiv=ZP.create("div",{class:"zpl_em"}),nameSubDiv2=nameDiv.appendChild(ZP.create("div",{class:"zpl_emdts"})).appendChild(ZP.create("div",{class:"tooltip-js w150","data-title-position":"bottom",title:this.emp_name}));nameSubDiv2.appendChild(ZP.create("em",{text:this.emp_id+" -"})),nameSubDiv2.appendChild(ZP.create("b",{text:this.emp_name})),nameTd.appendChild(nameDiv),tr.appendChild(nameTd);var ltTd=ZP.create("td"),ltDiv=ZP.create("div",{class:"tooltip-js","data-title-position":"bottom",title:ZPeople.decodeTxt(this.ltyp_name)}),ltSpan=ZP.create("span",{text:ZPeople.decodeTxt(this.ltyp_name),class:"txttrim w150"});ltDiv.appendChild(ltSpan),ltTd.appendChild(ltDiv),tr.appendChild(ltTd),tr.appendChild(ZP.create("td",{text:Leave.Type.text(this.ltyp_type)}));var recordView=ZP.create("td");recordView.appendChild(document.createTextNode(this.from+" - "+this.to)),tr.appendChild(recordView),tr.appendChild(ZP.create("td",{text:this.leavetaken+" "+this.leaveunit})),tr.appendChild(ZP.create("td",{text:this.dateofrequest?this.dateofrequest:""})),tempDoc.appendChild(tr)});var data_tbody=$("tbody#recordContainer",settingsPage.container);data_tbody.parents("table").find("thead").show(),data_tbody.html(""),data_tbody.append(tempDoc),LeaveAdminOpers.Util.showHideNoData(!1),$("#systemview_pagination",settingsPage.container).removeClass("DNI"),settingsPage.container.data("isreg",!0),settingsPage.container.find("tbody#recordContainer").off("click").on("click","div.zcheckbox",function(){var data_body=$("tbody#recordContainer",settingsPage.container),status=!0,showDelete=!1,swtched=$(this).find("input[type=checkbox]");swtched.prop("checked",!swtched.prop("checked")),data_body.find("input:checkbox").each(function(){$(this).is(":checked")?showDelete=!0:status=!1}),status?$(settingsPage.container.find(".headerSelect")).attr("checked","checked").prop("checked",!0):$(settingsPage.container.find(".headerSelect")).attr("checked","").prop("checked",!1),LeaveAdminOpers.Util.showBulkDelete(showDelete)}),settingsPage.container.find("table > thead").find("#systemview_header_row").off("click").on("click","div.zcheckbox",function(){var data_body=$(".zpl_tblres",settingsPage.container),swtched=$(this).find("input[type=checkbox]");swtched.prop("checked",!swtched.prop("checked"));var status=$(settingsPage.container.find(".headerSelect")[0]).is(":checked");data_body.find("tbody#recordContainer").find("input:checkbox").each(function(){$(this).parent().hasClass("disabled")||(this.checked=status)}),LeaveAdminOpers.Util.showBulkDelete(status)});var tbody=settingsPage.container.find(".zpl_rgtcnt table tbody#recordContainer");$(tbody).on("click","td",function(){if(0==$(this).find("i,input,button").length){var rec_id=$(this).closest("tr").data("id");window.location.href=LeaveAdminOpers.Router.getRecordUrl("view",rec_id)}})}else{LeaveAdminOpers.Util.showHideNoData(!0),$("#systemview_pagination",settingsPage.container).addClass("DNI"),$("tbody#recordContainer",settingsPage.container).parents("table").find("thead").show()}},showErrorMsg:function(){ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.leave.view.applications.errormsg")),LeaveAdminOpers.Util.removeLoading()}},isPageURLChanged(prevHash,nextHash){let prevHashArr=prevHash.split("/"),prevHashTab=prevHashArr[prevHashArr.length-1];-1!=prevHash.indexOf("user/applications")?prevHashTab="userapplications":-1!=prevHash.indexOf("mydata/applications")?prevHashTab="mydataapplications":-1!=prevHash.indexOf("team/applications")&&(prevHashTab="teamapplications");let prevMode=prevHashArr[0],nextTabArr=nextHash.split("/"),nextHashTab=nextTabArr[nextTabArr.length-2];-1!=nextHash.indexOf("user/applications")?nextHashTab="userapplications":-1!=nextHash.indexOf("mydata/applications")?nextHashTab="mydataapplications":-1!=nextHash.indexOf("team/applications")&&(nextHashTab="teamapplications");let nextMode=nextTabArr[0];prevHashTab==nextHashTab&&prevMode==nextMode||(ZP5Views.restSystemFilterZC(),ZP5Views.restViewPage(),$("#"+prevHash.replaceAll("/","-")).data("isreg",!1),LeaveApplications.refresh=!0)}}).Import={construct:function(){ZP5Import.init("leave")}};var LeaveApplicationListing={init:function(){return LeaveAdminOpers.initComponents(),{header:"",dataCallback:LeaveApplications.View.get,formId:ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.formid,selActionHTML:LeaveApplicationListing.getMultiSelectHtml,systemViewName:ZPeople.Module.MODULE_DATA.leavetracker.formDisplayName,onchangeCallback:LeaveApplicationListing.prepareView,recDeleteCallback:LeaveApplicationListing.deleteBulkWarning,tableName:"P_EmployeeLeave"}},prepareView:function(isSystem){var table=settingsPage.container.find("#viewsContainer"),topActions=settingsPage.container.find("#viewActionsContainer");isSystem=void 0==isSystem?ZP5Views.isSystemView():isSystem,settingsPage.container.removeClass("zpl_fltr_flt"),isSystem?(table.find("#fieldHeader").addClass("DN"),table.find("#systemview_header_row").removeClass("DNI"),settingsPage.container.find("#viewFooter,#filterContainer").addClass("DNI"),topActions.children(":not(systemviewonly):not(:first-child)").addClass("DNI"),settingsPage.container.find("[systemviewonly]").removeClass("DNI"),topActions.children("#zp_empty_data:not(systemviewonly)").addClass("DNI"),topActions.find("#filterButton").addClass("DNI"),settingsPage.container.find("#systemview_pagination").removeClass("DNI"),settingsPage.container.removeClass("zpl_fltr_lft"),settingsPage.container.removeClass("zpl_colmaxwd"),settingsPage.container.parents().closest("#page-wrapper").addClass("zpl_btmpgn"),settingsPage.container.attr("class","zpl_act zpl_tblfxd")):(LeaveApplications.refresh=!0,BrdCrumbFilterView.reset(settingsPage.container),table.find("#fieldHeader").removeClass("DN"),table.find("#systemview_header_row").addClass("DNI"),settingsPage.container.find("#viewFooter,#filterContainer").removeClass("DNI"),topActions.children(":not(systemviewonly):not(:first-child)").removeClass("DNI"),settingsPage.container.find("[systemviewonly]").addClass("DNI"),topActions.children("#zp_empty_data:not(systemviewonly)").removeClass("DNI"),topActions.find("#filterButton").removeClass("DNI"),settingsPage.container.find("#systemview_pagination").addClass("DNI"),settingsPage.container.data("isreg",!1))},getMultiSelectHtml:function(curViewObj){var needDeleteBtn=!(curViewObj.isApproverViewType(curViewObj.getViewId())&&!curViewObj.isAdmin()),mhtml="<div>";mhtml+=needDeleteBtn?'<button class="zlabel zlabel--red zlabel--medium" id="recordDelete" onclick="">'+ZPI18N.getString("zp.delete")+"</button>":"",LVUtil.Tab.isApplications()&&(mhtml+='<button class="zlabel zlabel--outline zlabel--medium DN" id="recordApproveReject" ><a>'+ZPI18N.getString("zp.clicktoapprovereject")+"</a></button>"),mhtml+='</div><i class="PI_cls" onclick="LeaveAdminOpers.Util.showBulkDelete(false);"></i>',curViewObj.container.find("#viewActionsContainer").find("#recordActionsContainer").html(mhtml),curViewObj.isApproverViewType()&&(curViewObj.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordApproveReject").removeClass("DN"),curViewObj.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordApproveReject").on("click",function(){var formId=ZP5Form.CONF.formId;ZPApprovals.viewApproveActionPopup(formId)})),needDeleteBtn&&curViewObj.container.find("#viewActionsContainer").find("#recordActionsContainer").find("#recordDelete").off().on("click",function(){curViewObj.deleteRecordsConfirmation()})},deleteBulkWarning:function(curViewObj,recIds){var header,info;header=ZPI18N.getString("zp.delete")+" "+ZPI18N.getString("zp.sleave")+"?",info=ZPI18N.getString("zp.leave.operations.deleteinfo",[ZPI18N.getString("zp.leave")])+"";var bulkDeleteModal=new DeleteAlertMessage;bulkDeleteModal.title=header,bulkDeleteModal.despcription=info,bulkDeleteModal.yesButtonText=ZPI18N.getString("zp.confirm"),bulkDeleteModal.cancelButtonText=ZPI18N.getString("zp.cancel"),bulkDeleteModal.callback=function(){LeaveApplicationListing.deleteRecords(recIds,curViewObj),bulkDeleteModal.close()},bulkDeleteModal.show()},deleteRecords:function(recIds,curViewObj){var params={key:"delete",id:recIds,page:"applications"};params[csrfParamName]=csrfToken,$.post("/leave_common_action.zp",params,function(data){"success"===data.status&&LeaveAdminOpers.Util.showBulkDelete(!1),curViewObj.reloadView(curViewObj.getFormId(),ZP5Views.getSelectedView(curViewObj.getViewId()),!0)})}},Holidays={init:function(){Holidays.View.get()},regEvents:function(){$("[name=addholidays]",settingsPage.container).on("click",function(){Holidays.Add.html(0)}),$("[name=applFor]",settingsPage.container).off("zselectchange").on("zselectchange",function(){0==settingsPage.container.find(".zpl_rgtcnt").find(".zpl_tblres").find(".zpl_tbl").length&&LeaveAdminOpers.constructTableHeader(),Holidays.View.get()}),LeaveAdminOpers.Util.regPager(settingsPage.container.find(".ZP-YearPagerUnTie")),$("[name=pushgcal]",settingsPage.container).on("click",function(){Holidays.GCalSync.showGoogleSyncModal()}),settingsPage.container.find("[name=periodV2]").parent().parent().addClass("DNI"),settingsPage.container.find("[name=from]").parent().parent().addClass("DNI"),settingsPage.container.find("[name=to]").parent().parent().addClass("DNI"),AppExc.getApplicableIds()},appendMoreOptionMenu:function(){$("#addholidaysMoreOptMenu").length>0&&(ZPeopleComponents.menu($("#addholidaysMoreOptMenu")).destroy(),$("#addholidaysMoreOptMenu").remove());var mhtml='<div id="addholidaysMoreOptMenu" class="zpl_drpdwn zmenu"><ul><li onclick="Holidays.Gallery.setHashUrl()"><span class="zmenu__text">'+ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name+" "+ZPI18N.getString("zp.gallery")+"</span></li></ul></div>";settingsPage.container.append(mhtml),ZPeopleComponents.menu("#addholidaysMoreOptMenu",{forElement:settingsPage.container.find("#addHolidaysOpts"),contentType:"text",appendTo:Layout.Page.pageId})},showAddHolidaysMoreOptn(){ZPeopleComponents.menu("#addholidaysMoreOptMenu").show()},getHolidayTypefromId:function(field){var leaveData=ZPeople.Module.MODULE_DATA.leavetracker;if(leaveData&&void 0!=leaveData.holiday_filterops){var hClassArr=leaveData.holiday_filterops.holidayClassification;if(hClassArr&&hClassArr.length>0)for(let ind=0;ind<hClassArr.length;ind++)if(hClassArr[ind].id==field)return ZPeople.decodeTxt(hClassArr[ind].name)}},destroyZComp:function(){var ele=settingsPage.container.find("#holidays_add_edit_view");ele.find("[name='numberofdays']").length>0&&ZPeopleComponents.select(ele.find("[name='numberofdays']")).destroy(),1==ele.find("#holidayClassification").length&&ZPeopleComponents.select(ele.find("#holidayClassification")).destroy(),ele.find("#sliderSbt").removeClass("disabled")},Gallery:{countries:[{id:"in",text:"India"},{id:"us",text:"USA"},{id:"uk",text:"United Kingdom"},{id:"jp",text:"Japan"},{id:"au",text:"Australia"},{id:"ca",text:"Canada"},{id:"de",text:"Germany"},{id:"fr",text:"France"},{id:"nl",text:"Netherlands"},{id:"it",text:"Italy"},{id:"sa",text:"Saudi Arabia"},{id:"ph",text:"Philippines"},{id:"my",text:"Malaysia"},{id:"lk",text:"Sri Lanka"},{id:"vn",text:"Vietnam"},{id:"sg",text:"Singapore"},{id:"es",text:"Spain"},{id:"mx",text:"Mexico"},{id:"br",text:"Brazil"},{id:"nz",text:"New Zealand"},{id:"ru",text:"Russia"}],modal:void 0,setHashUrl(){var url=settingsUrlProps.niceUrlArr.slice(0,settingsUrlProps.niceUrlArr.length).join("/");-1===url.indexOf("holiday/gallery")&&(window.location.href="#"+url+"/gallery")},closeCallback(){var url=settingsUrlProps.niceUrlArr.slice(0,settingsUrlProps.niceUrlArr.length).join("/");-1!==url.indexOf("holiday/gallery")&&(-1!==url.indexOf("operations")?window.location.href="#"+settingsUrlProps.niceUrlArr[0]+"/"+settingsUrlProps.niceUrlArr[1]+"/"+settingsUrlProps.niceUrlArr[2]:window.location.href="#"+settingsUrlProps.niceUrlArr[0]+"/"+settingsUrlProps.niceUrlArr[1])},html(){var _this=Holidays.Gallery,modalParams={id:"holiday_gallery",cardId:"holiday_gallery_modal"};modalParams.closeCallback=Holidays.Gallery.closeCallback;var viewModal=new sliderModal(ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name+" "+ZPI18N.getString("zp.gallery"),modalParams);viewModal.largeSize=!0,viewModal.construct(null,'<button class="zlabel zlabel--blue zlabel--medium" onclick="Holidays.Gallery.bulkAddModal()">'+ZPI18N.getString("zp.addcomponents",[ZPI18N.getString("zp.cap.selected")])+" "+ZPI18N.getString("zp.holidays")+'</button><button id="sliderCancel" type="button" class="zlabel zlabel--outline zlabel--medium" tabindex="0">'+ZPI18N.getString("zp.close")+"</button>"),viewModal.setCloseCallback(function(){Holidays.Gallery.closeCallback(),viewModal.remove()});var modalBodyHtml='<div class="zpl_container"> <div class="zpl_iwrpr"><div class="zpl_iwrprrgt"><div class="zpl_act">';modalBodyHtml+='<div class="zpl_btnmnu"><div class="zpl_lft"><select name="country" class="select-js" style="display:none;width:200px">'+_this.countries.map(c=>'<option value="'+c.id+'">'+c.text+"</option>").join("")+"</select></div>",modalBodyHtml+='<div  id="zp_lvCalOutCont" class="zpl_cntrdv ZP-YearPager"> <div class="zpl_inav"><i class="PI_alft" aria-label="'+ZPI18N.getString("zp.common.previousmon")+'" tabindex="0"></i> <i class="PI_monthly"></i><i class="PI_argt" aria-label="'+ZPI18N.getString("zp.common.nextmon")+'" tabindex="0"></i></div><b class="ZPCalNav"></b></div> <div class="zpl_rgt"></div>',modalBodyHtml+="</div>",modalBodyHtml+='<div class="zpl_rgtcnt"><div class="zpl_tblres" id="zp_holiday_gallery_table"><table class="zpl_tbl"><thead><tr></th><th style="width:50px"><div class="zcheckbox"><input type="checkbox" name="check" class="zcheckbox__helper" id="zp_cb_all"><label class="zcheckbox__label"></label></div></th><th style="min-width:500px">'+ZPI18N.getString("zp.holiday")+'</th><th style="min-width:150px">'+ZPI18N.getString("zp.date")+'</th><th style="min-width:200px">'+ZPI18N.getString("zp.session")+'</th></tr></thead><tbody id="galleryList"></tbody></table></div></div></div></div>',modalBodyHtml+="</div></div></div></div></div>",_this.modal=settingsPage.container.find("#holiday_gallery"),_this.modal.find("#holiday_gallery_modal").html(modalBodyHtml),_this.closeModal=function(){viewModal.close()},Leave.Util.regPager(settingsPage.container.find("#holiday_gallery .ZP-YearPager")),settingsPage.container.find("tbody#galleryList").off("click").on("click","div.zcheckbox",function(){var data_body=$("tbody#galleryList",settingsPage.container),status=!0,showbulkAdd=!1,swtched=$(this).find("input[type=checkbox]");swtched.prop("checked",!swtched.prop("checked")),data_body.find("input:checkbox").each(function(){$(this).is(":checked")?showbulkAdd=!0:status=!1}),status?$(settingsPage.container.find("#zp_cb_all")).attr("checked","checked").prop("checked",!0):$(settingsPage.container.find("#zp_cb_all")).attr("checked","").prop("checked",!1),_this.showHideBulkAdd(showbulkAdd)}),settingsPage.container.find("#zp_holiday_gallery_table").find("table > thead").off("click").on("click","div.zcheckbox",function(){var data_body=$("#zp_holiday_gallery_table",settingsPage.container),swtched=$(this).find("input[type=checkbox]");swtched.prop("checked",!swtched.prop("checked"));var status=$(settingsPage.container.find("#zp_cb_all")[0]).is(":checked");data_body.find("tbody#galleryList").find("input:checkbox").each(function(){$(this).parent().hasClass("disabled")||(this.checked=status)}),_this.showHideBulkAdd(status)}),ZPeopleComponents.select(_this.modal.find("select[name=country]")).element.on("zselectchange",_this.load),_this.load();var modalParentDiv=Holidays.Gallery.modal.find("#holiday_gallery_modal").parent().parent();modalParentDiv.removeClass(),modalParentDiv.addClass("zpl_mdl zpl_mfull zpl_mopen")},load(){Holidays.Gallery.fetch()},fetch(){var countryValue=ZPeopleComponents.select(Holidays.Gallery.modal.find("select[name=country]")).getValue(),holidayTable=Holidays.Gallery.modal.find("table").find("#galleryList");holidayTable.empty(),settingsPage.container.find("#zp_holiday_gallery_table #zp_cb_all").prop("checked",!1),Holidays.Gallery.modal.find("#holiday_gallery_modal").find(".zpl_rgtcnt").find("#zp_page_loading").remove(),Holidays.Gallery.modal.find("#holiday_gallery_modal").find(".zpl_rgtcnt").append(ZPeople.LOADING_HTML);const currentYear=(new Date).getFullYear();var dateArr=settingsPage.container.find("#zp_lvCalOutCont .ZPCalNav")[0].innerText.split(" - ");from=dateArr[0],to=dateArr[1];var isCurrentYear=currentYear==new Date(Calendar.parseDate(from,uidateFormat)).getFullYear()&&currentYear==new Date(Calendar.parseDate(to,uidateFormat)).getFullYear();ZPeople.Request.send("listHolidayGallery.zp",{method:"gallery_list",country:countryValue,isCurrentYear:isCurrentYear},function(result){if(result){var holidaysData=result.holidays;holidaysData&&holidaysData.length>0&&($.each(holidaysData,function(ind,holidayDet){var row=ZP.create("tr"),chkbox='<td><div class="zcheckbox '+(holidayDet.isHolidayPresent?"disabled":"")+'"><input type="checkbox" name="check" class="zcheckbox__helper" id="zp_cb_each"><label class="zcheckbox__label"></label></div></td>';$(row).append(chkbox);var column=ZP.create("td",{text:holidayDet.name,width:"40%",id:"name"});$(row).append(column),(""==holidayDet.to||Holidays.View.checkGet(holidayDet.from,holidayDet.to))&&($.each(holidayDet.daydetails,function(idx,day){var datestd=ZP.create("td",{id:"fromto"}),sessiontd=ZP.create("td",{id:"session"}),daytxt=" "+day.day+" ",date=document.createTextNode(day.dis_date);$(datestd).append(date),$(datestd).append(ZP.create("em",{text:daytxt,style:"color:#999999"}));var select=ZP.create("select",{name:day.dis_date}),selectDiv=ZP.create("div",{class:"zpl_w140"});$(selectDiv).append(select),$(sessiontd).append(selectDiv);var optArray=Holidays.Operation.constructSessionOpts();LeaveAdminOpers.ZPeopleComponents.Select.init({container:$(sessiontd).find("select"),optArray:optArray,defVal:"0"}),$(row).append(datestd),$(row).append(sessiontd)}),$(holidayTable).append(row),holidayDet.isHolidayPresent&&$(row).css({opacity:.6,"pointer-events":"none"}))}),$.each(Holidays.Gallery.modal.find("#galleryList").find("tr").find("select"),function(){ZPeopleComponents.select($(this))}),Holidays.Gallery.modal.find("#holiday_gallery_modal").find(".zpl_rgtcnt").find("#zp_page_loading").remove())}})},bulkAddModal(){Holidays.Add.html(0,null,!0)},save(){var addHolidayCont=settingsPage.container.find("#holidays_add_edit_view").find("#moduleCards"),holidayClassification=ZPeopleComponents.select(settingsPage.container.find("[name=holidayclassification]")).getValue();if("-1"!=holidayClassification){Holidays.Operation.hideerror(addHolidayCont.find("select[name=holidayclassification]"));var restricted=Holidays.View.isRestrictedHoliday(holidayClassification),applFor=AppExc.constructAppValues(addHolidayCont,"#appToSec",Holidays.Add.appElementsKey);applFor.location&&1==applFor.location.length&&"0"==applFor.location[0]&&(applFor.location=Object.keys(AppExc.appElements.locationList));var location=applFor.location;applFor.shifts&&1==applFor.shifts.length&&"0"==applFor.shifts[0]&&(applFor.shifts=Object.keys(AppExc.appElements.shiftList));var shifts=applFor.shifts,description=addHolidayCont.find("textarea[name=remark]"),remarks=description.val()?description.val():"",reminderday=addHolidayCont.find("select[name=numberofdays]"),remind_data={};remind_data.remindday=ZPeopleComponents.select(reminderday).getValue();var holidayconf=remind_data,holiDets=[];Layout.Page.container.find("#galleryList").find("tr").each(function(){var row=$(this);if(row.find('input[type="checkbox"]').is(":checked")){var daydetail={},holiObj={},holidayName=row.find("#name").eq(0).text(),dateArr=row.find("#fromto").eq(0).text().split(" "),fromDate=dateArr[0],toDate=dateArr[dateArr.length-3];row.find("#session select").each(function(){var date=$(this).attr("name"),sessionVal=ZPeopleComponents.select($(this)).getValue().split("-");daydetail[date]=restricted?{ishalfday:!1,session:0}:{ishalfday:.5==sessionVal[0],session:sessionVal[sessionVal.length-1]}}),holidayName&&fromDate&&toDate&&(holiObj.name=holidayName,holiObj.fromDate=fromDate,holiObj.toDate=toDate,holiObj.daydetails=daydetail,holiDets.push(holiObj))}}),settingsPage.container.find("#holidays_add_edit_view").find(".zpl_mfoter").find("#sliderSbt").addClass("disabled"),Holidays.Gallery.updateHolidays(holiDets,location,shifts,restricted,holidayClassification,holidayconf,remarks)}else Holidays.Operation.showerror(addHolidayCont.find("select[name=holidayclassification]"),ZPI18N.getString("zp.entervalidoption",[ZPI18N.getString("zp.classification")]))},updateHolidays(holiDets,locationIds,shiftIds,isRes,holidayClassification,holidayconf,remark){this.params={method:"update_gallery",conreqcsr:csrfToken,holiDets:JSON.stringify(holiDets),location:JSON.stringify(locationIds),shifts:JSON.stringify(shiftIds),restricted:isRes,holidayClassification:holidayClassification,holidayconf:JSON.stringify(holidayconf),remark:remark},ZPeople.Request.send("update_holiday_gallery.zp",this.params,function(resp){resp.success?(ModuleComp.Msg.showSuccessMsg(" "+ZPI18N.getString("zp.cap.selected")+" "+ZPI18N.getString("zp.holidays").toLowerCase()+" : "+holiDets.length+"<br> "+ZPI18N.getString("zp.holiday.gallery.addInfo")+" : "+resp.noof_add),settingsPage.container.find("#holidays_add_edit_view").hide(),Holidays.Gallery.fetch(),Holidays.Gallery.showHideBulkAdd(!1),Holidays.View.get()):settingsPage.container.find("#holidays_add_edit_view").find(".zpl_mfoter").find("#sliderSbt").removeClass("disabled")})},showHideBulkAdd(show){show||$(".zpl_tblres",settingsPage.container).find("input:checkbox").each(function(){$(this).parent().hasClass("disabled")||(this.checked=!1)})}},View:{holidayData:{},get:function(){LVUtil.Tab.isHolidayCalendar()?Holidays.View.Calendar.render():Holidays.View.list()},Calendar:{createContainer(){Holidays.View.Calendar.calObj=void 0;let html='<div id="zp_holidayCalOutCont"><div class="zpl_btnmnu"> <div class="zpl_lft"></div> <div class="zpl_cntrdv"> <div class="zpl_inav"><i class="PI_alft"></i> <i class="PI_monthly"></i><i class="PI_argt"></i> </div> <div><b class="ZPCalNav mon" id="calmonth"></b></div> </div> <div class="zpl_rgt"><div class="grpbtn"><i class="PI_listview" title="'+ZPI18N.getString("zp.listview")+'" onclick="Holidays.View.switchView();"></i><i class="PI_monthly zpl_act" title="'+ZPI18N.getString("zp.calendarview")+'" onclick="Holidays.View.switchView(1)"></i></div>';html+='<div><select class="select-js" name="applFor"></select></div>',ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isadmin&&(html+='<button class="zlabel zlabel--blue zlabel--medium ZP-Add" onclick="Holidays.Add.html(0);" >'+ZPI18N.getString("zp.addcomponents",[ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name])+"</button>"),html+="</div> </div>",html+='<div class="zpl_rgtcnt" id="zp_lvCalOutCont"><div id="caldiv" class="zpl_calndrvw"></div></div></div>',Layout.Page.container.html(html);let params=LeaveAdminOpers.getPageDetails(),optArray=LeaveAdminOpers.getOptionsForFilter("applFor",ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops,params);LeaveAdminOpers.ZPeopleComponents.Select.init({container:settingsPage.container.find("[name=applFor]"),optArray:optArray,defVal:1,groupBy:!0,ddHeight:"500px"}),$("[name=applFor]",settingsPage.container).off("zselectchange").on("zselectchange",function(){Holidays.View.Calendar.render(!0)}),Layout.Page.container.data("clickregistered")||(Layout.Page.container.on("click",Holidays.View.Calendar.closeDateCard),Layout.Page.container.data("clickregistered",!0))},render(skipContainerCreation){!skipContainerCreation&&this.createContainer();var calObj=Holidays.View.Calendar.calObj;calObj?NewCalendar.constructCalendar(Holidays.View.Calendar.calObj):((calObj=new NewCalendar.calObj).curYear=(new Date).getFullYear(),calObj.curMonth=(new Date).getMonth(),calObj.calcontId="monthcalendardiv",calObj.outerdivId="zp_holidayCalOutCont",calObj.daysObj={empty:"zpcalempty",weekend:"zpcalweek",day:"zpcaldays",today:"zpcaltoday",leave:"zpcalholi"},calObj.callback=_.debounce(Holidays.View.Calendar.load,200),calObj.divid="caldiv",calObj.tdonclick=null,calObj.totaldata=!1,calObj.prearrow="PI_alft",calObj.nextarrow="PI_argt",Leave.Util.reg(),Holidays.View.Calendar.calObj=calObj,NewCalendar.initCalendar(calObj))},load:function(){var params={method:"calendar_view",reqFor:"calendar_view",month:Holidays.View.Calendar.calObj.curMonth,year:Holidays.View.Calendar.calObj.curYear,get_upcoming:!1},applFor=ZPeopleComponents.select(settingsPage.container.find("[name=applFor]")).getValue(),groupBy=ZPeopleComponents.select(settingsPage.container.find("[name=applFor]"))._selected[0].optData.groupBy;0==applFor||1==applFor?params.applicableFor=applFor:"Location"==groupBy?params.location=applFor:"Shift"==groupBy?params.shift=applFor:"Holiday Classification"==groupBy&&(params.holidayClassification=applFor),ZPeople.Request.send("listHolidays.zp",params,Holidays.View.Calendar.construct,{},Leave.View.Calendar.showErrorMsg)},construct:function(dataArr,params){if(Holidays.View.Calendar.calObj.curMonth==params.month&&Holidays.View.Calendar.calObj.curYear==params.year){var holiday_data=dataArr.data,leaves=Holidays.View.Calendar.constructHolidayView(holiday_data);NewCalendar.populateData(Holidays.View.Calendar.calObj,leaves),Layout.Page.container.find(".calbrmre").on("click",function(event){$(event.target).attr("popup","active"),Holidays.View.Calendar.showDateCard($(this),holiday_data)})}},constructHolidayView:function(resultData){var holiday_obj={};for(var date in resultData){for(var date_detail=resultData[date],holiday_count=Object.keys(date_detail).length,display_holiday_count=holiday_count>3?2:holiday_count,cal_date_txt="",cal_date=date.slice(-2),i=0;i<display_holiday_count;i++){var holiday=date_detail[i],isadmin=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isadmin,sessionClass=0==holiday.session?"zpl_holiBgbdr":1==holiday.session?"zpl_holibrdrd zpl_halffst":"zpl_holibrdrd zpl_halfsec";sessionClass=isadmin?"CP "+sessionClass:sessionClass;var onClick=isadmin?"onclick='Holidays.ViewHoliday.html(\""+holiday.id+"\")'":"";cal_date_txt+="<div class='zpl_shftdts "+sessionClass+" "+(holiday.isOptional?" zpl_rholiBgbdr ":"")+"' "+onClick+" title='"+holiday.name+"'> <span>"+holiday.name+"</span> </div>"}holiday_count>3&&(cal_date_txt+='<a class="calbrmre" date="'+date+'">'+(holiday_count-2)+" "+ZPI18N.getString("zp.more")+" </a>"),holiday_obj[cal_date]={date:cal_date,txt:cal_date_txt}}return holiday_obj},showDateCard:function(more_tag,holiday_data){Layout.Page.container.find("[id*=holiday_card_]").addClass("DN");var date=more_tag.attr("date");if(Layout.Page.container.find("[id=holiday_card_"+date+"]")[0]){(card=Layout.Page.container.find("[id=holiday_card_"+date+"]")).removeClass("DN"),Holidays.View.Calendar.setPositionForCard(card)}else{var card=Holidays.View.Calendar.constructDateCard(holiday_data,date,0);more_tag.after(card),card=more_tag.parent().find("#holiday_card_"+date),Holidays.View.Calendar.setPositionForCard(card),card.data("data",{sIndx:0,date:date}),more_tag.parent().find(".IC-cls").on("click",function(){$(this).parent().addClass("DN")})}},closeDateCard:function(event){var object=$(event.target);object.attr("popup")&&"active"===object.attr("popup")||(Layout.Page.container.find("[id*=holiday_card_]").addClass("DN"),object.attr("popup","inactive"))},setPositionForCard:function(card){var calendar=$(".ZPcalvw-box"),appear_top=card.offset().top+340>calendar.height()+calendar.offset().top,appear_right=card.offset().left+290>calendar.width(),appear_left=card.offset().left<110;card.css("bottom",appear_top?"20px":"0px").css("right",appear_right?"20px":"0px").css("left",appear_left?"20px":"0px")},constructDateCard:function(holiday_data,date){var holidays=holiday_data[date],display_date=Calendar.parseDate(date,Calendar.DB_DATEFORMAT),card='<div class="caldprtmntmdl active" popup = "active" id="holiday_card_'+date+'"><a class="IC-cls"></a><h2 popup = "active">'+daysFull[display_date.getDay()]+", "+display_date.getDate()+'</h2><div class="caldprtmntmdl_lst" popup = "active">';for(var count in holidays){var holiday=holidays[count],isadmin=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isadmin,sessionClass=0==holiday.session?"zpl_holiBgbdr":1==holiday.session?"zpl_holibrdrd zpl_halffst":"zpl_holibrdrd zpl_halfsec";sessionClass=isadmin?"CP "+sessionClass:sessionClass;var onClick=isadmin?"onclick='Holidays.ViewHoliday.html(\""+holiday.id+"\")'":"";card+="<div class='zpl_shftdts "+sessionClass+" "+(holiday.isOptional?"zpl_rholiBgbdr":"")+"' "+onClick+" title='"+holiday.name+"' popup = 'active'> <span>"+holiday.name+"</span> </div>"}return card+=" </div></div>"}},getParams:function(params){var dateFields=settingsPage.container.find("#ZPCalNavTxt").html().split(" - ");params.from=dateFields[0],params.to=dateFields[1];var classificationArr=ZPeopleComponents.tokenfield(settingsPage.container.find("[name=holidayClassification]")).getSelectedValuesId();classificationArr&&0!=classificationArr.length&&(params.holidayClassification=JSON.stringify(classificationArr));var applFor=ZPeopleComponents.select(settingsPage.container.find("[name=applFor]")).getValue(),groupBy=ZPeopleComponents.select(settingsPage.container.find("[name=applFor]"))._selected[0].optData.groupBy;return 0==applFor||1==applFor?params.applicableFor=applFor:"Location"==groupBy?params.location=applFor:"Shift"==groupBy&&(params.shift=applFor),params.conreqcsr=csrfToken,params},checkGet:function(from,to){return Leave.Util.Validate.toafterfrom(from,to)?Leave.Util.Validate.noofDays(from,to,365,ZPI18N.getString("zp.datewithinoneyear")):(ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.greaterfromdate")),!1)},switchView:function(isCalendarView){Layout.Page.container.find(isCalendarView?".PI_monthly":".PI_listview").addClass("zpl_act"),Layout.Page.container.find(isCalendarView?".PI_listview":".PI_monthly").removeClass("zpl_act"),window.location=isCalendarView?LVUtil.urls.getUrlAsHash(LVUtil.Tab.isOpersPage()?LVUtil.urls.HolidayCalendar.OPERHOME():LVUtil.urls.HolidayCalendar.HOME()):LVUtil.urls.getUrlAsHash(LVUtil.Tab.isOpersPage()?LVUtil.urls.Holiday.HOME():LVUtil.urls.HolidayList.HOME())},list:function(){var params={method:"view",reqFor:"list_view",get_upcoming:!1};if(""==(params=Holidays.View.getParams(params)).location||""==params.shift)return""==params.location?Holidays.Operation.showerror(settingsPage.container.find("[name=location]"),ZPI18N.getString("zp.locationerror")):Holidays.Operation.showerror(settingsPage.container.find("[name=shift]"),ZPI18N.getString("zp.pleaseselectdes",[ZPI18N.getString("zp.shiftsig")])),void LeaveAdminOpers.toggleFilter();if(Holidays.Operation.hideerror(settingsPage.container.find("[name=location]")),Holidays.Operation.hideerror(settingsPage.container.find("[name=shift]")),Holidays.View.checkGet(params.from,params.to)){0==settingsPage.container.find(".zpl_tblres").find(".zpl_tbl").length&&LeaveAdminOpers.constructTableHeader();var holidayTable=$("table",settingsPage.container.find(".zpl_tblres")),tbody=holidayTable.find("tbody#holidaysRecordContainer");tbody.empty(),LeaveAdminOpers.Util.removeLoading(),LeaveAdminOpers.Util.appendLoading(),LeaveAdminOpers.Util.showHideNoData(!1);var moduleData=ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops;!moduleData.isadmin&&settingsPage.container.find(".zpl_tblres").find("tr>th")[6]&&settingsPage.container.find(".zpl_tblres").find("tr>th")[6].remove(),ZPeople.Request.send("listHolidays.zp",params,function(holidaysData){if(tbody.empty(),!(holidaysData.length>0))return LeaveAdminOpers.Util.removeLoading(),LeaveAdminOpers.Util.showHideNoData(!0,ZPI18N.getString("zp.leave.operations.nodatamsg",[ZPI18N.getString("zp.holiday.lowercaseholiday")])),void settingsPage.container.data("isreg",!0);LeaveAdminOpers.Util.showHideNoData(!1),holidayTable.find("thead").show(),$.each(holidaysData,function(ind,holidayDet){var hday_id=holidayDet.id,row=ZP.create("tr",{pk_id:hday_id+"",style:"cursor:auto"}),column=ZP.create("td",{tabindex:"0",scope:"row"});if(moduleData.isadmin)$(column).append(ZP.create("span",{text:ZPeople.decodeTxt(holidayDet.name),class:"CP"}));else{var nameSpan=ZP.create("span",{text:ZPeople.decodeTxt(holidayDet.name)});column.appendChild(nameSpan)}new Date<new Date(holidayDet.from_date)&&$(row).addClass("zpl_upleav"),$(row).append(column);var datestd=ZP.create("td");holidayDet.daydetails.length;$.each(holidayDet.daydetails,function(idx,day){var daytxt=" "+day.day+" ";daytxt+=day.session>0?"("+(1==day.session?ZPI18N.getString("zp.1sthalf"):ZPI18N.getString("zp.2ndhalf"))+")":"";var dateDiv=ZP.create("div",{class:"zpl_idiv"}),dateSpan=ZP.create("span",{html:day.dis_date+", <em>"+daytxt+"</em>"});dateDiv.appendChild(dateSpan),datestd.appendChild(dateDiv)}),$(row).append(datestd),row.appendChild(Holidays.View.getTD(holidayDet.locations,holidayDet.shifts,hday_id,"locaction")),row.appendChild(Holidays.View.getTD(holidayDet.shifts,holidayDet.locations,hday_id,"shift"));var holidayClasstd=ZP.create("td"),holidayClassObj=ZP.create("div",{class:"zpl_tg"}),hCtext=field=holidayDet.holidayClassification?Holidays.getHolidayTypefromId(holidayDet.holidayClassification):"-",spanObjHt=ZP.create("span",{text:hCtext});holidayClassObj.appendChild(spanObjHt),holidayClasstd.appendChild(holidayClassObj),$(row).append(holidayClasstd);var desSpan=ZP.create("span",{text:ZPeople.decodeTxt(holidayDet.remark)}),desTd=ZP.create("td");desTd.appendChild(desSpan),row.appendChild(desTd),moduleData.isadmin&&row.appendChild(Holidays.View.get_editdeleteTD(hday_id+"",Holidays.Operation.deleterec)),$(tbody).append(row),$(tbody).find("#lmoreicon_locaction_"+hday_id).off().on("click",e=>{e.stopPropagation(),$("#lmore_locaction_"+hday_id).length>0&&$("#lmore_locaction_"+hday_id).remove(),Holidays.View.constructMoreOption(holidayDet.locations,hday_id,"locaction"),ZPeopleComponents.menu("#lmore_locaction_"+hday_id).show()}),$(tbody).find("#lmoreicon_shift_"+hday_id).off().on("click",e=>{e.stopPropagation(),$("#lmore_shift_"+hday_id).length>0&&$("#lmore_shift_"+hday_id).remove(),Holidays.View.constructMoreOption(holidayDet.shifts,hday_id,"shift"),ZPeopleComponents.menu("#lmore_shift_"+hday_id).show()})}),LeaveAdminOpers.Util.removeLoading(),holidayTable.ztooltip(),settingsPage.container.data("isreg",!0),moduleData.isadmin&&tbody.find("tr td:not(:last-child)").off("click").on("click",function(){Holidays.ViewHoliday.html($(this).parents("tr").attr("pk_id"))})})}},constructMoreOption:function(list,hday_id,type){var listLen=list.length;if(listLen>0&&listLen>1){var mhtml='<div id="lmore_'+type+"_"+hday_id+'" class="zpl_drpdwn zpl_tagdrpdwn zmenu zposition--bottomright zh-radiustopright" data-type="list"><ul data-body="true" style="height: auto;">';for(let i=0;i<listLen;i++)if(i>1){mhtml+='<li data-item-type="custom"><div class="zpl_tg"><span>'+list[i].name+"</span></div></li>"}mhtml+="</ul></div>",$(settingsPage.container).append(mhtml),ZPeopleComponents.menu("#lmore_"+type+"_"+hday_id,{forElement:"#lmoreicon_"+type+"_"+hday_id})}},isRestrictedHoliday:function(id,isNameNeeded){if(void 0!=id){for(var hclass=ZPeople.Module.getData("leavetracker").holiday_filterops.holidayClassification,index=0;index<hclass.length;index++){var hclasObj=hclass[index];if(1==hclasObj.labelName&&hclasObj.id==id)return!isNameNeeded||ZPeople.decodeTxt(hclasObj.name)}return!1}return!1},getTD:function(list,checklist,hday_id,tdOf){var locTD=ZP.create("td",{id:hday_id+"_"+tdOf}),listLen=list.length,locDiv=ZP.create("div",{class:"zpl_tglist"});if(listLen>0)for(let i=0;i<listLen;i++){if(!(i<2)){divObj=ZP.create("div",{class:"zpl_tg",id:"lmoreicon_"+tdOf+"_"+hday_id,html:'<a class="lmoreicon">+'+(listLen-2)+"</a>"});locDiv.appendChild(divObj);break}{let obj=list[i];var divObj=ZP.create("div",{class:"zpl_tg"}),spanObj=ZP.create("span",{text:ZPeople.decodeTxt(obj.name)});divObj.appendChild(spanObj),locDiv.appendChild(divObj)}}else{divObj=ZP.create("div",{class:"zpl_tg"}),spanObj="";checklist.length>0?(spanObj=ZP.create("span",{text:"-"}),divObj.appendChild(spanObj),locDiv.appendChild(divObj)):(spanObj=ZP.create("span",{text:ZPI18N.getString("zp.all"+tdOf)}),divObj.appendChild(spanObj),locDiv.appendChild(divObj))}return locTD.appendChild(locDiv),locTD},get_editdeleteTD:function(pk_id,deleteCallback){var edit,td=ZP.create("td"),actionDiv=ZP.create("div",{class:"zpl_hvr"});edit=ZP.create("i",{class:"PI_edt tooltip-js",title:ZPI18N.getString("zp.edit")});var page=settingsUrlProps.niceUrlArr[settingsUrlProps.niceUrlArr.length-1];"holiday"==page?$(edit).off().on("click",edit,function(){Holidays.Add.html(1,pk_id)}):"workingday"==page&&$(edit).off().on("click",edit,function(){ExpWorkingDay.Add.html(1,pk_id)}),$(actionDiv).append(edit);var del=ZP.create("i",{class:"PI_delete tooltip-js",title:ZPI18N.getString("zp.delete")});return $(del).off().on("click",del,function(){Holidays.Operation.deleteWarning($(this),deleteCallback)}),actionDiv.appendChild(del),td.appendChild(actionDiv),td}}};Holidays.ViewHoliday={html:function(holiId){var modalParams={id:"holidays_add_edit_view",cardId:"holidays_add_edit_cont"},viewModal=new sliderModal(ZPI18N.getString("zp.view")+" "+ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name,modalParams);viewModal.construct(),viewModal.setCloseCallback(function(){viewModal.remove()});var modal=settingsPage.container.find("#holidays_add_edit_view"),viewhtml='<div class="zpl_crd"> <div class="zpl_crdcnt">';if(viewhtml+='<div class="zpl_secn"><div><h5><label class="zpl_mtry" name="name">'+ZPI18N.getString("zp.name")+"</label></h5></div></div>",viewhtml+='<div class="zpl_secn"><div><h5><label class="zpl_mtry" name="Date">'+ZPI18N.getString("zp.date")+"</label></h5></div></div>",viewhtml+='<div class="zpl_secn"><div><h5><label name="holidayclassification">'+ZPI18N.getString("zp.classification")+"</label></h5></div></div>",viewhtml+='<div class="zpl_secn DNI" id="Holiday_DayDetails"></div>',viewhtml+='<div class="zpl_secn"><div><h5><label name="location">'+ZPI18N.getString("zp.locations")+"</label></h5></div></div>",viewhtml+='<div class="zpl_secn"><div><h5><label name="shift">'+ZPI18N.getString("zp.shifts")+"</label></h5></div></div>",viewhtml+='<div class="zpl_secn"><div><h5><label name="remark">'+ZPI18N.getString("zp.description")+"</label></h5></div></div>",viewhtml+="</div></div>",modal.find(".zpl_mcnt").html(viewhtml),modal.find("#sliderSbt").remove(),modal.find("#sliderCancel").text(ZPI18N.getString("zp.close")),ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.isadmin){var actionSpan=ZP.create("span",{id:"edit_icon",class:"zpl_mhderrgt a-itm-cntr CP"}),edit=ZP.create("a",{class:"zpl_ibg PI_edt"});$(edit).on("click",edit,function(){modal.length>0&&viewModal.remove(),Holidays.Add.html(1,holiId)}),$(actionSpan).append(edit),modal.find(".zpl_mhder").find("#edit_icon").remove(),$(actionSpan).insertBefore(modal.find(".zpl_mhder .PI_cls"))}var params={reqFor:"edit_view",method:"view",id:holiId},views=settingsPage.container.find("#holidays_add_edit_view");ZPeople.Request.send("getdetail_holiday.zp",params,function(result){Holidays.Operation.fill_view(result,views),Holidays.View.holidayData=result,viewModal.open()}),modal.find("#sliderCancel, ._cls").on("click",function(){Holidays.View.holidayData={}})}},Holidays.Add={appElementsIndex:[0,8],appElementsKey:[],html:function(add_edit,pk_id,isGallery){var title=0==add_edit?ZPI18N.getString("zp.addcomponents",[ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name]):ZPI18N.getString("zp.module.edit",[ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name]);$("#holidays_add_edit_view").remove();var modalParams={id:"holidays_add_edit_view",cardId:"moduleCards"};modalParams.validate=isGallery?Holidays.Gallery.save:Holidays.Operation.save;var addModal=new sliderModal(title,modalParams);addModal.construct(),addModal.close(),addModal.setCloseCallback(function(){Holidays.destroyZComp()});var modal=settingsPage.container.find("#holidays_add_edit_view");modal.find("#moduleCards").css("position","relative");var holidayDispName=(moduleData=ZPeople.Module.MODULE_DATA.leavetracker).holiday_filterops.display_name;holidayDispName.toLowerCase()==ZPI18N.getString("zp.holidays").toLowerCase()&&(holidayDispName=ZPI18N.getString("zp.holiday.lowercaseholiday"));var isEnabledNotify=moduleData.leave_filterops.isEnabledNotify,holidayAddHtmls='<div class="zpl_crd"> <div class="zpl_crdcnt">';holidayAddHtmls+='<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.name")+'</label></div><div><input type="text" class="ztextbox" name="name"><span class="ztextbox--error__label"></span></div></div>',holidayAddHtmls+='<div class="zpl_secn" id="selectedHoliday"><div class="zpl_gbox zpl_ma0 zpl_w-100"><div><div class="">'+ZPI18N.getString("zp.cap.selected")+': <b id="selectedHolidayCnt"></b></div></div><div id="selectedHoliName" class="zpl_tglist"></div></div></div>',holidayAddHtmls+='<div class="zpl_secn"><div id="Date"><label class="zpl_mtry">'+ZPI18N.getString("zp.date")+'</label><br><br><div id="rangePicker"><div class="ztextbox--group zh-alignright"><i class="ztextbox__icon PI_monthly"></i><input id="dateRangePlaceHolder" name="fromto" type="text" class="ztextbox"></div><span id="dateErr" class="ztextbox--error__label"></span></div></div>',holidayAddHtmls+='<div class="zpl_secn DNI" id="Holiday_DayDetails"><div class="zpl_gbox W100"></div></div>',holidayAddHtmls+='</div><div class="zpl_secn" id="htypes"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.classification")+'</label></div><div><select class="select-js" id="holidayClassification" name="holidayclassification"></select><span class="ztextbox--error__label" id="classifyerror"></span></div></div>',holidayAddHtmls+='<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.description")+'</label></div><div><textarea class="ztextbox" name="remark" rows="2"></textarea><span class="ztextbox--error__label"></span></div></div>',holidayAddHtmls+='<div class="zpl_secn"><div id="selectDays"><label name="remindbefore">'+ZPI18N.getString("zp.holiday.noofdaysbefore")+'</label></div><div id="reminderDaySel"><select class="select-js" '+(isEnabledNotify?"":"disabled='disabled'")+' name="numberofdays" id="sel_aft_dates"></select><span class="ztextbox--error__label" id="reminderInfo"></span></div></div>',holidayAddHtmls+=isGallery?"":'<div class="zpl_secn"><div><div class="zcheckbox '+(isEnabledNotify?"":"disabled gry")+'"><input type="checkbox" name="feed" class="zcheckbox__helper"><label class="zcheckbox__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.holiday.notifyemployees")+"</span> </label></div><div><em>("+ZPI18N.getString("zp.holiday.notifyfeedinfo",[holidayDispName])+")</em></div></div></div>",holidayAddHtmls+=isGallery?"":'<div class="zpl_secn"><div><div class="zcheckbox"><input type="checkbox" name="isReprocessNeeded" class="zcheckbox__helper"><label class="zcheckbox__label"><span class="zradiobutton__text">'+(0==add_edit?ZPI18N.getString("zp.holiday.reprocess.adddesc",[holidayDispName]):ZPI18N.getString("zp.holiday.reprocess.editdesc",[holidayDispName]))+"</span></label></div></div><div><em>("+ZPI18N.getString("zp.holiday.reprocess.info",[holidayDispName])+")</em></div></div>",holidayAddHtmls+='<div class="zpl_secn"><div><div class="zpl_info" id="leaveinfo"><b>'+ZPI18N.getString("zp.note")+" : </b> "+ZPI18N.getString("zp.holidaynote",[holidayDispName,holidayDispName])+"</div></div></div>",holidayAddHtmls+="</div></div>",modal.find(".zpl_mcnt").html(holidayAddHtmls),modal.append('<div id="rangePickerElement" data-for-element="#rangePicker"></div>'),modal.attr({"aria-label":ZPI18N.getString("zp.common.addreqpage"),tabindex:"0"}),modal.focus(),Holidays.Add.appElementsKey[0]="location",Holidays.Add.appElementsKey[8]="shifts",Holidays.Add.appElementsIndex=AppExc.removeUnApplicableElements([0,8]),AppExc.setAppIndex(Holidays.Add.appElementsIndex,!0),modal.find(".zpl_crdcnt .zpl_secn").eq(3).after(AppExc.returnApplicableHtml("appToSec")),AppExc.showHideAddMoreEle(modal,AppExc.returnAppElementsIndex()),settingsPage.container.find("#appToSec .zpl_mtry").text(ZPI18N.getString("zp.applicablefor",[""])),settingsPage.container.find("#appToSec #employeeBox").remove(),settingsPage.container.find("#appToSec .zpl_cndop").remove(),settingsPage.container.find("#appToSec").find("label").removeClass("zpl_mtry");var period=modal.find("input[name=fromto]"),reminder=modal.find("select[name=numberofdays]"),feed=modal.find("input[name=feed]");0==add_edit&&feed.attr("checked","checked");var hClassification=modal.find("[name=holidayclassification]");period.on("input change",function(){Holidays.Add.showhidebars(),Holidays.Add.showHideReminderInfo(period)}),$(reminder).on("zselectchange",function(){Holidays.Add.showHideReminderInfo(period)}),$(hClassification).on("zselectchange",function(){Holidays.Add.showhidebars()}),modal.find("#sliderCancel, ._cls").on("click",function(){Holidays.View.holidayData={}});settingsPage.container.find("#dateRangePlaceHolder").on("change",function(){var dateVal=$(this).val();void 0!=dateVal&&""!=dateVal||ZPeopleComponents.daterangepicker(settingsPage.container.find("#rangePickerElement")).clearSelection()}),LeaveAdminOpers.ZPeopleComponents.DateRangePicker.init({container:modal.find("#rangePickerElement"),appendTo:"#moduleCards",selectionType:"separate",onChangeCB:function(){if(void 0!=ZPeopleComponents.daterangepicker(modal.find("#rangePickerElement")).getFromValue()||void 0!=ZPeopleComponents.daterangepicker(modal.find("#rangePickerElement")).getToValue()){var fromDate=ZPeopleComponents.daterangepicker(modal.find("#rangePickerElement")).getFromValue().fromValueString,toDate=void 0!=ZPeopleComponents.daterangepicker(modal.find("#rangePickerElement")).getToValue()?ZPeopleComponents.daterangepicker(modal.find("#rangePickerElement")).getToValue().toValueString:"";fromDate==toDate?modal.find("#dateRangePlaceHolder").val(fromDate):modal.find("#dateRangePlaceHolder").val(fromDate+"-"+toDate),Holidays.Add.showhidebars(),Holidays.Operation.hideerror(modal.find("#Date"))}},fromvalueselectCB:function(event,ui){var fromDate=ui.fromValueString;ZPeopleComponents.daterangepicker(modal.find("#rangePickerElement")).setFromValue(""),ZPeopleComponents.daterangepicker(modal.find("#rangePickerElement")).setToValue(""),modal.find("#dateRangePlaceHolder").val(fromDate),Holidays.Add.showhidebars(),Holidays.Operation.hideerror(modal.find("#Date"))},beforeopenCB:function(event){var period=modal.find("input[name=fromto]"),dates=Leave.Util.getDoubleCalFromTo(period.val()),from=dates.from,to=dates.to;Calendar.isvalidDate(period.val())&&(from=period.val(),to=period.val()),void 0!=from&&void 0!=to&&from==to&&(ZPeopleComponents.daterangepicker(modal.find("#rangePickerElement")).setFromValue(from),ZPeopleComponents.daterangepicker(modal.find("#rangePickerElement")).setToValue(from))},clearCB:function(){Holidays.Add.showhidebars()}});var picker=modal.find("#rangePickerElement");modal.find("#rangePicker").on("click",function(){modal.find("#rangePickerElement").is(":visible")?ZPeopleComponents.daterangepicker(picker).close():ZPeopleComponents.daterangepicker(picker).open()});var optArray=[];optArray.push({label:ZPI18N.getString("zp.select"),value:"-1"});for(var i=1;i<=30;i++)optArray.push({label:i+"",value:i+""});LeaveAdminOpers.ZPeopleComponents.Select.init({container:modal.find("[name=numberofdays]"),optArray:optArray,appendTo:"#moduleCards",defVal:"-1"});var hClassifyAr=[];hClassifyAr.push({label:ZPI18N.getString("zp.select"),value:"-1"});var moduleData,holidayData=(moduleData=ZPeople.Module.MODULE_DATA.leavetracker).holiday_filterops.holidayClassification,setByDefault={};if(moduleData&&moduleData.holiday_filterops&&holidayData&&holidayData.length>0)for(var ind=0;ind<holidayData.length;ind++){var hJsonobj=holidayData[ind];0==hJsonobj.labelName&&(setByDefault=hJsonobj),hClassifyAr.push({label:ZPeople.decodeTxt(hJsonobj.name+""),value:hJsonobj.id+"",classificationType:hJsonobj.labelName})}if(LeaveAdminOpers.ZPeopleComponents.Select.init({container:modal.find("[name=holidayclassification]"),optArray:hClassifyAr,appendTo:"#moduleCards",defVal:setByDefault.id}),$(modal.find(".zcheckbox")).on("click",function(){let swtched=$(this).find("input[type=checkbox]");swtched.prop("checked",!swtched.prop("checked"))}),1==add_edit){var id=pk_id,form=settingsPage.container.find("#holidays_add_edit_view");form.attr("pk_id",id);var params={reqFor:"edit_view",method:"view",id:id};_.isEmpty(Holidays.View.holidayData)||Holidays.View.holidayData.id!==id?ZPeople.Request.send("getdetail_holiday.zp",params,function(result){void 0!==result&&""!==result&&(Holidays.Add.fill_form(result,form),addModal.open(),AppExc.addNewConditionRow(void 0,"appToSec"),modal.find("[name=name]").focus())}):(Holidays.Add.fill_form(Holidays.View.holidayData,form),addModal.open(),modal.find("[name=name]").focus()),form.find(".modal-header").find(".PI_edt").remove()}else isGallery&&(modal.find('input[name="name"]').parent().parent().hide(),modal.find("#Date").hide()),addModal.open(),modal.find('[name="name"]').focus(),AppExc.addNewConditionRow(void 0,"appToSec");if(isGallery){var checkedDiv=settingsPage.container.find("#galleryList tr input[name='check']:checked");0===checkedDiv.length&&addModal.close(),modal.find("#selectedHoliday #selectedHolidayCnt").append(checkedDiv.length+" "+moduleData.holiday_filterops.display_name),$.each(checkedDiv,function(idx){var name=checkedDiv.parent().parent().parent().find("#name")[idx].innerText;modal.find("#selectedHoliday #selectedHoliName").append('<div class="zpl_tg zpl_whtbg"><span>'+name+"</span></div>")})}else modal.find("#selectedHoliday").hide();period=modal.find("#dateErr");Holidays.Operation.hideerror(period.parent())},fill_form:function(result,form){var locs=result.locations,loc_arr=new Array;$(locs).each(function(idx,loc){loc_arr.push(loc.id)}),result.location=loc_arr;var shifts=result.shifts,shift_arr=new Array;$(shifts).each(function(idx,loc){shift_arr.push(loc.id)}),result.location=loc_arr,result.shift=shift_arr,Holidays.Operation.fill_form(result,form)},showhidebars:function(){var ele=settingsPage.container.find("#holidays_add_edit_view"),fromto=ele.find("[name=fromto]").val(),dates=Leave.Util.getDoubleCalFromTo(fromto),hClassificationId=ele.find("[name=holidayclassification]").val(),restricted=Holidays.View.isRestrictedHoliday(hClassificationId);Holidays.Operation.getbars(dates,!1),restricted&&ele.find("#Holiday_DayDetails").find("select").each(function(){ZPeopleComponents.select($(this)).setValue("0"),$(this).parent().find(".zselectbox").attr("class","zselectbox disabled")})},showHideReminderInfo(period){var ele=settingsPage.container.find("#holidays_add_edit_view"),reminderVal=ele.find("[name=numberofdays]").val(),reminderInfoObj=ele.find("#reminderDaySel").find("#reminderInfo");if("-1"!=reminderVal){var dates=Leave.Util.getDoubleCalFromTo(period.val()),from=dates.from,to=dates.to;if(from&&to&&Calendar.isvalidDate(from)&&Calendar.isvalidDate(to)){var curDate=Calendar.parseDate(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date,uidateFormat),from_dt=Calendar.parseDate(from,uidateFormat),reminder_dt=Calendar.parseDate(from,uidateFormat),date=from_dt.getDate()-parseInt(reminderVal);reminder_dt.setDate(date),reminder_dt<=curDate?Holidays.Operation.showerror(ele.find("[name=numberofdays]").parent(),ZPI18N.getString("zp.holiday.holidayreminderinfo2")):Holidays.Operation.showerror(ele.find("[name=numberofdays]").parent(),ZPI18N.getString("zp.holiday.holidayreminderinfo1",[Calendar.formatDate(reminder_dt)]))}else reminderInfoObj.text("")}else reminderInfoObj.text("")}},Holidays.ImportICS={construct:function(){Timetracker.Import.dtls={},Timetracker.Import.dtls.fileSlider=Timetracker.Import.getImportSlider,Timetracker.Import.dtls.fileUploading=Holidays.ImportICS.fileUploading,Timetracker.Import.dtls.getMappingSliderHtml=function(){},Timetracker.Import.dtls.getVerifySliderHtml=function(){},Timetracker.Import.dtls.getImportSummaryHtml=Holidays.ImportICS.getImportSummaryHtml,Timetracker.Import.dtls.inputFileVerify=function(){},Timetracker.Import.dtls.autoMappingFields=function(){},Timetracker.Import.dtls.viewRecords=Holidays.ImportICS.viewRecords(),Timetracker.Import.construct(),settingsPage.container.find("#ttImportFileUpload").find("#importFileDiv1").find(".zpl_fldrp").find("p")[2].remove();var importModal=settingsPage.container.find("#ttImportFileUpload").find("#importFileDiv1");importModal.find(".zpl_info").append("<p>"+ZPI18N.getString("zp.holiday.imphelp4")+"</p>"),$(importModal.find(".zpl_fldrp").find("p")[0]).html(ZPI18N.getString("zp.icssupported")),importModal.find("input[elem=ttConfigImportFile]").attr("accept",".ics")},getLocationList:function(importModal){var moduleData=ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops,html='<div id="location_list"><div class="zpl_secn"><div><h4>'+ZPI18N.getString("zp.restricted")+" "+moduleData.display_name+'</h4></div><div class="zcheckbox"><input name="restricted" id="restricted" type="checkbox" class="zcheckbox__helper"><label class="zcheckbox__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.holiday.importrh")+" "+moduleData.display_name+'</span></label></div></div><div class="zpl_secn"> <div> <label><h4>'+ZPI18N.getString("zp.applicablefor",[""])+'</h4></label> </div><div style="width:50%">'+ModuleComp.ZPPickList.getHtml(ZPI18N.getString("zp.applicablefor",[""]))+"</div></div></div>";importModal.append(html),$(importModal.find(".zcheckbox")).on("click",function(){let swtched=$(this).find("input[type=checkbox]");swtched.prop("checked",!swtched.prop("checked"))})},fileUploading:function(fileObj){var cont=Timetracker.Import.importfileUpContiner;cont.find("#importFileDiv1").addClass("DN"),cont.find("#loadingImportDiv").show(),cont.find("#loadingImportDiv").html(ZPeople.LOADING_HTML);var formData=new FormData;fileObj&&(formData.append("theFile",fileObj),formData.append("method","importICS"),ModuleComp.ZPPickList.getData(cont).loc&&formData.append("locationList",JSON.stringify(ModuleComp.ZPPickList.getData(cont).loc)),ModuleComp.ZPPickList.getData(cont).shift&&formData.append("shiftList",JSON.stringify(ModuleComp.ZPPickList.getData(cont).shift)),formData.append("isRestricted",cont.find("input[name=restricted]").is(":checked")?1:0),formData.append("conreqcsr",csrfToken),$.ajax({url:"/import_holiday.zp",type:"POST",data:formData,contentType:!1,processData:!1,success:function(response){var obj={res:1};obj.resObj=JSON.parse(response),Timetracker.Import.fileData=obj;var html=Holidays.ImportICS.getImportSummaryHtml(JSON.parse(response));cont.find("#cardRightDiv").empty(),cont.find("#cardRightDiv").append(html)}}))},getImportSummaryHtml:function(resultData){var html='<div name="ttimport_summary" id="ttimport_summary_card" class="zpl_act"><div class="zpl_imprtrecordvw"><div class="zpl_secn"><div><div class="zpl_imprtrecord">';if(html+='<div><i class="IC-task-chk grn"></i><b>'+ZPI18N.getString("zp.importSuccess",[""])+"</b></div>",html+='<button type="button" class="zlabel zlabel--blue zlabel--medium" onclick="Holidays.ImportICS.viewRecords()">'+ZPI18N.getString("zp.viewRecords")+"</button>",html+="</div></div></div></div>",html+='<div class="zpl_btnmnu"><div><ul class="zpl_grpmnu">',html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfAdd")+" <b>"+resultData.noof_add+"</b></li>",html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfUpdate")+" <b>0</b></li>",html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfSkip")+" <b>"+resultData.noof_duplicate+"</b></li>",html+='<li style="cursor: default;">'+ZPI18N.getString("zp.noOfErr")+" <b>"+Object.keys(resultData.error).length+"</b></li>",html+="</ul></div></div>",resultData.error){var errLen=resultData.error.length;if(errLen>0){html+=' <div class="zpl_rgtcnt"><div class="zpl_tblres"> <table class="zpl_tbl">  <thead><tr><th>'+ZPI18N.getString("zp.error")+"</th></tr></thead><tbody>";for(var index=0;index<errLen;index++)html+="<tr><td><span>"+resultData.error[index].msg+"</span></td></tr>";html+="</tbody></table></div></div></div>"}}return resultData.noof_add>0&&(Holidays.GCalSync.syncStatus="askServer"),settingsPage.container.find("#ttImportFileUpload").find("#fullModFooter").find("#nextButton").hide(),html},viewRecords:function(){settingsPage.container.find("#ttImportFileUpload").find("#closeMark").trigger("click"),Holidays.View.get()}},Holidays.Import={construct:function(){Timetracker.Import.dtls={},Timetracker.Import.dtls.noteArr=["*"+ZPI18N.getString("zp.holiday.imphelp1"),"*"+ZPI18N.getString("zp.recommendeddate"),"*"+ZPI18N.getString("zp.holiday.imphelp2"),"*"+ZPI18N.getString("zp.holiday.imphelp3"),"*"+ZPI18N.getString("zp.holiday.imphelp4")],Timetracker.Import.dtls.fileSlider=Timetracker.Import.getImportSlider,Timetracker.Import.dtls.fileUploading=Holidays.Import.fileUploading,Timetracker.Import.dtls.getMappingSliderHtml=Holidays.Import.getMappingSliderHtml,Timetracker.Import.dtls.getVerifySliderHtml=Holidays.Import.getVerifySliderHtml,Timetracker.Import.dtls.getImportSummaryHtml=Holidays.Import.getImportSummaryHtml,Timetracker.Import.dtls.inputFileVerify=Holidays.Import.inputFileVerify,Timetracker.Import.dtls.autoMappingFields=Holidays.Import.autoMappingFields,Timetracker.Import.dtls.viewRecords=Holidays.View.get,Timetracker.Import.dtls.importTemplate=Holidays.Import.importTemplate,Timetracker.Import.construct(),Holidays.Import.getSupportFormatHtml();var importModal=settingsPage.container.find("#ttImportFileUpload").find("#importFileDiv1");$(importModal.find(".zpl_fldrp").find("p")[0]).html(ZPI18N.getString("zp.fomtsupportxlscsv")),importModal.find("input[elem=ttConfigImportFile]").attr("accept",".xls,.csv")},importTemplate:function(){Leave.exportForm.getHTMLFormDataObj("holiday_imp_form","","export_holiday.zp?method=importTemplate","post","exportresp1",null).submit()},getSupportFormatHtml:function(){var html='<div class="zpl_secn" elem="template_section"><div><h5>'+ZPI18N.getString("zp.supportedformats")+'</h5></div><div class="zpl_tblres"><table class="zpl_tbl wd100_per"><thead><tr><th></th> <th><b>A</b></th><th><b>B</b></th><th><b>C</b></th><th><b>D</b></th><th><b>E</b></th><th><b>F</b></th><th><b>G</b></th><th><b>H</b></th></tr></thead><tbody><tr><td><b>1</b></td><td><span><b>'+ZPI18N.getString("zp.name")+"</b></span></td><td><span><b>"+ZPI18N.getString("zp.from")+"</b></span></td><td><span><b>"+ZPI18N.getString("zp.to")+"</b></span></td><td><span><b>"+ZPI18N.getString("zp.locations")+"</b></span></td><td><span><b>"+ZPI18N.getString("zp.shifts")+"</b></span></td><td><span><b>"+ZPI18N.getString("zp.description")+"</b></span></td><td><span><b>"+ZPI18N.getString("zp.restricted")+"</b></span></td><td><span><b>"+ZPI18N.getString("zp.reminder")+"</b></span></td></tr><tr><td><b>2</b></td><td><span>New year</span></td><td><span>01-Jan-2018</span></td><td><span>01-Jan-2018</span></td><td><span></span></td><td><span></span></td><td><span>New Year Celebration</span></td><td><span></span></td><td><span>2</span></td></tr><tr><td><b>3</b></td><td><span>Presidents' Day</span></td><td><span>19-Feb-2018</span></td><td><span>19-Feb-2018</span></td><td><span></span></td><td><span>USA</span></td><td><span></span></td><td><span></span></td><td><span>2</span></td></tr><tr><td><b>4</b></td><td><span>Holi</span></td><td><span>02-Mar-2018</span></td><td><span>02-Mar-2018</span></td><td><span>India;Bangladesh</span></td><td><span></span></td><td><span>*Optional Holiday</span></td><td><span>TRUE</span></td><td><span></span></td></tr></tbody></table></div></div>";settingsPage.container.find("#ttImportFileUpload").find("#importFileDiv1").append(html)},fileUploading:function(fileObj){var cont=Timetracker.Import.importfileUpContiner;cont.find("#importFileDiv1").addClass("DN"),cont.find("#loadingImportDiv").show(),cont.find("#loadingImportDiv").html(ZPeople.LOADING_HTML);var formData=new FormData;fileObj&&(formData.append("file_data",fileObj),formData.append("method","import_XLS_file"),formData.append("conreqcsr",csrfToken),$.ajax({url:"/import_holiday_file.zp",type:"POST",data:formData,contentType:!1,processData:!1,success:function(response){var obj={res:1};obj.resObj=JSON.parse(response),Timetracker.Import.fileData=obj,Timetracker.Import.constructImportDiv()}}))},getMappingSliderHtml:function(){var html='<div class="zpl_btnmnu"><div><ul class="zpl_grpmnu"><li elem="mapUnMapDiv" value="allFields" class="zpl_act">'+ZPI18N.getString("zp.all")+"</li>";return html+='<li elem="mapUnMapDiv" value="mappedFields">'+ZPI18N.getString("zp.mapping")+' <div id="mappedNo"><b></b></div></li><li elem="mapUnMapDiv" value="unMappedFields">'+ZPI18N.getString("zp.unmapped")+' <div id="unMappedNo"><b></b></div></li></ul></div>',html+='<div class="zpl_rgt"><button class="zlabel zlabel--red zlabel--medium zlabel--outline" onclick="Timetracker.Import.resetOrAutomapFields(true);">'+ZPI18N.getString("zp.resetfields")+'</button><button class="zlabel zlabel--blue zlabel--medium zlabel--outline" onclick="Timetracker.Import.resetOrAutomapFields();">'+ZPI18N.getString("zp.automapfields")+"</button></div></div>",html+=Holidays.Import.getColumns("ttimport_mapping_collapseDiv",!0)},getVerifySliderHtml:function(){return Holidays.Import.getColumns("ttimport_verify_collapseDiv")},getColumn:function(con1,con2,id1,id2,isMan1,isMan2,isMap,isSingle){isMap&&(id1+="_map");var html='<div class="zpl_secn zpl_twoclum" elem="rowContainer">';return html+='<div><div elem="mappingFieldDiv"><label class="'+(isMan1?"zp_mdt":"")+'" style="'+(isMan1?"":"overflow: hidden !important;")+'"><font>'+con1+"</font>",html+='<b class="zbadges columnIndex DNI"></b></label><select class="select-js" id="'+id1+'" name="'+id1+'" style="display: none;"></select>'+(isMan1?'<span class="ztextbox--error__label"></span>':"")+"</div></div>",isSingle||(isMap&&(id2+="_map"),html+='<div><div elem="mappingFieldDiv"><label class="'+(isMan2?"zp_mdt":"")+'" style="'+(isMan2?"":"overflow: hidden !important;")+'"><font>'+con2+"</font>",html+='<b class="zbadges columnIndex DNI"></b></label><div class="d-flexcap a-itm-cntr"><select id="'+id2+'" name="'+id2+'" class="select-js" style="display: none;"></select></div>'+(isMan2?'<span class="ztextbox--error__label"></span>':"")+"</div></div>"),html+="</div>"},getColumns:function(id,isMap){var html='<div class="zpl_rgtcnt zpl_crdwthful"><div class="zpl_crd" elem="collapseMainDiv">';return html+='<div class="zpl_crdcnt zpl_colpanls" data-toggle-button-position="right" aria-multiselectable="true">',html+='<div id="'+id+'" elem="collapsibleSectionPanel"><div><div><h4="">'+ZPI18N.getString("zp.basicinfo")+"</div></div><div>",html+=Holidays.Import.getColumn(ZPI18N.getString("zp.name"),ZPI18N.getString("zp.from"),"name","from",!0,!0,isMap),html+=Holidays.Import.getColumn(ZPI18N.getString("zp.to"),ZPI18N.getString("zp.locations"),"to","locations",!0,!1,isMap),html+=Holidays.Import.getColumn(ZPI18N.getString("zp.shifts"),ZPI18N.getString("zp.description"),"shifts","desc",!1,!1,isMap),html+=Holidays.Import.getColumn(ZPI18N.getString("zp.lookup.is")+" "+ZPI18N.getString("zp.restricted"),ZPI18N.getString("zp.reminder"),"restricted","reminder",!1,!1,isMap),html+='</div></div></div></div><div id="zp_empty_data" style="display: none;"></div></div>'},validateFields:function(){var verifyDiv=Timetracker.Import.importContainer.find("#ttimport_verify_card"),haserror=!1;return $.each(verifyDiv.find("select"),function(idx,ele){ele=$(ele);var value=ZPeopleComponents.select(ele).getValue();-1==value||""==value?"name"!=ele.attr("name")&&"from"!=ele.attr("name")&&"to"!=ele.attr("name")||(haserror=!0,ele.parent().parent().find("span.ztextbox--error__label").removeClass("DN"),ele.parent().parent().find("span.ztextbox--error__label").html(ZPI18N.getString("zp.MandatoryFieldMap"))):ele.parent().parent().find("span.ztextbox--error__label").addClass("DN")}),haserror},getImportSummaryHtml:function(resultData){var html='<div class="zpl_imprtrecordvw"><div class="zpl_secn"><div><div class="zpl_imprtrecord">';if(html+='<div><i class="IC-task-chk grn"></i><b>'+ZPI18N.getString("zp.importSuccess",[""])+"</b></div>",html+='<button type="button" class="zlabel zlabel--blue zlabel--medium" onclick="Timetracker.Import.viewRecords()">'+ZPI18N.getString("zp.viewRecords")+"</button>",html+="</div></div></div></div>",html+='<div class="zpl_btnmnu"><div><ul class="zpl_grpmnu">',html+="<li>"+ZPI18N.getString("zp.noOfAdd")+" <b>"+resultData.noof_add+"</b></li>",html+="<li>"+ZPI18N.getString("zp.noOfUpdate")+" <b>0</b></li>",html+="<li>"+ZPI18N.getString("zp.noOfSkip")+" <b>"+resultData.noof_duplicate+"</b></li>",html+="<li>"+ZPI18N.getString("zp.noOfErr")+" <b>"+Object.keys(resultData.error).length+"</b></li>",html+="</ul></div></div>",resultData.error){var errLen=resultData.error.length;if(errLen>0){html+=' <div class="zpl_rgtcnt"><div class="zpl_tblres"> <table class="zpl_tbl">  <thead><tr><th>'+ZPI18N.getString("zp.row")+"</th><th>"+ZPI18N.getString("zp.error")+"</th></tr></thead><tbody>";for(var index=0;index<errLen;index++){html+="<tr><td><span>"+("Row "+resultData.error[index].row)+"</td><td>"+resultData.error[index].msg+"</span></td></tr>"}html+="</tbody></table></div></div>"}}return html},inputFileVerify:function(){var params={},container=Timetracker.Import.importContainer.find("#ttimport_verify_card");if(Holidays.Import.validateFields())Timetracker.Import.importObj.showTab(2);else{Timetracker.Import.importContainer.find("#fullModFooter").find("#nextButton").hide();var name=ZPeopleComponents.select(container.find("#name")).getValue(),from=ZPeopleComponents.select(container.find("#from")).getValue(),to=ZPeopleComponents.select(container.find("#to")).getValue();params.name=Number(name),params.from=Number(from),params.to=Number(to),params.location=ZPeopleComponents.select(container.find("[name=locations]")).getValue(),params.shift=ZPeopleComponents.select(container.find("[name=shifts]")).getValue(),params.desc=ZPeopleComponents.select(container.find("[name=desc]")).getValue(),params.is_restricted=ZPeopleComponents.select(container.find("[name=restricted]")).getValue(),params.reminder=ZPeopleComponents.select(container.find("[name=reminder]")).getValue(),params.location=""==params.location?-1:params.location,params.shift=""==params.shift?-1:params.shift,params.desc=""==params.desc?-1:params.desc,params.is_restricted=""==params.is_restricted?-1:params.is_restricted,params.reminder=""==params.reminder?-1:params.reminder,params.method="import_mapped",params[csrfParamName]=csrfToken,settingsPage.container.find("#ttimport_slider").find("#nextButton").hide(),Timetracker.Import.importContainer.find("#ttimport_summary_card").html(ZPeople.LOADING_HTML),$.post("/holiday_actions.zp",params,function(resultData){"success"==resultData.status?(Timetracker.Import.importContainer.find("#ttimport_summary_card").html(Holidays.Import.getImportSummaryHtml(resultData)),settingsPage.container.find("#ttimport_slider").find("#cancelButton,#closeMark").on("click",function(){Holidays.View.get()})):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.leave.import.error"))})}},autoMappingFields:function(cont){var headers=Timetracker.Import.fileData.resObj.tableHeaders,headerHash=Timetracker.Import.headerHash;for(var index in headers){var curHLC=headers[index].toLowerCase(),mapId=void 0;"name"===curHLC&&(mapId="#name_map"),"from"===curHLC&&(mapId="#from_map"),"to"===curHLC&&(mapId="#to_map"),"locations"===curHLC&&(mapId="#locations_map"),"shifts"===curHLC&&(mapId="#shifts_map"),curHLC.includes("desc")&&(mapId="#desc_map"),curHLC.includes("restricted")&&(mapId="#restricted_map"),curHLC.includes("reminder")&&(mapId="#reminder_map"),void 0!==mapId&&ZPeopleComponents.select(cont.find(mapId)).setValue(headerHash[curHLC])}}},Holidays.Export={ics:function(){var params={};for(key in(params=Holidays.View.getParams(params)).conreqcsr=csrfToken,params.filetype=5,params)"location"===key&&(params[key]=params[key]?params[key]:-1);Leave.exportForm.getHTMLFormDataObj("zp_export_form","","export_holiday.zp?method=export","post",null,params).submit()}},Holidays.Settings={loadPage:function(){window.open("#settings/service/leavetracker/additionaloptions")}},Holidays.Operation={},Holidays.Operation.deleteWarning=function(ele,deleteCallback){var isWorkingDayPage=LVUtil.Tab.isExpWorkingDay(),holidayDispName=ZPeople.Module.getData("leavetracker").holiday_filterops.display_name;holidayDispName.toLowerCase()==ZPI18N.getString("zp.holidays").toLowerCase()&&(holidayDispName=ZPI18N.getString("zp.holiday.lowercaseholiday"));var htmlContent="";htmlContent+='<div class="zpl_secn text-left"><span>'+ZPI18N.getString("zp.leave.operations.deleteinfo",[isWorkingDayPage?ZPI18N.getString("zp.leave.operations.smallexpworkingday"):ZPI18N.getString("zp.holiday.lowercaseholiday")+""])+"</span>",htmlContent+=isWorkingDayPage?"</div>":'<div class="zcheckbox"><input type="checkbox" name="feed" class="zcheckbox__helper"><label class="zcheckbox__label" style="padding-right:200px;"><span class="zradiobutton__text">'+ZPI18N.getString("zp.holiday.notifyemployees")+'</span></label></div><div class="zcheckbox"><input type="checkbox" name="reprocess" class="zcheckbox__helper"><label class="zcheckbox__label" style="padding-right:18px;"><span class="zradiobutton__text">'+ZPI18N.getString("zp.holiday.reprocess.deletedesc",[holidayDispName])+'</span></label><em id="reprocessInfo" class="d-flex" style="padding-left: 25px;">('+ZPI18N.getString("zp.holiday.reprocess.info",[holidayDispName])+")</em></div></div>";var deleteModal=new DeleteAlertMessage;deleteModal.title=ZPI18N.getString("zp.delete")+" "+(isWorkingDayPage?ZPI18N.getString("zp.leave.operations.smallexpworkingday"):ZPI18N.getString("zp.holiday.lowercaseholiday"))+"?",deleteModal.despcription=htmlContent,deleteModal.yesButtonText=ZPI18N.getString("zp.confirm"),deleteModal.cancelButtonText=ZPI18N.getString("zp.cancel"),deleteModal.callback=function(){deleteCallback(ele,deleteModal.alertDiv)},deleteModal.show(),!isWorkingDayPage&&deleteModal.alertDiv.find(".zcheckbox").on("click",function(){let swtched=$(this).find("input[type=checkbox]");swtched.prop("checked",!swtched.prop("checked"))})},Holidays.Operation.deleterec=function(ele,modal){var params={method:"delete"};params[csrfParamName]=csrfToken;var trparent=$(ele).closest("tr"),rec_id=trparent.attr("pk_id");modal.find("#yesBtn").addClass("disabled"),rec_id&&(params.id=rec_id,params.feed=modal.find("input[name=feed]").is(":checked"),params.isReprocessNeeded=modal.find("input[name=reprocess]").is(":checked"),$.post("delete_holiday.zp",params,function(data){"success"===data.status&&(data.isdeleted?(trparent.remove(),ModuleComp.Msg.showSuccessMsg(ZSEC.Encoder.encodeForHTML(data.message)),data.reprocessMsg&&setTimeout(function(){ModuleComp.Msg.showWarningMsg(ZSEC.Encoder.encodeForHTML(data.reprocessMsg))},5e3),modal.hide(),Holidays.View.get(),Holidays.GCalSync.syncStatus="askServer"):(modal.find("#yesBtn").removeClass("disabled"),ModuleComp.Msg.showFailureMsg(ZSEC.Encoder.encodeForHTML(data.message))))}))},Holidays.Operation.getbars=function(dates,isView){if(!dates.from||!dates.to)return Holidays.Operation.hidebars(),!1;if(!Calendar.isvalidDate(dates.from)||!Calendar.isvalidDate(dates.to))return Holidays.Operation.hidebars(),!1;var modalparent=settingsPage.container.find("#holidays_add_edit_view"),period=modalparent.find("input[name=fromto]"),from=Calendar.parseDate(dates.from,uidateFormat),to=Calendar.parseDate(dates.to,uidateFormat);if(from>to)return Holidays.Operation.hidebars(),!1;Holidays.Operation.hideerror(period);var daydetails=modalparent.find("#Holiday_DayDetails"),body=daydetails.find(".zpl_gbox").html("");daydetails.removeClass("DN");document.createDocumentFragment();for(var table=ZP.create("table",{class:"zpl_itbl"}),tbody=ZP.create("tbody");from<=to;){var holidaydate=Calendar.formatDate(from);tbody.appendChild(Holidays.Operation.constructBar({date:holidaydate,day:days[from.getDay()]},isView)),from=from.setDate(from.getDate()+1),from=new Date(from)}table.appendChild(tbody),body.append($(table)),daydetails.removeClass("DNI")},Holidays.Operation.constructBar=function(details,isView){var returnDiv="";if(isView){var barwidth=details.ishalfday?"50":"100",progressparent=ZP.create("div"),dayDiv=ZP.create("div");dayDiv.appendChild(ZP.create("span",{text:details.day+"  "+details.date,date:details.date}));var progressbarouter=ZP.create("div",{style:"width: 250px;","data-mode":"determinate","data-value":"20",role:"progressbar","aria-valuemin":"0","aria-valuemax":"100",class:"zprogress--group"});progressbarouter.appendChild(Holidays.Operation.progressBar(barwidth,details.session)),progressparent.appendChild(dayDiv),progressparent.appendChild(progressbarouter),returnDiv=progressparent}else{var tr=ZP.create("tr"),dateTd=ZP.create("td");dateTd.appendChild(ZP.create("span",{text:details.day+"  "+details.date,date:details.date})),tr.appendChild(dateTd);var sessionTd=ZP.create("td");sessionTd.appendChild(ZP.create("select",{name:details.date}));var optArray=Holidays.Operation.constructSessionOpts();LeaveAdminOpers.ZPeopleComponents.Select.init({container:$(sessionTd).find("select"),optArray:optArray,defVal:details.ishalfday?"0.5-"+details.session:"0"}),tr.appendChild(sessionTd),returnDiv=tr}return returnDiv},Holidays.Operation.constructSessionOpts=function(){return[{label:ZPI18N.getString("zp.fullday"),value:"0"},{label:ZPI18N.getString("zp.1sthalf"),value:"0.5-1"},{label:ZPI18N.getString("zp.2ndhalf"),value:"0.5-2"}]},Holidays.Operation.hidebars=function(){var modalparent=settingsPage.container.find("#holidays_add_edit_view"),period=modalparent.find("#dateErr");Holidays.Operation.showerror(period.parent(),ZPI18N.getString("zp.validdateerr"));var daydetails=modalparent.find("#Holiday_DayDetails");daydetails.addClass("DNI"),daydetails.find(".zpl_gbox").html("")},Holidays.Operation.save=function(){var holiday=settingsPage.container.find("#holidays_add_edit_view");holiday.find(".zpl_mfoter").find("#sliderSbt").addClass("disabled");var period=holiday.find("input[name=fromto]"),params={},pk_id=holiday.attr("pk_id");if(void 0==pk_id||""==pk_id||isNaN(pk_id)||(params.id=pk_id),!Holidays.Operation.validate(params))return holiday.find(".zpl_mfoter").find("#sliderSbt").removeClass("disabled"),!1;params.method="update";var daydetails={};if($("#Holiday_DayDetails tr",settingsPage.container).each(function(){var date=$(this).find("span").attr("date"),sessionVal=ZPeopleComponents.select($(this).find("select")).getValue().split("-");daydetails[date]={ishalfday:.5==sessionVal[0],session:sessionVal[sessionVal.length-1]}}),$.isEmptyObject(daydetails))return Holidays.Operation.showerror(period.parent(),ZPI18N.getString("zp.validdateerr")),void holiday.find(".zpl_mfoter").find("#sliderSbt").removeClass("disabled");params.daydetails=JSON.stringify(daydetails);var classificationId=holiday.find("select[name=holidayclassification]").val();params.restricted=Holidays.View.isRestrictedHoliday(classificationId),ZPeople.Request.send("update_holiday.zp",params,function(respdata){if($.isEmptyObject(respdata.error))respdata.success?(settingsPage.container.find("#holidays_add_edit_view").remove(),Holidays.View.holidayData={},Holidays.View.get(),Holidays.GCalSync.syncStatus="askServer",ModuleComp.Msg.showSuccessMsg(ZSEC.Encoder.encodeForHTML(respdata.message)),respdata.reprocessMsg&&setTimeout(function(){ModuleComp.Msg.showWarningMsg(ZSEC.Encoder.encodeForHTML(respdata.reprocessMsg))},5e3)):1==respdata.noof_duplicate&&(ModuleComp.Msg.showFailureMsg(ZSEC.Encoder.encodeForHTML(respdata.message)),settingsPage.container.find("#holidays_add_edit_view").find(".zpl_mfoter").find("#sliderSbt").removeClass("disabled"));else{var holiday=settingsPage.container.find("#holidays_add_edit_view"),name=holiday.find("input[name='name']"),period=holiday.find("input[name=fromto]"),desc=holiday.find("textarea[name=remark]");respdata.error[0].hasOwnProperty("name")&&Holidays.Operation.showerror(name,ZPI18N.getString("zp.holiday.nameerror")),respdata.error[0].hasOwnProperty("date")&&Holidays.Operation.showerror(period.parent(),ZPI18N.getString("zp.validdateerr")),respdata.error[0].hasOwnProperty("desc")&&Holidays.Operation.showerror(desc,respdata.error[0].msg),holiday.find(".zpl_mfoter").find("#sliderSbt").removeClass("disabled")}})},Holidays.Operation.validate=function(params){var isvalid=!0,holiday=settingsPage.container.find("#holidays_add_edit_view"),name=holiday.find("input[name='name']"),period=holiday.find("input[name=fromto]"),reminderday=holiday.find("select[name=numberofdays]"),holidayClassification=holiday.find("select[name=holidayclassification]"),dates=Leave.Util.getDoubleCalFromTo(period.val()),from=dates.from,to=dates.to;Calendar.isvalidDate(period.val())&&(from=period.val(),to=period.val());var description=holiday.find("textarea[name='remark']");if(name.val()&&""!=name.val()?(Holidays.Operation.hideerror(name),params.name=name.val()):(Holidays.Operation.showerror(name,ZPI18N.getString("zp.holiday.nameerror")),isvalid=!1),from&&to&&Calendar.isvalidDate(from)&&Calendar.isvalidDate(to)){var from_dt=Calendar.parseDate(from,uidateFormat),to_dt=Calendar.parseDate(to,uidateFormat);isNaN(from_dt.getTime())||isNaN(to_dt.getTime())||from_dt>to_dt?(Holidays.Operation.showerror(period.parent(),ZPI18N.getString("zp.validdateerr")),isvalid=!1):(Holidays.Operation.hideerror(period),params.from=Calendar.formatDate(from_dt,uidateFormat),params.to=Calendar.formatDate(to_dt,uidateFormat))}else Holidays.Operation.showerror(period.parent(),ZPI18N.getString("zp.validdateerr")),isvalid=!1;var remarks=description.val()?description.val():"";holiday.find("input[type=checkbox][name=feed]").prop("checked")?params.feed=!0:params.feed=!1,holiday.find("input[type=checkbox][name=isReprocessNeeded]").prop("checked")?params.isReprocessNeeded=!0:params.isReprocessNeeded=!1,"-1"==holidayClassification.val()?(Holidays.Operation.showerror(holiday.find("select[name=holidayclassification]"),ZPI18N.getString("zp.entervalidoption",[ZPI18N.getString("zp.classification")])),isvalid=!1):(Holidays.Operation.hideerror(holiday.find("select[name=holidayclassification]")),params.holidayClassification=holidayClassification.val());var remind_data={};if(remind_data.remindday=parseInt(reminderday.val()),params.holidayconf=JSON.stringify(remind_data),params.holidayClassification=holidayClassification.val(),isvalid){var reminderVal=reminderday.val();if("-1"!=reminderVal){from_dt=Calendar.parseDate(from,uidateFormat);var curDate=Calendar.parseDate(ZPeople.Module.MODULE_DATA.leavetracker.leave_filterops.cur_period.cur_date,uidateFormat),reminder_dt=Calendar.parseDate(from,uidateFormat),date=from_dt.getDate()-parseInt(reminderVal);reminder_dt.setDate(date),reminder_dt<=curDate&&(Holidays.Operation.showerror(holiday.find("[name=numberofdays]").parent(),ZPI18N.getString("zp.holiday.holidayreminderinfo2")),isvalid=!1)}}params.remark=remarks;var applFor=AppExc.constructAppValues(holiday,"#appToSec",Holidays.Add.appElementsKey);return applFor.location&&1==applFor.location.length&&"0"==applFor.location[0]&&(applFor.location=Object.keys(AppExc.appElements.locationList)),params.location=JSON.stringify(applFor.location),applFor.shifts&&1==applFor.shifts.length&&"0"==applFor.shifts[0]&&(applFor.shifts=Object.keys(AppExc.appElements.shiftList)),params.shifts=JSON.stringify(applFor.shifts),isvalid},Holidays.Operation.showerror=function(ele,text){ele.parent().find(".ztextbox--error__label").removeClass("DNI").html(text+""),ele.addClass("ztextbox__error")},Holidays.Operation.hideerror=function(ele){ele.removeClass("ztextbox__error"),ele.parent().find(".ztextbox--error__label").addClass("DNI")},Holidays.Operation.fill_form=function(data,form){$(form.find("[name]")).each(function(idx,ele){var name=(field=$(ele)).attr("name");if("name"===name||"remark"==name)field.val(ZPeople.decodeTxt(data[name]));else if("fromto"===name){data.from===data.to?field.val(data.from):field.val(data.from+"-"+data.to);var detailsdiv=form.find("#Holiday_DayDetails");detailsdiv.removeClass("DNI"),detailsdiv.find(".zpl_gbox").append("<table class='zpl_itbl'><tbody></tbody></table>");var body=detailsdiv.find(".zpl_gbox").find("tbody"),daydetails=data.daydetails,temp_doc=document.createDocumentFragment();$.each(daydetails,function(indx,datajson){temp_doc.appendChild(Holidays.Operation.constructBar({date:datajson.dis_date,ishalfday:datajson.ishalfday,day:datajson.day,session:datajson.session}))}),body.append(temp_doc)}else if("numberofdays"==name||"feed"==name){if(data.holidayconf){var confData;confData=JSON.parse(data.holidayconf),reminderdata=JSON.parse(data.holidayconf),"feed"==name?form.find("input[name=feed]").attr("checked",!!confData.publishFeed&&"checked"):ZPeopleComponents.select(form.find("[name=numberofdays]")).setValue(reminderdata.remindday)}}else if("holidayclassification"===name){var field;if("-"===(field=data.holidayClassification?data.holidayClassification:"-"))return;ZPeopleComponents.select(form.find("[name=holidayclassification]")).setValue(field)}}),Holidays.Add.appElementsKey.forEach(function(val,index){val="shifts"==val?"shift":val,Holidays.Add.appElementsIndex.includes(index)&&data[val].length>0&&AppExc.addNewConditionRow(void 0,"appToSec",index,data[val])})},Holidays.Operation.fill_view=function(data,form){form.find(".view_fields").remove(),$(form.find("label")).each(function(){var name=(field=$(this)).attr("name");if($(ZP.create("div",{name:name,class:"view_fields"})).insertAfter($(this).parent()),ele=$(this).parent().siblings(".view_fields"),"Date"===name){data.from===data.to?$(ele).append(ZP.create("span",{text:data.from})):$(ele).append(ZP.create("span",{text:data.from+"  -  "+data.to}));var detailsdiv=form.find("#Holiday_DayDetails");detailsdiv.removeClass("DNI"),detailsdiv.empty();var daydetails=data.daydetails,temp_doc=document.createDocumentFragment();$.each(daydetails,function(indx,datajson){temp_doc.appendChild(Holidays.Operation.constructBar({date:datajson.dis_date,ishalfday:datajson.ishalfday,day:datajson.day,session:datajson.session},!0))}),detailsdiv.append(temp_doc)}else if("location"===name)if(data.locations&&data.locations.length>0)for(indx in data.locations)indx<data.locations.length-1?$(ele).append(ZP.create("span",{text:ZPeople.decodeTxt(data.locations[indx].name)+", "})):$(ele).append(ZP.create("span",{text:ZPeople.decodeTxt(data.locations[indx].name)}));else $(ele).append(ZP.create("span",{text:ZPI18N.getString("zp.alllocaction")}));else if("shift"===name)if(data.shifts&&data.shifts.length>0)for(indx in data.shifts)indx<data.shifts.length-1?$(ele).append(ZP.create("span",{text:ZPeople.decodeTxt(data.shifts[indx].name)+", "})):$(ele).append(ZP.create("span",{text:ZPeople.decodeTxt(data.shifts[indx].name)}));else $(ele).append(ZP.create("span",{text:ZPI18N.getString("zp.allshift")}));else if("holidayclassification"==name){if(data.holidayClassification)"-"!==(field=data.holidayClassification?data.holidayClassification:"-")&&(field=Holidays.getHolidayTypefromId(field)),$(ele).append(ZP.create("span",{text:field}));else field.parent().parent().remove()}else{var field=data[name]?ZPeople.decodeTxt(data[name]):"-";$(ele).append(ZP.create("span",{text:field}))}})},Holidays.Operation.progressBar=function(barwidth,session){var progressbar=ZP.create("div",{class:"zprogress",style:"background:#DBDBDB;"});return progressbar.appendChild(ZP.create("div",{class:"zprogress__bar",style:"background: rgb(65, 144, 242); width:"+barwidth+"%; left:"+(2==session?"50%":"0%")+";"})),progressbar},Holidays.optDisplayNameInSingularForm=function(){var dispName=ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name;return dispName==ZPI18N.getString("zp.holidays")?ZPI18N.getString("zp.holiday"):dispName},Holidays.GCalSync={syncStatus:"askServer",showGoogleSyncModal:function(){if("upToDate"!=Holidays.GCalSync.syncStatus)if("nothingToSync"!=Holidays.GCalSync.syncStatus){var gcalSyncModal=new SuccessAlertMessage;gcalSyncModal.title=ZPI18N.getString("zp.gcalsync.syncwithgooglecalendar"),gcalSyncModal.despcription=ZPeople.LOADING_HTML,gcalSyncModal.yesButtonText=ZPI18N.getString("zp.confirm"),gcalSyncModal.cancelButtonText=ZPI18N.getString("zp.cancel"),gcalSyncModal.construct("--blue","success");var modal=gcalSyncModal.alertDiv;modal.find(".alert_contain").find("i").remove(),modal.attr("id","gCalSyncModal"),modal.find(".zpl_mcnt").append('<p class="text-center LH20 dgry" id="zp_confirm_body"></p>'),modal.show(),modal.find("#cnlBtn, ._cls").on("click",function(){$("#gCalSyncModal #zp_confirm_body").html("").siblings().remove(),modal.hide()}),$("#gCalSyncModal #yesBtn").addClass("disabled").off("click"),ZPeople.Request.send("/gcalSyncAction.zp",{mode:"gAuthStatus"},Holidays.GCalSync.handleGoogleAuthStatusResponse)}else ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.gcalsync.nothingtosyncmessage",[ZPeople.decodeTxt(ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name)]));else ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.gcalsync.syncuptodatemessage",[ZPeople.decodeTxt(ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name)]))},handleGoogleAuthStatusResponse:function(response){if(void 0==response||""==response||"failure"==response)return Holidays.GCalSync.removeLoadingHtml(!0),void ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.gcalsync.syncerror"));var responseJson=JSON.parse(response),status=responseJson.hasOwnProperty("status")?responseJson.status:"",nextStep=responseJson.hasOwnProperty("nextStep")?responseJson.nextStep:"";if(Holidays.GCalSync.syncStatus=responseJson.hasOwnProperty("syncStatus")?responseJson.syncStatus:"","apiDisabled"===status||"dataDisabled"===status)return Holidays.GCalSync.removeLoadingHtml(!0),void ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.gcalsync.gappsuseraccessdenied"));"showAuthoriseButton"===status?Holidays.GCalSync.showAuthoriseButton(nextStep,!0):"showCalendarsList"===status?Holidays.GCalSync.showCalendarsList(responseJson.calendarsArray):"showSyncButton"===status&&Holidays.GCalSync.showSyncButton()},showAuthoriseButton:function(nextStep,isNewVersion){var gcalOAuthUrl=ZPeople.gcalendarGadgetsUrl;""!==nextStep&&(gcalOAuthUrl=gcalOAuthUrl+"?nextStep="+nextStep),isNewVersion&&(gcalOAuthUrl=gcalOAuthUrl+"?isZPVersion5="+!0),$("#gCalSyncModal #zp_confirm_body").text(ZPI18N.getString("zp.gcalsync.showauthorizetext",[ZPeople.decodeTxt(ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name)])),$("#gCalSyncModal #yesBtn").removeClass("disabled").text(ZPI18N.getString("zp.authorize")).off("click").on("click",function(){var width=.7*screen.width,height=.7*screen.height,left=(screen.width-width)/2,top=(screen.height-.8*screen.height)/2;window.open(gcalOAuthUrl,"GCalAuthWinFromZP","width="+width+",height="+height+",left="+left+",top="+top+",screenX="+left+",screenY="+top)}),Holidays.GCalSync.removeLoadingHtml(!0)},closeOAuthPageCallback:function(accessDenied,nextStep){"true"!=accessDenied?(Holidays.GCalSync.hideModalBodyAndAppendLoadingHtml(),"showSyncButton"===nextStep?Holidays.GCalSync.showSyncButton():ZPeople.Request.send("/gcalSyncAction.zp",{mode:"gCalList"},function(response){if(void 0==response||""==response||"failure"==response)return Holidays.GCalSync.removeLoadingHtml(!0),void ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.gcalsync.syncerror"));Holidays.GCalSync.showCalendarsList(JSON.parse(response))})):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.gcalsync.googleaccessdenied"))},showCalendarsList:function(calendarsArray){if(void 0==calendarsArray||0==calendarsArray.length)return Holidays.GCalSync.removeLoadingHtml(!0),void ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.gcalsync.syncerror"));var radioHtml='<div class="zpl_crd"><div class="zpl_crdcnt"><div class="zpl_secn"><div id="gcalListUL">';$.each(calendarsArray,function(index,value){radioHtml+='<div class="zradiobutton"><input type="radio" name="gcalendarsList" class="zradiobutton__helper" value="'+value.gcalId+'"><label class="zradiobutton__label"><span>'+value.gcalName+"</span></span></label></div>"}),radioHtml+='</div><div class="zpl_idiv" id="addNewGCalText"><a class="zpl_lnkbg" onclick="Holidays.GCalSync.toggleAddNewGCalendarListItem(true);"><i class="PI_plus"></i>'+ZPI18N.getString("zp.addnew")+"</a></div>",radioHtml+='<div class="zpl_idiv DNI" id="addNewGCalInput"><div class="zpl_rwfld"><input id="newGCalTitle" type="text" class="ztextbox"><button class="zlabel zlabel--blue zlabel--medium ML10" onclick="Holidays.GCalSync.validateAndAddNewCalendarInGCalendar();">'+ZPI18N.getString("zp.add")+'</button><button class="zlabel zlabel--outline zlabel--medium" onclick="Holidays.GCalSync.toggleAddNewGCalendarListItem(false);">'+ZPI18N.getString("zp.cancel")+"</button></div></div>",radioHtml+="</div></div></div>",$("#gCalSyncModal #zp_confirm_body").text(ZPI18N.getString("zp.gcalsync.showcalendarslisttext")).after(radioHtml),$("#gCalSyncModal .zradiobutton").on("click",function(event){$('input[name="gcalendarsList"]').prop("checked",!1),$(this).find('[name="gcalendarsList"]').prop("checked","checked")}),$("#gCalSyncModal #yesBtn").removeClass("disabled").text(ZPI18N.getString("zp.submit")).off("click").on("click",Holidays.GCalSync.validateAndSendSelectedCalendarId),Holidays.GCalSync.removeLoadingHtml(!0)},validateAndAddNewCalendarInGCalendar:function(){var calendarTitle=$("#gCalSyncModal #newGCalTitle").val();if(""==calendarTitle)return ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.gcalsync.addnewcalendarnonameerror")),void $("newGCalTitle").trigger("focus");Holidays.GCalSync.hideModalBodyAndAppendLoadingHtml();var params={mode:"addGCal",calendarTitle:calendarTitle};ZPeople.Request.send("/gcalSyncAction.zp",params,function(response){if($("#gCalSyncModal #yesBtn").removeClass("disabled"),void 0==response||""==response||"failure"==response)return Holidays.GCalSync.removeLoadingHtml(!0),void ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.gcalsync.addnewcalendarerror"));$("#gcalListUL").append('<div class="zradiobutton"><input type="radio" name="gcalendarsList" class="zradiobutton__helper" value="'+response+'"><label class="zradiobutton__label"><span>'+calendarTitle+"</span></span></label></div>"),$("#gcalListUL input[name='gcalendarsList'][value='"+response+"']").prop("checked",!0),$("#gCalSyncModal #newGCalTitle").val(""),Holidays.GCalSync.toggleAddNewGCalendarListItem(!1),Holidays.GCalSync.removeLoadingHtml(!0)})},validateAndSendSelectedCalendarId:function(){var selectedCalId=$("#gCalSyncModal .zpl_secn").find("input[name='gcalendarsList']:checked").val();if(selectedCalId){Holidays.GCalSync.hideModalBodyAndAppendLoadingHtml();var params={mode:"saveGCalId",gCalendarId:selectedCalId};ZPeople.Request.send("/gcalSyncAction.zp",params,Holidays.GCalSync.handleSaveSelectedCalendarResponse)}else ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.gcalsync.calendarnotselectederror"))},handleSaveSelectedCalendarResponse:function(response){if(void 0==response||""==response||"failure"==response)return Holidays.GCalSync.removeLoadingHtml(!0),void ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.gcalsync.syncerror"));"success"==response&&Holidays.GCalSync.showSyncButton()},showSyncButton:function(){$("#gCalSyncModal #zp_confirm_body").siblings().remove();var syncStatus=Holidays.GCalSync.syncStatus;if(void 0==syncStatus||""==syncStatus||"notYetSynced"==syncStatus)$("#gCalSyncModal #zp_confirm_body").text(ZPI18N.getString("zp.gcalsync.firsttimesyncmessage",[ZPeople.decodeTxt(ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name)]));else if("reSync"==syncStatus)$("#gCalSyncModal #zp_confirm_body").text(ZPI18N.getString("zp.gcalsync.resyncmessage",[ZPeople.decodeTxt(ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name)]));else{if("upToDate"==syncStatus)return ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.gcalsync.syncuptodatemessage",[ZPeople.decodeTxt(ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name)])),void $("#gCalSyncModal").modal("hide");if("nothingToSync"==syncStatus)return ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.gcalsync.nothingtosyncmessage",[ZPeople.decodeTxt(ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name)])),void $("#gCalSyncModal").modal("hide")}$("#gCalSyncModal #yesBtn").removeClass("disabled").text(ZPI18N.getString("zp.push")).off("click").on("click",function(){Holidays.GCalSync.hideModalBodyAndAppendLoadingHtml(),ZPeople.Request.send("/gcalSyncAction.zp",{mode:"syncHols"},Holidays.GCalSync.handleSyncButtonClickResponse)}),Holidays.GCalSync.removeLoadingHtml(!0)},handleSyncButtonClickResponse:function(response){Holidays.GCalSync.removeLoadingHtml(!0),void 0!=response&&""!=response&&"failure"!=response?("success"===response&&(Holidays.GCalSync.syncStatus="upToDate",ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.gcalsync.holidayssyncsuccess",[ZPeople.decodeTxt(ZPeople.Module.MODULE_DATA.leavetracker.holiday_filterops.display_name)]))),$("#gCalSyncModal").modal("hide")):ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.gcalsync.syncerror"))},toggleAddNewGCalendarListItem:function(showInput){showInput?($("#addNewGCalText").addClass("DNI"),$("#addNewGCalInput").removeClass("DNI")):($("#addNewGCalText").removeClass("DNI"),$("#addNewGCalInput").addClass("DNI"))},removeLoadingHtml:function(showModalBody){$("#gCalSyncModal #zp_page_loading").remove(),showModalBody&&$("#gCalSyncModal .zpl_secn").children(":not('#addNewGCalInput')").removeClass("DNI")},hideModalBodyAndAppendLoadingHtml:function(){$("#gCalSyncModal .zpl_secn").append(ZPeople.LOADING_HTML).children(":not('#zp_page_loading')").addClass("DNI"),$("#yesBtn").addClass("disabled")}};