ZPFRules={ruleObj:{},conditionObj:{},actionObj:{},params:{},url:"/fieldRules.zp",rulesArray:[],formFields:[],ruleGroupTemplate:'<div class="panel-group dvaddruleacc" id="dvAddruleparent">$RULECONSTRUCT$</div>',errorTemplate:'<div class="dverrormsg DN" errorid="errorDiv"></div>',ruleHeaderTemplate:'<div class="panel clearfix" name="singleRuleDiv"><a name="deleteIcon" class="IC-delete gry FR lnkcls" onclick="ZPFRules.deleteRule({}, {forPost:true}, {obj:this})"></a><div name="ruleToggleDiv" class="GryBG panel-heading PT5 PL10 PB3" data-parent="#dvAddruleparent" data-target="#dvRule$COUNT$" onclick="ZPFRules.collapseElement(this)"><h6 class="ZPbold S16">'+ZPI18N.getString("zp.rule")+' $COUNT$</h6></div><div id="dvRule$COUNT$" $RULEID$ class="panel panel-collapse collapse col-md-12"><div class="dvCriteria clearfix dvfrmaddrule MT35"><div class="clearfix PB5"></div>$RULEDIV$</div><div class="dverrormsg DN" errorid="errorDiv"></div></div></div>',ruleIfDivTemplate:'<div class="form-group spnpostxt" id="$RULEID$"><label>'+ZPI18N.getString("zp.if")+'</label><select class="selectBox" id="ruleOperator"><option value="0" $SELECTED0$>'+ZPI18N.getString("zp.all")+'</option><option value="1" $SELECTED1$>'+ZPI18N.getString("zp.any")+"</option></select><label>"+ZPI18N.getString("zp.followingconditionsmet")+"</label></div>",selectTemplate:'<select class="selectBox" keyname="$KEYNAME$" $DISABLED$ onchange="$METHOD$" $MULTIPLE$>$OPTIONS$</select>',ruleConditionTemplate:'<div class="form-group $CLASS$" id="$ID$" rulenum="$NUM$" name="$NAME$" key="$KEY$">$CONDITION$</div>',addRemoveTemplate:'<div class="form-group col-md-1" name="addRemoveDiv"><div class="dvlist-action MT8"><a class="IC-plus-big S12 MR15 gry" onclick="ZPFRules.addDeleteCondition(this, true)"></a><a class="IC-mins gry S12" onclick="ZPFRules.addDeleteCondition(this, false)"></a></div></div>',optionsTemplate:'<div class="tabvertical tabselect DN" id="conditionDropdownSelection"><div class="rhttablst"><div class="dvPopsearch"><input class="form-control" onkeyup="ZPFRules.searchOptions(this)" type="search" placeholder="'+ZPI18N.getString("zp.search")+'..."></div><ul class="list-group ulRecipient" role="tablist" id="listBody">$LIST$</ul></div></div>',liTemplate:'<li name="list-group-item" class="$CLASS$" onclick="ZPFRules.conditionSelectRecord(this)"><span data-toggle="tab" role="tab" name="mOpt" id="$LISTID$">$LISTVALUE$</span></li>',formActionUsedFields:{},leaveTypes:[],setEmptyFcs:[],count:1},ZPFRules.OPERATOR={SHOW:0,HIDE:1,ALL:0,ANY:1},ZPFRules.ruleCreation=function(obj){var eles=$(obj).parents("#rule").find("[id*=dvRule]"),hasError=!1,isUpdate=!0,rulesArray=[];$(obj).parents("#rule").find("[errorid]").html(),$(obj).parents("#rule").find("[errorid]").hide(),eles.length>0&&$.each(eles,function(index,rule){isUpdate=!0;var ruleObject={},checkRuleObject={},conditionActionArray=[];ruleObject.ruleId=$(rule).attr("ruleid"),ruleObject.operator=$(rule).find("#ruleOperator").val(),void 0!=ruleObject.ruleId&&""!=ruleObject.ruleId&&""!=(checkRuleObject=ZPFRules.findObject(ZPForm.FIELD_RULE_DETAILS[$(obj).parents("#rule").find("#bodyTag").attr("formid")],"ruleId",ruleObject.ruleId))&&void 0!=checkRuleObject&&checkRuleObject.operator==ruleObject.operator&&(isUpdate=!1),$.each($(rule).find("[key=conditionFields]"),function(ind,condition){var checkConditionActionObject={},conditionActionObject={},attrId=$(condition).attr("id").toString();if(null!=attrId.match(/[\d]+$/)&&(conditionActionObject.conditionId=attrId.match(/[\d]+$/).toString(),checkConditionActionObject=ZPFRules.findObject(checkRuleObject.conditionArray,"conditionId",conditionActionObject.conditionId)),conditionActionObject.fcid=$(condition).find("[keyname]").val(),isUpdate||checkConditionActionObject.fcid==conditionActionObject.fcid||(isUpdate=!0),0==conditionActionObject.fcid.trim().length)$(condition).find("[errorid=errorDiv]").html("Please select a field for condition"),$(condition).find("[errorid=errorDiv]").show(),$(rule).addClass("in"),hasError=!0;else{var fieldValueObject=$(condition).next("[key=condition]").next("[key=fieldValue]");conditionActionObject.operator=$(condition).next("[key=condition]").find("[keyname=operator]").val(),conditionActionObject.value=$(fieldValueObject).find("#fieldValue").val();var fieldDtls=ZPForm.Field.getFieldComponent(conditionActionObject.fcid,$(condition).parents("#bodyTag").attr("formid"));if((fieldDtls.fieldType==ZPForm.Field.LOOKUP||fieldDtls.fieldType==ZPForm.Field.PICKLIST||fieldDtls.fieldType==ZPForm.Field.NEW_GENDER||fieldDtls.fieldType==ZPForm.Field.NEW_BLOODGROUP||fieldDtls.fieldType==ZPForm.Field.NEW_COUNTRY)&&$(fieldValueObject).find("#optionsIcon").length>0&&$.inArray(parseInt(conditionActionObject.operator),[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1){var value="";$.each($(fieldValueObject).find("#conditionDropdownSelection #listBody li.sel"),function(){var id=$(this).find("span").attr("id");value+=id+","}),value=value.substring(0,value.length-1),conditionActionObject.value=value}else if(fieldDtls.fieldType==ZPForm.Field.DATE_TIME&&!ZPFRules.checkEmptyValue(conditionActionObject.value)){var val=conditionActionObject.value;Calendar.is12HrFormat()&&(conditionActionObject.value=Calendar.convertHourFormat(val))}if($.inArray(parseInt(conditionActionObject.operator),[ZPNewView.OPERATORS.TRUE,ZPNewView.OPERATORS.FALSE,ZPNewView.OPERATORS.EMPTY,ZPNewView.OPERATORS.NOT_EMPTY])<0&&(void 0==conditionActionObject.value||"null"==conditionActionObject.value||0==conditionActionObject.value.trim().length))$(fieldValueObject).find("[errorid=errorDiv]").html(ZPI18N.getString("zp.entervalueforcondn")),$(fieldValueObject).find("[errorid=errorDiv]").show(),$(rule).addClass("in"),hasError=!0;else{if(void 0!=checkConditionActionObject.operator){var checkValue=checkConditionActionObject.value;fieldDtls.fieldType==ZPForm.Field.DATE&&(checkValue=Calendar.parseDate(checkValue,uidateFormat),checkValue=Calendar.formatDate(checkValue)),isUpdate||checkValue==conditionActionObject.value&&checkConditionActionObject.operator==conditionActionObject.operator||(isUpdate=!0)}else isUpdate||(isUpdate=!0);conditionActionArray.push(conditionActionObject)}}}),isUpdate||checkRuleObject.conditionArray.length==conditionActionArray.length||(isUpdate=!0),ruleObject.conditionArray=conditionActionArray;var showHideArray=[],actionArray=[];if($.each($(rule).find("[key=action]"),function(index1,action){var conditionActionObject={},checkConditionActionObject={};null!=(showHideArray=$(action).next("#actionFields").find("select").val())&&0!=showHideArray.length&&(conditionActionObject.operator=$(action).find("label").attr("saveValue"),void 0!=ruleObject.ruleId&&(void 0==(checkConditionActionObject=ZPFRules.findObject(checkRuleObject.actionArray,"operator",conditionActionObject.operator)).operator?isUpdate=!0:isUpdate||ZPFRules.containsAllElements(checkConditionActionObject.fieldArray,showHideArray)||(isUpdate=!0)),conditionActionObject.fieldArray=showHideArray,actionArray.push(conditionActionObject))}),0==actionArray.length){$(rule).addClass("in"),hasError=!0;var errorAt=$(rule).find("#actionFields").parent().children("[errorid=errorDiv]");$(errorAt).html(ZPI18N.getString("zp.showhidefield")),$(errorAt).show()}isUpdate||checkRuleObject.actionArray.length==actionArray.length||(isUpdate=!0),ruleObject.actionArray=actionArray,isUpdate&&rulesArray.push(ruleObject)}),!hasError&&rulesArray.length>0&&(ZPFRules.params={rulesArray:JSON.stringify(rulesArray),formId:$(obj).parents("#rule").find("#bodyTag").attr("formid"),method:"addUpdate"},$(obj).parents("#rule").find("[buttonname=done]").addClass("disabled"),ZPeople.Request.send(ZPFRules.url,ZPFRules.params,ZPFRules.saveRule))},ZPFRules.saveRule=function(data,params){if(data.hasOwnProperty("msg")){var msg=data.msg.trim();if("success"==msg){var formRuleArray=ZPForm.FIELD_RULE_DETAILS[params.formId],ruleArray=JSON.parse(params.rulesArray),isUpdate=!1;for(index in ruleArray){var ruleObject=ruleArray[index],ruleDiv="",ruleIndex=0,responseRuleObj="",fieldElms=[],actionElms=[];if(responseRuleObj=data.ruleArray[index],ruleObject.hasOwnProperty("ruleId"))ruleIndex=ZPFRules.findObject(formRuleArray,"ruleId",ruleObject.ruleId,"index").index,ruleDiv=Layout.Page.container.find("#dvRule"+(parseInt(ruleIndex)+1)),isUpdate=!0;else ruleIndex=formRuleArray.length,ruleDiv=Layout.Page.container.find("#dvRule"+(parseInt(ruleIndex)+1)),$(ruleDiv).attr("ruleid",responseRuleObj.ruleId);$.each(responseRuleObj.conditionArray,function(i1,v1){fieldElms.push(v1.fcid.toString())}),responseRuleObj.fieldElms=fieldElms,$.each(responseRuleObj.actionArray,function(i1,v1){v1.fieldArray.length>0&&$.each(v1.fieldArray,function(i2,v2){actionElms.push(v1.fieldArray[i2])})}),responseRuleObj.actionElms=actionElms,formRuleArray[ruleIndex]=responseRuleObj,ZPForm.FIELD_RULE_DETAILS[params.formId]=formRuleArray;$(ruleDiv).find("[name=conditionDiv]");var i=0;$.each(data.ruleArray[index].conditionArray,function(index,condition){var conditionId=condition.conditionId;null!=$(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id").match(/[\d]+$/)?($(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id",$(ruleDiv).find("[name=conditionDiv]:eq("+i+++")").attr("id").replace(/[\d]+$/,conditionId)),$(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id",$(ruleDiv).find("[name=conditionDiv]:eq("+i+++")").attr("id").replace(/[\d]+$/,conditionId)),$(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id",$(ruleDiv).find("[name=conditionDiv]:eq("+i+++")").attr("id").replace(/[\d]+$/,conditionId))):($(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id",$(ruleDiv).find("[name=conditionDiv]:eq("+i+++")").attr("id")+conditionId),$(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id",$(ruleDiv).find("[name=conditionDiv]:eq("+i+++")").attr("id")+conditionId),$(ruleDiv).find("[name=conditionDiv]:eq("+i+")").attr("id",$(ruleDiv).find("[name=conditionDiv]:eq("+i+++")").attr("id")+conditionId))}),Layout.Page.container.find("[errorid]").hide(),Layout.Page.container.find("[errorid]").html("")}isUpdate?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.rulesuccessmsg",[ZPI18N.getString("zp.updatedmsg")])):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.rulesuccessmsg",[ZPI18N.getString("zp.addedmsg")])),ZPForm.FIELD_RULE_DETAILS[params.formId].formComponent=[]}else"failure"==msg||""==msg?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror")):ZPeople.confirm(null,"",msg,"",!0,!0)}else data.hasOwnProperty("failure")&&ZPeople.confirm(null,"",data.failure,"",!0,!0);Layout.Page.container.find("#rule").find("[buttonname=done]").removeClass("disabled")},ZPFRules.constructRulesJson=function(data,params,others){if(data.code==zpconst.ResponseCodes.API_ERR_NO_ERROR){if(ZPFRules.rulesArray=[],void 0!=data.ruleArray&&(ZPFRules.rulesArray=data.ruleArray,delete data.ruleArray,$.each(ZPFRules.rulesArray,function(index,val){var fieldElms=[],actionElms=[];$.each(val.conditionArray,function(i1,v1){fieldElms.push(v1.fcid.toString())}),val.fieldElms=fieldElms,$.each(val.actionArray,function(i1,v1){v1.fieldArray.length>0&&$.each(v1.fieldArray,function(i2,v2){actionElms.push(v1.fieldArray[i2])})}),val.actionElms=actionElms})),data.hasOwnProperty("leaveTypes")&&data.leaveTypes.length>0){var leaveTypesData=data.leaveTypes,options=[],option={};$.each(leaveTypesData,function(i,types){(option={}).Id=types.id,option.DISPVALUE=types.name,options.push(option)}),ZPFRules.leaveTypes=options}ZPForm.FIELD_RULE_DETAILS[params.formId]=ZPFRules.rulesArray,ZPForm.FIELD_RULE_DETAILS[params.formId].formComponent=[],void 0!=others&&others.isFromSelfService?ZPForm.CURRFORM_PARAM.formId=params.formId:ZPForm.CURRFORM_PARAM.formId=data.formId,window.location.href.split("#")[1]&&window.location.href.split("#")[1].indexOf("admin/formslayout")>=0&&!ZPForm.isPreviewForm&&!ZPForm.isRoleBasedPreview&&!others.isValidation&&ZPFRules.rulesConstruction(params.formId)}else data.hasOwnProperty("failue")&&ZPeople.confirm(null,"",data.failue.trim(),"",!0,!0)},ZPFRules.evaluateRulesForAllFields=function(isQuickAdd){if(ZPFRules.LAYOUT=ZPForm.PRINT?ZPForm.PRINTPAGE_DATA:ZPForm.LAYOUT,0!=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].length){$.each(ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId],function(i,rule){rule.isExecuted=!1});var formFields=ZPForm.FORM_COMPONENT_DATA[ZPForm.CURRFORM_PARAM.formId].message.formComponentDetails;ZPForm.ISBLUEPRINT&&ZPForm.Blueprint.BLUEPRINT_COMPONENTS[ZPForm.CURRFORM_PARAM.formId].message.formComponentDetails,$.each(formFields,function(index1,section){$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){void 0!=field&&ZPFRules.evaluateRules(field,isQuickAdd)})})}),$.each(ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId],function(i,rule){!rule.isExecuted&&rule.hasNotes&&ZPFRules.evaluateSingleRule(rule,isQuickAdd)})}},ZPFRules.evaluateRules=function(field,isQuickAdd){var fcId=field.formComponentId,type=field.fieldType,obj=ZPFRules.LAYOUT.find("#zp_field_outer_"+fcId);ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[fcId]=[],0!=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].length&&($.each(ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId],function(i,rule){1==isQuickAdd?-1!=$.inArray(fcId,rule.actionElms)&&(rule.isExecuted||ZPFRules.evaluateSingleRule(rule,isQuickAdd),$.each(rule.conditionArray,function(j,condition){var condObj=ZPFRules.LAYOUT.find("[id=zp_field_outer_"+condition.fcid+"]");condObj.length>0&&($(condObj).attr("isconditionfield",!0),void 0==ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[condition.fcid]&&(ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[condition.fcid]=[]),ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[condition.fcid].push(rule))})):-1!=$.inArray(fcId,rule.fieldElms)?(rule.isExecuted||ZPFRules.evaluateSingleRule(rule,isQuickAdd),ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[fcId].push(rule),$(obj).length>0&&$(obj).attr("isconditionfield",!0)):-1!=$.inArray(fcId,rule.actionElms)&&(type==ZPForm.Field.PLAIN_TEXT?void 0==rule.hasNotes&&(rule.hasNotes=!0):rule.hasNotes=!1)}),$(obj).length>0&&(obj=$(obj).find("[id^=zp_field_]").length>0?$(obj).find("[id^=zp_field_]"):obj,void 0!=$(obj).attr("displaytype")?$(obj).attr("displaytype")==ZPForm.Field.RADIO_DISPLYTYPE?($(obj).find("input").off("click",ZPFRules.makeExecutefalse),$(obj).find("input").off("click",ZPFRules.evaluateRulesForField),$(obj).find("input").on("click",function(event){ZPFRules.setEmptyFcs.length>0&&(ZPFRules.setEmptyFcs=[]),ZPFRules.makeExecutefalse(),ZPFRules.evaluateRulesForField(this)})):$(obj).attr("displaytype")==ZPForm.Field.SELECT_DISPLYTYPE&&($(obj).find("select").off("change",ZPFRules.makeExecutefalse),$(obj).find("select").off("change",ZPFRules.evaluateRulesForField),$(obj).find("select").on("change",function(event){ZPFRules.setEmptyFcs.length>0&&(ZPFRules.setEmptyFcs=[]),ZPFRules.makeExecutefalse(),ZPFRules.evaluateRulesForField(this)})):($(obj).off("change",ZPFRules.makeExecutefalse),$(obj).off("change",ZPFRules.evaluateRulesForField),$(obj).on("change",function(event){ZPFRules.setEmptyFcs.length>0&&(ZPFRules.setEmptyFcs=[]),ZPFRules.makeExecutefalse(),ZPFRules.evaluateRulesForField(this)}))))},ZPFRules.evaluateSingleRule=function(rule,isQuickAdd){var str=0,noOfConditions=0;$.each(rule.conditionArray,function(j,condition){var result="",field=ZPForm.Field.getFieldComponent(condition.fcid,ZPForm.CURRFORM_PARAM.formId);if(void 0!=field){var type=field.fieldType;result=type==ZPForm.Field.DATE?ZPFRules.evaluateDateConditions(condition,condition.fcid,field,isQuickAdd):type==ZPForm.Field.DATE_TIME?ZPFRules.evaluateDateConditions(condition,condition.fcid,field,isQuickAdd):ZPFRules.evaluateCondition(condition,condition.fcid,field,isQuickAdd),condition.result=result,str+=result,noOfConditions++}});var result=!1;str>0&&(result=rule.operator==ZPFRules.OPERATOR.ALL?str==noOfConditions:str>0),rule.result=result;var executeRulesFor=[];for(i=0;i<rule.actionArray.length;i++){var actionObj=rule.actionArray[i].fieldArray;if(actionObj.length>0)for(j=0;j<actionObj.length;j++){void 0!=ZPForm.Field.getFieldComponent(actionObj[j],ZPForm.CURRFORM_PARAM.formId)&&(ZPFRules.evaluateAction(rule.actionArray[i].operator,actionObj[j],rule.result),executeRulesFor.push(actionObj[j]))}if(i+1==rule.actionArray.length){var fcsArray=executeRulesFor.slice();for(ZPFRules.makeExecutefalse(fcsArray);executeRulesFor.length>0;)ZPFRules.evaluateRulesForField(executeRulesFor.pop(),!0);rule.isExecuted=!0}}},ZPFRules.getFieldType=function(fcid){return ZPFRules.LAYOUT.find("#zp_field_outer_"+fcid).attr("fieldtype")},ZPFRules.evaluateCondition=function(condition,fcid,field,isQuickAdd,fieldValue){var fcType=field.fieldType;void 0!=fieldValue&&(fcType=field.componentType);var operator=parseInt(condition.operator),inputObject=ZPFRules.LAYOUT;void 0!=inputObject&&(inputObject=ZPFRules.LAYOUT.find("#zp_field_outer_"+fcid));var value="";if(1!=isQuickAdd||void 0!=inputObject&&0!=inputObject.length)if(value=void 0!=fieldValue?fieldValue:ZPFRules.getInputValue(inputObject,fcType,fcid),fcType!=ZPForm.Field.DECIMAL&&fcType!=ZPForm.Field.CURRENCY||ZPFRules.checkEmptyValue(value,fcType)){var dispType=field.hasOwnProperty("displayType")?field.displayType:0;"Select"!=value&&"-Select-"!=value||!($.inArray(fcType,[ZPForm.Field.PICKLIST,ZPForm.Field.LOOKUP])>-1&&$.inArray(parseInt(dispType),[ZPForm.Field.SELECT_DISPLYTYPE,ZPForm.Field.MULTISELECT_DISPLYTYPE])>-1||$.inArray(fcType,[ZPForm.Field.COUNTRY,ZPForm.Field.BLOODGROUP,ZPForm.Field.GENDER,ZPForm.Field.NEW_COUNTRY,ZPForm.Field.NEW_BLOODGROUP,ZPForm.Field.NEW_GENDER])>-1)||(value="")}else{for(value=Number(value).toString();value.length>1&&0==value.indexOf("0");)value=value.substring(1);var decPointIndex=value.indexOf(".");if(decPointIndex>=0){for(var decStr=value.substring(decPointIndex+1,value.length);decStr.length>0&&"0"==decStr.substring(decStr.length-1,decStr.length);)decStr=decStr.substring(0,decStr.length-1);value=""==decStr.trim()?value.substring(0,decPointIndex):value.replace(value.substring(decPointIndex+1,value.length),decStr)}}else value=fcType==ZPForm.Field.CHECK_BOX?"false":"";var conditionResult=!1,conditionValue=condition.value;if(fcType!=ZPForm.Field.DECIMAL&&fcType!=ZPForm.Field.CURRENCY||ZPFRules.checkEmptyValue(conditionValue,fcType)||(conditionValue=Number(conditionValue).toString()),null!=value&&"null"!=value&&""!=value&&(fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST||fcType==ZPForm.Field.NEW_GENDER||fcType==ZPForm.Field.NEW_BLOODGROUP||fcType==ZPForm.Field.NEW_COUNTRY))if($.inArray(operator,[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1&&((void 0!=inputObject?0==$(inputObject).find("input,select").length||!$(inputObject).find("input,select").is(":visible"):fcType==ZPForm.Field.LOOKUP)||fcType==ZPForm.Field.PICKLIST||fcType==ZPForm.Field.NEW_GENDER||fcType==ZPForm.Field.NEW_BLOODGROUP||fcType==ZPForm.Field.NEW_COUNTRY))if(fcType==ZPForm.Field.LOOKUP)if(void 0!=fieldValue&&void 0!=field&&void 0!=field.componentValue_ID)value=field.componentValue_ID;else{var fieldData=ZPForm.Field.getFieldValueData(fcid);value=void 0!=fieldData?fieldData.componentValue_ID:ZPFRules.findOptions(value,fcid,ZPForm.CURRFORM_PARAM.formId,!0)}else void 0!=inputObject&&0!=$(inputObject).find("input,select").length&&$(inputObject).find("input,select").is(":visible")&&fcType!=ZPForm.Field.PICKLIST||(value=ZPFRules.findOptions(value,fcid,ZPForm.CURRFORM_PARAM.formId,!0));else $.inArray(operator,[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])<0&&void 0!=inputObject&&$(inputObject).find("input,select").length>0&&$(inputObject).find("input,select").is(":visible")&&fcType==ZPForm.Field.LOOKUP&&(value=ZPFRules.findOptions(value,fcid,ZPForm.CURRFORM_PARAM.formId).trim());switch(operator){case ZPNewView.OPERATORS.EQUAL:conditionResult=ZPFRules.checkEqual(value,conditionValue,fcType);break;case ZPNewView.OPERATORS.NOT_EQUAL:conditionResult=!ZPFRules.checkEqual(value,conditionValue,fcType);break;case ZPNewView.OPERATORS.EMPTY:conditionResult=ZPFRules.checkEmptyValue(value,fcType,$(inputObject).attr("displaytype"));break;case ZPNewView.OPERATORS.NOT_EMPTY:conditionResult=!ZPFRules.checkEmptyValue(value,fcType,$(inputObject).attr("displaytype"));break;default:if(operator==ZPNewView.OPERATORS.NOT_CONTAINS)conditionResult=!ZPFRules.checkIfContains(value,conditionValue,fcType);else if(null!=value&&"null"!=value)switch(operator){case ZPNewView.OPERATORS.CONTAINS:conditionResult=ZPFRules.checkIfContains(value,conditionValue,fcType);break;case ZPNewView.OPERATORS.STARTS_WITH:conditionResult=0==value.indexOf(conditionValue);break;case ZPNewView.OPERATORS.ENDS_WITH:var startWith=value.length-conditionValue.length;conditionResult=conditionValue==value.substring(startWith,value.length);break;case ZPNewView.OPERATORS.LESS_THAN:conditionResult=ZPFRules.checkLessThan(value,conditionValue);break;case ZPNewView.OPERATORS.GREATER_THAN:conditionResult=ZPFRules.checkGreaterThan(value,conditionValue);break;case ZPNewView.OPERATORS.LESS_EQUAL:conditionResult=ZPFRules.checkLessThan(value,conditionValue)||ZPFRules.checkEqual(value,conditionValue);break;case ZPNewView.OPERATORS.GREATER_EQUAL:conditionResult=ZPFRules.checkGreaterThan(value,conditionValue)||ZPFRules.checkEqual(value,conditionValue);break;case ZPNewView.OPERATORS.TRUE:conditionResult=1==value||"true"==value.trim()||value.trim()==ZPI18N.getString("zp.yes");break;case ZPNewView.OPERATORS.FALSE:conditionResult=0==value||"false"==value.toString().trim()||value.trim()==ZPI18N.getString("zp.no")}}return conditionResult},ZPFRules.getInputValue=function(inputObject,fcType,fcid){if($(inputObject).hasClass("DN")||$(inputObject).parent("div").hasClass("DN"))return"";var inputDiv=$(inputObject).find("[id*=zp_field_]:visible");if($(inputObject).parents("#zp_form_body").siblings("div").length>0&&(0==$(inputObject).find("#zp_fieldedit_comp").length||$(inputObject).find("#zp_fieldedit_comp").not(".DN").length>0)&&(inputDiv=$(inputObject).find("[id*=zp_field_]")),$(inputDiv).length>0){if($(inputObject).find("select").length>0)return $(inputObject).find("select option:selected").val();if($(inputObject).find("input").length>0)return fcType==ZPForm.Field.CHECK_BOX?$(inputObject).find("input").is(":checked")+"":$(inputObject).find("input").length>1?$(inputObject).find("input[name]").val():$(inputObject).find("input").val();if($(inputObject).find("textarea").length>0)return $(inputObject).find("textarea").val()}else{if(void 0==$(inputObject).attr("displaytype")||$(inputObject).attr("displaytype")!=ZPForm.Field.RADIO_DISPLYTYPE){if(ZPForm.ISBLUEPRINT&&fcid)return ZPForm.getSingleRecordFieldValue(fcid);if($(inputObject).find("span:visible").length>0||1===ZPForm.getPaginationType()&&$(inputObject).find("span").length>0){val=$(inputObject).find("span:visible").text();if(0==$(inputObject).find("span:visible").length&&(val=$(inputObject).find("span").text()),"-"==val.trim()){if(ZPForm.isViewMode())if("-"==ZPForm.getSingleRecordFieldValue(fcid).trim())return val;val=""}else!ZPForm.isViewMode()||fcType!=ZPForm.Field.DECIMAL&&fcType!=ZPForm.Field.CURRENCY||(val=ZPForm.getSingleRecordFieldValue(fcid));return val}return $(inputObject).text()}return $(inputObject).find("input[type=radio]:visible").length>0?$(inputObject).find("input[type=radio]:checked").val():("-"==(val=$(inputObject).find("span:first").text()).trim()&&(val=""),val);var val}},ZPFRules.checkEmptyValue=function(value,fcType,dispType){return $.inArray(fcType,[ZPForm.Field.PICKLIST,ZPForm.Field.LOOKUP,ZPForm.Field.NEW_GENDER,ZPForm.Field.NEW_BLOODGROUP,ZPForm.Field.NEW_COUNTRY])>-1&&$.inArray(parseInt(dispType),[ZPForm.Field.SELECT_DISPLYTYPE,ZPForm.Field.MULTISELECT_DISPLYTYPE])>-1||$.inArray(fcType,[ZPForm.Field.COUNTRY,ZPForm.Field.BLOODGROUP,ZPForm.Field.GENDER,ZPForm.Field.NEW_COUNTRY,ZPForm.Field.NEW_BLOODGROUP,ZPForm.Field.NEW_GENDER])>-1?"Select"==value||""==value||"-Select-"==value:null==value||""==value||"null"==value},ZPFRules.checkEqual=function(value1,value2,fcType){if(fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST||fcType==ZPForm.Field.NEW_GENDER||fcType==ZPForm.Field.NEW_BLOODGROUP||fcType==ZPForm.Field.NEW_COUNTRY)return value2.split(",").indexOf(value1+"")>-1;if(fcType==ZPForm.Field.URL){if(value1.indexOf("://")>-1&&value2.indexOf("://")<0)return value1.split("://")[1].trim()==value2.trim();if(value2.indexOf("://")>-1&&value1.indexOf("://")<0)return value2.split("://")[1].trim()==value1.trim()}return value1==value2},ZPFRules.checkLessThan=function(value1,value2){return Number(value1)<Number(value2)},ZPFRules.checkGreaterThan=function(value1,value2){return Number(value1)>Number(value2)},ZPFRules.checkOptionsEmpty=function(value1,value2){return"-Select-"==value},ZPFRules.checkIfContains=function(value1,value2,fcType){return value1.indexOf(value2)>-1},ZPFRules.evaluateAction=function(operator,field,result){var actionFieldObject=ZPFRules.LAYOUT.find("#zp_field_outer_"+field),relatedFieldsObject=ZPFRules.LAYOUT.find("[id*=zp_form_relfield_"+field+"]"),parentSectionDiv=null,hideSection=null,isFieldShow=null,secDtls=ZPFRules.findSec(field);if(operator==ZPFRules.OPERATOR.SHOW&&result||operator==ZPFRules.OPERATOR.HIDE&&!result?(isFieldShow=!0,actionFieldObject.length>0&&($(relatedFieldsObject).removeClass("DN"),$(relatedFieldsObject).attr("isActionHidden",!1))):actionFieldObject.length>0&&($(relatedFieldsObject).addClass("DN"),$(relatedFieldsObject).attr("isActionHidden",!0)),$(actionFieldObject).parent("div").length>0||!secDtls.isTabular){if(parentSectionDiv=$(actionFieldObject).parents("[id^=zp_section_fields_]"),1==isFieldShow)if(void 0==$(actionFieldObject).attr("fieldtype")?$(actionFieldObject).removeClass("DN"):($(actionFieldObject).parent("div").removeClass("DN"),secDtls.isTabular&&ZPFRules.LAYOUT.find("[id=zp_field_outer_"+field+"]").each(function(){$(this).parent("div").removeClass("DN"),$(this).attr("isActionHidden",!1)})),$(actionFieldObject).attr("isActionHidden",!1),$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").not(".DN").length>0)1==$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").not(".DN").length&&(hideSection=!1);else{var notPlainTextFieldsLength=$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").length;$(parentSectionDiv).find("[id*=zp_field_outer_]").not(".DN").length>notPlainTextFieldsLength&&(hideSection=!1)}else if(void 0==$(actionFieldObject).attr("fieldtype")?$(actionFieldObject).addClass("DN"):($(actionFieldObject).parent("div").addClass("DN"),secDtls.isTabular&&ZPFRules.LAYOUT.find("[id=zp_field_outer_"+field+"]").each(function(){$(this).parent("div").addClass("DN"),$(this).attr("isActionHidden",!0)})),$(actionFieldObject).attr("isActionHidden",!0),ZPFRules.setEmptyFcs.push(field),0==$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").not(".DN").length){notPlainTextFieldsLength=$(parentSectionDiv).find("[id*=zp_field_outer_]").parents("[isallowed]").length;$(parentSectionDiv).find("[id*=zp_field_outer_]").not(".DN").length==notPlainTextFieldsLength&&(hideSection=!0)}}else if(secDtls.isTabular){var sectionDiv=ZPFRules.LAYOUT.find("#zp_section_fields_"+secDtls.sectionId),resultObj=ZPFRules.findObject(secDtls.column1,"formComponentId",field,"index",!0);0!=resultObj.length&&resultObj.hasOwnProperty("index")||(resultObj=ZPFRules.findObject(secDtls.column2,"formComponentId",field,"index",!0)),parentSectionDiv=sectionDiv;var index=resultObj.index+1,indexChange=!1,headerObject=$(sectionDiv).find("thead th:nth-child("+index+")"),formComp=ZPForm.Field.getFieldComponent(field);if(1==isFieldShow){sectionDiv.find("tbody tr").each(function(){if(formComp.fieldType==ZPForm.Field.ADDRESS){if(formComp.fieldType==ZPForm.Field.ADDRESS)for(var childIndex=0;childIndex<ZPForm.AddressField.COLUMNAMEARRAY.length;childIndex++){var currColumnName=ZPForm.AddressField.COLUMNAMEARRAY[childIndex];$(this).find("td[folabel="+currColumnName+"_"+formComp.labelName+"]").removeClass("DN"),$(this).find("td[folabel="+currColumnName+"_"+formComp.labelName+"]").attr("isActionHidden",!1)}}else{let $element=$(this).find("td[folabel="+formComp.labelName+"]");$element.length>0?(index=$element.index(),indexChange=!0,$element.removeClass("DN"),$element.attr("isActionHidden",!1)):"zp_forms_summationrow"==$(this).attr("id")&&$(this).find("td:nth-child("+(index+1)+")").removeClass("DN")}}),indexChange&&(index+=1,headerObject=$(sectionDiv).find("thead th:nth-child("+index+")"));var tdLen=ZPForm.isViewMode()?1:2;if(formComp.fieldType==ZPForm.Field.ADDRESS)for(var childObject=formComp.childFcObj,childIndex=0;childIndex<ZPForm.AddressField.COLUMNAMEARRAY.length;childIndex++){var currChildDisplayName=childObject[ZPForm.AddressField.COLUMNAMEARRAY[childIndex]].displayName+"("+formComp.displayName+")";$(sectionDiv).find("th:contains("+currChildDisplayName+")").removeClass("DN")}else $(headerObject).removeClass("DN");sectionDiv.find("tr th").not(".DN").length==tdLen&&(hideSection=!1),$(actionFieldObject).attr("isActionHidden",!1)}else{if(0==sectionDiv.find('tbody tr td:contains("No rows found.")').length){formComp=ZPForm.Field.getFieldComponent(field);sectionDiv.find("tbody tr").each(function(){if(formComp.fieldType==ZPForm.Field.ADDRESS)for(var childIndex=0;childIndex<ZPForm.AddressField.COLUMNAMEARRAY.length;childIndex++){var currColumnName=ZPForm.AddressField.COLUMNAMEARRAY[childIndex];$(this).find("td[folabel="+currColumnName+"_"+formComp.labelName+"]").addClass("DN"),$(this).find("td[folabel="+currColumnName+"_"+formComp.labelName+"]").attr("isActionHidden",!0)}else{let $element=$(this).find("td[folabel="+formComp.labelName+"]");$element.length>0?(index=$element.index(),indexChange=!0,$element.addClass("DN"),$element.attr("isActionHidden",!0)):"zp_forms_summationrow"==$(this).attr("id")&&$(this).find("td:nth-child("+(index+1)+")").addClass("DN")}})}indexChange&&(index+=1,headerObject=$(sectionDiv).find("thead th:nth-child("+index+")"));tdLen=ZPForm.isViewMode()?0:1;if(formComp.fieldType==ZPForm.Field.ADDRESS)for(childObject=formComp.childFcObj,childIndex=0;childIndex<ZPForm.AddressField.COLUMNAMEARRAY.length;childIndex++){currChildDisplayName=childObject[ZPForm.AddressField.COLUMNAMEARRAY[childIndex]].displayName+"("+formComp.displayName+")";$(sectionDiv).find("th:contains("+currChildDisplayName+")").addClass("DN")}else $(headerObject).addClass("DN");sectionDiv.find("th").not(".DN").length==tdLen&&(hideSection=!0),ZPFRules.setEmptyFcs.push(field),$(actionFieldObject).attr("isActionHidden",!0)}}if($(parentSectionDiv).length>0){var secId=$(parentSectionDiv).attr("id").split("_").pop();$(parentSectionDiv).is(":visible")||0!=hideSection?1==hideSection&&($(parentSectionDiv).is(":visible")||$(parentSectionDiv).parents("#zp_form_body").siblings().find("li[secid="+secId+"]").is(":visible")||ZPForm.PRINT)&&(1==ZPForm.getPaginationType()&&($(parentSectionDiv).parents("#zp_form_body").siblings().find("li[secid="+secId+"]").hide(),$(parentSectionDiv).parents("#zp_form_body").siblings().find('li[id^="zp_form_section_"]:visible:first').trigger("click")),$(parentSectionDiv).addClass("DN"),ZPForm.PRINT||ZPeople.isZPNewUI()||ZPForm.isEmbedForm||ZPPreboarding.isPreBoarding?ZPForm.PRINT?$(parentSectionDiv).parent().parent().prev("h3").addClass("DN"):$(parentSectionDiv).prev("h3").addClass("DN"):$(parentSectionDiv).prev("h6").addClass("DN")):1==ZPForm.getPaginationType()?($(parentSectionDiv).parents("#zp_form_body").siblings().find("li[secid="+secId+"]").show(),$(parentSectionDiv).parents("#zp_form_body").siblings().find('li[id^="zp_form_section_"].sel').trigger("click")):($(parentSectionDiv).removeClass("DN"),ZPForm.PRINT||ZPeople.isZPNewUI()||ZPForm.isEmbedForm||ZPPreboarding.isPreBoarding?ZPForm.PRINT?$(parentSectionDiv).parent().parent().prev("h3").removeClass("DN"):$(parentSectionDiv).prev("h3").removeClass("DN"):$(parentSectionDiv).prev("h6").removeClass("DN"))}else{secId=ZPFRules.findSecId(ZPForm.CURRFORM_PARAM.formId,field);var secObj=$(actionFieldObject).prevAll("#"+secId);0==secObj.length&&(secObj=$(actionFieldObject).parents("[isallowed]").prevAll("#"+secId)),1==isFieldShow?1==secObj.nextAll("[isallowed]").not(".DN").length&&secObj.removeClass("DN"):0==secObj.nextAll("[isallowed]").not(".DN").length&&secObj.addClass("DN")}},ZPFRules.evaluateRulesForField=function(obj,isFcid){var fcid=obj;if(isFcid||(void 0==obj?obj=ZPFRules.LAYOUT.find("[id^=zp_field_outer_]:active"):obj instanceof Date?obj=$(Calendar.currentObj).parents("[id*=zp_field_outer_]"):$(obj).is(":radio")&&(obj=$(obj).parents("[displaytype]")),fcid=$(obj).attr("id").split("_").pop(),ZPFRules.makeExecutefalse([fcid])),isFcid||$(obj).find("#zp_formedit_cancel").on("click",function(event){ZPFRules.evaluateRulesForField($(this).parents("[id*=zp_field_outer_]"))}),void 0!=ZPForm.CURRFORM_PARAM.formId&&void 0!=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId]){var isRulePresent=!1;if(ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent.hasOwnProperty(fcid)?isRulePresent=!0:void 0!=(fcid=$(isFcid).attr("id"))&&(fcid=fcid.substring(9),ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent.hasOwnProperty(fcid)&&(isRulePresent=!0)),isRulePresent){var rulesArray=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[fcid];rulesArray.length>0&&$.each(rulesArray,function(i,rule){ZPFRules.evaluateSingleRule(rule)})}}},ZPFRules.evaluateDateConditions=function(condition,fcid,field,isQuickAdd){var fcType=field.fieldType,conditionDate=condition.value,inputObject=ZPFRules.LAYOUT.find("#zp_field_outer_"+fcid),value="";1==isQuickAdd&&void 0==inputObject||(value=ZPFRules.getInputValue(inputObject,fcType,fcid)),fcType==ZPForm.Field.DATE?(conditionDate=Calendar.parseDate(conditionDate,uidateFormat),ZPFRules.checkEmptyValue(value)||(value=Calendar.parseDate(value,uidateFormat))):(conditionDate=Calendar.parseDate(conditionDate,uidateFormat,!0,!0),ZPFRules.checkEmptyValue(value)||(value=Calendar.convertHourFormat(value),value=Calendar.parseDate(value,uidateFormat,!0,!0)));var conditionResult=!1;switch(condition.operator){case ZPNewView.OPERATORS.EQUAL:ZPFRules.checkEmptyValue(value)||(conditionResult=Calendar.equalsTo(value,conditionDate));break;case ZPNewView.OPERATORS.NOT_EQUAL:ZPFRules.checkEmptyValue(value)||(conditionResult=!Calendar.equalsTo(value,conditionDate));break;case ZPNewView.OPERATORS.EMPTY:conditionResult=ZPFRules.checkEmptyValue(value);break;case ZPNewView.OPERATORS.NOT_EMPTY:conditionResult=!ZPFRules.checkEmptyValue(value);break;case ZPNewView.OPERATORS.LESS_THAN:ZPFRules.checkEmptyValue(value)||(conditionResult=ZPFRules.checkDateLessThan(value,conditionDate));break;case ZPNewView.OPERATORS.GREATER_THAN:ZPFRules.checkEmptyValue(value)||(conditionResult=ZPFRules.checkDateGreaterThan(value,conditionDate));break;case ZPNewView.OPERATORS.LESS_EQUAL:ZPFRules.checkEmptyValue(value)||(conditionResult=Calendar.equalsTo(value,conditionDate)||ZPFRules.checkDateLessThan(value,conditionDate));break;case ZPNewView.OPERATORS.GREATER_EQUAL:ZPFRules.checkEmptyValue(value)||(conditionResult=Calendar.equalsTo(value,conditionDate)||ZPFRules.checkDateGreaterThan(value,conditionDate))}return conditionResult},ZPFRules.checkDateLessThan=function(date1,date2,isTime){if(date1.getFullYear()<date2.getFullYear())return!0;if(date1.getFullYear()===date2.getFullYear()){if(date1.getMonth()<date2.getMonth())return!0;if(date1.getMonth()===date2.getMonth()){if(date1.getDate()<date2.getDate())return!0;if(date1.getDate()===date2.getDate()){if(date1.getHours()<date2.getHours())return!0;if(date1.getHours()===date2.getHours()&&date1.getMinutes()<date2.getMinutes())return!0}}}return!1},ZPFRules.checkDateGreaterThan=function(date1,date2,isTime){if(date1.getFullYear()>date2.getFullYear())return!0;if(date1.getFullYear()===date2.getFullYear()){if(date1.getMonth()>date2.getMonth())return!0;if(date1.getMonth()===date2.getMonth()){if(date1.getDate()>date2.getDate())return!0;if(date1.getDate()===date2.getDate()){if(date1.getHours()>date2.getHours())return!0;if(date1.getHours()===date2.getHours()&&date1.getMinutes()>date2.getMinutes())return!0}}}return!1},ZPFRules.findOptions=function(value,formComponentID,formId,isId){var formFields=ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails;ZPForm.ISBLUEPRINT&&ZPForm.Blueprint.BLUEPRINT_COMPONENTS[ZPForm.CURRFORM_PARAM.formId].message.formComponentDetails;var fieldOption=null;return $.each(formFields,function(){if(null==(fieldOption=ZPFRules.findOptionValue(this.column1,formComponentID,value,isId,formId))&&(fieldOption=ZPFRules.findOptionValue(this.column2,formComponentID,value,isId,formId)),null!=fieldOption)return!1}),fieldOption},ZPFRules.getAllOptions=function(field){if(field.fieldType===ZPForm.Field.NEW_GENDER||field.fieldType===ZPForm.Field.NEW_BLOODGROUP){if(void 0==field.OptionsWithId){let optionsVal=field.Options,oids=field.oIds,options=[];for(var i=0;i<optionsVal.length;i++){let optObj={Value:optionsVal[i],Id:oids[i]};options.push(optObj)}field.OptionsWithId=options}return field.OptionsWithId}return field.fieldType===ZPForm.Field.LOOKUP&&ZPeople.isZPNewUI()&&Layout.Page.container.find("#rule:visible,#validationrule:visible").length>0?(field.AllOptions||$.ajax({type:"POST",async:!1,url:"/createViewAction.zp",data:{mode:"getLookupList",conreqcsr:csrfToken,selectedLookupType:field.formComponentId,fcType:field.fieldType,isFromRule:!0},success:function(data){field.AllOptions=data.lookupDetailsList}}),field.AllOptions):field.isPrimaryLookup?field.hasOwnProperty("AddOptions")?field.AddOptions:field.EditOptions:field.hasOwnProperty("OptionsWithId")?field.OptionsWithId:field.Options},ZPFRules.findOptionValue=function(col,fcID,value,isId,formId){var optionVal=null;return $.each(col,function(){if(void 0!=this&&this.formComponentId==fcID&&(options=ZPFRules.getAllOptions(this),0==Object.keys(options).length&&"P_ApplyLeave"==ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formName&&"Leavetype"==this.labelName&&(options=ZPFRules.leaveTypes),null!=(optionVal=ZPFRules.findSelectedOptionValue(isId,value,options,fcID))))return!1}),optionVal},ZPFRules.findSelectedOptionValue=function(isId,value,options,fcid){var optionVal=null;return void 0!=(optionVal=ZPForm.select2.ALL_OPTIONS[fcid+"_"+value])&&""!=optionVal.trim()||$.each(options,function(){var valVariable=void 0!=this.name?"name":void 0!=this.DISPVALUE?"DISPVALUE":"Value";if((isId?ZPeople.decodeTxt(this[valVariable]).trim():void 0!=this.code?this.code:this.Id)==value.trim())return optionVal=isId?void 0!=this.code?this.code:this.Id:this[valVariable],!1}),optionVal},ZPFRules.addRule=function(formId){var formCompData=ZPForm.FORM_COMPONENT_DATA[formId];if(void 0==formCompData||ZPForm.isRoleBasedPreview||formCompData.lastprev||void 0==formCompData.refresh)ZPFRules.getFormComponents({},{},{forPost:!0,formId:formId}),ZPForm.isRoleBasedPreview=!1;else{var fc=formCompData.message.formComponentDetails;if(1==fc.length&&0==fc[0].column1.length&&0==fc[0].column2.length){var ruleDiv=ZPeople.createModalPopup("rule",ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName]),"popRgtModel PopMdModel modal-right"),emptyFormDiv='<div class="col-lg-12 text-center"><div id="zp_views_norecclass" class="PArds"></div><h2 id="zp_nodata" class="ZPNdt">'+ZPI18N.getString("zp.emptyform")+"</h2></div>";$(ruleDiv).find("#bodyTag").html(emptyFormDiv)}else void 0!=ZPForm.FIELD_RULE_DETAILS[formId]&&(ZPFRules.formActionUsedFields[formId]=[],ZPFRules.rulesConstruction(formId))}},ZPFRules.auditEnableCheck=function(){var fieldProperties=Layout.Page.container.find("#fieldProperties"),fcid=$(fieldProperties).attr("currentfcid");ZPFRules.formActionUsedFields[formCustom.formid].indexOf(fcid)>-1&&$(fieldProperties).find("input[name=auditfield]").prop("checked",!0)},ZPFRules.rulesConstruction=function(formId){var ruleDiv=ZPeople.createModalPopup("rule",ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName]),"popRgtModel PopMdModel modal-right");$(ruleDiv).find("[buttonname=done]").html(ZPI18N.getString("zp.save")),$(ruleDiv).find("[buttonname=done]").siblings("[buttonaction]").html(ZPI18N.getString("zp.close")),$(ruleDiv).find("[buttonname=done]").off(),$(ruleDiv).find("[buttonname=done]").on("click",function(){ZPFRules.ruleCreation(this)}),$(ruleDiv).find("[buttonname=done]").siblings("[buttonaction]").off(),$(ruleDiv).find("[buttonname=done]").siblings("[buttonaction]").on("click",function(){$(this).parents().find("#rule").removeClass("in"),ZPFRules.auditEnableCheck()}),$(ruleDiv).find(".modal-header").find("a[data-dismiss=modal]").off(),$(ruleDiv).find(".modal-header").find("a[data-dismiss=modal]").on("click",function(){$(this).parents().find("#rule").removeClass("in"),ZPFRules.auditEnableCheck()}),0==$(ruleDiv).find("#addRule").length&&$('<a class="btn btn-default btnaddrule" id="addRule" onclick="ZPFRules.addNewRule(this)">'+ZPI18N.getString("zp.addrule")+"</a>").insertAfter($(ruleDiv).find("[buttonaction]").first()),$(ruleDiv).find("#bodyTag").attr("formId",formId);var ruleHtml="";if(ZPFRules.count=1,ValidationRule.validationType=void 0,ZPForm.FIELD_RULE_DETAILS[formId].length>0?$.each(ZPForm.FIELD_RULE_DETAILS[formId],function(index,rule){ZPFRules.count=parseInt(index)+1,ruleHtml+=ZPFRules.singleRuleAdd(formId,rule)}):ruleHtml=ZPFRules.singleRuleAdd(formId,{}),""==ruleHtml){var emptyFormDiv='<div class="col-lg-12 text-center"><div id="zp_views_norecclass" class="PArds"></div><h2 id="zp_nodata" class="ZPNdt">'+ZPI18N.getString("zp.emptyform")+"</h2></div>";$(ruleDiv).find("h4").replaceWith('<h6 class="modal-title S16">'+ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName])+"</h6>"),$(ruleDiv).find("#bodyTag").html(emptyFormDiv)}else{var ruleGrp=ZPFRules.ruleGroupTemplate;ruleGrp=ruleGrp.replace(/\$RULECONSTRUCT\$/g,ruleHtml),$(ruleDiv).find("#bodyTag").html(ruleGrp),$(ruleDiv).find("[makeEmpty=true]").val(""),$(ruleDiv).find("#dvRule1").addClass("fade in"),$(ruleDiv).find("h4").replaceWith('<h6 class="modal-title S16">'+ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName])+"</h6>"),$(ruleDiv).find("select").select2()}},ZPFRules.singleRuleAdd=function(formId,rule){var mainDiv=ZPFRules.ruleHeaderTemplate;mainDiv=mainDiv.replace(/\$COUNT\$/g,ZPFRules.count);var ruleId=void 0!=rule&&rule.hasOwnProperty("ruleId")?"ruleid="+rule.ruleId:"";mainDiv=mainDiv.replace(/\$RULEID\$/g,ruleId);var ruleDiv='<div class="clearfix">';ruleDiv=(ruleDiv+=ZPFRules.ruleIfDivTemplate).replace(/\$RULEID\$/g,ruleId),ruleDiv=rule.operator==ZPFRules.OPERATOR.ANY?(ruleDiv=ruleDiv.replace(/\$SELECTED1\$/g,"selected")).replace(/\$SELECTED0\$/g,""):(ruleDiv=ruleDiv.replace(/\$SELECTED0\$/g,"selected")).replace(/\$SELECTED1\$/g,"");var fields=ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails,others={fields:fields};others.uniqueFields=ZPForm.FORM_COMPONENT_DATA[formId].message.UniqueFieldDetails;var fcId=ZPFRules.findFirstFcId(fields,formId,ZPForm.FORM_COMPONENT_DATA[formId].formDetails.tableName),conditionArray=rule.hasOwnProperty("conditionArray")?rule.conditionArray:[{fcid:fcId}];if($.each(conditionArray,function(index,condition){others.fieldDtl=ZPForm.Field.getFieldComponent(condition.fcid,formId),void 0==others.fieldDtl&&(others.fieldDtl={}),others.fieldArray=[condition.fcid],others.id=[condition.conditionId],others.formId=formId;var tempDiv;if(""==(tempDiv=ZPFRules.createRuleConditionFromTemplate("col-md-3 ML15","conditionFields",others)))return ruleDiv="",!1;ruleDiv+=tempDiv,others.condition=condition.operator,ruleDiv+=ZPFRules.createRuleConditionFromTemplate("col-md-3","condition",others),others.fieldValue=condition.value,ruleDiv+=ZPFRules.createRuleConditionFromTemplate("col-md-4","fieldValue",others),ruleDiv+=ZPFRules.addRemoveTemplate}),""==ruleDiv)return ruleDiv;ruleDiv+='<div class="clearfix col-md-12"><label class="control-label PL10 PT15 MB10">'+ZPI18N.getString("zp.performactions")+"</label></div>";var actionArray=rule.hasOwnProperty("actionArray")?rule.actionArray:[],showArray=[],hideArray=[];$.each(actionArray,function(index,action){action.operator==ZPFRules.OPERATOR.SHOW?showArray=action.fieldArray:hideArray=action.fieldArray}),others.multiple=!0,delete others.id;var actionArr=[{fieldArray:showArray,value:ZPI18N.getString("zp.show"),saveValue:"0"},{fieldArray:hideArray,value:ZPI18N.getString("zp.hide"),saveValue:"1"}];for(a in actionArr)others.fieldArray=actionArr[a].fieldArray,others.value=actionArr[a].value,others.saveValue=actionArr[a].saveValue,ruleDiv+=ZPFRules.createRuleConditionFromTemplate("col-md-3 ML15","action",others),ruleDiv+=ZPFRules.createRuleConditionFromTemplate("col-md-7","actionFields",others);return ruleDiv+='<div class="dverrormsg DN form-group col-md-7 ML15" errorid="errorDiv"></div>',ruleDiv+="</div>",mainDiv=mainDiv.replace(/\$RULEDIV\$/g,ruleDiv)},ZPFRules.createRuleConditionFromTemplate=function(classname,divtype,others,keyVal,isBlueprint){var ruleDiv=ZPFRules.ruleConditionTemplate;ruleDiv=(ruleDiv=(ruleDiv=ruleDiv.replace(/\$CLASS\$/g,classname)).replace(/\$ID\$/g,divtype+(others.hasOwnProperty("id")?others.id:""))).replace(/\$NUM\$/g,ZPFRules.count),ruleDiv=void 0!=keyVal?ruleDiv.replace(/\$KEY\$/g,keyVal):ruleDiv.replace(/\$KEY\$/g,divtype);var selDiv="";if(divtype.indexOf("Fields")>0){if(ruleDiv=ruleDiv.replace(/\$NAME\$/g,"conditionFields"==divtype?"conditionDiv":"actionDiv"),""==(selDiv=ZPFRules.addFieldsForSelect(others.fields,"conditionFields"==divtype,others,"actionFields"==divtype,isBlueprint)))return"";"actionFields"==divtype&&(selDiv+=ZPFRules.errorTemplate)}else"condition"==divtype?(ruleDiv=ruleDiv.replace(/\$NAME\$/g,"conditionDiv"),selDiv=ZPFRules.addConditionsForField(others.fieldDtl.fieldType,others.condition)):"fieldValue"==divtype?(ruleDiv=ruleDiv.replace(/\$NAME\$/g,"conditionDiv"),selDiv=ZPFRules.changeFieldForValue(others.condition,others.fieldDtl,void 0!=others.fieldValue?others.fieldValue:"",others.formId)):"action"==divtype&&(ruleDiv=ruleDiv.replace(/\$NAME\$/g,"actionDiv"),selDiv='<label saveValue="'+others.saveValue+'" class="form-control spnshwgry">'+others.value+"</label>");return ruleDiv=ruleDiv.replace(/\$CONDITION\$/g,selDiv)},ZPFRules.addFieldsForSelect=function(fields,isRestrict,others,isUniqFielsRes,isBlueprint){var selectDiv=ZPFRules.selectTemplate;selectDiv=(selectDiv=(selectDiv=selectDiv.replace(/\$METHOD\$/g,others.hasOwnProperty("multiple")?"ZPFRules.updateActionArray(event, this)":"ZPFRules.changeConditions(this)")).replace(/\$KEYNAME\$/g,"fcid")).replace(/\$MULTIPLE\$/g,others.hasOwnProperty("multiple")?"multiple":"");var disabled=ValidationRule.validationType==ValidationRule.validationTypes.BLUEPRINT?"disabled":"";selectDiv=(selectDiv=selectDiv.replace(/\$KEYNAME\$/g,"fcid")).replace(/\$DISABLED\$/g,disabled);var options="";if(0==$("#validationrule").length){var actionArray=ZPFRules.formActionUsedFields[others.formId];void 0!=actionArray&&0!=actionArray.length||(actionArray=ZPFRules.getAllActions(ZPForm.FIELD_RULE_DETAILS[others.formId]),ZPFRules.formActionUsedFields[others.formId]=actionArray)}var formTableName=ZPForm.FORM_COMPONENT_DATA[others.formId].formDetails.tableName,noOptions=!0;return $.each(fields,function(index1,section){options+="<optgroup label="+section.sectionName+" secid="+section.sectionId+">",$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){if(void 0!=field&&(!isUniqFielsRes||!ZPUtil.checkIsExistInArray(others.uniqueFields,field.labelName))&&(!isRestrict||!section.isTabular)&&ZPFRules.isFieldAllowed(isRestrict,field,others.fieldArray,formTableName,actionArray,isBlueprint)){noOptions=!1;var selected=$.inArray(field.formComponentId,others.fieldArray)>-1?"selected":"";options+='<option value="'+field.formComponentId+'" '+selected+">"+field.displayName+"</option>"}})}),options+="</optgroup>"}),noOptions&&(isRestrict||!isRestrict&&0==actionArray.length)?"":selectDiv=selectDiv.replace(/\$OPTIONS\$/g,options)},ZPFRules.addConditionsForField=function(fctype,id){var selectDiv=ZPFRules.selectTemplate;selectDiv=(selectDiv=selectDiv.replace(/\$METHOD\$/g,"ZPFRules.changeInput(this)")).replace(/\$KEYNAME\$/g,"operator");var selected=id==ZPNewView.OPERATORS.EQUAL?"selected":"",options='<option value="'+ZPNewView.OPERATORS.EQUAL+'" '+selected+">"+ZPI18N.getString("zp.is")+"</option>";return selected=id==ZPNewView.OPERATORS.NOT_EQUAL?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.NOT_EQUAL+'" '+selected+">"+ZPI18N.getString("zp.isnot")+"</option>",selected=id==ZPNewView.OPERATORS.EMPTY?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.EMPTY+'" '+selected+">"+ZPI18N.getString("zp.isempty")+"</option>",selected=id==ZPNewView.OPERATORS.NOT_EMPTY?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.NOT_EMPTY+'" '+selected+">"+ZPI18N.getString("zp.isnotempty")+"</option>",$.inArray(parseInt(fctype),[ZPForm.Field.DATE,ZPForm.Field.DATE_TIME,ZPForm.Field.NUMBER,ZPForm.Field.CURRENCY,ZPForm.Field.DECIMAL])>-1&&(selected=id==ZPNewView.OPERATORS.GREATER_THAN?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.GREATER_THAN+'" '+selected+">"+ZPI18N.getString("zp.greaterthan")+"</option>",selected=id==ZPNewView.OPERATORS.LESS_THAN?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.LESS_THAN+'" '+selected+">"+ZPI18N.getString("zp.lesserthan")+"</option>",selected=id==ZPNewView.OPERATORS.GREATER_EQUAL?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.GREATER_EQUAL+'" '+selected+">"+ZPI18N.getString("zp.greaterorequalto")+"</option>",selected=id==ZPNewView.OPERATORS.LESS_EQUAL?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.LESS_EQUAL+'" '+selected+">"+ZPI18N.getString("zp.lesserorequalto")+"</option>"),$.inArray(parseInt(fctype),[ZPForm.Field.DATE,ZPForm.Field.DATE_TIME,ZPForm.Field.CHECK_BOX,ZPForm.Field.FILE_UPLOAD,ZPForm.Field.BLOODGROUP,ZPForm.Field.GENDER,ZPForm.Field.COUNTRY,ZPForm.Field.NEW_BLOODGROUP,ZPForm.Field.NEW_GENDER,ZPForm.Field.NEW_COUNTRY])<0?(selected=id==ZPNewView.OPERATORS.CONTAINS?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.CONTAINS+'" '+selected+">"+ZPI18N.getString("zp.contains")+"</option>",selected=id==ZPNewView.OPERATORS.NOT_CONTAINS?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.NOT_CONTAINS+'" '+selected+">"+ZPI18N.getString("zp.notcontains")+"</option>",selected=id==ZPNewView.OPERATORS.STARTS_WITH?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.STARTS_WITH+'" '+selected+">"+ZPI18N.getString("zp.startswith")+"</option>",selected=id==ZPNewView.OPERATORS.ENDS_WITH?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.ENDS_WITH+'" '+selected+">"+ZPI18N.getString("zp.endswith")+"</option>"):fctype==ZPForm.Field.CHECK_BOX?(selected=id==ZPNewView.OPERATORS.TRUE?"selected":"",options='<option value="'+ZPNewView.OPERATORS.TRUE+'" '+selected+">"+ZPI18N.getString("zp.yes")+"</option>",selected=id==ZPNewView.OPERATORS.FALSE?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.FALSE+'" '+selected+">"+ZPI18N.getString("zp.no")+"</option>"):fctype==ZPForm.Field.FILE_UPLOAD&&(selected=id==ZPNewView.OPERATORS.EMPTY?"selected":"",options='<option value="'+ZPNewView.OPERATORS.EMPTY+'" '+selected+">"+ZPI18N.getString("zp.isempty")+"</option>",selected=id==ZPNewView.OPERATORS.NOT_EMPTY?"selected":"",options+='<option value="'+ZPNewView.OPERATORS.NOT_EMPTY+'" '+selected+">"+ZPI18N.getString("zp.isnotempty")+"</option>"),selectDiv=selectDiv.replace(/\$OPTIONS\$/g,options)},ZPFRules.changeFieldForValue=function(condition,fieldDtl,value,formId){var selDiv="",disabledClass="",fcType=parseInt(fieldDtl.fieldType),emptyAttr="";if($.inArray(parseInt(condition),[ZPNewView.OPERATORS.EMPTY,ZPNewView.OPERATORS.NOT_EMPTY])>-1&&(value="",disabledClass="disabled",emptyAttr=" makeEmpty=true"),$.inArray(fcType,[ZPForm.Field.LOOKUP,ZPForm.Field.PICKLIST,ZPForm.Field.NEW_GENDER,ZPForm.Field.NEW_BLOODGROUP,ZPForm.Field.NEW_COUNTRY])>-1){selDiv='<span class="input-group-addon dvSetpopup $DN$" id="optionsIcon" onclick="ZPFRules.openOptionsPopup(this)" data-placement="bottom" data-toggle="popover" aria-expanded="false"><i class="IC-addlist S15"></i></span>',selDiv+=ZPFRules.optionsTemplate;var options=ZPFRules.getAllOptions(fieldDtl);0==Object.keys(options).length&&"P_ApplyLeave"==ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formName&&"Leavetype"==fieldDtl.labelName&&(options=ZPFRules.leaveTypes);var valArr=value.split(",");if(selDiv=selDiv.replace(/\$LIST\$/g,ZPFRules.constructOptions(options,valArr)),void 0==condition&&(condition=ZPNewView.OPERATORS.EQUAL),$.inArray(parseInt(condition),[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL,ZPNewView.OPERATORS.IN,ZPNewView.OPERATORS.NOT_IN])>-1){if(selDiv=selDiv.replace(/\$DN\$/g,""),disabledClass="disabled",""!=value.trim())for(val in value="",valArr){var v=ZPFRules.findSelectedOptionValue(!1,valArr[val],options,fieldDtl.formComponentId);null!=v&&(""!=value.trim()&&(value+=","),value+=v)}}else selDiv=selDiv.replace(/\$DN\$/g,"DN")}else fcType==ZPForm.Field.CHECK_BOX&&(disabledClass="disabled");var dateHtml="";fcType==ZPForm.Field.DATE&&(ZPFRules.checkEmptyValue(value)||(value=Calendar.parseDate(value,uidateFormat),value=Calendar.formatDate(value)),dateHtml='onclick="Calendar.setUpCalendar(event,this)" caltype="popup"'),fcType==ZPForm.Field.DATE_TIME&&(dateHtml='onclick="Calendar.setUpCalendar(event,this,1)" caltype="popup"',Calendar.is12HrFormat()&&(value=Calendar.convertTo12Hours(value)));var inputDiv='<div class="input-group" keyname="value"><input id="fieldValue"'+emptyAttr+' class="form-control" type="text" value="'+ZPeople.decodeTxt(ZPeople.escapeHtml(value))+'" '+disabledClass+" "+dateHtml+">";return inputDiv+=selDiv,inputDiv+="</div>",inputDiv+=ZPFRules.errorTemplate},ZPFRules.constructOptions=function(options,valArr,searchStr){var optionsDiv="";void 0!=searchStr&&searchStr.indexOf("+")>-1&&(searchStr=searchStr.replace(/\+/i,"\\+"));var searchRe=void 0!=searchStr?new RegExp(searchStr,"i"):"";return $.each(options,function(ind,option){var value=void 0!=option.name?option.name:void 0!=option.DISPVALUE?option.DISPVALUE:option.Value,id=void 0!=option.code?option.code:option.Id+"";if(value.search(searchRe)>-1){var temphtml=ZPFRules.liTemplate;temphtml=(temphtml=(temphtml=temphtml.replace(/\$LISTID\$/g,id)).replace(/\$LISTVALUE\$/g,value)).replace(/\$CLASS\$/g,$.inArray(id,valArr)>-1?"sel":""),optionsDiv+=temphtml}}),optionsDiv},ZPFRules.selectJson=function(condition,fieldDtl,value,formId){var fcType=fieldDtl.fieldType,selectJson={disableClass:!1,showIcon:!1};return $.inArray(parseInt(condition),[ZPNewView.OPERATORS.EMPTY,ZPNewView.OPERATORS.NOT_EMPTY])>-1?selectJson.disableClass=!0:$.inArray(fcType,[ZPForm.Field.LOOKUP,ZPForm.Field.PICKLIST,ZPForm.Field.NEW_GENDER,ZPForm.Field.NEW_BLOODGROUP,ZPForm.Field.NEW_COUNTRY])>-1?$.inArray(parseInt(condition),[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1&&(selectJson.showIcon=!0,selectJson.disableClass=!0):fcType==ZPForm.Field.CHECK_BOX&&(selectJson.disableClass=!0),selectJson},ZPFRules.changeConditions=function(obj){var formId=$(obj).parents("#bodyTag").attr("formId"),fieldDtls=ZPForm.Field.getFieldComponent($(obj).val(),formId),a=ZPFRules.addConditionsForField(fieldDtls.fieldType,$(obj).val());$(obj).parents("[id*=conditionFields]").next("[id*=condition]").html(a),$(obj).parents("[id*=conditionFields]").next("[id*=condition]").find("select").select2();var b=selDiv=ZPFRules.changeFieldForValue(ZPNewView.OPERATORS.EQUAL,fieldDtls,"",formId);$(obj).parents("[id*=conditionFields]").next("[id*=condition]").next("[id*=fieldValue]").html(b)},ZPFRules.changeInput=function(obj){var formId=$(obj).parents("#bodyTag").attr("formId"),fcId=$(obj).parents("[id*=condition]").prev("[id*=conditionFields]").find("select").val(),fieldDtls=ZPForm.Field.getFieldComponent(fcId,formId),inputObj=$(obj).parents("[id*=condition]").next("[id*=fieldValue]").find("input#fieldValue"),selJson=ZPFRules.selectJson(parseInt($(obj).val()),fieldDtls,"",formId);if($(inputObj).prop("disabled",selJson.disableClass),selJson.showIcon){if(!$(inputObj).siblings("#optionsIcon").is(":visible")){var val="",length=$(inputObj).siblings("#conditionDropdownSelection").find("#listBody li.sel").length;$.each($(inputObj).siblings("#conditionDropdownSelection").find("#listBody li.sel"),function(ind,option){val+=$(option).find("span").text(),ind+1<length&&(val+=",")}),$(inputObj).val(val)}$(inputObj).siblings("#optionsIcon").removeClass("DN")}else $(inputObj).siblings("#optionsIcon").addClass("DN"),$(inputObj).val("")},ZPFRules.getFormComponents=function(data,params,others){if(others.hasOwnProperty("forPost")){params={formId:others.formId,mode:"getFormComponents",isFormRule:!0};ZPForm.CURRFORM_PARAM.formId=others.formId,others.isRoleBased&&(params.roleId="-1",params.isRoleBased=!0),ZPeople.Request.send(ZPForm.URL,params,ZPFRules.getFormComponents,others),delete others.forPost}else ZPForm.FORM_COMPONENT_DATA[others.formId]=data,data.code!==ZPeople.ResponeCodes.SUCCESS?7040==data.code&&ZPFRules.getFormComponents({},{},{forPost:!0,formId:ZPForm.CURRFORM_PARAM.formId,roleId:"-1",isRoleBased:!0}):(ZPForm.populateFields(data.message),ZPForm.CURRFORM_PARAM.tableName=void 0!==data.formDetails&&data.formDetails.hasOwnProperty("tableName")?data.formDetails.tableName:"","P_EmployeeLeave"===ZPForm.CURRFORM_PARAM.tableName&&(ZPForm.CURRFORM_PARAM.fieldFormat=["Employee_ID","Leavetype","From","To","TeamEmailID","Reasonforleave"]),ZPForm.formatFields(ZPForm.FORM_COMPONENT_DATA[others.formId].message),data.hasOwnProperty("ruleArray")&&(ZPFRules.constructRulesJson(data,params,others),delete data.ruleArray),others.isValidation?ValidationRule.addRule(others.formId,ValidationRule.validationType):others.hasOwnProperty("isBlueprint")&&others.isBlueprint?others.hasOwnProperty("duringClicked")&&others.duringClicked?Blueprint.duringClicked():others.hasOwnProperty("bpValidation")&&others.bpValidation&&Blueprint.Validation.addRule(others.formId,ValidationRule.validationType):ZPFRules.addRule(others.formId))},ZPFRules.conditionSelectRecord=function(obj){$(obj).toggleClass("sel");var id=$(obj).find("span").attr("id"),className=$(obj).hasClass("sel")?"sel":"";$(obj).parents("[keyname=value]").children("#conditionDropdownSelection").find("span#"+id).parent("li").attr("class",className);var input=$(obj).parents("[keyname=value]").find("input").first().val(),val=$(obj).find("span").text();$(obj).hasClass("sel")?(input+=input.trim().length>0?",":"",input+=val):input=0==$(obj).siblings("li.sel").length?"":input.endsWith(val)?input.replace(","+val,""):input.replace(val+",",""),$(obj).parents("[keyname=value]").find("input").first().val(input)},ZPFRules.openOptionsPopup=function(obj){$(obj).siblings("input#fieldValue").val(),$(obj).popover({html:!0,content:function(){return $($(this).siblings("#conditionDropdownSelection")).clone(!0).removeClass("DN")}}),0==$(obj).siblings(".popover:visible").length&&$(obj).trigger("click"),$("body").on("click",function(e){$('[data-toggle="popover"]').each(function(){$(this).is(e.target)||0!==$(this).has(e.target).length||0!==$(".popover").has(e.target).length||$(this).popover("hide")})})},ZPFRules.searchOptions=function(obj){var searchStr=$(obj).val(),conditionId=null!=$(obj).parents("[id*=fieldValue]").attr("id").match(/[\d]+$/)?$(obj).parents("[id*=fieldValue]").attr("id").match(/[\d]+$/).toString():"",fcId=Layout.Page.container.find("#conditionFields"+conditionId).find("select").val(),formId=$(obj).parents("#bodyTag").attr("formid"),fieldDtl=ZPForm.Field.getFieldComponent(fcId,formId),options=ZPFRules.getAllOptions(fieldDtl),valArr=[];if(void 0!=ZPForm.FIELD_RULE_DETAILS[formId]&&$(obj).parents("[ruleid]").length>0){var ruleArr=ZPFRules.findObject(ZPForm.FIELD_RULE_DETAILS[formId],"ruleId",$(obj).parents("[ruleid]").attr("ruleid")),conditionObj=ZPFRules.findObject(ruleArr.conditionArray,"conditionId",conditionId);valArr=$.inArray(parseInt(conditionObj.operator),[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1?conditionObj.value.split(","):[conditionObj.value]}$(obj).parents("#conditionDropdownSelection").find("#listBody").html(ZPFRules.constructOptions(options,valArr,searchStr))},ZPFRules.findObject=function(jsonArray,searchKey,searchValue,returnValue,checkAddressIndex){var resultObject={},addOnIndex=0;return $.each(jsonArray,function(index,json){if(json[searchKey]==searchValue)return void 0==returnValue?resultObject=json:"index"==returnValue&&(resultObject.index=0==addOnIndex?index:index+addOnIndex),!1;checkAddressIndex&&"formComponentId"==searchKey&&json.fieldType==ZPForm.Field.ADDRESS&&"index"==returnValue&&(addOnIndex+=5)}),resultObject},ZPFRules.addNewRule=function(obj){$(obj).parents("#rule").find("#dvAddruleparent [name=singleRuleDiv]").length;var visibleRule=$(obj).parents("#rule").find("#dvAddruleparent [id*=dvRule]:visible");if(0==visibleRule.length||!ZPFRules.validateRuleDiv(visibleRule)){var formId=$(obj).parents("#rule").find("#bodyTag").attr("formid"),cnt=$(obj).parents("#rule").find("#dvAddruleparent [name=singleRuleDiv]").length;ZPFRules.count=++cnt,$(obj).parents("#rule").find("#dvAddruleparent").append(ZPFRules.singleRuleAdd(formId,{})),$(obj).parents("#rule").find("#dvAddruleparent #dvRule"+cnt).find("select").select2(),$(obj).parents("#rule").find("#dvAddruleparent [id*=dvRule]").length>1&&$(obj).parents("#rule").find("#dvAddruleparent #dvRule"+cnt).siblings("[name=ruleToggleDiv]").trigger("click")}},ZPFRules.deleteRule=function(data,params,others){var isRemoved=!1;if(params.hasOwnProperty("forPost")){var ruleParent=$(others.obj).parents("[name=singleRuleDiv]");0==$(ruleParent).find("[ruleid]").length?$(ruleParent).siblings("[name=singleRuleDiv]").length>0&&($(ruleParent).remove(),isRemoved=!0):(delete(params={ruleId:$(ruleParent).find("[ruleid]").attr("ruleid"),formId:$(ruleParent).parents("#bodyTag").attr("formid"),method:"deleteRule"}).forPost,tabCustom.param=[ZPFRules.url,params,ZPFRules.deleteRule,{obj:ruleParent}],ZPeople.confirm(null,"","Are you sure you want to delete this rule",tabCustom.deleteRequest,!1,!0))}else if("success"==data.msg.trim()){$(others.obj).remove(),isRemoved=!0;var formRuleArray=ZPForm.FIELD_RULE_DETAILS[params.formId],index=ZPFRules.findObject(formRuleArray,"ruleId",params.ruleId,"index").index;formRuleArray.splice(index,1),formRuleArray.formComponent=[],ZPForm.FIELD_RULE_DETAILS[params.formId]=formRuleArray,ZPFRules.formActionUsedFields[params.formId]=ZPFRules.getAllActions(formRuleArray),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.rulesuccessmsg",[ZPI18N.getString("zp.deletedmsg")])),""==Layout.Page.container.find("#dvAddruleparent").html().trim()&&Layout.Page.container.find("#rule #addRule").trigger("click")}else""!=data.msg.trim?ZPeople.confirm(null,"",data.message.trim(),"",!0,!0):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"));isRemoved&&$.each(Layout.Page.container.find("#dvAddruleparent [name=singleRuleDiv]"),function(index,ruleDiv){0==index&&$(this).find("[name=ruleToggleDiv]").trigger("click"),$(this).find("[name=ruleToggleDiv] h6").text(ZPI18N.getString("zp.rule")+" "+(index+1));var id=$(this).find("[id*=dvRule]").attr("id");$(this).find("[name=ruleToggleDiv]").attr("data-target","#"+id.replace(/[\d]+$/,index+1)),$(this).find("[id*=dvRule]").attr("id",id.replace(/[\d]+$/,index+1))})},ZPFRules.findFirstFcId=function(fields,formId,tableName,isBlueprint){var fcId=null,returnFlag=!0,fieldArray=ZPFRules.formActionUsedFields[formId];return $.each(fields,function(index1,section){return $.each(["column1","column2"],function(index2,col){return $.each(section[col],function(index3,field){return void 0!=field&&ZPFRules.isFieldAllowed(!0,field,[],tableName,fieldArray,isBlueprint)&&(fcId=field.formComponentId,returnFlag=!1),returnFlag}),returnFlag}),returnFlag}),fcId},ZPFRules.getAllActions=function(rules){var actionArray=[],cnt=0;return $.each(rules,function(index,rule){$.each(rule.actionArray,function(index1,action){$.each(action.fieldArray,function(index2,field){actionArray[cnt++]=field})})}),actionArray},ZPFRules.addDeleteCondition=function(obj,isAdd){var parentDiv=$(obj).parents("#bodyTag"),currentInd=-1;if(isAdd){var formId=parentDiv.attr("formid"),fields=ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails,others={fields:fields},fcId=ZPFRules.findFirstFcId(fields,formId,ZPForm.FORM_COMPONENT_DATA[formId].formDetails.tableName),conditionActionDiv="",keyJson={cf:"conditionFields",con:"condition",fieldVal:"fieldValue"};$(obj).parents("#dvValidruleparent").length>0&&(currentInd=parseInt($(obj).parents("[name=addRemoveDiv]").prevAll("#criteriaInd").first().attr("ind"))+1,conditionActionDiv=(conditionActionDiv=(conditionActionDiv=ValidationRule.andorTemplate+'<label name="conditionDiv" class="FL ML20 PT5" id="criteriaInd" ind='+currentInd+">"+currentInd+"</label>").replace(/\$[a-z]+SELECTED\$/g,"")).replace(/\$(IND|NUM)\$/g,currentInd),keyJson={cf:"formComponentID",con:"Operator",fieldVal:"CrtVal"});var ruleDiv=ZPFRules.ruleConditionTemplate;others.fieldDtl=ZPForm.Field.getFieldComponent(fcId,formId),others.fieldArray=[fcId],others.formId=formId;var selDiv="";conditionActionDiv=(conditionActionDiv=(conditionActionDiv+=(ruleDiv=ruleDiv.replace(/\$NAME\$/g,"conditionDiv")).replace(/\$CLASS\$/g,"col-md-3 ML15")).replace(/\$KEY\$/g,keyJson.cf)).replace(/\$ID\$/g,"conditionFields"),selDiv=ZPFRules.addFieldsForSelect(others.fields,!0,others,!1),conditionActionDiv=conditionActionDiv.replace(/\$CONDITION\$/g,selDiv),conditionActionDiv=(conditionActionDiv=(conditionActionDiv+=ruleDiv.replace(/\$CLASS\$/g,"col-md-3")).replace(/\$KEY\$/g,keyJson.con)).replace(/\$ID\$/g,"condition"),selDiv=ZPFRules.addConditionsForField(others.fieldDtl.fieldType,others.condition),conditionActionDiv=conditionActionDiv.replace(/\$CONDITION\$/g,selDiv),conditionActionDiv=(conditionActionDiv=(conditionActionDiv=(conditionActionDiv+=ruleDiv.replace(/\$CLASS\$/g,"col-md-4")).replace(/\$KEY\$/g,keyJson.fieldVal)).replace(/\$ID\$/g,"fieldValue")).replace(/\$NUM\$/g,currentInd),selDiv=ZPFRules.changeFieldForValue(others.condition,others.fieldDtl,void 0!=others.fieldValue?others.fieldValue:"",others.formId),conditionActionDiv=conditionActionDiv.replace(/\$CONDITION\$/g,selDiv),conditionActionDiv+=ZPFRules.addRemoveTemplate,$(conditionActionDiv).insertAfter($(obj).parents("[name=addRemoveDiv]")),$(obj).parents("#dvValidruleparent").length>0&&2==parentDiv.find("[ind="+currentInd+"]").length&&$(obj).parents("[name=addRemoveDiv]").nextAll("[id=criteriaInd]").first().nextAll("[id=criteriaInd]").each(function(){var ind=$(this).attr("ind");$(this).attr("ind",++ind),$(this).nextAll("[rulenum="+(ind-1)+"]").attr("rulenum",ind),$(this).text(ind)}),-1!=currentInd&&parentDiv.find("[id=criteriaInd]").length>1&&(parentDiv.find("#patternDiv").show(),ValidationRule.constructPatternAdd(parentDiv,currentInd,"and")),$(obj).parents("[id*=dvRule]").find("select").select2()}else $(obj).parents("[id*=dvRule]").find("[name=conditionDiv]").length>5&&($(obj).parents("#dvValidruleparent").length>0&&(currentInd=parseInt($(obj).parents("[name=addRemoveDiv]").prevAll("#criteriaInd").first().attr("ind")),$(obj).parents("[name=addRemoveDiv]").nextAll("[id=criteriaInd]").each(function(){var ind=$(this).attr("ind");$(this).attr("ind",--ind),$(this).nextAll("[rulenum="+(ind+1)+"]").attr("rulenum",ind),$(this).text(ind)})),$(obj).parents("[name=addRemoveDiv]").prev("[name=conditionDiv]").remove(),$(obj).parents("[name=addRemoveDiv]").prev("[name=conditionDiv]").remove(),$(obj).parents("[name=addRemoveDiv]").prev("[name=conditionDiv]").remove(),$(obj).parents("[name=addRemoveDiv]").prev("[name=conditionDiv]").remove(),1==currentInd?(delOp=$(obj).parents("[name=addRemoveDiv]").next("[name=operatorDiv]").find("select").val(),$(obj).parents("[name=addRemoveDiv]").next("[name=operatorDiv]").remove()):(delOp=$(obj).parents("[name=addRemoveDiv]").prev("[name=operatorDiv]").find("select").val(),$(obj).parents("[name=addRemoveDiv]").prev("[name=operatorDiv]").remove()),$(obj).parents("[name=addRemoveDiv]").remove(),-1!=currentInd&&(1==parentDiv.find("[id=criteriaInd]").length?(parentDiv.find("#patternDiv").hide(),parentDiv.find("#patternDiv input[type=text]").val("")):ValidationRule.constructPatternDelete(parentDiv,currentInd,delOp)))},ZPFRules.updateActionArray=function(event,obj,isAdd){var formId=$(obj).parents("#bodyTag").attr("formid"),formActionArray=ZPFRules.formActionUsedFields[formId],length=formActionArray.length,valArr=[],currentObj=$(obj).parents("[key=actionFields]");if("fcid"==$(obj).attr("keyname"))if(event.hasOwnProperty("removed")){if(formActionArray.length>0){valArr[0]=event.removed.id;var ind=$.inArray(event.removed.id,formActionArray);formActionArray.splice(ind,1),ZPFRules.formActionUsedFields[formId]=formActionArray,isAdd=!1}}else ZPFRules.formActionUsedFields[formId][length]=event.added.id,valArr[0]=event.added.id,isAdd=!0;else if($(obj).parents("[name=addRemoveDiv]").length>0)if(1==isAdd)(null==valArr||valArr.length>0)&&(currentObj=$(obj).parents("[name=addRemoveDiv]").next("[name=actionDiv]").next("[name=actionDiv]"),valArr=$(currentObj).find("select").val()),null!=valArr&&valArr.length>0&&(ZPFRules.formActionUsedFields[formId][length]=valArr[0]);else if(currentObj=$(obj).parents("[name=addRemoveDiv]").prev("[name=actionDiv]"),valArr=$(currentObj).find("select").val(),formActionArray.length>0)for(val in valArr)index=$.inArray(valArr[val],formActionArray),formActionArray.splice(ind,1),ZPFRules.formActionUsedFields[formId]=formActionArray;null!=valArr&&valArr.length>0&&(isAdd?$.each($(obj).parents("#bodyTag").find("[key=actionFields]").not(currentObj),function(index,selectDiv){for(val in valArr)$(this).find("[keyname=fcid]").find("option[value="+valArr[val]+"]").remove();$(this).find("[keyname=fcid]").select2()}):$.each($(obj).parents("#bodyTag").find("[key=actionFields]").not(currentObj),function(index,selectDiv){for(val in valArr){var fieldDtl=ZPForm.Field.getFieldComponent(valArr[val],formId),secId=ZPFRules.findSecId(formId,valArr[val]);$(this).find("[keyname=fcid] optgroup[secid="+secId+"]").append('<option value="'+valArr[val]+'">'+fieldDtl.displayName+"</option>")}$(this).find("[keyname=fcid]").select2()}))},ZPFRules.findTabularFieldIndex=function(formId,fcId){var index=0;return $.each(ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails,function(index1,section){$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){if(void 0!=field&&field.formComponentId==fcId)return index=index3,!1})})}),index},ZPFRules.findSecId=function(formId,fcId){var secId=0;return $.each(ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails,function(index1,section){$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){if(void 0!=field&&field.formComponentId==fcId)return secId=section.sectionId,!1})})}),secId},ZPFRules.setEmptyValue=function(){var editId=ZPForm.Field.Edit.FORMCOMP_ID,emptyFcs=ZPFRules.setEmptyFcs,value="";$.each(emptyFcs,function(index){value="";var fcComp=ZPForm.Field.getFieldComponent(emptyFcs[index]);ZPForm.Field.Edit.FORMCOMP_ID=emptyFcs[index],fcComp.fieldType==ZPForm.Field.CHECK_BOX?value="false":fcComp.fieldType!=ZPForm.Field.LOOKUP&&fcComp.fieldType!=ZPForm.Field.PICKLIST&&fcComp.fieldType!=ZPForm.Field.NEW_GENDER&&fcComp.fieldType!=ZPForm.Field.NEW_BLOODGROUP&&fcComp.fieldType!=ZPForm.Field.NEW_COUNTRY||(value=$.inArray(fcComp.displayType,[ZPForm.Field.MULTISELECT_DISPLYTYPE,ZPForm.Field.CHECK_BOXES_DISPLYTYPE])>-1?[]:"-Select-");var secDtls=ZPFRules.findSec(emptyFcs[index]);secDtls.isTabular?ZPFRules.setEmptyValueForTabColumn(emptyFcs[index],secDtls):value=ZPForm.Field.setValue(fcComp,value)}),ZPFRules.setEmptyFcs=[],ZPForm.Field.Edit.FORMCOMP_ID=editId},ZPFRules.isFieldAllowed=function(isRestrict,field,fieldArray,formTableName,actionArray,isBlueprint){if(isRestrict){if(field.isReadOnly)return!1;if(field.hasOwnProperty("displayType")&&$.inArray(field.displayType,[ZPForm.Field.MULTISELECT_DISPLYTYPE,ZPForm.Field.CHECK_BOXES_DISPLYTYPE])>-1)return!1;if((!isBlueprint||field.fieldType!=ZPForm.Field.FILE_UPLOAD)&&$.inArray(field.fieldType,[ZPForm.Field.FILE_UPLOAD,ZPForm.Field.SCRIPT,ZPForm.Field.PLAIN_TEXT,ZPForm.Field.IMAGE,ZPForm.Field.AUTONUMBER,ZPForm.Field.ADDRESS,ZPForm.Field.SOCIAL_SECURITY_NUMBER])>-1)return!1;if("P_TimesheetJob"==formTableName&&$.inArray(field.labelName,["BillableStatus","Hours"])>-1)return!1;if("P_ClientDetails"==formTableName&&$.inArray(field.labelName,["Billing_Method"])>-1)return!1;if("P_PerformanceAppraisal"==formTableName&&$.inArray(field.labelName,["Rating","CurrentCTC"])>-1||"P_SelfAppraisal"==formTableName&&$.inArray(field.labelName,["AppriasalConfiguration","Rating"])>-1)return!1;if("P_EmployeeLeave"==formTableName&&$.inArray(field.labelName,["DateOfRequest","Daystaken","ZP_Leave_Unit"])>-1)return!1;if("P_Employee"==formTableName&&field.isSystem&&$.inArray(field.labelName,["OrganizationTag"])>-1)return!1}else{if(field.isReadOnly||field.isSystemMandatory)return!1;if($.inArray(formTableName,Timetracker.constants.tableNames)>-1&&(field.isSystem||"P_TimesheetJob"==formTableName&&$.inArray(field.labelName,["Reminder","ReminderTime"])>-1))return!1;if("P_Employee"==formTableName&&field.isSystem&&$.inArray(field.labelName,["Second_Reporting_To","Reporting_To","Role","Social_Security_Number"])>-1)return!1;if("P_EmployeeLeave"==formTableName&&field.isSystem&&$.inArray(field.labelName,["TeamEmailID","Reasonforleave"])<0)return!1;if("P_Goals"==formTableName&&field.isSystem&&$.inArray(field.labelName,["UserRating","ManagerRating"])>-1)return!1;if("P_Candidate"==formTableName&&field.isSystem&&$.inArray(field.labelName,["Last_Name","CandidateEntity","Business_unit","CandidateDivision"])>-1)return!1;if("P_Employee"==formTableName&&field.isSystem&&$.inArray(field.labelName,["Entity","Business_unit","Division","OrganizationTag"])>-1)return!1;if($.inArray(field.fieldType,[ZPForm.Field.AUTONUMBER])>-1)return!1;if($.inArray(field.formComponentId,fieldArray)<0&&$.inArray(field.formComponentId,actionArray)>-1)return!1}return!0},ZPFRules.containsAllElements=function(array1,array2){var isContains=!0;return array1.length==array2.length?$.each(array1,function(index){if(array2.indexOf(array1[index])<0)return isContains=!1,!1}):isContains=!1,isContains},ZPFRules.validateRuleDiv=function(obj){var ruleDiv=$(obj),hasError=!1;if($(ruleDiv).find("[errorid]").html(""),$(ruleDiv).find("[errorid]").hide(),$.each($(ruleDiv).find("[id=conditionFields]"),function(ind,condition){var conditionActionObject={};if(conditionActionObject.fcid=$(condition).find("[keyname]").val(),0==conditionActionObject.fcid.trim().length)$(condition).find("[errorid=errorDiv]").html("Please select a field for condition"),$(condition).find("[errorid=errorDiv]").show(),hasError=!0;else{var fieldValueObject=$(condition).next("[id=condition]").next("[id=fieldValue]");if(conditionActionObject.operator=$(condition).next("[id=condition]").find("[keyname]").val(),conditionActionObject.value=$(fieldValueObject).find("#fieldValue").val(),$(fieldValueObject).find("#optionsIcon").length>0&&$.inArray(parseInt(conditionActionObject.operator),[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1){var fieldDtls=ZPForm.Field.getFieldComponent(conditionActionObject.fcid,$(condition).parents("#bodyTag").attr("formid"));if(fieldDtls.fieldType==ZPForm.Field.LOOKUP||fieldDtls.fieldType==ZPForm.Field.PICKLIST||fieldDtls.fieldType==ZPForm.Field.NEW_GENDER||fieldDtls.fieldType==ZPForm.Field.NEW_BLOODGROUP||fieldDtls.fieldType==ZPForm.Field.NEW_COUNTRY){var valArr=$(fieldValueObject).find("#conditionDropdownSelection #listBody li.sel").length>1?conditionActionObject.value.split(","):[conditionActionObject.value],value="";for(val in valArr)value+=ZPFRules.findOptions(valArr[val],conditionActionObject.fcid,$(condition).parents("#bodyTag").attr("formid"),!0)+",";value=value.substring(0,value.length-1),conditionActionObject.value=value}}$.inArray(parseInt(conditionActionObject.operator),[ZPNewView.OPERATORS.TRUE,ZPNewView.OPERATORS.FALSE,ZPNewView.OPERATORS.EMPTY,ZPNewView.OPERATORS.NOT_EMPTY])<0&&(void 0==conditionActionObject.value||"null"==conditionActionObject.value||0==conditionActionObject.value.trim().length)&&($(fieldValueObject).find("[errorid=errorDiv]").html(ZPI18N.getString("zp.entervalueforcondn")),$(fieldValueObject).find("[errorid=errorDiv]").show(),hasError=!0)}}),$(obj).parents("#dvValidruleparent").length=0){var showHideArray=[],actionsCount=0;if($.each($(ruleDiv).find("[id=action]"),function(index1,action){$(action).next("[id=actionFields]").find("[errorid=errorDiv]").hide(),null!=(showHideArray=$(action).next("#actionFields").find("select").val())&&0!=showHideArray.length&&actionsCount++}),0==actionsCount){hasError=!0;var errorAt=$(ruleDiv).find("#actionFields").parent().children("[errorid=errorDiv]");$(errorAt).html(ZPI18N.getString("zp.showhidefield")),$(errorAt).show()}}return hasError},ZPFRules.collapseElement=function(obj){var toggleDiv=$(obj).siblings($(obj).attr("data-target")),ruleDiv=$(obj).parents("#rule:visible,#validationrule:visible").find("[id*=dvRule]:visible");0!=ruleDiv.length&&ZPFRules.validateRuleDiv(ruleDiv)||($(toggleDiv).find("[errorid]").html(""),$(toggleDiv).find("[errorid]").hide(),$(toggleDiv).collapse("show"),$(ruleDiv).collapse("hide"))},ZPFRules.makeExecutefalse=function(fcs){if(void 0!=fcs&&fcs.length>0)for(;fcs.length>0;){var fcid=fcs.pop();if(void 0!=ZPForm.CURRFORM_PARAM.formId&&void 0!=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId]&&ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent.hasOwnProperty(fcid)){var rulesArray=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent[fcid];if(rulesArray.length>0)for(ruleIn=0;ruleIn<rulesArray.length;ruleIn++){rulesArray[ruleIn].isExecuted=!1}}}else void 0!=ZPForm.CURRFORM_PARAM.formId&&void 0!=ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId]&&$.each(ZPForm.FIELD_RULE_DETAILS[ZPForm.CURRFORM_PARAM.formId].formComponent,function(key,rulesArray){if(rulesArray.length>0)for(ruleIn=0;ruleIn<rulesArray.length;ruleIn++){rulesArray[ruleIn].isExecuted=!1}})},ZPFRules.findSec=function(fcId){var sectionDtls={},fields=ZPForm.FORM_COMPONENT_DATA[ZPForm.CURRFORM_PARAM.formId].message.formComponentDetails,returnFlag=!0;return $.each(fields,function(index1,section){return $.each(["column1","column2"],function(index2,col){return $.each(section[col],function(index3,field){if(void 0!=field&&field.formComponentId==fcId)return sectionDtls=section,returnFlag=!1}),returnFlag}),returnFlag}),sectionDtls},ZPFRules.setEmptyValueForTabColumn=function(fcId,secDtls){var fieldObjects=ZPFRules.LAYOUT.find("[id=zp_field_outer_"+fcId+"]"),value="";if(0==fieldObjects.length){var sectionDiv=ZPFRules.LAYOUT.find("#zp_section_fields_"+secDtls.sectionId);0!=(resultObj=ZPFRules.findObject(secDtls.column1,"formComponentId",fcId,"index",!0)).length&&resultObj.hasOwnProperty("index")||(resultObj=ZPFRules.findObject(secDtls.column2,"formComponentId",fcId,"index",!0));var index=resultObj.index+1;fieldObjects=sectionDiv.find("tbody tr td:nth-child("+index+")")}var findProp={},inputObject=fieldObjects.first(),inputDiv=$(inputObject).find("[id*=zp_field_]:visible");$(inputObject).parents("#zp_form_body").siblings("div").length>0&&(0==$(inputObject).find("#zp_fieldedit_comp").length||$(inputObject).find("#zp_fieldedit_comp").not(".DN").length>0)&&(inputDiv=$(inputObject).find("[id*=zp_field_]")),$(inputDiv).length>0?$(inputObject).find("select").length>0?findProp={find:"select option:selected",val:"text"}:$(inputObject).find("input").length>0?findProp=fcType==ZPForm.Field.CHECK_BOX?{find:"input",val:"checked"}:{find:"input",val:"val"}:$(inputObject).find("textarea").length>0&&(findProp={find:"textarea",val:"val"}):void 0!=$(inputObject).attr("displaytype")&&$(inputObject).attr("displaytype")==ZPForm.Field.RADIO_DISPLYTYPE?findProp=$(inputObject).find("input[type=radio]:visible").length>0?{find:"input[type=radio]:checked",val:"checked"}:{find:"span:first",val:"text"}:($(inputObject).find("span:visible").length>0&&(findProp={find:"span:visible",val:"text"}),findProp={val:"text"}),fieldObjects.each(function(){findProp.hasOwnProperty("find")?"text"==findProp.val?findProp.find.indexOf("span")>-1?$(this).find(findProp.find).text("-"):$(this).find(findProp.find).text(""):"val"==findProp.val?$(this).find(findProp.find).val(""):"checked"==findProp.val&&$(this).find(findProp.find).each(function(){$(this).prop("checked",!1),value=!1}):($(this).is("td"),$(this).text("-"))});var fieldValData={};if(secDtls.isGridType){var recordDtls=ZPForm.getSingleRecord();if(void 0!=recordDtls&&void 0!=recordDtls.record){var resultObj,recData=recordDtls.record;$.each(recData.message.recordDetails,function(){if(this.sectionId==secDtls.sectionId&&this.hasOwnProperty("datarows"))return fieldValData=this.datarows,!1}),0!=(resultObj=ZPFRules.findObject(secDtls.column1,"formComponentId",fcId,"index",!0)).length&&resultObj.hasOwnProperty("index")||(resultObj=ZPFRules.findObject(secDtls.column2,"formComponentId",fcId,"index",!0));index=resultObj.index;for(i in fieldValData){fieldValData[i][index]=value}}}else for(i in(fieldValData=ZPForm.Field.getFieldValueData(fcId)).componentValue)fieldValData.componentValue[i]=value},ZPFRules.removeDeletedRows=function(deleteArray){for(i in deleteArray){var deleteRow=deleteArray[i],row=ZPFRules.LAYOUT.find("[rowid="+deleteRow+"]"),secId=row.attr("secid"),recordDtls=ZPForm.getSingleRecord();if(void 0!=recordDtls&&void 0!=recordDtls.record){var recData=recordDtls.record.recordDetails;$.each(recData.message.recordDetails,function(){if(this.isTabular){var fieldValData=this.recordIdArray;for(i in fieldValData)if(fieldValData[i]==deleteRow){if(this.hasOwnProperty("datarows"))this.datarows.splice(i,1);else{if(this.hasOwnProperty("column1"))for(fieldIndex in this.column1){this.column1[fieldIndex].componentValue.splice(i,1)}if(this.hasOwnProperty("column2"))for(fieldIndex in this.column2){this.column2[fieldIndex].componentValue.splice(i,1)}}return fieldValData.splice(i,1),this.noOfRows-=1,this.recordIdArray=fieldValData,!1}}})}0==row.siblings("[secid="+secId+"][row]").length?row.prop("rowid",""):row.remove()}},ZPFRules.hideFields=function(currentRow,prevRow){return prevRow.find("[id*=zp_field_outer_]").not(":visible").each(function(){var id=$(this).attr("id");$(this).is("td")?(currentRow.find("td#"+id).addClass("DN"),currentRow.find("td#"+id).attr("isActionHidden",!0)):(currentRow.find("#"+id).parent("div").addClass("DN"),currentRow.find("#"+id).attr("isActionHidden",!0))}),currentRow},ZPFRules.constructActionElms=function(rulesArray){var responseRuleObj={},actionElms=[],ruleElms=[];return $.each(rulesArray,function(index){var currRule=rulesArray[index];$.each(currRule.actionArray,function(i1,v1){v1.fieldArray.length>0&&$.each(v1.fieldArray,function(i2,v2){actionElms.push(v1.fieldArray[i2]),ruleElms.push(currRule)})})}),responseRuleObj.actionElms=actionElms,responseRuleObj.rules=ruleElms,responseRuleObj},ZPFRules.evaluateRuleForField=function(rule,record,actionFcId){rule.operator;var conditionArray=rule.conditionArray,actionArray=rule.actionArray,str=0,noOfConditions=0;$.each(conditionArray,function(i){var condition=conditionArray[i],fcid=condition.fcid;condition.value;$.each(record,function(index1,section){$.each(["column1","column2"],function(index2,col){void 0!=section[col]&&$.each(section[col],function(index3,field){if(void 0!=field&&fcid==field.formComponentId){var fieldValue=field.componentValue,result=ZPFRules.evaluateCondition(condition,fcid,field,!1,fieldValue);str+=result,noOfConditions++}})})})});var result=!1;str>0&&(result=rule.operator==ZPFRules.OPERATOR.ALL?str==noOfConditions:str>0);var isAllowed=!1;return $.each(actionArray,function(index,action){var actionoper=action.operator,actionFieldArray=action.fieldArray;$.inArray(actionFcId,actionFieldArray)>-1&&(0==actionoper?result&&(isAllowed=!0):result||(isAllowed=!0))}),isAllowed},ZPFRules.getDependentFields=function(critFcid,fields,isFromSelfService){var rules=ZPForm.FIELD_RULE_DETAILS[ZPForm.formid];isFromSelfService&&(rules=ZPForm.FIELD_RULE_DETAILS[ZPeople.EMP_FORMID]),void 0!=rules&&rules.length>0&&$.each(rules,function(index,rule){var fieldElms=rule.fieldElms,actionElms=rule.actionElms;(void 0!=fieldElms&&$.inArray(critFcid,fieldElms)>-1||void 0!=actionElms&&$.inArray(critFcid,actionElms)>-1)&&(void 0!=fieldElms&&fieldElms.length>0&&$.each(fieldElms,function(index2,fieldElm){-1==$.inArray(fieldElm,fields)&&(fields.push(fieldElm),ZPFRules.getDependentFields(fieldElm,fields,isFromSelfService))}),void 0!=actionElms&&actionElms.length>0&&$.each(actionElms,function(index1,actionElm){-1==$.inArray(actionElm,fields)&&(fields.push(actionElm),ZPFRules.getDependentFields(actionElm,fields,isFromSelfService))}))})};var zpMassUpdate={formId:void 0,url:"/massUpdate.zp",params:{},callback:"",firstFieldId:void 0,fieldDetails:void 0,isUser:!1,fieldCount:0,addLinkHtml:'<tr name="addnewlink"><td colspan="4"><a class="btn btn-link ML5" id="addnewLnk" onclick="zpMassUpdate.listBulkUpdateFields(null,null,true)"><span class="IC-add MR5 S12"></span>'+ZPI18N.getString("zp.addnew")+"</a></td></tr>",massUpdateFields:function(isAddNew){this.formId=Layout.Page.urlparam.formId;var isLocationTrackingEnabled=!1;ZPForm.FORM_DETAILS.hasOwnProperty(this.formId)&&(isLocationTrackingEnabled=ZPForm.FORM_DETAILS[this.formId].isLocationTrackingEnabled),isLocationTrackingEnabled&&void 0==ZPForm.isLocationPermissionEnabled?Timetracker.location.getLocation(zpMassUpdate.massUpdateFieldsGeo,isAddNew,this):zpMassUpdate.massUpdateFieldsGeo(isAddNew,this)},massUpdateFieldsGeo:function(isAddNew,ele){ele.formId=Layout.Page.urlparam.formId,Layout.Page.hash.indexOf("performance/salary/employeesalary")>-1&&(ele.formId=Appraisal.Salary.formDetails.formId);var isLocationTrackingEnabled=!1;if(ZPForm.FORM_DETAILS.hasOwnProperty(ele.formId)&&(isLocationTrackingEnabled=ZPForm.FORM_DETAILS[ele.formId].isLocationTrackingEnabled),isLocationTrackingEnabled&&(ZPForm.isLocationPermissionEnabled=!1,0!==Object.keys(Timetracker.location.latLongParam).length)){var location_obj=Timetracker.location.latLongParam;location_obj.hasOwnProperty("latitude")&&null!==location_obj.latitude&&!isNaN(Timetracker.location.latLongParam.latitude)&&location_obj.hasOwnProperty("longitude")&&null!==location_obj.longitude&&!isNaN(Timetracker.location.latLongParam.longitude)&&location_obj.hasOwnProperty("accuracy")&&null!==location_obj.accuracy&&!isNaN(Timetracker.location.latLongParam.accuracy)&&Timetracker.location.latLongParam.accuracy<=1e3&&(ZPForm.isLocationPermissionEnabled=!0)}var pageId=Layout.Page.container;if(void 0===ele.formId&&Layout.Page.hash.indexOf("#onboarding/candidate/cportal")>-1?ele.formId=Layout.Page.container.find("table#candidateListTable").attr("formid"):void 0===ele.formId&&(ele.formId=Layout.Page.container.find("table#userListTable").attr("formid"),ele.isUser=!0),ZPForm.CURRFORM_PARAM={formId:ele.formId},pageId.find("#massUpdatePopup #saveUpdate").removeClass("disabled"),void 0===ZPForm.FORM_COMPONENT_DATA[ele.formId]&&ZPeople.Request.sendAsyncPost(ZPForm.URL,{formId:ele.formId,mode:"getFormComponents"},ele.setFormComponentData),0!=pageId.find("#bulkUpdFieldsTable tbody").children().length&&isLocationTrackingEnabled&&0==ZPForm.isLocationPermissionEnabled?(pageId.find("#errormsg").hide(),pageId.find("div#massUpdatePopup [name=bulkRows]").not("#firstFieldRow").remove(),pageId.find("div#massUpdatePopup #firstFieldRow [name=fieldsSelBox]").val(ele.firstFieldId).trigger("change"),pageId.find("div#massUpdatePopup").modal()):(ele.params={formid:ele.formId,mode:"list"},ele.callback=ele.listBulkUpdateFields,ZPeople.Request.send(ele.url,ele.params,ele.callback,isAddNew)),isLocationTrackingEnabled&&0==ZPForm.isLocationPermissionEnabled&&(ZPForm.showNoData(void 0,pageId.find("div#massUpdatePopup"),1),pageId.find("[id=saveUpdate]").attr("style","display:none")),"P_Goals"==ZPForm.getTableName()){pageId.find("#errormsg").hide();var txt='<a class="btn btn-primary" id="saveUpdate" onclick="zpMassUpdate.updateFields(this)">'+ZPI18N.getString("zp.saveandupdate")+'</a> <a data-dismiss="modal" class="btn btn-default">'+ZPI18N.getString("zp.cancel")+"</a>";pageId.find("div.modal-footer").html(txt)}},setFormComponentData:function(resultObj){resultObj.iCache=!0,ZPForm.formatFields(resultObj.message),ZPForm.FORM_COMPONENT_DATA[zpMassUpdate.formId]=resultObj,ZPForm.populateFields(resultObj.message)},listBulkUpdateFields:function(fieldsDtls,paramsObj,isAddNew){var pageId=Layout.Page.container;if(isAddNew||fieldsDtls.isSuccess)if(isAddNew){newFirstElementObj=(editFieldsObj=zpMassUpdate.constructselectBoxForEditBulkUpd(zpMassUpdate.fieldDetails.sections))[0],initialElm=zpMassUpdate.getInitElementHtml(editFieldsObj);$(initialElm).insertBefore(pageId.find("tr[name=addnewlink]")),pageId.find("#field_"+zpMassUpdate.fieldCount).find("td").last().html('<div class="dvlist-action MT5"><a class="IC-remove" onclick="zpMassUpdate.handleRemoveField(this)"></a></div>'),pageId.find("#field_"+zpMassUpdate.fieldCount).find("#firstFieldSelBox").select2(zpMassUpdate.select2.getSelect2Properties({initseljson:newFirstElementObj,isFieldList:!0})),pageId.find("#field_"+zpMassUpdate.fieldCount).find("#firstFieldSelBox").select2("val",newFirstElementObj.id);selectedFieldDtls=ZPForm.FORM_COMPONENTS[newFirstElementObj.id];pageId.find("#field_"+zpMassUpdate.fieldCount).find("#firstFieldSelBox").attr("labelName",selectedFieldDtls.labelName),zpMassUpdate.fieldCount++;var lastFieldId=zpMassUpdate.fieldCount-1;pageId.find("#field_"+lastFieldId).find("#firstFieldSelBox").trigger("change"),1==editFieldsObj.length?Layout.Page.container.find("tr[name=addnewlink]").remove():Layout.Page.container.find("tr[name=addnewlink]")[0].scrollIntoView({behavior:"smooth",block:"end"})}else{pageId.find("table#bulkUpdFieldsTable tbody").html(""),zpMassUpdate.fieldCount=0,zpMassUpdate.fieldDetails=fieldsDtls;var selectedFieldDtls=ZPForm.FORM_COMPONENTS[fieldsDtls.firstFcid];zpMassUpdate.firstFieldId=selectedFieldDtls.formComponentId;var editFieldsObj=zpMassUpdate.constructselectBoxForEditBulkUpd(fieldsDtls.sections),initialElm=zpMassUpdate.getInitElementHtml(editFieldsObj),newFirstElementObj=editFieldsObj[0];pageId.find("table#bulkUpdFieldsTable tbody").html(initialElm),pageId.find("div#massUpdatePopup").find("#firstFieldSelBox").select2(zpMassUpdate.select2.getSelect2Properties({initseljson:newFirstElementObj,isFieldList:!0})),pageId.find("div#massUpdatePopup").find("#firstFieldSelBox").select2("val",newFirstElementObj.id),zpMassUpdate.fieldCount++,pageId.find("#field_"+(zpMassUpdate.fieldCount-1)).find("#firstFieldSelBox").trigger("change"),pageId.find("div#massUpdatePopup").modal(),fieldsDtls.isCVAvailable?0==pageId.find("table#bulkUpdFieldsTable").siblings("#zp_import_submit_cv").length?$('<div id="zp_import_submit_cv" class="pad form-group"><div class="col-sm-6 col-sm-offset-3"><label class="checkbox DIB MR10"><input type="checkbox" name="customValidationOn" checked="checked"><span class="ML2">'+ZPI18N.getString("zp.executecustomvalidation")+"</span></label></div></div>").insertAfter(pageId.find("table#bulkUpdFieldsTable")):pageId.find("#zp_import_submit_cv [name=customValidationOn]").prop("checked",!0):pageId.find("#zp_import_submit_cv").remove(),fieldsDtls.isWorkFlowAvailable&&0==pageId.find("table#bulkUpdFieldsTable").siblings("#zp_import_submitwork_flow").length&&($('<div id="zp_import_submitwork_flow" class="pad form-group"><div class="col-sm-6 col-sm-offset-3"><label class="checkbox DIB MR10"><input type="checkbox" name="workFlowOn" checked="checked"><span class="ML2">'+ZPI18N.getString("zp.executeeworkflow")+"</span></label></div></div>").insertAfter(pageId.find("table#bulkUpdFieldsTable")),ZPForm.isAdmin()||pageId.find("#zp_import_submitwork_flow").hide()),1==editFieldsObj.length?Layout.Page.container.find("tr[name=addnewlink]").remove():Layout.Page.container.find("tr[name=addnewlink]")[0].scrollIntoView({behavior:"smooth",block:"end"})}else{var msg=ZPI18N.getString("zp.sorryservererror");"NOFIELDS"==fieldsDtls.message&&(msg=ZPI18N.getString("zp.noeditablefields")),ZPForm.showNoData(msg,pageId.find("div#massUpdatePopup")),pageId.find("div#massUpdatePopup").modal(),pageId.find("[id=saveUpdate]").attr("style","display:none")}},constructselectBoxForEditBulkUpd:function(fieldsDtls,searchTerm){var options=[],addedFieldList=zpMassUpdate.getAddedFieldList();return $.each(fieldsDtls,function(index,fcDtls){$.each(fcDtls.fields,function(ind,fieldDtls){if(("P_Employee"===ZPForm.getTableName()||zpMassUpdate.isUser&&Layout.Page.pageId.includes("admin-employeerecords"))&&"Division"==fieldDtls.labelName&&zpMassUpdate.findFCData(zpMassUpdate.formId,fieldDtls.fcId).displayType==ZPForm.Field.MULTISELECT_DISPLYTYPE)return!0;var tempDispName=ZPeople.decodeTxt(fieldDtls.displayName.toUpperCase()),tempSearchTerm=void 0==searchTerm?"":searchTerm.toUpperCase();if(-1==$.inArray(fieldDtls.fcId,addedFieldList)&&(void 0==searchTerm||-1!=tempDispName.indexOf(tempSearchTerm))){var optionObj={id:fieldDtls.fcId,text:ZPeople.decodeTxt(fieldDtls.displayName)};options.push(optionObj)}})}),options},getFcDtlsWhenFieldChange:function(thisObj){Layout.Page.container,thisObj.value;var formId=this.formId;if(void 0!==ZPForm.FORM_COMPONENT_DATA[formId]){parseInt($(thisObj).find("option:selected").parent("optgroup").attr("secNum"));var columnName=$(thisObj).find("option:selected").attr("columnNum"),fcNum=parseInt($(thisObj).find("option:selected").attr("fcNum"));if(2==columnName)fcNum=fcNum-parseInt($(thisObj).find("option:selected").parent("optgroup").find("option[columnnum=1]").last().attr("fcNum"))-1;var fldDtls=this.findFCData(formId,$(thisObj).val());this.changeFields(fldDtls,thisObj)}},changeFields:function(fieldDtlsObj,currElm){var selectFieldDtls=fieldDtlsObj,fields=[];if(ZPForm.Field.Edit.getDependFieldMappingFields(selectFieldDtls.formComponentId,fields),$(currElm).attr("isdependentfield")&&"true"==$(currElm).attr("isdependentfield")){$(currElm).removeAttr("isdependentfield");var prevId=$(currElm).attr("dependentField"),prevFieldDetails=zpMassUpdate.findFCData(zpMassUpdate.formId,prevId);$(currElm).removeAttr("dependentField");var currFields=[];if(ZPForm.Field.Edit.getDependFieldMappingFields(prevId,currFields),prevFieldDetails.dependentFiledList&&prevFieldDetails.dependentFiledList.length>0)for(var i=0;i<prevFieldDetails.dependentFiledList.length;i++)currFields.push(prevFieldDetails.dependentFiledList[i]);zpMassUpdate.dependentFieldHandling(currFields,!0)}var appendHere=$(currElm).closest("tr").find("td#firstEdtbox");if(appendHere.html(zpMassUpdate.constructEditElms(selectFieldDtls)),ZPSetupCommon.isEmpty(selectFieldDtls.autofillvalue)||appendHere.find("*[name=editable]").val(ZPeople.decodeTxt(selectFieldDtls.autofillvalue)),$(currElm).attr("labelName",selectFieldDtls.labelName),$(currElm).attr("isMandatory",selectFieldDtls.isMandatory),$(currElm).parent().find("div.dverrormsg").remove(),appendHere.removeClass("has-error"),ZPeople.isZPNewUI()&&(appendHere.find("[fieldType=26]").select2(zpMassUpdate.select2.getSelect2Properties()),appendHere.find("[fieldType=26]").select2("val","-Select-"),appendHere.find("[fieldType=25]").select2(),appendHere.find("[fieldType=25]").select2("val","-Select-"),appendHere.find("[fieldType=28]").select2(),appendHere.find("[fieldType=28]").select2("val","-Select-"),appendHere.find("[fieldType=27]").select2(),appendHere.find("[fieldType=27]").select2("val","-Select-"),appendHere.find("[fieldType=29]").select2(),appendHere.find("[fieldType=29]").select2("val","-Select-"),appendHere.find("[fieldType=40]").select2(),appendHere.find("[fieldType=40]").select2("val","-Select-"),appendHere.find("[fieldType=41]").select2(),appendHere.find("[fieldType=41]").select2("val","-Select-"),appendHere.find("[fieldType=42]").select2(),appendHere.find("[fieldType=42]").select2("val","-Select-")),fields.length>0&&appendHere.find("[fieldType=26]").attr("onchange","zpMassUpdate.handledependentFieldChange(this)"),selectFieldDtls.dependentFiledList&&selectFieldDtls.dependentFiledList.length>0)for(i=0;i<selectFieldDtls.dependentFiledList.length;i++)fields.push(selectFieldDtls.dependentFiledList[i]);fields.length>0&&($(currElm).attr("isDependentField",!0),$(currElm).attr("dependentField",selectFieldDtls.formComponentId),fields=zpMassUpdate.updateOrderOfFields(fields,selectFieldDtls.formComponentId),zpMassUpdate.dependentFieldHandling(fields,!1,selectFieldDtls.formComponentId))},dependentFieldHandling:function(dependentList,isRemove,fcid){for(var pageId=Layout.Page.container,i=0;i<dependentList.length;i++)if(isRemove)1==Layout.Page.container.find("td[id=firstEdtbox]").find("input[fcid="+dependentList[i]+"]").length&&Layout.Page.container.find("td[id=firstEdtbox]").find("input[fcid="+dependentList[i]+"]").parent().parent().remove();else{for(var editFieldsObj=zpMassUpdate.constructselectBoxForEditBulkUpd(zpMassUpdate.fieldDetails.sections),newFirstElementObj=editFieldsObj[0],j=0;j<editFieldsObj.length;j++){var currObj=editFieldsObj[j];if(currObj.id==dependentList[i]){newFirstElementObj=currObj;break}}if(newFirstElementObj.id==dependentList[i]){var initialElm=zpMassUpdate.getInitElementHtml(editFieldsObj),selectFieldDtls=this.findFCData(zpMassUpdate.formId,newFirstElementObj.id);$(initialElm).insertBefore(pageId.find("tr[name=addnewlink]")),pageId.find("#field_"+zpMassUpdate.fieldCount).find("#firstFieldSelBox").attr("disabled","disabled"),pageId.find("#field_"+zpMassUpdate.fieldCount).find("#firstFieldSelBox").select2(zpMassUpdate.select2.getSelect2Properties({initseljson:newFirstElementObj,isFieldList:!0})),pageId.find("#field_"+zpMassUpdate.fieldCount).find("#firstFieldSelBox").select2("val",newFirstElementObj.id);var appendHere=pageId.find("#field_"+zpMassUpdate.fieldCount).closest("tr").find("td#firstEdtbox");zpMassUpdate.constructEditElms(selectFieldDtls);appendHere.html(zpMassUpdate.constructEditElms(selectFieldDtls)),ZPeople.isZPNewUI()&&(appendHere.find("[fieldType=26]").select2(zpMassUpdate.select2.getSelect2Properties()),appendHere.find("[fieldType=26]").select2("val","-Select-")),appendHere.find("[fieldType=26]").attr("onchange","zpMassUpdate.handledependentFieldChange(this)"),pageId.find("#field_"+zpMassUpdate.fieldCount).find("#firstFieldSelBox").attr("labelName",selectFieldDtls.labelName),pageId.find("#field_"+zpMassUpdate.fieldCount).find("#firstFieldSelBox").attr("isMandatory",selectFieldDtls.isMandatory),zpMassUpdate.fieldCount++,1==editFieldsObj.length&&Layout.Page.container.find("tr[name=addnewlink]").remove()}}},updateOrderOfFields:function(fields,selectedField){var alterTedArray=fields,selectedElementDetails=zpMassUpdate.findFCData(zpMassUpdate.formId,selectedField);if(("P_Employee"===ZPForm.getTableName()||zpMassUpdate.isUser&&Layout.Page.pageId.includes("admin-employeerecords"))&&("Entity"==selectedElementDetails.labelName||"Business_unit"==selectedElementDetails.labelName||"Division"==selectedElementDetails.labelName)||"P_Candidate"===ZPForm.getTableName()&&("CandidateEntity"==selectedElementDetails.labelName||"Business_unit"==selectedElementDetails.labelName||"CandidateDivision"==selectedElementDetails.labelName)){var labelNames="P_Candidate"===ZPForm.getTableName()?["CandidateEntity","Business_unit","CandidateDivision","CandidateDepartment"]:["Entity","Business_unit","Division","Department"];alterTedArray=[];for(var i=0;i<labelNames.length;i++)for(var j=0;j<fields.length;j++){zpMassUpdate.findFCData(zpMassUpdate.formId,fields[j]).labelName==labelNames[i]&&alterTedArray.push(fields[j])}return alterTedArray}return alterTedArray},handledependentFieldChange:function(ele){var elementId=$(ele).attr("fcid"),fields=[],pageId=Layout.Page.container;ZPForm.Field.Edit.getDependFieldMappingFields(elementId,fields);for(var i=0;i<fields.length;i++)if(field[i]!=elementId){var currFcid=fields[i];pageId.find("[name=bulkRows]").find("#firstEdtbox").find("[fcid="+currFcid+"]").select2("val","-Select-")}},constructEditElms:function(selectedFieldDtls){var editElms="",fieldType=selectedFieldDtls.fieldType,lblName=selectedFieldDtls.labelName,fcid=selectedFieldDtls.formComponentId;if(fieldType===ZPForm.Field.PICKLIST||selectedFieldDtls.fieldType==ZPForm.Field.LOOKUP&&!ZPeople.isZPNewUI()||fieldType===ZPForm.Field.BLOODGROUP||fieldType===ZPForm.Field.GENDER||fieldType===ZPForm.Field.COUNTRY||fieldType===ZPForm.Field.NEW_BLOODGROUP||fieldType===ZPForm.Field.NEW_GENDER||fieldType===ZPForm.Field.NEW_COUNTRY){editElms+="<select class='selectBox' name='editable' id='editable"+lblName+"' fieldType = '"+fieldType+"' fcid='"+fcid+"' >",editElms+="<option value='-Select-'>"+ZPI18N.getString("zp.select")+"</option>";var options=selectedFieldDtls.hasOwnProperty("isPrimaryLookup")&&selectedFieldDtls.isPrimaryLookup?selectedFieldDtls.hasOwnProperty("AddOptions")?selectedFieldDtls.AddOptions:selectedFieldDtls.EditOptions:selectedFieldDtls.Options,optionswithids=selectedFieldDtls.OptionsWithId;fieldType!==ZPForm.Field.NEW_BLOODGROUP&&fieldType!==ZPForm.Field.NEW_GENDER&&fieldType!==ZPForm.Field.NEW_COUNTRY&&fieldType!==ZPForm.Field.COUNTRY||(options=selectedFieldDtls.Options),$.each(options,function(index,val){if(fieldType===ZPForm.Field.PICKLIST||fieldType===ZPForm.Field.BLOODGROUP||fieldType===ZPForm.Field.GENDER){var optId=fieldType===ZPForm.Field.PICKLIST&&void 0!=optionswithids?optionswithids[index].Id:"-1";editElms+="<option optId="+optId+" value='"+val+"'>"+val+"</option>"}else if(fieldType===ZPForm.Field.COUNTRY){var name=val.name.toUpperCase();editElms+='<option code="'+val.code+'" value="'+name+'">'+name+"</option>"}else if(fieldType===ZPForm.Field.NEW_COUNTRY||fieldType===ZPForm.Field.COUNTRY){let value=val.name;fieldType===ZPForm.Field.NEW_COUNTRY&&(value=val.code),editElms+='<option code="'+val.code+'" value="'+value+'">'+val.name+"</option>"}else if(fieldType==ZPForm.Field.NEW_BLOODGROUP||fieldType==ZPForm.Field.NEW_GENDER){var optionIds=selectedFieldDtls.oIds;editElms+="<option optId="+optionIds[index]+" value='"+optionIds[index]+"'>"+val+"</option>"}else editElms+="<option value='"+val.Id+"'>"+val.Value+"</option>"}),editElms+="</select>"}else fieldType===DATE||fieldType===DATE_TIME?(editElms+="<div class='btnCal'>",fieldType===DATE?editElms+="<input type='text' class='form-control' name='editable' onclick='Calendar.setUpCalendar(event,this)' id='editable"+lblName+"' fieldType = '"+fieldType+"' caltype='popup' fcid='"+fcid+"' />":editElms+="<input type='text' class='form-control' name='editable' onclick='Calendar.setUpCalendar(event,this,1)' id='editable"+lblName+"' fieldType = '"+fieldType+"' caltype='popup' fcid='"+fcid+"' />",editElms+="</div>"):fieldType===TEXT_AREA?editElms+="<textarea rows='3' class='form-control' name='editable' id='editable"+lblName+"' fieldType = '"+fieldType+"' fcid='"+fcid+"' ></textarea>  ":9===fieldType?editElms+="<input type='checkbox' class='form-control' name='editable' id='editable"+lblName+"' fieldType = '"+fieldType+"' fcid='"+fcid+"' />":selectedFieldDtls.fieldType==ZPForm.Field.LOOKUP?editElms+="<input type='text' id='editable"+lblName+"' name='editable' fcid='"+fcid+"' fieldType = '"+fieldType+"'/>":editElms+="<input type='text' class='form-control' id='editable"+lblName+"' name='editable' fcid='"+fcid+"' fieldType = '"+fieldType+"'/>";return editElms},update:function(obj){var isLocationTrackingEnabled=!1;ZPForm.FORM_DETAILS.hasOwnProperty(zpMassUpdate.formId)&&(isLocationTrackingEnabled=ZPForm.FORM_DETAILS[zpMassUpdate.formId].isLocationTrackingEnabled),isLocationTrackingEnabled&&void 0==ZPForm.isLocationPermissionEnabled?Timetracker.location.getLocation(zpMassUpdate.updateGeo,obj):zpMassUpdate.updateGeo(obj)},updateGeo:function(obj){var params,pageId=Layout.Page.container,formId=zpMassUpdate.formId,tabEleAndPkIds=zpMassUpdate.getPkIds(),pkIds=(tabEleAndPkIds.userTableElm,tabEleAndPkIds.pkIds),fcIds=[],errorRef=[],duplicateErrRef=[];zpMassUpdate.selectedFieldIds=[],$(obj).addClass("disabled"),$.each(pageId.find("input[id='firstFieldSelBox']"),function(index,fields){fcIds[index]=$(fields).val()}),$("div.dverrormsg").remove();var isLocationTrackingEnabled=!1;ZPForm.FORM_DETAILS.hasOwnProperty(formId)&&(isLocationTrackingEnabled=ZPForm.FORM_DETAILS[formId].isLocationTrackingEnabled),params={formid:formId,mode:"edit",fcIds:JSON.stringify(fcIds),pkIds:JSON.stringify(pkIds),loginUserZUID:_LOGGEDIN_ZUID},params=Import.addLatLonParams(isLocationTrackingEnabled,params),pageId.find("#zp_import_submitwork_flow").length>0&&pageId.find("#zp_import_submitwork_flow [name=workFlowOn]").is(":checked")&&(params.isWfTrigger=!0),zpMassUpdate.fieldDetails.isCVAvailable&&(params.customValidationOn=pageId.find("#zp_import_submit_cv [name=customValidationOn]").is(":checked")),$.each(pageId.find("table#bulkUpdFieldsTable tbody").find("tr[name='bulkRows']"),function(index,rowObj){if("bulkRows"===$(rowObj).attr("name")){var value,fieldSelBox=$(rowObj).find("input[id='firstFieldSelBox']"),fcId=fieldSelBox.val(),labelName=fieldSelBox.attr("labelName"),editableElm=fieldSelBox.closest("tr").find("*[name='editable']");let displayType=ZPForm.FORM_COMPONENTS[fcId].displayType;var fieldType=editableElm.attr("fieldType");value="9"!==fieldType?editableElm.val():$(editableElm).is(":checked");var parentErrObj=$(rowObj).find("td#firstEdtbox");let showErr=!1;"true"===fieldSelBox.attr("isMandatory")&&(displayType==ZPForm.Field.RADIO_DISPLYTYPE||displayType==ZPForm.Field.SELECT_DISPLYTYPE?showErr=ZPUtil.Validation.isEmpty(value):fieldType==ZPForm.Field.CHECK_BOX?showErr=!value:void 0===displayType&&(showErr=ZPUtil.Validation.isEmpty(value))),showErr?(parentErrObj.addClass("has-error"),ZPSetupCommon.showErr(ZPI18N.getString("zp.mandatoryfield",new Array(labelName)),parentErrObj,"dverrormsg"),errorRef.push(labelName+index)):fieldType!=ZPForm.Field.EMAIL_ADDRESS||ZPSetupCommon.isEmpty(value)||ZPUtil.Validation.isEmail(value)?(value=fieldType==ZPForm.Field.DATE_TIME?Calendar.convertHourFormat(value):value,fieldType!=ZPForm.Field.PICKLIST||ZPForm.Field.getFieldComponent(fcId).isEmpStatus||(value=$(editableElm).find("option:selected").attr("optid")),params[labelName]=value,parentErrObj.removeClass("has-error"),$("#"+labelName+index).remove(),-1!==errorRef.indexOf(labelName)&&errorRef.pop(labelName+index)):(parentErrObj.addClass("has-error"),ZPSetupCommon.showErr(ZPI18N.getString("zp.validemail",new Array(labelName)),parentErrObj,"dverrormsg"),errorRef.push(labelName+index)),-1===zpMassUpdate.selectedFieldIds.indexOf(fcId)?(duplicateErrRef.length>0&&duplicateErrRef.pop(labelName+index),zpMassUpdate.selectedFieldIds.push(fcId)):(duplicateErrRef.push(labelName+index),ZPSetupCommon.showErr(ZPI18N.getString("zp.duplicatefield"),fieldSelBox.parent(),"dverrormsg"))}}),0===errorRef.length&&0===duplicateErrRef.length?(params.isPicklistIdEnabled=!0,ZPeople.Request.send("/massUpdate.zp",params,zpMassUpdate.handleResponseOfBulkUpdate)):$(obj).removeClass("disabled")},getPkIds:function(){var pageId=Layout.Page.container,pkIds=[];return Layout.Page.container.find("table#userListTable").length>0?(userTableElm=pageId.find("table#userListTable"),$.each(userTableElm.find("input[name='userRowCheck']:checked"),function(index,obj){pkIds[index]=$(obj).closest("tr").attr("emperecno")})):Layout.Page.hash.indexOf("cportal")>-1?(userTableElm=pageId.find("table#candidateListTable"),$.each(userTableElm.find("input[name='userRowCheck']:checked"),function(index,obj){pkIds[index]=$(obj).closest("tr").attr("candidateid")})):Layout.Page.hash.indexOf("performance/salary/employeesalary")>-1&&ZPView.isSystemView()?(pkIds=Appraisal.Salary.employeeArr.slice(0,Appraisal.Salary.employeeArr.length),userTableElm=null):(userTableElm=pageId.find("table#zp_views_records_table:visible"),$.each(userTableElm.find("tbody input#zp_view_sel_record:checked"),function(index,obj){pkIds[index]=$(this).parents("[recordid]").attr("recordid")})),{userTableElm:userTableElm,pkIds:pkIds}},updateFields:function(obj){var pageId=Layout.Page.container,fcIds=[];if($.each(pageId.find("select[name='fieldsSelBox']"),function(index,fields){fcIds[index]=$(fields).val()}),ZPForm.isAllowedToEdit(fcIds,!0)){var key="zp.editapprovalconfirmmsg";ZPForm.CONF.approvalSettingsDetails.isVerifySend&&(key="zp.editapprsendconfirmmsg"),ZPeople.BSModal.confirm(zpMassUpdate.update,ZPI18N.getString("zp.confirm"),ZPI18N.getString(key))}else zpMassUpdate.update(obj)},handleResponseOfBulkUpdate:function(resultObj,paramsObj){var pageId=Layout.Page.container,massUpdateElmId=pageId.find("div#massUpdatePopup");if(resultObj.isSuccess){if("EMPERRORS"===resultObj.errorType)resultObj.hasOwnProperty("activeUserList")?ZPeople.Message.showFailureMsg(resultObj.activeUserList.message):resultObj.hasOwnProperty("closedUserList")?ZPeople.Message.showFailureMsg(resultObj.closedUserList.message):resultObj.hasOwnProperty("dwngrdUserList")?ZPeople.Message.showFailureMsg(resultObj.dwngrdUserList.message):resultObj.hasOwnProperty("invitationInactive")?ZPeople.Message.showFailureMsg(resultObj.invitationInactive.message):resultObj.hasOwnProperty("dupMailIdList")&&ZPeople.Message.showFailureMsg(resultObj.dupMailIdList.message);else{if(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.success")),pageId.find("div#zp_view_close_selection").click(),pageId.find("div#massUpdatePopup").modal("hide"),zpMassUpdate.isUser&&Layout.Page.pageId.includes("admin-employeerecords")){var currMode=Layout.Page.currentmode.split("/")[2];if(paramsObj.hasOwnProperty("Employeestatus")){if("All Status"!=Layout.Page.container.find("#empStatusDtls").val()&&(User.variables[currMode].filterParams.searchByEmpStatus="user"==currMode?paramsObj.Employeestatus:"All Status"),"All Status"!=Layout.Page.container.find("#accStatusDtls").val()){var optionsWithId=null,fcIds=JSON.parse(paramsObj.fcIds);for(var i in fcIds){var fieldComponent=ZPForm.Field.getFieldComponent(fcIds[i]);if("Employeestatus"==fieldComponent.labelName){optionsWithId=fieldComponent.OptionsWithId;break}}var sysVal=null;for(var i in optionsWithId)if(optionsWithId[i].Value==paramsObj.Employeestatus){sysVal=optionsWithId[i].SysValue;break}User.variables[currMode].filterParams.userStatus=User.statusBasedOnSysVal(sysVal)}}else paramsObj.hasOwnProperty("LocationName")&&"0"!=Layout.Page.container.find("#locationsDtls").val()?User.variables[currMode].filterParams.searchByLoc=paramsObj.LocationName:paramsObj.hasOwnProperty("Role")&&"0"!=Layout.Page.container.find("#rolesDtls").val()?User.variables[currMode].filterParams.searchByRole=paramsObj.Role:paramsObj.hasOwnProperty("Department")&&"0"!=Layout.Page.container.find("#deptDtls").val()&&(User.variables[currMode].filterParams.searchByDept=paramsObj.Department);User.variables[currMode].reload=!0,Layout.Page.container.find("div#close_user_options").click(),User.ListUsers.usersListPageInit()}else Layout.Page.hash.indexOf("cportal")>-1?CPortal.User.getUserList():Layout.Page.hash.indexOf("performance/salary/employeesalary")>-1&&ZPView.isSystemView()?(Appraisal.Salary.refreshData=!0,Appraisal.Salary.salaryConstructStart()):ZPView.refresh(!0);var pkIds=resultObj.modifiedPkIds;$.each(pkIds,function(index,val){ZPForm.SINGLE_RECORD_DTL[paramsObj.formid+"_"+index]=void 0,ZPForm.CONF.approvalSettingsDetails.isVerifySend&&ZPApprovals.APPROVAL_DETAILS[index]&&delete ZPApprovals.APPROVAL_DETAILS[index]})}"P_Goals"===ZPForm.getTableName()&&(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.success")),pageId.find("div#massUpdatePopup").modal("hide"))}else{if(resultObj.isLicenseCountExceeded){var errMsg=ZPI18N.getString("zp.licensecountexceeded");ZPeople.Message.showFailureMsg(errMsg)}else{if("VALIDATION"===resultObj.errorType)massUpdateElmId.find("td").removeClass("has-error"),$.each(resultObj.errors,function(labelName,errObj){var errorAppendElm,appendHere=massUpdateElmId.find("#editable"+labelName),fieldType=appendHere.attr("fieldType");$(appendHere).parent().addClass("has-error"),errorAppendElm=fieldType==DATE||fieldType==DATE_TIME?$(appendHere).parent():$(appendHere).closest("td#firstEdtbox");var msg=errObj.message;6919===errObj.code&&(resultObj.isSuperAdmin?msg+=ZPI18N.getString("zp.reports.linktochangeanalyticsdbowner",new Array(window.location.href.split("#")[0]+"#reports/analytics/listReport")):msg+=ZPI18N.getString("zp.reports.contactsuperadmin")),ZPSetupCommon.showErr(msg,errorAppendElm,"dverrormsg")});else if("EMPERRORS"===resultObj.errorType)resultObj.hasOwnProperty("activeUserList")?ZPeople.Message.showFailureMsg(resultObj.activeUserList.message):resultObj.hasOwnProperty("closedUserList")?ZPeople.Message.showFailureMsg(resultObj.closedUserList.message):resultObj.hasOwnProperty("dwngrdUserList")?ZPeople.Message.showFailureMsg(resultObj.dwngrdUserList.message):resultObj.hasOwnProperty("invitationInactive")?ZPeople.Message.showFailureMsg(resultObj.invitationInactive.message):resultObj.hasOwnProperty("dupMailIdList")&&ZPeople.Message.showFailureMsg(resultObj.dupMailIdList.message);else if(7031==resultObj.code)ZPeople.Message.showFailureMsg(resultObj.message);else if("CUSTOMVALIDATIONFAILED"===resultObj.errorType)for(var resutarr=resultObj.errormessage,i=0;resutarr.length>i;i++){var tbodytr=jQuery("<tr />",{class:"ZPLRow"}),recordId=resutarr[i].recordId,message=resutarr[i].message;tbodytr.append(jQuery("<td />").append("<a href='#form/view-formId:"+Layout.Page.urlparam.formId+"/recordId:"+recordId+"' target='_blank'>"+ZPI18N.getString("zp.viewRecord")+"</a>"));for(var td=jQuery("<td />"),keys=Object.keys(message),j=0;j<keys.length;j++){var errObj=message[keys[j]];td.append(ZPeople.decodeTxt(errObj)+"<br><br>")}tbodytr.append(td),massUpdateElmId.find("#errormsg").find("#tablebody").html(tbodytr),massUpdateElmId.find("#errormsg").show()}else if("GOALVALIDATIONFAILED"===resultObj.errorType){pageId.find("#errormsg").hide();resutarr=resultObj.errormessage;massUpdateElmId.find("#errormsg").find("#tablebody").html("");for(i=0;resutarr.length>i;i++){tbodytr=jQuery("<tr />",{class:"ZPLRow"}),recordId=resutarr[i].recordId,message=resutarr[i].message;tbodytr.append(jQuery("<td />").append("<a href='#form/view-formId:"+Layout.Page.urlparam.formId+"/recordId:"+recordId+"' target='_blank'>"+ZPI18N.getString("zp.viewRecord")+"</a>"));for(td=jQuery("<td />"),keys=Object.keys(message),j=0;j<keys.length;j++){errObj=message[keys[j]];td.append(errObj+"<br><br>")}tbodytr.append(td),massUpdateElmId.find("#errormsg").find("#tablebody").append(tbodytr),massUpdateElmId.find("#errormsg").show()}var txt='<button type="button" class="btn btn-default" data-dismiss="modal">'+ZPI18N.getString("zp.close")+"</button>";pageId.find("div.modal-footer").html(txt)}else ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.success")),pageId.find("div#massUpdatePopup").modal("hide");if(resultObj.isSuperAdminChange){var errMap=resultObj.errorMap;ZPSetupCommon.showErr(errMap.message,massUpdateElmId.find("#editable"+errMap.labelName).closest("td#firstEdtbox"),"dverrormsg")}}massUpdateElmId.find("#saveUpdate").removeClass("disabled")}},findFCData:function(formId,fcId){var fldDtls={};return $.each(ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails,function(){var column1=this.column1;for(field in column1)if(column1[field].formComponentId==fcId)return fldDtls=column1[field],!1;var column2=this.column2;for(field in column2)if(column2[field].formComponentId==fcId)return fldDtls=column2[field],!1}),fldDtls}};zpMassUpdate.select2={OPTIONS:{},ALL_OPTIONS:{},getSelect2Properties:function(prop){return{formatNoMatches:function(){return ZPI18N.getString("zp.nomatchesfound")},formatSearching:function(){return ZPI18N.getString("zp.searching")},multiple:prop&&prop.multi,query:function(query){var results=[],term=query.term,fcid=$(query.element).attr("fcid"),key=fcid;results.push({id:"-Select-",text:"-Select-"});var fieldProps=zpMassUpdate.findFCData(zpMassUpdate.formId,fcid);if(fieldProps.dependentFiledList&&fieldProps.dependentFiledList.length>0){var fieldValues=zpMassUpdate.getFieldValuesForSearch(fcid,fieldProps.dependentFiledList);key+=JSON.stringify(fieldValues)}if(void 0==zpMassUpdate.select2.OPTIONS[key]&&(zpMassUpdate.select2.OPTIONS[key]={}),prop&&prop.isFieldList)results=zpMassUpdate.constructselectBoxForEditBulkUpd(zpMassUpdate.fieldDetails.sections,term);else if(zpMassUpdate.select2.OPTIONS[key][term]&&0==zpMassUpdate.select2.OPTIONS[key][term].length)!1;else{if(!(zpMassUpdate.select2.OPTIONS[key][term]&&zpMassUpdate.select2.OPTIONS[key][term].length>0&&zpMassUpdate.select2.OPTIONS[key][term].length>200*(query.page-1)))return void(results=zpMassUpdate.select2.getOptions(fcid,term,query.page,query.callback,prop));for(i=200*(query.page-1);i<200*query.page&&i<zpMassUpdate.select2.OPTIONS[key][term].length;i++)-1==$.inArray(zpMassUpdate.select2.OPTIONS[key][term][i],results)&&results.push(zpMassUpdate.select2.OPTIONS[key][term][i]);!1}query.callback({results:results,more:results.length>=200})},initSelection:function(element,callback){var results=[];results={id:"-Select-",text:"-Select-"},prop&&prop.initseljson&&(results=prop.initseljson),callback(results)}}},getOptions:function(fcid,term,page,successcallback,prop){fields=[fcid];var baseFormId=zpMassUpdate.formId,fieldProps=zpMassUpdate.findFCData(zpMassUpdate.formId,fcid),params={mode:"fetchFormLookupOtions",luFcIds:JSON.stringify(fields),formId:baseFormId};"P_Timesheet"===ZPForm.getTableName()&&(params.selUser=null===Timetracker.timelogs.tserecno||void 0===Timetracker.timelogs.tserecno?ZPeople.CURR_USER.usererec:Timetracker.timelogs.tserecno),"P_PerformanceAppraisal"===ZPForm.getTableName()&&(params.configId=Layout.Page.urlparam.configId),params.searchtxt=term,params.startInd=200*(page-1)+1,params.conreqcsr=csrfToken,params.isfilternotneeded=!1,url=ZPForm.URL;var results=[],key=fcid;if(fieldProps.dependentFiledList&&fieldProps.dependentFiledList.length>0){var fieldValues=zpMassUpdate.getFieldValuesForSearch(fcid,fieldProps.dependentFiledList);jQuery.isEmptyObject(fieldValues)||(params.fieldValues=JSON.stringify(fieldValues)),key+=params.fieldValues}return $.ajax({type:"POST",async:!0,url:url,data:params,success:function(data){data.code==zpconst.ResponseCodes.API_ERR_NO_ERROR&&data.message&&data.message[fcid]&&(results.push({id:"-Select-",text:"-Select-"}),$.each(data.message[fcid],function(ind,val){results.push({id:val.Id,text:ZPeople.decodeTxt(val.Value)}),ZPView.select2.ALL_OPTIONS[fcid+"_"+val.Value]=val.Id})),zpMassUpdate.select2.OPTIONS[key][term]||(zpMassUpdate.select2.OPTIONS[key][term]=[]),$.each(results,function(ind,value){"-Select-"!=value.id&&zpMassUpdate.select2.OPTIONS[key][term].push(value)}),successcallback({results:results,more:results.length>=200})}}),results}},zpMassUpdate.getFieldValuesForSearch=function(fcId,dependentFieldList){var fieldValues={},pageId=Layout.Page.container;return $.each(dependentFieldList,function(key,value){$(pageId).find("td[id=firstEdtbox]").each(function(){if($(this).find("input[fcid="+value+"]").length>0){var selectedValue=$(this).find("input[fcid="+value+"]").val();fieldValues[value]=selectedValue}})}),fieldValues},zpMassUpdate.getAddedFieldList=function(){var addedFieldList=[],ele=Layout.Page.container.find("table#bulkUpdFieldsTable tbody");return $(ele).children("tr[name='bulkRows']").each(function(){var currFcid=$(this).find("#firstFieldSelBox").val();addedFieldList.push(currFcid)}),addedFieldList},zpMassUpdate.getInitElementHtml=function(editFieldsObj){var initialElm="";return initialElm+="<tr id=field_"+zpMassUpdate.fieldCount+' name = "bulkRows">',initialElm+="<td></td>",initialElm+='<td><input type="text"  id="firstFieldSelBox" onchange="zpMassUpdate.getFcDtlsWhenFieldChange(this)" ></td>',initialElm+='<td id="firstEdtbox"></td><td></td></tr>',editFieldsObj.length>1&&0==Layout.Page.container.find("tr[name=addnewlink]").length&&(initialElm+=zpMassUpdate.addLinkHtml),initialElm},zpMassUpdate.handleRemoveField=function(ele){var fieldElement=$(ele).closest("tr"),obj=$(fieldElement).find("#firstEdtbox"),fcid=obj.find("input[id^=editable]").attr("fcid"),fieldType=obj.find("input[id^=editable]").attr("fieldType");ZPUtil.Validation.isEmpty(fcid)&&(fcid=obj.find("select[id^=editable]").attr("fcid"),ZPUtil.Validation.isEmpty(fcid)&&(fcid=obj.find("textarea[id^=editable]").attr("fcid")));var fcDetails=zpMassUpdate.findFCData(zpMassUpdate.formId,fcid),fcidsToRemove=[];void 0!=fcDetails.dependentFiledList&&fcDetails.dependentFiledList.length>0&&(fcidsToRemove=fcDetails.dependentFiledList),ZPForm.Field.Edit.getDependFieldMappingFields(fcid,fcidsToRemove),fcidsToRemove.push(fcid);for(var i=0;i<fcidsToRemove.length;i++){var fieldObj=Layout.Page.container.find("td[id=firstEdtbox]");fcidsToRemove[i]==fcid?fieldType==DATE||fieldType==DATE_TIME?fieldObj.find("input[fcid="+fcid+"]").parent().parent().parent().remove():(fieldObj.find("input[fcid="+fcid+"]").parent().parent().remove(),fieldObj.find("select[fcid="+fcid+"]").parent().parent().remove(),fieldObj.find("textarea[fcid="+fcid+"]").parent().parent().remove()):fieldObj.find("input[fcid="+fcidsToRemove[i]+"]").parent().parent().remove()}0==Layout.Page.container.find("table#bulkUpdFieldsTable tbody").find("#addnewLnk").length&&Layout.Page.container.find("table#bulkUpdFieldsTable tbody").append(zpMassUpdate.addLinkHtml)};var ZPNewView={};ZPNewView={allComponents:{},crtSelectionRecords:{},crtSelectedRecords:{},criteriaCnt:null,fieldOptionConstruction:null,leftSideSelected:null,rightSideSelected:null,leftColumns:null,rightColumns:null,savedComponents:null,LAYOUT:null,INPUT_DROPDOWN:null,LASTVIEWID:null,localValues:null,headerComponents:null,mouseDownFlag:!1,childSelectFlag:!1,removeAscDescFlag:!1,removeGrpFlag:!1,removeSumFlag:!1,pickListComponent:null,isCustomView:!0,allCmpName:null,formName:null,isEdit:!1,formId:null,fieldListCloneDom:{},OPERATORS:{EQUAL:18,NOT_EQUAL:19,LESS_THAN:20,GREATER_THAN:21,LESS_EQUAL:22,GREATER_EQUAL:23,STARTS_WITH:24,ENDS_WITH:25,CONTAINS:26,NOT_CONTAINS:27,EMPTY:29,NOT_EMPTY:30,YESTERDAY:31,TODAY:32,TOMORROW:33,IN:61,NOT_IN:62,LAST_MONTH:44,THIS_MONTH:45,NEXT_MONTH:46,TRUE:49,FALSE:50,LAST_YEAR:51,NEXT_YEAR:53,CURRENT_YEAR:52,LOGIN_USERS_DEPT:63,LOGIN_USER:64,LAST_WEEK:65,THIS_WEEK:66,NEXT_WEEK:67,LOGIN_USERS_DESIG:68,ONLY_PARTICULAR_MONTH:69,LOGIN_USERS_ENTITY:70,LOGIN_USERS_UNIT:71,LOGIN_USERS_DIVISION:72,SUBORDINATES_GOAL:73},init:function(){ZPNewView.isCrtPropagationInit||($(document).on("click",'[isviewcrt="true"]',function(e){e.stopPropagation();var obj=$(e.target);"true"==obj.attr("isCrtFld")&&ZPNewView.fieldChange(obj)}),ZPNewView.isCrtPropagationInit=!0),ZPNewView.LAYOUT=$("<div class='PL30 PR30'><form style='width:70%;' class='form-horizontal pad' role='form'><div id='viewNameSection' class='form-group'><label class='control-label col-sm-3'>"+ZPI18N.getString("zp.specifyviewname")+"</label><div class='col-sm-6'><input type='name' placeholder='"+ZPI18N.getString("zp.enterviewname")+"' class='form-control' id='zp_custom_view_name'><span id='zp_custom_view_name_error' class='error-msg'></span></div></div><div id='defaultViewSection' class='form-group'><div id='defaultViewSection' class='col-sm-6 col-sm-offset-3'><label class='checkbox DIB'><input id='zp_custom_view_default' type='checkbox'><span class='ML2'>"+ZPI18N.getString("zp.setdefaultview")+"</span></label></div></div><div id='view_approval_section' class='form-group'><div class='col-sm-6 col-sm-offset-3'><label class='checkbox DIB'><input id='zp_custom_view_approval' type='checkbox'><span class='ML2'>"+ZPI18N.getString("zp.showApproverDetails")+"</span></label></div></div><div id='viewPremissionSection' class='form-group'><label class='control-label col-sm-3'>"+ZPI18N.getString("zp.viewPerm")+"</label><div class='col-sm-9'><div><label class='radio DIB'><input id='zp_custom_view_only_me' type='radio' name='view' onClick='ZPNewView.sharedTo()' checked><span class='ML2'>"+ZPI18N.getString("zp.onlytome")+"</span></label></div><div class='MT10'><label class='radio DIB'><input id='zp_custom_view_all_employees' type='radio' name='view' onClick='ZPNewView.sharedTo()'><span class='ML2'>"+ZPI18N.getString("zp.allowallemployeetoaccess")+"</span></label></div><div class='MT10'><label class='radio DIB'><input id='zp_custom_view_selected_users' type='radio' name='view' onClick='ZPNewView.sharedTo()'><span class='ML2'>"+ZPI18N.getString("zp.specificuser")+"</span></label></div></div></div><div class='form-group DN' id='zp_custom_view_sharedto'><label class='control-label col-sm-3'>"+ZPI18N.getString("zp.sharedto",new Array(""))+"</label><div id='applicableToComponent' class='col-sm-6'></div></div></form><h5>"+ZPI18N.getString("zp.selectcolumns")+"</h5><div class='row MB20'><div class='col-md-5'><div class='ZPSCdiv'><ul id='zp_custom_view_left_columns' class='list-group'></ul></div></div><div class='col-md-1 MT80'><div class='ZPCVatn'><div class='IC-ar-lft-2 blu S16 CP' onClick='ZPNewView.moveAllLeftToRight()'></div></div><div class='ZPCVatn'><div class='IC-ar-rgt blu S16 CP' onClick='ZPNewView.moveSelectedRowToRight()'></div></div><div class='ZPCVatn'><div class='IC-ar-lft blu S16 CP' onClick='ZPNewView.moveSelectedRowToLeft()'></div></div><div class='ZPCVatn'><div class='IC-ar-rgt-2 blu S16 CP' onClick='ZPNewView.moveAllRightToLeft()'></div></div></div><div class='col-md-6'><div class='ZPSCdiv' id='zp_rightSide'><ul id='zp_custom_view_right_columns' class='list-group'></ul></div><span class='error-msg DN' id='zp_right_column_error'></span></div></div><h5 id='criteriaHeader'>"+ZPI18N.getString("zp.criteria")+"</h5><div id='criteriaSection' style='border-top:1px solid #e9edf3;' class='outcontainer'><table class='table table-hover'><thead><tr><th width='100'>"+ZPI18N.getString("zp.andor")+"</th><th width='200'>"+ZPI18N.getString("zp.fieldname")+"</th><th width='180'>"+ZPI18N.getString("zp.condition")+"</th><th width='300'>"+ZPI18N.getString("zp.value")+"</th><th width='20'></th><th width='100'></th></tr></thead><tbody id='zp_custom_view_criteria_table_body'></tbody></table><span id='zp_criteria_error' class='error-msg'></div></div>"),ZPNewView.criteriaCnt=0,ZPNewView.fieldOptionConstruction=null,ZPNewView.leftSideSelected={},ZPNewView.rightSideSelected={},ZPNewView.leftColumns={},ZPNewView.rightColumns={},ZPNewView.allCmpName={},ZPNewView.savedComponents=null,ZPNewView.localValues={},ZPNewView.headerComponents={},ZPNewView.pickListComponent=null,ZPNewView.formName=null,ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").children().remove(),ZPNewView.FIELDS_DROP_DOWN=null,ZPNewView.formId=ZPView.CURR_VIEWPARAMS.formId,ZPNewView.INPUT_DROPDOWN="<td id='lookupIcon' class='dropup PL0I'><i id='zp_crt_input_dropdown' class='IC-addlist S18 FL MT5 gry CP DN' data-toggle='dropdown' aria-expanded='false'></i><div id='crtDropdownSelection' class='dropdown-menu ZPCusPd ZPappBox ZptxtBox  ZPCmn-Arrow bottom rt gray'><div class='ZPTabVt'><div class='rhttabscrl'><div class='tab-content'><div class='tab-pane active' role='tabpanel'><div><div class='ZPtopSearch'><label class='checkbox DIB FL PT8 MR10'><input id='crtAllCheck' type='checkbox' onclick='ZPNewView.crtAllCheckSelect(this)'><span></span></label><div class='ZPsearch' id='ZPsearch'><div class='dvsearch Dropdown PR'><span class='ZPico-search FL MT2 ML8 ZPtooltip IC-lens S16' zptitle='Search Category'></span></div><input type='search' class='ZPselect' id='crtRecordSearch' placeholder='"+ZPI18N.getString("zp.search")+"' value='' name='Search'></div></div><div class='ZPapplCb'><ul id='ulList'></ul></div></div></div></div></div></div></div></td>"},createView:function(){$(".select2-dropdown-open").select2("close");var formID=ZPView.CURR_VIEWPARAMS.formId;ZPNewView.LASTVIEWID=ZPView.CURR_VIEWPARAMS.viewId,window.location.href="#"+Layout.UrlConf.getFormActionURL("createview")+"-formId:"+formID},editView:function(){var formID=ZPView.CURR_VIEWPARAMS.formId;ZPNewView.LASTVIEWID=ZPView.CURR_VIEWPARAMS.viewId,window.location.href="#"+Layout.UrlConf.getFormActionURL("editview")+"-formId:"+formID+"/viewId:"+ZPNewView.LASTVIEWID},showDelete:function(){ZPeople.BSModal.setup({id:"zp_modal_confirmpop",type:3,iconClass:"IC-alert",iconParenClass:"orgbgi",header:ZPI18N.getString("zp.zpalert"),body:ZPI18N.getString("zp.deleteconfirmmessage"),deleteOnHide:!0,closeOnSubmit:!0,buttonValue:ZPI18N.getString("zp.confirm"),successCallback:ZPNewView.deleteView})},deleteView:function(){var params={mode:"deleteView",formID:ZPView.CURR_VIEWPARAMS.formId,viewID:ZPView.CURR_VIEWPARAMS.viewId};ZPeople.Request.send("/createViewAction.zp",params,ZPNewView.afterDeleteAction)},getCreateViewPage:function(){ZPeople.BSModal.setup({id:"zp_createview",type:2,modalClass:"popRgtModel PopLgModel",header:ZPI18N.getString("zp.createview"),body:ZPeople.LOADING_HTML,buttonValue:ZPI18N.getString("zp.save"),hiddenCallback:ZPNewView.closeCallback,successCallback:ZPNewView.saveAction});var params={mode:"newView",formID:ZPView.CURR_VIEWPARAMS.formId};ZPeople.Request.send("/createViewAction.zp",params,ZPNewView.constructCreateViewPage)},getEditViewPage:function(){ZPeople.BSModal.setup({id:"zp_editview",type:2,modalClass:"popRgtModel PopLgModel",header:ZPI18N.getString("zp.editview"),body:ZPeople.LOADING_HTML,buttonValue:ZPI18N.getString("zp.save"),hiddenCallback:ZPNewView.closeCallback,successCallback:ZPNewView.updateAction});var formID=ZPView.CURR_VIEWPARAMS.formId;ZPNewView.LASTVIEWID=ZPView.CURR_VIEWPARAMS.viewId,void 0===ZPNewView.LASTVIEWID&&(ZPNewView.LASTVIEWID=Layout.Page.childUrlParam.viewId);var params={mode:"getViewDetails",formID:formID,viewID:ZPNewView.LASTVIEWID};ZPeople.Request.send("/createViewAction.zp",params,ZPNewView.constructEditViewPage)},constructCreateViewPage:function(data){if(void 0===data.error){ZPNewView.isEdit=!1,ZPNewView.allComponents=data.formDetailsMap,ZPNewView.init(),ZPNewView.FORM_NAME=data.formName,ZPNewView.isCustomView=!0,$.each(ZPNewView.allComponents,function(key,value){if(void 0!==value.childComponents&&Object.keys(value.childComponents).length>0){var tempObj={formCompID:value.formCompID,childComponents:value.childComponents,formCompName:value.formCompName};ZPNewView.headerComponents[value.formCompID+""]=tempObj}}),ZPNewView.initLeftColumns(),ZPNewView.initRightColumns();var curr_criteria_id=ZPNewView.addCriteria();ZPNewView.defaultActions(),ZPNewView.fieldOptionPopOverInit(curr_criteria_id),Layout.UrlConf.isModuleForm()&&ZPNewView.LAYOUT.find("#defaultViewSection").remove(),ZPForm.isApprovalEnabled()||ZPNewView.LAYOUT.find("#view_approval_section").remove();var mdata=ZPeople.Module.getData();mdata.isAdmin&&!mdata.viewDetails.isLocAdmin&&"P_MultiRater"!=ZPForm.getTableName()&&"P_MultiRater_Approval"!=ZPForm.getTableName()&&"P_Goals"!=ZPForm.getTableName()||ZPNewView.LAYOUT.find("#viewPremissionSection,#zp_custom_view_sharedto").remove(),Layout.Page.container.find("#zp_createview").find(".modal-body").html(ZPNewView.LAYOUT),Layout.Page.container.find("#zp_custom_view_name").trigger("focus"),Layout.Page.container.find(".modal-footer").find("#zp_modal_blubtn").prop("disabled",!1)}else void 0!==data.error.message?Layout.Page.container.find("#zp_createview").find(".modal-body").html("<p class='errorDiv'><b>"+data.error.message+"</b></p>"):void 0!==data.error.exception&&(Layout.Page.container.find("#zp_createview").find(".modal-body").html("<p class='errorDiv'><b>"+ZPI18N.getString("zp.erroroccurredloadingpage")+"</b></p>"),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.erroroccurredloadingpage")))},constructEditViewPage:function(data){if(void 0===data.error){ZPNewView.isEdit=!0;var viewDetails=data.viewDetails;ZPNewView.isCustomView=viewDetails.isCustomView;var viewObj=ZPNewView.getViewDetailByID(viewDetails.viewID);if(void 0!==viewObj&&(""===viewObj.ownerId||viewObj.ownerId.length<=0)&&(ZPNewView.isCustomView=!1),ZPNewView.allComponents=viewDetails.formDetailsMap,ZPNewView.init(),ZPNewView.FORM_NAME=viewDetails.formName,$.each(ZPNewView.allComponents,function(key,value){if(void 0!==value.childComponents&&Object.keys(value.childComponents).length>0){var tempObj={formCompID:value.formCompID,childComponents:value.childComponents,formCompName:value.formCompName};ZPNewView.headerComponents[value.formCompID+""]=tempObj}}),ZPNewView.LAYOUT.find("#zp_custom_view_name").val(viewDetails.viewName),ZPNewView.localValues.viewID=viewDetails.viewID,ZPNewView.localValues.expressionID=void 0===viewDetails.expressionID?0:viewDetails.expressionID,ZPNewView.localValues.reportPermissionID=0,ZPForm.isApprovalEnabled()||ZPNewView.LAYOUT.find("#view_approval_section").remove(),ZPNewView.LAYOUT.find("#zp_custom_view_approval").attr("checked",viewDetails.show_approver),ZPNewView.isCustomView){if(Layout.UrlConf.isModuleForm()&&ZPNewView.LAYOUT.find("#defaultViewSection").remove(),viewDetails.isDefaultView&&ZPNewView.LAYOUT.find("#zp_custom_view_default").attr("checked",!0),viewDetails.shareViewToAll)ZPNewView.LAYOUT.find("#zp_custom_view_all_employees").attr("checked",!0);else if(!viewDetails.shareViewToAll){var reportPermissionID=viewDetails.reportPermissionID;if(void 0!==reportPermissionID&&"0"!==reportPermissionID){ZPNewView.LAYOUT.find("#zp_custom_view_selected_users").attr("checked",!0),ZPNewView.sharedTo(),ZPNewView.localValues.reportPermissionID=reportPermissionID;var reportPermissionData=viewDetails.reportPermissionData;Object.keys(reportPermissionData).length>0&&null!==ZPNewView.pickListComponent&&(ZPPickList.setSelectedUsers(reportPermissionData.empList),ZPPickList.setSelectedDepartments(reportPermissionData.deptList),ZPPickList.setSelectedRoles(reportPermissionData.roleList),ZPPickList.setSelectedLocations(reportPermissionData.locList))}else ZPNewView.LAYOUT.find("#zp_custom_view_only_me").attr("checked",!0)}var savedCriteria=viewDetails.criteria,tempCnt=0;if(0!==Object.keys(savedCriteria).length&&$.each(savedCriteria,function(key,value){var fcID=value.formComponentID,lkFcid=value.lookupFcId,obj=ZPNewView.allComponents[fcID];if(void 0==obj)return!0;var fc=fcID,pfcid=-1;if(void 0!=lkFcid&&!value.isBaseForm){if(void 0==(obj=obj.childComponents[lkFcid]))return!0;pfcid=fcID,fc=lkFcid}var curr_criteria_id=ZPNewView.addCriteria();0!==tempCnt&&ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#operatorSelection").select2("val",value.conjunctiveCondn),ZPNewView.fiedpopoverclback(ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#fieldOpetions"),pfcid,fc,!0),ZPNewView.fieldOptionPopOverInit(curr_criteria_id);var operator=value.Operator;ZPeople.decodeTxt(value.CrtVal);0==ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").find("option[value="+operator+"]").length&&ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").append("<option value='"+operator+"'>"+LookupFilterRule.OPERATORS[operator]+"</option>"),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").select2("val",operator),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").trigger("change");var fcType=obj.fcType;if(fcType!=ZPForm.Field.LOOKUP&&fcType!=ZPForm.Field.PICKLIST&&fcType!=ZPForm.Field.NEW_GENDER&&fcType!=ZPForm.Field.NEW_BLOODGROUP&&fcType!=ZPForm.Field.NEW_COUNTRY||operator!=ZPNewView.OPERATORS.IN&&operator!=ZPNewView.OPERATORS.NOT_IN)ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#txtValue").val(ZPeople.decodeTxt(value.CrtVal));else{ZPNewView.loadCrtRequiredRecords(fc,fcType);var fcRecords1=ZPNewView.crtSelectionRecords[fc];if(void 0!==fcRecords1&&Object.keys(fcRecords1).length>0){var fcRecords=JSON.parse(JSON.stringify(fcRecords1));"";var values=JSON.parse(value.CrtVal),selectedRecords=ZPNewView.crtSelectedRecords[curr_criteria_id];void 0===selectedRecords&&(selectedRecords=[]);var selVals=[];$.each(values,function(key,value){$.each(fcRecords,function(k,v){(value==v.VALUE&&!v.isChecked||value==v.ID)&&(selectedRecords.push(v.ID+""),v.isChecked=!0,selVals.push(ZPeople.decodeTxt(v.DISPVALUE)))})}),ZPNewView.crtSelectedRecords[curr_criteria_id]=selectedRecords,ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#txtValue").val(selVals.toString())}}Timetracker.views.isTimetrackerSpecialFields(obj.tName,obj.labelName)&&ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").select2("val",Timetracker.views.getDefaultValueForSearch(obj.labelName,value)).trigger("change"),tempCnt++}),0==tempCnt){var curr_criteria_id=ZPNewView.addCriteria();ZPNewView.fieldOptionPopOverInit(curr_criteria_id)}}else ZPNewView.LAYOUT.find("#defaultViewSection,#viewPremissionSection,#criteriaHeader,#criteriaSection,#zp_custom_view_sharedto").remove();var selectedComps=viewDetails.components;0!==Object.keys(selectedComps).length&&(ZPNewView.savedComponents=selectedComps,ZPNewView.constructSelectedRightColumn()),ZPNewView.initLeftColumns(),ZPNewView.defaultActions();var mdata=ZPeople.Module.getData();mdata.isAdmin&&!mdata.viewDetails.isLocAdmin&&"P_MultiRater"!=ZPForm.getTableName()&&"P_MultiRater_Approval"!=ZPForm.getTableName()&&"P_Goals"!=ZPForm.getTableName()||ZPNewView.LAYOUT.find("#viewPremissionSection,#zp_custom_view_sharedto").remove(),Layout.Page.container.find("#zp_editview").find(".modal-body").html(ZPNewView.LAYOUT),Layout.Page.container.find(".modal-footer").find("#zp_modal_blubtn").prop("disabled",!1)}else void 0!==data.error.message?Layout.Page.container.find("#zp_editview").find(".modal-body").html("<p class='errorDiv style=''><b>"+data.error.message+"</b></p>"):void 0!==data.error.exception&&(Layout.Page.container.find("#zp_editview").find(".modal-body").html("<p class='errorDiv style=''><b>"+ZPI18N.getString("zp.erroroccurredloadingpage")+"</b></p>"),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.erroroccurredloadingpage")))},defaultActions:function(){Layout.Page.container.find(".modal-body").scrollTop(0),$(document).on("show.bs.dropdown","#lookupIcon",function(event){var inp=$(event.target).parent().find('[iscrtfc="true"]'),pfcid=inp.attr("pfcid"),fcid=inp.attr("fcid"),fcObj=ZPNewView.allComponents[fcid+""];-1!=pfcid&&(fcObj=ZPNewView.allComponents[pfcid+""].childComponents[fcid+""]);var fcType=fcObj.fcType;ZPNewView.loadCrtRequiredRecords(fcid,fcType);var crtID=$(event.target).parent().attr("id");ZPNewView.constructCrtSelectionRecord(crtID,ZPNewView.crtSelectionRecords[fcid],fcType,fcid),void 0!==ZPNewView.crtSelectedRecords[crtID]&&ZPNewView.makeSelectable(crtID,ZPNewView.crtSelectedRecords[crtID]),ZPNewView.LAYOUT.find("#crtRecordSearch").val("")}),$(document).on("keyup","#crtRecordSearch",function(e){var tr=$(this).parent().parent().parent().parent().parent().parent().parent().parent().parent().parent(),fcID=$(tr).find('[iscrtfc="true"]').attr("fcid"),currRecords=ZPNewView.crtSelectionRecords[fcID];if(!(Object.keys(currRecords).length<=0)){var crtID=$(tr).attr("id"),searchStr=$(this).val().trim();if(searchStr.length<=0)return ZPNewView.constructCrtSelectionRecord(crtID,currRecords),void(void 0!==ZPNewView.crtSelectedRecords[crtID]&&ZPNewView.makeSelectable(crtID,ZPNewView.crtSelectedRecords[crtID]));searchStr=searchStr.toLowerCase();var tempList=[];$.each(currRecords,function(key,value){-1!==value.DISPVALUE.toLowerCase().indexOf(searchStr)&&tempList.push(value)}),ZPNewView.constructCrtSelectionRecord(crtID,tempList),void 0!==ZPNewView.crtSelectedRecords[crtID]&&ZPNewView.makeSelectable(crtID,ZPNewView.crtSelectedRecords[crtID])}}),$(document).on("click","#crtDropdownSelection",function(e){$(this).hasClass("ZPCusPd")&&e.stopPropagation()}),ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").sortable({start:function(event,ui){$(ui.item).find("#parentCompDiv").addClass("drag")},stop:function(event,ui){$(ui.item).find("#parentCompDiv").removeClass("drag")},beforeStop:function(event,ui){ZPNewView.mouseDownFlag=!0},update:function(event,ui){ZPNewView.setRightColumns()}}),ZPNewView.LAYOUT.find("#zp_rightSide").on("click",function(event){var focusInID=event.target.id,focusOutID=$(this).find("input").parent().attr("id");focusInID.length>1&&focusInID!==focusOutID&&$(this).find("input").trigger("blur")}),ZPNewView.LAYOUT.find("#zp_custom_view_name").on("keypress",function(){ZPNewView.LAYOUT.find("#zp_custom_view_name").val().length<=0&&ZPNewView.LAYOUT.find("#zp_custom_view_name_error").hide()}),$(document).on("keyup","#fieldSearch",function(e){var parent=$(this).closest('[id^="fcid"]'),data=this.value.split(" "),allDataObj=$(parent).find("[name=list-group-item]");allDataObj.hide(),$.each(data,function(i,v){allDataObj=allDataObj.filter("*:Contains('"+v+"')")}),allDataObj.show()})},closeCallback:function(){if(ZPView.setViewPropertie("refreshStatus",!0),ZPView.setViewPropertie("refreshHeaders",!0),ZPView.removeViewProperty("groupBy"),ZPView.removeViewProperty("sortBy"),void 0===ZPNewView.LASTVIEWID||null===ZPNewView.LASTVIEWID)if(ZPeople.Module.getData().viewDetails.loaded=!1,ZPView.constructViews(),Layout.UrlConf.isModuleForm())ZPNewView.LASTVIEWID="systemview";else{var extOptions=Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2().find("option");ZPNewView.LASTVIEWID=extOptions[0].value}window.location.href=ZPView.getURL(ZPNewView.LASTVIEWID)},initLeftColumns:function(){ZPNewView.constructLeftCoulmns(ZPNewView.allComponents),$.each(ZPNewView.rightColumns,function(key,value){void 0!==ZPNewView.headerComponents[key+""]&&key===ZPNewView.headerComponents[key+""].formCompID||ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").find("#"+key).remove(),delete ZPNewView.leftColumns[key]}),ZPNewView.formatLeftComponents()},initRightColumns:function(){ZPNewView.constructRightColumns()},sort:function(components){var sortResult=Object.keys(components);return sortResult.sort(),sortResult},constructLeftCoulmns:function(components){var sortedComponents=ZPUtil.sortByJSONValue(components,"formCompID",!0);ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").empty();for(var i=0;i<sortedComponents.length;i++){var singleComponent=sortedComponents[i],formCompID=singleComponent.formCompID;void 0===formCompID&&(formCompID=$(singleComponent).attr("id"));var cmpName=singleComponent.formCompName;void 0===cmpName&&(cmpName=ZPNewView.allCmpName[formCompID].data("cmpName"));var parentFCID=singleComponent.parentFCID;void 0===parentFCID&&(parentFCID=$(singleComponent).attr("parentFCID"));var refFormID=singleComponent.refFormID;void 0===refFormID&&(refFormID=$(singleComponent).attr("refFormID"));var childCnt=singleComponent.childCnt;void 0===childCnt&&(childCnt=$(singleComponent).attr("childCnt"));var sumRequired=singleComponent.sumRequired;void 0===sumRequired&&(sumRequired=$(singleComponent).attr("sumRequired"));var row="<li id="+formCompID+" parentFCID="+parentFCID+" refFormID="+refFormID+" sumRequired="+sumRequired+" childCnt="+childCnt+" side=\"left\"class='list-group-item' onclick='ZPNewView.componentSelect(event,\"left\",this,\"parent\")'><div id='parentCompDiv' class='list-child'><div class='IC-drag FL gry MR5'></div><span id='leftFormCompNameID'></span></div></li>",childPresent=ZPNewView.headerComponents[formCompID+""];void 0!==childPresent&&(row=ZPNewView.constructChildComponents(formCompID,parentFCID,refFormID,childCnt,cmpName,childPresent.childComponents)),ZPNewView.leftColumns[formCompID+""]=row,ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").append(row),ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").children("#"+formCompID).find("#leftFormCompNameID").text(cmpName),void 0!==childPresent&&ZPNewView.setChildCompName(formCompID,childPresent.childComponents),ZPNewView.allCmpName.hasOwnProperty(formCompID)||((row=$(row)).data("cmpName",cmpName),row.data("displayName",cmpName),ZPNewView.allCmpName[formCompID]=row)}},setChildCompName:function(parentFormID,childComponents){$.each(childComponents,function(key,value){var childFormCompID=parentFormID+"_"+value.formCompID,childCmpName=value.formCompName;ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").children().find("#"+childFormCompID).find("#childCmpNameID").text(childCmpName)})},constructChildComponents:function(formCompID,parentFCID,refFormID,childCnt,cmpName,childComponents){var row="";if(void 0!==childComponents&&Object.keys(childComponents).length>0){row="<li id="+formCompID+" parentFCID="+parentFCID+" refFormID="+refFormID+" childCnt="+childCnt+" side=\"left\" class='list-group-item'onclick='ZPNewView.componentSelect(event,\"left\",this,\"parent\")'><div id='parentCompDiv' class='list-child'><div id='upAndDwn' class='IC-ar-dwn FL blu MR5 CP' onclick='ZPNewView.toggleLookupComponent(this)'></div><span id='leftFormCompNameID'></span><div class='IC-Lookup2-2x FR blu CP' onclick='ZPNewView.toggleLookupComponent(this)'></div></div>",row+="<ul class='list-group DN'>";var sortedChildComponents=ZPUtil.sortByJSONValue(childComponents,"formCompID",!0);$.each(sortedChildComponents,function(key,value){var childFormCompID=formCompID+"_"+value.formCompID,childCmpName=value.formCompName,subRow="<li id="+childFormCompID+" parentFCID="+value.parentFCID+" refFormID="+value.refFormID+" childCnt=0 side=\"left\"class='list-group-item' onclick='ZPNewView.childComponentSelect(event,\"left\",this,\"child\")'><div id='childCompDiv' class='list-child'><div class='IC-drag FL gry MR5'></div><span id='childCmpNameID'></span></div></li>",tempSubRow=subRow;ZPNewView.allCmpName.hasOwnProperty(childFormCompID)||((tempSubRow=$(tempSubRow)).data("cmpName",childCmpName),tempSubRow.data("displayName",childCmpName),ZPNewView.allCmpName[childFormCompID]=tempSubRow),row+=subRow}),row+="</ul></li>"}return row},constructRightColumns:function(components){ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").empty(),void 0!==components&&$.each(components,function(key,value){var cmpName=ZPNewView.allCmpName[key].data("displayName"),refFormID=$(value).attr("refFormID"),parentFCID=$(value).attr("parentFCID"),childCnt=$(value).attr("childCnt"),sumEnabled=$(value).find("#sumID").attr("value")===ZPI18N.getString("zp.capitalsum"),isAscStr=$(value).find("#asc_desc").attr("value"),isAsc=void 0;isAsc=void 0===isAscStr||isAscStr.length<=0?void 0:"ASC"===isAscStr;var isGrp=$(value).find("#grpBy").attr("value");isGrp=!(void 0===isGrp||isGrp.length<=0||"GRP"!==isGrp);var row=ZPNewView.constructRightSideListComponent(key,parentFCID,refFormID,childCnt,cmpName,isGrp,isAsc,sumEnabled);ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").append(row);var decodeCmpName=cmpName,originalName=ZPNewView.getOriginalName(key);ZPNewView.isEqual(originalName,decodeCmpName)?ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+key).find("#rightFormCompNameID").text(decodeCmpName):(ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+key).find("#editedFormCompNameID").text(decodeCmpName),ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+key).find("#originalFormCompNameID").text(originalName)),void 0!==parentFCID&&"0"!==parentFCID&&ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+key).find("#parentFormCmpNameID").text(ZPNewView.getParentCompNameByID(parentFCID))}),ZPNewView.setRightColumns()},constructSelectedRightColumn:function(){ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").empty();var sortedBySeq=ZPUtil.sortByJSONValue(ZPNewView.savedComponents,"sequenceNo",!0);$.each(sortedBySeq,function(key,value){var fcID=value.referredKey,cmpDisplayName=value.displayName;cmpDisplayName||(cmpDisplayName=ZPNewView.getOriginalName(fcID));var eachRow=ZPNewView.constructRightSideListComponent(fcID,value.parentFCID,value.refFormID,value.childCnt,cmpDisplayName,value.grouping,value.sorting,value.sumEnabled);ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").append(eachRow);var decodeCmpName=cmpDisplayName,originalName=ZPNewView.getOriginalName(fcID);ZPNewView.isEqual(originalName,decodeCmpName)?ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#rightFormCompNameID").text(decodeCmpName):(ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#editedFormCompNameID").text(decodeCmpName),ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#originalFormCompNameID").text(originalName)),void 0!==value.parentFCID&&"0"!==value.parentFCID&&ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#parentFormCmpNameID").text(ZPNewView.getParentCompNameByID(value.parentFCID)),ZPNewView.rightColumns[fcID]=eachRow}),ZPNewView.setRightColumns()},setRightColumns:function(htmlObj){ZPNewView.rightColumns={};var currRightComponents=ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children();$.each(currRightComponents,function(key,value){var id=$(this).attr("id");ZPNewView.rightColumns[id+""]=$(this)})},constructRightSideListComponent:function(key,parentFCID,refFormID,childCnt,cmpName,isGrp,isAsc,sumEnabled){var selected="<li id="+key+" value="+key+"  parentFCID="+parentFCID+" refFormID="+refFormID+" childCnt="+childCnt+" side=\"right\" class='list-group-item' onclick=ZPNewView.componentSelect(event,'right',this)>"+ZPNewView.listDiv(key,cmpName,parentFCID,isGrp,isAsc,sumEnabled),tempObj=selected+="</li>";return(tempObj=$(tempObj)).data("cmpName",cmpName),tempObj.data("displayName",cmpName),ZPNewView.allCmpName[key]=tempObj,selected},listDiv:function(fcID,cmpName,parentFCID,isGrp,isAsc,sumEnabled){var displayName=cmpName,listDiv="<div id='parentCompDiv' class='list-child'><div class='IC-drag FL gry MR5'></div>",originalName=ZPNewView.getOriginalName(fcID);ZPNewView.isEqual(originalName,displayName)?listDiv+="<span id='rightFormCompNameID'></span>":listDiv+="<div class='Edtxt'><span id='editedFormCompNameID'></span><br><font class='S12' id='originalFormCompNameID'></font></div>";var formComp=ZPNewView.allComponents[fcID];if(void 0!==parentFCID&&"0"!==parentFCID&&(listDiv+="<i class='IC-ar-lft gry CP S13 ML5'></i><font id='parentFormCmpNameID'></font>",formComp=ZPNewView.allComponents[parentFCID].childComponents[fcID.split("_")[1]]),listDiv+="<i class='IC-pen gry CP S13 ML8 list-over' onmousedown='ZPNewView.enableTextBox(this)'></i>",ZPNewView.isCustomView&&formComp&&formComp.grpRequired){if(void 0===isAsc||isAsc.length<=0)listDiv+="<div id='asc_desc' class='asdc ML10 list-over' onmousedown='ZPNewView.setAscDesc(this)' value=''>"+ZPI18N.getString("zp.capitalasc")+"</div>";else{var srtValue=ZPI18N.getString("zp.capitalasc");isAsc||(srtValue=ZPI18N.getString("zp.capitaldesc")),listDiv+="<div id='asc_desc' class='asdc ML10' onmousedown='ZPNewView.setAscDesc(this)' value='"+srtValue+"'>"+srtValue+"<i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeAscDesc(this)'></i></div>"}void 0===isGrp||!isGrp||isGrp.length>0?listDiv+="<div id='grpBy' class='asdc ML10 list-over' onmousedown='ZPNewView.setGroupBy(this)' value=''>"+ZPI18N.getString("zp.capitalgrp")+"</div>":listDiv+="<div id='grpBy' class='asdc ML10' onmousedown='ZPNewView.setGroupBy(this)' value='"+ZPI18N.getString("zp.capitalgrp")+"'>"+ZPI18N.getString("zp.capitalgrp")+"<i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeGrpBy(this)'></i></div>"}void 0!==formComp&&(formComp.sumRequired&&(listDiv+=sumEnabled?"<div id='sumID' class='asdc ML10' onmousedown='ZPNewView.setSum(this)' value='"+ZPI18N.getString("zp.capitalsum")+"'>"+ZPI18N.getString("zp.capitalsum")+"<i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeSum(this)'></i></div>":"<div id='sumID' class='asdc ML10 list-over' onmousedown='ZPNewView.setSum(this)' value=''>"+ZPI18N.getString("zp.capitalsum")+"</div>"));return listDiv+="</div>"},setSum:function(obj){if(ZPNewView.mouseDownFlag=!0,ZPNewView.removeSumFlag)ZPNewView.removeSumFlag=!1;else{var liObj=$(obj).parent().parent();$(obj).hasClass("list-over")&&($(liObj).find("#sumID").removeClass("list-over"),$(liObj).find("#sumID").attr("value",ZPI18N.getString("zp.capitalsum")),$(liObj).find("#sumID").html(ZPI18N.getString("zp.capitalsum")+" <i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeSum(this)'></i>"))}},removeSum:function(obj){ZPNewView.mouseDownFlag=!0,ZPNewView.removeSumFlag=!0;var liObj=$(obj).parent().parent().parent();$(liObj).find("#sumID").addClass("list-over"),$(liObj).find("#sumID").attr("value",""),$(liObj).find("#sumID").text(ZPI18N.getString("zp.capitalsum")),$(liObj).find("#sumID").find("i").remove()},setAscDesc:function(obj){if(ZPNewView.mouseDownFlag=!0,ZPNewView.removeAscDescFlag)ZPNewView.removeAscDescFlag=!1;else{var liObj=$(obj).parent().parent();$(obj).hasClass("list-over")?($(liObj).find("#asc_desc").removeClass("list-over"),$(liObj).find("#asc_desc").attr("value",ZPI18N.getString("zp.capitalasc")),$(liObj).find("#asc_desc").html(ZPI18N.getString("zp.capitalasc")+" <i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeAscDesc(this)'></i>")):ZPNewView.toggleAscDesc(obj)}},removeAscDesc:function(obj){ZPNewView.mouseDownFlag=!0,ZPNewView.removeAscDescFlag=!0;var liObj=$(obj).parent().parent().parent();$(liObj).find("#asc_desc").addClass("list-over"),$(liObj).find("#asc_desc").attr("value",""),$(liObj).find("#asc_desc").text(ZPI18N.getString("zp.capitalasc")),$(liObj).find("#asc_desc").find("i").remove();var grpVal=$(liObj).find("#grpBy").attr("value");void 0!==grpVal&&grpVal===ZPI18N.getString("zp.capitalgrp")&&(ZPNewView.removeGrpBy($(liObj).find("#grpBy").find("i")),ZPNewView.removeGrpFlag=!1)},setGroupBy:function(obj){if(ZPNewView.mouseDownFlag=!0,ZPNewView.removeGrpFlag)ZPNewView.removeGrpFlag=!1;else{var liObj=$(obj).parent().parent();if($(obj).hasClass("list-over")){$(liObj).find("#grpBy").removeClass("list-over"),$(liObj).find("#grpBy").attr("value",ZPI18N.getString("zp.capitalgrp")),$(liObj).find("#grpBy").html(ZPI18N.getString("zp.capitalgrp")+" <i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeGrpBy(this)'></i>");var sortVal=$(liObj).find("#asc_desc").attr("value");(void 0===sortVal||sortVal.length<=0)&&ZPNewView.setAscDesc($(liObj).find("#asc_desc"))}}},removeGrpBy:function(obj){ZPNewView.mouseDownFlag=!0,ZPNewView.removeGrpFlag=!0;var liObj=$(obj).parent().parent().parent();$(liObj).find("#grpBy").addClass("list-over"),$(liObj).find("#grpBy").attr("value",""),$(liObj).find("#grpBy").text(ZPI18N.getString("zp.capitalgrp")),$(liObj).find("#grpBy").find("i").remove();var sortVal=$(liObj).find("#asc_desc").attr("value");void 0!==sortVal&&sortVal.length>0&&(ZPNewView.removeAscDesc($(liObj).find("#asc_desc").find("i")),ZPNewView.removeAscDescFlag=!1)},enableTextBox:function(textObj){ZPNewView.mouseDownFlag=!0;var liObj=$(textObj).parent().parent(),fcID=$(liObj).attr("id"),cmpName=ZPNewView.allCmpName[fcID].data("displayName");if(void 0!==$(liObj).find("#grpBy")&&liObj.data("isGrp",$(liObj).find("#grpBy").attr("value")),void 0!==$(liObj).find("#asc_desc")&&liObj.data("isAsc",$(liObj).find("#asc_desc").attr("value")),void 0!==$(liObj).attr("parentFCID")&&liObj.data("parentFCID",$(liObj).attr("parentFCID")),void 0!==$(liObj).find("#sumID")){var sumEnabled=$(liObj).find("#sumID").attr("value")===ZPI18N.getString("zp.capitalsum");liObj.data("sumEnabled",sumEnabled)}$(liObj).html("<div class='IC-drag FL gry MT5 MR5'></div><input type='text' class='form-control table-inpt  input-bb1' onmousedown='ZPNewView.removeSelectOnInputBox()'><i class='IC-tick S15 DIB grn ML5 MR10 MT5 CP' onmousedown='ZPNewView.disableTextBox(this)'></i><i class='IC-cls S12 red DIB  CP MT5' onmousedown='ZPNewView.disableTextBox(this,true)'></i>"),setTimeout(function(){$(liObj).find("input").trigger("focus"),$(liObj).find("input").val(""),$(liObj).find("input").val(cmpName)},0),$(liObj).find("input").on("blur",function(){ZPNewView.disableTextBox($(this).next(),!0)})},disableTextBox:function(obj,isCancel){var liObj=$(obj).parent(),fcID=$(liObj).attr("id"),oldCmpName="";oldCmpName=isCancel?ZPNewView.allCmpName[fcID].data("displayName"):$(liObj).find("input").val();var isGrp=void 0;void 0!==liObj.data("isGrp")&&(isGrp=liObj.data("isGrp")===ZPI18N.getString("zp.capitalgrp"));var isAsc=void 0;void 0!==liObj.data("isAsc")&&(isAsc=(isAsc=liObj.data("isAsc")).length<=0?"":liObj.data("isAsc")===ZPI18N.getString("zp.capitalasc"));var parentFCID=void 0;void 0!==liObj.data("parentFCID")&&(parentFCID=liObj.data("parentFCID"));var sumEnabled=liObj.data("sumEnabled"),decodeCmpName=oldCmpName,originalName=ZPNewView.getOriginalName(fcID);if(void 0!=decodeCmpName&&0!=decodeCmpName.trim().length){ZPNewView.allCmpName[fcID].data("displayName",oldCmpName);var liHTML=ZPNewView.listDiv(fcID,oldCmpName,parentFCID,isGrp,isAsc,sumEnabled);$(liObj).html(liHTML),ZPNewView.isEqual(originalName,decodeCmpName)?ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#rightFormCompNameID").text(decodeCmpName):(ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#editedFormCompNameID").text(decodeCmpName),ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#originalFormCompNameID").text(originalName)),void 0!==parentFCID&&"0"!==parentFCID&&ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children("#"+fcID).find("#parentFormCmpNameID").text(ZPNewView.getParentCompNameByID(parentFCID)),ZPNewView.mouseDownFlag=!0}else $(liObj).append('<div class="error-msg PL30">'+ZPI18N.getString("zp.relformerrmsg")+"</div>")},removeSelectOnInputBox:function(){ZPNewView.mouseDownFlag=!0},fieldChange:function(obj){var fcid=obj.attr("fcid"),pfcid=obj.attr("pfcid"),crtObj=obj.closest('[id^="zp_criteria"]'),fcObj=(crtObj.find('[iscrtfc="true"]'),ZPNewView.allComponents[fcid+""]),dispName="";-1!=pfcid&&(fcObj=ZPNewView.allComponents[pfcid+""].childComponents[fcid+""],dispName=" ("+ZPNewView.allComponents[pfcid+""].formCompName+" )"),dispName=fcObj.formCompName+dispName,crtObj.find(".error-msg").hide(),crtObj.find("#txtValue").val(""),crtObj.find("#txtValue").prop("disabled",!1),crtObj.find("#txtValue").removeAttr("onclick");var fcType=fcObj.fcType,formulaDType=fcObj.formulaDType;fcType==ZPForm.Field.SCRIPT&&void 0!=formulaDType&&-1!=formulaDType&&(fcType=formulaDType);var isLookup=!1,tName=fcObj.tName;fcObj.columnName;fcType==ZPForm.Field.LOOKUP&&(fcObj.reffColName,tName=fcObj.reffTname);var oprs="",defOptn=ZPNewView.OPERATORS.EQUAL,lkpDefOptn="";fcType==ZPForm.Field.LOOKUP&&(isLookup=!0,void 0==(fcType=fcObj.reffcType)&&(fcType=ZPForm.Field.TEXT),"P_Department"==tName||"P_DepartmentN1"==tName?(oprs+="<option value='"+ZPNewView.OPERATORS.LOGIN_USERS_DEPT+"'>"+ZPI18N.getString("zp.loginUsersDept")+"</option>",lkpDefOptn=defOptn=ZPNewView.OPERATORS.LOGIN_USERS_DEPT):"P_Employee"==tName||"P_EmployeeN1"==tName?(oprs+="<option value='"+ZPNewView.OPERATORS.LOGIN_USER+"'>"+ZPI18N.getString("zp.loginUser")+"</option>",lkpDefOptn=defOptn=ZPNewView.OPERATORS.LOGIN_USER):"P_Legal_Entity"==tName?(oprs+="<option value='"+ZPNewView.OPERATORS.LOGIN_USERS_ENTITY+"'>"+ZPI18N.getString("zp.loginUserEntity")+"</option>",lkpDefOptn=defOptn=ZPNewView.OPERATORS.LOGIN_USERS_ENTITY):"P_Business_Unit"==tName?(oprs+="<option value='"+ZPNewView.OPERATORS.LOGIN_USERS_UNIT+"'>"+ZPI18N.getString("zp.loginUserUnit")+"</option>",lkpDefOptn=defOptn=ZPNewView.OPERATORS.LOGIN_USERS_UNIT):"P_Divisions"==tName?(oprs+="<option value='"+ZPNewView.OPERATORS.LOGIN_USERS_DIVISION+"'>"+ZPI18N.getString("zp.loginUserDivision")+"</option>",lkpDefOptn=defOptn=ZPNewView.OPERATORS.LOGIN_USERS_DIVISION):"P_Goals"==tName&&(oprs+="<option value='"+ZPNewView.OPERATORS.SUBORDINATES_GOAL+"'>"+ZPI18N.getString("zp.subordinatesgoals")+"</option>",lkpDefOptn=defOptn=ZPNewView.OPERATORS.SUBORDINATES_GOAL)),fcObj.isEncrypted&&fcType!=ZPForm.Field.NEW_GENDER&&fcType!=ZPForm.Field.NEW_BLOODGROUP?(oprs="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>",oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",fcType==ZPForm.Field.DATE&&crtObj.find("#txtValue").attr("onclick","Calendar.setUpCalendar(event,this)"),defOptn=ZPNewView.OPERATORS.EQUAL):Timetracker.views.isTimetrackerSpecialFields(tName,fcObj.labelName,fcObj.reffTname)?(oprs+=Timetracker.views.getSearchOperationOptions(fcObj.labelName,!0),defOptn=Timetracker.views.getDefaultValueForSearch(fcObj.labelName)):fcType==ZPForm.Field.TEXT||fcType==ZPForm.Field.EMAIL_ADDRESS||fcType==ZPForm.Field.PHONE_NUMBER||fcType==ZPForm.Field.URL||fcType==ZPForm.Field.TEXT_AREA||fcType==ZPForm.Field.FILE_UPLOAD||fcType==ZPForm.Field.IMAGE||fcType==ZPForm.Field.BLOODGROUP||fcType==ZPForm.Field.GENDER||fcType==ZPForm.Field.COUNTRY||fcType==ZPForm.Field.ADDRESS||fcType==ZPForm.Field.STATES?(isLookup?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.IN):(oprs+="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.EQUAL),oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",fcType!=ZPForm.Field.BLOODGROUP&&fcType!=ZPForm.Field.GENDER&&fcType!=ZPForm.Field.COUNTRY&&(oprs+="<option value='24'>"+ZPI18N.getString("zp.startswith")+"</option>",oprs+="<option value='25'>"+ZPI18N.getString("zp.endswith")+"</option>",oprs+="<option value='26'>"+ZPI18N.getString("zp.contains")+"</option>",oprs+="<option value='27'>"+ZPI18N.getString("zp.notcontains")+"</option>")):fcType==ZPForm.Field.DATE||fcType==ZPForm.Field.DATE_TIME||fcType==ZPForm.Field.FORMULA_DATE?(isLookup?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>"):(oprs+="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>"),oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",oprs+="<option value='20'>"+ZPI18N.getString("zp.before")+"</option>",oprs+="<option value='21'>"+ZPI18N.getString("zp.after")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.YESTERDAY+"'>"+ZPI18N.getString("zp.yesterday")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.TODAY+"'>"+ZPI18N.getString("zp.today")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.TOMORROW+"'>"+ZPI18N.getString("zp.tomorrow")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.LAST_WEEK+"'>"+ZPI18N.getString("zp.lastweek")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.THIS_WEEK+"'>"+ZPI18N.getString("zp.thisweek")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NEXT_WEEK+"'>"+ZPI18N.getString("zp.nextweek")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.LAST_MONTH+"'>"+ZPI18N.getString("zp.lastmonth")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.THIS_MONTH+"'>"+ZPI18N.getString("zp.thismonth")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NEXT_MONTH+"'>"+ZPI18N.getString("zp.nextmonth")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.LAST_YEAR+"'>"+ZPI18N.getString("zp.lastyear")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.CURRENT_YEAR+"'>"+ZPI18N.getString("zp.thisyear")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NEXT_YEAR+"'>"+ZPI18N.getString("zp.nextyear")+"</option>",fcType==ZPForm.Field.DATE_TIME?crtObj.find("#txtValue").attr("onclick","Calendar.setUpCalendar(event,this,1)"):crtObj.find("#txtValue").attr("onclick","Calendar.setUpCalendar(event,this)"),crtObj.find("#txtValue").attr("caltype","popup"),defOptn=ZPNewView.OPERATORS.TODAY):fcType==ZPForm.Field.CHECK_BOX?(oprs+="<option value='49'>"+ZPI18N.getString("zp.yes")+"</option>",oprs+="<option value='50'>"+ZPI18N.getString("zp.no")+"</option>",defOptn=ZPNewView.OPERATORS.TRUE):fcType==ZPForm.Field.NUMBER||fcType==ZPForm.Field.CURRENCY||fcType==ZPForm.Field.DECIMAL?(isLookup?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.IN):(oprs+="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.EQUAL),oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",oprs+="<option value='20'>"+ZPI18N.getString("zp.lesserthan")+"</option>",oprs+="<option value='21'>"+ZPI18N.getString("zp.greaterthan")+"</option>",oprs+="<option value='22'>"+ZPI18N.getString("zp.lesserorequalto")+"</option>",oprs+="<option value='23'>"+ZPI18N.getString("zp.greaterorequalto")+"</option>"):fcType==ZPForm.Field.PICKLIST?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",oprs+="<option value='24'>"+ZPI18N.getString("zp.startswith")+"</option>",oprs+="<option value='25'>"+ZPI18N.getString("zp.endswith")+"</option>",oprs+="<option value='26'>"+ZPI18N.getString("zp.contains")+"</option>",oprs+="<option value='27'>"+ZPI18N.getString("zp.notcontains")+"</option>",oprs+="<option value='20'>"+ZPI18N.getString("zp.lesserthan")+"</option>",oprs+="<option value='21'>"+ZPI18N.getString("zp.greaterthan")+"</option>",oprs+="<option value='22'>"+ZPI18N.getString("zp.lesserorequalto")+"</option>",oprs+="<option value='23'>"+ZPI18N.getString("zp.greaterorequalto")+"</option>",defOptn=ZPNewView.OPERATORS.IN):fcType==ZPForm.Field.NEW_GENDER||fcType==ZPForm.Field.NEW_BLOODGROUP||fcType==ZPForm.Field.NEW_COUNTRY?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",defOptn=ZPNewView.OPERATORS.IN):fcType==ZPForm.Field.TIME?(isLookup?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.IN):(oprs+="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='19'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.EQUAL),oprs+="<option value='29'>"+ZPI18N.getString("zp.isempty")+"</option>",oprs+="<option value='30'>"+ZPI18N.getString("zp.isnotempty")+"</option>",oprs+="<option value='20'>"+ZPI18N.getString("zp.before")+"</option>",oprs+="<option value='21'>"+ZPI18N.getString("zp.after")+"</option>"):isLookup?(oprs+="<option value='"+ZPNewView.OPERATORS.IN+"'>"+ZPI18N.getString("zp.is")+"</option>",oprs+="<option value='"+ZPNewView.OPERATORS.NOT_IN+"'>"+ZPI18N.getString("zp.isnot")+"</option>",defOptn=ZPNewView.OPERATORS.IN):(oprs+="<option value='18'>"+ZPI18N.getString("zp.is")+"</option>",defOptn=ZPNewView.OPERATORS.EQUAL),""!=lkpDefOptn&&(defOptn=lkpDefOptn),crtObj.find("[isopr='true']").html(oprs),crtObj.find("[isopr='true']").attr("disabled",!1),crtObj.find("[isopr='true']").select2(),crtObj.find("[isopr='true']").select2("val",[defOptn]);var criteriaRowId=crtObj.attr("id");(isLookup||fcType==ZPForm.Field.PICKLIST)&&(void 0!==ZPNewView.crtSelectedRecords[criteriaRowId]&&delete ZPNewView.crtSelectedRecords[criteriaRowId]);ZPNewView.addPickListComponent(criteriaRowId,isLookup),isLookup||fcType==ZPForm.Field.PICKLIST||fcType==ZPForm.Field.DATE||fcType==ZPForm.Field.DATE_TIME||fcType==ZPForm.Field.FORMULA_DATE?crtObj.find("#txtValue").on("keydown",function(e){e.preventDefault()}):crtObj.find("#txtValue").off("keydown"),crtObj.find("[isopr='true']").trigger("change")},constructCriteria:function(){var criteriaRow="<tr id='zp_criteria_"+ZPNewView.criteriaCnt+++"' class='ZPLRow ZPLErr'>";return criteriaRow+="<td>",ZPNewView.criteriaCnt>1&&(criteriaRow+="<select id='operatorSelection'><option value='AND'>"+ZPI18N.getString("zp.captialand")+"</option><option value='OR'>"+ZPI18N.getString("zp.captialor")+"</option></select>"),criteriaRow+="</td>",criteriaRow+="<td class='dropdown'><input id='fieldOpetions' value='"+ZPI18N.getString("zp.none")+"' fcid='-1' pfcid='-1' iscrtfc='true' class='form-control'data-placement='bottom' data-toggle='popover'><span class='error-msg DN' id='zp_criteria_field_error'></span></td>",criteriaRow+="<td><select isopr='true' onChange=ZPNewView.onConditionChange(this)><option value='-1'>"+ZPI18N.getString("zp.none")+"</option></select></td>",criteriaRow+="<td id='crtValueTD'><input id='txtValue' type='text' class='form-control'><span class='error-msg DN' id='zp_criteria_error'></span></td>",criteriaRow+=ZPNewView.INPUT_DROPDOWN,criteriaRow+="<td>",criteriaRow+="<div class='IC-plus-fill S16 blu FL MT5 CP' onclick=ZPNewView.addCriteria(this)></div>",criteriaRow+="<div class='IC-cls-fill S16 red FL MT5 ML5 CP' onclick=ZPNewView.removeCriteria(this)></div>",criteriaRow+="</td></tr>"},fieldOptionPopOverInit:function(crtID){var ruleFieldObj=ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").find("#"+crtID).find("#fieldOpetions"),menuBoxContent=ZPNewView.constructFieldOptionsPopover(ruleFieldObj);menuBoxContent.find("#contentDiv").removeClass("ulItemrec"),ZPNewView.defaultActions(),$(ruleFieldObj).setPopOver({callback:ZPNewView.fiedpopoverclback,html:menuBoxContent,targetId:ruleFieldObj,keyname:"name=list-group-item",container:""})},constructFieldOptionsPopover:function(obj){var fieldListClone,formId=ZPNewView.formId,fcid=$(obj).attr("fcid"),pfcid=$(obj).attr("pfcid");if(!ZPNewView.fieldListCloneDom.hasOwnProperty(formId)){var tabLi=(fieldListClone=AutomationCommon.getFormFieldsHtml().clone()).find("#dvRecipient li:first").clone(),contDiv=fieldListClone.find("#contentDiv :first").clone(),contLi=fieldListClone.find("[name=list-group-item]").clone();fieldListClone.find("#dvRecipient").empty(),fieldListClone.find("#contentDiv").empty();var cloneTagLiForBaseForm=tabLi.clone();cloneTagLiForBaseForm.attr({class:"",id:"div"+ZPNewView.formId}),cloneTagLiForBaseForm.find("a").attr({"data-toggle":"tab",href:"#fcid"+ZPNewView.formId}).html(ZSEC.Encoder.encodeForHTML(ZPNewView.FORM_NAME)),fieldListClone.find("#dvRecipient").append(cloneTagLiForBaseForm),$.each(ZPNewView.headerComponents,function(key,value){var cloneTagLi=tabLi.clone();cloneTagLi.attr({class:"",id:"div"+key}),cloneTagLi.find("a").attr({"data-toggle":"tab",href:"#fcid"+key}).text(value.formCompName),fieldListClone.find("#dvRecipient").append(cloneTagLi)});var cloneContDiv=contDiv.clone();cloneContDiv.find("[name=list-group]").empty(),$(cloneContDiv).find("[type=search]").attr("id","fieldSearch"),$(cloneContDiv).attr({class:"tab-pane fade",id:"fcid"+ZPNewView.formId}),$.each(ZPNewView.allComponents,function(key,value){if(!("0"!==value.parentFCID||value.fcType===ZPForm.Field.IMAGE||"P_EmployeeLeave"===ZPForm.getTableName()&&"ZP_Leave_Unit"==value.labelName||"P_Employee"==ZPForm.getTableName()&&"ORGANIZATION_TAG_NAME"==value.columnName)){var li=contLi.clone(),fieldKey=value.formCompID;li.find("[name=optDiv]").attr({id:fieldKey,pfcid:"-1"}),li.find("[name=mOpt]").html(ZSEC.Encoder.encodeForHTML(value.formCompName)),li.find("[name=mOpt]").parent("for",fieldKey),$(cloneContDiv).find("[name=list-group]").append(li)}}),fieldListClone.find("#contentDiv").append(cloneContDiv),$.each(ZPNewView.headerComponents,function(key,value){var cloneContDiv=contDiv.clone();cloneContDiv.find("[name=list-group]").empty(),$(cloneContDiv).find("[type=search]").attr("id","fieldSearch"),$(cloneContDiv).attr({class:"tab-pane fade",id:"fcid"+key}),$.each(value.childComponents,function(k,v){var tName=v.tName,columnName=v.columnName;if(("P_Rating"!=tName||"STARS"!=columnName)&&v.fcType!=ZPForm.Field.IMAGE){var li=contLi.clone(),fieldKey=k;li.find("[name=optDiv]").attr({id:fieldKey,pfcid:value.formCompID}),li.find("[name=mOpt]").html(ZSEC.Encoder.encodeForHTML(v.formCompName)),li.find("[name=mOpt]").parent("for",fieldKey),$(cloneContDiv).find("[name=list-group]").append(li)}}),fieldListClone.find("#contentDiv").append(cloneContDiv)}),ZPNewView.fieldListCloneDom[formId]=$(fieldListClone)}return fieldListClone=ZPNewView.fieldListCloneDom[formId].html(),fieldListClone=jQuery("<div />",{class:"clone"}).append(fieldListClone),-1==fcid&&-1==pfcid?($(fieldListClone).find("#div"+ZPNewView.formId).attr("class","active"),$(fieldListClone).find("#fcid"+ZPNewView.formId).attr("class","tab-pane fade active in")):-1==pfcid&&-1!==fcid?($(fieldListClone).find("#div"+ZPNewView.formId).attr("class","active"),$(fieldListClone).find("#fcid"+ZPNewView.formId).attr("class","tab-pane fade active in"),$(fieldListClone).find("#fcid"+ZPNewView.formId).find('a[id="'+fcid+'"]').parent().attr("class","sel")):-1!==pfcid&&-1!==fcid&&($(fieldListClone).find("#div"+pfcid).attr("class","active"),$(fieldListClone).find("#fcid"+pfcid).attr("class","tab-pane fade active in"),$(fieldListClone).find("#fcid"+pfcid).find('a[id="'+fcid+'"]').parent().attr("class","sel")),fieldListClone},fiedpopoverclback:function(ele,pfcid,fcid,isFromEditView){var obj,dispName="";if(isFromEditView){var fcObj=ZPNewView.allComponents[fcid+""];-1!=pfcid&&(fcObj=ZPNewView.allComponents[pfcid+""].childComponents[fcid+""],dispName=" ("+ZPNewView.allComponents[pfcid+""].formCompName+" )"),dispName=fcObj.formCompName+dispName,obj=$(ele),$(obj).val(dispName),$(obj).attr({fcid:fcid,pfcid:pfcid,iscrtfc:!0})}else{var text=$(ele).find("span").text(),id=$(ele).find("a").attr("id");"-1"!=(pfcid=$(ele).find("a").attr("pfcid"))&&(dispName=" ("+ZPNewView.allComponents[pfcid+""].formCompName+" )"),text+=dispName,obj=$(ele).closest('[id^="popover"]').parent().find("#fieldOpetions"),$(obj).val(text),$(obj).attr({fcid:id,pfcid:pfcid,iscrtfc:!0})}ZPNewView.fieldChange(obj)},addCriteria:function(obj){if(void 0===obj||ZPNewView.validCriteria()){var criteria=ZPNewView.constructCriteria(),curr_criteria_id=$(criteria).attr("id");return ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").append(criteria),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#operatorSelection").select2({minimumResultsForSearch:1/0}),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#fieldSelection").children().length>3?ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#fieldSelection").select2():ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#fieldSelection").select2({minimumResultsForSearch:1/0}),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").children().length>3?ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").select2():ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").select2({minimumResultsForSearch:1/0}),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[iscrtfc='true']").on("keydown",function(e){e.preventDefault()}),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("#txtValue").attr("disabled",!0),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").select2(),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find("[isopr='true']").select2("disable"),ZPNewView.LAYOUT.find("#"+curr_criteria_id).find('[isviewcrt="true"]').parent().on("shown.bs.dropdown",function(){var fcid=$(this).find('[iscrtfc="true"]').attr("fcid"),pfcid=$(this).find('[iscrtfc="true"]').attr("pfcid");-1!=fcid?($(this).find('ul[pfcid="'+pfcid+'"]').collapse("show"),$(this).find('[isviewcrt="true"]').scrollTop($(this).find('[isviewcrt="true"]').scrollTop()+$(this).find('ul[pfcid="'+pfcid+'"]').find('a[value="'+fcid+'"]').position().top)):$(this).find('ul[pfcid="-1"]').collapse("show")}),0!=$(obj).length&&ZPNewView.fieldOptionPopOverInit(curr_criteria_id),Layout.Page.container.find(".modal-body").scrollTop(Layout.Page.container.find(".PL30").height()),curr_criteria_id}},removeCriteria:function(obj){var tr=$(obj).parent().parent(),criteriaRowId=tr.attr("id"),firstRowID=ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").children()[0].id;if(tr.remove(),ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").children().length<=0){ZPNewView.criteriaCnt=0;var curr_criteria_id=ZPNewView.addCriteria();ZPNewView.fieldOptionPopOverInit(curr_criteria_id)}else firstRowID===criteriaRowId&&$(ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").children()[0]).find("#operatorSelection").parent().empty()},validCriteria:function(){var isValid=!0;return $.each(ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").children().find('[iscrtfc="true"]'),function(key,value){"-1"==$(value).attr("fcid")&&(isValid=!1,$(this).parent().find("#zp_criteria_field_error").html(ZPI18N.getString("zp.pleaseselectfieldname")).show())}),isValid},validCriteriaValue:function(fcType,tr,operator,crtValue,isFromLookUpFilter){isFromLookUpFilter||(crtValue=$(tr).find("#txtValue").val());var key,isFromLookupFilterResult={},isValid=!0;switch(fcType){case ZPForm.Field.EMAIL_ADDRESS:operator!=ZPNewView.OPERATORS.EQUAL&&operator!=ZPNewView.OPERATORS.NOT_EQUAL||(isValid=ZPUtil.Validation.isEmail(crtValue,!0))||(key=ZPI18N.getString("zp.entervalidemailaddress"));break;case ZPForm.Field.NUMBER:(isValid=ZPUtil.Validation.isNumber(crtValue))||(key=ZPI18N.getString("zp.enteravalidnumber"));break;case ZPForm.Field.DATE:(isValid=ZPUtil.Validation.isDate(crtValue))||(key=ZPI18N.getString("zp.holiday.dateerror"));break;case ZPForm.Field.DECIMAL:case ZPForm.Field.CURRENCY:isValid=!1,"SUCCESS"===ZPUtil.getDecimalLength(crtValue).message&&(isValid=!0),isValid||(key=ZPI18N.getString("zp.enteravalidnumber"))}return(void 0==crtValue||crtValue.length<=0)&&((isValid=!1)||(key=ZPI18N.getString("zp.fieldupdate.specifyfield"))),isFromLookUpFilter?(isFromLookupFilterResult.isValid=isValid,isFromLookupFilterResult.key=key,isFromLookupFilterResult):(isValid?$(tr).find("#zp_criteria_error").hide():$(tr).find("#zp_criteria_error").html(ZPI18N.getString("zp.invalidcriteriavalue")).show(),isValid)},addPickListComponent:function(criteriaRowId,addFlag){addFlag?ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#zp_crt_input_dropdown").removeClass("DN"):ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#zp_crt_input_dropdown").addClass("DN")},onConditionChange:function(obj){var optval=$(obj).val(),criteriaRowId=$(obj).parent().parent().attr("id"),inp=ZPNewView.LAYOUT.find("#"+criteriaRowId).find('[iscrtfc="true"]'),pfcid=inp.attr("pfcid"),fcid=inp.attr("fcid"),fcObj=ZPNewView.allComponents[fcid+""];-1!=pfcid&&(fcObj=ZPNewView.allComponents[pfcid+""].childComponents[fcid+""]);var fcType=fcObj.fcType;if(ZPNewView.LAYOUT.find("#"+criteriaRowId).find(".error-msg").hide(),Timetracker.views.isTimetrackerSpecialFields(fcObj.tName,fcObj.labelName))return ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").val(""),void ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").attr("disabled",!0);if(29==optval||30==optval||optval==ZPNewView.OPERATORS.YESTERDAY||optval==ZPNewView.OPERATORS.TODAY||optval==ZPNewView.OPERATORS.TOMORROW||optval==ZPNewView.OPERATORS.LAST_MONTH||optval==ZPNewView.OPERATORS.THIS_MONTH||optval==ZPNewView.OPERATORS.NEXT_MONTH||optval==ZPNewView.OPERATORS.LAST_YEAR||optval==ZPNewView.OPERATORS.CURRENT_YEAR||optval==ZPNewView.OPERATORS.NEXT_YEAR||optval==ZPNewView.OPERATORS.LOGIN_USERS_DEPT||optval==ZPNewView.OPERATORS.LOGIN_USER||optval==ZPNewView.OPERATORS.THIS_WEEK||optval==ZPNewView.OPERATORS.LAST_WEEK||optval==ZPNewView.OPERATORS.NEXT_WEEK||optval==ZPNewView.OPERATORS.TRUE||optval==ZPNewView.OPERATORS.FALSE||optval==ZPNewView.OPERATORS.LOGIN_USERS_ENTITY||optval==ZPNewView.OPERATORS.LOGIN_USERS_UNIT||optval==ZPNewView.OPERATORS.LOGIN_USERS_DIVISION||optval==ZPNewView.OPERATORS.SUBORDINATES_GOAL)ZPNewView.addPickListComponent(criteriaRowId,!1),ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").val(""),ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").attr("disabled",!0),(fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST)&&void 0!==ZPNewView.crtSelectedRecords[criteriaRowId]&&delete ZPNewView.crtSelectedRecords[criteriaRowId];else if(optval==ZPNewView.OPERATORS.NOT_IN||optval==ZPNewView.OPERATORS.IN){if(fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST||fcType==ZPForm.Field.NEW_GENDER||fcType==ZPForm.Field.NEW_BLOODGROUP||fcType==ZPForm.Field.NEW_COUNTRY)return ZPNewView.addPickListComponent(criteriaRowId,!0),void 0!==ZPNewView.crtSelectedRecords[criteriaRowId]?ZPNewView.displayCrtTxt(criteriaRowId):(delete ZPNewView.crtSelectedRecords[criteriaRowId],ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").val("")),void ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").attr("disabled",!0);ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").prop("disabled",!1)}else fcType!=ZPForm.Field.LOOKUP&&fcType!=ZPForm.Field.PICKLIST||ZPNewView.addPickListComponent(criteriaRowId,!1),ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").prop("disabled",!1);if(fcType==ZPForm.Field.LOOKUP||fcType==ZPForm.Field.PICKLIST){var optVal=ZPNewView.LAYOUT.find("#"+criteriaRowId).find("[isopr='true']").val();optVal==ZPNewView.OPERATORS.NOT_IN||optVal==ZPNewView.OPERATORS.IN?ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").on("keydown",function(e){e.preventDefault()}):ZPNewView.LAYOUT.find("#"+criteriaRowId).find("#txtValue").off("keydown")}},toggleLookupComponent:function(obj){var upAndDwn=$(obj).parent().find("#upAndDwn");ZPNewView.toggleUpAndDownArrow(upAndDwn)},toggleUpAndDownArrow:function(obj){ZPNewView.mouseDownFlag=!0,$(obj).hasClass("IC-ar-dwn")?($(obj).removeClass("IC-ar-dwn"),$(obj).addClass("IC-ar-top"),$(obj).parent().parent().addClass("subclm"),$(obj).parent().parent().children().next().removeClass("DN")):($(obj).removeClass("IC-ar-top"),$(obj).addClass("IC-ar-dwn"),$(obj).parent().parent().removeClass("subclm"),$(obj).parent().parent().children().next().addClass("DN"))},toggleAscDesc:function(obj){ZPNewView.mouseDownFlag=!0;var value=$(obj).attr("value");value=value===ZPI18N.getString("zp.capitalasc")?ZPI18N.getString("zp.capitaldesc"):ZPI18N.getString("zp.capitalasc"),$(obj).attr("value",value),$(obj).html(value+"<i class='IC-cls ML2 S8 red' onmousedown='ZPNewView.removeAscDesc(this)'></i>")},isExistInRightSide:function(idx){var isExist=!1,currRightChildrens=ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children();return $.each(currRightChildrens,function(key,value){$(value).attr("id")!==idx||(isExist=!0)}),isExist},componentSelect:function(event,side,obj,part){if("child"!==part)if(ZPNewView.childSelectFlag)ZPNewView.childSelectFlag=!1;else{var idx=$(obj).attr("id");if("left"===side)ZPNewView.isExistInRightSide(idx)&&(ZPNewView.mouseDownFlag=!0);ZPNewView.mouseDownFlag?ZPNewView.mouseDownFlag=!1:ZPNewView.toggleSelectClass(side,idx,obj)}},childComponentSelect:function(event,side,obj,part){if("parent"!==part){var idx=$(obj).attr("id");ZPNewView.childSelectFlag=!0,"left"===side?ZPNewView.leftSideSelected.hasOwnProperty(idx)?($(obj).find("div#childCompDiv").removeClass("sel"),delete ZPNewView.leftSideSelected[idx]):($(obj).find("div#childCompDiv").addClass("sel"),ZPNewView.leftSideSelected[idx]=$(obj)):ZPNewView.rightSideSelected.hasOwnProperty(idx)?($(obj).find("div#childCompDiv").removeClass("sel"),delete ZPNewView.rightSideSelected[idx]):($(obj).find("div#childCompDiv").addClass("sel"),ZPNewView.rightSideSelected[idx]=$(obj))}},toggleSelectClass:function(side,idx,obj){"left"===side?ZPNewView.leftSideSelected.hasOwnProperty(idx)?($(obj).find("div#parentCompDiv").removeClass("sel"),delete ZPNewView.leftSideSelected[idx]):($(obj).find("div#parentCompDiv").addClass("sel"),ZPNewView.leftSideSelected[idx]=$(obj)):ZPNewView.rightSideSelected.hasOwnProperty(idx)?($(obj).find("div#parentCompDiv").removeClass("sel"),delete ZPNewView.rightSideSelected[idx]):($(obj).find("div#parentCompDiv").addClass("sel"),ZPNewView.rightSideSelected[idx]=$(obj))},moveSelectedRowToRight:function(){Object.keys(ZPNewView.leftSideSelected).length<1||($.each(ZPNewView.leftSideSelected,function(key,value){key=$(this).attr("id");ZPNewView.rightColumns[key]=this,delete ZPNewView.leftColumns[key]}),ZPNewView.constructRightColumns(ZPNewView.rightColumns),ZPNewView.LAYOUT.find("#zp_right_column_error").hide(),$.each(ZPNewView.leftSideSelected,function(key,value){var id=$(value).attr("id");void 0===ZPNewView.headerComponents[id+""]||id!==ZPNewView.headerComponents[id+""].formCompID?$(this).remove():$(this).find("div#parentCompDiv").removeClass("sel")}),ZPNewView.leftSideSelected={},ZPNewView.rightSideSelected={},ZPNewView.formatLeftComponents())},formatLeftComponents:function(){var currLeftChildrens=ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").children();$.each(currLeftChildrens,function(key,value){var idx=$(value).attr("id");void 0!==ZPNewView.headerComponents[idx+""]&&idx===ZPNewView.headerComponents[idx+""].formCompID&&($(value).children().next().children().length<=0&&ZPNewView.isExistInRightSide(idx)&&($(this).remove(),delete ZPNewView.leftColumns[idx]))})},moveSelectedRowToLeft:function(){Object.keys(ZPNewView.rightSideSelected).length<1||($.each(ZPNewView.rightSideSelected,function(key,value){$(this).remove(),delete ZPNewView.rightColumns[key],delete ZPNewView.allCmpName[key]}),ZPNewView.rightSideSelected={},ZPNewView.leftSideSelected={},ZPNewView.constructLeftCoulmns(ZPNewView.allComponents),$.each(ZPNewView.rightColumns,function(key,value){void 0!==ZPNewView.headerComponents[key+""]&&key===ZPNewView.headerComponents[key+""].formCompID||ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").find("#"+key).remove(),delete ZPNewView.leftColumns[key]}),ZPNewView.formatLeftComponents())},moveAllLeftToRight:function(){Object.keys(ZPNewView.leftColumns).length<1||($.each(ZPNewView.leftColumns,function(key,value){ZPNewView.rightColumns[key]=value}),ZPNewView.constructRightColumns(ZPNewView.rightColumns),ZPNewView.LAYOUT.find("#zp_right_column_error").hide(),ZPNewView.leftSideSelected={},ZPNewView.rightSideSelected={},ZPNewView.constructLeftCoulmns(ZPNewView.allComponents),$.each(ZPNewView.rightColumns,function(key,value){void 0!==ZPNewView.headerComponents[key+""]&&key===ZPNewView.headerComponents[key+""].formCompID||ZPNewView.LAYOUT.find("#zp_custom_view_left_columns").find("#"+key).remove(),delete ZPNewView.leftColumns[key]}),ZPNewView.formatLeftComponents())},moveAllRightToLeft:function(){Object.keys(ZPNewView.rightColumns).length<1||(ZPNewView.allCmpName={},ZPNewView.constructLeftCoulmns(ZPNewView.allComponents),ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children().remove(),ZPNewView.rightColumns={},ZPNewView.leftSideSelected={},ZPNewView.rightSideSelected={})},updateAction:function(){ZPNewView.saveAction(null,!0)},saveAction:function(modal,isUpdate){var isValid=!0,isFirstErrMsg=!0;ZPNewView.LAYOUT.find(".error-msg").hide();var customViewName=ZPNewView.LAYOUT.find("#zp_custom_view_name").val().trim();(""===customViewName||customViewName.length<=0)&&(ZPNewView.LAYOUT.find("#zp_custom_view_name_error").html(ZPI18N.getString("zp.viewempty")).show(),Layout.Page.container.find(".modal-body").scrollTop(0),isFirstErrMsg=!1,isValid=!1);var rightSideColumns=ZPNewView.LAYOUT.find("#zp_custom_view_right_columns").children();if(rightSideColumns.length<=0){if(ZPNewView.LAYOUT.find("#zp_right_column_error").html(ZPI18N.getString("zp.pleaseselectonecolumn",new Array(ZSEC.Encoder.encodeForHTML(ZPNewView.FORM_NAME)))).show(),isFirstErrMsg){var height=Layout.Page.container.find(".modal-body").find(".form-horizontal.pad").height();height+=Layout.Page.container.find(".modal-body").find(".row.MB20").height(),Layout.Page.container.find(".modal-body").scrollTop(height),isFirstErrMsg=!1}isValid=!1}var isDefault=ZPNewView.LAYOUT.find("#zp_custom_view_default").is(":checked"),onlyMe=ZPNewView.LAYOUT.find("#zp_custom_view_only_me").is(":checked"),allEmployee=ZPNewView.LAYOUT.find("#zp_custom_view_all_employees").is(":checked"),show_approver=(ZPNewView.LAYOUT.find("#zp_custom_view_selected_users").is(":checked"),ZPNewView.LAYOUT.find("#zp_custom_view_approval").is(":checked")),shareToAll=null,specificView=null;onlyMe||(shareToAll=allEmployee)||(specificView={},null!==ZPNewView.pickListComponent&&(specificView.employee=ZPPickList.getSelectedUsers().toString(),specificView.department=ZPPickList.getSelectedDepartments().toString(),specificView.role=ZPPickList.getSelectedRoles().toString(),specificView.location=ZPPickList.getSelectedLocations().toString()));var selectedColumnsJsonObj=[],withoutParentFC=!0;if($.each(rightSideColumns,function(key,value){var parentFC=$(value).attr("parentFCID");withoutParentFC&&"0"===parentFC&&(withoutParentFC=!1);var formCompID=$(value).attr("id"),cmpDisplayName=ZPNewView.allCmpName[formCompID].data("displayName"),cmpName=ZPNewView.allCmpName[formCompID].data("cmpName"),refFormID=$(value).attr("refFormID"),grpStr=$(value).find("#grpBy").attr("value"),isGrp=null;void 0!==grpStr&&grpStr===ZPI18N.getString("zp.capitalgrp")&&(isGrp=!0);var ascStr=$(value).find("#asc_desc").attr("value"),asc=null;void 0!==ascStr&&ascStr.length>0&&(asc=!1,ascStr===ZPI18N.getString("zp.capitalasc")&&(asc=!0),null===isGrp&&(isGrp=!1));var column={formCompID:formCompID,refFormID:refFormID,grouping:isGrp,sorting:asc,sumEnabled:$(value).find("#sumID").attr("value")===ZPI18N.getString("zp.capitalsum")};void 0!=parentFC&&"0"!=parentFC&&(column.parentFcType=ZPNewView.allComponents[parentFC+""].fcType),isUpdate&&(ZPNewView.savedComponents&&ZPNewView.savedComponents[formCompID]&&ZPNewView.savedComponents[formCompID].displayName||cmpDisplayName!==cmpName)&&(column.displayName=cmpDisplayName),selectedColumnsJsonObj.push(column)}),withoutParentFC){if(ZPNewView.LAYOUT.find("#zp_right_column_error").html(ZPI18N.getString("zp.pleaseselectonecolumn",new Array(ZSEC.Encoder.encodeForHTML(ZPNewView.FORM_NAME)))).show(),isFirstErrMsg){height=Layout.Page.container.find(".modal-body").find(".form-horizontal.pad").height();height+=Layout.Page.container.find(".modal-body").find(".row.MB20").height(),Layout.Page.container.find(".modal-body").scrollTop(height),isFirstErrMsg=!1}isValid=!1}var isValidCrt=!0,criteriaList=ZPNewView.LAYOUT.find("#zp_custom_view_criteria_table_body").children(),crtJson=[];if($.each(criteriaList,function(key){var conjunctiveCondn;conjunctiveCondn=0===key?"AND":$(this).find("#operatorSelection").val();var formComponentID=$(this).find('[iscrtfc="true"]').attr("fcid"),pfcid=$(this).find('[iscrtfc="true"]').attr("pfcid"),operator=$(this).find("[isopr='true']").val();if("-1"!==formComponentID&&"-1"!==operator){var crtValue=$(this).find("#txtValue").val(),txtValueAttr=$(this).find("#txtValue").attr("disabled"),trObj=$(this).find("#txtValue").parent().parent(),fcObj=ZPNewView.allComponents[formComponentID+""];if(-1!=pfcid&&(fcObj=ZPNewView.allComponents[pfcid+""].childComponents[formComponentID+""]),Timetracker.views.isTimetrackerSpecialFields(fcObj.tName,fcObj.labelName)){var valueJson=Timetracker.views.getValueForField(fcObj.labelName,operator);crtValue=valueJson.value,operator=valueJson.operator}var fcType=fcObj.fcType,formulaDType=fcObj.formulaDType;if(fcType==ZPForm.Field.SCRIPT&&void 0!=formulaDType&&-1!=formulaDType&&(fcType=formulaDType),operator!=ZPNewView.OPERATORS.EMPTY&&operator!=ZPNewView.OPERATORS.NOT_EMPTY&&operator!=ZPNewView.OPERATORS.YESTERDAY&&operator!=ZPNewView.OPERATORS.TODAY&&operator!=ZPNewView.OPERATORS.TOMORROW&&operator!=ZPNewView.OPERATORS.LAST_YEAR&&operator!=ZPNewView.OPERATORS.CURRENT_YEAR&&operator!=ZPNewView.OPERATORS.NEXT_YEAR&&operator!=ZPNewView.OPERATORS.LAST_MONTH&&operator!=ZPNewView.OPERATORS.THIS_MONTH&&operator!=ZPNewView.OPERATORS.NEXT_MONTH&&operator!=ZPNewView.OPERATORS.LOGIN_USERS_DEPT&&operator!=ZPNewView.OPERATORS.LOGIN_USER&&operator!=ZPNewView.OPERATORS.THIS_WEEK&&operator!=ZPNewView.OPERATORS.LAST_WEEK&&operator!=ZPNewView.OPERATORS.NEXT_WEEK&&operator!=ZPNewView.OPERATORS.TRUE&&operator!=ZPNewView.OPERATORS.FALSE&&operator!=ZPNewView.OPERATORS.LOGIN_USERS_ENTITY&&operator!=ZPNewView.OPERATORS.LOGIN_USERS_UNIT&&operator!=ZPNewView.OPERATORS.LOGIN_USERS_DIVISION&&operator!=ZPNewView.OPERATORS.SUBORDINATES_GOAL&&0==crtValue.length&&($(this).find("#zp_criteria_error").html(ZPI18N.getString("zp.invalidcriteriavalue")).show(),isValid=!1),fcType==ZPForm.Field.DATE_TIME&&(operator==ZPNewView.OPERATORS.EQUAL||operator==ZPNewView.OPERATORS.NOT_EQUAL||operator==ZPNewView.OPERATORS.GREATER_THAN||operator==ZPNewView.OPERATORS.LESS_THAN)){var dateValueSplit=crtValue.split(" ");(isValid=ZPUtil.Validation.isDate(dateValueSplit[0]))||$(this).find("#zp_criteria_error").html(ZPI18N.getString("zp.invalidcriteriavalue")).show()}if(void 0!==txtValueAttr||ZPNewView.validCriteriaValue(fcType,this,operator)||($(this).find("#zp_criteria_error").html(ZPI18N.getString("zp.invalidcriteriavalue")).show(),isValid=!1),isValid&&fcObj.isEncrypted&&fcType!=ZPForm.Field.NEW_GENDER&&fcType!=ZPForm.Field.NEW_BLOODGROUP&&operator!=ZPNewView.OPERATORS.EMPTY&&operator!=ZPNewView.OPERATORS.NOT_EMPTY&&operator!=ZPNewView.OPERATORS.EQUAL&&operator!=ZPNewView.OPERATORS.NOT_EQUAL&&($(this).find("#zp_criteria_error").html(ZPI18N.getString("zp.EncryptedCriteriaError")).show(),isValid=!1),isValid){var crt={formComponentID:formComponentID,Operator:operator,CrtVal:crtValue,conjunctiveCondn:conjunctiveCondn};if(-1!=pfcid?(crt.lookupFcId=formComponentID,crt.formComponentID=pfcid,crt.isBaseForm=!1,fcType==ZPForm.Field.LOOKUP&&(crt.lookupFcId2=fcObj.lkpFcid)):fcType==ZPForm.Field.LOOKUP&&(crt.lookupFcId=fcObj.lkpFcid,crt.isBaseForm=!0),!(fcType!=ZPForm.Field.LOOKUP&&fcType!=ZPForm.Field.PICKLIST&&fcType!=ZPForm.Field.NEW_GENDER&&fcType!=ZPForm.Field.NEW_BLOODGROUP&&fcType!=ZPForm.Field.NEW_COUNTRY||operator!=ZPNewView.OPERATORS.NOT_IN&&operator!=ZPNewView.OPERATORS.IN)){var crtValArray=[],crtID=$(trObj).attr("id"),selectedRecords=ZPNewView.crtSelectedRecords[crtID],selectionRecords=ZPNewView.crtSelectionRecords[formComponentID];void 0==selectedRecords||void 0==selectionRecords||selectedRecords.length<=0?($(this).find("#zp_criteria_error").html(ZPI18N.getString("zp.invalidcriteriavalue")).show(),isValid=!1):($.each(selectedRecords,function(key,value){$.each(selectionRecords,function(k,v){value===v.ID+""&&crtValArray.push(v.VALUE)})}),crt.dispVal=crtValArray.toString(),crt.CrtVal=selectedRecords)}crtJson.push(crt)}else isValidCrt=!1}}),isFirstErrMsg&&!isValidCrt){var bodyHeight=Layout.Page.container.find(".modal-body").find(".PL30.PR30").height();Layout.Page.container.find(".modal-body").scrollTop(bodyHeight+100),isFirstErrMsg=!1}if(isValid){var formID=ZPView.CURR_VIEWPARAMS.formId,params={mode:void 0!==isUpdate&&isUpdate?"updateView":"saveView",formID:formID,viewID:void 0!==isUpdate&&isUpdate?ZPNewView.localValues.viewID:0,expressionID:void 0!==isUpdate&&isUpdate?ZPNewView.localValues.expressionID:0,reportPermissionID:void 0!==isUpdate&&isUpdate?ZPNewView.localValues.reportPermissionID:0,viewName:customViewName,isDefaultView:isDefault,show_approver:show_approver,crtJson:JSON.stringify(crtJson),components:JSON.stringify(selectedColumnsJsonObj),shareViewToAll:shareToAll,specificView:JSON.stringify(specificView)};Layout.Page.container.find(".modal-footer").find("#zp_modal_blubtn").attr("disabled",!0),ZPeople.Request.send("/createViewAction.zp",params,ZPNewView.afterSaveAction)}},afterSaveAction:function(data){if(Layout.Page.container.find(".modal-footer").find("#zp_modal_blubtn").prop("disabled",!1),void 0===data.error)if(data.viewDetails.isSuccess||data.viewDetails.isValidCriteria){ZPNewView.LASTVIEWID=data.viewDetails.viewId;var mdata=ZPeople.Module.getData(),viewDetails=mdata.viewDetails.message;if("true"===data.viewDetails.isDefaultView&&$.each(viewDetails,function(key,value){this.isDefaultView=!1}),"ADD"===data.action){var newObj={displayName:data.viewDetails.displayName,isDefaultView:"true"===data.viewDetails.isDefaultView,viewId:data.viewDetails.viewId,viewType:data.viewDetails.viewType,viewName:data.viewName,isCustomView:"true"===data.viewDetails.isCustomView,isSharedView:"true"===data.viewDetails.isSharedView,ownerId:data.viewDetails.ownerId};mdata.viewDetails.message.push(newObj)}else{var oldViewObj=ZPNewView.getViewDetailByID(data.viewDetails.viewId);if(void 0!==oldViewObj){var index=mdata.viewDetails.message.indexOf(oldViewObj);mdata.viewDetails.message.splice(index,1),oldViewObj.displayName=data.viewDetails.displayName,"true"===data.viewDetails.isDefaultView?oldViewObj.isDefaultView=!0:oldViewObj.isDefaultView=!1,"true"===data.viewDetails.isCustomView?oldViewObj.isCustomView=!0:oldViewObj.isCustomView=!1,"true"===data.viewDetails.isSharedView?oldViewObj.isSharedView=!0:oldViewObj.isSharedView=!1,mdata.viewDetails.message.push(oldViewObj)}}mdata.viewDetails.loaded=!1,ZPView.constructViews();var extOptions=Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2().find("option");extOptions.length>3?Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2("destroy").html(extOptions).select2().select2("val",[ZPNewView.LASTVIEWID]):Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2("destroy").html(extOptions).select2({minimumResultsForSearch:1/0}).select2("val",[ZPNewView.LASTVIEWID]),Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").trigger("change"),ZPeople.BSModal.hide()}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.invalidentries"));else ZPNewView.showErrorMessage(data,"zp.addmodifyerror")},afterDeleteAction:function(data){if(void 0===data.error){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.viewdeletedsuccess")),ZPNewView.LASTVIEWID=data.defaultViewID,Layout.UrlConf.isModuleForm()&&(ZPNewView.LASTVIEWID="systemview");for(var extOptions=Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2().find("option"),newOptions="",i=0;i<extOptions.length;i++)extOptions[i].value!==data.deletedViewID&&(newOptions+='<option value="'+extOptions[i].value+'">'+extOptions[i].text+"</option>");var oldViewObj=ZPNewView.getViewDetailByID(data.deletedViewID);if(void 0!==oldViewObj){var mdata=ZPeople.Module.getData(),index=mdata.viewDetails.message.indexOf(oldViewObj);mdata.viewDetails.message.splice(index,1)}extOptions.length-1>3?Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2("destroy").html(newOptions).select2().select2("val",[ZPNewView.LASTVIEWID]):Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").select2("destroy").html(newOptions).select2({minimumResultsForSearch:1/0}).select2("val",[ZPNewView.LASTVIEWID]),Layout.Page.container.find("#zp_views_viewlist").find("#zp_select_viewlist").trigger("change"),window.location.href=ZPView.getURL(ZPNewView.LASTVIEWID)}else ZPNewView.showErrorMessage(data,"zp.errordeleteview")},sharedTo:function(){var selectedUsers=ZPNewView.LAYOUT.find("#zp_custom_view_selected_users").is(":checked"),shareToDiv=ZPNewView.LAYOUT.find("#zp_custom_view_sharedto");if(selectedUsers){if(shareToDiv.removeClass("DN"),null===ZPNewView.pickListComponent){var sharedTempTxt=$(ZPPickList.picklistComponentTemplate);ZPNewView.LAYOUT.find("#applicableToComponent").html(sharedTempTxt);var keys=[];keys.push(ZPPickList.CONSTANTS.USERS),keys.push(ZPPickList.CONSTANTS.DEPARTMENTS),keys.push(ZPPickList.CONSTANTS.ROLES),keys.push(ZPPickList.CONSTANTS.LOCATIONS),ZPNewView.pickListComponent=ZPPickList.init(keys)}ZPNewView.LAYOUT.find("#applicableToComponent").html(ZPNewView.pickListComponent),ZPNewView.LAYOUT.find("#applicableToComponent").find("#pickListComp").find(".dropdown-menu").addClass("ZPSchPoP")}else shareToDiv.addClass("DN")},loadCrtRequiredRecords:function(fcID,fcType){void 0===ZPNewView.crtSelectionRecords[fcID]&&void 0!==fcID&&$.ajax({type:"POST",async:!1,url:"/createViewAction.zp",data:{mode:"getLookupList",conreqcsr:csrfToken,selectedLookupType:fcID,fcType:fcType},success:function(data){ZPNewView.crtSelectionRecords[fcID]=data.lookupDetailsList}})},constructCrtSelectionRecord:function(crtID,selectionRecord,fcType,fcId){if(jQuery.isEmptyObject(selectionRecord)||selectionRecord.length<=0)ZPNewView.LAYOUT.find("#"+crtID+" #ulList").html(ZPI18N.getString("zp.norec"));else{var li="";$.each(selectionRecord,function(key,value){li+="<li id='"+value.ID+"'><div class='MT3'><label class='checkbox DIB PT8 MR10'><input id='"+value.ID+"' type='checkbox' onclick='ZPNewView.crtSelectRecord(this)'><span class='ML2'>"+value.DISPVALUE+"</span></label></div></li>"}),ZPNewView.LAYOUT.find("#"+crtID+" #ulList").html(li)}},crtAllCheckSelect:function(obj){var isAllChecked=$(obj).is(":checked"),childList=$(obj).parent().parent().parent().find("#ulList").children(),childLength=childList.length;isAllChecked?childLength>0?($.each(childList,function(key,value){$(this).find("input")[0].checked=!0,ZPNewView.crtSelectRecord($(this).find("input"))}),$(obj)[0].checked=!0):$(obj).prop("checked",!1):childLength>0&&$.each(childList,function(key,value){$(this).find('.checkbox input[type="checkbox"]').prop("checked",!1),ZPNewView.crtSelectRecord($(this).find("input"))})},crtSelectRecord:function(obj){var isChecked=$(obj).is(":checked"),tr=$(obj).parent().parent().parent().parent().parent().parent().parent().parent().parent().parent().parent().parent().parent(),inp=tr.find('[iscrtfc="true"]'),pfcid=inp.attr("pfcid"),fcid=inp.attr("fcid"),fcObj=ZPNewView.allComponents[fcid+""];-1!=pfcid&&(fcObj=ZPNewView.allComponents[pfcid+""].childComponents[fcid+""]);var fcType=fcObj.fcType;if($(tr).find("#crtAllCheck").is(":checked"))$(tr).find("#crtAllCheck").prop("checked",!1);else{var childList=$(tr).find("#ulList").children();childList.length===childList.find(".checkbox input[type='checkbox']:checked").length&&($(tr).find("#crtAllCheck")[0].checked=!0)}var crtID=$(tr).attr("id"),selectedRecords=ZPNewView.crtSelectedRecords[crtID];void 0===selectedRecords&&(selectedRecords=[]);var id=$(obj).attr("id"),index=selectedRecords.indexOf(id);isChecked?-1===index&&selectedRecords.push(id):-1!==index&&selectedRecords.splice(index,1),ZPNewView.crtSelectedRecords[crtID]=selectedRecords,ZPNewView.displayCrtTxt(crtID,fcType)},displayCrtTxt:function(crtID,fcType){ZPNewView.LAYOUT.find("#"+crtID).find("#crtValueTD #txtValue").val(void 0);var fcID=ZPNewView.LAYOUT.find("#"+crtID).find('[iscrtfc="true"]').attr("fcid"),nameArr=ZPNewView.getRecordNamesByFcID(crtID,fcID,fcType);ZPNewView.LAYOUT.find("#"+crtID).find("#crtValueTD #txtValue").val(nameArr.toString())},getRecordNamesByFcID:function(crtID,fcID,fcType){if(void 0===fcID)return null;var selectedRecords=ZPNewView.crtSelectedRecords[crtID],selectionRecords=ZPNewView.crtSelectionRecords[fcID],tempList=[];return void 0===selectedRecords||void 0===selectionRecords?tempList:($.each(selectedRecords,function(key,value){$.each(selectionRecords,function(k,v){value===v.ID+""&&tempList.push(ZPeople.decodeTxt(v.DISPVALUE))})}),tempList)},makeSelectable:function(crtID,selectedRecord){ZPNewView.LAYOUT.find("#"+crtID).find("#crtAllCheck").prop("checked",!1);var fcID=ZPNewView.LAYOUT.find("#"+crtID).find('[iscrtfc="true"]').attr("fcid"),childList=ZPNewView.LAYOUT.find("#"+crtID).find("#ulList").children(),originalTotalLength=ZPNewView.crtSelectionRecords[fcID].length;if(!(originalTotalLength<=0)){selectedRecord.length===originalTotalLength&&(ZPNewView.LAYOUT.find("#"+crtID).find("#crtAllCheck")[0].checked=!0),$.each(selectedRecord,function(key,value){var row=$(childList).find("input#"+value);void 0!==row&&row.length>0&&(row[0].checked=!0)});var checkBoxSelectedCount=ZPNewView.LAYOUT.find("#"+crtID).find("#ulList").children("li").find("input[type='checkbox']:checked").length,currChildlength=$(childList).length;0===checkBoxSelectedCount&&0===currChildlength?ZPNewView.LAYOUT.find("#"+crtID).find("#crtAllCheck").prop("checked",!1):checkBoxSelectedCount===currChildlength?ZPNewView.LAYOUT.find("#"+crtID).find("#crtAllCheck")[0].checked=!0:ZPNewView.LAYOUT.find("#"+crtID).find("#crtAllCheck").prop("checked",!1)}},getViewDetailByID:function(viewID){var viewDetailObj=void 0;return $.each(ZPeople.Module.getData().viewDetails.message,function(key,value){value.viewId!==viewID||(viewDetailObj=value)}),viewDetailObj},showErrorMessage:function(data,msg){void 0!==data.error&&(void 0!==data.error.message?ZPeople.Message.showFailureMsg(data.error.message):void 0!==data.error.exception&&ZPeople.Message.showFailureMsg(ZPI18N.getString(msg)))},getParentCompNameByID:function(parentFCID){var name=void 0;return void 0!==parentFCID&&"0"!==parentFCID&&(name=ZPNewView.headerComponents[parentFCID+""].formCompName),name},getOriginalName:function(fcID){var name=void 0;if(void 0!==fcID)if(-1!==fcID.indexOf("_")){var ids=fcID.split("_");name=ZPNewView.allComponents[ids[0]].childComponents[ids[1]].formCompName}else name=ZPNewView.allComponents[fcID].formCompName;return name},isEqual:function(obj1,obj2){return obj1===obj2}},ValidationRule={baseFCs:{},ruleGroupTemplate:'<div class="panel-group dvvalidruleacc" id="dvValidruleparent">$RULECONSTRUCT$</div>',errorTemplate:'<div class="dverrormsg DN" errorid="errorDiv"></div>',ruleHeaderTemplate:'<div class="panel clearfix" name="singleRuleDiv"><a name="deleteIcon" class="IC-delete gry FR lnkcls" onclick="ValidationRule.deleteRule({}, {forPost:true}, {obj:this})"></a><div name="ruleToggleDiv" class="GryBG panel-heading PT5 PL10 PB3" data-parent="#dvValidruleparent" data-target="#dvRule$COUNT$" ruleid="$RULEID$" onclick="ZPFRules.collapseElement(this)"><h6 class="ZPbold S16">'+ZPI18N.getString("zp.rule")+' $COUNT$</h6></div><div id="dvRule$COUNT$" class="panel panel-collapse collapse"><div class="basefield spnpostxt" baseid="" id="$RULEID$"><label>BASE FC</label>$SELECTBOX$</div><div ruleid="$RULEID$" actionid="$ACTIONID$" class="col-md-12"><div class="dvCriteria clearfix dvfrmaddrule MT35"><div class="clearfix PB5"></div>$RULEDIV$</div><div class="dverrormsg DN" errorid="errorDiv"></div></div></div></div>',ruleBaseFCTemplate:'<div class="form-group" id="$RULEID$"><label>BASE FC</label>$SELECTBOX$</div>',selectTemplate:'<select $DISABLED$ class="selectBox" keyname="$KEYNAME$" onchange="$METHOD$" $MULTIPLE$>$OPTIONS$</select>',ruleConditionTemplate:'<div class="form-group $CLASS$" id="$ID$" name="$NAME$" key="$KEY$">$CONDITION$</div>',addRemoveTemplate:'<div class="form-group col-md-1" name="addRemoveDiv"><div class="dvlist-action MT8"><a class="IC-plus-big S12 MR15 gry" onclick="ZPFRules.addDeleteCondition(this, true)"></a><a class="IC-mins gry S12" onclick="ZPFRules.addDeleteCondition(this, false)"></a></div></div>',optionsTemplate:'<div class="tabvertical tabselect DN" id="conditionDropdownSelection"><div class="rhttablst"><div class="dvPopsearch"><input class="form-control" onkeyup="ZPFRules.searchOptions(this)" type="search" placeholder="'+ZPI18N.getString("zp.search")+'..."></div><ul class="list-group ulRecipient" role="tablist" id="listBody">$LIST$</ul></div></div>',liTemplate:'<li name="list-group-item" class="$CLASS$" onclick="ZPFRules.conditionSelectRecord(this)"><span data-toggle="tab" role="tab" name="mOpt" id="$LISTID$">$LISTVALUE$</span></li>',andorTemplate:'<div class="form-group col-md-12 ML15" key="conjunctiveCondn" name="operatorDiv" rulenum="$NUM$"><div class="input-group"><select class="selectBox" keyname="conjunctiveCondn" onchange="ValidationRule.updateOperatorPattern(this,$IND$)"><option $ANDSELECTED$ value="and">'+ZPI18N.getString("zp.captialand")+'</option><option $ORSELECTED$ value="or">'+ZPI18N.getString("zp.captialor")+"</option></select></div></div>",RULE_DETAILS:{},addRuleMethod:"addUpdate",fetchRule:"fetchRule",deleteRule:"deleteRule",ruleUrl:"/validationRules.zp",formid:"",selectOperator:{},validationType:1,validationTypes:{FORM:1,BLUEPRINT:2}},ValidationRule.validationKeys={fcid:"formComponentID",operator:"Operator",value:"CrtVal",conjunctiveCondn:"conjunctiveCondn"},ValidationRule.selectOperator[ZPNewView.OPERATORS.NOT_EQUAL]=ZPNewView.OPERATORS.NOT_IN,ValidationRule.selectOperator[ZPNewView.OPERATORS.EQUAL]=ZPNewView.OPERATORS.IN,ValidationRule.selectOperator[ZPNewView.OPERATORS.NOT_IN]=ZPNewView.OPERATORS.NOT_EQUAL,ValidationRule.selectOperator[ZPNewView.OPERATORS.IN]=ZPNewView.OPERATORS.EQUAL,ValidationRule.addRule=function(formId,validationType){if(ValidationRule.validationType=void 0!=validationType?validationType:1,ValidationRule.formid=formId,void 0==ZPForm.FORM_COMPONENT_DATA[formId])ZPFRules.getFormComponents({},{},{forPost:!0,formId:formId,isValidation:!0});else{var fc=ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails;if(1==fc.length&&0==fc[0].column1.length&&0==fc[0].column2.length){var ruleDiv=ZPeople.createModalPopup("rule",ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName]),"popRgtModel PopMdModel modal-right"),emptyFormDiv='<div class="col-lg-12 text-center"><div id="zp_views_norecclass" class="PArds"></div><h2 id="zp_nodata" class="ZPNdt">'+ZPI18N.getString("zp.emptyform")+"</h2></div>";$(ruleDiv).find("#bodyTag").html(emptyFormDiv)}else ValidationRule.validationType==ValidationRule.validationTypes.BLUEPRINT?Blueprint.Validation.rulesConstruction(formId,Blueprint.currentValidationJson):void 0==ValidationRule.RULE_DETAILS[formId]?ValidationRule.getRuleDetails({},{},{forPost:!0,formId:formId}):(ValidationRule.baseFCs[formId]=[],ValidationRule.rulesConstruction(formId))}},ValidationRule.getRuleDetails=function(data,params,others){others.hasOwnProperty("forPost")?(delete others.forPost,ZPeople.Request.send(ValidationRule.ruleUrl,{method:ValidationRule.fetchRule,formId:others.formId},ValidationRule.getRuleDetails,others)):(void 0!=data&&data.hasOwnProperty("rulesJson")?ValidationRule.RULE_DETAILS[params.formId]=data.rulesJson:ValidationRule.RULE_DETAILS[params.formId]={},ValidationRule.baseFCs[params.formId]=[],ValidationRule.rulesConstruction(params.formId))},ValidationRule.rulesConstruction=function(formId,validationJson){var ruleDiv=ZPeople.createModalPopup("validationrule",ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName]),"popRgtModel PopMdModel modal-right");$(ruleDiv).find("[buttonname=done]").html(ZPI18N.getString("zp.save")),$(ruleDiv).find("[buttonname=done]").siblings("[buttonaction]").html(ZPI18N.getString("zp.close")),$(ruleDiv).find("[buttonname=done]").unbind(),$(ruleDiv).find("[buttonname=done]").click(function(){ValidationRule.ruleCreation(this)}),0==$(ruleDiv).find("#addRule").length&&ValidationRule.validationType!=ValidationRule.validationTypes.BLUEPRINT&&$('<a class="btn btn-default btnaddrule" id="addRule" onclick="ValidationRule.addNewRule(this)">'+ZPI18N.getString("zp.addrule")+"</a>").insertAfter($(ruleDiv).find("[buttonaction]").first()),$(ruleDiv).find("#bodyTag").attr("formId",formId);var ruleHtml="";if(void 0!=validationJson?(ZPFRules.count=1,ruleHtml+=ValidationRule.singleRuleAdd(formId,validationJson)):ValidationRule.RULE_DETAILS[formId].length>0?$.each(ValidationRule.RULE_DETAILS[formId],function(index,rule){ZPFRules.count=parseInt(index)+1,ruleHtml+=ValidationRule.singleRuleAdd(formId,rule)}):(ZPFRules.count=1,ruleHtml=ValidationRule.singleRuleAdd(formId,{})),""==ruleHtml){var emptyFormDiv='<div class="col-lg-12 text-center"><div id="zp_views_norecclass" class="PArds"></div><h2 id="zp_nodata" class="ZPNdt">'+ZPI18N.getString("zp.emptyform")+"</h2></div>";$(ruleDiv).find("h4").replaceWith('<h6 class="modal-title S16">'+ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName])+"</h6>"),$(ruleDiv).find("#bodyTag").html(emptyFormDiv)}else{var ruleGrp=ValidationRule.ruleGroupTemplate;ruleGrp=ruleGrp.replace(/\$RULECONSTRUCT\$/g,ruleHtml),$(ruleDiv).find("#bodyTag").html(ruleGrp),$(ruleDiv).find("[makeEmpty=true]").val(""),$(ruleDiv).find("#dvRule1").addClass("fade in"),$(ruleDiv).find("h4").replaceWith('<h6 class="modal-title S16">'+ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName])+"</h6>"),$(ruleDiv).find("select").select2()}},ValidationRule.singleRuleAdd=function(formId,rule){var mainDiv=ValidationRule.ruleHeaderTemplate;mainDiv=mainDiv.replace(/\$COUNT\$/g,ZPFRules.count);var ruleId=void 0!=rule&&rule.hasOwnProperty("VALIDATION_RULE_ID")?rule.VALIDATION_RULE_ID:"";mainDiv=mainDiv.replace(/\$RULEID\$/g,ruleId);var ruleDiv='<div class="clearfix">';fields=ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails;var others={fields:fields,formId:formId};void 0!=rule&&Object.keys(rule).length>0&&(others.fieldArray=[rule.BASE_FCID],others.disabled=!0),others.firstFieldFix=!0,selDiv=ValidationRule.addFieldsForSelect(others.fields,others),ruleDiv=ruleDiv.replace("$SELECTBOX$",selDiv),mainDiv=mainDiv.replace("$SELECTBOX$",selDiv);var fcId=ZPFRules.findFirstFcId(fields,formId,ZPForm.FORM_COMPONENT_DATA[formId].formDetails.tableName),conditionArray=rule.hasOwnProperty("baseConditions")?rule.baseConditions:ValidationRule.validationType==ValidationRule.validationTypes.BLUEPRINT?[{formComponentID:rule.BASE_FCID}]:[{formComponentID:fcId}];return $.each(conditionArray,function(index,condition){mainDiv=mainDiv.replace(/\$ACTIONID\$/g,condition.hasOwnProperty("VALIDATION_ACTION_ID")?condition.VALIDATION_ACTION_ID:""),ruleDiv+='<div class="form-group spnpostxt" name="vmsg"><label>Validation Message</label><input id="message" type="text" class="form-control DIB" value="'+(void 0!=condition.VALIDATION_MSG?condition.VALIDATION_MSG:"")+'"/>'+ZPFRules.errorTemplate+"</div>",ruleDiv+=ValidationRule.constructConditions(condition,fcId,formId,others);var DN="DN";val="",condition.hasOwnProperty("PATTERNTEXT")&&""!=condition.PATTERNTEXT.trim()&&(DN="",val=condition.PATTERNTEXT),ruleDiv+='<div class="col-md-7 ML35 PL100 '+DN+'" id="patternDiv"><input value="'+val+'" class="col-md-5" type="text"/><input class="col-md-2 FR"  type="button" onclick="ValidationRule.validatePattern(this)" value="Save"/></div>',ruleDiv+='<div class="dverrormsg DN form-group col-md-7 ML15" errorid="errorDiv"></div>'}),""==ruleDiv?ruleDiv:(ruleDiv+="</div>",mainDiv=mainDiv.replace(/\$RULEDIV\$/g,ruleDiv))},ValidationRule.addFieldsForSelect=function(fields,others){var selectDiv=ValidationRule.selectTemplate;selectDiv=(selectDiv=(selectDiv=(selectDiv=selectDiv.replace(/\$METHOD\$/g,"ValidationRule.updateFirstField(this)")).replace(/\$KEYNAME\$/g,"BASE_FCID")).replace(/\$MULTIPLE\$/g,others.hasOwnProperty("multiple")?"multiple":"")).replace(/\$DISABLED\$/g,others.disabled?"disabled":"");var options="",actionArray=ValidationRule.baseFCs[others.formId],formTableName=ZPForm.FORM_COMPONENT_DATA[others.formId].formDetails.tableName;return $.each(fields,function(index1,section){options+="<optgroup label="+section.sectionName+" secid="+section.sectionId+">",$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){if(void 0!=field&&!ZPUtil.checkIsExistInArray(actionArray,field.formComponentId)&&!section.isTabular&&ZPFRules.isFieldAllowed(!0,field,others.fieldArray,formTableName,actionArray)){!1;var selected=$.inArray(field.formComponentId,others.fieldArray)>-1?"selected":"";options+='<option value="'+field.formComponentId+'" '+selected+">"+field.displayName+"</option>"}})}),options+="</optgroup>"}),selectDiv=selectDiv.replace(/\$OPTIONS\$/g,options)},ValidationRule.constructPatternAdd=function(parentDiv,addInd,addOperator){var patternText=parentDiv.find("#patternDiv input").first().val();if((patternText=patternText.replace(/\s/g,"")).length>0){if((patternText="("+patternText).indexOf(addInd)>-1){var indexValue=(patternText=patternText.replace(/[\d]/g,function(match){return parseInt(match)>=addInd?parseInt(match)+1:parseInt(match)})).indexOf(addInd-1)+(addInd-1).toString().length,updateSubStr=patternText.substr(indexValue);patternText=patternText.substr(0,patternText.indexOf(addInd-1)+1),patternText+=addOperator+addInd+")"+updateSubStr}else patternText+=addOperator+addInd+")";patternText=(patternText=patternText.replace(/and/g," and ")).replace(/or/g," or ")}else patternText="(1 and 2)";parentDiv.find("#patternDiv input").first().val(patternText)},ValidationRule.constructPatternDelete=function(parentDiv,deleteInd,deleteOperator){var patternText=parentDiv.find("#patternDiv input").first().val(),updateSubStr=(patternText=patternText.replace(/\s/g,"")).split(deleteInd)[0],firstInd=patternText.indexOf(deleteInd)+1;if(deleteInd>1){var delOpInd=updateSubStr.lastIndexOf(deleteOperator);patternText=(patternText=(updateSubStr=updateSubStr.substr(0,delOpInd)+updateSubStr.substr(delOpInd+deleteOperator.length))+patternText.substr(firstInd)).replace("()","")}else patternText=(patternText=updateSubStr+patternText.substr(firstInd).replace(deleteOperator,"")).replace("()","");patternText=patternText.replace(/[\d]/g,function(match){return parseInt(match)>deleteInd?parseInt(match)-1:parseInt(match)}),parentDiv.find("#patternDiv input").first().val(patternText)},ValidationRule.updateOperatorPattern=function(obj){var parentDiv=$(obj).parents("#bodyTag").find("[id*=dvRule]:visible"),updateInd=parseInt($(obj).parents("[name=operatorDiv]").next("#criteriaInd").attr("ind")),patternText=parentDiv.find("#patternDiv input").first().val();if((patternText=patternText.replace(/\s/g,"")).length>0){var subStr=patternText.substr(0,patternText.indexOf(updateInd)),prevOperator="and"===$(obj).val()?"or":"and",ind=subStr.lastIndexOf(prevOperator),finalText=subStr.substr(0,ind);finalText+=subStr.substr(ind).replace(prevOperator,$(obj).val()),finalText=(finalText=(finalText+=patternText.substr(patternText.indexOf(updateInd))).replace(/and/g," and ")).replace(/or/g," or "),parentDiv.find("#patternDiv input").first().val(finalText)}},ValidationRule.validatePattern=function(obj){var parentDiv=$(obj).parents("#bodyTag").find("[id*=dvRule]:visible");parentDiv.find("[id*=dvRule]").children("[errorid=errorDiv]").html(""),parentDiv.find("[id*=dvRule]").children("[errorid=errorDiv]").show();var patternText=parentDiv.find("#patternDiv input").first().val(),errorMsg="";if((patternText=patternText.replace(/\s/g,"")).match(/\(/g).length!=patternText.match(/\)/g).length)return errorMsg="Pattern brackets do not match",parentDiv.find("#dvRule1").children("[errorid=errorDiv]").html(errorMsg),!0;var invalid_number,lastInd=parseInt(parentDiv.find("[id=criteriaInd]").last().attr("ind"));for(presentNumbers=patternText.match(new RegExp(/\d/g)),numind=0;numind<presentNumbers.length;numind++)if(presentNumbers[numind]>lastInd){invalid_number=presentNumbers[numind];break}if(void 0!=invalid_number)return errorMsg="Please check the pattern at "+patternDiv.match(invalid_number),parentDiv.find("#dvRule1").children("[errorid=errorDiv]").html(errorMsg),!0;for(var ind=0,numberMatch=patternText.match(/[\d]/g);ind<numberMatch.length;)if(ind+1!=numberMatch[ind++])return errorMsg="Please check the pattern at "+numberMatch[ind-1],parentDiv.find("#dvRule1").children("[errorid=errorDiv]").html(errorMsg),!0;var totalCriterias=parentDiv.find("[id=criteriaInd]").length,operMatch=patternText.match(/and|or/g);if(numberMatch.length!=totalCriterias||operMatch.length!=totalCriterias-1)return errorMsg="The Criteria Pattern does not match the conditions you've chosen.",parentDiv.find("#dvRule1").children("[errorid=errorDiv]").html(errorMsg),!0;for(ind=0;ind<operMatch.length;)parentDiv.find("[name=operatorDiv]").eq(ind).find("select").val(operMatch[ind++]).select2()},ValidationRule.ruleCreation=function(obj){var parentDiv=$(obj).parents("#validationrule").find("#bodyTag [id*=dvRule]:visible");""==parentDiv.find("#message").val().trim()?(hasError=!0,parentDiv.find("[name=vmsg] [errorid=errorDiv]").html(ZPI18N.getString("zp.entervalueforcondn")),parentDiv.find("[name=vmsg] [errorid=errorDiv]").show()):hasError=ZPFRules.validateRuleDiv(parentDiv);var baseFC=parentDiv.find("[baseid] select[keyname=BASE_FCID]").val();if(!hasError&&parentDiv.find("#patternDiv").is(":visible")&&(hasError=ValidationRule.validatePattern(Layout.Page.container.find("#patternDiv input[type=button]"))),!hasError){var validationJson={VALIDATION_MSG:parentDiv.find("#message").val(),VALIDATIONTYPE:ValidationRule.validationType},patternText=parentDiv.find("#patternDiv input").first().val();patternText=patternText.replace(/\s/g,"");for(;null!=patternText.match(/\(/g);){var replaceText="$"+patternText.match(/\(/g).length+"$-",lastInd=patternText.lastIndexOf("("),finalText=patternText.substr(lastInd+1),firstInd=finalText.indexOf(")");finalText=finalText.substr(0,firstInd)+replaceText+finalText.substr(firstInd+1),patternText=patternText.substr(0,lastInd)+replaceText+finalText}patternText=parentDiv.find("[id=criteriaInd]").length>1?ValidationRule.removeDummyBrackets(patternText):"1",validationJson.secondaryConditions=ValidationRule.constructSec(patternText,parentDiv),void 0!=parentDiv.find("[ruleid]").attr("actionid")&&""!=parentDiv.find("[ruleid]").attr("actionid").trim()&&(validationJson.VALIDATION_ACTION_ID=parentDiv.find("[ruleid]").attr("actionid")),validationJson.PATTERNTEXT=patternText.trim().length>1?ValidationRule.convertToBrackets(patternText):"",parentDiv.find("#patternDiv input[type=text]").val(validationJson.PATTERNTEXT);var validationsJson={BASE_FCID:baseFC,baseConditions:[validationJson]};void 0!=parentDiv.find("[ruleid]").attr("ruleid")&&""!=parentDiv.find("[ruleid]").attr("ruleid").trim()&&(validationsJson.VALIDATION_RULE_ID=parentDiv.find("[ruleid]").attr("ruleid")),validationsJson.VALIDATIONTYPE=ValidationRule.validationType,ZPeople.Request.send(ValidationRule.ruleUrl,{method:ValidationRule.addRuleMethod,validationJson:JSON.stringify(validationsJson),formId:$(obj).parents("#validationrule").find("#bodyTag").attr("formid")},ValidationRule.handleResponse)}},ValidationRule.handleResponse=function(data,params){if(data.hasOwnProperty("message")&&data.message==zpconst.CommonMessages.SUCCESSMSG){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.updatesuccessful"));var ruleID=data.validationJson.VALIDATION_RULE_ID,index=ZPFRules.findObject(ValidationRule.RULE_DETAILS[params.formId],"VALIDATION_RULE_ID",ruleID,"index").index;void 0==index&&(index=ValidationRule.RULE_DETAILS[params.formId].length),ValidationRule.RULE_DETAILS[params.formId][index]=data.validationJson,ZPFRules.count=++index;var ruleHTml=$(ValidationRule.singleRuleAdd(params.formId,data.validationJson));ruleHTml.find("select").select2(),Layout.Page.container.find("#dvValidruleparent #dvRule"+index).parents("[name=singleRuleDiv]").replaceWith(ruleHTml),Layout.Page.container.find("#dvValidruleparent #dvRule"+index).parents("[name=singleRuleDiv]").find("[name=ruleToggleDiv]").click()}},ValidationRule.constructJson=function(crInd,parentDiv,json,others){parentDiv.find("[rulenum="+crInd+"]").each(function(){var keyname=$(this).attr("key"),keyval=$(this).find("[keyname] input,select[keyname]").val();if(json.hasOwnProperty(keyname)||(json[keyname]=keyval),keyname==ValidationRule.validationKeys.operator&&$.inArray(parseInt(keyval),[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1){var field=ZPForm.Field.getFieldComponent(json[ValidationRule.validationKeys.fcid],ValidationRule.formid);if(field.fieldType==ZPForm.Field.PICKLIST||field.fieldType==ZPForm.Field.LOOKUP){json[keyname]=ValidationRule.selectOperator[keyval],json.dispVal=$(this).next("#fieldValue").find("input#fieldValue").val();var valArr=[];$(this).next("#fieldValue").find("#conditionDropdownSelection #listBody li.sel").each(function(){valArr.push($(this).find("span").attr("id"))}),json[ValidationRule.validationKeys.value]=JSON.stringify(valArr),field.fieldType==ZPForm.Field.LOOKUP&&(json.lookupFcId=field.referredfcId,json.isBaseForm=!0)}}})},ValidationRule.constructSec=function(patternText,parentDiv){var subArr=[],secArr=[];if(null!=patternText.match(/\$[\d]+\$-/g)){var firstBr=patternText.match(/\$[\d]+\$-/g)[0],firstBrLen=patternText.match(/\$[\d]+\$-/g)[0].length;0==patternText.indexOf(firstBr)&&patternText.lastIndexOf(firstBr)==patternText.length-firstBrLen&&(patternText=patternText.substr(firstBrLen,patternText.length-2*firstBrLen))}if(patternText.trim().length>0)if(null!=patternText.match(/\$[\d]+\$-/g)){var halfText,substr=patternText.match(/\$[\d]+\$-/g)[0],stInd=patternText.indexOf(substr),endInd=patternText.lastIndexOf(substr),subLen=substr.length,arrInd=0;if(stInd>0)if(null!=(criterias=(halfText=patternText.substr(0,stInd)).match(/[\d]/g)))for(var cInd=0;cInd<criterias.length;){var criteria=criterias[cInd++],crJson={};ValidationRule.constructJson(criteria,parentDiv,crJson),secArr[arrInd++]=crJson}if(subArr=ValidationRule.constructSec(patternText.substr(stInd+subLen,endInd-stInd-subLen),parentDiv),Object.keys(subArr).length>0&&(secArr[arrInd++]={secondaryConditions:subArr}),null!=(halfText=patternText.substr(endInd+subLen+1)).match(/\$[\d]\$-/))subArr=ValidationRule.constructSec(halfText,parentDiv),Object.keys(subArr).length>0&&(secArr[arrInd++]={secondaryConditions:subArr});else if(null!=(criterias=halfText.match(/[\d]/g)))for(cInd=0,crJson={};cInd<criterias.length;){criteria=criterias[cInd++];ValidationRule.constructJson(criteria,parentDiv,crJson),secArr[arrInd++]=crJson}}else{var criterias;arrInd=0;if(null!=(criterias=patternText.match(/[\d]/g)))for(cInd=0;cInd<criterias.length;){criteria=criterias[cInd++],crJson={};ValidationRule.constructJson(criteria,parentDiv,crJson),secArr[arrInd++]=crJson}}return secArr},ValidationRule.constructConditions=function(condition,fcId,formId,others,index,patternText){void 0==index&&(index=1),ZPFRules.count=index;var tempDiv="",ruleDiv="";if(condition.hasOwnProperty(ValidationRule.validationKeys.conjunctiveCondn)){ruleDiv+=ValidationRule.andorTemplate;var selTxt="and"==condition[ValidationRule.validationKeys.conjunctiveCondn]?"$ANDSELECTED$":"$ORSELECTED$";ruleDiv=(ruleDiv=(ruleDiv=ruleDiv.replace(selTxt,"selected")).replace(/\$[a-z]+SELECTED\$/,"")).replace(/\$(IND|NUM)\$/g,index)}if(condition.hasOwnProperty(ValidationRule.validationKeys.fcid)){if(others.fieldDtl=ZPForm.Field.getFieldComponent(condition[ValidationRule.validationKeys.fcid],formId),void 0==others.fieldDtl&&(others.fieldDtl={}),others.fieldArray=[condition[ValidationRule.validationKeys.fcid]],others.id=[condition.conditionId],others.formId=formId,tempDiv=ZPFRules.createRuleConditionFromTemplate("col-md-3 ML15","conditionFields",others,ValidationRule.validationKeys.fcid),delete others.firstFieldFix,""==tempDiv)return ruleDiv;ruleDiv+='<label name="conditionDiv" class="FL ML20 PT5" ind='+index+' id="criteriaInd">'+index+"</label>",ruleDiv+=tempDiv,others.condition=condition[ValidationRule.validationKeys.operator],ruleDiv+=ZPFRules.createRuleConditionFromTemplate("col-md-3","condition",others,ValidationRule.validationKeys.operator),others.fieldValue=condition.hasOwnProperty(ValidationRule.validationKeys.value)?condition[ValidationRule.validationKeys.value]+"":"",others.fieldValue=others.fieldValue.replace(/\[|\]|"/g,""),ruleDiv+=ZPFRules.createRuleConditionFromTemplate("col-md-4","fieldValue",others,ValidationRule.validationKeys.value),ruleDiv+=ZPFRules.addRemoveTemplate,index++,ZPFRules.count=index}if(condition.hasOwnProperty("secondaryConditions")){var sConditions=condition.secondaryConditions;$.each(sConditions,function(scInd,sCondition){ruleDiv+=ValidationRule.constructConditions(sCondition,fcId,formId,others,ZPFRules.count)})}return ruleDiv},ValidationRule.updatestaticIndex=function(patternText,totalBracket,staticInd,endInd,substr){return totalBracket=null!=patternText.match(/\$[\d]+\$-/g)?patternText.match(/\$[\d]+\$-/g).length/2:1,patternText.lastIndexOf(substr),totalBracket},ValidationRule.updateDollars=function(patternText,ind){var len=0;for(presentNumbers=patternText.match(new RegExp(/\d/g)),numind=0;numind<presentNumbers.length;numind++)presentNumbers[numind]>=ind&&len++;var dollarLen=len/2;for(dInd=0;dInd<dollarLen;dInd++){var reg=new RegExp("\\$"+(ind+1)+"\\$-","g");patternText=patternText.replace(reg,"$"+ind+++"$-")}return patternText},ValidationRule.convertToBrackets=function(patternText){new RegExp("\\$[d]+\\$-","g");for(var ind=1;null!=patternText.match(/\$[\d]+\$-/g);)patternText=(patternText=patternText.replace("$"+ind+"$-","(")).replace("$"+ind+++"$-",")");return patternText},ValidationRule.removeDummyBrackets=function(patternText){for(var staticIndex=1,totalBrackets=patternText.match(/\$[\d]+\$-/g).length/2;staticIndex<=totalBrackets;){var substr="$"+staticIndex+"$-",startIndex=patternText.indexOf(substr),endIndex=patternText.lastIndexOf(substr),nextStr="$"+ ++staticIndex+"$-",nextStart=patternText.indexOf(nextStr),substrLength=substr.length,nextStrLength=nextStr.length;if(nextStart>=0&&nextStart<endIndex)for(;nextStart<endIndex;){var nextEnd=patternText.lastIndexOf(nextStr);if(nextStart!=startIndex+substrLength||nextEnd!=endIndex-nextStrLength){if(nextStart>=0?(checkindex=staticIndex,midString=patternText.substr(nextStart+nextStrLength,nextEnd-nextStart-nextStrLength)):(checkindex=staticIndex-1,midString=patternText.substr(startIndex+substrLength,endIndex-startIndex-substrLength)),null==midString.match(/and|or/g)){regex=new RegExp("\\$"+checkindex+"\\$-","g");for(patternText=patternText.replace(regex,""),presentNumbers=patternText.match(new RegExp(/\d/g)),numind=0;numind<presentNumbers.length;numind++)if(presentNumbers[numind]==checkindex){matching=presentNumbers[numind];break}if(void 0!=matching){index=checkindex;patternText=ValidationRule.updateDollars(patternText,index)}totalBrackets=ValidationRule.updatestaticIndex(patternText,totalBrackets,endIndex,substr),nextStart=patternText.indexOf(nextStr)}break}var matching,regex=new RegExp("\\$"+staticIndex+"\\$-","g");for(patternText=patternText.replace(regex,""),presentNumbers=patternText.match(new RegExp(/\d/g)),numind=0;numind<presentNumbers.length;numind++)if(presentNumbers[numind]==staticIndex){matching=presentNumbers[numind];break}if(void 0!=matching){var index=staticIndex;patternText=ValidationRule.updateDollars(patternText,index)}totalBrackets=ValidationRule.updatestaticIndex(patternText,totalBrackets,endIndex,substr),nextStart=patternText.indexOf(nextStr)}else if(midString=patternText.substr(startIndex+substrLength,endIndex-startIndex-substrLength),null==midString.match(/and|or/g)){regex=new RegExp("\\$"+(staticIndex-1)+"\\$-","g");for(patternText=patternText.replace(regex,""),presentNumbers=patternText.match(new RegExp(/\d/g)),numind=0;numind<presentNumbers.length;numind++)if(presentNumbers[numind]==staticIndex){matching=presentNumbers[numind];break}if(void 0!=matching){index=staticIndex-1;patternText=ValidationRule.updateDollars(patternText,index)}totalBrackets=ValidationRule.updatestaticIndex(patternText,totalBrackets,endIndex,substr)}}return patternText},ValidationRule.addNewRule=function(obj){$(obj).parents("#validationrule").find("#dvValidruleparent [name=singleRuleDiv]").length;var visibleRule=$(obj).parents("#validationrule").find("#dvValidruleparent [id*=dvRule]:visible");if(0==visibleRule.length||!ZPFRules.validateRuleDiv(visibleRule)){var formId=$(obj).parents("#validationrule").find("#bodyTag").attr("formid"),cnt=$(obj).parents("#validationrule").find("#dvValidruleparent [name=singleRuleDiv]").length;ZPFRules.count=++cnt,$(obj).parents("#validationrule").find("#dvValidruleparent").append(ValidationRule.singleRuleAdd(formId,{})),$(obj).parents("#validationrule").find("#dvValidruleparent #dvRule"+cnt).parents("[name=singleRuleDiv]").find("select").select2(),$(obj).parents("#validationrule").find("#dvValidruleparent [id*=dvRule]").length>1&&$(obj).parents("#validationrule").find("#dvValidruleparent #dvRule"+cnt).siblings("[name=ruleToggleDiv]").click()}},ValidationRule.deleteRule=function(data,params,others){var isRemoved=!1;if(params.hasOwnProperty("forPost")){var ruleParent=$(others.obj).parents("[name=singleRuleDiv]");0==$(ruleParent).find("[ruleid]").length||0==$(ruleParent).find("[ruleid]").attr("ruleid").trim().length?$(ruleParent).siblings("[name=singleRuleDiv]").length>0&&($(ruleParent).remove(),isRemoved=!0):(delete(params={ruleId:$(ruleParent).find("[ruleid]").attr("ruleid"),method:"deleteRule"}).forPost,tabCustom.param=[ValidationRule.ruleUrl,params,ValidationRule.deleteRule,{obj:ruleParent}],ZPeople.confirm(null,"","Are you sure you want to delete this rule",tabCustom.deleteRequest,!1,!0))}else if("success"==data.msg.trim()){var formID=$(others.obj).parents("#bodyTag").attr("formid");$(others.obj).remove(),isRemoved=!0;var formRuleArray=ValidationRule.RULE_DETAILS[formID],index=ZPFRules.findObject(formRuleArray,"VALIDATION_RULE_ID",params.ruleId,"index").index;formRuleArray.splice(index,1),ValidationRule.RULE_DETAILS[formID]=formRuleArray,ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.rulesuccessmsg",[ZPI18N.getString("zp.deletedmsg")])),""==Layout.Page.container.find("#dvValidruleparent").html().trim()?Layout.Page.container.find("#dvValidruleparent #addRule").click():Layout.Page.container.find("#validationrule:visible #bodyTag [name=ruleToggleDiv]").first().click()}else""!=data.msg.trim?ZPeople.confirm(null,"",data.msg.trim(),"",!0,!0):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.sorryservererror"));isRemoved&&$.each(Layout.Page.container.find("#dvValidruleparent [name=singleRuleDiv]"),function(index,ruleDiv){0==index&&$(this).find("[name=ruleToggleDiv]").click(),$(this).find("[name=ruleToggleDiv] h6").text(ZPI18N.getString("zp.rule")+" "+(index+1));var id=$(this).find("[id*=dvRule]").attr("id");$(this).find("[name=ruleToggleDiv]").attr("data-target","#"+id.replace(/[\d]+$/,index+1)),$(this).find("[id*=dvRule]").attr("id",id.replace(/[\d]+$/,index+1))})},ValidationRule.updateFirstField=function(obj){var selectedFC=$(obj).val();$(obj).parents("[name=singleRuleDiv]").find("#conditionFields select").val(selectedFC).select2(),$(obj).parents("[name=singleRuleDiv]").find("#conditionFields select").trigger("change")},Task={OPEN_SYSVALUE:1,COMPLETED_SYSVALUE:2,UNASSIGNED_SYSVALUE:-1,ALLSTATUS_SYSVALUE:0,HIGH_SYSVALUE:1,MODERATE_SYSVALUE:2,LOW_SYSVALUE:3,RELATETASKTEMPLATE:$('<li><div id="taskContainer"><i class="IC-task-unchk" id="rt_completebutton"></i><i id="unassignedicon" data-toggle="tooltip" data-placement="top" data-original-title='+ZPI18N.getString("zp.pick")+' onclick="ZPeople.confirm(this,\'\',\'zp.taskpickmessage\', Task.pickupTask)"></i><div class="ZP_photo" data-toggle="tooltip" data-placement="top" data-original-title="" id="rt_taskownerpic"><img></div><div class="zp_txtbx"><div id="rt_taskname"></div></div><div class="zp_txtbx"><input id="rt_duedate" type="textbox"><i id="rt_delete" class="IC-delete"></i></div></div></li>'),getHelpKey:"",initiateUsers:function(){var pageId=$("#"+Layout.Page.pageId),searchJson={id:"employeeCombo",inpFormat:"select",placeHolder:ZPI18N.getString("zp.allusers"),searchMode:"TASKS_VIEW",type:1,limit:10,searchType:"emp"};pageId.find("#empPhoto").attr("src",ZPeople.CURR_USER.avatar),Task.viewPerm!=zpconst.Permission.SUB_DATA&&(searchJson.initialSelection=Task.initialUser()),searchJson.defaultOption=Task.getAllUserOption(),ZPComponents.Search.reset(searchJson,!0),ZPComponents.Search.create(searchJson)},initialUser:function(){var initialUser={},userDtls=ZPeople.getUserDetailsById(erecno);return initialUser.text=ZPeople.decodeTxt(userDtls.empid+" "+userDtls.name),initialUser.html=userDtls.empid+" "+userDtls.name,initialUser.id=erecno,initialUser.photo=userDtls.thumb,initialUser},getAllUserOption:function(){var allUserObj={};return allUserObj.text=allUserObj.html=ZPI18N.getString("zp.allusers"),allUserObj.id="0",allUserObj.photo=ZPeople.getResourceURL(imageUrl+"user.png"),allUserObj},addTask:function(formId){var formlinkname=ZPUtil.Form_Link_Names.getFormLinkName(formId,!0),formnameString="-formLinkName:";void 0==formlinkname&&(formnameString="-formId:",formlinkname=formId),window.location.href="#task/mytasks/addtask"+formnameString+formlinkname},initiateChecklistPage:function(){var pageId=$("#"+Layout.Page.pageId),searchJson={id:"checklistReqEmployeeCombo",inpFormat:"select",placeHolder:ZPI18N.getString("zp.select"),searchMode:"TASKS",type:1,limit:10,searchType:"emp"};searchJson.initialSelection=Task.initialUser(),pageId.find("#empPhoto").attr("src",ZPeople.CURR_USER.avatar),ZPComponents.Search.reset(searchJson,!0),ZPComponents.Search.create(searchJson),pageId.find("#empSearch").removeClass("DN")},initiateListing:function(){var pageId=$("#"+AutomationCommon.getCurrentPageId());if(isadmin||isOperationalRoleAdmin||Task.viewPerm==zpconst.Permission.ALL_DATA||Task.viewPerm==zpconst.Permission.TEAM_DATA||Task.viewPerm==zpconst.Permission.MY_DATA)AutomationCommon.constructInitialEmpCombo("employeeCombo");else if(Task.viewPerm==zpconst.Permission.NO_DATA)return pageId.find(".mainhead").remove(),pageId.find("#taskStatusFooter").remove(),pageId.find("#taskpreview").html("").append('<div class="ZPNdata"><div id="notaskfound"></div><p class="no-para">'+ZPI18N.getString("zp.permissiondeniedtoaccessthispage")+"</p></div>"),void ZPUtil.noDataSVG("notaskfound",ZPeople.getResourceURL(newUIImageUrl+"svg/no-permission.svg"));Task.viewPerm==zpconst.Permission.SUB_DATA&&(pageId.find("#unassigned_count").remove(),pageId.find("#empPhoto").addClass("DN"),pageId.find("#taskStatusCombo").find("[sysvalue=-1]").remove()),isadmin||Task.addPerm!=zpconst.Permission.NO_DATA||pageId.find("#zp_record_add_btn").remove(),Task.initiateUsers(),Task.createTaskFilters(),ZPChecklist.regFilterClickEvent(),AutomationCommon.constructFormListCombo(TASK_MODE,"taskCombo","","listView")},createNewTask:function(related_formid,related_recordid){Task.getTaskFormid();var params={formId:Task.taskformid,formMode:"ADD",viewRefresh:!0,callback:Task.closePreview,disableUrlTrack:!1};void 0!=related_formid&&void 0!=related_recordid&&(params.related_recordid=related_recordid,params.related_formid=related_formid),ZPForm.load(params)},addQuickTask:function(status){var params={},pageId=$("#"+Layout.Page.pageId);if(params.zp_formId=ZPForm.CURRFORM_PARAM.formId,params.zp_recordId=ZPForm.CURRFORM_PARAM.recordId,params.conreqcsr=csrfToken,params.taskname=pageId.find("#quicktaskname").val(),params.dueDate=pageId.find("#quicktaskdue").val(),params.taskowner=pageId.find("#tUser").attr("ownervalueid"),params.method="addQuickTask",""!==params.taskname){void 0!==status&&(Task.getStatusOptionValuesBySysVal(),params.status=ZPeople.decodeTxt(Task.statusBySysVal[status].VALUE));var newtaskrow=pageId.find("#newquicktask").after(Task.RELATETASKTEMPLATE.clone()).next();newtaskrow.find("#rt_taskname").text(params.taskname),""===params.dueDate?(newtaskrow.find("#rt_duedate").val(ZPI18N.getString("zp.today")),params.dueDate=Calendar.getCurrentDate(!0)):newtaskrow.find("#rt_duedate").val(params.dueDate),pageId.find("#quicktaskname").val(""),pageId.find("#quicktaskdue").val(""),$.post("/addQuickTask.zp",params,function(data){if(void 0===data.taskid||null===data.taskid||""===data.taskid)return ZPeople.Message.showFailureMsg(data.errors),void newtaskrow.remove();newtaskrow.attr("id","rt_"+data.taskid),newtaskrow.attr("taskid",data.taskid),newtaskrow.attr("onclick",ZPeople.isZPNewUI()?'Task.showTaskDetails("'+data.taskid+'", true, "'+params.zp_formId+'", "'+params.zp_recordId+'")':"ZPView.Record.getFormPage('VIEW', \""+data.taskid+'", this)'),newtaskrow.find("#rt_delete").attr("onclick",'Task.deleteTaskConfirmation("'+data.taskid+'")'),newtaskrow.find("#rt_completebutton").attr("onclick","Task.changeTaskStatus(this)"),newtaskrow.find("#rt_taskownerpic").remove(),newtaskrow.find("#rt_completebutton").after(pageId.find("#newquicktask").find("#tUser").clone()),Task.getTaskFormid(),void 0!==status&&newtaskrow.find("#taskContainer").addClass("zp_cmpl"),newtaskrow.find("#rt_completebutton").click(function(event){event.stopPropagation()}),newtaskrow.find("#rt_delete").click(function(event){event.stopPropagation()})})}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.tasknameerromsg"))},getTaskFormid:function(){if(void 0===Task.taskformid){var param={method:"getTaskFormid",conreqcsr:csrfToken};$.ajax({url:"/taskformid.zp",type:"POST",data:param,async:!1,success:function(data){Task.taskformid=data.taskformid}})}return Task.taskformid},getPriorityOptionValuesBySysVal:function(){if(void 0===Task.priorityBySysVal)for(i in Task.priorityBySysVal={},Task.priorityArray)Task.priorityBySysVal[Task.priorityArray[i].SYSVALUE]=Task.priorityArray[i]},getStatusOptionValuesBySysVal:function(){if(void 0===Task.statusBySysVal)for(i in Task.statusBySysVal={},Task.statusArray)Task.statusBySysVal[Task.statusArray[i].SYSVALUE]=Task.statusArray[i];return Task.statusBySysVal},populateTask:function(){var calObj=new NewCalendar.calObj;calObj.curYear=(new Date).getFullYear(),calObj.curMonth=(new Date).getMonth(),calObj.calcontId="monthcalendardiv",calObj.outerdivId=Layout.Page.pageId,calObj.daysObj={empty:"zpcalempty",weekend:"zpcalweek",day:"zpcaldays",today:"zpcaltoday",leave:"zpcalholi"},calObj.callback=Leave.View.Calendar.get,calObj.divid="caldiv",calObj.mode="leave",calObj.tdonclick=null,calObj.totaldata=!1,calObj.prearrow="IC-ar-lft",calObj.nextarrow="IC-ar-rgt",Leave.Util.reg(),Leave.View.Calendar.calObj=calObj,NewCalendar.initCalendar(calObj)},initiateCalendarView:function(){Task.populateTask()},initiateTaskListPage:function(){var url=Layout.Page.hash;if(Task.initiateUsers(),-1!==url.indexOf("mytasks/addtask"))Task.createNewTask();else if(-1!==url.indexOf("mytasks/edittask"))Task.editRec(Task.taskformid,Layout.Page.childUrlParam.taskid);else if(-1!==url.indexOf("mytasks/viewtask"))Task.showTaskDetails(Layout.Page.childUrlParam.taskid);else if(-1!==url.indexOf("task/mytasks")){var totalTasks=$("#count_total").text(),openTasks=$("#count_open").text();Task.getTaskCount(),void 0!=Task.isPreviewClosed&&Task.isPreviewClosed&&(Task.isPreviewClosed=!1,totalTasks==$("#count_total").text()&&openTasks==$("#count_open").text()||Task.getTasks("reset"))}},viewTaskDetails:function(taskid){window.location.href="#task/mytasks/viewtask-taskid:"+taskid},redirectEditUrl:function(obj){var pageId=Layout.Page.pageId,formId=ZPForm.CURRFORM_PARAM.formId,recordId=ZPForm.CURRFORM_PARAM.recordId;if(ZPForm.isrelfieldsingelrecview)Layout.Page.container.find("#zp_relfielsingle_record_"+ZPForm.CURRFORM_PARAM.formId).modal("hide"),ZPForm.load({formId:ZPForm.CURRFORM_PARAM.formId,formMode:"EDIT",isfromrelfieldedit:!0,recordId:ZPForm.CURRFORM_PARAM.recordId});else if(-1!==Layout.Page.hash.indexOf("admin/employeerecords/user")||$(obj).attr("isFromChecklist"))ZPForm.load({formId:ZPForm.CURRFORM_PARAM.formId,formMode:"EDIT",recordId:ZPForm.CURRFORM_PARAM.recordId,disableUrlTrack:!0,tableName:"P_Task"});else if(-1!==pageId.indexOf("task-list")){var formlinkname=ZPUtil.Form_Link_Names.getFormLinkName(formId,!0),formnameString="-formLinkName:";void 0==formlinkname&&(formnameString="-formId:",formlinkname=formId),window.location.href="#task/list/edit"+formnameString+formlinkname+"/recordId:"+recordId}else window.location.href="#task/mytasks/edittask-taskid:"+recordId},getRelatedRecordParams:function(params){void 0!==ZPForm.CURRFORM_PARAM.related_formid&&void 0!==ZPForm.CURRFORM_PARAM.related_recordid&&(params.related_formid=ZPForm.CURRFORM_PARAM.related_formid,params.related_recordid=ZPForm.CURRFORM_PARAM.related_recordid)},createTaskFilters:function(){var pageId=$("#"+Layout.Page.pageId),options=Task.getOptionValues();Task.constructComboBox("taskStatusCombo",options.Status),Task.constructComboBox("taskPriorityCombo",options.Priority),pageId.find("#taskStatusCombo").select2(),pageId.find("#taskPriorityCombo").select2(),pageId.find("#taskStatusCombo").find("[sysvalue=1]").prop("selected",!0).change()},getOptionValues:function(){var options={};if(void 0===Task.statusArray||void 0===Task.priorityArray){var params={method:"getTaskOptionValues",conreqcsr:csrfToken,mode:"list"};$.ajax({url:"/getOptionValues.zp",type:"POST",data:params,async:!1,success:function(data){Task.statusArray=data.Status,Task.priorityArray=data.Priority,Task.statusObj=Task.getOptionValueByName(Task.statusArray),Task.priorityObj=Task.getOptionValueByName(Task.priorityArray)}})}return options.Status=Task.statusArray,options.Priority=Task.priorityArray,options},getOptionValueByName:function(optionArr){var optionObj={};for(i in optionArr)optionObj[optionArr[i].VALUE]=optionArr[i];return optionObj},constructComboBox:function(id,list){var selectObj=$("#"+Layout.Page.pageId).find("#"+id);for(i in selectObj.html(""),"taskStatusCombo"==id?(selectObj.append(jQuery("<option />",{value:"",sysvalue:Task.ALLSTATUS_SYSVALUE}).text(ZPI18N.getString("zp.allstatus"))),selectObj.append(jQuery("<option />",{value:"-1",sysvalue:Task.UNASSIGNED_SYSVALUE}).text(ZPI18N.getString("zp.unassigned")))):"taskPriorityCombo"==id&&selectObj.append(jQuery("<option />",{value:""}).text(ZPI18N.getString("zp.allpriority"))),list)selectObj.append(jQuery("<option />",{value:list[i].ID,sysvalue:list[i].SYSVALUE,label:list[i].VALUE}).text(ZPeople.decodeTxt(list[i].DISPVALUE)))},getTasks:function(mode){var pageId=$("#"+Layout.Page.pageId),taskobj={};if(ZPChecklist.isValideTaskFilter()){if(void 0!=mode&&"reset"==mode){if(pageId.find("#taskpreview").children().hide(),pageId.find("#taskCustomisedList").children().remove(),pageId.find("#taskpreview").append(ZPeople.LOADING_HTML),pageId.find("#taskStatusCombo").find("[sysvalue=2]").val()===pageId.find("#taskStatusCombo").val()?pageId.find("#taskCustomisedList").addClass("zp_cpl"):pageId.find("#taskCustomisedList").removeClass("zp_cpl"),pageId.find("#dvFiltersec").is(":visible")&&(taskobj.name=pageId.find("#taskSearchString").val(),taskobj.formid=0==pageId.find("#taskCombo").val()?"":pageId.find("#taskCombo").val(),taskobj.sDate=pageId.find("#datePicker").val(),taskobj.sDate==CUSTOM_DATE)){var dateStr=pageId.find("#customDatePicker").find("input").val(),dates=ZPChecklist.splitFromToDate(dateStr);taskobj.sDate=dates.from,taskobj.eDate=dates.to}taskobj.status=pageId.find("#taskStatusCombo").val(),taskobj.empIds=0==pageId.find("#employeeCombo").val()?"":pageId.find("#employeeCombo").val(),taskobj.priority=pageId.find("#taskPriorityCombo").val(),Task.getTaskCrt=taskobj}Task.getTaskCrt.index=pageId.find("#taskCustomisedList").children().length+1,$.post("/gettasks.zp",{conreqcsr:csrfToken,method:"getTasks",criteria:JSON.stringify(Task.getTaskCrt)},function(data){"reset"===mode&&(pageId.find("#taskpreview").children().show(),pageId.find("#zp_page_loading").remove()),Task.cloneTaskRow(data.tasks,"taskCustomisedList"),data.hasNextPage&&ZPeople.FireScroll.reset()})}},deleteTaskConfirmation:function(taskid){ZPeople.BSModal.confirm(Task.deleteTask),Task.deleteTaskId=taskid},deleteTask:function(taskid){Task.getTaskFormid();var params={mode:"deleteRecords",recordIds:Task.deleteTaskId,formId:Task.taskformid},callback=ZPeople.isZPNewUI()?ZPTasks.removeTaskRow:Task.removeTaskRow;ZPeople.Request.send(ZPForm.URL,params,callback)},removeTaskRow:function(result,params){var pageId=$("#"+Layout.Page.pageId);if(7e3===result.code){Layout.Page.hash;ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.taskdeletedsuccessfully")),-1!==Layout.Page.hash.indexOf("task/mytasks")&&void 0===ZPForm.CURRFORM_PARAM.formId?(Task.getTaskCount(),pageId.find(".zpl[taskid="+params.recordIds+"]").remove()):pageId.find("[id=rt_"+params.recordIds+"]").remove()}else ZPeople.Message.showFailureMsg(result.message)},cloneTaskRow:function(taskArr,bodyToAppend){var currentRow="",pageId=$("#"+Layout.Page.pageId);pageId.find("#tasklisthead").removeClass("zp_dyn"),0==taskArr.length?0==$("#"+bodyToAppend).children().length&&(pageId.find("#taskCustomisedList").html("").append('<div class="ZPNdata"><div id="notaskfound"></div><p class="no-para">'+ZPI18N.getString("zp.notaskforfilter")+"</p></div>"),ZPUtil.noDataSVG("notaskfound",ZPeople.getResourceURL(newUIImageUrl+"svg/no-records.svg")),pageId.find("#tasklisthead").addClass("zp_dyn")):$.each(taskArr,function(index,row){(currentRow=$("#taskrow").cloneRow("#"+bodyToAppend)).removeClass("zp_dyn"),currentRow.find(".zp_ctit").parents(".zpDtl").attr("onclick",'Task.viewTaskDetails("'+row.id+'")'),currentRow.find(".zp_ctit").find("b").html(row.name),row.isDeletable?currentRow.find(".zpricn").attr("onclick",'Task.deleteTaskConfirmation("'+row.id+'")'):currentRow.find(".IC-delete").remove(),void 0!=row.recordowner&&(void 0!=row.recordowner.employeePhoto?(currentRow.find("#recordDetails").find("#recordownername").text(ZPeople.decodeTxt(row.recordowner.name)+" "+row.recordowner.employeeID),currentRow.find(".ZP_photo").find("img").attr("src",row.recordowner.employeePhoto),currentRow.find("#recordownername, .ZP_photo").attr("onclick",'ZPACommon.viewRecord("'+ZPeople.EMP_FORMID+'","'+row.recordowner.erecno+'")'),currentRow.find("#recordownername, .ZP_photo").click(function(event){event.stopPropagation()})):currentRow.find(".ZP_photo").find("img").attr("alt",ZPeople.getShortName(row.recordowner.name))),void 0!=row.formname?(currentRow.find("#recordDetails").find("#formname").html(row.formname),currentRow.find("#recordDetails").attr("onclick",'ZPACommon.viewRecord("'+row.formid+'","'+row.recordid+'","'+row.formtablename+'")'),currentRow.find("#recordDetails").click(function(event){event.stopPropagation()})):currentRow.find("#recordDetails").hide(),currentRow.attr("taskid",row.id),currentRow.attr("taskformid",row.taskformid),void 0==row.endtime?currentRow.find("#duedate").text(ZPI18N.getString("zp.noduedate")):currentRow.find("#duedate").text(row.endtime),currentRow.find("#taskowner").text(ZPeople.decodeTxt(row.assignedto)),row.taskowner==pageId.find("#employeeCombo").val()&&currentRow.find("#taskowner").hide(),isadmin||row.unassigned||ZPForm.Permission.isAllowed([row.taskowner],Task.editPerm)||currentRow.find("#closeButton").remove(),void 0!=row.priority&&(1===Task.priorityObj[row.priority].SYSVALUE?currentRow.find(".IC-task-unchk").addClass("zp_rclr"):3===Task.priorityObj[row.priority].SYSVALUE&&currentRow.find(".IC-task-unchk").addClass("zp_oclr")),row.iscompleted?(currentRow.addClass("zp_cmpl"),currentRow.find("#duedate").text(row.dispCompletedTime)):void 0!=row.unassigned&&row.unassigned?(currentRow.find("#pickup").removeClass("zp_dyn"),currentRow.find(".zp_link").click(function(event){event.stopPropagation()}),isadmin&&currentRow.find("#assignedto").removeClass("zp_dyn")):row.isoverdue&&currentRow.find("#duedate").addClass("zp_rclr")})},selectRow:function(obj){var pageId=$("#"+Layout.Page.pageId),rootRow=$(obj).parents("div.zpl");rootRow.hasClass("sel")?rootRow.removeClass("sel zp_check"):rootRow.addClass("sel zp_check"),0!=pageId.find(".sel").length?pageId.find("#bulkComplete").removeClass("DN"):pageId.find("#bulkComplete").addClass("DN")},changeEmpCombo:function(){var pageId=$("#"+Layout.Page.pageId);pageId.find("#empPhoto").removeClass("DN"),pageId.find("#empPhoto").attr("src",pageId.find(".select2-choice").data().select2Data.photo),-1===Layout.Page.hash.indexOf("task/mychecklist")?Task.getEmpTasks():ZPChecklist.resetChecklistReqPage()},getEmpTasks:function(){var pageId=$("#"+Layout.Page.pageId);pageId.find("#employeeCombo").val()==erecno?(pageId.find("#taskStatusCombo").find("[value=-1]").removeClass("zp_dyn"),pageId.find("#unassigned_count").removeClass("zp_dyn")):(pageId.find("#unassigned_count").addClass("zp_dyn"),"-1"==pageId.find("#taskStatusCombo").val()&&pageId.find("#taskStatusCombo").find("[sysvalue=1]").prop("selected",!0).change(),pageId.find("#taskStatusCombo").find("[value=-1]").addClass("zp_dyn")),Task.getTasks("reset"),Task.getTaskCount()},getTaskCount:function(){if(isadmin||Task.viewPerm!=zpconst.Permission.NO_DATA){var pageId=$("#"+Layout.Page.pageId),params={erecno:pageId.find("#employeeCombo").val(),method:"getTaskCount",conreqcsr:csrfToken};$.ajax({url:"/gettaskcount.zp",type:"POST",async:!1,data:params,success:function(data){pageId.find("#count_total").text(data.total),pageId.find("#count_open").text(data.open),pageId.find("#count_completed").text(data.completed),pageId.find("#count_unassigned").text(data.unassigned)}})}},getTaskPermission:function(){if(void 0===Task.viewPerm)if(isadmin)Task.viewPerm=zpconst.Permission.ALL_DATA,Task.editPerm=zpconst.Permission.ALL_DATA,Task.addPerm=zpconst.Permission.ALL_DATA;else{var params={method:"getTaskPermission",conreqcsr:csrfToken};$.ajax({url:"/taskPermission.zp",type:"POST",async:!1,data:params,success:function(perm){Task.viewPerm=perm.viewPermission,Task.editPerm=perm.editPermission,Task.addPerm=perm.createPermission}})}},saveComment:function(getThis){var textArea=$(getThis).parent().parent().find("textarea"),taskid=ZPForm.CURRFORM_PARAM.recordId,comment=textArea.val(),params={taskid:taskid,comment:comment,method:"addTaskComment",conreqcsr:csrfToken};""!=comment&&(ZPChecklist.newComment(comment),textArea.val(""),$.post("/addTaskComment.zp",params,function(data){}),Task.resetTaskId=taskid)},canAddTask:function(){return Task.getTaskPermission(),0!=Task.addPerm},loadComment:function(comments){var pageId=$("#"+Layout.Page.pageId).find("#"+ZPForm.LAYOUT.data().curpageid).find("[id=zp_form_outer_container]").find("#commentContainer");pageId.find("#commentHead").siblings().remove();var comment="";$.each(comments,function(index,commentDtl){comment=pageId.find("#commentBodyDummy").clone().removeAttr("style"),pageId.find("#checklistComments").append(comment),comment.find("b").text(ZPeople.decodeTxt(commentDtl.name)),comment.find("img").attr("src",commentDtl.employeePhoto),comment.find("p").text(commentDtl.comment),comment.find("span").text(commentDtl.createdTime),comment.attr("id","taskcomment")});var commentHeadMsg="",commentsCount=comments.length;0==commentsCount?(commentHeadMsg=ZPI18N.getString("zp.comment"),pageId.find("#commentHead").find("a").attr("expanded",!0)):commentsCount<=3?(commentHeadMsg=ZPI18N.getString("zp.viewingallcomments",[commentsCount]),pageId.find("#commentHead").find("a").attr("expanded",!0)):(commentHeadMsg=ZPI18N.getString("zp.viewallcomments",[commentsCount]),pageId.find("#commentHead").siblings().slice(0,commentsCount-3).hide(),pageId.find("#commentHead").find("a").attr("expanded",!1)),pageId.find("#commentHead").find("a").text(commentHeadMsg),pageId.find("#commentHead").find("a").attr("count",commentsCount),pageId.find("#commentHead").find("a").click(function(){ZPChecklist.viewAllComments(this)}),ZPForm.LAYOUT.find("#checklistComments").append('<div class="modalComment" id="taskCommentBox"><div class="media"><div class="media-left"><img src="" class="Usrimg FL MR10 MT5"></div><div class="media-body"><div class="media-resize"><div class="mentions-input-box"><div class="mentions"></div><textarea placeholder="'+ZPI18N.getString("zp.writeacomment")+'" class="form-control ZP-postcmt"></textarea><div  class="mentions-autocomplete-list"></div></div><div class="text-right ZP-cmtbtn DB PT10"><div class="mentions"></div><button class="btn btn-primary" onclick="Task.saveComment(this)">'+ZPI18N.getString("zp.post")+'</button><div class="mentions-autocomplete-list"></div></div></div></div>'),pageId.find("#taskCommentBox").find("img").attr("src",ZPeople.CURR_USER.avatar)},showQuickTask:function(obj){var pageId=$("#"+Layout.Page.pageId);pageId.find("#rt_table").is(":visible")?(pageId.find("#newquicktask").removeClass("zp_dyn"),pageId.find("#zp_views_list_container_rel-1").find("#forms_norecordfound").remove()):(0!==$(obj).siblings().length?$(obj).siblings().click():$("#zp_profile_expandcola").click(),Task.isQuickTaskVisible=!0)},constructRelatedTask:function(resultObj,extraParam){var pageId=$("#"+Layout.Page.pageId);pageId.find("#rt_table").remove();var isfrommodule=1==extraParam,result=isfrommodule?resultObj:resultObj.recordDetails.message,norecord='<div class="label-body" id="forms_norecordfound"><h4 class="ZPNdt text-center" id="zp_views_nodata">'+ZPI18N.getString("zp.notaskfound")+"</h4></div>",quickui='<div class="zp_Task" id="rt_table">'+(isfrommodule?'<div class="zp_pshead">'+ZPI18N.getString("zp.tasks")+"</div>":"")+'<div class="zp_TLst"><ul><li id="newquicktask" class="zp_dyn"><i class="IC-task-unchk" onclick="Task.addQuickTask(Task.COMPLETED_SYSVALUE)"></i><div class="zp_txtbx"><input type="textbox" id="quicktaskname"></div><div class="ZP_photo" id="tUser" ownervalueid='+erecno+' onclick="Dropdown.taskUserdropdown(this)"><img src='+ZPeople.CURR_USER.avatar+'></div><div class="zp_txtbx"><input class="zp_ntsk" type="textbox" id="quicktaskdue" caltype ='+Task.getCalType()+'  onclick="Calendar.setUpCalendar(event,this,null,null,Task.addTaskByDate)"></div></li></ul></div>';pageId.find("#zp_views_list_container_rel-1").append(quickui),pageId.find("#quicktaskname").attr("placeholder",ZPI18N.getString("zp.taskname")),pageId.find("#quicktaskdue").attr("placeholder",ZPI18N.getString("zp.duedate")),Task.cloneRelatedTaskRow(result),Task.isQuickTaskVisible||isfrommodule?(pageId.find("#newquicktask").removeClass("zp_dyn"),Task.isQuickTaskVisible=!1):0===result.length&&pageId.find("#zp_views_list_container_rel-1").append(norecord),isadmin||Task.addPerm!==zpconst.Permission.NO_DATA||pageId.find("#newquicktask").remove(),pageId.find("#quicktaskname").keydown(function(key){13==key.which&&Task.addQuickTask()})},getCalType:function(){var url=Layout.Page.hash;return-1!==url.indexOf("admin/employeerecords/user")?"profile":-1!==url.indexOf("#hrcase/list/view")||-1!==url.indexOf("#hrcase/myrequest/view")||-1!==url.indexOf("cases/list")||-1!==url.indexOf("hrcase/report")||-1!==url.indexOf("#hrcase/allcases/view")?"HR_case":"popup"},getCheckRootTasks:function(getThis,isRefresh){var checkrootId=$(getThis).attr("checkrootId"),pageId=$("#"+Layout.Page.pageId);if(0==pageId.find("#taskRootDiv_"+checkrootId).length||isRefresh){$(getThis).attr("recordId");$(getThis).attr("id","taskRootDiv_"+checkrootId),$(getThis).find("tr").find("#taskClName").addClass("CP").attr("data-target","#taskDtlsDiv_"+checkrootId),$(getThis).find("#taskDtlsDiv").attr("id","taskDtlsDiv_"+checkrootId).addClass("zp_Task zp_TLst");var params={method:"getCheckRootTasks",checkitemrootid:checkrootId,conreqcsr:csrfToken};$.ajax({url:"/getCheckRootTasks.zp",type:"POST",data:params,success:function(data){var parentDiv=pageId.find("#taskDtlsDiv_"+checkrootId).find("ul").attr("checkrootid",checkrootId);parentDiv.children().remove(),0!=data.length&&Task.cloneRelatedTaskRow(data.tasks,$(parentDiv)),data.isCompleted?$(getThis).find("#rootStatus").html('<div class="grn">'+ZPI18N.getString("zp.completed")+"</div>"):$(getThis).find("#rootStatus").html('<div class="org">'+ZPI18N.getString("zp.inprogress")+"</div>")}})}},addTaskByDate:function(){var pageId=$("#"+Layout.Page.pageId);if(!pageId.find("#singlecalendar").is(":visible")){if(""===pageId.find("#quicktaskname").val())return;window.setTimeout(Task.addQuickTask,100)}},cloneRelatedTaskRow:function(taskArr,parentDiv){var pageId=$("#"+Layout.Page.pageId),currentRow="",row="";Task.getTaskPermission(),Task.getOptionValues();for(var index=0;index<taskArr.length;index++){if(row=taskArr[index],(currentRow=Task.RELATETASKTEMPLATE.clone().attr("id","rt_"+row.id)).attr("taskid",row.id),currentRow.find("#rt_taskname").html(row.name),row.isDeletable&&!row.isDraft?currentRow.find("#rt_delete").attr("onclick",'Task.deleteTaskConfirmation("'+row.id+'")'):currentRow.find("#rt_delete").remove(),void 0==row.endtime?currentRow.find("#rt_duedate").val(ZPI18N.getString("zp.noduedate")):currentRow.find("#rt_duedate").val(row.endtime),isadmin||row.istaskowner||ZPForm.Permission.isAllowed([row.taskowner],Task.editPerm)?currentRow.find("#rt_completebutton").attr("onclick","Task.changeTaskStatus(this)"):currentRow.find("#rt_completebutton").remove(),void 0!=row.priority&&(1===Task.priorityObj[row.priority].SYSVALUE?currentRow.find("#rt_completebutton").addClass("zp_rclr"):3===Task.priorityObj[row.priority].SYSVALUE&&currentRow.find("#rt_completebutton").addClass("zp_oclr")),row.iscompleted?(currentRow.find("#taskContainer").addClass("zp_cmpl"),currentRow.find("#rt_duedate").val(row.dispCompletedTime)):row.isoverdue&&currentRow.find("#rt_duedate").addClass("zp_rclr"),void 0!==row.taskownerdetail?(currentRow.find("#rt_taskownerpic").find("img").attr("src",row.taskownerdetail.employeePhoto),currentRow.find("#rt_taskownerpic").attr("popup","user").attr("empid",row.taskownerdetail.zuid),currentRow.find("#unassignedicon").remove()):row.isDraft||!row.istaskowner?currentRow.find("#rt_taskownerpic").find("img").attr("alt",ZPeople.getShortName(row.assignedto)):(currentRow.find("#rt_taskownerpic").addClass("zp_dyn"),currentRow.find("#unassignedicon").addClass("IC-add-usr")),row.isDraft?(currentRow.find("#rt_completebutton").addClass("zp_dyn"),currentRow.find("#rt_duedate").val(ZPI18N.getString("zp.chkyettostart")),currentRow.click(function(event){event.stopPropagation()})):currentRow.find("#taskContainer").attr("onclick",ZPeople.isZPNewUI()?void 0!=ZPForm.CURRFORM_PARAM.formId?'Task.showTaskDetails("'+row.id+'", true, "'+ZPForm.CURRFORM_PARAM.formId+'", "'+ZPForm.CURRFORM_PARAM.recordId+'")':'Task.showTaskDetails("'+row.id+'", true)':'Task.viewRelatedTask("'+row.id+'", this)'),void 0===parentDiv)pageId.find("#newquicktask").parent().append(currentRow);else{var parentTaskDivId="#rt_"+row.parenttaskid;void 0===row.parenttaskid||0==row.parenttaskid?parentDiv.append(currentRow):0!=parentDiv.find(parentTaskDivId).length?(parentDiv.find(parentTaskDivId).append("<ul childid="+row.id+"></ul>"),parentDiv.find("[childid="+row.id+"]").append(currentRow)):taskArr.push(row)}currentRow.find("#rt_completebutton").click(function(event){event.stopPropagation()}),currentRow.find("#rt_delete").click(function(event){event.stopPropagation()}),currentRow.find("#unassignedicon").click(function(event){event.stopPropagation()}),void 0===Task.taskformid&&(Task.taskformid=row.taskformid)}},viewRelatedTask:function(taskid,obj){delete ZPForm.SINGLE_RECORD_DTL[Task.taskformid+"_"+taskid];var isFromChecklist=void 0!==$(obj).parents("ul[checkrootid]").attr("checkrootid"),pageId=$("#"+Layout.Page.pageId),recordId=ZPForm.CURRFORM_PARAM.recordId,formId=ZPForm.CURRFORM_PARAM.formId;if(isFromChecklist){pageId.find("#rootTaskTriggerDtlsPage");pageId.find("#rootTaskTriggerDtlsPage").remove(),Task.showTaskDetails(taskid,!0),$($(".modal-backdrop.in")[1]).remove(),pageId.find("#task_closebutton").click(function(){void 0===recordId?($(".modal-backdrop").remove(),ZPChecklist.checklistTriggerData(ZPChecklist.rootLink)):ZPChecklist.getChecklistsForRecord(recordId,formId)}),pageId.find("#task_editicon").attr("isFromChecklist",!0)}else ZPView.Record.getFormPage("VIEW",taskid,obj)},changeStatusCombo:function(sysvalue){$("#"+Layout.Page.pageId).find("#taskStatusCombo").find("[sysvalue="+sysvalue+"]").prop("selected",!0).change()},editRec:function(formid,taskid){ZPForm.load({formId:formid,formMode:"EDIT",tableName:"P_Task",recordId:taskid,callback:Task.redirectClosePage,disableUrlTrack:!1})},redirectClosePage:function(taskid){Task.closePreview(),void 0!=taskid&&Task.viewTaskDetails(taskid)},changeTaskStatus:function(obj){var isFromTaskPage=-1!==Layout.Page.hash.indexOf("task/mytasks")&&void 0===ZPForm.CURRFORM_PARAM.formId,rootRow=isFromTaskPage?$(obj).parents("div.zpl"):$(obj).parent().parent("li"),taskid=0!=rootRow.length?rootRow.attr("taskid"):$(obj).attr("taskid"),isFromWidget=$(obj).parents("[widget]").attr("widget"),checkrootId=$(obj).parents("div[checkrootid]").attr("checkrootid"),status="";0!=rootRow.length?(status=rootRow.hasClass("zp_cmpl")||rootRow.find("#taskContainer").hasClass("zp_cmpl")?Task.OPEN_SYSVALUE:Task.COMPLETED_SYSVALUE,taskid=rootRow.attr("taskid")):(status=0!=$(obj).parents(".modal-content").find(".zp_cmpl").length?Task.OPEN_SYSVALUE:Task.COMPLETED_SYSVALUE,taskid=ZPForm.CURRFORM_PARAM.recordId);var params={taskid:taskid,method:"changeTaskStatus",status:status,conreqcsr:csrfToken},pageId=$("#"+Layout.Page.pageId);0!=rootRow.length&&(status==Task.OPEN_SYSVALUE?isFromTaskPage?rootRow.removeClass("zp_cmpl"):rootRow.find("#taskContainer").removeClass("zp_cmpl"):isFromTaskPage?rootRow.addClass("zp_cmpl"):rootRow.find("#taskContainer").addClass("zp_cmpl"),delete ZPForm.SINGLE_RECORD_DTL[Task.taskformid+"_"+taskid]),$.post("/changeTasksStatus.zp",params,function(data){if("success"==data.Status){var successmsg=status==Task.OPEN_SYSVALUE?ZPI18N.getString("zp.taskreopenedsuccess"):ZPI18N.getString("zp.taskcompletedsuccess");if(ZPeople.Message.showSuccessMsg(successmsg),isFromTaskPage)Task.getTaskCount();else if(isFromWidget){var countBox=pageId.find("#MYPENDINGTASKS").parent().find("#zpdash_widgetcnt").find("b");status==Task.COMPLETED_SYSVALUE?countBox.text(parseInt(countBox.text())-1):status==Task.OPEN_SYSVALUE&&countBox.text(parseInt(countBox.text())+1)}if(0==rootRow.length){var fcid=pageId.find("#commentSlideBody").find("[folabel=Status]").attr("id").split("_").pop(),status_optionvalue=Task.getOptionValue(fcid,ZPForm.CURRFORM_PARAM.formId,status);if(pageId.find("#commentSlideBody").find("[folabel=Status]").find("span").text(ZPeople.decodeTxt(status_optionvalue)),status==Task.COMPLETED_SYSVALUE){var timesplit=new Date(ZPDateTime.convertToTimezone((new Date).getTime())).constructor().split(" ");pageId.find("#commentSlideBody").find("[folabel=Completed_On]").find("span").text(timesplit[1]+" "+timesplit[2]+" "+timesplit[3]+" "+timesplit[4]),pageId.find("#commentSlideBody").find("[folabel=Completed_By]").find("span").text(ZPeople.decodeTxt(ZPeople.getUserDetailsById(erecno).name))}Task.fillDetailViewPage()}if(void 0!==checkrootId){var checkRootDiv="#taskRootDiv_"+checkrootId;Task.getCheckRootTasks(pageId.find(checkRootDiv),!0)}}else{var taskerrmsg;taskerrmsg="object"==typeof data.message&&void 0!=data.message.Status?data.message.Status:data.message,ZPeople.Message.showFailureMsg(taskerrmsg),0!=rootRow.length&&(status!==Task.OPEN_SYSVALUE?isFromTaskPage?rootRow.removeClass("zp_cmpl"):rootRow.find("#taskContainer").removeClass("zp_cmpl"):isFromTaskPage?rootRow.addClass("zp_cmpl"):rootRow.find("#taskContainer").addClass("zp_cmpl"))}})},pickupTask:function(obj){var pageId=$("#"+Layout.Page.pageId),isFromTaskPage=-1!==Layout.Page.hash.indexOf("task/mytasks")&&void 0===ZPForm.CURRFORM_PARAM.formId,rootRow=isFromTaskPage?$(obj).parents("div.zpl"):$(obj).parents("li"),taskid=0!=rootRow.length?rootRow.attr("taskid"):ZPForm.CURRFORM_PARAM.recordId,params={taskid:taskid,method:"changeTaskOwner",mode:"pickup",conreqcsr:csrfToken};$.post("/changeTaskOwner.zp",params,function(data){"success"==data.Status?(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.taskassignedsuccess")),0!=rootRow.length?(isFromTaskPage?(rootRow.find("#assignedto").hide(),rootRow.find("#pickup").hide(),rootRow.find("#taskowner").show().text(ZPeople.decodeTxt(ZPeople.CURR_USER.name))):(rootRow.find("#rt_taskownerpic").removeClass("zp_dyn").find("img").attr("src",ZPeople.CURR_USER.avatar),rootRow.find("#unassignedicon").remove()),delete ZPForm.SINGLE_RECORD_DTL[Task.taskformid+"_"+taskid]):(ZPForm.refreshRecord(taskid),ZPForm.SINGLE_RECORD_DTL[ZPForm.CURRFORM_PARAM.formId+"_"+ZPForm.CURRFORM_PARAM.recordId].record.recordDetails.message.ownerID[0]=erecno,pageId.find("[folabel=Task_Owner]").find("span").text(ZPeople.decodeTxt(ZPeople.CURR_USER.name)),Task.fillDetailViewPage())):ZPeople.Message.showFailureMsg(data.message)})},showTaskDetails:function(taskid,disableUrl,related_formid,related_recordid){var pageId=$("#"+Layout.Page.pageId);ZPACommon.hideSlideBodyContent(),pageId.find("#taskDetailPage").modal("show"),pageId.find("#task_editicon").removeClass("DN"),pageId.find("#completebutton,#tdtls_taskname,#task_editicon").addClass("zp_dyn"),pageId.find("#detail_pannel").addClass("zp_dyn"),Task.getTaskFormid();var formid=Task.taskformid,params={formId:formid,recordId:taskid,formMode:"VIEW",isCustomLayout:!0};if(disableUrl&&(params.disableUrlTrack=!1),ZPForm.load(params),pageId.find("#task_header").val(formid),pageId.find("[name=task_slider]").addClass("zp_tskFl"),pageId.find("#taskDetailPage").find("td[id]").text(""),pageId.find("#tdtls_taskowner").parents("dd").removeClass("zp_link").removeAttr("onclick"),pageId.find("#task_editicon").attr("taskid",taskid),pageId.find("#task_editicon").attr("formid",formid),pageId.find("#completebutton").attr("taskid",taskid),void 0!=related_formid&&void 0!=related_recordid){void 0!=ZPForm.getTableName()&&ZPForm.getTableName();pageId.find("#tdtls_close").attr("onclick",'ZPTasks.closeRecordTasks("'+related_formid+'","'+related_recordid+'")')}},fillDetailViewPage:function(){var page=ZPForm.LAYOUT.data().curpageid,pageId=$("#"+Layout.Page.pageId).find("#"+page),duedate=$(pageId.find("[folabel=Due_Date]").find("span")[0]).text(),taskname=$(pageId.find("[folabel=Task_Name]").find("span")[0]).text();"-"!==duedate?pageId.find("#tdtls_duedate").text(duedate):pageId.find("#tdtls_duedate").text(ZPI18N.getString("zp.noduedate")),pageId.find("#tdtls_taskname").text(taskname),-1!==page.indexOf("relfielsingle")&&pageId.find("#task_closebutton").attr("onclick","ZPForm.Field.formCloseBtn()");var status=$(pageId.find("[folabel=Status]").find("span")[0]).text(),status_sysvalue=Task.getSysValue(pageId.find("[folabel=Status]").attr("id").split("_").pop(),ZPForm.CURRFORM_PARAM.formId,status),status_color="";status_sysvalue==Task.COMPLETED_SYSVALUE?(status_color="zp_gclr",pageId.find("#taskSlideHead").parent().addClass("zp_cmpl"),pageId.find("[folabel=Completed_On]").parent().removeClass("zp_dyn"),pageId.find("[folabel=Completed_By]").parent().removeClass("zp_dyn"),"-"===pageId.find("[folabel=Task_Owner]").find("span").text()&&pageId.find("[folabel=Task_Owner]").find("span").text(ZPeople.CURR_USER.name)):(pageId.find("#taskSlideHead").parent().removeClass("zp_cmpl"),pageId.find("[folabel=Completed_On]").parent().addClass("zp_dyn"),pageId.find("[folabel=Completed_By]").parent().addClass("zp_dyn")),pageId.find("#tdtls_status").text(status).parent().attr("class",status_color);var taskowner=$(pageId.find("[folabel=Task_Owner]").find("span")[0]).text();if("-"!=taskowner){var taskownererecno="";if(pageId.find("#tdtls_taskowner").text(taskowner),pageId.find("#tdtls_taskowner_image").attr("alt",ZPeople.getShortName(taskowner)),pageId.find("[folabel=Assigned_To]").parent().addClass("zp_dyn"),void 0!==pageId.find("[folabel=Task_Owner]").find("select").val())taskownererecno=pageId.find("[folabel=Task_Owner]").find("select").val();else if(void 0!==ZPForm.SINGLE_RECORD_DTL[ZPForm.CURRFORM_PARAM.formId+"_"+ZPForm.CURRFORM_PARAM.recordId]){var owner=ZPForm.SINGLE_RECORD_DTL[ZPForm.CURRFORM_PARAM.formId+"_"+ZPForm.CURRFORM_PARAM.recordId].record.message.ownerID;taskownererecno=owner[0],isOperationalRoleAdmin||ZPForm.Permission.isAllowed(owner,ZPForm.Permission.getEditPerm())||(pageId.find("#task_editicon").remove(),pageId.find("#completebutton").remove())}if(""!==taskownererecno){var taskownerimg=ZPeople.getUserDetailsById(taskownererecno).avatar;pageId.find("#tdtls_taskowner_image").attr("src",taskownerimg)}else pageId.find("#tdtls_taskowner_image").removeAttr("src")}else{var assignedTo=ZPeople.escapeHtml($(pageId.find("[folabel=Assigned_To]").find("span")[0]).text());pageId.find("#tdtls_taskowner").text("").append("<span>"+assignedTo+"</span>").append("<span class=\"zp_ldot zp_link\" onclick=\"ZPeople.confirm(this,'','zp.taskpickmessage', Task.pickupTask)\">"+ZPI18N.getString("zp.pick")+"</span>").parents("dd").attr("taskid",pageId.find("#completebutton").attr("taskid")),pageId.find("[folabel=Assigned_To]").parent().removeClass("zp_dyn"),pageId.find("#tdtls_taskowner_image").attr("alt",ZPeople.getShortName(assignedTo))}var priority_sysvalue=Task.getSysValue(pageId.find("[folabel=Priority]").attr("id").split("_").pop(),ZPForm.CURRFORM_PARAM.formId,$(pageId.find("[folabel=Priority]").find("span")[0]).text()),priority_color="";priority_sysvalue==Task.LOW_SYSVALUE?priority_color="zp_oclr":priority_sysvalue==Task.HIGH_SYSVALUE&&(priority_color="zp_rclr"),pageId.find("#completebutton").removeClass("zp_oclr zp_rclr").addClass(priority_color),pageId.find("#completebutton,#tdtls_taskname,#task_editicon").removeClass("zp_dyn"),pageId.find("#detail_pannel").removeClass("zp_dyn"),ZPACommon.showSlideBodyContent(),Task.taskformid=ZPForm.CURRFORM_PARAM.formId;var taskrow=$("#taskCustomisedList").find("[taskid="+ZPForm.CURRFORM_PARAM.recordId+"]");if(0!=taskrow.length){priority_color="";priority_sysvalue==Task.LOW_SYSVALUE?priority_color="zp_oclr":priority_sysvalue==Task.HIGH_SYSVALUE&&(priority_color="zp_rclr"),status_sysvalue==Task.COMPLETED_SYSVALUE?taskrow.addClass("zp_cmpl"):taskrow.removeClass("zp_cmpl"),taskrow.find(".IC-task-unchk").removeClass("zp_oclr zp_rclr").addClass(priority_color),""!==taskname&&taskrow.find(".zp_ctit").find("b").text(taskname)}},getSysValue:function(fcId,formId,optionValue){var options=ZPForm.Field.getFieldComponent(fcId,formId).OptionsWithId,sysvalue=0;return $.each(options,function(index,row){ZPeople.decodeTxt(row.Value)!=optionValue||(sysvalue=row.SysValue)}),sysvalue},getOptionValue:function(fcId,formId,sysValue){var options=ZPForm.Field.getFieldComponent(fcId,formId).OptionsWithId,optionvalue=0;return $.each(options,function(index,row){row.SysValue!=sysValue||(optionvalue=row.Value)}),optionvalue},closePreview:function(taskid){var url=Layout.Page.hash,pageId=$("#"+Layout.Page.pageId);ZPeople.isZPNewUI()?-1===url.indexOf("task/mytask")&&-1===url.indexOf("task/alltask")||(void 0!=taskid?(window.location.href="#task/tracktask",ZPTasks.resetTasks(),$("#zp_t_task_mytask").attr("href","#task/mytask")):window.location.href=void 0==Task.parentUrl?"#task/mytask":Task.parentUrl):(-1!==url.indexOf("task/mytasks")&&(window.location.href="#task/mytasks"),pageId.find("#commentSlideBody div[id^='zp_addedit_record_']").attr("id","taskFormPage"),Task.isPreviewClosed=!0,void 0!==Task.resetTaskId&&""!==Task.resetTaskId&&(delete ZPForm.SINGLE_RECORD_DTL[Task.taskformid+"_"+Task.resetTaskId],Task.resetTaskId=""))},getShortName:function(name){var shortname="";if(void 0!=name){var splitname=ZPeople.decodeTxt(name).split(" ");shortname=splitname[0].charAt(0),shortname+=void 0!=splitname[1]?splitname[1].charAt(0):void 0!=splitname[0].charAt(1)?splitname[0].charAt(1):""}return shortname},isTaskAvailable:function(){var isTaskActive=!1;return-1===["P_PerfAppraisal","P_Location","P_Streams","P_EmployeeHealthData","P_VaccinationStatus","P_LeaveType","P_EmployeeLeave","P_AppraisalConfiguration","P_KRA","P_KRA_User","P_Rating","P_EmployeeJobs","P_Holiday","P_EmpBradfordScore","P_Bradford","P_Goals","P_TimesheetJob","P_TimesheetJobsList","P_Timesheet","P_TimesheetList","P_TimesheetBudget","P_TimeJobSchedule","P_ClientDetails"].indexOf(ZPForm.getTableName())&&$.each(ZPTabs.TAB_JSON,function(index,tab){"Task"===tab.name&&!1===tab.isHidden&&(isTaskActive=!0)}),isTaskActive}};var Dropdown={taskUserdropdown:function(obj){Task.addPerm!=zpconst.Permission.NO_DATA&&Task.addPerm!=zpconst.Permission.MY_DATA&&$(obj).zparrowmenu({id:"taskUserList",data:function(initObj){return EmployeeDropdown.getEmpList($(initObj).val(),"emp","TASKS")},callback:Dropdown.updateTaskUser})},updateTaskUser:function(obj,initObj){$("#"+Layout.Page.pageId);var result=$(obj).find("img"),ownervalueId=$(obj).attr("id");$(initObj).attr("ownervalueid",ownervalueId),$(initObj).find("img").replaceWith(result)}},WF_ACTION_ADD=1,WF_ACTION_EDIT=2,WF_ACTION_DELETE=3,WF_ACTION_APPROVE=4,WF_ACTION_REJECT=5,WF_ACTION_ADDOREDIT=8,WF_ACTION_FIELDVALUECHANGE=9,WF_ACTION_REMINDER=10,CHECKLIST_REC_PERPAGE=25,CUSTOM_DATE=36,TOMORROW=33,NEXT_7_DAYS=39,ZPChecklist={CHECKITEMROOT_TEMPLATE:'<div id="rootTaskTriggerDtlsPage"  class="modal popRgtModel PopMdxModel modal-right " aria-hidden="false"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"> <a data-dismiss="modal" class="close"><span class="IC-cls-1px red" id="rootClose"></span></a><h6><div class="txttrim FL">'+ZPI18N.getString("zp.checklist")+'</div><span data-placement="bottom" title="" class="S14 FL gry ML15 ZPtitle hide" data-original-title="Edit Permissions"><i class="IC-pen S14 MR5"></i></span> </h6></div><div class="row dvTaskdetail" id = "checklistDetails" style="display:none"><div><table class="table table-hover M0"><tbody><tr data-toggle="collapse"><th><div class="FL MR10"data-toggle="tooltip" data-placement="top" data-container="body"><img class="Usrimg FL MR10 MT5" src="" id="taskOwnerImg" /></div><div class="tragcont"><div class="S16" id="taskClName"></div><p id="myReqTriggerInfo"></p></div></th><th width="260" id="rootStatus"></th></tr></tbody></table><div id="taskDtlsDiv"><ul class="ulTaskdetail"></ul></div></div></div><div class="modal-body" id="checkrootList"></div><div class="modal-footer"><a data-dismiss="modal" class="btn btn-default">'+ZPI18N.getString("zp.close")+"</a></div></div></div></div>",CHECKLISTITEM_TEMPLATE:'<div class="modal popRgtModel PopMdxModel PopComtsfixed modal-right" tabindex="-1" id="myClReqComment"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"> <a class="close" data-dismiss="modal"><span class="IC-cls-1px red"></span></a><div class="txttrim FL" id="commentSlideHead"><h6><span class="S14 FL gry ML15 ZPtitle hide" title="Edit Permissions" data-placement="bottom"><i class="IC-pen S14 MR5"></i></span> </h6></div></div><div class="modal-body" id="commentSlideBody"><div class="row dvchklstcom"><div class="dvchkhead"><table class="table table-responsive"><tr><th id="checkitemDetail"></th><th width="260"></th></tr></table></div><div class="col-md-8 PT10 ML40"><div class="row"><label class="control-label col-md-4">'+ZPI18N.getString("zp.formname")+'</label><div class="form-group col-md-8"><a id="checklistFormName" name="record" formid="" recordid=""></a></div></div><div class="row"><label class="control-label col-md-4">'+ZPI18N.getString("zp.taskowner")+'</label><div class="form-group col-md-8" id="checklistTaskOwner"><div class="form-group"><span class="IC-role gry MR10 ZPtitle" title="Role"></span><span name="taskOwner"></span></div><div class="form-group"><span class="gry MR10 ZPtitle" title="Groups"></span><span name="taskOwner"></span></div><div class="form-group"><span class="IC-team gry MR10 ZPtitle" title="Department"></span><span name="taskOwner"></span></div><div class="form-group"><span class="IC-user gry MR10 ZPtitle" title="Employee"></span><span name="taskOwner"></span></div></div></div><div class="row"><label class="control-label col-md-4">'+ZPI18N.getString("zp.initiatedby")+'</label><div class="form-group col-md-8"><span id="checklistInitiatedBy"></span></div></div><div class="row"><label class="control-label col-md-4">'+ZPI18N.getString("zp.initiatedon")+'</label><div class="form-group col-md-8"><span id="checklistInitiatedOn"></span></div></div><div class="row"><label class="control-label col-md-4">'+ZPI18N.getString("zp.triggeredaction")+'</label><div class="form-group col-md-8"><span id="checklistTriggeredOn"></span></div></div></div><div class="main-media CL FL MT20"><div class="media-comments"><div class="media" id="commentBodyDummy" style="display:none"><div class="media-left"> <img src="" class="media-object" /></div><div class="media-body"><div class="media-resize"><a><b></b></a> <span class="dt-time"></span><p class="post-content MT8"></p></div></div></div><div id="checklistComments"><div class="media" id="commentHead"><div class="media-left"> <span class="IC-chat S16"></span> </div><div class="media-body"><a id="cmtCount"></a></div></div></div></div></div></div></div><div class="modal-footer"><div class="media"><div class="media-left"><img src="" class="Usrimg FL MR10 MT5"></div><div class="media-body"><div class="media-resize"><div class="mentions-input-box"><div class="mentions"></div><textarea placeholder="'+ZPI18N.getString("zp.writeacomment")+'" class="form-control ZP-postcmt"></textarea><div  class="mentions-autocomplete-list"></div></div><div class="text-right ZP-cmtbtn DB PT10"><div class="mentions"></div><button class="btn btn-primary" onclick="ZPChecklist.saveComment(this)">'+ZPI18N.getString("zp.post")+'</button><div class="mentions-autocomplete-list"></div></div></div></div></div></div></div></div></div>',getChecklistData:function(){var pageId=$("#"+AutomationCommon.getCurrentPageId()),formId=pageId.find("#myChecklistComboBox").val(),mode=pageId.find("#checklistStatusCombo").val(),url="",params={formId:formId,mode:mode,method:"getMyChecklistItem",conreqcsr:csrfToken};if(isadmin?(params.method="getAdminChecklistItem",params.erecno=pageId.find("#employeeChecklistCombo").val(),url="/checklistAdminAction.zp"):(params.method="getMyChecklistItem",url="/checklistAction.zp"),params.index="pending"===mode||"overdue"===mode?pageId.find(".IC-rou-tik.gry").length+1:pageId.find(".IC-rou-tik").length+1,0==pageId.find(".IC-rou-tik").length&&ZPACommon.showEmptyListPage("pageloading"),pageId.find("#dvFiltersec").is(":visible")&&(params.searchString=pageId.find("#taskSearchString").val(),params.sDate=pageId.find("#datePicker").val(),params.sDate==CUSTOM_DATE)){var dateStr=pageId.find("#customDatePicker").find("input").val(),dates=ZPChecklist.splitFromToDate(dateStr);params.sDate=dates.from,params.eDate=dates.to}ZPeople.Request.send(url,params,ZPChecklist.appendDataInHead)},regFilterClickEvent:function(){var pageId=$("#"+AutomationCommon.getCurrentPageId());pageId.find("#filterIcon").click(function(){pageId.find("#dvFiltersec").is(":visible")?(pageId.find("#dvFiltersec").addClass("DN"),pageId.find("#contWrapper").removeClass("open"),pageId.find("#filterIcon").removeClass("active")):(pageId.find("#dvFiltersec").removeClass("DN"),pageId.find("#contWrapper").addClass("open"),pageId.find("#datePicker").select2(),pageId.find("#filterIcon").addClass("active"))})},splitFromToDate:function(dateStr){var parts=dateStr.split("-"),dates={};return 2==parts.length?(dates.from=parts[0],dates.to=parts[1]):6==parts.length&&(dates.from=parts[0]+"-"+parts[1]+"-"+parts[2],dates.to=parts[3]+"-"+parts[4]+"-"+parts[5]),dates},resetChecklistTaskPage:function(){$(".ERR").remove(),ZPChecklist.isValideTaskFilter()&&($("#"+AutomationCommon.getCurrentPageId()).find("#myChecklistTable").html(""),ZPChecklist.getChecklistData())},isValideTaskFilter:function(){var pageId=$("#"+AutomationCommon.getCurrentPageId()),sDate=pageId.find("#datePicker").val(),mode=pageId.find("#checklistStatusCombo").val();if(pageId.find("#customDateErr").remove(),pageId.find("#dvFiltersec").is(":visible")){if(sDate==CUSTOM_DATE){var dateStr=pageId.find("#customDatePicker").find("input").val(),dates=ZPChecklist.splitFromToDate(dateStr);if(void 0==dates.from||void 0==dates.to||!Calendar.isvalidDate(dates.from)||!Calendar.isvalidDate(dates.to))return pageId.find("#customDatePicker").append('<div class="ERR WNW" id="customDateErr">'+ZPI18N.getString("zp.selectfromandto")+"</div>"),!1;if(Calendar.parseDate(dates.from,uidateFormat)>Calendar.parseDate(dates.to,uidateFormat))return pageId.find("#customDatePicker").append('<div class="ERR WNW" id="customDateErr">'+ZPI18N.getString("zp.holiday.datefromtoerror")+"</div>"),!1}if("completed"===mode&&(sDate==TOMORROW||sDate==NEXT_7_DAYS))return pageId.find("#datePicker").parent().append('<div class="ERR WNW" id="customDateErr">'+ZPI18N.getString("zp.entervalidperiod")+"</div>"),!1}return!0},appendDataInHead:function(data){var pageId=$("#"+AutomationCommon.getCurrentPageId()),listTable="";0==pageId.find(".IC-rou-tik").length?(pageId.find("#myChecklistTable").html(""),0==data.length?listTable='<div class="col-lg-12 text-center"><div class="PArds"></div><h2 class="ZPNdt">'+ZPI18N.getString("zp.nochecklistassigned")+"</h2></div>":(listTable='<div class="table-responsive"><table class="table table-hover"><thead><tr><th width="70"></th><th width="35%"><span >'+ZPI18N.getString("zp.tasks")+'</span></th><th  width="20%">'+ZPI18N.getString("zp.initiatedby")+"</th><th>"+ZPI18N.getString("zp.formname")+"</th>",listTable+='<th width="20%">'+ZPI18N.getString("zp.status")+"</th></tr></thead><tbody>",listTable+=ZPChecklist.constructList(data)+"</tbody></table></div>"),pageId.find("#myChecklistTable").append(listTable),ZPChecklist.setup()):(listTable=ZPChecklist.constructList(data),listTable=ZPChecklist.regClickEvents($(listTable)),pageId.find("#myChecklistTable").find("tbody").append(listTable)),data.length==CHECKLIST_REC_PERPAGE&&ZPeople.FireScroll.reset()},constructList:function(data){var listTable="",tickColor="",status="",onClick="",endDate="",relatedRecordOwnerName="",employeePhoto="",deptName="",relatedRecordOwnerErecno="",empId="";return void 0==ZPeople.EMP_FORMID&&(ZPeople.EMP_FORMID=data[0].employeeFormId),$.each(data,function(){status=ZPChecklist.getStatus(this.isCompleted,this.isOverDue,this.endDate),this.isCompleted?(tickColor="grn",onClick="",endDate=this.actualEndTime,status+=" "+endDate):(tickColor="gry",onClick="onclick=ZPChecklist.changeStatus('"+this.checkItemDataId+"')",endDate=this.endDate),void 0!=this.related_recordOwnerDetails&&void 0!=this.related_recordOwnerDetails.employeePhoto?(employeePhoto=this.related_recordOwnerDetails.employeePhoto,deptName=void 0!=(deptName=ZPeople.getUserDetailsById(this.related_recordOwnerDetails.erecno).deptName)?", "+deptName:"",empId=this.related_recordOwnerDetails.employeeID,relatedRecordOwnerName=this.related_recordOwnerDetails.name,relatedRecordOwnerErecno=this.related_recordOwnerDetails.erecno):(employeePhoto=this.recordOwnerDetails.employeePhoto,deptName=void 0!=(deptName=ZPeople.getUserDetailsById(this.recordOwnerDetails.erecno).deptName)?", "+deptName:"",empId=this.recordOwnerDetails.employeeID,relatedRecordOwnerName=this.recordOwnerDetails.name,relatedRecordOwnerErecno=this.recordOwnerDetails.erecno),listTable+='<tr><td><span id="checkSpan_'+this.checkItemDataId+'" class="IC-rou-tik '+tickColor+' S20 ML20 ZPtitle" title="Task Success" '+onClick+"></span></td>",listTable+='<td><div class="FL MR10"data-toggle="tooltip" data-placement="top" data-original-title="'+empId+" - "+relatedRecordOwnerName+'"><img src="'+employeePhoto+'" class="Usrimg MT5" /></div><div class="tragcont PL0"><a class="lnk" data-target="#myClTaskComment" data-toggle="modal" name="commentlink" checkitemdataid=\''+this.checkItemDataId+"'>"+this.displayName+"</a>",listTable+="<p>"+empId+' - <a class="lnk" name="record" formid=\''+ZPeople.EMP_FORMID+"' recordid='"+relatedRecordOwnerErecno+"'>"+relatedRecordOwnerName+"</a>"+deptName+"</p></div></td>",listTable+='<td><p><a class="lnk" name="record" formid=\''+ZPeople.EMP_FORMID+"' recordid='"+this.recordOwnerDetails.erecno+"'>"+this.recordOwnerDetails.name+"</a></p></td>",listTable+='<td><a name="record" formid=\''+this.checklist.formId+"' recordid='"+this.checklist.recordId+"'>"+this.checklist.formName+"</a></td>",listTable+='<td name="status">'+status+"</td></tr>"}),listTable},isCustomDate:function(){var pageId=$("#"+AutomationCommon.getCurrentPageId());pageId.find("#datePicker").val()==CUSTOM_DATE?pageId.find("#customDatePicker").removeClass("DN"):pageId.find("#customDatePicker").addClass("DN")},getStatus:function(isCompleted,isOverDue,endDate){var status="";if(isCompleted)status='<div class="grn">'+ZPI18N.getString("zp.completed")+'</div> <span class="gry"> '+ZPI18N.getString("zp.on")+"</span>";else{var statusMsg=isOverDue?"zp.overdue":"zp.inprogress",dueDateMsg=isOverDue?"zp.wasdueon":"zp.dueon";status='<div class="'+(isOverDue?"red":"org")+'">'+ZPI18N.getString(statusMsg)+"</div> <span>"+ZPI18N.getString(dueDateMsg)+" "+endDate+"</span>"}return status},commentSlide:function(checkItemDataId){var pageId=$("#"+AutomationCommon.getCurrentPageId());pageId.find("#assignedToList").html("");var params={checkItemDataId:checkItemDataId,method:"getComments",conreqcsr:csrfToken};$.post("/getChecklistComments.zp",params,function(data){var employeePhoto="",empId="",relatedRecordOwnerName="";void 0!=data[0].related_recordOwnerDetails&&void 0!=data[0].related_recordOwnerDetails.employeePhoto?(employeePhoto=data[0].related_recordOwnerDetails.employeePhoto,empId=data[0].related_recordOwnerDetails.employeeID,relatedRecordOwnerName=data[0].related_recordOwnerDetails.name):(employeePhoto=data[0].recordOwnerDetails.employeePhoto,empId=data[0].recordOwnerDetails.employeeID,relatedRecordOwnerName=data[0].recordOwnerDetails.name);data[0].isCompleted?data[0].actualEndTime:data[0].endDate;var checkitemDetail='<div class="FL MR10"data-toggle="tooltip" data-placement="top" data-container="body" data-original-title="'+empId+" - "+relatedRecordOwnerName+'"><img src="'+employeePhoto+'" class="Usrimg FL MR10 ML5" /></div><div class="tragcont"><div class="S16">'+data[0].displayName+"</div></div>",taskOwners="",rowIndex=0;data[0].actualEndTime=void 0==data[0].actualEndTime?"":data[0].actualEndTime,pageId.find("#commentSlideHead").find("h6").text(ZPeople.decodeTxt(data[0].checklist.checklistName)),pageId.find("#commentSlideHead").attr("checkid",data[0].checkItemDataId),pageId.find("#checkitemDetail").html(checkitemDetail),pageId.find("#checklistFormName").attr("formid",data[0].checklist.formId),pageId.find("#checklistFormName").attr("recordid",data[0].checklist.recordId),pageId.find("#checklistInitiatedBy").text(ZPeople.decodeTxt(data[0].recordOwnerDetails.name)),pageId.find("#checklistInitiatedOn").html(data[0].startDate),pageId.find("#checklistTriggeredOn").html(ZPI18N.getString(ZPChecklist.triggerAction(data[0])));var closedByImg=void 0!=data[0].closeBy?'<img class="Usrimg FL MR10 MT5" src="'+data[0].closeBy.employeePhoto+'">':"";pageId.find("#checkitemDetail").siblings("th").html(closedByImg+ZPChecklist.getStatus(data[0].isCompleted,data[0].isOverDue,data[0].endDate)+" "+data[0].actualEndTime),pageId.find("#checklistFormName").text(ZPeople.decodeTxt(data[0].checklist.formName)),pageId.find("#checklistTaskOwner").children().attr("style","display:none").removeAttr("visible").find("[name=taskOwner]").html(""),$.each(data[0].taskOwners,function(taskOwner,row){taskOwners="",0!=this.length&&($.each(row,function(index,assignedTo){""!=taskOwners&&(taskOwners+=","),taskOwners+=" "+assignedTo.value}),$(pageId.find("#checklistTaskOwner").children()[rowIndex]).show().attr("visible","true").attr("class","form-group").find("span").last().html(taskOwners)),rowIndex++}),pageId.find("#checklistTaskOwner").children("[visible=true]").last().removeAttr("class"),pageId.find("#commentHead").siblings().remove(),$.each(data[0].comments,function(index,commentDtl){comments=pageId.find("#commentBodyDummy").cloneRow("#checklistComments"),comments.find("b").text(ZPeople.decodeTxt(commentDtl.name)),comments.find("img").attr("src",commentDtl.employeePhoto),comments.find("p").text(commentDtl.comment),comments.find("span").text(commentDtl.createdTime)});var commentHeadMsg="",commentsCount=data[0].comments.length;0==commentsCount?(commentHeadMsg=ZPI18N.getString("zp.comment"),pageId.find("#commentHead").find("a").attr("expanded",!0)):commentsCount<=3?(commentHeadMsg=ZPI18N.getString("zp.viewingallcomments",[commentsCount]),pageId.find("#commentHead").find("a").attr("expanded",!0)):(commentHeadMsg=ZPI18N.getString("zp.viewallcomments",[commentsCount]),$("#commentHead").siblings().slice(0,commentsCount-3).hide(),pageId.find("#commentHead").find("a").attr("expanded",!1)),pageId.find("#commentHead").find("a").text(commentHeadMsg),pageId.find("#commentHead").find("a").attr("count",commentsCount),pageId.find("div.modal-footer").find("img").attr("src",ZPeople.CURR_USER.avatar),pageId.find("#myClReqComment").modal("show"),$($(".modal-backdrop")[0]).siblings(".modal-backdrop").remove()})},viewAllComments:function(getThis){0!=$("#"+AutomationCommon.getCurrentPageId()).find("#commentHead").siblings().length&&($(getThis).text(ZPI18N.getString("zp.viewingallcomments",[$(getThis).attr("count")])),$(getThis).attr("expanded",!0),$(getThis).parent().parent().siblings().show())},viewRecord:function(formId,pkId){$($(".modal-backdrop")[0]).remove(),$("#"+AutomationCommon.getCurrentPageId()).find("#rootTaskTriggerDtlsPage").remove(),$("#"+AutomationCommon.getCurrentPageId()).find("#myClReqComment").remove(),ZPACommon.viewRecord(formId,pkId),ZPChecklist.setup()},changeStatus:function(dataId){var currentRow=$("#checkSpan_"+dataId).closest("tr"),params={dataid:dataId,method:"completeTask",conreqcsr:csrfToken};$.post("/changeCheckitemStatus.zp",params,function(data){"success"==data&&($("#checkSpan_"+dataId).removeClass("gry").addClass("grn").removeAttr("onclick"),currentRow.find("[name=status]").html(ZPChecklist.getStatus("true")+" "+ZPI18N.getString("zp.today")))})},triggerInfo:function(obj){var triggerDetail="";if(void 0!=obj.workflowdetails)switch(obj.workflowdetails.action){case WF_ACTION_ADD:triggerDetail="zp.triggermessageadd";break;case WF_ACTION_EDIT:triggerDetail="zp.triggermessageedit";break;case WF_ACTION_DELETE:triggerDetail="zp.triggermessagedelete";break;case WF_ACTION_APPROVE:triggerDetail="zp.triggermessageapprove";break;case WF_ACTION_REJECT:triggerDetail="zp.triggermessagereject";break;case WF_ACTION_ADDOREDIT:triggerDetail="zp.triggermessageaddoredit";break;case WF_ACTION_FIELDVALUECHANGE:triggerDetail="zp.triggermessagefieldvalue";break;case WF_ACTION_REMINDER:triggerDetail="zp.triggermessageremainder"}else triggerDetail="zp.triggermessageadd";return triggerDetail},triggerAction:function(obj){var triggerDetail="";if(void 0!=obj.workflowdetails)switch(obj.workflowdetails.action){case WF_ACTION_ADD:triggerDetail="zp.create";break;case WF_ACTION_EDIT:triggerDetail="zp.edit";break;case WF_ACTION_DELETE:triggerDetail="zp.delete";break;case WF_ACTION_APPROVE:triggerDetail="zp.approved";break;case WF_ACTION_REJECT:triggerDetail="zp.rejected";break;case WF_ACTION_ADDOREDIT:triggerDetail="zp.workflow.createoredit";break;case WF_ACTION_FIELDVALUECHANGE:triggerDetail="zp.fieldupdates";break;case WF_ACTION_REMINDER:triggerDetail="zp.date"}else triggerDetail="zp.workflow.createoredit";return triggerDetail},filterChanges:function(thisObj){var pageId=$("#"+AutomationCommon.getCurrentPageId());$(thisObj).toggleClass("active");var filterObj=pageId.find("div#filterSec");pageId.find("div.ZPcontwrap").hasClass("open")?(pageId.find("div.ZPcontwrap").removeClass("open"),filterObj.removeClass("in"),filterObj.addClass("hide")):(pageId.find("div.ZPcontwrap").addClass("open"),filterObj.addClass("in"),filterObj.fadeIn("slow"),filterObj.removeClass("hide"))},saveComment:function(getThis){var textArea=$(getThis).parent().parent().find("textarea"),params={checkid:$("#"+AutomationCommon.getCurrentPageId()).find("#commentSlideHead").attr("checkid"),notes:textArea.val(),conreqcsr:csrfToken};$.post("/AddChecklistComment.zp",params,function(data){ZPChecklist.newComment(textArea.val()),textArea.val("")})},newComment:function(comment){var pageId=$("#"+Layout.Page.pageId),newRow=pageId.find("#commentBodyDummy").clone();pageId.find("#taskCommentBox").before(newRow);var count=parseInt(pageId.find("#cmtCount").attr("count"))+1,isExpanded=pageId.find("#commentHead").find("a").attr("expanded");newRow.attr("id","taskcomment").removeAttr("style"),newRow.find("b").text("Me"),newRow.find("p").text(comment),newRow.find("span").text(ZPI18N.getString("zp.today")),newRow.find("img").attr("src",ZPeople.CURR_USER.avatar),pageId.find("#commentHead").find("a").attr("count",count),pageId.find("#commentSlideBody").animate({scrollTop:pageId.find("#checklistComments").find(".media").last().position().top}),$.parseJSON(isExpanded)?pageId.find("#commentHead").find("a").text(ZPI18N.getString("zp.viewingallcomments",[count])):pageId.find("#commentHead").find("a").text(ZPI18N.getString("zp.viewallcomments",[count]))},getMyChecklistReqData:function(){var pageId=$("#"+AutomationCommon.getCurrentPageId()),formId=pageId.find("#myChecklistReqComboBox").val(),params={mode:pageId.find("#myReqStatusCombo").val(),method:"getMyChecklistReq",conreqcsr:csrfToken};0!=formId&&(params.formId=formId);var url="";if(isadmin||isOperationalRoleAdmin?(url="/getAdminChecklistReq.zp",params.method="getAdminChecklistReq",params.erecno=pageId.find("#checklistReqEmployeeCombo").val()):(url="/getMyChecklistReq.zp",params.method="getMyChecklistReq"),0==pageId.find("#myChecklistReqTable").find("tbody").children().length&&ZPACommon.showEmptyListPage("pageloading"),params.index=$("#myChecklistReqTable").find("tbody").children().length+1,pageId.find("#dvFiltersec").is(":visible")&&(params.searchString=pageId.find("#taskSearchString").val(),params.sDate=pageId.find("#datePicker").val(),params.sDate==CUSTOM_DATE)){var dateStr=pageId.find("#customDatePicker").find("input").val(),dates=ZPChecklist.splitFromToDate(dateStr);if(void 0==dates.from||void 0==dates.to||!Calendar.isvalidDate(dates.from)||!Calendar.isvalidDate(dates.to))return pageId.find("#customDatePicker").append('<div class="ERR WNW">'+ZPI18N.getString("zp.selectfromandto")+"</div>"),void pageId.find("#myChecklistReqTable").html("").append('<div class="col-lg-12 text-center"><div class="PArds"></div><h2 class="ZPNdt">'+ZPI18N.getString("zp.checklistnottriggered")+"</h2></div>");if(Calendar.parseDate(dates.from,uidateFormat)>Calendar.parseDate(dates.to,uidateFormat))return pageId.find("#customDatePicker").append('<div class="ERR WNW">'+ZPI18N.getString("zp.holiday.datefromtoerror")+"</div>"),void pageId.find("#myChecklistReqTable").html("").append('<div class="col-lg-12 text-center"><div class="PArds"></div><h2 class="ZPNdt">'+ZPI18N.getString("zp.checklistnottriggered")+"</h2></div>");params.sDate=dates.from,params.eDate=dates.to}ZPeople.Request.send(url,params,ZPChecklist.appendToCheckReqHead)},resetChecklistReqPage:function(){$(".ERR").remove(),ZPChecklist.isValidChecklistFilter()&&($("#"+AutomationCommon.getCurrentPageId()).find("#myChecklistReqTable").html(""),ZPChecklist.getMyChecklistReqData())},isValidChecklistFilter:function(){var pageId=$("#"+AutomationCommon.getCurrentPageId());if(pageId.find("#dvFiltersec").is(":visible")&&pageId.find("#datePicker").val()==CUSTOM_DATE){var dateStr=pageId.find("#customDatePicker").find("input").val(),dates=ZPChecklist.splitFromToDate(dateStr);if(void 0==dates.from||void 0==dates.to||!Calendar.isvalidDate(dates.from)||!Calendar.isvalidDate(dates.to))return pageId.find("#customDatePicker").append('<div class="ERR WNW">'+ZPI18N.getString("zp.selectfromandto")+"</div>"),!1;if(Calendar.parseDate(dates.from,uidateFormat)>Calendar.parseDate(dates.to,uidateFormat))return pageId.find("#customDatePicker").append('<div class="ERR WNW">'+ZPI18N.getString("zp.holiday.datefromtoerror")+"</div>"),!1}return!0},appendToCheckReqHead:function(data){var pageId=$("#"+AutomationCommon.getCurrentPageId()),listTable="";0==pageId.find("#myChecklistReqTable").find("tbody").children().length?(pageId.find("#myChecklistReqTable").html(""),0==data.length?listTable='<div class="col-lg-12 text-center"><div class="PArds"></div><h2 class="ZPNdt">'+ZPI18N.getString("zp.checklistnottriggered")+"</h2></div>":(listTable='<div class="table-responsive"><table class="table table-hover"><thead><thead><tr><th width="20"></th>',listTable+="<th><span>"+ZPI18N.getString("zp.workflow.checklist")+'</span></th><th width="32%">'+ZPI18N.getString("zp.status")+"</th></tr></thead><tbody>",listTable+=ZPChecklist.constructMyChecklistReq(data)+"</tbody></table>"),pageId.find("#myChecklistReqTable").append(listTable),ZPChecklist.setup()):(listTable=ZPChecklist.constructMyChecklistReq(data),listTable=ZPChecklist.regClickEvents($(listTable)),pageId.find("#myChecklistReqTable").find("tbody").append(listTable)),data.length==CHECKLIST_REC_PERPAGE&&ZPeople.FireScroll.reset()},constructMyChecklistReq:function(data){var listTable="",triggerDetail="",status="",employeePhoto="",empId="",relatedRecordOwnerName="";return $.each(data,function(){void 0!=this.related_recordOwnerDetails&&void 0!=this.related_recordOwnerDetails.employeePhoto?(employeePhoto=this.related_recordOwnerDetails.employeePhoto,empId=this.related_recordOwnerDetails.employeeID,relatedRecordOwnerName=this.related_recordOwnerDetails.name):(employeePhoto=this.recordOwnerDetails.employeePhoto,empId=this.recordOwnerDetails.employeeID,relatedRecordOwnerName=this.recordOwnerDetails.name),status=this.isCompleted?'<div class="grn">'+ZPI18N.getString("zp.completed")+"</div>":'<div class="org">'+ZPI18N.getString("zp.inprogress")+"</div>",triggerDetail=ZPChecklist.getMyreqTriggerInfo(this),listTable+='<tr><td></td><td><div class="FL MR10"data-toggle="tooltip" data-placement="top" data-container="body" data-original-title="'+empId+" - "+relatedRecordOwnerName+'"><img src="'+employeePhoto+'" class="Usrimg FL MR10 MT5" /></div><div class="tragcont PL0"><a class="lnk ZPbold S15" checkrootid='+this.checkItemRootId+" recordid="+this.recordId+' data-toggle="modal">'+this.checklistName+"</a>",listTable+='<p class="S13">'+triggerDetail+"</p>",listTable+="</div></td><td>"+status+"</td></tr>"}),listTable},getChecklistsForRecord:function(recordId,formId){void 0===recordId&&(recordId=ZPForm.CURRFORM_PARAM.recordId,formId=ZPForm.CURRFORM_PARAM.formId);var pageId=$("#"+AutomationCommon.getCurrentPageId());pageId.find("#rootTaskTriggerDtlsPage").is(":visible")||ZPChecklist.setup(),pageId.find("#zp_addedit_record_"+formId).remove();var rootTaskPage=pageId.find("#rootTaskTriggerDtlsPage");$(rootTaskPage.find("#checkrootList").children(0)).show(),rootTaskPage.find("#checkrootList").children().remove(),$(rootTaskPage.find("#checkrootList").children(0)).hide();var params={method:"getCheckItemRootDetails",recordId:recordId,conreqcsr:csrfToken};$.post("/getCheckitemRootDetails.zp",params,function(data){if(0!==data.length)$.each(data,function(index,checklistRoot){var checkroot=ZPChecklist.constructChecklistRoot(checklistRoot);ZPChecklist.regClickEvents(checkroot)}),rootTaskPage.find("#checkrootList").children().click(function(){$(this).siblings().find(".collapse.in").parent().children().find("tr").click(),Task.getCheckRootTasks(this)}),$(rootTaskPage.find("#checkrootList").children()[0]).find("tr").click(),$(rootTaskPage.find("#checkrootList").children()[0]).children().attr("class","dvchkhead");else{var placeToAppend=$("#"+AutomationCommon.getCurrentPageId()).find("div.modal-body:visible#checkrootList");placeToAppend.children().hide(),placeToAppend.append('<div class="ZPNdata"><div id="nochecklist"></div><p class="no-para">'+ZPI18N.getString("zp.nochecklistsassociated")+"</p></div>");var noDataSvg=ZPeople.getResourceURL(newUIImageUrl+"svg/no-records.svg");ZPUtil.noDataSVG("nochecklist",noDataSvg)}rootTaskPage.modal({backdrop:"static"}),$($(".modal-backdrop")[1]).remove()}),ZPForm.CURRFORM_PARAM.recordId=recordId,ZPForm.CURRFORM_PARAM.formId=formId,$("#"+AutomationCommon.getCurrentPageId()).find("#rootClose").click(function(){$(".modal-backdrop").remove(),ZPACommon.viewRecord(formId,recordId,"",!0)})},checklistTriggerData:function(getThis){var pageId=$("#"+AutomationCommon.getCurrentPageId()),rootTaskPage=pageId.find("#rootTaskTriggerDtlsPage");0===rootTaskPage.length&&(pageId.append(ZPChecklist.CHECKITEMROOT_TEMPLATE),rootTaskPage=pageId.find("#rootTaskTriggerDtlsPage")),rootTaskPage.modal({backdrop:"static"}),pageId.find("#checkrootList").children().remove();var rootDetail=$(getThis).parent().parent().parent().clone(),currentCheckroot=$($("#"+AutomationCommon.getCurrentPageId()).find("#rootTaskTriggerDtlsPage").find("#checkrootList").siblings(".row")).clone().cloneRow("#checkrootList");currentCheckroot.find("tr").replaceWith(rootDetail),currentCheckroot.attr("id","taskRootDiv"),rootTaskPage.find("#taskRootDiv").attr("checkrootid",$(getThis).attr("checkrootid")),Task.getCheckRootTasks(rootTaskPage.find("#taskRootDiv"),!0)},constructChecklistRoot:function(data){var status=data.checklist.isCompleted?'<div class="grn">'+ZPI18N.getString("zp.completed")+'</div><span class="gry"> '+ZPI18N.getString("zp.on")+"</span> "+data.checklist.endTime:'<div class="org">'+ZPI18N.getString("zp.inprogress")+"</div>",recordOwnerDetails=data.recordOwnerDetails,checklistDisplayName=data.checklist.checklistName;data.isCommentSlide=!0;var triggerInfo=ZPI18N.getString(ZPChecklist.triggerInfo(data),["",'<a name="record" onclick="ZPChecklist.viewRecord(\''+data.checklist.formId+"', '"+data.checklist.recordId+"')\">"+data.checklist.formName+"</a>"]),currentCheckroot=$($("#"+AutomationCommon.getCurrentPageId()).find("#rootTaskTriggerDtlsPage").find("#checkrootList").siblings(".row")).clone().cloneRow("#checkrootList"),employeePhoto="",empId="",empName="";return void 0!=data.related_recordOwnerDetails&&void 0!=data.related_recordOwnerDetails.employeePhoto?(employeePhoto=data.related_recordOwnerDetails.employeePhoto,empId=data.related_recordOwnerDetails.employeeID,empName=data.related_recordOwnerDetails.name):(employeePhoto=recordOwnerDetails.employeePhoto,empId=recordOwnerDetails.employeeID,empName=recordOwnerDetails.name),currentCheckroot.attr("checkRootId",data.checklist.checkItemRootId),currentCheckroot.attr("recordId",data.checklist.recordId),currentCheckroot.find("#taskClName").text(ZPeople.decodeTxt(checklistDisplayName)),currentCheckroot.find("#taskOwnerImg").attr("src",employeePhoto),currentCheckroot.find("#taskOwnerImg").parent().attr("data-original-title",empId+" - "+ZPeople.decodeTxt(empName)),currentCheckroot.find("#rootStatus").html(status),currentCheckroot.find("#myReqTriggerInfo").html(triggerInfo),currentCheckroot.find("#taskForm").text(data.formName),currentCheckroot},getChecklistItem:function(getThis,callback){var checklistId=$(getThis).attr("checkrootId"),pageId=$("#"+AutomationCommon.getCurrentPageId());if(0==pageId.find("#taskRootDiv_"+checklistId).length||callback){var recordId=$(getThis).attr("recordId");$(getThis).attr("id","taskRootDiv_"+checklistId),$(getThis).find("tr").find("#taskClName").addClass("CP").attr("data-target","#taskDtlsDiv_"+checklistId),$(getThis).find("#taskDtlsDiv").attr("id","taskDtlsDiv_"+checklistId);var params={method:"getChecklistTriggerData",recordId:recordId,checklistId:checklistId,conreqcsr:csrfToken};$.ajax({url:"/getClTriggerData.zp",type:"POST",data:params,success:function(data){void 0!=data.checklist&&(ZPChecklist.taskParentDtls=data,1==callback?(pageId.find("#checkrootList").children().remove(),getThis=ZPChecklist.constructChecklistRoot(ZPChecklist.taskParentDtls),$.each(data.parentDtls[0],function(index,parentTaskId){$(getThis).find("ul").append(ZPChecklist.taskDtlsRecursion(parentTaskId)),ZPChecklist.regClickEvents($(getThis))})):$.each(data.parentDtls[0],function(index,parentTaskId){$(getThis).find("#taskDtlsDiv_"+checklistId).find("ul").append(ZPChecklist.taskDtlsRecursion(parentTaskId))}))}})}},taskDtlsRecursion:function(taskItemId){var taskParentDtls=ZPChecklist.taskParentDtls.parentDtls,checklistItemDtls=ZPChecklist.taskParentDtls.checklistItem[taskItemId],taskChildArray=taskParentDtls[taskItemId],li=ZPChecklist.getTaskDtlsRecHtml(checklistItemDtls);if(void 0===taskChildArray)return li;var parentDiv=li.append($("<ul>",{parentTask:taskItemId}));return $.each(taskChildArray,function(index,childTaskItem){parentDiv.find("ul[parentTask='"+taskItemId+"']").append(ZPChecklist.taskDtlsRecursion(childTaskItem))}),parentDiv},getTaskDtlsRecHtml:function(checklistItemDtls){var action=ZPI18N.getString("zp.chkyettostart"),statusColor="org",process="",date="",li="",isValidChecklistItem=!0;if(!0===checklistItemDtls.isCompleted?(1,action=ZPI18N.getString("zp.completed"),process=ZPI18N.getString("zp.on"),date=checklistItemDtls.actualEndTime,statusColor="grn"):!1===checklistItemDtls.isCompleted?(0,!0===checklistItemDtls.isOverDue?(action=ZPI18N.getString("zp.overdue"),statusColor="red",process=ZPI18N.getString("zp.wasdueon")):(action=ZPI18N.getString("zp.chkinprogress"),statusColor="org",process=ZPI18N.getString("zp.dueon")),date=checklistItemDtls.endDate):void 0==checklistItemDtls.parentCheckItemId||0==checklistItemDtls.parentCheckItemId?isValidChecklistItem=!1:void 0!=checklistItemDtls.parentCheckItemId&&(isValidChecklistItem=!ZPChecklist.taskParentDtls.checklistItem[checklistItemDtls.parentCheckItemId].isCompleted),isValidChecklistItem){var cmtlink="";void 0!=checklistItemDtls.checkItemDataId&&(cmtlink='name="cmtlink" checkitemdataid=\''+checklistItemDtls.checkItemDataId+"'");var col1='<div class="collst1"> <div class="PT10 PL15"><a  class="lnk" '+cmtlink+">"+checklistItemDtls.displayName+"</a></div></div>",col3='<div class="collst3"> <div class="PT5 PB3 '+statusColor+'">'+action+'</div><span class="gry">'+process+"</span> "+date+" </div>";(li=$("<li>",{id:checklistItemDtls.checklistItemId})).append(col1,'<div class="collst2"></div>',col3),li.find("[name=cmtlink]").click(function(){ZPChecklist.commentSlide($(this).attr("checkitemdataid"))})}return li},getMyreqTriggerInfo:function(obj){var triggerDetail="";if(void 0!=obj.workflowdetails)switch(obj.workflowdetails.action){case WF_ACTION_ADD:triggerDetail="zp.triggerreqmessageadd";break;case WF_ACTION_EDIT:triggerDetail="zp.triggerreqmessageedit";break;case WF_ACTION_DELETE:triggerDetail="zp.triggerreqmessagedelete";break;case WF_ACTION_APPROVE:triggerDetail="zp.triggerreqmessageapprove";break;case WF_ACTION_REJECT:triggerDetail="zp.triggerreqmessagereject";break;case WF_ACTION_ADDOREDIT:triggerDetail="zp.triggerreqmessageaddoredit";break;case WF_ACTION_FIELDVALUECHANGE:triggerDetail="zp.triggerreqmessagefieldvalue";break;case WF_ACTION_REMINDER:triggerDetail="zp.triggerreqmessageremainder"}else triggerDetail="zp.triggerreqmessageadd";return ZPI18N.getString(triggerDetail,['<a name="record" formid=\''+obj.formId+"' recordid='"+obj.recordId+"'>"+obj.formName+"</a>",obj.startDate])},setup:function(){$("#"+AutomationCommon.getCurrentPageId()).append(ZPChecklist.CHECKITEMROOT_TEMPLATE),ZPChecklist.regClickEvents()},regClickEvents:function(obj){return(obj=void 0==obj?$("#"+AutomationCommon.getCurrentPageId()):obj).find("[name=record]").click(function(){ZPChecklist.viewRecord($(this).attr("formid"),$(this).attr("recordid"))}),obj.find("[name=commentlink]").click(function(){ZPChecklist.commentSlide($(this).attr("checkitemdataid"))}),obj.find("a[checkrootid]").click(function(){ZPChecklist.checklistTriggerData(this),ZPChecklist.rootLink=this}),obj}},ZPTasks={taskComments:{},MODE:"tasks",COMPLETE_TASKS:new Array,loadHeader:function(){var pageId=$("#"+Layout.Page.pageId),url=Layout.Page.hash;Task.getTaskFormid(),Task.getOptionValues(),Task.getStatusOptionValuesBySysVal(),pageId.removeClass("zp_Pshw"),AdvancedFilter.hideFilter(),!Layout.CustomizedUrl.isService()&&-1===url.indexOf("task/watchlist")&&Task.canAddTask()||pageId.find("#add_task_btn").addClass("zp_dyn"),void 0==ZPView.CURR_VIEWPARAMS&&(ZPView.CURR_VIEWPARAMS={formId:Task.taskformid}),-1!==url.indexOf("mytask/addtask")||-1!==url.indexOf("alltask/addtask")?Task.createNewTask():-1!==url.indexOf("task/mytask")?(pageId.find("#tasklist_header").text(ZPI18N.getString("zp.mytasks")),ZPTasks.viewType="list",(void 0==ZPTasks.resetMyTask||ZPTasks.resetMyTask)&&ZPTasks.getMyTasks("reset")):-1!==url.indexOf("task/alltask")||Layout.CustomizedUrl.isService()&&-1!==url.indexOf("/alltask")?(ZPTasks.viewType="list",(void 0==ZPTasks.resetAllTask||ZPTasks.resetAllTask)&&ZPTasks.getAllTasks("reset"),pageId.find("#tasklist_header").text(ZPI18N.getString("zp.alltasks"))):-1!==url.indexOf("task/unassignedtask")?(ZPTasks.viewType="list",(void 0==ZPTasks.resetUnassignedTask||ZPTasks.resetUnassignedTask)&&ZPTasks.getMyTasks("reset"),pageId.find("#tasklist_header").text(ZPI18N.getString("zp.unassigned"))):-1!==url.indexOf("task/watchlist")?(ZPTasks.viewType="list",(void 0==ZPTasks.resetWatchlist||ZPTasks.resetWatchlist)&&ZPTasks.getAllTasks("reset"),pageId.find("#tasklist_header").text(ZPI18N.getString("zp.watchlist"))):-1!==url.indexOf("task/tracktask")?(ZPTasks.viewType="list",(void 0==ZPTasks.resetTrackTask||ZPTasks.resetTrackTask)&&ZPTasks.getAllTasks("reset"),pageId.find("#tasklist_header").text(ZPI18N.getString("zp.tracktasks"))):-1!==url.indexOf("task/relatedchecklist")||-1!==url.indexOf("checklist/relatedchecklist")?((void 0==ZPTasks.resetRelatedChecklist||ZPTasks.resetRelatedChecklist)&&ZPTasks.getMyChecklist(),pageId.find("#checklist_header_title").text(ZPI18N.getString("zp.relatedchecklists"))):-1===url.indexOf("task/trackchecklist")&&-1===url.indexOf("checklist/trackchecklist")||((void 0==ZPTasks.resetTrackChecklist||ZPTasks.resetTrackChecklist)&&ZPTasks.getMyChecklist(),pageId.find("#checklist_header_title").text(ZPI18N.getString("zp.trackchecklists"))),-1===url.indexOf("mytask/viewtask")&&-1===url.indexOf("alltask/viewtask")&&-1===url.indexOf("unassignedtask/viewtask")&&-1===url.indexOf("watchlist/viewtask")&&-1===url.indexOf("tracktask/viewtask")||(Task.showTaskDetails(Layout.Page.childUrlParam.taskid),pageId.find("[name=task_slider]").removeClass("zp_tskFl"))},resetTasks:function(){ZPTasks.resetMyTask=!0,ZPTasks.resetAllTask=!0,ZPTasks.resetTrackTask=!0},bulkComplete:function(){$.post("/bulkComplete.zp",{conreqcsr:csrfToken,method:"bulkComplete",taskids:JSON.stringify(ZPTasks.COMPLETE_TASKS)},function(data){ZPTasks.COMPLETE_TASKS=[],ZPView.setViewPropertie("refreshStatus",!0),Layout.Page.container.find("#zp_view_record_delete").fadeOut(200,function(){$(this).siblings("#zp_views_formrecactions").fadeIn(200)}),ZPView.init(),ZPeople.Message.showSuccessMsg(data.Status)})},getMyTasks:function(mode){var pageId=$("#"+Layout.Page.pageId),filterBox=pageId.find("#filterOption"),headtag=pageId.find("#headtag"),taskobj={},url=Layout.Page.hash;-1!==url.indexOf("mytask")?ZPTasks.resetMyTask=!1:ZPTasks.resetUnassignedTask=!1,void 0==mode||"reset"!=mode&&"1"!=mode?taskobj.index=pageId.find("#list_container").children().length+1:(pageId.find("#list_container").children().remove(),pageId.find("#list_header").addClass("zp_dyn"),pageId.find("#list_container").append(ZPeople.LOADING_HTML),taskobj.index=1),0!=headtag.length?(CommonTemplates.toCheckEmpty("statusInput_input",taskobj,"status"),CommonTemplates.toCheckEmpty("priorityInput_input",taskobj,"priority"),CommonTemplates.toCheckEmpty("formInput_input",taskobj,"formid"),taskobj.name=filterBox.find("#searchDiv_input").val()):(taskobj.isInitialLoad=!0,-1!==url.indexOf("mytask")&&(taskobj.status=Task.statusBySysVal[Task.OPEN_SYSVALUE].ID)),-1!==url.indexOf("unassignedtask")&&(taskobj.status=Task.UNASSIGNED_SYSVALUE),$.post("/mytasks.zp",{conreqcsr:csrfToken,method:"getMyTasks",criteria:JSON.stringify(taskobj)},function(data){var countBox=pageId.find("#task_count");1==taskobj.index&&(void 0!=countBox.attr("reset")&&"true"!=countBox.attr("reset")||ZPTasks.setTaskCount(data.count),pageId.find("#zp_page_loading").remove()),countBox.attr("reset",!0),ZPTasks.cloneTaskRow(data.tasks,"list_container",taskobj.index),data.hasNextPage&&ZPeople.FireScroll.reset()})},getAllTasks:function(mode){var pageId=$("#"+Layout.Page.pageId),filterBox=pageId.find("#filterOption"),headtag=pageId.find("#headtag"),taskobj={},url=Layout.Page.hash;Task.getOptionValues(),Task.getStatusOptionValuesBySysVal(),-1!==url.indexOf("tracktask")?(ZPTasks.resetTrackTask=!1,taskobj.isTrack=!0):-1!==url.indexOf("watchlist")?(taskobj.isWatchlist=!0,ZPTasks.resetWatchlist=!1):ZPTasks.resetAllTask=!1,void 0!=mode&&"reset"==mode||"1"==mode?(pageId.find("#list_container").children().remove(),pageId.find("#list_header").addClass("zp_dyn"),pageId.find("#list_container").append(ZPeople.LOADING_HTML),taskobj.index=1):taskobj.index=pageId.find("#list_container").children().length+1,0!=headtag.length?(CommonTemplates.toCheckEmpty("statusInput_input",taskobj,"status"),CommonTemplates.toCheckEmpty("priorityInput_input",taskobj,"priority"),CommonTemplates.toCheckEmpty("taskownerInput_input",taskobj,"erecno"),CommonTemplates.toCheckEmpty("formInput_input",taskobj,"formid"),taskobj.name=filterBox.find("#searchDiv_input").val()):(taskobj.isInitialLoad=!0,-1==url.indexOf("watchlist")&&(taskobj.status=Task.statusBySysVal[Task.OPEN_SYSVALUE].ID+","+Task.UNASSIGNED_SYSVALUE)),void 0==taskobj.formid&&Layout.CustomizedUrl.isService()&&(taskobj.service=Layout.CustomizedUrl.getServiceName()),$.post("/alltasks.zp",{conreqcsr:csrfToken,method:"getAllTasks",criteria:JSON.stringify(taskobj)},function(data){var countBox=pageId.find("#task_count");ZPTasks.cloneTaskRow(data.tasks,"list_container",taskobj.index),1==taskobj.index&&(void 0!=countBox.attr("reset")&&"true"!=countBox.attr("reset")||ZPTasks.setTaskCount(data.count),pageId.find("#zp_page_loading").remove()),countBox.attr("reset",!0),data.hasNextPage&&ZPeople.FireScroll.reset()})},addTask:function(){var url=Layout.Page.hash;Task.parentUrl=url,-1!==url.indexOf("user/tasks")?Task.createNewTask():window.location.href="#task/mytask/addtask"},getChecklistsForRecord:function(){Layout.Page.container.find("[id^=record_checklist_]").remove();var recordId=ZPForm.CURRFORM_PARAM.recordId,modalid="record_checklist_"+recordId,pageId=$("#"+Layout.Page.pageId);if(0==pageId.find("#"+modalid).length){var slider='<div class="zp_pv checklist zp_tskFl" name=checklist_slider id='+modalid+'><div class="zp_pwrap"><div class="zp_pvhd zp_miHd"><div class="zp_mark"><span>'+ZPI18N.getString("zp.workflow.checklist")+'</span></div><div class="zp_micn"><ul><li><b><span id="checklist_close_'+recordId+'"><i class="IC-cls"></i></span></b></li></ul></div></div><div class="zp_pvcnt" id="zp_modal_body"></div></div></div></div>';pageId.append(slider),pageId.find("#checklist_close_"+recordId).click(function(){Layout.Page.container.removeClass("zp_Pshw"),pageId.find("#"+modalid).addClass("zp_dyn")});var params={method:"getCheckItemRootDetails",recordId:recordId,conreqcsr:csrfToken};$.post("/getCheckitemRootDetails.zp",params,function(data){var modalbody=$("#"+Layout.Page.pageId).find("#"+modalid).find("#zp_modal_body");modalbody.children().remove(),modalbody.addClass("zp_Lstwrap"),ZPTasks.constructChecklist(data,modalid),$(modalbody.children()[0]).click()})}else pageId.find("#"+modalid).removeClass("zp_dyn");Layout.Page.container.addClass("zp_Pshw")},getMyChecklist:function(index){var pageId=$("#"+Layout.Page.pageId),filterBox=pageId.find("#filterOption"),headtag=pageId.find("#headtag"),params={mode:"all",conreqcsr:csrfToken},url="";isadmin?(url="/getAdminChecklistReq.zp",params.method="getAdminChecklistReq",params.erecno=erecno):(url="/getMyChecklistReq.zp",params.method="getMyChecklistReq"),0!=headtag.length?(CommonTemplates.toCheckEmpty("clistStatusInput_input",params,"mode"),params.mode=void 0===params.mode||""===params.mode?"all":params.mode,CommonTemplates.toCheckEmpty("clistInitInput_input",params,"erecno"),params.searchString=filterBox.find("#searchDiv_input").val(),CommonTemplates.toCheckEmpty("formInput_input",params,"formId")):params.mode="pending",void 0!=index||0==pageId.find("#checklistHead").children().length?(params.index=1,pageId.find("#checklist_header").addClass("zp_dyn"),pageId.find("#checklistHead").children().remove()):params.index=pageId.find("#checklistHead").children().length+1,-1!=Layout.Page.hash.indexOf("relatedchecklist")?(params.isRelated=!0,ZPTasks.resetRelatedChecklist=!1):ZPTasks.resetTrackChecklist=!1,ZPeople.Request.send(url,params,ZPTasks.constructChecklist),Task.getTaskFormid()},getRootTasks:function(rootId,body){var pageId=$("#"+Layout.Page.pageId);if("true"!=$(body).attr("isexpanded")){$(body).attr("isexpanded",!0);var params={method:"getCheckRootTasks",checkitemrootid:rootId,conreqcsr:csrfToken};$.ajax({url:"/getCheckRootTasks.zp",type:"POST",data:params,success:function(data){ZPTasks.constructRootTaskTree(data.tasks,$(body),rootId),void 0===ZPTasks.expandTrack&&(ZPTasks.expandTrack={}),ZPTasks.expandTrack[rootId]={isExpanded:!0},$(body).click(function(){var toggleObj=pageId.find("[checkrootid="+rootId+"]");toggleObj.last().addClass("zp_dyn"),ZPTasks.expandTrack[rootId].isExpanded=!ZPTasks.expandTrack[rootId].isExpanded,pageId.find("[checkrootid="+rootId+"]").slideToggle("slow",function(){ZPTasks.expandTrack[rootId].isExpanded||toggleObj.last().removeClass("zp_dyn")})}),$(body).click()}})}},constructRootTaskTree:function(tasks,body,rootId){for(var pageId=$("#"+Layout.Page.pageId),dispTime="",completeClass="",list="",imgSrc="",row="",rootRow="",priority="",tickMsg="",index=0;index<tasks.length;index++){if(dispTime=void 0===(row=tasks[index]).dispCompletedTime?row.endtime:row.dispCompletedTime,row.iscompleted?(completeClass="zp_cmpl",tickMsg=ZPI18N.getString("zp.reopen")):(completeClass="",tickMsg=ZPI18N.getString("zp.complete")),void 0==row.taskownerdetail?(row.assignedto,imgSrc="<i class=\"IC-user-plu zp_rBf\" name=pick onclick=\"ZPeople.confirm(this,'','zp.taskpickmessage', ZPTasks.pickTask)\" taskid="+row.id+"></i>"):(row.taskownerdetail.employeeID+" - "+row.taskownerdetail.name,imgSrc='<div class="ZP_photo" '+('popup="user" empid= '+row.taskownerdetail.zuid)+"><img src="+row.taskownerdetail.employeePhoto+"></div>"),priority="",row.prioritySysValue==Task.LOW_SYSVALUE?priority='<em class="zp_gbg"></em>':row.prioritySysValue==Task.HIGH_SYSVALUE&&(priority='<em class="zp_rbg"></em>'),list='<div class="zp_Lst '+completeClass+'" onclick="Task.showTaskDetails(\''+row.id+"', "+!0+')" id=pt_'+row.id+" taskid='"+row.id+'\'><div><div class="zp_Ldtl"><div class="zp_Ctre"><i class="IC-task-unchk" data-toggle="tooltip" data-placement="bottom" data-original-title='+tickMsg+' name="completeButton" onclick="ZPTasks.changeStatus(this, ZPACommon.CHECKLIST_MODE)"></i></div><div class="zp_Tdts"><h3>'+priority+row.name+"</h3><em>"+dispTime+'</em></div></div><div class="zp_Lass">'+imgSrc+'</div><div class="zp_Lrgt"><i name=delete class="IC-delete-1px zp_rB" onclick="Task.deleteTaskConfirmation(\''+row.id+"')\"></i></div></div></div>",rootRow=body.siblings("[checkrootid="+rootId+"]"),void 0===row.parenttaskid||0==row.parenttaskid)(0==rootRow.length?body:rootRow.last()).after('<div class="zp_LClst" style="display:none" checkrootid='+rootId+">"+list+"</div>");else 0!=rootRow.find("[taskid="+row.parenttaskid+"]").length?0==body.siblings().find("#pt_"+row.parenttaskid).next(".zp_LClst").length?body.siblings().find("#pt_"+row.parenttaskid).after('<div class="zp_LClst" style="display:none" checkrootid='+rootId+">"+list+"</div>"):pageId.find("#pt_"+row.parenttaskid).next().append(list):tasks.push(row)}$.each(rootRow.find(".zp_Lst"),function(index,taskRow){$(taskRow).hasClass("zp_cmpl")||$(taskRow).next(".zp_LClst").addClass("zp_op5")}),pageId.find("[name=completeButton]").click(function(event){event.stopPropagation()}),pageId.find("[checkrootid="+rootId+"]").find(".zp_LClst").find(".zp_Lst:last").addClass("zp_nbdr"),pageId.find("[name=pick]").click(function(event){event.stopPropagation()}),pageId.find("[name=delete]").click(function(event){event.stopPropagation()})},changeStatus:function(obj,extraParam){var pageId=$("#"+Layout.Page.pageId),rootRow="slider"==extraParam?$(obj).parent().parent():$(obj).parents("div.zp_Lst"),status=rootRow.hasClass("zp_cmpl")?Task.OPEN_SYSVALUE:Task.COMPLETED_SYSVALUE,taskid=rootRow.attr("taskid"),params={taskid:taskid,method:"changeTaskStatus",status:status,conreqcsr:csrfToken},url=Layout.Page.hash;status==Task.OPEN_SYSVALUE?rootRow.removeClass("zp_cmpl"):rootRow.addClass("zp_cmpl"),"slider"!=extraParam&&delete ZPForm.SINGLE_RECORD_DTL[Task.taskformid+"_"+taskid],Task.getOptionValues(),Task.getStatusOptionValuesBySysVal(),$.post("/changeTasksStatus.zp",params,function(data){if("success"==data.Status){var successmsg=status==Task.OPEN_SYSVALUE?ZPI18N.getString("zp.taskreopenedsuccess"):ZPI18N.getString("zp.taskcompletedsuccess");if(ZPeople.Message.showSuccessMsg(successmsg),Task.resetTaskId=taskid,void 0!=extraParam&&extraParam==ZPACommon.CHECKLIST_MODE||-1!=url.indexOf("checklist")||pageId.find("[name=checklist_slider]").is(":visible")){var currentTaskRow=pageId.find("#pt_"+taskid),statusBar="checklist"==extraParam.MODE?$(pageId.find("[status="+rootRow.parent("[checkrootid]").attr("checkrootid")+"]")[0]):pageId.find("#root_"+currentTaskRow.parent().attr("checkrootid")),completed=parseInt(statusBar.find("#completed_cltask_count").text()),total=parseInt(statusBar.find("#total_cltask_count").text());if(status==Task.OPEN_SYSVALUE?(completed-=1,currentTaskRow.next(".zp_LClst").addClass("zp_op5"),currentTaskRow.removeClass("zp_cmpl"),currentTaskRow.find("[name=completeButton]").attr("data-original-title",ZPI18N.getString("zp.complete"))):(currentTaskRow.find("[name=completeButton]").attr("data-original-title",ZPI18N.getString("zp.reopen")),completed+=1,currentTaskRow.addClass("zp_cmpl"),currentTaskRow.next().removeClass("zp_op5")),statusBar.find("#completed_cltask_count").text(completed),statusBar.find("[style]").attr("style","width:"+completed/total*100+"%"),Layout.Page.container.hasClass("zp_Pshw")&&(-1!=url.indexOf("checklist")||-1!=url.indexOf("task"))){var isFullSlide=Layout.Page.container.find("[name=task_slider]").hasClass("zp_tskFl");Task.showTaskDetails(taskid),isFullSlide||Layout.Page.container.find("[name=task_slider]").removeClass("zp_tskFl")}}if("slider"==extraParam){var fcid=pageId.find("[name=task_slider]").find("[folabel=Status]").attr("id").split("_").pop(),status_optionvalue=Task.getOptionValue(fcid,ZPForm.CURRFORM_PARAM.formId,status);if(pageId.find("[name=task_slider]").find("[folabel=Status]").find("span").text(ZPeople.decodeTxt(status_optionvalue)),status==Task.COMPLETED_SYSVALUE){var timesplit=new Date(ZPDateTime.convertToTimezone((new Date).getTime())).constructor().split(" ");pageId.find("[name=task_slider]").find("[folabel=Completed_On]").find("span").text(timesplit[1]+" "+timesplit[2]+" "+timesplit[3]+" "+timesplit[4]),pageId.find("[name=task_slider]").find("[folabel=Completed_By]").find("span").text(ZPeople.decodeTxt(ZPeople.getUserDetailsById(erecno).name))}ZPTasks.fillDetailViewPage()}else if(status!==Task.OPEN_SYSVALUE?rootRow.find("[name=cmplButton]").attr("data-original-title",ZPI18N.getString("zp.reopen")):rootRow.find("[name=cmplButton]").attr("data-original-title",ZPI18N.getString("zp.complete")),Layout.Page.container.hasClass("zp_Pshw")&&(-1!=url.indexOf("checklist")||-1!=url.indexOf("task"))){isFullSlide=Layout.Page.container.find("[name=task_slider]").hasClass("zp_tskFl");Task.showTaskDetails(taskid),isFullSlide||Layout.Page.container.find("[name=task_slider]").removeClass("zp_tskFl")}var count_box=pageId.find("#task_count");if(count_box.is(":visible")){var taskRow=pageId.find("[rowid="+taskid+"]"),statusid=taskRow.attr("statusid"),updated_statusid=Task.statusBySysVal[status].ID,old_status_box=count_box.find("#status_"+statusid);taskRow.find("[name=pickButton]").is(":visible")&&status==Task.COMPLETED_SYSVALUE&&(old_status_box=count_box.find("#status_-1"));var new_status_box=count_box.find("#status_"+updated_statusid),old_count=parseInt(old_status_box.find("#status_count").text()),new_count=parseInt(new_status_box.find("#status_count").text());old_status_box.find("#status_count").text(old_count-1),new_status_box.find("#status_count").text(new_count+1),taskRow.attr("statusid",updated_statusid)}}else{var taskerrmsg;taskerrmsg="object"==typeof data.message&&void 0!=data.message.Status?data.message.Status:data.message,ZPeople.Message.showFailureMsg(taskerrmsg),status!==Task.OPEN_SYSVALUE?rootRow.removeClass("zp_cmpl"):rootRow.addClass("zp_cmpl")}})},editTask:function(obj){Layout.Page.container.removeClass("zp_Pshw"),ZPForm.load({formId:Task.taskformid,recordId:$(obj).parents("#taskDtlsHeader").attr("taskid"),isEmbed:!0,formMode:"EDIT",disableUrlTrack:!0})},pickTask:function(obj){var pageId=$("#"+Layout.Page.pageId),taskid=$(obj).attr("taskid"),params={taskid:taskid,method:"changeTaskOwner",mode:"pickup",conreqcsr:csrfToken};$.post("/changeTaskOwner.zp",params,function(data){if("success"==data.Status){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.taskassignedsuccess")),$(obj).addClass("zp_dyn");var headerBand=$(obj).parents("#detail_pannel");if(ZPTasks.resetUnassignedTask=!1,0==headerBand.length){if($(obj).parent().parent().find("#taskowner_img").html("").append('<img src="'+ZPeople.CURR_USER.avatar+'">'),$(obj).siblings().removeClass("zp_dyn"),delete ZPForm.SINGLE_RECORD_DTL[Task.taskformid+"_"+taskid],Layout.Page.container.hasClass("zp_Pshw")){var isFullSlide=Layout.Page.container.find("[name=task_slider]").hasClass("zp_tskFl");Task.showTaskDetails(taskid),isFullSlide||Layout.Page.container.find("[name=task_slider]").removeClass("zp_tskFl")}}else ZPForm.refreshRecord(taskid),ZPForm.SINGLE_RECORD_DTL[ZPForm.CURRFORM_PARAM.formId+"_"+ZPForm.CURRFORM_PARAM.recordId].record.message.ownerID[0]=erecno,pageId.find("[folabel=Task_Owner]").find("span").html(ZPeople.CURR_USER.name),ZPTasks.fillDetailViewPage()}else ZPeople.Message.showFailureMsg(data.message)})},constructChecklist:function(data,modalid){var pageId=$("#"+Layout.Page.pageId),body="",bodyToAppend=pageId.find("#checklistHead");$.each(data,function(index,row){void 0!==row.related_recordOwnerDetails&&(body+='<div class="zp_Lst" id="root_'+row.checkItemRootId+'" onclick="ZPTasks.getRootTasks(\''+row.checkItemRootId+'\', this)"><div><div class="zp_Ldtl "><div class="ZP_photo" popup="user" empid="'+row.related_recordOwnerDetails.zuid+'"><img src="'+row.related_recordOwnerDetails.employeePhoto+'"></div><div class="zp_Tdts"><h3>'+row.checklistName+'</h3><p popup="user" empid="'+row.related_recordOwnerDetails.zuid+'">'+row.related_recordOwnerDetails.employeeID+" - "+row.related_recordOwnerDetails.name+'</p><em class="zp_ldot">'+row.initiatedOn+'</em><a class="zp_ldot" name="clist_related_record" onclick="ZPACommon.viewRecord(\''+row.formId+"', '"+row.recordId+"')\">"+row.formName+'</a></div></div><div class="zp_Lass"><div status=\''+row.checkItemRootId+'\'><span class="DB"><font class="zp_bclr" id="completed_cltask_count">'+row.taskcount.completed+'</font>/<font id="total_cltask_count">'+row.taskcount.total+"</font>"+ZPI18N.getString("zp.completed")+'</span><div class="ZPprobar progress MT5I MB0I"><div class="progress-bar ZPprogrs PR" style="width:'+row.taskcount.completed/row.taskcount.total*100+'%"></div></div></div></div><div class="zp_Lrgt"><i name=delete class="IC-delete-1px zp_rB" onclick="ZPTasks.deleteCheckListConfirmation(\''+row.checkItemRootId+"')\"></i></div></div></div>")}),void 0!==modalid&&void 0===modalid.method&&(bodyToAppend=pageId.find("#"+modalid).find("#zp_modal_body")),0==data.length&&0==bodyToAppend.children().length?(bodyToAppend.find(".ZPNdata").remove(),ZPUtil.newNoDataHTML("CR-set-task-search",8,ZPI18N.getString("zp.nodatafound"),bodyToAppend)):(bodyToAppend.append(body),void 0===modalid||void 0!==modalid.method?(pageId.find("#checklist_header").removeClass("zp_dyn"),data.length==CHECKLIST_REC_PERPAGE&&ZPeople.FireScroll.reset(),bodyToAppend.find("[name=clist_related_record]").click(function(event){event.stopPropagation()})):bodyToAppend.find("[name=clist_related_record]").addClass("zp_dyn"))},cloneTaskRow:function(taskArr,bodyToAppend,index){var currentRow="",pageId=$("#"+Layout.Page.pageId);if(pageId.find("#tasklisthead").removeClass("zp_dyn"),0==taskArr.length)1==index&&pageId.find("#"+bodyToAppend).html("").append(ZPUtil.newNoDataHTML("CR-set-task-search",8,ZPI18N.getString("zp.notaskforfilter")));else{pageId.find("#list_header").removeClass("zp_dyn");var isFromMytaskPage=-1!=Layout.Page.hash.indexOf("mytask");isFromMytaskPage&&pageId.find("#task_container").find("[name=assignedto]").remove(),$.each(taskArr,function(index,row){(currentRow=$("#taskrow").cloneRow("#"+bodyToAppend)).removeClass("zp_dyn"),currentRow.attr("taskid",row.id),currentRow.attr("statusid",row.statusId),currentRow.attr("onclick",'ZPTasks.viewTaskDetails("'+row.id+'")'),currentRow.find("#task_name").append(row.name),void 0!=row.recordowner?"list"===ZPTasks.viewType&&void 0!=row.recordowner.employeePhoto&&(currentRow.find("#recordowner_name").html(row.recordowner.employeeID+" - "+row.recordowner.name),currentRow.find("#recordowner_img").find("img").attr("src",row.recordowner.employeePhoto),currentRow.find("#recordowner_name, #recordowner_img").attr("empid",row.recordowner.zuid)):void 0!=row.createdBy&&(currentRow.find("#recordowner_name").html(row.createdBy.employeeID+" - "+row.createdBy.name),currentRow.find("#recordowner_img").find("img").attr("src",row.createdBy.employeePhoto),currentRow.find("#recordowner_name, #recordowner_img").attr("empid",row.createdBy.zuid)),void 0!=row.formname?(currentRow.find("#form_name").html(row.formname),currentRow.find("#form_name").attr("onclick",'ZPACommon.viewRecord("'+row.formid+'","'+row.recordid+'","'+row.formtablename+'")'),currentRow.find("#form_name").click(function(event){event.stopPropagation()})):currentRow.find("#form_name").addClass("zp_dyn"),isFromMytaskPage?currentRow.find("#task_assignedto").remove():void 0!==row.taskownerdetail?void 0!=row.taskownerdetail.employeePhoto&&(currentRow.find("#taskowner_img").html("").append('<img src="'+row.taskownerdetail.employeePhoto+'">'),currentRow.find("#taskowner_img").attr("empid",row.taskownerdetail.zuid)):(currentRow.find("#taskowner_img").addClass(CommonTemplates.getColorCode(ZPTasks.getShortName(row.assignedto))),currentRow.find("#taskowner_img").html(ZPTasks.getShortName(row.assignedto))),void 0===row.taskownerdetail&&(currentRow.find("#task_pick").removeClass("zp_dyn"),currentRow.find("#task_pick").attr("taskid",row.id),currentRow.find("#taskowner_img").addClass("zp_dyn"),currentRow.find("#task_pick").click(function(event){event.stopPropagation()})),currentRow.find("[name=cmplButton]").click(function(event){event.stopPropagation()}),currentRow.attr("rowid",row.id),void 0==row.endtime?currentRow.find("#task_duedate").text(ZPI18N.getString("zp.noduedate")):currentRow.find("#task_duedate").text(row.endtime),row.isDeletable?(currentRow.find("#task_delete").removeClass("DN"),currentRow.find("#task_delete").attr("onclick",'Task.deleteTaskConfirmation("'+row.id+'")'),currentRow.find("#task_delete").click(function(event){event.stopPropagation()})):currentRow.find("#task_delete").addClass("DN"),void 0!=row.priority&&(currentRow.find("#task_priority").addClass("zp_dyn"),1===Task.priorityObj[row.priority].SYSVALUE?currentRow.find("#task_priority").removeClass("zp_dyn").addClass("zp_rbg"):3===Task.priorityObj[row.priority].SYSVALUE&&currentRow.find("#task_priority").removeClass("zp_dyn").addClass("zp_gbg")),row.iscompleted?(currentRow.find("[name=cmplButton]").attr("data-original-title",ZPI18N.getString("zp.reopen")),currentRow.addClass("zp_cmpl")):void 0!=row.unassigned&&row.unassigned?(currentRow.find("#pickup").removeClass("zp_dyn"),currentRow.find(".zp_link").click(function(event){event.stopPropagation()}),isadmin&&currentRow.find("#assignedto").removeClass("zp_dyn")):row.isoverdue&&currentRow.find("#task_duedate").addClass("zp_rclr")})}},getShortName:function(name){return void 0!=name?ZPeople.getShortName(name):""},removeTaskRow:function(result,params){var pageId=$("#"+Layout.Page.pageId);if(7e3===result.code){var url=Layout.Page.hash;ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.taskdeletedsuccessfully")),ZPTasks.resetTasks(),0!=pageId.find("[id=rt_"+params.recordIds+"]").length?pageId.find("[id=rt_"+params.recordIds+"]").remove():(url.indexOf("task/trackchecklist"),pageId.find("[taskid="+params.recordIds+"]").remove())}else ZPeople.Message.showFailureMsg(result.message)},getMyTaskCount:function(){$("#"+Layout.Page.pageId);var params={method:"getMyTaskCount",conreqcsr:csrfToken};$.ajax({url:"/getmytaskcount.zp",type:"POST",async:!1,data:params,success:function(data){ZPTasks.setTaskCount(data)}})},setTaskCount:function(data){var pageId=$("#"+Layout.Page.pageId),url=Layout.Page.hash,statusObj={},isInitialLoad=0==pageId.find("#headtag").length;pageId.find("#task_count").children().remove(),CommonTemplates.toCheckEmpty("statusInput_input",statusObj,"status"),pageId.find("#count_pannel").removeClass("zp_dyn"),void 0!=data&&0!==data[0].count?($.each(data,function(index,status){if((isInitialLoad||void 0===statusObj.status||-1!==statusObj.status.indexOf(status.option_id))&&(-1===url.indexOf("task/unassignedtask")||-1==status.option_id)){var countBox=pageId.find("#taskcount_box").cloneRow("#task_count");countBox.find("#status_value").html(status.option_value),countBox.find("#status_count").text(status.count),countBox.attr("id","status_"+status.option_id),Task.statusBySysVal[Task.OPEN_SYSVALUE].ID==status.option_id?(countBox.find("#status_count").addClass("zp_bclr"),isInitialLoad&&countBox.addClass("sel")):Task.statusBySysVal[Task.COMPLETED_SYSVALUE].ID==status.option_id&&countBox.find("#status_count").addClass("zp_gclr"),countBox.click(function(){ZPSelect.clearAllValues(pageId.find("#statusInput_input")),0!=status.option_id&&pageId.find("#statusInput_input").zpselect({selectedVal:[{id:status.option_id,text:status.option_value}],checkbox:!0}),Layout.Page.container.find("#aplFltr").trigger("click"),countBox.addClass("sel"),countBox.siblings().removeClass("sel"),pageId.find("#task_count").attr("reset",!1)})}}),2==pageId.find("#task_count").children().length&&$(pageId.find("#task_count").children()[0]).addClass("zp_dyn"),-1!=url.indexOf("task/mytask")&&pageId.find("#status_-1").addClass("zp_dyn")):pageId.find("#count_pannel").addClass("zp_dyn")},viewTaskDetails:function(taskid){var url=Layout.Page.hash,selectedRow=$("#"+Layout.Page.pageId).find(".zp_Lst[taskid="+taskid+"]");selectedRow.addClass("sel"),selectedRow.siblings().removeClass("sel"),-1!==url.indexOf("task/mytask")||-1!==url.indexOf("task/alltask")||-1!==url.indexOf("task/unassignedtask")||-1!==url.indexOf("task/watchlist")||-1!==url.indexOf("task/tracktask")?window.location.href=Layout.Page.hash.split("/viewtask")[0]+"/viewtask-taskid:"+taskid:Task.showTaskDetails(taskid,!0)},backToListView:function(){var url=Layout.Page.hash;-1!==url.indexOf("#home/task")?window.location.href=url.split("/")[0]+"/"+url.split("/")[1]+"/"+url.split("/")[2]:window.location.href=url.split("/")[0]+"/"+url.split("/")[1]},switchView:function(obj){if(!$(obj).hasClass("sel")){var pageId=$("#"+Layout.Page.pageId),url=Layout.Page.hash;$(obj).siblings().removeClass("sel"),$(obj).addClass("sel"),pageId.find("#taskpreview").removeClass("zp_kanb"),pageId.find("#taskhead").find(".zp_lwrap").remove();var view=$(obj).attr("view");-1!==url.indexOf("task/mytask")?"list"===view?(ZPTasks.viewType="list",ZPTasks.getMyTasks("reset")):"kanban"===view&&(ZPTasks.viewType="kanban",ZPTasks.getMyKanbanView("Status")):-1!==url.indexOf("task/alltask")&&("list"===view?(ZPTasks.viewType="list",ZPTasks.getAllTasks("reset")):"kanban"===view&&(ZPTasks.viewType="kanban",ZPTasks.getAllKanbanView("Status")))}},getViewList:function(obj){var prevMode=$("#"+Layout.Page.pageId).find("#taskhead").attr("mode");$(obj).attr("selectedids",prevMode);var LIST=[{id:"Status",value:ZPI18N.getString("zp.status")},{id:"Priority",value:ZPI18N.getString("zp.priority")}];$(obj).zpmenu({dropdownclass:"zp_drop",scrollclass:"ob_center",level:1,id:"viewList",data:LIST,callback:ZPTasks.switchKanbType})},switchKanbType:function(obj){var pageId=$("#"+Layout.Page.pageId),url=Layout.Page.hash;$(obj).addClass("sel"),$(obj).siblings().removeClass("sel"),pageId.find(".zp_lwrap").remove(),-1!==url.indexOf("task/mytask")?ZPTasks.getMyKanbanView($(obj).attr("id")):-1!==url.indexOf("task/alltask")&&ZPTasks.getAllKanbanView($(obj).attr("id"))},getMyKanbanView:function(mode){var pageId=$("#"+Layout.Page.pageId),taskobj={},ddobj={};taskobj.status="",taskobj.priority="",pageId.find("#taskhead").children().remove(),$.ajax({url:"/mykanbanview.zp",type:"POST",async:!1,data:{conreqcsr:csrfToken,method:"getMyKanbanView",mode:mode,criteria:JSON.stringify(taskobj)},success:function(data){pageId.find("#taskpreview").addClass("zp_kanb"),pageId.find("#taskhead").attr("mode",mode),ddobj.fcid=Object.keys(data)[0],ddobj.mode=mode,ddobj.callback=ZPTasks.doAfterKanbUpdate,ddobj.formid=Task.taskformid,ddobj.tablename="P_Task";var columnNo=1;$.each(data[ddobj.fcid],function(val,rows){var columnId=pageId.find("#taskhead").createNewColumn(!0,val,ddobj.mode+columnNo++);ZPTasks.cloneTaskRow(rows.tasks,columnId+" .zp_liscr")})}}),pageId.find("#taskhead").createDragAndDrop(ddobj)},getAllKanbanView:function(mode){var pageId=$("#"+Layout.Page.pageId),taskobj={},ddobj={};taskobj.status="",taskobj.priority="",pageId.find("#taskhead").children().remove(),$.ajax({url:"/allkanbanview.zp",type:"POST",async:!1,data:{conreqcsr:csrfToken,method:"getAllKanbanView",mode:mode,criteria:JSON.stringify(taskobj)},success:function(data){pageId.find("#taskpreview").addClass("zp_kanb"),pageId.find("#taskhead").attr("mode",mode),ddobj.fcid=Object.keys(data)[0],ddobj.mode=mode,ddobj.callback=ZPTasks.doAfterKanbUpdate,ddobj.formid=Task.taskformid,ddobj.tablename="P_Task";var columnNo=1;$.each(data[ddobj.fcid],function(val,rows){var columnId=pageId.find("#taskhead").createNewColumn(!0,val,ddobj.mode+columnNo++);ZPTasks.cloneTaskRow(rows.tasks,columnId+" .zp_liscr")})}}),pageId.find("#taskhead").createDragAndDrop(ddobj)},updateField:function(data){var params={};params.loginUserZUID=_LOGGEDIN_ZUID,params.zp_tableName=data.tablename,params.zp_formId=data.formid,params.zp_mode="updateRecord",params.zp_recordId=data.rowid,params.isSingleEdit=!0,params.fcId=data.fcid,params.isDraft=!1,params.conreqcsr=csrfToken,params[data.mode]=$(data.to).parent().val(),data.callback(data),$.ajax({url:"/addUpdateRecord.zp",type:"POST",async:!1,data:params,success:function(result){}})},constructTaskCmt:function(data,taskId,isInit){if(data&&!(data.length<1)){var page=ZPForm.LAYOUT.data().curpageid,pageId=$("#"+Layout.Page.pageId).find("#"+page);data.actRecId=taskId,data.subBtnCallBack=TaskCommon.postTaskComment;for(var newJSON={subBtnName:"zp.comment"},comments=data.comments,commentedZuids=[],cnt=0;cnt<comments.length;cnt++)comments[cnt].content=ZPFeeds.Activity.validateContent(comments[cnt].content,!1,data.departmentDts,data.groupDts),ZPUtil.checkIsExistInArray(commentedZuids,comments[cnt].commby)||commentedZuids.push(comments[cnt].commby);ZPeople.getUserDetailsByIds(commentedZuids,!0);var popup_body_cmt=pageId.find("#comment_body");popup_body_cmt.attr("streamid",taskId),isInit?(newJSON.calback=function(){HRCase.Comments.showMoreComments(""+taskId,People.Task.type,ZPApprovals.constructTaskCmt)},ZPACommon.constructCmtRw(data,popup_body_cmt,newJSON)):(popup_body_cmt.empty(),ZPACommon.constructCmtRw(data,popup_body_cmt,newJSON),popup_body_cmt.find("#view_more_cmts").empty().append("<a totalcmts="+data.totalComments+">"+ZPI18N.getString("zp.viewingallcomments",[data.totalComments])+"</a>"))}},fillDetailViewPage:function(){var page=ZPForm.LAYOUT.data().curpageid,url=Layout.Page.hash,pageId=$("#"+Layout.Page.pageId).find("#"+page+":is([name=task_slider])");-1!==url.indexOf("admin")&&pageId.addClass("zp_tskPst"),-1!==url.indexOf("task")?pageId.find("#tdtls_edit").removeClass("zp_dyn"):pageId.find("#tdtls_edit").addClass("zp_dyn");var taskname=$(pageId.find("[folabel=Task_Name]").find("span")[0]).text();pageId.find("#tdtls_taskname").text(taskname),pageId.find("[name=tdtls_complete]").removeClass("zp_dyn"),-1!==page.indexOf("relfielsingle")&&pageId.find("#task_closebutton").attr("onclick","ZPForm.Field.formCloseBtn()"),Task.taskformid=ZPForm.CURRFORM_PARAM.formId,pageId.find("#tdtls_initiator").html("").append("<em>"+ZPI18N.getString("zp.initiatedby")+"</em>"+ZPForm.SINGLE_RECORD_DTL[Task.taskformid+"_"+ZPForm.CURRFORM_PARAM.recordId].record.message.cAuditInfo.cInfo.user.dispName),pageId.find(".modal-footer").remove(),$(pageId.find("#zp_form_outer_container").find("H3")[0]).addClass("zp_dyn");var status=$(pageId.find("[folabel=Status]").find("span")[0]).text(),status_sysvalue=Task.getSysValue(pageId.find("[folabel=Status]").attr("id").split("_").pop(),ZPForm.CURRFORM_PARAM.formId,status),status_color="";if(status_sysvalue==Task.COMPLETED_SYSVALUE){status_color="zp_gclr",pageId.find("#taskDtlsHeader").addClass("zp_cmpl"),pageId.find("[name=tdtls_complete]").attr("data-original-title",ZPI18N.getString("zp.reopen")),pageId.find("[folabel=Completed_On]").parent().removeClass("zp_dyn"),pageId.find("[folabel=Completed_By]").parent().removeClass("zp_dyn");var completedOnDiv=$(pageId.find("[folabel=Completed_On]"));if(pageId.find("#timer_header").text(completedOnDiv.siblings("label").text()),"-"===pageId.find("[folabel=Task_Owner]").find("span").text()&&pageId.find("[folabel=Task_Owner]").find("span").html(ZPeople.CURR_USER.name),"-"===pageId.find("[folabel=Completed_On]").find("span").text()){var timesplit=new Date(ZPDateTime.convertToTimezone((new Date).getTime())).constructor().split(" ");pageId.find("[folabel=Completed_On]").find("span").text(timesplit[1]+" "+timesplit[2]+" "+timesplit[3]+" "+timesplit[4]),pageId.find("[folabel=Completed_By]").find("span").text(ZPeople.decodeTxt(ZPeople.getUserDetailsById(erecno).name))}pageId.find("#tdtls_duedate").text(completedOnDiv.find("span").text())}else{pageId.find("#taskDtlsHeader").removeClass("zp_cmpl"),pageId.find("[name=tdtls_complete]").attr("data-original-title",ZPI18N.getString("zp.complete")),pageId.find("[folabel=Completed_On]").parent().addClass("zp_dyn"),pageId.find("[folabel=Completed_By]").parent().addClass("zp_dyn");var duedateDiv=$(pageId.find("[folabel=Due_Date]")),duedate=$(duedateDiv.find("span")).text();pageId.find("#timer_header").text(duedateDiv.siblings("label").text()),"-"!==duedate?pageId.find("#tdtls_duedate").text(duedate):pageId.find("#tdtls_duedate").text(ZPI18N.getString("zp.noduedate"))}pageId.find("#tdtls_status").text(status).parent().attr("class",status_color);var taskrow=0!=$("#"+Layout.Page.pageId).find("#MYPENDINGTASKS").length?$("#"+Layout.Page.pageId).find("#rt_"+ZPForm.CURRFORM_PARAM.recordId):$("#"+Layout.Page.pageId).find("#list_container").find("[taskid="+ZPForm.CURRFORM_PARAM.recordId+"]"),taskowner=$(pageId.find("[folabel=Task_Owner]").find("span")[0]).text();if("-"!=taskowner){var taskownererecno="";if(pageId.find("#tdtls_taskowner").text(taskowner),pageId.find("#tdtls_taskowner_image").addClass(CommonTemplates.getColorCode(ZPTasks.getShortName(taskowner))),pageId.find("#tdtls_taskowner_image").html(ZPTasks.getShortName(taskowner)),pageId.find("[folabel=Assigned_To]").parent().addClass("zp_dyn"),taskrow.find("[name=pickButton]").remove(),pageId.find("#detail_pannel").find("[name=pickButton]").remove(),void 0!==pageId.find("[folabel=Task_Owner]").find("select").val())taskownererecno=pageId.find("[folabel=Task_Owner]").find("select").val();else if(void 0!==ZPForm.SINGLE_RECORD_DTL[ZPForm.CURRFORM_PARAM.formId+"_"+ZPForm.CURRFORM_PARAM.recordId]){var owner=ZPForm.SINGLE_RECORD_DTL[ZPForm.CURRFORM_PARAM.formId+"_"+ZPForm.CURRFORM_PARAM.recordId].record.message.ownerID;taskownererecno=owner[0],ZPForm.Permission.isAllowed(owner,ZPForm.Permission.getEditPerm())||(pageId.find("#task_editicon").remove(),pageId.find("#completebutton").remove())}""!==taskownererecno&&pageId.find("#tdtls_taskowner_image").html("").append('<img src="'+ZPeople.getUserDetailsById(taskownererecno).avatar+'">')}else{var assignedTo=ZPeople.escapeHtml($(pageId.find("[folabel=Assigned_To]").find("span")[0]).text());pageId.find("#tdtls_taskowner").html(assignedTo).after('<i name="pickButton" class="IC-user-plu zp_rB" taskid="'+ZPForm.CURRFORM_PARAM.recordId+"\"  onclick=\"ZPeople.confirm(this,'','zp.taskpickmessage', ZPTasks.pickTask)\"></i>"),pageId.find("[folabel=Assigned_To]").parent().removeClass("zp_dyn"),pageId.find("#tdtls_taskowner_image").addClass(CommonTemplates.getColorCode(ZPTasks.getShortName(assignedTo))),pageId.find("#tdtls_taskowner_image").html(ZPTasks.getShortName(assignedTo))}pageId.find("#completebutton,#tdtls_taskname,#task_editicon").removeClass("zp_dyn"),pageId.find("#detail_pannel").removeClass("zp_dyn"),pageId.find("#taskDtlsHeader").attr("taskid",ZPForm.CURRFORM_PARAM.recordId),ZPACommon.showSlideBodyContent();var priority_sysvalue=Task.getSysValue(pageId.find("[folabel=Priority]").attr("id").split("_").pop(),ZPForm.CURRFORM_PARAM.formId,$(pageId.find("[folabel=Priority]").find("span")[0]).text());0!=taskrow.length&&(taskrow.find("#task_priority").attr("class","zp_dyn"),priority_sysvalue==Task.LOW_SYSVALUE?taskrow.find("#task_priority").attr("class","zp_gbg"):priority_sysvalue==Task.HIGH_SYSVALUE&&taskrow.find("#task_priority").attr("class","zp_rbg"),status_sysvalue==Task.COMPLETED_SYSVALUE?taskrow.addClass("zp_cmpl"):taskrow.removeClass("zp_cmpl"),taskrow.addClass("sel"),taskrow.siblings().removeClass("sel"),""!==taskname&&taskrow.find("#task_name").text(taskname))},closePreview:function(){var url=Layout.Page.hash,pageid=$("#"+Layout.Page.pageId);pageid.find("#commentSlideBody div[id^='zp_addedit_record_']").attr("id","taskFormPage"),pageid.find("#list_container").find(".zp_Lst").removeClass("sel"),Task.isPreviewClosed=!0,pageid.find("#caseDtls").is(":visible")?pageid.find("#caseDtls").siblings("[name=task_slider]").addClass("zp_dyn"):pageid.find("[name=checklist_slider]").is(":visible")?pageid.find("[name=checklist_slider]").siblings("[name=task_slider]").addClass("zp_dyn"):Layout.Page.container.removeClass("zp_Pshw"),void 0!==Task.resetTaskId&&""!==Task.resetTaskId&&(delete ZPForm.SINGLE_RECORD_DTL[Task.taskformid+"_"+Task.resetTaskId],Task.resetTaskId=""),-1!==url.indexOf("task/mytask")||-1!==url.indexOf("task/alltask")||-1!==url.indexOf("task/unassignedtask")||-1!==url.indexOf("task/watchlist")||-1!==url.indexOf("task/tracktask")?ZPTasks.backToListView():-1!==url.indexOf("task/list")&&(window.location.href="#task/list-formId:"+ZPView.CURR_VIEWPARAMS.formId+"/viewId:"+ZPView.CURR_VIEWPARAMS.viewId)},closeRecordTasks:function(related_formid,related_recordid){var taskFormId=Task.taskformid;ZPTasks.closePreview(),ZPACommon.viewRecord(related_formid,related_recordid,"",!0),Layout.Page.container.find("[formId="+taskFormId+"]").trigger("click")},initiateFilter:function(){var url=Layout.Page.hash,filterArr=[],callback=($("#"+Layout.Page.pageId).find("#task_filter"),"");ZPACommon.getFormList(CHECKLIST_MODE),-1==url.indexOf("checklist")?(filterArr.push({parentDiv:"searchDiv",type:"search",title:ZPI18N.getString("zp.entertaskname")}),filterArr.push({parentDiv:"priorityInput",type:"select",menuProperties:ZPTasks.filterDropDown("priority"),title:ZPI18N.getString("zp.priority")}),filterArr.push({parentDiv:"formInput",type:"select",menuProperties:ZPTasks.filterDropDown("form"),title:ZPI18N.getString("zp.relatedforms")}),callback=ZPTasks.getMyTasks,-1!==url.indexOf("alltask")?(filterArr.push({parentDiv:"taskownerInput",type:"select",menuProperties:ZPTasks.filterDropDown("taskowner",!0),title:ZPI18N.getString("zp.taskowner")}),callback=ZPTasks.getAllTasks):-1!==url.indexOf("tracktask")?callback=ZPTasks.getAllTasks:-1!==url.indexOf("watchlist")&&(callback=ZPTasks.getAllTasks),-1===url.indexOf("unassignedtask")&&filterArr.push({parentDiv:"statusInput",type:"select",menuProperties:ZPTasks.filterDropDown("status"),title:ZPI18N.getString("zp.status")})):(filterArr.push({parentDiv:"searchDiv",type:"search",title:ZPI18N.getString("zp.enterchecklistname")}),filterArr.push({parentDiv:"clistStatusInput",type:"select",menuProperties:ZPTasks.filterDropDown("clist_status"),title:ZPI18N.getString("zp.status")}),filterArr.push({parentDiv:"formInput",type:"select",menuProperties:ZPTasks.filterDropDown("form"),title:ZPI18N.getString("zp.relatedforms")}),callback=ZPTasks.getMyChecklist,isadmin&&filterArr.push({parentDiv:"clistInitInput",type:"select",menuProperties:ZPTasks.filterDropDown("taskowner",!0),title:ZPI18N.getString("zp.checklistinitiator")})),AdvancedFilter.constructFilter(filterArr,callback)},filterDropDown:function(mode,needCheckBox,callbackFn){if("taskowner"===mode){var taskOwnerObj={id:"taskowner_list",data:function(initObj){return EmployeeDropdown.getEmpList($(initObj).val(),"emp","TASKS_VIEW")},callback:function(liObj,srcObj){var selectedId=$(liObj).attr("id"),agenttypeId=$(liObj).attr("agenttypeid"),dataObj=$(srcObj).data("ownerDataMap");void 0!=dataObj&&(dataObj.hasOwnProperty(agenttypeId)?dataObj[agenttypeId].push(selectedId):dataObj[agenttypeId]=new Array(selectedId)),void 0!=callbackFn&&callbackFn(liObj,srcObj)},callbackOnCancel:function(liObj,srcObj){var selectedId=$(liObj).attr("id"),agenttypeId=$(liObj).attr("agenttypeid"),dataObj=$(srcObj).data("ownerDataMap");if(void 0!=dataObj&&dataObj.hasOwnProperty(agenttypeId)){var index=dataObj[agenttypeId].indexOf(selectedId);dataObj[agenttypeId].splice(index)}}};return needCheckBox&&(taskOwnerObj.checkbox=!0),taskOwnerObj}if("status"===mode){var statusArr=[];return $.each(Task.statusArray,function(key,value){var param={id:value.ID,value:value.DISPVALUE};statusArr.push(param)}),{id:"mainmenu",data:statusArr,checkbox:!0}}if("priority"===mode){var priorityArr=[];return $.each(Task.priorityArray,function(key,value){var param={id:value.ID,value:value.DISPVALUE};priorityArr.push(param)}),{id:"mainmenu",data:priorityArr,checkbox:!0}}if("form"===mode){var formArr=[],formMode=CHECKLIST_MODE;return Layout.CustomizedUrl.isService()&&(formMode+="_"+Layout.CustomizedUrl.getServiceName()),$.each(ZPACommon[formMode+"_formList"],function(key,value){var param={id:value.formId,value:value.dispName};formArr.push(param)}),{id:"mainmenu",data:formArr,checkbox:!0}}if("clist_status"===mode)return(statusArr=[]).push({id:"completed",value:ZPI18N.getString("zp.completed")}),statusArr.push({id:"pending",value:ZPI18N.getString("zp.pending")}),{id:"mainmenu",data:statusArr,checkbox:!1}},doAfterKanbUpdate:function(rowdetail){var currentVal=$(rowdetail.to).parent().val(),currentSysVal="";"Priority"===rowdetail.mode?1===(currentSysVal=Task.priorityObj[currentVal].SYSVALUE)?rowdetail.updatedRow.find(".zplicn").find("i").attr("class","IC-task-unchk zp_rclr"):3===currentSysVal?rowdetail.updatedRow.find(".zplicn").find("i").attr("class","IC-task-unchk zp_oclr"):rowdetail.updatedRow.find(".zplicn").find("i").attr("class","IC-task-unchk"):"Status"===rowdetail.mode&&(2===(currentSysVal=Task.statusObj[currentVal].SYSVALUE)?rowdetail.updatedRow.addClass("zp_cmpl"):rowdetail.updatedRow.removeClass("zp_cmpl"))},constructWidgetTasks:function(taskDetails){var taskRowsContainer=$("#"+Layout.Page.pageId).find("#MYPENDINGTASKS"),quickui="";0!==taskDetails.count[0].count?(quickui='<div class="zp_Task" id="rt_table"><div class="zp_TLst"><ul><li id="newquicktask" class="zp_dyn"><i class="IC-task-unchk" onclick="Task.addQuickTask(Task.COMPLETED_SYSVALUE)"></i><div class="zp_txtbx"><input type="textbox" id="quicktaskname"></div><div class="ZP_photo" id="tUser" ownervalueid='+erecno+' onclick="Dropdown.taskUserdropdown(this)"><img src='+ZPeople.CURR_USER.avatar+'></div><div class="zp_txtbx"><input class="zp_ntsk" type="textbox" id="quicktaskdue" caltype ='+Task.getCalType()+'  onclick="Calendar.setUpCalendar(event,this,null,null,Task.addTaskByDate)"></div></li></ul></div>',taskRowsContainer.append(quickui),taskRowsContainer.find("#quicktaskname").attr("placeholder",ZPI18N.getString("zp.taskname")),taskRowsContainer.find("#quicktaskdue").attr("placeholder",ZPI18N.getString("zp.duedate")),Task.cloneRelatedTaskRow(taskDetails.tasks)):taskRowsContainer.append(ZPUtil.newNoDataHTML("CR-set-task-search",8,ZPI18N.getString("zp.notaskforfilter"))),taskRowsContainer.find("#zp_page_loading").remove()},widgetFireScroll:function(){var taskobj={},taskBox=$("#"+Layout.Page.pageId).find("#rt_table").find("ul");Task.getStatusOptionValuesBySysVal(),taskobj.status=Task.statusBySysVal[Task.OPEN_SYSVALUE].ID,taskobj.index=taskBox.find("li").length-taskBox.find("li.zp_cmpl").length,$.post("/mytasks.zp",{conreqcsr:csrfToken,method:"getMyTasks",criteria:JSON.stringify(taskobj)},function(data){data.hasNextPage&&ZPeople.FireScroll.reset(),Task.cloneRelatedTaskRow(data.tasks)})},editTaskDetails:function(taskid,labelname,value){var result="",params={method:"editTaskDetail"};return params.labelname=labelname,params.taskid=taskid,params.value=value,params.conreqcsr=csrfToken,$.ajax({url:"/taskSingleEdit.zp",type:"POST",async:!1,data:params,success:function(data){result=data}}),result},deleteCheckListConfirmation:function(clistRootId){ZPeople.BSModal.confirm(ZPTasks.deleteCheckList),ZPTasks.deleteCheckListIdId=clistRootId},deleteCheckList:function(){var params={method:"deleteCheckListRoot",rootID:ZPTasks.deleteCheckListIdId},callback=ZPTasks.removeCheckListRow;ZPeople.Request.send("/deleteCheckListItemRoot.zp",params,callback)},removeCheckListRow:function(data,params){if(data.success){var parentDiv=Layout.Page.container.find("#root_"+params.rootID).parent("[id]");Layout.Page.container.find("#root_"+params.rootID).remove(),0==parentDiv.children("[id*=root]").length&&ZPUtil.newNoDataHTML("CR-set-task-search",8,ZPI18N.getString("zp.nodatafound"),parentDiv)}else void 0!=data.msg?ZPeople.Message.showFailureMsg(data.msg):ZPeople.Message.showFailureMsg(data.message)}};!function($){$.fn.createNewColumn=function(titleNeeded,title,columnNo){var newColumn="",columnId="listcontainer";return titleNeeded?((newColumn=$("<div/>",{class:"zp_lwrap",id:columnId="listcontainer_"+columnNo})).append("<div class = 'zp_Tttl' id = 'listtitle'>"+title+"</div><div class = 'zp_liscr'></div>"),newColumn.val(title),newColumn.addClass("zp_Kgybg")):newColumn=$("<div/>",{class:"zp_lwrap",id:"listcontainer"}),this.append(newColumn),columnId},$.fn.createDragAndDrop=function(ddObj){var pageId=$("#"+Layout.Page.pageId);pageId.find(".zp_liscr").sortable({connectWith:pageId.find(".zp_liscr"),scroll:!0,scrollSensitivity:80,scrollSpeed:3,placeholder:"zpl active",start:function(event,row){ddObj.from=event.target,ddObj.onclickobj=row.item.find(".zpDtl").clone(),row.item.find(".zpDtl").removeAttr("onclick"),pageId.find(".zp_clist").addClass("zp_Kdg")},update:function(event,row){ddObj.to=event.target,ddObj.updatedRow=row.item,ddObj.rowid=row.item.attr("rowid"),pageId.find(".zp_clist").removeClass("zp_Kdg"),$(ddObj.to).find(".no-para").parent().remove(),ddObj.from!==ddObj.to&&ZPTasks.updateField(ddObj),row.item.find(".zpDtl").remove(),row.item.find(".zpLst").append(ddObj.onclickobj)}}).disableSelection()},$.fn.cloneRow=function(bodyToAppend){var obj=this.clone();return obj.removeAttr("id").removeAttr("style").appendTo("#"+Layout.Page.pageId+" "+bodyToAppend),obj}}(jQuery);var SLA={TYPE_CASES:1,TIMER_START:1,TIMER_PAUSE:2,TIMER_STOP:3,SLA_TIMER_MINUTES:1,SLA_TIMER_HOURS:2,SLA_TIMER_DAYS:3,SLA_TIMER_WEEKS:4,SLA_TIMER_MONTHS:5,ACTION_MAILALERT:11,ACTION_CASEOWNER_EMP:21,ACTION_CASEOWNER_GRP:22,ACTION_CASEOWNER_DEP:23,ACTION_ESCALATIONTO_EMP:31,APPR_AUTO_REJECT:40,APPR_AUTO_APPROVE:41,APPR_ASSIGNTO_EMP:42,APPR_PENDING:43,APPR_PENDING_NOTIFY:44,APPR_ASSIGNTO_REPORTINGTO:45,ACTION_ESCALATIONTO_PRIORITY:36,CALTYPE_CALENDAR_HOURS:1,CALTYPE_BUSINESS_HOURS:2,SLA_MAX_LEVEL:5,COLOR_RED:"red",COLOR_GRN:"green",COLOR_ORG:"orange",MODE:"sla",PRIORITY:{},getLevelsTemplate:function(){var levels='<div class="zp_lvlIn" name="sla_levels"><div  onclick="SLA.toggleLevelBox(this)" class="zp_lvlHead"><h5></h5><i class="IC-ar-dwn"></i><i name="delete_btn" onclick="SLA.removeLevel()" class="IC-delete DN"></i></div><div class="zp_mLtFld"><div class="zp_fm"><label>'+ZPI18N.getString("zp.closewithin")+'</label><div><input id="sla_duration"  maxlength="5" type="text"><span class="etxt zp_dyn">'+ZPI18N.getString("zp.enteravalue")+'</span></div><div id="sla_timer_div"><input><font class="IC-ar-dwn"></font></div></div>';return levels+='<div class="zp_fm"><label>'+ZPI18N.getString("zp.operationaldays")+'</label><div id="oper_hours_div"><input id type="text" value="'+ZPI18N.getString("zp.calendardays")+'"></div></div></div><div class="zp_mLtFld"><div class="zp_fm"><label>'+ZPI18N.getString("zp.remindbefore")+'</label><span id="mail_switch" class="zp_SFswtch" onclick="SLA.toggleEscalationMail(this)">',levels+='<input class="cmn-toggle-small cmn-toggle-round-small" type="checkbox"><span></span></span><div name="mail_time" class="zp_dyn"><input type="text"><span class="etxt zp_dyn">'+ZPI18N.getString("zp.enteravalue")+'</span></div><div id="escalation_timer_div" name="mail_time_type" class="zp_dyn"><input type="text"><font class="IC-ar-dwn"></font></div></div><div class="zp_fm zp_dyn"><label class="noLbl"> </label><div><input disabled="" type="text" value="Before Closure time"></div></div><div class="zp_mLtdInnr">',levels+="<h6>"+ZPI18N.getString("zp.actiononescalation")+'</h6><div class="zp_fm zp_fmFl zp_dyn"><label>Change Priority</label><div><input required="" type="text" value="High"><font class="IC-ar-dwn"></font></div></div>',levels+='<div class="zp_fm PR50"><label>'+ZPI18N.getString("zp.escalateto")+'</label><div id="escalation_to_div" class="zp_tgExpand"><input style="width: 74px;"><font class="IC-ar-dwn"></font></div></div><div class="zp_fm"><label>'+ZPI18N.getString("zp.agentchange")+'</label><div id="sla_agent_div"><input style="width: 74px;"><font class="IC-ar-dwn"></font><span class="etxt zp_dyn">'+ZPI18N.getString("zp.selectatleastoneaction")+"</span></div></div></div></div>",levels+='<div class="zp_addHrC MB0 FL" id="slaesc_enable_priority"><div class="FL"><label class="checkbox DIB"><input type="checkbox"><span></span> </label></div><div class="ZPckmain">'+ZPI18N.getString("zp.esclatepriority")+"</div></div>",levels+="</div>"},initPage:function(){SLA.getCasesSLA()},getCasesSLA:function(){if(void 0==SLA.resetConfig||SLA.resetConfig){SLA.resetConfig=!1,ZPeople.Request.send("/getSLAList.zp",{mode:"cases",method:"getSLAList"},SLA.constructCasesSLAConfig)}},deleteSLAConfig:function(getThis){var slaconfigid=$(getThis).attr("slaconfigid"),params={slaConfigId:slaconfigid,method:"deleteSLAConfig"};$("#"+Layout.Page.pageId).find("#slaListTable").find("[slaconfigid="+slaconfigid+"]").remove(),ZPeople.Request.send("/deleteSLAConfig.zp",params,SLA.afterDelete)},afterDelete:function(result){"success"==result.status?ZPeople.Message.showSuccessMsg(result.message):ZPeople.Message.showFailureMsg(result.message)},constructCasesSLAConfig:function(data){var pageId=$("#"+Layout.Page.pageId).find("#slaListTable"),pageWrapper=$("#"+Layout.Page.pageId).find("#slaList");SLA.pageWrapper=pageWrapper,pageId.children().remove(),pageId.next().remove(),0!=data.length?(body='<thead><tr><th class="text-center" width="22"></th><th class="text-center" width="25"></th><th width="40%"><span class="CP">'+ZPI18N.getString("zp.name")+'</span></th><th width="30%"><span class="CP">'+ZPI18N.getString("zp.category")+"</span></th><th><span>"+ZPI18N.getString("zp.status")+'</span></th><th width="10%"><span></span></th></tr></thead><tbody id="slaConfigBody" class="ui-sortable">',$.each(data,function(index,row){body+="<tr slaconfigid='"+row.slaConfigId+'\' ><td class="text-center"></td><td><span class="IC-move dvMove"></span></td><td><div><a class="ulnk txttrim" onclick="SLA.getSlaConfig(\''+row.slaConfigId+"')\">"+row.name+"</a></div></td><td><div>"+row.categoryName+'</div></td><td><div class="btnactive" onclick="SLA.changeSLAStatus(this, \''+row.slaConfigId+"')\"><input "+(row.isActive?"checked":"")+' class="cmn-toggle-small cmn-toggle-round-small" id="active_button" type="checkbox"><label  class="M0"></label></div></td><td><div class="dvlist-action"><a onclick="SLA.cloneSLA(\''+row.slaConfigId+'\')" title="'+ZPI18N.getString("zp.clone")+'" class="IC-clone MR15 ZPtitle"></a><a  onclick="SLA.getSlaConfig(\''+row.slaConfigId+'\')" class="IC-pen ZPtitle" title="" data-original-title="Edit"></a><a class="IC-delete ML15 ZPtitle" title="Delete" slaconfigid=\''+row.slaConfigId+"' onclick=\"ZPeople.confirm(this,'','zp.deleteconfirmmessage', SLA.deleteSLAConfig)\"></a></div></td></tr>"}),body+="</tbody>",pageId.append(body),pageId.find("#slaConfigBody").sortable({appendTo:"parent",helper:"clone",handle:".dvMove",items:"tr",update:function(){var slaTr=pageId.find("#slaConfigBody").find("tr"),slaConfigList=new Array;$.each(slaTr,function(ind,value){var slaConfigId=$(this).attr("slaconfigid");void 0!==slaConfigId&&(slaConfigList[ind]=slaConfigId)});var params={slaConfigList:""+slaConfigList,method:"changePriority",conreqcsr:csrfToken};$.post("/changeSLAConfigPriority.zp",params,function(data){})}}).disableSelection()):pageWrapper.append(CommonTemplates.noDataSVG("",!0,ZPI18N.getString("zp.noslaconfigured"),!1))},cloneSLA:function(slaConfigId){SLA.showSLASlider();var params={slaConfigId:slaConfigId,method:"getSLAConfig"};otherdetails={type:"clone"},ZPeople.Request.send("/getSLAConfig.zp",params,SLA.slaConfigEditAndClone,otherdetails)},changeSLAStatus:function(getThis,slaConfigId){var isActive=!0,params={},input=$(getThis).find("input");0==input.is(":checked")?input.prop("checked",!0):(isActive=!1,input.prop("checked",!1)),params.isActive=isActive,params.method="changeSLAStatus",params.slaConfigId=slaConfigId,ZPeople.Request.send("/changeSLAStatus.zp",params)},createNewLevel:function(){var pageId=$("#"+Layout.Page.pageId).find("#sla_levels_box");return pageId.append(SLA.getLevelsTemplate()),SLA.refreshLevels(),pageId.find("[name=sla_levels]").last()},showSlaMails:function(getThis){$(getThis).zparrowmenu({id:"slaMailList",data:SLA.getSLAMails(),callback:SLA.selectMailCallBack})},selectMailCallBack:function(obj,parent){$(parent).siblings("[name=mail_template]").zpselect({selectedVal:[{id:$(obj).attr("id"),text:$(obj).attr("name")}],isMandatory:!0})},toggleLevelBox:function(getThis){var levelBox=$(getThis).parent();levelBox.hasClass("zp_lvlHd")?levelBox.removeClass("zp_lvlHd"):levelBox.addClass("zp_lvlHd"),SLA.showLevelHeaders()},getSlaConfig:function(slaConfigId){SLA.showSLASlider(slaConfigId);var params={slaConfigId:slaConfigId,method:"getSLAConfig"};otherdetails={type:"edit"},ZPeople.Request.send("/getSLAConfig.zp",params,SLA.slaConfigEditAndClone,otherdetails)},slaConfigEditAndClone:function(data,params,otherdetails){var pageId=$("#"+Layout.Page.pageId).find("#sla_slider");"edit"==otherdetails.type&&pageId.find("#sla_header").text(ZPI18N.getString("zp.editsla")),pageId.find("#sla_name").val(ZPeople.decodeTxt(data.sla_name)),pageId.find("#sla_desc").val(ZPeople.decodeTxt(data.sla_desc)),pageId.find("#sla_category").zpselect({selectedVal:[{id:data.category.cgyId,text:data.category.cgyName}],isMandatory:!0}),void 0!=data.criteriaFCObj&&NewWorkFlow.setCriteria(data,data.criteriaFCObj),$.isEmptyObject(HRCase.PRIORITY)&&HRCases.getPriorityList(),pageId.find("#sla_levels_box").children().remove(),$.each(data.execution,function(level,target){var box=SLA.createNewLevel(),slaDetails=target.sla_details[0];if(box.find("#sla_duration").val(target.sla_duration),box.find("#sla_time").zpselect({selectedVal:[{id:target.sla_duration_type,text:SLA.getPeriodNameByValue(target.sla_duration_type)}],isMandatory:!0}),box.find("#oper_hours").zpselect({selectedVal:[{id:target.oper_hour,text:target.oper_hour==SLA.CALTYPE_CALENDAR_HOURS?ZPI18N.getString("zp.calendardays"):ZPI18N.getString("zp.businessdays")}],isMandatory:!0}),(void 0!=slaDetails&&"clone"==otherdetails.type||void 0!=slaDetails&&"edit"==otherdetails.type&&slaDetails.sla_type!=SLA.ACTION_ESCALATIONTO_PRIORITY)&&(box.find("#sla_agent").zpselect({selectedVal:[{id:slaDetails.sla_value,text:slaDetails.sla_dispName,imageAlt:ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(slaDetails.sla_dispName))),image:slaDetails.sla_dispImg}],isMandatory:!0}),box.find("#sla_agent").attr("cgyagentid",slaDetails.sla_value),box.find("#sla_agent").attr("agenttype",SLA.getAgentTypeBasedOnSLA(slaDetails.sla_type))),void 0!=target.notification_mails&&(SLA.toggleEscalationMail(box.find("#mail_switch")),$.each(target.notification_mails,function(index,mails){var mail_detail=mails.notification_templates[0];box.find("[name=mail_template]").zpselect({selectedVal:[{id:mail_detail.id,text:mail_detail.name}],isMandatory:!0}),box.find("#timer_type").zpselect({selectedVal:[{id:mails.notification_time_type,text:SLA.getPeriodNameByValue(mails.notification_time_type)}],isMandatory:!0}),box.find("[name=mail_time]").find("input").val(mails.notification_time)})),void 0!=target.escalations){var selectedVal_Arr=[];$.each(target.escalations,function(index,escalateTo){var escalationObj={id:escalateTo.sla_value,text:escalateTo.sla_dispName,imageAlt:ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(escalateTo.sla_dispName))),image:escalateTo.sla_dispImg};selectedVal_Arr.push(escalationObj)}),box.find("#escalation_to").zpselect({selectedVal:selectedVal_Arr,checkbox:!0})}target.hasOwnProperty("setHighPriority")&&target.setHighPriority&&box.find("#slaesc_enable_priority").find('input[type="checkbox"]').prop("checked",!0)}),pageId.find("#sla_levels_box").children().addClass("zp_lvlHd"),setTimeout(function(){SLA.showLevelHeaders()},100)},selectMenuCallBack:function(liObj,srcObj){-1==$(liObj).attr("id")?$("#"+AutomationCommon.getCurrentPageId()).find("#reportingToMsg").removeClass("zp_dyn"):$("#"+AutomationCommon.getCurrentPageId()).find("#reportingToMsg").addClass("zp_dyn")},resetApprovalAdvSettings:function(){var slaSettingsDiv=$("#"+AutomationCommon.getCurrentPageId()).find("#apprSlaSetDv");slaSettingsDiv.find("#skip_btn").prop("checked",!0),slaSettingsDiv.find("#approve_btn").prop("checked",!0),slaSettingsDiv.find("#sla_enable").removeClass("IC-chk-box2"),slaSettingsDiv.find("#sla_reminder").removeClass("IC-chk-box2"),slaSettingsDiv.find("#pending_reminder").find("i").removeClass("IC-chk-box2"),slaSettingsDiv.find("#sla_duration").val(""),slaSettingsDiv.find("#notification_time").val("").attr("disabled",!0),slaSettingsDiv.find("#pending_duration").val("").attr("disabled",!0),slaSettingsDiv.find("#sla_enable").parent().parent("div").siblings().addClass("zp_opLw"),void 0==SLA.isClickRegistered&&(slaSettingsDiv.find(".IC-chk-box1").click(function(){var checkBox=$(this);checkBox.hasClass("IC-chk-box2")?checkBox.removeClass("IC-chk-box2"):checkBox.addClass("IC-chk-box2")}),slaSettingsDiv.find("#sla_enable").click(function(){var checkBox=$(this);checkBox.hasClass("IC-chk-box2")?checkBox.parents(".zp_txt").siblings().removeClass("zp_opLw"):checkBox.parents(".zp_txt").siblings().addClass("zp_opLw")}),slaSettingsDiv.find("#sla_reminder").click(function(){$(this).hasClass("IC-chk-box2"),slaSettingsDiv.find("#notification_time").removeAttr("disabled")}),slaSettingsDiv.find("#pending_reminder").find("i").click(function(){$(this).hasClass("IC-chk-box2"),slaSettingsDiv.find("#pending_duration").removeAttr("disabled")}),slaSettingsDiv.find("[name=lastLevelApproval]").on("change",function(){var reminderDiv=slaSettingsDiv.find("#pending_reminder");slaSettingsDiv.find("#wait_btn").is(":checked")?(reminderDiv.removeClass("zp_opLw"),slaSettingsDiv.find("#reminderMsg").removeClass("zp_dyn")):(reminderDiv.addClass("zp_opLw"),slaSettingsDiv.find("#reminderMsg").addClass("zp_dyn"))}),SLA.isClickRegistered=!0);var approverDiv=slaSettingsDiv.find("#sla_assignee");CommonTemplates.getSelectMenu(ApprovalProcess.getApproverUserMenuProperty(SLA.MODE),approverDiv,{id:"sla_assignee_inp",placeholder:ZPI18N.getString("zp.select")},{isMandatory:!0}),CommonTemplates.getSelectMenu(SLA.setTimerValues(),slaSettingsDiv.find("#sla_timer_div"),{id:"sla_time"},{isMandatory:!0}),slaSettingsDiv.find("#sla_time").zpselect({selectedVal:[{id:SLA.SLA_TIMER_DAYS,text:ZPI18N.getString("zp.wfdays")}],isMandatory:!0})},setApprovalAdvSettings:function(slaConfig){if(void 0!=slaConfig&&void 0!=slaConfig.execution){var slaSettingsDiv=$("#"+AutomationCommon.getCurrentPageId()).find("#apprSlaSetDv");slaSettingsDiv.find(".zp_sLap").children().removeClass("zp_opLw"),slaSettingsDiv.find("#sla_enable").addClass("IC-chk-box2");var execution=slaConfig.execution,sla_details="";$.each(execution,function(index,row){switch(index){case 0:sla_details=row.sla_details[0],slaSettingsDiv.find("#sla_duration").val(row.sla_duration),sla_details.sla_type==SLA.APPR_AUTO_APPROVE?slaSettingsDiv.find("#skip_btn").prop("checked",!0):sla_details.sla_type==SLA.APPR_AUTO_REJECT?slaSettingsDiv.find("#rjct_btn").prop("checked",!0):sla_details.sla_type==SLA.APPR_ASSIGNTO_EMP?(slaSettingsDiv.find("#assign_btn").prop("checked",!0),slaSettingsDiv.find("#sla_assignee_inp").zpselect({selectedVal:[{id:sla_details.sla_value,text:ZPeople.decodeTxt(sla_details.sla_dispName)}],isMandatory:!0})):sla_details.sla_type==SLA.APPR_ASSIGNTO_REPORTINGTO&&(slaSettingsDiv.find("#assign_btn").prop("checked",!0),slaSettingsDiv.find("#sla_assignee_inp").zpselect({selectedVal:[{id:"-1",text:ZPI18N.getString("zp.reportingto")}],isMandatory:!0}));var notification=void 0!=row.notification_mails?row.notification_mails[0]:"";void 0!=notification&&""!=notification&&(slaSettingsDiv.find("#notification_time").val(notification.notification_time),slaSettingsDiv.find("#sla_reminder").addClass("IC-chk-box2"),slaSettingsDiv.find("#notification_time").removeAttr("disabled"),slaSettingsDiv.find("#sla_time").zpselect({selectedVal:[{id:notification.notification_time_type,text:SLA.getPeriodNameByValue(notification.notification_time_type)}],isMandatory:!0}));break;case 1:(sla_details=row.sla_details[0]).sla_type==SLA.APPR_AUTO_APPROVE?(slaSettingsDiv.find("#approve_btn").prop("checked",!0),slaSettingsDiv.find("#pending_reminder").addClass("zp_opLw"),slaSettingsDiv.find("#reminderMsg").addClass("zp_dyn")):sla_details.sla_type==SLA.APPR_AUTO_REJECT?(slaSettingsDiv.find("#reject_btn").prop("checked",!0),slaSettingsDiv.find("#pending_reminder").addClass("zp_opLw"),slaSettingsDiv.find("#reminderMsg").addClass("zp_dyn")):sla_details.sla_type==SLA.APPR_PENDING&&(slaSettingsDiv.find("#wait_btn").prop("checked",!0),slaSettingsDiv.find("#pending_reminder").removeClass("zp_opLw"),slaSettingsDiv.find("#reminderMsg").removeClass("zp_dyn"));break;case 2:(sla_details=row.sla_details[0]).sla_type==SLA.APPR_PENDING_NOTIFY?(slaSettingsDiv.find("#pending_reminder").find("i").addClass("IC-chk-box2"),slaSettingsDiv.find("#pending_duration").val(row.sla_duration),slaSettingsDiv.find("#pending_duration").removeAttr("disabled")):(slaSettingsDiv.find("#pending_reminder").find("i").removeClass("IC-chk-box2"),slaSettingsDiv.find("#pending_duration").attr("disabled",!0))}})}},saveConfig:function(related_configId,related_configtype,formId){var pageId=$("#"+Layout.Page.pageId).find("#sla_slider"),sla_name=$.trim(pageId.find("#sla_name").val()),sla_desc=$.trim(pageId.find("#sla_desc").val()),isError=!1;pageId.find(".etxt").addClass("zp_dyn"),pageId.find(".zp_err").removeClass("zp_err"),""==sla_name&&(isError=!0,pageId.find("#sla_name").parent().addClass("zp_err"),pageId.find("#sla_name").closest(".zp_fm").find("span").html(ZPI18N.getString("zp.cbtnameempty")).removeClass("zp_dyn")),sla_name.length>100&&(isError=!0,pageId.find("#sla_name").parent().addClass("zp_err"),pageId.find("#sla_name").closest(".zp_fm").find("span").html(ZPI18N.getString("zp.cannotexceedchar",new Array(ZPI18N.getString("zp.name"),"100"))).removeClass("zp_dyn")),sla_desc.length>250&&(isError=!0,pageId.find("#sla_desc").parent().addClass("zp_err"),pageId.find("#sla_desc").closest(".zp_fm").find("span").html(ZPI18N.getString("zp.cannotexceedchar",new Array(ZPI18N.getString("zp.description"),"250"))).removeClass("zp_dyn"));var params={related_configId:related_configId,related_configType:related_configtype,method:"save",sla_name:sla_name,sla_desc:sla_desc},slaConfigId=pageId.attr("slaconfigid");void 0!=slaConfigId&&""!=slaConfigId&&"0"!=slaConfigId&&(params.slaConfigId=slaConfigId),void 0!=formId&&(params.formId=formId),params.execution=SLA.getSlaExecutionConfig(),params.categoryIds=[];var categoryIds=pageId.find("#sla_category").attr("selectedIds");if(void 0==categoryIds||""==categoryIds)return pageId.find("#sla_category").parent().addClass("zp_err"),void pageId.find("#sla_category_div").next().removeClass("zp_dyn");params.categoryIds="["+categoryIds+"]";var ruleJSON=Criteria.getCriteriaConfigJson(pageId.find("#crtBody").find("[name=crtRowDiv]"),"",[]),ruleFormat=pageId.find("[name=critPatternVal]").val();ruleFormat=(ruleFormat=Criteria.replaceRuleFormat(ruleFormat)).replace(/ +/g,"");var ruleValidationResult=Rule.validateRuleWithFormat(pageId.find("#crtBody"),ruleJSON,ruleFormat);1==ruleJSON.isError||void 0!=ruleValidationResult&&1==ruleValidationResult.isError||(params.ruleJson=JSON.stringify(ruleJSON),params.ruleFormat=ruleFormat,!1===params.execution||isError||(pageId.find("#save_btn").attr("disabled",!0),ZPeople.Request.send("/saveSLAConfig.zp",params,SLA.afterSave)))},getSlaExecutionConfig:function(){var executionConf=[],level_Box=$("#"+Layout.Page.pageId).find("[name=sla_levels]");return $.each(level_Box,function(index,box){var params=SLA.getLevelData(box);if(void 0!==params.isError)return executionConf="",void $(box).removeClass("zp_lvlHd");executionConf.push(params)}),""!=executionConf&&JSON.stringify(executionConf)},getLevelData:function(box){var agent_input=$(box).find("#sla_agent"),sla_duration=$(box).find("#sla_duration").val(),params={};if(""==sla_duration)return params.isError=!0,$(box).find("#sla_duration").parent().addClass("zp_err"),$(box).find("#sla_duration").next().removeClass("zp_dyn"),params;params.sla_duration=sla_duration,params.sla_duration_type=$(box).find("#sla_time").attr("selectedids");var sla_time_mins=SLA.convertToMinutes(params.sla_duration_type,params.sla_duration);if(-1==sla_time_mins?($(box).find("#sla_duration").parent().addClass("zp_err"),$(box).find("#sla_duration").next().removeClass("zp_dyn").text(ZPI18N.getString("zp.enteravalidnumber")),params.isError=!0):sla_time_mins>21600&&($(box).find("#sla_duration").parent().addClass("zp_err"),$(box).find("#sla_duration").next().removeClass("zp_dyn").text(ZPI18N.getString("zp.cannotexceeddays",[15])),params.isError=!0),params.sla_duration<1)return ZPeople.Message.showFailureMsg("Reminder time should be less than Closure time"),params.isError=!0,params;var oper_hour=$(box).find("#oper_hours").attr("selectedIds");params.oper_hour=oper_hour;var sla_arr=[],change_agent=agent_input.attr("selectedids");if(void 0!=change_agent&&""!=change_agent){var sla_params={sla_type:SLA.getSLATypeBasedOnAgent(agent_input.attr("agenttype")),sla_value:change_agent};sla_arr.push(sla_params)}var escalation_owners=$(box).find("#escalation_to").attr("selectedids");if(void 0!=escalation_owners&&""!=escalation_owners){var esc_arr=escalation_owners.split(",");$.each(esc_arr,function(index,owners){var escalation_params={sla_type:SLA.ACTION_ESCALATIONTO_EMP,sla_value:owners};sla_arr.push(escalation_params)})}if($(box).find("#slaesc_enable_priority").find('input[type="checkbox"]').prop("checked")){var priority_params={sla_type:SLA.ACTION_ESCALATIONTO_PRIORITY};$.each(HRCase.ALLPRIORITY,function(i,v){if(HRCase.ALLPRIORITY[i].systemValue==HRCase.HIGH_SID)return priority_params.sla_value=HRCase.ALLPRIORITY[i].optionId,!1}),sla_arr.push(priority_params)}if(0!=sla_arr.length?params.sla_details=sla_arr:($(box).find("#sla_agent_div").addClass("zp_err"),$(box).find("#escalation_to_div").addClass("zp_err"),$(box).find("#escalation_to_div").closest(".zp_fm").append('<span class="etxt">'+ZPI18N.getString("zp.selectatleastoneaction")+"</span>"),params.isError=!0),$(box).find("#mail_switch").find("input").is(":checked")){var mails=[],mail_conf={};mail_conf.notification_time=$(box).find("[name=mail_time]").find("input").val(),""==mail_conf.notification_time&&($(box).find("[name=mail_time]").addClass("zp_err"),$(box).find("[name=mail_time]").find("span").text(ZPI18N.getString("zp.enteravalue")).removeClass("zp_dyn"),params.isError=!0),mail_conf.notification_time_type=$(box).find("#timer_type").attr("selectedids"),mails.push(mail_conf),params.notification_mails=mails;var reminder_time_mins=SLA.convertToMinutes(mail_conf.notification_time_type,mail_conf.notification_time);if(sla_time_mins<=reminder_time_mins||reminder_time_mins<1||-1==reminder_time_mins){var errmsg=-1==reminder_time_mins?ZPI18N.getString("zp.enteravalidnumber"):ZPI18N.getString("zp.lessremindertime");$(box).find("[name=mail_time]").addClass("zp_err"),$(box).find("[name=mail_time]").find("span").text(errmsg).removeClass("zp_dyn"),params.isError=!0}}return params},convertToMinutes:function(timer_type,timer_value){var miutes=0;return/^\d+$/.test(timer_value)?timer_type==SLA.SLA_TIMER_HOURS?miutes=60*timer_value:timer_type==SLA.SLA_TIMER_DAYS?miutes=60*timer_value*24:timer_type==SLA.SLA_TIMER_MINUTES&&(miutes=1*timer_value):miutes=-1,miutes},getSLATypeBasedOnAgent:function(agentType){var sla_type="";return agentType==OWNER_EMPLOYEE?sla_type=SLA.ACTION_CASEOWNER_EMP:agentType==OWNER_GROUP?sla_type=SLA.ACTION_CASEOWNER_GRP:agentType==OWNER_DEPARTMENT&&(sla_type=SLA.ACTION_CASEOWNER_DEP),sla_type},getAgentTypeBasedOnSLA:function(sla_type){var agentType="";return sla_type==SLA.ACTION_CASEOWNER_EMP?agentType=OWNER_EMPLOYEE:sla_type==SLA.ACTION_CASEOWNER_GRP?agentType=OWNER_GROUP:sla_type==SLA.ACTION_CASEOWNER_DEP&&(agentType=OWNER_DEPARTMENT),agentType},afterSave:function(results,params){void 0!==results.slaConfigId?(ZPeople.Message.showSuccessMsg(results.message),SLA.closeSLASlider(),SLA.resetConfig=!0,SLA.getCasesSLA()):ZPeople.Message.showFailureMsg(results.message)},callSaveConfig:function(){var related_configId="",related_configtype="";-1!==Layout.Page.hash.indexOf("hrcase/settings")&&(related_configId=Layout.Page.childUrlParam.categoryid,related_configtype=SLA.TYPE_CASES),SLA.saveConfig(related_configId,related_configtype)},toggleEscalationMail:function(getThis){var toggleBtn=$(getThis).find("input"),toggleParent=$(getThis).parent();toggleBtn.is(":checked")?(toggleBtn.prop("checked",!1),$(toggleParent).find("[name = mail_time_type]").addClass("zp_dyn"),$(toggleParent).find("[name = mail_time]").addClass("zp_dyn")):(toggleBtn.prop("checked",!0),$(toggleParent).find("[name = mail_time_type]").removeClass("zp_dyn"),$(toggleParent).find("[name = mail_time]").removeClass("zp_dyn"))},setTimerValues:function(getThis){return{id:"timerValList",data:SLA.getTimers()}},setReminderTimers:function(level){return{id:"timerValList",data:function(){for(var sla_timer_range=level.find("#sla_time").attr("selectedids"),timer_params=SLA.getTimers(!0),params=[],i=0;i<sla_timer_range;i++)params.push(timer_params[i]);return params}}},setOperationalHours:function(level){return{id:"operHoursList",data:function(){for(var sla_timer_range=level.find("#sla_time").attr("selectedids"),timer_params=SLA.getOperationalHours(sla_timer_range>SLA.SLA_TIMER_HOURS,level),params=[],i=0;i<timer_params.length;i++)params.push(timer_params[i]);return params}}},getTimers:function(isReminder){var params=[];return(isReminder||Layout.ISLOCALIDCSETUP||Layout.ISDEV)&&params.push({id:SLA.SLA_TIMER_MINUTES,value:ZPI18N.getString("zp.wfminutes")}),params.push({id:SLA.SLA_TIMER_HOURS,value:ZPI18N.getString("zp.leavetype.hours")}),params.push({id:SLA.SLA_TIMER_DAYS,value:ZPI18N.getString("zp.wfdays")}),params},getOperationalHours:function(isDays,box){var params=[];return params.push({id:SLA.CALTYPE_CALENDAR_HOURS,value:ZPI18N.getString("zp.calendardays")}),isDays&&params.push({id:SLA.CALTYPE_BUSINESS_HOURS,value:ZPI18N.getString("zp.businessdays")}),params},getPeriodNameByValue:function(val){var name="";return val==SLA.SLA_TIMER_HOURS?name=ZPI18N.getString("zp.leavetype.hours"):val==SLA.SLA_TIMER_DAYS?name=ZPI18N.getString("zp.wfdays"):val==SLA.SLA_TIMER_MINUTES&&(name=ZPI18N.getString("zp.wfminutes")),name},refreshSLASlider:function(){var pageId=$("#"+Layout.Page.pageId).find("#sla_slider");pageId.find("#sla_name").val(""),pageId.find("#sla_desc").val(""),pageId.find("#sla_levels_box").children().remove(),pageId.find("#save_btn").removeAttr("disabled"),pageId.find(".etxt").addClass("zp_dyn"),pageId.find(".zp_err").removeClass("zp_err"),pageId.find("#sla_header").text(ZPI18N.getString("zp.addsla")),Criteria.resetCrt();var crtBox=pageId.find("#crtMainDiv");crtBox.find(".col-md-12").find(".section").removeClass("MB5").addClass("MB15 MT20"),crtBox.find(".col-md-11").attr("class","col-md-12");var agent_params=HRCategory.cgydropdown(ADMIN_CGY_LISTING,"",!0);agent_params.isMandatory=!0,agent_params.callback=function(liObj,srcObj){Criteria.resetCrt()},$(pageId).find(".IC-info").attr("data-content","<div class='P5'>"+ZPI18N.getString("zp.levelstriggered")+"</div>").hover(function(){$(this).popover({html:!0,trigger:"hover",content:function(){return $(this).attr("data-content")}}),$(this).popover("show")}),CommonTemplates.getSelectMenu(agent_params,pageId.find("#sla_category_div"),{id:"sla_category",placeholder:ZPI18N.getString("zp.select")},{isMandatory:!0})},refreshLevels:function(){var level_Box=$("#"+Layout.Page.pageId).find("[name=sla_levels]").last(),agent_params=HRCaseDropdown.cgymemberdropdown(),timerProp=SLA.setTimerValues();timerProp.callback=SLA.setOperHour,CommonTemplates.getSelectMenu(timerProp,level_Box.find("#sla_timer_div"),{id:"sla_time",placeholder:ZPI18N.getString("zp.select")},{isMandatory:!0}),CommonTemplates.getSelectMenu(agent_params,level_Box.find("#sla_agent_div"),{id:"sla_agent",placeholder:ZPI18N.getString("zp.select")},{isMandatory:!0}),(agent_params=ZPTasks.filterDropDown("taskowner",!0)).checkbox=!0,CommonTemplates.getSelectMenu(agent_params,level_Box.find("#escalation_to_div"),{id:"escalation_to",placeholder:ZPI18N.getString("zp.select")},{checkbox:!0}),CommonTemplates.getSelectMenu(SLA.setOperationalHours(level_Box),level_Box.find("#oper_hours_div"),{id:"oper_hours"},{isMandatory:!0}),level_Box.find("#sla_timer_div").removeClass("zp_fm"),level_Box.find("#sla_agent_div").removeClass("zp_fm"),level_Box.find("#sla_duration").val(1),level_Box.find("#sla_time").zpselect({selectedVal:[{id:SLA.SLA_TIMER_DAYS,text:ZPI18N.getString("zp.wfdays")}],isMandatory:!0}),level_Box.find("[name=mail_time]").find("input").val(1),CommonTemplates.getSelectMenu(SLA.setReminderTimers(level_Box),level_Box.find("#escalation_timer_div"),{id:"timer_type",placeholder:ZPI18N.getString("zp.select")},{isMandatory:!0}),level_Box.find("#escalation_timer_div").removeClass("zp_fm"),level_Box.find("#timer_type").zpselect({selectedVal:[{id:SLA.SLA_TIMER_HOURS,text:ZPI18N.getString("zp.leavetype.hours")}],isMandatory:!0}),level_Box.find("#oper_hours").zpselect({selectedVal:[{id:SLA.CALTYPE_CALENDAR_HOURS,text:ZPI18N.getString("zp.calendardays")}],isMandatory:!0}),SLA.showLevelHeaders()},setOperHour:function(obj,inbutBox){var levelBox=inbutBox.closest("#sla_levels_box");levelBox.find("#oper_hours").zpselect({selectedVal:[{id:SLA.CALTYPE_CALENDAR_HOURS,text:ZPI18N.getString("zp.calendardays")}],isMandatory:!0}),levelBox.find("#sla_time").attr("selectedids")==SLA.SLA_TIMER_DAYS?levelBox.find("#oper_hours_div").parent().removeClass("zp_dyn"):levelBox.find("#oper_hours_div").parent().addClass("zp_dyn")},showLevelHeaders:function(){var pageId=$("#"+Layout.Page.pageId),boxes=pageId.find("[name=sla_levels]"),count=1;if($.each(boxes,function(key,box){var header_name=ZPI18N.getString("zp.level")+" "+count++;$(box).hasClass("zp_lvlHd")&&(header_name+=" - "+$(box).find("#sla_duration").val()+" "+$(box).find("#sla_time").siblings("div").html()),$(box).find("h5").text(header_name)}),2!=count){var lastBox=boxes.last();lastBox.find("[name=delete_btn]").removeClass("DN"),lastBox.prev().find("[name=delete_btn]").addClass("DN")}count>SLA.SLA_MAX_LEVEL?pageId.find("#add_level_button").addClass("DN"):pageId.find("#add_level_button").removeClass("DN")},removeLevel:function(){$("#"+Layout.Page.pageId).find("[name=sla_levels]").last().remove(),SLA.showLevelHeaders()},getSLAMails:function(){return void 0===SLA.MAILS&&$.ajax({url:"/mailalertListForCase.zp",type:"POST",async:!1,data:{mode:"hrCase",method:"mailAlertListforCase",conreqcsr:csrfToken},success:function(result){SLA.MAILS=[],$.each(result,function(key,value){SLA.MAILS.push({id:value.MAIL_ALERT_ID,value:value.TEMPLATE_NAME})})}}),SLA.MAILS},closeSLASlider:function(){$("#"+Layout.Page.pageId).find("#sla_slider").removeClass("zp_shw")},showSLASlider:function(slaConfigId){var pageId=$("#"+Layout.Page.pageId);SLA.refreshSLASlider(),0!=pageId.find("#sla_slider").length&&pageId.find("#sla_slider").addClass("zp_shw"),void 0==slaConfigId?(SLA.createNewLevel(),pageId.find("#sla_slider").removeAttr("slaconfigid")):pageId.find("#sla_slider").attr("slaconfigid",slaConfigId)},getSLAHistory:function(){var pageId=Layout.Page.container,pkid=ZPForm.CURRFORM_PARAM.recordId;if(0===pageId.find("#sla_history_"+pkid).length){var modalProperty={id:"sla_history_"+pkid,type:1,headerHtml:"<h6>"+ZPI18N.getString("zp.slatimeline")+'</h6><a data-dismiss="modal" class="close"> <i class="IC-cls red S14"></i> </a>',overwriteModalClass:!0,modalClass:"modal popRgtModel zp_sla PopApModel",removeModalClass:"fade ZPmdl",deleteOnHide:!0,closeonEsc:!0,disableFooter:!0,bodyClass:"NomdlFoot PT0I"};ZPeople.BSModal.show(ZPeople.BSModal.get(modalProperty))}var popup_body=pageId.find("#sla_history_"+pkid).find("#zp_modal_body");popup_body.children().remove(),popup_body.append(ZPeople.LOADING_HTML);var params={recordId:pkid,method:"getSLATimeline"};ZPeople.Request.send("/getSLATimeline.zp",params,SLA.constructSLAHistory)},constructSLAHistory:function(data,params){var popup_body=Layout.Page.container.find("#sla_history_"+params.recordId).find("#zp_modal_body");if(popup_body.children().remove(),0!=data.length){var history_body='<div class="tlouter tltime">';$.each(data,function(level,targets){history_body+='<div class="tlentry cmpl"><div class="tlentry-inner"><div class="tlicon ttl"></div><div class="tllabel zp_bld"><div class="stshead"><div><span>'+ZPI18N.getString("zp.level")+" "+(level+1)+"</span></div></div></div></div></div>",$.each(targets,function(dataCount,slaData){$.each(slaData,function(mapCount,actionMap){$.each(actionMap.actions,function(actionInd,action){var header_class=actionMap.isExecuted?"cmpl tlentry":"tlentry";if(0==actionInd){history_body+='<div class="'+header_class+'"><div class="tlentry-inner">';var slatime=actionMap.slatime.split("-"),date=slatime[0],month=slatime[1],year=slatime[2].split(" ")[0],time=slatime[2].split(" ")[1]+" "+slatime[2].split(" ")[2];history_body+='<div class="tltime"><span class="date"><i>'+date+"</i>"+month+"</span><span>"+year+'</span><span class="time">'+time+'</span></div><div class="tlicon"></div><div class="tllabel"><div class="stshead"><div>'}history_body+="<span>"+action.message+"</span>"}),history_body+="</div></div></div></div></div>"})})}),history_body+="</div>",popup_body.append(history_body)}else popup_body.append(CommonTemplates.noDataSVG("",!0,ZPI18N.getString("zp.noescalationfound"),!1))},setSLATimer:function(){var sla_timer=Layout.Page.container.find("#sla_time"),slaTimeStr=sla_timer.html();if(void 0==slaTimeStr||"00 : 00 : 00"===slaTimeStr||-1==slaTimeStr.indexOf(":"))clearInterval(SLA.timer);else{var time=slaTimeStr.split(" : "),timeinsec=3600*time[0]+60*time[1]+parseInt(time[2])-1;if(timeinsec>0){var hours=Math.floor(timeinsec/3600);timeinsec%=3600;var minutes=Math.floor(timeinsec/60);timeinsec%=60,sla_timer.html(SLA.getTimeIn2Digit(hours)+" : "+SLA.getTimeIn2Digit(minutes)+" : "+SLA.getTimeIn2Digit(timeinsec))}else sla_timer.prev().html(ZPI18N.getString("zp.escalated")),sla_timer.html("00 : 00 : 00"),clearInterval(SLA.timer),setTimeout(function(){HRCase.DetailedView.newviewCaseDetails(Layout.Page.childUrlParam.caseid)},3e3)}},showSLABand:function(data){var pageId=Layout.Page.container;if(void 0!=data&&void 0!=data.currentStatus){var slaTime,timerColor,details=SLA.getSlaTimeAndColor(data,"band");slaTime=details.text,timerColor="zpl_cSlt "+details.color;var timer_div=pageId.find("#timer"),sla_time=timer_div.find("#sla_time");timer_div.removeClass("gr rd"),timer_div.addClass(timerColor),"escalated"==details.status||"paused"==details.status?(sla_time.prev().html(slaTime),sla_time.html("00 : 00 : 00")):(sla_time.prev().html(ZPI18N.getString("zp.caseclosesin")),sla_time.html(slaTime)),clearInterval(SLA.timer),SLA.timer=setInterval(SLA.setSLATimer,1e3)}else pageId.find("#timer").addClass("zpl_DNI")},showSLATimeHeader:function(data){var slaTime,pageId=Layout.Page.container,details=SLA.getSlaTimeAndColor(data,"band");slaTime=details.text,details.color,pageId.find("#escalation_time").html(slaTime),clearInterval(SLA.timer),SLA.timer=setInterval(SLA.setSLATimer,1e3)},getSlaTimeAndColor:function(data,mode){var slaTime="",timerColor="",status="",params={};return void 0!=data&&void 0!=data.currentStatus&&(void 0==data.nextViolation?data.isViolated?(slaTime=ZPI18N.getString("zp.escalated"),timerColor="rd",status="escalated"):data.currentStatus==SLA.TIMER_PAUSE?(slaTime=ZPI18N.getString("zp.paused"),timerColor="",status="paused"):"list"!=mode&&(slaTime=ZPI18N.getString("zp.ontime"),timerColor="gr",status="ontime"):(slaTime=data.nextViolation,timerColor=data.isViolated?"rd":"gr",status="nextviolation")),params.color=timerColor,params.text=slaTime,params.status=status,params},getColorClass:function(color,mode){var color_class="";switch(color){case SLA.COLOR_RED:color_class="list"==mode?"zp_rclr":"vlteLvl";break;case SLA.COLOR_GRN:color_class="list"==mode?"zp_gclr":"CmLvl";break;case SLA.COLOR_ORG:color_class="list"==mode?"zp_oclr":"PsLvl"}return color_class},getTimeIn2Digit:function(time){return time>9?time:time<0?"00":"0"+time}};if(void 0===zia)var zia={};zia.minimizeChat=function(){ziaPeople.ziaChatClick()},zia.handleResponse=function(functionName,data,element,responseHandled,isFromHistory){var ele=$(element);return ziaPeople.constructResponse(data,ele,isFromHistory),!1},zia.didConnect=function(){$("#ziaLoading").remove()},zia.getClientSessionData=function(isSessionInvocation){if(!isSessionInvocation)return new Promise(function(resolve,reject){if("undefined"!=typeof Storage&&null!==localStorage.getItem("att_LatLonDet")){var latLonnObj=JSON.parse(localStorage.getItem("att_LatLonDet")),lastFetTime=latLonnObj.fetchedTime;if((new Date).getTime()-lastFetTime<=12e4){locStr=latLonnObj.latitude+"_"+latLonnObj.longitude+"_"+latLonnObj.accuracy;var json={location:locStr};resolve(json)}}navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(position){var param={};param.latitude=position.coords.latitude,param.longitude=position.coords.longitude,param.accuracy=position.coords.accuracy;var locStr=position.coords.latitude+"_"+position.coords.longitude+"_"+position.coords.accuracy;Attendance.Entry.storeLatLongInLStore(param),resolve({location:locStr})},function(err){resolve({location:"No location found"})})})},zia.getOnBoardingSentences=function(sentences){var OnBoardsentences=[],param={conreqcsr:csrfToken,method:"getOnboardingSentence"};return ZPeople.Request.sendAsyncPost("/getOnboardingSentence.zp",param,function(data){for(var i=0;i<data.onBoardingSentence.length;i++)OnBoardsentences.push({id:i+1,sentence:data.onBoardingSentence[i],actual_sentence:data.onBoardingSentence[i]})}),OnBoardsentences};var ziaPortalId="",ziaPeople={ziaDataEle:"",isZiaBotEnabled:!1,ziaChatClick:function(){if(""==ziaPortalId){var param={conreqcsr:csrfToken,method:"ziaPortal"};ZPeople.Request.sendAsyncPost("/ziaPortal.zp",param,function(data){ziaPortalId=data.ziaPortalId}),$("body").append('<div class="zp_cAzia"><div id="ziaLoading" class="zp_loads"><img src="'+ZPeople.getResourceURL(newUIImageUrl+"zia-loading.gif")+' " alt=""></div><zia-chat-bot chat-mode="popup" portal-id="'+ziaPortalId+'" show-help="true" show-history="false" show-action-suggestions="false"  show-typing-suggestions="false" skill-name="zohopeople" lt-prop-conversation="true"></zia-chat-bot></div>');var script=document.createElement("script");script.type="text/javascript",script.src=ZPeople.getResourceURL("addons/@zia/ziaSkillsSdk/assets/js/zia-skills-sdk.js"),script.integrity=ZPeople.getResourceChecksum("addons/@zia/ziaSkillsSdk/assets/js/zia-skills-sdk.js"),script.crossOrigin="anonymous",document.getElementsByTagName("head")[0].appendChild(script),script.onload=function(){Layout.PageUtil.loadFiles(ZPLyte.getResource(["lyte_components.js","lyte_dependencies_min.css"]),()=>{ziaskills.init({zia_url:Layout.ZIAURL,static_urls:pplclienturl,fingerprint_json:fingerprintJSON})})}}else $("body").find(".zp_cAzia").toggleClass("clsZia"),$("#faqDetViewBot").addClass("clsZia")},ziaMinimizeChat:function(){$("body").find(".zp_cAzia").addClass("clsZia"),$("#faqDetViewBot").addClass("clsZia")},constructResponse:function(dataObj,ele,isFromHistory){var resObj=dataObj.getResponse,resDiv="Something went wrong";if(resObj.hasOwnProperty("paramLookup"))resDiv=ziaPeople.paramSelectOpt(resObj);else if(resObj.hasOwnProperty("paramType")&&7==resObj.paramType)resDiv=ziaPeople.paramLocation(resObj);else if(resObj.hasOwnProperty("botMessage"))resDiv=resObj.botMessage;else if(resObj.hasOwnProperty("paramConfirm"))resDiv=ziaPeople.paramConfirmation(resObj);else if(resObj.hasOwnProperty("addType")&&!isFromHistory)resDiv=ziaPeople.addInweb(resObj);else if(resObj.hasOwnProperty("report"))resDiv=ziaPeople.constructReport(resObj);else switch(resObj.type){case"faqSearch":resDiv=HRCaseFAQ.listDummy(resObj.data,dataObj.userInput,ele);break;case"task":resDiv=HRCaseFAQ.listTaskBot(resObj.data)}$(ele).parent().parent();resObj.hasOwnProperty("hasFollowupAction")&&resObj.hasOwnProperty("data")&&resObj.data.length<=0&&(resDiv='<div id="parentChatDiv">'+resDiv+"<p>"+resObj.followUpQuestion+'</p><button btype="1" class="yes">Yes</button><button btype="2">No</button></div>'),$(ele).append('<div class="zp_cAZCnt">'+resDiv+"</div>"),setTimeout(function(ele,resObj){if($(ele).parent().parent().removeClass("noPaddingBotTxt"),"true"==resObj.report?$(ele).parent().parent().addClass("zp_cAZfaq"):"faqSearch"==resObj.type||"task"==resObj.type&&resObj.hasOwnProperty("data")&&resObj.data.length>0?($(ele).find("[btype]").length||($(ele).parent().parent().addClass("zp_cAZfaq"),"task"==resObj.type&&$(ele).parent().parent().addClass("zp_cAZtsk")),"faqSearch"==resObj.type?$(ele).find("[faqid]").on("click",{faqData:resObj.data},function(event){$(this).index();HRCaseFAQ.faqViewBot(event.data.faqData[$(this).index()-1])}):($(ele).find('[id="taskRow"]').on("click",{faqData:resObj.data},function(event){$(this).index();ziaPeople.ziaMinimizeChat(),Task.showTaskDetails(event.data.faqData[$(this).index()-1].id,!0)}),$(ele).find('[id="taskBotCmp"]').on("click",{faqData:resObj.data},function(event){event.stopPropagation();$(this).index();var status=$(this).hasClass("grn")?Task.OPEN_SYSVALUE:Task.COMPLETED_SYSVALUE,getThis=$(this),params={taskid:event.data.faqData[$(this).closest("#taskRow").index()-1].id,method:"changeTaskStatus",status:status,conreqcsr:csrfToken};$.post("/changeTasksStatus.zp",params,function(data){"success"==data.Status&&$(getThis).toggleClass("grn")})}))):resObj.hasOwnProperty("module")&&"form"==resObj.module&&($(ele).parent().parent().addClass("zp_cAZfaq"),$(ele).find("[id=formRow]").on("click",{recData:resObj.data},function(event){$(this).index();ziaPeople.openAddRec(event.data.recData[$(this).index()-1])})),"faqSearch"==resObj.type||resObj.hasOwnProperty("paramLookup")||resObj.hasOwnProperty("paramConfirm")){resObj.hasOwnProperty("paramLookup")&&$(ele).parent().parent().addClass("zp_cAZfaq");$(ele).find("button");$(ele).find("button").on("click",function(){ziaPeople.chatButtonClick(this)}),$(ele).find("a").on("click",function(){ziaPeople.dataLookupClick(this)})}else resObj.hasOwnProperty("paramType")&&7==resObj.paramType&&$(ele).find("button").on("click",function(){ziaPeople.getLocationAccess(this)})},10,ele,resObj)},paramSelectOpt:function(resObj){var paramLookup=resObj.paramLookup,selOpt="";for(var paramId in paramLookup){if(paramLookup.hasOwnProperty(paramId))selOpt+="<a valId="+paramId+">"+paramLookup[paramId]+"</a></br>"}return'<div id="parentChatDiv"  class="zp_cAZfaqHd"><p class="mt0 ttl">'+resObj.botMessage+"</p>"+selOpt+'<div class="mt10"><button  btype="1" class="yes">Submit</button></div></div>'},paramLocation:function(resObj){return'<div id="parentChatDiv"><p class="mt0 ttl">'+resObj.botMessage+'</p><div class="mt10"><button  btype="1" class="yes">Ok</button></div></div>'},getLocationAccess:function(getThis){var locStr="";if("undefined"!=typeof Storage&&null!==localStorage.getItem("att_LatLonDet")){var latLonnObj=JSON.parse(localStorage.getItem("att_LatLonDet")),lastFetTime=latLonnObj.fetchedTime;if((new Date).getTime()-lastFetTime<=12e4)return locStr=latLonnObj.latitude+"_"+latLonnObj.longitude+"_"+latLonnObj.accuracy,void ziaskills.sendMessage("Location Accessed",locStr)}navigator.geolocation&&navigator.geolocation.getCurrentPosition(ziaPeople.setLocationBot)},setLocationBot:function(position){var param={};param.latitude=position.coords.latitude,param.longitude=position.coords.longitude,param.accuracy=position.coords.accuracy;var locStr=position.coords.latitude+"_"+position.coords.longitude+"_"+position.coords.accuracy;Attendance.Entry.storeLatLongInLStore(param),ziaskills.sendMessage("Location Accessed",locStr)},dataLookupClick:function(getThis){$(getThis).siblings("a").removeClass("sel"),$(getThis).addClass("sel"),ziaPeople.ziaDataEle=getThis},chatButtonClick:function(getThis){var parentChatDiv=$(getThis).parents("#parentChatDiv");1==$(getThis).attr("btype")&&void 0!=ziaPeople.ziaDataEle.accessKey&&ziaPeople.ziaDataEle.hasAttribute("valId")?(ziaskills.sendMessage($(ziaPeople.ziaDataEle).text(),$(ziaPeople.ziaDataEle).attr("valId")),$(getThis).parents("#parentChatDiv").find("a").off("click"),ziaPeople.ziaDataEle=""):2==$(getThis).attr("btype")?ziaskills.sendMessage($(getThis).text(),"stop_it"):$(getThis)[0].hasAttribute("btext")?ziaskills.sendMessage($(getThis).text(),$(getThis).attr("btext")):ziaskills.sendMessage($(getThis).text()),parentChatDiv.find("button").off("click"),$(getThis).parent().find("button").off("click")},paramConfirmation:function(resObj){var tr="";return $.each(resObj.data,function(i,faqObj){tr+="<em>"+faqObj.paramName+'</em></td><td style="width: 605.25px;"><span>'+("Category"==faqObj.paramName||"Leavetype"==faqObj.paramName?faqObj.paramUserValue:ZPeople.escapeHtml(faqObj.paramUserValue))+"</span>"}),'<div id="parentChatDiv">'+tr+"<p>"+resObj.confirmQn+'</p><button btype="1" class="yes">Yes</button><button btype="2">No</button></div>'},addRecordForForm:function(data,formName){var recListDiv='<div class="ZPNdata"><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><h5 id="zp_views_nodata">'+ZPI18N.getString("zp.nofaqs")+"</h5></div>";return data.length>0&&(recListDiv="",$.each(data,function(i,Obj){var recObj='<div class="zp_Lst" id="formRow"><div><div class="zp_Ldtl "><div class="zp_Tdts"><h3>'+Obj.formLinkName+"</h3></div></div></div></div>";recListDiv+=recObj}),recListDiv='<div class="zp_cAZfaqHd">'+formName+"</div>"+recListDiv),recListDiv},openAddRec:function(obj){var params={formId:obj.formId,formMode:"ADD"};ZPForm.load(params,!1,!0)},addInweb:function(resObj){var resDiv="Opening...";switch(resObj.module){case"cases":HRCaseBand.serviceView();break;case"leave":Leave.add();break;case"form":resDiv=ziaPeople.addRecordForForm(resObj.data,resObj.formName)}return resDiv},constructReport:function(resObj){var clr=["orng","grn","ylw","blu","gylw","sblu"];switch(resObj.action){case"holiday_report":var tr="";return $.each(resObj.data,function(i,faqObj){tr+='<div class="zp_cAinCnt"><div class="rndCr '+clr[i%clr.length]+' "><i>'+CommonTemplates.getAltText(ZPeople.decodeTxt(ZPeople.escapeHtml(faqObj.name)))+'</i></div><div class="mnCdr"><span>'+ZPeople.escapeHtml(faqObj.name)+"</span><em>"+faqObj.from+" - "+faqObj.to+"</em></div></div>"}),'<div id="parentChatDiv" class="zp_cAZfaqHd"><p class="ttl">Holiday Report</p>'+tr+"</div>";case"leave_report":tr="";return $.each(resObj.data,function(i,faqObj){2!=faqObj.type&&(tr+='<div class="zp_cAinCnt"><div class="rndBdr '+clr[i%clr.length]+'"><i>'+faqObj.taken+'</i></div><div class="mnCdr"><span>'+ZPeople.escapeHtml(faqObj.name)+"</span><em>Available "+faqObj.available+" Day(s)</em></div></div>")}),'<div id="parentChatDiv" class="zp_cAZfaqHd"><p class="ttl">Leave Report</p>'+tr+"</div>"}}},ZPACommon={CHECKLIST_MODE:"checklist",TASK_MODE:"task",getUrlMode:function(){var url=this.getUrl(),mode="";if(-1!==url.indexOf("/task/list")||-1!==url.indexOf("/notification")||-1!==url.indexOf("/delegation/list")||-1!==url.indexOf("/user/tasks"))mode="",-1!==url.indexOf("#hrcase/settings/notification")?mode=HRCaseWorkFlow.MODE:-1===url.indexOf("#hrcase/settings/mail/notification")&&-1===url.indexOf("#officereadiness/settings")||(mode=HRCase.MAIL_MODE);else if(-1!==url.indexOf("#officereadiness/settings"))mode=HRCase.MAIL_MODE;else if(-1!==url.indexOf("/list")&&"#announcements/list"!=url&&"#files/hrdocuments/listview"!=url&&"#files/companyfile/listview"!=url&&"#files/companyfile/catview"!=url&&"#files/companyfile/view"!=url)mode=NewWorkFlow.MODE;else if(-1!==url.indexOf("mailalert"))mode=Mailalerts.MODE;else if(-1!==url.indexOf("/fieldupdate"))mode=Fieldupdate.MODE;else if(-1!==url.indexOf("/checklist")||-1!==url.indexOf("/task")){mode=-1!==url.indexOf("/checklist/tasks")?ZPACommon.TASK_MODE:ZPACommon.CHECKLIST_MODE;var sTab=$("#"+Layout.Page.pageId).find("[sTabPDiv=chklist]").find(".active").attr("sTabName");-1!==(url=ZPUtil.Validation.isEmpty(sTab)?url:sTab).indexOf("checklist/map")?mode=ZPACommon.CHECKLIST_MODE:-1!==url.indexOf("checklist/tasks")&&(mode=ZPACommon.TASK_MODE)}else if(-1!==url.indexOf("/webhook")){mode=Webhook.MODE;sTab=$("#"+Layout.Page.pageId).find("[sTabPDiv=wbkSubTabs]").find(".active").attr("sTabName");-1!==(url=ZPUtil.Validation.isEmpty(sTab)?url:sTab).indexOf("webhook/failurewebhook")?mode=Webhook.FAILUREMODE:-1!==url.indexOf("webhook/successwebhook")&&(mode=Webhook.SUCCESSMODE)}else-1!==url.indexOf("/customfunction")?mode=NewCustomFunction.MODE:-1!==url.indexOf("formslayout/formedit")?mode="formBuilder":-1!==url.indexOf("formslayout/customaction")?mode=CustomAction.MODE:-1!==url.indexOf("/blueprint")?mode=void 0!=Blueprint.currentMode&&""!=Blueprint.currentMode?Blueprint.currentMode:Blueprint.MODE:-1!==url.indexOf("timetracker/settings/")?mode="timetracker":-1!==url.indexOf("attendance/settings/regularization")||-1!==url.indexOf("attendance/settings/shiftmapping")||-1!==url.indexOf("attendance/settings/onduty")||-1!==url.indexOf("attendance/settings/permissionsapp")?mode="attendance":-1!==url.indexOf("admin/dashboard")?mode="dashboardSet":-1!==url.indexOf("esign")?mode=esign.MODE:-1!==url.indexOf("onboarding")?mode=ZPOnboarding.MODE:-1!==url.indexOf("postmessage")&&(mode=PostMessage.MODE);return mode},getUrl:function(){Layout.Page.hash;return Layout.Page.hash.replace("#admin/automation/workflow","").split("-")[0]},viewRecord:function(formId,pkId,tableName,needUrlTrack){tableName=void 0===tableName||""===tableName?ZPUtil.Form_Link_Names.getFormLinkName(formId,!0):tableName;var params={formId:formId,recordId:pkId,isEmbed:!0,formMode:"VIEW",editCallback:ZPACommon.editRecord};void 0!==needUrlTrack&&needUrlTrack&&-1===Layout.Page.hash.indexOf("task/mytasks")||(params.disableUrlTrack=!0),"P_EmployeeLeave"===tableName||"leave"===tableName?Leave.viewRec(formId,pkId,params):"P_Compensatory"===tableName?Leave.Compensatory.RecordView.get(pkId):"P_LeaveGrant"===tableName?ZPLTGrant.Record.view(pkId):"P_HR_Case"===tableName?HRCase.DetailedView.newviewCaseDetails(pkId):(-1!==Layout.Page.hash.indexOf("home/dashboard/approvals")&&(params.callback=ZPApprovals.closePopCallback),ZPForm.load(params))},editRecord:function(){ZPForm.load({formId:ZPForm.CURRFORM_PARAM.formId,recordId:ZPForm.CURRFORM_PARAM.recordId,isEmbed:!0,formMode:"EDIT",disableUrlTrack:!0})},getMode:function(){var parentPage=$parentPageId(),mode="";if($.each(parentPage.find("[type=mainPage]"),function(i,mainDivs){-1!==$(mainDivs).attr("class").indexOf("default")||(mode=$(mainDivs).parent().attr("id"))}),mode=""===mode||void 0===mode?this.getUrlMode():mode,-1!==Layout.Page.hash.indexOf("hrcase/settings/sla"))mode=SLA.MODE;else if(-1!==Layout.Page.hash.indexOf("#settings/service/performance/reviewsetting"))mode=paReviewReminder.mode;else if(-1!==Layout.Page.hash.indexOf("#announcements/list")||-1!==Layout.Page.hash.indexOf("#home/feeds/announcements")||-1!==Layout.Page.hash.indexOf("#announcements/list/new"))mode=announcementMailTemplate.mode;else if(""===mode){var formSelectObj=parentPage.find("[name=formSelect]");mode=formSelectObj.attr("mode");void 0!==formSelectObj&&0===formSelectObj.length&&(mode=parentPage.find("#editmode").attr("mode"))}return mode},showEmptyListPage:function(mode,dispMessage){var pageDiv=$("#"+AutomationCommon.getCurrentPageId(mode)),emptyPageMsg="",scrollDiv="div.ZPTscrlcont";0!==pageDiv.find("div.zp_center").length&&(scrollDiv="div.zp_center");var placeToAppend=pageDiv.find(scrollDiv).html("");"pageloading"==mode?emptyPageMsg=ZPeople.LOADING_HTML:(emptyPageMsg='<div class="ZPTscrlcont" id="emptyListPage"><div class="P20 text-center"><div class="row"><div class="dvNomsg"><div class="PAdms"></div>',emptyPageMsg+='<p class="PT20 S15">'+dispMessage+"</p></div></div></div></div>"),placeToAppend.append(emptyPageMsg)},hideSlideBodyContent:function(){$pageId().find("#atmn_page_loading").addClass("ctshow")},showSlideBodyContent:function(){$pageId().find("#atmn_page_loading").removeClass("ctshow")},getFormList:function(mode,isService){var originalMode=mode,param={method:"getFormList",mode:mode,conreqcsr:csrfToken};Layout.CustomizedUrl.isService()&&void 0==isService&&(param.serviceName=Layout.CustomizedUrl.getServiceName(),mode+="_"+param.serviceName,void 0!=originalMode&&originalMode==ApprovalProcess.MODE&&void 0!==ZPACommon[originalMode+"_formList"]&&""!==ZPACommon[originalMode+"_formList"]&&(ZPACommon[mode+"_formList"]=ZPACommon[originalMode+"_formList"]));var getFormsListFromCache=ZPACommon[mode+"_formList"];void 0===getFormsListFromCache||""===getFormsListFromCache?$.ajax({url:"/formlist.zp",type:"POST",data:param,async:!1,success:function(data){Automation.formList=data,ZPACommon[mode+"_formList"]=Automation.formList}}):Automation.formList=getFormsListFromCache},constructCmtRw:function(cmtData,appndContainer,jsonObj){$("#"+Layout.Page.pageId);cmtData.actOwner=ZPeople.getUserDetailsById(erecno),cmtData.totalComments>3&&(cmtData.viewallcomments=ZPI18N.getString("zp.viewallcomments",[cmtData.totalComments]),cmtData.showMoreCallback=jsonObj.calback),cmtData.subBtnName=jsonObj.subBtnName;var bcontainer=ZPFeeds.Construction.bottomContainerConstruction(cmtData);$(appndContainer).append(bcontainer),(void 0===cmtData||void 0!==cmtData.comments&&0==cmtData.comments.length)&&$(appndContainer).find("#bottomcont").append(ZPFeeds.Construction.constructTextArea(!0,cmtData)),ZPFeeds.Like.iterateLikedUsers(cmtData.likedUsers)},setBasePage:function(isFrom){void 0!==isFrom?$("#"+AutomationCommon.getCurrentPageId()).find("[automationpages]:visible").attr(isFrom,!0):$("#"+AutomationCommon.getCurrentPageId()).find("[automationpages]:visible").removeAttr("fromChecklist")},isFromChecklistPage:function(){return void 0!==$("#"+AutomationCommon.getCurrentPageId()).find("[automationpages]:visible").attr("fromChecklist")}},ADMIN_VIEW="adminView";ZPServices.View={multiOrgDiv:'<div class="pp_dd" style="top: 258px; left: 526px; min-width: 148px;"><ul></ul></div>',loadDiv:'<div class="ctcell"> <div class="loader-inner line-scale"><div></div><div></div><div></div><div></div><div></div></div> </div>',closeIcnDiv:'<div class="pp-cls"></div>',assStatus:1,UnavailStatus:0,UnassSingleStatus:2,UnassMultipleStatus:3,createFrshStatus:4,ConflictStatus:5,notAddedServicetoUser:6,PEOPLEPLUSSERVICE_SERVICEUNAVAILBLEFORDADMIN:-1,PEOPLEPLUSSERVICE_SERVICENOTADDEDBYADMIN:-2,paramNames:[],paramVals:[],error:null,PeopleAccountAssaigned:!1,ResultData:null,CountryCode:"",constructHeaderButton:function(hasReference,isAgent,hasFaqList,askUsBtn,isNeedAddRec){$("#"+Layout.Page.pageId);var url=Layout.Page.hash,buttonTag="",buttonhtml="";return hasReference&&(buttonTag+='<button  id="relatedDoc">'+ZPI18N.getString("zp.knowledgebase")+"</button>",buttonhtml+='<button  class="zpthm" id="relatedDoc">'+ZPI18N.getString("zp.knowledgebase")+"</button>"),askUsBtn&&(buttonTag+='<button  onclick="ZPServices.View.showAskUs()">'+ZPI18N.getString("zp.createcase")+"</button>"),buttonhtml+='<button  class="zpthm" onclick="ZPServices.View.showAskUs()">'+ZPI18N.getString("zp.askaquestion")+"</button>",hasFaqList&&(buttonTag+='<button  onclick="ZPServices.View.faqList()">'+ZPI18N.getString("zp.faq")+"</button>"),-1!==url.indexOf("/dashboard")?html='<div class="zp_btn">'+buttonhtml+"</div>":html='<div class="zp_btn">'+buttonTag+"</div>"},showAskUs:function(){$("#"+Layout.Page.pageId);var url=Layout.Page.hash,categoryId=$("#userServiceView").attr("categoryid");categoryId=-1!==url.indexOf("/dashboard")?$("#userServiceView").attr("categoryid"):$("#gotoservicebutton").attr("categoryid");var addcasemode=isadmin?HRCase.AgentAddMode:ZPeople.SUB_USERLIST.length>1?HRCase.ManagerAddMode:"";HRCase.AddCase.addCasePage(addcasemode,categoryId)},serviceViewPage:function(){var pageId=$("#"+Layout.Page.pageId),url=Layout.Page.hashDtl.hash,serviceName=Layout.Page.hash.split("/")[0].substring(1);if(serviceName!=Compensation.CONSTANTS.SERVICENAME)if(Layout.UrlConf.isServiceMode||Layout.UrlConf.isSystemService){var categoryprm={serviceName:serviceName,conreqcsr:csrfToken,mode:"serviceView"};$.ajax({url:"/fetchServiceDetails.zp",type:"POST",data:categoryprm,success:function(data){pageId.find("#serviceView").removeClass("zp_dyn"),"failure"!==data.status&&-1!==url.indexOf(serviceName+"/generalsettings")&&ZPServices.View.adminViewPage(data)}})}else Layout.Page.container.html('<div><div class="profileLft zc-componentBg mt7"><div class="pad20" id="errorDiv"><div class="P20 text-center"><div class="row"><div class="dvNomsg"><div class="PAdms"></div><p class="PT20 S15">'+ZPI18N.getString("zp.securityaccesserr")+"</p></div></div></div></div></div></div>");else window.location="#salarydetails/salarysettings/generalsettings"},getTabId:function(){var id=null,arr=Layout.Page.currentmode.split("/");return null!=ZPServices.SERVICE_JSON&&$.each(ZPServices.SERVICE_JSON,function(ind,val){if(ZPServices.SERVICE_JSON[ind].tabName.toLowerCase()==arr[0].toLowerCase())return id=ZPServices.SERVICE_JSON[ind].id,!1}),id},isServiceAdmin:function(){var serviceAdmin=serviceadminperm,id=ZPServices.View.getTabId();return!(null==serviceAdmin||void 0==id||!serviceAdmin.hasOwnProperty(id))},adminViewPage:function(data){if(isadmin){var pageId=$("#"+Layout.Page.pageId);if(pageId.addClass("services"),pageId.find("#edSrv").off("click").on("click",function(){ZPServices.Edit.editService(data)}),ZPServices.View.basicTabDetails(data),isadmin?(pageId.find("#tgForm").removeClass("zp_dyn"),pageId.find("#tgForm").off("click").on("click",function(){ZPServices.MoveForms.getFormsSlider(ZPServices.SERVICE_JSON,data.id)})):pageId.find("#tgForm").addClass("zp_dyn"),!isPlatformOrg){var formsList=data.formIds;pageId.find("#sfrmList").empty();var addFrm=ZPServices.View.addFormHtml();addfrm=addFrm.replace("$SERVICEID$",data.id);let serviceObj=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",data.tabName);data.isExtensionTab||data.tabName==Compensation.CONSTANTS.TAB_NAME||!serviceObj||serviceObj.isFormAddMoveDisable||pageId.find("#sfrmList").append(addfrm),ZPServices.View.viewFormList(formsList,!1),data.hasOwnProperty("FAQ_LIST")&&pageId.find("#FaqView").empty().append(FAQ.faqList(data.FAQ_LIST,!1,!1,"adminView"))}pageId.find("#serviceView").removeClass("zp_dyn"),pageId.find("#userServiceView").addClass("zp_dyn")}else Layout.Page.container.html('<div><div class="profileLft zc-componentBg mt7"><div class="pad20" id="errorDiv"><div class="P20 text-center"><div class="row"><div class="dvNomsg"><div class="PAdms"></div><p class="PT20 S15">'+ZPI18N.getString("zp.securityaccesserr")+"</p></div></div></div></div></div></div>")},formSettingsList:function(pcId,isActive,isDel,isApprovalAllowed,label,isExtensionForm){var sObj=[];return isActive&&(ZPeople.isDeptDesgRestricted&&("P_Department"==label||"P_Designation"==label)||isExtensionForm||sObj.push({id:"fCus",value:ZPI18N.getString("zp.customize")}),pcId!=ZPeople.EMP_HEALTH_FORMID&&(sObj.push({id:"fPer",value:ZPI18N.getString("zp.permissions")}),isApprovalAllowed&&sObj.push({id:"fApp",value:ZPI18N.getString("zp.approvals")})),sObj.push({id:"fAut",value:ZPI18N.getString("zp.automation")})),isDel&&!isExtensionForm&&sObj.push({id:"delForm",value:ZPI18N.getString("zp.deleteform")}),sObj},settingCallBack:function(dataObj,pcId){switch($(dataObj).attr("id")){case"fCus":window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl(ZPAppConstants.customize,pcId);break;case"fPer":window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl(ZPAppConstants.permissions,pcId);break;case"fApp":window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl(ZPAppConstants.approvals,pcId);break;case"fAut":window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl(ZPAppConstants.automation,pcId);break;case"delForm":ZPeople.BSModal.delete(function(){ZPServices.Configure.deleteForm(pcId)},"",ZPI18N.getString("zp.formdelconfirm"))}},viewFormList:function(formsList,isAddForm){var pageId=$("#"+Layout.Page.pageId);if(void 0!=formsList&&formsList.length>0){isAddForm||pageId.find("#sfrmList").find("[formId]").remove(),$.each(formsList,function(i,v){var formsHtml=ZPServices.View.formLstHtml(),alt=ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(v.dispName)));formsHtml=(formsHtml=(formsHtml=(formsHtml=formsHtml.replace("$PCID$",v.pcId)).replace("$FORMALTTEXT$",alt)).replace("$FORMNAME$",v.dispName)).replace("$FORMCOLOR$",ZPServices.View.getFormBgColor(alt)),pageId.find("#sfrmList").append(formsHtml);var formObj=pageId.find("#sfrmList").find("[formId = "+v.pcId+"]");if(formObj.find("#enbDisForm").attr("checked",v.isActive),v.isActive?formObj.removeClass("zp_dAct"):formObj.addClass("zp_dAct"),v.isExtensionForm&&formObj.find("#enbDisForm").parent().hide(),v.isActive&&"VaccinationStatus"!=v.label){var defAction=ZPAppConstants.customize;(ZPeople.isDeptDesgRestricted&&("P_Department"==v.label||"P_Designation"==v.label)||v.isExtensionForm)&&(defAction=ZPAppConstants.permissions),formObj.off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl(defAction,v.pcId)})}var settingsList=ZPServices.View.formSettingsList(v.pcId,v.isActive,v.isCustom,v.isApprovalAllowed,v.label,v.isExtensionForm);"VaccinationStatus"==v.label&&(settingsList=[]),settingsList.length>0?formObj.find("#formSett").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),$(this).addClass("zp_shw"),$(this).zparrowmenu({id:"fSett",width:155,position:ZPArrow.RIGHT_TOP,data:settingsList,callbackonclose:function(sourceObj){$(sourceObj).removeClass("zp_shw")},callback:function(dataObj,sourceObj){$(sourceObj).removeClass("zp_shw"),ZPServices.View.settingCallBack(dataObj,v.pcId)}})}):formObj.find("#formSett").remove(),v.isEnableDis?formObj.find("#enbDisForm").closest("label").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault();var obj=$(this),isActive=$(obj).find("#enbDisForm").is(":checked");isActive?ZPeople.BSModal.confirm(function(){ZPServices.Configure.enabledisableForm(v,isActive,obj)},"",ZPI18N.getString("zp.disableform")):ZPServices.Configure.enabledisableForm(v,isActive,obj)}):formObj.find(".zp_SFswtch").remove(),1})}},basicTabDetails:function(data){var pageId=$("#"+Layout.Page.pageId);pageId.find("#serviceView").attr("categoryId",data.categoryId),pageId.find("#cgeName").html(data.dispName);var desc=""!=data.desc.trim()?data.desc:CommonTemplates.noDataSVG("cgeDesc",!1,ZPI18N.getString("zp.emptydesc"),!1);pageId.find("#cgeDesc").html(desc);var iconClass=Icons.getIconClass(data.icon).iconClass;if(pageId.find("#srvicon").attr("class","zp_Si "+iconClass),data.hasOwnProperty("enable_hrcase")&&data.enable_hrcase&&!$.isEmptyObject(ZPTabs.getSelectedTab("hrcase"))){var html='<div class="zp_sttl"><span class="nobdr">'+ZPI18N.getString("zp.agent")+"</span></div><div>"+HRCategory.View.cloneAgentRow(data.agentDetails,!0)+"</div>";pageId.find("#enHRcase").html(html)}else pageId.find("#enHRcase").html("");data.hasOwnProperty("assoContents")?pageId.find("#docuList").html(HRCategory.View.cloneContentRow(data.assoContents,data.categoryId)):pageId.find("#docuList").html("")},addFormHtml:function(){return'<div onclick="ZPServices.Configure.addForm(\'$SERVICEID$\');" class="zp_svc SC1"><span><div class="zp_SFOpts"></div><label class="zp_serIcn"><i class="zp_Si zp_app0"></i></label><h3>'+ZPI18N.getString("zp.addnewform")+"</h3></span></div>"},formLstHtml:function(){return'<div formId="$PCID$" class="zp_svc"><span><div class="zp_SFOpts"><label class="zp_SFswtch"><input id="enbDisForm" class="cmn-toggle-small cmn-toggle-round-small" type="checkbox"><span></span></label><i id="formSett" class="IC-setting" title='+ZPI18N.getString("zp.more")+"></i></div>"+'<label class="zp_serIcn $FORMCOLOR$">$FORMALTTEXT$</label><h3>$FORMNAME$</h3></span></div>'},faqList:function(){var pageId=$("#"+Layout.Page.pageId),param={conreqcsr:csrfToken,method:"faqList",index:1,categoryId:pageId.find("#gotoservicebutton").attr("categoryid")};ZPeople.Request.send("/faqList.zp",param,function(data){$("#sliderPopup").length<=0&&$("body").append(CommonTemplates.sliderPop()),$("#sliderPopup").addClass("services zp_shw"),$("#sliderName").append(ZPI18N.getString("zp.faqAbbre")),$("#sliderContent").empty().append(FAQ.faqList(data.FAQ_LIST,!1,!0)),$("[name=closeSlider]").off("click").on("click",function(){CommonTemplates.closeSlider()})})},getRelatedDoc:function(categoryId){$("#"+Layout.Page.pageId);var param={mode:"relatedDoc",conreqcsr:csrfToken,categoryId:categoryId};param.serviceName=CustomServiceResources.SERVICE_NAME,ZPeople.Request.send("/services/references/list",param,function(data){ZPServices.View.showRelatedDoc(data)})},showRelatedDoc:function(data){$("#"+Layout.Page.pageId);$("#sliderPopup").length<=0&&$("body").append(CommonTemplates.sliderPop()),$("#sliderPopup").addClass("services zp_shw"),$("#sliderName").append(ZPI18N.getString("zp.knowledgebase")),$("#sliderContent").empty().append(HRCategory.View.cloneContentRow(data.FilesList,data.categoryId,!0)),$("[name=closeSlider]").off("click").on("click",function(){CommonTemplates.closeSlider()})},getFormBgColor:function(text){for(var len=text.length,code=0,i=0;i<len;i++)code+=text.charCodeAt(i);return"GC"+(code=code%4+1)}},ZPServices.SELECTED_SERVICE={},ZPServices.SERVICE_LIST_DIV='<div class="zp_svc $SERVICECOLOR$" tab="$SERVICELBL$"><span><i id="info" class="IC-info"></i><label class="zp_serIcn"><i class="$SERVICEICON$"></i></label><h3 title="$SERVICENAME$">$SERVICENAME$</h3></span></div>',ZPServices.SERVICE_CLOSE_HTML='<a class="zp_svcls" onclick="ZPServices.resetServicePage(event)"><i class="IC-cls" title='+ZPI18N.getString("zp.close")+"></i></a>",ZPServices.SERVICE_DESC_DIV='<div class="zp_sttl"><span>'+ZPI18N.getString("zp.description")+'</span></div><div class="zp_txt"><p>$SERVICEDESC$</p></div>',ZPServices.SERVICE_GOTO_BTN='<div class="zp_btn"><button class="zpthm" id="gotoservicebutton" onclick="ZPServices.gotoService(this)" categoryId="$CATEGORYID$">$GOTO$</button></div>',ZPServices.SERVICE_HEADER='<div class="zp_sR" id="hrServiceHeader"><div class="zp_sLIn"><h2>'+ZPI18N.getString("zp.allservices")+"</h2></div>",ZPServices.SERVICE_HEADER+='<div class="zp_sRIn"><div class="zp_sRBx"><i class="IC-lens"></i><input placeholder="'+ZPI18N.getString("zp.search")+'" onkeyup="ZPServices.search(this)" type="text"></div>$SETTINGSDIV$</div></div>',ZPServices.PEOPLE_PLUS_SERVICE={recruit:{dispName:"ATS",iconClass:"zp_app2",iconColor:"SC2",desc:ZPI18N.getString("zp.recruitdesc")},connect:{dispName:"Connect",iconClass:"zp_app3",iconColor:"SC3",desc:ZPI18N.getString("zp.connectdesc")},chat:{dispName:"Cliq",iconClass:"zp_app4",iconColor:"SC2",desc:ZPI18N.getString("zp.cliqdesc")},expense:{dispName:"Expense Tracker",iconClass:"zp_app6",iconColor:"SC1",desc:ZPI18N.getString("zp.expensedesc")},payroll:{dispName:"Payroll",iconClass:"zp_app56",iconColor:"SC1",desc:ZPI18N.getString("zp.payrolldesc")},sign:{dispName:"Sign",iconClass:"zp_app7",iconColor:"SC4",desc:ZPI18N.getString("zp.signdesc")},vault:{dispName:"Vault",iconClass:"zp_app49",iconColor:"SC2",desc:ZPI18N.getString("zp.vaultdesc")}},ZPServices.SERVICE_NODATA='<div class="ZPNdata" id="service_nodata"> <i class="CR-nodata"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i> <h5 id="zp_views_nodata">'+ZPI18N.getString("zp.noservice")+"</h5> </div>",ZPServices.constructServicePage=function(){var serviceDv=$("#"+Layout.Page.pageId).find("#serviceMainDv");if(ZPServices.SERVICE_JSON.length>0){serviceDv.find("[name=hrService]").length<1&&serviceDv.append('<div class="zp_sRcnt" name="hrService"></div>');var mainDv=serviceDv.find("[name=hrService]");Layout.isPeoplePlus?serviceDv.find("[name=peopleService]").siblings().remove():(mainDv.empty(),mainDv.siblings(".ZPNdata").remove()),ZPServices.SELECTED_SERVICE={};var settingsDv="";if($.each(ZPServices.SERVICE_JSON,function(index,service){if(void 0!=service.tabName&&service.isActive){var serviceDiv=ZPServices.serviceListRow(service);mainDv.append(serviceDiv),mainDv.find('[tab="'+service.tabName+'"] span').click(function(){ZPServices.SELECTED_SERVICE={},ZPServices.gotoService(this)});var systemService=["organization","timetracker","leavetracker","attendance","files","performance","announcements","lms","hrcase","officereadiness","employeeengagement",Compensation.CONSTANTS.TAB_NAME.toLowerCase()];ZPUtil.checkIsExistInArray(systemService,service.tabName.toLowerCase())?(mainDv.find('[tab="'+service.tabName+'"] span #info').remove(),service.tabName==Compensation.CONSTANTS.TAB_NAME&&mainDv.find('[tab="'+service.tabName+'"] span').attr("tabName",service.tabName)):mainDv.find('[tab="'+service.tabName+'"] span #info').click(function(event){ZPServices.showServiceDtl(this,event)})}}),isadmin){settingsDv='<a href="#admin/formslayout/tabs"><span data-toggle="tooltip" data-placement="bottom" data-original-title="'+ZPI18N.getString("zp.settings")+'"><i class="IC-setting zp_rB"></i></span></a>';var addServiceDV=ZPServices.serviceListRow({dispName:ZPI18N.getString("zp.newservice"),tabName:"",icon:"add"});mainDv.append(addServiceDV),mainDv.find('[tab=""] span').attr("onclick","ZPServices.Configure.addNewService()"),mainDv.find('[tab=""]').addClass("addService"),$("#"+Layout.Page.pageId).find("#serviceMainDv").find(".addService").find(".IC-info").remove(),$("#"+Layout.Page.pageId).find("#serviceMainDv").find(".addService").find(".zp_serIcn").addClass("GC1")}serviceDv.find("#hrServiceHeader").length<1?serviceDv.prepend(ZPServices.SERVICE_HEADER.replace("$SETTINGSDIV$",settingsDv)):serviceDv.find("#hrServiceHeader input").val(""),mainDv.find(".zp_sRBx .IC-lens").on("click",function(){$(this).siblings("input").trigger("focus")})}if(Layout.isPeoplePlus)if(serviceDv.find("[name=peopleService]").length<1){$(".zp_clist").prepend(ZPeople.LOADING_HTML),Layout.Page.container.find("#serviceMainDv").hide(),ZPServices.validateCompanyDetails();mainDv.prepend('<div class="zp_sRcnt zp_pPls zp_svc" name="peopleService" style="width:auto;margin-right:0;margin-bottom: 0;height: auto;max-height: 405px;"></div>');var peopleDv=serviceDv.find("[name=peopleService]");$.each(ZPServices.PEOPLE_PLUS_SERVICE,function(tabName,pplService){pplService.tabName=tabName,peopleDv.append(ZPServices.serviceListRow(pplService,!0)),peopleDv.find("[tab='"+tabName+"']").attr("id",tabName+"_id")}),peopleDv.find("span #info").click(function(event){ZPServices.showServiceDtl(this,event)}),peopleDv.find("span").click(function(){ZPServices.gotoPeopleService(this)})}else ZPServices.getPPServiceStatusCallback(),Layout.Page.container.find("#service_nodata").remove()},ZPServices.addSampleAndRedirect=function(button){var params={issampledatarequired:"addsampledata"===button.id};ZPeople.Request.send("/onboarding/sample/runSampleDataScheduler",params,function(response){var url=window.location.protocol+"//"+window.location.host+"/"+ZPeople.PORTAL_NAME+"/zp"+window.location.hash;params.issampledatarequired&&response.hasOwnProperty("message")?ZPeople.confirm(null,"",response.message,function(){url==window.location.href?window.location.reload():window.location.href=url},!0,!0,ZPI18N.getString("zp.ok")):url!=window.location.href&&(window.location.href=url)}),ZPeople.isSampleDataRequestNotRaised=!1,$("#sampleDiv,.modal-backdrop").remove()},ZPServices.appendSampleDataPopUp=function(){if(0==$("#sampleDiv").length){$("body").removeClass("topZ");var sampleDataPopUp='<div class="tdAcc modalShdw" id="sampleDiv"><span class="modalShdwInner"><em></em></span>';sampleDataPopUp+='<div style="dtable"><div class="lft"><img src="'+ZPeople.getResourceURL(hrImageUrl+"sampleData.png")+'"></div>',sampleDataPopUp+='<div class="rht">',sampleDataPopUp+='<p class="bld">'+ZPI18N.getString("zp.sampledataheader")+"</p>",sampleDataPopUp+="<p>"+ZPI18N.getString("zp.sampledatabody")+"</p>",sampleDataPopUp+='<span class="tdAccBtn" id="dataAccount">',sampleDataPopUp+='<a id="addsampledata" onclick="ZPServices.addSampleAndRedirect(this)">'+ZPI18N.getString("zp.sampledataaccept")+"</a>",sampleDataPopUp+='</span><span class="tdAccBtn">',sampleDataPopUp+='<a id="dontaddsmapledata" onclick="ZPServices.addSampleAndRedirect(this)" class="link">'+ZPI18N.getString("zp.sampledatareject")+"</a>",sampleDataPopUp+='</span></div></div><span class="modalShdwInner flip"><em></em></span></div><div class="modal-backdrop"></div>',$("body").append(sampleDataPopUp),$("#sampleDiv").addClass("in")}};var urlDetails={};ZPServices.serviceList=["recruit","expense","connect","vault","payroll","chat","sign"],ZPServices.getPPServiceStatus=function(serviceName){var disObj=ZPSetupCommon.isEmpty(serviceName)?Layout.Page.container.find("div[name=peopleService]").find("[tab]"):Layout.Page.container.find("#"+serviceName+"_id"),params={action:"getDashBoard"},url="getDashBoard";if(!ZPSetupCommon.isEmpty(serviceName))if(ZPServices.PEOPLE_PLUS_SERVICE[serviceName].hasOwnProperty("status"))if(ZPServices.PEOPLE_PLUS_SERVICE[serviceName].status===ZPServices.View.UnassSingleStatus)params.action="mergeSelectedService",url="mergeSelectedService",params.servicename=serviceName,params.serviceId=ZPServices.PEOPLE_PLUS_SERVICE[serviceName].orgid,ZPServices.PEOPLE_PLUS_SERVICE.expense.tabName==serviceName?params.expenseOrPayrollAppStatus=ZPServices.PEOPLE_PLUS_SERVICE.payroll.status:ZPServices.PEOPLE_PLUS_SERVICE.payroll.tabName==serviceName&&(params.expenseOrPayrollAppStatus=ZPServices.PEOPLE_PLUS_SERVICE.expense.status),ZPServices.PEOPLE_PLUS_SERVICE[serviceName].hasOwnProperty("fromSoftLink")&&(params.fromSoftLink=ZPServices.PEOPLE_PLUS_SERVICE[serviceName].fromSoftLink);else if(ZPServices.PEOPLE_PLUS_SERVICE[serviceName].status===ZPServices.View.createFrshStatus)params.action="createService",url="createService",params.servicename=serviceName,ZPServices.PEOPLE_PLUS_SERVICE.expense.tabName==serviceName?params.expenseOrPayrollAppStatus=ZPServices.PEOPLE_PLUS_SERVICE.payroll.status:ZPServices.PEOPLE_PLUS_SERVICE.payroll.tabName==serviceName&&(params.expenseOrPayrollAppStatus=ZPServices.PEOPLE_PLUS_SERVICE.expense.status);else{if(ZPServices.PEOPLE_PLUS_SERVICE[serviceName].status===ZPServices.View.ConflictStatus&&("paid_account"==ZPServices.PEOPLE_PLUS_SERVICE[serviceName].conflict_type||"already_mapped_account"==ZPServices.PEOPLE_PLUS_SERVICE[serviceName].conflict_type||"non_admin_user"==ZPServices.PEOPLE_PLUS_SERVICE[serviceName].conflict_type)){if("paid_account"==ZPServices.PEOPLE_PLUS_SERVICE[serviceName].conflict_type){var additionalContent=ZPI18N.getString("zpp.upgradetopeopleplusplan");url=(url=$("#subscriptionLink").attr("href")).substr(0,paymentUrl.indexOf("people"))+serviceName}else if("non_admin_user"==ZPServices.PEOPLE_PLUS_SERVICE[serviceName].conflict_type&&void 0!=ZPServices.PEOPLE_PLUS_SERVICE[serviceName].admins)JSON.stringify(ZPServices.PEOPLE_PLUS_SERVICE[serviceName].admins);return void ZPServices.showStatusPopUp(serviceName,ZPServices.View.ConflictStatus,ZPServices.PEOPLE_PLUS_SERVICE[serviceName],additionalContent,url)}if(ZPServices.PEOPLE_PLUS_SERVICE[serviceName].status===ZPServices.View.UnassMultipleStatus)return void ZPServices.showMultiPortalPopUp(ZPServices.PEOPLE_PLUS_SERVICE[serviceName].eachServiceIter,serviceName)}else params.action="createService",url="createService",params.servicename=serviceName;disObj.find("#retry_mode").remove(),ZPeople.Request.send("/pplus/"+url,params,ZPServices.getPPServiceStatusCallback,serviceName)},ZPServices.mergePaidAccount=function(serviceName,serviceId){$("#upgradeSubsButton").val(ZPI18N.getString("zp.pleasewaitmsg")),$("#upgradeSubsButton").attr("disabled",!0);var params={action:"mergeSelectedService"};params.servicename=serviceName,params.serviceId=serviceId,params.conreqcsr=csrfToken,$.post("/pplus/mergeSelectedService",params,function(data){if("Success"==data.result){var paymentUrl=$("#subscriptionLink").attr("href");paymentUrl=paymentUrl.substr(0,paymentUrl.indexOf("people"))+serviceName,window.open(paymentUrl,"_blank"),ZPServices.removeStausDiv()}else{Layout.Page.container.find("#serviceStatusDiv").find("b").html(ZPI18N.getString("zpp.configurationfailure")),$("#upgradeSubsButton").remove()}})},ZPServices.getPPServiceStatusCallback=function(data,params,app_name){var serviceObj,baseDiv=$("div[name=peopleService]");$("#adminConsole").find("div").click(function(){window.open($(this).attr("href"),"_blank")});var isFromScheduler=!1;ZPSetupCommon.isEmpty(app_name)?2===Object.keys(data).length?(app_name=Object.keys(data)[1],isFromScheduler=!0,ZPServices.PEOPLE_PLUS_SERVICE.expense.tabName!=app_name&&ZPServices.PEOPLE_PLUS_SERVICE.expense.tabName!=app_name||$("div#loadingClassPopUp").length>0&&($("div#loadingClassPopUp").remove(),$("div#freezelayerid").remove()),serviceObj=Layout.Page.container.find("#"+app_name+"_id")):serviceObj=Layout.Page.container.find("div[name=peopleService]").find("div[tab]"):serviceObj=Layout.Page.container.find("#"+app_name+"_id");serviceObj.find(".icon-stat").remove(),serviceObj.removeClass("zp_svcDis"),$.each(ZPServices.serviceList,function(index,item){if(!ZPSetupCommon.isEmpty(app_name)&&app_name===item||ZPSetupCommon.isEmpty(app_name)){var eachServiceIter=data[item],status=ZPServices.View.notAddedServicetoUser;void 0!=eachServiceIter?status=eachServiceIter.Status:(status=data.status,eachServiceIter=data);baseDiv.find("#"+item+"_id");var isAlreadyCreated=!0;(!ZPSetupCommon.isEmpty(params)&&params.hasOwnProperty("action")&&"createService"===params.action||null==params)&&(isAlreadyCreated=!1),ZPSetupCommon.isEmpty(app_name)||isFromScheduler||ZPServices.showStatusPopUp(item,status,eachServiceIter),ZPServices.statusAppearance(status,eachServiceIter,item,isAlreadyCreated,app_name),index==ZPServices.serviceList.length-1&&(Layout.Page.container.find("#serviceMainDv").show(),$("#zp-contwrap-services-listing").find("#zp_page_loading").remove())}})},ZPServices.showMultiPortalPopUp=function(eachServiceIter,serviceName){var appName="Zoho Expense",appIcon="lst ze";"payroll"==serviceName?appName="Zoho Payroll":"recruit"==serviceName&&(appName="ATS",appIcon="lst zr");var comDiv='<div class="pp-popup" id="serviceStatusDiv"><a class="zp_svcls FR" onclick="ZPServices.removeStausDiv()"><i class="IC-cls" title="Close"></i></a>';comDiv+='<div class="zpwelmd_bx"><div class="infoPage"><h1>Choose an account to map with Zoho People Plus</h1><div class="zpwelmd_prdt"><div class="'+appIcon+'"><p>'+appName+'</p><select class="selectBox" id="expenseOrg">';for(var ids=Object.keys(eachServiceIter.Orgs),i=0;i<ids.length;i++)comDiv+='<option value="'+ids[i]+'">'+ids[i]+" - "+eachServiceIter.Orgs[ids[i]].display_name+"</option>";comDiv+='</select></div></div></div><div class="button"><input class="button" onclick="ZPServices.submitPortalData(\''+serviceName+'\')" value="Done" type="button"></div></div></div><div class="modal-backdrop fade in"></div>',Layout.Page.container.append(comDiv),Layout.Page.container.find("#expenseOrg").select2()},ZPServices.submitPortalData=function(serviceName){var serviceDiv=$("div[name=peopleService]").find("#"+serviceName+"_id"),expenseOrgId=$("#expenseOrg option:selected").val();if(null!=expenseOrgId&&""!=expenseOrgId&&ZPServices.PEOPLE_PLUS_SERVICE[serviceName].hasOwnProperty("Orgs")&&ZPServices.PEOPLE_PLUS_SERVICE[serviceName].Orgs.hasOwnProperty(expenseOrgId))if(ZPServices.PEOPLE_PLUS_SERVICE[serviceName].Orgs[expenseOrgId].hasOwnProperty("conflict_type")&&"non_admin_user"==ZPServices.PEOPLE_PLUS_SERVICE[serviceName].Orgs[expenseOrgId].conflict_type)ZPServices.PEOPLE_PLUS_SERVICE[serviceName].Orgs[expenseOrgId].hasOwnProperty("admins")&&(ZPServices.removeStausDiv(),ZPServices.PEOPLE_PLUS_SERVICE[serviceName].display_name=ZPServices.PEOPLE_PLUS_SERVICE[serviceName].Orgs[expenseOrgId].display_name,ZPServices.showStatusPopUp(serviceName,ZPServices.View.ConflictStatus,ZPServices.PEOPLE_PLUS_SERVICE[serviceName].Orgs[expenseOrgId]));else{var anotherfinanceSppStatus,item;ZPServices.removeStausDiv(),serviceDiv.find("#retry_mode").remove(),ZPServices.PEOPLE_PLUS_SERVICE.expense.tabName==serviceName?(anotherfinanceSppStatus=ZPServices.PEOPLE_PLUS_SERVICE.payroll.status,item=ZPServices.PEOPLE_PLUS_SERVICE.payroll.tabName):ZPServices.PEOPLE_PLUS_SERVICE.payroll.tabName==serviceName&&(anotherfinanceSppStatus=ZPServices.PEOPLE_PLUS_SERVICE.expense.status,item=ZPServices.PEOPLE_PLUS_SERVICE.expense.tabName);var params={action:"mergeSelectedService",conreqcsr:csrfToken,servicename:serviceName,serviceId:expenseOrgId,fromSoftLink:!1,expenseOrPayrollAppStatus:anotherfinanceSppStatus};$.ajax({type:"POST",async:!0,url:"/pplus/mergeSelectedService",data:params,success:function(data){if("Success"==data.result)(error={}).message=ZPI18N.getString("zp.configurationsucc"),ZPServices.showStatusPopUp(serviceName,ZPServices.View.assStatus,error),data.hasOwnProperty("url")&&(urlDetails.expense=data.url),Layout.Page.container.find("#"+serviceName+"_id .icon-stat").remove(),Layout.Page.container.find("#"+serviceName+"_id").removeClass("zp_svcDis"),setTimeout(function(){-1==ZPServices.PEOPLE_PLUS_SERVICE[item].status&&ZPServices.getPPServiceStatus()},8e3);else if(void 0!=data.result){(error={}).message=data.result,ZPServices.showStatusPopUp(serviceName,ZPServices.View.ConflictStatus,error)}else if("Failure"==data.result){var error;(error={}).message=ZPI18N.getString("zpp.configurationfailure"),ZPServices.showStatusPopUp(serviceName,ZPServices.View.ConflictStatus,error)}}})}},ZPServices.showStatusPopUp=function(item,status,eachServiceIter,additionalContent,url,isRed){if($("#confirmationPopup #textConfirmationPopupHeader").text(""),void 0!=additionalContent&&null!=additionalContent?($("#confirmationPopup #confirmConfirmationPopup").show(),$("#confirmationPopup #confirmConfirmationPopup").text(additionalContent),additionalContent==ZPI18N.getString("zpp.cancelonezohobutton")?$("#confirmationPopup #confirmConfirmationPopup").removeClass("btn-primary").addClass("btn-warning"):$("#confirmationPopup #confirmConfirmationPopup").removeClass("btn-warning").addClass("btn-primary"),$("#confirmationPopup #confirmConfirmationPopup").off().on("click",function(){window.open(url,"_blank")})):$("#confirmationPopup #confirmConfirmationPopup").hide(),status===ZPServices.View.assStatus)$("#confirmationPopup #textConfirmationPopupBody").text(ZPI18N.getString("zp.configurationsucc"));else{if(status===ZPServices.View.PEOPLEPLUSSERVICE_SERVICEUNAVAILBLEFORDADMIN||status===ZPServices.View.notAddedServicetoUser||status===ZPServices.View.PEOPLEPLUSSERVICE_SERVICENOTADDEDBYADMIN){var serviceDiv=$("div[name=peopleService]").find("#"+item+"_id");return void $(serviceDiv).hide()}if(status===ZPServices.View.UnavailStatus)$("#confirmationPopup #textConfirmationPopupBody").html("Coming soon");else if(status===ZPServices.View.createFrshStatus||status===ZPServices.View.ConflictStatus||status===ZPServices.View.UnassSingleStatus)if(eachServiceIter.hasOwnProperty("admins")){$("#confirmationPopup").addClass("ZPmdlnw"),$("#confirmationPopup #textConfirmationPopupHeader").hide();ZPI18N.getString("zpp.noperms");'<p class="dgry">'+ZPI18N.getString("zpp.nopermsMessage",[ZPServices.PEOPLE_PLUS_SERVICE[item].dispName,ZPServices.PEOPLE_PLUS_SERVICE[item].display_name])+"</p>",'<p class="PB20">'+ZPI18N.getString("zpp.selectadmin")+"</p><select id=selectAdmins_"+item+">";for(var jsonadminObj=eachServiceIter.admins[0],ids=Object.keys(eachServiceIter.admins[0]),i=0;i<ids.length;i++)'<option value="'+ids[i]+'">'+jsonadminObj[ids[i]]+"</option>";"</select></div></div>",$("#confirmationPopup").find("#selectAdmins_"+item).select2(),$("#confirmationPopup #confirmConfirmationPopup").show();additionalContent=ZPI18N.getString("zpp.requestaccess");$("#confirmationPopup #confirmConfirmationPopup").text(additionalContent),$("#confirmationPopup #confirmConfirmationPopup").off().on("click",function(){ZPServices.submitAdminRequest(item,eachServiceIter,this)})}else eachServiceIter.hasOwnProperty("message")?$("#confirmationPopup #confirmConfirmationPopup").text(additionalContent):$("#confirmationPopup #textConfirmationPopupBody").html(ZPI18N.getString("zpp.configurationfailure"))}$("#confirmationPopup #cancelConfirmationPopup").show(),$("#confirmationPopup #cancelConfirmationPopup").text(ZPI18N.getString("zp.close")),$("#confirmationPopup").modal("show")},ZPServices.submitAdminRequest=function(serviceName,eachServiceIter,getThis){$("div[name=peopleService]").find("#"+serviceName+"_id");var adminZUID=$("#selectAdmins_"+serviceName).find("option:selected").val();if(null!=adminZUID&&""!=adminZUID){ZPServices.removeStausDiv();var params={action:"mergeSelectedService",conreqcsr:csrfToken,servicename:serviceName,serviceId:eachServiceIter.zaaid,fromSoftLink:!0,adminZUID:adminZUID};$.ajax({type:"POST",async:!0,url:"/pplus/mergeSelectedService",data:params,success:function(data){if("Success"==data.result)(error={}).message=ZPI18N.getString("zp.copycust.sucmsg"),ZPServices.showStatusPopUp(serviceName,ZPServices.View.ConflictStatus,error),ZPServices.getPPServiceStatus();else if("Failure"==data.result){var error;(error={}).message=ZPI18N.getString("zp.serrviceconflict.commonerror",[Layout.ppSupportEmail]),ZPServices.showStatusPopUp(serviceName,ZPServices.View.ConflictStatus,error)}}})}},ZPServices.removeStausDiv=function(){Layout.Page.container.find("#serviceStatusDiv").remove(),Layout.Page.container.find(".modal-backdrop").remove()},ZPServices.validateCompanyDetails=function(){1==ZPeople.showCompanyInfoPopUp&&Layout.isPeoplePLusAdmin?(ZPServices.getPPServiceStatus(),ZPeople.Request.sendAsyncPost("/pplus/getCompanyDetails",{action:"getCompanyDetails"},ZPServices.showCompanyInfo)):ZPServices.getPPServiceStatus()},ZPServices.showCancelTrailPopUp=function(){ZPeople.showLogoutModal();var comDiv='<div class="pp-popup" id="cancelTrail"> <a class="zp_svcls FR" onclick="ZPServices.removeCancelTrailPopUp()"><i class="IC-cls" title="Close"></i></a><div id="CancelTrial"><div class="pp-popTop"></div><h1>Cancel Trial</h1><div class="cancelDiv in" role="dialog" id="PPTrailCancel" aria-hidden="false" data-keyboard="false" data-backdrop="static"><p>'+ZPI18N.getString("zpp.canceltrialmsg")+'</p><ul><li class="mand"><label>'+ZPI18N.getString("zpp.reasonforcancel")+'</label><span><input type="text" id="cancelreason" onfocus="ZPServices.removeErrorDivForCancel();"></span></li></ul><div class="button">  <input type="button" value="'+ZPI18N.getString("zpp.cancelpeopleplus")+'" class="cancel" id="canceltrail" onclick="ZPServices.cancelTrail()"></div></div></div></div><div class="modal-backdrop fade in"></div>';Layout.Page.container.find(".pp-popup").remove(),Layout.Page.container.append(comDiv)},ZPServices.removeCancelTrailPopUp=function(){Layout.Page.container.find("#cancelTrail").remove(),Layout.Page.container.find(".modal-backdrop").remove(),ZPServices.validateCompanyDetails()},ZPServices.removeErrorDivForCancel=function(){Layout.Page.container.find(".dverrormsg").remove(),Layout.Page.container.find(".etxt").remove()},ZPServices.cancelTrail=function(){var cancelreason=$("#cancelreason").val();$("#errorcancelreason").remove(),$("#errorgeneral").remove();var cancelreasonEmpty=ZPUtil.Validation.isEmpty(cancelreason);cancelreasonEmpty?cancelreasonEmpty&&!$("#cancelreason").siblings().hasClass("dverrormsg")&&$("#cancelreason").parent().parent().append("<div class='dverrormsg'  id='errorcancelreason'>"+ZPI18N.getString("zp.invcancelreason")+"</div>"):ZPeople.Request.send("/pplus/cancelTrial",{action:"cancelTrial",reason:cancelreason},ZPServices.TrailStatus)},ZPServices.TrailStatus=function(resultObj){if("success"==resultObj.status)window.location.reload();else{var errMsg=ZPI18N.getString("zp.invcase3");"invalid_password"==resultObj.code?(errMsg=ZPI18N.getString("zp.invalidPassword"),$("#pppwd").parent().parent().append("<div class='dverrormsg'  id='errorpwd'>"+errMsg+"</div>")):$("#CancelTrial").find("h1").after("<div class='etxt'  id='errorgeneral'>"+errMsg+"</div>")}},ZPServices.showCompanyInfo=function(obj){if(0===Layout.Page.container.find(".pp-popup").length){var comDiv='<div class="pp-popup compDtlPop" id="parentClassPopUp"><div id="infoPage"><div class="pp-popTop"></div><h1>'+ZPI18N.getString("zp.compinfo")+"<span>"+ZPI18N.getString("zp.compinfomsg")+"</span>";comDiv+='</h1><ul class="form single"><li class="mand"><label class="S14">'+ZPI18N.getString("zp.companyname")+'<em class="red">*</em></label> <span><input   id="companyname" type="text" autofocus onfocus="ZPServices.removeErrorDiv();"></span> </li>',comDiv+='<li class="mand"><label class="S14" >'+ZPI18N.getString("zp.phone")+'<em class="red">*</em></label><span><input id="mobile" type="text" onfocus="ZPServices.removeErrorDiv();"></span></li>',comDiv+='<li class="othInfoHdr">'+ZPI18N.getString("zp.otherinfo")+"</li>",comDiv+=' <li class="mb5"><label>'+ZPI18N.getString("zp.country")+'</label><div class="othInfo"><div class="select2-container sgnemail "> <abbr class="select2-search-choice-close" style="display:none;"></abbr><select id="country" onchange="ZPServices.GetStateFromCountryCode();" updatekey="basicOrgcountry" name="editable" style="display: block;"></select></div></li></li>',comDiv+=' <li class="mb5"><label>'+ZPI18N.getString("zp.state")+'</label><div class="othInfo"><div class="select2-container sgnemail "> <abbr class="select2-search-choice-close" style="display:none;"></abbr><select id="state" updatekey="basicOrgState" name="editable" style="display: block;"></select></div></li></li>',comDiv+='<li class="mb5"> <label>'+ZPI18N.getString("zp.timezone")+'</label><div class="othInfo"><div class="select2-container sgnemail "> <abbr class="select2-search-choice-close" style="display:none;"></abbr><select  id="timezone" updatekey="basicOrgTimezone" name="editable" style="display: block;"></select></div></li></li>',comDiv+='</ul><div class="button"><input type="button"  id="updBasicCmpInfo" value="'+ZPI18N.getString("zp.update")+'" onclick="ZPServices.UpdateBasicSetupInfo()"></div></div>',comDiv+='</div></form></div></div></div></div></div><div class="modal-backdrop fade in"></div>',Layout.Page.container.append(comDiv),obj.hasOwnProperty("companyName")&&Layout.Page.container.find("#parentClassPopUp #companyname").val(obj.companyName),obj.hasOwnProperty("mobile")&&Layout.Page.container.find("#parentClassPopUp #mobile").val(obj.mobile),void 0!=contextPath&&null!=contextPath&&"null"!=contextPath&&Layout.Page.container.find("#parentClassPopUp #portalname").val(contextPath),ZPServices.settimezoneDetails(obj)}},ZPServices.settimezoneDetails=function(dataObj){var timeZoneList="";$.each(dataObj.timeZoneList,function(index,timeMap){for(timeZoneList+="<optgroup label='"+timeMap.disp+"'>",i=0;i<timeMap.list.length;i++)timeZoneList+="<option value='"+timeMap.list[i].code+"'>"+timeMap.list[i].name+"&nbsp("+timeMap.list[i].code+")</option>";timeZoneList+="</optgroup>"}),Layout.Page.container.find("select[updateKey='basicOrgTimezone']").html(timeZoneList),dataObj.hasOwnProperty("accTimeZone")?Layout.Page.container.find("#timezone").val(dataObj.accTimeZone).select2():Layout.Page.container.find("#timezone").select2();var countryList="";$.each(dataObj.countryList,function(index,country){countryList+="<option value="+country.code+(0===index?' selected="selected">':">")+country.name+"</option>"}),Layout.Page.container.find("select[updateKey='basicOrgcountry']").html(countryList),dataObj.hasOwnProperty("stateList")?(Layout.Page.container.find("#country").val(dataObj.stateList.country_code).select2(),ZPServices.PopulateStatesinUI(dataObj)):Layout.Page.container.find("#country").select2()},ZPServices.GetStateFromCountryCode=function(){var countryCode=Layout.Page.container.find("#country option:selected").val(),params={conreqcsr:csrfToken,action:"getCompanyDetails",countryCode:countryCode};$.ajax({type:"POST",async:!1,url:"/pplus/getCompanyDetails",data:params,success:function(data){ZPServices.PopulateStatesinUI(data)}})},ZPServices.PopulateStatesinUI=function(dataObj){$.each(dataObj.stateList.data,function(index,state){"<option value="+state.state_code+(0===index?' selected="selected">':">")+state.state_name+"</option>"});Layout.Page.container.find("select[updateKey='basicOrgState']");Layout.Page.container.find("#state").select2()},ZPServices.UpdateBasicSetupInfo=function(){var companyName=Layout.Page.container.find("#companyname").val(),companyNameisEmpty=ZPUtil.Validation.isEmpty(companyName),mobileNum=Layout.Page.container.find("#mobile").val(),mobileIsEmpty=ZPUtil.Validation.isEmpty(mobileNum),country=Layout.Page.container.find("#country option:selected").text(),countryisEmpty=ZPUtil.Validation.isEmpty(country),timFmt=Layout.Page.container.find("#timezone").val(),timFmtisEmpty=ZPUtil.Validation.isEmpty(timFmt),GettingStartedJsonObject={},params={},state=Layout.Page.container.find("#state option:selected").text(),stateisEmpty=ZPUtil.Validation.isEmpty(state);companyNameisEmpty||timFmtisEmpty||mobileIsEmpty||countryisEmpty?(companyNameisEmpty&&Layout.Page.container.find("#companyname").parent().parent().addClass("mand err").append("<div class='dverrormsg'  id='errorcompanyName'>"+ZPI18N.getString("zp.organizationemptymsg")+"</div>"),timFmtisEmpty&&Layout.Page.container.find("#timezone").parent().parent().append("<div class='dverrormsg'  id='errortimezone'>"+ZPI18N.getString("zp.timezoneemptymsg")+"</div>"),countryisEmpty&&Layout.Page.container.find("#country").parent().parent().append("<div class='dverrormsg'  id='errorcountry'>"+ZPI18N.getString("zp.countryemptymsg")+"</div>"),mobileIsEmpty&&Layout.Page.container.find("#mobile").parent().parent().addClass("mand err").append("<div class='dverrormsg'  id='errormobile'>"+ZPI18N.getString("zp.mbleemptymsg")+"</div>"),stateisEmpty&&Layout.Page.container.find("#state").parent().parent().append("<div class='dverrormsg'  id='errorstate'>"+ZPI18N.getString("zp.stateemptymsg")+"</div>")):/[^0-9-()+]/.test(mobileNum)?Layout.Page.container.find("#mobile").siblings().hasClass("etxt")?Layout.Page.container.find("#mobile").find("#errormobile").attr("value",ZPI18N.getString("zp.enteravalidnumber")):Layout.Page.container.find("#mobile").parent().append("<div class='etxt'  id='errormobile'>"+ZPI18N.getString("zp.enteravalidnumber")+"</div>"):(GettingStartedJsonObject.country=country,GettingStartedJsonObject.state=state,GettingStartedJsonObject.timezone=timFmt,GettingStartedJsonObject.mobile=mobileNum,GettingStartedJsonObject.companyName=companyName,GettingStartedJsonObject.phone=mobileNum,$("#updBasicCmpInfo").attr("disabled",!0).val(ZPI18N.getString("zp.pleasewaitmsg")),params={conreqcsr:csrfToken,action:"updateCompanyDetails",updateBasicInfoJSON:JSON.stringify(GettingStartedJsonObject)},$.post("/pplus/updateCompanyDetails",params,function(data){"Success"==data.response.message?(Layout.Page.container.find("#updBasicCmpInfo").prop("disabled",!0),ZPeople.showCompanyInfoPopUp=!1,ZPServices.createFinanceServicesLoading()):Layout.Page.container.find("#infoPage").find("h1").append("<div class='dverrormsg' id='errorcompanyName'>"+ZPI18N.getString("zp.internalservererror")+"</div>")}))},ZPServices.createFinanceServicesLoading=function(){if(3!=ZPServices.PEOPLE_PLUS_SERVICE.expense.status&&3!=ZPServices.PEOPLE_PLUS_SERVICE.payroll.status){Layout.Page.container.find(".pp-popup,.modal-backdrop").remove();var loadhtml='<div class="pp-popup loadpop" id="loadingClassPopUp"><div id="infoPage"> <div class="load-hz"></div> <h1>'+ZPI18N.getString("zpp.loadingtext")+"</h1> ";ZPeople.ISUNCONFIRMEDACC&&(loadhtml+="<p> "+ZPI18N.getString("zpp.loadingtext1")+" </p>"),loadhtml+='</div></div><div class="modal-backdrop dark in" id="freezelayerid"></div>',Layout.Page.container.append(loadhtml),$("div#loadingClassPopUp").length>0&&setTimeout(ZPServices.showLoadingPopUp,12e3)}},ZPServices.showLoadingPopUp=function(){ZPServices.getPPServiceStatus(),$("div#loadingClassPopUp").length>0&&setTimeout(ZPServices.showLoadingPopUp,1e3),$("div#loadingClassPopUp").remove(),$("div#freezelayerid").remove()},ZPServices.removeErrorDiv=function(){Layout.Page.container.find(".dverrormsg").remove()},ZPServices.click=function(serviceDiv,message,ServiceName){serviceDiv.find("div").click(function(){void 0==message||null==message?window.open($(this).attr("href"),"_blank"):alert("application not added")})},ZPServices.statusAppearance=function(status,eachServiceIter,item,alreadyCreated,appName){var serviceDiv=$("div[name=peopleService]").find("#"+item+"_id");ZPServices.PEOPLE_PLUS_SERVICE[item].status=status;var isNotAllowedToShowApp=!!eachServiceIter.hasOwnProperty("isNotAllowedToShowApp")&&eachServiceIter.isNotAllowedToShowApp,isAllowedToShowCliq=!("chat"!=item||!eachServiceIter.hasOwnProperty("isAllowedToShowCliq"))&&eachServiceIter.isAllowedToShowCliq,isAllowedToShowSign=!("sign"!=item||!eachServiceIter.hasOwnProperty("isAllowedToShowSign"))&&eachServiceIter.isAllowedToShowSign;if(status==ZPServices.View.assStatus||"chat"!=item&&"sign"!=item||$(serviceDiv).remove(),status===ZPServices.View.assStatus)"chat"!=item&&"sign"!=item||isAllowedToShowCliq||isAllowedToShowSign?isNotAllowedToShowApp?$(serviceDiv).remove():($(serviceDiv).show(),alreadyCreated?(serviceDiv.removeClass("zp_svcConf"),serviceDiv.find("h3").text(ZPServices.PEOPLE_PLUS_SERVICE[item].dispName),serviceDiv.find("span i#succ_ic").remove()):(serviceDiv.addClass("zp_svcConf"),serviceDiv.find("h3").text(ZPI18N.getString("zp.configurationsucc")),serviceDiv.find("span i#succ_ic").remove(),serviceDiv.find("span").append('<i class="IC-IC-task-chk" id="succ_ic"></i>')),eachServiceIter.hasOwnProperty("Orgs")&&eachServiceIter.Orgs.hasOwnProperty("url")?urlDetails[item]=eachServiceIter.Orgs.url:eachServiceIter.hasOwnProperty("url")&&(urlDetails[item]=eachServiceIter.url),serviceDiv.find("span").unbind("click").click(function(){ZPServices.gotoPeopleService(this)}),ZPSetupCommon.isEmpty(appName),ZPServices.removeStatusAppearance(status,serviceDiv,item)):$(serviceDiv).remove();else if(status===ZPServices.View.UnavailStatus)serviceDiv.addClass("zp_svcDis");else if(status===ZPServices.View.UnassMultipleStatus)$(serviceDiv).show(),ZPServices.PEOPLE_PLUS_SERVICE[item].eachServiceIter=eachServiceIter,eachServiceIter.hasOwnProperty("Orgs")&&(ZPServices.PEOPLE_PLUS_SERVICE[item].Orgs=eachServiceIter.Orgs),ZPSetupCommon.isEmpty(appName),ZPServices.removeStatusAppearance(status,serviceDiv,item);else if(status===ZPServices.View.createFrshStatus||status===ZPServices.View.ConflictStatus||status===ZPServices.View.UnassSingleStatus){$(serviceDiv).show(),eachServiceIter.hasOwnProperty("Orgs")&&(ZPServices.PEOPLE_PLUS_SERVICE[item].zaaid=Object.keys(eachServiceIter.Orgs)[0],ZPServices.PEOPLE_PLUS_SERVICE[item].orgid=Object.keys(eachServiceIter.Orgs)[0],eachServiceIter.Orgs[ZPServices.PEOPLE_PLUS_SERVICE[item].orgid].hasOwnProperty("conflict_type")&&(ZPServices.PEOPLE_PLUS_SERVICE[item].conflict_type=eachServiceIter.Orgs[ZPServices.PEOPLE_PLUS_SERVICE[item].orgid].conflict_type,"non_admin_user"==ZPServices.PEOPLE_PLUS_SERVICE[item].conflict_type&&eachServiceIter.Orgs[ZPServices.PEOPLE_PLUS_SERVICE[item].orgid].hasOwnProperty("admins")&&(ZPServices.PEOPLE_PLUS_SERVICE[item].admins=eachServiceIter.Orgs[ZPServices.PEOPLE_PLUS_SERVICE[item].orgid].admins,ZPServices.PEOPLE_PLUS_SERVICE[item].display_name=eachServiceIter.Orgs[ZPServices.PEOPLE_PLUS_SERVICE[item].orgid].display_name)),eachServiceIter.Orgs[ZPServices.PEOPLE_PLUS_SERVICE[item].orgid].hasOwnProperty("fromSoftLink")&&(ZPServices.PEOPLE_PLUS_SERVICE[item].fromSoftLink=!0)),serviceDiv.addClass("zp_svcConf"),eachServiceIter.hasOwnProperty("message")&&(ZPServices.PEOPLE_PLUS_SERVICE[item].message=eachServiceIter.message),ZPSetupCommon.isEmpty(appName),ZPServices.removeStatusAppearance(status,serviceDiv,item),extendedParam={status:"5",result:"Failure"},$.extend(!0,eachServiceIter,extendedParam)}else status!==ZPServices.View.PEOPLEPLUSSERVICE_SERVICEUNAVAILBLEFORDADMIN&&status!==ZPServices.View.notAddedServicetoUser&&status!==ZPServices.View.PEOPLEPLUSSERVICE_SERVICENOTADDEDBYADMIN||$(serviceDiv).remove()},ZPServices.removeStatusAppearance=function(status,serviceDiv,item){status===ZPServices.View.assStatus?(serviceDiv.removeClass("zp_svcConf"),serviceDiv.find("h3").text(ZPServices.PEOPLE_PLUS_SERVICE[item].dispName),serviceDiv.find("span i#succ_ic").remove()):(serviceDiv.removeClass("zp_svcConf"),serviceDiv.addClass("zp_svcDis"),serviceDiv.find("#retry_mode,i#failure_ic").remove(),serviceDiv.find("h3").text(ZPServices.PEOPLE_PLUS_SERVICE[item].dispName),serviceDiv.append('<div class="icon-stat" id="retry_mode"> <div class="ctable"> <div class="ctcell"> <i class="IC-reload" onclick=ZPServices.getPPServiceStatus("'+item+'")></i> <h3>'+ZPI18N.getString("zp.retry")+"</h3> </div> </div> </div>"))},ZPServices.serviceListRow=function(data,isPeoplePlus){var icon,addServiceDV=ZPServices.SERVICE_LIST_DIV;return addServiceDV=(addServiceDV=addServiceDV.replace(/\$SERVICENAME\$/g,data.dispName)).replace(/\$SERVICELBL\$/g,data.tabName),isPeoplePlus?icon={iconClass:"zp_SPls "+data.iconClass,iconColor:data.iconColor}:(icon=Icons.getIconClass(data.icon)).iconClass="zp_Si "+icon.iconClass,addServiceDV=(addServiceDV=addServiceDV.replace(/\$SERVICEICON\$/g,icon.iconClass)).replace(/\$SERVICECOLOR\$/g,icon.iconColor)},ZPServices.resetServicePage=function(event){void 0!=event&&event.preventDefault(),$("#"+Layout.Page.pageId).find("#serviceMainDv .zp_svc").removeClass("zp_sel"),$("#"+Layout.Page.pageId).find("#serviceMainDv .zp_svcpv").remove(),$("#"+Layout.Page.pageId).find("#serviceMainDv .ZPNdata").remove()},ZPServices.showServiceDtl=function(getThis,event){event.preventDefault(),event.stopPropagation();var pageId=$("#"+Layout.Page.pageId);$(getThis).closest(".zp_svc").hasClass("zp_sel")?ZPServices.resetServicePage():(ZPServices.resetServicePage(),setTimeout(function(){var service,descDV;$(getThis).closest(".zp_svc").addClass("zp_sel");var tabName=$(getThis).closest(".zp_svc").attr("tab");if("hrService"===$(getThis).closest(".zp_sRcnt").attr("name"))void 0!=(service=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",tabName,!0))&&(descDV='<div class="zp_svcpv zp_shw" id="serviceDtls">'+ZPServices.constructServiceDtl(service)+"</div>");else if("peopleService"===$(getThis).closest(".zp_sRcnt").attr("name")){var pplService=ZPServices.PEOPLE_PLUS_SERVICE[tabName];pplService&&(descDV='<div class="zp_svcpv zp_shw" id="serviceDtls" style="height: 195px;"><a class="zp_svcls" onclick="ZPServices.resetServicePage(event)"><i class="IC-cls" title="Close"></i></a>'+ZPServices.SERVICE_DESC_DIV.replace(/\$SERVICEDESC\$/g,pplService.desc),descDV+='<div class="zp_btn"><button class="zpthm" onclick="ZPServices.gotoPeopleService(this)">'+ZPI18N.getString("zp.goto",[pplService.dispName])+"</button></div></div>")}if(descDV){var height=parseInt($(getThis).closest(".zp_svc").offset().top+190);$(getThis).closest(".zp_svc").append(descDV),$(getThis).parent().siblings("#serviceDtls").offset({top:height}),pageId.find("#serviceDtls")[0].scrollIntoView({behavior:"smooth"}),ZPServices.SELECTED_SERVICE={},service&&(ZPServices.SELECTED_SERVICE=service,pageId.find("[id=relatedDoc]").off("click").on("click",function(){ZPServices.View.getRelatedDoc(pageId.find("#gotoservicebutton").attr("categoryId"))}))}},200))},ZPServices.constructDesc=function(service){var descDiv="";return void 0!=service.desc&&""!==service.desc&&(descDiv=ZPServices.SERVICE_DESC_DIV.replace(/\$SERVICEDESC\$/g,service.desc)),descDiv='<div class="zp_svcdesc">'+(descDiv+=ZPServices.SERVICE_GOTO_BTN.replace(/\$GOTO\$/g,ZPI18N.getString("zp.goto",[service.dispName])).replace(/\$CATEGORYID\$/g,void 0!=service.categoryid?service.categoryid:"-1"))+"</div>"},ZPServices.constructFormList=function(service){var formList='<div class="zp_flt">';$.each(service.forms,function(index,form){!form.isActive||"true"==is5_0Enabled&&form.isBackend||(formList+='<a onclick="ZPServices.openForm(this,event)" formid="'+form.pcId+'" viewid="'+form.viewId+'">'+form.dispName+(form.isAddPerm?"<span>+</span>":"")+"</a>")}),formList+="</div>";var askUsBtn=!1;return service.hasOwnProperty("enable_hrcase")&&!$.isEmptyObject(ZPTabs.getSelectedTab("hrcase"))&&(askUsBtn=service.enable_hrcase),formList='<div class="zp_svcreq">'+(formList+=ZPServices.View.constructHeaderButton(service.hasReference,service.isServiceAdmin,service.hasFAQList,askUsBtn))+"</div>"},ZPServices.openForm=function(getThis,event){event.preventDefault();var formId=$(getThis).attr("formid");if($(event.target).is("span")){var params={formId:formId,disableUrlTrack:!0};ZPForm.load(params)}else{var viewId=$(getThis).attr("viewid"),serviceName=$(getThis).closest(".zp_svc").attr("tab");window.location.href="#"+ZPServices.getViewFormUrl(serviceName,formId,viewId)}},ZPServices.constructServiceDtl=function(service){var descDiv=ZPServices.SERVICE_CLOSE_HTML;return descDiv+=ZPServices.constructDesc(service),descDiv+=ZPServices.constructFormList(service)},ZPServices.gotoPeopleService=function(getThis){var tabName=$(getThis).closest(".zp_svc").attr("tab");return tabName&&ZPServices.PEOPLE_PLUS_SERVICE[tabName]&&void 0!=urlDetails[tabName]&&window.open(urlDetails[tabName],"_blank","noopener"),!1},ZPServices.gotoService=function(getThis){var tabName=$(getThis).closest(".zp_svc").attr("tab");ZPServices.gotoServicePage(tabName)},ZPServices.gotoServicePage=function(tabName){if(Object.keys(ZPServices.SELECTED_SERVICE).length<1&&(ZPServices.SELECTED_SERVICE=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",tabName,!0)),void 0!=ZPServices.SELECTED_SERVICE&&!ZPServices.setShowMainTab(ZPServices.SELECTED_SERVICE)){ZPTabs.Actions.addTabsInUserTabs(ZPServices.SELECTED_SERVICE);var firstForm=ZPServices.SELECTED_SERVICE.forms[0];window.location.href=void 0==firstForm?"#"+tabName.toLowerCase()+"/generalsettings":"#"+ZPServices.getViewFormUrl(ZPServices.SELECTED_SERVICE.tabName.toLowerCase(),firstForm.pcId,firstForm.viewId)}if(showNewTab){var maintabEle=$("#zp_maintabs");if(0==maintabEle.find('[tabname="'+tabName.toLowerCase()+'"]').length){var tabObj,servicesTab=maintabEle.find('li[tabname="services"]');servicesTab.prev().remove(),$.each(ZPTabs.TAB_JSON,function(idx,tabJSON){tabJSON.name==tabName&&(tabObj=tabJSON)});var tabname=tabObj.name.toLowerCase(),subtabs=ZPTabs.getSubTabs(tabname,tabObj.isSysTab);servicesTab.before($(ZPTabs.getTabHtml(tabname,subtabs,tabObj,{tname:tabname})))}}},ZPServices.setShowMainTab=function(service){var mainTabName=service.tabName;mainTabName=ZPServices.selectTab(mainTabName);var selTab=ZPServices.getObjectFormArray(ZPTabs.TAB_JSON,"name",mainTabName,!0);if(void 0!=selTab){var url=ZPTabs.getMainTabUrl(selTab.subtabs,mainTabName);return void 0!==url&&(window.location.href="#"+url),!0}return!1},ZPServices.getViewFormUrl=function(serviceName,formId,viewId){return void 0!==formId&&void 0!==viewId?serviceName.toLowerCase()+"/form/listview-formId:"+formId+"/viewId:"+viewId:""},ZPServices.search=function(getThis){ZPServices.resetServicePage();var value=$(getThis).val(),searchDiv=Layout.Page.container.find("[tab]");if(ZPUtil.Validation.isEmpty(value))$(searchDiv).show();else{$(searchDiv).hide();for(var servIdx=0;servIdx<ZPServices.SERVICE_JSON.length;servIdx++){var service=ZPServices.SERVICE_JSON[servIdx];if(ZPeople.decodeTxt(service.dispName).match(new RegExp(value,"iu")))Layout.Page.container.find('[tab="'+service.tabName+'"]').show();else{for(var formIdx=0;formIdx<service.forms.length;formIdx++)if(ZPeople.decodeTxt(service.forms[formIdx].dispName).match(new RegExp(value,"iu"))){Layout.Page.container.find('[tab="'+service.tabName+'"]').show();break}if("organization"==service.tabName.toLowerCase()&&service.hasOwnProperty("empHealthFormDetails")&&ZPeople.decodeTxt(service.empHealthFormDetails.dispName).match(new RegExp(value,"iu"))){Layout.Page.container.find('[tab="'+service.tabName+'"]').show();break}}}if(Layout.isPeoplePlus)for(var app in ZPServices.serviceList)ZPeople.decodeTxt(ZPServices.PEOPLE_PLUS_SERVICE[ZPServices.serviceList[app]].dispName).match(new RegExp(value,"iu"))&&Layout.Page.container.find('[tab="'+ZPServices.serviceList[app]+'"]').show();Layout.Page.container.find("[tab]").is(":visible")?Layout.Page.container.find("#serviceMainDv #service_nodata").remove():0===Layout.Page.container.find("#serviceMainDv #service_nodata").length&&Layout.Page.container.find("#serviceMainDv").append(ZPServices.SERVICE_NODATA)}},ZPServices.getNoDataHTML=function(noDataMsg){return'<div class="ZPNdata"><i class="CR-nodata"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><h5 id="zp_views_nodata">'+noDataMsg+"</h5></div>"},ZPServices.addFormInService=function(formsData,isAddForm,serviceName,isActive,serviceId){var currentService;if(void 0!=(currentService=void 0!=serviceName?ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",serviceName,!0):ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"id",serviceId,!0))){var formSubTab,tab=Layout.UrlConf.isSystemService?void 0:ZPServices.getObjectFormArray(ZPTabs.TAB_JSON,"name",serviceName,!0);void 0!=tab&&(formSubTab=tab.subtabs[0],tab.subtabs.length<2&&(formSubTab={isDiretTabs:!0,tabName:"",displayName:ZPI18N.getString("zp.forms"),formArr:[]},tab.subtabs.splice(0,0,formSubTab,{displayName:ZPI18N.getString("zp.analytics"),tabURL:serviceName+"/analytics/list"}),ZPServices.ISTASKTABACTIVE&&tab.subtabs.splice(1,0,{displayName:ZPI18N.getString("zp.tasks"),tabURL:serviceName+"/alltask"})),isAddForm||(formSubTab.formArr=[])),isAddForm||(currentService.forms=[],currentService.activeFormCount=0),$.each(formsData,function(index,form){var formId=form.pcId,formName=form.dispName,viewId=form.viewId;if(void 0==serviceId&&void 0!=$("#accordion")&&$("#accordion").length>0){if(serviceId=currentService.id,0==currentService.activeFormCount){var obj=$("#accordion").find("ul#Tab_"+serviceId);void 0!=obj&&obj.length>0&&obj[0].lastChild.remove()}var formDtls=[{isHidden:!1,isCustom:!0,formId:formId,formName:formName}];tabAndFormsCustom.tabsPageConstruction.formsListConstruction(formDtls,$("#accordion").find("ul#Tab_"+serviceId))}isAddForm?void 0==isActive?currentService.forms.push({dispName:formName,isAddPerm:isadmin,label:form.label,pcId:formId,viewId:viewId,isMoveable:!0,isActive:!0,isEnableDis:!0,isCustom:!0}):(form=formId==ZPeople.EMP_HEALTH_FORMID?currentService.empHealthFormDetails:ZPServices.getObjectFormArray(currentService.forms,"pcId",formId,!0,!0)).isActive=isActive:currentService.forms.push(form);(form.isActive||void 0==isActive)&&(++currentService.activeFormCount,void 0!=formSubTab&&formSubTab.formArr.push({pcId:formId,displayName:formName,tabURL:ZPServices.getViewFormUrl(serviceName,formId,viewId)}))}),ZPTabs.constructSubtabsBasedOnHash(!1,serviceName,"0"===ZPeople.USER_CUST_SETTINGS.USER_TAB_MINIMIZE)}},ZPServices.removeFormInService=function(removeFormIds,serviceName,isActive){var currentService=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",serviceName,!0);if(void 0!=currentService){var tab=Layout.UrlConf.isSystemService?void 0:ZPServices.getObjectFormArray(ZPTabs.TAB_JSON,"name",serviceName,!0),formTabArr=[];void 0!=tab&&void 0!=tab.subtabs[0].formArr&&tab.subtabs[0].formArr.length>0&&(formTabArr=tab.subtabs[0].formArr);var forms=currentService.forms;$.each(removeFormIds,function(index,formId){var form=ZPServices.getObjectFormArray(forms,"pcId",formId,!0,!0);void 0!=form&&(void 0==isActive?forms.splice(form.index,1):form.isActive=isActive,--currentService.activeFormCount);var formTab=ZPServices.getObjectFormArray(formTabArr,"pcId",formId,!0,!0);void 0!=formTab&&formTabArr.splice(formTab.index,1)}),void 0!=tab&&formTabArr.length<1&&tab.subtabs.splice(0,tab.subtabs.length,{displayName:ZPI18N.getString("zp.settings"),tabURL:serviceName+"/generalsettings"}),Layout.CustomizedUrl.getServiceName()===serviceName&&ZPTabs.constructSubtabsBasedOnHash(!1,serviceName,"0"===ZPeople.USER_CUST_SETTINGS.USER_TAB_MINIMIZE)}},ZPServices.addUpdateService=function(serviceId,serviceLName,srName,srSDesc,srvIcon,categoryId,enable_hrcase){var currentService=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",serviceLName,!1);void 0===currentService&&(currentService={categoryid:categoryId,id:serviceId,forms:[],hasFAQList:!1,isApprovalEnabled:!1,icon:"star",isActive:!0,activeFormCount:0},ZPServices.SERVICE_JSON.push(currentService)),currentService.enable_hrcase=enable_hrcase,currentService.tabName=serviceLName,currentService.dispName=srName,currentService.desc=srSDesc;currentService.icon;currentService.icon=srvIcon},ZPServices.updateHasFAQ=function(faqDiv){var service=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",Layout.CustomizedUrl.getServiceName(),!0);void 0!=service&&(service.hasFAQList=faqDiv.find(".zpfaq").length>0)},ZPServices.Configure={addServiceHtml:function(sliderName){return'<div id="newService" class="zp_NSPop active"><div class="zp_popInner"><h4>'+(sliderName=void 0==sliderName?ZPI18N.getString("zp.newservice"):sliderName)+'</h4><i class="IC-cls" onclick="ZPServices.Configure.closeSlide()"></i><div data-placement="bottom" data-toggle="tooltip" data-original-title="'+ZPI18N.getString("zp.chooseicon")+'" class="zp_sIcn"><label id="serIcon" class="zp_serIcn"><i class="zp_Si zp_app0"></i></label></div><div class="zp_formncls"><div id="svNameDiv" class="zp_fm"></div><span class="etxt"></span><div id="svSDescDiv" class="zp_fm"></div><span class="etxt"></span></div><div class="zp_btn"><button class="zpthm zpn_btn" id="svServBtn" onclick="ZPServices.Configure.saveService()"><b>'+ZPI18N.getString("zp.save")+'</b><div class="zp_circular"></div><label>'+ZPI18N.getString("zp.saving")+'</label></button><button onclick="ZPServices.Configure.closeSlide()">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div>"},addNewService:function(){isadmin&&(ZPServices.resetServicePage(),0==$("#"+Layout.Page.pageId).find("#newService").length&&Layout.Page.container.find("#serviceMainDv").append(ZPServices.Configure.addServiceHtml()),ZPServices.Configure.resetPage())},closeSlide:function(){Layout.Page.container.find("#newService").remove()},resetPage:function(){var parentId=$("#"+Layout.Page.pageId).find("#newService");CommonTemplates.removeErrorMessagesinContainerDiv("newService"),CommonTemplates.getInputTextBox({id:"svName",placeholder:ZPI18N.getString("zp.enterservicename")},ZPI18N.getString("zp.name"),!0,parentId.find("[id=svNameDiv]")),parentId.find("[id=serIcon]").off("click").on("click",function(){ZPServices.Configure.chooseIcon(this)}),CommonTemplates.getInputTextBox({id:"svSDesc",placeholder:ZPI18N.getString("zp.enterdesc")},ZPI18N.getString("zp.description"),!0,parentId.find("[id=svSDescDiv]"))},chooseIcon:function(obj){var params=[];$.each(Icons.ICONS_LIST,function(i,v){"add"!=i&&"graduate"!=i&&params.push({iconVal:i,value:"zp_Si "+v})}),$(obj).zparrowmenu({id:"iconsList",data:params,icon:!0,callback:function(listedObj,sourceObj){$(sourceObj).closest("div").attr("class","zp_sIcn "+Icons.getIconClass($(listedObj).attr("iconVal")).iconColor),$(sourceObj).find("i").attr("class",$(listedObj).attr("name"))}})},addNewFormCallBack:function(data){var serviceName=Layout.CustomizedUrl.getServiceName();serviceName==Compensation.CONSTANTS.SERVICENAME&&Layout.CustomizedUrl.refreshTab(!0),ZPServices.View.viewFormList([{pcId:data.formId,dispName:data.formName,isCustom:!0,isEnableDis:!1,label:data.labelName,isExtensionForm:!1}],!0),ZPServices.addFormInService([{pcId:data.formId,dispName:data.formName,label:data.labelName,viewId:data.viewId}],!0,serviceName),window.location.href=Layout.CustomizedUrl.getNewCustomizedUrl("admin/formslayout/formedit",data.formId)},addForm:function(serviceId){AppsCustom.addNewApp({},{tabid:serviceId,successCallback:ZPServices.Configure.addNewFormCallBack})},deleteForm:function(formid){$("#"+Layout.Page.pageId);var params={method:"deleteForm",formid:formid},others={callback:ZPServices.removeFormInService([params.formid],Layout.CustomizedUrl.getServiceName())};ZPeople.Request.send("/formOperations.zp",params,tabCustom.deleteForm,others)},enabledisabelFormCallBack:function(data,others,params){var inObj=others.obj.find("#enbDisForm"),serviceName=(params.hidden,Layout.CustomizedUrl.getServiceName());params.hidden?(inObj.prop("checked",!1),inObj.closest("[formId]").addClass("zp_dAct"),ZPServices.removeFormInService([others.formData.pcId],serviceName,!1)):(inObj.prop("checked",!0),inObj.closest("[formId]").removeClass("zp_dAct"),ZPServices.addFormInService([others.formData],!0,serviceName,!0));var currentService=ZPServices.getObjectFormArray(ZPServices.SERVICE_JSON,"tabName",serviceName,!0,!1),forms=$.grep(currentService.forms,function(form){return form});"organization"==currentService.tabName.toLowerCase()&&currentService.hasOwnProperty("empHealthFormDetails")&&forms.push(currentService.empHealthFormDetails),ZPServices.View.viewFormList(forms,!1)},enabledisableForm:function(formData,hidden,obj){var params={method:"formCustOperations",mode:"showhideform",formid:formData.pcId,hidden:hidden},others={formData:formData,obj:obj,successCallback:ZPServices.Configure.enabledisabelFormCallBack};ZPeople.Request.send("/formCustOperations.zp",params,tabCustom.enableDisableForm,others)},validateServiceName:function(headerDiv,excludeName){var data=$.trim($("#"+headerDiv).find("#svName").val());if(excludeName=void 0==excludeName?"":excludeName,$.grep(ZPServices.SERVICE_JSON,function(ele){return decodeHTML(ele.dispName.toLowerCase())==data.toLowerCase()&&data.toLowerCase()!=decodeHTML(excludeName).toLowerCase()}).length>0||""==data||data.length>50){var errorMsg=ZPI18N.getString("zp.serviceavailable");""==data?errorMsg=ZPI18N.getString("zp.serviceempty"):data.length>50&&(errorMsg=ZPI18N.getString("zp.cannotexceedchar",new Array(ZPI18N.getString("zp.hrservicename"),"50"))),CommonTemplates.setErrorMessageinTextBox($("#"+headerDiv).find("#svName"),errorMsg)}else CommonTemplates.removeErrorMessageinTextBox($("#"+headerDiv).find("#svName"))},validateSDesc:function(headerDiv,currentId){var shortDesc=$("#"+headerDiv).find("#"+currentId).val();if(""==$.trim(shortDesc)||shortDesc.length>250){var errorMsg=ZPI18N.getString("zp.servicedesc");shortDesc.length>250&&(errorMsg=ZPI18N.getString("zp.cannotexceedchar",new Array(ZPI18N.getString("zp.description"),"250"))),CommonTemplates.setErrorMessageinTextBox($("#"+headerDiv).find("#"+currentId),errorMsg)}else CommonTemplates.removeErrorMessageinTextBox($("#"+headerDiv).find("#"+currentId))},saveService:function(){var parentId=$("#"+Layout.Page.pageId).find("#newService");CommonTemplates.waitTillSave("svServBtn"),CommonTemplates.removeErrorMessagesinContainerDiv("newService");var servDtl,params={mode:"add"},srName=parentId.find("#svName").val(),srSDesc=parentId.find("#svSDesc").val(),srIcon=parentId.find("#serIcon").find("i").attr("class");srIcon=srIcon.replace("zp_Si",""),servDtl={serviceName:srName,serviceDescription:srSDesc,serviceIcon:Icons.getIconName(srIcon.trim())},params.serviceDtls=JSON.stringify(servDtl),ZPServices.Configure.validateServiceName("newService"),ZPServices.Configure.validateSDesc("newService","svSDesc"),parentId.find("span[class=etxt]:not([class=zp_dyn])").length>0?CommonTemplates.saveComplete("svServBtn"):ZPeople.Request.send("/services.zp",params,function(data){if(CommonTemplates.saveComplete("svServBtn"),"success"==data.status){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.servicesaved")),ZPServices.Configure.closeSlide(),Layout.UrlConf.SERVICE_MODULE.push(data.tabName.toLocaleLowerCase()),ZPServices.addUpdateService(data.id,data.tabName,data.dispName,data.desc,data.icon,data.categoryId,!1);var tabDtls={tabDisplayName:data.dispName,tabName:data.tabName,tabId:data.id,formDetailsMap:[],isLink:!1},switchInfo={isSwitch:!0,switchId:"showhide_"+data.id,isHidden:!1,isCustom:!0,deletemethod:tabAndFormsCustom.tabDeleteMethod,enablemethod:tabAndFormsCustom.tabEnableMethod,title:ZPI18N.getString(Translate.getCurrentUIKey("zp.deletetab","zp.deleteservice")),name:""},tabLen=$("#accordion").find("#tabsPageDiv .col-md-12").length,last=$("#accordion").find("#tabsPageDiv [name=tabDiv] span:contains("+tabLen+")").last();last=$(last).parents("[name=tabDiv]"),$(last).parents("[name=tabColumn]").siblings("[name=tabColumn]").append(tabAndFormsCustom.tabsPageConstruction.tabDiv(tabLen+1,tabDtls,switchInfo)),tabCustom.addNewTabEntry(data.id,data.dispName),window.location.href="#"+data.tabName.toLocaleLowerCase()+"/generalsettings"}else ZPeople.Message.showFailureMsg(data.msg)},"",function(xhr){CommonTemplates.saveComplete("svServBtn");var error_response=xhr.responseText;ZPeople.Message.showFailureMsg(error_response.error)})}},ZPServices.MoveForms={popupHtml:'<div class="zp_whtbg zp_shw" id="moveform"><div class="zp_pop"><div class="zp_Ptl zp_wthBdr"><h3>'+ZPI18N.getString("zp.moveform")+'</h3></div><div id="mvFormCont" class="zp_pcnt">$FORMSDRAGDROP$</div><div class="zp_btn"><button name="closeSlider">'+ZPI18N.getString("zp.close")+'</button></div></div><i name="closeSlider" title='+ZPI18N.getString("zp.close")+' class="IC-cls"></i></div>',dragColumn:'<div name="$ULTYPE$" class="zp_mvFmOut"><div class="zp_ttl">$COLUMNTTL$</div><div class="zp_mvFrm $ALIGN$">$COLFORMS$</div></div>',formsList:'<ul serviceid="$SERVICEID$" isMoveEnable="$ISMOVEABLE$" name="$ULTYPE$" class="zp_fmCont">$FORMSLIST$</ul>',dragableDiv:'<li class="zp_drgBle"></li>',singleForm:'<li $FATTR$ formid="$FORMID$"><i class="$DRAGICON$"></i> $FORMNAME$</li>',noForm:'<li type="noform">'+ZPI18N.getString("zp.noformsavailable")+"</li>",serviceList:'<li serviceid="$SERVICEID$" class=""><span>$SRVDISPNAME$</span>$FRMLST$</li>',allServiceHtml:'<div class="zp_mvSr"><input id="srcTabForm" placeholder="'+ZPI18N.getString("zp.search")+'" type="text"><i class="IC-lens"></i></div><ul>$SRVLIST$</ul>',getFormsAndServices:function(serviceId){ZPeople.Request.send("/getFormAndTabs.zp",{method:"formsAndTabsPage"},function(data){ZPServices.MoveForms.getFormsSlider(data.tabList,serviceId)},"")},search:function(getThis){var parentId=$("#"+Layout.Page.pageId).find("#moveform"),value=$(getThis).val(),searchDiv=parentId.find("li[serviceid]");if(ZPUtil.Validation.isEmpty(value))$(searchDiv).show();else{$(searchDiv).hide();for(var servIdx=0;servIdx<ZPServices.SERVICE_JSON.length;servIdx++){var service=ZPServices.SERVICE_JSON[servIdx];if(ZPeople.decodeTxt(service.dispName).match(new RegExp(value,"iu")))parentId.find('li[serviceid="'+service.id+'"]').show(),parentId.find('li[serviceid="'+service.id+'"]').addClass("zp_heAd");else for(var formIdx=0;formIdx<service.forms.length;formIdx++)if(ZPeople.decodeTxt(service.forms[formIdx].dispName).match(new RegExp(value,"iu"))){parentId.find('li[serviceid="'+service.id+'"]').show(),parentId.find('li[serviceid="'+service.id+'"]').addClass("zp_heAd");break}}}},getFormsSlider:function(data,serviceId){var serviceForms="",allsrvList="";$.each(data,function(i,v){let isMoveEnable=0==v.isFormAddMoveDisable;if(v.id==serviceId){var currForms="";v.hasOwnProperty("forms")&&v.forms.length>0&&(currForms=ZPServices.MoveForms.getFormsList(v.forms));var formsList=ZPServices.MoveForms.formsList;formsList=(formsList=(formsList=formsList.replace("$FORMSLIST$",currForms)).replace("$ULTYPE$","to")).replace("$SERVICEID$",v.id),serviceForms=(serviceForms=(serviceForms=(serviceForms=(serviceForms=(serviceForms=ZPServices.MoveForms.dragColumn).replace("$COLUMNTTL$",v.dispName)).replace("$ALIGN$","zp_aAct")).replace("$COLFORMS$",formsList)).replace("$ULTYPE$","to")).replace("$ISMOVEABLE$",isMoveEnable)}else{var srvHtml=ZPServices.MoveForms.serviceList;srvHtml=(srvHtml=srvHtml.replace("$SRVDISPNAME$",v.dispName)).replace("$SERVICEID$",v.id);var srvForms="";srvForms=v.hasOwnProperty("forms")&&v.forms.length>0?ZPServices.MoveForms.getFormsList(v.forms):ZPServices.MoveForms.noForm,srvHtml=(srvHtml=(srvHtml=(srvHtml=(srvHtml=srvHtml.replace("$FRMLST$",ZPServices.MoveForms.formsList)).replace("$SERVICEID$",v.id)).replace("$FORMSLIST$",srvForms)).replace("$ULTYPE$","from")).replace("$ISMOVEABLE$",isMoveEnable),allsrvList+=srvHtml}});var allForms=ZPServices.MoveForms.dragColumn;allForms=(allForms=(allForms=(allForms=(allForms=allForms.replace("$COLUMNTTL$",ZPI18N.getString("zp.allformsandservices"))).replace("$ALIGN$","")).replace("$COLFORMS$",ZPServices.MoveForms.allServiceHtml)).replace("$SRVLIST$",allsrvList)).replace("$ULTYPE$","from");var sliderHtml=ZPServices.MoveForms.popupHtml;sliderHtml=sliderHtml.replace("$FORMSDRAGDROP$",allForms+serviceForms),Layout.Page.container.append(sliderHtml),Layout.Page.container.find("[name=closeSlider]").off("click").on("click",function(){$(this).closest("#moveform").remove()}),Layout.Page.container.find("li[serviceid]").find("span").off("click").on("click",function(){$(this).closest("li[serviceid]").toggleClass("zp_heAd")}),ZPServices.MoveForms.getDraggableOption(serviceId),Layout.Page.container.find("#srcTabForm").off("keyup").on("keyup",function(){var obj=$(this);setTimeout(function(){ZPServices.MoveForms.search(obj)},500)})},getFormsList:function(formDetailsMap){var currForms="";return $.each(formDetailsMap,function(index,val){var fhtml=ZPServices.MoveForms.singleForm;fhtml=fhtml.replace("$FORMID$",val.pcId);var attribute="";val.isActive||(fhtml=fhtml.replace("$DRAGICON$","IC-lock"),attribute='type="inactive"'),!val.hasOwnProperty("isMoveable")||!val.isMoveable||val.hasOwnProperty("isExtensionForm")&&val.isExtensionForm?fhtml=fhtml.replace("$DRAGICON$","IC-lock"):(fhtml=fhtml.replace("$DRAGICON$","CR-drag"),attribute+=' moveable="true" '),fhtml=(fhtml=fhtml.replace("$FATTR$",attribute)).replace("$FORMNAME$",val.dispName),currForms+=fhtml}),formDetailsMap.length<=0&&(currForms=ZPServices.MoveForms.noForm),currForms},getDraggableOption:function(currentServiceId){var pageId=$("#"+Layout.Page.pageId),isSorted=(pageId.find("#moveform"),!1);pageId.find("ul.zp_fmCont").sortable({handle:".CR-drag",items:"li[formid][moveable=true]",cancel:"li[type=inactive]",connectWith:"[ismoveenable=true]",placeholder:"zp_drgBle",helper:"clone",forceHelperSize:!0,appendTo:"body",containment:"document",dropOnEmpty:!0,distance:.5,scroll:!0,tolerance:"touch",start:function(event,ui){$(ui.helper).addClass("zp_dragList"),$(ui.helper).css({height:"auto"}),startElement=$(this),isSorted=!1,sortType="",senderArray={},receiverArray={}},update:function(ev,ui){endElement=$(this),null==ui.sender?(senderArray.serviceid=$(this).attr("serviceid"),senderArray.forms=[],$.each($(this).find("li"),function(index,obj){senderArray.forms.push($(obj).attr("formid"))}),receiverArray.serviceid=$(this).attr("serviceid"),receiverArray.forms=[],$.each($(this).find("li"),function(index,obj){receiverArray.forms.push($(obj).attr("formid"))}),sortType="reorder"):null!=ui.sender&&(receiverArray.serviceid=$(this).attr("serviceid"),receiverArray.forms=[],$.each($(this).find("li"),function(index,obj){receiverArray.forms.push($(obj).attr("formid"))}),sortType="tag"),isSorted=!0},stop:function(ev,ui){if(isSorted){var formId=$(ui.item).attr("formid"),otherformids=[],currentFormIds=[],receiverserviceName="",receiverlblName="",senderlblName="",formName="";if("reorder"==sortType){if(senderArray.serviceid!=currentServiceId)return $(startElement).sortable("cancel"),void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.moveformnotallowed"));otherformids=senderArray.forms,currentFormIds=senderArray.forms;var currentFormDetails=new Array(currentFormIds.length),otherFormDetails=new Array(otherformids.length);$.each(ZPServices.SERVICE_JSON,function(i,v){if(v.id==currentServiceId)return senderlblName=v.tabName,receiverlblName=v.tabName,receiverserviceName=v.dispName,void $.each(v.forms,function(index,value){var inArray=$.inArray(value.pcId,currentFormIds);-1!=inArray&&(currentFormDetails[inArray]=value,otherFormDetails[inArray]=value)})})}else if("tag"==sortType){if($(endElement).attr("name")==$(startElement).attr("name"))return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.moveformnotallowed")),void $(startElement).sortable("cancel");currentServiceId==receiverArray.serviceid?(currentFormIds=receiverArray.forms,otherformids=senderArray.forms):(currentFormIds=senderArray.forms,otherformids=receiverArray.forms);currentFormDetails=new Array(currentFormIds.length),otherFormDetails=new Array(otherformids.length);var portalerror=!1;if($.each(ZPServices.SERVICE_JSON,function(i,v){if(v.id==senderArray.serviceid||v.id==receiverArray.serviceid){if(v.id==senderArray.serviceid&&(senderlblName=v.tabName),$.each(v.forms,function(index,value){if(formId==value.pcId&&(formName=value.dispName,void 0!=value.isPortal&&1==value.isPortal))return portalerror=!0,!1;var inArray=$.inArray(value.pcId,currentFormIds);-1!=inArray&&(currentFormDetails[inArray]=value);var otherArray=$.inArray(value.pcId,otherformids);-1!=otherArray&&(otherFormDetails[otherArray]=value)}),portalerror)return!1;v.id==receiverArray.serviceid&&(receiverlblName=v.tabName,receiverserviceName=v.dispName)}}),portalerror)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.movecportalformnotallowed")),void $(startElement).sortable("cancel")}var params={method:"formCustOperations",mode:"reorderform",parenttabid:receiverArray.serviceid,formIds:JSON.stringify(receiverArray.forms)};ZPeople.Request.send("/formCustOperations.zp",params,function(data){if("success"==data.msg.trim()){if(ZPServices.View.viewFormList(currentFormDetails,!1),ZPServices.addFormInService(currentServiceId==receiverArray.serviceid?currentFormDetails:otherFormDetails,!1,receiverlblName,!0),receiverlblName!=senderlblName&&ZPServices.removeFormInService([formId],senderlblName.toLowerCase()),"from"==$(endElement).attr("name")){var noform=$(endElement).find("li[type=noform]");noform.length>0&&noform.remove()}"from"==$(startElement).attr("name")&&$(startElement).find("li").length<=0&&$(startElement).html(ZPServices.MoveForms.noForm),"reorder"==sortType?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.reorderformsuccess")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.moveformsuccess",new Array(formName,receiverserviceName)))}else{let errMsg=ZPI18N.getString("zp.ttfailuremsg");"MOVE_RESTRICTED"==data.msg.trim()?($(startElement).sortable("cancel"),errMsg=ZPI18N.getString("zp.cannotmoveformtothisservice")):"extensionservice"==data.msg.trim()&&(errMsg=ZPI18N.getString("zp.extensionservicenoedit")),ZPeople.Message.showFailureMsg(errMsg)}},{},function(resultData){$(startElement).sortable("cancel"),ZPeople.Message.showFailureMsg(resultData.error)})}}})}},ZPServices.Edit={srvHtml:function(){var enableCase="";$.isEmptyObject(ZPTabs.getSelectedTab("hrcase"))||(enableCase='<div class="zp_sttl"><span>'+ZPI18N.getString("zp.addtohrcases")+'</span></div><div class="ZPFnoti zp_addHrC"><div class="FL"><label class="checkbox DIB"><input id="enbHRC" type="checkbox"><span></span></label></div><div class="ZPckmain">'+ZPI18N.getString("zp.enablehrcase")+'<i data-placement="bottom" data-toggle="tooltip" data-original-title="'+ZPI18N.getString("zp.enablehrcaseinfo")+'" class="IC-info"></i></div></div>');var assCont='<div class="zp_sttl"><span>'+ZPI18N.getString("zp.knowledgebase")+"</span></div>"+HRCategory.ConfigureCategory.cloneAddContentsBox();return'<div data-placement="bottom" data-toggle="tooltip" data-original-title="'+ZPI18N.getString("zp.chooseicon")+'" class="zp_sIcn"><label id="serIcon" class="zp_serIcn"><i class=""></i></label></div><div class="zp_formncls"><div id="svNameDiv" class="zp_fm"></div><span class="etxt"></span><div id="svSDescDiv" class="zp_fm"></div><span class="etxt"></span>'+(isPlatformOrg?"":enableCase+'<div id="svAgentDiv" class="zp_fm"></div><span class="etxt"></span>'+assCont)+"</div>"},editService:function(data){var pageId=$("#"+Layout.Page.pageId);pageId.append(CommonTemplates.sliderPop(!0));var parentId=pageId.find("#sliderPopup");if(parentId.find("#sliderContent").html(ZPServices.Edit.srvHtml()),parentId.find("[id=serIcon]").closest("div").addClass(Icons.getIconClass(data.icon).iconColor),parentId.find("[id=serIcon]").find("i").attr("class","zp_Si "+Icons.getIconClass(data.icon).iconClass),parentId.find("[id=serIcon]").off("click").on("click",function(){ZPServices.Configure.chooseIcon(this)}),CommonTemplates.getInputTextBox({id:"svName",value:data.dispName},ZPI18N.getString("zp.name"),!0,parentId.find("[id=svNameDiv]")),CommonTemplates.getInputTextBox({id:"svSDesc",value:data.desc},ZPI18N.getString("zp.description"),!0,parentId.find("[id=svSDescDiv]")),!$.isEmptyObject(ZPTabs.getSelectedTab("hrcase"))){if(parentId.find("#svAgentDiv").addClass("zp_dyn"),CommonTemplates.getSelectMenu(HRCaseDropdown.cgymemberdropdown(),parentId.find("[id=svAgentDiv]"),{id:"svAgent"},{isMandatory:!0,inputHeaderName:ZPI18N.getString("zp.agent")}),data.enable_hrcase&&data.hasOwnProperty("agentDetails")){parentId.find("#svAgentDiv").removeClass("zp_dyn"),parentId.find("#enbHRC").attr("checked","checked"),ownerImage=data.agentDetails.agentTypeId==OWNER_EMPLOYEE.toString()?ZPeople.getUserDetailsById(data.agentDetails.agentValueId).avatar:"";var selectedValObj={id:data.agentDetails.agentValueId,text:data.agentDetails.owner,imageAlt:ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(data.agentDetails.owner))),image:ownerImage};parentId.find("#svAgent").zpselect({selectedVal:[selectedValObj],isMandatory:!0}),parentId.find("#svAgent").attr("agenttype",data.agentDetails.agentTypeId)}else ZPSelect.clearAllValues(parentId.find("#svAgent"));parentId.find("#enbHRC").off("click").on("click",function(){$(this).is(":checked")?parentId.find("#svAgentDiv").removeClass("zp_dyn"):parentId.find("#svAgentDiv").addClass("zp_dyn")})}var referencesObjects;(referencesObjects=data.hasOwnProperty("assoContents")?data.assoContents:[]).length>0&&$.each(referencesObjects,function(i,v){switch(v.formType){case LINK_URL:var linkHtml=HRCategory.ConfigureCategory.cloneAssociatedURLBox("edit");$(linkHtml).insertBefore(parentId.find("div.zp_Add"));var contObj=parentId.find("div[contType]").last();$(contObj).find("#linkUrl").val(decodeURIComponent(v.link));break;case LINK_FILE:var linkName=v.hasOwnProperty("filePath")?v.filePath.split("/")[v.filePath.split("/").length-1]:v.link.split("/")[v.link.split("/").length-1],fileHtml=HRCategory.ConfigureCategory.cloneAssociatedDocumentsBox("edit");$(fileHtml).insertBefore(parentId.find("div.zp_Add"));contObj=parentId.find("div[contType]").last();$(contObj).find("#fName").html(linkName),$(contObj).attr("linkId",v.linkId)}contObj=parentId.find("div[contType]").last();$(contObj).attr("linkId",v.linkId),$(contObj).find("input[type=text]").attr("disabled",!0),""==v.linkName&&$(contObj).find("#linkDispName").closest("div.zp_fm").remove(),$(contObj).find("#linkDispName").val(ZPeople.decodeTxt(v.linkName))}),CommonTemplates.openSlider(ZPI18N.getString("zp.settings")),parentId.find("#submitBtn").off("click"),parentId.find("#submitBtn").on("click",function(){ZPServices.Edit.updateService(data.dispName,data.tabName)}),parentId.find("[name=closeSlider]").off("click").on("click",function(){parentId.remove()})},updateService:function(serviceDispName,serviceLName){var pageId=$("#"+Layout.Page.pageId),parentId=pageId.find("#sliderPopup");CommonTemplates.waitTillSave("submitBtn"),CommonTemplates.removeErrorMessagesinContainerDiv("sliderPopup");var servDtl={},srName=parentId.find("#svName").val(),srSDesc=parentId.find("#svSDesc").val(),sragentTypeId=void 0==parentId.find("#svAgent").attr("agenttype")?"":parentId.find("#svAgent").attr("agenttype"),sragentValueId=void 0==parentId.find("#svAgent").attr("selectedIds")?"":parentId.find("#svAgent").attr("selectedIds"),srIcon=parentId.find("#serIcon").find("i").attr("class");srIcon=srIcon.replace("zp_Si","");var srvIcon=Icons.getIconName(srIcon.trim());servDtl={serviceLName:serviceLName,serviceName:srName,serviceDescription:srSDesc,serviceIcon:srvIcon};var formData=new FormData;formData.append("conreqcsr",csrfToken),$.isEmptyObject(ZPTabs.getSelectedTab("hrcase"))||(parentId.find("#enbHRC").is(":checked")&&""==sragentValueId&&CommonTemplates.setErrorMessageinTextBox(parentId.find("#svAgent"),ZPI18N.getString("zp.selectagent")),servDtl.enable_hrcase=parentId.find("#enbHRC").is(":checked")&&""!=sragentValueId,servDtl.enable_hrcase&&(servDtl.agentType=sragentTypeId,servDtl.agentValue=sragentValueId));var assoContents=[],deleteLinks=[],filecount=0;parentId.find("div[conttype]:not([class=zp_dyn]):not([linkId])").each(function(i){var refObj={};refObj=HRCategory.ConfigureCategory.validateContentBox($(this),filecount,formData),$(this).attr("contType")==LINK_FILE&&(filecount=refObj.file_count),refObj.hasOwnProperty("isError")&&1==refObj.isError?HRCategory.ConfigureCategory.cancelContentBox(this):(refObj.linkOrder=i+1,assoContents.push(refObj))}),parentId.find("div.zp_dyn[linkId]").each(function(i){deleteLinks.push($(this).attr("linkId"))}),servDtl.assoContents=assoContents,servDtl.deleteLinks=deleteLinks.join(","),formData.append("serviceDtls",JSON.stringify(servDtl)),ZPServices.Configure.validateServiceName("sliderPopup",serviceDispName),ZPServices.Configure.validateSDesc("sliderPopup","svSDesc"),parentId.find("span[class=etxt]:not([class=zp_dyn])").length>0?CommonTemplates.saveComplete("submitBtn"):$.ajax({url:"/services.zp?mode=update",type:"POST",data:formData,processData:!1,contentType:!1,async:!1,error:function(xhr){CommonTemplates.saveComplete("submitBtn");var error_response=JSON.parse(xhr.responseText);ZPeople.Message.showFailureMsg(error_response.error)},success:function(data){CommonTemplates.saveComplete("submitBtn"),"success"==data.status?(ZPServices.View.basicTabDetails(data),pageId.find("#edSrv").off("click").on("click",function(){ZPServices.Edit.editService(data)}),ZPServices.addUpdateService(data.id,data.tabName,data.dispName,data.desc,data.icon,data.categoryId,servDtl.enable_hrcase),parentId.find("[name=closeSlider]").trigger("click")):ZPeople.Message.showFailureMsg(data.msg)}})}};var OWNER_EMPLOYEE=1,OWNER_DEPARTMENT=2,OWNER_GROUP=3,OWNER_INTERNAL_GROUP=4,OWNER_ROLE=5,OWNER_SYSTEM=11,LINK_URL="0",LINK_FILE="2",STATUS={},FEEDSTATUS={},HR_CASE_ATTACHEMENTS="1",HR_CATEGORY_ATTACHEMENTS="2",HRCASE_FAQ_ATTACHEMENTS="3",SUBMIT_CASE="submitCase",DEFAULT_GENERAL_CATEGORY="1",LOCATION_DROPDOWN={},RECORDS_PER_PAGE=25,SUBCGY_LISTING="subCategoryListing",USER_CGY_LISTING="userListing",ADMIN_CGY_LISTING="adminListing",AGENT_CGY_LISTING="agentListing",CGYADMIN_AGENT_CGY_LISTING="categoryAdminAndAgentListing",USER_VIEW="userView",REQ_TYPE_MYREQUEST=(ADMIN_VIEW="adminView","myRequest"),REQ_TYPE_MYCASES="myCase",REQ_TYPE_ALLCASES="allCase",REQ_TYPE_REPORTS="reports",REQ_TYPE_UNASSIGNCASES="unassignCases",REQ_TYPE_FOLLOWS="followedCases",REQ_TYPE_UNMANAGED="unmanagedCases",REQ_TYPE_OPENCASE="openCase",REQ_TYPE_ESCALATION="escalatedCases",REQ_TYPE_OVERALL="overall",REQ_TYPE_AGENT_REQVSCLOSED="agentreqvsclosed",REQ_TYPE_ADMIN_REQVSCLOSED="adminreqvsclosed",REQ_TYPE_AGENT_ESCALATEDREPORT="agentescalatedreport",REQ_TYPE_ADMIN_ESCALATEDREPORT="adminescalatedreport",CASE_WORKFLOW="caseworkflow",REQ_TYPE_FAQ="faq",ADMIN_REPORT="adminreport",USER_REPORT="userreport",AGENT_REPORT="agentreport",MY_REPORT="myreport",HRCaseTableName="P_HR_Case",POST="POST",HR_CASE_FORMID="",URL_MYREQ="#hrcase/myrequest/list",URL_UNMANAGED="#hrcase/unmanaged/list",URL_WATCHLIST="#hrcase/watchlist/list",URL_ESCALATION="#hrcase/escalation/list",URL_ALLCASE="#hrcase/allcases/list",URL_MYCASE="#hrcase/list",URL_UNASSIGNED="#hrcase/unassigned/list",URL_OPENCASES="#hrcase/opencases/list",URL_REQVSCLOSED="#hrcase/reports/requestedvsclosed",URL_OVERALLREPORT="#hrcase/reports/overallreport",URL_ESCALATEDREPORT="#hrcase/reports/escalationreport",URL_SELFSERVICE_MYCASE="#selfservice/mycases/list",URL_SELFSERVICE_MYREQ="#selfservice/cases/list",CasesImport={isCasePage:function(){return 0==Layout.Page.pageId.indexOf("hrcase-")},loadTemplate:function(){var formObj=$("<form id='zp_cases_export_form' action='casesSampleTemplate.zp' method='post' target='exportresp1' style='display:none'/>").html("");formObj.append('<input type="hidden" value="'+csrfToken+'" name="conreqcsr"/>'),formObj.append('<input type="hidden" value="sampleTemplateDownLoad" name="method"/>'),$("body").append(formObj),formObj.trigger("submit")},init:function(){CasesImport.getFormId()},getFormId:function(){""==HR_CASE_FORMID&&ZPeople.Request.send("/getFormId.zp",{method:"getFormId",conreqcsr:csrfToken,tableName:"P_HR_Case"},function(data){HR_CASE_FORMID=data.formId})},getMoreOption:function(liObj,srcObj){"hrimport"==$(liObj).attr("id")?Import.init(HR_CASE_FORMID,void 0,Layout.Page.hash):"hrexport"==$(liObj).attr("id")&&ZPExport.showExportContainer(CasesImport.exportData,"HrCase")},showImpExpDropDown:function(obj){var url=Layout.Page.hash,moreOption=[],optionClass=[],ids=[];HRCase.CASES_ADMIN.isAdmin&&-1!==url.indexOf("#hrcase/allcases/list")&&(moreOption.push(ZPI18N.getString("zp.import")),optionClass.push("IC-imprt"),ids.push("hrimport")),moreOption.push(ZPI18N.getString("zp.export")),optionClass.push("IC-exprt"),ids.push("hrexport");var params=[];$.each(moreOption,function(key,value){var param1={id:ids[key],value:value,iconClass:optionClass[key]};params.push(param1)});var menuProp;menuProp={id:"import",data:params,width:140,position:ZPArrow.BOTTOM_RIGHT,oneTimeMenu:!0,callback:function(liObj,srcObj){CasesImport.getMoreOption(liObj,srcObj)}},$(obj).zparrowmenu(menuProp)},exportData:function(mode,params,ftype){var url=Layout.Page.hash;mode=CasesImport.getExportUrlMode();0==$("#zp_cases_export_form").length&&$("body").append('<form id="zp_cases_export_form" action="CasesExportData.zp" method="post" name="zp_cases_export_form" style="display: none;" target="exportresp"></form>');var formObj=$("#zp_cases_export_form").html("");formObj.append('<input type="hidden" value="'+mode+'" name="url_mode"/>'),formObj.append('<input type="hidden" value="exportData" name="method"/>'),formObj.append('<input type="hidden" value="'+ftype+'" name="fType"/>'),formObj.append('<input type="hidden" value="'+csrfToken+'" name="'+csrfParamName+'"/>'),formObj.append('<input type="hidden" value="1" name="index"/>');var exportJSON={};(exportJSON=mode==REQ_TYPE_OVERALL||mode==REQ_TYPE_AGENT_REQVSCLOSED||mode==REQ_TYPE_ADMIN_REQVSCLOSED||mode==REQ_TYPE_AGENT_ESCALATEDREPORT||mode==REQ_TYPE_ADMIN_ESCALATEDREPORT?HRCReport.getCurrentListParams(url):HRCase.SearchFilter.searchHrcase(!1,!0)).hasOwnProperty("mode")&&formObj.append('<input type="hidden" value="'+exportJSON.mode+'" name="mode"/>'),exportJSON.hasOwnProperty("status")&&formObj.append('<input type="hidden" value="'+exportJSON.status+'" name="status"/>'),exportJSON.hasOwnProperty("requestorErecno")&&formObj.append('<input type="hidden" value="'+exportJSON.requestorErecno+'" name="requestorErecno"/>'),exportJSON.hasOwnProperty("query")&&formObj.append('<input type="hidden" value="'+exportJSON.query+'" name="query"/>'),exportJSON.hasOwnProperty("categoryId")&&formObj.append('<input type="hidden" value="'+exportJSON.categoryId+'" name="categoryId"/>'),exportJSON.hasOwnProperty("periodOfTime")&&formObj.append('<input type="hidden" value="'+exportJSON.periodOfTime+'" name="periodOfTime"/>'),exportJSON.hasOwnProperty("type")&&formObj.append('<input type="hidden" value="'+exportJSON.type+'" name="type"/>'),exportJSON.hasOwnProperty("searchtype")&&formObj.append('<input type="hidden" value="'+exportJSON.searchtype+'" name="searchtype"/>'),exportJSON.hasOwnProperty("requestorType")&&formObj.append('<input type="hidden" value="'+exportJSON.requestorType+'" name="requestorType"/>'),exportJSON.hasOwnProperty("agenterecno")&&void 0!=exportJSON.agenterecno&&formObj.append('<input type="hidden" value="'+exportJSON.agenterecno+'" name="tempAgentErecno"/>'),exportJSON.hasOwnProperty("from")&&formObj.append('<input type="hidden" value="'+exportJSON.from+'" name="from"/>'),exportJSON.hasOwnProperty("to")&&formObj.append('<input type="hidden" value="'+exportJSON.to+'" name="to"/>'),exportJSON.hasOwnProperty("reqType")&&formObj.append('<input type="hidden" value="'+exportJSON.reqType+'" name="reqType"/>'),exportJSON.hasOwnProperty("subcategoryId")&&formObj.append('<input type="hidden" value="'+exportJSON.subcategoryId+'" name="subcategoryId"/>');formObj.append('<input type="hidden" value="" name="selectedFields"/>'),formObj.trigger("submit")},getExportUrlMode:function(){var url=Layout.Page.hash,mode="";switch(url){case URL_MYREQ:mode=REQ_TYPE_MYREQUEST;break;case URL_UNMANAGED:mode=REQ_TYPE_UNMANAGED;break;case URL_WATCHLIST:mode=REQ_TYPE_FOLLOWS;break;case URL_ESCALATION:mode=REQ_TYPE_ESCALATION;break;case URL_MYCASE:mode=REQ_TYPE_MYCASES;break;case URL_ALLCASE:mode=REQ_TYPE_ALLCASES;break;case URL_UNASSIGNED:mode=REQ_TYPE_UNASSIGNCASES;break;case URL_OPENCASES:mode=REQ_TYPE_OPENCASE;break;case URL_OVERALLREPORT:mode=REQ_TYPE_OVERALL;break;case URL_REQVSCLOSED:mode=HRCReport.Mycases?REQ_TYPE_AGENT_REQVSCLOSED:REQ_TYPE_ADMIN_REQVSCLOSED;break;case URL_SELFSERVICE_MYCASE:mode=REQ_TYPE_MYCASES;break;case URL_SELFSERVICE_MYREQ:mode=REQ_TYPE_MYREQUEST;break;case URL_ESCALATEDREPORT:mode=HRCReport.Mycases?REQ_TYPE_AGENT_ESCALATEDREPORT:REQ_TYPE_ADMIN_ESCALATEDREPORT}return""==mode&&-1!==url.indexOf("/allcases/list")&&(mode=REQ_TYPE_ALLCASES),mode}},HRCategory={CATEGORY_LIST:[],USERVIEW_CATEGORY_LIST:[],ADMINVIEW_CATEGORY_LIST:[],AGENTVIEW_CGY_LIST:[],CGYADMIN_AGENT_CGY_LIST:[],SUBCATEGORY_LIST:{},REORDER:!1,cgydropdown:function(mode,categoryId){var allfn,params=[],categoryList=[];switch(mode=void 0==mode?SUBMIT_CASE:mode){case SUBMIT_CASE:$.isEmptyObject(HRCategory.CATEGORY_LIST)&&HRCategory.getCgyList(mode),categoryList=HRCategory.CATEGORY_LIST;break;case USER_CGY_LISTING:$.isEmptyObject(HRCategory.USERVIEW_CATEGORY_LIST)&&HRCategory.getCgyList(mode),categoryList=HRCategory.USERVIEW_CATEGORY_LIST;break;case ADMIN_CGY_LISTING:$.isEmptyObject(HRCategory.ADMINVIEW_CATEGORY_LIST)&&HRCategory.getCgyList(mode),categoryList=HRCategory.ADMINVIEW_CATEGORY_LIST;break;case AGENT_CGY_LISTING:$.isEmptyObject(HRCategory.AGENTVIEW_CGY_LIST)&&HRCategory.getCgyList(mode),categoryList=HRCategory.AGENTVIEW_CGY_LIST;break;case CGYADMIN_AGENT_CGY_LISTING:$.isEmptyObject(HRCategory.CGYADMIN_AGENT_CGY_LIST)&&HRCategory.getCgyList(mode),categoryList=HRCategory.CGYADMIN_AGENT_CGY_LIST;break;case SUBCGY_LISTING:return ZPUtil.Validation.isEmpty(categoryId)?categoryList=[]:(void 0==HRCategory.SUBCATEGORY_LIST[categoryId]&&HRCategory.getSubCgyList(categoryId),categoryList=HRCategory.SUBCATEGORY_LIST[categoryId]),$.each(categoryList,function(index,value){var param1={};param1.value=value.subcategoryname,param1.id=value.subCategoryId,params.push(param1)}),{id:"subcgyList",search:!0,data:params}}return allfn=HRCases.changeIconAddCase,$.each(categoryList,function(index,value){var param1={};param1.value=value.categoryName,param1.id=value.categoryId,param1.icon=value.categoryIcon,param1.iconClass="zp_Si "+Icons.getIconClass(this.categoryIcon).iconClass,params.push(param1)}),{id:"cgyList",search:!0,data:params,callback:allfn}},userDetails:{},getCgyList:function(mode){var caseCatalog={method:"fetchCategoryList",conreqcsr:csrfToken,mode:mode};$.ajax({url:"/listAllCatalogs.zp",type:"POST",data:caseCatalog,async:!1,success:function(data){switch(mode){case SUBMIT_CASE:HRCategory.CATEGORY_LIST=data;break;case USER_CGY_LISTING:HRCategory.USERVIEW_CATEGORY_LIST=data;break;case ADMIN_CGY_LISTING:HRCategory.ADMINVIEW_CATEGORY_LIST=data;break;case AGENT_CGY_LISTING:HRCategory.AGENTVIEW_CGY_LIST=data;break;case CGYADMIN_AGENT_CGY_LISTING:HRCategory.CGYADMIN_AGENT_CGY_LIST=data}$.each(data,function(i,v){HRCategory.SUBCATEGORY_LIST[v.categoryId]=v.subCategories})}})},getSubCgyList:function(categoryId){var params={method:"fetchSubCategoryList",conreqcsr:csrfToken,categoryId:categoryId};ZPeople.Request.sendAsyncPost("/fetchSubCategoryList.zp",params,function(data){HRCategory.SUBCATEGORY_LIST[categoryId]=data.subCategoryArray})}},HRCase={OPEN_SID:"1",INPROGRESS_SID:"2",AWAITING_SID:"3",ONHOLD_SID:"4",COMPLETED_SID:"5",CANCELLED_SID:"6",SPC_SEARCH:!1,PICK_CASE_ROW:"1",PICK_CASE_VIEW:"2",PICK_CASE_FEEDS:"3",MYREQ_CASE_PARAM:{},MYCASE_CASE_PARAM:{},UNASSIGN_CASE_PARAM:{},ALLCASE_CASE_PARAM:{},WATCHLIST_CASE_PARAM:{},OPEN_CASE_PARAM:{},UNMANAGED_CASE_PARAM:{},ESCALATAION_CASE_PARAM:{},ASSIGNEE_LIST:{},STATUS:{},PRIORITY:{},ALLPRIORITY:{},SOURCE:{},CASETYPE:{},HIGH_SID:"12",MEDIUM_SID:"11",LOW_SID:"10",WEB_SID:"1",CHAT_SID:"2",INPERSON_SID:"3",EAMIL_SID:"4",PHONE_SID:"5",HIGH_SID:"12",MEDIUM_SID:"11",LOW_SID:"10",MAIL_MODE:"hrCaseMailNotify",CASES_ADMIN:{},fetchAdminPerm:function(){var isCasesAdmin=-1!==JSON.stringify(ZPTabs.getSelectedTab("hrcase")).indexOf('"isTabAdmin":true');HRCase.CASES_ADMIN.isAdmin=isCasesAdmin,HRCase.CASES_ADMIN.hasOwnProperty("categoryAdmin")||ZPeople.Request.sendAsyncPost("/getUserOwnedCategories.zp",{method:"getCategoriesAsAdmin",conreqcsr:csrfToken},function(data){HRCase.CASES_ADMIN.categoryAdmin=data})},isCaseAdmin:function(categoryId){return $.isEmptyObject(HRCase.CASES_ADMIN)&&HRCase.fetchAdminPerm(),void 0!=categoryId&&void 0!=HRCase.CASES_ADMIN.categoryAdmin&&-1!=HRCase.CASES_ADMIN.categoryAdmin.indexOf(categoryId)||HRCase.CASES_ADMIN.isAdmin},init:function(){var url=Layout.Page.hash;HRCase.fetchAdminPerm(),Layout.Page.container.addClass("hrcases");var pageId=Layout.Page.container;$.isEmptyObject(HRCase.STATUS)&&HRCases.getStatusList(),$.isEmptyObject(HRCase.PRIORITY)&&HRCases.getPriorityList(),$.isEmptyObject(HRCase.SOURCE)&&HRCases.getSourceList(),pageId.find("#showNotes").hasClass("shw")&&pageId.find("#showNotes").removeClass("shw"),HRCase.SearchFilter.constructFilterOptions(),"#hrcase/list/kanbanView"!=url&&"#allcases/list/kanbanView"!=url||HRCase.KanbanView.showKanbanView(),"#hrcase/list"!=url&&-1===url.indexOf("#hrcase/myrequest/list")&&-1===url.indexOf("#hrcase/allcases/list")&&-1===url.indexOf("#hrcase/unassigned/list")&&-1===url.indexOf("#hrcase/watchlist/list")&&-1===url.indexOf("#hrcase/escalation/list")&&-1===url.indexOf("#hrcase/opencases/list")&&-1===url.indexOf("#hrcase/unmanaged/list")||(HRCaseAction.closepreview(),(HRCase.CASES_ADMIN.isAdmin||HRCase.CASES_ADMIN.hasOwnProperty("categoryAdmin")&&HRCase.CASES_ADMIN.categoryAdmin.length>0)&&void 0!=Layout.Page.urlparam.categoryid&&void 0!=Layout.Page.urlparam.status&&-1!==url.indexOf("#hrcase/allcases/list")?(HRCase.SPC_SEARCH=!0,HRCase.List.getAllCasesList(1)):HRCase.SPC_SEARCH&&-1!==url.indexOf("#hrcase/allcases/list")&&(HRCase.SPC_SEARCH=!1,HRCase.List.getAllCasesList(1)),pageId.removeClass("zp_Pshw")),-1===url.indexOf("#hrcase/list/view")&&-1===url.indexOf("#hrcase/opencases/view")&&-1===url.indexOf("#hrcase/myrequest/view")&&-1===url.indexOf("#hrcase/allcases/view")&&-1===url.indexOf("#hrcase/unassigned/view")&&-1===url.indexOf("#hrcase/watchlist/view")&&-1===url.indexOf("#hrcase/escalation/view")&&-1===url.indexOf("#hrcase/unmanaged/view")||(AdvancedFilter.hideFilter(),HRCase.DetailedView.newviewCaseDetails(Layout.Page.childUrlParam.caseid),-1!==url.indexOf("#hrcase/myrequest/view")&&void 0!=Layout.Page.childUrlParam.feedbackid&&""!=Layout.Page.childUrlParam.feedbackid&&CasesFeedback.postFeedbackPopUp(Layout.Page.childUrlParam.caseid,Layout.Page.childUrlParam.feedbackid))},getStatusName:function(statusId){var statusName="";return $.each(HRCase.STATUS,function(key){if(HRCase.STATUS[key]==statusId)return statusName=key,!0}),statusName},getCaseFormid:function(){if(void 0===HRCase.caseformid){var param={method:"getCaseFormid",conreqcsr:csrfToken};$.ajax({url:"/caseformid.zp",type:"POST",data:param,async:!1,success:function(data){HRCase.caseformid=data.caseformid}})}return HRCase.caseformid},AgentAddMode:"AGENT",ManagerAddMode:"MANAGER"};HRCase.Header={headerDiv:function(headerName,iconClass,isService,backbtn){var serviceIcon=isService?'<img src="'+ZPeople.getResourceURL(newUIImageUrl+"svg/app.svg")+'" name="gotoservice" data-toggle="tooltip" data-placement="right" title="'+ZPI18N.getString("zp.goto",new Array(ZPI18N.getString("zp.service")))+'">':"";return'<h2 id="hdName">'+(backbtn=void 0!=backbtn?backbtn:"")+(void 0!=iconClass&&""!=iconClass?'<i class="zp_Si '+iconClass+'"></i>':"")+(void 0!=headerName&&""!=headerName?'<font id="cName" >'+headerName+serviceIcon+"</font>":"")+"</h2>"},getCaseHeader:function(mode,origin){CasesImport.init();var pageId=Layout.Page.container,titleDiv="",reportDW="",iconDiv='<div class="zp_frt zp_micn">',subHeaderDiv="",selfserviceHeader='<div class="ZPcalvw-tphd-fr"> <div class="ZPcalvw-tphd-lt"><ul class="dash-tabs" role="tablist"><li id="myreq"><a onclick="SelfService.Cases.toggleView(this)">'+ZPI18N.getString("zp.myrequests")+'</a></li><li id="mycase"><a onclick="SelfService.Cases.toggleView(this)">'+ZPI18N.getString("zp.mycases")+"</a></li></ul></div></div>";mode==REQ_TYPE_MYREQUEST&&(titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.myrequests")),"selfservice"==origin&&(titleDiv+=selfserviceHeader),subHeaderDiv+=HRCase.Header.getSubHeader({id:"caseScrollHead",headers:[{classNm:"zp_Ldtl",name:ZPI18N.getString("zp.casedetails")},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.category")},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.status")}]})),mode==REQ_TYPE_OPENCASE&&(titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.opencases")),subHeaderDiv+=HRCase.Header.getSubHeader({id:"caseScrollHead",headers:[{classNm:"zp_Ldtl",name:ZPI18N.getString("zp.casedetails")},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.category"),filterClassNm:"IC-filter-line"},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.status")},{classNm:"zp_Lass",name:ZPI18N.getString("zp.assignedto")},{classNm:"zp_Lrgt"}]})),mode==REQ_TYPE_UNMANAGED?(titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.unmanagedcases")),subHeaderDiv+=HRCase.Header.getSubHeader({id:"caseScrollHead",headers:[{classNm:"zp_Ldtl",name:ZPI18N.getString("zp.casedetails")},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.category"),filterClassNm:"IC-filter-line"},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.status")}]})):mode==REQ_TYPE_MYCASES?(titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.mycases")),"selfservice"==origin&&(titleDiv+=selfserviceHeader),subHeaderDiv+=HRCase.Header.getSubHeader({id:"caseScrollHead",headers:[{classNm:"zp_Ldtl",name:ZPI18N.getString("zp.casedetails")},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.category"),filterClassNm:"IC-filter-line"},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.status")}]})):mode==REQ_TYPE_ALLCASES?("selfservice"==origin?(titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.mycases")),titleDiv+=selfserviceHeader):titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.allcases")),subHeaderDiv+=HRCase.Header.getSubHeader({id:"caseScrollHead",headers:[{classNm:"zp_Ldtl",name:ZPI18N.getString("zp.casedetails")},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.category"),filterClassNm:"IC-filter-line"},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.status")},{classNm:"zp_Lass",name:ZPI18N.getString("zp.assignedto")},{classNm:"zp_Lrgt"}]})):mode==REQ_TYPE_UNASSIGNCASES?(titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.unpickedcases")),subHeaderDiv+=HRCase.Header.getSubHeader({id:"caseScrollHead",headers:[{classNm:"zp_Ldtl",name:ZPI18N.getString("zp.casedetails")},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.category"),filterClassNm:"IC-filter-line"},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.status")},{classNm:"zp_Lass",name:ZPI18N.getString("zp.assignedto")},{classNm:"zp_Lrgt"}]})):mode==REQ_TYPE_FOLLOWS?(titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.watchlist")),subHeaderDiv+=HRCase.Header.getSubHeader({id:"caseScrollHead",headers:[{classNm:"zp_Ldtl",name:ZPI18N.getString("zp.casedetails")},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.category"),filterClassNm:"IC-filter-line"},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.status")},{classNm:"zp_Lass",name:ZPI18N.getString("zp.assignedto")},{classNm:"zp_Lrgt"}]})):mode==REQ_TYPE_ESCALATION?(titleDiv+=HRCase.Header.headerDiv(ZPI18N.getString("zp.escalatedcases")),subHeaderDiv+=HRCase.Header.getSubHeader({id:"caseScrollHead",headers:[{classNm:"zp_Ldtl",name:ZPI18N.getString("zp.casedetails")},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.category"),filterClassNm:"IC-filter-line"},{classNm:"zp_Lsts",name:ZPI18N.getString("zp.status")},{classNm:"zp_Lass",name:ZPI18N.getString("zp.assignedto")},{classNm:"zp_Lrgt"}]})):mode==MY_REPORT&&(titleDiv+='<h2 class="zp_rpHd" id="cgyFilterReport"><i class="zp_app50 zp_Si" id="iconclass"></i><font id="category">All Categories</font></h2>',reportDW+='<div class="zp_frt zp_micn"><ul id="caseToggle"><li><div class=""><a onclick="HRCReport.reloadMyReport(true);" id="agentView" class="sel">Agent View</a></div></li><li><div class=""><a onclick="HRCReport.reloadMyReport(false);" id="adminView">Admin View</a></div></li></ul></div> '),iconDiv+=mode!=REQ_TYPE_UNASSIGNCASES&&mode!=MY_REPORT?CommonTemplates.getIconMenuBar([{attributes:{onclick:"AdvancedFilter.showHidefilter()"},iconsList:[{class:"IC-filter-l"}]},{attributes:{onclick:"CasesImport.showImpExpDropDown(this)"},iconsList:[{class:"IC-more"}]}]):"",iconDiv+=mode==REQ_TYPE_UNASSIGNCASES?CommonTemplates.getIconMenuBar([{attributes:{onclick:"CasesImport.showImpExpDropDown(this)"},iconsList:[{class:"IC-more"}]}]):"",iconDiv+="</div>",Layout.Page.container.find("[name=headerposition]").empty().append(titleDiv+iconDiv+reportDW),mode!=MY_REPORT&&(pageId.find("#caseScrollHead").remove(),pageId.find("[name=caseListView]").before(subHeaderDiv))},getSubHeader:function(properties){var html="",hdrId=properties.hasOwnProperty("id")?'id="'+properties.id+'"':"";return $.each(properties.headers,function(i,value){html+="<div class="+value.classNm+">",html+=void 0!=value.name?"<font><em>"+value.name+"</em> </font> ":"",html+=void 0!=value.filterClassNm?"<i class="+value.filterClassNm+' id="cgyFilter"></i>':"",html+="</div>"}),html="<div "+hdrId+' class="zp_Lttl"><div class="zp_Lst"><div>'+html+"</div></div></div>"},getFooter:function(mode,sCount,isFilterSearch){var pageId=Layout.Page.container;pageId.find("[name=footerposition]").hasClass("zp_dyn")&&pageId.find("[name=footerposition]").removeClass("zp_dyn");var statusArr={};return mode==REQ_TYPE_ALLCASES||mode==REQ_TYPE_MYREQUEST||mode==REQ_TYPE_FOLLOWS||mode==REQ_TYPE_MYCASES||mode==REQ_TYPE_OPENCASE||mode==REQ_TYPE_ESCALATION?(statusArr[1]={attributes:{id:"openedCase",value:HRCase.OPEN_SID,class:HRCase.List.getStatusColorClass(HRCase.OPEN_SID)},onclick:"HRCase.SearchFilter.getQuickFilterList('status','"+HRCase.OPEN_SID+"',this)"},statusArr[2]={attributes:{id:"inProgressCase",value:HRCase.INPROGRESS_SID,class:HRCase.List.getStatusColorClass(HRCase.INPROGRESS_SID)},onclick:"HRCase.SearchFilter.getQuickFilterList('status','"+HRCase.INPROGRESS_SID+"',this)"},statusArr[3]={attributes:{id:"awaitingReqCase",value:HRCase.AWAITING_SID,class:HRCase.List.getStatusColorClass(HRCase.AWAITING_SID)},onclick:"HRCase.SearchFilter.getQuickFilterList('status','"+HRCase.AWAITING_SID+"',this)"},statusArr[4]={attributes:{id:"onHoldCase",value:HRCase.ONHOLD_SID,class:HRCase.List.getStatusColorClass(HRCase.ONHOLD_SID)},onclick:"HRCase.SearchFilter.getQuickFilterList('status','"+HRCase.ONHOLD_SID+"',this)"},mode!=REQ_TYPE_OPENCASE&&(statusArr[5]={attributes:{id:"closedCase",value:HRCase.COMPLETED_SID,class:HRCase.List.getStatusColorClass(HRCase.COMPLETED_SID)},onclick:"HRCase.SearchFilter.getQuickFilterList('status','"+HRCase.COMPLETED_SID+"',this)"}),mode==REQ_TYPE_MYREQUEST&&(statusArr[6]={attributes:{id:"cancelledCase",value:HRCase.CANCELLED_SID,class:HRCase.List.getStatusColorClass(HRCase.CANCELLED_SID)},onclick:"HRCase.SearchFilter.getQuickFilterList('status','"+HRCase.CANCELLED_SID+"',this)"})):mode==REQ_TYPE_UNASSIGNCASES?statusArr[7]={attributes:{id:"unassigned",value:"1,2,3,4",class:"zp_gclr"}}:mode==REQ_TYPE_UNMANAGED&&(statusArr[8]={attributes:{id:"unmanaged",class:"zp_gclr"}}),$.each(sCount,function(i,value){var sourceObj=statusArr[value.systemValue];void 0!=sourceObj&&(sourceObj.sequence=value.sequence,sourceObj.iconName=value.optionValue,void 0==isFilterSearch?void 0!=value.count?sourceObj.count=value.count:sourceObj.count=0:void 0!=value.count?sourceObj.count=value.count:delete statusArr[value.systemValue])}),(statusArr=Object.values(statusArr)).sort(function(a,b){return a.sequence-b.sequence}),CommonTemplates.getCountMenuBar(statusArr)}},HRCase.AddManualCase={resetPage:function(categoryid,mode,categoryData){if(mode==HRCase.AgentAddMode){var openstatus="",statusParams=[];$.each(HRCase.STATUS,function(key){if(HRCase.STATUS[key]!=HRCase.CANCELLED_SID){var param1={id:HRCase.STATUS[key],value:key};HRCase.STATUS[key]==HRCase.OPEN_SID&&(openstatus=key,param1.isDefaultValue=!0),statusParams.push(param1)}});var menuObj={id:"statusList",data:statusParams,callback:function(liObj,sourceObj){$(liObj).attr("id")!=HRCase.OPEN_SID?$("#caseresolutionDiv").find("#resolution").length<=0&&CommonTemplates.getInputTextBox({id:"resolution"},ZPI18N.getString("zp.resolution"),!1,$("#caseresolutionDiv")):ZPSelect.destroyMenu($("#caseresolutionDiv"))}};CommonTemplates.getSelectMenu(menuObj,$("#casestatusDiv"),{id:"statusId"},{isMandatory:!0,inputHeaderName:ZPI18N.getString("zp.status")}),$("#statusId").zpselect({selectedVal:[{id:HRCase.OPEN_SID,text:openstatus}],isMandatory:!0}),HRCase.AddManualCase.setPriortyOption($("#casepriorityDiv"),"priorityId","priorityList",HRCase.MEDIUM_SID,"addcase",null,!0)}var search={type:""};if($.isEmptyObject(categoryData)||(search=HRCase.AddManualCase.getEmpSearchType(categoryData)),""!=search.type){var extraparam={};search.hasOwnProperty("locids")&&(extraparam.locids=search.locids);var employeeMenuObj={id:"empList",data:function(initObj){return EmployeeDropdown.getEmpList($(initObj).val(),"emp",search.type,[],extraparam,!0)},callback:function(initObj){HRCase.CASES_ADMIN.isAdmin||erecno==$("#empInput").attr("selectedids")?HRCase.CASES_ADMIN.isAdmin||erecno!=$("#empInput").attr("selectedids")||$("#casesourceDiv").empty().removeClass("zp_fm"):HRCase.AddManualCase.setSourceOption($("#casesourceDiv"),"reqSourceId","reqSourceList",HRCase.WEB_SID,"addcase",null,!0,!0)}};CommonTemplates.getSelectMenu(employeeMenuObj,$("#csempDiv"),{id:"empInput"},{isMandatory:!0,inputHeaderName:ZPI18N.getString("zp.requestor")});var userDetails=ZPeople.getUserDetailsById(erecno),selectedValObj={id:erecno,text:userDetails.empid+" "+userDetails.name,imageAlt:ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(userDetails.empid+" "+userDetails.name))),image:userDetails.avatar};$("#empInput").zpselect({selectedVal:[selectedValObj],isMandatory:!0})}},setPriortyOption:function(ele,inputid,menuid,selectedValId,mode,caseid,hideMandatoryMark){var priorityParams=[];selectedValId=selectedValId||HRCase.MEDIUM_SID;$.each(HRCase.PRIORITY,function(key){var param1={id:HRCase.PRIORITY[key],value:key};HRCase.PRIORITY[key]==selectedValId&&(key,param1.isDefaultValue=!0),priorityParams.push(param1)});var menuObj={id:menuid,data:priorityParams,callback:function(liObj,sourceObj){if("caseview"==mode&&caseid&&HRCaseAction.caseviewoldpriority!=$(liObj).attr("id")){var pId=$(liObj).attr("id");HRCaseAction.caseviewoldpriority=pId,HRCaseAction.changePriorityOption(caseid,pId,sourceObj)}}};"caseview"==mode&&caseid&&(HRCaseAction.caseviewoldpriority=selectedValId),CommonTemplates.getSelectMenu(menuObj,ele,{id:inputid},{inputHeaderName:ZPI18N.getString("zp.priority"),isMandatory:!0,hideMandatoryMark:hideMandatoryMark,search:!1})},setSourceOption:function(ele,inputid,menuid,selectedValId,mode,caseid,_isMandatory,isDefaultSelectText){var selectedText="",sourceParams=[];selectedValId=selectedValId||HRCase.WEB_SID;$.each(HRCase.SOURCE,function(key){HRCase.SOURCE[key]==selectedValId&&(selectedText=key);var param1={id:HRCase.SOURCE[key],value:key};sourceParams.push(param1)});var menuObj={id:menuid,data:sourceParams,callback:function(liObj,sourceObj){if("caseview"==mode&&caseid){var pId=$(liObj).attr("id");HRCaseAction.changeSourceOption(caseid,pId,sourceObj)}}};CommonTemplates.getSelectMenu(menuObj,ele,{id:inputid,autocomplete:"off"},{inputHeaderName:ZPI18N.getString("zp.sourceofrequest"),isMandatory:!0,hideMandatoryMark:!0,search:!1}),$("#"+inputid).zpselect({selectedVal:[{id:selectedValId,text:selectedText}],isMandatory:_isMandatory})},getEmpSearchType:function(data){var search={type:"HRCASES_ADDCASE_RT"};return HRCase.CASES_ADMIN.isAdmin?search.type="HRCASES_ADDCASE_AGENT":data.isAgent&&data.hasOwnProperty("applicableLocations")&&data.applicableLocations.length<=0?search.type="HRCASES_ADDCASE_AGENT":data.isAgent&&data.hasOwnProperty("applicableLocations")&&data.applicableLocations.length>0?(search.type="HRCASES_ADDCASE_AGENT",search.locids=data.applicableLocations):!data.isAgent&&ZPeople.SUB_USERLIST.length>1?search.type="HRCASES_ADDCASE_RT":!data.isAgent&&ZPeople.SUB_USERLIST.length<=1&&(search.type=""),search}},HRCase.AddCase={validateSubject:function(headerDiv,currentId){var shortDesc=$("#"+headerDiv).find("#"+currentId).val();if(""==shortDesc.trim()||shortDesc.length>250){var errorMsg=ZPI18N.getString("zp.subjectemptymsg");shortDesc.length>250&&(errorMsg=ZPI18N.getString("zp.cannotexceedchar",new Array(ZPI18N.getString("zp.subject"),"250"))),CommonTemplates.setErrorMessageinTextBox($("#"+headerDiv).find("#"+currentId),errorMsg)}else CommonTemplates.removeErrorMessageinTextBox($("#"+headerDiv).find("#"+currentId))},resetPage:function(mode,categoryid){var cgyMode=SUBMIT_CASE,categoryData={};HRCategory.cgydropdown(cgyMode),void 0!=categoryid&&""!=categoryid&&($.each(HRCategory.CATEGORY_LIST,function(i,val){val.categoryId==categoryid&&(categoryData=val)}),$.isEmptyObject(categoryData)&&($.isEmptyObject(HRCategory.USERVIEW_CATEGORY_LIST)&&HRCategory.getCgyList(USER_CGY_LISTING),$.each(HRCategory.USERVIEW_CATEGORY_LIST,function(i,val){val.categoryId==categoryid&&(categoryData=val)}))),mode!=HRCase.AgentAddMode&&mode!=HRCase.ManagerAddMode||(HRCase.AddManualCase.resetPage(categoryid,mode,categoryData),cgyMode=mode==HRCase.AgentAddMode?AGENT_CGY_LISTING:SUBMIT_CASE),CommonTemplates.removeErrorMessagesinContainerDiv("addcaseContent"),$("#caseCgyDiv").empty(),void 0!=categoryid&&""!=categoryid||CommonTemplates.getSelectMenu(HRCategory.cgydropdown(cgyMode),$("#caseCgyDiv"),{id:"cgyId"},{isMandatory:!0,inputHeaderName:ZPI18N.getString("zp.category")}),$.isEmptyObject(HRCase.STATUS)&&HRCases.getStatusList(),$.isEmptyObject(HRCase.PRIORITY)&&HRCases.getPriorityList(),$.isEmptyObject(HRCase.SOURCE)&&HRCases.getSourceList(),$.isEmptyObject(HRCase.CASETYPE)&&HRCases.getCaseTypeList(),HRCase.AddManualCase.setPriortyOption($("#casepriorityDiv"),"priorityId","priorityList",HRCase.MEDIUM_SID,"addcase",null,!0),CommonTemplates.getInputTextIcon({id:"caseSubject"},{inputHeaderName:ZPI18N.getString("zp.subject"),isMandatory:!0,hideMandatoryMark:!1,noBorder:!1},$("#caseSubDiv")),EditorTemplate.editorConstruct("caseeditor",!0,"addcaseContent",!0,categoryData.isDescMandatory),EditorTemplate.replaceWithEditor("caseDescEditorContainer","descEditor",!0),HRCase.CASES_ADMIN.isAdmin&&HRCase.AddManualCase.setSourceOption($("#casesourceDiv"),"reqSourceId","reqSourceList",HRCase.WEB_SID,"addcase",null,!0,!0),void 0!=categoryid&&""!=categoryid?($("#submitCaseBtn").attr("onclick","HRCase.AddCase.submitCase('"+mode+"','"+categoryid+"')"),$("#addcaseHeader").html("<h3>"+ZPI18N.getString("zp.queryoncategory",[categoryData.categoryName])+"</h3>")):($("#submitCaseBtn").attr("onclick","HRCase.AddCase.submitCase('"+mode+"')"),$("#addcaseHeader").html("<h3>"+ZPI18N.getString("zp.askaquestion")+"</h3>")),$("#addcaseContent").find("div.attachedFile").remove();var isCaseTypeEnabled=!1;if($.each(HRCategory.CATEGORY_LIST,function(i,val){if(isCaseTypeEnabled=val.isCaseTypeEnabled,(void 0==categoryid||""==categoryid)&&val.typeOthers==DEFAULT_GENERAL_CATEGORY)return $("#cgyId").zpselect({selectedVal:[{id:val.categoryId,text:val.categoryName,iconClass:"zp_Si "+Icons.getIconClass(val.categoryIcon).iconClass}],isMandatory:!0}),void(categoryid=val.categoryId)}),void 0!=categoryid&&""!=categoryid){var selectedCgyId=categoryid;HRCaseBand.getCategoryView(selectedCgyId);var subCgyMenu=HRCategory.cgydropdown(SUBCGY_LISTING,selectedCgyId);subCgyMenu.data.length>0&&(categoryData.isSubCategoryMandatory&&(subCgyMenu.data[0].isDefaultValue=!0),CommonTemplates.getSelectMenu(subCgyMenu,$("#caseSubCgyDiv"),{id:"subCgyId"},{isMandatory:categoryData.isSubCategoryMandatory,hideMandatoryMark:!1,inputHeaderName:ZPI18N.getString("zp.subcategory")}))}if(isCaseTypeEnabled){var caseTypeParams=[];$.each(HRCase.CASETYPE,function(key){var param1={id:key,value:HRCase.CASETYPE[key]};caseTypeParams.push(param1)});var caseTypeMenuObj={id:"caseTypeList",data:caseTypeParams};CommonTemplates.getSelectMenu(caseTypeMenuObj,$("#caseTypeDiv"),{id:"caseTypeId",placeholder:ZPI18N.getString("zp.casetypeunspecified")},{isMandatory:!1,inputHeaderName:ZPI18N.getString("zp.casetype")})}$("#hcDFile").off("click").on("click",function(){HRCaseFileTag.fileUploadfn({id:"0"},$(this),"addcaseContent")}),$("#hcCFile").off("click").on("click",function(){HRCaseFileTag.fileUploadfn({id:"1"},$(this),"addcaseContent")}),$("#hcWFile").off("click").on("click",function(){HRCaseFileTag.fileUploadfn({id:"2"},$(this),"addcaseContent")})},checkEmptyError:function(id){var isEmpty=!1,value=$("#"+id).val();return"cgyId"!=id&&"empInput"!=id||(value=$("#"+id).attr("selectedids")),""!=value&&null!=value&&void 0!=value||(CommonTemplates.setErrorMessageinTextBox($("#"+id)),isEmpty=!0),isEmpty},showAskus:function(mode){var url=Layout.Page.hash;mode=void 0==mode?"":mode,-1!==url.indexOf("#hrcase/category/view")?HRCase.AddCase.addCasePage(mode,Layout.Page.childUrlParam.categoryid):HRCase.AddCase.addCasePage(mode)},addCasePage:function(mode,categoryid){Layout.Page.container.find("#addHRCase").attr("formid");$("#addHRCase").length<=0?HRCaseBand.serviceView(mode,categoryid):HRCase.AddCase.resetPage(mode,categoryid),$("#cgyId").prop("disabled",!1),$("#addHRCase").addClass("zp_shw"),setTimeout(function(){$("#caseSubject").trigger("focus")},300)},submitCase:function(mode,categoryId){var pageDiv=$("#addHRCase");CommonTemplates.removeErrorMessagesinContainerDiv("addcaseContent");var categoryid="",isCategoryEmpty=!0,priority="";$("#cgyId").length>0?(categoryid=$("#cgyId").attr("selectedids"),isCategoryEmpty=HRCase.AddCase.checkEmptyError("cgyId")):(categoryid=categoryId,isCategoryEmpty=!1);var caseSub=$("#caseSubject").val().trim().replace(/ +/g," "),caseDesc="",editor=ZPFeeds.Editor.editorList.descEditor;void 0!=editor&&(caseDesc=ZPFeeds.getSmileysAndMentions(editor.getContent(),!1)),HRCase.AddCase.validateSubject("addcaseContent","caseSubject");var isSubEmpty=HRCase.AddCase.checkEmptyError("caseSubject"),isEmpEmpty=!1;mode!=HRCase.AgentAddMode&&mode!=HRCase.ManagerAddMode||(isEmpEmpty=HRCase.AddCase.checkEmptyError("empInput"));if($("#addcaseContent").find("span[class=etxt]:not([class=zp_dyn])").length<=0&&!(isSubEmpty||isCategoryEmpty||isEmpEmpty)){CommonTemplates.waitTillSave("submitCaseBtn");var caseParams={categoryId:categoryid,subject:caseSub,conreqcsr:csrfToken,methodName:"addHRCase"};if($("#subCgyId").length>0&&!ZPUtil.Validation.isEmpty($("#subCgyId").attr("selectedIds"))&&(caseParams.subCategoryId=$("#subCgyId").attr("selectedIds")),(mode==HRCase.AgentAddMode||mode==HRCase.ManagerAddMode)&&(caseParams.employeeId=$("#empInput").attr("selectedids"),mode==HRCase.AgentAddMode&&$("#resolution").length>0)){var resolCmt=$("#resolution").val().trim().replace(/ +/g," ");caseParams.status=$("#statusId").attr("selectedids"),caseParams.messageText=resolCmt,caseParams.comment=resolCmt}var selectedIds=pageDiv.find("#priorityId").attr("selectedids");priority=void 0!=selectedIds&&""!=selectedIds?selectedIds:HRCase.MEDIUM_SID;caseParams.priority=priority;var source=void 0!=(selectedIds=pageDiv.find("#reqSourceId").attr("selectedids"))&&""!=selectedIds?selectedIds:HRCase.WEB_SID;caseParams.source=source;var caseType=void 0!=(selectedIds=pageDiv.find("#caseTypeId").attr("selectedids"))?selectedIds:"";if(caseParams.caseType=caseType,caseParams.description=caseDesc,$("#addcaseContent  div.attachedFile").length>0){var uploadFromCloud=[],uploadFromWD=[],uploadFromDesktop=[];if($("#addcaseContent  div.attachedFile").each(function(i){var uploadMode=$(this).data("uploadMode"),cloudUploadDoc=$(this).data("cloudUploadDoc"),WDUploadDoc=$(this).data("WDUploadDoc"),caseFileUpload=$(this).data("caseFileUpload");"cloudUpload"==uploadMode?uploadFromCloud.push(cloudUploadDoc):"localUpload"==uploadMode&&void 0!==caseFileUpload?uploadFromDesktop.push(caseFileUpload):"workDriveUpload"==uploadMode&&void 0!==WDUploadDoc&&uploadFromWD.push(WDUploadDoc)}),uploadFromDesktop.length>0&&(caseParams.case_attachment=JSON.stringify(uploadFromDesktop)),uploadFromCloud.length>0||uploadFromWD.length>0){var formData=new FormData;formData.append("loginUserZUID",_ZUIDENRYPT),formData.append("formId",0),formData.append("tableName","P_HR_Case"),formData.append("conreqcsr",csrfToken),formData.append("uploadFromCloud",JSON.stringify(uploadFromCloud)),formData.append("uploadFromWD",JSON.stringify(uploadFromWD)),formData.append("needJSONresponse",!0),$.ajax({url:"/fileUploadAction.zp",type:"POST",data:formData,contentType:!1,processData:!1,cache:!1,error:function(xhr){CommonTemplates.saveComplete("submitCaseBtn");var error_response=JSON.parse(xhr.responseText);ZPeople.Message.showFailureMsg(error_response.error)},success:function(data){if("7000"==data.code){var allFiles=[];$.each(data.message,function(i,v){var fileDetails={filePath:v.filePath,fileName:v.fileName};null==v.uploadSource||ZPSetupCommon.isEmpty(v.uploadSource)?fileDetails.uploadSource=0:fileDetails.uploadSource=v.uploadSource,allFiles.push(fileDetails)}),caseParams.case_attachment=JSON.stringify($.merge(allFiles,uploadFromDesktop)),HRCase.AddCase.addCaseRequest(caseParams,mode)}else CommonTemplates.saveComplete("submitCaseBtn"),ZPeople.Message.showFailureMsg(data.message)}})}else HRCase.AddCase.addCaseRequest(caseParams,mode)}else HRCase.AddCase.addCaseRequest(caseParams,mode)}},addCaseRequest:function(obj,mode){var params=obj;-1!==Layout.Page.hash.indexOf("hrcase/category/list")&&(params.fromCasePage=!0),ZPeople.Request.send("/addHrcase.zp",params,function(data){if(CommonTemplates.saveComplete("submitCaseBtn"),"success"==data.status){var tab="myrequest";params.hasOwnProperty("employeeId")&&params.employeeId!=erecno&&(tab="watchlist");var redirectToCase='<a href="#hrcase/'+tab+"/view-caseid:"+data.zp_recordId+'">'+ZPI18N.getString("zp.here")+"</a>";ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.viewqueryraise",[redirectToCase])),HRCase.AddCase.closePage()}else ZPeople.Message.showFailureMsg(data.desc);-1!==Layout.Page.hash.indexOf("#hrcase/askus")&&(window.location.href="#hrcase/home")},{},function(resultData){CommonTemplates.saveComplete("submitCaseBtn");var error_reponse=resultData.responseJSON;"case_attachment"==error_reponse.paramName&&"PATTERN_NOT_MATCHED"==error_reponse.code?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.projectattachmentnameerror")):ZPeople.Message.showFailureMsg(error_reponse.error),-1!==Layout.Page.hash.indexOf("#hrcase/askus")&&(window.location.href="#hrcase/home")})},closePage:function(){Layout.Page.container.removeClass("askCase"),$("#addHRCase").remove()}},HRCase.addCaseInWMS={getInstantCaseRow:function(data){Layout.Page.hash;var isRequestor=!1,isAgent=!1,isMemberAgent=!1,isFollower=!1,caseStatusId=data.hasOwnProperty("caseJobj")?data.caseJobj.statusId:"0",isOpenCase=data.hasOwnProperty("caseJobj")&&data.caseJobj.statusId!=HRCase.COMPLETED_SID&&data.caseJobj.statusId!=HRCase.CANCELLED_SID,isCategoryAdmin=data.hasOwnProperty("caseJobj")&&data.caseJobj.hasOwnProperty("isCategoryAdmin")&&data.caseJobj.isCategoryAdmin,isUnmanagedCase=data.hasOwnProperty("caseJobj")&&data.caseJobj.hasOwnProperty("isUnmanaged")&&data.caseJobj.isUnmanaged;if(data.isRequestor==erecno&&(isRequestor=!0),data.isAgent==erecno?isAgent=!0:"2"==data.isAgentType&&data.isMemberAgent==_LOGGEDIN_DEPID?isMemberAgent=!0:"3"!=data.isAgentType&&"4"!=data.isAgentType||$.each(ZPeople.loggedInGroups,function(k,grpId){data.isMemberAgent==grpId&&(isMemberAgent=!0)}),void 0!=data.isFollower&&$.each(data.isFollower,function(k,arr){1==arr.isFollowerId?$.each(arr.isFollower,function(k,followerId){followerId==erecno&&(isFollower=!0)}):2==arr.isFollowerId?$.each(arr.isFollower,function(k,deptId){deptId==_LOGGEDIN_DEPID&&(isFollower=!0)}):3!=arr.isFollowerId&&4!=arr.isFollowerId||$.each(arr.isFollower,function(k,followerGrpId){$.each(ZPeople.loggedInGroups,function(k,grpId){grpId==followerGrpId&&(isFollower=!0)})})}),ZPTabs.hasOwnProperty("TAB_JSON")&&!$.isEmptyObject(ZPTabs.TAB_JSON)){var hrcaseTabJSON={},casesSubTabJSON=[],mycasesTabJSon={},allcasesTabJSon={},unassignedTabJSon={},myrequestTabJSon={},categoryTabJSon={},opencasesTabJSon={},watchListTabJSon={},unmanagedTabJson={},tabOrderType="user";$.each(ZPTabs.TAB_JSON,function(index,value){"HRCase"==value.name&&(hrcaseTabJSON=value,$.each(value.subtabs,function(ind,subTab){"views"==subTab.tabName?(casesSubTabJSON=subTab.formArr,$.each(casesSubTabJSON,function(i,st){"hrcase/unmanaged/list"==st.tabURL&&(unmanagedTabJson=st),"hrcase/list"==st.tabURL&&(mycasesTabJSon=st),"hrcase/escalation/list"==st.tabURL&&st,"hrcase/opencases/list"==st.tabURL&&(opencasesTabJSon=st),"hrcase/unassigned/list"==st.tabURL&&(unassignedTabJSon=st),"hrcase/watchlist/list"==st.tabURL&&(watchListTabJSon=st),"hrcase/allcases/list"==st.tabURL&&(allcasesTabJSon=st)})):"myrequest"==subTab.tabName?myrequestTabJSon=subTab:"categories"==subTab.tabName?(categoryTabJSon=subTab,tabOrderType="agent"):"caseshome"==subTab.tabName&&(categoryTabJSon=subTab)}))}),isRequestor&&(data.isNewRwAdded?$.isEmptyObject(myrequestTabJSon)?(isTabRefresh=!!isTabRefresh||isTabRefresh,myrequestTabJSon={displayName:ZPI18N.getString("zp.myrequests"),tabURL:"hrcase/myrequest/list",tabName:"myrequest"},hrcaseTabJSON.subtabs.push(myrequestTabJSon)):HRCase.addCaseInWMS.constructCaseRwInWMS(data,"zp-contwrap-hrcase-myrequest",REQ_TYPE_MYREQUEST,caseStatusId):HRCase.addCaseInWMS.deleteRwInWMSNotify(data,"zp-contwrap-hrcase-myrequest",caseStatusId,ZPI18N.getString("zp.norequestedcases")));var isTabRefresh=!1,viewsTabExist=!$.isEmptyObject(casesSubTabJSON);(isAgent||isMemberAgent||isFollower||isCategoryAdmin)&&(isUnmanagedCase&&isCategoryAdmin&&(data.isNewRwAdded?$.isEmptyObject(unmanagedTabJson)?(isTabRefresh=isTabRefresh||!0,unmanagedTabJson={displayName:ZPI18N.getString("zp.unmanagedcases"),tabURL:"hrcase/unmanaged/list"},casesSubTabJSON.push(unmanagedTabJson)):HRCase.addCaseInWMS.constructCaseRwInWMS(data,"zp-contwrap-hrcase-unmanaged",REQ_TYPE_UNMANAGED,"unmanaged"):HRCase.addCaseInWMS.deleteRwInWMSNotify(data,"zp-contwrap-hrcase-unmanaged","unmanaged",ZPI18N.getString("zp.nounmanagedcases"))),isOpenCase&&(isAgent||isMemberAgent)&&(data.isNewRwAdded?$.isEmptyObject(opencasesTabJSon)?(isTabRefresh=isTabRefresh||!0,opencasesTabJSon={displayName:ZPI18N.getString("zp.opencases"),tabURL:"hrcase/opencases/list"},casesSubTabJSON.push(opencasesTabJSon)):HRCase.addCaseInWMS.constructCaseRwInWMS(data,"zp-contwrap-hrcase-opencases",REQ_TYPE_OPENCASE,caseStatusId):HRCase.addCaseInWMS.deleteRwInWMSNotify(data,"zp-contwrap-hrcase-opencases",caseStatusId,ZPI18N.getString("zp.noongoingcases"))),isAgent&&(tabOrderType="agent",data.isNewRwAdded?$.isEmptyObject(mycasesTabJSon)?(isTabRefresh=isTabRefresh||!0,mycasesTabJSon={displayName:ZPI18N.getString("zp.mycases"),tabURL:"hrcase/list"},casesSubTabJSON.push(mycasesTabJSon)):HRCase.addCaseInWMS.constructCaseRwInWMS(data,"zp-contwrap-hrcase-list",REQ_TYPE_MYCASES,caseStatusId):HRCase.addCaseInWMS.deleteRwInWMSNotify(data,"zp-contwrap-hrcase-list",caseStatusId,ZPI18N.getString("zp.noongoingcases"))),isMemberAgent&&(tabOrderType="agent",data.isNewRwAdded?$.isEmptyObject(unassignedTabJSon)?(isTabRefresh=isTabRefresh||!0,unassignedTabJSon={displayName:ZPI18N.getString("zp.unpicked"),tabURL:"hrcase/unassigned/list"},casesSubTabJSON.push(unassignedTabJSon)):HRCase.addCaseInWMS.constructCaseRwInWMS(data,"zp-contwrap-hrcase-unassigned",REQ_TYPE_UNASSIGNCASES,"unassigned"):HRCase.addCaseInWMS.deleteRwInWMSNotify(data,"zp-contwrap-hrcase-unassigned","unassigned",ZPI18N.getString("zp.nodataunassign"))),isFollower&&(data.isNewRwAdded?$.isEmptyObject(watchListTabJSon)?(isTabRefresh=isTabRefresh||!0,watchListTabJSon={displayName:ZPI18N.getString("zp.watchlist"),tabURL:"hrcase/watchlist/list"},casesSubTabJSON.push(watchListTabJSon)):HRCase.addCaseInWMS.constructCaseRwInWMS(data,"hrcase-watchlist-list",REQ_TYPE_FOLLOWS,caseStatusId):HRCase.addCaseInWMS.deleteRwInWMSNotify(data,"hrcase-watchlist-list",caseStatusId,ZPI18N.getString("zp.nofollowedcases"))),data.isNewRwAdded?$.isEmptyObject(allcasesTabJSon)?(isTabRefresh=isTabRefresh||!0,allcasesTabJSon={displayName:ZPI18N.getString("zp.allcases"),tabURL:"hrcase/allcases/list"},casesSubTabJSON.push(allcasesTabJSon)):HRCase.addCaseInWMS.constructCaseRwInWMS(data,"zp-contwrap-hrcase-allcases",REQ_TYPE_ALLCASES,caseStatusId):HRCase.addCaseInWMS.deleteRwInWMSNotify(data,"zp-contwrap-hrcase-allcases",caseStatusId,ZPI18N.getString("zp.noallcases")));var tabUrlArr=["hrcase/unmanaged/list","hrcase/list","hrcase/escalation/list","hrcase/opencases/list","hrcase/unassigned/list","hrcase/watchlist/list","hrcase/allcases/list"];casesSubTabJSON.sort(function(a,b){var apos=tabUrlArr.indexOf(a.tabURL),bpos=tabUrlArr.indexOf(b.tabURL);return apos<bpos?-1:apos>bpos?1:0});var casetabarr=["caseshome","myrequest","views"];$.isEmptyObject(casesSubTabJSON)||viewsTabExist||(viewsTabExist=!0,hrcaseTabJSON.subtabs.push({displayName:ZPI18N.getString("zp.views"),formArr:casesSubTabJSON,isStaticTab:!0,tabName:"views"})),(HRCase.CASES_ADMIN.isAdmin||isAgent||isMemberAgent||"agent"==tabOrderType)&&viewsTabExist&&(categoryTabJSon.tabName="categories",categoryTabJSon.displayName=ZPI18N.getString("zp.categories"),casetabarr=["views","myrequest","categories","reports","settings"]),hrcaseTabJSON.subtabs.sort(function(a,b){var apos=casetabarr.indexOf(a.tabName),bpos=casetabarr.indexOf(b.tabName);return apos<bpos?-1:apos>bpos?1:0}),isTabRefresh&&ZPTabs.constructSubtabsBasedOnHash()}},constructCaseRwInWMS:function(data,zpContwrapId,mode,statusId){if(0!=$("#"+zpContwrapId).find("#caseList").find(".ZPNdata").length){$("#"+zpContwrapId).find("#caseList").find(".ZPNdata").remove(),$("#"+zpContwrapId).find("#caseScrollHead").removeClass("zp_dyn"),$("#"+zpContwrapId).find(".zp_cinfo").removeClass("zp_dyn");var caseListHtml=HRCase.List.caseListRow(data.caseJobj,mode);$("#"+zpContwrapId).find("#caseList").append(caseListHtml)}else{caseListHtml=HRCase.List.caseListRow(data.caseJobj,mode);$("#"+zpContwrapId).find("#caseList div:eq(0)").before(caseListHtml)}var count=$("#"+zpContwrapId).find("[name=footerposition]").find("span[id="+statusId+"]").text(),iNum=parseInt(count);$("#"+zpContwrapId).find("[name=footerposition]").find("span[id="+statusId+"]").html(iNum+1)},deleteRwInWMSNotify:function(data,zpContwrapId,statusId,nodataKey){$("#"+zpContwrapId).find("#caseList").find("[caseid="+data.hrcase+"]").remove();var count=$("#"+zpContwrapId).find("[name=footerposition]").find("span[id="+statusId+"]").text(),iNum=parseInt(count);iNum>0&&$("#"+zpContwrapId).find("[name=footerposition]").find("span[id="+statusId+"]").html(iNum-1),0==$("#"+zpContwrapId).find("#caseList").find("div[caseId]").length&&($("#"+zpContwrapId).find("#caseList").append(CommonTemplates.noDataSVG("",!0,nodataKey)),$("#"+zpContwrapId).find("[name=nodataReq]").off("click").on("click",function(e){HRCaseBand.serviceView()}))}},HRCase.List={statusSysValue:"1,2,3,4",reloadMyReqCaseList:function(){Layout.Page.container.find("#caseList").empty(),HRCase.Header.getCaseHeader(REQ_TYPE_MYREQUEST),HRCase.List.getMyReqCasesList(1)},reloadMyHrCaseList:function(){Layout.Page.container.find("#caseList").empty(),HRCase.Header.getCaseHeader(REQ_TYPE_MYCASES),HRCase.List.getMyHrCasesList(1)},reloadAllCasesList:function(){Layout.Page.container.find("#caseList").empty(),HRCase.Header.getCaseHeader(REQ_TYPE_ALLCASES),HRCase.List.getAllCasesList(1)},reloadUnassignedList:function(){Layout.Page.container.find("#caseList").empty(),HRCase.Header.getCaseHeader(REQ_TYPE_UNASSIGNCASES),HRCase.List.getUnassignedList(1)},reloadfollowedList:function(){Layout.Page.container.find("#caseList").empty(),HRCase.Header.getCaseHeader(REQ_TYPE_FOLLOWS),HRCase.List.getFollowedCasesList(1)},reloadOpencaseList:function(){Layout.Page.container.find("#caseList").empty(),HRCase.Header.getCaseHeader(REQ_TYPE_OPENCASE),HRCase.List.getOpenCasesList(1)},reloadUnmanagedList:function(){Layout.Page.container.find("#caseList").empty(),HRCase.Header.getCaseHeader(REQ_TYPE_UNMANAGED),HRCase.List.getUnmanagedCasesList(1)},getUnmanagedCasesList:function(newIndex,newJSONObject,isFromAdvancedFilter){var pageId=Layout.Page.container,index=0===pageId.find("div[caseId]").length?1:pageId.find("div[caseId]").length+1;index=void 0!=newIndex?newIndex:index;var params,errorMsg=ZPI18N.getString("zp.nofilteredcases"),needNewFooter=isFromAdvancedFilter||void 0==newJSONObject;void 0==newJSONObject&&(newJSONObject={status:HRCase.List.statusSysValue,index:index,requestorErecno:"",query:""},errorMsg=ZPI18N.getString("zp.nounmanagedcases"),HRCase.OPEN_CASE_PARAM=newJSONObject),params={method:"unmanagedCases",myCasesJson:JSON.stringify(newJSONObject),conreqcsr:csrfToken},$.ajax({url:"/unmanagedCases.zp",type:POST,data:params,async:!1,success:function(data){1==index&&pageId.find("div#caseList").empty(),needNewFooter&&pageId.find("[name=footerposition]").empty().append(HRCase.Header.getFooter(REQ_TYPE_UNMANAGED,data.statusCount,isFromAdvancedFilter)),pageId.find("[name=footerposition]").removeClass("zp_dyn"),HRCase.List.getCasesList(data,REQ_TYPE_UNMANAGED,errorMsg,!0,!needNewFooter),HRCase.SearchFilter.getStatusFilterValue(newJSONObject.status)}})},getOpenCasesList:function(newIndex,newJSONObject,isFromAdvancedFilter){var pageId=Layout.Page.container,index=0===pageId.find("div[caseId]").length?1:pageId.find("div[caseId]").length+1;index=void 0!=newIndex?newIndex:index;var params,errorMsg=ZPI18N.getString("zp.nofilteredcases"),needNewFooter=isFromAdvancedFilter||void 0==newJSONObject;void 0==newJSONObject&&(newJSONObject={status:HRCase.List.statusSysValue,index:index,requestorErecno:"",query:""},errorMsg=ZPI18N.getString("zp.noongoingcases"),HRCase.OPEN_CASE_PARAM=newJSONObject),params={method:"openCases",myCasesJson:JSON.stringify(newJSONObject),conreqcsr:csrfToken},$.ajax({url:"/openCases.zp",type:POST,data:params,async:!1,success:function(data){1==index&&pageId.find("div#caseList").empty(),needNewFooter&&pageId.find("[name=footerposition]").empty().append(HRCase.Header.getFooter(REQ_TYPE_OPENCASE,data.statusCount,isFromAdvancedFilter)),pageId.find("[name=footerposition]").removeClass("zp_dyn"),HRCase.List.getCasesList(data,REQ_TYPE_OPENCASE,errorMsg,!0,!needNewFooter),HRCase.SearchFilter.getStatusFilterValue(newJSONObject.status)}})},reloadEscalationList:function(){Layout.Page.container.find("#caseList").empty(),HRCase.Header.getCaseHeader(REQ_TYPE_ESCALATION),HRCase.List.getEscalatedCasesList(1)},getEscalatedCasesList:function(newIndex,newJSONObject,isFromAdvancedFilter){var pageId=Layout.Page.container,index=0===pageId.find("div[caseId]").length?1:pageId.find("div[caseId]").length+1;index=void 0!=newIndex?newIndex:index;var params,errorMsg=ZPI18N.getString("zp.nofilteredcases"),needNewFooter=isFromAdvancedFilter||void 0==newJSONObject;void 0==newJSONObject&&(newJSONObject={status:HRCase.List.statusSysValue,index:index,requestorErecno:"",query:""},errorMsg=ZPI18N.getString("zp.noescalatedcases"),HRCase.ESCALATAION_CASE_PARAM=newJSONObject),params={method:"escalatedCases",myCasesJson:JSON.stringify(newJSONObject),conreqcsr:csrfToken},$.ajax({url:"/escalatedCases.zp",type:POST,data:params,async:!1,success:function(data){1==index&&pageId.find("div#caseList").empty(),needNewFooter&&pageId.find("[name=footerposition]").empty().append(HRCase.Header.getFooter(REQ_TYPE_ESCALATION,data.statusCount,isFromAdvancedFilter)),pageId.find("[name=footerposition]").removeClass("zp_dyn"),HRCase.List.getCasesList(data,REQ_TYPE_ESCALATION,errorMsg,!0,!needNewFooter),HRCase.SearchFilter.getStatusFilterValue(newJSONObject.status)}})},getFollowedCasesList:function(newIndex,newJSONObject,isFromAdvancedFilter){var pageId=Layout.Page.container,index=0===pageId.find("div[caseId]").length?1:pageId.find("div[caseId]").length+1;index=void 0!=newIndex?newIndex:index;var params,errorMsg=ZPI18N.getString("zp.nofilteredcases"),needNewFooter=isFromAdvancedFilter||void 0==newJSONObject;void 0==newJSONObject&&(newJSONObject={status:HRCase.List.statusSysValue,index:index,requestorErecno:"",query:""},errorMsg=ZPI18N.getString("zp.nofollowedcases"),HRCase.WATCHLIST_CASE_PARAM=newJSONObject),params={method:"followedHRCases",myCasesJson:JSON.stringify(newJSONObject),conreqcsr:csrfToken},$.ajax({url:"/followedHRCases.zp",type:POST,data:params,async:!1,success:function(data){1==index&&pageId.find("div#caseList").empty(),needNewFooter&&pageId.find("[name=footerposition]").empty().append(HRCase.Header.getFooter(REQ_TYPE_FOLLOWS,data.statusCount,isFromAdvancedFilter)),pageId.find("[name=footerposition]").removeClass("zp_dyn"),HRCase.List.getCasesList(data,REQ_TYPE_FOLLOWS,errorMsg,!0,!needNewFooter),HRCase.SearchFilter.getStatusFilterValue(newJSONObject.status)}})},getUnassignedList:function(newIndex,newJSONObject,isFromAdvancedFilter){var pageId=Layout.Page.container,index=0===pageId.find("div[caseId]").length?1:pageId.find("div[caseId]").length+1;index=void 0!=newIndex?newIndex:index;var params,errorMsg=ZPI18N.getString("zp.nofilteredcases"),needNewFooter=isFromAdvancedFilter||void 0==newJSONObject;void 0==newJSONObject&&(newJSONObject={status:HRCase.List.statusSysValue,index:index,requestorErecno:"",query:"",type:"unassigned"},errorMsg=ZPI18N.getString("zp.nodataunassign"),HRCase.UNASSIGN_CASE_PARAM=newJSONObject),params={method:"unassignedHRCases",myCasesJson:JSON.stringify(newJSONObject),conreqcsr:csrfToken},$.ajax({url:"/unassignedHRCases.zp",type:POST,data:params,async:!1,success:function(data){1==index&&(pageId.find("div#caseList").empty(),HRCase.List.cancelBulkSelection(REQ_TYPE_UNASSIGNCASES)),needNewFooter&&pageId.find("[name=footerposition]").empty().append(HRCase.Header.getFooter(REQ_TYPE_UNASSIGNCASES,data.statusCount,isFromAdvancedFilter)),pageId.find("[name=footerposition]").removeClass("zp_dyn"),HRCase.List.getCasesList(data,REQ_TYPE_UNASSIGNCASES,errorMsg,!needNewFooter,!needNewFooter),HRCase.SearchFilter.getStatusFilterValue(newJSONObject.status)}})},getMyReqCasesList:function(newIndex,newJSONObject,isFromAdvancedFilter,self){var pageId=Layout.Page.container,index=0===pageId.find("div[caseId]").length?1:pageId.find("div[caseId]").length+1;index=void 0!=newIndex?newIndex:index;var params,errorMsg=ZPI18N.getString("zp.nofilteredcases"),needNewFooter=isFromAdvancedFilter||void 0==newJSONObject;void 0==newJSONObject&&(newJSONObject={status:"",index:index},HRCase.MYREQ_CASE_PARAM=newJSONObject,errorMsg=ZPI18N.getString("zp.norequestedcases")),params={method:"myHrCasesRequest",myCaseRequestJson:JSON.stringify(newJSONObject),conreqcsr:csrfToken},$.ajax({url:"/myHrCasesRequest.zp",type:POST,data:params,async:!1,success:function(data){1==index&&pageId.find("div#caseList").empty(),needNewFooter&&pageId.find("[name=footerposition]").empty().append(HRCase.Header.getFooter(REQ_TYPE_MYREQUEST,data.statusCount,isFromAdvancedFilter)),pageId.find("[name=footerposition]").removeClass("zp_dyn"),HRCase.List.getCasesList(data,REQ_TYPE_MYREQUEST,errorMsg,!needNewFooter,!needNewFooter,self),HRCase.SearchFilter.getStatusFilterValue(newJSONObject.status)}})},getMyHrCasesList:function(newIndex,newJSONObject,isFromAdvancedFilter,mode,particular,id){var pageId=Layout.Page.container,index=0===pageId.find("div[caseId]").length?1:pageId.find("div[caseId]").length+1;index=void 0!=newIndex?newIndex:index;var params,errorMsg=ZPI18N.getString("zp.nofilteredcases"),needNewFooter=isFromAdvancedFilter||void 0==newJSONObject;void 0==newJSONObject&&(newJSONObject={requestorErecno:"",query:"",status:HRCase.List.statusSysValue,index:index},HRCase.MYCASE_CASE_PARAM=newJSONObject,errorMsg=ZPI18N.getString("zp.noongoingcases")),mode&&(newJSONObject.mode="self",particular&&(newJSONObject.requestorErecno=id)),params={method:"myHrCases",myCasesJson:JSON.stringify(newJSONObject),conreqcsr:csrfToken},$.ajax({url:"/myHrCases.zp",type:POST,data:params,async:!1,success:function(data){1==index&&(pageId.find("div#caseList").empty(),HRCase.List.cancelBulkSelection(REQ_TYPE_MYCASES)),needNewFooter&&pageId.find("[name=footerposition]").empty().append(HRCase.Header.getFooter(REQ_TYPE_MYCASES,data.statusCount,isFromAdvancedFilter)),pageId.find("[name=footerposition]").removeClass("zp_dyn"),mode?HRCase.List.getCasesList(data,REQ_TYPE_ALLCASES,errorMsg,!0,!needNewFooter,mode):HRCase.List.getCasesList(data,REQ_TYPE_MYCASES,errorMsg,!0,!needNewFooter),HRCase.SearchFilter.getStatusFilterValue(newJSONObject.status)}})},getAllCasesList:function(newIndex,newJSONObject,isFromAdvancedFilter){var pageId=Layout.Page.container,index=0===pageId.find("div[caseId]").length?1:pageId.find("div[caseId]").length+1;index=void 0!=newIndex?newIndex:index;var params,errorMsg=ZPI18N.getString("zp.nofilteredcases"),needNewFooter=isFromAdvancedFilter||void 0==newJSONObject;void 0==newJSONObject&&(newJSONObject=(HRCase.CASES_ADMIN.isAdmin||HRCase.CASES_ADMIN.hasOwnProperty("categoryAdmin")&&HRCase.CASES_ADMIN.categoryAdmin.length>0)&&void 0!=Layout.Page.urlparam.categoryid&&void 0!=Layout.Page.urlparam.status&&HRCase.SPC_SEARCH?{categoryId:Layout.Page.urlparam.categoryid,query:"",status:Layout.Page.urlparam.status,index:index,requestorType:"0"}:{categoryId:"",query:"",status:"",index:index},HRCase.ALLCASE_CASE_PARAM=newJSONObject,errorMsg=ZPI18N.getString("zp.noallcases")),params={method:"allHrCases",myCasesJson:JSON.stringify(newJSONObject),conreqcsr:csrfToken},$.ajax({url:"/allHrCases.zp",type:POST,data:params,async:!1,success:function(data){if(1==index&&(pageId.find("div#caseList").empty(),HRCase.List.cancelBulkSelection(REQ_TYPE_ALLCASES)),needNewFooter&&pageId.find("[name=footerposition]").empty().append(HRCase.Header.getFooter(REQ_TYPE_ALLCASES,data.statusCount,isFromAdvancedFilter)),pageId.find("[name=footerposition]").removeClass("zp_dyn"),HRCase.List.getCasesList(data,REQ_TYPE_ALLCASES,errorMsg,!needNewFooter,!needNewFooter),HRCase.SearchFilter.getStatusFilterValue(newJSONObject.status),(HRCase.CASES_ADMIN.isAdmin||HRCase.CASES_ADMIN.hasOwnProperty("categoryAdmin")&&HRCase.CASES_ADMIN.categoryAdmin.length>0)&&void 0!=Layout.Page.urlparam.categoryid&&void 0!=Layout.Page.urlparam.status&&HRCase.SPC_SEARCH){var filterDiv=HRCase.SearchFilter.getFilterArray();AdvancedFilter.filterTagClearOption(filterDiv),pageId.find("#statusDiv_input").attr("selectedIds",Layout.Page.urlparam.status),pageId.find("#cgyDiv_input").attr("selectedIds",Layout.Page.urlparam.categoryid)}}})},getCasesList:function(data,mode,nodataKey,showFooterOnempty,showHeaderOnEmpty,isCheckforCaserowClick){var pageId=Layout.Page.container,bodyDiv="div#caseList";0==pageId.find("div[caseId]").length&&pageId.find(bodyDiv).html(""),0!=data.hrcaseList.length&&(pageId.find("#hrcaseHead [caseid]").removeClass("sel"),pageId.find("#caseScrollHead").removeClass("zp_dyn"),$.each(data.hrcaseList,function(index,value){pageId.find(bodyDiv).append(HRCase.List.caseListRow(value,mode,isCheckforCaserowClick))})),0==pageId.find("div[caseId]").length&&(pageId.find(bodyDiv).empty(),void 0!=showFooterOnempty&&showFooterOnempty||pageId.find("[name=footerposition]").addClass("zp_dyn"),void 0!=showHeaderOnEmpty&&showHeaderOnEmpty||pageId.find("#caseScrollHead").addClass("zp_dyn"),pageId.find(bodyDiv).append(CommonTemplates.noDataSVG("",!0,nodataKey)),pageId.find("[name=nodataReq]").off("click").on("click",function(e){HRCaseBand.serviceView()})),pageId.find("#cgyFilter").off("click"),pageId.find("#cgyFilter").on("click",function(e){var filterType="category_agent";mode!=REQ_TYPE_MYCASES&&mode!=REQ_TYPE_UNASSIGNCASES&&mode!=REQ_TYPE_OPENCASE&&(filterType="category");var prop=HRCase.SearchFilter.filterDropDown(filterType);prop.checkbox=!1,prop.callback=function(ele){var categoryId="cgyAll"==$(ele).attr("id")?"":$(ele).attr("id"),categoryName=$(ele).attr("name");""==categoryId&&(categoryName=ZPI18N.getString("zp.category")),HRCase.SearchFilter.getQuickFilterList("category",categoryId),pageId.find("#cgyFilter").prev("font").html('<em title="'+ZPeople.escapeHtml(categoryName)+'">'+ZPeople.escapeHtml(categoryName)+"</em>")},pageId.find("#cgyFilter").zparrowmenu(prop)}),data.isNextAvailable&&ZPeople.FireScroll.reset()},agentPopup:function(typeId,valueId){var popup="";switch(typeId){case OWNER_EMPLOYEE.toString():popup='empid = "'+valueId+'" popup = "user"';break;case OWNER_DEPARTMENT.toString():popup='deptId = "'+valueId+'" popup = "dept"';break;case OWNER_GROUP.toString():case OWNER_INTERNAL_GROUP.toString():popup='grpId = "'+valueId+'" popup = "group"'}return popup},bulkUnassign:function(recordIds,mode){var pageId=Layout.Page.container;ZPeople.BSModal.confirm(function(e){var params={conreqcsr:csrfToken,method:"unassignCases"};params.pkIds=JSON.stringify(recordIds),params.agent="-Select-",ZPeople.Request.send("/unassignCases.zp",params,function(data){if(data.isSuccess){var modifiedCount=0;if($.each(data.modifiedPkIds,function(key){var agentRow=pageId.find('[caseid = "'+key+'"]');mode==REQ_TYPE_MYCASES?(agentRow.addClass("slowHide"),setTimeout(function(){agentRow.remove()},400)):($(agentRow).find("[name=CLAgent]").html('<i class="IC-user-plu zp_rBf" id="pickUptoMe" onclick="HRCase.DetailedView.getAssignedToList(event,this,\''+key+"','caseList')\"></i>"),$(agentRow).find("[name=CLAgent]").off("click")),++modifiedCount}),mode==REQ_TYPE_MYCASES){var totalNo=pageId.find("[caseid]:not(.slowHide)").find("i[name=selBox]").length;HRCase.List.bulkSelectHeader(recordIds.length-modifiedCount,mode,totalNo)}HRCase.DetailedView.updateUnassignedCount(!1,modifiedCount),ZPeople.Message.showSuccessMsg("You have unassigned yourself from "+modifiedCount+" case(s).")}})},"Unassign Cases","You are about to unassign yourself from the selected cases. Do you wish to proceed?")},bulkPickup:function(recordIds,mode){var pageId=Layout.Page.container;ZPeople.BSModal.confirm(function(e){var params={conreqcsr:csrfToken,method:"pickupCases"};params.pkIds=JSON.stringify(recordIds),params.agent=erecno;var userDetails=ZPeople.getUserDetailsById(erecno);ZPeople.Request.send("/pickupCases.zp",params,function(data){if(data.isSuccess){var modifiedCount=0;if($.each(data.modifiedPkIds,function(key){var agentRow=pageId.find('[caseid = "'+key+'"]');mode==REQ_TYPE_UNASSIGNCASES?(agentRow.addClass("slowHide"),setTimeout(function(){agentRow.remove()},400)):($(agentRow).find("[name=CLAgent]").html(CommonTemplates.returnImgDiv(userDetails.avatar,"","",userDetails.name,"")),$(agentRow).find("[name=CLAgent]").removeAttr("onclick"),$(agentRow).find("[name=CLAgent]").off("click")),++modifiedCount}),mode==REQ_TYPE_UNASSIGNCASES){var totalNo=pageId.find("[caseid]:not(.slowHide)").find("i[name=selBox]").length;HRCase.List.bulkSelectHeader(recordIds.length-modifiedCount,mode,totalNo)}HRCase.DetailedView.updateUnassignedCount(!0,modifiedCount),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.bulkpickupsuccess",new Array(modifiedCount.toString())))}},{},function(xhr){var error_response=JSON.parse(xhr.responseText);"ARRAY_SIZE_OUT_OF_RANGE"==error_response.code&&"pkIds"==error_response.paramName?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.cannotpickcases")):ZPeople.Message.showFailureMsg(error_response.error)})},ZPI18N.getString("zp.pickupcases"),ZPI18N.getString("zp.bulkpickup"))},bulkStatusChange:function(statusId,recordIds,mode,oldStatusList){var pageId=Layout.Page.container;ZPeople.BSModal.confirm(function(e){var params={conreqcsr:csrfToken,method:"bulkStatusChange"};params.pkIds=JSON.stringify(recordIds),params.status=HRCase.getStatusName(statusId);var editorContent="";if(void 0!=ZPFeeds.Editor.editorList.descEditor){var value=ZPFeeds.Editor.editorList.descEditor.getContent();editorContent=ZPFeeds.getSmileysAndMentions(value,"true"),editorContent=ZPFeeds.removeTrailingEmptyDivs(editorContent),params.comment=editorContent,params.messageText=ZPFeeds.getTextContent(editorContent)}ZPeople.Request.send("/bulkStatusChange.zp",params,function(data){if(data.isSuccess){var originalStatusCount={},modifiedCasesCount=0;$.each(data.modifiedPkIds,function(key){var oldstatus=oldStatusList[key];originalStatusCount[oldstatus]=void 0==originalStatusCount[oldstatus]?1:originalStatusCount[oldstatus]+1,HRCase.List.newstatusChange(statusId,key),++modifiedCasesCount});var footerDiv=pageId.find("[name=footerposition]");$.each(originalStatusCount,function(stId,count){var countDiv=footerDiv.find('span[value="'+stId+'"]'),newcount=parseInt(countDiv.text())-count;countDiv.html(newcount)});var countDiv=footerDiv.find('span[value="'+statusId+'"]'),newcount=parseInt(countDiv.text())+modifiedCasesCount;countDiv.html(newcount),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.bulkstatuschangesuccess",new Array(modifiedCasesCount,HRCase.getStatusName(statusId))))}},{},function(xhr){var error_response=JSON.parse(xhr.responseText);"ARRAY_SIZE_OUT_OF_RANGE"==error_response.code&&"pkIds"==error_response.paramName?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.cannotclosecases")):ZPeople.Message.showFailureMsg(error_response.error)})},ZPI18N.getString("zp.closecases"),ZPI18N.getString("zp.bulkclosecase")+'<div id="commentEditor"></div>'),EditorTemplate.editorConstruct("commentEditor",!1,"",!1);var initobject={currentContainer:$("[id=zp_modal_confirmpop]"),editorheight:100,isMiniEditor:!0,isMentionsEnabled:!0};ZPFeeds.Editor.getEditor("descEditor","BulkUpdateEdit",initobject),$("[id=zp_modal_confirmpop]").removeClass("DelMdl")},bulkSelect:function(obj,mode,selectAll){var pageId=Layout.Page.container;$(obj).toggleClass("IC-chk-box2"),$(obj).hasClass("IC-chk-box2")||pageId.find("#selAll").removeClass("IC-chk-box2"),selectAll&&($(obj).hasClass("IC-chk-box2")?pageId.find("[caseid]").find("i[name=selBox]").addClass("IC-chk-box2"):pageId.find("[caseid]").find("i[name=selBox]").removeClass("IC-chk-box2"));var selectedNo=pageId.find("[caseid]").find("i.IC-chk-box2").length,totalNo=pageId.find("[caseid]").find("i[name=selBox]").length;HRCase.List.bulkSelectHeader(selectedNo,mode,totalNo)},cancelBulkSelection:function(mode){var totalNo=0;Layout.Page.container.find("[caseid]").each(function(i){var selectBox=$(this).find("i[name=selBox]");selectBox.hasClass("IC-chk-box2")&&selectBox.removeClass("IC-chk-box2"),++totalNo}),HRCase.List.bulkSelectHeader(0,mode,totalNo)},bulkSelectHeader:function(selectedNo,mode,totalNo){var pageId=Layout.Page.container,bSelHdr=pageId.find("#bSelHdr");if(selectedNo>0){var selectOptionHeader=$("<div><ul></ul></div>"),selectOption="";switch(mode){case REQ_TYPE_MYCASES:selectOption="<li onclick=\"HRCase.List.bulkOptionCallback(this,'BSstatus','"+mode+'\')" name="BSstatus">'+ZPI18N.getString("zp.close")+"</li>";break;case REQ_TYPE_UNASSIGNCASES:selectOption="<li onclick=\"HRCase.List.bulkOptionCallback(this,'BSpickup','"+mode+'\')" name="BSpickup">'+ZPI18N.getString("zp.pickupcase")+"</li>";break;case REQ_TYPE_ALLCASES:HRCase.CASES_ADMIN.isAdmin&&(selectOption="<li class=\"zp_multiAct del\" onclick=\"HRCase.List.bulkOptionCallback(this,'BSdelete','"+mode+'\')" name="BSdelete">'+ZPI18N.getString("zp.delete")+"</li>"),selectOption+="<li onclick=\"HRCase.List.bulkOptionCallback(this,'BSstatus','"+mode+'\')" name="BSstatus">'+ZPI18N.getString("zp.close")+"</li>"}if(selectOptionHeader.find("ul").html(selectOption),bSelHdr.length>0)bSelHdr.removeClass("DN");else{var headerHtml=HRCase.List.BULKSELHEADER;headerHtml=(headerHtml=headerHtml.replace(/\$SELCLS\$/,"")).replace(/\$SELOPER\$/,selectOptionHeader.html()),pageId.find("[name=headerposition]").append(headerHtml),bSelHdr=pageId.find("#bSelHdr")}bSelHdr.find("#selItems").html(selectedNo+" "+ZPI18N.getString("zp.selected")),bSelHdr.find("#selAll").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),HRCase.List.bulkSelect(this,mode,!0)}),selectedNo==totalNo?bSelHdr.find("#selAll").addClass("IC-chk-box2"):bSelHdr.find("#selAll").removeClass("IC-chk-box2"),pageId.addClass("multiselect")}else pageId.removeClass("multiselect"),bSelHdr.addClass("DN")},bulkOptionCallback:function(obj,optionValue,mode){Layout.Page.container;var selectionObj=HRCase.List.getSelectedCases();switch(optionValue){case"BSstatus":HRCase.List.bulkStatusChange(HRCase.COMPLETED_SID,selectionObj.selectedRecordIds,mode,selectionObj.selectedStatusIds);break;case"BSpickup":HRCase.List.bulkPickup(selectionObj.selectedRecordIds,mode);break;case"BSunassign":HRCase.List.bulkUnassign(selectionObj.selectedRecordIds,mode);break;case"BSdelete":HRCase.DetailedView.deleteCase(selectionObj.selectedRecordIds.toString(),!0,mode)}$(obj).removeAttr("selectedids")},getSelectedCases:function(){var result={},selectedRecordIds=[],selectedStatusIds={};return Layout.Page.container.find("[caseid]").find("i[name=selBox]").each(function(){if($(this).hasClass("IC-chk-box2")){var currentObj=$(this).closest("[caseid]"),recordId=currentObj.attr("caseid");selectedRecordIds.push(recordId),selectedStatusIds[recordId]=currentObj.find("[statusId]").attr("statusId")}}),result.selectedRecordIds=selectedRecordIds,result.selectedStatusIds=selectedStatusIds,result},BULKSELHEADER:'<div id="bSelHdr" class="zp_slctlst $SELCLS$"><div><i id="selAll" class="IC-chk-box1"></i><span id="selItems"></span></div>$SELOPER$</div>',caseListRow:function(data,mode,isCheckforCaserowClick){Layout.Page.container;var url=Layout.Page.hash,caseRow=$("#caseRow").clone();$(caseRow).removeAttr("id"),$(caseRow).removeClass("zp_dyn"),$(caseRow).attr("caseId",data.recordId);var isBulkSelect=!1;mode!=REQ_TYPE_MYCASES&&mode!=REQ_TYPE_UNASSIGNCASES&&mode!=REQ_TYPE_ALLCASES||(isBulkSelect=!0);var userData={},userPopup="";if(mode==REQ_TYPE_MYREQUEST)if(data.hasOwnProperty("agent"))$(caseRow).find("[name=caseDetails]").before(HRCase.List.getAvatarImageDiv(data,mode,isBulkSelect)),userData=data.agent,data.agent.hasOwnProperty("name")?userPopup=HRCase.List.agentPopup(OWNER_EMPLOYEE.toString(),data.agent.zuid):(userData.name=data.agent.details,userPopup=HRCase.List.agentPopup(data.agent.typeId,data.agent.valueId));else{var imageDiv="<div>"+CommonTemplates.returnImgDiv(ZPeople.getResourceURL(imageUrl+"user.png"),"","","",userPopup,isBulkSelect)+'<i class="IC-pending"></i></div>';$(caseRow).find("[name=caseDetails]").before(imageDiv)}else $(caseRow).find("[name=caseDetails]").before("<div>"+CommonTemplates.returnImgDiv(data.requestor.employeePhoto,"","","",userPopup,isBulkSelect)+"</div>"),"null"!=(userData=data.requestor).zuid&&""!=userData.zuid&&(userPopup=HRCase.List.agentPopup(OWNER_EMPLOYEE.toString(),data.requestor.zuid));isBulkSelect&&$(caseRow).find("i[name=selBox]").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),HRCase.List.bulkSelect(this,mode)});var attachmentDiv="",timeDivClass="";data.hasOwnProperty("hasAttachment")&&(attachmentDiv+='<span id="attachment"><i class="IC-attach1" data-original-title="'+ZPI18N.getString("zp.attachment")+'" data-toggle="tooltip" data-placement="top"></i></span>',timeDivClass="zp_ldot");userPopup="";userData.hasOwnProperty("zuid")&&(userPopup='empid="'+userData.zuid+'" popup= "user"'),userData.name;var followtype="";mode==REQ_TYPE_FOLLOWS&&data.hasOwnProperty("followerMode")&&(followtype='<em class="zp_ldot">'+data.followerMode+"</em>");var userDataHtml="";void 0==userData||$.isEmptyObject(userData)?(userDataHtml='<p class="zp_inRvTg">'+ZPI18N.getString("zp.inreview")+"</p> ",timeDivClass="zp_ldot"):(userDataHtml="<a "+userPopup+' class="zp_ldot">'+userData.name+"</a>",timeDivClass="zp_ldot");var casedetails="<h3><span>"+data.caseId+"</span>"+data.subject+"</h3>"+attachmentDiv+userDataHtml+' <em class="'+timeDivClass+'">'+data.requestedTime+"</em>"+followtype+"</div>";$(caseRow).find("[name=caseDetails]").empty().append(casedetails),$(caseRow).find("[name=CLcategory]").attr("categoryId",data.categoryId);var subCategoryHtml="";data.hasOwnProperty("subCategoryName")&&(subCategoryHtml='<em title="'+data.subCategoryName+'" class="zp_LsSbt">'+data.subCategoryName+"</em>"),$(caseRow).find("[name=CLcategory]").html('<em title="'+data.categoryName+'">'+data.categoryName+"</em>"+subCategoryHtml),$(caseRow).find("[name=CLstatus]").empty().html('<span statusId="'+data.statusId+'">'+data.status+"</span>"),$(caseRow).find("[name=CLstatus]").find("span").addClass(HRCase.List.getStatusColorClass(data.statusId));var deleteButton="";HRCase.CASES_ADMIN.isAdmin&&mode==REQ_TYPE_ALLCASES&&-1===url.indexOf("#hrcase/reports/requestedvsclosed")&&-1===url.indexOf("#hrcase/reports/overallreport")&&(deleteButton='<i id="delCase" class="IC-delete-1px zp_rB"></i>'),mode!=REQ_TYPE_MYREQUEST&&mode!=REQ_TYPE_MYCASES&&mode!=REQ_TYPE_UNMANAGED&&(data.hasOwnProperty("agent")&&data.agent.hasOwnProperty("name")?$(caseRow).find("[name=CLstatus]").after('<div class="zp_Lass" name="CLAgent">'+HRCase.List.getAvatarImageDiv(data,mode)+'</div><div class="zp_Lrgt">'+deleteButton+"</div>"):$(caseRow).find("[name=CLstatus]").after('<div class="zp_Lass" name="CLAgent"><i class="IC-user-plu zp_rBf" id="pickUptoMe" onclick="HRCase.DetailedView.getAssignedToList(event,this,\''+data.recordId+"','caseList')\"></i></div><div class=\"zp_Lrgt\">"+deleteButton+"</div>")),-1!==deleteButton.indexOf("delCase")&&$(caseRow).find("#delCase").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),HRCase.DetailedView.deleteCase(data.recordId,!1,mode)}),$(caseRow).off("click").on("click",function(){isCheckforCaserowClick?HRCase.DetailedView.newviewCaseDetails(data.recordId,isCheckforCaserowClick):window.location.href=HRCases.getParentURL()+"/view-caseid:"+data.recordId}),$(caseRow).find("#attachment").on("click",function(e){e.stopPropagation();var obj=$(this);ZPeople.Request.send("/getfilesList.zp",{method:"getFilesList",conreqcsr:csrfToken,caseId:data.recordId},function(d){var params=[];$.each(d,function(index,v){var fileExtn=v.fileName.substring(v.fileName.lastIndexOf(".")+1),previewfileId=v.hasOwnProperty("previewFileId")?v.previewFileId:"",param1={value:decodeURIComponent(v.fileName),id:v.fileUploadId,iconClass:CommonTemplates.getFileIcon(fileExtn)+" fileType",previewfileId:previewfileId};params.push(param1)}),obj.zparrowmenu({id:"flList",data:params,oneTimeMenu:!0,callback:function(Obj1){var fileName=$(Obj1).attr("name"),fileExtn=fileName.substring(fileName.lastIndexOf(".")+1);casesFiles.getFilePreview($(Obj1).attr("id"),data.recordId,HR_CASE_ATTACHEMENTS,escape(fileName),fileExtn,escape($(Obj1).attr("previewFileId")))}})})}),data.statusId==HRCase.COMPLETED_SID&&$(caseRow).addClass("zp_cmpl");var sla=SLA.getSlaTimeAndColor(data.SLA,"list");return""!=sla.text&&$(caseRow).find("[name=caseDetails]").append('<em name="SLAData" class="zp_ldot '+sla.color+'"><i class="IC-timer2"></i>'+sla.text+"</em>"),caseRow},getStatusColorClass:function(statusId){var colorClass="zp_bclr";switch(statusId){case HRCase.OPEN_SID:colorClass="zp_bclr";break;case HRCase.INPROGRESS_SID:colorClass="zp_gclr";break;case HRCase.AWAITING_SID:colorClass="zp_ybg";break;case HRCase.ONHOLD_SID:colorClass="zp_lyclr";break;case HRCase.COMPLETED_SID:colorClass="zp_grbg";break;case HRCase.CANCELLED_SID:colorClass="zp_rclr";break;default:newClassName="zp_bclr"}return colorClass},getAvatarImageDiv:function(data,mode,multiselect){var html="",userPopup="",name=data.agent.details,photo="";return userPopup=HRCase.List.agentPopup(data.agent.typeId,data.agent.valueId),data.agent.hasOwnProperty("name")&&(photo=data.agent.employeePhoto,name=data.agent.name,userPopup=HRCase.List.agentPopup(OWNER_EMPLOYEE.toString(),data.agent.zuid)),html+=CommonTemplates.returnImgDiv(photo,ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(name))),"","",userPopup,multiselect)},newstatusChange:function(statusId,caseId){var pageId=Layout.Page.container,newClassName=HRCase.List.getStatusColorClass(statusId);if(pageId.find("#cStatus").attr("class",newClassName),void 0!=caseId){var statusName="";$.each(HRCase.STATUS,function(key){HRCase.STATUS[key]!=statusId||(statusName=key)});var statusObj=pageId.find("#caseList").find("[caseid="+caseId+"]").find("[name=CLstatus] span");statusObj.attr("class",newClassName),statusObj.html(statusName),statusObj.attr("statusId",statusId),statusId!=HRCase.COMPLETED_SID?pageId.find("#caseList").find("[caseid="+caseId+"]").removeClass("zp_cmpl"):(pageId.find("#caseList").find("[caseid="+caseId+"]").find("[name=SLAData]").remove(),pageId.find("#caseList").find("[caseid="+caseId+"]").addClass("zp_cmpl"))}},footerStatusUpdate:function(oldStatusId,newStatusId){var pageId=Layout.Page.container;if(void 0!=oldStatusId){var oldStatus=pageId.find("[name='footerposition']").find("span[value="+oldStatusId+"]");oldStatus.length>0&&oldStatus.text(parseInt(oldStatus.text())-1)}if(void 0!=newStatusId){var newStatus=pageId.find("[name='footerposition']").find("span[value="+newStatusId+"]");newStatus.length>0&&newStatus.text(parseInt(newStatus.text())+1)}}},HRCase.DetailedView={MORE_OPTION:[],permittedCaseStatus:[],reply_content:"",caseObj:"",newviewCaseDetails:function(caseid,self){var pageId=Layout.Page.container,url=Layout.Page.hash;AdvancedFilter.hideFilter(),pageId.find("#caseDtls").find("#zp_page_loading").remove(),pageId.find("div[caseid]").removeClass("sel"),pageId.find('div[caseid = "'+caseid+'"]').addClass("sel");var params={conreqcsr:csrfToken,method:"getInfoInCase",caseId:caseid};$.isEmptyObject(HRCase.PRIORITY)&&HRCases.getPriorityList(),ZPeople.Request.send("/getHRCaseInfoPanel.zp",params,function(response){if(pageId.find(".IC-hc-task").parent().removeClass("zp_dyn"),"success"==response.status){var onlyCaseDetails=response.InfoPanel.viewCaseDataOnly,caseDtl=response.InfoPanel.caseDtls;ZPForm.CURRFORM_PARAM.recordId=caseid,ZPForm.CURRFORM_PARAM.formId=response.hrcaseformId,ZPForm.CURRFORM_PARAM.tableName=HRCaseTableName,HRCase.DetailedView.caseObj=response;var _caseAdmin=HRCase.isCaseAdmin(caseDtl.categoryId);if(pageId.find("#caseDtls").length<=0){var viewPg=HRCaseContainer.cViewPageHtml();Layout.Page.container.append(viewPg)}-1===url.indexOf("selfservice/cases/list")&&-1===url.indexOf("selfservice/mycases/list")||pageId.find("#caseDtls").css({position:"fixed"});var cViewHeader=HRCaseContainer.cViewHeader(caseDtl);pageId.find("#viewcasedtls").empty().append($(cViewHeader)),pageId.find("#header_subject").prev().html(caseDtl.caseId+"");var cViewSplitHtml=HRCaseContainer.cViewSplitHtml();pageId.find("#viewcasedtls").append($(cViewSplitHtml));var cViewLeftHtml=HRCaseContainer.cViewLeftHtml();pageId.find("#casevwNotesContainer").append($(cViewLeftHtml));var cViewLeftBottom=HRCaseContainer.cViewLeftBottom();pageId.find("#casevwNotesContainer").append($(cViewLeftBottom));var cViewRightHtml=HRCaseContainer.cViewRightHtml();pageId.find("#caserightinfo").empty().append($(cViewRightHtml)),response.isCaseTypeEnabled||pageId.find("#caseType").remove(),pageId.find("#caseDtls").attr("caseid",caseid),pageId.find("#caseDtls").attr("streamid",caseid),pageId.find("#sla_time").on("click",SLA.getSLAHistory),SLA.showSLABand(response.sla),pageId.find("#categoryList #subCategoryList #caseType #cStatus  #casepriorityDiv  #caseAgent").empty();var _caseDtlHtm=HRCaseData.casecard(caseDtl);if(pageId.find("#zrhrcv_comments").html(_caseDtlHtm),response.hasOwnProperty("HRCaseFeedComment")&&!onlyCaseDetails&&(parseInt(response.HRCaseFeedComment.totalComments)>0||response.HRCaseFeedComment.comments.length>0)){var hrCaseFeedCmnt=response.HRCaseFeedComment,_caseCmntHtm=HRCaseData.casecmntconstruction(hrCaseFeedCmnt,response.InfoPanel.caseDtls.requestor.erecno==erecno&&"5"==response.InfoPanel.caseDtls.statusId,response.casesFeedbackType);pageId.find("#zrhrcv_comments").append(_caseCmntHtm),response.InfoPanel.feedbackPostComment&&pageId.find("#zrhrcv_comments").append(5==response.InfoPanel.casesFeedbackType?'<div class="zp_cVmn zp_AtMd"><div class="ZP_photo pc5"><i class="IC-hrc"></i></div><div><div class="zp_fDsmAl"><i class="CR-f-vgood"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><i class="CR-f-good"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><i class="CR-f-neutral"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><i class="CR-f-bad"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><i class="CR-f-vbad"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i></div><em>Give Your Feedback</em></div><div id="postFeedbackBtnCase" class="zp_btn text-right"><button class="zpthm">'+ZPI18N.getString("zp.feedback")+"</button></div></div>":'<div class="zp_cVmn zp_AtMd"><div class="ZP_photo pc5"><i class="IC-hrc"></i></div><div><div class="zp_fDsmAl"></i><i class="CR-f-good"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><i class="CR-f-neutral"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><i class="CR-f-bad"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i></div><em>Give Your Feedback</em></div><div id="postFeedbackBtnCase" class="zp_btn text-right"><button class="zpthm">'+ZPI18N.getString("zp.feedback")+"</button></div></div>"),pageId.find("#zrhrcv_comments").find("[id=postFeedbackBtnCase]").parent().not(":last").remove(),pageId.find("#zrhrcv_comments").find("[id=postFeedbackBtnCase]").off().on("click",function(e){CasesFeedback.postFeedbackPopUp(caseid)}),HRCaseAction.shareFAQClick(),HRCaseAction.convertSmileys(),setTimeout(function(){pageId.find(".cboxElement").off("click").on("click",function(event){ZPFeeds.registerAttPreview(event,this,caseid)})},300)}if(caseDtl.hasOwnProperty("recordOwner")){var _recordHtm=HRCaseData.cvRecordOwnerInfo(caseDtl.recordOwner);pageId.find("#zphrc_vownerd").empty().append(_recordHtm),pageId.find("#zphrc_vownerd").removeClass("zp_dyn")}var _requestorHtm=HRCaseData.cvRequestorInfo(caseDtl.requestor);HRCase.DetailedView.MORE_OPTION=[],pageId.find("#zphrc_vreqd").empty().append(_requestorHtm);var allowCancel=caseDtl.requestor.erecno==erecno;caseDtl.hasOwnProperty("recordOwner")&&!allowCancel&&(allowCancel=caseDtl.recordOwner.erecno==erecno);var allowUnassign=null!=caseDtl.agentId&&caseDtl.agentId==erecno&&caseDtl.agentTypeId;allowCancel=caseDtl.requestor.erecno==erecno;caseDtl.hasOwnProperty("recordOwner")&&!allowCancel&&(allowCancel=caseDtl.recordOwner.erecno==erecno);var allowDelete=!!response.InfoPanel.hasOwnProperty("allowDelete")&&response.InfoPanel.allowDelete,allowFollowCase=(allowUnassign=!!response.InfoPanel.hasOwnProperty("unassign")&&response.InfoPanel.unassign,caseDtl.requestor.erecno!=erecno);if(caseDtl.statusId!=HRCase.CANCELLED_SID&&caseDtl.statusId!=HRCase.COMPLETED_SID&&(allowFollowCase&&!caseDtl.hasOwnProperty("followerMode")&&HRCase.DetailedView.MORE_OPTION.push({id:"followCase",value:ZPI18N.getString("zp.followcase")}),allowCancel&&HRCase.DetailedView.MORE_OPTION.push({id:"cancelCase",value:ZPI18N.getString("zp.cancelReq")}),allowUnassign&&HRCase.DetailedView.MORE_OPTION.push({id:"unassignCase",value:ZPI18N.getString("zp.unassign")})),allowDelete&&-1===url.indexOf("#hrcase/reports/requestedvsclosed")&&-1===url.indexOf("#hrcase/reports/overallreport")&&HRCase.DetailedView.MORE_OPTION.push({id:"delCase",value:ZPI18N.getString("zp.deletecase")}),pageId.find("#zphr_vctlft > i").off("click").on("click",function(){HRCaseMoreOption.dropdown($(this),caseDtl.caseId)}),HRCaseAction.changeCategoryDropdown(caseid,caseDtl.requestor.erecno!=erecno,"",response.InfoPanel.changeCategoryList,caseDtl.categoryId,caseDtl.subCategoryId,caseDtl),HRCase.DetailedView.permittedCaseStatus=caseDtl.permittedCaseStatus,HRCase.DetailedView.permittedCasePriority=caseDtl.permittedCasePriority,HRCase.DetailedView.permittedCaseType=caseDtl.permittedCaseType,HRCase.DetailedView.permittedCasePriority.length<=0){var _htm=HRCaseData.rightSideSigleData(ZPI18N.getString("zp.priority"),"priorityId",caseDtl.priority,caseDtl.priorityId);pageId.find("#casepriorityDiv").html("").append(_htm)}else HRCase.AddManualCase.setPriortyOption(pageId.find("#casepriorityDiv"),"priorityId","priorityList",caseDtl.priorityId,"caseview",caseid,!0);if(HRCase.DetailedView.permittedCaseStatus.length<=0){_htm=HRCaseData.rightSideSigleData(ZPI18N.getString("zp.status"),"caseStatusInp",caseDtl.status,caseDtl.statusId);pageId.find("#cStatus").html("").append(_htm)}else HRCaseAction.selectCaseStatus(caseid,caseDtl.statusId,caseDtl.isAgent,HRCase.DetailedView.permittedCaseStatus),pageId.find("#caseStatusInp").zpselect({selectedVal:[{id:caseDtl.statusId,text:caseDtl.status}],isMandatory:!0});if(response.hasOwnProperty("isCaseTypeEnabled")&&response.isCaseTypeEnabled)if(HRCase.DetailedView.permittedCaseType.length<=0){_htm=HRCaseData.rightSideSigleData(ZPI18N.getString("zp.casetype"),"caseTypeInp",caseDtl.typeId,caseDtl.type);pageId.find("#caseType").html("").append(_htm)}else HRCaseAction.selectCaseType(caseid,caseDtl.type,caseDtl.isAgent,HRCase.DetailedView.permittedCaseType),""!=caseDtl.typeId&&pageId.find("#caseTypeInp").zpselect({selectedVal:[{id:caseDtl.typeId,text:caseDtl.type}],isMandatory:!0});if(caseDtl.hasOwnProperty("source")){var _sourcehtm=HRCaseData.rightSideSigleData(ZPI18N.getString("zp.sourceofrequest"),"reqSourceId",caseDtl.source,caseDtl.sourceid);pageId.find("#caseSource").html("").append(_sourcehtm)}if(setTimeout(function(){caseDtl.statusId!=HRCase.CANCELLED_SID&&caseDtl.statusId!=HRCase.COMPLETED_SID||HRCaseAction.rightActionDisableOnStatus(caseDtl.statusId)},300),response.InfoPanel.hasOwnProperty("assignedToList")&&response.InfoPanel.assignedToList){var menuProp=HRCaseAction.selectAgentDropdown(caseid,"caseView");if(menuProp.isMandatory=!0,CommonTemplates.getSelectMenu(menuProp,pageId.find("#caseAgent"),{id:"newAgentInp",placeholder:ZPI18N.getString("zp.select")+" "+ZPI18N.getString("zp.agent")},{inputHeaderName:ZPI18N.getString("zp.agent"),isMandatory:!0,hideMandatoryMark:!0}),caseDtl.hasOwnProperty("agent")){ZPeople.getUserDetailsById(caseDtl.agent.valueId);var userDetails="1"==caseDtl.agent.hasOwnProperty("employeePhoto")?ZPeople.getUserDetailsById(caseDtl.agent.valueId):{},imageVal=caseDtl.agent.hasOwnProperty("employeePhoto")?caseDtl.agent.employeePhoto:"",displayName="1"==caseDtl.agent.typeId?userDetails.empid+" "+caseDtl.agentDetails:caseDtl.agentDetails,selectedValObj={id:caseDtl.agent.valueId,text:caseDtl.agent.details,imageAlt:ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(displayName))),image:imageVal};pageId.find("#newAgentInp").zpselect({selectedVal:[selectedValObj]})}}else if(caseDtl.hasOwnProperty("agent")){var altText=ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(caseDtl.agentDetails))),sourceUrl="",popup=(caseDtl.agent.valueId,caseDtl.agent.typeId,HRCase.List.agentPopup(caseDtl.agent.typeId,caseDtl.agent.valueId));caseDtl.agent.hasOwnProperty("erecno")&&(popup=HRCase.List.agentPopup(OWNER_EMPLOYEE.toString(),caseDtl.agent.zuid),sourceUrl=caseDtl.agent.employeePhoto,agentZuid=caseDtl.agent.zuid,caseDtl.agentDetails=caseDtl.agent.name,caseDtl.agent.erecno,OWNER_EMPLOYEE.toString());var _photoUrl=CommonTemplates.returnImgDiv(sourceUrl,altText,"","",popup),_singleAgentHtm=HRCaseData.singleAgentData(caseDtl.agent.valueId,caseDtl.agentDetails,_photoUrl);pageId.find("#caseAgent").html(_singleAgentHtm)}if(pageId.find("#zrphrc_prevnxt").remove(),-1==Layout.Page.hash.indexOf("#selfservice/cases/list")&&Layout.Page.hash.indexOf("#home/dashboard")){_htm=HRCaseContainer.cViewPrevNxt();$(_htm).insertBefore("#timer"),pageId.find("#zrphrc_prevnxt i").off("click").on("click",function(){HRCaseAction.showPrevOrNxt($(this).attr("type"),caseid)})}var actJson={divId:"zp_noteEditor",subBtnId:"submitbtn",parentCon:"editor_container",isActivity:!1,isavatarnded:!1,isTitleNeeded:!1,placeholder:"Reply"};if(actJson.actRecId=caseid,actJson.fdk=response.HRCaseFeedComment.fdk,actJson.editorheight="150",actJson.cancelnotneeded=!0,actJson.isAutogrowEnabled=!1,actJson.isAttachNeeded=!0,onlyCaseDetails){if(pageId.find("#cmntnotes_menu li:first-child").hide(),pageId.find("#cmntnotes_menu li:last-child").addClass("sel"),pageId.find("#i_choosestatus").addClass("zp_dyn"),pageId.find("#comment_cont").hide(),pageId.find("#caseview_atch").hide(),pageId.find("#casenote_cont").show(),pageId.find("#replysubmitbtn").hide(),pageId.find("#savenotebutton").show(),!ZPFeeds.Editor.editorList.zp_noteEditor){Layout.Page.container.find("#casenote_cont").append(ZPFeeds.Editor.getEditorContainer(actJson));var zp_noteEditor=ZPFeeds.Editor.getEditor("zp_noteEditor","HRCaseNote");ZPFeeds.Editor.getfocusOnEditor(zp_noteEditor,!1)}setTimeout(function(){caseDtl.hasOwnProperty("noteId")&&HRCaseAction.fetchNotes(caseDtl.noteId)},300)}else{var cmtData=response.HRCaseFeedComment;if(pageId.find("#caseDtls").attr("fdk",cmtData.fdk),cmtData.actRecId=caseid,cmtData.customeButton=caseDtl.permittedCaseStatus.length>0,cmtData.status=response.InfoPanel.caseDtls.statusId,cmtData.reqID=caseDtl.requestor.erecno,cmtData.isAgent=caseDtl.isAgent,cmtData.isEscalatedUser=caseDtl.isEscalatedUser,cmtData.editorheight="150",cmtData.cancelnotneeded=!0,cmtData.isAutogrowEnabled=!1,cmtData.isAttachNeeded=!0,cmtData.hr_categoryId=caseDtl.categoryId,ZPFeeds.Editor.editorList.hasOwnProperty("cmt_editordiv_"+cmtData.fdk)&&delete ZPFeeds.Editor.editorList["cmt_editordiv_"+cmtData.fdk],ZPFeeds.Editor.editorList.zp_noteEditor&&delete ZPFeeds.Editor.editorList.zp_noteEditor,HRCase.DetailedView.getAttachmentList(caseid,response.InfoPanel),caseDtl.noteId&&pageId.find("#cmntnotes_menu  li").last().attr("noteid",caseDtl.noteId),pageId.find("#cmntnotes_menu li").off("click").on("click",function(){pageId.find("#cmntnotes_menu li").removeClass("sel");var etype=$(this).attr("etype");if($(this).addClass("sel"),"1"==etype){pageId.find("#comment_cont").hide(),pageId.find("#caseview_atch").hide(),pageId.find("#casenote_cont").show(),pageId.find("#replysubmitbtn").hide(),pageId.find("#savenotebutton").show();var editor=ZPFeeds.Editor.editorList["cmt_editordiv_"+cmtData.fdk];if(editor&&(HRCase.DetailedView.reply_content=ZPFeeds.getSmileysAndMentions(editor.getContent(),!1)),!ZPFeeds.Editor.editorList.zp_noteEditor){Layout.Page.container.find("#casenote_cont").append(ZPFeeds.Editor.getEditorContainer(actJson));var zp_noteEditor=ZPFeeds.Editor.getEditor("zp_noteEditor","HRCaseNote");ZPFeeds.Editor.getfocusOnEditor(zp_noteEditor,!1)}var noteId=$(this).attr("noteid");void 0!=noteId&&setTimeout(function(){HRCaseAction.fetchNotes(noteId)},300)}else if(pageId.find("#casenote_cont").hide(),pageId.find("#comment_cont").show(),pageId.find("#savenotebutton").hide(),pageId.find("#replysubmitbtn").show(),pageId.find("#caseview_atch").show(),!ZPFeeds.Editor.editorList.hasOwnProperty("cmt_editordiv_"+cmtData.fdk)){ZPFeeds.Comment.getNewEditor(cmtData);var _attchHtm=HRCaseData.caseAttachFAQ(cmtData);setTimeout(function(){pageId.find("#cases_custBtn").remove(),$(pageId.find("#zpEditor").children()[0]).append($(_attchHtm)),cmtData.type===People.HrCase.type&&(pageId.find("#cases_custBtn").find("#addfaqbtn").off("click").on("click",function(){FAQ.showFAQSlider(this)}),pageId.find("#cases_custBtn").find("#attachfaqbtn").off("click").on("click",function(){FAQ.showShareFAQSlider(this)}))},300)}}),caseDtl.restrictCmt?(pageId.find("#cmntnotes_menu").find("li[etype=0]").addClass("DN"),pageId.find("#cmntnotes_menu").find("li[etype=1]").trigger("click")):pageId.find("#cmntnotes_menu").find("li[etype=0]").trigger("click"),(caseDtl.statusId==HRCase.CANCELLED_SID||HRCase.DetailedView.permittedCaseStatus.length<=0||caseDtl.statusId==HRCase.COMPLETED_SID)&&pageId.find("#i_choosestatus").addClass("zp_dyn"),pageId.find("#replysubmitbtn").off("click").on("click",function(event){if("I"==event.target.nodeName)HRCaseAction.setCVSubmitOption(this,_replyEditor,actJson,cmtData.fdk,$(this));else{var _replyEditor=ZPFeeds.Editor.editorList["cmt_editordiv_"+cmtData.fdk];HRCaseAction.submitReply(_replyEditor,actJson,ZPFeeds.getContentJson(_replyEditor,actJson),$(this))}}),pageId.find("#caseview_atch").off("click").on("click",function(){pageId.find("#hrcAttchedFiles").find("[type=file]").length<4?HRCaseFile.createInput(!0,caseid):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.maximum4filesreached"))}),pageId.find("#hrcase_recenttasktab").remove(),pageId.find("#hrcase_recentlist").remove(),pageId.find("#hrcase_addtasklist").remove(),HRCaseData.initTaskHtm(),pageId.find("#hrcase_addtasklist").addClass("zp_dyn"),Task.isTaskAvailable()){var reqId=caseDtl.requestor.erecno;if(caseDtl.hasOwnProperty("agentId")){if(response.taskList&&response.taskList.length>0){var taskHtm=HRCaseData.taskListCons(response.taskList);pageId.find("#hrcase_addtasklist").html(taskHtm),HRCaseAction.setTaskListHeight(),pageId.find("#hrcase_addtasklist > div").on("click",function(event){event.stopPropagation(),HRCaseAction.taskDetail(event)})}else{var _noData=HRCaseData.noDataFound("No Data Found");pageId.find("#hrcase_addtasklist").html(_noData)}reqId!=erecno||response.InfoPanel.caseDtls.agentId==erecno||isadmin||pageId.find("#hrcase_addtaskicn").addClass("zp_dyn")}else HRCaseAction.removeHRCaseTask();pageId.find("#hrcase_addtaskicn").on("click",function(){if(0==pageId.find("#quickTask").length){var taskHtm=HRCaseData.addTask();0==pageId.find("#hrcase_addtasklist").children().length?pageId.find("#hrcase_addtasklist").html(taskHtm):$(taskHtm).insertBefore(pageId.find("#hrcase_addtasklist").children()[0])}}),Task.canAddTask()||pageId.find("#hrcase_addtaskicn").addClass("zp_dyn"),HRCaseAction.setTaskListHeight(0)}HRCaseAction.scrollToBottom(),(_caseAdmin||isManageHRCase||response.InfoPanel.caseDtls.isAgent)&&-1==Layout.Page.hash.indexOf("#hrcase/myrequest")?setTimeout(function(){var _casejson={};_casejson.categoryId=caseDtl.categoryId,_casejson.query="",_casejson.status=Layout.Page.urlparam.status,_casejson.index=1,_casejson.requestorErecno=caseDtl.requestor.erecno,HRCaseAction.getRecentIntractionsList(1,_casejson,caseid)},300):HRCaseAction.removeRecentInteractions(),caseDtl.requestor.erecno!=erecno||response.InfoPanel.caseDtls.agentId==erecno||_caseAdmin||(pageId.find("#hrcase_recenttasktab").remove(),pageId.find("#hrcase_recentlist").remove(),pageId.find("#hrcase_addtasklist").remove()),HRCaseAction.scrollToBottom()}pageId.find("#savenotebutton").on("click",function(){var isEdit=!!pageId.find("#cmntnotes_menu  li").last().attr("noteid");HRCaseAction.addNotes(caseid,isEdit)})}else ZPeople.Message.showFailureMsg(response.desc),HRCase.DetailedView.closeSlide()})},CASE_VIEW_PAGE:"caseViewPage",CASE_FEEDS_PAGE:"caseFeedsPage",changeCategoryDropdown:function(obj,recordId,mode,allowFollow,callback,changeCategoryList,oldcategoryId,oldsubcategoryId){var params=[],currentSubCgyList=[],currentCgyData={},selectedCgyLiObj={};$.isEmptyObject(changeCategoryList)||$.each(changeCategoryList,function(i,v){var param1={};param1.id=v.categoryId,param1.value=v.categoryName,param1.iconClass="zp_Si "+Icons.getIconClass(v.categoryIcon).iconClass,params.push(param1),v.categoryId==oldcategoryId&&(currentSubCgyList=v.subCategoryList,currentCgyData={id:v.categoryId,text:v.categoryName,iconClass:"zp_Si "+Icons.getIconClass(v.categoryIcon).iconClass},selectedCgyLiObj=v)});var popupBody=$('<div><div id="chcategoryList"></div><div id="subCategoryList"></div></div>');allowFollow&&popupBody.append($('<p class="inlCbox MT10"><label class="checkbox"><input id="folChk" name="folChk" type="checkbox"><span>'+ZPI18N.getString("zp.followcase")+"</span><div></div></label></p>"));var menuProp={id:"chcgyList",data:params,callback:function(liObj,sourceObj){var cId=$(liObj).attr("id");if(!$.isEmptyObject(changeCategoryList)){var subcList=[];if($.each(changeCategoryList,function(i,v){v.categoryId==cId&&(subcList=v.subCategoryList,selectedCgyLiObj=v)}),subcList.length>0){var subcgyparams=[];$.each(subcList,function(i,v){var param1={};param1.id=v.subCategoryId,param1.value=v.subcategoryname,subcgyparams.push(param1)}),selectedCgyLiObj.isSubCategoryMandatory&&(subcgyparams[0].isDefaultValue=!0),CommonTemplates.getSelectMenu({id:"subcgyList",data:subcgyparams},popupBody.find("#subCategoryList"),{id:"subcgyListInp"},{isMandatory:selectedCgyLiObj.isSubCategoryMandatory,hideMandatoryMark:!1,inputHeaderName:ZPI18N.getString("zp.subcategory")})}else popupBody.find("#subCategoryList").empty(),popupBody.find("#subCategoryList").removeAttr("class")}}};if(CommonTemplates.getSelectMenu(menuProp,popupBody.find("#chcategoryList"),{id:"chcgyListInp"},{inputHeaderName:ZPI18N.getString("zp.category"),isMandatory:!0}),$.isEmptyObject(currentCgyData)||popupBody.find("#chcgyListInp").zpselect({selectedVal:[currentCgyData]}),currentSubCgyList.length>0){var subcgyparams=[],currentSubCgyData={};$.each(currentSubCgyList,function(i,v){var param1={};param1.id=v.subCategoryId,param1.value=v.subcategoryname,ZPUtil.Validation.isEmpty(oldsubcategoryId)||v.subCategoryId!=oldsubcategoryId||(currentSubCgyData={id:v.subCategoryId,text:v.subcategoryname}),subcgyparams.push(param1)});var subCgyMenuProp={id:"subcgyList",data:subcgyparams};CommonTemplates.getSelectMenu(subCgyMenuProp,popupBody.find("#subCategoryList"),{id:"subcgyListInp"},{isMandatory:selectedCgyLiObj.isSubCategoryMandatory,hideMandatoryMark:!1,inputHeaderName:ZPI18N.getString("zp.subcategory")}),ZPUtil.Validation.isEmpty(oldsubcategoryId)||popupBody.find("#subcgyListInp").zpselect({selectedVal:[currentSubCgyData]})}CommonTemplates.Popup.showPopup(ZPI18N.getString("zp.changecategory"),popupBody),$("#cnf_popup").find("#popup_confirm").off("click").on("click",function(){$(this).prop("disabled",!0),CommonTemplates.removeErrorMessageinTextBox($("#cnf_popup").find("#chcgyListInp"));var isFollow=!1;allowFollow&&(isFollow=$("#cnf_popup").find("#folChk").is(":checked"));var subCategoryId="",selectedSubCgyObj={},newcgyId=$("#cnf_popup").find("#chcgyListInp").attr("selectedids");void 0!=newcgyId&&""!=newcgyId?($("#cnf_popup").find("#subcgyListInp").length>0&&(subCategoryId=void 0==$("#cnf_popup").find("#subcgyListInp").attr("selectedids")?"":$("#cnf_popup").find("#subcgyListInp").attr("selectedids"),ZPUtil.Validation.isEmpty(subCategoryId)||$.each(selectedCgyLiObj.subCategoryList,function(i,v){v.subCategoryId==subCategoryId&&(selectedSubCgyObj=v)})),newcgyId!=oldcategoryId||subCategoryId!=oldsubcategoryId?HRCase.DetailedView.ChangeCategory(selectedCgyLiObj,obj,recordId,isFollow,callback,selectedSubCgyObj):CommonTemplates.Popup.closePopup()):CommonTemplates.setErrorMessageinTextBox($("#cnf_popup").find("#chcgyListInp"),ZPI18N.getString("zp.selecthrcategory"))})},feedsCgyDN:function(obj){var boxId=$(obj).closest(".zp-fd-box"),caseId=boxId.attr("streamid"),caseCatalog={method:"getPermittedCategory",conreqcsr:csrfToken,caseId:caseId};$.ajax({url:"/getPermittedCategory.zp",type:"POST",data:caseCatalog,async:!1,success:function(resultdata){var oldcategoryId=$(obj).attr("cgeid"),oldsubcategoryId=$(obj).attr("subcategoryId");HRCase.DetailedView.changeCategoryDropdown(obj,caseId,HRCase.DetailedView.CASE_FEEDS_PAGE,!0,function(data,newCategoryObj,newSubCategoryObj){var categoryObj=boxId.find("#cgyName").parent();if(categoryObj.html(ZPeople.LOADING_HTML),data.assignedToList.hasOwnProperty("assigneeList")&&0==data.assignedToList.assigneeList.length){var agentDiv=boxId.find(".zp-fd-user"),agentDetails=data.agent;agentDiv.empty().append('<div class="dpcnt"><img popup="user" empid='+agentDetails.zuid+' src="'+agentDetails.employeePhoto+'" class="zp-usimg FL"></div><div class="zp-fd-uname">'+agentDetails.name+"</div>")}else{agentDiv=boxId.find(".zp-fd-user");var agentTypeId=data.agentTypeId,pickUpBtn=!1;2==agentTypeId&&data.agentValueId==_LOGGEDIN_DEPID?pickUpBtn=!0:3==agentTypeId&&$.each(_LOGGEDIN_GROUPID,function(k,grpId){data.agentValueId===grpId&&(pickUpBtn=!0)});var agentIcon='<div class="dpcnt">'+ZPeople.getShortName(data.agent_details)+'</div><div class="zp-fd-uname">'+data.agent_details+'</div><div class="btn-pickup">';!0===pickUpBtn&&(agentIcon+='<button onclick="HRCaseFeeds.pickupHRCase(this)" caseid='+boxId.attr("streamid")+' class="btn btn-primary">'+ZPI18N.getString("zp.pick")+"</button>"),agentIcon+="</div>",agentDiv.empty().append(agentIcon)}HRCase.Comments.constructSinglefieldComments(data,boxId.attr("streamid"));var subCategoryId="",subCategoryName="";$.isEmptyObject(newSubCategoryObj)||(subCategoryId='subCategoryId = "'+newSubCategoryObj.subCategoryId+'"',subCategoryName=" - "+newSubCategoryObj.subcategoryname),categoryObj.empty().append('<a onclick="HRCase.DetailedView.feedsCgyDN(this)" '+subCategoryId+" cgeId="+newCategoryObj.categoryId+' id="cgyName" class="zp-fdedit">'+newCategoryObj.categoryName+subCategoryName+"</a>"),boxId.find("#cgeNameHeader").text(ZPeople.decodeTxt(newCategoryObj.categoryName))},resultdata.changeCategoryList,oldcategoryId,oldsubcategoryId)}})},getFormView:function(caseid){var parentDiv=Layout.Page.container.find("#showFromInfo").find("div.zp_Plnk");parentDiv.hasClass("zp_sel")?(parentDiv.next().remove(),parentDiv.removeClass("zp_sel"),parentDiv.empty().append(ZPI18N.getString("zp.showdetails")+'<i class="IC-ar-dwn"></i>'),parentDiv.after('<div id="formInfo"></div>')):(parentDiv.addClass("zp_sel"),parentDiv.empty().append(ZPI18N.getString("zp.hidedetails")+'<i class="IC-ar-dwn"></i>'),HRCases.CURR_COMPONENT={formId:ZPForm.CURRFORM_PARAM.formId,recordId:caseid,isPageMode:!0,formMode:"VIEW",containerId:"formInfo",loadingContainer:"showFromInfo",disableSingleEdit:!0},ZPForm.load(HRCases.CURR_COMPONENT))},getAssignedToList:function(event,obj,caseId,mode,callback){event.stopPropagation(),event.preventDefault(),HRCase.ASSIGNEE_LIST.hasOwnProperty(caseId)||ZPeople.Request.sendAsyncPost("/getAssignedToList.zp",{caseId:caseId,method:"getAssignedToList",conreqcsr:csrfToken},function(data){"success"==data.status?data.assignedToList.isAssigneeAvailable?HRCase.ASSIGNEE_LIST[caseId]=data.assignedToList.assigneeList:HRCase.ASSIGNEE_LIST[caseId]=[]:ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.ttfailuremsg"))},function(){ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.ttfailuremsg"))});var empdata=[];if($.each(HRCase.ASSIGNEE_LIST[caseId],function(i,value){var param1={value:value.empDispName,image:value.empPhoto,id:value.empErecno,ownerType:OWNER_EMPLOYEE,dataval:"callbackcal"};empdata.push(param1)}),empdata.length>0){var existingAgent=$(obj).attr("selectedids"),isAllowed=!0;$(obj).zparrowmenu({id:"assignedToList",data:empdata,callback:function(liObj,srcObj){void 0!=existingAgent&&""!=existingAgent&&$(liObj).attr("id")==existingAgent&&(isAllowed=!1),isAllowed&&HRCase.DetailedView.assignHrcase(srcObj,liObj,caseId,mode)}})}void 0!=callback&&"function"==typeof callback&&callback(empdata)},getAttachments:function(caseId,fileArr){var html="";return $.each(fileArr,function(i,v){var fileExtn=v.fileName.substring(v.fileName.lastIndexOf(".")+1),previewfileId=v.hasOwnProperty("previewFileId")?v.previewFileId:"",extn=v.fileName.substring(v.fileName.lastIndexOf(".")+1),icon=CommonTemplates.getFileIcon(extn);"1"==v.uploadSource||v.filePath.indexOf(workDriveUrl)>-1||v.filePath.indexOf(writerUrl)>-1||v.filePath.indexOf(sheetUrl)>-1||v.filePath.indexOf(showUrl)>-1?(icon="IC-wd",html+='<div class="attachedFile filePosts"  attachcnt="'+i+'1" onclick=window.open("'+v.filePath+'") > <i class="'+icon+' fileType"></i><i onclick=window.open("'+v.filePath+'") class="IC-down"></i><div class="fileNameAndSize" ><label class="fileName" purpose="fileName">'+decodeURIComponent(v.fileName)+'</label> <span purpose="fileSize">'+(null!=v.filesize?v.filesize:"")+"</span> </div></div>"):html+='<div class="attachedFile filePosts"  attachcnt="'+i+'1" onclick="casesFiles.getFilePreview(\''+v.fileUploadId+"','"+caseId+"','"+HR_CASE_ATTACHEMENTS+"','"+escape(v.fileName)+"','"+fileExtn+"','"+previewfileId+'\')"> <i class="'+icon+' fileType"></i><i onclick="casesFiles.getFileDownload(event,\''+v.fileUploadId+"','"+caseId+"','"+HR_CASE_ATTACHEMENTS+"',"+v.hasOwnProperty("previewFileId")+')" class="IC-down"></i><div class="fileNameAndSize" ><label class="fileName" purpose="fileName">'+decodeURIComponent(v.fileName)+'</label> <span purpose="fileSize">'+(null!=v.filesize?v.filesize:"")+"</span> </div></div>"}),html},getAttachmentList:function(caseId,response){var pageId=Layout.Page.container;if(response.hasOwnProperty("filesList")&&response.filesList.length>0){pageId.find("#caseAttch").removeClass("zp_dyn"),pageId.find("#filesAttch").empty();var html=HRCase.DetailedView.getAttachments(caseId,response.filesList);pageId.find("#filesAttch").append(html)}else pageId.find("#caseAttch").addClass("zp_dyn"),pageId.find("#filesAttch").empty()},closeSlide:function(){var pageId=Layout.Page.container;pageId.find("div[caseid]").removeClass("sel"),Layout.Page.container.hasClass("zp_Pshw")&&Layout.Page.container.removeClass("zp_Pshw"),-1!==Layout.Page.hash.indexOf("#hrcase/myrequest")?window.location.href="#hrcase/myrequest/list":-1!==Layout.Page.hash.indexOf("#hrcase/list/")?window.location.href="#hrcase/list":-1!==Layout.Page.hash.indexOf("#hrcase/allcases/")?window.location.href="#hrcase/allcases/list":-1!==Layout.Page.hash.indexOf("#hrcase/watchlist/")?window.location.href="#hrcase/watchlist/list":-1!==Layout.Page.hash.indexOf("#hrcase/escalation/")?window.location.href="#hrcase/escalation/list":-1!==Layout.Page.hash.indexOf("#hrcase/unassigned/")?window.location.href="#hrcase/unassigned/list":-1!==Layout.Page.hash.indexOf("#hrcase/opencases/")?window.location.href="#hrcase/opencases/list":-1!==Layout.Page.hash.indexOf("#hrcase/unmanaged/")&&(window.location.href="#hrcase/unmanaged/list"),pageId.find("#hrcaseHead").find("div.zp_lwrap").hasClass("zp_kansh")&&pageId.find("#hrcaseHead").find(".zp_lwrap").removeClass("zp_kansh"),pageId.find("#showNotes").hasClass("shw")&&pageId.find("#showNotes").removeClass("shw"),clearInterval(SLA.timer)},changeCaseStatus:function(caseId,ele,oldCaseStatus){var pageId=Layout.Page.container,url=Layout.Page.hash,params={conreqcsr:csrfToken,status:$(ele).attr("id"),zp_recordId:caseId,method:"changeCaseStatus"},oldhtml=pageId.find("#caseStatus").html();ZPeople.Request.send("/changeCaseStatus.zp",params,function(data){if("success"==data.status){var _statusName=params.status==HRCase.CANCELLED_SID?ZPI18N.getString("zp.cancelled"):$(ele).attr("name");HRCaseAction.cancelStatusCallBack(data,oldCaseStatus,params.status,_statusName,caseId),-1!==url.indexOf("#hrcase/reports/requestedvsclosed")?(5==$(ele).attr("id")?(HRCReport.MY_CURRENT_DATA.lineGraph.closeCountList[HRCReport.MY_CURRENT_DATA.position]+=1,HRCReport.MY_CURRENT_DATA.lineGraph.openCountList[HRCReport.MY_CURRENT_DATA.position]-=1,HRCReport.MY_CURRENT_DATA.lineGraph.totalClose+=1):5==oldCaseStatus&&(HRCReport.MY_CURRENT_DATA.lineGraph.closeCountList[HRCReport.MY_CURRENT_DATA.position]-=1,HRCReport.MY_CURRENT_DATA.lineGraph.openCountList[HRCReport.MY_CURRENT_DATA.position]+=1,HRCReport.MY_CURRENT_DATA.lineGraph.totalClose-=1),HRCReport.lineChartImplementation(HRCReport.MY_CURRENT_DATA,HRCReport.MY_CURRENT_DATA.categoryId)):-1!==url.indexOf("#hrcase/reports/overallreport")&&7!=HRCReport.MY_CURRENT_DATA.sysValue&&HRCReport.columnChartValueCallback(caseId,ele,oldCaseStatus)}else{pageId.find("#caseStatus").html(oldhtml),pageId.find("#caseStatus").attr("selectedids",oldCaseStatus);var failureMessage=data.desc;data.desc.hasOwnProperty("status")&&(failureMessage=data.desc.status),ZPeople.Message.showFailureMsg(failureMessage)}SLA.showSLABand(data.sla)})},changeStatusCallBack:function(data,oldStatusId,newstatusId,newstatusName,caseId,noComment){var pageId=Layout.Page.container;if(HRCase.DetailedView.MORE_OPTION=jQuery.grep(HRCase.DetailedView.MORE_OPTION,function(value){return"cancelCase"!=value.id}),0==HRCase.DetailedView.MORE_OPTION.length&&pageId.find("#moredropdown").remove(),void 0!=noComment&&noComment||HRCase.Comments.constructSinglefieldComments(data,caseId),newstatusId==HRCase.CANCELLED_SID?pageId.find("#cStatus").html('<span id="caseStatus"><font>'+ZPI18N.getString("zp.cancelled")+"</font></span>"):pageId.find("#cStatus").html('<span id="caseStatus"><font>'+newstatusName+'</font><i class="IC-ar-dwn"></i></span>'),pageId.find("#caseStatus").attr("selectedids",newstatusId),HRCase.List.newstatusChange(newstatusId,caseId),0!=pageId.find("#caseDtlsContent").find("#zp_addedit_record_"+ZPForm.CURRFORM_PARAM.formId).length){var fcid=pageId.find("[folabel=status]").attr("id").split("_").pop(),status_optionvalue=HRCaseForm.getOptionValue(fcid,ZPForm.CURRFORM_PARAM.formId,newstatusId);pageId.find("[folabel=status]").find("span").text(status_optionvalue),newstatusId==HRCase.COMPLETED_SID&&(pageId.find("[folabel=completed_time]").find("span").text(ZPI18N.getString("zp.now")),pageId.find("[folabel=complete_by]").find("span").text(ZPeople.CURR_USER.name)),HRCaseForm.fillDetailViewPage({case_number:$(pageId.find("[folabel=caseid]").find("span")[0]).text()})}if(newstatusId==HRCase.COMPLETED_SID){var closedTime=ZPDateTime.getDateDisplayFormat(Date.now()),headertext=ZPI18N.getString("zp.closed");-1===closedTime.indexOf(ZPI18N.getString("zp.today"))&&-1===closedTime.indexOf(ZPI18N.getString("zp.yesterday"))&&(headertext+=" "+ZPI18N.getString("zp.on")),pageId.find("#pickupOption").siblings("dt").html(headertext+" <span>"+closedTime+"</span> "+ZPI18N.getString("zp.by"));var popup=HRCase.List.agentPopup(OWNER_EMPLOYEE.toString(),_LOGGEDIN_ZUID);pageId.find("#caseOwner").html(CommonTemplates.returnImgDiv(ZPeople.CURR_USER.avatar,ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(ZPeople.CURR_USER.name))),"","",popup)+"<font "+popup+">"+ZPeople.CURR_USER.name+"</font>"),pageId.find("#caseList").find("div[caseid="+caseId+"]").addClass("zp_cmpl")}else if(pageId.find("#pickupOption").siblings("dt").html(ZPI18N.getString("zp.agent")),pageId.find("#caseList").find("div[caseid="+caseId+"]").removeClass("zp_cmpl"),data.hasOwnProperty("agent")){popup=HRCase.List.agentPopup(OWNER_EMPLOYEE.toString(),data.agent.zuid);pageId.find("#caseOwner").html(CommonTemplates.returnImgDiv(data.agent.employeePhoto,ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(data.agent.name))),"","",popup)+"<font "+popup+">"+data.agent.name+"</font>")}else{popup=HRCase.List.agentPopup(data.agentTypeId,data.agentValueId);pageId.find("#caseOwner").html(CommonTemplates.returnImgDiv("",ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(data.agent_details))),"","",popup)+"<font "+popup+">"+data.agent_details+"</font>")}newstatusId!=HRCase.CANCELLED_SID&&newstatusId!=HRCase.COMPLETED_SID||(pageId.find("#cgyName").closest("div").addClass("zp_NH"),pageId.find("#cgyName").off("click"),pageId.find("#cgyName").find("i.IC-ar-dwn").remove(),pageId.find("#caseOwner").closest("div").addClass("zp_NH"),pageId.find("#caseOwner").off("click"),pageId.find("#caseOwner").find("i").remove(),HRCase.ASSIGNEE_LIST[caseId]=[],pageId.find("#postclosecmts").remove()),data.hasOwnProperty("agent")&&(pageId.find("#caseList").find("[caseid="+caseId+"]").find("[name=CLAgent]").html(pageId.find("#caseOwner").find("div.ZP_photo")[0].outerHTML),HRCase.DetailedView.updateUnassignedCount(!0,1)),pageId.find("#caseStatus").off("click"),data.hasOwnProperty("permittedCaseStatus")&&data.permittedCaseStatus.length>0?(pageId.find("#cStatus").closest("div").removeClass("zp_NH"),pageId.find("#caseStatus").on("click",function(){HRCase.SearchFilter.selectCaseStatus(caseId,this,newstatusId,data.isAgent,data.permittedCaseStatus)})):(pageId.find("#cStatus").closest("div").addClass("zp_NH"),pageId.find("#cStatus").find("i.IC-ar-dwn").remove())},updateUnassignedCount:function(isDecreased,offset){var unassignedCountDiv=Layout.Page.container.find("[name=footerposition]").find("#unassigned");if(unassignedCountDiv.length>0){var count=parseInt(unassignedCountDiv.text());isDecreased?count-=offset:count+=offset,unassignedCountDiv.html(count)}},assignHrcase:function(srcObj,ele,caseid,mode){var pageId=Layout.Page.container,params=(Layout.Page.hash,{conreqcsr:csrfToken,method:"assignedHrcase",zp_recordId:caseid,assignedId:$(ele).attr("id")});pageId.find("#caseOwner").html(ZPeople.LOADING_HTML),ZPeople.Request.send("/assignedHrcase.zp",params,function(data){if("success"==data.status)if("caseList"==mode){var obj=$(srcObj).closest("div[caseid]");obj.find("[name=CLAgent]").remove(),$(obj).find("[name=CLstatus]").after('<div class="zp_Lass" name="CLAgent">'+HRCase.List.getAvatarImageDiv(data,mode)+"</div>")}else if("caseView"==mode||"categorychnge"==mode){if(HRCase.Comments.constructSinglefieldComments(data,caseid),0!=pageId.find("#caseDtlsContent").find("#zp_addedit_record_"+ZPForm.CURRFORM_PARAM.formId).length){var fcid=ZPForm.LAYOUT.find("div[folabel=agent]").attr("id").split("_").pop(),formcp=ZPForm.Field.getFieldComponent(fcid),value=ZPForm.Field.setValue(formcp,$(ele).attr("name"),fcid);ZPForm.LAYOUT.find("[folabel=agent]").html(value)}HRCase.DetailedView.newAgentDetails(caseid,{id:data.agent.zuid,name:ZPeople.escapeHtml($(ele).attr("name")),data:data,mode:mode},$(ele).find("div.ZP_photo")[0].outerHTML)}else HRCase.DetailedView.newAgentDetails(caseid,{id:data.agent.zuid,name:ZPeople.escapeHtml($(ele).attr("name")),data:data,mode:mode},$(ele).find("div.ZP_photo")[0].outerHTML);else ZPeople.Message.showFailureMsg(data.desc)})},newAgentDetails:function(caseId,agentData,imageDiv){var pageId=Layout.Page.container,url=Layout.Page.hash,data=agentData.data;pageId.find("#caseOwner").removeAttr("selectedids"),pageId.find("#caseOwner").html(imageDiv+"<font>"+agentData.name+"</font>"),void 0!=agentData.id&&(pageId.find("#caseOwner").attr("selectedids",data.agent.erecno),pageId.find("#caseOwner").find("div.ZP_photo").attr("popup","user"),pageId.find("#caseOwner").find("div.ZP_photo").attr("empid",agentData.id)),data.hasOwnProperty("taskList")||data.hasOwnProperty("agent")?(pageId.find("#zp_views_list_container_rel-1").empty(),Task.isTaskAvailable()?Task.constructRelatedTask(data.taskList,!0):pageId.find("#zp_views_list_container_rel-1").empty()):pageId.find("#zp_views_list_container_rel-1").empty();var agentRow=pageId.find('[caseid = "'+caseId+'"]');agentRow.find("[name=CLAgent]").empty(),-1===url.indexOf("hrcase/allcases/list")&&-1===url.indexOf("hrcase/opencases/list")&&-1===url.indexOf("hrcase/unassigned/list")&&-1===url.indexOf("hrcase/myfollows/list")&&-1===url.indexOf("#hrcase/allcases/view")&&-1===url.indexOf("#hrcase/unassigned/view")&&-1===url.indexOf("#hrcase/watchlist/view")&&-1===url.indexOf("#hrcase/escalation/view")&&-1===url.indexOf("#hrcase/reports/requestedvsclosed")&&-1===url.indexOf("#hrcase/reports/overallreport")&&-1===url.indexOf("selfservice/cases/list")&&-1===url.indexOf("selfservice/mycases/list")||("categorychnge"==agentData.mode||"unassign"==agentData.mode?data.hasOwnProperty("agent")?($(agentRow).find("[name=CLAgent]").html(HRCase.List.getAvatarImageDiv(data,agentData.mode)),$(agentRow).find("[name=CLAgent]").removeAttr("onclick"),$(agentRow).find("[name=CLAgent]").off("click")):data.hasOwnProperty("assignedToList")&&data.assignedToList.isAssigneeAvailable||void 0!=HRCase.ASSIGNEE_LIST[caseId]&&HRCase.ASSIGNEE_LIST[caseId].length>0?($(agentRow).find("[name=CLAgent]").html('<i class="IC-user-plu zp_rBf" id="pickUptoMe"></i>'),$(agentRow).find("[name=CLAgent]").attr("onclick","HRCase.DetailedView.getAssignedToList(event, this, '"+caseId+"', '"+agentData.mode+"')")):($(agentRow).find("[name=CLAgent]").html(CommonTemplates.returnImgDiv("",ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(data.agent_details))),"",data.agent_details,"")),$(agentRow).find("[name=CLAgent]").removeAttr("onclick"),$(agentRow).find("[name=CLAgent]").off("click")):$(agentRow).find("[name=CLAgent]").html(HRCase.List.getAvatarImageDiv(agentData.data)))},ChangeCategory:function(currCategoryObj,sourceObj,recordId,isFollow,callback,subcategoryObj){Layout.Page.container;var params={conreqcsr:csrfToken,method:"changeCatalog",categoryId:currCategoryObj.categoryId,zp_recordId:recordId};$.isEmptyObject(subcategoryObj)||(params.subCategoryId=subcategoryObj.subCategoryId),isFollow&&(params.followCase=!0);var originalHtml=$(sourceObj).html();$(sourceObj).html(ZPeople.LOADING_HTML),ZPeople.Request.send("/changeCatalog.zp",params,function(data){"success"!=data.status?($(sourceObj).html(originalHtml),ZPeople.Message.showFailureMsg(data.desc)):(CommonTemplates.Popup.closePopup(),SLA.showSLABand(data.sla),callback(data,currCategoryObj,subcategoryObj))})},categoryChangeCallback:function(caseId,data,categoryObj,subcategoryObj){var pageId=Layout.Page.container;if("success"==data.status){HRCase.Comments.constructSinglefieldComments(data,caseId);var altText=""!=data.agent_details?ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(data.agent_details))):"",sourceUrl="",popupZuid="",agentData={};data.hasOwnProperty("agentId")&&"null"!=data.agentId?(sourceUrl=data.agent.employeePhoto,agentData={id:popupZuid=data.agent.zuid,name:data.agent_details}):agentData={name:data.agent_details};var subCategoryData="",subCategoryListHtml="";$.isEmptyObject(subcategoryObj)?pageId.find("#cgyName").removeAttr("subCategoryId"):(pageId.find("#cgyName").attr("subCategoryId",subcategoryObj.subCategoryId),subCategoryData='<em class="zp_ldot">'+subcategoryObj.subcategoryname+"</em>",subCategoryListHtml='<em title="'+subcategoryObj.subcategoryname+'" class="zp_LsSbt">'+subcategoryObj.subcategoryname+"</em>"),pageId.find("#cgyName").html('<i class="zp_Si '+Icons.getIconClass(categoryObj.categoryIcon).iconClass+'"></i><font><em>'+categoryObj.categoryName+"</em>"+subCategoryData+"</font>"),agentData.mode="categorychnge",agentData.data=data;var photoDiv=""==sourceUrl&&""==altText?"":CommonTemplates.returnImgDiv(sourceUrl,altText,"","",popupZuid);HRCase.DetailedView.newAgentDetails(caseId,agentData,photoDiv);var caseRowCategorySection=pageId.find('[caseid = "'+caseId+'"]').find("[name=CLcategory]");$(caseRowCategorySection).html('<em title="'+categoryObj.categoryName+'">'+categoryObj.categoryName+"</em>"+subCategoryListHtml),$(caseRowCategorySection).attr("categoryId",$("#cgyName").attr("selectedIds")),$(caseRowCategorySection).attr("subCategoryId",$("#cgyName").attr("subCategoryId"));var categorydropdown="";pageId.find("#caseOwner").off("click"),data.hasOwnProperty("assignedToList")&&data.assignedToList.isAssigneeAvailable?(pageId.find("#caseOwner").closest("div").removeClass("zp_NH"),pageId.find("#caseOwner").append('<i class="IC-ar-dwn"></i>'),HRCase.ASSIGNEE_LIST[caseId]=data.assignedToList.assigneeList,pageId.find("#caseOwner").on("click",function(e){HRCase.DetailedView.getAssignedToList(e,this,caseId,"categorychnge")}),categorydropdown='<i class="IC-pen-1px"></i>'):(HRCase.ASSIGNEE_LIST[caseId]=[],pageId.find("#caseOwner").closest("div").addClass("zp_NH")),pageId.find("#cgyName").attr("selectedIds",categoryObj.categoryId),pageId.find("#cgyName").append(categorydropdown)}else ZPeople.Message.showFailureMsg(data.desc)},unAssignedHrcase:function(caseId){Layout.Page.container,Layout.Page.hash;var params={conreqcsr:csrfToken,method:"assignedHrcase",zp_recordId:caseId,assignedId:0};ZPeople.Request.send("/unAssignedHrcase.zp",params,function(data){if("success"==data.status){HRCaseAction.afterChangeCommentUpdate(data),HRCaseAction.scrollToBottom(),HRCase.DetailedView.MORE_OPTION=jQuery.grep(HRCase.DetailedView.MORE_OPTION,function(value){return"unassignCase"!=value.id}),data.unassign&&HRCaseAction.removeHRCaseTask();var _agentDetails=""!=data.agent_details?CommonTemplates.returnImgDiv("",ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(data.agent_details)))):"";$("#newAgentInp").removeAttr("selectedids"),$("#newAgentInp").prev().html("").append(_agentDetails+data.agent_details)}else ZPeople.Message.showFailureMsg(data.desc)})},deleteCase:function(caseids,isBulkDel,mode){var pageId=Layout.Page.container,popupHeader=ZPI18N.getString("zp.delete"),popupBody=void 0!=isBulkDel&&isBulkDel?ZPI18N.getString("zp.confirmdeletecases"):ZPI18N.getString("zp.confirmdeletecase");ZPeople.BSModal.confirm(function(e){var params={method:"deleteCase",caseId:caseids,conreqcsr:csrfToken};ZPeople.Request.send("/deleteCase.zp",params,function(data){if("success"==data.status){HRCase.DetailedView.closeSlide();var caseArr=caseids.split(","),deletedCount=0;if($.each(caseArr,function(i,v){$("div[caseid = "+caseArr[i]+"]").addClass("slowHide");var pageObj=pageId.find("[caseid = "+caseArr[i]+"]");pageObj.find(".IC-chk-box2").length>0&&(void 0==isBulkDel||!isBulkDel)&&HRCase.List.bulkSelect(pageObj.find("i[name=selBox]"),mode,!1);var statusId=parseInt(pageObj.find("[statusid]").attr("statusid"));HRCase.List.footerStatusUpdate(statusId),setTimeout(function(){$("div[caseid = "+caseArr[i]+"]").remove()},100),++deletedCount}),isBulkDel){var totalNo=pageId.find("[caseid]:not(.slowHide)").find("i[name=selBox]").length;HRCase.List.bulkSelectHeader(0,mode,totalNo),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.bulkdeletesuccess",[deletedCount]))}else ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.casedeletesuccess"))}else ZPeople.Message.showFailureMsg(data.desc)},{},function(resultData){var errResponse=resultData.responseJSON;"MORE_THAN_MAX_LENGTH"==errResponse.code&&"caseId"==errResponse.paramName?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.cannotdeletecases")):ZPeople.Message.showFailureMsg(errResponse.error)})},popupHeader,popupBody)},deleteComment:function(obj){Layout.Page.container;var popupHeader=ZPI18N.getString("zp.deletecommentheader"),popupBody=ZPI18N.getString("zp.deletecommentbody"),commentId=$(obj).closest("div[rel]").attr("rel");ZPeople.BSModal.confirm(function(e){var params={actionType:"DELETE_COMMENT",commentId:commentId,activityType:"HrCase"};ZPeople.Request.send("/feedActions.zp",params,function(data){if("success"==data){var imgDiv=$(obj).closest("div[rel]").find("div.ZP_photo").clone(),timeDiv=$(obj).closest("div[rel]").find("div.zp_cVtmD").clone();$(obj).closest("div[rel]").addClass("zp_vVdlM").empty().append(imgDiv).append(timeDiv).append(ZPI18N.getString("zp.commentwasdeleted")),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.commentdeletedsuccess"))}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.announcementdeletecommentfailure"))})},popupHeader,popupBody)}},HRCase.Comments={List:{FEEDS_ACTIVITY_TYPE:"HrCase"},customeButton:function(data,params,actRecId){var pageId=Layout.Page.container;if("home/feeds/myfeed"===Layout.Page.currentmode){var boxId=pageId.find("#zp_feeds_views").find("[streamid="+actRecId+"]");boxId.find("#status").text(ZPI18N.getString("zp.closed")),boxId.find("#customeBtn").remove()}else HRCase.DetailedView.changeStatusCallBack(data,pageId.find("#caseStatus").attr("selectedids"),HRCase.COMPLETED_SID,ZPI18N.getString("zp.closed"),actRecId,!0)},constructSinglefieldComments:function(data,recId){var pageId=Layout.Page.container,content=ZPFeeds.Activity.validateContent(data.content,void 0,void 0,!1),cmtDiv="<div  id="+data.cfdk+'  class="zp-cmtdiv" commentid='+data.commentId+"><div empid="+ZPeople.CURR_USER.id+' popup="user" class="zp-cmt-uimg"> <img src='+ZPeople.CURR_USER.thumb+' class="zp-usimg zphvr-cpro"> </div> <div class="zp-cmt-content"><a empid='+data.zuid+' popup="user" class="zp-cmt-uname zphvr-cpro">'+ZPeople.CURR_USER.name+'</a><div class="zp-cmt-udt"><div>'+content+'<br></div></div> <div class="zp-cmt-uaction"> <span class="zpcmt-date FL">'+ZPDateTime.getDateDisplayFormat(data.time)+'</span> <div class="FL ZPdot"></div> <a id="zpcmt_like_link" class="zpcmt-like FL">'+ZPI18N.getString("zp.like")+"</a></div> </div> </div>";(cmtDiv=$(cmtDiv)).find("#zpcmt_like_link").off("click").on("click",function(){ZPFeeds.Like.doLikeAction(this,recId,People.HrCase.type,!0)}),pageId.find("[streamid="+recId+"]").find("#cmtlistcont").removeClass("DN").append(cmtDiv)},showMoreComments:function(recordId,type,callback){var pageId=Layout.Page.container,params={method:"showMoreComments",conreqcsr:csrfToken,record_Id:recordId,reqType:type};ZPeople.Request.send("/showMoreComments.zp",params,function(data){if(callback&&"function"==typeof callback)callback(data,recordId);else{pageId.find("#zp_hrcase_comments").empty(),pageId.find("#zp_hrcase_comments").attr("streamid",recordId);for(var comments=data.comments,cnt=0;cnt<comments.length;cnt++)comments[cnt].content=ZPFeeds.Activity.validateContent(comments[cnt].content,!1,data.departmentDts,data.groupDts);data.comments=comments,data.actRecId=recordId,data.status=pageId.find("#caseStatus").attr("selectedIds"),data.customeButton=data.permittedCaseStatus.length>0,data.reqID=data.reqID;var newJSON={subBtnName:"zp.reply"};ZPACommon.constructCmtRw(data,Layout.Page.container.find("#zp_hrcase_comments"),newJSON),pageId.find("#view_more_cmts").empty().append("<a totalcmts="+data.totalComments+">"+ZPI18N.getString("zp.viewingallcomments",[data.totalComments])+"</a>")}})}},HRCase.KanbanView={URL:"/myHRCaseKanbanView.zp",showKanbanView:function(){HRCase.KanbanView.kanbanView({status:"",categoryId:"",query:""})},filterKanbanView:function(){var pageId=Layout.Page.container,criteriaObj={status:"",categoryId:"",query:""};pageId.find("#hrcasePreview").hasClass("zp_kanb")&&(""!=pageId.find("#searchInput").val()&&(criteriaObj.subject=pageId.find("#searchInput").val()),void 0!=pageId.find("#statusInput").attr("selectedids")&&(criteriaObj.status=pageId.find("#statusInput").attr("selectedids")),void 0!=pageId.find("#cgyInput").attr("selectedids")&&(criteriaObj.categoryId=pageId.find("#cgyInput").attr("selectedids")),void 0!=pageId.find("#casereqInput").attr("selectedids")&&(criteriaObj.caseRequestor=pageId.find("#casereqInput").attr("selectedids")),void 0!=pageId.find("#tymPeriodInput").attr("selectedids")&&(criteriaObj.dateRange=pageId.find("#tymPeriodInput").attr("selectedids"))),HRCase.KanbanView.kanbanView(criteriaObj)},kanbanView:function(CriteriaObj){var pageId=Layout.Page.container,url=Layout.Page.hash,reqType="",ddobj={};-1!==url.indexOf("#hrcase/list")?reqType=REQ_TYPE_MYCASES:-1!==url.indexOf("#hrcase/allcases/list")&&(reqType=REQ_TYPE_ALLCASES),pageId.find("#hrcaseHead").children().remove(),$.ajax({url:HRCase.KanbanView.URL,type:POST,async:!1,data:{conreqcsr:csrfToken,method:"myKanbanView",mode:"status",reqType:reqType,criteria:JSON.stringify(CriteriaObj)},success:function(data){"#hrcase/list"!=url&&"#hrcase/allcases/list"!=url||(window.location.href=Layout.Page.hash+"/kanbanView"),pageId.find("#hrcasePreview").addClass("zp_kanb"),pageId.find("#hrcaseHead").attr("mode","status"),ddobj.fcid=Object.keys(data)[0],ddobj.mode="status",ddobj.formid=ZPForm.CURRFORM_PARAM.formId,ddobj.tablename=HRCaseTableName,ddobj.callback=ZPTasks.doAfterKanbUpdate;var columnNo=1;$.each(data[ddobj.fcid],function(val,rows){var columnId=pageId.find("#hrcaseHead").createNewColumn(!0,val,ddobj.mode+columnNo++);HRCase.KanbanView.cloneHRCaseRow(rows,columnId+" .zp_liscr")})}}),pageId.find("#hrcaseHead").createDragAndDrop(ddobj)},cloneHRCaseRow:function(caseArr,bodyToAppend){var url=Layout.Page.hash,currentRow="",pageId=Layout.Page.container;0==caseArr.length?0==pageId.find("#"+bodyToAppend).children().length&&pageId.find("#"+bodyToAppend).html("").append('<div id="noCasefound"><p class="no-para">'+ZPI18N.getString("zp.norecfound")+"</p></div>"):($.each(caseArr,function(index,row){(currentRow=$("#caseRow").cloneRow("#"+bodyToAppend)).removeClass("zp_dyn"),currentRow.attr("rowid",row.caseId);var queryHtml='<span id="CLCaseNo" >'+this.caseId+"</span>";if(currentRow.find("#CLCaseQuery").html(queryHtml+row.subject),currentRow.find("#CLReqDate").text(row.requestedTime),-1!==url.indexOf("#hrcase/list")){0==row.agent.erecno.length&&row.isAgent&&(currentRow.find("div.zp_cfrm").prepend(HRCaseCommon.getPickUpHtml()),currentRow.find("#CLCaseReqName").addClass("zp_ldot"));var name=""!=row.agent.hasOwnProperty("name")?row.agent.name:row.agent.details;currentRow.find("#reqImgDiv").html(CommonTemplates.returnImgDiv(row.requestor.employeePhoto,"","CLReqPhoto",ZPeople.decodeTxt(name),HRCase.List.agentPopup(OWNER_EMPLOYEE.toString(),row.requestor.zuid))),currentRow.find("#CLCaseReqName").html(name),currentRow.on("click",function(){window.location.href="#hrcase/list/view-caseid:"+row.recordId,currentRow.closest(".zp_lwrap").addClass("zp_kansh")})}else-1!==url.indexOf("#hrcase/allcases/list")&&(0==row.agent.erecno.length&&row.isAgent&&(currentRow.find("div.zp_cfrm").prepend(HRCaseCommon.getPickUpHtml()),currentRow.find("#CLCaseReqName").addClass("zp_ldot")),currentRow.find("#reqImgDiv").html(CommonTemplates.returnImgDiv(this.requestor.employeePhoto,"","CLReqPhoto",ZPeople.decodeTxt(this.requestor.name),HRCase.List.agentPopup(OWNER_EMPLOYEE.toString(),this.requestor.zuid))),currentRow.find("#CLCaseReqName").html(this.requestor.name),currentRow.on("click",function(){window.location.href="#hrcase/allcases/view-caseid:"+row.recordId,currentRow.closest(".zp_lwrap").addClass("zp_kansh")}))}),caseArr.length==RECORDS_PER_PAGE&&ZPeople.FireScroll.reset())}},HRCase.SearchFilter={constructFilterOptions:function(){AdvancedFilter.constructFilter(HRCase.SearchFilter.getFilterArray(),HRCase.SearchFilter.searchHrcase)},getFilterArray:function(){var url=Layout.Page.hash,filterArr=[];return-1===url.indexOf("#hrcase/reports/adminreport")&&-1===url.indexOf("#hrcase/reports/agentreport")&&-1===url.indexOf("#hrcase/reports/userreport")&&filterArr.push({parentDiv:"searchDiv",type:"search",title:ZPI18N.getString("zp.search")}),-1==url.indexOf("#hrcase/opencases")&&-1==url.indexOf("#hrcase/unmanaged")&&filterArr.push({parentDiv:"statusDiv",type:"select",menuProperties:HRCase.SearchFilter.filterDropDown("status"),title:ZPI18N.getString("zp.status")}),-1!=url.indexOf("#hrcase/unmanaged")&&filterArr.push({parentDiv:"caseReqDiv",type:"select",menuProperties:HRCase.SearchFilter.filterDropDown("caseRequestor"),title:ZPI18N.getString("zp.casereq")}),-1===url.indexOf("#hrcase/list")&&-1===url.indexOf("#selfservice/mycases/list")||(filterArr.push({parentDiv:"caseReqDiv",type:"select",menuProperties:HRCase.SearchFilter.filterDropDown("caseRequestor"),title:ZPI18N.getString("zp.casereq")}),filterArr.push({parentDiv:"tymPeriodDiv",type:"select",menuProperties:HRCase.SearchFilter.timeBasedDropDown(),title:ZPI18N.getString("zp.periodoftime")})),-1!==url.indexOf("#hrcase/opencases")?(filterArr.push({parentDiv:"caseReqDiv",type:"select",menuProperties:HRCase.SearchFilter.filterDropDown("caseRequestor"),title:ZPI18N.getString("zp.casereq")}),filterArr.push({parentDiv:"tymPeriodDiv",type:"select",menuProperties:HRCase.SearchFilter.timeBasedDropDown(),title:ZPI18N.getString("zp.periodoftime")})):-1!==url.indexOf("#hrcase/allcases")||-1!==url.indexOf("#hrcase/watchlist")||-1!==url.indexOf("#hrcase/escalation")?(filterArr.push({parentDiv:"caseReqDiv",type:"select",menuProperties:HRCase.SearchFilter.filterDropDown("caseRequestor"),title:ZPI18N.getString("zp.casereq")}),filterArr.push({parentDiv:"tymPeriodDiv",type:"select",menuProperties:HRCase.SearchFilter.timeBasedDropDown(),title:ZPI18N.getString("zp.periodoftime")}),filterArr.push({parentDiv:"cgyDiv",type:"select",menuProperties:HRCase.SearchFilter.filterDropDown("category_filter"),title:ZPI18N.getString("zp.category")}),filterArr.push({parentDiv:"subcgyDiv",type:"select",menuProperties:HRCase.SearchFilter.filterDropDown("subcategory_filter"),title:ZPI18N.getString("zp.subcategory")}),-1!==url.indexOf("#hrcase/allcases")&&HRCase.CASES_ADMIN.isAdmin&&filterArr.push({parentDiv:"requestorTypeDiv",type:"select",menuProperties:HRCase.SearchFilter.filterDropDown("caseRequestorType"),title:ZPI18N.getString("zp.requestorstatus")})):-1===url.indexOf("#hrcase/reports/adminreport")&&-1===url.indexOf("hrcase/reports/agentreport")&&-1===url.indexOf("hrcase/reports/userreport")||filterArr.push({parentDiv:"cgyDiv",type:"select",menuProperties:HRCase.SearchFilter.filterDropDown("category_filter"),title:ZPI18N.getString("zp.category")}),filterArr},filterDropDown:function(mode){var params=[],pageId=Layout.Page.container;if("category"==mode||"category_filter"==mode||"subcategory_filter"==mode)"category"==mode&&params.push({id:"cgyAll",value:ZPI18N.getString("zp.allcategories")}),HRCase.CASES_ADMIN.isAdmin?(HRCategory.ADMINVIEW_CATEGORY_LIST.length<=0&&HRCategory.getCgyList(ADMIN_CGY_LISTING),params=HRCase.SearchFilter.getCgyFilterArr(HRCategory.ADMINVIEW_CATEGORY_LIST,mode)):HRCase.CASES_ADMIN.hasOwnProperty("categoryAdmin")&&HRCase.CASES_ADMIN.categoryAdmin.length>0?(HRCategory.CGYADMIN_AGENT_CGY_LIST.length<=0&&HRCategory.getCgyList(CGYADMIN_AGENT_CGY_LISTING),params=HRCase.SearchFilter.getCgyFilterArr(HRCategory.CGYADMIN_AGENT_CGY_LIST,mode)):(HRCategory.USERVIEW_CATEGORY_LIST.length<=0&&HRCategory.getCgyList(USER_CGY_LISTING),params=HRCase.SearchFilter.getCgyFilterArr(HRCategory.USERVIEW_CATEGORY_LIST,mode));else if("category_agent"==mode||"category_agent_filter"==mode)"category_agent"==mode&&params.push({id:"cgyAll",value:ZPI18N.getString("zp.allcategories")}),HRCategory.AGENTVIEW_CGY_LIST.length<=0&&HRCategory.getCgyList(AGENT_CGY_LISTING),params=HRCase.SearchFilter.getCgyFilterArr(HRCategory.AGENTVIEW_CGY_LIST,mode);else if("status"==mode)$.each(HRCase.STATUS,function(key,value){if(HRCase.CANCELLED_SID!=value){var param1={id:HRCase.STATUS[key],value:key};params.push(param1)}});else{if("caseRequestor"==mode)return{id:"caserequestorList",data:function(initObj){return EmployeeDropdown.getEmpList($(initObj).val(),"emp","HRCASES_ADDCASE_AGENT",[],{},!0)},checkbox:!0};if("caseRequestorType"==mode){var caseReqTypeObj={id:"requestorType",data:[{id:"0",value:ZPI18N.getString("zp.allemployees")},{id:"1",value:ZPI18N.getString("zp.activeemployees"),isDefaultValue:!0},{id:"2",value:ZPI18N.getString("zp.formeremployees")}],checkbox:!1,isMandatory:!0,retainDefaultValue:!0};return caseReqTypeObj}}var returnObj={id:"mainmenu",data:params,checkbox:!0};return"category_filter"==mode?returnObj.callback=function(liObj,srcObj){var categoryId=$(liObj).attr("id");HRCase.SearchFilter.removeSelectedSubCgy(categoryId)}:"subcategory_filter"==mode&&(returnObj.callback=function(liObj,srcObj){var categoryId=$(liObj).attr("categoryId");pageId.find("#cgyDiv").find("i[name=close][id="+categoryId+"]").trigger("click")}),returnObj},removeSelectedSubCgy:function(categoryId){var pageId=Layout.Page.container,subCgySel=[];if(pageId.find("#subcgyDiv_input").length>0&&!ZPUtil.Validation.isEmpty(pageId.find("#subcgyDiv_input").attr("selectedids"))&&(subCgySel=pageId.find("#subcgyDiv_input").attr("selectedids").split(",")),subCgySel.length>0){var list=[];list=HRCase.CASES_ADMIN.isAdmin?HRCategory.ADMINVIEW_CATEGORY_LIST:HRCase.CASES_ADMIN.hasOwnProperty("categoryAdmin")&&HRCase.CASES_ADMIN.categoryAdmin.length>0?HRCategory.CGYADMIN_AGENT_CGY_LIST:HRCategory.USERVIEW_CATEGORY_LIST,$.each(list,function(index,value){value.categoryId!=categoryId||$.each(value.subCategoryList,function(i,v){-1!=$.inArray(v.subCategoryId,subCgySel)&&pageId.find("#subcgyDiv").find("i[name=close][id="+v.subCategoryId+"]").trigger("click")})})}},getCgyFilterArr:function(list,mode){var params=[];return"subcategory_filter"==mode?$.each(list,function(index,value){$.each(value.subCategoryList,function(i,v){var param1={};param1.id=v.subCategoryId,param1.value=value.categoryName+" - "+v.subcategoryname,param1.categoryId=value.categoryId,params.push(param1)})}):$.each(list,function(index,value){var param1={};param1.id=value.categoryId,param1.value=value.categoryName,param1.iconClass="zp_Si "+Icons.getIconClass(value.categoryIcon).iconClass,params.push(param1)}),params},getSubcgyFilter:function(query){Layout.Page.container;var params=[];return params=HRCase.CASES_ADMIN.isAdmin?HRCase.SearchFilter.getCgyFilterArr(HRCategory.ADMINVIEW_CATEGORY_LIST,"subcategory_filter"):HRCase.CASES_ADMIN.hasOwnProperty("categoryAdmin")&&HRCase.CASES_ADMIN.categoryAdmin.length>0?HRCase.SearchFilter.getCgyFilterArr(HRCategory.CGYADMIN_AGENT_CGY_LIST,"subcategory_filter"):HRCase.SearchFilter.getCgyFilterArr(HRCategory.USERVIEW_CATEGORY_LIST,"subcategory_filter"),$.trim(query).length>0&&(params=$.grep(params,function(ele){return decodeHTML(ele.value).toLowerCase().indexOf(query.toLowerCase())>-1})),params},timeBasedDropDown:function(){var params=[],PERIOD_OF_TIME=[ZPI18N.getString("zp.today"),ZPI18N.getString("zp.yesterday"),ZPI18N.getString("zp.last7days"),ZPI18N.getString("zp.last30days")];return $.each(PERIOD_OF_TIME,function(index,value){var param1={};param1.id="CUSTOM RANGE"==value?"none":index,param1.value=value,params.push(param1)}),{id:"mainmenu",data:params,search:!0}},searchHrcase:function(isFromAdvancedFilter,onlyParams){var pageId=Layout.Page.container,index=0===pageId.find("#caseList").find("div[caseId]").length?1:pageId.find("#caseList").find("div[caseId]").length+1,caseListParam={status:"",index:index=isFromAdvancedFilter?1:index};return isFromAdvancedFilter?(ZPeople.FireScroll.reset(),CommonTemplates.toCheckEmpty("statusDiv_input",caseListParam,"status"),CommonTemplates.toCheckEmpty("cgyDiv_input",caseListParam,"categoryId"),CommonTemplates.toCheckEmpty("subcgyDiv_input",caseListParam,"subcategoryId"),CommonTemplates.toCheckEmpty("tymPeriodDiv_input",caseListParam,"periodOfTime"),CommonTemplates.toCheckEmpty("caseReqDiv_input",caseListParam,"requestorErecno"),pageId.find("#searchDiv_input").length>0&&(caseListParam.query=pageId.find("#searchDiv_input").val().trim()),pageId.find("#requestorTypeDiv_input").length>0&&(caseListParam.requestorType=pageId.find("#requestorTypeDiv_input").attr("selectedIds")),caseListParam.searchtype="filter",HRCase.SearchFilter.setURLBasedParam(caseListParam)):((caseListParam=HRCase.SearchFilter.getURLBasedParam()).index=index,delete caseListParam.searchtype),pageId.find("[name=headerposition]").hasClass("zp_sfltr")?(pageId.find("#cgyFilter").addClass("zp_dyn"),pageId.find("#cgyFilter").prev("font").html("<em>"+ZPI18N.getString("zp.category")+"</em>")):(pageId.find("#cgyFilter").removeClass("zp_dyn"),isFromAdvancedFilter&&pageId.find("#cgyFilter").prev("font").html("<em>"+ZPI18N.getString("zp.category")+"</em>")),void 0!=onlyParams&&onlyParams||HRCase.SearchFilter.getListing(index,caseListParam,isFromAdvancedFilter),caseListParam},getListing:function(index,caseListParam,isFromAdvancedFilter){var url=Layout.Page.hash;-1!==url.indexOf("#hrcase/reports/adminreport")?HRCReport.adminReport(caseListParam):-1!==url.indexOf("hrcase/reports/agentreport")?HRCReport.agentReport(caseListParam):-1!==url.indexOf("hrcase/reports/userreport")?HRCReport.userReport(caseListParam):-1!==url.indexOf("#hrcase/myrequest/")?HRCase.List.getMyReqCasesList(index,caseListParam,isFromAdvancedFilter,""):-1!==url.indexOf("#selfservice/cases/list")?HRCase.List.getMyReqCasesList(index,caseListParam,isFromAdvancedFilter,"self"):-1!==url.indexOf("#hrcase/allcases/")?"#hrcase/allcases/list/kanbanView"==url?HRCase.KanbanView.filterKanbanView():HRCase.List.getAllCasesList(index,caseListParam,isFromAdvancedFilter):-1!==url.indexOf("#hrcase/watchlist/")?HRCase.List.getFollowedCasesList(index,caseListParam,isFromAdvancedFilter):-1!==url.indexOf("#hrcase/opencases/")?HRCase.List.getOpenCasesList(index,caseListParam,isFromAdvancedFilter):-1!==url.indexOf("#hrcase/unmanaged/")?HRCase.List.getUnmanagedCasesList(index,caseListParam,isFromAdvancedFilter):-1!==url.indexOf("#hrcase/escalation/")?HRCase.List.getEscalatedCasesList(index,caseListParam,isFromAdvancedFilter):-1!==url.indexOf("#hrcase/unassigned/")?HRCase.List.getUnassignedList(index,caseListParam,isFromAdvancedFilter):-1!==url.indexOf("#selfservice/mycases/list")?HRCase.List.getMyHrCasesList(index,caseListParam,isFromAdvancedFilter,"self"):-1!==url.indexOf("#hrcase/")&&("#hrcase/list/kanbanView"==url?HRCase.KanbanView.filterKanbanView():HRCase.List.getMyHrCasesList(index,caseListParam,isFromAdvancedFilter,""))},getURLBasedParam:function(){var url=Layout.Page.hash;return-1!==url.indexOf("#hrcase/myrequest/")||-1!==url.indexOf("#selfservice/cases/list")?HRCase.MYREQ_CASE_PARAM:-1!==url.indexOf("#hrcase/allcases/")?HRCase.ALLCASE_CASE_PARAM:-1!==url.indexOf("#hrcase/watchlist/")?HRCase.WATCHLIST_CASE_PARAM:-1!==url.indexOf("#hrcase/escalation/")?HRCase.ESCALATAION_CASE_PARAM:-1!==url.indexOf("#hrcase/unassigned/")?HRCase.UNASSIGN_CASE_PARAM:-1!==url.indexOf("#hrcase/opencases/")?HRCase.OPEN_CASE_PARAM:-1!==url.indexOf("#hrcase/unmanaged/")?HRCase.UNMANAGED_CASE_PARAM:-1!==url.indexOf("#hrcase/")||-1!==url.indexOf("#selfservice/mycases/list")?HRCase.MYCASE_CASE_PARAM:{}},setURLBasedParam:function(caseParam){var url=Layout.Page.hash;-1!==url.indexOf("#hrcase/myrequest/")||-1!==url.indexOf("#selfservice/cases/list")?HRCase.MYREQ_CASE_PARAM=caseParam:-1!==url.indexOf("#hrcase/allcases/")?HRCase.ALLCASE_CASE_PARAM=caseParam:-1!==url.indexOf("#hrcase/watchlist/")?HRCase.WATCHLIST_CASE_PARAM=caseParam:-1!==url.indexOf("#hrcase/escalation/")?HRCase.ESCALATAION_CASE_PARAM=caseParam:-1!==url.indexOf("#hrcase/unassigned/")?HRCase.UNASSIGN_CASE_PARAM=caseParam:-1!==url.indexOf("#hrcase/opencases/")?(HRCase.OPEN_CASE_PARAM=caseParam,caseParam.status=""==caseParam.status?"1,2,3,4":caseParam.status):-1!==url.indexOf("#hrcase/unmanaged/")?(HRCase.UNMANAGED_CASE_PARAM=caseParam,caseParam.status=""==caseParam.status?"1,2,3,4":caseParam.status):-1===url.indexOf("#hrcase/")&&-1===url.indexOf("#selfservice/mycases/list")||(HRCase.MYCASE_CASE_PARAM=caseParam)},getQuickFilterList:function(mode,value,ele){var url=Layout.Page.hash,pageId=Layout.Page.container,caseParam=HRCase.SearchFilter.searchHrcase(!1,!0);caseParam.index=1,caseParam.mode=mode,"status"==mode?(caseParam.status=value,void 0!=ele&&($(ele).hasClass("sel")||pageId.find("[name=footerposition]").find("[class=sel]").removeClass("sel"),$(ele).toggleClass("sel"),$(ele).hasClass("sel")?caseParam.status=value:void 0!=Layout.Page.urlparam.status?caseParam.status=Layout.Page.urlparam.status:(caseParam.status="",-1==url.indexOf("hrcase/opencases")&&-1==url.indexOf("hrcase/unmanaged")||(caseParam.status="1,2,3,4"),CommonTemplates.toCheckEmpty("statusDiv_input",caseParam,"status")))):"category"==mode&&(caseParam.categoryId=value),ZPeople.FireScroll.reset(),HRCase.SearchFilter.getListing(1,caseParam,!1)},getStatusFilterValue:function(statusStr){Layout.Page.container;var sVal=[],arr=statusStr.split(",");$.isEmptyObject(HRCase.STATUS)&&HRCases.getStatusList(),$.each(HRCase.STATUS,function(key,value){if(-1!==$.inArray(HRCase.STATUS[key],arr)){var param1={};param1.id=HRCase.STATUS[key],param1.text=key,sVal.push(param1)}})},selectCaseStatus:function(caseId,obj,currentCaseStatus,isAgent,permittedCaseStatus){var dropdownList=[];Layout.Page.hash;permittedCaseStatus.length>0&&currentCaseStatus!=HRCase.CANCELLED_SID&&($.each(permittedCaseStatus,function(key,value){var param1={id:value.systemValue,value:value.optionValue};currentCaseStatus==value.systemValue&&(param1.isDefaultValue=!0),dropdownList.push(param1)}),$(obj).zparrowmenu({id:"statusList",data:dropdownList,callback:function(obj,initObj){HRCase.DetailedView.changeCaseStatus(caseId,obj,currentCaseStatus)}}))}};var HRCases={showNoData:function(bodyDiv,rowDiv){var row=Layout.Page.container.find("#"+rowDiv).clone(!0);$(row).children().remove(),$(row).removeClass("zp_dyn").addClass("zp_nodata"),$(row).append("<span> "+ZPI18N.getString("zp.lookup.norecfound")+" </span>"),$(bodyDiv).append(row)},getParentURL:function(){return-1!==Layout.Page.hash.indexOf("#hrcase/myrequest")?"#hrcase/myrequest":-1!==Layout.Page.hash.indexOf("#hrcase/list")?"#hrcase/list":-1!==Layout.Page.hash.indexOf("#hrcase/allcases")?"#hrcase/allcases":-1!==Layout.Page.hash.indexOf("#hrcase/unassigned")?"#hrcase/unassigned":-1!==Layout.Page.hash.indexOf("#hrcase/watchlist")?"#hrcase/watchlist":-1!==Layout.Page.hash.indexOf("#hrcase/opencases")?"#hrcase/opencases":-1!==Layout.Page.hash.indexOf("#hrcase/escalation")?"#hrcase/escalation":-1!==Layout.Page.hash.indexOf("#hrcase/unmanaged")?"#hrcase/unmanaged":void 0},changeIconAddCase:function(obj){var pageId=Layout.Page.container,iconValue=$(obj).attr("icon");void 0!=iconValue&&""!=iconValue?Icons.getIconClass(iconValue).iconClass:Icons.ADD_ICON;pageId.find("#cgyId").attr("categoryId",$(obj).attr("id")),HRCaseBand.getCategoryView($(obj).attr("id"))},getStatusList:function(){if($.isEmptyObject(HRCase.STATUS)){var params={method:"getStatusList",conreqcsr:csrfToken};$.ajax({url:"/fetchAllStatus.zp",type:"POST",data:params,async:!1,success:function(data){$.each(data,function(i,v){HRCase.STATUS[v.optionValue]=v.systemValue})}})}},getPriorityList:function(){if($.isEmptyObject(HRCase.PRIORITY)||$.isEmptyObject(HRCase.ALLPRIORITY)){var params={method:"getPriorityList",conreqcsr:csrfToken};$.ajax({url:"/fetchAllPriority.zp",type:"POST",data:params,async:!1,success:function(data){HRCase.ALLPRIORITY=data,$.each(data,function(i,v){HRCase.PRIORITY[v.optionValue]=v.systemValue})}})}},getSourceList:function(){if($.isEmptyObject(HRCase.SOURCE)){var params={method:"getSourceList",conreqcsr:csrfToken};$.ajax({url:"/fetchAllSources.zp",type:"POST",data:params,async:!1,success:function(data){$.each(data,function(i,v){HRCase.SOURCE[v.optionValue]=v.systemValue})}})}},getCaseTypeList:function(){if($.isEmptyObject(HRCase.CASETYPE)){var params={method:"getCaseTypeList",conreqcsr:csrfToken};$.ajax({url:"/getAllCaseType.zp",type:"POST",data:params,async:!1,success:function(data){$.each(data,function(i,v){HRCase.CASETYPE[v.optionId]=v.optionValue})}})}}},HRCaseForm={fillDetailViewPage:function(extraparams){var pageId=$("#"+Layout.Page.pageId).find("#zp_addedit_record_"+ZPForm.CURRFORM_PARAM.formId);if(pageId.find("[folabel=caseid]").length>0){var fcid=pageId.find("[folabel=caseid]").attr("id").split("_").pop(),formcp=ZPForm.Field.getFieldComponent(fcid);ZPForm.Field.setValue(formcp,extraparams.case_number,fcid);ZPForm.LAYOUT.find("[folabel=caseid]").html("<span>"+extraparams.case_number+"</span>")}if(pageId.find("[folabel=agent]").length>0){var agent=$(pageId.find("[folabel=agent]").find("span")[0]).text();""!=agent?pageId.find("[folabel=agent_details]").closest("div.zp-label").addClass("zp_dyn"):""==agent&&pageId.find("[folabel=agent]").closest("div.zp-label").addClass("zp_dyn")}var status=$(pageId.find("[folabel=status]").find("span")[0]).text();HRCaseForm.getSysValue(pageId.find("[folabel=status]").attr("id").split("_").pop(),ZPForm.CURRFORM_PARAM.formId,status)==HRCase.COMPLETED_SID?(pageId.find("[folabel=completed_time]").closest("div.zp-label").removeClass("zp_dyn"),pageId.find("[folabel=complete_by]").closest("div.zp-label").removeClass("zp_dyn")):(pageId.find("[folabel=completed_time]").closest("div.zp-label").addClass("zp_dyn"),pageId.find("[folabel=complete_by]").closest("div.zp-label").addClass("zp_dyn"))},getSysValue:function(fcId,formId,optionValue){var options=ZPForm.Field.getFieldComponent(fcId,formId).OptionsWithId,sysvalue=0;return $.each(options,function(index,row){row.Value!=optionValue||(sysvalue=row.SysValue)}),sysvalue},getOptionValue:function(fcId,formId,optionValue){var options=ZPForm.Field.getFieldComponent(fcId,formId).OptionsWithId,optValue="";return $.each(options,function(index,row){row.SysValue!=optionValue||(optValue=row.Value)}),optValue}},HRCaseFeeds={pickupHRCase:function(ele,mode){Layout.Page.container;var caseId=$(ele).closest("[caseid]").attr("caseId"),params={conreqcsr:csrfToken,method:"assignedHrcase",zp_recordId:caseId,assignedId:erecno};ZPeople.Request.send("/assignedHrcase.zp",params,function(data){if("success"==data.status)if(mode==HRCase.PICK_CASE_ROW){var agnetDiv=$(ele).parent();agnetDiv.empty(),agnetDiv.html(CommonTemplates.returnImgDiv(ZPeople.CURR_USER.avatar,"","","",HRCase.List.agentPopup(OWNER_EMPLOYEE.toString(),data.zuid))+"<a>"+ZPeople.CURR_USER.name+'</a></div><div class="zp_Lrgt"></div>')}else if(mode==HRCase.PICK_CASE_VIEW)HRCase.DetailedView.newAgentDetails(caseId,{id:data.zuid,name:data.agent_details},CommonTemplates.returnImgDiv(ZPeople.CURR_USER.avatar,"","","",HRCase.List.agentPopup(OWNER_EMPLOYEE.toString(),data.zuid))),$(ele).remove();else{var agentDiv=$(ele).parent().parent();agentDiv.empty(),agentDiv.append('<div class="dpcnt"><img popup="user" empid='+ZPeople.CURR_USER.id+' src="'+ZPeople.CURR_USER.avatar+'" class="zp-usimg"></div><div class="zp-fd-uname">'+ZPeople.CURR_USER.name+"</div>"),data.hasOwnProperty("content")&&HRCase.Comments.constructSinglefieldComments(data,caseId)}})}},HRCaseFileTag={fileUploadfn:function(obj,currentDiv,parentId){if("0"==obj.id){var fieldName="caseattachment",formTable="P_HR_Case";"addFaqContent"==parentId&&(fieldName="attachment",formTable="P_HRCase_FAQ"),$("#hcBrowseFile").trigger("click"),$("#hcBrowseFile").off("change").on("change",function(ev){var parentDiv=$(currentDiv).closest("#"+parentId),fileCnt=currentDiv.attr("id")&&"caseview_atch"==currentDiv.attr("id")?4:5;if($(parentDiv).find("div.attachedFile:not(.zp_dyn)").length+$("#hcBrowseFile")[0].files.length>fileCnt)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.maxfileupload"));else{$(this);var files=$(this)[0].files;if($(parentDiv).find("#attchedFiles").length<=0){$(parentDiv).find("#fAtch").siblings(".zp_note").after('<div id="attchedFiles" class="zp_Alst clearfix"></div>')}$.each(files,function(i){CommonTemplates.getFileBoxProgressOnSelect(files[i],i,function(obj,file){$(parentDiv).find("#attchedFiles").append(obj),casesFiles.uploadFileByXHR(files[i],{fieldName:fieldName,formTable:formTable,callback:function(fileInfo){$(parentDiv).find("div.attachedFile[filepos="+i+"]").replaceWith(CommonTemplates.setFileBoxAndDataOnSelect(files[i],fileInfo))},failureCallback:function(uploadedFileInfo){$(parentDiv).find("div.attachedFile[filepos="+i+"]").remove()}}),$(parentDiv).find("div.attachedFile").last().offset().top>$(parentDiv).scrollTop()&&$(parentDiv).scrollTop($(parentDiv).find("div.attachedFile").last().offset().top)},i)})}})}else if("1"==obj.id){var mode="";"addFaqContent"==parentId?mode="AddFAQFiles":"addcaseContent"==parentId&&(mode="AddHRCase"),Files.showCloudPickerModal(ZPeople.cloudPickerGadgetsUrl,mode)}else if("2"==obj.id){mode="";"addFaqContent"==parentId?mode="AddFAQFiles":"addcaseContent"==parentId&&(mode="AddHRCase"),Files.showWorkDriveModal(mode)}},addFileTag:function(filename,fileJsonObj,mode){Layout.Page.container;var parentId="addcaseContent",fileObj={name:filename,type:Files.uploadMode};if("AddFAQFiles"==mode&&(parentId="addFaqContent"),$("[id="+parentId+"]").find("#attchedFiles").length<=0){$("[id="+parentId+"]").find("#fAtch").siblings(".zp_note").after('<div id="attchedFiles" class="zp_Alst clearfix"></div>')}$("[id="+parentId+"]").find("div.attachedFile").length<5?CommonTemplates.getFileBoxOnSelect(fileObj,function(html,file){$("[id="+parentId+"]").find("#attchedFiles").append(html),$("[id="+parentId+"]").find("div.attachedFile").last().offset().top>$("[id="+parentId+"]").scrollTop()&&$("[id="+parentId+"]").scrollTop($("[id="+parentId+"]").find("div.attachedFile").last().offset().top)}):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.maxfileupload")),$("[id="+parentId+"]").find("div.attachedFile").last().data("uploadMode",Files.uploadMode),"workDriveUpload"==Files.uploadMode?$("[id="+parentId+"]").find("div.attachedFile").last().data("WDUploadDoc",fileJsonObj):"cloudUpload"==Files.uploadMode&&$("[id="+parentId+"]").find("div.attachedFile").last().data("cloudUploadDoc",fileJsonObj)}},HRCaseMoreOption={moreOption:function(caseId,allowUnassign,allowCancel,status){var pageId=Layout.Page.container,url=Layout.Page.hash;status!=HRCase.CANCELLED_SID&&status!=HRCase.COMPLETED_SID&&(allowUnassign&&HRCase.DetailedView.MORE_OPTION.push({id:"unassignCase",value:ZPI18N.getString("zp.unassign")}),allowCancel&&HRCase.DetailedView.MORE_OPTION.push({id:"cancelCase",value:ZPI18N.getString("zp.cancelReq")})),HRCase.CASES_ADMIN.isAdmin&&-1===url.indexOf("#hrcase/reports/requestedvsclosed")&&-1===url.indexOf("#hrcase/reports/overallreport")&&-1===url.indexOf("#hrcase/reports/escalationreport")&&HRCase.DetailedView.MORE_OPTION.push({id:"delCase",value:ZPI18N.getString("zp.deletecase")}),0!=HRCase.DetailedView.MORE_OPTION.length&&pageId.find("#addNotes").after(CommonTemplates.getSingleIconMenu({attributes:{id:"moredropdown",onclick:"HRCaseMoreOption.dropdown(this,'"+caseId+"')"},iconsList:[{class:"IC-more","data-placement":"bottom","data-toggle":"tooltip","data-original-title":ZPI18N.getString("zp.more")}]}))},dropdown:function(obj,caseId){HRCase.DetailedView.MORE_OPTION.length>0&&$(obj).zparrowmenu({id:"mainmenu",data:HRCase.DetailedView.MORE_OPTION,search:!1,width:200,position:ZPArrow.BOTTOM_RIGHT,oneTimeMenu:!0,callback:function(obj,initObj){$(initObj).removeAttr("selectedIds"),HRCaseMoreOption.optionCallBack(obj,caseId,initObj)}})},optionCallBack:function(obj,caseId,initObj){var pageId=Layout.Page.container;"unassignCase"==$(obj).attr("id")?HRCase.DetailedView.unAssignedHrcase(ZPForm.CURRFORM_PARAM.recordId):"cancelCase"==$(obj).attr("id")?($(obj).removeAttr("id"),$(obj).attr("id",HRCase.CANCELLED_SID),ZPeople.BSModal.confirm(function(){HRCase.DetailedView.changeCaseStatus(ZPForm.CURRFORM_PARAM.recordId,obj,pageId.find("#caseStatus").attr("selectedIds"))},"",ZPI18N.getString("zp.canceledmsg"))):"delCase"==$(obj).attr("id")?HRCase.DetailedView.deleteCase(ZPForm.CURRFORM_PARAM.recordId,!1,REQ_TYPE_ALLCASES):"followCase"==$(obj).attr("id")&&HRCaseAction.followCase(ZPForm.CURRFORM_PARAM.recordId,initObj,!0,HRCaseAction.afterFollowCase)}},HRCaseCommon={getFileDownload:function(event,fileId,recordId,fileType){event.stopPropagation(),event.preventDefault(),Layout.Page.container.find("#dwlcgyFile").remove(),Layout.Page.container.find("#cgyDFileFrame").remove(),Layout.Page.container.append('<form method="post" id="dwlcgyFile" enctype="multipart/form-data" action="/downloadCasesFile.zp" target="cgyDFileFrame" novalidate></form>'),Layout.Page.container.append('<iframe  src="" id="cgyDFileFrame" name="cgyDFileFrame" scrolling="auto" style="border: none; margin: 0pt;" frameborder="0" height="10px" width="100%" ></iframe>');var caseForm=Layout.Page.container.find("#dwlcgyFile");caseForm.append('<input type="hidden" name="fileId" value="'+fileId+'">'),caseForm.append('<input type="hidden" name="recordId" value="'+recordId+'">'),caseForm.append('<input type="hidden" name="fileType" value="'+fileType+'">'),caseForm.append('<input type="hidden" name="conreqcsr" value="'+csrfToken+'">'),caseForm.append('<input type="hidden" name="methodName" value="downloadFile">'),caseForm.trigger("submit"),$(caseForm).find("input[type=hidden]").remove()},getPickUpHtml:function(){return'<span class="zp_ldot zp_caps dte" id="pickUptoMe"><span class="zp_ldot zp_caps dte zp_link"  id="CLCaseAgent" onclick="HRCaseFeeds.pickupHRCase(this,'+HRCase.PICK_CASE_ROW+')" >'+ZPI18N.getString("zp.pickupcase")+"</span></span>"},askUsHtml:function(needCategory,isAgent){var subcgyHtml,empHtml="",cgyHtml="",statusHtml="",resolHtml="",casetypeHtml="";needCategory&&(cgyHtml='<div id="caseCgyDiv" class="zp_fm"></div><span class="etxt zp_dyn">'+ZPI18N.getString("zp.selecthrcategory")+"</span>"),isAgent&&(empHtml='<div id="csempDiv" class="zp_fm"></div><span class="etxt zp_dyn">'+ZPI18N.getString("zp.selecthrEmployee")+"</span>",cgyHtml='<div id="caseCgyDiv" class="zp_fm"></div><span class="etxt zp_dyn">'+ZPI18N.getString("zp.selecthrcategory")+"</span>",statusHtml='<div id="casestatusDiv" class="zp_fm"></div>',resolHtml='<div id="caseresolutionDiv" class="zp_fm"></div>',casetypeHtml='<div id="caseTypeDiv" class="zp_fm"></div>'),subcgyHtml='<div id="caseSubCgyDiv" class="zp_fm"></div>';var html='<div class="zp_whtbg" id="addHRCase"><div class="zp_pop" id="caseDescEditorContainer"><div class="zp_Ptl" id="addcaseHeader"><h3>'+ZPI18N.getString("zp.askaquestion")+"</h3></div>";return html+='<div class="zp_pcnt" id="addcaseContent" onscroll="CommonTemplates.scrollfunction(\'addcaseHeader\',\'addcaseContent\')">'+empHtml+cgyHtml+subcgyHtml+'<div id="caseSubDiv" class="zp_fm"></div><span class="etxt zp_dyn">'+ZPI18N.getString("zp.mentionthesubject")+'</span><div class=""  id="caseeditor"></div>'+CommonTemplates.chooseFileHtml()+statusHtml+resolHtml+casetypeHtml+"</div>",html+='<div class="zp_btn"><button  id="submitCaseBtn" class="zpthm zpn_btn" onclick="HRCase.AddCase.submitCase()"><b>'+ZPI18N.getString("zp.submit")+'</b><div class="zp_circular"></div><label>'+ZPI18N.getString("zp.submitting")+"</label></button><button onclick='HRCase.AddCase.closePage()'>"+ZPI18N.getString("zp.cancel")+'</button></div></div><i class="IC-cls"  title='+ZPI18N.getString("zp.close")+" onclick='HRCase.AddCase.closePage()'></i></div>"}},HRCaseDropdown={feedsShowMoreDesc:function(obj){var boxId=$(obj).closest(".zp-fd-box"),params={method:"fetchCaseDesc",conreqcsr:csrfToken,recordId:boxId.attr("streamid")};ZPeople.Request.sendAsyncPost("/fetchCaseDesc.zp",params,function(data){$(obj).closest("div").html(data.description)})},feedsStatusDN:function(obj){var boxId=$(obj).closest(".zp-fd-box"),params=[],caseCatalog={method:"getPermittedStatus",conreqcsr:csrfToken,caseId:boxId.attr("streamid")};$.ajax({url:"/getPermittedStatus.zp",type:"POST",data:caseCatalog,async:!1,success:function(data){$.each(data.permittedCaseStatus,function(i,value){var param1={id:value.systemValue,value:value.optionValue};params.push(param1)})}}),$(obj).zparrowmenu({id:"statusList",data:params,callback:function(obj){var params={conreqcsr:csrfToken,status:$(obj).attr("id"),zp_recordId:boxId.attr("streamid"),method:"changeCaseStatus"},statusObj=boxId.find("#status").parent();statusObj.html(ZPeople.LOADING_HTML),ZPeople.Request.send("/changeCaseStatus.zp",params,function(data){if("success"==data.status&&(statusObj.empty().append('<a onclick="HRCaseDropdown.feedsStatusDN(this)" id="status" class="zp-dpwn-ar">'+ZPeople.escapeHtml($(obj).attr("name"))+"</a>"),HRCase.Comments.constructSinglefieldComments(data,boxId.attr("streamid")),data.hasOwnProperty("agent")&&!ZPUtil.Validation.isEmpty(data.agent.erecno))){var agentHtml='<div class="dpcnt"><img popup="user" empid='+data.agent.empid+' src="'+data.agent.employeePhoto+'" class="zp-usimg"></div><div class="zp-fd-uname">'+data.agent_details+"</div>";boxId.find(".zp-fd-user").html(agentHtml)}})}})},feedsPriorityDN:function(obj){var boxId=$(obj).closest(".zp-fd-box"),priorityParams=[];$.each(HRCase.PRIORITY,function(key){var param1={id:HRCase.PRIORITY[key],value:key};priorityParams.push(param1)}),$(obj).zparrowmenu({id:"priorityList",data:priorityParams,callback:function(obj){var params={conreqcsr:csrfToken,priority:$(obj).attr("id"),zp_recordId:boxId.attr("streamid"),method:"changePriorityOption"},priObj=boxId.find("#feed_priority").parent();priObj.html(ZPeople.LOADING_HTML),ZPeople.Request.send("/changePriorityOption.zp",params,function(data){"success"==data.status&&(priObj.empty().append('<a onclick="HRCaseDropdown.feedsPriorityDN(this)" id="feed_priority" class="zp-dpwn-ar">'+$(obj).attr("name")+"</a>"),HRCase.Comments.constructSinglefieldComments(data,boxId.attr("streamid")))})}})},cgymemberList:function(obj){var results=[],params=[],grpList=[],deptList=[],empList=[],query=void 0==$(obj).val()?"":$(obj).val();if(query.length>0){(grpList=EmployeeDropdown.getListData(query.toLowerCase(),"grp","HRCASES",query.toLowerCase())).length<10&&(deptList=EmployeeDropdown.getListData(query.toLowerCase(),"dept","FEEDS",query.toLowerCase())),grpList.length+deptList.length<10&&(empList=EmployeeDropdown.getListData(query.toLowerCase(),"emp","HRCASES",query.toLowerCase()));var ownerList=[];$.each(grpList,function(i,grp){grp.dataType=ZPI18N.getString("zp.group"),ownerList.push(grp)}),$.each(deptList,function(i,dept){dept.dataType=ZPI18N.getString("zp.department"),ownerList.push(dept)}),$.each(empList,function(i,emp){emp.dataType=ZPI18N.getString("zp.user"),ownerList.push(emp)}),results=(results=ownerList).slice(0,15),$.each(results,function(index,value){var param1={isEmpty:!1};param1.dataType=value.dataType,param1.value=value.text,param1.image=value.avatar,param1.imageAlt=value.alt,param1.id=value.id,param1.agenttype=value.type,params.push(param1)})}else{if(USER_GROUP_LISTS.length<=0){var groupListparams={mode:"myGroups",method:"listGroup",conreqcsr:csrfToken};ZPeople.Request.sendAsyncPost("/group/list",groupListparams,function(groupdata){USER_GROUP_LISTS=groupdata})}$.each(USER_GROUP_LISTS,function(idx,val){var grpParam={isEmpty:!1,dataType:ZPI18N.getString("zp.group"),agenttype:OWNER_GROUP};grpParam.value=val.name,grpParam.image="",grpParam.imageAlt=ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(val.name))),grpParam.id=val.groupId,params.push(grpParam)});var deptParam={isEmpty:!1,dataType:ZPI18N.getString("zp.department"),agenttype:OWNER_DEPARTMENT},loginUserDetails=ZPeople.getUserDetailsById(erecno);"null"!=loginUserDetails.deptId&&""!=loginUserDetails.deptId&&(deptParam.value=loginUserDetails.deptName,deptParam.image="",deptParam.imageAlt=ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(loginUserDetails.deptName))),deptParam.id=loginUserDetails.deptId,params.push(deptParam)),$.each(ZPeople.getUserDetailsByIds(ZPeople.SUB_USERLIST),function(i,v){if("true"==v.isLogEnb&&(v.reportingTo===erecno||v.usererec==erecno)){var param1={isEmpty:!1};param1.dataType=ZPI18N.getString("zp.user"),param1.value=v.empid+" "+v.name,param1.image=v.avatar,param1.imageAlt=ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(v.name))),param1.id=v.usererec,param1.agenttype=OWNER_EMPLOYEE,params.push(param1)}})}return params},cgymemberdropdown:function(){return{id:"caseownerList",data:function(searchObj){return HRCaseDropdown.cgymemberList(searchObj)},callback:function(obj,parentObj){$("#"+Layout.Page.pageId);var agentType=$(obj).attr("agenttype");$(parentObj).attr("agenttype",agentType)}}}};HRCases.FAQ_FILEUPLOAD_LABELNAME="attachment",HRCases.HRCASE_FILEUPLOAD_LABELNAME="case_attachment",HRCategory.View={cloneAgentRow:function(data,returnTagOnly){var html="",agentTag="";if(!$.isEmptyObject(data)){var src="",agentZuid="",alt=ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(data.owner))),displayName=data.owner;if(data.agentTypeId==OWNER_EMPLOYEE){var userDtl=ZPeople.getUserDetailsById(data.agentValueId);src=userDtl.avatar,agentZuid=userDtl.id,displayName=userDtl.empid+"  "+data.owner}var agentData=[{text:displayName,imageSrc:src,imageAlt:alt,imgZuid:agentZuid,attribute:HRCase.List.agentPopup(data.agentTypeId.toString(),data.agentValueId)}];agentTag=CommonTemplates.cloneTag(agentData);if(returnTagOnly)return agentTag;html='<div class="zp_txt"><div class="zp_ttl"><span>'+ZPI18N.getString("zp.agent")+"</span></div>"+agentTag+"</div>"}return html},cloneContentRow:function(data,categoryId,returnContentListOnly){var contentListHtml=$('<ul class="zp_Alst"></ul>'),linkName="",tempDiv=$("<div></div>");if(data.length>0){if($.each(data,function(i,value){var contentList=$("<li><a></a></li>"),icon="IC-url",title="";switch(value.formType){case LINK_URL:icon="IC-url";var http=value.link.match(/^http[s]*:\/\//),escaped_link=http?http+escape(value.link.split(/^http[s]*:\/\//)[1]):"https://"+escape(value.link);title=escaped_link,contentList.find("a").attr("rel","noopener noreferrer"),contentList.find("a").attr("href",unescape(escaped_link)),contentList.find("a").attr("target","_blank"),contentList.find("a").attr("title",unescape(title));break;case LINK_FILE:icon="IC-docs";var extn="";value.hasOwnProperty("filePath")?(title=value.filePath.split("/")[value.filePath.split("/").length-1],-1!=value.filePath.lastIndexOf(".")&&(extn=value.filePath.substr(value.filePath.lastIndexOf(".")+1,value.filePath.length))):(title=value.link.split("/")[value.link.split("/").length-1],-1!=value.link.lastIndexOf(".")&&(extn=value.link.substr(value.link.lastIndexOf(".")+1,value.link.length))),linkName=""!=value.linkName?value.linkName:title,"1"==value.uploadSource||value.link.indexOf(workDriveUrl)>-1||value.link.indexOf(writerUrl)>-1||value.link.indexOf(sheetUrl)>-1||value.link.indexOf(showUrl)>-1?contentList.find("a").attr("onclick","window.open('"+value.link+"')"):contentList.find("a").attr("onclick","casesFiles.getFilePreview('"+value.linkId+"','"+categoryId+"','"+HR_CATEGORY_ATTACHEMENTS+"','"+escape(linkName)+"','"+escape(extn)+"','"+(value.hasOwnProperty("filePath")?"attachmentz"+value.link:"")+"')")}linkName=""!=value.linkName?value.linkName:title,contentList.find("i").attr("class",icon),contentList.find("a").html('<i class="'+icon+'"></i>'+linkName),contentListHtml.append(contentList)}),returnContentListOnly)return contentListHtml;tempDiv.html('<div id="vcont" class="zp_txt"><div id="vcontEdit" class="zp_ttl"><span>'+ZPI18N.getString("zp.references")+'</span></div><div id="vcontent"></div></div>'),tempDiv.find("#vcontent").html(contentListHtml)}return tempDiv.html()}},HRCategory.ConfigureCategory={cloneAssociatedURLBox:function(mode){var borderClass="edit"==mode?"nobdr":"",innerHtml='<div class=" zp_fm"><div class="nobdr"><i class="IC-url"></i><input id="linkUrl" placeholder="'+ZPI18N.getString("zp.associatedUrl")+'" type="text"></div></div><div class=" zp_fm"><div class="'+borderClass+'"><input id="linkDispName" placeholder="'+ZPI18N.getString("zp.displayname")+'" type="text"></div></div><i class="IC-cls-1px" onclick="HRCategory.ConfigureCategory.cancelContentBox(this)"></i>';return'<div class="zp_fc2" contType = "'+LINK_URL+'">'+innerHtml+'</div><span class="etxt zp_dyn"></span>'},cloneAssociatedDocumentsBox:function(mode){var alignClass="edit"==mode?"zp_aftFle":"",innerHtml="";if("edit"==mode)innerHtml='<div class="zp_fm '+alignClass+'" id="fileNameDiv"><div class="nobdr"><i class="IC-note"></i><span id="fName"></span></div></div><div class=" zp_fm"><div class="nobdr"><input id="linkDispName" required="" placeholder="'+ZPI18N.getString("zp.displayname")+'" type="text"></div></div><i class="IC-cls-1px" onclick="HRCategory.ConfigureCategory.cancelContentBox(this)"></i></div>';else{var cloudHtml=ZPeople.isChinaSetup?"":'<a onclick="HRCategory.ConfigureCategory.chooseCloudFile(this)"><i class="IC-attcloud"></i>'+ZPI18N.getString("zp.files.cloud")+"</a>",workdrivehtml=isWorkdriveAllowed?'<a onclick="HRCategory.ConfigureCategory.chooseWorkDrive(this)"><i class="CR-workdrive"></i>'+ZPI18N.getString("zp.workdrive")+"</a>":"";innerHtml='<div class="zp_fm '+alignClass+'" id="fileNameDiv"><div class="nobdr"><a onclick="HRCategory.ConfigureCategory.chooseFile(this)"><i class="IC-system"></i> '+ZPI18N.getString("zp.files.desktop")+"</a>"+workdrivehtml+cloudHtml+'</div></div><div class="zp_fm"><div><input id="linkDispName" required="" placeholder="'+ZPI18N.getString("zp.displayname")+'" type="text"></div></div><i class="IC-cls-1px" onclick="HRCategory.ConfigureCategory.cancelContentBox(this)"></i></div>'}return'<div id="fileDiv" class="zp_fc2" contType = "'+LINK_FILE+'">'+innerHtml+'</div><span class="etxt zp_dyn"></span>'},replaceWithContentBox:function(obj,mode){var pageId=Layout.Page.container,newHtml="";switch(pageId.find("div[conttype]").length>0&&HRCategory.ConfigureCategory.validateContentBox(pageId.find("div[conttype]").last(),0),mode.toString()){case LINK_URL:newHtml=HRCategory.ConfigureCategory.cloneAssociatedURLBox();break;case LINK_FILE:newHtml=HRCategory.ConfigureCategory.cloneAssociatedDocumentsBox()}$(newHtml).insertBefore($(obj).closest("div.zp_Add"))},chooseFile:function(obj){var pageId=Layout.Page.container;pageId.find("[id=browseFile]").trigger("click"),pageId.find("[id=browseFile]").on("change",function(){var filename=$(this).val();filename=filename.replace("C:\\fakepath\\",""),HRCategory.ConfigureCategory.setFileDetails(pageId.find("[id=browseFile]")[0].files[0],filename,obj,"localUpload")})},chooseCloudFile:function(obj){Layout.Page.container;HRCategory.calledObject=obj,Files.showCloudPickerModal(ZPeople.cloudPickerGadgetsUrl,"HRCategory")},chooseWorkDrive:function(obj){Layout.Page.container;HRCategory.calledObject=obj,Files.showWorkDriveModal("HRCategory")},setFileDetails:function(file,filename,obj,mode){$(obj).closest("#fileNameDiv").addClass("zp_aftFle");var topDiv=$(obj).closest("div[id=fileDiv]");topDiv.data("uploadMode",mode);var progressbar="";"localUpload"==mode?(progressbar='<div class="zpPbar"><div><div class="zp_prgressbg" style="width:90%"></div></div></div>',casesFiles.uploadFileByXHR(file,{fieldName:"attachment",formTable:"P_HR_Catalog",callback:function(fileInfo,moduleProp){topDiv.find("div.zpPbar").remove(),topDiv.data("uploadedFile",JSON.stringify({filePath:fileInfo.fileId+"",fileName:fileInfo.fileName,fileSize:fileInfo.fileSize}))}}),topDiv.find("[id=linkDispName]").val(filename)):(topDiv.data("uploadedFile",file),topDiv.find("[id=linkDispName]").val(filename)),$(obj).closest("div").html('<i class="IC-note"></i><span>'+ZPeople.escapeHtml(filename)+"</span>"+progressbar)},cancelContentBox:function(obj){void 0!=$(obj).closest("div[conttype]").attr("linkId")&&""!=$(obj).closest("div.zp_fatt").attr("linkId")?$(obj).closest("div[conttype]").addClass("zp_dyn"):$(obj).closest("div[conttype]").remove()},validateContentBox:function(object,filecount,formData){var isError=!1,formType=$(object).attr("contType"),linkName=$(object).find("#linkDispName").val(),refObj={};switch(refObj={linkId:"",linkName:"",link:"",formId:"",formType:formType,file_count:0},formType){case LINK_URL:refObj.link=$(object).find("#linkUrl").val(),(isError=""==refObj.link.trim()||isError)||(refObj.linkName=""!=linkName&&void 0!=linkName?linkName:refObj.link);break;case LINK_FILE:(isError=void 0==$(object).data("uploadedFile")||isError)||(filecount+=1,refObj.file_count=filecount,refObj.linkName=""!=linkName&&void 0!=linkName?linkName:"",void 0!=formData&&(formData.append("uploadMode_"+filecount,$(object).data("uploadMode")),"localUpload"==$(object).data("uploadMode")?formData.append("file_upload_"+filecount,$(object).data("uploadedFile")):"cloudUpload"==$(object).data("uploadMode")?formData.append("cloudUploadDoc_"+filecount,$(object).data("uploadedFile")):"workDriveUpload"==$(object).data("uploadMode")&&formData.append("WDUploadDoc_"+filecount,$(object).data("uploadedFile"))))}return isError&&(refObj.isError=isError),refObj},cloneAddContentsBox:function(){return'<div class="zp_Add"><div><i class="IC-attcloud"></i><a onclick="HRCategory.ConfigureCategory.replaceWithContentBox(this,'+LINK_FILE+')">'+ZPI18N.getString("zp.attachment")+'</a></div><div><i class="IC-url"></i><a onclick="HRCategory.ConfigureCategory.replaceWithContentBox(this,'+LINK_URL+')">'+ZPI18N.getString("zp.associatedUrl")+'</a></div></div><div class="zp_note">'+ZPI18N.getString("zp.maximumfilesreached")+"</div>"}};var HRCaseBand={doubleSliderPopup:function(isCategoryView){return'<div class="zp_whtbg zp_fp zp_shw zp_dyn" id="addHRCase" ><div class="zp_pop">'+('<div class="zp_Lpop" id="caseDescEditorContainer"><div class="zp_Ptl " id="addcaseHeader"><h3>'+ZPI18N.getString("zp.askus")+'</h3></div><div class="zp_pcnt" id="addcaseContent" onscroll="CommonTemplates.scrollfunction(\'addcaseHeader\',\'addcaseContent\')"><div class="zp_formncls zp_serDs"><div id="csempDiv" class=""></div><span class="etxt zp_dyn">'+ZPI18N.getString("zp.selecthrEmployee")+'</span><div id="caseCgyDiv" class=""></div><span class="etxt zp_dyn">'+ZPI18N.getString("zp.selecthrcategory")+'</span><div id="caseSubCgyDiv" class=""></div><div id="caseTypeDiv" class=""></div><div id="casepriorityDiv" class=""></div><div id="casesourceDiv" class=""></div><div id="caseSubDiv" class=""></div><span class="etxt zp_dyn">'+ZPI18N.getString("zp.mentionthesubject")+'</span><div class=""  id="caseeditor"></div>'+CommonTemplates.chooseFileHtml()+'<div id="casestatusDiv" class=""></div><div id="caseresolutionDiv" class=""></div></div></div></div>')+'<div class="zp_Rpop" id="sCategoryView"><div class="zp_pcnt"><div class="zp_Clnd" id="sView">'+('<div class="zp_ifNoD"> <img class="img-responsive" src="'+ZPeople.getResourceURL(newUIImageUrl+"svg/no-records.svg")+'"><p>'+ZPI18N.getString("zp.nodatadoubleslider")+"</p></div>")+"</div></div></div>"+('<div class="zp_btn"><button  id="submitCaseBtn" class="zpthm zpn_btn" onclick="HRCase.AddCase.submitCase()"><b>'+ZPI18N.getString("zp.submit")+'</b><div class="zp_circular"></div><label>'+ZPI18N.getString("zp.submitting")+"</label></button><button onclick='HRCaseBand.closePage()'>"+ZPI18N.getString("zp.cancel")+"</button></div>")+"</div><i class=\"IC-cls\" onclick='HRCaseBand.closePage()'></i></div>"},categoryViewHTML:function(){return'<div class="zp_pcnt" id="sCategoryViewBody"><div class="zp_Clnd" id="sView"><div name="shortDesc" class="zp_Pdesc"></div>'+('<div class="zp_ttl" name="descTitle"><span>'+ZPI18N.getString("zp.description")+'</span></div><div class="zp_txt" name=sDesc></div>')+('<div class="zp_ttl" name="sAgent"><span>'+ZPI18N.getString("zp.agentdetails")+'</span></div><div class="zp_txt" name="sAgent"></div>')+('<div name="sSubCgy" class="zp_ttl" ><span>'+ZPI18N.getString("zp.subcategory")+'</span></div><div class="zp_txt" name="sSubCgy"></div>')+('<div name="sContent" class="zp_ttl"><span>'+ZPI18N.getString("zp.references")+'</span></div><div class="zp_txt" name="sContent"></div>')+"</div></div>"},TOPBAND:"topBandMode",serviceView:function(mode,categoryid){Layout.Page.hash;$("body").find("#addHRCase").remove(),Layout.Page.container.hasClass("askCase")?Layout.Page.container.removeClass("askCase"):($("#addHRCase").length<=0&&(Layout.Page.container.addClass("askCase"),$("body").append(HRCaseBand.doubleSliderPopup())),HRCase.AddCase.resetPage(mode,categoryid),$("body").find("#addHRCase").removeClass("zp_dyn"))},closePage:function(){CommonTemplates.removeErrorMessagesinContainerDiv("addHRCase"),Layout.Page.container.removeClass("askCase"),$("body").find("#addHRCase").remove(),-1!==Layout.Page.hash.indexOf("#hrcase/askus")&&(window.location.href="#hrcase/home")},getCategoryView:function(categoryId){$("#sCategoryView").find("#zp_page_loading").length<=0&&$("#sCategoryView").empty().html(ZPeople.LOADING_HTML);var categoryData=HRCategory.userDetails[categoryId];if(void 0==categoryData||$.isEmptyObject(categoryData)){var categoryprm={method:"fetchCatalogDetails",categoryId:categoryId,conreqcsr:csrfToken,mode:USER_VIEW};ZPeople.Request.sendAsyncPost("/fetchCatalog.zp",categoryprm,function(data){HRCategory.SUBCATEGORY_LIST[categoryId]=data.subCategories,HRCategory.userDetails[categoryId]=data,categoryData=data})}if(void 0!=categoryData&&!$.isEmptyObject(categoryData)){var subCgyMenu=HRCategory.cgydropdown(SUBCGY_LISTING,categoryId);categoryData.subCategories.length>0?(categoryData.isSubCategoryMandatory&&(subCgyMenu.data[0].isDefaultValue=!0),CommonTemplates.getSelectMenu(subCgyMenu,$("#caseSubCgyDiv"),{id:"subCgyId"},{isMandatory:categoryData.isSubCategoryMandatory,hideMandatoryMark:!1,inputHeaderName:ZPI18N.getString("zp.subcategory")})):$("#subCgyId").length>0&&(ZPSelect.destroyMenu($("#caseSubCgyDiv")),$("#caseSubCgyDiv").removeClass("zp_fm")),HRCaseBand.categoryDetailsSlider(categoryData,categoryId)}},categoryDetailsSlider:function(data,categoryId){$("#sCategoryView").addClass("services"),$("#sCategoryView").removeClass("zp_faqs");var serviceIcon=data.hasOwnProperty("serviceId")&&!ZPUtil.Validation.isEmpty(data.serviceId)?'<div class="zp_hdSrCn"><img src="'+ZPeople.getResourceURL(newUIImageUrl+"svg/app.svg")+'"></div>':"";if($("#sCategoryView").empty().append('<div class="zp_header"><label class="zp_serIcn" ><i class="zp_Si '+Icons.getIconClass(data.categoryIcon).iconClass+'"></i>'+serviceIcon+"</label><span>"+data.categoryName+"</span></div>"),$("#sCategoryView").append(HRCaseBand.categoryViewHTML()),$("[name=shortDesc]").html(data.categoryShortDescription),""!=data.description&&"<div><br /></div>"!=data.description&&"<br />"!=data.description&&"<div>&nbsp;</div>"!=data.description?$("[name=sDesc]").html(ZPFeeds.Activity.getSmileys(data.description)):($("[name=sDesc]").remove(),$("[name=descTitle]").remove()),$.each(data.categoryConfiguration,function(i,v){$("div[name=sAgent].zp_txt").empty().append(HRCategory.View.cloneAgentRow(v.categoryAgents,!0)),$.isEmptyObject(v.categoryAgents)&&$("div[name=sAgent].zp_txt").html(ZPI18N.getString("zp.agentnotavailable")),v.categoryReferences.length>0?$("div[name=sContent].zp_txt").append(HRCategory.View.cloneContentRow(v.categoryReferences,categoryId,!0)):$("[name=sContent]").remove()}),data.subCategories.length>0){var subCgyHtml="";$.each(data.subCategories,function(i,v){var agentHtml="";ZPUtil.Validation.isEmpty(v.agentTypeId)||ZPUtil.Validation.isEmpty(v.agentValueId)||(agentHtml=HRCategory.View.cloneAgentRow(v,!0)),subCgyHtml+='<div class="zp_sbCt"><div>'+v.subcategoryname+"</div>"+agentHtml+"</div>"}),$('div[name="sSubCgy"].zp_txt').empty().append(subCgyHtml)}else $('[name="sSubCgy"]').remove();$("#sView").find("[name=faqDiv]").remove(),0!=data.faqList&&($("#sView").append('<div name="faqDiv" class="zp_ttl"><span>'+ZPI18N.getString("zp.faq")+'</span></div><div name="faqDiv" class="zp_txt zp_faqs" id="faqList"></div>'),Solution.listRow(data.faqList,$("#sView").find("#faqList"),!0))},loadFAQ:function(query){$("#sCategoryViewBody").empty().append(ZPeople.LOADING_HTML);var params={mode:"searchFAQ",conreqcsr:csrfToken};params.searchStr=query,ZPeople.Request.send("/searchFAQ.zp",params,function(data){Solution.listRow(data.FAQ_LIST,$("#sCategoryViewBody"),!0),$("#sCategoryView").addClass("zp_faqs"),$("#sCategoryView").find("#faqNodataBtn").remove(),$("#sCategoryViewBody").find("#zp_page_loading").remove(),$("#sCategoryView").find(".zp_header").html("<span>Suggested FAQs</span>")})},faqListClick:function(getThis,isDoubleSlider){var faqId=$(getThis).attr("faqid");$("#sCategoryView > div").addClass("zp_dyn"),$("#sCategoryView").find("#faqDtls").remove(),$("#sCategoryView").append('<div id="faqDtls" class="zp_faqs" faqid="'+faqId+'"></div>'),Solution.faqDetailedView(faqId,$("#sCategoryView").find("#faqDtls"),!0),$("#sCategoryView").find("#faqDtlsHeader").find(".zp_micn").remove(),$("#sCategoryView").find("#faqDtlsHeader").prepend('<i id="backToFAQList" class="IC-ar-lft"></i>'),$("#backToFAQList").off("click").on("click",function(e){$("#sCategoryView > div").removeClass("zp_dyn"),$("#sCategoryView").find("#faqDtls").remove()})}},casesFiles={appInfo:{},CURR_UPLOADED_FILES:[],uploadViaXHRs:function(eve,moduleProp){for(var fileStore=eve.files,i=0;i<fileStore.length;i++)CURR_UPLOADED_FILES.push(fileStore[i]),casesFiles.uploadFileByXHR(fileStore[i])},uploadFileByXHR:function(file,moduleProp){var uploadId=(new Date).getTime()+"_"+_LOGGEDIN_ZUID;Layout.ISLOCALIDCSETUP&&(UDS_UPLOAD_SERVICE_CODE=window.location.host.split(".")[0]);var udsUploadApi=UPLOAD_URL+"/"+UDS_UPLOAD_SERVICE_CODE+"/ver1/stream/upload";xhr=new XMLHttpRequest,xhr.instanceKey=xhr.upload.instanceKey=this.instanceKey,xhr.uploadId=xhr.upload.uploadId=uploadId,this.appInfo.portalId=_LOGGEDIN_ACCZSOID,this.appInfo.moduleName="HRCase",this.appInfo.fieldName=moduleProp.fieldName,this.appInfo.formTableName=moduleProp.formTable,xhr.open("post",udsUploadApi,!0),xhr.setRequestHeader("x-assured-response",!0),xhr.setRequestHeader("x-streammode","1"),xhr.setRequestHeader("app-info",JSON.stringify(this.appInfo)),xhr.setRequestHeader("file-info",JSON.stringify({fileName:encodeURIComponent(file.name),contentType:file.type,fileSize:file.size})),xhr.setRequestHeader("upload-id",uploadId),xhr.withCredentials=!0,xhr.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var responseObj=JSON.parse(this.response);casesFiles.uploadCallBack(responseObj,moduleProp)}else 4==this.readyState&&200!=this.status&&(ZPeople.Message.showFailureMsg(uploadedFileInfo.message),void 0!=moduleProp.failureCallback&&"function"==typeof moduleProp.failureCallback&&moduleProp.failureCallback(uploadedFileInfo))},xhr.send(file)},uploadCallBack:function(uploadedFileInfo,moduleProp){if(this.uploadedFileInfo=uploadedFileInfo,uploadedFileInfo.fileInfo){var fileInfo=uploadedFileInfo.fileInfo;void 0!=moduleProp.callback&&"function"==typeof moduleProp.callback&&moduleProp.callback(fileInfo)}else"Failure"==uploadedFileInfo.status&&(ZPeople.Message.showFailureMsg(uploadedFileInfo.message),void 0!=moduleProp.failureCallback&&"function"==typeof moduleProp.failureCallback&&moduleProp.failureCallback(uploadedFileInfo))},generateDownloadURL:function(moduleProp){Layout.ISLOCALIDCSETUP&&(UDS_DOWNLOAD_SERVICE_CODE=window.location.host.split(".")[0]);var obj={portalId:_LOGGEDIN_ACCZSOID,fileId:moduleProp.fileId,submode:moduleProp.fType,recordId:moduleProp.recordId,mode:"HRCase"},eventid=(new Date).getTime()+"_"+_LOGGEDIN_ZUID,myJson=JSON.stringify(obj);return UDS_DOWNLOAD_URL+"/webdownload?x-service="+UDS_DOWNLOAD_SERVICE_CODE+"&event-id="+eventid+"_"+moduleProp.recordId+"&x-cli-msg="+encodeURIComponent(myJson)},getFilePreview:function(fileId,recordId,fileType,displayName,extn,previewFileId){var imgExtn=["jpg","jpeg","gif","png"],textFileExtn=["txt","sql","xml"],zohoDocsFileExtn=["xls","xlsx","sxc","ods","csv","tsv","doc","docx","sxw","odt","rtf","ppt","pptx","pps","odp","sxi"];previewFileId=void 0!=previewFileId?previewFileId:"";var fileParams={fileId:fileId,recordId:recordId,fType:fileType,fileName:unescape(displayName),fileExtn:extn,filePath:previewFileId,allowDownload:!0,fileConfident:0};if(""!=previewFileId&&(fileParams.previewFileId=previewFileId),-1==zohoDocsFileExtn.indexOf(extn)&&-1==imgExtn.indexOf(extn)&&-1==textFileExtn.indexOf(extn)&&"pdf"!=extn)casesFiles.getFileDownload(event,fileId,recordId,fileType,""!=previewFileId);else{Preview.showPreview(fileParams,"HRCase");var pageId=$("#viewPreviewFileDiv"),previewURL="";if(""==previewFileId||"pdf"!=extn&&-1==Files.previewVideoFType.indexOf(extn))if(-1!=zohoDocsFileExtn.indexOf(extn)){$(ZPeople.LOADING_HTML).insertBefore(Layout.Page.container.find(".content-body"));var params={fileId:fileId,recordId:recordId,fileType:fileType,conreqcsr:csrfToken,methodName:"viewCgyFile"};$.ajax({url:"/getCgyFile.zp",type:"POST",data:params,async:!1,success:function(res,textStatus,request){var url=res.url;Files.setUrlIframeToViewFile(url,"HRCase")}})}else{pageId.find(".content-pv").append(ZPeople.LOADING_HTML);var xhr=new XMLHttpRequest,previewData=new FormData;previewData.append("fileId",fileId),previewData.append("recordId",recordId),previewData.append("fileType",fileType),previewData.append("methodName","viewCgyFile"),previewData.append("conreqcsr",csrfToken),xhr.open("post","/getCgyFile.zp"),xhr.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var data_url=URL.createObjectURL(this.response);$(".content-pv").find("#zp_page_loading").remove(),-1!=imgExtn.indexOf(extn)?($("#imageviewFrame").attr("src",data_url),$("#imageviewFrame").off("load"),$("#imageviewFrame").on("load",function(){Files.imgOrgHeight=$("#imageviewFrame").height(),Preview.imgOrgHeight=$("#imageviewFrame").height()})):($("#viewFileFrame").attr("src",data_url),$(window.top.document).find("#viewFileFrame").height($("#viewPreviewFileDiv").height()-120+"px"),-1!=textFileExtn.indexOf(extn)&&$("#preview_body").addClass("pv-txt"))}else 4==this.readyState&&200!=this.status&&ZPeople.Message.showFailureMsg("Error")},xhr.responseType="blob",xhr.send(previewData)}else{previewURL=Files.constructPreviewUrl("HRCase",{filePath:previewFileId,fileId:fileId,recordId:recordId,fType:fileType},extn);Files.setUrlIframeToViewFile(previewURL,"HRCase")}}},getFileDownload:function(event,fileId,recordId,fileType,isUDSUpload){event.stopPropagation(),event.preventDefault(),HRCaseCommon.getFileDownload(event,fileId,recordId,fileType)}};HRCaseContainer={cViewPageHtml:function(){return'<div class="zp_cV active" id="caseDtls"><div class="zp_cVIn" id="viewcasedtls"></div></div>'},cViewHeader:function(caseDtl){var _htm='<div class="zp_cHd"> <div class="zp_cHTtl"> <i  data-toggle="tooltip" data-placement="bottom" data-original-title="'+ZPI18N.getString("zp.back")+'" class="IC-ar-lft" onclick="HRCaseAction.closepreview()"></i> <div class="zp_chQt"> <span data-toggle="tooltip" data-placement="bottom" title="" data-original-title="'+caseDtl.caseId+'">'+caseDtl.caseId+"</span>";return _htm+='<h3 data-toggle="tooltip" data-placement="bottom" title="" data-original-title="'+caseDtl.subject+'" id="header_subject">'+caseDtl.subject+"</h3> ",_htm+='</div> </div> <div class="zp_cHopt" id="zphr_vctlft"> <i id="hrcasev_moreopt"class="IC-more"></i>',_htm+='<div class="zp_cSlt" id="timer"><span>Closes in </span><p id="sla_time"></p></div>',_htm+="</div> </div>"},cViewPrevNxt:function(){return'<div class="zp_cHnV" id="zrphrc_prevnxt"><i class="IC-ar-lft"  type="0" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="'+ZPI18N.getString("zp.prevcase")+'"></i><i class="IC-ar-rgt"  type="1" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="'+ZPI18N.getString("zp.nextcase")+'"></i></div>'},cViewSplitHtml:function(){return'<div class="zp_cVwrp"><div class="zp_cVlt" id="casevwNotesContainer"></div><div class="zp_cVrt" id="caserightinfo"></div></div>'},cViewLeftHtml:function(){return'<div class="zp_cVltIn"><div class="zp_cVltcrd" id="zrhrcv_comments"></div></div>'},cViewLeftBottom:function(){var _htm='<div class="zp_cVrpy" id="caseviewContent"><ul class="zp_cVCmTbs" id="cmntnotes_menu"> <li class="sel" etype="0"><a href="javascript:;">'+ZPI18N.getString("zp.reply")+'</a></li> <li etype="1"><a href="javascript:;" >'+ZPI18N.getString("zp.notes")+"</a></li> </ul>";return _htm+='<div class="zp_cVCmts" id="comment_cont"></div>',_htm+='<div class="zp_cVCmts" id="casenote_cont" style="display: none"></div>',_htm+='<div class="zp_cVcmtAts" id="caseview_footer">',_htm+='<div class="zp_cVbtn"  id="replysubmitbtn"><button class="zp_btnWar">'+ZPI18N.getString("zp.submit")+'</button><i class="IC-ar-dwn" id="i_choosestatus" data-toggle="tooltip" data-placement="top" data-original-title="'+ZPI18N.getString("zp.submitwithstatus")+'"></i></div>',_htm+='<div class="zp_cVbtn" id="savenotebutton" style="display: none"> <button class="zp_btnWar">'+ZPI18N.getString("zp.submitnotes")+"</button></div>",_htm+='<div class="editor-atchment" id="caseview_atch"> <i class="zei-attachment" data-toggle="tooltip" data-placement="right" data-original-title="'+ZPI18N.getString("zp.attachments")+'"></i> </div>',_htm+='<div id="hrcAttchedFiles" attachcnt="0" class="zp_Alst clearfix"></div>',_htm+="</div>",_htm+="</div>"},cViewRightHtml:function(){var _htm='<ul class="zpTm-list zp_dyn" id="zphrc_vownerd"></ul><ul class="zpTm-list" id="zphrc_vreqd"></ul><div class="zp_cVsbx" id="hrcasev_cspa"> <div class="zp_formncls">';return _htm+='<div class="zp_fm" id="categoryList"></div>',_htm+='<div class="zp_fm" id="caseType"></div>',_htm+='<div class="zp_fm" id="cStatus"></div>',_htm+='<div class="zp_fm" id="casepriorityDiv"></div>',_htm+='<div class="zp_fm" id="caseSource"></div>',_htm+='<div class="zp_fm" id="caseAgent"></div>',_htm+="</div></div>"}},HRCaseAction={caseviewoldpriority:"",closepreview:function(){$("#caseDtls").length>0&&($("#caseDtls").remove(),$(".zp_Lst").removeClass("sel"),HRCase.DetailedView.closeSlide(),HRCase.DetailedView.permittedCaseStatus={})},changeCategoryDropdown:function(recordId,allowFollow,callback,changeCategoryList,oldcategoryId,oldsubcategoryId,caseDtl){var pageId=Layout.Page.container,params=[],currentSubCgyList=[],currentCgyData={},selectedCgyLiObj={};$.isEmptyObject(changeCategoryList)?currentCgyData={id:caseDtl.categoryId,text:caseDtl.categoryName,iconClass:"zp_Si "+Icons.getIconClass(caseDtl.categoryIcon).iconClass}:$.each(changeCategoryList,function(i,v){var param1={};param1.id=v.categoryId,param1.value=v.categoryName,param1.iconClass="zp_Si "+Icons.getIconClass(v.categoryIcon).iconClass,params.push(param1),v.categoryId==oldcategoryId&&(currentSubCgyList=v.subCategoryList,currentCgyData={id:v.categoryId,text:v.categoryName,iconClass:"zp_Si "+Icons.getIconClass(v.categoryIcon).iconClass},selectedCgyLiObj=v)});var nameinputProperties={isMandatory:!1,inputHeaderName:ZPI18N.getString("zp.category")},nameinputAttributes={id:"cgyListInp",value:caseDtl.categoryName,disabled:"disabled"};if(CommonTemplates.getInputTextIcon(nameinputAttributes,nameinputProperties,pageId.find("[id=categoryList]")),$.isEmptyObject(currentCgyData)||pageId.find("#categoryList").find("#cgyListInp").zpselect({selectedVal:[currentCgyData]}),params.length>1&&pageId.find("#categoryList").off("click").on("click",function(ev){ev.stopPropagation(),ev.preventDefault();var srcObj=$(this);oldcategoryId=srcObj.find("#cgyListInp").attr("selectedids"),oldsubcategoryId="",pageId.find("#subCategoryList").length>0&&!ZPUtil.Validation.isEmpty(pageId.find("#subcgyListInp").attr("selectedIds"))&&(oldsubcategoryId=pageId.find("#subcgyListInp").attr("selectedIds")),HRCase.DetailedView.changeCategoryDropdown(srcObj.find("#cgyListInp"),recordId,HRCase.DetailedView.CASE_VIEW_PAGE,!0,function(data,currCategoryObj,subcategoryObj){if(HRCase.DetailedView.categoryChangeCallback(recordId,data,currCategoryObj,subcategoryObj),HRCaseAction.actionAfterCategoryChange(data,recordId),HRCaseAction.afterChangeCommentUpdate(data),HRCaseAction.scrollToBottom(),SLA.showSLABand(data.sla),!$.isEmptyObject(changeCategoryList)){var subcList=[];if($.each(changeCategoryList,function(i,v){v.categoryId==currCategoryObj.categoryId&&(subcList=v.subCategoryList,srcObj.find("#cgyListInp").removeAttr("value").attr("selectedIds",v.categoryId).attr("value",v.categoryName),srcObj.find("#cgyListInp").zpselect({selectedVal:[{id:v.categoryId,text:v.categoryName,iconClass:"zp_Si "+Icons.getIconClass(v.categoryIcon).iconClass}]}),selectedCgyLiObj=v)}),subcList.length>0){var subcgyparams=[];$.each(subcList,function(i,v){var param1={};param1.id=v.subCategoryId,param1.value=v.subcategoryname,subcgyparams.push(param1)}),0==pageId.find("#subCategoryList").length&&$('<div class="zp_fm" id="subCategoryList"></div>').insertAfter("#categoryList");var _subCgyMenuProp={id:"subcgyList",data:subcgyparams,callback:function(liObj,sourceObj){var sCId=$(liObj).attr("id");callbacksublist=function(data){HRCaseAction.actionAfterCategoryChange(data,recordId),HRCaseAction.afterChangeCommentUpdate(data),HRCaseAction.scrollToBottom(),SLA.showSLABand(data.sla)},HRCaseAction.ChangeCategory(currCategoryObj.categoryId,sourceObj,recordId,callbacksublist,"updateSubCategory",sCId)},callbackOnCancel:function(sourceObj){callbacksublist=function(data){HRCaseAction.actionAfterCategoryChange(data,recordId),HRCaseAction.afterChangeCommentUpdate(data),HRCaseAction.scrollToBottom()},HRCaseAction.ChangeCategory(pageId.find("#cgyListInp").attr("selectedids"),sourceObj,recordId,callbacksublist,"updateSubCategory","")}};CommonTemplates.getSelectMenu(_subCgyMenuProp,pageId.find("#subCategoryList"),{id:"subcgyListInp"},{isMandatory:selectedCgyLiObj.isSubCategoryMandatory,inputHeaderName:ZPI18N.getString("zp.subcategory")}),void 0==subcategoryObj||ZPUtil.Validation.isEmpty(subcategoryObj.subCategoryId)||pageId.find("#subcgyListInp").zpselect({selectedVal:[{id:subcategoryObj.subCategoryId,text:subcategoryObj.subcategoryname}]})}else pageId.find("#subCategoryList").remove()}},changeCategoryList,oldcategoryId,oldsubcategoryId)}),currentSubCgyList.length>0){0==pageId.find("#subCategoryList").length&&$('<div class="zp_fm" id="subCategoryList"></div>').insertAfter("#categoryList");var subcgyparams=[],currentSubCgyData={};$.each(currentSubCgyList,function(i,v){var param1={};param1.id=v.subCategoryId,param1.value=v.subcategoryname,subcgyparams.push(param1),ZPUtil.Validation.isEmpty(oldsubcategoryId)||v.subCategoryId!=oldsubcategoryId||(currentSubCgyData={id:v.subCategoryId,text:v.subcategoryname})});var subCgyMenuProp={id:"subcgyList",data:subcgyparams,callback:function(liObj,sourceObj){var sCId=$(liObj).attr("id");callbacksublist=function(data){HRCaseAction.actionAfterCategoryChange(data,recordId),HRCaseAction.afterChangeCommentUpdate(data),HRCaseAction.scrollToBottom()},HRCaseAction.ChangeCategory(pageId.find("#cgyListInp").attr("selectedids"),sourceObj,recordId,callbacksublist,"updateSubCategory",sCId)},callbackOnCancel:function(sourceObj){callbacksublist=function(data){HRCaseAction.actionAfterCategoryChange(data,recordId),HRCaseAction.afterChangeCommentUpdate(data),HRCaseAction.scrollToBottom()},HRCaseAction.ChangeCategory(pageId.find("#cgyListInp").attr("selectedids"),sourceObj,recordId,callbacksublist,"updateSubCategory","")}};CommonTemplates.getSelectMenu(subCgyMenuProp,pageId.find("#subCategoryList"),{id:"subcgyListInp"},{isMandatory:selectedCgyLiObj.isSubCategoryMandatory,inputHeaderName:ZPI18N.getString("zp.subcategory")}),ZPUtil.Validation.isEmpty(oldsubcategoryId)||pageId.find("#subcgyListInp").zpselect({selectedVal:[currentSubCgyData]})}else pageId.find("#subCategoryList").remove()},actionAfterCategoryChange:function(data,recordId){var pageId=Layout.Page.container;if(data.hasOwnProperty("assignedToList")&&data.assignedToList.isAssigneeAvailable){var menuProp=HRCaseAction.selectAgentDropdown(recordId,"caseView");menuProp.isMandatory=!1,CommonTemplates.getSelectMenu(menuProp,pageId.find("#caseAgent"),{id:"newAgentInp",placeholder:ZPI18N.getString("zp.select")+" "+ZPI18N.getString("zp.agent")},{inputHeaderName:ZPI18N.getString("zp.agent"),isMandatory:!0,hideMandatoryMark:!0});var userDetails="1"==data.agentTypeId?ZPeople.getUserDetailsById(data.agentValueId):{},imageVal="1"==data.agentTypeId?userDetails.avatar:"",displayName="1"==data.agentTypeId?userDetails.empid+" "+data.agentDetails:data.agent_details,selectedValObj={id:data.agentValueId,text:data.agent_details,imageAlt:ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(displayName))),image:imageVal};pageId.find("#newAgentInp").zpselect({selectedVal:[selectedValObj]})}else{var altText=""!=data.agent_details?ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(data.agent_details))):"",sourceUrl="",popup=(data.agentValueId,data.agentTypeId,HRCase.List.agentPopup(data.agentTypeId,data.agentValueId));data.hasOwnProperty("agent")&&data.agent.hasOwnProperty("erecno")&&(popup=HRCase.List.agentPopup(OWNER_EMPLOYEE.toString(),data.agent.zuid),sourceUrl=data.agent.employeePhoto,agentZuid=data.agent.zuid,data.agent.erecno,OWNER_EMPLOYEE.toString());var _photoUrl=CommonTemplates.returnImgDiv(sourceUrl,altText,"","",popup),_singleAgentHtm=HRCaseData.singleAgentData(data.agentTypeId,data.agent_details,_photoUrl);pageId.find("#caseAgent").empty(),pageId.find("#caseAgent").html(_singleAgentHtm)}},ChangeCategory:function(categoryId,sourceObj,recordId,callback,mode,subCategoryId,isFollow){Layout.Page.container;var params={conreqcsr:csrfToken,method:"changeCatalog",categoryId:categoryId,zp_recordId:recordId};subCategoryId&&(params.subCategoryId=subCategoryId),isFollow&&(params.followCase=!0);var originalHtml=$(sourceObj).html();ZPeople.Request.send("/changeCatalog.zp",params,function(data){"success"!=data.status?(ZPeople.Message.showFailureMsg(data.desc),$(sourceObj).html(originalHtml)):("followCase"==mode?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.followcasesucs")):"updateCategory"==mode?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.categorychangesuccs")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.subcategorychangesuccs")),callback(data))})},followCase:function(recordId,obj,isFollow,callback){Layout.Page.container;var params={conreqcsr:csrfToken,method:"followCase",zp_recordId:recordId};isFollow&&(params.followCase=!0);var originalHtml=$(obj).html();ZPeople.Request.send("/followCase.zp",params,function(data){"success"!=data.status?$(sourceObj).html(originalHtml):(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.followcasesucs")),callback(data))})},afterFollowCase:function(data){"string"==typeof data&&(data=JSON.parse(data));var MORE_OPTION=HRCase.DetailedView.MORE_OPTION;for(var i in MORE_OPTION)if("followCase"==MORE_OPTION[i].id){HRCase.DetailedView.MORE_OPTION.splice(i,1);break}},selectCaseStatus:function(caseId,currentCaseStatus,isAgent,permittedCaseStatus){var pageId=Layout.Page.container,dropdownList=[];Layout.Page.hash;if(permittedCaseStatus.length>0&&currentCaseStatus!=HRCase.CANCELLED_SID){$.each(permittedCaseStatus,function(key,value){var param1={id:value.systemValue,value:value.optionValue};currentCaseStatus==value.systemValue&&(param1.isDefaultValue=!0),dropdownList.push(param1)});var menuProp={id:"caseStatus",data:dropdownList,callback:function(liObj,sourceObj){var sId=$(liObj).attr("id"),sName=$(liObj).attr("name");callback=function(data){HRCaseAction.afterCVStatusUpdate(data,caseId,sId,sName),HRCaseAction.scrollToBottom()},HRCaseAction.changeCaseStatus(caseId,sourceObj,sId,sName,currentCaseStatus,callback)}};CommonTemplates.getSelectMenu(menuProp,pageId.find("#cStatus"),{id:"caseStatusInp"},{inputHeaderName:ZPI18N.getString("zp.status"),isMandatory:!0,hideMandatoryMark:!0})}},selectCaseType:function(caseId,currentCaseType,isAgent,permittedCaseType){var pageId=Layout.Page.container,dropdownList=[];Layout.Page.hash;if(permittedCaseType.length>0){$.each(permittedCaseType,function(key,value){var param1={id:value.optionId,value:value.optionValue};currentCaseType==value.optionValue&&(param1.isDefaultValue=!0),dropdownList.push(param1)});var menuProp={id:"caseTypeList",data:dropdownList,callback:function(liObj,sourceObj){var sId=$(liObj).attr("id"),sName=$(liObj).attr("name");callback=function(data){HRCaseAction.afterCaseTypeUpdate(data,caseId,sId,sName),HRCaseAction.scrollToBottom()},HRCaseAction.changeCaseType(caseId,sourceObj,sId,sName,currentCaseType,callback)},callbackOnCancel:function(sourceObj){callback=function(data){HRCaseAction.afterCaseTypeUpdate(data,caseId,"",""),HRCaseAction.scrollToBottom()},HRCaseAction.changeCaseType(caseId,sourceObj,"","",currentCaseType,callback)}};CommonTemplates.getSelectMenu(menuProp,pageId.find("#caseType"),{id:"caseTypeInp",placeholder:ZPI18N.getString("zp.casetypeunspecified")},{inputHeaderName:ZPI18N.getString("zp.casetype"),isMandatory:!1,hideMandatoryMark:!0})}},selectAgentDropdown:function(caseId,mode){var pageId=Layout.Page.container;return{id:"newAgentList",data:HRCaseAction.getAssignedToList(caseId,mode),callback:function(liObj,sourceObj){callback=function(data){if(HRCaseAction.afterChangeCommentUpdate(data),HRCaseAction.scrollToBottom(),HRCase.DetailedView.MORE_OPTION=jQuery.grep(HRCase.DetailedView.MORE_OPTION,function(value){return"unassignCase"!=value.id}),data.unassign&&HRCase.DetailedView.MORE_OPTION.unshift({id:"unassignCase",value:ZPI18N.getString("zp.unassign")}),Task.isTaskAvailable()&&(0==pageId.find("#hrcase_addtaskicn").length?HRCaseData.initTaskHtm():HRCaseAction.enableHRCaseTask(),pageId.find("#hrcase_addtaskicn").on("click",function(){if(0==pageId.find("#quickTask").length){var taskHtm=HRCaseData.addTask();0==pageId.find("#hrcase_addtasklist").children().length?pageId.find("#hrcase_addtasklist").html(taskHtm):pageId.find(taskHtm).insertBefore(pageId.find("#hrcase_addtasklist").children()[0])}}),data.hasOwnProperty("taskList"))){var taskHtm=HRCaseData.taskListCons(data.taskList);if(""==taskHtm){var _noData=HRCaseData.noDataFound("No Data Found");pageId.find("#hrcase_addtasklist").html(_noData)}else pageId.find("#hrcase_addtasklist").html(taskHtm),HRCaseAction.setTaskListHeight(),pageId.find("#hrcase_addtasklist > div").on("click",function(event){event.stopPropagation(),HRCaseAction.taskDetail(event)})}},HRCaseAction.assignHrcase(sourceObj,liObj,caseId,callback)}}},assignHrcase:function(srcObj,ele,caseid,callback){var pageId=Layout.Page.container,params=(Layout.Page.hash,{conreqcsr:csrfToken,method:"assignedHrcase",zp_recordId:caseid,assignedId:$(ele).attr("id")});pageId.find("#caseOwner").html(ZPeople.LOADING_HTML),ZPeople.Request.send("/assignedHrcase.zp",params,function(data){"success"==data.status?callback(data):ZPeople.Message.showFailureMsg(data.desc)})},getAssignedToList:function(caseId,mode){HRCase.ASSIGNEE_LIST.hasOwnProperty(caseId)||ZPeople.Request.sendAsyncPost("/getAssignedToList.zp",{caseId:caseId,method:"getAssignedToList",conreqcsr:csrfToken},function(data){"success"==data.status?data.assignedToList.isAssigneeAvailable?HRCase.ASSIGNEE_LIST[caseId]=data.assignedToList.assigneeList:HRCase.ASSIGNEE_LIST[caseId]=[]:ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.ttfailuremsg"))},function(){ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.ttfailuremsg"))});var empdata=[];return $.each(HRCase.ASSIGNEE_LIST[caseId],function(i,value){var param1={value:value.empDispName,image:value.empPhoto,id:value.empErecno,ownerType:OWNER_EMPLOYEE,dataval:"callbackcal"};empdata.push(param1)}),empdata},afterChangeCommentUpdate:function(data){var pageId=Layout.Page.container,_hrcasefeedcomment=HRCase.DetailedView.caseObj.HRCaseFeedComment,_content=ZPFeeds.Activity.validateContent(data.content,!1,_hrcasefeedcomment.departmentDts,_hrcasefeedcomment.groupDts),_comment=HRCaseAction.constructCmntObj(data);_comment.isSysComment=!0;var _cmnthtm=HRCaseData.singleCaseComment(_comment,_content);pageId.find("#zrhrcv_comments").append($(_cmnthtm)),HRCaseAction.convertSmileys(),HRCaseAction.shareFAQClick()},convertSmileys:function(){var pageId=Layout.Page.container,_smiliesAr="smilenew,lol,sad,angry,tongueout,winknew,meh,shocked,worried,sleepy,lipssealed,neutral,like,dislike,claps,searching,tensed,dizzy,coolnew,yummy,idea,injured,sick,anxious,doubtful,tearofjoy,halo,grin,loveit,curious,thinking,relaxed,yuck,blush,upset,stressed,tired,bored,jealous,evil,facepalm,surprise,headache,namaste,super,birthday,feelingwarm,feelingcold,ontarget".split(",");for(var i in _smiliesAr){var str="zcoemoji-"+_smiliesAr[i],_ele=pageId.find("#zrhrcv_comments").find('[class~="'+str+'"]').get();_ele.length>0&&$.each(_ele,function(index,value){$(_ele[index]).hasClass("zp_emoji")||$(_ele[index]).addClass("zp_emoji")})}},constructCmntObj:function(data){var comment={},commbyinfo={};return comment.commentId=data.commentId,comment.content=data.content,comment.commat=data.time,(commbyinfo=data.commbyinfo).zuid=commbyinfo.zuid,commbyinfo.employeePhoto=commbyinfo.employeePhoto,commbyinfo.name=commbyinfo.name,commbyinfo.empid=commbyinfo.empid,comment.commbyinfo=commbyinfo,comment},afterCaseTypeUpdate:function(data,caseId,newCaseType,newCaseTypeName){var pageId=Layout.Page.container;HRCase.DetailedView.permittedCaseType=data.permittedCaseType,HRCaseAction.selectCaseType(caseId,newCaseType,data.isAgent,data.permittedCaseType),pageId.find("#caseType").find("#caseTypeInp").val(newCaseTypeName),pageId.find("#caseType").find("#caseTypeInp").attr("selectedids",newCaseType)},afterCVStatusUpdate:function(data,caseId,newStatus,newStatusName){var pageId=Layout.Page.container;if(HRCase.DetailedView.permittedCaseStatus=data.permittedCaseStatus,HRCaseAction.selectCaseStatus(caseId,newStatus,data.isAgent,data.permittedCaseStatus),pageId.find("#cStatus").find("#caseStatusInp").val(newStatusName),pageId.find("#cStatus").find("#caseStatusInp").attr("selectedids",newStatus),newStatus!=HRCase.COMPLETED_SID&&newStatus!=HRCase.OPEN_SID||HRCaseAction.rightActionDisableOnStatus(newStatus),newStatus==HRCase.COMPLETED_SID?pageId.find("#i_choosestatus").addClass("zp_dyn"):newStatus==HRCase.OPEN_SID&&pageId.find("#i_choosestatus").removeClass("zp_dyn"),data.isAgent&&newStatus!=HRCase.COMPLETED_SID){var selectedValObj={id:data.agent.erecno,text:data.agent_details,imageAlt:ZPeople.escapeHtml(CommonTemplates.getAltText(ZPeople.decodeTxt(data.agent_details))),image:data.agent.employeePhoto};pageId.find("#newAgentInp").zpselect({selectedVal:[selectedValObj]})}else{var popup=HRCase.List.agentPopup(data.agentTypeId,data.agent.erecno),_photoUrl=CommonTemplates.returnImgDiv(data.agent.employeePhoto,data.agent_details,"","",popup),_singleAgentHtm=HRCaseData.singleAgentData(data.agent.erecno,data.agent_details,_photoUrl);pageId.find("#caseAgent").html(_singleAgentHtm)}var _hrcasefeedcomment=HRCase.DetailedView.caseObj.HRCaseFeedComment,_content=ZPFeeds.Activity.validateContent(data.content,!1,_hrcasefeedcomment.departmentDts,_hrcasefeedcomment.groupDts),_comment=HRCaseAction.constructCmntObj(data);_comment.isSysComment=!0;var _cmnthtm=HRCaseData.singleCaseComment(_comment,_content);pageId.find("#zrhrcv_comments").append($(_cmnthtm)),HRCaseAction.shareFAQClick()},rightActionDisableOnStatus:function(sid){var pageId=Layout.Page.container;sid==HRCase.CANCELLED_SID||sid==HRCase.COMPLETED_SID?(pageId.find("#cgyListInp").prop("disabled",!0),pageId.find("#cgyListInp").prev().prev().hide(),pageId.find("#subcgyListInp").prop("disabled",!0),pageId.find("#subcgyListInp").prev().prev().hide(),pageId.find("#priorityId").prop("disabled",!0),pageId.find("#priorityId").prev().prev().hide(),sid==HRCase.CANCELLED_SID&&(pageId.find("#caseStatusInp").prop("disabled",!0),pageId.find("#caseStatusInp").prev().prev().hide())):(pageId.find("#cgyListInp").prop("disabled",!1),pageId.find("#cgyListInp").prev().prev().show(),pageId.find("#subcgyListInp").prop("disabled",!1),pageId.find("#subcgyListInp").prev().prev().show(),pageId.find("#priorityId").prop("disabled",!1),pageId.find("#priorityId").prev().prev().show(),pageId.find("#caseStatusInp").prop("disabled",!1),pageId.find("#caseStatusInp").prev().prev().show())},changeCaseStatus:function(caseId,sourceObj,newStatus,newStatusName,oldCaseStatus,callback){Layout.Page.container,Layout.Page.hash;var params={conreqcsr:csrfToken,status:newStatus,zp_recordId:caseId,method:"changeCaseStatus"},originalHtml=$(sourceObj).html();ZPeople.Request.send("/changeCaseStatus.zp",params,function(data){if("success"==data.status)callback(data);else{var failureMessage=data.desc;data.desc.hasOwnProperty("status")?failureMessage=data.desc.status:data.desc.hasOwnProperty("Security_Error")&&(failureMessage=data.desc.Security_Error),ZPeople.Message.showFailureMsg(failureMessage),$(sourceObj).html(originalHtml)}SLA.showSLABand(data.sla)})},changeCaseType:function(caseId,sourceObj,newCaseType,newCaseTypeName,oldCaseType,callback){Layout.Page.container,Layout.Page.hash;var params={conreqcsr:csrfToken,status:newCaseType,zp_recordId:caseId,method:"changeCaseType"},originalHtml=$(sourceObj).html();ZPeople.Request.send("/changeCaseType.zp",params,function(data){if("success"==data.status)HRCaseAction.afterChangeCommentUpdate(data),HRCaseAction.scrollToBottom();else{var failureMessage=data.desc;data.desc.hasOwnProperty("status")?failureMessage=data.desc.status:data.desc.hasOwnProperty("Security_Error")&&(failureMessage=data.desc.Security_Error),ZPeople.Message.showFailureMsg(failureMessage),$(sourceObj).html(originalHtml)}})},changePriorityOption:function(caseid,priorityOption,sourceObj){Layout.Page.container,Layout.Page.hash;var params={conreqcsr:csrfToken,priority:priorityOption,zp_recordId:caseid,method:"changePriorityOption"};$(sourceObj).html();ZPeople.Request.send("/changePriorityOption.zp",params,function(data){"success"==data.status?(HRCaseAction.afterChangeCommentUpdate(data),HRCaseAction.scrollToBottom()):ZPeople.Message.showFailureMsg(data.desc)})},submitReply:function(editor,actJson,editorJson,ele,status){var pageId=Layout.Page.container,curConObj=ZPFeeds.getCurrentViewContainer(actJson.actRecId),attachCnt=parseInt(pageId.find("#hrcAttchedFiles").attr("attachcnt")),content=ZPFeeds.getSmileysAndMentions(ZPFeeds.COMMENTEDITOR.getContent(),ZPeople.isSearchAllowed);content=ZPFeeds.removeTrailingEmptyDivs(content);var messageText=ZPFeeds.getTextContent(content);if((0===messageText.length&&0===$("<div>").append(content).find("img").length||messageText.length>5e3)&&0==attachCnt)messageText.length>5e3?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.commentlengthwarning")):0===messageText.length&&ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.emptycomment")),pageId.find("#replysubmitbtn").removeAttr("selectedids"),pageId.find("#replysubmitbtn").find("button").prop("disabled",!1),ZPFeeds.Editor.getfocusOnEditor(ZPFeeds.COMMENTEDITOR,!1);else if(""!==editorJson.messgeTxt){var params={type:"HrCase",fdk:actJson.fdk,callBack:HRCaseAction.afterSubmitReply,content:editorJson.content,messageText:editorJson.messgeTxt,curConObj:curConObj,attachCnt:attachCnt,actRecId:actJson.actRecId};status&&(params.btnType=status),pageId.find("#hrcAttchedFiles").find("[type = 'file']").length>0&&(params.isNewUI=!0),ZPFeeds.postAction(params,!1),pageId.find("#replysubmitbtn").find("button").prop("disabled",!0)}else pageId.find("#replysubmitbtn").removeAttr("selectedids"),pageId.find("#replysubmitbtn").find("button").prop("disabled",!1),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.emptycomment")),ZPFeeds.Editor.getfocusOnEditor(ZPFeeds.COMMENTEDITOR,!1)},afterSubmitReply:function(data,params){var pageId=Layout.Page.container;if("string"==typeof data&&(data=JSON.parse(data)),200==data.code){ZPFeeds.Editor.editorList["cmt_editordiv_"+params.fdk].setContent("");var _hrcasefeedcomment=HRCase.DetailedView.caseObj.HRCaseFeedComment,commentObj=data.commentObj;for(var i in commentObj){var comActObj=new People.Comment(new Comment(commentObj[i]),!0),comment={},commbyinfo={};comment.commentId=comActObj.commentId,comment.content=comActObj.content,comment.commat=comActObj.commat,comment.isSysComment=!comActObj.isDelete,commbyinfo.zuid=comActObj.commentOwnDtl.id,commbyinfo.employeePhoto=comActObj.commentOwnDtl.avatar,commbyinfo.name=comActObj.commentOwnDtl.name,commbyinfo.empid=comActObj.commentOwnDtl.empid,comment.commbyinfo=commbyinfo,comment.isDelete=comActObj.isDelete;var _content=ZPFeeds.Activity.validateContent(comActObj.content,!1,_hrcasefeedcomment.departmentDts,_hrcasefeedcomment.groupDts),_cmnthtm=HRCaseData.singleCaseComment(comment,_content);pageId.find("#zrhrcv_comments").append($(_cmnthtm))}if(HRCaseAction.convertSmileys(),params.btnType&&pageId.find("#replysubmitbtn").removeAttr("selectedids"),pageId.find("#replysubmitbtn").find("button").prop("disabled",!1),HRCaseAction.scrollToBottom(),data.hasOwnProperty("permittedCaseStatus")){var newStatus=params.btnType;HRCase.DetailedView.permittedCaseStatus=data.permittedCaseStatus,HRCaseAction.selectCaseStatus(data.commentObj[0].actRecId,newStatus,data.isAgent,data.permittedCaseStatus),pageId.find("#cStatus").find("#caseStatusInp").val(HRCase.getStatusName(newStatus)),pageId.find("#cStatus").find("#caseStatusInp").attr("selectedids",newStatus)}HRCaseAction.shareFAQClick(),data.hasOwnProperty("sla")&&SLA.showSLABand(data.sla)}else data.hasOwnProperty("desc")?ZPeople.Message.showFailureMsg(data.desc):ZPeople.Message.showFailureMsg(data.error),pageId.find("#replysubmitbtn").find("button").prop("disabled",!1)},shareFAQClick:function(){Layout.Page.container.find("#zrhrcv_comments").find("[name^=sharefaq]").off("click").on("click",function(e){var arr=$(this).attr("name").split("sharefaq");FAQ.searchFAQ(arr[1])})},removeRecentInteractions:function(){var pageId=Layout.Page.container;pageId.find("#hrcase_recenttasktab").find("li[tabtype=0]").remove(),pageId.find("#hrcase_recentlist").remove(),pageId.find("#hrcase_addtasklist").removeClass("zp_dyn"),pageId.find("#hrcase_recenttasktab").find("li[tabtype=1]").addClass("single active")},removeHRCaseTask:function(){var pageId=Layout.Page.container;pageId.find("#hrcase_recenttasktab").find("li[tabtype=1]").addClass("zp_dyn"),pageId.find("#hrcase_addtasklist").addClass("zp_dyn"),pageId.find("#hrcase_recenttasktab").removeClass("zp_dyn"),pageId.find("#hrcase_recenttasktab").find("li[tabtype=0]").addClass("single active")},enableHRCaseTask:function(){var pageId=Layout.Page.container;pageId.find("#hrcase_recenttasktab").find("li[tabtype=0]").removeClass("single"),pageId.find("#hrcase_recenttasktab").find("li[tabtype=1]").removeClass("zp_dyn"),pageId.find("#hrcase_addtasklist").addClass("zp_dyn"),pageId.find("#hrcase_recenttasktab").removeClass("zp_dyn")},notesEditor:function(caseid){var pageId=Layout.Page.container,actJson={divId:"zp_notesEditor",subBtnId:"notessubmitbtn",parentCon:"editor_container",isActivity:!1,isavatarnded:!1,isTitleNeeded:!1,placeholder:""};actJson.actRecId=caseid,Layout.Page.container.find("#casenote_cont").append(ZPFeeds.Editor.getEditorContainer(actJson));var zp_notesEditor=ZPFeeds.Editor.getEditor("zp_notesEditor","Status");ZPFeeds.Editor.getfocusOnEditor(zp_notesEditor,!1),pageId.find("#casenote_cont").find(".zp-fd-composeActions").remove()},setCVSubmitOption:function(obj,editor,actJson,fdk,ele){var permittedCaseStatus=HRCase.DetailedView.permittedCaseStatus,dropdownList=[];$.each(permittedCaseStatus,function(key,value){var param1={id:value.systemValue};param1.value=ZPI18N.getString("zp.submitas",[value.optionValue]),dropdownList.push(param1)}),$(obj).zparrowmenu({id:"submitOption",data:dropdownList,search:!1,width:200,callback:function(Obj1,initObj){var status=$(Obj1).attr("id"),_replyEditor=ZPFeeds.Editor.editorList["cmt_editordiv_"+fdk];HRCaseAction.submitReply(editor,actJson,ZPFeeds.getContentJson(_replyEditor,actJson),ele,status)}})},editNote:function(){Layout.Page.container;var editor=ZPFeeds.Editor.editorList.zp_noteEditor,description="";void 0!=editor&&(description=ZPFeeds.getSmileysAndMentions(editor.getContent(),!1));var noteJson={text:description,recordId:Layout.Page.childUrlParam.caseid,formID:ZPForm.CURRFORM_PARAM.formId,module_type:10},params={method:"addNote",conreqcsr:csrfToken,addNoteJson:JSON.stringify(noteJson)};ZPeople.Request.send("/addNote.zp",params,function(data){"success"==data.status&&ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.noteseditmsg"))})},fetchNotes:function(noteId){var pageId=Layout.Page.container,params={method:"fetchNotes",conreqcsr:csrfToken,noteId:noteId,recordId:Layout.Page.childUrlParam.caseid,module_type:10};ZPeople.Request.send("/fetchNotes.zp",params,function(data){$.each(data,function(index,value){""!=value.text&&pageId.find("#zp_noteEditor iframe").contents().find("body").html(value.text)})})},addNotes:function(recordId,isEdit){Layout.Page.container;var editor=ZPFeeds.Editor.editorList.zp_noteEditor,description="";void 0!=editor&&(description=ZPFeeds.getSmileysAndMentions(editor.getContent(),!1));var noteJson={text:description,recordId:recordId,formID:ZPForm.CURRFORM_PARAM.formId,module_type:10},params={method:"addNote",conreqcsr:csrfToken,addNoteJson:JSON.stringify(noteJson)};ZPeople.Request.send("/addNote.zp",params,function(data){"success"==data.status&&(isEdit?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.noteseditmsg")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.notessuccessmsg")))})},scrollToBottom:function(){Layout.Page.container.find("#zrhrcv_comments").parent().animate({scrollTop:$("#zrhrcv_comments").parent().prop("scrollHeight")},0)},taskDetail:function(event){var taskid=event.currentTarget.getAttribute("taskid");ZPForm.CURRFORM_PARAM.formId,ZPForm.CURRFORM_PARAM.recordId;if("hrcase_taskdel"==event.target.id){Task.getTaskFormid();var params={mode:"deleteRecords",recordIds:taskid=taskid||event.target.parentNode.getAttribute("taskid"),formId:Task.taskformid};ZPeople.Request.send(ZPForm.URL,params,HRCaseAction.afterTaskDelete)}else if("hrcase_taskcomp"==event.target.id)HRCaseAction.changeTaskStatus(event.target);else{var uri=window.location.origin+window.location.pathname;uri+="#task/alltask/viewtask-taskid:"+taskid,window.open(uri)}},afterTaskDelete:function(data,params){var pageId=Layout.Page.container;if(7e3===data.code){Layout.Page.hash;if(pageId.find("[taskid="+params.recordIds+"]").remove(),ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.taskdeletedsuccessfully")),pageId.find("#hrcase_addtasklist").children().length<=0){var _noData=HRCaseData.noDataFound("No Data Found");pageId.find("#hrcase_addtasklist").html(_noData)}}},showPrevOrNxt:function(type,caseid){var _caseUrl=HRCaseAction.getCaseViewURL();if(0==type){var prevCse=$("[caseid="+caseid+"]").prev();if(prevCse.length>0){var _prevCaseId=prevCse.attr("caseid");_prevCaseId&&(_caseUrl?window.location.href=_caseUrl+"view-caseid:"+_prevCaseId:HRCase.DetailedView.newviewCaseDetails(_prevCaseId))}}else if(1==type){var nextCse=$("[caseid="+caseid+"]").next();if(nextCse.length>0){var _nextCaseId=nextCse.attr("caseid");_nextCaseId&&(_caseUrl?window.location.href=_caseUrl+"view-caseid:"+_nextCaseId:HRCase.DetailedView.newviewCaseDetails(_nextCaseId))}else _caseUrl&&HRCase.SearchFilter.searchHrcase()}},getCaseViewURL:function(){var url=Layout.Page.hash;return-1!==url.indexOf("#hrcase/myrequest/")||-1!==url.indexOf("#selfservice/cases/list")?"#hrcase/myrequest/":-1!==url.indexOf("#hrcase/allcases/")?"#hrcase/allcases/":-1!==url.indexOf("#hrcase/watchlist/")?"#hrcase/watchlist/":-1!==url.indexOf("#hrcase/escalation/")?"#hrcase/escalation/":-1!==url.indexOf("#hrcase/unassigned/")?"#hrcase/unassigned/":-1!==url.indexOf("#hrcase/opencases/")?"#hrcase/opencases/":-1!==url.indexOf("#hrcase/list/")||-1!==url.indexOf("#selfservice/mycases/list")?"#hrcase/list/":void 0},setTaskListHeight:function(tabtype){var pageId=Layout.Page.container,_docHgt=pageId.find("#caserightinfo").outerHeight(),_reqInfoHgt=pageId.find("#zphrc_vreqd").outerHeight(),_recOwnerInfoHgt=pageId.find("#zphrc_vownerd").outerHeight(),_totalHgt=_docHgt-(_reqInfoHgt+pageId.find("#hrcasev_cspa").outerHeight()+pageId.find("#hrcase_recenttasktab").outerHeight()+pageId.find("#zphr_vctlft").parent().outerHeight()+_recOwnerInfoHgt);"1"==tabtype?pageId.find("#hrcase_addtasklist").height(_totalHgt):pageId.find("#hrcase_recentlist").height(_totalHgt)},handleCommentResponse:function(data,params){var pageId=Layout.Page.container;if("string"==typeof data&&(data=JSON.parse(data)),400===data.code)ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.unabletoprocess")),ZPFeeds.Editor.getfocusOnEditor(ZPFeeds.COMMENTEDITOR,!1);else if(void 0!==data.commentObj&&data.commentObj.length>0){HRCaseFile.editorEmpty();var comment={},tempCmntObj=data.commentObj[0],comActObj=new People.Comment(new Comment(tempCmntObj),!0),commbyinfo={};comment.commentId=tempCmntObj.commentId,comment.content=tempCmntObj.contents,comment.commat=tempCmntObj.at,comment.isSysComment=!comActObj.isDelete,commbyinfo.zuid=comActObj.commentOwnDtl.id,commbyinfo.employeePhoto=comActObj.commentOwnDtl.avatar,commbyinfo.name=comActObj.commentOwnDtl.name,commbyinfo.empid=comActObj.commentOwnDtl.empid,comment.commbyinfo=commbyinfo;var _content=ZPFeeds.Activity.validateContent(tempCmntObj.contents,!1,null,null),attachIdsList=tempCmntObj["ap.attachIds"];void 0!==attachIdsList&&(comment.cmtattObj=HRCaseFile.getAttachContent(attachIdsList,tempCmntObj.actRecId,tempCmntObj.commentId,"HrCase"));var _cmnthtm=HRCaseData.singleCaseComment(comment,_content);pageId.find("#zrhrcv_comments").append($(_cmnthtm)),pageId.find(".cboxElement").off("click").on("click",function(event){ZPFeeds.registerAttPreview(event,this,tempCmntObj.actRecId)}),HRCaseAction.convertSmileys(),HRCaseAction.scrollToBottom()}},cancelStatusCallBack:function(data,oldStatusId,newstatusId,newstatusName,caseId){var pageId=Layout.Page.container;HRCase.DetailedView.MORE_OPTION=jQuery.grep(HRCase.DetailedView.MORE_OPTION,function(value){return"cancelCase"!=value.id}),0==HRCase.DetailedView.MORE_OPTION.length&&pageId.find("#hrcasev_moreopt").remove(),pageId.find("#caseStatusInp").zpselect({selectedVal:[{id:newstatusId,text:newstatusName}]}),newstatusId==HRCase.CANCELLED_SID&&HRCaseAction.rightActionDisableOnStatus(newstatusId);var _hrcasefeedcomment=HRCase.DetailedView.caseObj.HRCaseFeedComment,_content=ZPFeeds.Activity.validateContent(data.content,!1,_hrcasefeedcomment.departmentDts,_hrcasefeedcomment.groupDts),_comment=HRCaseAction.constructCmntObj(data);_comment.isSysComment=!0;var _cmnthtm=HRCaseData.singleCaseComment(_comment,_content);pageId.find("#zrhrcv_comments").append($(_cmnthtm)),HRCaseAction.shareFAQClick(),HRCaseAction.scrollToBottom()},addQuickTask:function(status){var params={},pageId=Layout.Page.container,_dateExpression=new RegExp("^([0-9]){2,4}[- /.]([0-9a-zA-Z]){2,3}[- /.]([0-9]){2,4}$");params.zp_formId=ZPForm.CURRFORM_PARAM.formId,params.zp_recordId=ZPForm.CURRFORM_PARAM.recordId,params.conreqcsr=csrfToken,params.taskname=pageId.find("#quicktaskname").val(),params.dueDate=pageId.find("#quicktaskdue").text(),params.taskowner=pageId.find("#tUser").attr("ownervalueid"),params.method="addQuickTask",""!==params.taskname?_dateExpression.test(params.dueDate.trim())?(void 0!==status&&(Task.getStatusOptionValuesBySysVal(),params.status=ZPeople.decodeTxt(Task.statusBySysVal[status].VALUE)),$.post("/addQuickTask.zp",params,function(data){if(void 0!==data.taskid&&null!==data.taskid&&""!==data.taskid){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.taskadded"));var taskList=[],taskJson={};taskJson.id=data.taskid,taskJson.name=ZPeople.escapeHtml(params.taskname),taskJson.endtime=params.dueDate,taskJson.isDeletable=!0,taskJson.assignedto=pageId.find("#tUser").parent().text();var taskownerdetail={};taskownerdetail.erecno=params.taskowner,taskownerdetail.employeePhoto=pageId.find("#tUser").find("img").attr("src"),taskJson.taskownerdetail=taskownerdetail,taskList.push(taskJson);var taskHtm=HRCaseData.taskListCons(taskList);pageId.find("#zpcv_nodatadiv").length>0?(pageId.find("#hrcase_addtasklist").empty(),pageId.find("#hrcase_addtasklist").append($(taskHtm))):($(taskHtm).insertAfter(pageId.find("#quickTask")),HRCaseAction.cancelQuickTask()),pageId.find("#hrcase_addtasklist > div").on("click",function(event){event.stopPropagation(),HRCaseAction.taskDetail(event)})}else ZPeople.Message.showFailureMsg(data.errors)})):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.taskdatavalidate")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.tasknameerromsg"))},cancelQuickTask:function(){Layout.Page.container.find("#quickTask").remove()},changeTaskStatus:function(Obj){var status=$(Obj).parent().hasClass("cmpl")?Task.OPEN_SYSVALUE:Task.COMPLETED_SYSVALUE,params={taskid:$(Obj).parent().attr("taskid"),method:"changeTaskStatus",status:status,conreqcsr:csrfToken};$.post("/changeTasksStatus.zp",params,function(data){if("success"==data.Status){var successmsg=status==Task.OPEN_SYSVALUE?ZPI18N.getString("zp.taskreopenedsuccess"):ZPI18N.getString("zp.taskcompletedsuccess");status==Task.OPEN_SYSVALUE?$(Obj).parent().removeClass("cmpl"):$(Obj).parent().addClass("cmpl"),ZPeople.Message.showSuccessMsg(successmsg)}})},getRecentIntractionsList:function(newIndex,newJSONObject,caseid){var params,pageId=Layout.Page.container;params={method:"allHrCases",myCasesJson:JSON.stringify(newJSONObject),conreqcsr:csrfToken},$.ajax({url:"/allHrCases.zp",type:POST,data:params,async:!1,success:function(data){var _htm=HRCaseData.recentInteraticonList(data,caseid);""!=_htm?(pageId.find("#hrcase_recentlist").empty().append($(_htm)),pageId.find("#hrcase_recentlist div").off("click").on("click",function(){var _caseid=$(this).attr("rel"),uri=window.location.origin+window.location.pathname;uri+="#hrcase/allcases/view-caseid:"+_caseid,window.open(uri)})):HRCaseAction.removeRecentInteractions()}})}},HRCaseFile={createInput:function(isComment,containerId){var pageId=Layout.Page.container,_newAttachCnt=parseInt(pageId.find("#hrcAttchedFiles").attr("attachcnt"))+1;0===pageId.find("#zp_attchments_"+_newAttachCnt).length?(pageId.find("#hrcAttchedFiles").append($('<input type="file" class="zp_dyn" id="zp_attchments_'+_newAttachCnt+'" type="file" attachcnt="'+_newAttachCnt+'" name="file_upload_'+_newAttachCnt+'" >').on("change",function(){var file=this.files[0];if(void 0!==file&&file.size>0&&file.size<5242880){file.type.split("/")[1];var _filePre=HRCaseFile.getFileBoxOnSelect(file);pageId.find("#hrcAttchedFiles").append(_filePre),pageId.find("#hrcAttchedFiles").attr("attachcnt",_newAttachCnt)}else 0===file.size?ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.emptyfilewarning")):ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.feedfilesizewarning"))})),pageId.find("#zp_attchments_"+_newAttachCnt).trigger("click")):pageId.find("#zp_attchments_"+_newAttachCnt).trigger("click")},getFileBoxOnSelect:function(file){var fileExtn=file.name.substring(file.name.lastIndexOf(".")+1),fileIcon=CommonTemplates.getFileIcon(fileExtn),fileSize=void 0!=file.size?CommonTemplates.getFileSize(file.size):"",fileName=file.name;return'<div class="attachedFile filePosts"><i class="'+fileIcon+' fileType"></i><i  onclick="HRCaseFile.removeFileDiv(this)" class="IC-cls"></i><div class="fileNameAndSize"><label class="fileName" purpose="fileName">'+ZPeople.escapeHtml(fileName)+'</label><span purpose="fileSize">'+fileSize+"</span></div></div>"},removeFileDiv:function(obj){var pageId=Layout.Page.container;$(obj).closest("div.attachedFile").prev().remove(),CommonTemplates.removeFileDiv(obj);parseInt(pageId.find("#hrcAttchedFiles").attr("attachcnt"));if(0===pageId.find("#hrcAttchedFiles").find("[type=file]").length)pageId.find("#hrcAttchedFiles").attr("attachcnt","0");else{pageId.find("#hrcAttchedFiles").attr("attachcnt",parseInt(pageId.find("#hrcAttchedFiles").attr("attachcnt"))-1);pageId.find("#hrcAttchedFiles"),pageId.find("#hrcAttchedFiles").find("[type=file]");var curAttCnt=1;pageId.find("#hrcAttchedFiles").find("[type=file]").each(function(index){$(this).attr("id","zp_attchments_"+curAttCnt),$(this).attr("name","file_upload_"+curAttCnt),$(this).attr("attachcnt",curAttCnt),curAttCnt++})}},getAttachContent:function(attachArr,statusId,commentId,type){var extn,attachObj={},fileContent="",fileCnt=0,viewUrl=null;if(void 0!==attachArr&&attachArr.length>0){fileContent+='<div class="clearfix">';for(var attCnt=0;attCnt<attachArr.length;attCnt++){extn=-1!==(extn=attachArr[attCnt].fileExtn).indexOf("image/")?extn.split("/")[1]:extn;var n=attachArr[attCnt].fileName.lastIndexOf("."),res=attachArr[attCnt].fileName.substring(n+1);viewUrl=ZPFeeds.Activity.getFileViewUrl(res,attachArr[attCnt].downloadFileId,"HrCase",statusId);var fileicon=CommonTemplates.getFileIcon(res),downloadUrl=attachArr[attCnt].downloadFileId,fSize=attachArr[attCnt].fileSize,fileSize=-1!=fSize.indexOf("KB")||-1!=fSize.indexOf("MB")||-1!=fSize.indexOf("GB")||-1!=fSize.indexOf("TB")?fSize:HRCaseFile.covertBytesFileSize(attachArr[attCnt].fileSize);void 0!==downloadUrl&&(downloadUrl="/people/downloadAttachment?recId="+statusId+"&fileId="+downloadUrl+"&acttype=HrCase"),fileContent+='<div class="attachedFile filePosts"><div class="fileInfo cboxElement" title="'+attachArr[attCnt].fileName+'" rel="'+(void 0===commentId?statusId:commentId)+'" downloadUrl="'+downloadUrl+'" file=true viewUrl="'+viewUrl+'"><i class="'+fileicon+' fileType"></i><div class="fileNameAndSize"><label class="fileName CP" purpose="fileName">'+attachArr[attCnt].fileName+'</label><span class="CP" purpose="fileSize">'+fileSize+'</span></div></div><span><a href="'+downloadUrl+'"><i class="IC-imprt filedwn"></i></a></span></div>',fileCnt++}return fileContent+="</div>",attachObj.filecontent=void 0,0!==fileCnt&&(attachObj.filecontent=fileContent),attachObj}},editorEmpty:function(){Layout.Page.container.find("#hrcAttchedFiles").empty().attr("attachcnt","0"),ZPFeeds.COMMENTEDITOR.setContent("")},covertBytesFileSize:function(size){var i=Math.floor(Math.log(size)/Math.log(1024));return 1*(size/Math.pow(1024,i)).toFixed(2)+" "+["kB","MB","GB","TB"][i]}},HRCaseData={casecard:function(caseInfo){var _htm='<div class="zp_cVmn">';return _htm+='<div class="ZP_photo pc5"  empid="'+caseInfo.requestor.zuid+'" popup="user"><img src="'+caseInfo.requestor.employeePhoto+'" alt="'+caseInfo.requestor.name+'"></div>',_htm+='<div class="zp_cVtmD">'+ZPDateTime.getDateDisplayFormat(caseInfo.createdTime)+"</div>",_htm+='<div class="zp_usnmdv"><span>'+caseInfo.requestor.empid+'</span><p  empid="'+caseInfo.requestor.zuid+'" popup="user">'+caseInfo.requestor.name+"</p></div>",_htm+="<p>"+caseInfo.subject+"</p>",_htm+="<p>"+ZPFeeds.Activity.getSmileys(caseInfo.description)+"</p>",_htm+='<div class="zp_attach" id="caseAttch"><div class="zp_pshead">'+ZPI18N.getString("zp.attachment")+'</div><div id="filesAttch" class="zp_Alst clearfix"></div></div>',_htm+="</div>"},casecmntconstruction:function(hrCaseFeedCmnt){var _htm="",comments=hrCaseFeedCmnt.comments;for(var i in comments){var tempCmntObj=comments[i],content=ZPFeeds.Activity.validateContent(tempCmntObj.content,!1,hrCaseFeedCmnt.departmentDts,hrCaseFeedCmnt.groupDts),attachIdsList=tempCmntObj.cmtattList;void 0!==attachIdsList&&attachIdsList.length>0&&(comments[i].cmtattObj=HRCaseFile.getAttachContent(attachIdsList,tempCmntObj.actRecId,tempCmntObj.commentId,"HrCase")),tempCmntObj.hasOwnProperty("commbyinfo")&&(comments[i].commbyinfo.name=tempCmntObj.commbyinfo.name),_htm+=HRCaseData.singleCaseComment(comments[i],content)}return _htm},singleCaseComment:function(comment,content){var _htm="";if($("<div>"+content+"</div>").find("[name=postFeedback]").length>0)_htm="";else{var isEscSysComment=comment.hasOwnProperty("isEscSysComment"),isSysComment=comment.hasOwnProperty("isSysComment"),isDeletedComment=comment.hasOwnProperty("isDeletedComment")&&comment.isDeletedComment,_autoCls=isSysComment&&comment.isSysComment||isEscSysComment&&comment.isEscSysComment?"zp_cVmn zp_AtMd":"zp_cVmn";_autoCls=isDeletedComment?"zp_cVmn zp_vVdlM":_autoCls,_cmtID=isDeletedComment?"":'rel="'+comment.commentId+'"',_htm='<div class="'+_autoCls+'" '+_cmtID+">",_htm+=isEscSysComment?'<div class="ZP_photo"><i class="IC-Setting-02"></i></div>':'<div class="ZP_photo pc5" empid="'+comment.commbyinfo.zuid+'" popup="user"> <img src="'+comment.commbyinfo.employeePhoto+'" alt="'+comment.commbyinfo.name+'"> </div>',_htm+='<div class="zp_cVtmD">'+ZPDateTime.getDateDisplayFormat(comment.commat)+"</div>",isDeletedComment||(comment.hasOwnProperty("isDelete")&&comment.isDelete&&(_htm+='<a class="zp_cVdL" onclick="HRCase.DetailedView.deleteComment(this)"><i class="IC-delete-1px"></i></a>'),isEscSysComment||(_htm+='<div class="zp_usnmdv"> <span>'+comment.commbyinfo.empid+'</span> <p  empid="'+comment.commbyinfo.zuid+'" popup="user">'+comment.commbyinfo.name+"</p> </div>")),_htm+="<p>"+content+"</p>",isDeletedComment||comment.hasOwnProperty("cmtattObj")&&void 0!=comment.cmtattObj&&comment.cmtattObj.hasOwnProperty("filecontent")&&void 0!=comment.cmtattObj.filecontent&&(_htm+='<div class="zp_attach" id="commentAttch_"'+comment.commentId+'><div class="zp_pshead">'+ZPI18N.getString("zp.attachment")+'</div><div class="zp_Alst clearfix">'+comment.cmtattObj.filecontent+"</div></div>"),_htm+="</div>"}return _htm},cvRequestorInfo:function(requestorInfo){var _htm="<li>";_htm+="<em>"+ZPI18N.getString("zp.requestor")+'</em> <div class="zpTm-img FL" popup="user" empid="'+requestorInfo.zuid+'" ><img src="'+requestorInfo.employeePhoto+'" class="Usrimg"> </div>',_htm+="<a>",_htm+='<div class="zpTmDt"><span class="DB zpTMname blk"  popup="user" empid="'+requestorInfo.zuid+'" ><span class="usrEmpID">'+requestorInfo.empid+"&nbsp;-&nbsp;</span>"+requestorInfo.name+"</span>";var userDtls=ZPeople.getUserDetailsById(requestorInfo.erecno);if(""==userDtls.extension&&""==userDtls.mobile)_htm+='<span class="sse-mn eml"> <i class="IC-email" data-toggle="tooltip" data-placement="right" data-original-title="'+requestorInfo.employeeEmailAlias+'"></i>'+requestorInfo.employeeEmailAlias+"</span>";else{var _extn=userDtls.extension&&""!=userDtls.extension?userDtls.extension:"----";_htm+='<span class="sse-mn"><i class="IC-ext-1px"></i>'+ZPeople.escapeHtml(_extn)+"</span>",_htm+='<span class="sse-mn"><i class="IC-mobile-1px"></i>'+(userDtls.mobile&&""!=userDtls.mobile?userDtls.mobile:"----- -----")+"</span>"}return _htm+="</div>",requestorInfo.erecno!=erecno&&(_htm+='<div class="zptm-hover"> <span class="TM-chat"><i class="CR-cmsg S17" uid="'+requestorInfo.zuid+'" ischat="true" onclick="ZPeople.initUserChat(event, '+requestorInfo.zuid+')"><i class="path1"></i><i class="path2"></i></i></span> </div>'),_htm+="</a> </li>"},cvRecordOwnerInfo:function(recordOwnerInfo){var _htm="<li>";_htm+="<em>"+ZPI18N.getString("zp.casecreatedby")+'</em> <div class="zpTm-img FL" popup="user" empid="'+recordOwnerInfo.zuid+'" ><img src="'+recordOwnerInfo.employeePhoto+'" class="Usrimg"> </div>',_htm+="<a>",_htm+='<div class="zpTmDt"><span class="DB zpTMname blk"  popup="user" empid="'+recordOwnerInfo.zuid+'" ><span class="usrEmpID">'+recordOwnerInfo.empid+"&nbsp;-&nbsp;</span>"+recordOwnerInfo.name+"</span>";var userDtls=ZPeople.getUserDetailsById(recordOwnerInfo.erecno);if(""==userDtls.extension&&""==userDtls.mobile)_htm+='<span class="sse-mn eml"> <i class="IC-email" data-toggle="tooltip" data-placement="right" data-original-title="'+recordOwnerInfo.employeeEmailAlias+'"></i>'+recordOwnerInfo.employeeEmailAlias+"</span>";else{var _extn=userDtls.extension&&""!=userDtls.extension?userDtls.extension:"----";_htm+='<span class="sse-mn"><i class="IC-ext-1px"></i>'+ZPeople.escapeHtml(_extn)+"</span>",_htm+='<span class="sse-mn"><i class="IC-mobile-1px"></i>'+(userDtls.mobile&&""!=userDtls.mobile?userDtls.mobile:"----- -----")+"</span>"}return _htm+="</div>",recordOwnerInfo.erecno!=erecno&&(_htm+='<div class="zptm-hover"> <span class="TM-chat"><i class="CR-cmsg S17" uid="'+recordOwnerInfo.zuid+'" ischat="true" onclick="ZPeople.initUserChat(event, '+recordOwnerInfo.zuid+')"><i class="path1"></i><i class="path2"></i></i></span> </div>'),_htm+="</a> </li>"},singleAgentData:function(agentId,agentName,photoElem){var _htm="<label>"+ZPI18N.getString("zp.agent")+"</label>";return _htm+='<div class="notg AgntDv">',_htm+='<div class="zp_Tg" zpmenu="true">',_htm+=photoElem+""+agentName,_htm+="</div></div>",_htm+='<input id="newAgent" type="hidden" selectedids="'+agentId+'" style="width: 225px;" readonly>'},rightSideSigleData:function(labelName,inputId,inputName,selectedids,icon){var _htm="<label>"+labelName+"</label>";(_htm+='<div class="notg">',icon)&&(_htm+='<div class="zp_Tg" zpmenu="true"><i class="zp_Si '+Icons.getIconClass(icon).iconClass+'"></i>'+inputName+"</div>");return _htm+='<input id="'+inputId+'" type="text" value="'+inputName+'"selectedids="'+selectedids+'" style="width: 225px;" readonly>',_htm+="</div>"},initTaskHtm:function(){var pageId=Layout.Page.container,_htm='<div class="zp_cVsTtl" id="hrcase_recenttasktab"><ul><li class="active" tabtype="0"><span>'+ZPI18N.getString("zp.recentinterations")+'</span></li><li tabtype="1"><i class="IC-plus-round" id="hrcase_addtaskicn"></i><span>'+ZPI18N.getString("zp.tasks")+"</span></li></ul></div>";_htm+='<div class="zp_cVsbx onlyScroll" id="hrcase_recentlist"></div>',_htm+='<div class="zp_cVsbx onlyScroll zp_dyn" id="hrcase_addtasklist"></div>',pageId.find("#hrcasev_cspa").after($(_htm)),pageId.find("#hrcase_recenttasktab  li").off("click").on("click",function(eve){var _tabtype=$(this).attr("tabtype");pageId.find("#hrcase_recenttasktab  li").removeClass("active"),$(this).addClass("active"),"1"==_tabtype?(pageId.find("#hrcase_recentlist").addClass("zp_dyn"),pageId.find("#hrcase_addtasklist").removeClass("zp_dyn")):(pageId.find("#hrcase_recentlist").removeClass("zp_dyn"),pageId.find("#hrcase_addtasklist").addClass("zp_dyn")),HRCaseAction.setTaskListHeight(_tabtype)})},taskListCons:function(taskList){var _htm="";for(var i in taskList){_htm+='<div class="'+(taskList[i].statusSysValue==Task.COMPLETED_SYSVALUE?"zp_cVsbxIn cmpl":"zp_cVsbxIn")+'" taskid="'+taskList[i].id+'">',_htm+='<i class="IC-rou-tik" id="hrcase_taskcomp"></i>',taskList[i].isDeletable&&(_htm+='<i class="IC-delete" id="hrcase_taskdel"></i>'),_htm+="<p>"+taskList[i].name+"</p>",_htm+="<div>",_htm+='<div><div class="ZP_photo pc2" ownervalueid="'+taskList[i].taskownerdetail.erecno+'"><img src="'+taskList[i].taskownerdetail.employeePhoto+'" alt="'+taskList[i].assignedto+'"></div>'+taskList[i].assignedto+"</div>",_htm+='<div class="frty"><i class="IC-clock"></i><p>'+taskList[i].endtime+"</p></div>",_htm+="</div>",_htm+="</div>"}return _htm},caseAttachFAQ:function(actJson){var btnhtml="";if(!0!==actJson.isActivity&&actJson.type===People.HrCase.type){var isAllowedPerm=EditorTemplate.toCheckEditorCustomeBtnPerm(actJson);btnhtml+='<ul class="zp_casesBtn" id="cases_custBtn">',isAllowedPerm.isAgent?btnhtml+='<li id="addfaqbtn"><b title="'+ZPI18N.getString("zp.addfaqbtn")+'"><span>'+ZPI18N.getString("zp.addfaqbtn")+'</span></b></li><li id="attachfaqbtn"><b title="'+ZPI18N.getString("zp.attachfaq")+'"><span>'+ZPI18N.getString("zp.attachfaq")+"</span></b></li>":isAllowedPerm.isEscalatorUser&&(btnhtml+='<li id="attachfaqbtn"><b title="'+ZPI18N.getString("zp.attachfaq")+'"><span>'+ZPI18N.getString("zp.attachfaq")+"</span></b></li>"),btnhtml+="</ul>"}return btnhtml},addTask:function(){var _htm='<div class="zp_cVsbxIn tskCr" id="quickTask"><i class="IC-cls-1px" onclick="HRCaseAction.cancelQuickTask()"></i><input  id="quicktaskname" type="text" placeholder="'+ZPI18N.getString("zp.taskname")+'">';return _htm+='<div><div><div class="ZP_photo pc2" id="tUser" ownervalueid='+erecno+' onclick="HRCaseTaskDropdown.taskUserdropdown(this)"><img src="'+ZPeople.CURR_USER.avatar+'" alt="'+ZPeople.CURR_USER.name+'"></div>'+ZPeople.CURR_USER.name+"</div>",_htm+='<div class="frty"><i class="IC-clock"></i><p id="quicktaskdue" caltype ='+Task.getCalType()+'  onclick="Calendar.setUpCalendar(event,this)">'+ZPI18N.getString("zp.selecttaskdate")+"</p></div></div>",_htm+='<div class="zp_btn text-center" onclick="HRCaseAction.addQuickTask()"> <button class="zpthm">'+ZPI18N.getString("zp.save")+"</button> </div></div>"},recentInteraticonList:function(data,caseid){var _hrcaseList=data.hrcaseList,_htm="";if(_hrcaseList)for(var i in _hrcaseList){var _recordId=_hrcaseList[i].recordId;if(caseid!=_recordId)_htm+='<div class="zp_cVsbxIn" rel="'+_recordId+'"><p>'+_hrcaseList[i].subject+"</p><span>"+_hrcaseList[i].requestedTime+"</span></div>"}return _htm},noDataFound:function(msg){return'<div class="ZPNdata" id="zpcv_nodatadiv"> <div><label><h3>'+msg+"</h3></label></div></div>"}};var HRCaseTaskDropdown={taskUserdropdown:function(obj){Task.addPerm!=zpconst.Permission.NO_DATA&&Task.addPerm!=zpconst.Permission.MY_DATA&&$(obj).zparrowmenu({id:"taskUserList",data:function(initObj){return EmployeeDropdown.getEmpList($(initObj).val(),"emp","TASKS")},callback:HRCaseTaskDropdown.updateTaskUser})},updateTaskUser:function(obj,initObj){Layout.Page.container;var result=$(obj).find("img"),ownervalueId=$(obj).attr("id");$(initObj).attr("ownervalueid",ownervalueId),$(initObj).find("img").replaceWith(result),$(initObj).parent().contents().last().replaceWith($(obj).text())}},Delegation={DELEGATION_URL:"/delegationAction.zp",DELEGATION_JSON:[],DELEGATION_TYPE:{temporary:1,permanent:2},addDelegationForm:function(){ZPeople.Request.send(Delegation.DELEGATION_URL,{method:"addDelegationForm",conreqcsr:csrfToken})},initPage:function(){var url=Layout.Page.hash;url==Delegation.getDelegationUrl("list")?Delegation.View.fecthDelegationList():url==Delegation.getDelegationUrl("edit",Layout.Page.childUrlParam.delegationid)?Delegation.Edit.getSingleRecord("edit"):url==Delegation.getDelegationUrl("add")?Delegation.Modal.openDelegSlide():url==Delegation.getDelegationUrl("view",Layout.Page.childUrlParam.delegationid)?Delegation.Edit.getSingleRecord("view"):($("#"+Layout.Page.pageId).find("#delegationPage .btn").removeAttr("onclick"),$("#"+Layout.Page.pageId).children().addClass("DN"),$("#"+Layout.Page.pageId).append('<div class="profileLft zc-componentBg mt7"><div class="pad20" id="errorDiv"><div class="P20 text-center"><div class="row"><div class="dvNomsg"><div class="PAdms"></div><p class="PT20 S15">'+ZPI18N.getString("zp.securityaccesserr")+"</p></div></div></div></div></div>"))},showPageLoading:function(divToHide,parentDiv){divToHide.addClass("DN"),parentDiv.append(ZPeople.LOADING_HTML)},hidePageLoading:function(divToShow,parentDiv){divToShow.removeClass("DN"),parentDiv.find("#zp_page_loading").remove()},getSelfServiceErecno:function(){if(-1!==Layout.Page.currentmode.indexOf("selfservice/delegation"))return SelfService.getUserId()},getDelegationUrl:function(mode,delegationId){var selfServiceErecno=Delegation.getSelfServiceErecno();if(selfServiceErecno){var urlParam=selfServiceErecno!=erecno?"-id:"+selfServiceErecno:"";return"#selfservice/delegation/"+mode+urlParam+(delegationId?(""!=urlParam?"/":"-")+"delegationid:"+delegationId:"")}if(isadmin)return"#admin/organization/delegation/"+mode+(delegationId?"-delegationid:"+delegationId:"")},failureCallBack:function(failureData,params){params&&"addUpdateDelegation"==params.method&&$("#"+Layout.Page.pageId).find("#delegModal").find(".modal-footer .btn-primary").attr("disabled",!1),failureData.hasOwnProperty("responseJSON")&&failureData.responseJSON.hasOwnProperty("error")&&failureData.responseJSON.error.trim().length>0&&ZPeople.Message.showFailureMsg(failureData.responseJSON.error)}};Delegation.View={createDeleg:function(){Delegation.Modal.openDelegSlide()},fecthDelegationList:function(){if(!($("#"+Layout.Page.pageId).find("#delegTable tbody").find("tr").length>0)){var pageDiv=$("#"+Layout.Page.pageId).find("#delegationPage");Delegation.showPageLoading(pageDiv.find(".ZPTscrlcont"),pageDiv),isadmin||SelfService.Info.allow_add_delegation||pageDiv.find(".mainhead .btn.btn-primary").addClass("DN"),ZPeople.Request.send(Delegation.DELEGATION_URL,{method:"list",erecno:Delegation.getSelfServiceErecno(),conreqcsr:csrfToken},Delegation.View.constructDelgPage)}},constructDelgPage:function(delegList){if(void 0!=delegList){if($("#"+Layout.Page.pageId).find("#zp_page_loading").remove(),Delegation.DELEGATION_JSON=delegList,Delegation.DELEGATION_JSON.length<1)return $("#"+Layout.Page.pageId).find("#delegationPage").append(CommonTemplates.noDataSVG("delegationPage",!0,ZPI18N.getString("zp.nodelegationmsg"),!1)),void $("#"+Layout.Page.pageId).find("#delegationPage .mainhead").addClass("ndat");var tableBody=$("#"+Layout.Page.pageId).find("#delegTable tbody");$.each(delegList,function(i,singleDeleg){var tableRow=Delegation.View.constructDelgRow(singleDeleg);tableBody.append(tableRow)}),Delegation.View.addClickEvent(tableBody);var pageDiv=$("#"+Layout.Page.pageId).find("#delegationPage");Delegation.hidePageLoading(pageDiv.find(".ZPTscrlcont"),pageDiv)}},constructDelgRow:function(singleDeleg){return'<tr class="ZPLRow" delegationid="'+singleDeleg.delegationId+'">'+Delegation.View.constructDelgData(singleDeleg)+"</tr>"},addClickEvent:function(tableBody){tableBody.find("tr td div .IC-pen").on("click",function(e){e.stopPropagation(),e.preventDefault(),Delegation.Edit.getSingleRecord("edit",$(this).closest("tr").attr("delegationid"))}),tableBody.find("tr td div .IC-delete").on("click",function(e){e.stopPropagation(),e.preventDefault(),Delegation.Delete.deleteRecord($(this).closest("tr").attr("delegationid"))}),tableBody.find("tr").on("click",function(){Delegation.Edit.getSingleRecord("view",$(this).closest("tr").attr("delegationid"))})},constructDelgData:function(singleDeleg){singleDeleg.delegationId;var singleDelgtr='<td class="PL0I text-center over-display"></td>';return singleDelgtr+=this.constructEmpData(singleDeleg.employeeDtls),singleDelgtr+=this.constructEmpData(singleDeleg.delegateeDtls),singleDeleg.TypeOfDelegation==Delegation.DELEGATION_TYPE.temporary?(singleDelgtr+="<td>"+ZPI18N.getString("zp.temporary")+"</td>",singleDelgtr+='<td><div class="FL">'+singleDeleg.From+'<span class="dgry ML2 MR2">-</span>'+singleDeleg.To+"</div></td>"):(singleDelgtr+="<td>"+ZPI18N.getString("zp.local.Permanent")+"</td>",singleDelgtr+="<td></td>"),singleDelgtr+="<td><span>"+singleDeleg.Status+"</span></td>",singleDelgtr+='<td class="text-left over-display P0"><div class="dvlist-action">',singleDeleg.hasEditDelPerm&&(singleDeleg.Status!==ZPI18N.getString("zp.leave.compensatory.expired")&&(singleDelgtr+='<a class="IC-pen ZPtitle FL" title="'+ZPI18N.getString("zp.edit")+'" data-original-title="Edit"></a>'),singleDelgtr+='<a class="IC-delete ML15 ZPtitle" title="'+ZPI18N.getString("zp.delete")+'" data-original-title="Delete"></a>'),singleDelgtr+="</div></td>"},constructEmpData:function(empData){var empHTML="<td>";return void 0!=empData&&Object.keys(empData).length>0&&(empHTML+='<img src="'+empData.employeePhoto+'" class="FL ZP_photo" data-toggle="tooltip" data-placement="top" data-original-title="" popup="user" empid="'+empData.zuid+'"><div class="ZPusrName" popup="user" empid="'+empData.zuid+'"><span>',empHTML+=empData.erecno==erecno?ZPI18N.getString("zp.you"):"<b>"+empData.employeeID+"</b>"+ZPeople.decodeTxt(ZPeople.escapeHtml(empData.name))+"</span></div>"),empHTML+"</td>"},getPermissionDeniedData:function(mode){var key="";return key="view"===mode?"zp.deniedtoviewdelegperm":"edit"===mode?"zp.deniedtoeditdelegperm":"delete"===mode?"zp.deniedtodeltdelegperm":"zp.deniedtoadddelegperm",ZPI18N.getString(key)}},Delegation.Menu={getEmpMenuProperty:function(){return{id:"empList",data:function(searchObj){var searchVal=void 0==$(searchObj).val()?"":$(searchObj).val(),delegateeId=$("#delegModal #addEdit").find('[label="Delegatee"] #delegId').attr("selectedIds");return EmployeeDropdown.getEmpList(searchVal,"emp","DELEGATION_EMP",void 0==delegateeId||""==delegateeId?void 0:[delegateeId])}}},getDelegMenuProperty:function(){return{id:"delegList",data:function(searchObj){var delegatorId,defaultVal,searchVal=void 0==$(searchObj).val()?"":$(searchObj).val();return Layout.Page.container.find("#delegModal #addEdit").length>0?delegatorId=Layout.Page.container.find("#delegModal #addEdit").find('[label="Delegator"] #empId').attr("selectedIds"):"P_Employee"==ZPForm.getTableName()&&(delegatorId=ZPForm.CURRFORM_PARAM.recordId,defaultVal=ZPeople.getUserDetailsById(delegatorId).reportingTo),EmployeeDropdown.getEmpList(searchVal,"emp","DELEGATION_DELEGATOR",void 0==delegatorId||""==delegatorId?void 0:[delegatorId],void 0,!1,defaultVal)}}},getDefaultData:function(erecno,name,image){return{id:erecno,text:ZPeople.decodeTxt(ZPeople.escapeHtml(name)),image:image,imageAlt:ZPeople.escapeHtml(CommonTemplates.getAltText(name))}},getSelectDefault:function(erecno,name,image){return{selectedVal:[Delegation.Menu.getDefaultData(erecno,name,image)],isMandatory:!0}}},Delegation.Modal={openDelegSlide:function(mode,response){var delegModalDiv=$("#"+Layout.Page.pageId).find("#delegModal");delegModalDiv.find("#viewErrorModal").remove(),Delegation.showPageLoading(delegModalDiv.find(".modal-dialog .modal-content"),delegModalDiv.find(".modal-dialog")),delegModalDiv.modal("show"),this.resetErrorMsg();if("view"===mode)delegModalDiv.find("#addEdit").addClass("DN"),delegModalDiv.find("#view").removeClass("DN"),delegModalDiv.find(".modal-footer .btn-default").removeClass("DN"),delegModalDiv.find(".modal-footer .btn-primary").addClass("DN"),delegModalDiv.find(".modal-footer .btn-primary").off("click"),Delegation.Modal.constructViewModalBody(response);else if(isadmin||SelfService.Info.allow_add_delegation){delegModalDiv.find(".modal-header .IC-pen").addClass("DN"),delegModalDiv.find("#view").addClass("DN"),delegModalDiv.find("#addEdit").removeClass("DN"),delegModalDiv.find(".modal-footer a").removeClass("DN"),editDelegModalDiv=$("#"+Layout.Page.pageId).find("#delegModal").find("#addEdit"),delegModalDiv.find("#empId").length<1&&CommonTemplates.getSelectMenu(Delegation.Menu.getEmpMenuProperty(),editDelegModalDiv.find("[label=Delegator]"),{id:"empId"},{isMandatory:!0,inputHeaderName:ZPI18N.getString("zp.delegator")}),delegModalDiv.find("#delegId").length<1&&CommonTemplates.getSelectMenu(Delegation.Menu.getDelegMenuProperty(),editDelegModalDiv.find("[label=Delegatee]"),{id:"delegId",placeholder:ZPI18N.getString("zp.delegateeplaceholder")},{isMandatory:!0,inputHeaderName:ZPI18N.getString("zp.delegatee")}),editDelegModalDiv.find('[label="TypeOfDelegation"] label').on("click",function(){var value=$(this).find("input").attr("value");value==Delegation.DELEGATION_TYPE.temporary?($(this).closest(".form-group").removeClass("zp_fmBN"),$(this).siblings('[label="Date"]').collapse("show"),$(this).closest('[label="TypeOfDelegation"]').find("[label='FromTo']").val("")):value==Delegation.DELEGATION_TYPE.permanent&&($(this).siblings('[label="Date"]').collapse("hide"),$(this).closest(".form-group").addClass("zp_fmBN"),$(this).siblings('[label="Date"]').hasClass("collapsing")||$(this).siblings('[label="Date"]').addClass("collapse"))});var saveButton=delegModalDiv.find(".modal-footer .btn-primary");"edit"===mode?(editDelegModalDiv.find('[label="Delegator"] div').addClass("sel"),editDelegModalDiv.find('[label="Delegator"] div').find("font").addClass("zp_dyn"),saveButton.off("click").on("click",function(){Delegation.Add.save(response.delegationId)}),Delegation.Modal.constructEditModalBody(response)):(editDelegModalDiv.find('[label="Delegator"] div').removeClass("sel"),editDelegModalDiv.find('[label="Delegator"] div').find("font").removeClass("zp_dyn"),saveButton.off("click").on("click",function(){Delegation.Add.save()}),Delegation.Modal.resetModalBody())}else Delegation.Edit.constructDelegError(mode,Delegation.View.getPermissionDeniedData(mode));delegModalDiv.find(".modal-header h6").html(Delegation.Edit.getModalHeaderStr(mode)),Delegation.hidePageLoading(delegModalDiv.find(".modal-dialog .modal-content"),delegModalDiv.find(".modal-dialog"))},resetModalBody:function(){var delegModalDiv=$("#"+Layout.Page.pageId).find("#delegModal #addEdit");ZPSelect.clearAllValues(delegModalDiv.find("#delegId")),ZPSelect.clearAllValues(delegModalDiv.find("#empId"));var selfServiceErecno=Delegation.getSelfServiceErecno();if(void 0==selfServiceErecno||selfServiceErecno==erecno)delegModalDiv.find("#empId").zpselect(Delegation.Menu.getSelectDefault(ZPeople.CURR_USER.usererec,ZPeople.CURR_USER.name,ZPeople.CURR_USER.avatar));else{var userDtl=ZPeople.getUserDetailsById(selfServiceErecno);delegModalDiv.find("#empId").zpselect(Delegation.Menu.getSelectDefault(userDtl.usererec,userDtl.name,userDtl.avatar))}delegModalDiv.find("[label='TypeOfDelegation'] label").find("[value='"+Delegation.DELEGATION_TYPE.temporary+"']").trigger("click"),delegModalDiv.find("[label='FromTo']").val(""),delegModalDiv.find("[label='Description'] textarea").val(""),delegModalDiv.find("[label='is_Notify']").find("[value='1']").trigger("click")},constructEditModalBody:function(data){var delegModalDiv=$("#"+Layout.Page.pageId).find("#delegModal #addEdit");$("#"+Layout.Page.pageId).find("#delegModal").attr("delegationid",data.delegationId),ZPSelect.clearAllValues(delegModalDiv.find("#delegId")),ZPSelect.clearAllValues(delegModalDiv.find("#empId")),Object.keys(data.employeeDtls).length>0&&delegModalDiv.find("#empId").zpselect(Delegation.Menu.getSelectDefault(data.employeeDtls.erecno,data.employeeDtls.name,data.employeeDtls.employeePhoto)),Object.keys(data.delegateeDtls).length>0&&delegModalDiv.find("#delegId").zpselect(Delegation.Menu.getSelectDefault(data.delegateeDtls.erecno,data.delegateeDtls.name,data.delegateeDtls.employeePhoto)),delegModalDiv.find("[label='TypeOfDelegation'] label").find("[value='"+data.TypeOfDelegation+"']").trigger("click"),data.TypeOfDelegation==Delegation.DELEGATION_TYPE.temporary&&delegModalDiv.find("[label='FromTo']").val(data.From+"-"+data.To),delegModalDiv.find("[label='Description'] textarea").val(void 0!=data.Description?ZPeople.decodeTxt(data.Description):""),delegModalDiv.find("[label='is_Notify']").find("[value='"+(data.delegateeDtls.is_Notify?"1":"0")+"']").trigger("click")},constructViewModalBody:function(viewData){var delegModalDiv=$("#"+Layout.Page.pageId).find("#delegModal #view");$("#"+Layout.Page.pageId).find("#delegModal").attr("delegationid",viewData.delegationId);var headerEdit=$("#"+Layout.Page.pageId).find("#delegModal").find(".modal-header .IC-pen");viewData.hasEditDelPerm&&viewData.Status!=ZPI18N.getString("zp.leave.compensatory.expired")?(headerEdit.removeClass("DN"),headerEdit.on("click",function(e){e.stopPropagation(),e.preventDefault(),Delegation.Edit.getSingleRecord("edit",$("#"+Layout.Page.pageId).find("#delegModal").attr("delegationid"))})):(headerEdit.addClass("DN"),headerEdit.off("click")),this.setEmpData(viewData.employeeDtls,delegModalDiv.find("[label=Delegator]")),this.setEmpData(viewData.delegateeDtls,delegModalDiv.find("[label=Delegatee]"));var delegationType=ZPI18N.getString("zp.local.Permanent"),dateRange="";viewData.TypeOfDelegation==Delegation.DELEGATION_TYPE.temporary&&(delegationType=ZPI18N.getString("zp.temporary"),dateRange=viewData.From+"-"+viewData.To),delegModalDiv.find("[label=Date]").text(dateRange),delegModalDiv.find("[label=TypeOfDelegation]").text(delegationType),delegModalDiv.find("[label=is_Notify] span").text(viewData.delegateeDtls.is_Notify?ZPI18N.getString("zp.delegateeanddelegator"):ZPI18N.getString("zp.delegatee")),delegModalDiv.find("[label=Description] span").text(viewData.Description?ZPeople.decodeTxt(viewData.Description):"-")},setEmpData:function(empData,parentDiv){if(void 0!=empData){var imageDiv=CommonTemplates.returnImgDiv(empData.employeePhoto,CommonTemplates.getAltText(ZPeople.escapeHtml(empData.name)),"","","");parentDiv.find("div").html('<div class="zp_Tg notg" popup="user" empid="'+empData.zuid+'">'+imageDiv+"<span><b>"+empData.employeeID+"</b> - "+ZPeople.decodeTxt(ZPeople.escapeHtml(empData.name))+"</span></div>")}},resetErrorMsg:function(){$("#"+Layout.Page.pageId).find("#delegModal .etxt").remove()},closeDelegSlide:function(){$("#"+Layout.Page.pageId).find("#delegModal").modal("hide"),window.location.href=Delegation.getDelegationUrl("list")}},Delegation.Validation={validateEmptyValue:function(value,valueParentEle,errorMsg){ZPUtil.Validation.isEmpty(value)&&Delegation.Validation.showErrorMsg(valueParentEle,errorMsg)},showErrorMsg:function(valueParentEle,errorMsg){if(valueParentEle.length>0){var errorDiv=$('<span class="etxt">'+errorMsg+"</span>");"TypeOfDelegation"==valueParentEle.attr("label")?valueParentEle.append(errorDiv):(valueParentEle.find("input").length>0?valueParentEle=valueParentEle.find("input"):valueParentEle.find("textarea").length>0&&(valueParentEle=valueParentEle.find("textarea")),errorDiv.insertAfter(valueParentEle))}else ZPeople.Message.showFailureMsg(errorMsg)}},Delegation.Add={save:function(delegationId){var empId,delegModal=$("#"+Layout.Page.pageId).find("#delegModal");delegModal.find(".etxt").remove(),void 0==delegationId&&(empId=delegModal.find('[label="Delegator"] #empId').attr("selectedIds"),Delegation.Validation.validateEmptyValue(empId,delegModal.find('[label="Delegator"]'),ZPI18N.getString("zp.delegatoremptyerr")));var delegId=delegModal.find('[label="Delegatee"] #delegId').attr("selectedIds");Delegation.Validation.validateEmptyValue(delegId,delegModal.find('[label="Delegatee"]'),ZPI18N.getString("zp.delegateeemptyerr"));var isNotify=delegModal.find('[name="delgNotify"]:checked').attr("value"),desc=delegModal.find('[label="Description"] textarea').val().trim();!ZPUtil.Validation.isEmpty(desc)&&desc.length>250&&Delegation.Validation.showErrorMsg(delegModal.find('[label="Description"]'),ZPI18N.getString("zp.desclength"));var delegationType=delegModal.find('[name="delgType"]:checked').attr("value");if(1==delegationType){var date=delegModal.find('[label="FromTo"]').val();if(void 0==date||""==date)Delegation.Validation.showErrorMsg(delegModal.find('[label="FromTo"]'),ZPI18N.getString("zp.emptydateerr"));else{var from,to,splitDate=date.split("-");splitDate.length<2||3==splitDate.length?Delegation.Validation.showErrorMsg(delegModal.find('[label="FromTo"]'),ZPI18N.getString("zp.temporaryplaceholder")):2===splitDate.length?(from=splitDate[0],to=splitDate[1]):6===splitDate.length?(from=splitDate[0]+"-"+splitDate[1]+"-"+splitDate[2],to=splitDate[3]+"-"+splitDate[4]+"-"+splitDate[5]):Delegation.Validation.showErrorMsg(delegModal.find('[label="FromTo"]'),ZPI18N.getString("zp.invaliddateerr")),!from||!to||Calendar.isvalidDate(from.trim())&&Calendar.isvalidDate(to.trim())||Delegation.Validation.showErrorMsg(delegModal.find('[label="FromTo"]'),ZPI18N.getString("zp.invaliddateerr"))}}if(delegModal.find(".etxt").length<1){delegModal.find(".modal-footer .btn-primary").attr("disabled",!0);var configuration={Delegator:empId,Delegatee:delegId,From:from,To:to,Description:desc,TypeOfDelegation:delegationType,is_Notify:isNotify},params={method:"addUpdateDelegation",conreqcsr:csrfToken,configuration:JSON.stringify(configuration)};void 0!=delegationId&&(params.delegationId=delegationId),ZPeople.Request.send(Delegation.DELEGATION_URL,params,Delegation.Add.showSuccessMsg,void 0,Delegation.failureCallBack)}},showSuccessMsg:function(data,params){if(data.success){params.delegationId?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.successdelegedit")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.successdelegadd"));var selfServiceErecno=Delegation.getSelfServiceErecno();if($("#"+Layout.Page.pageId).find("#delegTable tbody tr").length>=0&&data.success.delegationId){if(void 0==selfServiceErecno||data.success.employeeDtls.erecno==selfServiceErecno||data.success.delegateeDtls.erecno==selfServiceErecno)Delegation.Add.addDelegationRow(data.success);else if(selfServiceErecno){var delegation=ZPServices.getObjectFormArray(Delegation.DELEGATION_JSON,"delegationId",data.success.delegationId,!0,!0);delegation&&Delegation.DELEGATION_JSON.splice(delegation.index,1),$("#"+Layout.Page.pageId).find("#delegTable tbody [delegationid='"+data.success.delegationId+"']").remove(),Delegation.Modal.closeDelegSlide()}}else Delegation.Modal.closeDelegSlide()}else data.errors&&("string"==typeof data.errors?ZPeople.Message.showFailureMsg(data.errors):$.each(data.errors,function(key,errorMsg){Delegation.Add.constructErrorMsg(key,errorMsg)}));$("#"+Layout.Page.pageId).find("#delegModal").find(".modal-footer .btn-primary").attr("disabled",!1)},addDelegationRow:function(singleDeleg){var pageDiv=$("#"+Layout.Page.pageId).find("#delegationPage .ZPTscrlcont");if(void 0!=singleDeleg)if(pageDiv.removeClass("DN"),pageDiv.find("tbody [delegationid='"+singleDeleg.delegationId+"']").length>0){var oldSingleDeleg=ZPServices.getObjectFormArray(Delegation.DELEGATION_JSON,"delegationId",singleDeleg.delegationId,!1,!0);Delegation.DELEGATION_JSON.splice(oldSingleDeleg.index,1,singleDeleg);var tableData=Delegation.View.constructDelgData(singleDeleg);(tableRow=pageDiv.find("tbody [delegationid='"+singleDeleg.delegationId+"']")).empty(),tableRow.append(tableData)}else{Delegation.DELEGATION_JSON.splice(0,0,singleDeleg);var tableRow=Delegation.View.constructDelgRow(singleDeleg);$("#"+Layout.Page.pageId).find("#delegationPage .ZPNdata").remove(),pageDiv.find("tbody").prepend(tableRow)}Delegation.View.addClickEvent(pageDiv.find("table")),Delegation.Modal.closeDelegSlide()},constructErrorMsg:function(key,errorMsg){var delegModal=$("#"+Layout.Page.pageId).find("#delegModal #addEdit");"From"!==key&&"To"!==key||(key="FromTo"),Delegation.Validation.showErrorMsg(delegModal.find("[label='"+key+"']"),errorMsg)}},Delegation.Edit={getSingleRecord:function(mode,delegationId){if(void 0!==(delegationId=delegationId||Layout.Page.childUrlParam.delegationid)){var singleDelegData=ZPServices.getObjectFormArray(Delegation.DELEGATION_JSON,"delegationId",delegationId);void 0==singleDelegData||"edit"===mode&&!singleDelegData.hasEditDelPerm?ZPeople.Request.send(Delegation.DELEGATION_URL,{method:"delegationOperation",mode:mode,conreqcsr:csrfToken,delegationId:delegationId},Delegation.Edit.constructEditData,mode):Delegation.Modal.openDelegSlide(mode,singleDelegData)}},constructEditData:function(data,param,mode){data.errors?Delegation.Edit.constructDelegError(mode,data.errors):Delegation.Modal.openDelegSlide(mode,data)},constructDelegError:function(mode,errorMsg){var messageHTML=$('<div class="col-lg-12 text-center" id="viewErrorModal"><div class="PArds"></div><h2 class="ZPNdt">'+errorMsg+"</h2></div>"),delegModalDiv=$("#"+Layout.Page.pageId).find("#delegModal");delegModalDiv.find("#viewErrorModal").remove(),delegModalDiv.modal("show"),delegModalDiv.find(".modal-header h6").html(Delegation.Edit.getModalHeaderStr(mode)),delegModalDiv.find(".modal-body form").addClass("DN"),delegModalDiv.find(".modal-body").append(messageHTML),delegModalDiv.find(".modal-footer .btn-default").removeClass("DN")},getModalHeaderStr:function(mode){return"view"===mode?ZPI18N.getString("zp.viewdelegation"):"edit"===mode?ZPI18N.getString("zp.editdelegheader"):ZPI18N.getString("zp.createdelegbtn")}},Delegation.Delete={deleteRecord:function(delegationId){void 0!==delegationId&&(isadmin||SelfService.Info.allow_add_delegation?ZPeople.BSModal.confirm(function(){Delegation.Delete.sendDeleteRequest(delegationId)},ZPI18N.getString("zp.confirm"),ZPI18N.getString("zp.deletedelegconfirm")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.deniedtodeltdelegperm")))},sendDeleteRequest:function(delegationId){ZPeople.Request.send(Delegation.DELEGATION_URL,{method:"delegationOperation",conreqcsr:csrfToken,mode:"delete",delegationId:delegationId},Delegation.Delete.showMessage)},showMessage:function(data,params){if(data.errors)ZPeople.Message.showFailureMsg(data.errors);else if(data.success&&params.delegationId){ZPeople.Message.showSuccessMsg(data.success);var oldSingleDeleg=ZPServices.getObjectFormArray(Delegation.DELEGATION_JSON,"delegationId",params.delegationId,!1,!0),selectedRow=$("#"+Layout.Page.pageId).find("#delegationPage tbody [delegationid="+params.delegationId+"]");"delete"===params.mode&&(Delegation.DELEGATION_JSON.splice(oldSingleDeleg.index,1),selectedRow.remove(),$("#"+Layout.Page.pageId).find("#delegationPage tbody tr").length<1&&($("#"+Layout.Page.pageId).find("#delegationPage .ZPTscrlcont").addClass("DN"),$("#"+Layout.Page.pageId).find("#delegationPage").append(CommonTemplates.noDataSVG("delegationPage",!0,ZPI18N.getString("zp.nodelegationmsg"),!1)),$("#"+Layout.Page.pageId).find("#delegationPage .mainhead").addClass("ndat")))}}};var DelegationSettings={DELEGATION_URL:"/delegationAction.zp",DELEGATION_JSON:[],DELEGATION_TYPE:{temporary:1,permanent:2},PAGE_ID:null,DELEGTABLE_ID:null,TAB_ID:null,CARD_ID:null,VIEW_ID:null,setPageId:function(container){DelegationSettings.PAGE_ID=void 0!=container?container:settingsUrlProps.url.includes("myspace")?Layout.Page.container:settingsPage.container},isFromMySpace:function(){return settingsUrlProps.url.includes("myspace")},showPageLoading:function(divToHide,parentDiv){divToHide.addClass("zpl_DNI"),parentDiv.append(ZPeople.LOADING_HTML)},hidePageLoading:function(divToShow,parentDiv){divToShow.removeClass("zpl_DNI"),parentDiv.find("#zp_page_loading").remove()},getMySpaceErecno:function(){if(DelegationSettings.isFromMySpace())return erecno},resetPageId:function(container){DelegationSettings.PAGE_ID=null,DelegationSettings.DELEGTABLE_ID=null,DelegationSettings.TAB_ID=null,DelegationSettings.CARD_ID=null,DelegationSettings.VIEW_ID=null,DelegationSettings.setPageId(container)},failureCallBack:function(failureData,params){params&&"addUpdateDelegation"==params.method&&DelegationSettings.TAB_ID.find(".zpl_mfoter #sliderSbt").attr("disabled",!1),failureData.hasOwnProperty("responseJSON")&&failureData.responseJSON.hasOwnProperty("error")&&failureData.responseJSON.error.trim().length>0&&ZPeople.Message.showFailureMsg(failureData.responseJSON.error)},changeDelegationUrl:function(mode,delegationId){switch(mode){case"view":window.location.href=Layout.Page.hash.split("/delegation")[0]+"/delegation/view-id:"+delegationId;break;case"edit":window.location.href=Layout.Page.hash.split("/delegation")[0]+"/delegation/edit-id:"+delegationId;break;case"add":window.location.href=Layout.Page.hash.split("/delegation")[0]+"/delegation/add";break;case"close":window.location.href=Layout.Page.hash.split("/delegation")[0]+"/delegation"}}};DelegationSettings.View={EMPTY_PAGE:null,isDelegationAllowed:!1,isAddDelegationAllowed:!1,delegationRouting:function(){var url=Layout.Page.hash,delegationId=url.split(":")[1];-1!==url.indexOf("delegation/edit")?DelegationSettings.Edit.getSingleRecord("edit",delegationId):-1!==url.indexOf("delegation/view")?DelegationSettings.Edit.getSingleRecord("view",delegationId):-1!==url.indexOf("delegation/add")&&DelegationSettings.Modal.openDelegSlide()},init:function(){ZPeople.Request.send(DelegationSettings.DELEGATION_URL,{method:"getDelegationPermission",erecno:DelegationSettings.getMySpaceErecno(),conreqcsr:csrfToken},DelegationSettings.View.constructPage)},constructPage:function(delegPerm){if(DelegationSettings.View.isDelegationAllowed=delegPerm.isDelegationAllowed,DelegationSettings.resetPageId(null),container=DelegationSettings.PAGE_ID,isadmin||DelegationSettings.View.isDelegationAllowed)container.html(DelegationSettings.View.getViewPageHTML()),ZPeopleComponents.button(container.find("#add_delegation_btn"),{appearance:"primary",click:DelegationSettings.View.createDeleg}),DelegationSettings.View.fetchDelegationList();else{new EmptyPages("zp_nd_permission",ZPI18N.getString("zp.permissiondeniedtoaccessthispage"),"",container).show()}},getViewPageHTML:function(){return DelegationSettings.isFromMySpace()?'<div class="zpl_act"><div class="zpl_btnmnu"><div class="zpl_rgt"><button id="add_delegation_btn" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.createdelegbtn")+'</button></div></div><div class="zpl_rgtcnt"><div class="zpl_tblres">'+DelegationSettings.View.getListPageOutlineHTML("zpl_tabularfxd")+'</div><div label="DelegEmptPage"></div></div></div></div>':'<div class="zpl_act"><div class="zpl_btnmnu"><div class="zpl_rgt"><button id="add_delegation_btn" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.createdelegbtn")+'</button></div></div><div class="zpl_rgtcnt"><div class="zpl_tblres">'+DelegationSettings.View.getListPageOutlineHTML("")+'</div><div label="DelegEmptPage"></div></div></div>'},getListPageOutlineHTML:function(tableCls){return'<table id="delegTable" class="zpl_tbl '+tableCls+'"><thead><tr><th>'+ZPI18N.getString("zp.delegator")+"</th><th>"+ZPI18N.getString("zp.delegatee")+"</th><th>"+ZPI18N.getString("zp.type")+"</th><th>"+ZPI18N.getString("zp.fromtodate")+"</th><th>"+ZPI18N.getString("zp.status")+'</th><th class="zpl_w100"></th></tr></thead><tbody> </tbody></table>'},createDeleg:function(){DelegationSettings.changeDelegationUrl("add")},fetchDelegationList:function(){container=DelegationSettings.PAGE_ID,DelegationSettings.DELEGTABLE_ID=container.find("#delegTable"),DelegationSettings.DELEGTABLE_ID.find("tbody tr").length>0||(DelegationSettings.showPageLoading(DelegationSettings.DELEGTABLE_ID,container),ZPeople.Request.send(DelegationSettings.DELEGATION_URL,{method:"list",erecno:DelegationSettings.getMySpaceErecno(),conreqcsr:csrfToken},DelegationSettings.View.constructDelgPage))},constructDelgPage:function(delegList){if(void 0!=delegList){DelegationSettings.DELEGATION_JSON=delegList.list,DelegationSettings.View.isAddDelegationAllowed=delegList.isAddDelegationAllowed;var pageId=DelegationSettings.PAGE_ID;if(isadmin||delegList.isAddDelegationAllowed||pageId.find("#add_delegation_btn").addClass("zpl_DNI"),pageId.find("#zp_page_loading").remove(),DelegationSettings.DELEGATION_JSON.length<1)return DelegationSettings.Common.emptyData(),void DelegationSettings.hidePageLoading(DelegationSettings.DELEGTABLE_ID,pageId);DelegationSettings.DELEGTABLE_ID.removeClass("zpl_DNI");var tableBody=DelegationSettings.DELEGTABLE_ID.find("tbody").empty(),tableRows="";$.each(DelegationSettings.DELEGATION_JSON,function(i,singleDeleg){tableRows+=DelegationSettings.View.constructDelgRow(singleDeleg)}),tableBody.append(tableRows),DelegationSettings.View.addClickEvent(tableBody),DelegationSettings.hidePageLoading(DelegationSettings.DELEGTABLE_ID,pageId)}},constructDelgRow:function(singleDeleg){return'<tr class="ZPLRow" delegationid="'+singleDeleg.delegationId+'">'+DelegationSettings.View.constructDelgData(singleDeleg)+"</tr>"},addClickEvent:function(tableBody){tableBody.find("tr td div .PI_edt").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),DelegationSettings.changeDelegationUrl("edit",$(this).closest("tr").attr("delegationid"))}),tableBody.find("tr td div .PI_delete").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),DelegationSettings.Delete.deleteRecord($(this).closest("tr").attr("delegationid"))}),tableBody.find("tr").off("click").on("click",function(){DelegationSettings.changeDelegationUrl("view",$(this).closest("tr").attr("delegationid"))})},constructDelgData:function(singleDeleg){singleDeleg.delegationId;var singleDelgtr=this.constructEmpData(singleDeleg.employeeDtls);return singleDelgtr+=this.constructEmpData(singleDeleg.delegateeDtls),singleDeleg.TypeOfDelegation==DelegationSettings.DELEGATION_TYPE.temporary?(singleDelgtr+="<td> <span>"+ZPI18N.getString("zp.temporary")+"</span></td>",singleDelgtr+="<td><span>"+singleDeleg.From+" to "+singleDeleg.To+"</span></td>"):(singleDelgtr+="<td><span>"+ZPI18N.getString("zp.local.Permanent")+"</span></td>",singleDelgtr+="<td></td>"),singleDelgtr+="<td><span>"+singleDeleg.Status+"</span></td>",singleDelgtr+='<td><div class="zpl_hvr">',singleDeleg.hasEditDelPerm&&(singleDeleg.Status!==ZPI18N.getString("zp.expired")&&(singleDelgtr+='<i class="PI_edt" title="'+ZPI18N.getString("zp.edit")+'" data-original-title="Edit"></i>'),singleDelgtr+='<i class="PI_delete" title="'+ZPI18N.getString("zp.delete")+'" data-original-title="Delete"></i>'),singleDelgtr+="</div></td>"},constructEmpData:function(empData){var empHTML="<td>";return void 0!=empData&&Object.keys(empData).length>0&&(empHTML+='<div class="zpl_em">',empHTML+='<div class="zpl_emimg"><img src="'+empData.employeePhoto+'" data-toggle="tooltip" data-placement="top" data-original-title="" popup="user" empid="'+empData.zuid+'"></div>',empHTML+='<div class="zpl_emdts"> <div>',empHTML+=empData.erecno==erecno?"<b>"+ZPI18N.getString("zp.you")+"</b>":"<em>"+empData.employeeID+" - </em><b>"+ZPeople.decodeTxt(ZPeople.escapeHtml(empData.name))+"</b>",empHTML+="</div></div></div>"),empHTML+"</td>"}},DelegationSettings.Menu={getEmployeeProperty:function(selectedIdDtl,searchMode){var property={};if(property.dataSource={search:function(params){return new Promise(function(search,reject){var searchRes;if("DELEGATION_DELEGATOR"==searchMode){var delegatorId,defaultVal,modalObj=DelegationSettings.TAB_ID;modalObj?delegatorId=ZPeopleComponents.select(modalObj.find("#delegatorList")).getValue():"P_Employee"==ZPForm.getTableName()&&(delegatorId=ZPForm.CURRFORM_PARAM.recordId,defaultVal=ZPeople.getUserDetailsById(delegatorId).reportingTo),searchRes=EmployeeSearch.getEmpList(params.query,"emp","DELEGATION_DELEGATOR",void 0==delegatorId||""==delegatorId?void 0:[delegatorId],void 0,!1,defaultVal)}else{var delegateeId=DelegationSettings.TAB_ID.find("#delegateeList").val();searchRes=EmployeeSearch.getEmpList(params.query,"emp",searchMode,void 0==delegateeId||""==delegateeId?void 0:[delegateeId],void 0)}search({delay:20,results:searchRes,more:!1})})},paginated:!0},property.placeholder=ZPI18N.getString("zp.select"),property.dataMapping={id:"id",label:"value",value:"id",image:"image"},property.showSearchField=!0,property.contentType="image-text",property.search={by:["value","email"]},property.serverSearch=!0,property.cacheData=!0,property.isLabelHTMLEncoded=!0,property.dropdownList={fitForElement:!0,moveOnScroll:!0,isTextHTMLEncoded:!0},property.change=DelegationSettings.Modal.changeDelegCallback,selectedIdDtl){var userDtl=ZPeople.getUserDetailsById(selectedIdDtl.erecno);(param1={}).value=userDtl.name,param1.image=userDtl.avatar,param1.id=userDtl.usererec,param1.emailId=userDtl.email,param1.zuid=userDtl.id,property.selectedValue=param1}else if("DELEGATION_EMP"==searchMode){var param1;userDtl=ZPeople.getUserDetailsById(erecno);(param1={}).value=userDtl.name,param1.image=userDtl.avatar,param1.id=userDtl.usererec,param1.emailId=userDtl.email,param1.zuid=userDtl.id,property.selectedValue=param1}return property},getDelegTypeProperty:function(selectedType){var property={},invokeType=[];return invokeType.push({id:"1",value:ZPI18N.getString("zp.temporary")}),invokeType.push({id:"2",value:ZPI18N.getString("zp.local.Permanent")}),property.options=invokeType,property.dataMapping={label:"value",value:"id"},selectedType&&(property.selectedValue=selectedType),property.change=DelegationSettings.Modal.changeDelegTypeCallback,property}},DelegationSettings.Modal={SLIDER_MODAL:void 0,BODY_OUTER_HTML:'<div class="zpl_crd"><div class="zpl_crdcnt" id="delegation_modal_body"></div></div>',INPUT_HTML:'<div class="zpl_secn"><div><label class="$LABEL_CLASS$">$LABEL_DISP_NAME$</label></div><div class="$FIELD_CLASS$">$FIELD_HTML$</div></div>',getPageId:function(){return DelegationSettings.isFromMySpace()?$("body #modal_Container"):$(settingsPage.mainWrapId)},openDelegSlide:function(event,data,mode){(isadmin||DelegationSettings.View.isDelegationAllowed)&&("view"==mode?(DelegationSettings.Modal.SLIDER_MODAL=new sliderModal(DelegationSettings.Modal.getModalHeaderStr(mode),new Tab("ViewDeleg",function(){DelegationSettings.Modal.constructViewModalBody(data)},function(){DelegationSettings.Add.save(void 0===data?data:data.delegationId)})),DelegationSettings.Modal.SLIDER_MODAL.cancel=ZPI18N.getString("zp.close")):(isadmin||DelegationSettings.View.isAddDelegationAllowed)&&(void 0!=DelegationSettings.Modal.SLIDER_MODAL&&DelegationSettings.Modal.closeDelegSlide(!1),DelegationSettings.Modal.SLIDER_MODAL=new sliderModal(DelegationSettings.Modal.getModalHeaderStr(mode),new Tab("AddEditDeleg",function(){DelegationSettings.Modal.constructEditModalBody(data)},function(){DelegationSettings.Add.save(void 0===data?data:data.delegationId)}))),DelegationSettings.Modal.SLIDER_MODAL.isAppendToBody=!!DelegationSettings.isFromMySpace(),DelegationSettings.Modal.SLIDER_MODAL.construct(),DelegationSettings.Modal.SLIDER_MODAL.setCloseCallback(function(){DelegationSettings.Modal.closeDelegSlide(!0)}))},getInputHTML:function(dispName,fieldHtml,labelClass,fieldClass){var html=DelegationSettings.Modal.INPUT_HTML;return html=(html=(html=(html=html.replace("$LABEL_DISP_NAME$",dispName)).replace("$FIELD_HTML$",fieldHtml)).replace("$LABEL_CLASS$",labelClass||"")).replace("$FIELD_CLASS$",fieldClass||"")},constructEditModalBody:function(data){DelegationSettings.TAB_ID=DelegationSettings.Modal.getPageId().find("#tabAddEditDeleg"),DelegationSettings.CARD_ID=DelegationSettings.TAB_ID.find("#cardAddEditDeleg");var popup_body=DelegationSettings.CARD_ID;popup_body.append('<div class="zpl_crd"><div class="zpl_crdcnt">'+DelegationSettings.Modal.getEditModalHTML()+"</div></div>"),DelegationSettings.Modal.setEditModalProperty(data),data&&(DelegationSettings.TAB_ID.attr("delegationId",data.delegationId),popup_body.find("#delegatorList").parent("div").addClass("disabled"))},getEditModalHTML:function(){var html="";html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.delegator"),'<select id="delegatorList" label="Delegator"></select>',"zpl_mtry"),html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.delegatee"),'<select id="delegateeList" label="Delegatee"></select>',"zpl_mtry");var inputHTML='<select id="delegationTypeList" label="TypeOfDelegation"></select>';return inputHTML+=DelegationSettings.Modal.getDateRangePicker(),html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.type"),inputHTML,void 0,"zpl_idiv"),inputHTML=DelegationSettings.Modal.getRadioBtnHTML(),html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.notification"),inputHTML),html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.description"),'<textarea class="ztextbox" rows="5" label="Description"></textarea>')},getRadioBtnHTML:function(){var html='<div class="zpl_idiv zpl_erorbx" label="is_Notify">';return html+='<div class="zradiobutton d-flexC zradiobutton--horizontal">',html+='<input id="notify_bothdeleg" type="radio" checked="" class="zradiobutton__helper" name="delgNotify" value="1">',html+='<label for="notify_bothdeleg" class="zradiobutton__label">',html+='<span class="zradiobutton__text">'+ZPI18N.getString("zp.delegateeanddelegator")+"</span>",html+="</label>",html+="</div>",html+='<div class="zradiobutton d-flexC zradiobutton--horizontal">',html+='<input id="notify_delegatee" type="radio" class="zradiobutton__helper" name="delgNotify" value="0">',html+='<label for="notify_delegatee" class="zradiobutton__label">',html+='<span class="zradiobutton__text">'+ZPI18N.getString("zp.delegatee")+"</span>",html+="</label>",html+="</div>",html+="</div>"},getDateRangePicker:function(){return'<div id="delegationFromToDiv" class="zpl_DNI"><div id="delegationDateRangePicker" data-for-element="#delegDateRangeInput"></div><div><div id="delegDateRangeDiv" class="ztextbox--group zh-alignright"><i class="ztextbox__icon PI_calendar"></i><input id="delegDateRangeInput" class="ztextbox" label="FromTo" placeholder="'+ZPI18N.getString("zp.daterange")+'"></div></div></div>'},setDateRangePicker:function(){ZPeopleComponents.daterangepicker("#delegationDateRangePicker",{forElement:"#delegDateRangeDiv",appendTo:DelegationSettings.TAB_ID,change:(event,ui)=>{DelegationSettings.CARD_ID.find("#delegDateRangeInput").val(ui.fromValueString+"-"+ui.toValueString)},format:dateFmt,singleDateSelect:!0,position:"bottom"});let picker=DelegationSettings.TAB_ID.find("#delegationDateRangePicker");DelegationSettings.CARD_ID.find("#delegDateRangeDiv").off().on("click",function(){picker.is(":visible")?ZPeopleComponents.daterangepicker(picker).close():ZPeopleComponents.daterangepicker(picker).open()})},setEditModalProperty:function(data){ZPeopleComponents.select("#delegatorList",DelegationSettings.Menu.getEmployeeProperty(data&&data.employeeDtls?data.employeeDtls:void 0,"DELEGATION_EMP")),ZPeopleComponents.select("#delegateeList",DelegationSettings.Menu.getEmployeeProperty(data&&data.delegateeDtls?data.delegateeDtls:void 0,"DELEGATION_DELEGATOR")),ZPeopleComponents.select("#delegationTypeList",DelegationSettings.Menu.getDelegTypeProperty(data?data.TypeOfDelegation:void 0)),DelegationSettings.Modal.setDateRangePicker();var container=DelegationSettings.TAB_ID;data&&data.delegateeDtls&&data.delegateeDtls.hasOwnProperty("is_Notify")?container.find("[label='is_Notify']").find("[value='"+(data.delegateeDtls.is_Notify?"1":"0")+"']").trigger("click"):container.find("[label='is_Notify']").find("[value='1']"),data&&data.Description&&container.find("[label='Description']").val(ZPeople.decodeTxt(data.Description));var typeOfDeleg=data&&data.TypeOfDelegation?data.TypeOfDelegation:"1";DelegationSettings.Modal.changeDelegType(typeOfDeleg),data&&data.TypeOfDelegation&&data.TypeOfDelegation==DelegationSettings.DELEGATION_TYPE.temporary&&container.find("[label='FromTo']").val(data.From+"-"+data.To)},changeDelegTypeCallback:function(event,detail){DelegationSettings.Modal.changeDelegType(detail.selectedValue)},changeDelegType:function(selectedType){var container=DelegationSettings.TAB_ID;selectedType==DelegationSettings.DELEGATION_TYPE.temporary?(DelegationSettings.Validation.removeErrorMsg(container.find('[label="TypeOfDelegation"]').closest("div.zpl_secn")),container.find('#delegDateRangeInput[label="FromTo"]').val(""),container.find("#delegationFromToDiv").removeClass("zpl_DNI")):selectedType==DelegationSettings.DELEGATION_TYPE.permanent&&(DelegationSettings.Validation.removeErrorMsg(container.find('[label="TypeOfDelegation"]').closest("div.zpl_secn")),container.find("#delegationFromToDiv").addClass("zpl_DNI"))},changeDelegCallback:function(event,detail){var ele=detail.element.closest("div.zpl_secn");(ele.find(".ztextbox--error__label").length>0||ele.find(".ztextbox__error").length>0)&&DelegationSettings.Validation.removeErrorMsg(ele)},constructViewModalBody:function(viewData){DelegationSettings.VIEW_ID=DelegationSettings.Modal.getPageId().find("#tabViewDeleg"),DelegationSettings.VIEW_ID.find("#sliderSbt").hide(),$('<div class="zpl_mhderrgt"><a id="sliderEdt"class="_cls PI_edt zpl_DNI" title="Edit"></a></div>').insertBefore(DelegationSettings.VIEW_ID.find("#sliderCls")),DelegationSettings.VIEW_ID.attr("delegationId",viewData.delegationId);var popup_body=DelegationSettings.VIEW_ID.find("#cardViewDeleg"),headerEdt=DelegationSettings.VIEW_ID.find("#sliderEdt");viewData.hasEditDelPerm&&viewData.Status!=ZPI18N.getString("zp.expired")?(headerEdt.removeClass("zpl_DNI"),headerEdt.on("click",function(e){e.stopPropagation(),e.preventDefault(),DelegationSettings.changeDelegationUrl("edit",DelegationSettings.VIEW_ID.attr("delegationid"))})):(headerEdt.addClass("zpl_DNI"),headerEdt.off("click")),popup_body.append('<div class="zpl_crd"><div class="zpl_crdcnt">'+DelegationSettings.Modal.getViewModalHTML(viewData)+"</div></div>")},getViewModalHTML:function(viewData){var delegationType=ZPI18N.getString("zp.local.Permanent"),dateRange="";viewData.TypeOfDelegation==DelegationSettings.DELEGATION_TYPE.temporary&&(delegationType=ZPI18N.getString("zp.temporary"),dateRange=viewData.From+" - "+viewData.To);var html="";return html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.delegator"),this.setEmpData(viewData.employeeDtls)),html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.delegatee"),this.setEmpData(viewData.delegateeDtls)),html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.type"),'<span label="TypeOfDelegation">'+delegationType+"</span>"),html+=dateRange?DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.fromtodate"),'<span label="Date">'+dateRange+"</span>"):dateRange,html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.notification"),'<span label="is_Notify">'+(viewData.delegateeDtls.is_Notify?ZPI18N.getString("zp.delegateeanddelegator"):ZPI18N.getString("zp.delegatee"))+"</span>"),html+=DelegationSettings.Modal.getInputHTML(ZPI18N.getString("zp.description"),'<span label="Description">'+(viewData.Description?viewData.Description:"-")+"</span>")},setEmpData:function(empData){if(void 0!=empData){let imageDiv='<div class="zselectbox__image"><img src="'+empData.employeePhoto+'"></img></div>';return'<div class="zselectbox__selected" popup="user" empid="'+empData.zuid+'">'+imageDiv+"<span><b>"+empData.employeeID+"</b> - "+ZPeople.decodeTxt(ZPeople.escapeHtml(empData.name))+"</span></div>"}},closeDelegSlide:function(isNeedURLChange){if(null!=DelegationSettings.TAB_ID){var container=DelegationSettings.TAB_ID;container.find("#delegatorList").length>0&&ZPeopleComponents.select($("#delegatorList")).destroy(),container.find("#delegateeList").length>0&&ZPeopleComponents.select($("#delegateeList")).destroy(),container.find("#delegationTypeList").length>0&&ZPeopleComponents.select($("#delegationTypeList")).destroy(),DelegationSettings.TAB_ID=null,DelegationSettings.CARD_ID=null}else DelegationSettings.VIEW_ID=null;DelegationSettings.Modal.SLIDER_MODAL.remove(),DelegationSettings.Modal.SLIDER_MODAL=null,isNeedURLChange&&DelegationSettings.changeDelegationUrl("close")},getModalHeaderStr:function(mode){return"view"===mode?ZPI18N.getString("zp.viewdelegation"):"edit"===mode?ZPI18N.getString("zp.editdelegheader"):ZPI18N.getString("zp.adddeleghdr")}},DelegationSettings.Validation={validateEmptyValue:function(value,valueParentEle,errorMsg){ZPUtil.Validation.isEmpty(value)&&DelegationSettings.Validation.showErrorMsg(valueParentEle,errorMsg)},showErrorMsg:function(valueParentEle,errorMsg){if(!valueParentEle.hasClass("ztextbox__error"))if(valueParentEle.length>0){var errorDiv=$('<span class="ztextbox--error__label">'+errorMsg+"</span>");"FromTo"==valueParentEle.attr("label")||"TypeOfDelegation"==valueParentEle.attr("label")?(errorDiv.insertAfter(valueParentEle.closest("div.zpl_idiv")),DelegationSettings.CARD_ID.find('[label="TypeOfDelegation"]').next("div").addClass("ztextbox__error"),DelegationSettings.CARD_ID.find("#delegDateRangeInput").addClass("ztextbox__error")):(valueParentEle.next("div").length>0?valueParentEle=valueParentEle.next("div"):valueParentEle.find("textarea").length>0&&(valueParentEle=valueParentEle.find("textarea")),valueParentEle.hasClass("ztextbox__error")||errorDiv.insertAfter(valueParentEle),valueParentEle.addClass("ztextbox__error"))}else ZPeople.Message.showFailureMsg(errorMsg)},removeErrorMsg:function(ele){var cardId=void 0==ele?DelegationSettings.CARD_ID:ele;cardId.find(".ztextbox--error__label").remove(),cardId.find(".ztextbox__error").removeClass("ztextbox__error")}},DelegationSettings.Add={save:function(delegationId){var empId,delegModal=DelegationSettings.CARD_ID;DelegationSettings.Validation.removeErrorMsg(),void 0==delegationId&&(empId=delegModal.find("#delegatorList").val(),DelegationSettings.Validation.validateEmptyValue(empId,delegModal.find('[label="Delegator"]'),ZPI18N.getString("zp.delegatorerr")));var delegId=delegModal.find("#delegateeList").val();DelegationSettings.Validation.validateEmptyValue(delegId,delegModal.find('[label="Delegatee"]'),ZPI18N.getString("zp.delegateeerr"));var isNotify=delegModal.find('[name="delgNotify"]:checked').attr("value"),desc=delegModal.find('[label="Description"]').val().trim();!ZPUtil.Validation.isEmpty(desc)&&desc.length>250&&DelegationSettings.Validation.showErrorMsg(delegModal.find('[label="Description"]'),ZPI18N.getString("zp.maxdesclimit",[250]));var delegationType=delegModal.find("#delegationTypeList").val();if(1==delegationType){var date=delegModal.find('[label="FromTo"]').val();if(void 0==date||""==date)DelegationSettings.Validation.showErrorMsg(delegModal.find('[label="FromTo"]'),ZPI18N.getString("zp.delegdateerr"));else{var from,to,splitDate=date.split("-");splitDate.length<2||3==splitDate.length?DelegationSettings.Validation.showErrorMsg(delegModal.find('[label="FromTo"]'),ZPI18N.getString("zp.temporaryplaceholder")):2===splitDate.length?(from=splitDate[0],to=splitDate[1]):6===splitDate.length?(from=splitDate[0]+"-"+splitDate[1]+"-"+splitDate[2],to=splitDate[3]+"-"+splitDate[4]+"-"+splitDate[5]):DelegationSettings.Validation.showErrorMsg(delegModal.find('[label="FromTo"]'),ZPI18N.getString("zp.invaliddateerr")),!from||!to||Calendar.isvalidDate(from.trim())&&Calendar.isvalidDate(to.trim())||DelegationSettings.Validation.showErrorMsg(delegModal.find('[label="FromTo"]'),ZPI18N.getString("zp.invaliddateerr"))}}if(delegModal.find(".ztextbox--error__label").length<1){delegModal.find(".zpl_mfoter #sliderSbt").attr("disabled",!0);var configuration={Delegator:empId,Delegatee:delegId,From:from,To:to,Description:desc,TypeOfDelegation:delegationType,is_Notify:isNotify},params={method:"addUpdateDelegation",conreqcsr:csrfToken,configuration:JSON.stringify(configuration)};void 0!=delegationId&&(params.delegationId=delegationId),ZPeople.Request.send(DelegationSettings.DELEGATION_URL,params,DelegationSettings.Add.showSuccessMsg,void 0,DelegationSettings.failureCallBack)}},showSuccessMsg:function(data,params){if(data.success){params.delegationId?ZPeople.Message.success(ZPI18N.getString("zp.successdelegedit")):ZPeople.Message.success(ZPI18N.getString("zp.successdelegadd"));var mySpaceErecno=DelegationSettings.getMySpaceErecno();if(DelegationSettings.DELEGTABLE_ID.find("tbody tr").length>=0&&data.success.delegationId){if(void 0==mySpaceErecno||data.success.employeeDtls.erecno==mySpaceErecno||data.success.delegateeDtls.erecno==mySpaceErecno)DelegationSettings.Add.addDelegationRow(data.success);else if(mySpaceErecno){var delegation=ZPServices.getObjectFormArray(DelegationSettings.DELEGATION_JSON,"delegationId",data.success.delegationId,!0,!0);delegation&&DelegationSettings.DELEGATION_JSON.splice(delegation.index,1),DelegationSettings.DELEGTABLE_ID.find("tbody [delegationid='"+data.success.delegationId+"']").remove(),DelegationSettings.Modal.closeDelegSlide(!0)}}else DelegationSettings.Modal.closeDelegSlide(!0)}else data.errors&&("string"==typeof data.errors?ZPeople.Message.failure(data.errors):$.each(data.errors,function(key,errorMsg){DelegationSettings.Add.constructErrorMsg(key,errorMsg)}));void 0!=DelegationSettings.TAB_ID&&DelegationSettings.TAB_ID.find(".zpl_mfoter #sliderSbt").attr("disabled",!1)},addDelegationRow:function(singleDeleg){var tableBody=DelegationSettings.DELEGTABLE_ID.find("tbody");if(void 0!=singleDeleg)if(tableBody.parents(".zpl_tblres").removeClass("zpl_DNI"),tableBody.find("[delegationid='"+singleDeleg.delegationId+"']").length>0){var oldSingleDeleg=ZPServices.getObjectFormArray(DelegationSettings.DELEGATION_JSON,"delegationId",singleDeleg.delegationId,!1,!0);DelegationSettings.DELEGATION_JSON.splice(oldSingleDeleg.index,1,singleDeleg);var tableData=DelegationSettings.View.constructDelgData(singleDeleg);(tableRow=tableBody.find("[delegationid='"+singleDeleg.delegationId+"']")).empty(),tableRow.append(tableData)}else{void 0!=DelegationSettings.View.EMPTY_PAGE&&DelegationSettings.Common.removeEmptyData(),DelegationSettings.DELEGATION_JSON.splice(0,0,singleDeleg);var tableRow=DelegationSettings.View.constructDelgRow(singleDeleg);tableBody.prepend(tableRow)}DelegationSettings.View.addClickEvent(tableBody),DelegationSettings.Modal.closeDelegSlide(!0)},constructErrorMsg:function(key,errorMsg){var delegModal=DelegationSettings.CARD_ID;"From"!==key&&"To"!==key||(key="FromTo"),DelegationSettings.Validation.showErrorMsg(delegModal.find("[label='"+key+"']"),errorMsg)}},DelegationSettings.Edit={getSingleRecord:function(mode,delegationId){if(void 0!==(delegationId=delegationId||Layout.Page.childUrlParam.delegationid)){var singleDelegData=ZPServices.getObjectFormArray(DelegationSettings.DELEGATION_JSON,"delegationId",delegationId);void 0==singleDelegData||"edit"===mode&&!singleDelegData.hasEditDelPerm?ZPeople.Request.send(DelegationSettings.DELEGATION_URL,{method:"delegationOperation",mode:mode,conreqcsr:csrfToken,delegationId:delegationId},DelegationSettings.Edit.constructEditData,mode):DelegationSettings.Modal.openDelegSlide(void 0,singleDelegData,mode)}},constructEditData:function(data,param,mode){data.errors?DelegationSettings.Edit.constructDelegError(mode,data.errors):DelegationSettings.Modal.openDelegSlide(void 0,data,mode)},constructDelegError:function(mode,errorMsg){var messageHTML=$('<div class="col-lg-12 text-center" id="viewErrorModal"><div class="PArds"></div><h2 class="ZPNdt">'+errorMsg+"</h2></div>"),delegModalDiv=$("#"+Layout.Page.pageId).find("#delegModal");delegModalDiv.find("#viewErrorModal").remove(),delegModalDiv.modal("show"),delegModalDiv.find(".modal-header h6").html(DelegationSettings.Edit.getModalHeaderStr(mode)),delegModalDiv.find(".modal-body form").addClass("zpl_DNI"),delegModalDiv.find(".modal-body").append(messageHTML),delegModalDiv.find(".modal-footer .btn-default").removeClass("zpl_DNI")},getModalHeaderStr:function(mode){return"view"===mode?ZPI18N.getString("zp.viewdelegation"):"edit"===mode?ZPI18N.getString("zp.editdelegheader"):ZPI18N.getString("zp.adddeleghdr")}},DelegationSettings.Delete={deleteRecord:function(delegationId){if(void 0!==delegationId)if(isadmin||DelegationSettings.View.isDelegationAllowed){var deleteAlertMessage=new DeleteAlertMessage;deleteAlertMessage.title=ZPI18N.getString("zp.delegdelhdr"),deleteAlertMessage.despcription=ZPI18N.getString("zp.delegdeldesc"),deleteAlertMessage.callback=function(){DelegationSettings.Delete.sendDeleteRequest(delegationId)},deleteAlertMessage.show()}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.deniedtodeltdelegperm"))},sendDeleteRequest:function(delegationId){ZPeople.Request.send(DelegationSettings.DELEGATION_URL,{method:"delegationOperation",conreqcsr:csrfToken,mode:"delete",delegationId:delegationId},DelegationSettings.Delete.showMessage)},showMessage:function(data,params){if(data.errors)ZPeople.Message.failure(data.errors);else if(data.success&&params.delegationId){ZPeople.Message.success(data.success);var oldSingleDeleg=ZPServices.getObjectFormArray(DelegationSettings.DELEGATION_JSON,"delegationId",params.delegationId,!1,!0),selectedRow=DelegationSettings.DELEGTABLE_ID.find("tbody [delegationid="+params.delegationId+"]");"delete"===params.mode&&(DelegationSettings.DELEGATION_JSON.splice(oldSingleDeleg.index,1),selectedRow.remove(),DelegationSettings.DELEGTABLE_ID.find("tbody tr").length<1&&DelegationSettings.Common.emptyData())}}},DelegationSettings.Common={emptyData:function(){DelegationSettings.PAGE_ID.find("#add_delegation_btn").addClass("zpl_DNI"),DelegationSettings.DELEGTABLE_ID.parent(".zpl_tblres").addClass("zpl_DNI"),DelegationSettings.View.EMPTY_PAGE=new EmptyPages("zp_nd_template",ZPI18N.getString("zp.nodeleghdr"),ZPI18N.getString("zp.nodelegdesc"),DelegationSettings.PAGE_ID.find('[label="DelegEmptPage"]')),DelegationSettings.View.EMPTY_PAGE.setButton(ZPI18N.getString("zp.createdelegbtn"),DelegationSettings.View.createDeleg),DelegationSettings.View.EMPTY_PAGE.show()},removeEmptyData:function(){DelegationSettings.PAGE_ID.find("#add_delegation_btn").removeClass("zpl_DNI"),DelegationSettings.DELEGTABLE_ID.parent(".zpl_tblres").removeClass("zpl_DNI"),DelegationSettings.View.EMPTY_PAGE.remove(),DelegationSettings.View.EMPTY_PAGE=null}};var HRCaseFAQ={removeFileDiv:function(obj){Layout.Page.container;var e=window.event;e.cancelBubble=!0,e.stopPropagation(),""!=$(obj).closest("div.attachedFile").attr("fileid")&&void 0!=$(obj).closest("div.attachedFile").attr("fileid")?$(obj).closest("div.attachedFile").addClass("zp_dyn"):$(obj).closest("div.attachedFile").remove()},ziaFaqSearch:function(data,ele){var params={mode:"searchFAQ",conreqcsr:csrfToken};params.searchStr=data.userInput;var faqListDiv="";if(ZPeople.Request.sendAsyncPost("/searchFAQ.zp",params,function(data1){faqListDiv=HRCaseFAQ.listDummy(data1.FAQ_LIST)}),""!=faqListDiv){$(ele).append(faqListDiv);var parent=$(ele).parent();$(parent).attr("style","max-inline-size: 800px; overflow: auto;")}else $(ele).parent().parent().removeClass("noPaddingBotTxt"),$(ele).append("No Results Found")},ziaFaqReport:function(data,ele){var repData={},param={conreqcsr:csrfToken,method:"faqReport"};if(param.faqId=data.faqId,ZPeople.Request.sendAsyncPost("/faqReport.zp",param,function(data1){repData=data1}),jQuery.isEmptyObject(repData)||0==repData.disLikeCount&&0==repData.likeCount)$(ele).parent().parent().removeClass("noPaddingBotTxt"),$(ele).append("No Data Found");else{Solution.constructFaqChart(repData,ele);$(ele).width("400"),$(ele).height("200");var parent=$(ele).parent();$(parent).attr("style","max-inline-size: 800px; overflow: auto;")}},listDummy:function(data,faqQues,ele){var faqListDiv='<div class="ZPNdata"><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><h5 id="zp_views_nodata">'+ZPI18N.getString("zp.nofaqs")+"</h5></div>";return data.length>0&&(faqListDiv="",$.each(data,function(i,faqObj){faqObj='<div class="zp_Lst" id="faqRow" faqId='+faqObj.faqID+'><div><div class="zp_Ldtl "><div class="zp_Tdts"><h3>'+faqObj.query+"</h3><span>"+ZPeople.escapeHtml(ZPFeeds.getTextContent(faqObj.answer))+"</span></div></div></div></div>";faqListDiv+=faqObj}),faqQues=ZSEC.Encoder.encodeForHTML(faqQues),faqListDiv='<div class="zp_cAZfaqHd">'+faqQues+"</div>"+faqListDiv+'<div class="zp_cAZfaqBt"><button btext="yes">'+ZPI18N.getString("zp.notrelevant")+"</button></div>"),faqListDiv},listTaskBot:function(data){return data.length>0&&(faqListDiv="",$.each(data,function(i,taskObj){var rd="";taskObj.endtime==ZPI18N.getString("zp.noduedate")&&(rd="rd");taskObj='<div class="zp_Lst" id="taskRow"><div><div class="zp_Ldtl"><div class="zp_Tdts"><i id="taskBotCmp" class="IC-rou-tik"></i><h3>'+taskObj.name+'</h3></div></div><div class="zp_Lsts"><em class="'+rd+'" title="'+taskObj.endtime+'">'+taskObj.endtime+"</em></div></div></div>";faqListDiv+=taskObj}),faqListDiv='<div class="zp_cAZfaqHd">Pending Task</div>'+faqListDiv),faqListDiv},faqViewBot:function(faqObj){if(faqObj.faqID==$("#faqDetViewBot").attr("faqId"))$("#faqDetViewBot").removeClass("clsZia");else{$("#faqDetViewBot").remove();var param={conreqcsr:csrfToken,method:"singleFAQDetails",faqId:faqObj.faqID,source:"2"};ZPeople.Request.sendAsyncPost("/faqInfoPanel.zp",param,function(data){var v=data[0],grn="",red="",likeHanddisCls="";v.reactObj.hasOwnProperty("isReactedType")&&(likeHanddisCls="cPn",1==v.reactObj.isReactedType?grn="grn":0==v.reactObj.isReactedType&&(red="red"));var moreDiv=faqObj.answer.length>3e3||void 0!=v.filesList&&0!=v.filesList.length?'<div class="zp_txt zp_ln"><a id="faqDetViewBotMor" href="javascript:;">Show More</a></div>':"",mr10=is5_0Enabled?"MR10":"",closeClass=is5_0Enabled?"PI_cls":"IC-cls",faqView='<div id="faqDetViewBot" faqId="'+v.faqID+'" class="zp_cAziaInf"><div class="zp_cAzfIn zp_faqs"><div class="zp_cAzHd"><h3>'+v.query+'</h3><i id="faqDetViewBotCls" class="'+closeClass+'"></i></div><div class="zp_cAzBd"><div id="faqDetViewBotAns" class="zp_txt">'+ZPFeeds.Activity.getRawSmileys(v.answer)+"</div>"+moreDiv+'<div class="zp_pvbt"><div class="zp_txt"><p>'+ZPI18N.getString("zp.helpfull")+'</p><span class="'+likeHanddisCls+" "+mr10+'"><i id="faqDetViewBotLik" class="IC-like '+grn+' "></i><em class="zpl_pl1">'+ZPI18N.getString("zp.yes")+'</em></span><span class="'+likeHanddisCls+'"><i id="faqDetViewBotUnLik" class="IC-unlike '+red+'"></i><em class="zpl_pl1">'+ZPI18N.getString("zp.no")+"</em></span></div></div></div></div></div>";$("body").append(faqView);var faqDetViewBotAns=$("#faqDetViewBotAns");faqDetViewBotAns.height(.7*$("#faqDetViewBot").height()),faqDetViewBotAns.css("overflow","hidden");var removeStyle=faqDetViewBotAns.find("[style]");$(removeStyle).css("line-height","").css("font-weight","").css("font-family","").css("font-size",""),$("#faqDetViewBotCls").off().on("click",function(e){$("#faqDetViewBot").addClass("clsZia")}),$("#faqDetViewBotLik").off().on("click",function(e){FAQ.likeFAQ(this,$("#faqDetViewBot").attr("faqId"),!0)}),$("#faqDetViewBotUnLik").off().on("click",function(e){$(this).hasClass("red")||$("#faqDetViewBotLik").hasClass("grn")||FAQ.disLikeFAQ(this,$("#faqDetViewBot").attr("faqId"),!0)}),$("#faqDetViewBotMor").off().on("click",function(e){var uri=window.location.origin+window.location.pathname;is5_0Enabled?uri+="#hrcase/faq/view-faqId:"+v.faqID:uri+="#hrcase/home/faq-viewid:"+v.faqID,window.open(uri)})})}}},Solution={cgyisAgentKV:{},startFaqList:[],index:1,isNextAvailable:!0,init:function(){var url=Layout.Page.hash,pageDiv=Layout.Page.container;if(-1!==url.indexOf("#hrcase/faq/list/view")){var faqId=Layout.Page.childUrlParam.faqId;Solution.faqDetailedView(faqId)}else-1!==url.indexOf("#hrcase/faq/list")&&(pageDiv.find("#faqDtls").remove(),pageDiv.find("[id=faqRow]").removeClass("sel"))},faqListFireScroll:function(){var pageDiv=Layout.Page.container;pageDiv.find("#faqDtls").remove(),pageDiv.find("[id=faqRow]").removeClass("sel"),Solution.isNextAvailable&&Solution.getFaqList(!0)},reloadSolutionList:function(){var titleDiv=HRCase.Header.headerDiv(ZPI18N.getString("zp.faqAbbre"));titleDiv+='<div class="zp_prvIcns"><ul><li id="faqSchIc"><i class="IC-lens"></i></li></ul></div><div id="faqSearchBar" class="zp_fqSrch DN"><div><label>'+ZPI18N.getString("zp.searchfaq")+'</label><input id="searchFaqInp" type="text"></div></div>',Layout.Page.container.find("[name=headerposition]").empty().append(titleDiv),Solution.getFaqList(!1)},faqToggleSearch:function(){var pageDiv=Layout.Page.container;if(pageDiv.find("#faqSearchBar").toggleClass("DN"),pageDiv.find("#faqSearchBar").hasClass("DN")){if(Solution.startFaqList.length>0){var faqList=pageDiv.find("#faqList");$(faqList).find("[id=faqRow]").remove(),Solution.listRow(Solution.startFaqList,"#faqList"),$(faqList).find(".ZPNdata").remove()}}else pageDiv.find("#searchFaqInp").val(""),pageDiv.find("#searchFaqInp").trigger("focus")},expandCgyDetails:function(getThis){var categoryId=$(getThis).attr("categoryid"),categoryData=HRCategory.userDetails[categoryId];if(void 0==categoryData&&$.isEmptyObject(categoryData)){var categoryprm={method:"fetchCatalogDetails",categoryId:categoryId,conreqcsr:csrfToken,mode:USER_VIEW};$.ajax({url:"/fetchCatalog.zp",type:"POST",data:categoryprm,async:!1,success:function(data){HRCategory.userDetails[categoryId]=data,categoryData=data}})}var pageDiv=Layout.Page.container,faqSideCgyList=pageDiv.find("#faqSideCgyList"),thisCgy=$(faqSideCgyList).find("[cgydetails="+categoryId+"]");if($(faqSideCgyList).find("[categoryid]").not(getThis).removeClass("open"),$(faqSideCgyList).find("[cgydetails]").not(thisCgy).removeClass("open"),$(getThis).addClass("open"),0==$(faqSideCgyList).find("[cgydetails="+categoryId+"]").length){var desc="",agenDetails='<div class="zp_ttl"><span>Agent</span></div>',relContent="";""!=categoryData.description&&"<div><br /></div>"!=categoryData.description&&(desc='<div class="zp_ttl"><span>Descriptions</span><i class="IC-pen-1px"></i></div><div class="zp_txt">'+ZPFeeds.Activity.getSmileys(categoryData.description)+"</div>"),$.each(categoryData.categoryConfiguration,function(i,v){if(agenDetails+=HRCategory.View.cloneAgentRow(v.categoryAgents,!0),0!==v.categoryReferences.length){relContent='<div class="zp_ttl"><span>Related Contents</span></div>';var Agenttag=HRCategory.View.cloneContentRow(v.categoryReferences,categoryId,!0);$(Agenttag).addClass("zp_txt")}});var cgyHtml="<div cgydetails="+categoryId+' class="zp_ctDts open"><div class="zp_Clnd">'+desc+agenDetails+relContent+"</div></div>";$(getThis).after(cgyHtml)}else $(getThis).toggleClass("open"),$(faqSideCgyList).find("[cgydetails="+categoryId+"]").toggleClass("open");var cateDy=pageDiv.find("[cgydetails="+categoryId+"]");$(cateDy).find(".zp_Tg").parent().addClass("zp_txt")},getFaqList:function(isFireScroll){var pageId=Layout.Page.container;pageId.addClass("zp_faqs");if(pageId.find("#faqSchIc").off().on("click",function(e){Solution.faqToggleSearch()}),!isFireScroll){pageId.find("#faqList").addClass("zp_dyn"),pageId.find("#faqRwrap").find(".zp_lwrap").append(ZPeople.LOADING_HTML);var searchFaqInp=pageId.find("#searchFaqInp"),typingTimer=null;$(searchFaqInp).off("keyup").on("keyup",function(e){if(clearTimeout(typingTimer),typingTimer=setTimeout(function(){Solution.searchFAQList()},750),""==pageId.find("#searchFaqInp").val().trim()){var faqList=pageId.find("#faqList");Solution.startFaqList.length>0?($(faqList).find("[id=faqRow]").remove(),Solution.listRow(Solution.startFaqList,"#faqList"),$(faqList).find(".ZPNdata").remove()):(faqListDiv='<div class="ZPNdata"><div><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><label id="zp_views_nodata"><p>'+ZPI18N.getString("zp.nofaqs")+"</p></label></div></div>",$(faqList).append(faqListDiv))}}),$(searchFaqInp).off("keydown").on("keydown",function(e){clearTimeout(typingTimer)})}var param={conreqcsr:csrfToken,method:"faqList",index:Solution.index};ZPeople.Request.send("/faqList.zp",param,function(data){Solution.startFaqList.push.apply(Solution.startFaqList,data.FAQ_LIST),Solution.index+=25,Solution.isNextAvailable=data.isNextAvailable,Solution.listRow(data.FAQ_LIST,"#faqList",!1,!0);var url=Layout.Page.hash;if(pageId.find("#faqList").removeClass("zp_dyn"),pageId.find("#faqRwrap").find("#zp_page_loading").remove(),-1!==url.indexOf("#hrcase/faq/list/view")){var faqId=Layout.Page.childUrlParam.faqId,faqRw=pageId.find("[id=faqRow][faqid="+faqId+"]");$(faqRw).addClass("sel");var topVal=$(faqRw).offset().top;pageId.find("#faqList").scrollTop(topVal-105)}})},searchFAQList:function(){var pageId=Layout.Page.container;if(pageId.find("#searchFaqInp").val().trim().length>=2){Solution.closeSlide(),pageId.find("#faqList").addClass("zp_dyn");var faqList=pageId.find("#faqList");$(faqList).find(".ZPNdata").remove(),pageId.find("#faqRwrap").find(".zp_lwrap").append(ZPeople.LOADING_HTML);var params={mode:"searchFAQ",conreqcsr:csrfToken};params.searchStr=pageId.find("#searchFaqInp").val();faqList=pageId.find("#faqList");$(faqList).find("[id=faqRow]").remove(),ZPeople.Request.send("/searchFAQ.zp",params,function(data){Solution.listRow(data.FAQ_LIST,"#faqList"),pageId.find("#faqList").removeClass("zp_dyn"),pageId.find("#faqRwrap").find("#zp_page_loading").remove()})}},listRow:function(data,id,isDoubleSlider,isFireScroll){var faqListDiv="";if(data.length>0?$.each(data,function(i,faqObj){faqListDiv+='<div class="zp_Lst" id="faqRow" faqId='+faqObj.faqID+'><div><div class="zp_Ldtl "><div class="zp_Tdts"><h3>'+faqObj.query+"</h3><span>"+ZPeople.escapeHtml(ZPFeeds.getTextContent(faqObj.answer))+'</span><em class="red">'+faqObj.catalogName+"</em></div></div></div></div>"}):isFireScroll||(faqListDiv='<div class="ZPNdata"><div><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><label id="zp_views_nodata"><p>'+ZPI18N.getString("zp.nofaqs")+'</p><div id="faqNodataBtn" class="zp_btn"><button id="faqNoBtnAddCase" class="zpthm">'+ZPI18N.getString("zp.askaquestion")+"</button></div></label></div></div>"),faqListDiv=$(faqListDiv),$(id).append(faqListDiv),data.length>0)$.each(faqListDiv,function(i,val){$(val).off().on("click",function(e){isDoubleSlider?HRCaseBand.faqListClick(this,!0):Solution.faqListClick(this)})});else{var faqNoBtn=$(faqListDiv).find("#faqNoBtnAddCase");$(faqNoBtn).off().on("click",function(e){var subject=Layout.Page.container.find("#searchFaqInp").val();Solution.faqNoDataClick(subject)})}},faqNoDataClick:function(subject){Layout.Page.container;HRCaseBand.serviceView(),setTimeout(function(){$("#addHRCase").find("#caseSubject").val(subject)},300)},faqListClick:function(getThis){var faqId=$(getThis).attr("faqid"),url=Layout.Page.hash,pageId=Layout.Page.container;-1!=url.indexOf("#hrcase/faq/list")?(window.location.href="#hrcase/faq/list/view-faqId:"+faqId,pageId.find("#faqDtls").find("#zp_page_loading").remove(),pageId.find("div[faqid]").removeClass("sel"),pageId.find('div[faqid = "'+faqId+'"]').addClass("sel")):-1!=url.indexOf("hrcase/home")?CasesHome.faqListHomeClick(faqId,!0):Solution.faqDetailedView(faqId)},faqDetailedView:function(faqId,id,isDoubleSlider){var pageId=void 0!=id?id:Layout.Page.container,param={conreqcsr:csrfToken,method:"singleFAQDetails",faqId:faqId};ZPeople.Request.sendAsyncPost("/faqInfoPanel.zp",param,function(data){if(pageId.find("#faqDtls").remove(),null!=data&&data.length>0){var v=data[0],iconsHtml=CommonTemplates.getIconMenuBar([{attributes:{onclick:"Solution.copyURL('"+faqId+"')",id:"faqCopyURL"},iconsList:[{class:"IC-url","data-placement":"bottom","data-toggle":"tooltip","data-original-title":ZPI18N.getString("zp.lms.settings.copyurl")}]},{attributes:{onclick:"Solution.closeSlide()",id:"faqClose"},iconsList:[{class:"IC-cls","data-placement":"bottom","data-toggle":"tooltip","data-original-title":ZPI18N.getString("zp.close")}]}]),clearTag=$("<div>"+v.answer+"</div>");$(clearTag).find("[style]").css("font-style","");Solution.cgyisAgentKV[v.categoryId];var fhtml="",filesHtml="";void 0!=v.filesList&&0!=v.filesList.length&&($.each(v.filesList,function(i,val){var extn=val.fileName.substring(val.fileName.lastIndexOf(".")+1),icon=CommonTemplates.getFileIcon(extn);"1"==val.uploadSource||val.filePath.indexOf(workDriveUrl)>-1||val.filePath.indexOf(writerUrl)>-1||val.filePath.indexOf(sheetUrl)>-1||val.filePath.indexOf(showUrl)>-1?(icon="IC-wd",fhtml+='<div class="attachedFile filePosts"  attachcnt="'+i+'1" onclick=window.open("'+val.filePath+'") > <i class="'+icon+' fileType"></i><i onclick=window.open("'+val.filePath+'") class="IC-down"></i><div class="fileNameAndSize" ><label class="fileName" purpose="fileName">'+decodeURIComponent(val.fileName)+'</label> <span purpose="fileSize">'+(null!=val.filesize?val.filesize:"")+"</span> </div></div>"):fhtml+='<div class="attachedFile filePosts"  attachcnt="'+i+'1" onclick="casesFiles.getFilePreview(\''+val.fileUploadId+"','"+v.faqID+"','"+HRCASE_FAQ_ATTACHEMENTS+"','"+escape(val.fileName)+"','"+extn+"','"+(val.hasOwnProperty("previewFileId")?val.previewFileId:"")+'\')"> <i class="'+icon+' fileType"></i><i class="IC-down" onclick="casesFiles.getFileDownload(event,\''+val.fileUploadId+"','"+v.faqID+"','"+HRCASE_FAQ_ATTACHEMENTS+"',"+val.hasOwnProperty("previewFileId")+')"></i><div class="fileNameAndSize" ><label class="fileName" purpose="fileName">'+decodeURIComponent(val.fileName)+'</label> <span purpose="fileSize">'+(null!=val.filesize?val.filesize:"")+"</span> </div> </div>"}),filesHtml='<div class="zp_attach" id="caseAttch"> <div class="zp_pshead">'+ZPI18N.getString("zp.attachment")+'</div><div id="filesAttch" class="zp_Alst">'+fhtml+"</div></div>");var tagsHtml="";if(void 0!=v.tagsArr&&0!=v.tagsArr.length){var singleTag="";$.each(v.tagsArr,function(index,value){singleTag+='<div class="zp_Tg" tagId='+value.tagId+' zpmenu="true">'+value.tagName+"</div>"}),tagsHtml='<div class="zp_pvTgs"><div class="zp_pshead">'+ZPI18N.getString("zp.tags")+' :</div><div class="zp_txt"><div class="zp_Alst">'+singleTag+"</div></div></div>"}var grn="",red="",likeHanddisCls="";v.reactObj.hasOwnProperty("isReactedType")&&(likeHanddisCls="cPn",1==v.reactObj.isReactedType?grn="grn":0==v.reactObj.isReactedType&&(red="red"));var relFaq="";v.hasOwnProperty("relFaqArr")&&(relFaq='<div class="zp_ttl">'+ZPI18N.getString("zp.relfaq")+'</div><div id="relFaqList" class="zp_txt"></div>');var faqReport="";(HRCase.CASES_ADMIN.isAdmin||v.isCgyAgent)&&v.isReportAvailable&&void 0==isDoubleSlider&&(faqReport='<div id="faqReport" class="zp_fQAnls"><i class="IC-chart"></i>'+ZPI18N.getString("zp.analytics")+"</div>");var LikesHtml='<div class="zp_pvbt">'+faqReport+'<div class="zp_txt"><p>'+ZPI18N.getString("zp.helpfull")+' </p><span class="'+likeHanddisCls+'" id="faqLikeIc"><i onclick="FAQ.likeFAQ(this)" id="icLike" class="IC-like '+grn+'"></i><em>'+ZPI18N.getString("zp.yes")+'</em></span><span class="'+likeHanddisCls+'" id="faqDisLikeIc"><i onclick="FAQ.disLikeFAQ(this)" id="icDisLike" class="IC-unlike '+red+'"></i><em>'+ZPI18N.getString("zp.no")+'</em></span></div><div id="faqComDiv" class="zp_txt zp_pvCmts zp_dyn"><p>'+ZPI18N.getString("zp.comment")+'</p><textarea id="faqComment"></textarea><div class="zp_btn"><button onclick="FAQ.disLikeFAQ(this)" class="zpthm">'+ZPI18N.getString("zp.post")+"</button></div></div>"+relFaq+"</div>",faqPwrap='<div id="faqDtlsHeader" class="zp_pvhd"><div class="zp_mark" title="'+v.query+'" id="viewHeader"><span>'+v.query+"</span><div>"+v.catalogName+'</div></div><div class="zp_micn">'+iconsHtml+'</div></div><div class="zp_pvcnt" id="faqPreview"><div class="zp_pvcnt"><div id="faqAnswer"class="zp_Pdesc">'+ZPFeeds.Activity.getRawSmileys(v.answer)+"</div>"+filesHtml+tagsHtml+LikesHtml+"</div></div>",viewPg=void 0!=id?faqPwrap:'<div  id="faqDtls" class="zp_pv zp_faqs"><div id="faqDtlsWrap" class="zp_pwrap">'+faqPwrap+"</div></div>";pageId.append(viewPg),v.hasOwnProperty("relFaqArr")&&Solution.listRow(v.relFaqArr,pageId.find("#relFaqList"),isDoubleSlider);var removeStyle=pageId.find("#faqDtls").find("#faqAnswer").find("[style]");$(removeStyle).css("line-height","").css("font-weight","").css("font-family","").css("font-size",""),pageId.find("#faqReport").off("click").on("click",{faqId:faqId,categoryId:v.categoryId},function(event){Solution.faqReport(event.data.faqId,event.data.categoryId)}),void 0==id&&Layout.Page.container.parent().addClass("zp_Pshw"),-1==Layout.Page.hash.indexOf("#hrcase/faq/list/view")&&pageId.find(".zp_lwrap").addClass("zp_noRwrap");var faqDtls=pageId.find("#faqDtls");$(faqDtls).attr("faqId",faqId)}else ZPeople.Message.showFailureMsg("You don't have permission to view")})},copyURL:function(faqId){var successCopy,tempInput=document.createElement("input"),url="#hrcase/faq/list/view-faqId:"+faqId;tempInput.value=window.location.origin+window.location.pathname+url,document.body.appendChild(tempInput),tempInput.select(),document.execCommand("copy"),document.body.removeChild(tempInput);try{!1===(successCopy=document.execCommand("copy"))?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.copyfailed")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.copysuccess"))}catch(exception){successCopy=!1,ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.copyfailed"))}return successCopy},closeSlide:function(){var pageDiv=Layout.Page.container,pageParenDiv=pageDiv.parent();pageParenDiv.hasClass("zp_Pshw")&&pageParenDiv.removeClass("zp_Pshw"),-1!==Layout.Page.hash.indexOf("#hrcase/faq")&&(window.location.href="#hrcase/faq/list"),pageDiv.find("#faqDtls").remove(),pageDiv.find("#faqList").find("[id=faqRow]").removeClass("sel")},faqReport:function(faqId,categoryId){var pageDiv=Layout.Page.container,param={conreqcsr:csrfToken,method:"faqReport"};param.faqId=faqId,param.categoryId=categoryId,ZPeople.Request.send("/faqReport.zp",param,function(data){var faqRepHtml=Solution.faqReportHtml(data);pageDiv.find("#faqDtls").append(faqRepHtml),0!=data.disLikeCount||0!=data.likeCount?(Solution.constructFaqChart(data,"faqDonutChart"),data.hasOwnProperty("likeEmpArr")&&data.likeEmpArr.length>0?(pageDiv.find("#faqRepWrap").find("[name=faqLikenDisLike][ltype=1]").addClass("sel"),pageDiv.find("#faqDisLikedPpl").addClass("DN"),pageDiv.find("#faqLikedPpl").removeClass("DN")):data.hasOwnProperty("disLikeEmpCmtArr")&&data.disLikeEmpCmtArr.length>0&&(pageDiv.find("#faqRepWrap").find("[name=faqLikenDisLike][ltype=0]").addClass("sel"),pageDiv.find("#faqLikedPpl").addClass("DN"),pageDiv.find("#faqDisLikedPpl").removeClass("DN")),pageDiv.find("#faqDtlsWrap").toggleClass("DN"),pageDiv.find("[name=faqLikenDisLike]").off("click").on("click",function(event){Solution.faqLikenDisLikeToggle($(this).attr("ltype"))})):(pageDiv.find("#faqRepNodata").removeClass("zp_dyn"),pageDiv.find("#faqRepInfo").addClass("DN")),pageDiv.find("#faqRepIcBack").off("click").on("click",function(event){pageDiv.find("#faqRepWrap").remove(),pageDiv.find("#faqDtlsWrap").removeClass("DN")})})},faqLikenDisLikeToggle:function(type){var pageDiv=Layout.Page.container;pageDiv.find("#faqRepWrap").find("[name=faqLikenDisLike]").removeClass("sel"),pageDiv.find("#faqRepWrap").find("[name=faqLikenDisLike][ltype="+type+"]").addClass("sel"),1==type?(pageDiv.find("#faqDisLikedPpl").addClass("DN"),pageDiv.find("#faqLikedPpl").removeClass("DN")):0==type&&(pageDiv.find("#faqLikedPpl").addClass("DN"),pageDiv.find("#faqDisLikedPpl").removeClass("DN"))},faqReportHtml:function(data){var headerDiv='<div class="zp_header"><h2><i id="faqRepIcBack" class="IC-ar-lft"></i><font>'+ZPI18N.getString("zp.analytics")+'</font></h2><div class="zp_prvIcns"><ul><li onclick="Solution.closeSlide()"><i class="IC-cls" data-placement="bottom" data-toggle="tooltip" data-original-title='+ZPI18N.getString("zp.close")+"></i></li></ul></div></div>",noDataHTMl='<div class="ZPNdata zp_dyn" id="faqRepNodata"><div><i class="CR-nodata-rpt"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><label id="zp_views_nodata"><p>'+ZPI18N.getString("zp.nodatafound")+"</p></label></div></div>",faqChartDiv='<div class="zp_FqChrt"><div id="faqDonutChart"></div><div class="zp_rpRts"><ul><li class="grnDt"><span>'+ZPI18N.getString("zp.like")+"</span><em>"+data.likeCount+"</em></li><li><span>"+ZPI18N.getString("zp.dislike")+"</span><em>"+data.disLikeCount+"</em></li></ul></div></div>",likeBar="",likePplHtml="";data.hasOwnProperty("likeEmpArr")&&data.likeEmpArr.length>0&&(likeBar='<li name="faqLikenDisLike" ltype="1"><span> <i class="IC-like"></i> '+ZPI18N.getString("zp.like")+"</span></li>",likePplHtml=Solution.faqLikesPplConstruct(data.likeEmpArr));var disLikeBar="",disLikePplHtml="";return data.hasOwnProperty("disLikeEmpCmtArr")&&data.disLikeEmpCmtArr.length>0&&(disLikeBar='<li name="faqLikenDisLike" ltype="0"><span> <i class="IC-unlike"></i> '+ZPI18N.getString("zp.dislike")+"</span></li>",disLikePplHtml=Solution.faqDisLikesPplConstruct(data.disLikeEmpCmtArr)),'<div id="faqRepWrap" class="zp_pwrap">'+headerDiv+noDataHTMl+'<div class="zp_pvcnt" id="faqRepInfo">'+faqChartDiv+('<div class="zp_csPvTb"><ul>'+likeBar+disLikeBar+"</ul></div>")+likePplHtml+disLikePplHtml+"</div></div>"},faqLikesPplConstruct:function(likeEmpArr){var eachLikeHtml="";return $.each(likeEmpArr,function(key,value){eachLikeHtml+='<li><div class="zp_Tg notg"><div class="ZP_photo pc5" empid='+value.zuid+' popup="user"><img src='+value.employeePhoto+"></div>"+value.name+"</div></li>"}),'<div id="faqLikedPpl" class="zp_TbDts"><ul>'+eachLikeHtml+"</ul></div>"},faqDisLikesPplConstruct:function(disLikeEmpCmtArr){var eachDisLikeHtml="";return $.each(disLikeEmpCmtArr,function(key,value){var comment="";value.hasOwnProperty("comment")&&(comment=value.comment),eachDisLikeHtml+='<div class="zp_TbDslk"><div class="ZP_photo pc5" empid='+value.zuid+' popup="user"><img src='+value.employeePhoto+'></div><div class="zp_tbNdts"><p>'+value.name+"</p><span>"+comment+'</span></div><div class="zp_tbTm">'+value.reactedTime+"</div></div>"}),'<div id="faqDisLikedPpl" class="zp_TbDts">'+eachDisLikeHtml+"</div>"},constructFaqChart:function(data,id){var pageId=Layout.Page.container,chart=new Highcharts.Chart({chart:{renderTo:faqDonutChart,type:"pie"},title:{text:""},credits:{enabled:!1},tooltip:{formatter:function(){return"<b>"+this.point.name+"</b> : "+this.y}},plotOptions:{pie:{showInLegend:!1,states:{hover:{enabled:!0}}},series:{point:{events:{click:function(){0!=this.y&&Solution.faqLikenDisLikeToggle(this.x)}}}}},colors:["#FF7270","#3EE0BA"],series:[{name:"Count",data:[["Dislike",data.disLikeCount],["Like",data.likeCount]],size:"127%",innerSize:"75%",dataLabels:{enabled:!1}}],exporting:{enabled:!1,chartOptions:{title:{text:"Faq Report - "+pageId.find("#faqDtls").attr("faqid")}},plotOptions:{series:{dataLabels:{enabled:!0}}},pie:{showInLegend:!0,dataLabels:{style:{cursor:"pointer"}}},buttons:{contextButton:{theme:{states:{hover:{stroke:"#000000",fill:null},select:{stroke:"#000000",fill:null}}},symbolStroke:"#bfbfbf"}},filename:"Faq Report - "+pageId.find("#faqDtls").attr("faqid")}});chart.innerText=chart.renderer.text("Total User : "+(data.disLikeCount+data.likeCount),120,105).css({fontSize:"16px",textAlign:"center"}).add()}},FAQ={TAGS_LIST:[],relatedFAQ:[],closeFAQSlider:function(){$("#sliderPopup").remove()},showShareFAQSlider:function(obj){var url=Layout.Page.hash,pageId=Layout.Page.container,param={conreqcsr:csrfToken,method:"relatedFAQ"},hasNoti=pageId.find("#zpntfn_modal").length;-1!==url.indexOf("#home/feeds/myfeed")||1==hasNoti?param.caseId=$(obj).closest("#actOuterCont").attr("streamid"):param.caseId=pageId.find("#caseDtls").attr("caseid"),$("#sliderPopup").remove(),$("body").append(CommonTemplates.sliderPop()),$("#sliderName").html(ZPI18N.getString("zp.attachfaq")),$("#sliderPopup").addClass("zp_srchFq zp_shw"),$("#sliderContent").remove(),$("#sliderPopup .zp_pop").append(ZPeople.LOADING_HTML),ZPeople.Request.send("/relatedFAQ.zp",param,function(data){var html="";data.FAQ_LIST.length>0?(html=FAQ.searchFAQList(data.FAQ_LIST,!0),FAQ.relatedFAQ=data.FAQ_LIST):(html='<div class="ZPNdata"><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><h5 id="zp_views_nodata">'+ZPI18N.getString("zp.nosuggestfaq")+"</h5></div>",FAQ.relatedFAQ=[]),FAQ.showFAQ(!0,html);var typingTimer=null;$("#sliderPopup").find("#searchFAQ").off("keyup").on("keyup",function(e){if($("#sliderPopup").find("#searchFAQ").val().trim().length>=3)clearTimeout(typingTimer),typingTimer=setTimeout(function(){FAQ.searchFAQ()},750);else if(""==$("#sliderPopup").find("#searchFAQ").val().trim()&&FAQ.relatedFAQ.length>0){var faqListHtml=FAQ.searchFAQList(FAQ.relatedFAQ,!0);$("#sliderPopup").find("#faqList").empty(),$("#sliderPopup").find("#faqList").append(faqListHtml)}}),$(sliderPopup).find("#searchFAQ").off("keydown").on("keydown",function(e){clearTimeout(typingTimer)})})},showFAQ:function(isSearchInputNeeded,faqListHtml,isCaseId){$("#sliderPopup").find("#zp_page_loading").remove(),$("#sliderPopup").find("#faqList").empty(),void 0!=isCaseId&&$("#sliderPopup").attr("caseId",isCaseId);var html='<div class="zp_pcnt"><div class="zp_Clnd">';isSearchInputNeeded&&(html+='<div class="zp_srchCont"><input type="text" placeholder='+ZPI18N.getString("zp.search")+'  id="searchFAQ"><i class="IC-lens"></i></div>'),html+='<div id="faqList" class="zp_txt">'+faqListHtml+"</div></div></div>",$("#sliderPopup").find(".zp_pop").append(html),$("#sliderPopup").find("#searchFAQ").trigger("focus"),$("#sliderPopup").find("[name=closeSlider]").off("click").on("click",function(){$("#sliderPopup").remove()})},searchFAQList:function(data,isShareButton){var div="";return $.each(data,function(key,value){div+='<div class="zpfaq" faqId='+value.faqID+'><div> <input  type="checkbox">';var toggleClick="";isShareButton&&(div+='<div class="zp_frt zp_micn"><ul><li ><b><div class="zp_hd"></div>  <span onclick ="FAQ.shareFAQ(this)">'+ZPI18N.getString("zp.attachfaq")+"</span></b> </li> </ul></div>",toggleClick='onclick="FAQ.toggleFAQ(this);"'),div+="<label "+toggleClick+' id="faqQuery" >',isShareButton&&(div+='<div class="zp_micn"> <ul> <li><b><div class="zp_hd"></div><span> <i class="IC-ar-rgt"></i></span></b></li></ul></div>'+value.query+"</label>"),div+="<span>"+value.answer,value.hasOwnProperty("filesList")&&(div+='<div class="zp_Alst"><ul>',$.each(value.filesList,function(i,v){"1"==v.uploadSource||v.filePath.indexOf(workDriveUrl)>-1||v.filePath.indexOf(writerUrl)>-1||v.filePath.indexOf(sheetUrl)>-1||v.filePath.indexOf(showUrl)>-1?div+='<li><span onclick=window.open("'+v.filePath+'") ><i class="IC-wd" ></i>'+decodeURIComponent(v.fileName)+"</span></li>":div+="<li><span onclick=\"FAQ.getFileView('"+v.fileUploadId+"','"+value.faqID+"','"+HRCASE_FAQ_ATTACHEMENTS+'\')"><i class="IC-docs"></i>'+decodeURIComponent(v.fileName)+"</span></li>"}),div+="</ul></div>"),div+="</span></div></div>"}),div},shareFAQ:function(ele){var url=Layout.Page.hash;$("#sliderPopup").remove();var faqDiv=$(ele).closest(".zpfaq");if(-1!==url.indexOf("home/feeds/myfeed")){var boxId=$("#actOuterCont").attr("streamid",$(faqDiv).closest("#sliderPopup").attr("caseId")),editor=ZPFeeds.Editor.editorList["cmt_editordiv_"+boxId.find("#cmtlistcont").attr("actfdk")];void 0!==editor&&(ZPFeeds.COMMENTEDITOR=editor)}guru8=ZPFeeds.COMMENTEDITOR;var faqid="sharefaq"+$(faqDiv).attr("faqid"),_faqEle=$(ZPFeeds.COMMENTEDITOR.doc).find("body").html()+'<div class="zp_cVrBx zp_cVfaQ" style="padding: 10px;background-color: #F5F5F5;border-radius: 5px;box-shadow: 0 0 4px rgba(0, 0, 0, 0.1) inset;"><h3 style="margin-top: 5px;"  name="'+faqid+'">'+ZPeople.escapeHtml($(faqDiv).find("#faqQuery").text())+"</h3></div>";ZPFeeds.COMMENTEDITOR.setContent(_faqEle)},searchFAQSlider:function(data){var html='<div class="zp_faqPop"  id="sliderPopup"><div class="zp_popup"> <i class="IC-cls" onclick="FAQ.closeFAQSlider();" ></i>';return 0!=data.length&&$.each(data,function(key,value){html+='<div class="zp_popHd"> <div class="zp_hdtit"><h2> <font>'+value.query+"</font> </h2> </div> </div>"}),html+=' <div class="zp_Pocnt" id="faqList">',html+=" </div> </div> </div>"},searchFAQ:function(faqId){Layout.Page.hash;var params={mode:"searchFAQ",conreqcsr:csrfToken};""!=$("#searchFAQ").val()&&(params.searchStr=$("#searchFAQ").val()),void 0!=faqId&&(params.faqId=faqId),ZPeople.Request.send("/searchFAQ.zp",params,function(data){var html="";0!=data.FAQ_LIST.length?void 0!=faqId?($("body").append(FAQ.searchFAQSlider(data.FAQ_LIST)),html=FAQ.searchFAQList(data.FAQ_LIST,!1)):html=FAQ.searchFAQList(data.FAQ_LIST,!0):void 0!=faqId?($("body").append(FAQ.searchFAQSlider(data.FAQ_LIST)),html='<div class="ZPNdata"><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><h5 id="zp_views_nodata">'+ZPI18N.getString("zp.faqremoved")+"</h5></div>"):html='<div class="ZPNdata"><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><h5 id="zp_views_nodata">'+ZPI18N.getString("zp.nofaqs")+"</h5></div>";var hdheight=$("#sliderPopup").find(".zp_popHd").height();$("#sliderPopup").find("#faqList").css({top:hdheight+"px"}),$("#sliderPopup").find("#faqList").empty().append(html),void 0!=faqId&&$("#sliderPopup").find("#faqList").find(".zpfaq").addClass("zp_drp")})},faqTemplate:function(){var url=Layout.Page.hash,feedSliderObj=Layout.Page.container.find("#zpntfn_modal"),queryHtml='<div class="zp_fm" id="faqQueryDiv"></div><span class="etxt zp_dyn" id="errMsgForQry">'+ZPI18N.getString("zp.mentionthesubject")+"</span>",cancelbtn='<button onclick="FAQ.closeSlider()">'+ZPI18N.getString("zp.cancel")+"</button>",saveAttachbtnHtml="";feedSliderObj.hasClass("in")?saveAttachbtnHtml='<button class="zpthm zpn_btn" id="submitAttachFAQBtn" onclick="FAQ.addFAQ(this)"><b></b><div class="zp_circular"></div><label>'+ZPI18N.getString("zp.saving")+"</label></button>":-1===url.indexOf("#home/feeds/myfeed")&&-1===url.indexOf("#hrcase/list/view")&&-1===url.indexOf("#hrcase/opencases/view")&&-1===url.indexOf("#hrcase/myrequest/view")&&-1===url.indexOf("#hrcase/allcases/view")&&-1===url.indexOf("#hrcase/unassigned/view")&&-1===url.indexOf("#hrcase/watchlist/view")&&-1===url.indexOf("#hrcase/escalation/view")&&-1===url.indexOf("#selfservice/cases/list")&&-1===url.indexOf("#selfservice/mycases/list")&&-1===url.indexOf("#home/dashboard")&&-1===url.indexOf("#hrcase/reports/requestedvsclosed")&&-1===url.indexOf("#hrcase/reports/overallreport")||(saveAttachbtnHtml='<button class="zpthm zpn_btn" id="submitAttachFAQBtn" onclick="FAQ.addFAQ(this)"><b></b><div class="zp_circular"></div><label>'+ZPI18N.getString("zp.saving")+"</label></button>");var saveAndNewBtn="";return-1===url.indexOf("#hrcase/category/view-categoryid")&&-1===url.indexOf("#hrcase/settings/categoryview-categoryid")||(saveAndNewBtn='<button  id="saveAndNewBtn" class="zpthm zpn_btn" saveAndNew="true" onclick="FAQ.addFAQ(this,true)" ><b></b><div class="zp_circular"></div><label>'+ZPI18N.getString("zp.saving")+"</label></button>"),'<div class="zp_whtbg"  id="newFAQ"><div class="zp_pop" id="faqDecEditorContainer"><div class="zp_Ptl"  id="addFaqHeader"><h3  id="faqCgyDiv"></h3></div><form id="addFaqForm" method="POST"  autocomplete="off" enctype="multipart/form-data" target="cgy_file_response" novalidate><div class="zp_pcnt" id="addFaqContent" onscroll="CommonTemplates.scrollfunction(\'addFaqHeader\',\'addFaqContent\')">'+queryHtml+'<div class="zp_fm" id="faqeditor"></div></div></form>'+('<div class="zp_btn"><button  id="submitFAQBtn" class="zpthm zpn_btn"  onclick="FAQ.addFAQ(this,true)" ><b></b><div class="zp_circular"></div><label>'+ZPI18N.getString("zp.saving")+"</label></button>"+saveAndNewBtn+saveAttachbtnHtml+cancelbtn+"</div>")+'</div><i class="IC-cls" title='+ZPI18N.getString("zp.close")+' onclick="FAQ.closeSlider()"></i></div>'},closeSlider:function(){$("body").find("#newFAQ").remove()},showFAQSlider:function(obj){var pageId=Layout.Page.container,url=Layout.Page.hash;$("body").find("#newFAQ").remove(),$("body").append(FAQ.faqTemplate);var cgeName="",cgeId="";pageId.find("#zpntfn_modal").hasClass("in")?(cgeName=$(obj).closest("#actOuterCont").find("#cgyName").text(),cgeId=$(obj).closest("#actOuterCont").find("#cgyName").attr("cgeid")):-1!==url.indexOf("#home/feeds/myfeed")?(cgeName=$(obj).closest("#actOuterCont").find("#cgyName").text(),cgeId=$(obj).closest("#actOuterCont").find("#cgyName").attr("cgeid")):-1!==url.indexOf("#hrcase/settings/categoryview")||-1!==url.indexOf("#hrcase/category/view")?(cgeName="",cgeId=Layout.Page.childUrlParam.categoryid):-1!==url.indexOf("#hrcase/")||-1!==url.indexOf("#selfservice")||-1!==url.indexOf("#home/dashboard")?(cgeName=$("#cgyListInp").prev().text(),cgeId=$("#cgyListInp").attr("selectedids")):(cgeName="",cgeId=pageId.find("#serviceView").attr("categoryid"));var faqHeadingText=""==cgeName?ZPI18N.getString("zp.addfaqbtn"):ZPI18N.getString("zp.addfaq",[cgeName]);$("#faqCgyDiv").text(faqHeadingText),$("#faqCgyDiv").attr("selectedids",cgeId),CommonTemplates.getInputTextBox({id:"faqQueryInput"},ZPI18N.getString("zp.question"),!0,$("#faqQueryDiv")),EditorTemplate.editorConstruct("faqeditor",!0,"addFaqContent"),EditorTemplate.replaceWithEditor("faqDecEditorContainer","descEditor",!0),ZPFeeds.Editor.editorList.descEditor.setContent(""),FAQ.descEditorAfterLoad(),$("#fAtch").remove(),$("#addFaqContent").append(CommonTemplates.chooseFileHtml()),$("#hcDFile").off("click").on("click",function(){HRCaseFileTag.fileUploadfn({id:"0"},$(this),"addFaqContent")}),$("#hcCFile").off("click").on("click",function(){HRCaseFileTag.fileUploadfn({id:"1"},$(this),"addFaqContent")}),$("#hcWFile").off("click").on("click",function(){HRCaseFileTag.fileUploadfn({id:"2"},$(this),"addFaqContent")}),FAQ.addTagsInp(),$("#submitAttachFAQBtn").find("b").html(ZPI18N.getString("zp.saveandattach")),$("#submitFAQBtn").find("b").html(ZPI18N.getString("zp.save")),$("#saveAndNewBtn").find("b").html(ZPI18N.getString("zp.saveNew")),$("#newFAQ").addClass("zp_shw"),setTimeout(function(){$("#addFaqContent").scrollTop($("#faqeditor").offset().top),$("#faqQueryInput").trigger("focus")},300)},editFAQ:function(obj){var pageId=Layout.Page.container,url=Layout.Page.hash;$("body").find("#newFAQ").remove(),$("body").append(FAQ.faqTemplate);var categoryId="";categoryId=-1!==url.indexOf("#hrcase/settings/categoryview")||-1!==url.indexOf("#hrcase/category/view")?Layout.Page.childUrlParam.categoryid:pageId.find("#serviceView").attr("categoryid");var params={mode:"fetchFaq",conreqcsr:csrfToken,faqId:$(obj).closest("div.zpfaq").attr("faqid"),categoryId:categoryId};ZPeople.Request.send("/fetchFaq.zp",params,function(data){CommonTemplates.removeErrorMessagesinContainerDiv("addFaqContent"),$("#addFaqContent").find(".attachedFile").remove(),$("#addFaqContent").attr("deletedfileid",""),$("#addFaqForm").attr("faqId",data.faqId),-1!==url.indexOf("#hrcase/settings/categoryview")||-1!==url.indexOf("#hrcase/category/view")?($("#faqCgyDiv").text(ZPI18N.getString("zp.editfaq")+"'"+pageId.find("#cName").text()+"'"),$("#faqCgyDiv").attr("selectedids",Layout.Page.childUrlParam.categoryid)):($("#faqCgyDiv").text(ZPI18N.getString("zp.editfaq")+"'"+pageId.find("#serviceView").find("#cgeName").text()+"'"),$("#faqCgyDiv").attr("selectedids",data.categoryId)),CommonTemplates.getInputTextBox({id:"faqQueryInput"},ZPI18N.getString("zp.enterquery"),!0,$("#faqQueryDiv")),$("#faqQueryInput").val(data.question),setTimeout(function(){$("#faqQueryInput").trigger("focus")},300),EditorTemplate.editorConstruct("faqeditor",!0,"addFaqContent"),EditorTemplate.replaceWithEditor("faqDecEditorContainer","descEditor",!0),ZPFeeds.Editor.editorList.descEditor.setContent(ZPFeeds.Activity.getRawSmileys(data.answer,!1)),FAQ.descEditorAfterLoad(),$("#fAtch").remove(),$("#addFaqContent").append(CommonTemplates.chooseFileHtml()),$("#hcDFile").off("click").on("click",function(){HRCaseFileTag.fileUploadfn({id:"0"},$(this),"addFaqContent")}),$("#hcCFile").off("click").on("click",function(){HRCaseFileTag.fileUploadfn({id:"1"},$(this),"addFaqContent")}),$("#hcWFile").off("click").on("click",function(){HRCaseFileTag.fileUploadfn({id:"2"},$(this),"addFaqContent")}),$("#addFaqContent").find("div.attachedFile").remove();var fhtml="",filesHtml="";data.hasOwnProperty("Files")&&data.Files.length>0&&($.each(data.Files,function(i,val){var extn=val.fileName.substring(val.fileName.lastIndexOf(".")+1),icon=CommonTemplates.getFileIcon(extn);fhtml+='<div class="attachedFile filePosts" filepath="'+val.filepath+'" fileid="'+val.fileUploadId+'" attachcnt="'+i+'1"  onclick="casesFiles.getFilePreview(\''+val.fileUploadId+"','"+data.faqId+"','"+HRCASE_FAQ_ATTACHEMENTS+"','"+escape(val.fileName)+"','"+extn+"','"+(val.hasOwnProperty("previewFileId")?val.previewFileId:"")+'\')"> <i class="'+icon+' fileType"></i><i onclick="HRCaseFAQ.removeFileDiv(this)" class="IC-cls"></i><div class="fileNameAndSize"><label class="fileName" purpose="fileName">'+decodeURIComponent(val.fileName)+'</label> <span purpose="fileSize">'+(null!=val.filesize?val.filesize:"")+"</span> </div> </div>"}),filesHtml='<div class="zp_attach PL0" id="caseAttch"><div id="attchedFiles" class="zp_Alst clearfix">'+fhtml+"</div></div>"),$("#addFaqContent").append(filesHtml),FAQ.addTagsInp(data.tagsArr),$("#submitFAQBtn").find("b").html(ZPI18N.getString("zp.update")),$("#saveAndNewBtn").addClass("zp_dyn"),$("#newFAQ").addClass("zp_shw"),Solution.closeSlide()})},descEditorAfterLoad:function(){var editor=ZPFeeds.Editor.editorList.descEditor;editor.afterEditorLoad(function(){$(editor.doc).find("body").on("keyup",function(e){var evtobj=window.event?event:e;if(17==evtobj.which||91==evtobj.which||93==evtobj.which||224==evtobj.which){var removeStyle=$(editor.doc).find("body").find("[style]");$(removeStyle).css("line-height","").css("font-weight","").css("font-family","").css("font-size","")}})})},getTagsParamForMenu:function(tagArr){var params=[];return $.each(tagArr,function(index,value){var param1={};param1.text=value.tagName,param1.id=value.tagId,params.push(param1)}),params},addTagsInp:function(selArr){$("#addFaqContent").append('<div class="zp_fm" id="faqTagDiv"></div>');void 0!=selArr&&FAQ.getTagsParamForMenu(selArr);var menuObj={id:"tagsList",data:function(initObj){return FAQ.searchTags($(initObj).val())},enableAddNewItem:!0,checkbox:!0,noDataText:"",addNewData:{callback:function(obj,initobj){$(obj).attr("name").trim().length<2?($(initobj).siblings("div.zp_Tg").find('i[value="'+$(obj).attr("name")+'"]').trigger("click"),ZPeople.Message.showFailureMsg("Tag Length should atleast be 2")):$(obj).attr("name").trim().length>20&&($(initobj).siblings("div.zp_Tg").find('i[value="'+$(obj).attr("name")+'"]').trigger("click"),ZPeople.Message.showFailureMsg("Tag Length should not exceed be 20"))}}};CommonTemplates.getSelectMenu(menuObj,$("#faqTagDiv"),{id:"tagsInp",placeholder:ZPI18N.getString("zp.searchtags")},{isMandatory:!1,inputHeaderName:ZPI18N.getString("zp.tags")}),void 0!=selArr&&selArr.length>0&&$("#tagsInp").zpselect({selectedVal:FAQ.getTagsParamForMenu(selArr),needTag:!0,checkbox:!0,isMandatory:!1})},deleteFAQ:function(obj){var pageId=Layout.Page.container,url=Layout.Page.hash,categoryId="",mode=USER_VIEW;-1!==url.indexOf("#hrcase/settings/categoryview")||-1!==url.indexOf("#hrcase/category/view")?(categoryId=Layout.Page.childUrlParam.categoryid,-1!==url.indexOf("#hrcase/settings/categoryview")&&(mode=ADMIN_VIEW)):categoryId=pageId.find("#serviceView").attr("categoryid"),ZPeople.BSModal.confirm(function(e){var param={mode:"deleteFaq",conreqcsr:csrfToken,faqId:$(obj).closest("div.zpfaq").attr("faqid"),categoryId:categoryId};ZPeople.Request.send("/deleteFAQ.zp",param,function(data){"success"==data.status&&(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.faqdeletesuccessmsg")),HRCategory.View.updateFAQData([{faqID:param.faqId}],categoryId,mode,"delete"),pageId.find("#faqList").find("[faqid="+$(obj).closest("div.zpfaq").attr("faqid")+"]").remove(),!(pageId.find("#faqList").find(".zpfaq").length>0)&&pageId.find("#faqList").append(CommonTemplates.noDataSVG("faqList",!1,ZPI18N.getString("zp.nofaqs"))),Layout.CustomizedUrl.isService()&&ZPServices.updateHasFAQ(pageId.find("#faqList")))})},ZPI18N.getString("zp.deletefaq"),ZPI18N.getString("zp.faqdeletemsg"))},createTagsStr:function(params){var selectedIds=$("#tagsInp").attr("selectedids"),newTags=$("#tagsInp").attr("newvalues");void 0!=selectedIds&&selectedIds.length>0&&(params.tagsIds=selectedIds),void 0!=newTags&&newTags.length>0&&(params.createTags=newTags)},addFAQ:function(ele,isSave){Layout.Page.container,Layout.Page.hash;var isQueryEmpty=!1;if(""!=$("#faqQueryInput").val()&&null!=$("#faqQueryInput").val()&&void 0!=$("#faqQueryInput").val()||(CommonTemplates.setErrorMessageinTextBox($("#faqQueryInput")),isQueryEmpty=!0),!isQueryEmpty){isSave?"saveAndNewBtn"!=$(ele).attr("id")?CommonTemplates.waitTillSave("submitFAQBtn"):CommonTemplates.waitTillSave("saveAndNewBtn"):CommonTemplates.waitTillSave("submitAttachFAQBtn");var editor=ZPFeeds.Editor.editorList.descEditor,faqDesc=ZPFeeds.getSmileysAndMentions(editor.getContent(),!1),params={categoryId:$("#faqCgyDiv").attr("selectedids"),answer:faqDesc,question:$("#faqQueryInput").val()},recordId=$("#addFaqForm").attr("faqId"),deletedFileIds=[],attachment=[];if(void 0!=recordId&&(params.faqId=recordId,$("#addFaqContent div.zp_dyn[fileid]").each(function(i){deletedFileIds.push($(this).attr("fileid"))}),params.deletedFileIds=deletedFileIds.join(",")),FAQ.createTagsStr(params),$("#addFaqContent").find("div.attachedFile:not([fileid])").length>0){var formData=new FormData;formData.append("loginUserZUID",_ZUIDENRYPT),formData.append("formId",0),formData.append("tableName","P_HRCase_FAQ"),formData.append("conreqcsr",csrfToken);var uploadFromCloud=[],uploadFromWD=[],uploadFromDesktop=[];if($("#addFaqContent").find("div.attachedFile:not([fileid])").each(function(i){var uploadMode=$(this).data("uploadMode"),cloudUploadDoc=$(this).data("cloudUploadDoc"),WDUploadDoc=$(this).data("WDUploadDoc"),faqFileUpload=$(this).data("caseFileUpload");"cloudUpload"==uploadMode?uploadFromCloud.push(cloudUploadDoc):"localUpload"==uploadMode&&void 0!==faqFileUpload?uploadFromDesktop.push(faqFileUpload):"workDriveUpload"==uploadMode&&void 0!==WDUploadDoc&&uploadFromWD.push(WDUploadDoc)}),uploadFromDesktop.length>0&&(attachment=uploadFromDesktop,params.attachment=JSON.stringify(uploadFromDesktop),attachment=uploadFromDesktop),uploadFromCloud.length>0||uploadFromWD.length>0)formData.append("uploadFromCloud",JSON.stringify(uploadFromCloud)),formData.append("uploadFromWD",JSON.stringify(uploadFromWD)),formData.append("attachment",JSON.stringify(uploadFromDesktop)),formData.append("needJSONresponse",!0),$.ajax({url:"/fileUploadAction.zp",type:"POST",data:formData,contentType:!1,processData:!1,cache:!1,error:function(err){isSave?CommonTemplates.waitTillSave("submitFAQBtn"):CommonTemplates.waitTillSave("submitAttachFAQBtn");var error_reponse=JSON.parse(err);ZPeople.Message.showFailureMsg(error_reponse.error)},success:function(data){var allFiles=[];7e3==data.code&&$.each(data.message,function(i,v){var fileDetails={filePath:v.filePath,fileName:v.fileName};null==v.uploadSource||ZPSetupCommon.isEmpty(v.uploadSource)?fileDetails.uploadSource=0:fileDetails.uploadSource=v.uploadSource,allFiles.push(fileDetails)});var faqParams=params;faqParams.attachment=JSON.stringify($.merge(allFiles,attachment));var faqParms=[];faqParms.push(faqParams);var pars={faqConf:JSON.stringify(faqParms)};FAQ.addFaqRequest(pars,ele,isSave)}});else{(faqParms=[]).push(params);var pars={faqConf:JSON.stringify(faqParms)};FAQ.addFaqRequest(pars,ele,isSave)}}else{var faqParms;(faqParms=[]).push(params);pars={faqConf:JSON.stringify(faqParms)};FAQ.addFaqRequest(pars,ele,isSave)}}},addFaqRequest:function(object,ele,isSave){var url=Layout.Page.hash,faqParams=JSON.parse(object.faqConf);object.conreqcsr=csrfToken,object.mode="addFaq",$.post("/addFAQ.zp",object,function(data){if("success"==data.status){var isEdit=void 0!=faqParams[0].faqId;if(void 0!=faqParams[0].faqId?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.faqeditsuccessmsg")):ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.faqsuccessmsg")),"saveAndNewBtn"==$(ele).attr("id")?FAQ.resetFaqSlider():FAQ.closeSlider(),-1!==url.indexOf("#hrcase/settings/categoryview")?(HRCategory.View.updateFAQData(data.FAQLIST,faqParams[0].categoryId,ADMIN_VIEW,isEdit?"edit":"add"),FAQ.singleFaqRecord(data.FAQLIST,data.isAgent,"adminView")):-1!==url.indexOf("#hrcase/category/view")?(HRCategory.View.updateFAQData(data.FAQLIST,faqParams[0].categoryId,USER_VIEW,isEdit?"edit":"add"),FAQ.singleFaqRecord(data.FAQLIST,data.isAgent,"userView")):FAQ.singleFaqRecord(data.FAQLIST,data.isAgent,"adminView"),$(".zp-cmt-faq").remove(),!isSave){if(-1!==url.indexOf("home/feeds/myfeed")){var faqDiv=$(ele).closest(".zpfaq"),boxId=$("#actOuterCont").attr("streamid",$(faqDiv).closest("#sliderPopup").attr("caseId")),editor=ZPFeeds.Editor.editorList["cmt_editordiv_"+boxId.find("#cmtlistcont").attr("actfdk")];void 0!==editor&&(ZPFeeds.COMMENTEDITOR=editor)}$.each(data.FAQLIST,function(key,value){var faqid="sharefaq"+value.faqID,_faqEle=$(ZPFeeds.COMMENTEDITOR.doc).find("body").html()+'<div class="zp_cVrBx zp_cVfaQ" style="padding: 10px;background-color: #F5F5F5;border-radius: 5px;box-shadow: 0 0 4px rgba(0, 0, 0, 0.1) inset;"><h3 style="margin-top: 5px;"  name="'+faqid+'">'+value.query+"</h3></div>";ZPFeeds.COMMENTEDITOR.setContent(_faqEle)})}}else void 0!=faqParams[0].faqId?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.faqeditunsuccessmsg")):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.faqunsuccessmsg"))}).fail(function(err){isSave?CommonTemplates.waitTillSave("submitFAQBtn"):CommonTemplates.waitTillSave("submitAttachFAQBtn");var error_reponse=err.responseJSON;"faqConf"==error_reponse.paramName&&"PATTERN_NOT_MATCHED"==error_reponse.code?ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.projectattachmentnameerror")):ZPeople.Message.showFailureMsg(error_reponse.error)})},resetFaqSlider:function(){var pageDiv=$("#newFAQ");pageDiv.find("#errMsgForQry").addClass("zp_dyn"),ZPFeeds.Editor.editorList.descEditor.setContent(""),pageDiv.find("#faqTagDiv").find("[zpmenu]").remove(),pageDiv.find("#tagsInp").attr("newvalues","").attr("selectedids",""),pageDiv.find("#attchedFiles").remove(),pageDiv.find("#submitFAQBtn").removeClass("zpn_sbmt").prop("disabled",!1).find("b").html(ZPI18N.getString("zp.save")),pageDiv.find("#saveAndNewBtn").removeClass("zpn_sbmt").prop("disabled",!1).find("b").html(ZPI18N.getString("zp.saveNew")),pageDiv.find("#addFaqForm").removeAttr("zp_recordid"),$("#hcBrowseFile").val(""),pageDiv.find("#faqQueryInput").val(""),setTimeout(function(){pageDiv.find("#faqQueryInput").trigger("focus")},100)},singleFaqRecord:function(data,isAgent,mode){var pageId=Layout.Page.container,faqList=(Layout.Page.hash,""),faqID="";$.each(data,function(key,value){var iconMenu1="adminView"==mode||"userView"==mode&&isAgent?CommonTemplates.getIconMenuBar([{attributes:{onclick:"FAQ.editFAQ(this)"},iconsList:[{class:"IC-pen-1px","data-placement":"bottom","data-toggle":"tooltip","data-original-title":ZPI18N.getString("zp.edit")}]},{attributes:{onclick:"FAQ.deleteFAQ(this)"},iconsList:[{class:"IC-delete","data-placement":"bottom","data-toggle":"tooltip","data-original-title":ZPI18N.getString("zp.delete")}]}]):"",iconMenu2=CommonTemplates.getIconMenuBar([{attributes:{},iconsList:[{class:"IC-ar-rgt"}]}]);if(faqList='<div class="zpfaq" faqid=\''+value.faqID+'\'><div class="bbdr"><input type="checkbox"><div class="zp_frt zp_micn">'+iconMenu1+"</div><label  faqid="+value.faqID+' onclick="Solution.faqListClick(this);" > <div class="zp_micn zp_dyn">'+iconMenu2+"</div>"+value.query+"</label><span >"+value.answer,value.hasOwnProperty("filesList")){faqList+='<div class="zp_Alst zp_hglt"  ><ul>';var fileExtn="";$.each(value.filesList,function(i,v){fileExtn=v.fileName.substring(v.fileName.lastIndexOf(".")+1),faqList+="<li><span onclick=\"casesFiles.getFilePreview('"+v.fileUploadId+"','"+value.faqID+"','"+HRCASE_FAQ_ATTACHEMENTS+"','"+escape(v.fileName)+"','"+fileExtn+"','"+(v.hasOwnProperty("previewFileId")?v.previewFileId:"")+'\')"><i class="IC-docs"></i>'+decodeURIComponent(v.fileName)+"</span></li>"}),faqList+="</ul></div>"}faqList+="</span></div></div>",faqID=value.faqID}),pageId.find("#faqList").find("#noData").remove(),pageId.find("#faqList").find("div[faqid='"+faqID+"']").remove(),pageId.find("#faqList").append(faqList),Layout.CustomizedUrl.isService()&&ZPServices.updateHasFAQ(pageId.find("#faqList"))},faqList:function(data,isAgent,isSlider,mode){Layout.Page.container,Layout.Page.hash;var faqList="";0!=data.length?$.each(data,function(key,value){var iconMenu1="";isSlider||(iconMenu1="adminView"==mode||"userView"==mode&&isAgent?CommonTemplates.getIconMenuBar([{attributes:{onclick:"FAQ.editFAQ(this)"},iconsList:[{class:"IC-pen-1px","data-placement":"bottom","data-toggle":"tooltip","data-original-title":ZPI18N.getString("zp.edit")}]},{attributes:{onclick:"FAQ.deleteFAQ(this)"},iconsList:[{class:"IC-delete","data-placement":"bottom","data-toggle":"tooltip","data-original-title":ZPI18N.getString("zp.delete")}]}]):"");var iconMenu2=CommonTemplates.getIconMenuBar([{attributes:{},iconsList:[{class:"IC-ar-rgt"}]}]),onclick="",togCls="";"adminView"!=mode&&isSlider?onclick="FAQ.toggleFAQ(this);":(onclick="Solution.faqListClick(this);",togCls="zp_dyn");value.faqID;faqList+='<div class="zpfaq"   faqid=\''+value.faqID+'\'><div class="bbdr "><input type="checkbox"><div class="zp_frt zp_micn">'+iconMenu1+"</div><label faqid="+value.faqID+" onclick="+onclick+' > <div class="zp_micn '+togCls+'">'+iconMenu2+"</div>"+value.query+"</label><span>"+value.answer,value.hasOwnProperty("filesList")&&(faqList+='<div class="zp_Alst zp_hglt"><ul>',$.each(value.filesList,function(i,v){"1"==v.uploadSource||v.filePath.indexOf(workDriveUrl)>-1||v.filePath.indexOf(writerUrl)>-1||v.filePath.indexOf(sheetUrl)>-1||v.filePath.indexOf(showUrl)>-1?(icon="IC-wd",faqList+='<li><span onclick=window.open("'+v.filePath+'") ><i class="IC-wd" ></i>'+decodeURIComponent(v.fileName)+"</span></li>"):faqList+="<li><span onclick=\"FAQ.getFileView('"+v.fileUploadId+"','"+value.faqID+"','"+HRCASE_FAQ_ATTACHEMENTS+'\');" ><i class="IC-docs" ></i>'+decodeURIComponent(v.fileName)+"</span></li>"}),faqList+="</ul></div>"),faqList+="</span></div></div>"}):faqList+='<div id="noData" class="ZPNdata"><div><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><label id="zp_views_nodata"><p>'+ZPI18N.getString("zp.nofaqs")+"</p></label></div></div>";var html="";if(isSlider)html=faqList;else{var addIcon="adminView"==mode||"userView"==mode&&isAgent?'<a data-placement="bottom" data-toggle="tooltip" data-original-title='+ZPI18N.getString("zp.add")+' onclick="FAQ.showFAQSlider(this);">'+ZPI18N.getString("zp.add")+"</a>":"";html='<div class="zp_txt" id="faqDiv"  ><div class="zp_ttl">'+ZPI18N.getString("zp.faq")+addIcon+'</div><div id="faqList" class="zp_txt" >'+faqList+"</div></div>"}return html},toggleFAQ:function(obj){var faqDiv=$(obj).parent().parent();$(faqDiv).hasClass("zp_drp")?$(faqDiv).removeClass("zp_drp"):$(faqDiv).addClass("zp_drp")},getFileView:function(fileId,recordId,mode){var params={method:"getFilesDetails",conreqcsr:csrfToken,fileUploadId:fileId,mode:mode};ZPeople.Request.send("/getFileView.zp",params,function(data){$.each(data,function(key,value){var fileExtn=value.fileName.substring(value.fileName.lastIndexOf(".")+1);casesFiles.getFilePreview(value.fileUploadId,recordId,mode,escape(value.fileName),fileExtn,value.hasOwnProperty("previewFileId")?value.previewFileId:"")})})},createUpdateTags:function(tagName,tagId){var tagData={},params={method:"createUpdateTags",tagName:tagName,conreqcsr:csrfToken};return void 0!=tagId&&(params.tagId=tagId),ZPeople.Request.sendAsyncPost("/createUpdateTags.zp",params,function(data){jQuery.isEmptyObject(data)||(tagData.value=data.tagName,tagData.id=data.tagId,FAQ.TAGS_LIST.push(data))}),tagData},LikeOrDisLikeFaq:function(recordId,type,comment){var params={method:"LikeOrDisLikeFaq",recordId:recordId,type:type,conreqcsr:csrfToken};void 0!=comment&&comment.length>0&&(params.comment=comment);var status="";return ZPeople.Request.sendAsyncPost("/LikeOrDisLikeFaq.zp",params,function(data){status=data.status}),status},likeFAQ:function(getThis,faqId,isFromBot){var pageDiv=$(getThis).closest("#faqDtls");$(getThis).hasClass("grn")||$("#faqDetViewBotUnLik").hasClass("red")&&pageDiv.find("#icDisLike").hasClass("red")||(void 0!=faqId&&""!=faqId||(faqId=pageDiv.attr("faqid")),"success"==FAQ.LikeOrDisLikeFaq(faqId,1)&&($(getThis).addClass("grn"),isFromBot||pageDiv.find("#faqComDiv").addClass("zp_dyn")))},disLikeFAQ:function(getThis,faqId,isFromBot){var pageDiv=$(getThis).closest("#faqDtls"),faqComDiv=pageDiv.find("#faqComDiv");if(isFromBot||$(getThis).hasClass("red")||pageDiv.find("#icLike").hasClass("grn")||!$(faqComDiv).hasClass("zp_dyn")){if(isFromBot||!pageDiv.find("#icDisLike").hasClass("red")&&!pageDiv.find("#icLike").hasClass("grn")&&!$(faqComDiv).hasClass("zp_dyn")){void 0!=faqId&&""!=faqId||(faqId=pageDiv.attr("faqid"));var comment="";isFromBot||(comment=pageDiv.find("#faqComment").val()),"success"==FAQ.LikeOrDisLikeFaq(faqId,0,comment)&&(isFromBot?$(getThis).addClass("red"):pageDiv.find("#icDisLike").addClass("red"),isFromBot||$(faqComDiv).addClass("zp_dyn"))}}else $(faqComDiv).removeClass("zp_dyn")},searchTags:function(tagStr,recordId){var tagsArr=[];if((tagStr=void 0==tagStr||""==tagStr?"":tagStr).length>=2){var params={method:"searchTags",conreqcsr:csrfToken};void 0!=tagStr&&(params.tagStr=tagStr.trim()),void 0!=recordId&&(params.recordId=recordId),ZPeople.Request.sendAsyncPost("/searchTags.zp",params,function(data){$.each(data,function(index,value){var param1={};param1.value=value.tagName,param1.id=value.tagId,tagsArr.push(param1)})})}return tagsArr},getAllTags:function(){var params={method:"getAllTags",conreqcsr:csrfToken};ZPeople.Request.sendAsyncPost("/getAllTags.zp",params,function(data){FAQ.TAGS_LIST=data})}},CasesHome={recentFAQ:[],faqMode:"",intialSetup:function(){CasesHome.faqMode="recentFaq";var pageDiv=Layout.Page.container;$.isEmptyObject(HRCase.STATUS)&&HRCases.getStatusList();var intialHtml='<div class="zp_content" id="casesHomeCont"> <div class="zp_cScatUr"> <div class="zp_cScatIn"> <div id="homeCgyPar" class="zp_cScatLst zp_cSUpFrnt"> <div class="zp_cScatLsIn" id="homeCgyList"></div> </div> <div class="zp_cScatSrh" > <h2>'+ZPI18N.getString("zp.gotaquestion")+"</h2> <p>"+ZPI18N.getString("zp.findyouranswers")+'</p> <div class="zp_cScatSrIn" id="faqSearchBar"> <input type="text" placeholder="'+ZPI18N.getString("zp.searchfaq")+'" id="faqSearchInp"> <button id="faqSearchBtn">'+ZPI18N.getString("zp.findhelp")+'</button> </div> <div  id="recentFaqPar" class="zp_cScatSrRt"> <div class="zp_cScatSrRtIn" id="recentFaqDiv"> <h3 id="searchTit">'+ZPI18N.getString("zp.recentfaq")+'</h3><span id="recentFaqCls">'+ZPI18N.getString("zp.close")+'</span><button id="moreFaq">'+ZPI18N.getString("zp.more")+'</button> <ul class="zp_cScatFqLst" id="faqHSearchList"></ul> <div id="notRelAskQue" class="zp_rsNwcs DN"><p><a id="notRelAskQueBtn">'+ZPI18N.getString("zp.notrelevant")+'</a></p></div></div> <div class="zp_pv zp_faqs" id="faqDtls"><div id="faqpwrap" class="zp_pwrap"></div></div> </div> </div> </div> </div>';pageDiv.append(intialHtml);var agentCgyIds=[];HRCategory.USERVIEW_CATEGORY_LIST.length<=0&&HRCategory.getCgyList(USER_CGY_LISTING),$.each(HRCategory.USERVIEW_CATEGORY_LIST,function(i,cgyObj){var iconObj=Icons.getIconClass(cgyObj.categoryIcon),isAgent=cgyObj.hasOwnProperty("isAgent")&&cgyObj.isAgent,agentTag=isAgent?'<i name="cgyAgentMore" class="IC-pen"></i><div class="zp_Tg" zpmenu="true">'+ZPI18N.getString("zp.agent")+"</div>":"",cgyLi='<div class="zp_crd zp_cScatCrd"><div class="zp_crdInn"><div class="zp_licn SC1"><label class="zp_serIcn"><i class="'+iconObj.iconClass+' zp_Si"></i></label>'+agentTag+'</div><div class="zp_dtl"><div class="zp_ctit"><b>'+cgyObj.categoryName+"</b><span>"+cgyObj.categoryShortDescription+'</span><button id="cgyAskUs">'+ZPI18N.getString("zp.askus")+"</button></div></div></div></div>";pageDiv.find("#homeCgyList").append(cgyLi);var addcasemode=cgyObj.hasOwnProperty("isAgent")&&cgyObj.isAgent||HRCase.isCaseAdmin(cgyObj.categoryId)?HRCase.AgentAddMode:ZPeople.SUB_USERLIST.length>1?HRCase.ManagerAddMode:"";pageDiv.find("#homeCgyList").find("[id=cgyAskUs]:last").off("click").on("click",{mode:addcasemode,categoryId:cgyObj.categoryId},function(event){window.location.href="#hrcase/askus-categoryid:"+event.data.categoryId}),isAgent&&(pageDiv.find("[name=cgyAgentMore]:last").on("click",{categoryId:cgyObj.categoryId},function(event){event.stopPropagation(),event.preventDefault(),window.location.href="#hrcase/category/view-categoryid:"+event.data.categoryId}),agentCgyIds.push(cgyObj.categoryId))}),pageDiv.find("#homeCgyPar").data("agentCgyIds",agentCgyIds);var param={conreqcsr:csrfToken,method:"faqList",mode:"recentFaq",index:0};ZPeople.Request.sendAsyncPost("/faqList.zp",param,function(data){data.FAQ_LIST.length>0&&(CasesHome.recentFAQ=data.FAQ_LIST,CasesHome.faqHomeSearchList(data.FAQ_LIST,"recentFaq"))}),pageDiv.find("#moreFaq").on("click",function(e){e.stopPropagation(),pageDiv.find("#faqHSearchList").html(""),pageDiv.find("#recentFaqPar").addClass("toggle fullScreen"),pageDiv.find("#moreFaq").addClass("DN"),CasesHome.faqHomeSearchList(pageDiv.find("#faqSearchInp").data("searchFaq"),"moreFaq")}),pageDiv.find("#faqSearchBtn").on("click",function(e){e.stopPropagation()}),pageDiv.find("#recentFaqPar").on("click",function(e){e.stopPropagation()}),pageDiv.find("#recentFaqCls").on("click",function(e){e.stopPropagation(),CasesHome.recentFaqClose()}),pageDiv.find("#casesHomeCont").on("click",function(e){e.stopPropagation(),CasesHome.recentFaqClose()}),pageDiv.find("#notRelAskQueBtn").off().on("click",function(e){Solution.faqNoDataClick(pageDiv.find("#faqSearchInp").val().trim())});var faqSearchInp=pageDiv.find("#faqSearchInp");$(faqSearchInp).on("click",function(e){e.stopPropagation(),""==$(faqSearchInp).val().trim()&&0!=CasesHome.recentFAQ.length&&(pageDiv.find("#moreFaq").addClass("DN"),pageDiv.find("#notRelAskQue").addClass("DN"),pageDiv.find("#searchTit").text(ZPI18N.getString("zp.recentfaq")),pageDiv.find("#homeCgyPar").removeClass("zp_cSUpFrnt"),pageDiv.find("#faqHSearchList").html(""),CasesHome.faqHomeSearchList(CasesHome.recentFAQ,"recentFaq"),pageDiv.find("#recentFaqPar").addClass("toggle"))});var typingTimer=null;pageDiv.find("#faqSearchInp").off("keyup").on("keyup",function(e){if(clearTimeout(typingTimer),typingTimer=setTimeout(function(){CasesHome.searchHomeFAQList()},750),""==pageDiv.find("#faqSearchInp").val().trim()){var faqList=pageDiv.find("#faqHSearchList");$(faqList).find(".ZPNdata").remove(),$(faqList).find("li").remove(),pageDiv.find("#faqHSearchList").find("[id=zp_page_loading]").remove(),pageDiv.find("#searchTit").text(ZPI18N.getString("zp.recentfaq")),pageDiv.find("#moreFaq").addClass("DN"),pageDiv.find("#notRelAskQue").addClass("DN"),CasesHome.recentFAQ.length>0?($(faqList).find("li").remove(),CasesHome.faqHomeSearchList(CasesHome.recentFAQ,"recentFaq"),$(faqList).find(".ZPNdata").remove()):(faqListDiv='<div class="ZPNdata"><div><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><label id="zp_views_nodata"><p>'+ZPI18N.getString("zp.nofaqs")+'</p><div id="faqNodataBtn" class="zp_btn"><button id="faqNoBtnAddCase" class="zpthm">'+ZPI18N.getString("zp.askaquestion")+"</button></div></label></div></div>",$(faqList).append(faqListDiv),CasesHome.faqNoDataClick())}}),pageDiv.find("#faqSearchInp").off("keydown").on("keydown",function(e){clearTimeout(typingTimer)})},recentFaqClose:function(){var pageDiv=Layout.Page.container;pageDiv.find("#recentFaqPar").hasClass("fullScreen")?(pageDiv.find("#faqHSearchList").html(""),pageDiv.find("#recentFaqPar").removeClass("fullScreen"),pageDiv.find("#moreFaq").removeClass("DN"),CasesHome.faqHomeSearchList(pageDiv.find("#faqSearchInp").data("searchFaq"),"searchFaq")):(pageDiv.find("#faqSearchInp").val(""),CasesHome.faqMode="recentFaq",pageDiv.find("#recentFaqPar").removeClass("toggle zp_Pshw fullScreen"),setTimeout(function(){pageDiv.find("#homeCgyPar").addClass("zp_cSUpFrnt")},200))},init:function(){var pageDiv=Layout.Page.container,url=Layout.Page.hash;if("#hrcase/home"!=url&&-1===url.indexOf("#hrcase/askus")||CasesHome.recentFaqClose(),$("#sliderPopup").remove(),$("#newFAQ").remove(),-1!==url.indexOf("#hrcase/askus")){var categoryId=Layout.Page.childUrlParam.categoryid,addcasemode=pageDiv.find("#homeCgyPar").data("agentCgyIds").includes(categoryId)||HRCase.isCaseAdmin(categoryId)?HRCase.AgentAddMode:ZPeople.SUB_USERLIST.length>1?HRCase.ManagerAddMode:"";HRCase.AddCase.addCasePage(addcasemode,categoryId)}else if(-1!==url.indexOf("#hrcase/home/faq")){var faqId=Layout.Page.childUrlParam.viewid;pageDiv.find("#faqSearchInp").trigger("click"),CasesHome.faqListHomeClick(faqId,!1),pageDiv.find("#homeCgyPar").removeClass("zp_cSUpFrnt")}},searchHomeFAQList:function(){var pageId=Layout.Page.container;if(pageId.find("#faqSearchInp").val().trim().length>=2){var faqList=pageId.find("#faqHSearchList");$(faqList).find(".ZPNdata").remove(),$(faqList).find("li").remove(),pageId.find("#faqHSearchList").find("[id=zp_page_loading]").remove(),pageId.find("#faqHSearchList").append(ZPeople.LOADING_HTML),pageId.find("#searchTit").text(ZPI18N.getString("zp.searchfaq"));var params={mode:"searchFAQ",conreqcsr:csrfToken};params.searchStr=pageId.find("#faqSearchInp").val(),ZPeople.Request.send("/searchFAQ.zp",params,function(data){$(faqList).find(".ZPNdata").remove(),$(faqList).find("li").remove(),pageId.find("#faqHSearchList").find("[id=zp_page_loading]").remove(),data.FAQ_LIST.length>0?(data.FAQ_LIST.length>5?pageId.find("#moreFaq").removeClass("DN"):pageId.find("#moreFaq").addClass("DN"),pageId.find("#notRelAskQue").removeClass("DN"),CasesHome.faqHomeSearchList(data.FAQ_LIST,"searchFaq")):(pageId.find("#homeCgyPar").removeClass("zp_cSUpFrnt"),pageId.find("#recentFaqPar").addClass("toggle"),pageId.find("#moreFaq").addClass("DN"),pageId.find("#notRelAskQue").addClass("DN"),faqListDiv='<div class="ZPNdata"><div><i class="CR-sr-faq"><i class="path1"></i><i class="path2"></i><i class="path3"></i><i class="path4"></i><i class="path5"></i><i class="path6"></i><i class="path7"></i><i class="path8"></i></i><label id="zp_views_nodata"><p>'+ZPI18N.getString("zp.nofaqavail")+'</p><div id="faqNodataBtn" class="zp_btn"><button id="faqNoBtnAddCase" class="zpthm">'+ZPI18N.getString("zp.askaquestion")+"</button></div></label></div></div>",$(faqList).append(faqListDiv),CasesHome.faqNoDataClick()),pageId.find("#faqHSearchList").find("[id=zp_page_loading]").remove()})}},faqNoDataClick:function(){var pageDiv=Layout.Page.container;pageDiv.find("#faqNoBtnAddCase").off().on("click",function(e){var subject=pageDiv.find("#faqSearchInp").val();Solution.faqNoDataClick(subject)})},faqListHomeClick:function(faqId,isRelatedFaq){var pageDiv=Layout.Page.container,url=Layout.Page.hash,recentFaqPar=pageDiv.find("#recentFaqPar"),recentClass=pageDiv.find("#faqClose").data("class");pageDiv.find("#faqpwrap").html(""),Solution.faqDetailedView(faqId,pageDiv.find("#faqpwrap"),!1),pageDiv.find("#faqDtls").attr("faqid",faqId);var faqClose=pageDiv.find("#faqClose");isRelatedFaq||(recentClass=$(recentFaqPar).attr("class")),faqClose.data("class",recentClass),faqClose.removeAttr("onclick"),faqClose.on("click",function(e){e.stopPropagation(),$(recentFaqPar).attr("class",pageDiv.find("#faqClose").data("class")),-1!==url.indexOf("#hrcase/home/faq")&&(window.location.href="#hrcase/home")}),$(recentFaqPar).addClass("zp_Pshw fullScreen")},faqHomeSearchList:function(faqList,mode){var pageDiv=Layout.Page.container,faqSearchInp=pageDiv.find("#faqSearchInp");"searchFaq"!=mode&&"recentFaq"!=mode||(CasesHome.faqMode=mode),$(faqSearchInp).data(mode,faqList),$.each(faqList,function(i,faqObj){if(null!=faqObj&&void 0!=faqObj&&""!=faqObj){var faqLi="<li><p>"+faqObj.query+'</p><a href="javascript:;">'+faqObj.catalogName+"</a></li>";pageDiv.find("#faqHSearchList").append(faqLi);var li=pageDiv.find("#faqHSearchList").find("li:last");if($(li).on("click",{faqId:faqObj.faqID},function(event){event.stopPropagation(),CasesHome.faqListHomeClick(event.data.faqId,!1)}),"searchFaq"==mode||"recentFaq"==mode)return CasesHome.faqMode=mode,i<4}})}},Blueprint={currentMode:"",MODE:"blueprint",currentBpData:{},criteriaFCObj:"",criteriaHTML:"",initiatePage:function(){var url=Layout.Page.hash;if(Layout.Page.container.find(".selectBox").select2(),-1!==url.indexOf("blueprint/add"))ZPeople.FireScroll.init(ProcessBuilder.getAllProcesses,"blueprint",Blueprint.constructList),ZPeople.FireScroll.setRecordCount(0),Blueprint.getList();else if(-1!==url.indexOf("blueprint/edit")){var processId=Layout.Page.urlparam.blueprintId;$('div[id^="admin-automation-blueprint-edit-"]').each(function(index){$(this).attr("id").includes(processId)||$(this).remove()}),Blueprint.showBlueprintloading(),ZPeople.Request.send("/blueprintCriteria.zp",{},function(resultData){Blueprint.criteriaHTML=resultData,ZPeople.Request.sendRequest("/processFlowAction.zp",{method:"getFComp",FormId:Layout.Page.urlparam.formid},"",function(fcresultData){Blueprint.criteriaFCObj=fcresultData[1].criteriaFCObj,ProcessBuilder.getProcessDetails(Blueprint.edit,processId)})})}else ZPeople.FireScroll.init(ProcessBuilder.getAllProcesses,"blueprint",Blueprint.constructList),ZPeople.FireScroll.setRecordCount(0),Blueprint.getList()},showBlueprintloading:function(){var pageId=$pageId();pageId.find("#loadingContainer").hide(),pageId.find("#loadingContainer").before(ZPeople.LOADING_HTML)},hideBlueprintloading:function(){var pageId=$pageId();pageId.find("#loadingContainer").show(),pageId.find("#loadingContainer").siblings("#zp_page_loading").remove()},getList:function(){var pageId=$pageId();pageId.find("#bluePrintCls, #createBpCancelBtn").on("click",function(){pageId.find("#blueprintModal").removeClass("in")}),$("#"+Layout.Page.pageId+" .Scrcont").remove(),Blueprint.processList={},ProcessBuilder.getAllProcesses(Blueprint.constructList),ProcessBuilder.Process.PickListValueDetails={},ProcessBuilder.Process.ConnectionIdVsName={},ProcessBuilder.TransitionIdVsDetails={}},constructList:function(resultData){if(1==resultData[0]){Blueprint.processList=resultData[1].Processes;var data=resultData[1].Processes;Blueprint.constructTableRows(data),resultData[1].IsAllProcessLoaded?ZPeople.FireScroll.getFireScrollPropertie().triggered=!0:ZPeople.FireScroll.getFireScrollPropertie().triggered=!1,ZPeople.FireScroll.increaseRecordCount(resultData[1].ProcessesLoaded)}else ZPeople.confirm(null,ZPI18N.getString("zp.error"),ZPI18N.getString("zp.error"),null,!0,!0);$("#bpTableBody").sortable({appendTo:"parent",helper:function(e,tr){var $originals=tr.children(),$helper=tr.clone();return $helper.children().each(function(index){$(this).width($originals.eq(index).width())}),$helper},handle:".IC-drag",items:"tr",update:function(){var bpTr=$("#bpTableBody").find("tr"),bpIdList=new Array;$.each(bpTr,function(ind,value){var Id=$(this).attr("Id");formId=pageId.find("#formsList").val(),void 0!==Id&&(bpIdList[ind]=Id)});var params={sequenceDetails:""+bpIdList,formId:formId,method:"saveProcessOrder"};ZPeople.Request.send("/processFlowAction.zp",params,function(resultData){})}}).disableSelection(),$pageId().find("#formsList option").length<=1&&Blueprint.getformsList()},constructTableRows:function(data){var pageId=$pageId(),bpListBody=(pageId.find("#bpTable"),pageId.find("#bpTableBody"));bpListBody.show();var transarr=[];$.each(data,function(i,bpListObj){var tdIcons,isProcessActive="Active"==bpListObj.ProcessStatus,tdDrag='<td class="PL0I text-center over-display"><i id="drag_'+bpListObj.Id+'" class="IC-drag"></i></td>',tdbpName='<td><a id="bpName_'+bpListObj.Id+'" href="#admin/automation/blueprint/edit-formid:'+bpListObj.Form.Id+"/blueprintId:"+bpListObj.Id+'"></a></td>',tdField='<td id="bpFieldName_'+bpListObj.Id+'"></td>',tdForm='<td id="bpFormName_'+bpListObj.Id+'"></td>',tdTransitions="<td>"+bpListObj.transitionsCount+"</td>",tdUser='<td><div class="ZP_photo FL" ><img src="'+bpListObj.userPhoto+'" class="FL"></div><div class="ML10 FL"><span class="bld DB">'+bpListObj.name+'</span><span class="dgry S13">'+bpListObj.ModifiedByDetails.DisplayDate+"</span></div></td>",tdSwitch='<td><label class="btnactive MT3 btnNew MT5"> <input class="cmn-toggle-small cmn-toggle-round-small" name="onoffswitch_'+bpListObj.Id+'" type="checkbox" id="myonoffswitch_'+bpListObj.Id+'" '+(isProcessActive?"checked":"")+' onchange="Blueprint.confirmDeactivate(this)"> <span></span> </label></td>';tdIcons=bpListObj.isSystem?'<td width="80" class="text-left over-display P0 PR0I"><a href="#admin/automation/blueprint/edit-formid:'+bpListObj.Form.Id+"/blueprintId:"+bpListObj.Id+'"><span class="IC-pen-1px CP MR10" data-toggle="tooltip" data-placement="bottom" data-original-title="Edit"></span></a></td>':'<td width="80" class="text-left over-display P0 PR15I"><a href="#admin/automation/blueprint/edit-formid:'+bpListObj.Form.Id+"/blueprintId:"+bpListObj.Id+'"><span class="IC-pen-1px CP MR10"data-toggle="tooltip" data-placement="bottom" data-original-title="Edit"></span></a><span onclick="ZPeople.confirm(\''+bpListObj.Id+'\',\'\',\'zp.bpdeletemsg\', ProcessBuilder.deleteProcess, false, false, ZPI18N.getString(\'zp.confirm\'))"><span class="IC-delete-1px CP" data-toggle="tooltip" data-placement="bottom" data-original-title="Delete"></span></span></td>';var tr=$('<tr class="ZPLRow" id="'+bpListObj.Id+'" formId='+bpListObj.Form.Id+">"+tdDrag+tdbpName+tdForm+tdField+tdTransitions+tdUser+tdSwitch+tdIcons+"</tr>");bpListBody.append(tr);var transobj={};transobj.id=bpListObj.Id,transobj.name=bpListObj.Name,transobj.formname=bpListObj.Form.FormName,transobj.fieldname=bpListObj.Field.Name,transarr.push(transobj)}),$.each(transarr,function(index,transition){bpListBody.find("[id=bpName_"+transition.id+"]").text(ZPeople.decodeTxt(transition.name)),bpListBody.find("[id=bpFieldName_"+transition.id+"]").text(ZPeople.decodeTxt(transition.fieldname)),bpListBody.find("[id=bpFormName_"+transition.id+"]").html(ZSEC.Encoder.encodeForHTML(transition.formname))}),"all"!=$("#BpStatusHeader").attr("status")||0==pageId.find("#formsList").val()?$('i[id*="drag"]').removeClass("IC-drag"):0==pageId.find("#formsList").val()||$('i[id*="drag"]').hasClass("IC-drag")||$('i[id*="drag"]').addClass("IC-drag"),Blueprint.showEmptylistPage()},createBlueprint:function(){var bpConfJObj={},pageDiv=$pageId();pageDiv.find(".zp-err-msg").hide(),pageDiv.find(".zp-err").removeClass("zp-err"),bpConfJObj.bpName=pageDiv.find("#bpNameInput").val(),bpConfJObj.bpModule=pageDiv.find("#createBpFormlist").val(),bpConfJObj.bpField=pageDiv.find("#createBpFieldlist").val(),bpConfJObj.bpDescription=pageDiv.find("#bpDescInput").val();var isValid=!0;if(""!=bpConfJObj.bpName.trim()&&Blueprint.isBpNameUnique(bpConfJObj.bpName)||(""==bpConfJObj.bpName.trim()&&pageDiv.find("#bpNameInput").siblings(".zp-err-msg").text(ZPI18N.getString("zp.emptyBpName")),pageDiv.find("#bpNameInput").siblings(".zp-err-msg").show(),pageDiv.find("#createBpNamediv").addClass("zp-err"),isValid=!1),bpConfJObj.bpDescription.length>250){var args=[ZPI18N.getString("zp.description"),250];pageDiv.find("#bpDescInput").siblings(".zp-err-msg").text(ZPI18N.getString("zp.fieldlength",args)),pageDiv.find("#bpDescInput").siblings(".zp-err-msg").show(),pageDiv.find("#createBpDescdiv").addClass("zp-err"),isValid=!1}0==bpConfJObj.bpModule?(pageDiv.find("#createBpFormlist").siblings(".zp-err-msg").show(),pageDiv.find("#createBpFormdiv").addClass("zp-err"),isValid=!1):(pageDiv.find("#createBpFormlist").siblings(".zp-err-msg").hide(),pageDiv.find("#createBpFormdiv").removeClass("zp-err")),0==bpConfJObj.bpField?(pageDiv.find("#createBpFieldlist").siblings(".zp-err-msg").show(),pageDiv.find("#createBpFielddiv").addClass("zp-err"),isValid=!1):(pageDiv.find("#createBpFieldlist").siblings(".zp-err-msg").hide(),pageDiv.find("#createBpFielddiv").removeClass("zp-err"));var bpRuleJSON=Criteria.getCriteriaConfigJson(pageId.find("#crtBody").find("[name=crtRowDiv]"),"",[]),bpRuleFormat=pageId.find("[name=critPatternVal]").val();bpRuleFormat=(bpRuleFormat=Criteria.replaceRuleFormat(bpRuleFormat)).replace(/ +/g,"");var ruleValidationResult=Rule.validateRuleWithFormat(pageId.find("#crtBody"),bpRuleJSON,bpRuleFormat);if(!(bpRuleJSON.isError||void 0!=ruleValidationResult&&1==ruleValidationResult.isError)){var crtBody=pageId.find("#crtBody");Criteria.isActionAllowed(crtBody)&&(bpConfJObj.rule=bpRuleJSON,bpConfJObj.ruleFormat=bpRuleFormat,isValid&&(Blueprint.currentMode="",pageDiv.find("#createBpSubmitBtn").attr("disabled","disabled"),ProcessBuilder.createProcess(bpConfJObj)))}},isBpNameUnique:function(bpname){var result=!0;return $.each(Blueprint.processList,function(index,process){process.Name!=bpname||(result=!1)}),result},add:function(){var pageDiv=$pageId();pageDiv.find(".zp-err-msg").hide(),pageDiv.find(".zp-err").removeClass("zp-err"),pageDiv.find("#blueprintModal").addClass("in"),pageDiv.append('<div class="modal-backdrop in"></div>'),Blueprint.reset();var formId=pageDiv.find("#formsList option:selected").val();0==formId&&(formId=ZPeople.EMP_FORMID),$("#createBpFormlist").val(formId).trigger("change"),pageDiv.find(".IC-info").on("click",function(){$(this).popover({html:!0,trigger:"manual",content:function(){return $(this).attr("data-content")}}),$(this).popover("show")})},edit:function(bpId,processDetails){if("Failure"==processDetails[1].Status)return ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.bpnotexist")),void Blueprint.cancel();Blueprint.currentBpData=processDetails[1],Blueprint.resetlocalData();var pageDiv=$pageId();pageDiv.find("#blueprintDetails").attr("processId",bpId),pageDiv.find("#blueprintDetails").attr("formId",processDetails[1].FormId),pageDiv.find("#editmode").attr("formid",processDetails[1].FormId),pageDiv.find("#blueprintDetails").attr("fieldId",processDetails[1].FieldId);var stateList=pageDiv.find("#dragableDiv"),bpDescInput=pageDiv.find("#bpConfigDesc"),moduleLabel=pageDiv.find("#editmode"),fieldLabel=pageDiv.find("#bpConfigField"),bpNameLabel=pageDiv.find("#bpConfigbpName");pageDiv.find("#processSaveBtn"),pageDiv.find("#processCancelBtn"),pageDiv.find("#addStates");ProcessBuilder.Process.PickListValueDetails.START={optVal:"-None-"},$.each(processDetails[1].TransitionsMeta,function(index,transition){Blueprint.checkGlobal(transition.TransitionId,transition.Id,transition.Global,processDetails[1].TransitionsMeta)||("null"==transition.SourceId&&(transition.SourceId="START"),ProcessBuilder.Process.ConnectionIdVsName[transition.SourceId+"_"+transition.TargetId]=transition)}),$.each(processDetails[1].PicklistValues,function(count,option){ProcessBuilder.Process.PickListValueDetails[option.optId]=option;var state='<div class="ProcessState" data-nodeid="'+option.optId+'"><i class="IC-drag"></i><span>'+option.optVal+"</span></div>";stateList.append(state)});var ruleList=pageDiv.find("#bpCriteriaList"),ruleFormat=processDetails[1].RuleFormat;Blueprint.setProcessedJson(ruleList,processDetails[1].ProcessedJson,!1),Blueprint.setCriteriaPattern(ruleFormat,pageDiv,"ruleFormat"),ruleList.hasClass("DN")||pageDiv.find("#bpCriteriaBtn i").removeClass("IC-add-r"),pageDiv.find(".IC-info").on("click",function(){$(this).popover({html:!0,trigger:"manual",content:function(){return $(this).attr("data-content")}}),$(this).popover("show")}),$("body").on("click",function(e){$('[data-toggle="popover"]').each(function(){$(this).is(e.target)||0!==$(this).has(e.target).length||0!==$(".popover").has(e.target).length||$(this).popover("hide")})}),ProcessBuilder.Process.ChartData=processDetails[1].ChartData,fieldLabel.text(processDetails[1].FieldName),moduleLabel.text(processDetails[1].FormName),bpNameLabel.text(processDetails[1].Name),bpDescInput.val(processDetails[1].Description),""!=processDetails[1].Description&&bpDescInput.parents(".desc").addClass("sel"),processDetails[1].isnewStateAllowed||pageDiv.find(".availStats").find("#addStates").hide(),bpNameLabel.on("keyup",Blueprint.clearPlaceHolder()),ProcessBuilder.init(),Blueprint.showSearchBar(),ProcessBuilder.unSavedChanges=!1},reset:function(){var pageDiv=$pageId();pageDiv.find("#bpNameInput").val(""),pageDiv.find("#bpModuleInput").val("0").trigger("change"),pageDiv.find("#bpfieldSelect").val("0").trigger("change"),pageDiv.find("#bpDescInput").val("")},resetConfigPage:function(){var pageDiv=$pageId();pageDiv.find("#dragableDiv").html(""),Blueprint.addStartNode(),pageDiv.find("[bpResetFlag]").html(""),pageDiv.find("#bpConfigDesc").val("")},addStartNode:function(){$pageId().find("#dragableDiv").append('<div class="ProcessState startState hide" data-nodeid="START"><i class="IC-drag"></i><span class="dIB mw250">'+ZPI18N.getString("zp.starts")+"</span></div>")},saveBlueprint:function(){var pageDiv=$pageId();if(ProcessBuilder.getTransWithoutLabel().length>0)return ZPeople.confirm(null,ZPI18N.getString("zp.error"),ZPI18N.getString("zp.translabel"),null,!0,!0),!1;if(ProcessBuilder.checkOrphanNodes())return ZPeople.confirm(null,ZPI18N.getString("zp.error"),ZPI18N.getString("zp.orphannode"),null,!0,!0),!1;var blueprintDetails={};if(!pageDiv.find("#transitionTab").hasClass("active")||0==pageDiv.find("#error_message").length){pageDiv.find("#error_message").remove();var bpDescInput=pageDiv.find("#bpConfigDesc");blueprintDetails.description=bpDescInput.val();var bpNameInput=pageDiv.find("#bpConfigbpName");pageDiv.find("#pb_transitionName");if(0!=bpNameInput.text())if(blueprintDetails.Name=bpNameInput.text(),blueprintDetails.description.length>250){var args=[ZPI18N.getString("zp.description"),250];Blueprint.showError(pageDiv.find("#bpConfigDesc").parent(),ZPI18N.getString("zp.fieldlength",args))}else if(blueprintDetails.Name.length>150){args=[ZPI18N.getString("zp.bpname"),150];Blueprint.showError(pageDiv.find("#bpNameDiv"),ZPI18N.getString("zp.fieldlength",args))}else{var bpId=$("#blueprintDetails").attr("processId");ProcessBuilder.saveProcessDetails(bpId,blueprintDetails),Blueprint.closeSidebar()}else Blueprint.showError(pageDiv.find("#bpNameDiv"),ZPI18N.getString("zp.emptyBpName"))}},cancel:function(){$("#admin-automation-blueprint").remove(),window.location.href="#admin/automation/blueprint";var currentPage=Layout.Page.pageId;$("#"+currentPage).remove(),Blueprint.resetlocalData(),Blueprint.closeSidebar(),$(".modal-backdrop").remove()},confirmDeactivate:function(getThis){getThis.checked?(getThis.checked=!1,Blueprint.changeStatus(getThis)):(getThis.checked=!0,ZPeople.confirm(getThis,ZPI18N.getString("zp.bpdeactivate"),ZPI18N.getString("zp.bpdeactivation"),Blueprint.changeStatus,!1,!0))},changeStatus:function(getThis){$pageId();var blueprintId=$(getThis).parents("tr").attr("id"),formId=$(getThis).parents("tr").attr("formid");getThis.checked=!getThis.checked;var status=getThis.checked?"Active":"inactive";$("#BpStatusHeader").attr("status")!=status&&"all"!=$("#BpStatusHeader").attr("status")&&($(getThis).parents("tr").hide(),!ZPeople.FireScroll.getFireScrollPropertie().triggered&&$("#bpTableBody tr:visible").length<25&&ProcessBuilder.getAllProcesses(Blueprint.constructList),Blueprint.showEmptylistPage()),ProcessBuilder.updateProcessStatus(status,blueprintId,getThis,formId)},mainPageAct:function(option){!0===option?AutomationCommon.showHidePage("[automationPages=bpNewPage]"):AutomationCommon.showHidePage("[automationPages=bpNewPage]",!0)},getformsList:function(){var pageDiv=$pageId();pageDiv.find('i[id*="drag"]').removeClass("IC-drag"),pageDiv.find("#formsList").on("change",function(){$("#bpTableBody").html(""),ZPeople.FireScroll.setRecordCount(0),ProcessBuilder.getAllProcesses(Blueprint.constructList)}),ZPACommon.getFormList(Blueprint.MODE),$.each(ZPACommon.blueprint_formList,function(key,value){pageDiv.find("#formsList, #createBpFormlist").append('<option value="'+value.formId+'">'+value.dispName+"</option>")}),pageDiv.find("#formsList").select2({dropdownCssClass:"WAI"}),Blueprint.populateFieldsAndCriteria()},populateFieldsAndCriteria:function(){var $fieldList=$("#createBpFieldlist");$("#createBpFormlist").on("change",function(){if(0!==$(this).val()){formId=$(this).val(),$fieldList.empty(),$fieldList.append('<option value="0">'+ZPI18N.getString("zp.selectfield")+"</option>"),$fieldList.val("0").trigger("change"),ProcessBuilder.getAllFields(formId,!0,function(resultData){$fieldList.html('<option value="0">'+ZPI18N.getString("zp.selectfield")+"</option>"),$.each(resultData[1],function(index,field){$fieldList.append('<option value="'+field.FieldId+'">'+field.FieldName+"</option>")})}),formId=$("#createBpFormlist option:selected").val();var crtBody=$pageId().find("[role=dialog]").find("#createBpCrtDiv"),ruleAddNewBtn=$(crtBody).parent().find("[name=addCrt]");$(ruleAddNewBtn).data("criteriaFComp",""),Criteria.iterateCriteria([]),Criteria.addSingleCriteria(crtBody.find(".btn-primary")),crtBody.find("#crtBody").addClass("over-visi"),crtBody.find("p").addClass("DN")}}),-1!==Layout.Page.hash.indexOf("blueprint/add")&&Blueprint.add()},selectTransitionTab:function(tab){var pageDiv=$pageId();switch(pageDiv.find("#before,#during,#after").hide(),pageDiv.find("#beforeTab,#duringTab,#afterTab").removeClass("active"),tab){case 1:pageDiv.find("#before").show(),pageDiv.find("#beforeTab").addClass("active"),Blueprint.beforeTabClicked();break;case 2:pageDiv.find("#during").show(),pageDiv.find("#duringTab").addClass("active"),Blueprint.duringClicked();break;case 3:pageDiv.find("#after").show(),pageDiv.find("#afterTab").addClass("active")}},showAddState:function(){var pageDiv=$pageId();pageDiv.find("#bpAddState").show();var fieldname=pageDiv.find("#bpConfigField").html(),field=ZPI18N.getString("zp.createnewbpstate")+" "+fieldname;pageDiv.find("#newStatefieldName").text(field),pageDiv.find(".availStats").addClass("sel")},hideAddState:function(){var pageDiv=$pageId();pageDiv.find(".availStats").removeClass("sel"),pageDiv.find("#bpNewStateText").val(""),pageDiv.find("#bpAddState").hide()},addState:function(){var $newStatetxtField=(pageDiv=$pageId()).find("#bpNewStateText");pageDiv.find("#bpAddState").hide();var stateName=$newStatetxtField.val();if(ZPUtil.Validation.isEmpty(stateName))ZPeople.confirm(null,"","zp.emptystateName","",!0,!1),Blueprint.hideAddState();else if(Blueprint.isStateUnique(pageDiv,stateName.trim())){pageDiv.find(".availStats #loadDiv").html(ZPeople.LOADING_HTML);$newStatetxtField=(pageDiv=$pageId()).find("#bpNewStateText"),$("#blueprintDetails").attr("fieldId");var pageDiv,stateList=pageDiv.find("#dragableDiv"),sequence=0;$.each(ProcessBuilder.Process.PickListValueDetails,function(count,option){sequence<option.seqNo&&(sequence=option.seqNo)});var statesDiv=pageDiv.find("#pBformcomponentcontainerdiv"),chartDiv=pageDiv.find("#canvasContainer"),newStateCount=statesDiv.find('[newState="true"]').length+chartDiv.find('[newstate="true"]').length,state='<div class="ProcessState" data-nodeid="newState-'+newStateCount+'" newState="true"><i class="IC-drag"></i><span class="dIB mw250">'+ZSEC.Encoder.encodeForHTML(stateName)+"</span></div>",newState={optId:"newState-"+newStateCount,optVal:stateName,seqNo:sequence+1,sysVal:0};ProcessBuilder.Process.PickListValueDetails["newState-"+newStateCount]=newState,stateList.append(state),$newStatetxtField.val(""),Blueprint.hideAddState(),ProcessBuilder.applyDragg(),pageDiv.find("#pbactionSearchBox").val(""),ProcessBuilder.searchStateAction(pageDiv.find("#pbactionSearchBox")),Blueprint.showSearchBar(),pageDiv.find(".availStats #loadDiv").html("")}else ZPeople.confirm(null,"","zp.uniquestate","",!0,!1),pageDiv.find("#bpAddState").parent().find("#zp_page_loading").remove(),Blueprint.hideAddState()},isStateUnique:function(pageDiv,stateName){var stateUnique=!0;return pageDiv.find(".ProcessState, [id^=state]").each(function(index){var statetxt="";statetxt=void 0!=$(this).attr("title")?$(this).attr("title"):$(this).text(),"START"==$(this).attr("data-nodeid")||statetxt.toUpperCase()!==stateName.toUpperCase()||(stateUnique=!1)}),stateUnique},getActionConstruct:function(configDtls){AutomationCommon.setChildParam();AutomationCommon.getCurrentPageId();var mapActionArray=[{actName:"MAILALERT",name:ZPI18N.getString("zp.mailalert"),key:"mailalert",oprType:"fetch_wf_mail_mapping",dataName:"alertList"},{actName:"CHECKLIST",name:ZPI18N.getString("zp.workflow.checklist"),key:"checklist",oprType:"fetch_wf_checklist_mapping",dataName:"checklist"},{actName:"FIELDUPDATE",name:ZPI18N.getString("zp.fieldupdates"),key:"fieldupdate",oprType:"wf_fvu_list_mapping",dataName:"fieldUpdateList"},{actName:"WEBHOOK",name:ZPI18N.getString("zp.webhooks"),key:"webhook",oprType:"wf_webhook_list_mapping",dataName:"webHookList"},{actName:"CUSTOMFN",name:ZPI18N.getString("zp.customfunctions"),key:"customfunction",oprType:"wf_customfn_list_mapping",dataName:"customfnList"}],ul=$("<ul name='actionList' class='afterList' >");return $.each(mapActionArray,function(i,Obj){var header='<b name="mapName">'+Obj.name+'</b><div class="actions"><a name="addActionBtn" data-placement="bottom" data-toggle="popover" dataName="'+Obj.dataName+'" oprtype="'+Obj.oprType+'" onclick="NewWorkFlow.getWFMappingList(this)" class="btnRond"><i class="IC-addlist MT5" title="'+ZPI18N.getString("zp.chooseexstngaction")+'"></i></a> <a name="addActionBtn" class="btnRond MR10" onclick="Blueprint.createNewWorkflow(\''+Obj.key+'\')"> <i class="IC-add-r" title="'+ZPI18N.getString("zp.addnewaction")+'"></i></a>  </div>',li=$('<li actName="'+Obj.actName+'"></li>');li.append(header,'<div class="criteriaList" name="mapTableDiv"><ul name="mappingTable" class="list"></div>'),ul.append(li)}),$(ul).find("[oprtype]").each(function(){var multiClick="wf_webhook_list_mapping"!==$(this).attr("oprtype");if($(this).setPopOver({callback:Blueprint.mappingCallBack,html:"",keyname:"name=list-group-item",targetId:"",multi:multiClick}),configDtls[$(this).attr("dataName")]){var mappingObj=$(this);$.each(configDtls[$(this).attr("dataName")],function(i,data){Blueprint.insertActionList(data,mappingObj.closest("[actname]").find("[name=mappingTable]"))})}}),Blueprint.checkEmptyActions(),ul},insertActionList:function(data,mapTable){var workflowType=mapTable.closest("[actname]").attr("actname"),tempId=data.tempId,method=Blueprint.getMethodOfAction(workflowType,tempId),trRow=$('<li name="mappingRow" ><i class="ri"></i></li>'),trRowIcons=$('<span class="actions"><i class="IC-pen-1px" onclick="'+method+'" title="'+ZPI18N.getString("zp.editaction")+'"></i><i onclick="Blueprint.removeActionListRow(this)" class="IC-delete-1px" title="'+ZPI18N.getString("zp.removeaction")+'"></i></span>');trRow.attr("id",data.tempId+"_row"),trRow.append(ZSEC.Encoder.encodeForHTML(data.tempName)),trRow.append(trRowIcons),trRow.attr("templateid",data.tempId),mapTable.append(trRow)},removeActionListRow:function(getThis){$(getThis).closest("li").remove(),Blueprint.checkEmptyActions(),Blueprint.saveActions(),ProcessBuilder.unSavedChanges=!0},mappingCallBack:function(getLiObj,params){var getThis=$(getLiObj).find("[name=mOpt]"),workflowType=$(getThis).closest("[actname]").attr("actname"),tempId=$(getThis).attr("id"),tempName=$(getThis).text(),isAdd=-1!==$(getThis).closest("li").attr("class").indexOf("sel"),mapTable=$(getThis).closest("[actname]").find("[name=mappingTable]");if($(mapTable).find("li").length>=10)return $(getLiObj).removeClass("sel"),void ZPeople.confirm(null,"",ZPI18N.getString("zp.bpactionslimit"),function(){},!0,!0);var mapName=$(getThis).closest("[actname]").attr("actname"),method=NewWorkFlow.getMethodOfAction(workflowType,tempId);if(!0===isAdd){"WEBHOOK"===mapName&&$(mapTable).find("tr").remove();var trRow=$('<li name="mappingRow" ><i class="ri"></i></li>'),trRowIcons=$('<span class="actions"><i class="IC-pen-1px" onclick="'+method+'" title="'+ZPI18N.getString("zp.editaction")+'"></i><i onclick="Blueprint.removeActionListRow(this)" class="IC-delete-1px" title="'+ZPI18N.getString("zp.removeaction")+'"></i></span>');trRow.attr("id",tempId+"_row"),trRow.append(ZPeople.escapeHtml(tempName)),trRow.append(trRowIcons),trRow.attr("templateid",tempId),mapTable.append(trRow)}else $(mapTable).find("#"+tempId+"_row").remove();Blueprint.checkEmptyActions(),Blueprint.saveActions(),ProcessBuilder.unSavedChanges=!0,$pageId().find(".modal-backdrop").remove()},callbackByAction:function(action,resp){var parentPageDiv=$parentPageId(),pageDiv=$pageId(Blueprint.MODE);switch(action!==CustomFunctionValidation.MODE&&this.mainPageAct(!0),action){case Mailalerts.MODE:if(!0!==resp.cancel)(data={}).tempId=resp.mailalertId,data.tempName=resp.templateName,pageDiv.find("[actname=MAILALERT]").find("[name=mappingTable]").find("#"+data.tempId+"_row").remove(),Blueprint.insertActionList(data,pageDiv.find("[actname=MAILALERT]").find("[name=mappingTable]"));break;case Fieldupdate.MODE:var data;if(!0!==resp.cancel)(data={}).tempId=resp.fieldupdateId,data.tempName=ZPeople.decodeTxt(resp.fvuName),pageDiv.find("[actname=FIELDUPDATE]").find("[name=mappingTable]").find("#"+data.tempId+"_row").remove(),Blueprint.insertActionList(data,pageDiv.find("[actname=FIELDUPDATE]").find("[name=mappingTable]"));break;case ZPACommon.CHECKLIST_MODE:!0!==resp.cancel&&(pageDiv.find("[actname=CHECKLIST]").find("[name=mappingTable]").find("#"+resp.tempId+"_row").remove(),Blueprint.insertActionList(resp,pageDiv.find("[actname=CHECKLIST]").find("[name=mappingTable]")));break;case Task.MODE:!0!==resp.cancel&&(pageDiv.find("[actname=TASKS]").find("[name=mappingTable]").find("#"+resp.tempId+"_row").remove(),Blueprint.insertActionList(resp,pageDiv.find("[actname=TASKS]").find("[name=mappingTable]")));break;case Webhook.MODE:!0!==resp.cancel&&(pageDiv.find("[actname=WEBHOOK]").find("[name=mappingTable]").find("#"+resp.tempId+"_row").remove(),Blueprint.insertActionList(resp,pageDiv.find("[actname=WEBHOOK]").find("[name=mappingTable]")));break;case NewCustomFunction.MODE:!0!==resp.cancel&&(pageDiv.find("[actname=CUSTOMFN]").find("[name=mappingTable]").find("#"+resp.tempId+"_row").remove(),Blueprint.insertActionList(resp,pageDiv.find("[actname=CUSTOMFN]").find("[name=mappingTable]")));break;case CustomFunctionValidation.MODE:parentPageDiv.find("#aPageHead").addClass("DN"),!0!==resp.cancel?(parentPageDiv.find("#cfvalidation").find("input").attr("cfid",CustomFunctionValidation.cfId).prop("checked",!0),parentPageDiv.find("#cfvalidation").find("label").attr("cfid",CustomFunctionValidation.cfId).text(resp.dispname)):(0==CustomFunctionValidation.cfId||ZPUtil.Validation.isEmpty(CustomFunctionValidation.cfId))&&parentPageDiv.find("#cfvalidation").find("input").prop("checked",!1),CustomFunctionValidation.isCFFromValidation=!1}Blueprint.checkEmptyActions(),Blueprint.saveActions()},mapValidationToField:function(validationJson){var pageDiv=$pageId(Blueprint.MODE),valruleid=validationJson.VALIDATION_RULE_ID,fieldid=validationJson.BASE_FCID,val_msg=validationJson.baseConditions[0].VALIDATION_MSG,transitionid=ProcessBuilder.Transition.transitionId;$.each(ProcessBuilder.TransitionIdVsDetails[transitionid].Fields,function(index,field){field.id==fieldid&&(field.validationJson=validationJson,void 0!=valruleid&&(field.valruleid=valruleid))}),pageDiv.find("#duringFields").find("#"+fieldid+" .IC-add").hide(),Blueprint.showValidationMsg(fieldid,val_msg)},addFieldtoDuring:function(fieldText,fieldId,isFromPickList,seq,valrule){var fieldCount=(duringFields=(pageDiv=$pageId(Blueprint.MODE)).find("#duringFields")).find("li").length;if(fieldCount>=20)ZPeople.confirm(null,"",ZPI18N.getString("zp.bpfieldlimit"),function(){},!0,!0);else{var fieldObj={};fieldObj.name=fieldText,fieldObj.id=fieldId,fieldObj.sequence=fieldCount;var transitionid=ProcessBuilder.Transition.transitionId,pageDiv=$pageId(Blueprint.MODE);$("#emptyBpFields").remove();var duringFields=pageDiv.find("#duringFields"),field=(pageDiv.find("#blueprintDetails").attr("formId").toString(),'<li class="bp-durField" id="'+fieldId+'"> <span id="Bpfieldmsg"> <i class="IC-drag"></i><b>'+ZSEC.Encoder.encodeForHTML(fieldText)+'</b> <a class="fr" onclick="Blueprint.Validation.initVal('+ValidationRule.validationTypes.BLUEPRINT+",'"+fieldId+'\')" id="fieldCriteriaTab"><i class="IC-add"></i> '+ZPI18N.getString("zp.validation")+"</a> <i onclick=\"Blueprint.deleteField('"+fieldId+'\')" class="IC-delete-1px"></i> <div id="BpValMsg" style="display:none;"></div></span> </li>');if(duringFields.append(field),void 0!=valrule&&""!=valruleid){var valruleid=valrule.VALIDATION_RULE_ID;pageDiv.find("#"+fieldId).find(".IC-add").hide()}isFromPickList&&(ProcessBuilder.TransitionIdVsDetails[transitionid].Fields.push(fieldObj),ProcessBuilder.unSavedChanges=!0),void 0!=valrule&&Blueprint.showValidationMsg(fieldId,valrule.baseConditions[0].VALIDATION_MSG)}},deleteField:function(fieldid){var pageDiv=$pageId(Blueprint.MODE),transitionid=ProcessBuilder.Transition.transitionId;pageDiv.find("#duringFields").find("#"+fieldid).remove(),$.each(Blueprint.currentBpData.fieldsList,function(index,field){field.FieldId==fieldid&&pageDiv.find("#duringFieldlist").append('<option value="'+field.FieldId+'">'+field.FieldName+"</option>")}),$.each(ProcessBuilder.TransitionIdVsDetails[transitionid].Fields,function(index,field){if(field.id==fieldid)return ProcessBuilder.TransitionIdVsDetails[transitionid].Fields.splice(index,1),!1}),Blueprint.Reorderfieldsequence()},Reorderfieldsequence:function(){var transitionid=ProcessBuilder.Transition.transitionId,seq=0;$.each(ProcessBuilder.TransitionIdVsDetails[transitionid].Fields,function(index,field){field.sequence=seq,seq++})},fieldComparator:function(a,b){return a.sequence<b.sequence?-1:a.sequence>b.sequence?1:0},duringClicked:function(){var formId=Blueprint.currentBpData.FormId;if(void 0==ZPForm.FORM_COMPONENT_DATA[formId])$("#BpLoading").html(ZPeople.LOADING_HTML),ZPFRules.getFormComponents({},{},{forPost:!0,formId:formId,isBlueprint:!0,duringClicked:!0});else if("true"!=$("#duringTab").attr("fill")){var pageDiv=$pageId(Blueprint.MODE),transitionid=ProcessBuilder.Transition.transitionId;ProcessBuilder.TransitionIdVsDetails[transitionid].Fields.sort(this.fieldComparator),$.each(ProcessBuilder.TransitionIdVsDetails[transitionid].Fields,function(index,field){var $fieldsList=pageDiv.find("#duringFields li");$.each($fieldsList,function(index,fieldObject){field.id==fieldObject.id&&!0}),Blueprint.addFieldtoDuring(field.name,field.id,!1,field.sequence,field.validationJson)}),void 0==ProcessBuilder.TransitionIdVsDetails[transitionid].InfoMessage&&(ProcessBuilder.TransitionIdVsDetails[transitionid].InfoMessage="");var BPmessage=pageDiv.find("#BPmessage"),idtext=ProcessBuilder.TransitionIdVsDetails[transitionid].InfoMessage,selClass="";""!=idtext&&(selClass="sel");var messageField='<span class="zp-label desc '+selClass+'" onclick="$(this).addClass(\'sel\'); $pageId().find(\'#bpMessageTxt\').trigger(\'focus\');"><span class="zprt-label"><span><a><i class="IC-add"></i>'+ZPI18N.getString("zp.infomessage")+'</a> <textarea id="bpMessageTxt" ele="InfoMessage" placeholder="'+ZPI18N.getString("zp.bpmessage")+'" onblur="Blueprint.validateOnBlur(this)">'+idtext+"</textarea></span></span></span>";BPmessage.append(messageField);formId=pageDiv.find("#blueprintDetails").attr("formId");var fieldid,idexist=0,formTableName=Blueprint.currentBpData.P_TableName,fields=ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails;$("#duringFieldlist").select2({dropdownCssClass:"W180"}),"true"!=$("#duringTab").attr("fill")&&($.each(fields,function(index1,section){$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){idexist=0,void 0!=field&&!section.isTabular&&ZPFRules.isFieldAllowed(!0,field,null,formTableName,null,!0)&&$.each(ProcessBuilder.TransitionIdVsDetails[transitionid].Fields,function(itr,fieldcheck){field.formComponentId!=fieldcheck.id&&Blueprint.currentBpData.FieldId!=fieldcheck.id||(idexist=1)}),1!=idexist&&!section.isTabular&&ZPFRules.isFieldAllowed(!0,field,null,formTableName,null,!0)&&Blueprint.currentBpData.FieldId!=field.formComponentId&&(field.isPrimaryLookup&&1==field.isPrimaryLookup||pageDiv.find("#duringFieldlist").append('<option value="'+field.formComponentId+'">'+field.displayName+"</option>"))})})}),$("#duringTab").attr("fill","true")),pageDiv.find("#duringFieldlist").off(),pageDiv.find("#duringFieldlist").on("change",function(){if(0!=$(this).val()){fieldid=$(this).val();var fieldText=pageDiv.find("#duringFieldlist option:selected").text();Blueprint.addFieldtoDuring(fieldText,fieldid,!0),pageDiv.find("#duringFieldlist option:selected").remove(),$(this).val("0").trigger("change"),$("#duringFieldlist").select2("val",0)}}),$("#duringFields").sortable({appendTo:"parent",helper:"clone",handle:".IC-drag",items:"li",update:function(){var bpli=$("#duringFields").find("li");new Array;$.each(bpli,function(ind,value){Blueprint.getFieldForId(value.id,ProcessBuilder.Transition.transitionId).sequence=ind})}}).disableSelection(),$("#BpLoading").remove()}},criteriaEditor:function(isBlueprint){var processid,transitionid,rulejson,ruleformat,pageDiv=$pageId();isBlueprint?(processid=pageDiv.find("#blueprintDetails").attr("processId"),rulejson=Blueprint.currentBpData.ProcessedJson,ruleformat=Blueprint.currentBpData.RuleFormat):(transitionid=ProcessBuilder.Transition.transitionId,rulejson=ProcessBuilder.TransitionIdVsDetails[transitionid].Criteria,ruleformat=ProcessBuilder.TransitionIdVsDetails[transitionid].RuleFormat),Blueprint.showCriteriaEditor(rulejson,processid,transitionid,ruleformat),Layout.Page.container.find('[name="ruleFields"]').tooltip({title:function(){return $(this).val()},placement:"top",trigger:"hover"})},showCriteriaEditor:function(rulejson,processid,transitionid,ruleFormat){Blueprint.currentMode="criteriaEditorPopup";var pageDiv=$pageId();if(pageDiv.find("#popupCriteriaDiv").html(Blueprint.criteriaHTML),pageDiv.find("[role=dialog]").addClass("in"),void 0!=transitionid&&""!=transitionid?(pageDiv.attr("isBlueprintCriteria",!1),pageDiv.attr("transitionid",transitionid),pageDiv.find(".modal-title").text(ZPI18N.getString("zp.beforecriteria"))):(pageDiv.find(".modal-title").text(ZPI18N.getString("zp.bpcriteriahd")),pageDiv.attr("isBlueprintCriteria",!0),pageDiv.attr("processid",processid)),void 0!=rulejson&&0!=rulejson.length)ruleFormat=void 0!=ruleFormat?Criteria.replaceRuleFormatToString(ruleFormat):"",Criteria.iterateCriteria(rulejson,Blueprint.criteriaFCObj,pageDiv.find("[role=dialog]").find("#popupCriteriaDiv"),ruleFormat);else{var crtBody=pageDiv.find("[role=dialog]").find("#popupCriteriaDiv"),ruleAddNewBtn=$(crtBody).parent().find("[name=addCrt]");$(ruleAddNewBtn).data("criteriaFComp",Blueprint.criteriaFCObj),Criteria.iterateCriteria([],Blueprint.criteriaFCObj,pageDiv.find("[role=dialog]").find("#popupCriteriaDiv"));var CrtDiv=pageDiv.find("#popupCriteriaDiv");Criteria.addSingleCriteria(CrtDiv.find(".btn-primary"))}pageDiv.append('<div class="modal-backdrop in"></div>')},closeCriteriaEditor:function(){var pageDiv=$pageId();pageDiv.find("[role=dialog]").removeClass("in"),pageDiv.find(".modal-dialog").show(),pageDiv.find(".modal-backdrop").html(""),pageDiv.find(".modal-backdrop").remove(),Blueprint.currentMode=""},saveCriteriaEditor:function(){var pageDiv=$pageId(),isBlueprintCriteria=pageDiv.attr("isBlueprintCriteria"),rulejson=Criteria.getCriteriaConfigJson(pageId.find("#crtBody").find("[name=crtRowDiv]"),"",[]),ruleFormat=pageId.find("[name=critPatternVal]").val();ruleFormat=(ruleFormat=Criteria.replaceRuleFormat(ruleFormat)).replace(/ +/g,"");var ruleValidationResult=Rule.validateRuleWithFormat(pageId.find("#crtBody"),rulejson,ruleFormat);if(!(rulejson.isError||void 0!=ruleValidationResult&&1==ruleValidationResult.isError)){var crtBody=pageId.find("#crtBody");if(Criteria.isActionAllowed(crtBody)){if("true"===isBlueprintCriteria)var processid=pageDiv.attr("processid");Blueprint.saveCriteriaforTransition(processid,rulejson,ruleFormat)}}},saveCriteriaforTransition:function(processid,rulejson,ruleFormat){var pageDiv=$pageId(Blueprint.MODE),formId=pageDiv.find("#blueprintDetails").attr("formid"),transitionid=ProcessBuilder.Transition.transitionId,params={method:"saveCriteriaforTransition",ProcessId:processid,FormId:formId,Criteria:JSON.stringify(rulejson),RuleFormat:ruleFormat,processedJSONMode:!0},hideDiv=$pageId();hideDiv.find(".modal-backdrop").html(ZPeople.LOADING_HTML),hideDiv.find(".modal-dialog").hide(),ZPeople.Request.send("/transitionAction.zp",params,function(resultData,params){var data=resultData[1];if("Success"==data.Status){if(null!=params.ProcessId&&""!=params.ProcessId){Blueprint.currentBpData.ProcessedJson=data.ProcessedJson,Blueprint.currentBpData.RuleFormat=ruleFormat;var bpruleList=pageDiv.find("#bpCriteriaList");Blueprint.setProcessedJson(bpruleList,Blueprint.currentBpData.ProcessedJson,!1),Blueprint.setCriteriaPattern(ruleFormat,pageDiv,"ruleFormat"),bpruleList.hasClass("DN")?pageDiv.find("#bpCriteriaBtn i").addClass("IC-add-r"):pageDiv.find("#bpCriteriaBtn i").removeClass("IC-add-r")}else{ProcessBuilder.TransitionIdVsDetails[transitionid].Criteria=data.ProcessedJson,ProcessBuilder.TransitionIdVsDetails[transitionid].RuleFormat=ruleFormat,Blueprint.currentMode="";var transruleList=(pageDiv=$pageId()).find("#bpConfigCrtDiv");Blueprint.setProcessedJson(transruleList,ProcessBuilder.TransitionIdVsDetails[transitionid].Criteria,!0),Blueprint.setCriteriaPattern(ruleFormat,pageDiv,"bpConfigRuleFormat")}Blueprint.currentMode="criteriaEditorPopup",hideDiv.find(".modal-footer").show(),Blueprint.closeCriteriaEditor(),ProcessBuilder.unSavedChanges=!0}else ZPeople.confirm(null,"",data.ERRORMSG,function(){},!0,!0)},null,function(resultdata){ZPeople.confirm(null,"",ZPI18N.getString("zp.critersavefail"),function(){},!0,!0),Blueprint.closeCriteriaEditor()})},beforeTabClicked:function(){var pageDiv=$pageId(Blueprint.MODE),ruleJson=(pageDiv.find("#blueprintDetails").attr("formId"),ProcessBuilder.Transition.Criteria),ruleFormat=ProcessBuilder.Transition.RuleFormat,ruleList=pageDiv.find("#bpConfigCrtDiv");Blueprint.setProcessedJson(ruleList,ruleJson,!0),Blueprint.setCriteriaPattern(ruleFormat,pageDiv,"bpConfigRuleFormat")},saveBeforeCriteria:function(){var pageDiv=$pageId(Blueprint.MODE),transitionid=ProcessBuilder.Transition.transitionId,beforeRuleJSON=Criteria.getCriteriaConfigJson(pageDiv.find("#bpConfigCrtDiv").find("#crtBody").find("[name=crtRowDiv]"),"",[]);ProcessBuilder.TransitionIdVsDetails[transitionid].Criteria=beforeRuleJSON,ProcessBuilder.Transition=ProcessBuilder.TransitionIdVsDetails[transitionid]},saveActions:function(){var pageDiv=$pageId(Blueprint.MODE),mailAlertIds=Blueprint.getBlueprintSelectedActionsList(pageDiv.find("[actName=MAILALERT]").find("[name=mappingTable]")),checklistIds=Blueprint.getBlueprintSelectedActionsList(pageDiv.find("[actName=CHECKLIST]").find("[name=mappingTable]")),fieldUpdateIds=Blueprint.getBlueprintSelectedActionsList(pageDiv.find("[actName=FIELDUPDATE]").find("[name=mappingTable]")),webhookIds=Blueprint.getBlueprintSelectedActionsList(pageDiv.find("[actName=WEBHOOK]").find("[name=mappingTable]")),customfnIds=Blueprint.getBlueprintSelectedActionsList(pageDiv.find("[actName=CUSTOMFN]").find("[name=mappingTable]")),transitionid=ProcessBuilder.Transition.transitionId,Actions={};Actions.mailAlertIds=mailAlertIds,Actions.checklistIds=checklistIds,Actions.fieldUpdateIds=fieldUpdateIds,Actions.webhookIds=webhookIds,Actions.customfnIds=customfnIds,ProcessBuilder.TransitionIdVsDetails[transitionid].ActionsToSave=Actions;var alertList=[],checklist=[],customfnList=[],fieldUpdateList=[],webHookList=[];pageDiv.find("[actname=MAILALERT] [name=mappingTable] [name=mappingRow]").each(function(index){var tempName=$(this).text(),tempId=$(this).attr("templateid"),alert={};alert.tempName=tempName,alert.tempId=tempId,alertList.push(alert)}),ProcessBuilder.TransitionIdVsDetails[transitionid].Actions.alertList=alertList,pageDiv.find("[actname=CHECKLIST] [name=mappingTable] [name=mappingRow]").each(function(index){var tempName=$(this).text(),tempId=$(this).attr("templateid"),check={};check.tempName=tempName,check.tempId=tempId,checklist.push(check)}),ProcessBuilder.TransitionIdVsDetails[transitionid].Actions.checklist=checklist,pageDiv.find("[actname=FIELDUPDATE] [name=mappingTable] [name=mappingRow]").each(function(index){var tempName=$(this).text(),tempId=$(this).attr("templateid"),fieldUpdate={};fieldUpdate.tempName=tempName,fieldUpdate.tempId=tempId,fieldUpdateList.push(fieldUpdate)}),ProcessBuilder.TransitionIdVsDetails[transitionid].Actions.fieldUpdateList=fieldUpdateList,pageDiv.find("[actname=WEBHOOK] [name=mappingTable] [name=mappingRow]").each(function(index){var tempName=$(this).text(),tempId=$(this).attr("templateid"),webHook={};webHook.tempName=tempName,webHook.tempId=tempId,webHookList.push(webHook)}),ProcessBuilder.TransitionIdVsDetails[transitionid].Actions.webHookList=webHookList,pageDiv.find("[actname=CUSTOMFN] [name=mappingTable] [name=mappingRow]").each(function(index){var tempName=$(this).text(),tempId=$(this).attr("templateid"),customfn={};customfn.tempName=tempName,customfn.tempId=tempId,customfnList.push(customfn)}),ProcessBuilder.TransitionIdVsDetails[transitionid].Actions.customfnList=customfnList},getBlueprintSelectedActionsList:function(getTable){return $(getTable).find("li").map(function(){return $(this).attr("templateid")}).get().join(",")},getFieldForId:function(id,transitionid){var resultfield;return $.each(ProcessBuilder.TransitionIdVsDetails[transitionid].Fields,function(index,field){field.id==id&&(resultfield=field)}),resultfield},assignSequenceForFields:function(){var $fieldsList=$pageId(Blueprint.MODE).find("#duringFields li"),seq_count=0,transitionid=ProcessBuilder.Transition.transitionId;$.each($fieldsList,function(index,fieldObject){Blueprint.getFieldForId(fieldObject.id,transitionid).sequence=seq_count,seq_count++})},saveFields:function(){$pageId(Blueprint.MODE),ProcessBuilder.Transition.transitionId},saveTransitionConfig:function(conn){var pageDiv=$pageId(Blueprint.MODE),transitionid=ProcessBuilder.Transition.transitionId,isNameExists=!1;for(var currTransid in ProcessBuilder.Transition.Name=pageDiv.find("#pb_transitionName").text(),ProcessBuilder.TransitionIdVsDetails){var name=ProcessBuilder.TransitionIdVsDetails[currTransid].Name;void 0!=ProcessBuilder.TransitionIdVsDetails[currTransid].toBeDeleted&&ProcessBuilder.TransitionIdVsDetails[currTransid].toBeDeleted||name.toUpperCase()!=ProcessBuilder.Transition.Name.toUpperCase()||transitionid==currTransid||(isNameExists=!0)}if(isNameExists)Blueprint.showError(pageDiv.find("#pb_transitionName").parent(),ZPI18N.getString("zp.uniquetransition"));else{if(ProcessBuilder.setOverlayLabel(conn[0],{Name:ProcessBuilder.Transition.Name,TransitionId:transitionid}),ProcessBuilder.Transition.Description=pageDiv.find("#pb_transitionDescription").val(),Blueprint.saveActions(),Blueprint.saveFields(),Blueprint.Owners.saveTransitionOwners(),ProcessBuilder.TransitionIdVsDetails[transitionid].Criteria.isError)return delete ProcessBuilder.TransitionIdVsDetails[transitionid].Criteria.isError,void(ProcessBuilder.TransitionIdVsDetails[transitionid].Criteria.length=0);ProcessBuilder.TransitionIdVsDetails[transitionid]=ProcessBuilder.Transition,ProcessBuilder.saveTransition(transitionid)}},getTransitionDetailsTemplate:function(){var transitionsHTML='<div class="bpInfoTop"><div class="zp-label" id="transitionNameDiv"><i id="transdel" class="IC-delete-1px CP DN FR"></i><span class="bld" id="pb_transitionName" contenteditable="true" ele="Name" placeholder="'+ZPI18N.getString("zp.transitionname")+'" onblur="Blueprint.validateOnBlur(this)"></span> </div><div class="zp-label desc" id="transitionDescDiv" onclick="$(this).addClass(\'sel\'); $pageId().find(\'#pb_transitionDescription\').trigger(\'focus\');"><div class="zprt-label"><span><a><i class="IC-add"></i>'+ZPI18N.getString("zp.description")+'</a> <textarea id="pb_transitionDescription" ele="Description" placeholder="'+ZPI18N.getString("zp.description")+'" onblur="Blueprint.validateOnBlur(this)"></textarea></span> </div></div> <div id="globalCbContainer" class="form-group DN"> <div class="checkbox checkbox-primary FL"> <input id="globalTransitionCb" onclick="ProcessBuilder.globalClicked(this,event);" type="checkbox"> <label for="globalTransitionCb" data-toggle="collapse1">'+ZPI18N.getString("zp.globaltransition")+'</label> </div><div class="fl gry PL10 PR10" id="globalDivider">|</div> <div id="commonStatesDiv" class="dropdown FL"> <div class="CP" data-toggle="dropdown" > <span class="FL">'+ZPI18N.getString("zp.connstates")+'</span> <span class="IC-ar-dwn ArwDwn gry"></span> </div> <ul class="dropdown-menu top gray lt TabDD" id="trans_states"> </ul></div></div><div id="ownerContainer" class="form-group"> <div class="PT20 PB20 S16"> <span>'+ZPI18N.getString("zp.transitionowners")+'</span> </div><div id="ownerList" taginputbox="ownerList" class="input-group" > <div class="form-control text-left dvfrmlist"></div> <a onclick="Blueprint.Owners.loadOwnerPopUp(this,\'ownerList\')" elname="transOwner" targetid="ownerList" class="input-group-addon dvAddRecipient" data-placement="bottom" data-toggle="popover" data-original-title="" title=""><i class="IC-addlist S15"></i></a> </div> <div name="errormsg" class="ERR"></div> </div></div> <div class="form-group"> <div id="allTransitionDetails"> <nav class="nwnavbar navbar-default ZPSnav criTab mar30"> <div class="container-fluid"> <ul class="nav navbar-nav"> <li class="active" id="beforeTab" onclick="Blueprint.selectTransitionTab(1)"><a>'+ZPI18N.getString("zp.before")+'</a></li>  <li id="duringTab" onclick="Blueprint.selectTransitionTab(2)"><a>'+ZPI18N.getString("zp.during")+'</a></li> <li id="afterTab" onclick="Blueprint.selectTransitionTab(3)"><a>'+ZPI18N.getString("zp.after")+'</a></li>  </ul> </div> </nav> <div id="before"> <div class="zp-label"> <div role="dialog" class="criteriaList"> <ul id="bpConfigCrtDiv">';return transitionsHTML+='</ul></div></div><div id="bpConfigRuleFormatDiv" class="DN form-group criteriaSt"><b>'+ZPI18N.getString("zp.critpattern")+'</b><span id="bpConfigRuleFormatSpan"></span></div></div> <div class="zp-label" id="during"> <span class="S16">'+ZPI18N.getString("zp.insertbpmessage")+'</span><div id="BPmessage" class="PT10 PB10"></div> <div id="bpFieldButtonDiv" class="PB20 fl MR15"><div id="BpLoading"></div> <select class="selectBox" mode="blueprint" name="duringfieldSelect" id="duringFieldlist"> <option value="0">'+ZPI18N.getString("zp.addfield")+'</option> </select></div> <ul id="duringFields" class="bp-drag"></ul></div> ',transitionsHTML+='<div id="after"> <ul class="afterList"> <li> <b>'+ZPI18N.getString("zp.mailalert")+'</b>  <div class="actions"> <i class="IC-add-r"></i> </div> <div class="criteriaList"> <ul id="alertsList"> </ul> <i class="IC-pen ri"></i> </div> </li> <li> <b>'+ZPI18N.getString("zp.workflow.checklist")+'</b>  <div class="actions"> <i class="IC-add-r"></i> </div> <div class="criteriaList"> <i class="IC-pen ri"></i> </div> </li> <li> <b>'+ZPI18N.getString("zp.fieldupdates")+'</b>  <div class="actions"> <i class="IC-add-r"></i> </div> </li> <li> <b>'+ZPI18N.getString("zp.webhooks")+'</b>  <div class="actions"> <i class="IC-add-r"></i> </div> </li> <li> <b>'+ZPI18N.getString("zp.customfunctions")+'</b>  <div class="actions"> <i class="IC-add-r"></i> </div> </li> </ul> </div></div></div> '},showError:function(obj,message){obj.find("#error_message").remove(),obj.append('<div id="error_message" class="ERR MT5">'+message+"</div>")},getKeys:function(jsonObj){var keys=[];if(!jsonObj)return keys;if(Object.keys)keys=Object.keys(jsonObj);else for(var i in jsonObj)jsonObj.hasOwnProperty(i)&&keys.push(i);return keys},filterByStatus:function(option){var pageDiv=$pageId();if(pageDiv.find(".ZPLRow").show(),1==option){if("active"==pageDiv.find("#BpStatusHeader").attr("status"))return;pageDiv.find("#BpStatusHeader").attr("status","active")}else if(2==option){if("inactive"==pageDiv.find("#BpStatusHeader").attr("status"))return;pageDiv.find("#BpStatusHeader").attr("status","inactive")}else if(3==option){if("all"==pageDiv.find("#BpStatusHeader").attr("status"))return;pageDiv.find("#BpStatusHeader").attr("status","all")}pageDiv.find("#bpTableBody").html(""),ZPeople.FireScroll.setRecordCount(0),ProcessBuilder.getAllProcesses(Blueprint.constructList)},resetlocalData:function(){ProcessBuilder.Process.PickListValueDetails={},ProcessBuilder.Process.ConnectionIdVsName={},ProcessBuilder.TransitionIdVsDetails={},ProcessBuilder.transNameVsId={},ProcessBuilder.Transition={}},createNewWorkflow:function(mode){AutomationCommon.pageInsert(mode),$parentPageId().find("#aPageHead").removeClass("DN"),mode===Mailalerts.MODE?Mailalerts.setConfigFormCombo():mode===Fieldupdate.MODE?Fieldupdate.add():mode===ZPACommon.CHECKLIST_MODE?checklist.initiatePage():mode===Task.MODE?Task.addTaskConfig(AutomationCommon.getFormId()):mode===Webhook.MODE?Blueprint.initiateWebhook():mode===NewCustomFunction.MODE?NewCustomFunction.initiatePage():mode===NewTemplate.RECORDTEMPLATEMODE?NewTemplate.newRecordTemplateSlide():mode===MMtemplte.MODE&&(MMtemplte.templateInit(),MMtemplte.addMailMergeTemplte($("<div/>"))),$pageId(mode).find("[name=formSelect]").select2("disable"),$pageId(mode).find(".flwlft").remove(),0==$pageId(mode).find(".flwrht .modal-backdrop").length&&$pageId(mode).find(".flwrht").append('<div class="modal-backdrop in"></div>')},initiateChecklist:function(checklistMode){AutomationCommon.pageInsert(ZPACommon.CHECKLIST_MODE);var pageId=$("#"+AutomationCommon.getCurrentPageId(ZPACommon.CHECKLIST_MODE)).find("#"+checklist.pageId);Layout.Page.hash;if(AutomationCommon.removePaymentException(),"add"==checklistMode){if(pageId.find("#saveClist").removeAttr("disabled"),$("#"+AutomationCommon.getCurrentPageId()).find("#addChecklist").attr("newchecklistcountleft")<=0)return void AutomationCommon.showPaymentException(ZPI18N.getString("zp.checklistpaymentmsg"));checklist.add("ADD"),AutomationCommon.createSlideHeader(ZPI18N.getString("zp.checklist.add"),ZPACommon.CHECKLIST_MODE)}else checklist.editChecklist(Layout.Page.childUrlParam.id)},initiateWebhook:function(){Webhook.viewWebhookSlide(),"FALSE"===Automation.paymentProperty.P_PAYMENT_WEBHOOK_ALLOWED?AutomationCommon.showPaymentException(ZPI18N.getString("zp.webhookpaymentmsg")):AutomationCommon.constructFormListCombo(Webhook.MODE,"webhookSlideFormsList",Layout.Page.childUrlParam.formid),AutomationCommon.createSlideHeader(ZPI18N.getString("zp.addwebhook"))},getMethodOfAction:function(workflowType,tempId,formId){formId=ZPUtil.Validation.isEmpty(formId)?AutomationCommon.getFormId():formId;var method="";switch(workflowType){case"MAILALERT":case"mailAlertIds":method="Mailalerts.edit('"+tempId+"','"+formId+"')";break;case"FIELDUPDATE":case"fieldUpdateIds":method="Fieldupdate.editFieldUpdate('"+tempId+"','"+formId+"')";break;case"CHECKLIST":method="checklist.editChecklist('"+tempId+"')";break;case"WEBHOOK":method="Webhook.editWebhook('"+formId+"','"+tempId+"')";break;case"CUSTOMFN":case"customfnIds":method="NewCustomFunction.getConfig('"+tempId+"','"+formId+"')";break;case"recordTempIds":method="NewTemplate.editRecordTemplateRow('"+formId+"','"+tempId+"')"}return method+=";Blueprint.removeLeftActionPane();"},removeLeftActionPane:function(){$pageId(Blueprint.MODE).find(".flwlft").remove()},showValidationMsg:function(fieldid,message){var fieldmsg=message;$("#"+fieldid).find("#BpValMsg").text(fieldmsg),$("#"+fieldid).find("#BpValMsg").show()},refreshForms:function(){var formId=$pageId(Blueprint.MODE).find("#blueprintDetails").attr("formid");$.each(ZPForm.SINGLE_RECORD_DTL,function(key,form){key.startsWith(formId)&&(form.refresh=!0)})},setProcessedJson:function(ruleList,ProcessedJson,isTransition){if(void 0==ProcessedJson||void 0!=ProcessedJson&&0==ProcessedJson.length){ZPI18N.getString("zp.nocriteriatrans");ruleList.addClass("DN"),isTransition&&ruleList.parent().find("#emptyBpCriteria").length<1&&ruleList.parent().append('<div id="emptyBpCriteria" class="text-center dgry PT20">'+ZPI18N.getString("zp.nocriteriatrans")+'</div><div class="text-center"><div class="btn btn-primary MT20" onclick="Blueprint.criteriaEditor(false)">'+ZPI18N.getString("zp.workflow.addcrt")+"</div></div></div>")}else{ruleList.removeClass("DN"),ruleList.html(""),ruleList.siblings().remove(),$.each(ProcessedJson,function(index,rule){ruleList.append('<li id="curRule"><i class="ri"></i></li>'),ruleLine=ruleList.find("#curRule"),void 0!=rule.Operator&&58==rule.Operator&&void 0!=rule.fcType&&10==rule.fcType?(ruleLine.append('<span><span id="fieldDispName"></span> '+rule.OperatorDisplayName+' <span id="fromVal"></span> <span id="toVal"></span></span>'),ruleLine.find("#fieldDispName").text(rule.fielddisplayName),ruleLine.find("#fromVal").text(rule.fromValue),ruleLine.find("#fieldDispName").text(rule.toValue)):(ruleLine.append('<span><span id="fieldDispName"></span> '+rule.OperatorDisplayName+' <span id="crtVal"></span></span>'),ruleLine.find("#fieldDispName").text(rule.fielddisplayName),ruleLine.find("#crtVal").text(rule.crtVal)),ruleLine.removeAttr("id")});var ruleActions='<li class="actions"> <i onclick=Blueprint.criteriaEditor('+!isTransition+') class="IC-pen-1px"></i> </li>';ruleList.append(ruleActions),isTransition||Blueprint.showSearchBar()}},showSearchBar:function(){var blueprintId=(pageDiv=$pageId()).find("#blueprintDetails").attr("processId"),formId=pageDiv.find("#blueprintDetails").attr("formId"),$myElt=$("#dragableDiv div:last-child");if($myElt.length>0){var availStateTxt=ZPI18N.getString("zp.availablestates");pageDiv.find("#availableStatestxt").text(availStateTxt);var $window=$("#admin-automation-blueprint-edit-formid-"+formId+"-blueprintId-"+blueprintId),myTop=$myElt.offset().top,windowTop=$window.scrollTop(),windowBottom=windowTop+$window.height();if(myTop>windowTop&&myTop<windowBottom)$(".zp-search").hide(),(pageDiv=$pageId()).find("#dragableDiv").find(".ProcessState").show();else $(".zp-search").show()}else{var pageDiv;availStateTxt=ZPI18N.getString("zp.addstates");pageDiv.find("#availableStatestxt").text(availStateTxt),$(".zp-search").hide(),(pageDiv=$pageId()).find("#dragableDiv").find(".ProcessState").show()}},checkEmptyActions:function(){var pageDiv=$pageId().find("#after");$.each(["MAILALERT","CHECKLIST","FIELDUPDATE","WEBHOOK","CUSTOMFN"],function(i,Obj){pageDiv.find("[actname="+Obj+"] .criteriaList ul li").length>0?pageDiv.find("[actname="+Obj+"] [name=mapTableDiv]").show():pageDiv.find("[actname="+Obj+"] [name=mapTableDiv]").hide()})},checkGlobal:function(transitionid,transitionrelid,isglobal,flowTransitions){var result=!1;return isglobal?result=!1:$.each(flowTransitions,function(index,transition){transition.Id!==transitionrelid&&transition.TransitionId==transitionid&&(result=!0)}),result},closeSidebar:function(){$("body").removeClass("ZPsbarMini"),$("body").find("#zp_main_subtabs").addClass("in"),$("#zp_minimax_leftpanel").attr("data-original-title",ZPI18N.getString("zp.minimize"))},saveBlueprintName:function(){var infostates=Layout.Page.container.find("#infoAndStates"),bpName=infostates.find("#bpConfigbpName").text();infostates.find("#error_message").remove(),0!=bpName.length||Blueprint.showError(infostates.find("#bpNameDiv"),ZPI18N.getString("zp.emptyBpName"))},validateOnBlur:function(getThis,e){var pageDiv=$pageId();if("bpDesc"!=$(getThis).attr("ele")||""!=$(getThis).val()){var transitionid=ProcessBuilder.Transition.transitionId;if(void 0!=transitionid&&""!=transitionid){var transition=ProcessBuilder.TransitionIdVsDetails[transitionid];$(getThis).siblings("#error_message").remove();pageDiv=$pageId();if("Name"==$(getThis).attr("ele")){var isNameExists=!1,eletext=$(getThis).text();for(var currTransid in ProcessBuilder.TransitionIdVsDetails){var name=ProcessBuilder.TransitionIdVsDetails[currTransid].Name;void 0!=ProcessBuilder.TransitionIdVsDetails[currTransid].toBeDeleted&&ProcessBuilder.TransitionIdVsDetails[currTransid].toBeDeleted||void 0==name||name.trim().toUpperCase()!=eletext.trim().toUpperCase()||transitionid==currTransid||(isNameExists=!0)}if($.each(Blueprint.currentBpData.TransitionsMeta,function(index,transmeta){transmeta.Name.trim().toUpperCase()==eletext.trim().toUpperCase()&&transmeta.TransitionId!=transitionid&&(isNameExists=!0)}),eletext.length>=50){var args=[ZPI18N.getString("zp.transitionname"),50];return errhtml='<div id="error_message" class="ERR">'+ZPI18N.getString("zp.fieldlength",args)+"</div>",void $(getThis).parent().append(errhtml)}if(0==eletext.trim().length)return void Blueprint.showError(pageDiv.find("#transitionNameDiv"),ZPI18N.getString("zp.mandatorytransition"));if(isNameExists)return void Blueprint.showError(pageDiv.find("#transitionNameDiv"),ZPI18N.getString("zp.uniquetransition"));ProcessBuilder.setOverlayLabel(conn[0],{Name:eletext,TransitionId:transitionid})}else if("Description"==$(getThis).attr("ele")){if((eletext=$(getThis).val()).length>=100){args=[ZPI18N.getString("zp.description"),100];return errhtml='<div id="error_message" class="ERR">'+ZPI18N.getString("zp.fieldlength",args)+"</div>",void $(getThis).parent().append(errhtml)}""==$(getThis).val()&&$(getThis).parents(".sel").removeClass("sel")}else if("InfoMessage"==$(getThis).attr("ele")){eletext=$(getThis).val();""==$(getThis).val()&&$(getThis).parents(".sel").removeClass("sel")}transition[$(getThis).attr("ele")]!=eletext&&(ProcessBuilder.unSavedChanges=!0),transition[$(getThis).attr("ele")]=eletext}}else $(getThis).parents(".sel").removeClass("sel")},showEmptylistPage:function(){var pageId=$pageId(),bpListBody=pageId.find("#bpTableBody");0===bpListBody.has("> tr:visible").length?(pageId.find("#bpTable table").addClass("ht100"),bpListBody.append('<tr class="ZPLRow"> <td colspan="7"> <div class="dtable text-center"> <div class="ctcell"> <div class="bp-animate"> <img src="'+ZPeople.getResourceURL(hrImageUrl+"bp-blueBg.png")+'" class="bp-animateBg1"> <img src="'+ZPeople.getResourceURL(hrImageUrl+"bp-bg.png")+'" class="bp-animateBg2"> <img src="'+ZPeople.getResourceURL(hrImageUrl+"bp-animate.gif")+'" class="bp-animateGif"> </div> <p class="dgry">'+ZPI18N.getString("zp.designdefineprocess")+'</p> <button type="button" class="btn btn-primary MT10" onclick="Blueprint.add();">'+ZPI18N.getString("zp.letsgetstarted")+"</button> </div> </div> </td> </tr>")):pageId.find("#bpTable table").removeClass("ht100")},clearPlaceHolder:function(){0==$(this).text().length&&$(this).empty()},cancelBpCheck:function(){var pageDiv=$pageId(),bpDescInput=pageDiv.find("#bpConfigDesc");description=bpDescInput.val();var bpNameInput=pageDiv.find("#bpConfigbpName");Name=bpNameInput.text(),Blueprint.currentBpData.Name==Name&&Blueprint.currentBpData.Description==description||(ProcessBuilder.unSavedChanges=!0),ProcessBuilder.unSavedChanges?ZPeople.BSModal.confirm(Blueprint.cancel,null,ZPI18N.getString("zp.unsavedchnglost"),null,null,null):Blueprint.cancel()},getTransitionSuggestions:function(){var formId=Layout.Page.urlparam.formid,params={method:"fetchTransitionsList"};params.formId=formId,ZPeople.Request.sendRequest("/transitionAction.zp",params,"GET",function(resultData){1==resultData[0]&&(ProcessBuilder.transNameVsId[formId]=resultData[1].transitions,Blueprint.suggestTransitions())})},refreshTransSuggestionCache:function(formId){$.each(ProcessBuilder.TransitionIdVsDetails,function(){if(this.toBeDeleted){var transitionId=this.transitionId;$.each(ProcessBuilder.transNameVsId[formId],function(ind,trans){if(trans.transitionId==transitionId)return ProcessBuilder.transNameVsId[formId].splice(ind,1),!1})}if(this.isNewTransition){var transCacheObj={transitionId:this.transitionId,transitionName:this.Name,processName:Blueprint.currentBpData.Name};Blueprint.isTransitionInSuggestionCache(ProcessBuilder.transNameVsId[formId],this.transitionId)||ProcessBuilder.transNameVsId[formId].push(transCacheObj)}}),$.each(ProcessBuilder.transNameVsId[formId],function(index,value){void 0!=ProcessBuilder.TransitionIdVsDetails[value.transitionId]&&ProcessBuilder.TransitionIdVsDetails[value.transitionId].Name!=value.transitionName&&(value.transitionName=ProcessBuilder.TransitionIdVsDetails[value.transitionId].Name)})},isTransitionInSuggestionCache:function(cache,transid){var isCached=!1;return $.each(cache,function(index,transition){transition.transitionId==transid&&(isCached=!0)}),isCached},constructTransSuggestions:function(){var pageDiv=$pageId(),formId=Layout.Page.urlparam.formid,transListHtml="",transName=pageDiv.find("#pb_transitionName").text().toLowerCase().trim(),listClass="",cloneTransExist=!1,addNewLiHeader='<li class="zp_dropListHdr" id="addnewLi">'+ZPI18N.getString("zp.addnew")+'</li><li id="curTransName" class=""><label id="curTransNameLabel"></label></li>',cloneTransLiHeader='<li class="zp_dropListHdr" id="clonetransLi">'+ZPI18N.getString("zp.clonetransition")+"</li>";$.each(ProcessBuilder.transNameVsId[formId],function(index,transition){var hiddenCls="DNI";transition.transitionName.includes(transName)&&(hiddenCls="",listClass="zp_shw",cloneTransExist=!0),transListHtml+="<li id="+transition.transitionId+' class="'+hiddenCls+'"><label></label><span class="FR"></span></li>'});transListHtml='<div id="transListDiv" class="zp_drop '+listClass+'" style="z-index:2; width:480px;"><div class="zpD_scrl"><ul id="transList" >'+addNewLiHeader+cloneTransLiHeader+transListHtml+"</ul></div></div>",pageDiv.find("#transitionNameDiv").after(transListHtml),pageDiv.find("#curTransNameLabel").text(transName),$.each(ProcessBuilder.transNameVsId[formId],function(index,transition){pageDiv.find("#transList li#"+transition.transitionId+" label").text(transition.transitionName),pageDiv.find("#transList li#"+transition.transitionId+" span").text(transition.processName)}),""==transName?(pageDiv.find("#addnewLi").addClass("DNI"),pageDiv.find("#curTransName").addClass("DNI"),pageDiv.find("#clonetransLi").removeClass("MT20I")):(pageDiv.find("#addnewLi").removeClass("DNI"),pageDiv.find("#curTransName").removeClass("DNI"),pageDiv.find("#clonetransLi").addClass("MT20I"),pageDiv.find("#transListDiv").addClass("zp_shw")),cloneTransExist?pageDiv.find("#clonetransLi").removeClass("DNI"):pageDiv.find("#clonetransLi").addClass("DNI"),pageDiv.find("#pb_transitionName").removeAttr("onkeyup"),$(document).on("click",function(e){"transListDiv"!=e.target.id&&"pb_transitionName"!=e.target.id&&pageDiv.find("#transListDiv").removeClass("zp_shw")}),$("#curTransName").on("click",function(e){pageDiv.find("#transListDiv").removeClass("zp_shw")}),pageDiv.find("#pb_transitionName").on("keyup",function(e){var transName=pageDiv.find("#pb_transitionName").text().toLowerCase().trim(),cloneTransExist=!1;pageDiv.find("#curTransNameLabel").text(transName),$.each(pageDiv.find("#transList li label"),function(index,trans){"curTransNameLabel"!=$(trans).attr("id")&&($(trans).text().toLowerCase().includes(transName)?($(trans).parents("li").removeClass("DNI"),pageDiv.find("#transListDiv").addClass("zp_shw"),cloneTransExist=!0):($(trans).parents("li").addClass("DNI"),pageDiv.find("#transList .DNI").length==pageDiv.find("#transList li").length&&pageDiv.find("#transListDiv").removeClass("zp_shw")))}),""==transName?(pageDiv.find("#addnewLi").addClass("DNI"),pageDiv.find("#curTransName").addClass("DNI"),pageDiv.find("#clonetransLi").removeClass("MT20I"),cloneTransExist||pageDiv.find("#transListDiv").removeClass("zp_shw")):(pageDiv.find("#addnewLi").removeClass("DNI"),pageDiv.find("#curTransName").removeClass("DNI"),pageDiv.find("#clonetransLi").addClass("MT20I"),pageDiv.find("#transListDiv").addClass("zp_shw")),cloneTransExist?pageDiv.find("#clonetransLi").removeClass("DNI"):pageDiv.find("#clonetransLi").addClass("DNI")}),pageDiv.find("#transListDiv li").on("click",function(){if("addnewLi"!=$(this).attr("id")&&"clonetransLi"!=$(this).attr("id")&&"curTransName"!=$(this).attr("id")){var transId=$(this).attr("id");0!=pageDiv.find("#cloneWarning").length&&pageDiv.find("#cloneWarning").remove();for(var transName=$(this).find("label").text(),i=1;i<ProcessBuilder.transLimit+1;i++){var eletext=transName+"_"+i,isNameExists=!1;for(var currTransid in ProcessBuilder.TransitionIdVsDetails){var name=ProcessBuilder.TransitionIdVsDetails[currTransid].Name;void 0!=ProcessBuilder.TransitionIdVsDetails[currTransid].toBeDeleted&&ProcessBuilder.TransitionIdVsDetails[currTransid].toBeDeleted||void 0==name||name.trim().toUpperCase()!=eletext.trim().toUpperCase()||(isNameExists=!0)}for(var j=0;j<Blueprint.currentBpData.TransitionsMeta.length;j++){Blueprint.currentBpData.TransitionsMeta[j].Name.trim().toUpperCase()==eletext.trim().toUpperCase()&&(isNameExists=!0)}if(!isNameExists){transName=eletext;break}}pageDiv.find("#pb_transitionName").text(eletext),$('<div class="label-note" id="cloneWarning" transid='+transId+'><i class="IC-info"></i><span class="S13">'+ZPI18N.getString("zp.clonetrans",[$(this).find("label").html()])+'</span><span class="FR"><i class="IC-delete-1px" onclick="$(this).parents(\'#cloneWarning\').remove()"></i></span></div>').insertAfter(pageDiv.find("#pb_transitionName"))}})},showHideTransSuggestions:function(pageDiv){pageDiv.find("#transList .DNI").length==pageDiv.find("#transList li").length?pageDiv.find("#transListDiv").removeClass("zp_shw"):pageDiv.find("#transListDiv").addClass("zp_shw")},suggestTransitions:function(){var pageDiv=$pageId(),formId=Layout.Page.urlparam.formid,isSuggestionCached=void 0!=ProcessBuilder.transNameVsId[formId],isSuggestionDivEmpty=0==pageDiv.find("#transListDiv").length;!isSuggestionCached&&isSuggestionDivEmpty?Blueprint.getTransitionSuggestions():(Blueprint.refreshTransSuggestionCache(formId),0==pageDiv.find("#transListDiv").length?Blueprint.constructTransSuggestions():Blueprint.showHideTransSuggestions(pageDiv))},processVrForClone:function(fields){fields.forEach(function(field){field.valruleid&&delete field.valruleid,field.validationJson&&(field.validationJson.VALIDATION_RULE_ID&&delete field.validationJson.VALIDATION_RULE_ID,field.validationJson.IS_ACTIVE&&delete field.validationJson.IS_ACTIVE,field.validationJson.VALIDATIONTYPE=2,field.validationJson.baseConditions.forEach(function(baseCondition){baseCondition.VALIDATION_ACTION_ID&&delete baseCondition.VALIDATION_ACTION_ID}))})},setCriteriaPattern:function(ruleFormat,pageDiv,id){"(1)"==ruleFormat||""==ruleFormat?pageDiv.find("#"+id+"Div").addClass("DN"):void 0!=ruleFormat&&(ruleFormat=void 0!=ruleFormat?Criteria.replaceRuleFormatToString(ruleFormat):"",pageDiv.find("#"+id+"Span").text(ruleFormat),pageDiv.find("#"+id+"Div").removeClass("DN"))},handleBpCriteriaPattern:function(crtBody){Layout.Page.hash.indexOf("/automation/blueprint")>=0&&(crtBody.find("#patternSaveDiv").removeClass("col-md-2").addClass("col-md-3"),crtBody.find("#patternSaveDiv [name='rulePtrnCancel']").addClass("btn-sm"),crtBody.find("#patternSaveDiv [name='rulePtrnSave']").addClass("btn-sm"))}};Blueprint.Validation={ruleGroupTemplate:'<div class="panel-group dvvalidruleacc" id="dvValidruleparent">$RULECONSTRUCT$</div>',AddRemoveTemplate:'<div class="form-group col-md-1" name="addRemoveDiv"><div class="dvlist-action MT8"> <a onclick="Blueprint.Validation.addDeleteCondition(this, false)" class="IC-remove red text-right" data-original-title="Remove"></a><a onclick="Blueprint.Validation.addDeleteCondition(this, true)" class="IC-add-r text-right" data-original-title="Remove"></a> </div></div>',andorTemplate:'<div class="form-group col-md-12 ML15" key="conjunctiveCondn" name="operatorDiv" rulenum="$NUM$"><span class="listOpr"><em keyname="conjunctiveCondn" onclick="Blueprint.Validation.updateOperatorPattern(this,$IND$)" class="and $ANDCLASS$" >'+ZPI18N.getString("zp.captialand")+'</em><em keyname="conjunctiveCondn" onclick="Blueprint.Validation.updateOperatorPattern(this,$IND$)" class="or $ORCLASS$">'+ZPI18N.getString("zp.captialor")+"</em></span></div>",currentValidationJson:{},initVal:function(bpMode,fieldid){var transitionid=ProcessBuilder.Transition.transitionId;$.each(ProcessBuilder.TransitionIdVsDetails[transitionid].Fields,function(index,field){field.id==fieldid&&(Blueprint.Validation.currentValidationJson=field.validationJson)}),void 0==Blueprint.Validation.currentValidationJson&&(Blueprint.Validation.currentValidationJson={},Blueprint.Validation.currentValidationJson.BASE_FCID=fieldid.toString()),Blueprint.Validation.addRule(),$("#validationrule").find(".modal-footer").show()},addRule:function(){ValidationRule.validationType=ValidationRule.validationTypes.BLUEPRINT;var formId=Layout.Page.urlparam.formid;ValidationRule.formid=formId,void 0==ZPForm.FORM_COMPONENT_DATA[formId]?ZPFRules.getFormComponents({},{},{forPost:!0,formId:formId,isValidation:!0,isBlueprint:!0,bpValidation:!0}):Blueprint.Validation.rulesConstruction(formId,Blueprint.Validation.currentValidationJson)},rulesConstruction:function(formId,validationJson){validationJson=Blueprint.Validation.currentValidationJson;var ruleDiv=ZPeople.createModalPopup("validationrule",ZPI18N.getString("zp.bpfieldval"),"modal ZPmdl bluePrint");$(ruleDiv).find("[buttonname=done]").html(ZPI18N.getString("zp.save")),$(ruleDiv).find("[buttonname=done]").siblings("[buttonaction]").html(ZPI18N.getString("zp.close")),$(ruleDiv).find("[buttonname=done]").off(),$(ruleDiv).find("[buttonname=done]").on("click",function(){Blueprint.Validation.ruleCreation(this),ProcessBuilder.unSavedChanges=!0}),$(ruleDiv).find("#bodyTag").attr("formId",formId);var ruleHtml="";if(void 0!=validationJson&&(ZPFRules.count=1,ruleHtml+=Blueprint.Validation.singleRuleAdd(formId,validationJson)),""==ruleHtml){var emptyFormDiv='<div class="col-lg-12 text-center"><div id="zp_views_norecclass" class="PArds"></div><h2 id="zp_nodata" class="ZPNdt">'+ZPI18N.getString("zp.emptyform")+"</h2></div>";$(ruleDiv).find("h4").replaceWith('<h6 class="modal-title S16">'+ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName])+"</h6>"),$(ruleDiv).find("#bodyTag").html(emptyFormDiv)}else{var ruleGrp=Blueprint.Validation.ruleGroupTemplate;ruleGrp=ruleGrp.replace(/\$RULECONSTRUCT\$/g,ruleHtml),$(ruleDiv).find("#bodyTag").html(ruleGrp),$(ruleDiv).find("[makeEmpty=true]").val(""),$(ruleDiv).find("#dvRule1").addClass("fade in"),$(ruleDiv).find("h4").replaceWith('<h6 class="modal-title S16">'+ZPI18N.getString("zp.addrulefor",[ZPForm.FORM_COMPONENT_DATA[formId].formDetails.formdisplayName])+"</h6>"),$(ruleDiv).find("select").select2()}addRemoveDivs=$(ruleDiv).find("[name=addRemoveDiv]");var len=addRemoveDivs.length;addRemoveDivs.each(function(index,addRemoveDiv){index<len-1&&$(addRemoveDiv).find(".IC-add-r").addClass("DN")})},ruleCreation:function(obj){var parentDiv=$(obj).parents("#validationrule").find("#bodyTag [id*=dvRule]:visible");if(""==parentDiv.find("#message").val().trim())hasError=!0,parentDiv.find("[name=vmsg] [errorid=errorDiv]").html(ZPI18N.getString("zp.entervalueforcondn")),parentDiv.find("[name=vmsg] [errorid=errorDiv]").show();else if(parentDiv.find("#message").val().length>=250){hasError=!0;var args=[ZPI18N.getString("zp.valmsglower"),250];parentDiv.find("[name=vmsg] [errorid=errorDiv]").html(ZPI18N.getString("zp.fieldlength",args)),parentDiv.find("[name=vmsg] [errorid=errorDiv]").show()}else hasError=ZPFRules.validateRuleDiv(parentDiv);var baseFC=Blueprint.Validation.currentValidationJson.BASE_FCID;if(!hasError&&parentDiv.find("#editPatternDiv").is(":visible")&&(hasError=Blueprint.Validation.validatePattern(Layout.Page.container.find("#editPatternDiv textarea[type=button]"),!0)),!hasError){for(var validationJson={VALIDATION_MSG:parentDiv.find("#message").val(),VALIDATIONTYPE:ValidationRule.validationType},patternText=parentDiv.find("#patternText").text();null!=patternText.match(/\(/g);){var replaceText="$"+patternText.match(/\(/g).length+"$-",lastInd=patternText.lastIndexOf("("),finalText=patternText.substr(lastInd+1),firstInd=finalText.indexOf(")");finalText=finalText.substr(0,firstInd)+replaceText+finalText.substr(firstInd+1),patternText=patternText.substr(0,lastInd)+replaceText+finalText}patternText=parentDiv.find("[id=criteriaInd]").length>1?ValidationRule.removeDummyBrackets(patternText):"1",validationJson.secondaryConditions=Blueprint.Validation.constructSec(patternText,parentDiv),void 0!=parentDiv.find("[ruleid]").attr("actionid")&&""!=parentDiv.find("[ruleid]").attr("actionid").trim()&&(validationJson.VALIDATION_ACTION_ID=parentDiv.find("[ruleid]").attr("actionid")),validationJson.PATTERNTEXT=patternText.trim().length>1?ValidationRule.convertToBrackets(patternText):"",parentDiv.find("#editPatternDiv textarea[type=text]").val(validationJson.PATTERNTEXT);var validationsJson={BASE_FCID:baseFC,baseConditions:[validationJson],VALIDATIONTYPE:ValidationRule.validationType};void 0!=parentDiv.find("[ruleid]").attr("ruleid")&&""!=parentDiv.find("[ruleid]").attr("ruleid").trim()&&(validationsJson.VALIDATION_RULE_ID=parentDiv.find("[ruleid]").attr("ruleid"));ProcessBuilder.Transition.transitionId,$(obj).parents("#validationrule").find("#bodyTag").attr("formid");Blueprint.mapValidationToField(validationsJson),$(".modal").modal("hide")}},singleRuleAdd:function(formId,rule){var mainDiv='<div class="clearfix" name="singleRuleDiv"><div id="dvRule$COUNT$"><div ruleid="$RULEID$" actionid="$ACTIONID$" class="col-md-12"><div class="clearfix"><div class="clearfix PB5"></div>$RULEDIV$</div><div class="dverrormsg DN" errorid="errorDiv"></div></div></div></div>';mainDiv=mainDiv.replace(/\$COUNT\$/g,ZPFRules.count);var ruleId=void 0!=rule&&rule.hasOwnProperty("VALIDATION_RULE_ID")?rule.VALIDATION_RULE_ID:"";mainDiv=mainDiv.replace(/\$RULEID\$/g,ruleId);var ruleDiv='<div class="clearfix"><div class="fieldCriteria"><div class="fieldCriteriaInner">';fields=ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails;var others={fields:fields,formId:formId};void 0!=rule&&Object.keys(rule).length>0&&(others.fieldArray=[rule.BASE_FCID],others.disabled=!0),others.firstFieldFix=!0;var fcId=ZPFRules.findFirstFcId(fields,formId,ZPForm.FORM_COMPONENT_DATA[formId].formDetails.tableName,!0),conditionArray=rule.hasOwnProperty("baseConditions")?rule.baseConditions:[{formComponentID:rule.BASE_FCID}];return $.each(conditionArray,function(index,condition){mainDiv=mainDiv.replace(/\$ACTIONID\$/g,condition.hasOwnProperty("VALIDATION_ACTION_ID")?condition.VALIDATION_ACTION_ID:""),ruleDiv+=Blueprint.Validation.constructConditions(condition,fcId,formId,others);var DN="DN";val="",condition.hasOwnProperty("PATTERNTEXT")&&""!=condition.PATTERNTEXT.trim()&&(DN="",val=condition.PATTERNTEXT),ruleDiv+='</div><div class="form-group PT10 '+DN+'" id="patternDiv"> <label class="dgry S13">'+ZPI18N.getString("zp.critpattern")+'</label> <div class="criPattern"> <div id="patternTextDiv"> <span class="FL" id="patternText">'+val+'</span> <span class="FR"> <a onclick="Blueprint.Validation.editValidationPattern()">'+ZPI18N.getString("zp.editpattern")+'</a> <i class="IC-info"></i> </span> </div> <div id="editPatternDiv" class="DNI"> <textarea>'+val+'</textarea> <span class="actions"> <a onclick="Blueprint.Validation.validatePattern(this,true)">'+ZPI18N.getString("zp.save")+'</a> <a onclick="Blueprint.Validation.validatePattern(this,false)" class="dgry">'+ZPI18N.getString("zp.cancel")+"</a> </span> </div> </div> </div>",ruleDiv+='<div class="dverrormsg DN FR" errorid="errorDiv"></div>',ruleDiv+='<div class="form-group" name="vmsg"><label class="dgry err S13">'+ZPI18N.getString("zp.valmsg")+'</label><input id="message" type="text" class="form-control DIB" value="'+(void 0!=condition.VALIDATION_MSG?ZPeople.escapeHtml(condition.VALIDATION_MSG):"")+'"/>'+ZPFRules.errorTemplate+"</div></div>"}),""==ruleDiv?ruleDiv:(ruleDiv+="</div>",mainDiv=mainDiv.replace(/\$RULEDIV\$/g,ruleDiv))},constructConditions:function(condition,fcId,formId,others,index,patternText){void 0==index&&(index=1),ZPFRules.count=index;var tempDiv="",ruleDiv="";if(condition.hasOwnProperty(ValidationRule.validationKeys.conjunctiveCondn)){ruleDiv+=Blueprint.Validation.andorTemplate;var selTxt="and"==condition[ValidationRule.validationKeys.conjunctiveCondn]?"$ORCLASS$":"$ANDCLASS$";ruleDiv=(ruleDiv=(ruleDiv=ruleDiv.replace(selTxt," DN")).replace(/\$[A-Z]+CLASS\$/,"")).replace(/\$(IND|NUM)\$/g,index)}if(condition.hasOwnProperty(ValidationRule.validationKeys.fcid)){if(others.fieldDtl=ZPForm.Field.getFieldComponent(condition[ValidationRule.validationKeys.fcid],formId),void 0==others.fieldDtl&&(others.fieldDtl={}),others.fieldArray=[condition[ValidationRule.validationKeys.fcid]],others.id=[condition.conditionId],others.formId=formId,tempDiv=ZPFRules.createRuleConditionFromTemplate("col-md-3 ML15","conditionFields",others,ValidationRule.validationKeys.fcid,!0),delete others.firstFieldFix,""==tempDiv)return ruleDiv;ruleDiv+='<label name="conditionDiv" class="FL ML20 PT5" ind='+index+' id="criteriaInd">'+index+"</label>",ruleDiv+=tempDiv,others.condition=condition[ValidationRule.validationKeys.operator],others.fieldDtl.fieldType!=ZPForm.Field.PICKLIST&&others.fieldDtl.fieldType!=ZPForm.Field.LOOKUP||void 0==ValidationRule.selectOperator[others.condition]||(others.condition=ValidationRule.selectOperator[others.condition]),ruleDiv+=ZPFRules.createRuleConditionFromTemplate("col-md-3","condition",others,ValidationRule.validationKeys.operator),others.fieldValue=condition.hasOwnProperty(ValidationRule.validationKeys.value)?condition[ValidationRule.validationKeys.value]+"":"",others.fieldValue=others.fieldValue.replace(/\[|\]|"/g,""),ruleDiv+=ZPFRules.createRuleConditionFromTemplate("col-md-4","fieldValue",others,ValidationRule.validationKeys.value),ruleDiv+=Blueprint.Validation.AddRemoveTemplate,index++,ZPFRules.count=index}if(condition.hasOwnProperty("secondaryConditions")){var sConditions=condition.secondaryConditions;$.each(sConditions,function(scInd,sCondition){ruleDiv+=Blueprint.Validation.constructConditions(sCondition,fcId,formId,others,ZPFRules.count)})}return ruleDiv},addDeleteCondition:function(obj,isAdd){Blueprint.Validation.closeValidationPattern();var parentDiv=$(obj).parents("#bodyTag"),currentInd=-1;if(isAdd){if($(obj).parents("#dvValidruleparent").find('[id="criteriaInd"]').length>8)return;var formId=parentDiv.attr("formid"),others={fields:ZPForm.FORM_COMPONENT_DATA[formId].message.formComponentDetails},fcId=Blueprint.Validation.currentValidationJson.BASE_FCID,conditionActionDiv="",keyJson={cf:"conditionFields",con:"condition",fieldVal:"fieldValue"};if($(obj).parents("#dvValidruleparent").length>0){currentInd=parseInt($(obj).parents("[name=addRemoveDiv]").prevAll("#criteriaInd").first().attr("ind"))+1;conditionActionDiv=(conditionActionDiv=(conditionActionDiv=(conditionActionDiv=Blueprint.Validation.andorTemplate+'<label name="conditionDiv" class="FL ML20 PT5" id="criteriaInd" ind='+currentInd+">"+currentInd+"</label>").replace("$ORCLASS$","DN")).replace(/\$[A-Z]+CLASS\$/g,"")).replace(/\$(IND|NUM)\$/g,currentInd),keyJson={cf:"formComponentID",con:"Operator",fieldVal:"CrtVal"}}var ruleDiv=ZPFRules.ruleConditionTemplate;others.fieldDtl=ZPForm.Field.getFieldComponent(fcId,formId),others.fieldArray=[fcId],others.formId=formId;var selDiv="";conditionActionDiv=(conditionActionDiv=(conditionActionDiv+=(ruleDiv=ruleDiv.replace(/\$NAME\$/g,"conditionDiv")).replace(/\$CLASS\$/g,"col-md-3 ML15")).replace(/\$KEY\$/g,keyJson.cf)).replace(/\$ID\$/g,"conditionFields"),selDiv=ZPFRules.addFieldsForSelect(others.fields,!0,others,!1,!0),conditionActionDiv=conditionActionDiv.replace(/\$CONDITION\$/g,selDiv),conditionActionDiv=(conditionActionDiv=(conditionActionDiv+=ruleDiv.replace(/\$CLASS\$/g,"col-md-3")).replace(/\$KEY\$/g,keyJson.con)).replace(/\$ID\$/g,"condition"),selDiv=ZPFRules.addConditionsForField(others.fieldDtl.fieldType,others.condition),conditionActionDiv=conditionActionDiv.replace(/\$CONDITION\$/g,selDiv),conditionActionDiv=(conditionActionDiv=(conditionActionDiv=(conditionActionDiv+=ruleDiv.replace(/\$CLASS\$/g,"col-md-4")).replace(/\$KEY\$/g,keyJson.fieldVal)).replace(/\$ID\$/g,"fieldValue")).replace(/\$NUM\$/g,currentInd),selDiv=ZPFRules.changeFieldForValue(others.condition,others.fieldDtl,void 0!=others.fieldValue?others.fieldValue:"",others.formId),conditionActionDiv=conditionActionDiv.replace(/\$CONDITION\$/g,selDiv),conditionActionDiv+=Blueprint.Validation.AddRemoveTemplate,$(conditionActionDiv).insertAfter($(obj).parents("[name=addRemoveDiv]")),$(obj).parents("#dvValidruleparent").length>0&&2==parentDiv.find("[ind="+currentInd+"]").length&&$(obj).parents("[name=addRemoveDiv]").nextAll("[id=criteriaInd]").first().nextAll('[key="conjunctiveCondn"]').each(function(){var ind=$(this).attr("rulenum");$(this).attr("rulenum",++ind),$(this).next("#criteriaInd").attr("ind",ind).text(ind),$(this).nextAll("[rulenum="+(ind-1)+"]").attr("rulenum",ind)}),-1!=currentInd&&parentDiv.find("[id=criteriaInd]").length>1&&(parentDiv.find("#patternDiv").removeClass("DN"),Blueprint.Validation.constructPatternAdd(parentDiv,currentInd,"and")),$(obj).parents("[id*=dvRule]").find("select").select2(),$(obj).addClass("DN")}else if($(obj).parents("[id*=dvRule]").find("[name=conditionDiv]").length>5){if($(obj).parents("#dvValidruleparent").length>0&&(currentInd=parseInt($(obj).parents("[name=addRemoveDiv]").prevAll("#criteriaInd").first().attr("ind")),$(obj).parents("[name=addRemoveDiv]").nextAll("[id=criteriaInd]").each(function(){var ind=$(this).attr("ind");$(this).attr("ind",--ind),$(this).prev("[key=conjunctiveCondn]").attr("rulenum",ind),$(this).nextAll("[rulenum="+(ind+1)+"]").attr("rulenum",ind),$(this).text(ind)})),$(obj).parents("[name=addRemoveDiv]").prev("[name=conditionDiv]").remove(),$(obj).parents("[name=addRemoveDiv]").prev("[name=conditionDiv]").remove(),$(obj).parents("[name=addRemoveDiv]").prev("[name=conditionDiv]").remove(),$(obj).parents("[name=addRemoveDiv]").prev("[name=conditionDiv]").remove(),1==currentInd){var delOp="and";$(obj).parents("[name=addRemoveDiv]").next("[name=operatorDiv]").find("em").each(function(){$(this).hasClass("DN")||(delOp=$(this).hasClass("and")?"and":"or")}),$(obj).parents("[name=addRemoveDiv]").next("[name=operatorDiv]").remove()}else{delOp="and";$(obj).parents("[name=addRemoveDiv]").prev("[name=operatorDiv]").find("em").each(function(){$(this).hasClass("DN")||(delOp=$(this).hasClass("and")?"and":"or")}),$(obj).parents("[name=addRemoveDiv]").prev("[name=operatorDiv]").remove()}var criteriaContainerDiv=$(obj).parents(".fieldCriteriaInner");$(obj).parents("[name=addRemoveDiv]").remove(),addRemoveDivs=$(criteriaContainerDiv).find("[name=addRemoveDiv]");var len=addRemoveDivs.length;if(len-1>=0){var showDiv=addRemoveDivs[len-1];$(showDiv).find(".IC-add-r").hasClass("DN")&&$(showDiv).find(".IC-add-r").removeClass("DN")}-1!=currentInd&&(1==parentDiv.find("[id=criteriaInd]").length?(parentDiv.find("#patternText").text(""),parentDiv.find("#editPatternDiv texarea").val(""),parentDiv.find("#patternDiv").addClass("DN")):Blueprint.Validation.constructPatternDelete(parentDiv,currentInd,delOp))}},constructPatternAdd:function(parentDiv,addInd,addOperator){var patternText=parentDiv.find("#patternText").first().text();if((patternText=patternText.replace(/\s/g,"")).length>0){if((patternText="("+patternText).indexOf(addInd)>-1){var indexValue=(patternText=patternText.replace(/\d+/g,function(match){return parseInt(match)>=addInd?parseInt(match)+1:parseInt(match)})).indexOf(addInd-1)+(addInd-1).toString().length,updateSubStr=patternText.substr(indexValue);patternText=patternText.substr(0,patternText.indexOf(addInd-1)+1),patternText+=addOperator+addInd+")"+updateSubStr}else patternText+=addOperator+addInd+")";patternText=(patternText=patternText.replace(/and/g," and ")).replace(/or/g," or ")}else patternText="(1 and 2)";parentDiv.find("#patternText").text(patternText)},constructPatternDelete:function(parentDiv,deleteInd,deleteOperator){var patternText=parentDiv.find("#patternText").text(),updateSubStr=(patternText=patternText.replace(/\s/g,"")).split(deleteInd)[0],firstInd=patternText.indexOf(deleteInd)+1;if(deleteInd>1){var delOpInd=updateSubStr.lastIndexOf(deleteOperator);patternText=(patternText=(updateSubStr=updateSubStr.substr(0,delOpInd)+updateSubStr.substr(delOpInd+deleteOperator.length))+patternText.substr(firstInd)).replace("()","")}else patternText=(patternText=updateSubStr+patternText.substr(firstInd).replace(deleteOperator,"")).replace("()","");patternText=patternText.replace(/\d+/g,function(match){return parseInt(match)>deleteInd?parseInt(match)-1:parseInt(match)}),parentDiv.find("#patternText").text(patternText)},validatePattern:function(obj,save){var parentDiv=$(obj).parents("#bodyTag").find("[id*=dvRule]:visible");if(save){parentDiv.find("#patternDiv").siblings("[errorid=errorDiv]").html(""),parentDiv.find("#patternDiv").siblings("[errorid=errorDiv]").removeClass("DN");var patternText=parentDiv.find("#editPatternDiv textarea").first().val(),errorMsg="";if((patternText=patternText.replace(/\s/g,"")).match(/\(/g).length!=patternText.match(/\)/g).length)return errorMsg=ZPI18N.getString("zp.patternbrack"),parentDiv.find("#patternDiv").siblings("[errorid=errorDiv]").html(errorMsg),!0;var invalid_number,lastInd=parseInt(parentDiv.find("[id=criteriaInd]").last().attr("ind"));for(presentNumbers=patternText.match(new RegExp(/\d/g)),numind=0;numind<presentNumbers.length;numind++)if(presentNumbers[numind]>lastInd){invalid_number=presentNumbers[numind];break}if(void 0!=invalid_number)return errorMsg=ZPI18N.getString("zp.patterncheck",[invalid_number]),parentDiv.find("#patternDiv").siblings("[errorid=errorDiv]").html(errorMsg),!0;for(var ind=0,numberMatch=patternText.match(/\d+/g);ind<numberMatch.length;)if(ind+1!=numberMatch[ind++])return errorMsg=ZPI18N.getString("zp.patterncheck",numberMatch[ind-1]),parentDiv.find("#patternDiv").siblings("[errorid=errorDiv]").html(errorMsg),!0;var totalCriterias=parentDiv.find("[id=criteriaInd]").length,operMatch=patternText.match(/and|or/gi);if(null!=operMatch&&(operMatch=operMatch.map(function(x){return x.toLowerCase()})),null==operMatch||numberMatch.length!=totalCriterias||operMatch.length!=totalCriterias-1||""!=patternText.replace(/\d+|\(|\)|and|or/g,""))return errorMsg=ZPI18N.getString("zp.critpatternfail"),parentDiv.find("#patternDiv").siblings("[errorid=errorDiv]").html(errorMsg),parentDiv.find("#patternDiv").siblings("[errorid=errorDiv]").removeClass("DN"),!0;for(ind=0;ind<operMatch.length;){var val="and"==operMatch[ind]?"and":"or",hideVal="and"==operMatch[ind]?"or":"and";parentDiv.find("[name=operatorDiv]").eq(ind).find("."+val).removeClass("DN"),parentDiv.find("[name=operatorDiv]").eq(ind).find("."+hideVal).addClass("DN"),ind++}parentDiv.find("#patternText").text(parentDiv.find("#editPatternDiv textarea").first().val()),parentDiv.find("#patternDiv").siblings("[errorid=errorDiv]").addClass("DN")}Blueprint.Validation.closeValidationPattern()},updateOperatorPattern:function(obj){Blueprint.Validation.closeValidationPattern();var parentDiv=$(obj).parents("#bodyTag").find("[id*=dvRule]:visible"),updateInd=parseInt($(obj).parents("[name=operatorDiv]").next("#criteriaInd").attr("ind")),patternText=parentDiv.find("#patternText").text();if(patternText=patternText.replace(/\s/g,""),$(obj).siblings($(obj).hasClass("and")?".or":".and").removeClass("DN"),$(obj).addClass("DN"),patternText.length>0){var subStr=patternText.substr(0,patternText.indexOf(updateInd)),prevOperatorValue=($(obj).hasClass("and")?"or":"and").toLowerCase(),prevOperator="and"===prevOperatorValue?"or":"and",ind=subStr.lastIndexOf(prevOperator),finalText=subStr.substr(0,ind);finalText+=subStr.substr(ind).replace(prevOperator,prevOperatorValue),finalText=(finalText=(finalText+=patternText.substr(patternText.indexOf(updateInd))).replace(/and/g," and ")).replace(/or/g," or "),parentDiv.find("#patternText").text(finalText)}},constructSec:function(patternText,parentDiv){var subArr=[],secArr=[];if(null!=patternText.match(/\$\d+\$-/g)){var firstBr=patternText.match(/\$\d+\$-/g)[0],firstBrLen=patternText.match(/\$\d+\$-/g)[0].length;0==patternText.indexOf(firstBr)&&patternText.lastIndexOf(firstBr)==patternText.length-firstBrLen&&(patternText=patternText.substr(firstBrLen,patternText.length-2*firstBrLen))}if(patternText.trim().length>0){subArr=[],secArr=[];if(null!=patternText.match(/\$\d+\$-/g)){firstBr=patternText.match(/\$\d+\$-/g)[0],firstBrLen=patternText.match(/\$\d+\$-/g)[0].length;0==patternText.indexOf(firstBr)&&patternText.lastIndexOf(firstBr)==patternText.length-firstBrLen&&(patternText=patternText.substr(firstBrLen,patternText.length-2*firstBrLen))}if(patternText.trim().length>0)if(null!=patternText.match(/\$\d+\$-/)){var halfText,substr=patternText.match(/\$\d+\$-/g)[0],stInd=patternText.indexOf(substr),endInd=patternText.lastIndexOf(substr),subLen=substr.length,arrInd=0;if(stInd>0)if(null!=(criterias=(halfText=patternText.substr(0,stInd)).match(/\d+/g)))for(var cInd=0;cInd<criterias.length;){var criteria=criterias[cInd++],crJson={};Blueprint.Validation.constructJson(criteria,parentDiv,crJson),secArr[arrInd++]=crJson}if(subArr=Blueprint.Validation.constructSec(patternText.substr(stInd+subLen,endInd-stInd-subLen),parentDiv),Object.keys(subArr).length>0&&(secArr[arrInd++]={secondaryConditions:subArr}),null!=(halfText=patternText.substr(endInd+subLen+1)).match(/\$\d+\$-/))subArr=Blueprint.Validation.constructSec(halfText,parentDiv),Object.keys(subArr).length>0&&(secArr[arrInd++]={secondaryConditions:subArr});else if(null!=(criterias=halfText.match(/\d+/g)))for(cInd=0,crJson={};cInd<criterias.length;){criteria=criterias[cInd++];Blueprint.Validation.constructJson(criteria,parentDiv,crJson),secArr[arrInd++]=crJson}}else{var criterias;arrInd=0;if(null!=(criterias=patternText.match(/\d+/g)))for(cInd=0;cInd<criterias.length;){criteria=criterias[cInd++],crJson={};Blueprint.Validation.constructJson(criteria,parentDiv,crJson),secArr[arrInd++]=crJson}}return secArr}return secArr},constructJson:function(crInd,parentDiv,json,others){var field={};parentDiv.find("[rulenum="+crInd+"]").each(function(){var keyname=$(this).attr("key"),keyval=$(this).find("[keyname] input,select[keyname]").val();if(json.hasOwnProperty(keyname)||("conjunctiveCondn"==keyname&&$(this).find("em").each(function(){$(this).hasClass("DN")||(keyval=$(this).hasClass("and")?"and":"or")}),json[keyname]=keyval),keyname==ValidationRule.validationKeys.fcid&&(field=ZPForm.Field.getFieldComponent(keyval,ValidationRule.formid)),keyname==ValidationRule.validationKeys.operator&&$.inArray(parseInt(keyval),[ZPNewView.OPERATORS.EQUAL,ZPNewView.OPERATORS.NOT_EQUAL])>-1&&(field.fieldType==ZPForm.Field.PICKLIST||field.fieldType==ZPForm.Field.LOOKUP)){json[keyname]=ValidationRule.selectOperator[keyval],json.dispVal=$(this).next("#fieldValue").find("input#fieldValue").val();var valArr=[];$(this).next("#fieldValue").find("#conditionDropdownSelection #listBody li.sel").each(function(){valArr.push($(this).find("span").attr("id"))}),json[ValidationRule.validationKeys.value]=JSON.stringify(valArr)}field.fieldType==ZPForm.Field.LOOKUP&&(json.lookupFcId=field.referredfcId,json.isBaseForm=!0)})},editValidationPattern:function(){var pageDiv=$("#validationrule");pageDiv.find("#editPatternDiv textarea").first().val(pageDiv.find("#patternText").text()),pageDiv.find("#patternTextDiv").addClass("DNI"),pageDiv.find("#editPatternDiv").removeClass("DNI")},closeValidationPattern:function(){var pageDiv=$("#validationrule");pageDiv.find("#patternTextDiv").removeClass("DNI"),pageDiv.find("#editPatternDiv").addClass("DNI")}},Blueprint.Owners={keyPairIdJson:{sysConfList:{id:"sysConfList",dispVal:ZPI18N.getString("zp.systemopt"),Class:"tab-pane fade active in",parentClass:"active"},system:{id:"system",dispVal:ZPI18N.getString("zp.users")},roles:{id:"roles",dispVal:ZPI18N.getString("zp.roles")},departments:{id:"departments",dispVal:ZPI18N.getString("zp.departments")},group:{id:"group",dispVal:ZPI18N.getString("zp.grouplist")}},saveTransitionOwners:function(){var transitionId=ProcessBuilder.Transition.transitionId;ProcessBuilder.TransitionIdVsDetails[transitionId].OwnersToSave={},ProcessBuilder.TransitionIdVsDetails[transitionId].OwnersToSave.ownerIds="",ProcessBuilder.TransitionIdVsDetails[transitionId].OwnersToSave.ownerTypes="",ProcessBuilder.TransitionIdVsDetails[transitionId].TransitionOwners.system={},ProcessBuilder.TransitionIdVsDetails[transitionId].TransitionOwners.departments={},ProcessBuilder.TransitionIdVsDetails[transitionId].TransitionOwners.roles={},ProcessBuilder.TransitionIdVsDetails[transitionId].TransitionOwners.groups={},ProcessBuilder.TransitionIdVsDetails[transitionId].TransitionOwners.sysConfList={};var ownerIds="",ownerTypes="",ownerDiv=$pageId().find("#ownerList"),empDiv=ownerDiv.find("[ptagid=system] span");$.each(empDiv,function(index,emp){ownerIds+=$(emp).attr("attr")+",",ownerTypes+="1,",ProcessBuilder.TransitionIdVsDetails[transitionId].TransitionOwners.system[$(emp).attr("attr")]=$("#ownerList").find('[ctagid="'+$(emp).attr("attr")+'"]').text()});var roleDiv=ownerDiv.find("[ptagid=roles] span");$.each(roleDiv,function(index,role){ownerIds+=$(role).attr("attr")+",",ownerTypes+="4,",ProcessBuilder.TransitionIdVsDetails[transitionId].TransitionOwners.roles[$(role).attr("attr")]=$("#ownerList").find('[ctagid="'+$(role).attr("attr")+'"]').text()});var deptDiv=ownerDiv.find("[ptagid=departments] span");$.each(deptDiv,function(index,dept){ownerIds+=$(dept).attr("attr")+",",ownerTypes+="2,",ProcessBuilder.TransitionIdVsDetails[transitionId].TransitionOwners.departments[$(dept).attr("attr")]=$("#ownerList").find('[ctagid="'+$(dept).attr("attr")+'"]').text()});var groupDiv=ownerDiv.find("[ptagid=group] span");$.each(groupDiv,function(index,group){ownerIds+=$(group).attr("attr")+",",ownerTypes+="3,",ProcessBuilder.TransitionIdVsDetails[transitionId].TransitionOwners.groups[$(group).attr("attr")]=$("#ownerList").find('[ctagid="'+$(group).attr("attr")+'"]').text()});var sysConfDiv=ownerDiv.find("[ptagid=sysConfList] span");$.each(sysConfDiv,function(index,sysConf){ownerIds+=$(sysConf).attr("attr")+",",ownerTypes+="0,",ProcessBuilder.TransitionIdVsDetails[transitionId].TransitionOwners.sysConfList[$(sysConf).attr("attr")]=$("#ownerList").find('[ctagid="'+$(sysConf).attr("attr")+'"]').text()}),ProcessBuilder.TransitionIdVsDetails[transitionId].OwnersToSave.ownerIds=ownerIds,ProcessBuilder.TransitionIdVsDetails[transitionId].OwnersToSave.ownerTypes=ownerTypes},emptyOwnersCheck:function(){var isEmpty=!1,ownerDiv=$pageId().find("#ownerList"),emplen=ownerDiv.find("[ptagid=system] span").length,rolelen=ownerDiv.find("[ptagid=roles] span").length,deptlen=ownerDiv.find("[ptagid=departments] span").length,grouplen=ownerDiv.find("[ptagid=group] span").length,sysConflen=ownerDiv.find("[ptagid=sysConfList] span").length;ownerDiv.is(":visible")&&0==emplen&&0==rolelen&&0==deptlen&&0==grouplen&&0==sysConflen&&(isEmpty=!0);var insertDiv=ownerDiv.children(":first"),groupTagDiv=insertDiv.find('[id="emptyOwnerMsg"]');return isEmpty?0===groupTagDiv.length&&(groupTagDiv=$('<div id="emptyOwnerMsg" class="taggroup"><p>'+ZPI18N.getString("zp.notransowners")+"</p></div>"),insertDiv.append(groupTagDiv)):insertDiv.find('[id="emptyOwnerMsg"]').remove(),isEmpty},constructOwnerList:function(configJson,tagInputObj){var dispValJson=$.extend({},Blueprint.Owners.keyPairIdJson,{constantVal:{id:"constantVal",dispVal:ZPI18N.getString("zp.contactemail")}}),keyNameList=[dispValJson.sysConfList.id,dispValJson.system.id,dispValJson.roles.id,dispValJson.departments.id,dispValJson.group.id];$.each(keyNameList,function(i,keyVal){configJson.hasOwnProperty(keyVal)&&$.each(configJson[keyVal],function(key,val){var parentJson=dispValJson[keyVal],parentTagJson={id:parentJson.id,value:parentJson.dispVal},childTagJson={id:key,value:val,attr:key};$(tagInputObj).tagInput(parentTagJson,[childTagJson],TemplateCommon.newConstant)}),TemplateCommon.newConstant($(tagInputObj))})},loadOwnerPopUp:function(getThis,tagId){var params={formId:AutomationCommon.getFormId(),mode:ZPACommon.getMode(),method:"getPossibleAddresses"};$(getThis).data("data")||(ZPeople.Request.sendAsyncPost("/getPossibleMailAlertDtls.zp",params,Blueprint.Owners.initiatePopOver),$(getThis).popover("show")),TemplateCommon.selectMalertAddr(tagId,$(getThis))},initiatePopOver:function(data){var pageDiv=$("#"+AutomationCommon.getCurrentPageId()),keyPairIdJson=JSON.parse(JSON.stringify(Blueprint.Owners.keyPairIdJson)),employeeObjs={},userList=ZPeople.getUserListData();$.each(userList,function(cnt,empObj){"false"===empObj.isNonUser&&(employeeObjs[empObj.usererec]=empObj.name+" "+empObj.empid)}),data.system=employeeObjs;var addrPopOverHtml=AutomationCommon.contructMbox(data,keyPairIdJson),popOverObjs=pageDiv.find("[targetid]");$.each(popOverObjs,function(i,obj){$(obj).attr("targetid");var popOverContent=$(addrPopOverHtml).clone();void 0===$(obj).data("bs.popover")?$(obj).setPopOver({callback:TemplateCommon.msgTempAddrFn,html:popOverContent,targetId:$(obj).attr("targetid"),keyname:"name=list-group-item",multi:!0}):$(obj).setContent(popOverContent)}),$(popOverObjs).data("data",!0),ZPeople.ALL_USER_LOADED=!1,ZPeople.ALL_USERLIST=null}},ProcessBuilder={},ProcessBuilder.Process={},ProcessBuilder.Transition={},ProcessBuilder.panXVal=0,ProcessBuilder.panYVal=0,ProcessBuilder.canvasLeft=0,ProcessBuilder.canvasTop=0,ProcessBuilder.ispbPanPositionLeft=!1,ProcessBuilder.ispbPanPositionRight=!1,ProcessBuilder.initialPos=!0,ProcessBuilder.unSavedChanges=!1,ProcessBuilder.dragElement=null,ProcessBuilder.magnetizer=null,ProcessBuilder.TransitionIdVsDetails={},ProcessBuilder.nodeNameConstant="state_",ProcessBuilder.dragAndDropCircle='<div class="pR" id="pb_dragAndDropBox"> <div class="pb_dragAndDropBox pA"> <div class="pb_dragCenter"> <div class="pb_Simply">'+ZPI18N.getString("zp.bpdragdrop")+'</div> <div class="pb_SimplyStart proximal">'+ZPI18N.getString("zp.start")+'</div> </div> </div> <span class="pb_startState">'+ZPI18N.getString("zp.start")+"</span> </div>",ProcessBuilder.globalTransTimeout="",ProcessBuilder.onDragSource="",ProcessBuilder.onDragTarget="",ProcessBuilder.existingConnection="",ProcessBuilder.commonTransState={},ProcessBuilder.loopCommConnector=[],ProcessBuilder.transLimit=20,ProcessBuilder.globalTransTimeout="",ProcessBuilder.transNameVsId={},ProcessBuilder.Process.ConnectionIdVsName={},ProcessBuilder.basicType={connector:"StateMachine",paintStyle:{strokeStyle:"red",lineWidth:2},hoverPaintStyle:{strokeStyle:"blue"},overlays:["Arrow"]},ProcessBuilder.existingConnectorPaintStyle={lineWidth:1.5,strokeStyle:"#000000",joinstyle:"round",outlineColor:"#efc551",outlineWidth:1},ProcessBuilder.loopConnectorPaintStyle={lineWidth:1.5,strokeStyle:"#e26868",joinstyle:"round",outlineColor:"white",outlineWidth:1},ProcessBuilder.newConnectorPaintStyle={lineWidth:1.5,strokeStyle:"#9Bc9ff",joinstyle:"round",outlineColor:"white",outlineWidth:1},ProcessBuilder.connectorPaintStyle={lineWidth:1.5,strokeStyle:"#888888",joinstyle:"round",outlineColor:"white",outlineWidth:1},ProcessBuilder.connectorHoverStyle={lineWidth:2,strokeStyle:"#2196f3",outlineWidth:1,outlineColor:"white"},ProcessBuilder.connectorSelectStyle={lineWidth:2,strokeStyle:"#2196f3",outlineWidth:1,outlineColor:"white"},ProcessBuilder.endpointHoverStyle={fillStyle:"#008aff",strokeStyle:"#9Bc9ff",radius:5.8},ProcessBuilder.globalsourceEndpoint={paintStyle:{strokeStyle:"#04bc11",fillStyle:"#ffffff",radius:3,joinstyle:"round",lineWidth:2,outlineWidth:1,outlineColor:"#ffffff"},endpointStyle:{fillStyle:"transparent",radius:"4",outlineColor:"transparent"},endpoint:["Dot",{cssClass:"globalEndPoint"}],newConnection:!0,deleteEndpointsOnDetach:!1,isSource:!0,isTarget:!0,connector:["Flowchart",{midpoint:.2,stub:[15,15],gap:0,cornerRadius:8,alwaysRespectStubs:!0}],connectorStyle:ProcessBuilder.connectorPaintStyle,overlays:[["Arrow",{location:3,visible:!0,foldback:.09,lineWidth:1,id:"ARROW"}]]},ProcessBuilder.sourceEndpoint={endpoint:"Dot",paintStyle:{strokeStyle:"#599ce0",fillStyle:"#ffffff",radius:4,lineWidth:1},reattach:!0,isSource:!0,isTarget:!0,connector:["Flowchart",{midpoint:.2,stub:[15,15],gap:0,cornerRadius:8,alwaysRespectStubs:!0}],connectorStyle:ProcessBuilder.connectorPaintStyle,hoverPaintStyle:ProcessBuilder.endpointHoverStyle,connectorHoverStyle:ProcessBuilder.connectorHoverStyle,dragOptions:{stop:function(ui){$pageId().find(ui.el).css({visibility:"hidden"})}},overlays:[["Arrow",{location:3,visible:!0,foldback:.09,width:9,length:5,lineWidth:1.5,id:"ARROW"}],["Label",{location:[.5,1.5],cssClass:"endpointSourceLabel",visible:!1}]]},ProcessBuilder.resetProcessCreateRelatedObjects=function(){var pageDiv=$pageId();ProcessBuilder.IsProcessCriteriaUpdated=!1,ProcessBuilder.IsTransitionCriteriaUpdated={},ProcessBuilder.fieldCriteriaContentObject={},ProcessBuilder.criteriaUpdatedFieldValidation={},ProcessBuilder.panXVal=0,ProcessBuilder.panYVal=0,ProcessBuilder.canvasLeft=0,ProcessBuilder.canvasTop=0,ProcessBuilder.ispbPanPositionLeft=!1,ProcessBuilder.ispbPanPositionRight=!1,ProcessBuilder.initialPos=!0,ProcessBuilder.magnetizer=null,ProcessBuilder.TransitionIdVsDetails={},ProcessBuilder.transNameVsId={},ProcessBuilder.criteriaContentObject="",ProcessBuilder.Process={},ProcessBuilder.Transition={},ProcessBuilder.commonTransState={},ProcessBuilder.unSavedChanges=!1;var $jsPlumbParantContainer=pageDiv.find("#createProcessContainer");null!==ProcessBuilder.instance&&"null"!==ProcessBuilder.instance&&($jsPlumbParantContainer.find(".jsplumb-endpoint-anchor").off(),ProcessBuilder.instance.reset()),$jsPlumbParantContainer.empty(),ProcessBuilder.instance=null},ProcessBuilder.getTransitionsToSave=function(){var pageDiv=$pageId(),commonTransTargetId=pageDiv.find(".globalTransition").attr("id"),transitions=[];return $.each(ProcessBuilder.instance.getConnections(),function(idx,connection){if(connection.targetId!=commonTransTargetId){connection.getUuids();var sourceId=pageDiv.find(connection.source).attr("nodeid"),targetId=pageDiv.find(connection.target).attr("nodeid");if(sourceId&&targetId){var $labelElem=pageDiv.find(connection.getOverlay("label").canvas),isGlobal=$labelElem.hasClass("globalTransition"),transRelId=($labelElem.attr("continuous"),$labelElem.attr("relId")),trans={SourceId:sourceId,TargetId:targetId,TransitionId:$labelElem.attr("transId")};trans.Global=isGlobal||!1,transRelId&&""!==transRelId&&"undefined"!==transRelId&&(trans.TransRelId=transRelId),transitions.push(trans)}}}),transitions},ProcessBuilder.saveTransition=function(transitionId){var transition,pageDiv=$pageId(),formId=pageDiv.find("#blueprintDetails").attr("formid");void 0!=ProcessBuilder.TransitionIdVsDetails&&ProcessBuilder.TransitionIdVsDetails!={}&&(transition=ProcessBuilder.TransitionIdVsDetails[transitionId]),pageDiv.find("#transitions").html(ZPeople.LOADING_HTML);var nodeids=JSON.stringify(ProcessBuilder.getAllNodeIds()),params={ProcessId:pageDiv.find("#blueprintDetails").attr("processId"),method:"addOrUpdateTransition",Name:transition.Name,TransitionId:transitionId,SourceId:transition.SourceId,TargetId:transition.TargetId,Description:transition.Description,Global:transition.Global,formId:formId,IsCriteriaUpdated:Blueprint.isTransitionCriUpdated,Criteria:JSON.stringify(transition.Criteria),NodeIds:nodeids,Fields:JSON.stringify(transition.Fields),InfoMessage:ProcessBuilder.TransitionIdVsDetails[transitionId].InfoMessage,Actions:JSON.stringify(transition.ActionsToSave),OwnersToSave:JSON.stringify(transition.OwnersToSave)};ZPeople.Request.send("/transitionAction.zp",params,function(resultData,params){var data=resultData[1];"Success"==data.Status?(ProcessBuilder.TransitionIdVsDetails[transitionId].Criteria=data.ProcessedJson,ProcessBuilder.TransitionIdVsDetails[transitionId].TransitionOwners=data.TransitionOwners,ProcessBuilder.showInfoAndStates()):ZPeople.confirm(null,"",data.ERRORMSG,function(){},!0,!0)},function(resultdata){ProcessBuilder.showTransitionsSbDetails(!1),ProcessBuilder.loadTransitionDetails(ProcessBuilder.TransitionIdVsDetails[transitionId]),ZPeople.confirm(null,"",zp.transsavefailed,function(){},!0,!0)})},ProcessBuilder.executeTransition=function(formId,recordId,transitionrelid,callback,position){if(ZPForm.FORM_DETAILS.hasOwnProperty(ZPForm.CURRFORM_PARAM.formId)&&(isLocationTrackingEnabled=ZPForm.FORM_DETAILS[ZPForm.CURRFORM_PARAM.formId].isLocationTrackingEnabled),isLocationTrackingEnabled&&void 0==position)navigator.geolocation.getCurrentPosition(function(position){var obj={};obj.latitude=position.coords.latitude,obj.longitude=position.coords.longitude,ProcessBuilder.executeTransition(formId,recordId,transitionrelid,callback,obj)},ZPForm.Record.errorForGetLatLang,{maximumAge:12e4});else{var params={zp_formId:formId,zp_recordId:recordId,method:"executeTransition",transitionRelId:transitionrelid,modBpTime:ZPForm.Blueprint.BLUEPRINT_RECORD_DTL[ZPForm.CURRFORM_PARAM.formId+"_"+ZPForm.CURRFORM_PARAM.recordId].TransitionDetails.ClientModifiedTime};void 0!=position&&(params.latitude=position.latitude,params.longitude=position.longitude),ZPeople.Request.send("/processFlowAction.zp",params,function(resultData){if("Success"==resultData[1].Status&&1==resultData[0]){void 0!=callback&&callback();var bpFieldId=resultData[1].Transition.ProcessFieldId,newValue=resultData[1].Transition.newValueforField;if(void 0!=ZPForm.Field.getFieldValueData(bpFieldId,!1))ZPForm.Field.getFieldValueData(bpFieldId,!1).componentValue=newValue;ZPForm.FIELD_LAYOUT.find("#zp_field_outer_"+bpFieldId+" span").html(ZSEC.Encoder.encodeForHTML(newValue)),params.zp_mode="updateRecord",ZPForm.Record.addUpdateRecordResponse(resultData[1].updateData,params),ZPForm.Blueprint.getTransitions(ZPForm.CURRFORM_PARAM.formId,ZPForm.CURRFORM_PARAM.recordId,ZPForm.Permission.getViewPerm())}else void 0!=callback&&callback(),params.zp_mode="updateRecord",ZPForm.Record.addUpdateRecordResponse(resultData[1].updateData,params),ZPeople.confirm(null,"Failure",ZPI18N.getString("zp.transfail"),function(){ZPForm.Blueprint.getTransitions(ZPForm.CURRFORM_PARAM.formId,ZPForm.CURRFORM_PARAM.recordId,ZPForm.Permission.getViewPerm())},!0,!0)},{},function(){ZPeople.confirm(null,"Failure",ZPI18N.getString("zp.transfail"),function(){ZPForm.Blueprint.getTransitions(ZPForm.CURRFORM_PARAM.formId,ZPForm.CURRFORM_PARAM.recordId,ZPForm.Permission.getViewPerm())},!0,!0)})}},ProcessBuilder.getAllNodeIds=function(){var pageDiv=$pageId(),nodeIds=[];return pageDiv.find(".jtk-node").each(function(idx,elem){var nodeId=pageDiv.find(elem).attr("nodeId");nodeIds.push(nodeId)}),nodeIds},ProcessBuilder.applyStyle=function(connObject,style){1==connObject.length&&(connObject[0].setPaintStyle(style),connObject[0].repaint())},ProcessBuilder.getAllFields=function(formId,isPicklistOnly,callback){var params={formId:formId,isPicklistOnly:isPicklistOnly,method:"getAllFields"};ZPeople.Request.sendRequest("/processFlowAction.zp",params,"GET",function(resultData){callback(resultData)})},ProcessBuilder.getAllProcesses=function(callback){var obj=ZPeople.FireScroll.getFireScrollPropertie(),pageDiv=$pageId();if(pageDiv.find("#zp_page_loading").length<1){pageDiv.find("#emptyBlueprint").html(ZPeople.LOADING_HTML),pageDiv.find("#emptyBlueprint").show();var params={method:"getAllProcesses",start:obj.count+1,formId:pageDiv.find("#formsList").val(),status:pageDiv.find("#BpStatusHeader").attr("status")};ZPeople.Request.sendRequest("/processFlowAction.zp",params,"GET",function(resultData){void 0!=resultData[1].Status&&(pageDiv.find("#emptyBlueprint").html(""),callback(resultData))})}},ProcessBuilder.deleteProcess=function(processid){var formId=$pageId().find("#bpTableBody .ZPLRow#"+processid).attr("formid"),params={method:"deleteProcess",processId:processid,formId:formId};ZPeople.Request.send("/processFlowAction.zp",params,function(resultData){void 0!=resultData[1]&&void 0!=resultData[1].Status&&"Success"==resultData[1].Status?($("#"+processid).remove(),$.each(Blueprint.processList,function(index,process){if(process.Id==processid)return Blueprint.processList.splice(index,1),!1}),Blueprint.showEmptylistPage()):ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.bpdeleteFailed"))})},ProcessBuilder.updateProcessStatus=function(status,processId,getThis,formId){var params={method:"updateProcessStatus",status:status,processId:processId,formId:formId};ZPeople.Request.send("/processFlowAction.zp",params,function(resultData){1==resultData[0]&&"Success"==resultData[1].Status||(ZPeople.Message.showFailureMsg(ZPI18N.getString("bpupdateFailed")),getThis.checked=!getThis.checked)},{},function(){ZPeople.Message.showFailureMsg(ZPI18N.getString("bpupdateFailed")),getThis.checked=!getThis.checked})},ProcessBuilder.getProcessDetails=function(callback,processId){var params={method:"getProcessDetails",processId:processId};ZPeople.Request.sendRequest("/processFlowAction.zp",params,"GET",function(resultData){void 0!=resultData[1].Status&&(callback(processId,resultData),ZPFRules.getFormComponents({},{},{forPost:!0,formId:Layout.Page.urlparam.formid,isBlueprint:!0}))})},ProcessBuilder.createProcess=function(bpConfObj){var pageDiv=$pageId(),params={method:"createProcess",Name:bpConfObj.bpName,FormId:bpConfObj.bpModule,FieldId:bpConfObj.bpField,Description:bpConfObj.bpDescription,Criteria:JSON.stringify(bpConfObj.rule),RuleFormat:bpConfObj.ruleFormat};ZPeople.Request.send("/processFlowAction.zp",params,function(resultData){if(1==resultData[0]){var data=resultData[1];"Success"==data.Status?(pageDiv.find("#createBpSubmitBtn").removeAttr("disabled"),window.location.href="#admin/automation/blueprint/edit-formid:"+bpConfObj.bpModule+"/blueprintId:"+resultData[1].ProcessId):(pageDiv.find("#createBpSubmitBtn").removeAttr("disabled"),ZPeople.confirm(null,"",data.ERRORMSG,"",!0,!0))}},null,function(resultData){var errMsg=ZPI18N.getString("zp.createfailed");void 0!=resultData&&resultData.hasOwnProperty("responseJSON")&&resultData.responseJSON.hasOwnProperty("error")&&resultData.responseJSON.error.trim().length>0&&(errMsg=resultData.responseJSON.error),pageDiv.find("#createBpSubmitBtn").removeAttr("disabled"),ZPeople.confirm(null,"",errMsg,"",!0,!0)})},ProcessBuilder.saveProcessDetails=function(processId,blueprintDetails){var pageDiv=$pageId(),name=blueprintDetails.Name,description=blueprintDetails.description,formId=(pageDiv.find("#pb_processInfoContainer"),pageDiv.find("#blueprintDetails").attr("formid")),FieldId=pageDiv.find("#blueprintDetails").attr("fieldId"),transObj=JSON.stringify(ProcessBuilder.TransitionIdVsDetails);transObj=JSON.parse(transObj),$.each(transObj,function(transid,transition){delete transObj[transid].Actions,delete transObj[transid].TransitionOwners,transObj[transid].sourceIds&&transObj[transid].sourceIds.length>0&&(transObj[transid].sourceIds=transObj[transid].sourceIds.filter(function(el){return ProcessBuilder.getAllNodeIds().includes(el)}))});var params={ProcessId:processId,method:"updateProcess",Description:description,FormId:formId,FieldId:FieldId,Name:name,FlowTransitions:JSON.stringify(ProcessBuilder.getTransitionsToSave()),Transitions:JSON.stringify(transObj),ChartData:JSON.stringify(ProcessBuilder.getFlowCharMeta()),chartNodeList:JSON.stringify(ProcessBuilder.getAllNodeIds()),Criteria:JSON.stringify(Blueprint.currentBpData.ProcessedJson),RuleFormat:Blueprint.currentBpData.RuleFormat,PicklistValues:JSON.stringify(ProcessBuilder.Process.PickListValueDetails)};Blueprint.showBlueprintloading(),ZPeople.Request.send("/processFlowAction.zp",params,function(resultData){Blueprint.hideBlueprintloading();var data=resultData[1];"Success"==data.Status?(Blueprint.refreshForms(),Blueprint.cancel()):(ZPeople.confirm(null,"",data.ERRORMSG,"",!0,!0),Blueprint.hideBlueprintloading())},null,function(resultData){var errMsg=ZPI18N.getString("zp.bpsavefailed");void 0!=resultData&&resultData.hasOwnProperty("responseJSON")&&resultData.responseJSON.hasOwnProperty("error")&&resultData.responseJSON.error.trim().length>0?errMsg=resultData.responseJSON.error:resultData.hasOwnProperty("responseJSON")&&$.isArray(resultData.responseJSON)&&(errMsg=resultData.responseJSON[1].msg),pageDiv.find("#createBpSubmitBtn").removeAttr("disabled"),ZPeople.Message.showFailureMsg(errMsg),Blueprint.hideBlueprintloading()})},ProcessBuilder.instance=null,ProcessBuilder.init=function(){var pageDiv=$pageId();ProcessBuilder.instance=jsPlumb.getInstance({DragOptions:{cursor:"pointer",zIndex:2e3},ConnectionOverlays:[["Arrow",{location:1,visible:!0,foldback:.09,width:8,length:6,id:"ARROW",lineWidth:1}],["Custom",{create:function(component){return $("<div id='customDot' style='background-color:#000;width:7px;height:7px;z-index:10;border-radius:3.5px;'></div>")},location:0,visible:!0,foldback:.09,id:"customOverlay"}],["Label",{location:.45,id:"label",cssClass:"aLabel hide",events:{tap:function(){}}}]],Container:pageDiv.find("#canvas")}),ProcessBuilder.instance.registerConnectionType("basic",ProcessBuilder.basicType),ProcessBuilder.applyDragg(),Blueprint.hideBlueprintloading(),ProcessBuilder.loadFlowChart(ProcessBuilder.Process.ChartData),$.each(Blueprint.currentBpData.TransitionsMeta,function(index,transition){transition.Global&&ProcessBuilder.makeGlobalTransition(transition.TransitionId,!0,transition.Name)}),$pageId().find("#canvas").find(".window.jtk-node").length<1&&$pageId().find("#canvasContainer").append(ProcessBuilder.dragAndDropCircle),jsPlumb.fire("jsPlumbDemoLoaded",ProcessBuilder.instance),pageDiv.find("#canvasContainer").on("contextmenu.namespace",function(e){return!1})},ProcessBuilder.applyDragg=function(){var pageDiv=$pageId(),$endPoint=pageDiv.find(".flowchart-demo .jsplumb-endpoint");pageDiv.find(".ProcessState").draggable({revert:"invalid",helper:"clone",appendTo:"#bluePrintInfo",start:function(event,ui){var $stateDiv=$(this);$stateDiv.addClass("hide"),$stateDiv.parent().removeClass("oA"),pageDiv.find("#canvas").find(".window.jtk-node").length>0&&pageDiv.find("#pb_dragAndDropBox").remove(),$('<div class="tempDrag" style="clear: both;"></div>').insertAfter($stateDiv),$endPoint.css("opacity","0")},stop:function(event,ui){var $stateDiv=$(this);$stateDiv.removeClass("hiAdd"),$stateDiv.addClass("draggableClass"),$stateDiv.parent().addClass("oA"),pageDiv.find(".tempDrag").remove(),$stateDiv.removeClass("hide"),$endPoint.css("opacity","1")}}),pageDiv.find("#processDropCanvas, #pb_dragAndDropBox").droppable({hoverClass:"hoverpbContain",accept:"#dragableDiv div, #processDropCanvas div",drop:function(event,ui){ProcessBuilder.unSavedChanges=!0;var dropZone=$(this);dropZone.addClass("pb-canvas-state-highlight"),pageDiv.find("#dragableDiv").addClass("oA");var draggedElement=pageDiv.find(ui.draggable),diff=draggedElement.parent().attr("id"),pos=ui.draggable.position(),offSetPos=ui.helper.offset();if("dragableDiv"===diff){var lefpos=offSetPos.left,toppos=offSetPos.top;draggedElement.css({position:"relative",left:lefpos,top:toppos}),pageDiv.find(".tempDrag").remove();var $NodeNone=pageDiv.find("#dragableDiv .ProcessState.startState");0==pageDiv.find("#canvas").find(".window.jtk-node").length?(ProcessBuilder.enablePanning(),$NodeNone.length>0&&ProcessBuilder.addNode($NodeNone.data("nodeid"),ZPI18N.getString("zp.start"),30,100,!1,!0),ProcessBuilder.addNode(draggedElement.attr("data-nodeid"),draggedElement.text(),lefpos,toppos,!1,!1),$NodeNone.length>0&&(ProcessBuilder.connectNodes($NodeNone.data("nodeid"),draggedElement.attr("data-nodeid")),$NodeNone.remove())):ProcessBuilder.addNode(draggedElement.attr("data-nodeid"),draggedElement.text(),lefpos,toppos)}else draggedElement.appendTo(dropZone),draggedElement.css({position:"absolute",left:pos.left,top:pos.top});pageDiv.find("#dragableDiv .ProcessState[data-nodeid='"+draggedElement.attr("data-nodeid")+"']").remove(),pageDiv.find("#pbactionSearchBox").val(""),ProcessBuilder.searchStateAction(pageDiv.find("#pbactionSearchBox")),Blueprint.showSearchBar()}}),pageDiv.find("#processDropCanvas").show()},ProcessBuilder.constructNode=function(nodeId){$pageId();var $newNode=$(document.createElement("div")),attrList={nodeId:nodeId,class:"window jtk-node",id:ProcessBuilder.nodeNameConstant+nodeId};return 0==nodeId.indexOf("newState")&&(attrList.newState="true"),$newNode.attr(attrList),$newNode},ProcessBuilder.applyMagnetiser=function(){var pageDiv=$pageId();ProcessBuilder.magnetizer=null;var nodeElemIds=ProcessBuilder.getNodeIds();ProcessBuilder.magnetizer=new Magnetizer({container:pageDiv.find("#canvas"),getContainerPosition:function(c){return c.position()},getPosition:ProcessBuilder.offset,getSize:function(id){return[pageDiv.find("#"+id).outerWidth(),pageDiv.find("#"+id).outerHeight()]},getId:function(id){return id},setPosition:ProcessBuilder.setOffset,elements:nodeElemIds,filter:ProcessBuilder.dragFilter,padding:[5,5]}),ProcessBuilder.instance.draggable(nodeElemIds,{containment:!1,grid:[10,10],start:function(option){ProcessBuilder.dragElement=option.el.getAttribute("id"),pageDiv.find("#canvas").removeClass("surfaceCls"),pageDiv.find("#canvasContainer").removeAttr("onmousedown onmouseup")},drag:function(option){var cCWid,cCHei,dragEle=pageDiv.find("#"+ProcessBuilder.dragElement),dEleTop=dragEle.offset().top,canvasContain=pageDiv.find("#canvasContainer"),canvasDiv=pageDiv.find("#canvas");cCWid=canvasContain.outerWidth(),cCHei=canvasContain.outerHeight();var leftBefore=ProcessBuilder.canvasLeft,topBefore=ProcessBuilder.canvasTop,dEleLeft=Math.round(dragEle.offset().left+dragEle.outerWidth());dEleTop=Math.round(dragEle.offset().top+dragEle.outerHeight());dEleLeft>cCWid&&(leftBefore-=dEleLeft-cCWid,canvasDiv.css("left",leftBefore),ProcessBuilder.canvasLeft=leftBefore);dEleLeft<dragEle.outerWidth()&&(leftBefore+=10,canvasDiv.css("left",leftBefore),ProcessBuilder.canvasLeft=leftBefore);dEleTop>cCHei&&(topBefore-=dEleTop-cCHei,canvasDiv.css("top",topBefore),ProcessBuilder.canvasTop=topBefore);dEleTop<Math.round(dragEle.outerHeight()+40)&&(topBefore+=10,canvasDiv.css("top",topBefore),ProcessBuilder.canvasTop=topBefore);ProcessBuilder.unSavedChanges=!0;ProcessBuilder.instance.getConnections({source:ProcessBuilder.dragElement}),ProcessBuilder.instance.getConnections({target:ProcessBuilder.dragElement});ProcessBuilder.magnetizer.executeAtEvent(option.e),ProcessBuilder.instance.repaintEverything(),pageDiv.find("#canvasContainer").removeAttr("onmousedown onmouseup")},stop:function(options){ProcessBuilder.dragElement=null,pageDiv.find("#canvas").addClass("surfaceCls"),ProcessBuilder.enablePanning()}})},ProcessBuilder.addNode=function(nodeId,txt,left,top,isFromInitialLoad,isStartNode){var pageDiv=$pageId(),startBox=pageDiv.find("#pb_dragAndDropBox"),$newNode=ProcessBuilder.constructNode(nodeId);(isStartNode||"START"==nodeId)&&$newNode.addClass("startNode"),$newNode.attr({title:txt,"data-zcqa":"node_pa_"+txt}).text(txt);var $canvasDiv=pageDiv.find("#canvas");$canvasDiv.prepend($newNode);var stateCount=$canvasDiv.find(".window.jtk-node").length;if(isFromInitialLoad)$newNode.css({left:left,top:top}),startBox.remove();else{pageDiv.find("#dragableDiv .ProcessState.startState");if(1==stateCount){startBox.fadeOut(500),$newNode.hide();var firstNodeLeft=pageDiv.find("#processDropCanvas").outerWidth()/2-$newNode.outerWidth()/2;pageDiv.find(".startNode").length>0?(pageDiv.find(".pb_startState").css("left","155px").animate({top:"-110px",opacity:"1"},600).fadeOut(100,function(){startBox.remove()}),$newNode.css({left:10*Math.floor((firstNodeLeft+1)/10),top:10*Math.floor(3.1)}).fadeIn(1500)):(startBox.remove(),$newNode.css({left:10*Math.floor((firstNodeLeft+1)/10),top:10*Math.floor(3.1)}).show())}else if(!1===isStartNode&&1==ProcessBuilder.initialPos){$newNode.hide();var secondNodeLeft=pageDiv.find("#processDropCanvas").outerWidth()/2-$newNode.outerWidth()/2;$newNode.css({left:10*Math.floor((secondNodeLeft+1)/10),top:10*Math.floor(15.1)}).fadeIn(1e3),pageDiv.find(".ProcessState.ui-draggable-dragging").remove()}else{var canvasPosition=$canvasDiv.position();canvasPosition.left,canvasPosition.top;startBox.remove();document.getElementById("tabLayer"),document.getElementById("annoncement");$newNode.offset({top:10*Math.round((top+1)/10),left:10*Math.floor((left+1)/10)})}}$canvasDiv.addClass("surfaceCls"),ProcessBuilder.instance.repaint($newNode.attr("id")),ProcessBuilder.addEndpoints(ProcessBuilder.nodeNameConstant+nodeId,["TopCenter","BottomCenter","LeftMiddle","RightMiddle"],[[.12,0,0,-1],[.88,0,0,-1],[.12,1,0,1],[.88,1,0,1]],[[.3,0,0,-1],[.7,0,0,-1],[.3,1,0,1],[.7,1,0,1]]);var node=pageDiv.find("#"+ProcessBuilder.nodeNameConstant+nodeId),anchor=pageDiv.find("."+ProcessBuilder.nodeNameConstant+nodeId);ProcessBuilder.bindEventHandlersForNodes(node,anchor),anchor.each(function(idx,elem){pageDiv.find(elem).attr("data-zcqa","pa_connect_"+txt+"_"+(idx+1))}),ProcessBuilder.nodeContextMenu($newNode,ProcessBuilder.nodeNameConstant+nodeId),ProcessBuilder.applyMagnetiser(),pageDiv.find("#pBformcomponentcontainerdiv").find(".ProcessState[data-nodeid='"+nodeId+"']").remove(),isFromInitialLoad||ProcessBuilder.editNodesinGlobal(nodeId);var globTransId=pageDiv.find(".globalTransition").attr("transId");globTransId&&(ProcessBuilder.commonTransState[globTransId]&&(nodeId in ProcessBuilder.commonTransState[globTransId]||(ProcessBuilder.commonTransState[globTransId][nodeId]=!0)))},ProcessBuilder.connectNodes=function(sourceId,targetId){var sourceUId=ProcessBuilder.nodeNameConstant+sourceId+"_BottomCenter",targetUId=ProcessBuilder.nodeNameConstant+targetId+"_TopCenter",newConn=ProcessBuilder.instance.connect({uuids:[sourceUId,targetUId],editable:!0});ProcessBuilder.setOverlayLabel(newConn)},ProcessBuilder.connectNodesforGlobal=function(sourceId,targetId){ProcessBuilder.instance.connect({source:sourceId,target:targetId,anchor:"Continuous",detachable:!1},ProcessBuilder.globalsourceEndpoint)},ProcessBuilder.addEndpoints=function(toId,sourceAnchors,targetAnchors,extraAnchors){for(var i=0;i<sourceAnchors.length;i++){var sourceUUID=toId+"_"+sourceAnchors[i];ProcessBuilder.instance.addEndpoint(toId,ProcessBuilder.sourceEndpoint,{cssClass:toId,anchor:sourceAnchors[i],uuid:sourceUUID})}for(i=0;i<targetAnchors.length;i++){sourceUUID=toId+"_"+targetAnchors[i];ProcessBuilder.instance.addEndpoint(toId,ProcessBuilder.sourceEndpoint,{cssClass:toId,anchor:targetAnchors[i],uuid:sourceUUID})}for(i=0;i<extraAnchors.length;i++){sourceUUID=toId+"_"+extraAnchors[i];ProcessBuilder.instance.addEndpoint(toId,ProcessBuilder.sourceEndpoint,{cssClass:toId,anchor:extraAnchors[i],uuid:sourceUUID})}},ProcessBuilder.getTransWithoutLabel=function(){for(var pageDiv=$pageId(),TransWithoutLabel=[],allCon=ProcessBuilder.instance.getAllConnections(),t=0;t<allCon.length;t++){var labelOverlay=allCon[t].getOverlay("label"),$labelElem=pageDiv.find(labelOverlay.canvas);""==$labelElem.attr("transid")&&TransWithoutLabel.push($labelElem)}return TransWithoutLabel},ProcessBuilder.getFlowCharMeta=function(){var pageDiv=$pageId(),flowChartData={},nodes=[];orphanStateNodeIds=[],pageDiv.find(".jtk-node").each(function(idx,elem){var $elem=pageDiv.find(elem),nodeId=$elem.attr("nodeId"),nodeElemId=$elem.attr("id"),elemPosition=(ProcessBuilder.instance.getConnections({source:nodeElemId}),ProcessBuilder.instance.getConnections({target:nodeElemId}),ProcessBuilder.instance.getEndpoints($elem),$elem.position());nodes.push({nodeId:nodeId,nodetype:$elem.attr("data-nodetype"),posX:parseInt(elemPosition.left+ProcessBuilder.canvasLeft,10),posY:parseInt(elemPosition.top+ProcessBuilder.canvasTop,10)})});var connections=[],globalIds=[];$.each(pageDiv.find(".globalTransition"),function(){globalIds.push($(this).attr("id"))}),$.each(ProcessBuilder.instance.getConnections(),function(idx,connection){if(-1===$.inArray(connection.targetId,globalIds)){var uuIds=connection.getUuids();connections.push({fromUUId:uuIds[0],toUUId:uuIds[1]})}}),flowChartData.nodes=nodes,flowChartData.connections=connections;var canvasDiv=pageDiv.find("#processDropCanvas");return flowChartData.canvasWidth=canvasDiv[0].offsetWidth,flowChartData.canvasHeight=canvasDiv[0].offsetHeight,flowChartData},ProcessBuilder.getNodeIds=function(id){var elemIds=[];return $pageId().find(".jtk-node").each(function(idx,elem){elemIds.push($(elem).attr("id"))}),elemIds},ProcessBuilder.offset=function(id){var el=$pageId().find("#"+id)[0],_=function(p){var v=el.style[p];return parseInt(v.substring(0,v.length-2))};return{left:_("left"),top:_("top")}},ProcessBuilder.setOffset=function(id,o){var el=$pageId().find("#"+id)[0];el.style.left=o.left+"px",el.style.top=o.top+"px"},ProcessBuilder.dragFilter=function(id){return id!=ProcessBuilder.dragElement},ProcessBuilder.bindEventHandlersForNodes=function(node,anchor){node.on("mouseenter",function(){anchor.css("visibility","visible")}),node.on("mouseleave",function(){anchor.css("visibility","hidden")}),anchor.on("mouseenter",function(){anchor.css("visibility","visible")}),anchor.on("mouseleave",function(){anchor.css("visibility","hidden")})},ProcessBuilder.removeNode=function(nodeElemId,skipConfirm){var pageDiv=$pageId(),nodeName=pageDiv.find("#"+nodeElemId).text(),nodeId=nodeElemId.split("_")[1],dragElem='<div class="ProcessState" title="'+ZSEC.Encoder.encodeForHTML(nodeName)+'" data-nodeid="'+nodeId+'"><i class="IC-drag"></i><span class="dIB mw250">'+ZSEC.Encoder.encodeForHTML(nodeName)+"</span></div>";if(ProcessBuilder.instance.remove(nodeElemId),ProcessBuilder.unSavedChanges=!0,pageDiv.find("#dragableDiv").append(dragElem),pageDiv.find(".NodeContextMenu").hide(),this.applyDragg(),this.applyMagnetiser(),ProcessBuilder.initialPos=!1,ProcessBuilder.editNodesinGlobal(nodeId,!0),ProcessBuilder.Process.ConnectionIdVsName){var transitionid,conIds=Blueprint.getKeys(ProcessBuilder.Process.ConnectionIdVsName);$.each(conIds,function(key,value){var ids=value.split("_");nodeId!==ids[0]&&nodeId!==ids[1]||void 0!=(transitionid=void 0!=ProcessBuilder.Process.ConnectionIdVsName[value]?ProcessBuilder.Process.ConnectionIdVsName[value].TransitionId:"")&&""!=transitionid&&ProcessBuilder.deleteLocalTransition(transitionid,value)})}Blueprint.showSearchBar()},ProcessBuilder.deleteLocalTransition=function(transitionid,value){var isNew=!1,formId=Layout.Page.urlparam.formid;void 0!=ProcessBuilder.TransitionIdVsDetails[transitionid]&&(isNew=ProcessBuilder.TransitionIdVsDetails[transitionid].isNewTransition),void 0==ProcessBuilder.TransitionIdVsDetails[transitionid]&&(ProcessBuilder.TransitionIdVsDetails[transitionid]={},ProcessBuilder.TransitionIdVsDetails[transitionid].transitionId=transitionid),ProcessBuilder.TransitionIdVsDetails[transitionid].toBeDeleted=!0;for(var metaLength=Blueprint.currentBpData.TransitionsMeta.length,i=0;i<metaLength;i++)Blueprint.currentBpData.TransitionsMeta[i].TransitionId==transitionid&&(Blueprint.currentBpData.TransitionsMeta.splice(i,1),metaLength=Blueprint.currentBpData.TransitionsMeta.length,i--);isNew&&delete ProcessBuilder.TransitionIdVsDetails[transitionid],void 0!=value&&""!=value&&delete ProcessBuilder.Process.ConnectionIdVsName[value],ProcessBuilder.transNameVsId[formId]&&$.each(ProcessBuilder.transNameVsId[formId],function(ind,trans){if(trans.transitionId==transitionid)return ProcessBuilder.transNameVsId[formId].splice(ind,1),!1}),void 0!=ProcessBuilder.Transition.transitionId&&ProcessBuilder.Transition.transitionId==transitionid&&ProcessBuilder.showInfoAndStates()},ProcessBuilder.removeConnection=function(fromStateId,toStateId,skipConfirm){var pageDiv=$pageId(),conn=(pageDiv.find("#"+fromStateId).text(),pageDiv.find("#"+toStateId).text(),ProcessBuilder.instance.getConnections({source:fromStateId,target:toStateId}));if(conn[0]){fromStateId=fromStateId.split("_")[1],toStateId=toStateId.split("_")[1],ProcessBuilder.unSavedChanges=!0;var transitionid=void 0!=ProcessBuilder.Process.ConnectionIdVsName[fromStateId+"_"+toStateId]?ProcessBuilder.Process.ConnectionIdVsName[fromStateId+"_"+toStateId].TransitionId:"";delete ProcessBuilder.Process.ConnectionIdVsName[fromStateId+"_"+toStateId],ProcessBuilder.instance.detach(conn[0]),ProcessBuilder.instance.repaintEverything(),pageDiv.find(".jsplumb-endpoint").css("visibility","hidden"),void 0!=transitionid&&""!=transitionid&&ProcessBuilder.deleteLocalTransition(transitionid)}},ProcessBuilder.bindEventHandlersForConnections=function(event){var pageDiv=$pageId();pageDiv.on("click",function(){$(".linkContextMenu").hide(),$(".NodeContextMenu").hide()}),ProcessBuilder.instance.unbind("click").bind("contextmenu",function(conn,originalEvent){if(originalEvent.preventDefault(),conn.getClass().includes("jsplumb-connector")){var bindHtml="<ul><li class='proxima' onclick=\"ProcessBuilder.removeConnection('"+conn.sourceId+"', '"+conn.targetId+'\');"><i class="IC-delete MR5"></i>'+ZPI18N.getString("zp.transdelete")+"</li></ul>";pageDiv.find(".NodeContextMenu").hide(),pageDiv.find(".linkContextMenu").html(bindHtml).show().css({top:originalEvent.pageY-pageDiv.find("#canvas").offset().top,left:originalEvent.pageX-pageDiv.find("#canvas").offset().left})}}),ProcessBuilder.instance.unbind("connectionDrag").bind("connectionDrag",function(connection,event){var pageDiv=$pageId();ProcessBuilder.disablePanning(),connection.setPaintStyle(ProcessBuilder.newConnectorPaintStyle),connection.repaint(),pageDiv.find(".window.jtk-node, .jsplumb-endpoint").off("mouseenter mouseleave"),pageDiv.find("#canvas .window.jtk-node").removeAttr("onmouseover onmouseout"),pageDiv.find(".jsplumb-endpoint").css("visibility","visible"),pageDiv.find(connection.target).hasClass("jtk-node")?(ProcessBuilder.onDragSource=$(connection.source).attr("id"),ProcessBuilder.onDragTarget=$(connection.target).attr("id"),ProcessBuilder.existingConnection=!0):(ProcessBuilder.onDragSource="",ProcessBuilder.onDragTarget="",ProcessBuilder.existingConnection=!1)}),ProcessBuilder.instance.unbind("beforeDrop").bind("beforeDrop",function(info){if(1==ProcessBuilder.existingConnection){if(ProcessBuilder.instance.getConnections({source:info.sourceId,target:info.targetId}).length>1)return!1;if(ProcessBuilder.onDragSource!=info.sourceId||ProcessBuilder.onDragTarget!=info.targetId){ProcessBuilder.existingConnection=!1,ProcessBuilder.onDragSource=ProcessBuilder.onDragSource.replace("state_",""),ProcessBuilder.onDragTarget=ProcessBuilder.onDragTarget.replace("state_",""),info.sourceId=info.sourceId.replace("state_",""),info.targetId=info.targetId.replace("state_","");var oldConn=ProcessBuilder.Process.ConnectionIdVsName[ProcessBuilder.onDragSource+"_"+ProcessBuilder.onDragTarget];ProcessBuilder.Process.ConnectionIdVsName[info.sourceId+"_"+info.targetId]={};var newConn=ProcessBuilder.Process.ConnectionIdVsName[info.sourceId+"_"+info.targetId];newConn.Continuous=oldConn.Continuous,newConn.Global=oldConn.Global,newConn.Id=oldConn.Id,newConn.Name=oldConn.Name,newConn.SourceId=info.sourceId,newConn.TargetId=info.targetId,newConn.TransitionId=oldConn.TransitionId,ProcessBuilder.globalActionListeners(newConn.Global,newConn.SourceId,newConn.TargetId),delete ProcessBuilder.Process.ConnectionIdVsName[ProcessBuilder.onDragSource+"_"+ProcessBuilder.onDragTarget]}}return!0}),ProcessBuilder.instance.unbind("connectionDragStop").bind("connectionDragStop",function(connection,event){var pageDiv=$pageId();pageDiv.find(".jsplumb-endpoint").css("visibility","hidden");var transId=$(connection.getOverlay("label").canvas).attr("transid");pageDiv.find(".window.jtk-node").each(function(idx,elem){var nodeElemId=(elem=pageDiv.find(elem)).attr("id");ProcessBuilder.bindEventHandlersForNodes(pageDiv.find("#"+nodeElemId),pageDiv.find("."+nodeElemId))});var startNodeId=pageDiv.find(".startNode").attr("id");if(connection.targetId==startNodeId&&(ProcessBuilder.instance.detach(connection),ProcessBuilder.instance.repaintEverything(),ZPeople.confirm(null,"","zp.startconnectionrestriction","",!0,!1),void 0!=transId&&ProcessBuilder.deleteLocalTransition(transId)),connection.sourceId==connection.targetId)ProcessBuilder.instance.detach(connection),ProcessBuilder.instance.repaintEverything(),void 0!=transId&&ProcessBuilder.deleteLocalTransition(transId);else{var conn=ProcessBuilder.instance.getConnections({source:connection.sourceId,target:connection.targetId});0==conn.length&&pageDiv.find(".endpointDrag").removeClass("endpointDrag"),1==conn.length?(conn[0].setPaintStyle(ProcessBuilder.connectorPaintStyle),conn[0].repaint(),ProcessBuilder.setOverlayLabel(connection),ProcessBuilder.unSavedChanges=!0):conn.length>1&&(ProcessBuilder.instance.detach(connection),conn[0].setPaintStyle(ProcessBuilder.existingConnectorPaintStyle),conn[0].repaint(),setTimeout(function(){conn[0].setPaintStyle(ProcessBuilder.connectorPaintStyle),conn[0].repaint()},1300))}var sourcePoint=connection.sourceId.substr(connection.sourceId.length-1),targetPoint=connection.targetId.substr(connection.targetId.length-1);"undefined"!=typeof orphanStateNodeIds&&(-1==$.inArray(sourcePoint,orphanStateNodeIds)&&-1==$.inArray(targetPoint,orphanStateNodeIds)||(pageDiv.find("#"+ProcessBuilder.nodeNameConstant+sourcePoint).removeClass("orphanState"),pageDiv.find("#"+ProcessBuilder.nodeNameConstant+targetPoint).removeClass("orphanState"))),ProcessBuilder.enablePanning()})},ProcessBuilder.addConnectionName=function(obj){var pageDiv=$pageId(),transition=ProcessBuilder.Transition,conn=ProcessBuilder.instance.getConnections({source:ProcessBuilder.nodeNameConstant+transition.SourceId,target:ProcessBuilder.nodeNameConstant+transition.TargetId}),pb_transitionName=pageDiv.find("#pb_transitionName"),transName=(pageDiv.find("#globalCheck").is(":checked"),pb_transitionName.text().trim()),desc=pageDiv.find("#pb_transitionDescription").val()||"",cloneObj=pageDiv.find("#cloneWarning"),formId=pageDiv.find("#blueprintDetails").attr("formid"),isNameExists=!1;for(var currTransid in ProcessBuilder.TransitionIdVsDetails){if(!ProcessBuilder.TransitionIdVsDetails[currTransid].toBeDeleted)ProcessBuilder.TransitionIdVsDetails[currTransid].Name.toUpperCase()==transName.toUpperCase()&&(isNameExists=!0)}if($.each(Blueprint.currentBpData.TransitionsMeta,function(index,transmeta){transmeta.Name.toUpperCase()==transName.toUpperCase()&&(isNameExists=!0)}),transName.length>=50){if(0==pageDiv.find("#error_messageName").length){var args=["Transition Name",50];errhtml='<div id="error_messageName" class="dverrormsg">'+ZPI18N.getString("zp.fieldlength",args)+"</div>",pb_transitionName.parent().append(errhtml)}}else if(desc.length>=100){if(0==pageDiv.find("#error_messagedesc").length){args=["description",100];errhtml='<div id="error_messagedesc" class="dverrormsg">'+ZPI18N.getString("zp.fieldlength",args)+"</div>",pageDiv.find("#pb_transitionDescription").parent().append(errhtml)}}else if(void 0!=transName&&""!=transName.trim())if(isNameExists)Blueprint.showError(pageDiv.find("#transitionNameDiv"),ZPI18N.getString("zp.uniquetransition"));else{var transitionId=transition.SourceId+"-"+transition.TargetId;if(ProcessBuilder.Transition.Description=desc,ProcessBuilder.Transition.Name=transName,ProcessBuilder.Transition.transitionId=transitionId,ProcessBuilder.TransitionIdVsDetails[transitionId]=ProcessBuilder.Transition,cloneObj.length>0){var params={method:"getTransitionDetails"};params.TransitionId=cloneObj.attr("transid"),pageDiv.find("#transitions").append('<div id="cloneLoading">'+ZPeople.LOADING_HTML+"</div>"),pageDiv.find("#cloneLoading").siblings().addClass("DN"),pageDiv.find("#cloneLoading").addClass("ht100");var isTransCacheAvailable=!1;if(ProcessBuilder.TransitionIdVsDetails[params.TransitionId]&&(ProcessBuilder.TransitionIdVsDetails[params.TransitionId].toBeDeleted&&1==ProcessBuilder.TransitionIdVsDetails[params.TransitionId].toBeDeleted||(isTransCacheAvailable=!0)),isTransCacheAvailable){var parentTrans=JSON.parse(JSON.stringify(ProcessBuilder.TransitionIdVsDetails[params.TransitionId]));pageDiv.find("#cloneLoading").siblings().removeClass("DN"),pageDiv.find("#cloneLoading").remove(),pageDiv.find("#transListDiv").remove(),cloneObj.remove(),ProcessBuilder.populateTransClone(transitionId,parentTrans,transName,desc,transition),pageDiv.find("#transitions").html(ZPeople.LOADING_HTML).removeClass("ht100"),ProcessBuilder.setOverlayLabel(conn[0],{Name:transName,TransitionId:transitionId,Global:parentTrans.Global}),ProcessBuilder.makeGlobalTransition(transitionId,parentTrans.Global,transName),ProcessBuilder.addTransition(transition.SourceId,transition.TargetId,transitionId,transName,"",""),Blueprint.currentBpData.transitionsCount++}else ZPeople.Request.send("/transitionAction.zp",params,function(resultData){pageDiv.find("#cloneLoading").siblings().removeClass("DN"),pageDiv.find("#cloneLoading").remove(),pageDiv.find("#transListDiv").remove(),cloneObj.remove(),void 0!=resultData[1].Error?(delete ProcessBuilder.TransitionIdVsDetails[transitionId],ProcessBuilder.Transition.transitionId="",$.each(ProcessBuilder.transNameVsId[formId],function(ind,trans){if(trans.transitionId==params.TransitionId)return ProcessBuilder.transNameVsId[formId].splice(ind,1),!1})):(ProcessBuilder.populateTransClone(transitionId,resultData[1],transName,desc,transition),pageDiv.find("#transitions").html(ZPeople.LOADING_HTML).removeClass("ht100"),ProcessBuilder.setOverlayLabel(conn[0],{Name:transName,TransitionId:transitionId,Global:resultData[1].Global}),ProcessBuilder.makeGlobalTransition(transitionId,resultData[1].Global,transName),ProcessBuilder.addTransition(transition.SourceId,transition.TargetId,transitionId,transName,"",""),Blueprint.currentBpData.transitionsCount++,Blueprint.saveActions(),Blueprint.Owners.saveTransitionOwners())})}else ProcessBuilder.setOverlayLabel(conn[0],{Name:transName,TransitionId:transitionId}),ProcessBuilder.addTransition(transition.SourceId,transition.TargetId,transitionId,transName,"",""),Blueprint.currentBpData.transitionsCount++}else Blueprint.showError(pageDiv.find("#pb_transitionName").parent(),ZPI18N.getString("zp.mandatorytransition"))},ProcessBuilder.populateTransClone=function(transitionId,parentTransition,transName,desc,transition){ProcessBuilder.TransitionIdVsDetails[transitionId]=parentTransition,ProcessBuilder.TransitionIdVsDetails[transitionId].Name=transName,ProcessBuilder.TransitionIdVsDetails[transitionId].Description=desc,ProcessBuilder.TransitionIdVsDetails[transitionId].SourceId=transition.SourceId,ProcessBuilder.TransitionIdVsDetails[transitionId].TargetId=transition.TargetId,ProcessBuilder.TransitionIdVsDetails[transitionId].isNewTransition=!0,ProcessBuilder.TransitionIdVsDetails[transitionId].sourceIds=[transition.SourceId],$.each(ProcessBuilder.TransitionIdVsDetails[transitionId].Fields,function(index,durField){if(durField.id==$("#blueprintDetails").attr("fieldId"))return ProcessBuilder.TransitionIdVsDetails[transitionId].Fields.splice(index,1),!1}),Blueprint.processVrForClone(ProcessBuilder.TransitionIdVsDetails[transitionId].Fields)},ProcessBuilder.nodeContextMenu=function(nodeElem,nodeElemId){var pageDiv=$pageId(),$NodeContextMenu=pageDiv.find(".NodeContextMenu"),$linkContextMenu=pageDiv.find(".linkContextMenu"),$canvas=pageDiv.find("#canvas");nodeElem.on("contextmenu",function(event){event.preventDefault();var bindHtml="<ul><li class='proxima' onclick=\"ProcessBuilder.removeNode('"+nodeElemId+'\');"><i class="IC-delete MR5"></i>'+ZPI18N.getString("zp.delete")+"</li></ul>";$linkContextMenu.hide(),$NodeContextMenu.html(bindHtml).show().css({top:event.pageY+10-$canvas.offset().top,left:event.pageX+10-$canvas.offset().left})})},ProcessBuilder.calculatePosition=function(left,top,flowChart){var pageDiv=$pageId(),newPos={};if(flowChart.canvasWidth){var dummyCanvasCont=pageDiv.find("#processDropCanvas"),oldWidth=parseInt(flowChart.canvasWidth),oldHeight=parseInt(flowChart.canvasHeight),newWidth=dummyCanvasCont[0].offsetWidth,newHeight=dummyCanvasCont[0].offsetHeight;if(oldWidth<newWidth)left+=Math.ceil((newWidth-oldWidth)/2);else left-=Math.ceil((oldWidth-newWidth)/2);if(oldHeight<newHeight)top+=Math.ceil((newHeight-oldHeight)/2);else top-=Math.ceil((oldHeight-newHeight)/2)}return left=parseInt(left),top=parseInt(top),newPos.left=10*Math.ceil(left/10),newPos.top=10*Math.ceil(top/10),newPos},ProcessBuilder.loadFlowChart=function(flowChart){var pageDiv=$pageId();if(pageDiv.find("#processDropCanvas").css({width:$("#createProcessContainer").width()-540+"px"}),ProcessBuilder.panXVal=0,ProcessBuilder.panYVal=0,ProcessBuilder.canvasLeft=0,ProcessBuilder.canvasTop=0,flowChart=flowChart?JSON.parse(flowChart):{},ProcessBuilder.instance.setSuspendDrawing(!0),flowChart.nodes){var nodes=flowChart.nodes,$availableStatesDiv=(flowChart.nodes.length,pageDiv.find("#canvas"),pageDiv.find("#dragableDiv")),isStartNodePresent=0;$.each(nodes,function(index,node){var nodeId=node.nodeId;if(void 0!=ProcessBuilder.Process.PickListValueDetails[nodeId]){var stateDisplayName=ZPeople.decodeTxt(ProcessBuilder.Process.PickListValueDetails[nodeId].optVal),isStartNode="-None-"===ProcessBuilder.Process.PickListValueDetails[nodeId].optVal;isStartNode&&(stateDisplayName=ZPI18N.getString("zp.start"),isStartNodePresent=1),$availableStatesDiv.find("[data-nodeid='"+nodeId+"']").remove();var newPos=ProcessBuilder.calculatePosition(node.posX,node.posY,flowChart);ProcessBuilder.addNode(nodeId,stateDisplayName,newPos.left,newPos.top,!0,isStartNode)}}),0==isStartNodePresent&&0!=flowChart.nodes.length&&pageDiv.find("#state_START").removeClass("DNI"),ProcessBuilder.enablePanning()}if(ProcessBuilder.instance.bind("connection",function(connInfo,originalEvent){connInfo.connection.getOverlay("label").setLabel("+")}),flowChart.connections){var connections=flowChart.connections;$.each(connections,function(index,connection){try{var newConn=ProcessBuilder.instance.connect({uuids:[connection.fromUUId,connection.toUUId],editable:!0});ProcessBuilder.setOverlayLabel(newConn),ProcessBuilder.loadInitalGlobal(newConn)}catch(er){}})}ProcessBuilder.bindEventHandlersForConnections(),ProcessBuilder.instance.setSuspendDrawing(!1,!0),pageDiv.find(".ui-droppable").show(),Blueprint.showSearchBar()},ProcessBuilder.setOverlayLabel=function(connection,labTextObj){var pageDiv=$pageId(),sourceId=connection.sourceId.split("_")[1],targetId=connection.targetId.split("_")[1],oldTransObject=ProcessBuilder.Process.ConnectionIdVsName[sourceId+"_"+targetId],labelOverlay=connection.getOverlay("label"),$labelElem=($(labelOverlay.canvas).attr("id"),$(labelOverlay.canvas)),isGlobal=!(!(labTextObj=labTextObj||ProcessBuilder.Process.ConnectionIdVsName[sourceId+"_"+targetId])||!labTextObj.Global)&&labTextObj.Global,transitionId=labTextObj&&labTextObj.TransitionId?labTextObj.TransitionId:"",transitionName=labTextObj&&labTextObj.Name?labTextObj.Name:"",isContinuous=!(!labTextObj||!labTextObj.Continuous)&&labTextObj.Continuous,transRelId=oldTransObject&&oldTransObject.Id?oldTransObject.Id:"";if(labelOverlay.removeClass("hide"),$labelElem.attr({relId:transRelId,source:sourceId,target:targetId,transId:transitionId,continuous:isContinuous,global:isGlobal,"data-zcqa":"trans_pa_"+transitionName,title:transitionName}),$labelElem[0].setAttribute("onclick","ProcessBuilder.addTransition('"+sourceId+"', '"+targetId+"', '"+transitionId+"', '"+transitionName+"', event, this)"),labTextObj&&labTextObj.Name){labTextObj.SourceId=sourceId,labTextObj.TargetId=targetId,labTextObj.Name=transitionName,labTextObj.TransitionId=transitionId,labTextObj.Continuous=isContinuous,labTextObj.Global=isGlobal,$labelElem.attr("label",labTextObj.Name);$labelElem.html('<div class="skew_33 transDiv"><span class="reverseSkew"></span></div>'),$labelElem.find(".reverseSkew").text(labTextObj.Name),labelOverlay.addClass("labelText"),labelOverlay.removeClass("add-transition"),$labelElem[0].setAttribute("onmouseenter","ProcessBuilder.transitionHover(this)"),$labelElem[0].setAttribute("onmouseleave","ProcessBuilder.transitionLeave(this)"),ProcessBuilder.globalActionListeners(isGlobal,sourceId,targetId),ProcessBuilder.Process.ConnectionIdVsName[labTextObj.SourceId+"_"+labTextObj.TargetId]=labTextObj}else{var $canvasDiv=pageDiv.find("#canvas"),transNum=$canvasDiv.find(".transDiv").length;if((transNum+=$canvasDiv.find(".add-transition").length)>=ProcessBuilder.transLimit)ProcessBuilder.removeConnection("state_"+sourceId,"state_"+targetId),ZPeople.confirm(null,"","zp.translimitexceed","",!0,!1);else{labelOverlay.setLabel("+"),labelOverlay.removeClass("labelText"),labelOverlay.addClass("add-transition");var key=ZPI18N.getString("zp.transadd");$labelElem.attr("data-key",key)}}},ProcessBuilder.transitionHover=function(obj){var pageDiv=$pageId(),sNode=pageDiv.find(obj).attr("source"),tNode=pageDiv.find(obj).attr("target");pageDiv.find(obj).addClass("cTstatesHover"),pageDiv.find("#state_"+sNode).addClass("cTstatesHover"),pageDiv.find("#state_"+tNode).addClass("cTstatesHover")},ProcessBuilder.transitionLeave=function(obj){var pageDiv=$pageId(),sNode=pageDiv.find(obj).attr("source"),tNode=pageDiv.find(obj).attr("target");pageDiv.find(obj).removeClass("cTstatesHover"),pageDiv.find("#state_"+sNode).removeClass("cTstatesHover"),pageDiv.find("#state_"+tNode).removeClass("cTstatesHover")},ProcessBuilder.loadTransitionDetails=function(transitionDetails){var pageDiv=$pageId();pageDiv.find("#pb_transitionName").text(transitionDetails.Name),pageDiv.find("#pb_transitionDescription").val(transitionDetails.Description),""!=transitionDetails.Description&&pageDiv.find("#transitionDescDiv").addClass("sel"),pageDiv.find("#globalCbContainer").show(),pageDiv.find("#ownerContainer").show(),void 0==transitionDetails.Global&&""==transitionDetails.Global||(pageDiv.find("#globalTransitionCb").prop("checked",transitionDetails.Global),ProcessBuilder.makeGlobalTransition(ProcessBuilder.Transition.transitionId,transitionDetails.Global,transitionDetails.Name),ProcessBuilder.populateCommonStates(transitionDetails.Global,ProcessBuilder.Transition.transitionId)),ProcessBuilder.setActions(transitionDetails.Actions),Blueprint.Owners.constructOwnerList(transitionDetails.TransitionOwners,pageDiv.find("#ownerList")),Blueprint.Owners.emptyOwnersCheck(),$(pageDiv.find("#ownerList")).on("click",function(){Blueprint.Owners.saveTransitionOwners(),Blueprint.Owners.emptyOwnersCheck(),ProcessBuilder.unSavedChanges=!0});var tab;tab=transitionDetails.Criteria.length>0?1:transitionDetails.Fields.length>0||void 0!=transitionDetails.InfoMessage&&transitionDetails.InfoMessage.length>0?2:transitionDetails.Actions.alertList.length>0||transitionDetails.Actions.checklist.length>0||transitionDetails.Actions.customfnList.length>0||transitionDetails.Actions.fieldUpdateList.length>0||transitionDetails.Actions.taskConfigList.length>0||transitionDetails.Actions.webHookList.length>0?3:1,Blueprint.selectTransitionTab(tab),pageDiv.find("#pb_transitionName").on("keyup",Blueprint.clearPlaceHolder())},ProcessBuilder.setActions=function(actions){$pageId().find("#after").html(Blueprint.getActionConstruct(actions)),Blueprint.checkEmptyActions()},ProcessBuilder.addTransition=function(sourceId,targetId,transitionId,transitionName,event,obj){var pageDiv=$pageId(),$obj=pageDiv.find(obj);pageDiv.find("#canvas .window.jtk-node, .jsplumb-overlay.aLabel").removeClass("cTstates");var transition={};if(pageDiv.find(".aLabel").removeClass("actTransition"),$obj.addClass("actTransition"),transition.SourceId=sourceId,transition.TargetId=targetId,transition.transitionId=transitionId,transition.Name=transitionName,transitionId)if(void 0!=ProcessBuilder.TransitionIdVsDetails[transitionId])pageDiv.find("#transitions").html(Blueprint.getTransitionDetailsTemplate()),pageDiv.find("#transdel").attr("onclick","ProcessBuilder.removeConnection('state_"+sourceId+"', 'state_"+targetId+"');"),pageDiv.find("#transdel").removeClass("DN"),ProcessBuilder.Transition=ProcessBuilder.TransitionIdVsDetails[transitionId],ProcessBuilder.Transition.transitionId=transitionId,ProcessBuilder.showTransitionsSbDetails(!1),ProcessBuilder.loadTransitionDetails(ProcessBuilder.TransitionIdVsDetails[transitionId]),pageDiv.find("#"+ProcessBuilder.nodeNameConstant+sourceId).addClass("cTstates"),pageDiv.find("#"+ProcessBuilder.nodeNameConstant+targetId).addClass("cTstates"),$obj.addClass("cTstates");else{var params={method:"getTransitionDetails"};params.TransitionId=transitionId,ProcessBuilder.showTransitionsSbDetails(!1),pageDiv.find("#transitions").html(ZPeople.LOADING_HTML).addClass("ht100"),ZPeople.Request.send("/transitionAction.zp",params,function(resultData){ProcessBuilder.TransitionIdVsDetails[transitionId]=resultData[1],ProcessBuilder.TransitionIdVsDetails[transitionId].SourceId=sourceId,ProcessBuilder.TransitionIdVsDetails[transitionId].TargetId=targetId,ProcessBuilder.Transition=ProcessBuilder.TransitionIdVsDetails[transitionId],$.each(ProcessBuilder.Transition.Fields,function(index,value){void 0!=value.validationJson&&value.validationJson!={}&&void 0!=value.validationJson.baseConditions[0].VALIDATION_MSG&&(value.validationJson.baseConditions[0].VALIDATION_MSG=ZPeople.decodeTxt(value.validationJson.baseConditions[0].VALIDATION_MSG))}),$.each(ProcessBuilder.Transition.Actions,function(key,value){$.inArray(key,["alertList","checklist","fieldUpdateList","webHookList","customfnList"])>-1&&$.each(value,function(index,action){void 0!=action.tempName&&""!=action.tempName&&(action.tempName="fieldUpdateList"===key||"customfnList"===key?ZPeople.decodeTxt(action.tempName):action.tempName)})}),ProcessBuilder.Transition.transitionId=transitionId,pageDiv.find("#transitions").html(Blueprint.getTransitionDetailsTemplate()).removeClass("ht100"),pageDiv.find("#transdel").attr("onclick","ProcessBuilder.removeConnection('state_"+sourceId+"', 'state_"+targetId+"');"),pageDiv.find("#transdel").removeClass("DN"),pageDiv.find("#ownerContainer").hide(),ProcessBuilder.showTransitionsSbDetails(!1),ProcessBuilder.loadTransitionDetails(ProcessBuilder.TransitionIdVsDetails[transitionId]),Blueprint.saveActions(),Blueprint.Owners.saveTransitionOwners(),pageDiv.find("#"+ProcessBuilder.nodeNameConstant+sourceId).addClass("cTstates"),pageDiv.find("#"+ProcessBuilder.nodeNameConstant+targetId).addClass("cTstates"),$obj.addClass("cTstates")})}else{transition.isNewTransition=!0,transition.Criteria=[],transition.TransitionOwners={},transition.TransitionOwners.departments={},transition.TransitionOwners.groups={},transition.TransitionOwners.roles={},transition.TransitionOwners.system={},transition.TransitionOwners.sysConf={},transition.OwnersToSave={},transition.OwnersToSave.ownerIds="",transition.OwnersToSave.ownerTypes="",transition.Fields=[],transition.sourceIds=[sourceId],transition.Description="",transition.Global=!1;var ActionsToSave={mailAlertIds:"",checklistIds:"",fieldUpdateIds:"",webhookIds:"",customfnIds:""};transition.ActionsToSave=ActionsToSave;var Actions={alertList:[],checklist:[],customfnList:[],esignConfigList:[],fieldUpdateList:[],taskConfigList:[],webHookList:[]};transition.Actions=Actions,ProcessBuilder.Transition=transition,ProcessBuilder.unSavedChanges=!0,ProcessBuilder.showAddNewTransition($obj)}ProcessBuilder.applyCommonlineStyle(),conn=ProcessBuilder.instance.getConnections({source:ProcessBuilder.nodeNameConstant+sourceId,target:ProcessBuilder.nodeNameConstant+targetId}),ProcessBuilder.applyStyle(conn,ProcessBuilder.connectorSelectStyle),ProcessBuilder.closeBpInfo(!0)},ProcessBuilder.showAddNewTransition=function($obj){var pageDiv=$pageId();pageDiv.find("#transitions").html(Blueprint.getTransitionDetailsTemplate()),ProcessBuilder.showTransitionsSbDetails(!0,$obj),pageDiv.find("#pb_transitionName").text("").trigger("focus"),pageDiv.find("#"+ProcessBuilder.nodeNameConstant+ProcessBuilder.Transition.SourceId).addClass("cTstates"),pageDiv.find("#"+ProcessBuilder.nodeNameConstant+ProcessBuilder.Transition.TargetId).addClass("cTstates"),$obj.addClass("cTstates")},ProcessBuilder.applyCommonlineStyle=function(){for(var pageDiv=$pageId(),allCon=ProcessBuilder.instance.getAllConnections(),t=0;t<allCon.length;t++){var labelOverlay=allCon[t].getOverlay("label"),$labelElem=pageDiv.find(labelOverlay.canvas),sId=$labelElem.attr("source"),tId=$labelElem.attr("target");conn=ProcessBuilder.instance.getConnections({source:ProcessBuilder.nodeNameConstant+sId,target:ProcessBuilder.nodeNameConstant+tId}),ProcessBuilder.applyStyle(conn,ProcessBuilder.connectorPaintStyle)}},ProcessBuilder.enablePanning=function(){$pageId().find("#canvasContainer").attr({onmousedown:"ProcessBuilder.enablePan('canvasContainer', event);",onmouseup:"ProcessBuilder.disablePan('canvasContainer', event);",onmouseout:"ProcessBuilder.canvasOut(event);"})},ProcessBuilder.disablePanning=function(){$pageId().find("#canvasContainer").removeAttr("onmousedown onmouseup onmouseout")},ProcessBuilder.canvasOut=function(e){var pageDiv=$pageId();pageDiv.find("#canvasContainer").hasClass("pb-surface-panning")&&(ProcessBuilder.disablePan("canvasContainer",e),pageDiv.find("#canvas").position({left:ProcessBuilder.canvasLeft,top:ProcessBuilder.canvasTop}))},ProcessBuilder.enablePan=function(obj,event){var pageDiv=$pageId(),evTarget=pageDiv.find(event.target);if(!(evTarget.hasClass("jtk-node")||evTarget.hasClass("reverseSkew")||evTarget.hasClass("transDiv")||evTarget.hasClass("jsplumb-overlay"))){var $obj=pageDiv.find("#"+obj);$obj.addClass("pb-surface-panning"),ProcessBuilder.panXVal=event.pageX,ProcessBuilder.panYVal=event.pageY;var canvasPos=pageDiv.find("#canvas").position();ProcessBuilder.canvasLeft=canvasPos.left,ProcessBuilder.canvasTop=canvasPos.top,$obj.on("mousemove",function(event){var panXMoveVal=event.pageX-ProcessBuilder.panXVal,panYMoveVal=event.pageY-ProcessBuilder.panYVal,posx="left";panXMoveVal>0&&(posx="right");var posy="top";panYMoveVal>0&&(posy="bottom");var isMaxAreaReached=ProcessBuilder.isMaxAreaReached(posx,panXMoveVal),isMaxAreaReachedY=ProcessBuilder.isMaxAreaReachedY(posy,panYMoveVal);isMaxAreaReached?ProcessBuilder.ispbPanPositionLeft=!0:pageDiv.find("#canvas").css({left:ProcessBuilder.canvasLeft+panXMoveVal}),isMaxAreaReachedY?ProcessBuilder.ispbPanPositionTop=!0:pageDiv.find("#canvas").css({top:ProcessBuilder.canvasTop+panYMoveVal})})}},ProcessBuilder.isMaxAreaReached=function(position,panXMoveVal){var pageDiv=$pageId(),isMaxAreaReached=!1;if("left"===position){var maxElemLeft=void 0;pageDiv.find("#canvas .window.jtk-node").each(function(){var newLeft=$(this).position().left;maxElemLeft=maxElemLeft?newLeft>maxElemLeft?newLeft:maxElemLeft:newLeft}),maxElemLeft&&(isMaxAreaReached=(maxElemLeft+=10)+(ProcessBuilder.canvasLeft+panXMoveVal)<=0)}else if("right"===position){var minElemLeft=void 0,elemWidth=0,canvasVisibleAreaWid=pageDiv.find("#processDropCanvas").outerWidth();pageDiv.find("#canvas .window.jtk-node").each(function(){var newLeft=$(this).position().left;(!minElemLeft||newLeft<minElemLeft)&&(minElemLeft=newLeft,elemWidth=$(this).outerWidth())}),minElemLeft&&(isMaxAreaReached=canvasVisibleAreaWid-((minElemLeft-=10)+ProcessBuilder.canvasLeft+panXMoveVal+elemWidth)<=0)}return isMaxAreaReached},ProcessBuilder.isMaxAreaReachedY=function(position,panYMoveVal){var isMaxAreaReachedY,pageDiv=$pageId();if("top"===position){var maxElemTop=void 0;pageDiv.find("#canvas .window.jtk-node").each(function(){var newTop=$(this).position().top;maxElemTop=maxElemTop?newTop>maxElemTop?newTop:maxElemTop:newTop}),maxElemTop&&(isMaxAreaReachedY=maxElemTop+(ProcessBuilder.canvasTop+panYMoveVal)<=0)}else if("bottom"===position){var minElemBottom=void 0,canvasVisibleAreaHeight=pageDiv.find("#processDropCanvas").outerHeight()-50;pageDiv.find("#canvas .window.jtk-node").each(function(){var newBottom=$(this).position().top;(!minElemBottom||newBottom<minElemBottom)&&(minElemBottom=newBottom,elemHeight=$(this).outerHeight())}),minElemBottom&&(isMaxAreaReachedY=canvasVisibleAreaHeight-((minElemBottom-=10)+ProcessBuilder.canvasTop+panYMoveVal+elemHeight)<=0)}return isMaxAreaReachedY},ProcessBuilder.disablePan=function(obj,event){var pageDiv=$pageId();if(!pageDiv.find(event.target).hasClass("jtk-node")){var $obj=pageDiv.find("#"+obj);$obj.removeClass("pb-surface-panning");var canvasPosition=pageDiv.find("#canvas").position(),pbCanvasLeftPos=canvasPosition.left,pbCanvasTopPos=canvasPosition.top;if(ProcessBuilder.ispbPanPositionLeft){panXValue=0;ProcessBuilder.canvasLeft=pbCanvasLeftPos+panXValue,ProcessBuilder.ispbPanPositionLeft=!1}else{var panXValue=event.pageX-ProcessBuilder.panXVal;ProcessBuilder.canvasLeft+=panXValue}if(ProcessBuilder.ispbPanPositionTop){panYValue=0;ProcessBuilder.canvasTop=pbCanvasTopPos+panYValue,ProcessBuilder.ispbPanPositionTop=!1}else{var panYValue=event.pageY-ProcessBuilder.panYVal;ProcessBuilder.canvasTop+=panYValue}$obj.off("mousemove"),ProcessBuilder.panXVal=0,ProcessBuilder.panYVal=0}},ProcessBuilder.showTransitionsSbDetails=function(isNewTransition,obj){var pageDiv=$pageId();if(pageDiv.find("#infoAndStates").hide(),pageDiv.find("#transitionTab").removeClass("DNI"),pageDiv.find("#transitions").show(),isNewTransition){pageDiv.find("#allTransitionDetails").hide(),pageDiv.find("#ownerContainer").hide(),pageDiv.find("#pb_transitionName").text(""),pageDiv.find("#pb_transitionName").attr("onkeyup","Blueprint.suggestTransitions()"),pageDiv.find("#pb_transitionName").attr("onclick","Blueprint.suggestTransitions()"),pageDiv.find("#pb_transitionDescription").val("");var saveButton='<button data-zcqa="btn_pa_saveTrans" id="savetransconfigbtn" type="button" class="btn btn-primary" onclick="ProcessBuilder.addConnectionName('+obj.attr("id")+');">'+ZPI18N.getString("zp.save")+'</button><button data-zcqa="btn_pa_saveTrans" id="savetoinfostatesbtn" type="button" class="btn btn-default ML10" onclick="ProcessBuilder.showInfoAndStates();">'+ZPI18N.getString("zp.cancel")+"</button>";pageDiv.find("#transitions").append(saveButton)}else pageDiv.find("#pb_transitionName").attr("onclick",""),pageDiv.find("#allTransitionDetails").show(),pageDiv.find("#ownerContainer").show();pageDiv.find("#transitionTab").addClass("active"),pageDiv.find("#infoTab").removeClass("active"),pageDiv.find("#infoTab a").removeClass("bld")},ProcessBuilder.showInfoAndStates=function(){var pageDiv=$pageId();pageDiv.find("#transitionTab").addClass("DNI"),pageDiv.find("#transitions").hide(),pageDiv.find("#infoTab a").addClass("bld"),pageDiv.find("#infoAndStates").show(),pageDiv.find("#bpEditCriteria").html(Blueprint.criteriaHTML);var ruleList=pageDiv.find("#bpCriteriaList");Blueprint.setProcessedJson(ruleList,Blueprint.currentBpData.ProcessedJson,!1),pageDiv.find("#transitionTab").removeClass("active"),Blueprint.showSearchBar()},ProcessBuilder.closeBpInfo=function(transitionmode){void 0==transitionmode||1!=transitionmode?$("#closeBpInfo").hasClass("DN")?($("#openBpInfo").addClass("DN"),$("#closeBpInfo").removeClass("DN"),$("#bluePrintInfo").css({right:"0px"}),setTimeout(function(){$("#canvasContainer").css({right:"540px"})},400)):($("#openBpInfo").removeClass("DN"),$("#closeBpInfo").addClass("DN"),$("#bluePrintInfo").css({right:"-510px"}),$("#canvasContainer").css({right:"20px"})):$("#openBpInfo").hasClass("DN")||void 0==transitionmode||1!=transitionmode||($("#openBpInfo").addClass("DN"),$("#closeBpInfo").removeClass("DN"),$("#bluePrintInfo").css({right:"0px"}),setTimeout(function(){$("#canvasContainer").css({right:"540px"})},400))},ProcessBuilder.removeConnectionconfirm=function(fromStateId,toStateId,skipConfirm){var transitionid=void 0!=ProcessBuilder.Process.ConnectionIdVsName[fromStateId+"_"+toStateId]?ProcessBuilder.Process.ConnectionIdVsName[fromStateId+"_"+toStateId].TransitionId:"";if(void 0!=transitionid&&""!=transitionid){var pageDiv=$pageId().parent(),popup='<div id="confirmstatedelete"><div class="modal ZPmdl DelMdl bluePrint in" role="dialog"><div class="modal-dialog modal-center"><div class="modal-content"><div class="modal-header PR"><div class="Icn orgbgi"><i class="IC-alert whi S24"></i></div><h4 class="modal-title">'+ZPI18N.getString("zp.transdelete")+'</h4></div><div class="modal-body"><div>'+ZPI18N.getString("zp.zp.transdeletebody")+'</div></div><div class="text-center modal-footer"><a id="confirmtransdelete" data-dismiss="modal" class="btn btn-primary MR5">'+ZPI18N.getString("zp.yes")+'</a><a id="canceltransdelete" data-dismiss="modal" class="btn btn-default">'+ZPI18N.getString("zp.no")+"</a></div></div></div></div></div>";pageDiv.append(popup),pageDiv.find("#confirmtransdelete").on("click",function(){pageDiv.parent().find("#confirmstatedelete").remove(),ProcessBuilder.removeConnection(fromStateId,toStateId,skipConfirm)}),pageDiv.find("#canceltransdelete").on("click",function(){pageDiv.parent().find("#confirmstatedelete").remove()})}else ProcessBuilder.removeConnection(fromStateId,toStateId,skipConfirm)},ProcessBuilder.searchStateAction=function(obj){var pageDiv=$pageId(),searchText=pageDiv.find(obj).val(),actionItems=pageDiv.find("#dragableDiv").find(".ProcessState");if(""!=searchText.trim())for(var i=0;i<actionItems.length;i++){var $actionItem=actionItems.eq(i),searchTxtValues=$actionItem.find("span").text();searchTxtValues=searchTxtValues.toLocaleLowerCase(),searchText=searchText.toLocaleLowerCase(),searchTxtValues.search(searchText)<0?$actionItem.hide():$actionItem.show()}else actionItems.show()},ProcessBuilder.globalClicked=function(obj,e){var isGlobalChecked=$(obj).prop("checked"),transitionid=ProcessBuilder.Transition.transitionId,transName=ProcessBuilder.Transition.Name,$transObject=$pageId().find('[transid="'+transitionid+'"]'),sourceId=$transObject.attr("source"),targetId=$transObject.attr("target");ProcessBuilder.populateCommonStates(isGlobalChecked,transitionid,!0),isGlobalChecked?(ProcessBuilder.makeGlobalTransition(transitionid,!0,transName),ProcessBuilder.Transition.Global=!0,ProcessBuilder.globalTransitionHover(sourceId,targetId,!0),clearTimeout(ProcessBuilder.globalTransHoverTimeout),ProcessBuilder.globalTransHoverTimeout=setTimeout(function(){ProcessBuilder.globalTransitionLeave(sourceId,targetId)},800)):(ProcessBuilder.makeGlobalTransition(transitionid,!1,transName),ProcessBuilder.Transition.Global=!1),ProcessBuilder.globalActionListeners(isGlobalChecked,sourceId,targetId),ProcessBuilder.unSavedChanges=!0,e.stopPropagation()},ProcessBuilder.makeGlobalTransition=function(transid,isGlobal,transName){var $transObject=$pageId().find('[transid="'+transid+'"]'),tooltip=transName;isGlobal?(tooltip="("+ZPI18N.getString("zp.globaltransition")+") "+transName,$transObject.addClass("globalTransition")):$transObject.removeClass("globalTransition"),$transObject.attr("title",tooltip)},ProcessBuilder.checkOrphanNodes=function(){var nodeList=ProcessBuilder.getAllNodeIds(),result=!1,transitions=JSON.stringify(ProcessBuilder.getTransitionsToSave());return $.each(nodeList,function(index,node){-1==transitions.indexOf(node)&&(result=!0)}),result},ProcessBuilder.globalTransitionHover=function(sourceId,targetId,isFromChange){var nodes=[],nodeLenChanged=!1,conn=ProcessBuilder.instance.getConnections({source:ProcessBuilder.nodeNameConstant+sourceId,target:ProcessBuilder.nodeNameConstant+targetId});if(conn[0]){var globalTransObj=$(conn[0].getOverlay("label").canvas),globalTransId=globalTransObj.attr("id"),transId=globalTransObj.attr("transid");nodes=void 0!=ProcessBuilder.TransitionIdVsDetails[transId]?ProcessBuilder.TransitionIdVsDetails[transId].sourceIds:ProcessBuilder.getAllNodeIds();var jtkNode=$(".jtk-node"),posArr=ProcessBuilder.setTransformedPosition(globalTransObj);if((jtkNode.length!=globalTransObj.data("nodeConLen")||isFromChange)&&(jtkNode.length!=globalTransObj.data("nodeConLen")&&(nodeLenChanged=!0),ProcessBuilder.globalActionListeners(!1,sourceId,targetId),globalTransObj.data("conSet",!1)),1!=globalTransObj.data("conSet")){for(i in nodes)nodes[i]!=sourceId&&nodes[i]!=targetId&&ProcessBuilder.connectNodesforGlobal(ProcessBuilder.nodeNameConstant+nodes[i],globalTransId);ProcessBuilder.instance.setSuspendDrawing(!1,!0),globalTransObj.data("conSet",!0)}else ProcessBuilder.instance.repaintEverything(),ProcessBuilder.instance.show(globalTransId);nodeLenChanged&&ProcessBuilder.globalActionListeners(!0,sourceId,targetId),globalTransObj.data("nodeConLen",jtkNode.length),globalTransObj.css({transform:"translate(-50%, -50%)",left:posArr[0],top:posArr[1]})}},ProcessBuilder.globalTransitionLeave=function(sourceId,targetId){var conn=ProcessBuilder.instance.getConnections({source:ProcessBuilder.nodeNameConstant+sourceId,target:ProcessBuilder.nodeNameConstant+targetId});if(conn[0]){var globalTransId=$(conn[0].getOverlay("label").canvas).attr("id");ProcessBuilder.getAllNodeIds();ProcessBuilder.instance.hide(globalTransId)}},ProcessBuilder.setTransformedPosition=function(globTrans){var globObjPosition=(globTrans=$pageId().find(globTrans)).position(),newL=globObjPosition.left,newT=globObjPosition.top;globTrans.css({transform:""});var glopPosObj=globTrans.position(),checkL=glopPosObj.left,checkT=glopPosObj.top;return globTrans.css({left:newL,top:newT}),[checkL,checkT]},ProcessBuilder.detachGlobalConnections=function(globTransId){var globalConn=ProcessBuilder.instance.getConnections({target:globTransId});for(i in globalConn)ProcessBuilder.instance.detach(globalConn[i])},ProcessBuilder.globalActionListeners=function(isGlobal,sNode,tNode){var conn=ProcessBuilder.instance.getConnections({source:ProcessBuilder.nodeNameConstant+sNode,target:ProcessBuilder.nodeNameConstant+tNode}),$activeTransObj=$(conn[0].getOverlay("label").canvas);isGlobal?($activeTransObj.on("mouseenter.globalTransition",function(){clearTimeout(ProcessBuilder.globalTransHoverTimeout),ProcessBuilder.globalTransHoverTimeout=setTimeout(function(){ProcessBuilder.globalTransitionHover(sNode,tNode)},800)}),$activeTransObj.on("mouseleave.globalTransition",function(){clearTimeout(ProcessBuilder.globalTransHoverTimeout),ProcessBuilder.globalTransitionLeave(sNode,tNode)})):($activeTransObj.off("mouseenter.globalTransition"),$activeTransObj.off("mouseleave.globalTransition"),clearTimeout(ProcessBuilder.globalTransTimeout),ProcessBuilder.detachGlobalConnections($activeTransObj.attr("id")),$activeTransObj.data("conSet",!1))},ProcessBuilder.loadInitalGlobal=function(conn){var sourceId=conn.sourceId.split("_")[1],targetId=conn.targetId.split("_")[1];if(ProcessBuilder.Process.ConnectionIdVsName[sourceId+"_"+targetId].Global){var globalTransObj=$(conn.getOverlay("label").canvas),globalTransId=globalTransObj.attr("id"),jtkNode=$(".jtk-node"),nodes=[];for(i in $.each(Blueprint.currentBpData.TransitionsMeta,function(index,connection){connection.TransitionId==globalTransObj.attr("transid")&&("null"==connection.SourceId?nodes.push("START"):nodes.push(connection.SourceId))}),nodes)nodes[i]!=sourceId&&nodes[i]!=targetId&&(ProcessBuilder.connectNodesforGlobal(ProcessBuilder.nodeNameConstant+nodes[i],globalTransId),ProcessBuilder.instance.hide({source:sourceId,target:globalTransId}));ProcessBuilder.instance.hide(globalTransId),ProcessBuilder.instance.setSuspendDrawing(!1,!0),globalTransObj.data("conSet",!0),globalTransObj.data("nodeConLen",jtkNode.length),globalTransObj.css({transform:"translate(-50%, -50%)",left:posArr[0],top:posArr[1]})}},ProcessBuilder.populateCommonStates=function(isGlobal,transid,globalClicked){var pageDiv=$pageId(),$transObject=pageDiv.find('[transid="'+transid+'"]'),sourceId=$transObject.attr("source"),targetId=$transObject.attr("target"),conn=ProcessBuilder.instance.getConnections({source:ProcessBuilder.nodeNameConstant+sourceId,target:ProcessBuilder.nodeNameConstant+targetId});if(conn[0]){var globalTransObj=$(conn[0].getOverlay("label").canvas),globalTransId=globalTransObj.attr("id");ProcessBuilder.detachGlobalConnections(globalTransId),globalTransObj.data("conSet",!1)}if(globalClicked)if(isGlobal){var nodes=ProcessBuilder.getAllNodeIds();for(i in nodes)nodes[i]!=sourceId&&nodes[i]!=targetId&&ProcessBuilder.TransitionIdVsDetails[transid].sourceIds.push(nodes[i])}else ProcessBuilder.TransitionIdVsDetails[transid].sourceIds=[sourceId];if(isGlobal){var statesHtml="";statesHtml+='<li><a> <div class="checkbox"> <input id="commState_all" type="checkbox" value ="0" onclick="ProcessBuilder.editCommonStates(this);"> <label for="commState_all" data-toggle="collapse1" data-target="#dvShowautonum">'+ZPI18N.getString("zp.selectall")+"</label> </div> </a></li>",$.each(ProcessBuilder.Process.PickListValueDetails,function(i,state){var checked="";let newState=-1!=i.indexOf("newState");void 0!=this.optId?-1!==$.inArray(this.optId,ProcessBuilder.getAllNodeIds())&&sourceId!=this.optId&&targetId!=this.optId&&(-1!==$.inArray(this.optId,ProcessBuilder.TransitionIdVsDetails[transid].sourceIds)&&(checked="checked"),statesHtml+='<li><a> <div class="checkbox"> <input id="commState_'+this.optId+'" type="checkbox" value ="'+this.optId+'" onclick="ProcessBuilder.editCommonStates(this);" '+checked+'> <label for="commState_'+this.optId+'" data-toggle="collapse1" data-target="#dvShowautonum">'+(newState?ZSEC.Encoder.encodeForHTML(this.optVal):this.optVal)+"</label> </div> </a></li>"):-1!==$.inArray("START",ProcessBuilder.getAllNodeIds())&&"START"!=sourceId&&"START"!=targetId&&(-1!==$.inArray("START",ProcessBuilder.TransitionIdVsDetails[transid].sourceIds)&&(checked="checked"),statesHtml+='<li><a> <div class="checkbox"> <input id="commState_START" type="checkbox" value ="START" onclick="ProcessBuilder.editCommonStates(this);" '+checked+'> <label for="commState_START" data-toggle="collapse1" data-target="#dvShowautonum">'+ZPI18N.getString("zp.start")+"</label> </div> </a></li>")}),pageDiv.find("#trans_states").html(statesHtml),pageDiv.find("#trans_states li input:checked").length==ProcessBuilder.getAllNodeIds().length-2&&(pageDiv.find("#commState_all")[0].checked=!0),pageDiv.find("#commonStatesDiv").removeClass("DN"),pageDiv.find("#globalDivider").removeClass("DN"),globalClicked&&pageDiv.find(".dropdown").addClass("open"),$("body").on("click","#trans_states",function(e){$(this).parent().is(".open")&&e.stopPropagation()})}else pageDiv.find("#commonStatesDiv").addClass("DN"),pageDiv.find("#globalDivider").addClass("DN")},ProcessBuilder.editCommonStates=function(getThis){var stateObj=$(getThis),pageDiv=$pageId(),transid=ProcessBuilder.Transition.transitionId,sourceId=($transObject=pageDiv.find('[transid="'+transid+'"]')).attr("source"),targetId=$transObject.attr("target");if(0==$(getThis).val())if($(getThis).prop("checked")){$.each(pageDiv.find("#trans_states li input"),function(){this.checked=!0});var nodes=ProcessBuilder.getAllNodeIds();for(i in ProcessBuilder.TransitionIdVsDetails[transid].sourceIds=[],nodes)nodes[i]!=sourceId&&nodes[i]!=targetId&&ProcessBuilder.TransitionIdVsDetails[transid].sourceIds.push(nodes[i])}else $.each(pageDiv.find("#trans_states li input"),function(){this.checked=!1}),ProcessBuilder.TransitionIdVsDetails[transid].sourceIds=[sourceId];else if($(getThis).prop("checked"))ProcessBuilder.Transition.sourceIds.push(stateObj.attr("value"));else{var index=ProcessBuilder.Transition.sourceIds.indexOf(stateObj.attr("value"));-1!==index&&ProcessBuilder.Transition.sourceIds.splice(index,1),pageDiv.find("#commState_all")[0].checked=!1}pageDiv.find("#trans_states li input:checked").length==ProcessBuilder.getAllNodeIds().length-2&&(pageDiv.find("#commState_all")[0].checked=!0);sourceId=($transObject=pageDiv.find('[transid="'+transid+'"]')).attr("source"),targetId=$transObject.attr("target");var $transObject,conn=ProcessBuilder.instance.getConnections({source:ProcessBuilder.nodeNameConstant+sourceId,target:ProcessBuilder.nodeNameConstant+targetId});if(conn[0]){var globalTransObj=$(conn[0].getOverlay("label").canvas),globalTransId=globalTransObj.attr("id");ProcessBuilder.detachGlobalConnections(globalTransId),globalTransObj.data("conSet",!1)}},ProcessBuilder.editNodesinGlobal=function(nodeId,isRemoveMode){var pageDiv=$pageId(),params={method:"getMultiTransitionDetails"},transIds=[],globTrans=pageDiv.find(".globalTransition");$.each(globTrans,function(){if(void 0!=ProcessBuilder.TransitionIdVsDetails[$(this).attr("transid")])if(isRemoveMode){var index=ProcessBuilder.TransitionIdVsDetails[$(this).attr("transid")].sourceIds.indexOf(nodeId);-1!==index&&ProcessBuilder.TransitionIdVsDetails[$(this).attr("transid")].sourceIds.splice(index,1)}else ProcessBuilder.TransitionIdVsDetails[$(this).attr("transid")].sourceIds.push(nodeId);else transIds.push($(this).attr("transid"))}),transIds.length>0&&(params.transIds=JSON.stringify(transIds),ZPeople.Request.sendRequest("/transitionAction.zp",params,"GET",function(resultData,params){$.each(resultData[1],function(){ProcessBuilder.TransitionIdVsDetails[this.transitionId]=this;var $transObject=pageDiv.find('[transid="'+this.transitionId+'"]');if(ProcessBuilder.TransitionIdVsDetails[this.transitionId].SourceId=$transObject.attr("source"),ProcessBuilder.TransitionIdVsDetails[this.transitionId].TargetId=$transObject.attr("target"),isRemoveMode){var index=ProcessBuilder.TransitionIdVsDetails[this.transitionId].sourceIds.indexOf(nodeId);-1!==index&&ProcessBuilder.TransitionIdVsDetails[this.transitionId].sourceIds.splice(index,1)}else ProcessBuilder.TransitionIdVsDetails[this.transitionId].sourceIds.push(nodeId)})}))};var VaccinationStatus={CURR_INDEX:1,CURR_EMP_INDEX:1,CURR_PARAM:{},CURR_LISTING:"vaccList",timer:null,init:function(){Layout.Page.hash;VaccinationStatus.getVaccConfigDetails(),VaccinationStatus.CURR_INDEX=1,VaccinationStatus.CURR_EMP_INDEX=1,VaccinationStatus.CURR_SEARCHOBJ={employeeId:"",vaccinationStatus:""},VaccinationStatus.CURR_PARAM={method:"getVaccinationList",searchObj:JSON.stringify(VaccinationStatus.CURR_SEARCHOBJ),index:VaccinationStatus.CURR_INDEX},VaccinationStatus.CURR_LISTING="vaccList",ZPeople.FireScroll.reset()},setCurrentParam:function(employeeId,vaccinationStatus,index){VaccinationStatus.CURR_SEARCHOBJ.vaccinationStatus=void 0!=vaccinationStatus?vaccinationStatus:"",VaccinationStatus.CURR_SEARCHOBJ.employeeId=void 0!=employeeId?employeeId:"",VaccinationStatus.CURR_PARAM.index=index,VaccinationStatus.CURR_PARAM.searchObj=JSON.stringify(VaccinationStatus.CURR_SEARCHOBJ)},getCurrentList:function(){"empList"==VaccinationStatus.CURR_LISTING?VaccinationStatus.getNonUpdatedList():VaccinationStatus.getList()},getCurrentStatus:function(){return"empList"==VaccinationStatus.CURR_LISTING?"-1":"0"==VaccinationStatus.CURR_SEARCHOBJ.vaccinationStatus||""==VaccinationStatus.CURR_SEARCHOBJ.vaccinationStatus?"0":1==(VaccinationStatus.CURR_SEARCHOBJ.hasOwnProperty("vaccinationStatus")?VaccinationStatus.CURR_SEARCHOBJ.vaccinationStatus.split(","):"").length?VaccinationStatus.CURR_SEARCHOBJ.vaccinationStatus:"-2"},getList:function(isFromAdvancedfilter){var pageId=Layout.Page.container;VaccinationStatus.CURR_LISTING="vaccList",isFromAdvancedfilter&&(VaccinationStatus.CURR_INDEX=1,VaccinationStatus.setCurrentParam(pageId.find("#vfempDiv_input").attr("selectedIds"),pageId.find("#vfstatusDiv_input").attr("selectedIds"),1)),ZPeople.Request.send("/vaccination/list",VaccinationStatus.CURR_PARAM,function(data){if((isFromAdvancedfilter||1==VaccinationStatus.CURR_PARAM.index)&&Layout.Page.container.find("#vaccTable").empty(),isadmin?isFromAdvancedfilter||1!=VaccinationStatus.CURR_INDEX||(Layout.Page.container.find("#filterOption").remove(),VaccinationStatus.constructFilterDiv()):(Layout.Page.container.find("#vacc_filter_icon").remove(),Layout.Page.container.find("#filterOption").remove()),VaccinationStatus.resetSelectedStatusFooter(VaccinationStatus.getCurrentStatus()),"success"==data.status&&data.list.length>0){VaccinationStatus.CURR_INDEX+=data.list.length,VaccinationStatus.setCurrentParam(VaccinationStatus.CURR_SEARCHOBJ.employeeId,VaccinationStatus.CURR_SEARCHOBJ.vaccinationStatus,VaccinationStatus.CURR_INDEX),Layout.Page.container.find("#vPageDiv").find(".ZPNdata").remove(),Layout.Page.container.find("div.zp_cinfo").removeClass("DN"),Layout.Page.container.find("#vaccTable").removeClass("DN");var trow="",date="",editIcon="",deleteIcon="";$.each(data.list,function(i,v){editIcon="",deleteIcon=isadmin||v.employee_id==erecno?'<i id="deleteVacc" onclick="event.stopPropagation(); VaccinationStatus.deleteVaccinationData(\''+v.recordId+'\',false);" class="IC-delete-1px zp_rB"></i>':"",date=v.partial_vaccination_date,""!=v.vaccination_date&&(date=v.vaccination_date),v.employee_id==erecno&&(editIcon='<i id="editVacc" onclick="VaccinationStatus.openVaccinationStatusPopup(event,\'edit\')" class="IC-pen-1px zp_rB"></i>'),trow+='<div id="'+v.recordId+'" class="zp_Lst" onclick="VaccinationStatus.viewStatus(\''+v.employee_id+'\')" erecno="'+v.employee_id+'"><div><div class="zp_Lsts">'+VaccinationStatus.showEmployeeData(v.employeeDtls)+'</div><div class="zp_Lsts" name="vaccsts">'+v.have_you_been_vaccinated+'</div><div class="zp_Lass" name="vaccdate">'+date+'</div><div class="zp_Lrgt">'+editIcon+deleteIcon+"</div></div></div>"}),Layout.Page.container.find("#vaccTable").append(trow),data.hasNext&&ZPeople.FireScroll.reset()}else Layout.Page.container.find("#vaccTable").find("div.zp_Lst").length<=0&&(Layout.Page.container.find("div.zp_cinfo").addClass("DN"),Layout.Page.container.find("#vaccTable").addClass("DN"),"0"!=VaccinationStatus.getCurrentStatus()||isFromAdvancedfilter?Layout.Page.container.find("#vPageDiv").append(CommonTemplates.noDataSVG("vPageDiv",!0,ZPI18N.getString("zp.norecfound"))):Layout.Page.container.find("#vPageDiv").append(CommonTemplates.noDataSVG("vPageDiv",!1,ZPI18N.getString("zp.novaccrecfound"),!0,"VaccinationStatus.openVaccinationStatusPopup(event,'');",ZPI18N.getString("zp.addvaccrecord"))));data.hasOwnProperty("totalCount")&&data.totalCount.length>0?VaccinationStatus.totalCountStatus(data,Layout.Page.container):isadmin||Layout.Page.container.find("[name=footerposition]").addClass("zp_dyn")})},showmoreDropDown:function(obj){var menuProp;menuProp={id:"import",data:[{id:"vacc_exp",value:ZPI18N.getString("zp.export")},{id:"vacc_setting",value:ZPI18N.getString("zp.editstatuslist")},{id:"vacc_deleteAll",value:ZPI18N.getString("zp.allvaccdatadelete")}],width:200,position:ZPArrow.BOTTOM_RIGHT,oneTimeMenu:!0,callback:function(liObj,srcObj){"vacc_exp"==$(liObj).attr("id")?ZPExport.showExportContainer(VaccinationStatus.Export.exportList,"vaccinationstatus"):"vacc_setting"==$(liObj).attr("id")?VaccinationStatus.Settings.showPopup():"vacc_deleteAll"==$(liObj).attr("id")&&VaccinationStatus.deleteVaccinationData("vaccTable",!0)}},$(obj).zparrowmenu(menuProp)},searchNonUpdatedEmployee:function(ev,obj){var query=$(obj).val().trim(),keycode=ev.which;(13==keycode||8==keycode||ZPMenu.isValidKeycode(ev))&&(clearTimeout(VaccinationStatus.timer),VaccinationStatus.timer=null,VaccinationStatus.timer=setTimeout(function(){VaccinationStatus.getNonUpdatedEmpDtls(query)},700))},getNonUpdatedEmpDtls:function(query){$("#sliderContent").find("div.zp_Lst").remove(),$("#sliderContent").find("div.ZPNdata").remove();var result=[],empList=[];(query=query.length>0?query:"*").length&&(result=EmployeeDropdown.getListData(query.toLowerCase(),"emp","VACC_NUPD_EMP",query.toLowerCase(),[],!0),$.each(result,function(i){var param1={};param1.name=result[i].value,param1.employeePhoto=result[i].avatar,param1.erecno=result[i].id,param1.zuid=result[i].zuid,param1.emailId=result[i].emailId,empList.push(param1)})),empList.length>0?$("#sliderContent").append(VaccinationStatus.returnEmpRowHtml(empList)):$("#sliderContent").append(CommonTemplates.noDataSVG("sliderPopup",!0,ZPI18N.getString("zp.norecfound")))},getNonUpdatedList:function(){Layout.Page.container;var params={method:"getVaccinationList",searchObj:JSON.stringify({employeeId:"",vaccinationStatus:"-1"}),index:VaccinationStatus.CURR_EMP_INDEX};ZPeople.Request.send("/vaccination/list",params,function(data){if(CommonTemplates.createEmptyPopupSlider(!1,ZPI18N.getString("zp.vaccnotsubmittedemp"),function(){VaccinationStatus.CURR_EMP_INDEX=1,VaccinationStatus.resetSelectedStatusFooter(VaccinationStatus.CURR_SEARCHOBJ.vaccinationStatus)}),$("#sliderContent").attr("scroll","enabled"),VaccinationStatus.CURR_EMP_INDEX<=1&&$("#sliderContent").empty(),"success"==data.status&&data.list.length>0){$("#sliderContent").append('<div class="usrsearch"><div class="input-group"><div class="input-group-btn"><a class="btn btn-default S16"> <span class="IC-lens"></span></a></div><input class="form-control" autocomplete="off" onkeyup="VaccinationStatus.searchNonUpdatedEmployee(event,this)" id="searchNUPDEmp" type="search" placeholder="'+ZPI18N.getString("zp.gtsearchuser")+'"></div></div>'),$("#sliderContent").append(VaccinationStatus.returnEmpRowHtml(data.list))}else CommonTemplates.setSliderBody(CommonTemplates.noDataSVG("sliderPopup",!0,ZPI18N.getString("zp.norecfound")))})},returnEmpRowHtml:function(data){var trow="";return $.each(data,function(i,v){trow+='<div class="zp_Lst" erecno="'+v.erecno+'"><div><div class="zp_Lsts">'+VaccinationStatus.showEmployeeData(v)+"</div></div></div>"}),trow},resetSelectedStatusFooter:function(optionId){Layout.Page.container.find("div[optionId]").removeClass("sel"),Layout.Page.container.find("div[optionId='"+optionId+"']").addClass("sel")},showEmployeeData:function(empDtls){return'<img src="'+empDtls.employeePhoto+'" class="FL ZP_photo" data-toggle="tooltip" data-placement="top" data-original-title="" popup="user" empid="'+empDtls.zuid+'"/><div class="ZPusrName" popup="user" empid="'+empDtls.zuid+'"><em>'+empDtls.name+"</em></div>"},constructFilterDiv:function(){var filterArr=[],hasVaccinated=VaccinationStatus.getFCDetails("have_you_been_vaccinated"),params=[];$.each(hasVaccinated.optionArray,function(index,obj){params.push({id:obj.optionId,value:obj.displayValue,sysValue:obj.sysValue})}),filterArr.push({parentDiv:"vfstatusDiv",type:"select",menuProperties:{id:"vstatusList",data:params,checkbox:!0},title:ZPI18N.getString("zp.haveyoubeenvaccinated")});var employeeMenu={id:"vempList",data:function(initObj){return EmployeeDropdown.getEmpList($(initObj).val(),"emp","VACC_EMP",[],{},!0)},checkbox:!0};filterArr.push({parentDiv:"vfempDiv",type:"select",menuProperties:employeeMenu,title:ZPI18N.getString("zp.employee")}),AdvancedFilter.constructFilter(filterArr,VaccinationStatus.getList)},viewStatus:function(employee_id){ZPeople.Request.send("/vaccination/status",{method:"getVaccinationStatus",employeeId:employee_id},function(data){if("success"==data.status)if(CommonTemplates.createEmptyPopupSlider(!1,ZPI18N.getString("zp.vaccinationstatus")),data.list.length>0){var dtls=data.list[0],html='<div class="zp_fm"><label class="nobdr">'+ZPI18N.getString("zp.employee")+'</label><div class="nobdr"><span>'+CommonTemplates.tagHtml(dtls.employeeDtls.zuid,dtls.employeeDtls.name,CommonTemplates.returnImgDiv(dtls.employeeDtls.employeePhoto,dtls.employeeDtls.name))+"</span></div></div>";html+='<div class="zp_fm"><label class="nobdr">'+ZPI18N.getString("zp.haveyoubeenvaccinated")+'</label><div class="nobdr P10"><span>'+dtls.have_you_been_vaccinated+"</span></div></div>",html+='<div class="zp_fm"><label class="nobdr">'+ZPI18N.getString("zp.dateofpartialvaccination")+'</label><div class="nobdr P10"><span>'+dtls.partial_vaccination_date+"</span></div></div>",html+='<div class="zp_fm"><label class="nobdr">'+ZPI18N.getString("zp.dateofvaccination")+'</label><div class="nobdr P10"><span>'+dtls.vaccination_date+"</span></div></div>",html+='<div class="zp_fm"><label class="nobdr">'+ZPI18N.getString("zp.additionalcomments")+'</label><div class="zp_tgExpand nobdr P10"><textarea class="zp_wbg" cols="30" rows="10" disabled="disabled">'+dtls.additional_comments+"</textarea></div></div>";var certVal="";dtls.certificate.length>0&&($.each(dtls.certificate,function(i,v){certVal+=VaccinationStatus.constructFileDiv(dtls.recordId,v.fileId,v.fileUploadId,v.fileName,v.filesize,!1)}),html+='<div class="zp_fm"><label class="nobdr">'+ZPI18N.getString("zp.lms.certificate.Certificates")+'</label></div><div class="zp_Alst clearfix nobdr">'+certVal+"</div>"),CommonTemplates.setSliderBody(html),$("#sliderContent").addClass("services")}else CommonTemplates.setSliderBody(CommonTemplates.noDataSVG("sliderPopup",!0,ZPI18N.getString("zp.norecfound")));else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.internalservererror"))})},getVaccConfigDetails:function(){ZPeople.Request.sendAsyncPost("/widget/getVaccFormConfig",{},function(resultData){resultData.isSuccess&&(ZPeople.EMP_VACC_FORMID=resultData.formId,VaccinationStatus.isEnabled=resultData.isWidgetEnabled,VaccinationStatus.fcDtls=resultData.fcDtls,VaccinationStatus.recordId=resultData.recordId,VaccinationStatus.currentStatus=resultData.currentStatus)})},getOptionArray:function(label){var optn=[];return $.each(VaccinationStatus.fcDtls,function(i,v){if(v.labelName==label)return optn=v.optionArray,!1}),optn},getFCDetails:function(label){var dtls={};return $.each(VaccinationStatus.fcDtls,function(i,v){if(v.labelName==label)return dtls=v,!1}),dtls},POPUP_OUTER_HTML:'<div class="zp-covid-pop in" id="zp_emp_vacc_popup"><div id="zp_emp_vacc_popup_optionDiv" class="zp-covid-popInner"><i class="IC-cls-r" id="zp_emp_vacc_popupClose"></i><h1>'+ZPI18N.getString("zp.thankyouvaccstatus")+'</h1><div class="zp-cvd-fxd">$POPUPBODY$</div><input id="vacc_file" class="zp_dyn" type="file" multiple/><button id="vacc_sbt">'+ZPI18N.getString("zp.submit")+"</button></div></div>",openVaccinationStatusPopup:function(ev,mode){ev.stopPropagation(),ev.preventDefault(),VaccinationStatus.getVaccConfigDetails(),$("#zp_emp_vacc_popup").length<=0&&(this.constructPopupBody(mode),$("#zp_emp_vacc_popup").find("#vacc_sbt").off("click").on("click",function(e){VaccinationStatus.submitVaccinationDetails(VaccinationStatus.recordId)})),$("#zp_emp_vacc_popup").find("#zp_emp_vacc_popupClose").on("click",function(){$("#zp_emp_vacc_popup").remove()}),$("#zp_emp_vacc_popup").addClass("in")},constructPopupBody:function(mode){var hasVaccinated=VaccinationStatus.getFCDetails("have_you_been_vaccinated"),option1='<div class="zp_fm zp_fmFr"><label>'+hasVaccinated.displayName+'</label><div class="">';$.each(hasVaccinated.optionArray,function(index,obj){ZPUtil.Validation.isEmpty(mode)?void 0!=VaccinationStatus.recordId&&"1"==VaccinationStatus.currentStatus?"2"==obj.sysValue&&(option1+='<div name="'+hasVaccinated.labelName+'" sysVal = "'+obj.sysValue+'"><i class="IC-rdo-cir-1"></i><label>'+obj.displayValue+"</label></div>"):obj.sysValue!=VaccinationStatus.currentStatus&&obj.isEnabled&&(option1+='<div name="'+hasVaccinated.labelName+'" sysVal = "'+obj.sysValue+'"><i class="IC-rdo-cir-1"></i><label>'+obj.displayValue+"</label></div>"):obj.isEnabled&&(option1+='<div name="'+hasVaccinated.labelName+'" sysVal = "'+obj.sysValue+'"><i class="IC-rdo-cir-1"></i><label>'+obj.displayValue+"</label></div>")}),option1+="</div></div>";var date_of_partial_vacc=VaccinationStatus.getFCDetails("partial_vaccination_date"),date_of_vacc=VaccinationStatus.getFCDetails("vaccination_date"),option2='<div class="zp_fm" id="'+date_of_partial_vacc.labelName+'"></div>',option2_1='<div class="zp_fm zp_dyn" id="'+date_of_vacc.labelName+'"></div>',showDateValue=!1;"edit"!=mode&&void 0!=VaccinationStatus.recordId?(option2="1"==VaccinationStatus.currentStatus?"":'<div class="zp_fm" id="'+date_of_partial_vacc.labelName+'"></div>',option2_1='<div class="zp_fm '+("1"==VaccinationStatus.currentStatus?"":"zp_dyn")+'" id="'+date_of_vacc.labelName+'"></div>'):void 0!=VaccinationStatus.recordId&&"edit"==mode&&(option2='<div class="zp_fm" id="'+date_of_partial_vacc.labelName+'"></div>',option2_1='<div class="zp_fm" id="'+date_of_vacc.labelName+'"></div>',showDateValue=!0);var desc=VaccinationStatus.getFCDetails("additional_comments"),option3='<div class="zp_fm zp_fmFr" id="'+desc.labelName+'"><label>'+desc.displayName+'</label><div class="nobdr"><textarea id="descinput"></textarea></div></div>',option4='<div class="zp_fm zp_fmFr"><label>'+VaccinationStatus.getFCDetails("certificate").displayName+'</label><div id="vacc_file_div" class="zp_ppFlud"><a onclick="VaccinationStatus.getFileBoxOnUpload(this)">'+ZPI18N.getString("zp.upload")+"</a></div></div>",outerHtml='<div class="zp_formcls">'+option1+option2+option2_1+option3+(option4+='<div class="zp_txt"><div id="vfilesAttach" class="zp_Alst clearfix"></div></div>')+"</div>",html=this.POPUP_OUTER_HTML;if(html=html.replace("$POPUPBODY$",outerHtml),$("body").append(html),$("div[name="+hasVaccinated.labelName+"]").off("click").on("click",function(ev){$("div[name="+hasVaccinated.labelName+"] > i").removeClass("IC-radio2x"),$(this).find("i").addClass("IC-radio2x"),"1"!=$(this).attr("sysval")&&"2"!=$(this).attr("sysval")?($("div[id="+date_of_partial_vacc.labelName+"]").addClass("zp_dyn"),$("div[id="+date_of_vacc.labelName+"]").addClass("zp_dyn")):"1"==$(this).attr("sysval")?($("div[id="+date_of_partial_vacc.labelName+"]").removeClass("zp_dyn"),$("div[id="+date_of_vacc.labelName+"]").addClass("zp_dyn")):("edit"==mode?$("div[id="+date_of_partial_vacc.labelName+"]").removeClass("zp_dyn"):$("div[id="+date_of_partial_vacc.labelName+"]").addClass("zp_dyn"),$("div[id="+date_of_vacc.labelName+"]").removeClass("zp_dyn"))}),$('div[name="'+hasVaccinated.labelName+'"][sysval = "'+VaccinationStatus.currentStatus+'"]').trigger("click"),showDateValue?ZPeople.Request.send("/vaccination/status",{method:"getVaccinationStatus",employeeId:erecno},function(data){var inpObj={id:"datePartVaccinput",placeholder:dateFmt,caltype:"filter",onclick:"Calendar.setUpCalendar(event, this);"};""!=data.list[0].partial_vaccination_date&&(inpObj.value=data.list[0].partial_vaccination_date),CommonTemplates.getInputTextIcon(inpObj,{inputHeaderName:ZPI18N.getString("zp.dateofpartialvaccination")},$("#"+date_of_partial_vacc.labelName)),inpObj.value="",""!=data.list[0].vaccination_date&&(inpObj.value=data.list[0].vaccination_date),inpObj.id="dateVaccinput",CommonTemplates.getInputTextIcon(inpObj,{inputHeaderName:ZPI18N.getString("zp.dateofvaccination")},$("#"+date_of_vacc.labelName))}):(""!=option2&&CommonTemplates.getInputTextIcon({id:"datePartVaccinput",placeholder:dateFmt,caltype:"filter",onclick:"Calendar.setUpCalendar(event, this);"},{inputHeaderName:ZPI18N.getString("zp.dateofvaccination")},$("#"+date_of_partial_vacc.labelName)),""!=option2_1&&CommonTemplates.getInputTextIcon({id:"dateVaccinput",placeholder:dateFmt,caltype:"filter",onclick:"Calendar.setUpCalendar(event, this);"},{inputHeaderName:ZPI18N.getString("zp.dateofvaccination")},$("#"+date_of_vacc.labelName))),void 0!=VaccinationStatus.recordId){mode="getVaccStatusDtls";ZPeople.Request.sendAsyncPost("/widget/"+mode,{},function(resultData){VaccinationStatus.certificate=resultData.certificate,resultData.isSuccess&&$("#descinput").val(ZPeople.decodeTxt(resultData.additional_comments))})}void 0!=VaccinationStatus.certificate&&$.each(VaccinationStatus.certificate,function(i,v){$("#vfilesAttach").append(VaccinationStatus.constructFileDiv(VaccinationStatus.recordId,v.fileId,v.fileUploadId,v.fileName,v.filesize,!0))})},constructFileDiv:function(recordId,filePath,fileId,fileName,filesize,needCloseButton){var fcId=VaccinationStatus.getFCDetails("certificate").fcId,closeButton=needCloseButton?'<i onclick="VaccinationStatus.removeFileBox(event, this)" class="IC-cls"></i>':"",downloadButton=needCloseButton?"":"<i onclick=\"VaccinationStatus.downloadFile(event,'"+filePath+'\')" class="IC-down"></i>',fileExtn=fileName.substring(fileName.lastIndexOf(".")+1),fileIcon=CommonTemplates.getFileIcon(fileExtn);return'<div class="attachedFile filePosts" onclick="'+("VaccinationStatus.viewFile(event,this,'"+fcId+"','"+recordId+"','"+filePath+"','"+fileId+"','"+fileExtn+"')")+'" filepath="'+filePath+'" filename="'+ZPeople.escapeHtml(fileName)+'"> <i class="'+fileIcon+' fileType"></i>'+downloadButton+closeButton+'<div class="fileNameAndSize"><label class="fileName" purpose="fileName">'+fileName+'</label> <span purpose="fileSize">'+filesize+"</span> </div></div>"},viewFile:function(ev,obj,fcId,recordId,filePath,fileId,extn){var imgExtn=["jpg","jpeg","gif","png"],pdfExtn=["pdf","tif"],zohoDocsFileExtn=["xls","xlsx","sxc","ods","csv","tsv","doc","docx","sxw","odt","rtf","ppt","pptx","pps","odp","sxi"],fileParams={fcId:fcId,recordId:recordId,fileId:fileId,formId:ZPeople.EMP_VACC_FORMID,original:"true"};if(-1==zohoDocsFileExtn.indexOf(extn)&&-1==imgExtn.indexOf(extn)&&-1==pdfExtn.indexOf(extn))VaccinationStatus.downloadFile(ev,filePath);else if(-1!=zohoDocsFileExtn.indexOf(extn)||-1!=pdfExtn.indexOf(extn))Layout.Page.pageContWrapper.parent().prepend(Files.constructViewDiv(obj,"Forms",encodeURIComponent(JSON.stringify(fileParams)))),Files.viewFile(obj,"Forms",encodeURIComponent(JSON.stringify(fileParams)));else if(-1!=imgExtn.indexOf(extn)){fileParams={fileId:fileId,recordId:recordId,fileName:unescape($(obj).attr("filename")),fileExtn:extn,filePath:fcId+"z"+filePath,allowDownload:!0,fileConfident:0};Preview.showPreview(fileParams,"Forms"),Layout.Page.container.find(".content-pv").append(ZPeople.LOADING_HTML);var xhr=new XMLHttpRequest,previewData=new FormData;previewData.append("fileUploadId",fileId),previewData.append("fileId",filePath),previewData.append("recordId",recordId),previewData.append("methodName","viewVaccinationCertificate"),previewData.append("conreqcsr",csrfToken),xhr.open("post","/vaccination/certificate/view"),xhr.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var data_url=URL.createObjectURL(this.response);$(".content-pv").find("#zp_page_loading").remove(),$("#imageviewFrame").attr("src",data_url),$("#imageviewFrame").off("load"),$("#imageviewFrame").on("load",function(){Files.imgOrgHeight=$("#imageviewFrame").height(),Preview.imgOrgHeight=$("#imageviewFrame").height()})}else 4==this.readyState&&200!=this.status&&ZPeople.Message.showFailureMsg("Error")},xhr.responseType="blob",xhr.send(previewData)}},downloadFile:function(event,fileId){event.stopPropagation(),event.preventDefault(),Layout.Page.container.find("#dwlvaccFile").remove(),Layout.Page.container.find("#dwlvaccFrame").remove(),Layout.Page.container.append('<form method="post" id="dwlvaccFile" enctype="multipart/form-data" action="/vaccination/certificate/download" target="dwlvaccFrame" novalidate></form>'),Layout.Page.container.append('<iframe  src="" id="dwlvaccFrame" name="dwlvaccFrame" scrolling="auto" style="border: none; margin: 0pt;" frameborder="0" height="10px" width="100%" ></iframe>');var caseForm=Layout.Page.container.find("#dwlvaccFile");caseForm.append('<input type="hidden" name="filePath" value="'+fileId+'">'),caseForm.append('<input type="hidden" name="conreqcsr" value="'+csrfToken+'">'),caseForm.append('<input type="hidden" name="methodName" value="downloadVaccinationCertificate">'),caseForm.trigger("submit"),$(caseForm).find("input[type=hidden]").remove()},getOptionValue:function(sysval){var optionValue="",hasVaccinated=VaccinationStatus.getFCDetails("have_you_been_vaccinated");return $.each(hasVaccinated.optionArray,function(index,obj){if(obj.sysValue==sysval)return optionValue=ZPeople.decodeTxt(obj.optionValue),!1}),optionValue},getDisplayValue:function(sysval){var displayValue="",hasVaccinated=VaccinationStatus.getFCDetails("have_you_been_vaccinated");return $.each(hasVaccinated.optionArray,function(index,obj){if(obj.sysValue==sysval)return displayValue=obj.displayValue,!1}),displayValue},submitVaccinationDetails:function(recordId){var parentId=$("#zp_emp_vacc_popup");parentId.find("#vacc_sbt").attr("disabled","disabled");var params={},have_you_been_vaccinated="",vacc_sys_val="";parentId.find("div[name=have_you_been_vaccinated]").closest("div.zp_fm").hasClass("DN")||parentId.find("div[name=have_you_been_vaccinated]").each(function(){if($(this).find("i").hasClass("IC-radio2x"))return vacc_sys_val=$(this).attr("sysVal"),have_you_been_vaccinated=VaccinationStatus.getOptionValue(vacc_sys_val),!1});var partial_date=$("#datePartVaccinput").length>0&&$("#datePartVaccinput").closest("div.zp_fm").hasClass("zp_dyn")?"":$("#datePartVaccinput").val(),vacc_date=$("#dateVaccinput").length>0&&$("#dateVaccinput").closest("div.zp_fm").hasClass("zp_dyn")?"":$("#dateVaccinput").val(),additional_comments=$("#descinput").val(),certificate="";$("#vfilesAttach").find("div.attachedFile").each(function(i){certificate+=$(this).attr("filepath")+";"}),ZPUtil.Validation.isEmpty(certificate)||(certificate=certificate.slice(0,-1)),""==have_you_been_vaccinated?(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.selectvaccinationstatus")),parentId.find("#vacc_sbt").removeAttr("disabled")):"1"==vacc_sys_val&&ZPUtil.Validation.isEmpty(partial_date)||"2"==vacc_sys_val&&ZPUtil.Validation.isEmpty(vacc_date)?(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.selectdateofvaccination")),parentId.find("#vacc_sbt").removeAttr("disabled")):$("#vfilesAttach").find("div.attachedFile").length>5?(ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.maxfileupload")),parentId.find("#vacc_sbt").removeAttr("disabled")):(params.have_you_been_vaccinated=have_you_been_vaccinated,"2"!=vacc_sys_val&&"1"!=vacc_sys_val?(params.vaccination_date="",params.partial_vaccination_date=""):"1"==vacc_sys_val?(params.vaccination_date="",params.partial_vaccination_date=partial_date):"2"==vacc_sys_val&&($("#datePartVaccinput").length>0&&!$("#datePartVaccinput").hasClass("zp_dyn")&&(params.partial_vaccination_date=partial_date),$("#dateVaccinput").length>0&&!$("#dateVaccinput").hasClass("zp_dyn")&&(params.vaccination_date=vacc_date)),params.additional_comments=additional_comments,ZPUtil.Validation.isEmpty(certificate)||(params.certificate=certificate),params.zp_mode=ZPUtil.Validation.isEmpty(recordId)?"addRecord":"updateRecord",params.zp_tableName="P_VaccinationStatus",params.zp_formId=ZPeople.EMP_VACC_FORMID,params.loginUserZUID=_LOGGEDIN_ZUID,params.conreqcsr=csrfToken,params.isDraft="false",ZPUtil.Validation.isEmpty(recordId)||(params.zp_recordId=recordId),ZPeople.Request.send("/addUpdateRecord.zp",params,function(res){parentId.find("#vacc_sbt").removeAttr("disabled"),-1!=Layout.Page.hash.indexOf("home/dashboard")&&($("#zp_emp_health").remove(),EmployeeHealthData.widgetStatusRefresh(!0));var data=res[0];if(7e3==data.code){if(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.vaccinationdetailssuccess")),$("#zp_emp_vacc_popupClose").trigger("click"),VaccinationStatus.recordId=data.pkId,-1!=Layout.Page.hash.indexOf("/vaccinationstatus/list")){Layout.Page.container.find("div.zp_Lst[erecno="+erecno+"]").find("[name=vaccsts]").html(VaccinationStatus.getDisplayValue(vacc_sys_val));var date=ZPUtil.Validation.isEmpty(params.vaccination_date)?params.partial_vaccination_date:params.vaccination_date;Layout.Page.container.find("div.zp_Lst[erecno="+erecno+"]").find("[name=vaccdate]").html(date),ZPUtil.Validation.isEmpty(recordId)?VaccinationStatus.getList():ZPeople.Request.send("/vaccination/list",VaccinationStatus.CURR_PARAM,function(result){VaccinationStatus.totalCountStatus(result,Layout.Page.container)})}}else{var message=data.message;$.each(message,function(key,value){"vaccination_date"!=key&&"partial_vaccination_date"!=key&&"Form_Error"!=key||ZPeople.Message.showFailureMsg(value)})}}))},getFileBoxOnUpload:function(){var parentDiv=$("#vfilesAttach");$("#vacc_file").trigger("click"),$("#vacc_file").off("change").on("change",function(ev){$(this);var files=$(this)[0].files;$.each(files,function(i){CommonTemplates.getFileBoxProgressOnSelect(files[i],i,function(obj,file){$(parentDiv).append(obj),VaccinationStatus.uploadFileByXHR(files[i],{callback:function(fileInfo){$("#vfilesAttach").find("div[filePos="+i+"]").replaceWith(VaccinationStatus.getFileBoxAfterUpload(fileInfo))},failureCallback:function(uploadedFileInfo){$("#vfilesAttach").find("div[filepos="+i+"]").remove()}})})})})},removeFileBox:function(ev,obj){ev.stopPropagation(),ev.preventDefault(),$(obj).closest("div").remove()},getFileBoxAfterUpload:function(fileInfo){var fileExtn=fileInfo.fileName.substring(fileInfo.fileName.lastIndexOf(".")+1),fileIcon=CommonTemplates.getFileIcon(fileExtn),fileSize=void 0!=fileInfo.fileSize?CommonTemplates.getFileSize(fileInfo.fileSize):"",fileName=fileInfo.fileName;return'<div class="attachedFile filePosts" filepath="'+fileInfo.fileId+'"><i class="'+fileIcon+' fileType"></i><i  onclick="VaccinationStatus.removeFileBox(event,this)" class="IC-cls"></i><div class="fileNameAndSize"><label class="fileName" purpose="fileName">'+ZPeople.escapeHtml(fileName)+'</label><span purpose="fileSize">'+fileSize+"</span></div></div>"},uploadFileByXHR:function(file,obj){if(file.size>maxFileSizeBytes||file.size<=0)ZPeople.Message.showFailureMsg("Invalid file size!");else{var xhr=new XMLHttpRequest,fieldDtls=VaccinationStatus.getFCDetails("certificate"),fcId=fieldDtls.fcId,fieldName=fieldDtls.labelName,uploadId=(new Date).getTime()+"_"+_LOGGEDIN_ZUID+"_"+fcId;xhr.upload.uploadId=uploadId;var udsUploadApi=UPLOAD_URL+"/"+UDS_UPLOAD_SERVICE_CODE+"/ver1/stream/upload";xhr.open("post",udsUploadApi,!0),xhr.setRequestHeader("x-assured-response",!0),void 0!=ZPeople.zaid&&xhr.setRequestHeader("x-cli-zaid",ZPeople.zaid),xhr.setRequestHeader("x-streammode","1");var params={portalId:_LOGGEDIN_ACCZSOID,moduleName:"Forms",fcId:fcId,fieldName:fieldName,formTableName:"P_VaccinationStatus",zaid:ZPeople.zaid};params=JSON.stringify(params),xhr.setRequestHeader("app-info",params),xhr.setRequestHeader("file-info",JSON.stringify({fileName:encodeURIComponent(file.name),contentType:file.type,fileSize:file.size})),xhr.setRequestHeader("upload-id",uploadId),xhr.withCredentials=!0,xhr.onreadystatechange=function(oEvent){if(4==xhr.readyState)if(200===xhr.status){var responseObj=JSON.parse(xhr.response);"function"==typeof obj.callback&&obj.callback(responseObj.fileInfo)}else"function"==typeof obj.failureCallback&&obj.failureCallback()},xhr.send(file)}},deleteVaccinationData:function(id,isAll){var arg={};arg.id=id,arg.isAll=isAll,"vaccTable"==id?ZPeople.confirm(arg,ZPI18N.getString("zp.deleteallpopupheading"),ZPI18N.getString("zp.deleteallpopupbody"),VaccinationStatus.deleteVaccinationDataCall,!1,!0,"",!0):ZPeople.confirm(arg,ZPI18N.getString("zp.deletepopupheading"),ZPI18N.getString("zp.deletepopupbody"),VaccinationStatus.deleteVaccinationDataCall,!1,!0,"",!0)},deleteVaccinationDataCall:function(arg){arg.id;arg.id,ZPeople.Request.send("/vaccination/entry/delete",{method:"deleteVaccEntry",recordId:arg.id,isAll:arg.isAll},function(data){data.isAll?Layout.Page.container.find("#vaccTable").empty():Layout.Page.container.find("#"+arg.id).remove(),VaccinationStatus.totalCountStatus(data,Layout.Page.container),Layout.Page.container.find("#vaccTable").find("div.zp_Lst").length<=0&&(Layout.Page.container.find("div.zp_cinfo").addClass("DN"),Layout.Page.container.find("#vaccTable").addClass("DN"),Layout.Page.container.find("#vPageDiv").append(CommonTemplates.noDataSVG("vPageDiv",!1,ZPI18N.getString("zp.novaccrecfound"),!0,"VaccinationStatus.openVaccinationStatusPopup(event,'');",ZPI18N.getString("zp.addvaccrecord")))),void 0!=EmployeeHealthData&&($("#zp_emp_health").remove(),EmployeeHealthData.widgetStatusRefresh(!0))})},totalCountStatus:function(data,pageId){if(data.hasOwnProperty("totalCount")&&data.totalCount.length>0){$.each(data.totalCount,function(i,v){v.hasOwnProperty("total_vaccinated_emp_count")?Layout.Page.container.find("#vaccst_count").text(v.total_vaccinated_emp_count).closest("div").attr("optionId","0"):v.hasOwnProperty("not_yet_vaccinated_emp_count")?Layout.Page.container.find("#navc_emp_count").text(v.not_yet_vaccinated_emp_count).closest("div").attr("optionId","-1"):Layout.Page.container.find("#vcnt_sysValue_"+v.sysValue).text(v.count).closest("div").attr("optionId",v.optionId)}),Layout.Page.container.find("div[optionId]").off("click").on("click",function(i){VaccinationStatus.CURR_LISTING="vaccList",VaccinationStatus.CURR_INDEX=1,Layout.Page.container.find("div[optionId]").removeClass("sel"),$(this).addClass("sel");var selOptionId=$(this).attr("optionId");if("-1"!=selOptionId&&pageId.find("#filterOption").find("[name=reset]").trigger("click"),"0"!=selOptionId&&"-1"!=selOptionId){var selectedData=[],hasVaccinated=VaccinationStatus.getFCDetails("have_you_been_vaccinated");$.each(hasVaccinated.optionArray,function(index,obj){obj.optionId==selOptionId&&selectedData.push({id:obj.optionId,text:obj.displayValue})});var menuProp={selectedVal:selectedData,checkbox:!0};pageId.find("#vfstatusDiv_input").zpselect(menuProp)}"-1"==selOptionId?(VaccinationStatus.CURR_LISTING="empList",VaccinationStatus.CURR_EMP_INDEX=1,VaccinationStatus.getNonUpdatedList()):setTimeout(function(){pageId.find("#filterOption").find("#aplFltr").trigger("click")},700)})}}};VaccinationStatus.Settings={showPopup:function(){ZPeople.Request.send("/vaccination/status/list",{method:"fetchVaccinationStatusConfig"},function(data){var bodyHtml=$('<div><p class="MT10">'+ZPI18N.getString("zp.statuseditconfirmation")+'</p><p class="inlCbox MT10"></p></div>');$.each(data.statusSettings,function(i,v){var checked="1"==v.settingsValue?'checked = "checked"':"",checkBoxTag=$('<label name="sysValue_'+v.sysValue+'" class="checkbox"><input id="sysValue_'+v.sysValue+'" name="sysValue_'+v.sysValue+'" type="checkbox" '+checked+"/><span>"+v.displayValue+"</span><div></div></label>");checkBoxTag.find("input").off("change").on("change",function(e){var value=$(this).is(":checked")?"1":"0";ZPeople.Request.send("/saveVaccinationStatusConfig.zp",{method:"saveVaccinationStatusConfig",mode:v.sysValue,value:value},function(data){"success"==data?ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.statuslistconfigurationsuccess")):(checkBoxTag.find("input").prop("checked",!value),ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.statuslistconfigurationfailure")))})}),bodyHtml.find("p.inlCbox").append(checkBoxTag)}),CommonTemplates.Popup.showPopup(ZPI18N.getString("zp.statuslistconfiguration"),bodyHtml),$("#cnf_popup").find("div.zp_btn").remove()})}},VaccinationStatus.Export={exportList:function(mode,params,ftype){Layout.Page.container.find("#vaccexportFile").remove(),Layout.Page.container.find("#vaccexportFileFrame").remove(),Layout.Page.container.append('<form method="post" id="vaccexportFile" enctype="multipart/form-data" action="/vaccination/list/export" target="vaccexportFileFrame" novalidate></form>'),Layout.Page.container.append('<iframe  src="" id="vaccexportFileFrame" name="vaccexportFileFrame" scrolling="auto" style="border: none; margin: 0pt;" frameborder="0" height="10px" width="100%" ></iframe>');var employeeId=VaccinationStatus.CURR_SEARCHOBJ.hasOwnProperty("employeeId")&&void 0!=VaccinationStatus.CURR_SEARCHOBJ.employeeId?VaccinationStatus.CURR_SEARCHOBJ.employeeId:"",vaccStatus=VaccinationStatus.CURR_SEARCHOBJ.hasOwnProperty("vaccinationStatus")&&void 0!=VaccinationStatus.CURR_SEARCHOBJ.vaccinationStatus?VaccinationStatus.CURR_SEARCHOBJ.vaccinationStatus:"",expForm=Layout.Page.container.find("#vaccexportFile");expForm.append('<input type="hidden" name="employeeId" value="'+employeeId+'">'),expForm.append('<input type="hidden" name="vaccinationStatus" value="'+vaccStatus+'">'),expForm.append('<input type="hidden" name="fType" value="'+ftype+'">'),expForm.append('<input type="hidden" name="conreqcsr" value="'+csrfToken+'">'),expForm.append('<input type="hidden" name="method" value="exportVaccinationList">'),expForm.trigger("submit"),$(expForm).find("input[type=hidden]").remove()}};var Preview={imgOrgHeight:800,constructInfoList:function(data){var row="<em>",array=data.toString().split(",");for(var i in array)row+="<strong>"+array[i]+"</strong>";return row+="</em>"},constructHeaderFooterForPreview:function(data,mode){var fileId,filePath,allowDownload,viewFileDiv="";if(fileId=data.fileId,filePath=data.filePath,allowDownload=data.allowDownload,allowPrint=data.allowPrint,void 0!=data.aggId&&data.aggId,void 0!=data.fileType&&"4"==data.fileType&&-1==data.filePath.indexOf("Document")&&(mode="HRFormTemp"),viewFileDiv+="<div class='content-box cbmodal' id='viewPreviewFileDiv' style='display:block;'>",viewFileDiv+="<div class='content-header'>",viewFileDiv+="<h6 class='addPopTitle'id='viewfileHeader'>"+data.fileName+"</h6>",viewFileDiv+="<button aria-label='Close' data-dismiss='modal' class='close' type='button' onclick='Preview.closeDiv()'><span aria-hidden='true'><div class='IC-cls S18 CP'></div></span></button></div>",viewFileDiv+="<div id='preview_body' class='content-body'></div>",viewFileDiv+="<div id='preview_footer' class='content-footer'>","files"===mode)if(null!==data.isFeeds&&void 0!==data.isFeeds&&1==data.isFeeds){var extraProps={};extraProps.isFromFeeds=data.isFeeds,extraProps.isUserSharedNodeCheck=data.isUserSharedNodeCheck,extraProps.isEmpFileAck=data.isEmpFileAck,extraProps.isLoginUserAck=data.isLoginUserAck,viewFileDiv+=Files.Reports.acknowledgementStatus(fileId,data.fileAcknowledge,data.fileOwner,data.isEmpFileAck,data.isLoginUserAck,!0,void 0,extraProps)}else viewFileDiv+=Files.Reports.acknowledgementStatus(fileId,data.fileAcknowledge,data.fileOwner,data.isEmpFileAck,data.isLoginUserAck,!0);if(viewFileDiv+="<div id='moreActions' class='actions'>","hrdocPdf"==mode&&(viewFileDiv+='<a href="javascript:;" onclick=Files.showEdithrdocuments("edit",this,"uploadmode",\''+fileId+'\') class="zp_atOfbt FL" >'+ZPI18N.getString("zp.addtocompfiles",new Array(Files.compdisname))+"</a>"),viewFileDiv+="<div class='dropdown FL PR ZPCusDrs ZPPdrop cust-dm'><span class='CP dropdown-toggle upload' data-toggle='dropdown' aria-expanded='false'>",null!==data.info&&void 0!==data.info&&(viewFileDiv+="<i class='CR-info S12 ML5'></i>"),viewFileDiv+="</span><div class='dropdown-menu ZPCmn-Arrow bottom gray TBDD'>","Onboarding"!=mode){var infoDiv="",info=data.info;if(void 0!=info&&Object.keys(info).length>0){for(var infoKeys=Object.keys(info),i=0;i<=infoKeys.length-1;i++){var key=infoKeys[i],value=info[key];if(Array.isArray(value))infoDiv+="<li><span>"+key+"</span>"+Preview.constructInfoList(value)+"</li>";else key==ZPI18N.getString("zp.description")?infoDiv+="<li><span>"+key+"</span><em class='flWd'>"+value+"</em></li>":infoDiv+="<li><span>"+key+"</span><em>"+value+"</em></li>"}viewFileDiv+="<ul>"+infoDiv+"</ul>"}}if(viewFileDiv+="</div></div>","ESign"==mode&&(viewFileDiv+='<i class="CR-imprt" onclick=Agreements.downloadAttachement(this,"'+fileId+'","download","'+encodeURIComponent(data.fileName)+'","'+encodeURIComponent(data.filePath)+'")></i>'),!0===allowDownload&&!0===allowPrint)if("Forms"===mode)viewFileDiv+='<i class="CR-imprt" onclick="window.open(\''+ZPForm.constructDownloadLink(fileParams)+"');\"></i>",viewFileDiv+='<i id="filePrint" class="IC-print" onclick="Files.printFile()"></i>';else if("HRCase"===mode)viewFileDiv+='<i class="CR-imprt" onclick="casesFiles.getFileDownload(event,\''+data.fileId+"','"+data.recordId+"','"+data.fType+"',"+data.hasOwnProperty("previewFileId")+')"></i>';else if("revisionletter"===mode)viewFileDiv+=`<i class="CR-imprt" onclick="Compensation.RevisionLetters.download('${data.recordId}');"></i>`;else{viewFileDiv+=Layout.Page.hash.indexOf("#files/hrdocuments/listview")>-1&&"5"==data.fileType?'<i class="CR-imprt" onclick=Files.downloadCompHandbook("'+fileId+'")></i>':"HRFormTemp"==mode?'<i class="CR-imprt" onclick=Files.downloadCompHandbook("'+fileId+'")></i>':'<i class="CR-imprt" onclick=Files.downloadFilecabinet(\'html\',"'+fileId+'","'+encodeURIComponent(filePath)+'","'+encodeURIComponent(data.fileName)+'")></i>',"hrdocPdf"!=mode&&(viewFileDiv+='<i id="filePrint" class="IC-print" onclick="Files.printFile()"></i>')}viewFileDiv+="</div></div>",$("#page-wrapper").append(viewFileDiv)},showPreview:function(data,mode){var fileExtn=data.filePath;if(void 0!=fileExtn&&-1!=fileExtn.lastIndexOf(".")&&(fileExtn=(fileExtn=fileExtn.substr(fileExtn.lastIndexOf(".")+1,fileExtn.length)).toLowerCase()),null!=data.filePath&&void 0!=data.filePath&&-1==data.filePath.indexOf("/")&&-1==data.filePath.indexOf("\\")&&(fileExtn=data.fileExtn),Preview.constructHeaderFooterForPreview(data,mode),"jpg"===fileExtn||"jpeg"===fileExtn||"gif"===fileExtn||"png"===fileExtn||"gif"===fileExtn){var constructBody="<div class='content-pv' style='max-height: 610px; max-width: 1265px; color: #fff;'>";constructBody+="<img src='' id='imageviewFrame' name='imageviewFrame' scrolling='auto' style='position:relative;max-height: 610px; max-width: 1265px;'/>",$("#preview_body").html(constructBody);var footer="<div class='cf-zoom'>";footer+="<span><i class='IC-mins'></i><em class='DB'>0%</em></span>",footer+="<div><input  id='zoomRange' class='inputRange' type='range' min='0' max='200' value='0' oninput=Preview.zoomFile()><em id='zoomval' class='DB'>0%</em></div>",footer+="<span><i class='IC-plus-big'></i><em class='DB'>200%</em></span></div>",$("#preview_footer").prepend(footer),$("#moreActions").prepend('<i id="magnify_files" class="CR-magnifier" onclick="Preview.magnifyFileView()"></i>')}else{constructBody="<iframe  src='' id='viewFileFrame' name='viewFileFrame' scrolling='auto' style='border: none; margin: 0pt;' frameborder='0' height='0' scrolling='no' width='100%' ></iframe>";$("#preview_body").html(constructBody)}},closeDiv:function(isEsc,event){$("#viewPreviewFileDiv").remove(),$("#wrapper").removeClass("ZPMprw")},magnifyFileView:function(){var img,glass,zoom=Number("2"),bw=3;if(document.getElementById("magnify_files").classList.toggle("sel"),"CR-magnifier sel"==$("#magnify_files").attr("class")){function hideMagnifier(){glass.style.display="none"}function showMagnifier(e){glass.style.display="block";var pos,x,y,w=glass.offsetWidth/2,h=glass.offsetHeight/2;e.preventDefault(),pos=function(e){var a,x=0,y=0;return e=e||window.event,a=img.getBoundingClientRect(),x=e.pageX-a.left,y=e.pageY-a.top,x-=window.pageXOffset,y-=window.pageYOffset,{x:x,y:y}}(e),x=pos.x,y=pos.y,glass.style.left=x-w+"px",glass.style.top=y-h+"px";img.getBoundingClientRect().left,img.getBoundingClientRect().top;var tempXPos=0;tempXPos=-(x*zoom-w+bw)<=0?-(x*zoom-w+bw):w-(x*zoom-bw);var tempYPos=0;tempYPos=-(y*zoom-h+bw)<=0?-(y*zoom-h+bw):h-(y*zoom-bw),glass.style.backgroundPosition=tempXPos+"px "+tempYPos+"px"}0==$("#page-wrapper").find("#viewFileDiv").find("#magnifyFiles").length&&(img=document.getElementById("imageviewFrame"),(glass=document.createElement("DIV")).setAttribute("id","magnifyFiles"),glass.setAttribute("class","files-magnifier-glass"),img.parentElement.insertBefore(glass,img),glass.style.backgroundImage="url('"+img.src+"')",glass.style.backgroundRepeat="no-repeat",glass.style.backgroundSize=img.width*zoom+"px "+img.height*zoom+"px",glass.addEventListener("mousemove",showMagnifier),img.addEventListener("mousemove",showMagnifier),glass.addEventListener("mouseout",hideMagnifier),img.addEventListener("mouseout",hideMagnifier))}else $("#page-wrapper").find("#viewFileDiv").find("#magnifyFiles").remove()},zoomFile:function(){$("#page-wrapper").find("#viewFileDiv").find("#magnifyFiles").remove(),$("#magnify_files").removeClass("sel");var zoomVal=parseInt($("#zoomRange").val()),val=($("#zoomRange").val()-$("#zoomRange").attr("min"))/($("#zoomRange").attr("max")-$("#zoomRange").attr("min"));Layout.Page.container.find("#zoomRange").css("background-image","-webkit-gradient(linear, left top, right top, color-stop("+val+", #ffffff), color-stop("+val+", #787878))"),$("#zoomval").text(zoomVal+"%");var imgOrigHeight=parseInt(Preview.imgOrgHeight)+parseInt(zoomVal),imgmaxheight=parseInt(610)+parseInt(zoomVal),imgmaxwidth=parseInt(1265)+parseInt(zoomVal);0!=zoomVal?($("#imageviewFrame").css("max-height",imgmaxheight+"px"),$("#imageviewFrame").css("max-width",imgmaxwidth+"px"),$("#imageviewFrame").height(imgOrigHeight+"px"),$("#imageviewFrame").width("auto")):($("#imageviewFrame").css("max-height","610px"),$("#imageviewFrame").css("max-width","1465px"),$("#imageviewFrame").height(imgOrigHeight+"px"),$("#imageviewFrame").width("auto"))}};