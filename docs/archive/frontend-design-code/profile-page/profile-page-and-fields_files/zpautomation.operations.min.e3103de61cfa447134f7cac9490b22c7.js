ApprovalList={APPROVE_RECIDS:new Array,TOTAL_RECS:Number(0),APPROVAL_FORMLIST:[],viewApprTimeline:!1,getActiveTabName:function(){let mode="";return-1!=Layout.Page.currentmode.indexOf("operations/approvals/allapproval")?mode="allapproval":-1!=Layout.Page.currentmode.indexOf("operations/approvals/myrequest")?mode="myrequest":-1!=Layout.Page.currentmode.indexOf("myspace")?mode="myspace":Layout.Page.currentmode.includes("home/team/approvals")&&(mode="team"),mode},getHeaderHtml:function(activeTab){return'<div class="zpl_btnmnu"><div class="zpl_rgt"><i class="zpl_ibg PI_fltr" id=approvalsFilter title="'+ZPI18N.getString("zp.filter")+'" onclick="ApprovalList.Filter.showHideFilter(\''+activeTab+'\')" aria-label="Filter" role="button" aria-haspopup="dialog" tabindex="0"></i></div></div><div class="zpl_fltrvw zpl_DNI" id="filterResultsHeader"><div id="filterResults"><ul class="zpl_fltrvwlst" role="tablist"></ul></div><div class="d-flexcap MLauto zpl_DNI"><a id="resetFilter" onclick="ApprovalList.Filter.resetFilterResult()" role="button" tabindex="0" aria-label="'+ZPI18N.getString("zp.reset")+'">'+ZPI18N.getString("zp.reset")+'</a></div></div><div class="zpl_rgtcnt" tabindex="0"><div id="'+activeTab+'_page_content" class="zpl_msplst"></div></div>'},getTableHtml:function(activeTab){return'<div class="zpl_tblres"><table class="zpl_tbl"><thead id="'+activeTab+'_thead"><tr>'+("allapproval"==activeTab||"team"==activeTab?'<th class="" width="3%"><div class="zcheckbox"><input id="zp_allapproval_check" class="" onclick="ApprovalList.selectUnselectCheck(this, \'all\')" type="checkbox"><span></span></div></th>':"")+'<th class="" width="65%">'+ZPI18N.getString("zp.message")+'</th><th class="" width="16%">'+ZPI18N.getString("zp.requestedon")+'</th><th class="" width="16%">'+ZPI18N.getString("zp.status")+'</th></tr></thead><tbody id="'+activeTab+'_tbody"></tbody></table></div>'},initApprovalPage:function(){var pageId=Layout.Page.container;pageId.addClass("zpl_tblfxd"),pageId.attr("scroll","enabled"),pageId.append(ApprovalList.getHeaderHtml(ApprovalList.getActiveTabName()))},approvalFireScrollAction:function(){var fireScrollProp=ZPeople.FireScroll.getFireScrollPropertie(),params=fireScrollProp.curParams;fireScrollProp.isFromWidget?(params.src="widget",params.sIndex=Layout.Page.container.find("#PENDING_APPROVALS").children("li").length+1):params.sIndex=fireScrollProp.count+1,ZPeople.Request.send("/approvalAction.zp",params,fireScrollProp.isFromWidget?ZPDashboard.Widget.constructApprDashBoardRow:ApprovalList.approvalFireScrollCallback)},approvalFireScrollCallback:function(resultData,params){if(7e3===resultData.code){ApprovalList.constructApprovalDataRow(resultData,params);var rowCount=resultData.message.length;21===rowCount&&(ZPeople.FireScroll.reset(),rowCount-=1),ZPeople.FireScroll.increaseRecordCount(rowCount)}},setFireScollCount:function(result,params,isFromWidget){var rowCount=result.message.length;21==rowCount&&(ZPeople.FireScroll.reset(),rowCount-=1),ZPeople.FireScroll.setRecordCount(rowCount),ZPeople.FireScroll.setParam("curParams",params),ZPeople.FireScroll.setParam("isFromWidget",isFromWidget)},viewRequestedForm:function(obj,viewApprTimeline){let $obj=$(obj).closest("[name=approval_card]"),formId=$obj.attr("formId"),recordId=$obj.attr("id"),tableName=$obj.attr("tableName");ApprovalList.viewApprTimeline=viewApprTimeline,ApprovalList.setReqFormUrl(formId,recordId,tableName)},addClickEvent:function(apprRecDiv){"myspace"==this.getActiveTabName()?($(apprRecDiv).find(".zpl_msp-dts").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault();let transferId=this.parentElement.getAttribute("id");if("true"===this.parentElement.getAttribute("isPhotoTransfer"))ProfilePictureTransfer.photoTransferModel(transferId);else{let $this=$(this).closest("[name=approval_card]");ApprovalList.loadApprovalRecord($this.attr("formId"),$this.attr("id"),$this.attr("tableName"))}}),$(apprRecDiv).find("#zp_approval_approvereject button").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),ApprovalList.MySpace.showPopup(this,!1)})):($(apprRecDiv).find(".zpl_msp-dts").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault();let transferId=this.parentElement.getAttribute("id");"true"===this.parentElement.getAttribute("isPhotoTransfer")?ProfilePictureTransfer.photoTransferModel(transferId):ApprovalList.viewRequestedForm(this)}),$(apprRecDiv).find("[id=zp_approval_approvereject]").off("click").on("click",function(e){let obj=$(this).closest("[name=approval_card]"),transferId=obj.attr("id");"true"===obj.attr("isPhotoTransfer")?ZPeople.Request.sendRequest("/v5/profilepicture/approvalStatusDetails",{recordId:transferId},"GET",ProfilePictureTransfer.getApprovalDetails,{},FrameworkCommon.failureCallback):(e.stopPropagation(),e.preventDefault(),ApprovalList.viewRequestedForm(this,!0))}))},approvalAction:function(){void 0==Layout.Page.urlparam.formId&&void 0==Layout.Page.urlparam.formLinkName||void 0==Layout.Page.urlparam.recordId?ApprovalList.getApprovalOrRequestList():void 0!=settingsUrlProps.urlParamsArr.formLinkName?ApprovalList.viewApprovalPopup(settingsUrlProps.urlParamsArr.formLinkName,settingsUrlProps.urlParamsArr.recordId,!0):ApprovalList.viewApprovalPopup(settingsUrlProps.urlParamsArr.formId,settingsUrlProps.urlParamsArr.recordId,!1)},getApprovalsCallback:function(result,params,pageId){if(0===ApprovalList.APPROVAL_FORMLIST.length&&"myspace"!=ApprovalList.getActiveTabName()){pageId.find("zpl_iwrpr").attr("tabindex","0"),pageId.find("zpl_iwrpr").attr("aria-label",ZPI18N.getString("zp.common.tabname",[ZPI18N.getString("zp.approvals")]));var formList=[];formList.push({id:"-1",value:ZPI18N.getString("zp.allforms"),isDefaultValue:!0}),$.each(result.formList,function(index,data){formList.push({id:data.formId,value:decodeHTML(data.dispName)})}),ApprovalList.APPROVAL_FORMLIST=formList}var activeTab=ApprovalList.getActiveTabName();if("myspace"==activeTab?pageId.siblings("#zp_page_loading").remove():pageId.closest(".zpl_act").find("#zp_page_loading").remove(),7024===result.code){var emptyPageObj=new EmptyPages("zp_nd_approval","myspace"==activeTab?ZPI18N.getString("zp.noapprovalreq"):ZPI18N.getString("zp.noallapprovalreq"),"",pageId);Layout.Page.container.find(".zpl_rgtcnt").attr("aria-label","myspace"==activeTab?ZPI18N.getString("zp.noapprovalreq"):ZPI18N.getString("zp.noallapprovalreq")),emptyPageObj.show(),ZPeople.FireScroll.setRecordCount(0),ZPeople.FireScroll.setParam("curParams",params)}else 7e3===result.code&&(Layout.Page.container.find("#myspace_page_content").empty(),pageId.append(this.getApprovalHeaderHtml()),Layout.Page.container.find(".zpl_rgtcnt").attr("aria-label",ZPI18N.getString("zp.proceedtoappr")),this.constructApprovalDataRow(result,params,pageId),ApprovalList.setFireScollCount(result,params,!1))},getApprovalOrRequestList:function(callBackData){let activeTab=ApprovalList.getActiveTabName(),pageId=Layout.Page.container;0==pageId.find("#"+activeTab+"_page_content").length&&pageId.append('<div id="'+activeTab+'_page_content" class="zpl_msplst"></div>'),pageId=pageId.find("#"+activeTab+"_page_content");var params={};Layout.Page.container.find("#myspace_page_content").empty();var loadingContainer="myspace"==activeTab?pageId.parent():pageId.parents(":eq(1)");0===Layout.Page.container.find("#zp_page_loading").length&&loadingContainer.append(ZPeople.LOADING_HTML),params.action="myApprovals";var approverFilterValue=ApprovalList.Filter.getFilterValue(activeTab+"_apprLst_appr_fltr");void 0!=approverFilterValue&&""!=approverFilterValue&&-1!=approverFilterValue&&(params.empErecNo=ApprovalList.Filter.getFilterValue(activeTab+"_apprLst_appr_fltr"));var myApprovalsRecordOwner=ApprovalList.Filter.getFilterValue(activeTab+"_apprLst_recownr_fltr");myApprovalsRecordOwner&&"0"!=myApprovalsRecordOwner?params.myApprRecOwner=myApprovalsRecordOwner:params.empStatus=ApprovalList.Filter.getFilterValue(activeTab+"_apprLst_empstatus_fltr"),params.mode="viewApprovals",params.approvalForm=ApprovalList.Filter.getFilterValue(activeTab+"_apprLst_forms_fltr"),params.approvalStatus=ApprovalList.Filter.getFilterValue(activeTab+"_apprLst_status_fltr"),ApprovalList.Filter.showFilterResult(params),ZPeople.Request.send("/approvalAction.zp",params,function(result){ApprovalList.getApprovalsCallback(result,params,pageId),Layout.Page.container.find("#zp_page_loading").remove(),callBackData&&(callBackData.error||callBackData.errorMsg)&&ApprovalList.constructErrorMsgInfo(callBackData,void 0,!0)}),-1!==Layout.Page.hash.indexOf("home/myspace/overview-approval")&&ApprovalHome.getPendingCount()},viewApprovalPopup:function(formId,recordId,isFormLinkName,mode){mode=void 0!=mode?mode:settingsUrlProps.urlParamsArr.mode,isFormLinkName&&(formId=ZPUtil.Form_Link_Names.getFormLinkName(formId,!1)),void 0!=mode&&"Timesheet"===mode?Layout.PageUtil.loadFiles(["timely.1.min.js"],()=>Timetracker.timesheet.getTimesheetDetails(formId,recordId,!0,ApprovalList.closePopCallback)):void 0!=mode&&"TimesheetBudget"===mode?Timetracker.Budget.getTimeLogsOfBudget(recordId,ApprovalList.closePopCallback):void 0!=mode&&"Attendance"===mode?Layout.PageUtil.loadFiles(["regularization.min.js","timely.1.min.js"],()=>{regularization_operation.getAttendanceRegDetails(formId,recordId,ApprovalList.closePopCallback)}):void 0!=mode&&"AttendancePermissions"===mode?Layout.PageUtil.loadFiles(["permission.min.js","timely.1.min.js"],()=>{permission.getPermissionApprovalDetails(formId,recordId,ApprovalList.closePopCallback)}):void 0!=mode&&"Shift"===mode?Layout.PageUtil.loadFiles(["shiftRequest.min.js","empShiftMapping.min.js","timely.1.min.js"],()=>{shiftRequest.getAttendanceShiftDetails(formId,recordId,ApprovalList.closePopCallback)}):void 0!=mode&&"AutoAssignShift"===mode?Layout.PageUtil.loadFiles(["autoassignshiftRequest.min.js","empShiftMapping.min.js","timely.1.min.js"],()=>{AutoAssignShiftRequest.getAttendanceShiftDetails(formId,recordId,ApprovalList.closePopCallback)}):void 0!=mode&&"AttendanceOD"===mode?Layout.PageUtil.loadFiles(["onduty.min.js","timely.1.min.js"],()=>{onduty.getAttendanceODDetails(formId,recordId,ApprovalList.closePopCallback)}):void 0!=mode&&"Goal"===mode?Layout.PageUtil.loadFiles(["pms.util.min.js","pms.commonMod.min.js"],()=>Goals.Approval.initGoalSheetApproval(recordId,ApprovalList.closePopCallback)):void 0!=mode&&"Review"===mode?Layout.PageUtil.loadFiles(["pms.util.min.js","pms.commonMod.min.js"],()=>ApprReview.Approval.constructReviewApprovalSheet(recordId,ApprovalList.closePopCallback)):void 0!=mode&&"Rater"===mode?Layout.PageUtil.loadFiles(["pms.util.min.js","pms.commonMod.min.js"],()=>MR.Approval.showApprovalEntriesModal("approval",recordId,ApprovalList.closePopCallback)):void 0!=mode&&"objective"===mode?Layout.PageUtil.loadFiles(["okr.com.min.js"],()=>OKRApproval.openObjectiveApproval(recordId)):void 0!=mode&&"keyResultCheckIn"===mode?Layout.PageUtil.loadFiles(["okr.com.min.js"],()=>OKRApproval.openCheckInApproval(recordId)):void 0!=mode&&"ObjectiveAlign"===mode?Layout.PageUtil.loadFiles(["okr.com.min.js"],()=>OKRApproval.openObjectiveAlignApproval(recordId)):void 0!=mode&&"Compensatory"===mode?LeaveCompensatory.RecordView.get(recordId):mode&&"LeaveGrant"===mode?LeaveGrant.RecordView.get(recordId):void 0!=mode&&"Reviewsheet"===mode?Layout.PageUtil.loadFiles(["pms.util.min.js","pms.commonMod.min.js"],()=>BudgetReviewSheet.showReviewSheetApprovalPage("approval",recordId,ApprovalList.closePopCallback)):void 0!=mode&&mode===Compensation.CONSTANTS.SALARY_REVISION_PC_NAME?Layout.PageUtil.loadFiles(["compensation.common.min.js"],()=>{Compensation.SalRevision.Operations.showSalRevisionRecord(recordId,formId,ApprovalList.closePopCallback)}):void 0!=mode&&"TransferV2"===mode?Layout.PageUtil.loadFiles(["transfer.configuration.min.js"],()=>ZP5Views.transferV2SingleRecordCallBack(recordId)):void 0!=mode&&"Offboarding"===mode?Layout.PageUtil.loadFiles(["offboarding_common.min.js","offboarding_operations.min.js","offboarding_feedback.min.js"],()=>{Offboarding.View.loadApprovalRecord(recordId)}):OPApprovals.Forms.loadRecordByMode(formId,recordId,"VIEW",mode)},showBulkForwardButton:function(){return"allapproval"===this.getActiveTabName()||"team"===this.getActiveTabName()},isCheckBoxNeedToDisable:function(tableName,isCheckboxDisabled){return isCheckboxDisabled||["P_Resignation"].includes(tableName)},getApprovalHeaderHtml:function(){return'<div id="zp_approval_header" class="zpl_msp-hgroup zpl_DNI"><div class="zpl_btnmnu zpl_mspbtnmnu"><div>'+this.getCheckboxHtml("all")+'<button class="zlabel zlabel--blue zlabel--outline zlabel--medium DN" approvalType=1 onclick="ApprovalList.MySpace.showPopup(this, true)" data-popup-open="AllApprovalPop">Approve</button><button class="zlabel zlabel--red zlabel--medium zlabel--outline M0I DN" approvalType=0 onclick="ApprovalList.MySpace.showPopup(this, true)">Reject</button>'+(this.showBulkForwardButton()?'<button class="zlabel zlabel--outline zlabel--medium DN" approvalType=2 onclick="ApprovalList.Forward.showPopup(this, true)" data-popup-open="AllApprovalPop">'+ZPI18N.getString("zp.forward")+"</button>":"")+"</div></div></div>"},getCheckboxHtml:function(recId,isCheckboxDisabled){return'<div id="zp_approval_check_div" class="zcheckbox '+(isCheckboxDisabled?"disabled":"")+'" onclick="ApprovalList.selectUnselectCheck(this,\''+recId+'\')" tabindex="0" role="button"><input id="zp_approval_check" type="checkbox" name="check" value="" class="zcheckbox__helper"><label class="zcheckbox__label"></label></div>'},getApprReqDtlHtml:function(empPhotoUrl,empId,recordOwner,formName,reqMsg,recordOwnerZuid){return'<div class="zpl_msp-dts CP"><div><div class="zpl_em"><div class="zpl_emimg" popup="user" empid='+recordOwnerZuid+'><img alt="" src="'+empPhotoUrl+'"></div><div class="zpl_emdts zpl_ellipsis"><div><em>'+ZSEC.Encoder.encodeForHTML(empId)+" - </em><b>"+recordOwner+"</b></div><div><em>"+reqMsg+" </em><b>"+formName+"</b></div></div></div></div></div>"},getRaisedOnHtml:function(requestedOn){return'<div><div class="zpl_compoffar"><em>'+ZPI18N.getString("zp.raisedon")+'</em><div class="d-flexclmcap10"><div><b>'+requestedOn+"</b></div></div></div></div>"},getStatusTypeHtml:function(statusTypeText,btnClass,isNotButton){return'<div id="zp_approval_actiondiv" class="zpl_msp-act"><div id="zp_approval_approvereject" class="'+`${isNotButton?"zpl_compoffar":"zpl_hvr"}`+'">'+(isNotButton?statusTypeText:'<button tabindex="0"  aria-haspopup="dialog" class="zlabel zlabel--blue zlabel--medium zlabel--outline '+btnClass+'">'+statusTypeText+"</button>")+"</div></div>"},constructApprovalDataRow:function(result,params,pageId){let approvalCards="",pendingRecordCount=ApprovalList.TOTAL_RECS,activeTab=ApprovalList.getActiveTabName(),mySpace="myspace"==activeTab,allApproval="allapproval"==activeTab,team="team"==activeTab;pageId=void 0!=pageId?pageId:Layout.Page.container.find("#"+activeTab+"_page_content");var resultDataLength=result.message.length;21==resultDataLength&&(resultDataLength-=1);for(let index=0;index<resultDataLength;index++){let data=result.message[index],recId=data.recordId,approvalAction=data.approvalAction,isPrimaryAppr=data.isPrimaryAppr,recordOwnerName=ZPeople.CURR_USER.usererec===data.recordOwnerErecno?ZPeople.CURR_USER.name:data.recordOwnerName,isCheckboxDisabled=!0,isNotButton=!0,statusTypeHtml="",btnText="",btnClass="",reqMsg="";if(data.approvalStatus===zpconst.ApprovalStatus.Pending||data.approvalStatus===zpconst.ApprovalStatus.CancellationPending)(mySpace||allApproval||team)&&(isPrimaryAppr?(btnText=1==approvalAction?ZPI18N.getString("zp.extenddecline"):ZPI18N.getString("zp.clicktoapprovereject"),btnClass=data.recordImmutable?"disabled":"",isCheckboxDisabled=!1,isNotButton=!1,pendingRecordCount+=1):(isadmin&&(isCheckboxDisabled=!1,pendingRecordCount+=1),btnText=1==approvalAction?'<span class="org">'+ZPI18N.getString("zp.cancellationpending"):ZPI18N.getString("zp.pendingmessage")),statusTypeHtml=mySpace?ApprovalList.MySpace.getApprRejBtnHtml():ApprovalList.getStatusTypeHtml(btnText,btnClass,isNotButton));else if(1===data.approvalStatus||3===data.approvalStatus){let[date,...timeParts]=data.approveRejectTime.split(" "),time=timeParts.join(" "),approvedMsg=`<span class="grn">${ZPI18N.getString("zp.approvedmessage")}</span> <span>${date}, ${time}</span>`;statusTypeHtml=ApprovalList.getStatusTypeHtml(approvedMsg,btnClass,isNotButton)}else if(0===data.approvalStatus){let[date,...timeParts]=data.approveRejectTime.split(" "),time=timeParts.join(" "),rejectedMsg=`<span class="red">${ZPI18N.getString("zp.rejectedmessage")}</span> <span>${date}, ${time}</span>`;statusTypeHtml=ApprovalList.getStatusTypeHtml(rejectedMsg,btnClass,isNotButton)}else data.approvalStatus===zpconst.ApprovalStatus.Cancelled?statusTypeHtml=ApprovalList.getStatusTypeHtml(ZPI18N.getString("zp.approvalmessage",new Array("red",ZPI18N.getString("zp.cancelled"),data.approveRejectTime)),btnClass,isNotButton):data.approvalStatus===zpconst.ApprovalStatus.Revoked&&(statusTypeHtml=ApprovalList.getStatusTypeHtml(ZPI18N.getString("zp.approvalmessage",new Array("blu",ZPI18N.getString("zp.revoked"),data.approveRejectTime)),btnClass,isNotButton));reqMsg=1==data.approvalAction?ZPI18N.getString("zp.hasmadecancelreq"):ZPI18N.getString("zp.hasmadereq"),(mySpace||allApproval||team)&&(checkboxHtml=ApprovalList.getCheckboxHtml(recId,this.isCheckBoxNeedToDisable(data.tableName,isCheckboxDisabled))),data.isPhotoTransfer&&(data.formName=ZPI18N.getString("zp.photochange")),approvalCards+='<div name="approval_card" id="'+recId+'" formId="'+data.formId+'" isPhotoTransfer = '+data.isPhotoTransfer+' formDisplayName="'+data.formName+'" tableName="'+data.tableName+'" status="'+data.approvalStatus+'" recordOwnerErecno="'+data.recordOwnerErecno+'" isPrimaryAppr="'+isPrimaryAppr+'" tabindex="0" role="button" aria-haspopup="dialog" aria-label="'+`${recordOwnerName} ${reqMsg} ${data.formName}. ${ZPI18N.getString("zp.raisedon")} : ${data.requestedOn}`+'">'+checkboxHtml+this.getApprReqDtlHtml(data.employeePhotoUrl,data.recordOwnerEmpId,recordOwnerName,data.formName,reqMsg,data.recordOwnerZUID)+this.getRaisedOnHtml(data.requestedOn)+statusTypeHtml+"</div>"}pageId.append(approvalCards),ApprovalList.addClickEvent(pageId)},selectUnselectCheck:function(Obj,recId){var isSelect=$(Obj).children("#zp_approval_check").prop("checked");if(isSelect?($(Obj).children("#zp_approval_check").prop("checked",!1),isSelect=!1):($(Obj).children("#zp_approval_check").prop("checked",!0),isSelect=!0),"all"===recId)isSelect?Layout.Page.container.find("[name=approval_card]").each(function(){recId=$(this).attr("id"),0===$(this).find("#zp_approval_check").length||$(this).find("#zp_approval_check_div").hasClass("disabled")||($(this).find("#zp_approval_check")[0].checked=!0,isNaN(recId)||ApprovalList.APPROVE_RECIDS.includes(recId)||ApprovalList.APPROVE_RECIDS.push(recId))}):(ApprovalList.APPROVE_RECIDS=new Array,Layout.Page.container.find("[name=approval_card]").find("[id=zp_approval_check]").prop("checked",!1));else if(!isNaN(recId)){if(isSelect)ApprovalList.APPROVE_RECIDS.push(recId);else{var posOfEle=ApprovalList.APPROVE_RECIDS.indexOf(recId);-1!==posOfEle&&ApprovalList.APPROVE_RECIDS.splice(posOfEle,1)}var totalRec=ApprovalList.TOTAL_RECS,selRec=Layout.Page.container.find("[name=approval_card]").find("[type=checkbox]:checked"),headerSel=Layout.Page.container.find("#zp_approval_header").find("#zp_approval_check");totalRec===selRec.length?headerSel[0].checked=!0:headerSel.is(":checked")&&(headerSel[0].checked=!1)}var apprRejHdrBtn=Layout.Page.container.find("#zp_approval_header button");!apprRejHdrBtn.is(":visible")&&ApprovalList.APPROVE_RECIDS.length>0?(apprRejHdrBtn.parents("#zp_approval_header").removeClass("zpl_DNI"),apprRejHdrBtn.fadeIn(200)):apprRejHdrBtn.is(":visible")&&0===ApprovalList.APPROVE_RECIDS.length&&(apprRejHdrBtn.fadeOut(200),apprRejHdrBtn.parents("#zp_approval_header").addClass("zpl_DNI"))},setReqFormUrl:function(formId,recordId,tableName){let mode=ApprovalList.getModeByTableName(tableName),url=Layout.Page.hash.split("-")[0];if(-1!==Layout.Page.hash.indexOf("home/dashboard/approvals")&&void 0!=Layout.Page.urlparam.userId)url+="-userId:"+Layout.Page.urlparam.userId+"/formId:"+formId+"/recordId:"+recordId;else if("Timesheet"==mode||"TimesheetBudget"===mode||"Attendance"==mode||"AttendanceOD"==mode||"AttendancePermissions"==mode||"Leave"==mode||"Compensatory"==mode||"LeaveGrant"==mode||"Goal"==mode||"Rater"==mode||"Reviewsheet"==mode)url+="-formId:"+formId+"/recordId:"+recordId;else{var formlinkname=OPApprovals.Forms.getFormLinkName(formId,!0),formnameString="-formLinkName:";void 0==formlinkname&&(formnameString="-formId:",formlinkname=formId),url+=formnameString+formlinkname+"/recordId:"+recordId}void 0!==mode&&(url+="/mode:"+mode),window.location.href=url},getModeByTableName:function(tableName){let mode;return"P_TimesheetList"===tableName?mode="Timesheet":"P_TimesheetBudget"===tableName?mode="TimesheetBudget":"P_EmployeeLeave"===tableName?mode="Leave":"P_AttendanceReg"===tableName?mode="Attendance":"P_PermissionDetails"===tableName?mode="AttendancePermissions":"P_ShiftMappingForm"===tableName?mode="Shift":"P_AutoShiftAssignForm"===tableName?mode="AutoAssignShift":"P_AttendanceOD"===tableName?mode="AttendanceOD":"P_Compensatory"===tableName?mode="Compensatory":"P_LeaveGrant"===tableName?mode="LeaveGrant":"P_GoalSheet"===tableName?mode="Goal":"P_ReviewApprovalSheet"===tableName?mode="Review":"P_MultiRater_Approval"===tableName?mode="Rater":"P_Budget_Splitup"===tableName?mode="Reviewsheet":tableName===Compensation.CONSTANTS.SALARY_REVISION_TABLE_NAME?mode=Compensation.CONSTANTS.SALARY_REVISION_PC_NAME:"P_EmployeeTransfer"===tableName?mode="TransferV2":"P_Resignation"===tableName?mode="Offboarding":"P_Objectives"===tableName?mode="objective":"P_KeyResult_CheckIn"===tableName?mode="keyResultCheckIn":"P_ObjectiveAlign"===tableName&&(mode="ObjectiveAlign"),mode},loadApprovalRecord:function(formId,recordId,tableName){let mode=ApprovalList.getModeByTableName(tableName);ApprovalList.viewApprovalPopup(formId,recordId,!1,mode)},closePopCallback:function(callBackRecordId,approvalStatus){if("Attendance"===Layout.Page.urlparam.mode||"AttendanceOD"===Layout.Page.urlparam.mode||"AttendancePermissions"===Layout.Page.urlparam.mode||"Goal"==Layout.Page.urlparam.mode||"Rater"==Layout.Page.urlparam.mode||"Review"==Layout.Page.urlparam.mode||"Reviewsheet"==Layout.Page.urlparam.mode||"TimesheetBudget"===Layout.Page.urlparam.mode)"Goal"!=Layout.Page.urlparam.mode&&"Rater"!=Layout.Page.urlparam.mode&&"Review"!=Layout.Page.urlparam.mode&&"Reviewsheet"!=Layout.Page.urlparam.mode||(AppraisalConfig.GOALSHEETAPPROVER=!1),ApprovalList.reloadApprovalContent();else if(0!==Layout.Page.container.find("#zp_approval_rec_"+Layout.Page.urlparam.recordId).length){var recRow=Layout.Page.container.find("#zp_approval_rec_"+Layout.Page.urlparam.recordId),formId=Layout.Page.urlparam.formId;if(void 0==formId&&void 0!=Layout.Page.urlparam.formLinkName&&(formId=ZPUtil.Form_Link_Names.getFormLinkName(Layout.Page.urlparam.formLinkName,!1)),void 0!==Layout.Page.urlparam.mode&&"Timesheet"===Layout.Page.urlparam.mode)void 0!==approvalStatus&&""===approvalStatus?ZPApprovals.removeSingleRec(Layout.Page.urlparam.recordId):void 0!==approvalStatus&&"-1"===approvalStatus?ZPApprovals.reloadApprovalContent():void 0!==approvalStatus&&Layout.Page.container.find("#zp_approval_rec_"+Layout.Page.urlparam.recordId).attr("status")!==approvalStatus&&ZPApprovals.constructApproveOrReject(recRow,approvalStatus,ZPApprovals.TIMESHEET_RECORD_DTL[Layout.Page.urlparam.recordId]);else if(!ZPUtil.Validation.isEmpty(callBackRecordId)&&ZPForm.SINGLE_RECORD_DTL[formId+"_"+callBackRecordId]&&7e3===ZPForm.SINGLE_RECORD_DTL[formId+"_"+callBackRecordId].record.code){var recDetail=ZPForm.SINGLE_RECORD_DTL[formId+"_"+callBackRecordId].record;if(recRow.attr("status")!==recDetail.message.approvalStatus+""||recRow.attr("status")==zpconst.ApprovalStatus.Pending){var apprDetails=recDetail.approvalDetails?recDetail.approvalDetails:ZPApprovals.APPROVAL_DETAILS[callBackRecordId];apprDetails&&ZPApprovals.constructApproveOrReject(recRow,apprDetails.currentApprovalStatus,apprDetails)}}}var url=Layout.Page.hash.split("-")[0];-1!==Layout.Page.hash.indexOf("home/dashboard/approvals")&&void 0!=Layout.Page.urlparam.userId?url+="-userId:"+Layout.Page.urlparam.userId:"#home/dashboard"==Layout.Page.hash?Layout.Page.container.find("#"+ZPDashboard.Widget.List.PAPP).find("li").off("click").on("click",function(){ZPDashboard.Widget.Actions.loadApprovalRecord($(this).attr("formid"),$(this).attr("recordid"),$(this).attr("tablename")),$(this).off("click")}):"myspace"==ApprovalList.getActiveTabName()&&(url=Layout.Page.hash),ZPApprovals.SUCCESS_PKID=void 0,window.location.hash=url,void 0===ApprovalList.APPROVAL_FORMLIST&&ApprovalList.reloadApprovalContent()},reloadApprovalContent:function(){},constructErrorMsgInfo:function(approvalResult,siblingDiv,isBulkApproval){let pageId=Layout.Page.container.find("#"+ApprovalList.getActiveTabName()+"_page_content");if(approvalResult&&(approvalResult.error||approvalResult.errorMsg)){let errors=approvalResult.error;errors&&"string"!=typeof errors&&errors.forEach(function(singleErr){let errCardId=pageId.find("#"+singleErr.recordId);errCardId.find("#error_info").remove(),errCardId.find("div.zcheckbox").addClass("zpl_DNI"),errCardId.addClass("zpl_mspinfo"),errCardId.prepend('<div id="error_info" class="PI_info red tooltip-js M0I" data-title-display-type="box" data-position="top" title="'+singleErr.errorMsg+'"></div>')}),ZPeople.Message.failure(approvalResult.errorMsg)}},showErrorMsg:function($divToAppend,errorMsg){$('<span class="ztextbox--error__label">'+errorMsg+"</span>").insertAfter($divToAppend),$divToAppend.addClass("ztextbox__error")},removeErrorMsg:function($divToRemove){$divToRemove.find(".ztextbox--error__label").remove(),$divToRemove.find(".ztextbox__error").removeClass("ztextbox__error")},resetApprovalPage:function(){Layout.Page.container.find("#"+ApprovalList.getActiveTabName()+"_page_content").empty(),ApprovalList.getApprovalOrRequestList(),ApprovalList.APPROVE_RECIDS=[]}},ApprovalList.Filter={getFilterHtml:function(activeTab){return`<div class="zpl_fltr" id="apprLst_fltr_cont" tabindex="0" role="dialog" aria-label="${ZPI18N.getString("zp.filterpopupselected")}">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<div class="zpl_fltrhd">\n\t\t\t\t\t\t\t\t\t\t\t<h5>`+ZPI18N.getString("zp.filter")+'</h5>\n\t\t\t\t\t\t\t\t\t\t\t\t<i class="PI_cls" id="fltr_cls" onclick="ApprovalList.Filter.showHideFilter(\''+activeTab+'\')"  title="'+ZPI18N.getString("zp.close")+`" tabindex="0" aria-label="${ZPI18N.getString("zp.close")}"></i>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="zpl_fltrcnt">\n\t\t\t\t\t\t\t\t\t\t<div class="zpl_fltrlst"> \n\t\t\t\t\t\t\t\t\t\t${isadmin?`<div class="zpl_secn">\n\t\t\t\t\t\t\t\t\t\t\t\t<div tabindex="0" aria-label="${ZPI18N.getString("zp.approver")}">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label>${ZPI18N.getString("zp.approver")}</label>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<select id="${activeTab}_apprLst_appr_fltr"></select>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>`:""}\n\t\t\t\t\t\t\t\t\t\t \t<div class="zpl_secn">\n\t\t\t\t\t\t\t\t\t\t\t\t<div tabindex="0" aria-label="${ZPI18N.getString("zp.recordowner")}">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label>`+ZPI18N.getString("zp.recordowner")+`</label>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<select id="${activeTab}_apprLst_recownr_fltr"></select>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="zpl_secn">\n\t\t\t\t\t\t\t\t\t\t\t\t<div tabindex="0" aria-label="${ZPI18N.getString("zp.forms")}">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label>`+ZPI18N.getString("zp.forms")+`</label>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<select id="${activeTab}_apprLst_forms_fltr"></select>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="zpl_secn">\n\t\t\t\t\t\t\t\t\t\t\t\t<div tabindex="0" aria-label="${ZPI18N.getString("zp.status")}">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label>`+ZPI18N.getString("zp.status")+`</label>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<select id="${activeTab}_apprLst_status_fltr"></select>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="zpl_secn">\n\t\t\t\t\t\t\t\t\t\t\t\t<div tabindex="0" aria-label="${ZPI18N.getString("zp.employeestatus")}">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label>`+ZPI18N.getString("zp.employeestatus")+`</label>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<select id="${activeTab}_apprLst_empstatus_fltr"></select>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<button id="searchFilter" type="button" class="zlabel zlabel--blue zlabel--medium" onclick="ApprovalList.Filter.searchFilterAction('`+activeTab+"')\">"+ZPI18N.getString("zp.apply")+'</button><button type="button" class="zlabel zlabel--outline zlabel--medium" onclick="ApprovalList.Filter.resetFilter(\''+activeTab+"')\">"+ZPI18N.getString("zp.reset")+"</button></div>\n\t\t\t\t\t\t\t\t</div>"},constructFilterElements:function(activeTab){Layout.Page.container.append(ApprovalList.Filter.getFilterHtml(activeTab)),isadmin&&ApprovalList.Filter.loadEmployeeOptionProperties("MYAPPROVALS_APPROVER",activeTab+"_apprLst_appr_fltr"),ApprovalList.Filter.loadEmpStatusOptionProperties(),ApprovalList.Filter.loadEmployeeOptionProperties("MYAPPROVALS_RECORDOWNER",activeTab+"_apprLst_recownr_fltr"),ApprovalList.Filter.loadFormsOptionProperties(),ApprovalList.Filter.loadStatusOptionProperties()},showHideFilter:function(activeTab){var pageId=Layout.Page.container;pageId.find("#apprLst_fltr_cont").length<=0&&ApprovalList.Filter.constructFilterElements(activeTab),pageId.hasClass("zpl_fltr_flt")?(pageId.removeClass("zpl_fltr_flt"),pageId.find("#approvalsFilter").focus()):(pageId.addClass("zpl_fltr_flt"),pageId.find("#apprLst_fltr_cont").focus(),pageId.on("keydown",function(e){"Escape"===e.key&&(ApprovalList.Filter.showHideFilter(activeTab),pageId.off("keydown"))}))},loadFormsOptionProperties:function(){var approvalFormsProp={options:ApprovalList.APPROVAL_FORMLIST,removeExistingDropdown:!0,dataMapping:{label:"value",value:"id",title:"value"},forElement:"apprLst_fltr_cont",select:(event,data)=>{ZPA_Common.getParentPageId().find("#"+ApprovalList.getActiveTabName()+"_apprLst_forms_fltr-container").attr("aria-label",data.optionData.value)}};ZPA_Common.ZCompProp.loadSelectListProp(approvalFormsProp),ZPeopleComponents.select(ZPA_Common.getParentPageId().find("#"+ApprovalList.getActiveTabName()+"_apprLst_forms_fltr"),approvalFormsProp),ZPA_Common.getParentPageId().find("#"+ApprovalList.getActiveTabName()+"_apprLst_forms_fltr-container").attr("aria-label",ZPI18N.getString("zp.allforms"))},loadStatusOptionProperties:function(){var approvalStatusList=[];approvalStatusList.push({id:"all",value:ZPI18N.getString("zp.allstatus")}),approvalStatusList.push({id:"pending",value:ZPI18N.getString("zp.pending"),isDefaultValue:!0}),approvalStatusList.push({id:"approved",value:ZPI18N.getString("zp.approved")}),approvalStatusList.push({id:"rejected",value:ZPI18N.getString("zp.rejected")}),-1!=Layout.Page.hash.indexOf("approval/myrequest")&&approvalStatusList.push({id:"cancelled",value:ZPI18N.getString("zp.cancelled")});var approvalStatusProp={options:approvalStatusList,selectedValue:"pending",removeExistingDropdown:!0,dataMapping:{label:"value",value:"id"},forElement:"apprLst_fltr_cont",select:(event,data)=>{ZPA_Common.getParentPageId().find("#"+ApprovalList.getActiveTabName()+"_apprLst_status_fltr-container").attr("aria-label",data.optionData.value)}};ZPA_Common.ZCompProp.loadSelectListProp(approvalStatusProp),ZPeopleComponents.select(ZPA_Common.getParentPageId().find("#"+ApprovalList.getActiveTabName()+"_apprLst_status_fltr"),approvalStatusProp),ZPA_Common.getParentPageId().find("#"+ApprovalList.getActiveTabName()+"_apprLst_status_fltr-container").attr("aria-label",ZPI18N.getString("zp.pending"))},loadEmployeeOptionProperties:function(mode,id){let apprProp={};if(apprProp.dataSource={search:function(params){return new Promise(function(search,reject){let searchMode="MYAPPROVALS_APPROVER"===mode?"APPROVALS_MYAPPROVALS":"APPROVALS_MYAPPROVALS_RECORDOWNER",searchRes=ZPA_Common.getDecodedEmpIdWithName(EmployeeSearch.getEmpList(params.query,"emp",searchMode));searchRes.unshift({id:0,value:ZPI18N.getString("zp.allusers"),image:ZPeople.getDefaultUserImagePath()}),search({delay:20,results:searchRes,more:!1})})},paginated:!0},apprProp.dataMapping={value:"id",label:"value",image:"image"},apprProp.serverSearch=!0,apprProp.cacheData=!0,apprProp.contentType="image-text",apprProp.select=((event,data)=>{ZPA_Common.getParentPageId().find("#"+id+"-container").attr("aria-label",data.optionData.value)}),ZPA_Common.ZCompProp.loadSelectListProp(apprProp),"MYAPPROVALS_RECORDOWNER"==mode&&(apprProp.change=ApprovalList.Filter.enableDisableEmpStatusFilter),ZPeopleComponents.select("#"+id,apprProp),"allapproval"==ApprovalList.getActiveTabName()||"MYAPPROVALS_RECORDOWNER"==mode)ZPeopleComponents.select(Layout.Page.container.find("#"+id)).setValue({id:0,value:ZPI18N.getString("zp.allusers")}),Layout.Page.container.find("#"+id+"-container").attr("aria-label",ZPI18N.getString("zp.allusers"));else{let currUser=ZPA_Common.getDecodedEmpIdWithName(EmployeeSearch.getEmpList({},"emp","APPROVALS_MYAPPROVALS"))[0];ZPeopleComponents.select(Layout.Page.container.find("#"+id)).setValue({id:currUser.id,value:currUser.value,image:currUser.image}),Layout.Page.container.find("#"+id+"-container").attr("aria-label",currUser.value)}},loadEmpStatusOptionProperties:function(){var empStatusOptions=[];empStatusOptions.push({id:zpconst.EmployeeStatus.all,value:ZPI18N.getString("zp.allrequest")}),empStatusOptions.push({id:zpconst.EmployeeStatus.activeemprecord,value:ZPI18N.getString("zp.activeemprequest"),isDefaultValue:!0}),empStatusOptions.push({id:zpconst.EmployeeStatus.exitemprecord,value:ZPI18N.getString("zp.exemprequest")});var empStatusProp={options:empStatusOptions,selectedValue:zpconst.EmployeeStatus.activeemprecord,removeExistingDropdown:!0,dataMapping:{label:"value",value:"id"},forElement:"apprLst_fltr_cont",select:(event,data)=>{ZPA_Common.getParentPageId().find("#"+ApprovalList.getActiveTabName()+"_apprLst__empstatus_fltr-container").attr("aria-label",data.optionData.value)}};ZPA_Common.ZCompProp.loadSelectListProp(empStatusProp),ZPeopleComponents.select(ZPA_Common.getParentPageId().find("#"+ApprovalList.getActiveTabName()+"_apprLst_empstatus_fltr"),empStatusProp),ZPA_Common.getParentPageId().find("#"+ApprovalList.getActiveTabName()+"_apprLst_empstatus_fltr-container").attr("aria-label",ZPI18N.getString("zp.activeemprequest"))},enableDisableEmpStatusFilter:function(event){var data=event.detail;let id=Layout.Page.container.find("#"+ApprovalList.getActiveTabName()+"_apprLst_empstatus_fltr");"0"!=data.selectedValue&&""!=data.selectedValue&&void 0!=data.selectedValue?(ZPeopleComponents.select(id).setValue({id:zpconst.EmployeeStatus.activeemprecord,value:ZPI18N.getString("zp.activeemprequest")}),ZPeopleComponents.select(id).setAttributes({disabled:!0})):ZPeopleComponents.select(id).setAttributes({disabled:!1})},showFilterResult:function(params){var pageId=Layout.Page.container,formId=params.approvalForm,status=params.approvalStatus;let empStatusId=params.empStatus,approverId=params.empErecNo,recordOwnerId=params.myApprRecOwner,activeTab=ApprovalList.getActiveTabName();pageId.find("#filterResultsHeader").removeClass("zpl_DNI");var formName=ZPI18N.getString("zp.all");if(ZPA_Common.isNotNull(formId)&&"-1"!=formId){var formList=ZPeopleComponents.select(pageId.find("#apprLst_fltr_cont #"+ApprovalList.getActiveTabName()+"_apprLst_forms_fltr")).options;$.each(formList,function(index,formObj){if(formObj.id==formId)return formName=formObj.value,!1})}let empStatus,filterContent;if(empStatusId==zpconst.EmployeeStatus.activeemprecord?empStatus=ZPI18N.getString("zp.activeemprequest"):empStatusId==zpconst.EmployeeStatus.exitemprecord&&(empStatus=ZPI18N.getString("zp.exemprequest")),pageId.find("#filterResultsHeader ul").empty(),formName!=ZPI18N.getString("zp.all")&&(filterContent=ZPI18N.getString("zp.forms")+" : "+ZSEC.Encoder.encodeForHTML(formName),pageId.find("#filterResultsHeader ul").append("<li name=\"forms\" tabindex='0' role='tab' aria-label='"+filterContent+"'><label>"+filterContent+"</label><a class='PI_cls' onclick='ApprovalList.Filter.removeFilterTag(\"forms\", \"-1\")' title='"+ZPI18N.getString("zp.clear")+"' tabindex='0' role='button' aria-label='"+ZPI18N.getString("zp.clear")+"'></a></li>")),"all"!=status&&(filterContent=ZPI18N.getString("zp.status")+" : "+ZPI18N.getString("zp."+status.toLowerCase()),pageId.find("#filterResultsHeader ul").append("<li name=\"status\" tabindex='0' role='tab' aria-label='"+filterContent+"'><label>"+filterContent+"</label><a class='PI_cls' onclick='ApprovalList.Filter.removeFilterTag(\"status\", \"all\")' title='"+ZPI18N.getString("zp.clear")+"' tabindex='0' role='button' aria-label='"+ZPI18N.getString("zp.clear")+"'></a></li>")),isadmin&&ZPA_Common.isNotNull(approverId)&&"0"!=approverId){let approverName=ZPeopleComponents.isComponent("#"+activeTab+"_apprLst_appr_fltr")?ZSEC.Encoder.encodeForHTML(ZPeopleComponents.select("#"+activeTab+"_apprLst_appr_fltr")._optDatas[0].value):ZPeople.getUserDetailsById(_LOGGEDIN_ZUID).name;filterContent=ZPI18N.getString("zp.approver")+" : "+approverName,pageId.find("#filterResultsHeader ul").append("<li name=\"appr\" tabindex='0' role='tab' aria-label='"+filterContent+"'><label>"+filterContent+"</label><a class='PI_cls' onclick='ApprovalList.Filter.removeFilterTag(\"appr\")' title='"+ZPI18N.getString("zp.clear")+"' tabindex='0' role='button' aria-label='"+ZPI18N.getString("zp.clear")+"'></a></li>")}ZPA_Common.isNotNull(recordOwnerId)&&"0"!=recordOwnerId?(filterContent=ZPI18N.getString("zp.recordowner")+" : "+ZSEC.Encoder.encodeForHTML(ZPeopleComponents.select("#"+activeTab+"_apprLst_recownr_fltr")._optDatas[0].value),pageId.find("#filterResultsHeader ul").append("<li name=\"recownr\" tabindex='0' role='tab' aria-label='"+filterContent+"'><label>"+filterContent+"</label><a class='PI_cls' onclick='ApprovalList.Filter.removeFilterTag(\"recownr\", \"0\")' title='"+ZPI18N.getString("zp.clear")+"' tabindex='0' role='button' aria-label='"+ZPI18N.getString("zp.clear")+"'></a></li>")):ZPA_Common.isNotNull(empStatusId)&&empStatusId!=zpconst.EmployeeStatus.all&&(filterContent=ZPI18N.getString("zp.employeestatus")+" : "+empStatus,pageId.find("#filterResultsHeader ul").append("<li name=\"empstatus\" tabindex='0' role='tab' aria-label='"+filterContent+"'><label>"+filterContent+"</label><a class='PI_cls' onclick='ApprovalList.Filter.removeFilterTag(\"empstatus\","+zpconst.EmployeeStatus.all+" )' title='"+ZPI18N.getString("zp.clear")+"' tabindex='0' role='button' aria-label='"+ZPI18N.getString("zp.clear")+"'></a></li>"))},removeFilterTag:function(filterName,value){let activeTab=ApprovalList.getActiveTabName();Layout.Page.container.find("#apprLst_fltr_cont").length<=0&&ApprovalList.Filter.constructFilterElements(activeTab),"appr"==filterName?ZPeopleComponents.select(ZPA_Common.getParentPageId().find("#apprLst_fltr_cont #"+activeTab+"_apprLst_appr_fltr")).setValue({id:0,value:ZPI18N.getString("zp.allusers")}):ZPeopleComponents.select(ZPA_Common.getParentPageId().find("#apprLst_fltr_cont #"+activeTab+"_apprLst_"+filterName+"_fltr")).setValue(value),ApprovalList.Filter.searchFilterAction()},getFilterValue:function(inputId){let activeTab=ApprovalList.getActiveTabName();var filterDiv=Layout.Page.container.find("#"+inputId);if(ZPeopleComponents.isComponent(filterDiv))return ZPeopleComponents.select(filterDiv).selectedValue;switch(inputId){case activeTab+"_apprLst_appr_fltr":return"allapproval"==activeTab?"0":erecno;case activeTab+"_apprLst_forms_fltr":return"-1";case activeTab+"_apprLst_status_fltr":return"pending";case activeTab+"_apprLst_empstatus_fltr":return zpconst.EmployeeStatus.activeemprecord}},resetFilter:function(){let activeTab=ApprovalList.getActiveTabName();var pageId=ZPA_Common.getParentPageId();pageId.find("#apprLst_fltr_cont").length<=0&&ApprovalList.Filter.constructFilterElements(activeTab),ZPA_Common.removeErrorDiv(pageId.find("#apprLst_fltr_cont")),isadmin&&ZPeopleComponents.select(pageId.find("#apprLst_fltr_cont #"+activeTab+"_apprLst_appr_fltr")).setValue({id:0,value:ZPI18N.getString("zp.allusers")}),ZPeopleComponents.select(pageId.find("#apprLst_fltr_cont #"+activeTab+"_apprLst_recownr_fltr")).setValue({id:0,value:ZPI18N.getString("zp.allusers")}),ZPeopleComponents.select(pageId.find("#apprLst_fltr_cont #"+activeTab+"_apprLst_forms_fltr")).setValue(-1),ZPeopleComponents.select(pageId.find("#apprLst_fltr_cont #"+activeTab+"_apprLst_status_fltr")).setValue("pending"),ZPeopleComponents.select(pageId.find("#apprLst_fltr_cont #"+activeTab+"_apprLst_empstatus_fltr")).setValue(zpconst.EmployeeStatus.activeemprecord)},searchFilterAction:function(activeTab){ApprovalList.Filter.resetApprovalFireScroll(),ApprovalList.resetApprovalPage(),activeTab&&ApprovalList.Filter.showHideFilter(activeTab)},resetApprovalFireScroll:function(){var fireScrollProperty=ZPeople.FireScroll.getFireScrollPropertie();fireScrollProperty&&(fireScrollProperty.triggered=!0)},resetFilterResult:function(){ApprovalList.Filter.resetFilter(),ApprovalList.Filter.searchFilterAction()}},ApprovalList.Forward={showPopup:function(){if(ApprovalList.APPROVE_RECIDS.length<200){let forwardApprTab=new Tab("",this.constructBulkForwardPopUpHtml);forwardApprTab.id="bulkForwardPopup",forwardApprTab.cardId="bulkForwardCard",forwardApprTab.validate=(popupObj=>{this.bulkForwardValidateAndExecute(popupObj)}),ApprovalList.Forward.popupModal=new popupModal(ZPI18N.getString("zp.bfwrdmyapprpophead"),forwardApprTab),ApprovalList.Forward.popupModal.mediumSize=!0,ApprovalList.Forward.popupModal.isAppendToBody=!0,ApprovalList.Forward.popupModal.save=ZPI18N.getString("zp.proceed"),ApprovalList.Forward.popupModal.construct(),ApprovalList.Forward.popupModal.setCloseCallback(function(){ApprovalList.Forward.closePopup()})}else ZPeople.Message.failure(ZPI18N.getString("zp.apprfrwdmaxrecordidlenerr"))},closePopup:function(){ApprovalList.Forward.popupModal.remove()},getBulkForwardPopUpHtml:function(){return'<div class="zpl_crd"><div id="forwardingDiv" class="zpl_crdcnt"><div class="zpl_secn">'+this.getBulkForwardWarningMsgHtml()+'</div><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.selectapprover")+'</label></div><div><select id="appr_forward_id" style="display:none"></select></div></div><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.local.Comments")+'</label></div><div><textarea id="forward_comment" class="ztextbox" rows="8" placeholder="'+ZPI18N.getString("zp.local.Comments")+'"></textarea></div></div></div></div>'},constructBulkForwardPopUpHtml:function(){let frwdPopupCardId=ApprovalList.Forward.popupModal.cardElem();ApprovalList.Forward.popupModal.sliderDiv.find(".zpl_mhder div").append("<div>"+ZPI18N.getString("zp.bfwrdmyapprpopmsg")+"</div>"),frwdPopupCardId.append(ApprovalList.Forward.getBulkForwardPopUpHtml()),ZPeopleComponents.select(frwdPopupCardId.find("#appr_forward_id"),ApprovalForward.getForwardMenuProperty())},isBulkForwardWarningMsgNeeded:function(){let activeTab=ApprovalList.getActiveTabName(),isBulkForwardWarningMsgNeeded=!1;return"allapproval"!=ApprovalList.getActiveTabName()&&"team"!=ApprovalList.getActiveTabName()||void 0==ApprovalList.Filter.getFilterValue(activeTab+"_apprLst_appr_fltr")||ApprovalList.Filter.getFilterValue(activeTab+"_apprLst_appr_fltr")==erecno||Layout.Page.container.find("[name=approval_card][isPrimaryAppr=false] input").is(":checked")&&(isBulkForwardWarningMsgNeeded=!0),isBulkForwardWarningMsgNeeded},getBulkForwardWarningMsgHtml:function(){return this.isBulkForwardWarningMsgNeeded()?'<div class="zpl_info"><em>'+ZPI18N.getString("zp.bfwrdmyapprwrngmsg")+"</em></div>":""},bulkForwardValidateAndExecute:function(popupObj){let $forwardCard=popupObj.cardElem(),forwardErecno=ZPeopleComponents.select($forwardCard.find("#appr_forward_id")).getValue(),forwardComment=$forwardCard.find("#forward_comment").val();ApprovalList.removeErrorMsg($forwardCard),ZPUtil.Validation.isEmpty(forwardComment)?ApprovalList.showErrorMsg($forwardCard.find("#forward_comment"),ZPI18N.getString("zp.commentsrequirederrormsg")):forwardComment.length>250&&ApprovalList.showErrorMsg($forwardCard.find("#forward_comment"),ZPI18N.getString("zp.commentlenerr")),ZPUtil.Validation.isEmpty(forwardErecno)&&ApprovalList.showErrorMsg($forwardCard.find("#appr_forward_id").next("div"),ZPI18N.getString("zp.selectapprover")),0===$forwardCard.find(".ztextbox--error__label").length&&(this.isBulkForwardWarningMsgNeeded()?(ApprovalList.Forward.warningPopup=new InfoAlertMessage("",ZPI18N.getString("zp.bfwrdmyapprconfirm")),ApprovalList.Forward.warningPopup.setCallback(()=>{this.execute(forwardErecno,forwardComment)}),ApprovalList.Forward.warningPopup.setCloseCallback(this.frwdWarningCancelCallback),ApprovalList.Forward.popupModal.sliderDiv.removeClass("zpl_mopen"),ApprovalList.Forward.warningPopup.show()):($forwardCard.closest(".zpl_minr").find("#submitSbt").prop("disabled",!0),this.execute(forwardErecno,forwardComment)))},frwdWarningCancelCallback:function(){Layout.Page.container.find("#"+ApprovalList.getActiveTabName()+"_page_content button[approvalType=2]").prop("disabled",!1),ApprovalList.Forward.popupModal.sliderDiv.addClass("zpl_mopen")},execute:function(forwardErecno,forwardComment){this.closePopup();var params={method:"forwardMyApprovals",recordIds:JSON.stringify(ApprovalList.APPROVE_RECIDS),forwardErecno:forwardErecno,comment:forwardComment};ZPeople.Request.send("/forwardApproval.zp",params,this.bulkFrwdSuccessCallBack,void 0,this.bulkFrwdFailureCallBack)},bulkFrwdSuccessCallBack:function(resultData,params){"forwardMyApprovals"===params.method&&void 0!=resultData.successMsg&&ZPeople.Message.success(resultData.successMsg),Layout.Page.container.find("#"+ApprovalList.getActiveTabName()+"_page_content").empty(),ApprovalList.getApprovalOrRequestList(resultData),ApprovalList.APPROVE_RECIDS=[]},bulkFrwdFailureCallBack:function(failureData){failureData.hasOwnProperty("responseJSON")&&failureData.responseJSON.hasOwnProperty("error")&&failureData.responseJSON.error.trim().length>0&&ZPeople.Message.showFailureMsg(failureData.responseJSON.error)}},ApprovalList.MySpace={constructApprovalPage:function(result,params){let pageId=Layout.Page.container,activeTab=ApprovalList.getActiveTabName();0==pageId.find("#"+activeTab+"_page_content").length&&pageId.append('<div id="'+activeTab+'_page_content" class="zpl_msplst"></div>'),pageId.find("#"+activeTab+"_page_content").append(this.getApprovalHeaderHtml()),this.constructApprovalCards(result,params),ApprovalList.addClickEvent(pageId)},showPopup:function(btnObj,isBulkApproval,formId){let action=$(btnObj).attr("approvalType");const cardObj=$(btnObj).closest("[name=approval_card]");if(cardObj.length>0){const tableName=cardObj.attr("tablename");let callback=OPApprovals.ModuleCallback.ActionCard.initialApprovalPopup(tableName,action);if(ZPUtil.Validation.isFunction(callback)){return void callback(tableName,cardObj.attr("formid"),cardObj.attr("id"),action)}}if(1==action){let apprAlrtObj=new SuccessAlertMessage(ZPI18N.getString("zp.approval.apprconformationtitle"));apprAlrtObj.setCallback(this.apprRejAction),apprAlrtObj.yesButtonText=ZPI18N.getString("zp.approve"),apprAlrtObj.removeAfterYes=!1,apprAlrtObj.setCenterHtml('<textarea id="approver_comment" class="ztextbox" rows="8" placeholder="'+ZPI18N.getString("zp.local.Comments")+'"></textarea>'+this.getAllLevelApprovalHtml()),apprAlrtObj.show(),apprAlrtObj.alertDiv.find("p").text(ZPI18N.getString("zp.approval.apprconformationdesc")),apprAlrtObj.cardObj=cardObj,apprAlrtObj.approvalType=action,apprAlrtObj.isBulkApproval=isBulkApproval,apprAlrtObj.formId=formId}else{let rejAlrtObj=new DeleteAlertMessage(ZPI18N.getString("zp.approval.rejconformationtitle"));rejAlrtObj.setCallback(this.apprRejAction),rejAlrtObj.yesButtonText=ZPI18N.getString("zp.reject"),rejAlrtObj.removeAfterYes=!1,rejAlrtObj.setCenterHtml('<textarea id="approver_comment" class="ztextbox" rows="8" placeholder="'+ZPI18N.getString("zp.local.Comments")+'"></textarea>'),rejAlrtObj.show(),rejAlrtObj.alertDiv.find("p").text(ZPI18N.getString("zp.approval.rejconformationdesc")),rejAlrtObj.cardObj=cardObj,rejAlrtObj.approvalType=action,rejAlrtObj.isBulkApproval=isBulkApproval,rejAlrtObj.formId=formId}},apprRejAction:function(thisObj){let apprParam,alertDiv=thisObj.alertDiv,cardObj=thisObj.cardObj,isBulk=thisObj.isBulkApproval,recIdArr=isBulk?ApprovalList.APPROVE_RECIDS:new Array(cardObj.attr("id")),isRecordAdmin=ZPeople.CURR_USER.usererec===cardObj.attr("recordOwnerErecno"),approvalType=thisObj.approvalType,comment=alertDiv.find("#approver_comment").val(),isApproveAllLevel=!(!isadmin||1!=approvalType)&&alertDiv.find("#appr_alllvl_check").prop("checked");alertDiv.find("#yesBtn").attr("name","approvalBtn"),apprParam=isBulk?ApprovalParam.setBulkParam(recIdArr,isRecordAdmin,thisObj.formId):new ApprovalParam(cardObj.attr("formid"),recIdArr,cardObj.attr("tableName"),cardObj.attr("status"),isRecordAdmin);let layoutParam=new LayoutParam(alertDiv,alertDiv.find("#alrtCls"),alertDiv.find(".zpl_mfoter"),"MySpace");layoutParam.setActionLayout(alertDiv),alertDiv.find("#yesBtn").attr("disabled",!0);let approveRejectObj=new ApproveReject(apprParam,layoutParam,approvalType,comment,isApproveAllLevel);approveRejectObj.setIsBulkApproval(isBulk),approveRejectObj.setIsCardApproval(!isBulk),approveRejectObj.execute()},getAllLevelApprovalHtml:function(){return isadmin?'<div class="zcheckbox" onchange="ApprovalList.MySpace.showAllLevelApprBtn(this)"><input id="appr_alllvl_check" class="zcheckbox__helper" type="checkbox" name="check"><label for="appr_alllvl_check" class="zcheckbox__label">'+ZPI18N.getString("zp.skipinterapprlvl")+"</label></div>":""},showAllLevelApprBtn:function($this){let isSelected=$($this).children("#appr_alllvl_check").prop("checked");$($this).parents(".zpl_minr").find("#yesBtn").text(isSelected?ZPI18N.getString("zp.approveall"):ZPI18N.getString("zp.approve"))},getCheckboxHtml:function(recId){return'<div class="zcheckbox" onclick="ApprovalList.selectUnselectCheck(this,\''+recId+'\')"><input id="zp_approval_check" type="checkbox" name="check" value="" class="zcheckbox__helper"><label class="zcheckbox__label"></label></div>'},getApprReqDtlHtml:function(empPhotoUrl,recordOwner,formName,reqMsg,recordOwnerZuid){return'<div class="zpl_msp-dts CP"><div><div class="zpl_em"><div class="zpl_emimg" popup="user" empid='+recordOwnerZuid+'><img alt="" src="'+empPhotoUrl+'"></div><div class="zpl_emdts zpl_ellipsis"><div><b>'+recordOwner+"</b></div><div><em>"+reqMsg+" </em><b>"+formName+"</b></div></div></div></div></div>"},getRaisedOnHtml:function(data){return'<div><div class="zpl_compoffar"><em>'+ZPI18N.getString("zp.raisedon")+'</em><div class="d-flexclmcap10"><div><b>'+data.requestedOn+"</b></div></div></div></div>"},getApprRejBtnHtml:function(){return'<div id="zp_approval_actiondiv" class="zpl_msp-act"><div id="zp_approval_approvereject" class="zpl_hvr"><button class="zlabel zlabel--blue zlabel--medium zlabel--outline" approvalType=1>'+ZPI18N.getString("zp.approve")+'</button><button class="zlabel zlabel--red zlabel--medium zlabel--outline" approvalType=0>'+ZPI18N.getString("zp.reject")+"</button></div></div>"},getApprRejMsgHtml:function(status){return'<div class="d-flexclmcap10 '+(status?"grn":"red")+'">'+ZPI18N.getString(status?"zp.approved":"zp.rejected")+"</div>"},constructApprovalCards:function(result,params){let pageId=Layout.Page.container.find("#"+ApprovalList.getActiveTabName()+"_page_content"),approvalCards="",recordCount=ApprovalList.TOTAL_RECS,resultDataLength=result.message.length;21==resultDataLength&&(resultDataLength-=1);for(let index=0;index<resultDataLength;index++){let data=result.message[index],recordOwnerName=ZPeople.CURR_USER.usererec===data.recordOwnerErecno?ZPeople.CURR_USER.name:data.recordOwnerName,reqMsg="";reqMsg=1==data.approvalAction?ZPI18N.getString("zp.hasmadecancelreq"):ZPI18N.getString("zp.hasmadereq"),approvalCards+='<div name="approval_card" id="'+data.recordId+'" formId="'+data.formId+'" formDisplayName="'+data.formName+'" tableName="'+data.tableName+'" status="'+data.approvalStatus+'" recordOwnerErecno="'+data.recordOwnerErecno+'">'+this.getCheckboxHtml(data.recordId)+this.getApprReqDtlHtml(data.employeePhotoUrl,recordOwnerName,data.formName,reqMsg,data.recordOwnerZUID)+this.getRaisedOnHtml(data)+this.getApprRejBtnHtml()+"</div>",recordCount+=1}pageId.append(approvalCards),ApprovalList.TOTAL_RECS=recordCount},updateApprovalCard:function(recordId,status){let cardId=Layout.Page.container.find("#"+ApprovalList.getActiveTabName()+"_page_content #"+recordId);0==status||1==status?(cardId.removeClass("zpl_mspinfo"),cardId.find("#error_info").remove(),cardId.find("#zp_approval_check_div").addClass("disabled"),cardId.find("#zp_approval_check").prop("checked",!1).attr("disabled",!0),cardId.find("div.zcheckbox").removeClass("zpl_DNI"),cardId.find("#zp_approval_actiondiv").empty().append(ApprovalList.MySpace.getApprRejMsgHtml(status))):cardId.remove()},updateApprovalCards:function(recordIds,status){recordIds.forEach(function(val){ApprovalList.MySpace.updateApprovalCard(val,status)}),ZPeople.Message.success(ZPI18N.getString(status?"zp.apprsuccessmsg":"zp.rejsuccessmsg"))}},ApprovalHome={getPendingCount:function(){ZPeople.Request.send("/approvalAction.zp",{mode:"pendingApprovalsCount"},function(result){let count=result.message.count;$("#home_myspace_overview_approval").addClass("zpl_NtHd").find(".zpl_Ntcont").remove(),0!=count&&$("#home_myspace_overview_approval").addClass("zpl_NtHd").append('<div class="zpl_Ntcont"><span>'+count+"</span></div>")})},updateApprovalCount:function(){-1!==Layout.Page.hash.indexOf("home/myspace/overview-approval")?ApprovalList.approvalAction():ApprovalHome.getPendingCount()}},ApprovalRedirection={getV5URL:function(){if(settingsUrlProps.urlParamsArr&&settingsUrlProps.urlParamsArr.mode){var mode=settingsUrlProps.urlParamsArr.mode,formId=settingsUrlProps.urlParamsArr.formId,recordId=settingsUrlProps.urlParamsArr.recordId;if("AttendancePermissions"==mode)return{isValid:!0,redirectToURL:"attendance/hourlyperm/viewmyrequest-formId:"+formId+"/recordId:"+recordId};if("AttendanceOD"==mode)return{isValid:!0,redirectToURL:"attendance/onduty/viewmyrequest-formId:"+formId+"/recordId:"+recordId};if("Shift"==mode)return{isValid:!0,redirectToURL:"attendance/shiftchangerequests/viewmyrequest-formId:"+formId+"/recordId:"+recordId};if("Goal"==mode)return{isValid:!0,redirectToURL:"performance/approval-formId:"+formId+"/recordId:"+recordId+"/mode:Goal"};if("Review"==mode)return{isValid:!0,redirectToURL:"performance/approval-formId:"+formId+"/recordId:"+recordId+"/mode:Review"};if("Rater"==mode)return{isValid:!0,redirectToURL:"performance/approval-formId:"+formId+"/recordId:"+recordId+"/mode:Rater"};if("Reviewsheet"==mode)return{isValid:!0,redirectToURL:"performance/approval-formId:"+formId+"/recordId:"+recordId+"/mode:Reviewsheet"};if("Salary_Revision"==mode)return{isValid:!0,redirectToURL:"salarydetails/salaryrevision/approval-formId:"+formId+"/recordId:"+recordId+"/mode:Salary_Revison"}}}},OPApprovals={APPROVAL_DETAILS:{},setApprovalData:function(recordId,approvalData){OPApprovals.APPROVAL_DETAILS[recordId]=approvalData},getApprovalData:function(recordId,formId){return OPApprovals.APPROVAL_DETAILS[recordId]&&1!=OPApprovals.APPROVAL_DETAILS[recordId].refresh?OPApprovals.APPROVAL_DETAILS[recordId]:void 0==OPApprovals.APPROVAL_DETAILS[recordId]&&void 0!=formId?(OPApprovals.fetchApprovalDetails(recordId,formId),OPApprovals.APPROVAL_DETAILS[recordId]):void 0},fetchApprovalDetails:function(recordId,formId,callback,failureCallback){let params={formId:formId,recordId:recordId,method:"getApprovalDetails"};ZPeople.Request.sendAsyncPost("/getApprovalDetails.zp",params,function(apprData){apprData.errorMsg||(OPApprovals.setApprovalData(recordId,apprData),OPApprovals.Common.Settings.setApprovalSettings(apprData.approvalSettingsDetails)),ZPUtil.Validation.isFunction(callback)&&callback(apprData,params)},null,failureCallback)},refreshApprovalData:function(recordId){OPApprovals.APPROVAL_DETAILS[recordId]&&delete OPApprovals.APPROVAL_DETAILS[recordId]},getTimeline(){var tab=new Tab;tab.id="approvalpopup_"+ZPApprovals.RECORDID,tab.cardId="approval_card",OPApprovals.approvalModal=new sliderModal(ZPI18N.getString("zp.apprTimeline"),tab),OPApprovals.approvalModal.smallSize=!0,OPApprovals.approvalModal.ftExtraCls="zpl_DNI",OPApprovals.approvalModal.construct(),OPApprovals.approvalModal.setCloseCallback(function(){OPApprovals.approvalModal.remove()});ZPA_Common.getMainContainer().find("#approvalpopup_"+ZPApprovals.RECORDID).find("#approval_card").append("<div id='zp_modal_body' class='zpl_crd'></div>");if(void 0===ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID]||ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID].refresh){ZPApprovals.APPROVAL_DETAILS[ZPApprovals.RECORDID]=void 0;var params={formId:ZPApprovals.FORMID,recordId:ZPApprovals.RECORDID,method:"getApprovalDetails"};ZPeople.Request.send("/getApprovalDetails.zp",params,ZPApprovals.getApprovalDtlCallBack,void 0,ZPApprovals.showHideApprDetailsBtn)}else ZPApprovals.showApproverejectModal(ZPApprovals.FORMID,ZPApprovals.RECORDID)},getApprovalEditButtonHTML:function(){var html='<div class="zpl_mfoter DN" id="footer"><div class="zpl_frm_mfoter"><div class="MRauto">';return html+='<button type="button" class="zlabel zlabel--blue zlabel--medium" name="approvalBtn">'+ZPI18N.getString("zp.submit")+"</button>",html+='<button id="zp_form_cancel_close_btn" class="zlabel zlabel--outline zlabel--medium"  name="closeBtn">Cancel</button>',html+="</div></div></div>"},getApprovalIcon:function(apprStatus,isApprovalEnabled,tableName){return-1!=[zpconst.ApprovalStatus.CancellationPending,zpconst.ApprovalStatus.Pending,zpconst.ApprovalStatus.Rejected,zpconst.ApprovalStatus.Approved,zpconst.ApprovalStatus.Cancelled,zpconst.ApprovalStatus.Draft,zpconst.ApprovalStatus.Revoked].indexOf(apprStatus)||(-2===apprStatus||-3===apprStatus)&&isApprovalEnabled||11!==apprStatus&&14!==apprStatus&&"P_MultiRater"===tableName?OPApprovals.getIconHtml(apprStatus):""},getIconHtml:function(apprStatus){var iconHtml="";switch(apprStatus){case zpconst.ApprovalStatus.CancellationPending:iconHtml='<i class="PI_ap_canclpend" data-toggle="tooltip" data-placement="top" title="'+ZPI18N.getString("zp.cancellationpending")+'"><i class="path1"></i><i class="path2"></i></i>';break;case zpconst.ApprovalStatus.NotSubmitedd:case zpconst.ApprovalStatus.NoStatus:iconHtml='<i class="PI_ap_notsend"  data-toggle="tooltip" data-placement="top" title="'+ZPI18N.getString("zp.notsentforapproval")+'"></i>';break;case zpconst.ApprovalStatus.Pending:iconHtml='<i class="PI_ap_pending" data-toggle="tooltip" data-placement="top" title="'+ZPI18N.getString("zp.approvalpending")+'"><i class="path1"></i><i class="path2"></i></i>';break;case zpconst.ApprovalStatus.Rejected:iconHtml='<i class="PI_ap_reject" data-toggle="tooltip" data-placement="top" title="'+ZPI18N.getString("zp.rejected")+'"></i>';break;case zpconst.ApprovalStatus.Approved:iconHtml='<i class="PI_ap_approved"  data-toggle="tooltip" data-placement="top" title="'+ZPI18N.getString("zp.approved")+'"></i>';break;case zpconst.ApprovalStatus.Cancelled:iconHtml='<i class="PI_ap_cancel"  data-toggle="tooltip" data-placement="top" title="'+ZPI18N.getString("zp.recordcancelled")+'"></i>';break;case zpconst.ApprovalStatus.Revoked:iconHtml='<i class="PI_fil_revoke PI_oldversion blu"  data-toggle="tooltip" data-placement="top" title="'+ZPI18N.getString("zp.revoked")+'"></i>';break;default:iconHtml='<i class="PI_ap_draft"  data-toggle="tooltip" data-placement="top" title="'+ZPI18N.getString("zp.savedasdraft")+'"></i>'}return iconHtml},getStatusText:function(status,tableName){switch(status){case zpconst.ApprovalStatus.CancellationPending:return ZPI18N.getString("zp.cancellationpending");case zpconst.ApprovalStatus.Pending:return ZPI18N.getString("zp.pending");case zpconst.ApprovalStatus.Approved:return ZPI18N.getString("zp.approved");case zpconst.ApprovalStatus.Rejected:return ZPI18N.getString("zp.rejected");case zpconst.ApprovalStatus.Cancelled:return ZPI18N.getString("zp.cancelled");case zpconst.ApprovalStatus.Revoked:if("P_Resignation"==tableName)return ZPI18N.getString("zp.revoked")}},getStatusColor:function(status){switch(status){case zpconst.ApprovalStatus.CancellationPending:case zpconst.ApprovalStatus.Pending:return"blu";case zpconst.ApprovalStatus.Approved:return"grn";case zpconst.ApprovalStatus.Rejected:case zpconst.ApprovalStatus.Revoked:case zpconst.ApprovalStatus.Cancelled:return"red"}}},OPApprovals.Filter={showApprovers:function(){var container=Layout.Page.container;"otherspending"==ZPeopleComponents.select(container.find("#approvalList")).getValue()?(container.find("#approverFilter").removeClass("DN"),OPApprovals.Filter.searchApprovers(container.find("#approverList"))):container.find("#approverFilter").addClass("DN")},searchApprovers:function(selectList){EmployeeSearch.getEmpDeptGrpList("","HRCASES","FEEDS","HRCASES",!0,"APPROVAL");var selectMenuObj={showSearchField:!0};selectMenuObj.dataSource={search:function(params){return new Promise(function(search,reject){search({delay:20,results:EmployeeSearch.getEmpDeptGrpList(params.query,"HRCASES","FEEDS","HRCASES",!0,"APPROVAL"),more:!1})})},paginated:!0},selectMenuObj.placeholder=ZPI18N.getString("zp.select"),selectMenuObj.isLabelHTMLEncoded=!0,selectMenuObj.serverSearch=!0,selectMenuObj.cacheData=!0,selectMenuObj.dataMapping={value:"id",label:"value",image:"image",informativeText:"email",textIcon:"avatarText",optgroupLabel:"dataType"},selectMenuObj.contentType="image-text",selectMenuObj.dropdownList={contentType:"image-text-desc",height:300,position:"bottom",width:20,isTextHTMLEncoded:!0},selectMenuObj.search={by:["value","email"]},selectList.zselect("destroy"),ZPeopleComponents.select(selectList,selectMenuObj)}},OPApprovals.Forward={showPopup:function(isFromTransition,transitionId,transitionRelId){var tab=new Tab;tab.id="bulkForwardPopup",tab.cardId="bulkFrwrd_cards",tab.validate=(()=>OPApprovals.Forward.saveForwardAppr(isFromTransition,transitionId,transitionRelId)),OPApprovals.Forward.forwardModal=new popupModal(ZPI18N.getString("zp.bulkforwardpopupheader"),tab),OPApprovals.Forward.forwardModal.mediumSize=!0,OPApprovals.Forward.forwardModal.isAppendToBody=!0,OPApprovals.Forward.forwardModal.construct(),OPApprovals.Forward.forwardModal.setCloseCallback(function(){OPApprovals.Forward.closePopup()}),ZPA_Common.getPopUpId(OPApprovals.Forward.forwardModal).find("#bulkFrwrd_cards").append(ZPA_Common.Cards.construct("frwdappr_basic",OPApprovals.Forward.getForwardHtml())),ZPA_Common.Loader.add("bulkFrwrd_cards")},closePopup:function(){OPApprovals.Forward.forwardModal.remove()},constructForwardPopup:function(isFromTransition,transitionId,transitionRelId){OPApprovals.Forward.showPopup(isFromTransition,transitionId,transitionRelId);var popUpId=ZPA_Common.getPopUpId(OPApprovals.Forward.forwardModal),delegateeErecNo="";"P_Employee"==ZP5Form.getCurrFormsOperation().tableName&&(delegateeErecNo=ZP5Form.getFormClassObj().getParams().recordId);var forwardSel_Prop={dataMapping:{value:"id",label:"value",image:"image"}};forwardSel_Prop.placeholder=ZPI18N.getString("zp.selectapprover"),forwardSel_Prop.dataSource={search:param=>new Promise(function(search){search({delay:20,results:ZPA_Common.getDecodedEmpIdWithName(EmployeeSearch.getEmpList(param.query,"emp","DELEGATION_DELEGATOR",[delegateeErecNo])),selectedIndex:erecno,more:!1})}),paginated:!0},forwardSel_Prop.serverSearch=!0,forwardSel_Prop.cacheData=!0,forwardSel_Prop.contentType="image-text",forwardSel_Prop.search={by:["value","email"]},ZPA_Common.ZCompProp.loadSelectListProp(forwardSel_Prop),ZPeopleComponents.select(popUpId.find("#frwrdappr"),forwardSel_Prop),ZPA_Common.Loader.remove(popUpId.find("#bulkFrwrd_cards"))},saveForwardAppr:function(isFromTransition,transitionId,transitionRelId){var popUpId=ZPA_Common.getPopUpId(OPApprovals.Forward.forwardModal);ZPA_Common.removeErrorDiv(popUpId);var formObj=ZP5Form.getFormClassObj(),frwdErecNo=ZPeopleComponents.select(popUpId.find("#frwrdappr")).getValue();ZPA_Common.isNotNull(frwdErecNo)?(formObj.setParamsVal("forwardErecno",frwdErecNo),formObj.isSingleFiledEdit()&&!formObj.isSingleFieldModal?formObj.callbackForSingleFieldEdit():isFromTransition&&"P_Employee"===formObj.tableName?ZPA_BPOperation.blueprintValidation(transitionId,transitionRelId,frwdErecNo):formObj.submitBtn(),OPApprovals.Forward.closePopup()):ZPA_Common.appendErrorDiv(popUpId.find("#frwrdappr"))},getForwardHtml:function(){return'<div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.selectapprover")+'</label></div><div><select type="text" id="frwrdappr" class="ztextbox" value=""></select></div>\n\t\t\t\t\t<div  class="zpl_info">'+ZPI18N.getString("zp.bulkforwardpopupcontent")+"</div></div>"}},OPApprovals.Common={getFormLayout:function(){return ZP5Form.getLayout()},getFormConfApprSettings:function(formId){var formConf=ZP5Form.getFormsOperation(formId).getFormsDetailsMap().approvalSettingsDetails;return formConf||(OPApprovals.Common.Settings.getApprovalSettings(formId)?OPApprovals.Common.Settings.getApprovalSettings(formId):{})},getFormTableName:function(){return ZP5Form.getCurrFormsOperation().getTableName()},getMandatoryCommentErrHTML:function(errMsg,mode){return"MySpace"==mode?'<span id="cmtErrMsg" class="ztextbox--error__label">'+errMsg+"</span>":'<div id="cmtErrMsg" class="ztextbox--error__label MB10">'+errMsg+"</div>"},failureCallBack:function(failureData,params){failureData.hasOwnProperty("responseJSON")&&failureData.responseJSON.hasOwnProperty("error")&&failureData.responseJSON.error.trim().length>0&&ZPeople.Message.showFailureMsg(failureData.responseJSON.error)},RecordOwner:{DATA:{},setOwner:function(recordId,ownerIds){let recordOwner=OPApprovals.Common.RecordOwner.getRecordOwner(recordId);recordOwner?recordOwner.OWNER=ownerIds:(recordOwner=OPApprovals.Common.RecordOwner.getInitialRecordOwner(recordId)).OWNER=ownerIds},setAddedBy:function(recordId,addedBy){let recordOwner=OPApprovals.Common.RecordOwner.getRecordOwner(recordId);recordOwner?recordOwner.ADDED_BY=addedBy:(recordOwner=OPApprovals.Common.RecordOwner.getInitialRecordOwner(recordId)).ADDED_BY=addedBy},getRecordOwner:function(recordId){return OPApprovals.Common.RecordOwner.DATA[recordId]},getInitialRecordOwner:function(recordId){return OPApprovals.Common.RecordOwner.DATA[recordId]={}},isRecordOwner:function(recordId,userId){let recordOwner=OPApprovals.Common.RecordOwner.getRecordOwner(recordId);return!!recordOwner&&(ZPUtil.checkIsExistInArray(recordOwner.OWNER,userId)||recordOwner.ADDED_BY==userId)},refreshRecordOwner:function(recordId){delete OPApprovals.Common.RecordOwner.DATA[recordId]}},Settings:{APPROVAL_SETTINGS:{},setApprovalSettings:function(apprSettings){apprSettings&&(OPApprovals.Common.Settings.APPROVAL_SETTINGS[apprSettings.formId]=apprSettings)},getApprovalSettings:function(formId){if(void 0!=formId)return void 0==OPApprovals.Common.Settings.APPROVAL_SETTINGS[formId]&&OPApprovals.Common.Settings.fetchApprovalSettings(formId,!0),OPApprovals.Common.Settings.APPROVAL_SETTINGS[formId]},resetApprovalSettings:function(formId){delete OPApprovals.Common.Settings.APPROVAL_SETTINGS[formId]},fetchApprovalSettings:function(formId,isCommentNeeded,callback){var params={formId:formId,method:"fetchUserApprovalSettings",type:isCommentNeeded?"commentSettings":"allSettings",conreqcsr:csrfToken};ZPeople.Request.sendAsyncPost("/fetchUserApprovalSettings.zp",params,function(data){OPApprovals.Common.Settings.setApprovalSettings(data),ZPUtil.Validation.isFunction(callback)&&callback(data,params)})},fetchSpecificApprovalSettings:function(formId,settingKeyName){var settingKeyValue,params={formId:formId,method:"fetchSettingsDetails",conreqcsr:csrfToken};return ZPeople.Request.sendAsyncPost("/fetchApprovalSettings.zp",params,function(resultData,params,settingKeyName){void 0!=resultData[settingKeyName]&&(settingKeyValue=resultData[settingKeyName])},settingKeyName),settingKeyValue}},getDivToAppendChooseApproverDiv:function(){return"P_EmployeeLeave"===OPApprovals.Common.getFormTableName()?"sectionsparent":"zp_form_body"}},OPApprovals.CustomerBased={sendForApproval:function(formId,recordId){if(formId&&("444399000134373317"==formId||"100597000023832001"==formId||"387345000000035743"==formId||Layout.ISDEV)){let recordOwner=OPApprovals.Common.RecordOwner.getRecordOwner(recordId);if(recordOwner&&recordOwner.OWNER){var recordOwnerSubList=ZPUtil.getCommonElementsInArrays(ZPeople.SUB_USERLIST,recordOwner.OWNER[0]);return recordOwnerSubList&&recordOwnerSubList.length>0}}return!1}},OPApprovals.ModuleCallback={ApproveReject:{initialCallback:function(tableName){return"P_AttendanceReg"==tableName?regularization_operation.appRejRegDetails:"P_ShiftMappingForm"==tableName?shiftRequest.appRejShiftDetails:"P_AutoShiftAssignForm"==tableName?AutoAssignShiftRequest.appRejShiftDetails:"P_AttendanceOD"==tableName?onduty.appRejODDetails:"P_TimesheetList"==tableName?Timetracker.timesheet.approverejectTsList:"P_Budget_Splitup"==tableName?BudgetReviewSheet.approveRejectReviewSheet:"P_MultiRater_Approval"==tableName?MR.Approval.approveRejectSubmit:"P_ReviewApprovalSheet"==tableName?ApprReview.Approval.appRejReviewApproval:"P_GoalSheet"==tableName?Goals.Approval.handleGoalApproval:void 0},postCallback:function(tableName){return"P_SalaryRevision"==tableName?Compensation.SalRevision.Operations.appRejSalRevision:"P_EmployeeLeave"==tableName?LeaveForm.postApprRejCallback:"P_PermissionDetails"==tableName?permission.postAppCallBack:"P_ShiftMappingForm"==tableName?shiftRequest.postAppCallBack:"P_AutoShiftAssignForm"==tableName?AutoAssignShiftRequest.postAppCallBack:"P_Resignation"==tableName?Offboarding.Form.approveRejectCallBack:"P_Compensatory"==tableName||"P_LeaveGrant"==tableName?LeaveAdminOpers.getData:"P_AppointmentLetter"==tableName?ApptLtr.Tabs.handlePostApprovalCallback:void 0}},ApprovalTimeline:{postCallback:function(tableName){if("P_Resignation"==tableName)return Offboarding.Form.approvalTimelineCallback}},SendForApproval:{postCallback:function(tableName){}},CancelApproval:{postCallback:function(tableName){if("P_Resignation"==tableName)return Offboarding.ListView.MoreAction.cancelResponseHandler}},ActionCard:{initialApprovalPopup:function(tableName,approvalStatus){if("P_Resignation"==tableName&&approvalStatus==zpconst.ApprovalStatus.Approved)return function(tableName,formId,recordId,action){Layout.PageUtil.loadFiles(["offboarding_common.min.js","offboarding_operations.min.js"],function(){Offboarding.Form.showMySpaceApprovalPopup(tableName,formId,recordId,action)})}}}},OPApprovals.Forms={getApproverType:function(formId){return ZP5Form.getFormsOperation(formId).getFormsDetailsMap()&&ZP5Form.getFormsOperation(formId).getApproverType()?ZP5Form.getFormsOperation(formId).getApproverType():"NONE"},constructChooseApproverCard:function(pageId){pageId=pageId||Layout.Page.container;let pageDiv=OPApprovals.Common.getDivToAppendChooseApproverDiv();pageId.find("#"+pageDiv).append(SendForApproval.getChooseApproverHtml(!0)),ZPeopleComponents.select("#zp_form_chooseapprover",SendForApproval.getChooseApproverProp())},isAllowEmployeeToChooseApprover:function(formObj){return ZP5Form.isApprovalEnabled(formObj.getParams().formId)&&"APPROVER_CHOOSEN_BY_USER"===formObj.FormOperations.getApproverType()&&!formObj.FormOperations.getApprovalSettingsDetails().isVerifySend&&(formObj.isAddMode()||formObj.isEditMode()||formObj.isResubmit())&&!formObj.isDraft},validateAndGetChosenApprover:function(formObj,pageId,params){if(OPApprovals.Forms.isAllowEmployeeToChooseApprover(formObj)){if(!pageId.find("select[name=zp_approverId]").val()){let chooseApprDiv=pageId.find("#zp_form_chooseappr_cont #zp_form_chooseapprover");return ZPA_Common.removeErrorDiv(chooseApprDiv.parent()),ZPA_Common.appendErrorDiv(chooseApprDiv.next("div"),ZPI18N.getString("zp.chooseapprovererrormsg")),!1}params.zp_approverId=pageId.find("select[name=zp_approverId]").val()}return!0},loadRecordByMode:function(formId,recordId,mode,formName){var params={formId:formId,recordId:recordId,formMode:mode=void 0!==mode?mode:"VIEW",isPageMode:!1,isEditDisabled:!0,disableUrlTrack:!0,editCallback:OPApprovals.Forms.loadRecordByEdit,modalCloseCallback:ApprovalList.closePopCallback};if(void 0!=formName&&"Leave"===formName){var leaveForm=new LeaveForm;"EDIT"==mode?leaveForm.edit(recordId):leaveForm.view(recordId)}else ZP5Form.load(params)},loadRecordByEdit:function(formId,recordId){ApprovalList.viewApprTimeLine=!1,OPApprovals.Forms.loadRecordByMode(formId,recordId,"EDIT")},listCallBack:function(recordId){var formId=OPApprovals.getApprovalData(recordId).formId;if(ZP5Form.getSingleRecord(formId,recordId)&&ZP5Form.getSingleRecord(formId,recordId).record.message){var recordObj=ZP5Form.getSingleRecord(formId,recordId).record;recordObj.message.approvalStatus=OPApprovals.getApprovalData(recordId).currentApprovalStatus,recordObj.isPrimaryAppr=OPApprovals.getApprovalData(recordId).isPrimaryAppr,recordObj.approvalDetails=OPApprovals.getApprovalData(recordId),ZP5Form.getFormsOperation(formId).updateRecordDetails(recordId,"record",recordObj)}},getFormLinkName:function(keyname,isFormId){return void 0!=ZPUtil.Form_Link_Names.formLinkNameObj&&0!=Object.keys(ZPUtil.Form_Link_Names.formLinkNameObj).length||ZPUtil.Form_Link_Names.load(),isFormId?ZPUtil.Form_Link_Names.formLinkNameObj[keyname]:ZPUtil.Form_Link_Names.formIdObj[keyname]},printApprovalData:function(isApproval,approvalDtl,newContent,recordId,formId){if(!isApproval)return{draft:!0,newContentWithApprData:newContent};if(0!==(approvalDtl=void 0!==approvalDtl?approvalDtl:OPApprovals.getApprovalData(recordId,formId)).length){if(!approvalDtl.hasOwnProperty("currentApprovalStatus")||approvalDtl.currentApprovalStatus!==zpconst.ApprovalStatus.NoStatus&&approvalDtl.currentApprovalStatus!==zpconst.ApprovalStatus.NotSubmitedd){let statusColur=OPApprovals.getStatusColor(approvalDtl.currentApprovalStatus),statusText=OPApprovals.getStatusText(approvalDtl.currentApprovalStatus);const printDiv=(new DOMParser).parseFromString(newContent,"text/html");let apprSection='<div class="zpl_frminfopanel"><div class="zpl_secn"><div><label>Approval Status:</label> <span class='+statusColur+">"+statusText+'</span></div><div><div class="zpl_crdlst zpl_aprvl-prntvw">',apprDtls='<div class="zpl_catlst"><div><div class="zpl_crd"><div><div class="zpl_em"><div class="zpl_emimg">';const endApprDtls="</div></div></div></div></div></div>";if(approvalDtl.systemApproved){let apprLevel=apprDtls;apprLevel+='<img src="'+ZPeople.getResourceURL(imageUrl+"auto-app.jpg")+'"></div><div class="zpl_emdts"><div>'+ZPI18N.getString("zp.systemapproval")+"</div><div"+(1===approvalDtl.currentApprovalStatus?" class='+statusColur+'>"+ZPI18N.getString("zp.approved"):" class='red'>"+ZPI18N.getString("zp.rejected"))+'</div><div class="d-flexclmcap20"><em>'+approvalDtl.systemApprovedTime+"</em></div>",apprSection+=apprLevel+=endApprDtls}if(void 0!==approvalDtl.processed){let approverlist=approvalDtl.processed;for(let approverdtl=-4==approvalDtl.currentApprovalStatus?1:0;approverdtl<approverlist.length;approverdtl++){let apprLevel=apprDtls,apprStatusHtml="";apprStatusHtml=3===approverlist[approverdtl].approvalStatus||1===approverlist[approverdtl].approvalStatus?" class='grn'>"+ZPI18N.getString("zp.approved"):approverlist[approverdtl].approvalStatus===zpconst.ApprovalStatus.Cancelled?" class='red'>"+ZPI18N.getString("zp.cancelled"):approverlist[approverdtl].approvalStatus===zpconst.ApprovalStatus.Revoked?" class='red'>"+ZPI18N.getString("zp.revoked"):" class='red'>"+ZPI18N.getString("zp.rejected"),apprLevel+='<img src="'+approverlist[approverdtl].photo+'"></div><div class="zpl_emdts"><div class="tooltip-js" data-position="bottom-left" title="'+approverlist[approverdtl].name+'"><b>'+approverlist[approverdtl].name+"</b></div><div"+apprStatusHtml+'</div><div class="d-flexclmcap20"><em>'+approverlist[approverdtl].approvedTime+"</em></div>",apprSection+=apprLevel+=endApprDtls}}if(void 0!==approvalDtl.current){let currrentapplist=approvalDtl.current.delegatee&&1!==approvalDtl.current.delegatee.Sub_Type?approvalDtl.current.delegatee:approvalDtl.current,apprLevel=apprDtls;apprLevel+='<img src="'+currrentapplist.photo+'"></div><div class="zpl_emdts"><div class="tooltip-js" data-position="bottom-left" title="'+currrentapplist.name+'"><b>'+currrentapplist.name+'&nbsp;&nbsp;&nbsp;(Current Approver)</b></div><div class="blu">'+ZPI18N.getString("zp.pending")+"</div>",apprSection+=apprLevel+=endApprDtls}if(void 0!==approvalDtl.pending){let pendinglist=approvalDtl.pending;for(let approverdtl=0;approverdtl<pendinglist.length;approverdtl++){let apprLevel=apprDtls;apprLevel+='<img src="'+pendinglist[approverdtl].photo+'"></div><div class="zpl_emdts"><div class="tooltip-js" data-position="bottom-left" title="'+pendinglist[approverdtl].name+'"><b>'+pendinglist[approverdtl].name+'</b></div><div class="blu">'+ZPI18N.getString("zp.pending")+"</div>",apprSection+=apprLevel+=endApprDtls}}return apprSection+="</div></div></div></div>",printDiv.getElementById("sectionsparent").insertAdjacentHTML("afterend",apprSection),{draft:!1,newContentWithApprData:printDiv.documentElement.outerHTML}}return{draft:!0,newContentWithApprData:newContent}}}},ZPA_ChecklistActivity={CHECKLIST_MODE:"checklist",TRACK_CHKLST_MODE:"trackchecklist",RELATED_CHKLST_MODE:"relatedchecklist",PENDING_CHECKLIST_MODE:"pendingchecklist",COMPLETED_CHECKLIST_MODE:"completedchecklist",loadHeader:function(){var pageId=Layout.Page.container;pageId.attr("scroll","enabled"),pageId.closest(".zpl_container").addClass("chclstptch"),pageId.find("#topSettMenu").removeClass("zp_dyn"),pageId.append(ZPA_ChecklistActivity.getWrapperContainerDiv()),Layout.Page.container.closest(".zpl_iwrpr").attr("tabindex","0"),Layout.Page.container.closest(".zpl_iwrpr").attr("aria-label",ZPI18N.getString("zp.common.tabname",[$("#tltabcontainer li.zpl_act a").text()])),ChecklistFilter.construct()},fireScrollChklstRouting:function(){var url=Layout.Page.hash;-1!==url.indexOf("checklist/trackchecklist")?ZPA_ChecklistActivity.loadChecklist(void 0,void 0,!0):-1!==url.indexOf("checklist/relatedchecklist")?ZPA_ChecklistActivity.loadChecklist(!0,void 0,!0):-1===url.indexOf("checklist/pending")&&-1===url.indexOf("checklist/completed")||ZPA_ChecklistActivity.loadOperationChecklist(void 0,!0)},loadInitChecklist:function(){ZPA_ChecklistActivity.loadHeader(),ZPA_ChecklistActivity.loadChecklist()},loadInitRelatedChecklist:function(){ZPA_ChecklistActivity.loadHeader(),ZPA_ChecklistActivity.loadChecklist(!0)},loadChecklist:function(isRelated,filterJson,isFireSB){var pageId=ZPA_ChecklistActivity.getPageId(),params={mode:"all",conreqcsr:csrfToken,mode:"pending"};params.index=isFireSB?pageId.find("#"+ZPA_ChecklistActivity.getPageMode()+"_List").children().length:1;params.method="getMyChecklistReq",ZPA_Common.isNotNull(isRelated)&&isRelated&&(params.isRelated=!0),ZPA_Common.isNotNull(filterJson)&&(filterJson.hasOwnProperty("chklstName")&&(params.searchString=filterJson.chklstName),filterJson.hasOwnProperty("relFormIds")&&(params.formId=filterJson.relFormIds),filterJson.hasOwnProperty("status")&&(params.mode=filterJson.status),filterJson.hasOwnProperty("erecno")&&(params.erecno=filterJson.erecno)),ZPeople.Request.send("/getMyChecklistReq.zp",params,function(resultArr){ZPA_ChecklistActivity.constructChecklist(resultArr,isFireSB)})},loadInitOperChklist:function(){ZPA_ChecklistActivity.loadHeader(),ZPA_ChecklistActivity.loadOperationChecklist()},loadOperationChecklist:function(filterJson,isFireSB){var pageId=ZPA_ChecklistActivity.getPageId(),params={mode:"all",conreqcsr:csrfToken};ZPA_ChecklistActivity.getPageMode()==ZPA_ChecklistActivity.PENDING_CHECKLIST_MODE?params.mode="pending":params.mode="completed",isadmin&&(url="/getAdminChecklistReq.zp",params.method="getAdminChecklistReq"),params.index=isFireSB?pageId.find("#"+ZPA_ChecklistActivity.getPageMode()+"_List").children().length:1,ZPA_Common.isNotNull(filterJson)&&(filterJson.hasOwnProperty("chklstName")&&(params.searchString=filterJson.chklstName),filterJson.hasOwnProperty("relFormIds")&&(params.formId=filterJson.relFormIds),filterJson.hasOwnProperty("status")&&(params.mode=filterJson.status),filterJson.hasOwnProperty("erecno")&&(params.erecno=filterJson.erecno)),ZPeople.Request.send(url,params,function(resultArr){ZPA_ChecklistActivity.constructChecklist(resultArr,isFireSB)})},constructChecklist:function(checklistArr,isFireSB){var pageId=ZPA_ChecklistActivity.getPageId();if(ZPA_Common.isNotNull(checklistArr)&&checklistArr.length>0){var chkBody="";isFireSB||(chkBody=ZPA_ChecklistActivity.getChecklistHeader()),$.each(checklistArr,function(index,chkObj){void 0!==chkObj.related_recordOwnerDetails&&(chkBody+=ZPA_ChecklistActivity.getChecklistCardList(chkObj,!1))}),25===checklistArr.length&&ZPeople.FireScroll.reset(),isFireSB||(pageId.find("#"+ZPA_ChecklistActivity.getPageMode()+"_List").empty(),pageId.find("#"+ZPA_ChecklistActivity.getPageMode()+"_List").attr("aria-label",ZPI18N.getString("zp.proceedingchklst"))),pageId.find("#"+ZPA_ChecklistActivity.getPageMode()+"_List").append(chkBody)}else isFireSB||(pageId.find("#"+ZPA_ChecklistActivity.getPageMode()+"_List").attr("aria-label",ZPI18N.getString("zp.nomatchchklst")),ZPA_ChecklistActivity.loadEmptyPage())},loadEmptyPage:function(){var pageId=ZPA_ChecklistActivity.getPageId();let emptyMsg=ZPA_ChecklistActivity.isFilterApplied(pageId)?ZPI18N.getString("zp.nomatchchklst"):ZPI18N.getString("zp.nochecklistforfilter");new EmptyPages("zp_nd_nodata",emptyMsg,"",pageId.find("#"+ZPA_ChecklistActivity.getPageMode()+"_List")).show()},isFilterApplied:function(pageId){return pageId.find("[name=chkFilterHeader]").find("ul").find("li").length>0},getChecklistRootTask:function(chkRow,chkRootId,isRecChklist){ZPA_ChecklistActivity.getPageId();if(!$(chkRow).data("isexpanded")){$(chkRow).data("isexpanded",!0);var params={method:"getCheckRootTasks",checkitemrootid:chkRootId,conreqcsr:csrfToken};ZPeople.Request.send("/getCheckRootTasks.zp",params,function(respData){ZPA_ChecklistActivity.constructTaskTree($(chkRow),respData.tasks,chkRootId,isRecChklist),$(chkRow).off().on("click",function(){$(chkRow).siblings("[checkrootid="+chkRootId+"]").slideToggle("slow")})},{},(data,params,others)=>{ServiceApplicabilityUtil.Error.showWarningMessage(data,params,others)})}},constructTaskTree:function(chkRow,taskArr,chkRootId,isRecChklist){ZPA_ChecklistActivity.getPageId();let chkRootRow="";if(taskArr.length>0){let taskJObj={};for(var index=0;index<taskArr.length;index++){var taskObj=taskArr[index];let taskid=taskObj.id;taskJObj[taskid]=taskObj;let ptId="",dispTime=void 0===taskObj.dispCompletedTime?taskObj.endtime:taskObj.dispCompletedTime,isSubTask=(taskObj.iscompleted,void 0!==taskObj.parenttaskid&&0!=taskObj.parenttaskid);if(void 0==taskObj.taskownerdetail){taskObj.assignedto;var imgSrc='<div name="pickBtn" class="PI_usr"></div>'}else taskObj.taskownerdetail.employeeID,taskObj.taskownerdetail.name,imgSrc='<div class="zpl_em">'+ZPA_ChecklistActivity.getEmpPhotoHtml(taskObj.taskownerdetail.employeePhoto,taskObj.taskownerdetail.zuid)+"</div>";let taskListHtml=ZPA_ChecklistActivity.getTaskRowHtml(taskid,taskObj,ptId,dispTime,imgSrc,isRecChklist);if(chkRootRow=chkRow.siblings("[checkrootid="+chkRootId+"]"),isSubTask)0!=chkRootRow.find("[taskid="+taskObj.parenttaskid+"]").length?0==chkRootRow.find("[taskid="+taskObj.parenttaskid+"]").next(".zpl_crdtmln").length?chkRootRow.find("[taskid="+taskObj.parenttaskid+"]").after('<div class="zpl_crdlst zpl_crdtmln" checkrootid='+chkRootId+">"+taskListHtml+"</div>"):chkRootRow.find("[taskid="+taskObj.parenttaskid+"]").next().append(taskListHtml):taskArr.push(taskObj);else{let taskAppendRow=0==chkRootRow.length?chkRow:chkRootRow.last();$(taskAppendRow).after('<div class="zpl_crdlst zpl_crdtmln" checkrootid='+chkRootId+">"+taskListHtml+"</div>")}}$.each(chkRootRow.find(".zpl_catlst"),function(index,taskRow){$(taskRow).find(".zpl_tckchng").hasClass("PI_tick2_fil")||$(taskRow).next(".zpl_crdlst").find(".zpl_catlst").addClass("disabled pnone")})}},deleteChecklistConfirmation:function(delIcObj){event.stopPropagation();var alertMsgObj=new DeleteAlertMessage(ZPI18N.getString("zp.delchk"),ZPI18N.getString("zp.delchkdesc"));alertMsgObj.setCallback(ZPA_ChecklistActivity.deleteChecklist),alertMsgObj.yesButtonText=ZPI18N.getString("zp.confirm"),alertMsgObj.delIcObj=delIcObj,alertMsgObj.show()},deleteChecklist:function(thisObj){var delIcObj=thisObj.delIcObj,params={method:"deleteCheckListRoot",rootID:$(delIcObj).closest("[chkrootid]").attr("chkrootid")};ZPeople.Request.send("/deleteCheckListItemRoot.zp",params,ZPA_ChecklistActivity.removeChecklistRow,{},(data,params,others)=>{ServiceApplicabilityUtil.Error.showWarningMessage(data,others,params)})},removeChecklistRow:function(data,params){var pageId=ZPA_ChecklistActivity.getPageId();data.success?pageId.find("[chkRootId="+params.rootID+"]").remove():void 0!=data.msg?ZPeople.Message.failure(data.msg):ZPeople.Message.failure(data.message)},getTaskRowHtml:function(taskId,taskObj,parTaskId,dispTime,imgSrc,isRecChklist){var isCompleted=taskObj.iscompleted,taskName=taskObj.name,color=TaskCommon.getStatusColor(taskObj.statusSysValue);let completeClass=isCompleted?"PI_tick2_fil":"PI_tick2";return'<div class="zpl_catlst" taskid="'+taskId+'" ptId="'+parTaskId+'" onclick="TaskCommon.openViewTask(\''+taskId+"', '"+isRecChklist+`')">\n\t\t\t\t\t<div><i class="zpl_tckchng zpl_act mw50 ${taskObj.statusSysValue==TaskStatus.NA_SYSVALUE?"zpl_disabl-pe":""} ${completeClass}" title="`+(isCompleted?ZPI18N.getString("zp.reopen"):ZPI18N.getString("zp.complete"))+'" onclick="TaskCommon.changeStatus(this, \''+taskId+'\', \'checklist\')"></i></div>\n\t\t\t\t\t<div class="zpl_tsklstnme zpl_ellipsis">\n                        <div class="zpl_em">\n                            <div class="zpl_emdts zpl_ellipsis">\n                                <div title="'+taskName+'"><b>'+taskName+'</b></div>\n                                <div class="d-flexC"><em>'+dispTime+`</em></div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="mw200 zpl_flex-a-c"><div class="zpl_em"><div name="tStatus" class=${color}>${taskObj.status}</div></div></div>\n                    <div class="mw200 zpl_flex-a-c"><div class="zpl_em">`+imgSrc+'</div></div>\n                    <div class="zpl_tskaction mw150"><div class="zpl_hvr "><i class="PI_delete" onclick=TaskCommon.deleteTaskConfirmation(this) title="'+ZPI18N.getString("zp.delete")+'"></i></div></div>\n\t\t\t\t</div>'},getEmpPhotoHtml:function(photoUrl,zuid){return'<div class="zpl_emimg" popup="user" empid="'+zuid+'"><img src="'+photoUrl+'"></div>'},getChecklistCardList:function(chkObj,isRecChklst){let chkRootId=chkObj.checkItemRootId,relRecOwn=chkObj.related_recordOwnerDetails,chkName=chkObj.checklistName,taskCount=chkObj.taskcount,initiatedOn=chkObj.initiatedOn,formName=chkObj.formName,formId=chkObj.formId,recId=chkObj.recordId,progressPercent=taskCount.completed/taskCount.total*100,formDiv=isRecChklst?"":'<span class="zpl_dots"></span><a onclick="ZPA_Common.viewRecord(\''+formId+"', '"+recId+'\')" title="'+formName+'">'+formName+"</a>";return`<div class="zpl_crdlst zpl_crdlstrow zpl_crdtmln">\n\t\t\t\t\t<div class="zpl_catlst" tabindex="0" aria-label="${ZPI18N.getString("zp.checklist.name")} : ${chkName}. ${ZPA_Common.isNotNull(relRecOwn.name)?ZPI18N.getString("zp.taskowner")+" : "+relRecOwn.name:""}. ${ZPA_Common.isNotNull(initiatedOn)?ZPI18N.getString("zp.duedate")+":"+initiatedOn+".":""} ${ZPA_Common.isNotNull(taskCount)?ZPI18N.getString("zp.status")+" : "+ZPI18N.getString("zp.numberoftaskcompleted",[taskCount.completed,taskCount.total]):""}" chkrootid='`+chkRootId+"' onclick=\"ZPA_ChecklistActivity.getChecklistRootTask(this, '"+chkRootId+"', "+isRecChklst+')">\n\t\t\t\t\t\t<div class="zpl_tsklstnme zpl_ellipsis">\n\t\t\t\t\t\t\t<div class="zpl_em">\n\t\t\t\t\t\t\t\t'+ZPA_ChecklistActivity.getEmpPhotoHtml(relRecOwn.employeePhoto,relRecOwn.zuid)+'\n\t\t\t\t\t\t\t\t<div class="zpl_emdts zpl_ellipsis">\n\t\t\t\t\t\t\t\t\t<div><b>'+chkName+'</b></div>\n\t\t\t\t\t\t\t\t\t<div class="d-flexC"><em>'+relRecOwn.employeeID+" - </em> <span>"+relRecOwn.name+'</span><span class="zpl_dots"></span> <em class="red">'+initiatedOn+"</em>"+formDiv+'</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="mw200" status="'+chkRootId+'">\n\t\t\t\t\t\t\t<span class="zpl_progtitle" ><span name="comp_taskcount">'+taskCount.completed+'</span>/<span name="tot_taskcount">'+taskCount.total+" </span><span>"+ZPI18N.getString("zp.completed")+'</span></span>\n\t\t\t\t\t\t\t<div class="zprogress" style="background:#DBDBDB; min-width:150px"><div class="zprogress__bar" style="background:#50C173; width: '+progressPercent+'%;"></div></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="zpl_tskaction mw150">\n\t                        <div class="zpl_hvr "><i class="PI_delete" onclick="ZPA_ChecklistActivity.deleteChecklistConfirmation(this)" title="'+ZPI18N.getString("zp.delete")+'"></i></div>\n\t                    </div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>'},getChecklistHeader:function(){return'<div class="zpl_crdlst zpl_crdlsthdr"><div class="zpl_catlst"><div class="zpl_tsklstnme"><h5>'+ZPI18N.getString("zp.checklist")+'</h5></div><div class="mw200">'+ZPI18N.getString("zp.status")+'</div><div class="mw150 zpl_tskaction"></div></div></div>'},getWrapperContainerDiv:function(){return`<div class="zpl_btnmnu"><div class="zpl_rgt"><i class="zpl_ibg PI_fltr"  id="filter" tabindex="0" aria-label="${ZPI18N.getString("zp.filter")}" onclick="ChecklistFilter.showHide()" title="`+ZPI18N.getString("zp.filter")+'" ></i></div></div>\n\t\t\t\t<div class="zpl_fltrvw DNI" name="chkFilterHeader"><div name="filterResults"><ul class="zpl_fltrvwlst" tabindex="0" role="tab"></ul></div><div class="d-flexcap MLauto"><a class="red" name="resetFilter" onclick="ChecklistFilter.clearAllFilterResult()">'+ZPI18N.getString("zp.clearAll")+'</a></div></div>\n\t\t\t\t<div class="zpl_rgtcnt" id="'+ZPA_ChecklistActivity.getPageMode()+'_List" tabindex="0"></div>\n\t\t\t\t'+ChecklistFilter.getHtml(ZPA_ChecklistActivity.getPageMode())},getPageMode:function(){let pageMode="",pageHash=Layout.Page.hash;return-1!=pageHash.indexOf(ZPA_ChecklistActivity.TRACK_CHKLST_MODE)?pageMode=ZPA_ChecklistActivity.TRACK_CHKLST_MODE:-1!=pageHash.indexOf(ZPA_ChecklistActivity.RELATED_CHKLST_MODE)?pageMode=ZPA_ChecklistActivity.RELATED_CHKLST_MODE:-1!=pageHash.indexOf("task/checklist/pending")?pageMode=ZPA_ChecklistActivity.PENDING_CHECKLIST_MODE:-1!=pageHash.indexOf("task/checklist/complete")&&(pageMode=ZPA_ChecklistActivity.COMPLETED_CHECKLIST_MODE),pageMode},getPageId:function(){return $("#"+Layout.Page.pageId)},getChecklistsForRecord:function(){var params={method:"getCheckItemRootDetails",recordId:ZP5Form.getFormClassObj().getParams().recordId,conreqcsr:csrfToken};ZPeople.Request.send("/getCheckitemRootDetails.zp",params,function(data){var tab=new Tab;tab.id="recordChecklist",tab.cardId="recChk_cards";var chk_Sli=new sliderModal(ZPI18N.getString("zp.workflow.checklist"),tab);chk_Sli.largeSize=!0,chk_Sli.isAppendToBody=!0,chk_Sli.setHeadFootContent(void 0,""),chk_Sli.construct(),chk_Sli.setCloseCallback(function(){chk_Sli.remove()});var pageId=Layout.Page.hashDtl&&Layout.HashConfigUtil.isSettingsLayout(Layout.Page.hashDtl)?settingsPage.container:$("body #modal_Container").find("#recordChecklist");pageId.find(".zpl_minr").addClass("tskptch"),pageId.find("#sliFootDiv").remove(),pageId.find("#recChk_cards").addClass("chclstpth"),ZPA_ChecklistActivity.constructRecordChecklist(data,pageId)},{},(data,params,others)=>{ServiceApplicabilityUtil.Error.showWarningMessage(data,params,others)})},constructRecordChecklist:function(checklistArr,pageId){if(ZPA_Common.isNotNull(checklistArr)&&checklistArr.length>0){var chkBody="";chkBody=ZPA_ChecklistActivity.getChecklistHeader(),$.each(checklistArr,function(index,chkObj){void 0!==chkObj.related_recordOwnerDetails&&(chkBody+=ZPA_ChecklistActivity.getChecklistCardList(chkObj,!0))}),pageId.find("#recChk_cards").empty(),pageId.find("#recChk_cards").append(chkBody)}else new EmptyPages("zp_nd_nodata",ZPI18N.getString("zp.nochkforrec"),"",pageId.find("#recChk_cards")).show()}},ChecklistFilter={isStatusFilterAllowed:function(){return ZPA_ChecklistActivity.getPageMode()!=ZPA_ChecklistActivity.PENDING_CHECKLIST_MODE&&ZPA_ChecklistActivity.getPageMode()!=ZPA_ChecklistActivity.COMPLETED_CHECKLIST_MODE},construct:function(){var pageId=ZPA_ChecklistActivity.getPageId();if(ChecklistFilter.isStatusFilterAllowed()){var statusArr=[];statusArr.push({id:"all",value:ZPI18N.getString("zp.all")}),statusArr.push({id:"completed",value:ZPI18N.getString("zp.completed")}),statusArr.push({id:"pending",value:ZPI18N.getString("zp.pending")});var statusProp={options:statusArr,selectedValue:"",dataMapping:{label:"value",value:"id"}};ZPA_Common.ZCompProp.loadSelectListProp(statusProp),ZPeopleComponents.select(pageId.find("[name=status]"),statusProp)}var chklstIniProp={dataMapping:{value:"id",label:"value",image:"image"},showSearchField:!0};chklstIniProp.dataSource={search:param=>new Promise(function(search,reject){search({delay:20,results:EmployeeSearch.getEmpList(param.query,"emp","TASKS_VIEW"),selectedIndex:erecno,more:!1})}),paginated:!0},chklstIniProp.serverSearch=!0,chklstIniProp.cacheData=!0,chklstIniProp.contentType="image-text",chklstIniProp.search={by:["value","email"]},chklstIniProp.multiple=!0,ZPA_Common.ZCompProp.loadSelectListProp(chklstIniProp,!0),ZPeopleComponents.select(pageId.find("[name=chklst_initiator]"),chklstIniProp);var formArr=[];ZPA_Common.getFormList(ZPA_ChecklistActivity.CHECKLIST_MODE),$.each(ZPA_Common[ZPA_Common.getFormListMode(ZPA_ChecklistActivity.CHECKLIST_MODE)],function(key,value){var param={id:value.formId,value:value.dispName};formArr.push(param)});var relFormProp={options:formArr,selectedValue:"",multiple:!0,dataMapping:{label:"value",value:"id",title:"value"}};ZPA_Common.ZCompProp.loadSelectListProp(relFormProp),ZPeopleComponents.select(pageId.find("[name=rel_forms]"),relFormProp)},show:function(pageContDiv){pageContDiv.addClass("zpl_fltr_flt"),pageContDiv.find("#chklstFilter").focus()},hide:function(pageContDiv){pageContDiv.removeClass("zpl_fltr_flt"),pageContDiv.find("#filter").focus()},showHide:function(){var pageId=ZPA_ChecklistActivity.getPageId();pageId.hasClass("zpl_fltr_flt")?ChecklistFilter.hide(pageId):(ChecklistFilter.show(pageId),pageId.on("keydown",function(e){"Escape"===e.key&&(ChecklistFilter.hide(pageId),pageId.off("keydown"))}))},clearAllFilterResult:function(){ChecklistFilter.resetFilter(),ChecklistFilter.applyFilter()},resetFilter:function(){let filterCont=ZPA_ChecklistActivity.getPageId().find("[name=chklstFilter]");filterCont.find("[name=chklst_name]").val(""),ChecklistFilter.isStatusFilterAllowed()&&ZPeopleComponents.select(filterCont.find("[name=status]")).deselectAllOptions(),ZPeopleComponents.select(filterCont.find("[name=rel_forms]")).deselectAllOptions(),ZPeopleComponents.select(filterCont.find("[name=chklst_initiator]")).deselectAllOptions()},applyFilter:function(){let pageMode=ZPA_ChecklistActivity.getPageMode(),pageId=ZPA_ChecklistActivity.getPageId(),filterCont=pageId.find("[name=chklstFilter]"),chklstName=filterCont.find("[name=chklst_name]").val(),relFormIds=ZPeopleComponents.select(filterCont.find("[name=rel_forms]")).getValue().toString(),chklst_init_Ids=ZPeopleComponents.select(filterCont.find("[name=chklst_initiator]")).getValue().toString(),filterJObj={};if(ZPA_Common.isNotNull(chklstName)&&(filterJObj.chklstName=chklstName),ChecklistFilter.isStatusFilterAllowed()){var statusId=ZPeopleComponents.select(filterCont.find("[name=status]")).getValue().toString();if(ZPA_Common.isNotNull(statusId)){filterJObj.status=statusId;var statusDispName="";let statusList=ZPeopleComponents.select(filterCont.find("[name=status]")).getOptionData();$.each(statusList,function(ind,statusObj){-1!=statusId.indexOf(statusObj.id)&&(statusDispName+=statusObj.value)})}}if(ZPA_Common.isNotNull(relFormIds)){filterJObj.relFormIds=relFormIds;var formDispNames="";let formsList=ZPeopleComponents.select(filterCont.find("[name=rel_forms]")).getOptionData();$.each(formsList,function(ind,formObj){-1!=relFormIds.indexOf(formObj.id)&&(ZPA_Common.isNotNull(formDispNames)&&(formDispNames+=", "),formDispNames+=formObj.value)})}if(ZPA_Common.isNotNull(chklst_init_Ids)){filterJObj.erecno=chklst_init_Ids;var chklst_init_names="";let chklst_initiator_List=ZPeopleComponents.select(filterCont.find("[name=chklst_initiator]")).getOptionData();$.each(chklst_initiator_List,function(ind,chkInitObj){-1!=chklst_init_Ids.indexOf(chkInitObj.id)&&(ZPA_Common.isNotNull(chklst_init_names)&&(chklst_init_names+=", "),chklst_init_names+=chkInitObj.value)})}ChecklistFilter.constructFilterResult(chklstName,statusDispName,formDispNames,chklst_init_names),ChecklistFilter.hide(pageId),pageMode==ZPA_ChecklistActivity.TRACK_CHKLST_MODE?ZPA_ChecklistActivity.loadChecklist(!1,filterJObj):pageMode==ZPA_ChecklistActivity.RELATED_CHKLST_MODE?ZPA_ChecklistActivity.loadChecklist(!0,filterJObj):pageMode!=ZPA_ChecklistActivity.PENDING_CHECKLIST_MODE&&pageMode!=ZPA_ChecklistActivity.COMPLETED_CHECKLIST_MODE||ZPA_ChecklistActivity.loadOperationChecklist(filterJObj)},constructFilterResult:function(chklstName,statusDispName,formDispNames,chklst_init_names){let chklstFilterHead=ZPA_ChecklistActivity.getPageId().find("[name=chkFilterHeader]");chklstFilterHead.hasClass("DNI")&&chklstFilterHead.removeClass("DNI"),chklstFilterHead.find("ul").empty(),ZPA_Common.isNotNull(chklstName)&&chklstFilterHead.find("ul").append("<li fil_name=\"chklst_name\" tabindex='0' role='tab'><label>"+ZPI18N.getString("zp.checklist.name")+" : </label><span title='"+ZPA_Common.encodeHtml(chklstName)+"'>"+ZPA_Common.encodeHtml(chklstName)+"</span><a class='PI_cls' onclick='ChecklistFilter.removeFilterTag(this)' title='"+ZPI18N.getString("zp.clear")+"' tabindex='0'></a></li>"),ZPA_Common.isNotNull(statusDispName)&&chklstFilterHead.find("ul").append("<li fil_name=\"status\" tabindex='0' role='tab'><label>"+ZPI18N.getString("zp.status")+" : </label><span title='"+statusDispName+"'>"+statusDispName+"</span><a class='PI_cls' onclick='ChecklistFilter.removeFilterTag(this)' title='"+ZPI18N.getString("zp.clear")+"' tabindex='0'></a></li>"),ZPA_Common.isNotNull(formDispNames)&&chklstFilterHead.find("ul").append("<li fil_name=\"rel_forms\" tabindex='0' role='tab'><label>"+ZPI18N.getString("zp.relatedforms")+" : </label><span title='"+ZPA_Common.encodeHtml(formDispNames)+"'>"+ZPA_Common.encodeHtml(formDispNames)+"</span><a class='PI_cls' onclick='ChecklistFilter.removeFilterTag(this)' title='"+ZPI18N.getString("zp.clear")+"' tabindex='0'></a></li>"),ZPA_Common.isNotNull(chklst_init_names)&&chklstFilterHead.find("ul").append("<li fil_name=\"chklst_initiator\" tabindex='0' role='tab'><label>"+ZPI18N.getString("zp.checklistinitiator")+" : </label><span title='"+chklst_init_names+"'>"+chklst_init_names+"</span><a class='PI_cls' onclick='ChecklistFilter.removeFilterTag(this)' title='"+ZPI18N.getString("zp.clear")+"' tabindex='0'></a></li>"),0==chklstFilterHead.find("ul li").length&&chklstFilterHead.addClass("DNI")},removeFilterTag:function(thisObj){let filterCont=ZPA_ChecklistActivity.getPageId().find("[name=chklstFilter]"),filterName=$(thisObj).parent().attr("fil_name");ZPA_Common.isNotNull(filterName)&&"chklst_name"==filterName?filterCont.find("[name=chklst_name]").val(""):ZPeopleComponents.select(filterCont.find("[name="+filterName+"]")).deselectAllOptions(),ChecklistFilter.applyFilter()},getHtml:function(mode){let statusHtml=ChecklistFilter.isStatusFilterAllowed()?'<div class="zpl_secn">\n\t\t                                    \t<div><label>'+ZPI18N.getString("zp.status")+"</label></div>\n\t\t\t\t                            \t<div><select name='status'></select></div>\n\t\t\t\t                    </div>":"",filterHtml='<div class="zpl_fltr" name="chklstFilter">\n\t\t\t\t\t\t\t<div name="fltrheader">\n\t\t\t\t\t\t\t\t\t<div class="zpl_fltrhd">\n\t\t                       \t\t\t <h5>'+ZPI18N.getString("zp.filter")+'</h5><i class="PI_cls" onclick="ChecklistFilter.showHide()"></i>\n\t\t                   \t\t\t </div>\n\t\t                   \t\t\t <div class="zpl_search zpl_srchsml">\n\t\t                        \t\t<input name="chklst_name" placeholder="'+ZPI18N.getString("zp.emptychkname")+'" type="search" class="ztextbox"><i class="PI_lens"></i>\n\t\t                    \t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="zpl_fltrcnt"><div class="zpl_fltrlst">\n\t\t\t\t\t\t\t\t\t'+statusHtml+'\n\t\t\t\t                    <div class="zpl_secn">\n\t\t                                    \t<div><label>'+ZPI18N.getString("zp.relatedforms")+"</label></div>\n\t\t\t\t                            \t<div><select name='rel_forms'></select></div>\n\t\t\t\t                    </div>\n\t\t                            <div class=\"zpl_secn\">\n\t\t                                    \t<div><label>"+ZPI18N.getString("zp.checklistinitiator")+"</label></div>\n\t\t\t\t                            \t<div><select name='chklst_initiator'></select></div>\n\t\t\t\t                     </div>\n\t\t\t\t\t\t\t\t</div></div>";return filterHtml+='<div><button name="applyButton" type="button" class="zlabel zlabel--blue zlabel--medium" onclick="ChecklistFilter.applyFilter()">'+ZPI18N.getString("zp.apply")+'</button><button name="resetButton" type="button" class="zlabel zlabel--outline zlabel--medium" onclick="ChecklistFilter.resetFilter()">'+ZPI18N.getString("zp.reset")+"</button></div></div>"}},ZPA_CusActOper={CUSTOMACTION:0,CUSTOMLINK:1,DOCUMENTDOWNLOAD:2,WIDGETS:3,constructCBListInViewForRecs:function(custActAry,recordObj){var cbHtml="",custBtnCnt=custActAry.length;for(let index=0;index<custActAry.length;index++){var custActObj=custActAry[index],custActId=custActObj.customActionId,custActName=custActObj.name,type=custActObj.type;0==index&&(cbHtml+="<button id='custAct_"+recordObj.recordId+"' data-menu-id='custActLi_Menu_"+recordObj.recordId+"' recordid='"+recordObj.recordId+"' data-value='0' custActId='"+custActId+"' custActType='"+type+"' class='zlabel zlabel--blue zlabel--outline zlabel--small' name='custAct_Li_Btn' data-size='small'>"+custActName+"</button>"),cbHtml+=0==index?"<ul id='custActLi_Menu_"+recordObj.recordId+"' name='custActMenu' style='display:none;''>":"",cbHtml+="<li  data-item-type='radio' name='custActLi' data-value='"+index+"' recordid='"+recordObj.recordId+"' custActId='"+custActId+"' custActType='"+type+"'>"+custActName+"</li>",index==custBtnCnt-1&&(cbHtml+="</ul>")}return cbHtml},constructCBListView:function(custActAry,recId,isOnlyCWF,viewId){var cbHtml="",custBtnCnt=custActAry.length;recId=isOnlyCWF?"":recId;for(let index=0;index<custActAry.length;index++){var custActObj=custActAry[index],custActId=custActObj.customActionId,custActName=custActObj.name,type=custActObj.type;0==index&&(cbHtml+="<button id='custAct_"+viewId+"' data-menu-id='custActMenu_"+viewId+"' recordid='"+viewId+"' data-value='0' custActId='"+custActId+"' custActType='"+type+"' class='zlabel zlabel--blue zlabel--outline zlabel--medium' name='custAct_Li_Btn' data-size='small'>"+custActName+"</button>"),cbHtml+=0==index?"<ul id='custActMenu_"+viewId+"' name='custActMenu' style='display:none;''>":"",cbHtml+="<li  data-item-type='radio' name='custActLi' data-value='"+index+"' recordid='"+recId+"' custActId='"+custActId+"' custActType='"+type+"'>"+custActName+"</li>",index==custBtnCnt-1&&(cbHtml+="</ul>")}return cbHtml},constructCBRecordView:function(recId,custActAry,pageId,headerElem){let custActBtnDefId="#zp_form_header";void 0!=headerElem&&(custActBtnDefId="#"+headerElem);var custActBtn=pageId.find(custActBtnDefId+" .zpl_mhderrgt [name=custAct_Li_Btn]"),custActBtnId=custActBtn.attr("id");if(custActBtn.remove(),pageId.find(custActBtnDefId+" .zpl_mhderrgt #"+custActBtnId+"Container").remove(),pageId.find(custActBtnDefId+" .zpl_mhderrgt [name=custActMenu]").remove(),!(void 0==custActAry||custActAry.length<=0)){var cbHtml="",custBtnCnt=custActAry.length;for(let index=0;index<custActAry.length;index++){var custActObj=custActAry[index],custActId=custActObj.customActionId,custActName=custActObj.name,type=custActObj.type;0==index&&(cbHtml+="<button id='custActRec_"+recId+"' data-menu-id='custActRecView_Menu_"+recId+"' recordid='"+recId+"' data-value='0' custActId='"+custActId+"' custActType='"+type+"' class='zlabel zlabel--blue zlabel--outline zlabel--small' name='custAct_Li_Btn' data-size='small'>"+custActName+"</button>"),cbHtml+=0==index?"<ul id='custActRecView_Menu_"+recId+"' name='custActMenu' style='display:none;''>":"",cbHtml+="<li  data-item-type='radio' name='custActLi' data-value='"+index+"' recordid='"+recId+"' custActId='"+custActId+"' custActType='"+type+"'>"+custActName+"</li>",index==custBtnCnt-1&&(cbHtml+="</ul>")}pageId.find(custActBtnDefId+" .zpl_mhderrgt a:first").before(cbHtml),1==custActAry.length?ZPeopleComponents.button(pageId.find("#custActRec_"+recordId),{size:"large",click:function(event,data){event.stopPropagation();var recordIds=recordId,custActId=$(this).attr("custactid"),type=$(this).attr("custacttype");ZPA_CusActOper.triggerCustomAction(custActId,recordIds,type,!1)}}):ZPeopleComponents.splitbutton(pageId.find("#custActRec_"+recordId),{width:"200px",isTextHTMLEncoded:!0,change:event=>{event.stopPropagation();var liItem=$(event.detail.selectedItem[0]);let recId=recordId;var custActId=liItem.attr("custactid"),type=liItem.attr("custacttype");ZPA_CusActOper.triggerCustomAction(custActId,recId,type,!1)},buttonclick:event=>{event.stopPropagation()},click:event=>{if(event.stopPropagation(),!event.detail.isMenuButton){var selBtn=event.detail.selectedItem[0];if(void 0!=selBtn.itemData){var selBtnAttr=selBtn.itemData.attrs;let recId=recordId;var custActId=selBtnAttr.custactid,type=selBtnAttr.custacttype;ZPA_CusActOper.triggerCustomAction(custActId,recId,type,!1)}else{let recId=recordId;custActId=$(selBtn).attr("custactid"),type=$(selBtn).attr("custacttype");ZPA_CusActOper.triggerCustomAction(custActId,recId,type,!1)}}}})}},triggerCustomAction:function(cbId,recId,type,isMassTrigger){if(ZPA_Common.isNotNull(cbId)&&ZPA_Common.isNotNull(type))if(parseInt(type)===ZPA_CusActOper.DOCUMENTDOWNLOAD){if(isMassTrigger&&recId.length>1)return void ZPeople.Message.failure(ZPI18N.getString("zp.ddsinglerecerror"));var params={customActionId:cbId,recordIds:recId=isMassTrigger?recId[0]:recId,method:"getCWFMap"};(alertMsgObj=new InfoAlertMessage(ZPI18N.getString("zp.ddoperhdr"),"")).yesButtonText=ZPI18N.getString("zp.confirm"),alertMsgObj.setCenterHtml(ZPeople.LOADING_HTML),alertMsgObj.show(),alertMsgObj.alertDiv.find("#yesBtn").addClass("DNI"),alertMsgObj.params=params,alertMsgObj.setCallback(ZPA_CusActOper.customDOCDownload),alertMsgObj.alertDiv.find(".zpl_mcnt").css("overflow","hidden"),alertMsgObj.params=params,ZPeople.Request.send("/getCWFMap.zp",params,function(data){ZPA_CusActOper.constructWFMapModal(data,params,alertMsgObj,isMassTrigger)},{},(data,params,others)=>{ServiceApplicabilityUtil.Error.showWarningMessage(data,params,others,(data,params,others)=>alertMsgObj.close())})}else if(parseInt(type)===ZPA_CusActOper.CUSTOMLINK){if(isMassTrigger&&recId.length>1)return void ZPeople.Message.failure(ZPI18N.getString("zp.linksingerecerror"));params={customActionId:cbId,recordIds:recId=isMassTrigger?recId[0]:recId};ZPeople.Request.send("/triggerCB.zp",params,ZPA_CusActOper.triggerAfter,{},(data,params,others)=>{ServiceApplicabilityUtil.Error.showWarningMessage(data,params,others)})}else if(parseInt(type)===ZPA_CusActOper.CUSTOMACTION){var alertMsgObj;params={customActionId:cbId,recordIds:recId=isMassTrigger?ZPA_CusActOper.convertStringArrayToCommaString(recId):recId,method:"getCWFMap"};(alertMsgObj=new InfoAlertMessage(ZPI18N.getString("zp.catrigger"),"")).yesButtonText=ZPI18N.getString("zp.confirm"),alertMsgObj.setCenterHtml(ZPeople.LOADING_HTML),alertMsgObj.show(),alertMsgObj.alertDiv.find("#yesBtn").addClass("DNI"),alertMsgObj.params=params,alertMsgObj.setCallback(ZPA_CusActOper.triggerCustomButton),alertMsgObj.alertDiv.find(".zpl_mcnt").css("overflow","hidden"),ZPeople.Request.send("/getCWFMap.zp",params,function(data){ZPA_CusActOper.constructWFMapModal(data,params,alertMsgObj)},{},(data,params,others)=>{ServiceApplicabilityUtil.Error.showWarningMessage(data,params,others,(data,params,others)=>alertMsgObj.close())})}else if(parseInt(type)===ZPA_CusActOper.WIDGETS){let failureCallback=(data,params,others)=>{ServiceApplicabilityUtil.Error.showWarningMessage(data,params,others)};params={customActionId:cbId,recordIds:recId=isMassTrigger?ZPA_CusActOper.convertStringArrayToCommaString(recId):recId};"undefined"==typeof ZPWidget?Layout.PageUtil.loadFiles(["sigmawidget.min.js"],function(){ZPeople.Request.send("/triggerCB.zp",params,ZPA_CusActOper.triggerAfter,{},failureCallback)}):ZPeople.Request.send("/triggerCB.zp",params,ZPA_CusActOper.triggerAfter,{},failureCallback)}else{params={customActionId:cbId,recordIds:recId};ZPeople.Request.send("/triggerCB.zp",params,ZPA_CusActOper.triggerAfter)}else if(!ZPUtil.Validation.isEmpty(cbId)&&!ZPUtil.Validation.isEmpty(recId)&&void 0===type){params={recordIds:recId,customActionId:cbId};ZPeople.Request.send("/triggerCB.zp",params,ZPA_CusActOper.triggerAfter)}},constructWFMapModal:function(data,params,alertMsgObj,isMassTrigger){var type=data.type;setTimeout(function(){if(type==ZPA_CusActOper.CUSTOMACTION)if(!data.singleRec||data.isRecordMatched){var mapHtml=ZPA_CusActOper.getWFmapModalHtml(data.CWFMap);alertMsgObj.alertDiv.find("p").html(ZPI18N.getString("zp.catrigdesc")),alertMsgObj._setCentrHtAftrLoad(mapHtml),alertMsgObj.alertDiv.find("#yesBtn").removeClass("DNI")}else alertMsgObj._setCentrHtAftrLoad(""),alertMsgObj.alertDiv.find("h3").text(ZPI18N.getString("zp.noactexec")),alertMsgObj.alertDiv.find("p").text(ZPI18N.getString("zp.noactionmatch"));else type==ZPA_CusActOper.DOCUMENTDOWNLOAD&&(data.isRecordMatched?(alertMsgObj._setCentrHtAftrLoad(""),alertMsgObj.alertDiv.find("p").html(ZPI18N.getString("zp.ddoperdesc")),alertMsgObj.alertDiv.find("#yesBtn").removeClass("DNI")):(alertMsgObj._setCentrHtAftrLoad(""),alertMsgObj.alertDiv.find("h3").remove(),alertMsgObj.alertDiv.find("p").html(ZPI18N.getString("zp.notempmatch"))))},500)},getWFmapModalHtml:function(wfMap){var keyNameJson={mailAlertIds:ZPI18N.getString("zp.mailalert"),fieldUpdateIds:ZPI18N.getString("zp.fieldupdates"),customfnIds:ZPI18N.getString("zp.customfunctions"),esignTempIds:ZPI18N.getString("zp.esignature"),checklistIds:ZPI18N.getString("zp.workflow.checklist"),postMessageIds:ZPI18N.getString("zp.postmessage")},urlModeJson={mailAlertIds:ZP_Automation_Mode.EMAILALERT,fieldUpdateIds:ZP_Automation_Mode.FIELDUPDATE,customfnIds:ZP_Automation_Mode.CUSTOMFUNCTION,esignTempIds:ZP_Automation_Mode.ESIGN,checklistIds:ZP_Automation_Mode.CHECKLIST,postMessageIds:"postmessage",recordTempIds:ZP_Automation_Mode.LETTERTEMPLATE},mapHtml="";return $.each(wfMap,function(key,wfMapList){mapHtml+=0!==wfMapList.length?'<div class="zpl_gbox wd100_per"><div class="zpl_gbxttl"><div><h4>'+keyNameJson[key]+"</h4></div></div>":"",$.each(wfMapList,function(ind,actionDtl){let tempName="checklistIds"===key||"mailAlertIds"===key||"esignTempIds"===key||"postMessageIds"===key?ZSEC.Encoder.encodeForHTML(this.tempName):this.tempName;if(isadmin||isManageAutoAdmin){let serviceName=ZP5Form.getCurrFormsOperation().getServiceName().toLowerCase();var href=ZPA_Common.getActionHref(serviceName,urlModeJson[key],this.tempId,this.FORMID);if(MP.Extension.isTestEnvironment()&&(href=location.origin+"/"+portalname+"/devv5"+href),isWebForm){let url=location.origin+"/"+portalName+"/zp"+href;mapHtml+='<div class="zpl_idiv whtbg"><div class="zpl_tg"><a  href="'+url+'" target="_blank" rel="noopener noreferrer">'+tempName+"</a></div></div>"}else mapHtml+='<div class="zpl_idiv whtbg"><div class="zpl_tg"><a '+(!1!==actionDtl.isEditable?"onclick=\"window.open('"+href+"')\"":"")+">"+tempName+"</a></div></div>"}else mapHtml+='<div class="zpl_idiv whtbg"><div class="zpl_tg"><a>'+tempName+"</a></div></div>"}),mapHtml+="</div>"}),mapHtml},triggerCustomButton:function(thisObj){var cbId=(params=thisObj.params).customActionId,params={recordIds:params.recordIds,customActionId:cbId};ZPeople.Request.send("/triggerCB.zp",params,ZPA_CusActOper.triggerAfter)},customDOCDownload:function(thisObj){var reqparams=thisObj.params,params="customActionId="+reqparams.customActionId+"&recordIds="+unescape(reqparams.recordIds);0===$(document.body).find("#zp_cbutton_form").length&&$("html body").append("<form id='zp_cbutton_form' style='display:none' method='Post' ></form>");var form=$($(document.body).find("#zp_cbutton_form")[0]);form.attr("action","triggerCBPdf.zp?"+params),form.find("input").remove(),form.append('<input type="hidden" value="'+csrfToken+'" name="'+csrfParamName+'"/>'),form.trigger("submit")},triggerAfter:function(data,params){if(ZPA_Common.isNotNull(data.error))ZPeople.Message.failure(data.error);else if(data.type===ZPA_CusActOper.CUSTOMLINK){data.response=ZPeople.decodeTxt(data.response);var url=data.result.url.match(/^http[s]*:\/\//)?data.result.url:"https://"+data.result.url;0===url.indexOf("http")&&(window.opener=null,window.open(url))}else if(data.type===ZPA_CusActOper.WIDGETS){var widgetContainer,custWidBdy=$("body #modal_Container"),widgetData=[];if(0==custWidBdy.find("#renderCustomWidgetModal").length){var widgetHtml='<div class="zpl_mdl zpl_mcenter zpl_mmd zpl_mopen" data-modal-box="renderWidgetModel" id="renderCustomWidgetModal"><div class="zpl_minr">  <div class="zpl_mhder"><div><h4>'+ZSEC.Encoder.encodeForHTML(data.widgetName)+'</h4></div><a class="_cls PI_cls" id="cbwid_closeRendering"></a></div><div class="zpl_mcnt zpl_fm"><div class="zpl_crd"><div class="zpl_crdcnt"  id="cbwidget_'+data.widgetId+'"></div></div></div></div>';widgetContainer=$(widgetHtml).appendTo(custWidBdy)}else custWidBdy.find("#renderCustomWidgetModal").addClass("zpl_mopen");if(widgetContainer.find("#cbwid_closeRendering").on("click",function(){widgetContainer.remove()}),"internal"==data.hosting)widgetData.push(data),widgetData.length>0&&ZPWidget.loadsWidget(widgetData);else{var iframe='<iframe src="'+data.url+'" width="100%" style="min-height:400px; border: 0;">';widgetContainer.find("#cbwidget_"+data.widgetId).append(iframe)}}else{var msg="scheduled"===data.action?ZPI18N.getString("zp.scheduledmsg"):ZPI18N.getString("zp.executedsuccessfully");ZPeople.Message.success(msg)}},convertStringArrayToCommaString:function(stringArray){var commaStr="";return $.each(stringArray,function(index,strValue){commaStr+=strValue+","}),commaStr.slice(0,commaStr.length-1)}},ZPA_BPOperation={BLUEPRINT_COMPONENTS:{},TransRelId:void 0,BLUEPRINT_COMPONENT_DATA:{},BLUEPRINT_RECORD_DTL:{},formObj:void 0,isBlueprintConfigured:function(formId){var isBlueprintConfigured=!1;return void 0!==ZP5Form.getFormsOperation(formId).getFormsDetailsMap()&&void 0!==ZP5Form.getFormsOperation(formId).getFormsDetailsMap().isBlueprintConfigured&&(isBlueprintConfigured=ZP5Form.getFormsOperation(formId).getFormsDetailsMap().isBlueprintConfigured),isBlueprintConfigured},getTransitions:function(formid,recordid,viewperm){if(this.formObj=ZP5Form.getFormClassObj(),ZPA_BPOperation.isBlueprintConfigured(formid)&&formid&&recordid&&(viewperm||isOperationalRoleAdmin||ZP5Form.getFormsOperation(formid).isAdditonalPermView())){var params={method:"mapBpgetTransitions",formId:formid,zp_recordId:recordid,viewperm:viewperm};ZPeople.Request.send("/processFlowAction.zp",params,function(resultData){ZPA_BPOperation.setTransitions(resultData)},null,function(resultData){void 0!=resultData&&resultData.hasOwnProperty("responseJSON")&&resultData.responseJSON.hasOwnProperty("code")&&"SERVICE_NOT_APPLICABLE"==resultData.responseJSON.code||ZPA_BPOperation.transitionErrMsg(resultData)})}},setTransitions:function(resultData){void 0==resultData[1]||void 0!=resultData[1]&&void 0==resultData[1].TransitionDetails?ZP5Form.getLayout().find("#transitionBar").addClass("DN"):0==resultData[0]||void 0!=resultData[1].TransitionDetails&&"Failure"==resultData[1].TransitionDetails.Status?ZPA_BPOperation.transitionErrMsg():ZPA_BPOperation.loadNextTransition(resultData[1])},loadNextTransition:function(result){var recordId=ZP5Form.getFormClassObj().getParams().recordId,formId=ZP5Form.getFormClassObj().getParams().formId,transitionResult=void 0!=ZPA_BPOperation.BLUEPRINT_RECORD_DTL[formId+"_"+recordId]?ZPA_BPOperation.BLUEPRINT_RECORD_DTL[formId+"_"+recordId].TransitionDetails:null;void 0!=result&&(transitionResult=result.TransitionDetails,ZPA_BPOperation.BLUEPRINT_RECORD_DTL[formId+"_"+recordId]={TransitionDetails:transitionResult});var currentStateName=transitionResult.CurrentState;ZPA_BPOperation.formObj.LAYOUT.find("#bp_transition").remove(),ZPA_BPOperation.formObj.LAYOUT.find("#zp_form_outer_container").before(ZPA_BPOperation.getBpContainer(ZPA_Common.encodeHtml(currentStateName)));var processFieldId=transitionResult.ProcessFieldId;transfieldName="",$.each(ZP5Form.FIELD_RECORD,function(index,field){void 0!=field.formComponentId&&transitionResult.ProcessFieldId==field.formComponentId&&(transfieldName=field.componentName)}),ZPA_BPOperation.createTransitionButtons(transitionResult,processFieldId,transfieldName)},createTransitionButtons:function(transitionResult,fcid,name){var Transitions=transitionResult.Transitions,transHTML="";ZP5Form.getFormClassObj().getParams().recordId,ZP5Form.getFormClassObj().getParams().formId;if(ZPA_BPOperation.lockField(transitionResult),void 0!=transitionResult.ProcessFieldId){var isEditable=!1;void 0!=ZP5Form.Field.getFieldValueData(transitionResult.ProcessFieldId)&&(isEditable=ZP5Form.Field.getFieldValueData(transitionResult.ProcessFieldId).isEditable);var recordDetails=ZP5Form.getSingleRecord().record.message.recordDetails,rulesArray=ZPFRulesNew.Evaluation.rulesArray,responseRuleObj={};rulesArray.length>0&&(responseRuleObj=ZPFRulesNew.constructActionElms(rulesArray));var isFieldAllowed=!0;if(!jQuery.isEmptyObject(responseRuleObj)&&$.inArray(transitionResult.ProcessFieldId,responseRuleObj.actionElms)>-1){var ruleId=responseRuleObj.actionElms.indexOf(transitionResult.ProcessFieldId),rule=responseRuleObj.rules[ruleId];isFieldAllowed=ZPFRulesNew.Evaluation.evaluateRuleForField(rule,recordDetails,transitionResult.ProcessFieldId)}if(isFieldAllowed){var transarr=[],transCount=0,accessibleFailedTransCount=0;$.each(Transitions,function(index){var transobj={};(this.isTransitionOwner||!this.isTransitionOwner&&this.checkPerm&&isEditable)&&(transHTML+='<a class="zlabel zlabel--blue zlabel--outline zlabel--small" transid="'+this.TransitionId+'" title="'+this.TransitionName+'" onclick="ZPA_BPOperation.blueprintValidation(\''+this.TransitionId+"',  '"+this.TransitionRelId+"');\"></a>",transobj.id=this.TransitionId,transobj.name=this.TransitionName,transarr.push(transobj),transCount++)}),$.each(transitionResult.FailedTransitions,function(index){(this.isTransitionOwner||!this.isTransitionOwner&&this.checkPerm&&isEditable)&&accessibleFailedTransCount++}),transCount>5&&(transHTML+="</span>"),ZPA_BPOperation.formObj.LAYOUT.find("#field_transbtn").html(transHTML),ZPeopleComponents.tooltip(ZPA_BPOperation.formObj.LAYOUT.find("#bp_transition"),{position:"bottom-right",displayType:"callout"});var transDiv=ZPA_BPOperation.formObj.LAYOUT.find("#field_transbtn");$.each(transarr,function(index,transition){transDiv.find("[transid="+transition.id+"]").text(transition.name)}),(0!=transCount||0!=accessibleFailedTransCount)&&(transCount>0||transitionResult.FailedTransitions.length>0)?(ZPA_BPOperation.formObj.LAYOUT.find("#bp_transition").removeClass("DN"),0==transCount&&transitionResult.FailedTransitions.length>0&&(transDiv.html(ZPI18N.getString("zp.notransitionmatchescriteria")),ZPA_BPOperation.formObj.LAYOUT.find("#bp_transition").removeClass("DN"))):ZPA_BPOperation.formObj.LAYOUT.find("#bp_transition").addClass("DN")}else ZPA_BPOperation.formObj.LAYOUT.find("#bp_transition").addClass("DN")}else ZPA_BPOperation.formObj.LAYOUT.find("#bp_transition").addClass("DN")},lockField:function(transitionResult){if(void 0!=transitionResult.unlockFieldId&&""!=transitionResult.unlockFieldId){ZPA_BPOperation.formObj.LAYOUT.find("#transitionBar").addClass("DN");var fcid=transitionResult.unlockFieldId;(fieldComp=ZPA_BPOperation.formObj.FIELD_LAYOUT.find("#zp_field_outer_"+fcid).parent()).find("#zp_formfield_lock_opt").length>0&&(fieldComp.find("#zp_formfield_lock_opt").remove(),ZP5Form.Field.getFieldValueData(fcid).blueprintField=!1,fieldComp.on("mouseenter",function(){ZP5Form.Field.Edit.showOption(this)}).on("mouseleave",function(){ZP5Form.Field.Edit.hideOption(this)}))}if(void 0!=transitionResult.ProcessFieldId&&""!=transitionResult.ProcessFieldId){fcid=transitionResult.ProcessFieldId;var fieldComp,lockObj=$('<b id="bp_lock" title="'+ZPI18N.getString("zp.lockfieldtitle")+'" class="PI_lock" blueprintField="true"></b>');(fieldComp=ZPA_BPOperation.formObj.LAYOUT.find("#zp_field_outer_"+fcid).parent()).find("#bp_lock").length>0||fieldComp.find("label").parent().append(lockObj),void 0!=ZP5Form.Field.getFieldValueData(fcid)&&(ZP5Form.Field.getFieldValueData(fcid).blueprintField=!0),fieldComp.find("#zp_formfield_edit_opt").parent().remove(),ZPA_BPOperation.formObj.isEditMode()&&fieldComp.find("input[type=radio]").length>0&&(fieldComp.find("input[type=radio]").attr("disabled",!0),radios=fieldComp.find("input[type=radio]"),$.each(radios,function(index,radio){$(radio).parent().addClass("gry")}))}},blueprintValidation:function(TransitionId,TransitionRelId,forwardErecno){ZPA_Common.Loader.add(ZPA_BPOperation.formObj.LAYOUT.find("#bp_transition"));var isLocationTrackingEnabled=!1;if(void 0!==ZP5Form.getCurrFormsOperation().getFormComponentData().formDetails&&(isLocationTrackingEnabled=ZP5Form.getCurrFormsOperation().getFormComponentData().formDetails.isLocationTrackingEnabled),isLocationTrackingEnabled){if((void 0==ZP5Form.isLocationPermissionEnabled||0==ZP5Form.isLocationPermissionEnabled)&&0!==Object.keys(Timetracker.location.latLongParam).length){var location_obj=Timetracker.location.latLongParam;location_obj.hasOwnProperty("latitude")&&null!==location_obj.latitude&&!isNaN(location_obj.latitude)&&location_obj.hasOwnProperty("longitude")&&null!==location_obj.longitude&&!isNaN(location_obj.longitude)&&location_obj.hasOwnProperty("accuracy")&&null!==location_obj.accuracy&&!isNaN(location_obj.accuracy)&&(ZP5Form.isLocationPermissionEnabled=!0)}if(void 0==ZP5Form.isLocationPermissionEnabled)return ZP5Form.isLocationPermissionEnabled=!1,void Timetracker.location.getLocation(ZPA_BPOperation.blueprintValidation,TransitionId,TransitionRelId,forwardErecno);if(!ZP5Form.isLocationPermissionEnabled)return void ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.enableaccesstolocation"))}var msg,fields;ZPA_BPOperation.BLUEPRINT_RECORD_DTL[ZP5Form.getFormClassObj().getParams().formId+"_"+ZP5Form.getFormClassObj().getParams().recordId].TransitionDetails.ProcessFieldId;if($.each(ZPA_BPOperation.BLUEPRINT_RECORD_DTL[ZP5Form.getFormClassObj().getParams().formId+"_"+ZP5Form.getFormClassObj().getParams().recordId].TransitionDetails.Transitions,function(index,transition){if((void 0!=transition.fields||void 0!=transition.InfoMessage)&&transition.TransitionId==TransitionId)return fields=transition.fields,transition.ToStateName,msg=transition.InfoMessage,!1}),void 0!=fields&&0!=fields.length||void 0!=msg&&0!=msg.length){var params={method:"fetchTransCompDtl",formId:ZP5Form.getFormClassObj().getParams().formId,zp_recordId:ZP5Form.getFormClassObj().getParams().recordId,transitionId:TransitionId};ZPeople.Request.sendRequest("/transitionAction.zp",params,"GET",function(resultData){ZPA_Common.Loader.remove(ZPA_BPOperation.formObj.LAYOUT.find("#bp_transition")),resultData[1].recDtl.TransitionDetails=ZPA_BPOperation.BLUEPRINT_RECORD_DTL[ZP5Form.getFormClassObj().getParams().formId+"_"+ZP5Form.getFormClassObj().getParams().recordId].TransitionDetails,ZPA_BPOperation.BLUEPRINT_RECORD_DTL[ZP5Form.getFormClassObj().getParams().formId+"_"+ZP5Form.getFormClassObj().getParams().recordId]=resultData[1].recDtl,ZPA_BPOperation.BLUEPRINT_COMPONENTS[ZP5Form.getFormClassObj().getParams().formId]=resultData[1].BpCompData,ZPA_BPOperation.BLUEPRINT_COMPONENTS[ZP5Form.getFormClassObj().getParams().formId].formDetails=ZP5Form.getCurrFormsOperation().getFormComponentData().formDetails,ZPA_BPOperation.transitionExecutionModal(TransitionId,TransitionRelId)},null,function(resultData){ZPA_BPOperation.transitionErrMsg(resultData)})}else ZPA_BPOperation.executeTransition(ZP5Form.getFormClassObj().getParams().formId,ZP5Form.getFormClassObj().getParams().recordId,TransitionRelId,function(){ZPA_Common.Loader.remove(ZPA_BPOperation.formObj.LAYOUT.find("#bp_transition"))},null,TransitionId,forwardErecno)},submit:function(formClassObj,save){$("#bpContentDiv #zp_quickadd_done").attr("disabled","disabled"),save?(formClassObj.IS_SUBMITNEW=!1,formClassObj.LAYOUT=Layout.Page.container.find("[bppopup=true]"),formClassObj.FIELD_LAYOUT=Layout.Page.container.find("[bppopup=true]"),$("[bppopup=true]").find(".modal-footer").addClass("DN"),ZP5Form.Record.validateAndSubmit()):this.ISBLUEPRINT&&(formClassObj.LAYOUT.closest("#blueprint_DurFld").remove(),formClassObj.BLUEPRINT_RECORD_DTL[formClassObj.getParams().formId+"_"+formClassObj.getParams().recordId]={TransitionDetails:ZPA_BPOperation.BLUEPRINT_RECORD_DTL[ZP5Form.getFormClassObj().getParams().formId+"_"+ZP5Form.getFormClassObj().getParams().recordId].TransitionDetails},ZP5Form.setViewMode(),ZP5Form.isrelfieldsingelrecview?(formClassObj.LAYOUT=Layout.Page.container.find("#zp_relfielsingle_record_"+formClassObj.getParams().formId),formClassObj.FIELD_LAYOUT=Layout.Page.container.find("#zp_relfielsingle_record_"+formClassObj.getParams().formId)):(formClassObj.LAYOUT=Layout.Page.container.find("#zp_addedit_record_"+formClassObj.getParams().formId),formClassObj.FIELD_LAYOUT=Layout.Page.container.find("#zp_addedit_record_"+formClassObj.getParams().formId)))},executeTransition:function(formId,recordId,transitionrelid,callback,position,transitionId,forwardErecno){var isLocationTrackingEnabled=!1;if(ZP5Form.getCurrFormsOperation().getFormsDetailsMap().hasOwnProperty(ZP5Form.getFormClassObj().getParams().formId)&&(isLocationTrackingEnabled=ZP5Form.getCurrFormsOperation().getFormsDetailsMap().isLocationTrackingEnabled),isLocationTrackingEnabled&&void 0==position)navigator.geolocation.getCurrentPosition(function(position){var obj={};obj.latitude=position.coords.latitude,obj.longitude=position.coords.longitude,ZPA_BPOperation.executeTransition(formId,recordId,transitionrelid,callback,obj,transitionId,forwardErecno)},ZP5Form.Record.errorForGetLatLang,{maximumAge:12e4});else{var params={zp_formId:formId,zp_recordId:recordId,method:"executeTransition",transitionRelId:transitionrelid,modBpTime:ZPA_BPOperation.BLUEPRINT_RECORD_DTL[ZP5Form.getFormClassObj().getParams().formId+"_"+ZP5Form.getFormClassObj().getParams().recordId].TransitionDetails.ClientModifiedTime};void 0!=position&&(params.latitude=position.latitude,params.longitude=position.longitude),void 0!=forwardErecno&&(params.forwardErecno=forwardErecno),ZPeople.Request.send("/processFlowAction.zp",params,function(resultData){if("Success"==resultData[1].Status&&1==resultData[0]){void 0!=callback&&callback();var bpFieldId=resultData[1].Transition.ProcessFieldId,newValue=resultData[1].Transition.newValueforField;if(void 0!=ZP5Form.Field.getFieldValueData(bpFieldId,!1))ZP5Form.Field.getFieldValueData(bpFieldId,!1).componentValue=newValue;ZP5Form.getFieldLayout().find("#zp_field_outer_"+bpFieldId+" span").html(ZSEC.Encoder.encodeForHTML(newValue)),params.zp_mode="updateRecord",ZPA_BPOperation.formObj.addUpdateRecordResponse(resultData[1].updateData,params),ZPA_BPOperation.getTransitions(ZP5Form.getFormClassObj().getParams().formId,ZP5Form.getFormClassObj().getParams().recordId,ZP5Form.getFormClassObj().FormOperations.getViewPerm())}else void 0!=callback&&callback(),params.zp_mode="updateRecord",resultData[1].updateData[0].isFromTransition=!0,resultData[1].updateData[0].transitionDetails={transitionId:transitionId,transitionRelId:transitionrelid},ZPA_BPOperation.formObj.addUpdateRecordResponse(resultData[1].updateData,params),ZPA_BPOperation.getTransitions(ZP5Form.getFormClassObj().getParams().formId,ZP5Form.getFormClassObj().getParams().recordId,ZP5Form.getFormClassObj().FormOperations.getViewPerm())},{},function(data,params,others){ServiceApplicabilityUtil.Error.showWarningMessage(data,params,others)||(ZPeople.Message.failure(ZPI18N.getString("zp.transfail")),ZPA_BPOperation.getTransitions(ZP5Form.getFormClassObj().getParams().formId,ZP5Form.getFormClassObj().getParams().recordId,ZP5Form.getFormClassObj().FormOperations.getViewPerm()))})}},transitionErrMsg:function(resultData){var errMsg=ZPI18N.getString("zp.transfetchfail");void 0!=resultData&&resultData.hasOwnProperty("responseJSON")&&resultData.responseJSON.hasOwnProperty("error")&&resultData.responseJSON.error.trim().length>0&&(errMsg=resultData.responseJSON.error),ZPeople.Message.showFailureMsg(errMsg),ZP5Form.getLayout().find("#transitionBar").addClass("DN")},getBpContainer:function(currentState){return'<div class="zpl_orgstrsec" id="bp_transition">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div><label>'+ZPI18N.getString("zp.currentstate")+" -</label><span>"+currentState+"</span></div>\n\t\t\t\t\t\t\t\t<div><label>"+ZPI18N.getString("zp.transitions")+' -</label><span id="field_transbtn"></span></div>\n\t\t\t\t\t\t\t\t<div><a onclick="ZPA_BPOperation.configureTransitions(true)" class="zlabel zlabel--blue zlabel--outline zlabel--small">'+ZPI18N.getString("zp.viewchart")+"</a></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>"},configureTransitions:function(state){if(state){var bpName=ZSEC.Encoder.encodeForHTML(ZPA_BPOperation.BLUEPRINT_RECORD_DTL[ZP5Form.getFormClassObj().getParams().formId+"_"+ZP5Form.getFormClassObj().getParams().recordId].TransitionDetails.ProcessName),tab=new Tab;tab.id="bpTrans",tab.cardId="bpTrans_Cards";var transModal=new popupModal(bpName,tab);transModal.largeSize=!0,transModal.setContainerAsBody(!0),transModal.construct(),transModal.sliderDiv.find(".zpl_mfoter").empty(),transModal.setCloseCallback(function(){transModal.remove()});var $execParam_cards=ZPA_Common.getPopUpId(transModal).find("#"+tab.cardId);ZPA_Common.setRelativeContainer($execParam_cards);ZP5Form.getFormClassObj().getParams().recordId,ZP5Form.getFormClassObj().getParams().formId;var transitionhtml='<div id="pb_configProcess" class="pR"><div id="configActionBpBody" class="pb_preview pb_scrollstyle oA">\n\t\t\t\t\t<table cellpadding="0" cellspacing="0" style="min-width:auto;margin-left:40px;" id="processPreviewTable">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td style="width: 200px;vertical-align: middle;overflow:hidden; padding-bottom: 38px;"><div class="pb_state currentstate" ><span class="mw140" id="CurrentStateDisplayValue">'+ZSEC.Encoder.encodeForHTML(ZPA_BPOperation.BLUEPRINT_RECORD_DTL[ZP5Form.getFormClassObj().getParams().formId+"_"+ZP5Form.getFormClassObj().getParams().recordId].TransitionDetails.CurrentState)+'</span><span class="pbstartLine"></span></div></td>\n\t\t\t\t\t\t\t<td style="width:500px" class="PR" id="toStateIdValue"></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</div></div>';$execParam_cards.append(transitionhtml);var blueprintField=ZPA_BPOperation.BLUEPRINT_RECORD_DTL[ZP5Form.getFormClassObj().getParams().formId+"_"+ZP5Form.getFormClassObj().getParams().recordId].TransitionDetails.ProcessFieldId;if(void 0!=blueprintField){var isEditable=!1;void 0!=ZP5Form.Field.getFieldValueData(blueprintField)&&(isEditable=ZP5Form.Field.getFieldValueData(blueprintField).isEditable);var recordDetails=ZP5Form.getSingleRecord().record.message.recordDetails,rulesArray=ZPFRulesNew.Evaluation.rulesArray,responseRuleObj={};rulesArray.length>0&&(responseRuleObj=ZPFRulesNew.constructActionElms(rulesArray));var isFieldAllowed=!0;if(!jQuery.isEmptyObject(responseRuleObj)&&$.inArray(blueprintField,responseRuleObj.actionElms)>-1){var ruleId=responseRuleObj.actionElms.indexOf(blueprintField),rule=responseRuleObj.rules[ruleId];isFieldAllowed=ZPFRulesNew.evaluateRuleForField(rule,recordDetails,blueprintField)}}$.each(ZPA_BPOperation.BLUEPRINT_RECORD_DTL[ZP5Form.getFormClassObj().getParams().formId+"_"+ZP5Form.getFormClassObj().getParams().recordId].TransitionDetails.Transitions,function(index,transition){var BpCriteria="";void 0!=transition.ProcessedJson&&transition.ProcessedJson.length>0&&$.each(transition.ProcessedJson,function(index2,ProcessedJson){void 0!=ProcessedJson.conjunctiveCondn&&""!=ProcessedJson.conjunctiveCondn&&(BpCriteria+=ProcessedJson.conjunctiveCondn),void 0!=ProcessedJson.Operator&&58==ProcessedJson.Operator&&void 0!=ProcessedJson.fcType&&10==ProcessedJson.fcType?BpCriteria+=ProcessedJson.fielddisplayName+" "+ProcessedJson.OperatorDisplayName+" "+ProcessedJson.fromValue+", "+ProcessedJson.toValue:BpCriteria+=ProcessedJson.fielddisplayName+" "+ProcessedJson.OperatorDisplayName+" "+ProcessedJson.crtVal});var ToStateObj='<div class="pb_prevProcess_layer"><div class="pb_state_layer"><span class="pbconnLine"></span><span class="pre_trans" ><span transid='+transition.TransitionId+' data-toggle="tooltip" title="'+BpCriteria+'" data-container="body" data-placement="bottom"></span></span><span class="pb_state mW188 FR" >'+ZSEC.Encoder.encodeForHTML(transition.ToStateName)+"</span></div></div>";isFieldAllowed&&(transition.isTransitionOwner||!transition.isTransitionOwner&&transition.checkPerm&&isEditable)&&($execParam_cards.find("#toStateIdValue").append(ToStateObj),$execParam_cards.find("[transid="+transition.TransitionId+"]").text(ZSEC.Encoder.encodeForHTML(transition.TransitionName)))}),$.each(ZPA_BPOperation.BLUEPRINT_RECORD_DTL[ZP5Form.getFormClassObj().getParams().formId+"_"+ZP5Form.getFormClassObj().getParams().recordId].TransitionDetails.FailedTransitions,function(index,ftransition){var BpCriteria="";void 0!=ftransition.ProcessedJson&&ftransition.ProcessedJson.length>0&&$.each(ftransition.ProcessedJson,function(index2,ProcessedJson){void 0!=ProcessedJson.conjunctiveCondn&&""!=ProcessedJson.conjunctiveCondn&&(BpCriteria+=ProcessedJson.conjunctiveCondn),void 0!=ProcessedJson.Operator&&58==ProcessedJson.Operator&&void 0!=ProcessedJson.fcType&&10==ProcessedJson.fcType?BpCriteria+=ProcessedJson.fielddisplayName+" "+ProcessedJson.OperatorDisplayName+" "+ProcessedJson.fromValue+", "+ProcessedJson.toValue:BpCriteria+=ProcessedJson.fielddisplayName+" "+ProcessedJson.OperatorDisplayName+" "+ProcessedJson.crtVal});var ToStateObj='<div class="pb_prevProcess_layer"><div class="pb_state_layer"><span class="pbconnLine pbDisconnect"></span><span class="pre_trans" ><span transid='+ftransition.TransitionId+' data-toggle="tooltip" title="'+BpCriteria+'" data-container="body" data-placement="bottom"></span></span><span class="pb_state mW188 FR" >'+ZSEC.Encoder.encodeForHTML(ftransition.ToStateName)+"</span></div></div>";isFieldAllowed&&(ftransition.isTransitionOwner||!ftransition.isTransitionOwner&&ftransition.checkPerm&&isEditable)&&($execParam_cards.find("#toStateIdValue").append(ToStateObj),$execParam_cards.find("[transid="+ftransition.TransitionId+"]").text(ZSEC.Encoder.encodeForHTML(ftransition.TransitionName)))});var $previewTable=$("#processPreviewTable");if($previewTable.find(".pb_prevProcess_layer").length>1){var preLayerHeight=$previewTable.find("tr td:nth-child(2)").outerHeight()-100;$previewTable.find("tr td:nth-child(2)").append('<span class="pbMorePreiview"></span>'),$previewTable.find("span.pbMorePreiview").css({height:preLayerHeight})}}},getFormComponents:function(){return ZPA_BPOperation.BLUEPRINT_COMPONENT_DATA[ZP5Form.getFormClassObj().getParams().formId]},transitionExecutionModal:function(TransitionId,TransitionRelId){ZPA_BPOperation.TransitionRelId=TransitionRelId;var msg,fields,formCompObj=JSON.parse(JSON.stringify(ZPA_BPOperation.BLUEPRINT_COMPONENTS[ZP5Form.getFormClassObj().getParams().formId])),editableObj=formCompObj.message.formComponentDetails,processfieldId=ZPA_BPOperation.BLUEPRINT_RECORD_DTL[ZP5Form.getFormClassObj().getParams().formId+"_"+ZP5Form.getFormClassObj().getParams().recordId].TransitionDetails.ProcessFieldId,toStateName=null,filterarray=[],transitionName="";$.each(ZPA_BPOperation.BLUEPRINT_RECORD_DTL[ZP5Form.getFormClassObj().getParams().formId+"_"+ZP5Form.getFormClassObj().getParams().recordId].TransitionDetails.Transitions,function(index,transition){if((void 0!=transition.fields||void 0!=transition.InfoMessage)&&transition.TransitionId==TransitionId)return fields=transition.fields,toStateName=transition.ToStateName,msg=transition.InfoMessage,transitionName=transition.TransitionName,!1});var approvalWarningreq=!1;$.each(fields,function(index,field){1==field.isApprovalWarning&&(approvalWarningreq=!0)}),$.each(editableObj,function(index1,section){$.each(["column1","column2"],function(index2,col){$.each(section[col],function(index3,field){void 0!=field&&(processfieldId==field.formComponentId&&(field.sequence=-1,filterarray.push(field)),$.each(fields,function(itr,fieldcheck){field.formComponentId==fieldcheck.durfieldId.toString()&&(field.sequence=fieldcheck.sequence,filterarray.push(field))}))})})}),$.each(editableObj,function(index1,section){$.each(["column1","column2"],function(index2,col){section[col]=section[col].filter(function(el){return filterarray.includes(el)})})}),$.each(editableObj,function(index1,section){$.each(["column1","column2"],function(index2,col){0==index1&&"column2"!=col||$.each(section[col],function(index3,field){editableObj[0].column1.push(field)})})}),$.each(editableObj,function(index,section){if(0==index)return $.each(ZPA_BPOperation.BLUEPRINT_RECORD_DTL[ZP5Form.getFormClassObj().getFormsProperties().getFormId()+"_"+ZP5Form.getFormClassObj().getFormsProperties().getRecordId()].TransitionDetails.Transitions,function(index1,transition){transition.TransitionId==TransitionId&&(section.sectionName="",transitionName=transition.TransitionName,section.sectionId=transition.TransitionId)}),section.column2.length=0,!0;delete editableObj[index]}),editableObj.length=1,editableObj[0].column1.sort(function(a,b){var x=a.sequence,y=b.sequence;return x<y?-1:x>y?1:0}),formCompObj.message.formComponentDetails=editableObj,ZPA_BPOperation.BLUEPRINT_COMPONENT_DATA[ZP5Form.getFormClassObj().getParams().formId]=formCompObj;let params1=ZP5Form.getFormClassObj().getParams();params1.formMode="EDIT",params1.postFormConstructionCallback=function(){let currFormObj=ZP5Form.getFormClassObj();ZPA_Common.isNotNull(msg)&&currFormObj.LAYOUT.find("#sectionsparent").prepend("<div name='info' class='zpl_crd'><div class='zpl_info' >"+msg+"</div></div>"),approvalWarningreq&&currFormObj.LAYOUT.find("#sectionsparent").prepend(ZPA_BPOperation.getApprovalWarnHtml()),$.each(filterarray,function(index1,fillfield){$("#duringBpfield").find("#zp_field_outer_"+fillfield.formComponentId).parent().addClass("WP90").addClass("PR12");if(fillfield.formComponentId==processfieldId)if(fillfield.displayType===FormConstants.FieldType.RADIO_DISPLYTYPE)radioButs=$("input:radio[name="+fillfield.labelName+"]"),radioButs.each(function(index,button){button.value===toStateName&&(button.checked=!0)}),1==(bpFld=$("#blueprint_DurFld").find("#zp_field_outer_"+fillfield.formComponentId)).closest("[name=sections_obj]").find(".zpl_secn:visible").length&&bpFld.closest(".zpl_crd").addClass("DNI"),bpFld.parent().addClass("DNI");else if(fillfield.displayType===FormConstants.FieldType.SELECT_DISPLYTYPE){var bpFld,bpInpFld=(bpFld=$("#blueprint_DurFld").find("#zp_field_outer_"+fillfield.formComponentId)).find("#zp_field_"+fillfield.formComponentId);ZPeopleComponents.select(bpInpFld).setValue(toStateName),1==bpFld.closest("[name=sections_obj]").find(".zpl_secn:visible").length&&bpFld.closest(".zpl_crd").addClass("DNI"),bpFld.parent().addClass("DNI")}})},params1.isSingleCol=!0,params1.isPageMode=!0,params1.transitionRelId=TransitionRelId,params1.submitCallback=((formClassObj,resultData,params)=>{ZPA_BPOperation.durBpFldModal.close(),ZP5Form.getFormClassObj().refreshPage(ZP5Form.getFormClassObj().getParams())}),params1.failureCallback=((formClassObj,resultData,params)=>{void 0!=resultData&&7478==resultData[0].code&&(ZPA_BPOperation.durBpFldModal.close(),ZPA_BPOperation.getTransitions(ZP5Form.getFormClassObj().getFormsProperties().getFormId(),ZP5Form.getFormClassObj().getFormsProperties().getRecordId(),ZP5Form.getFormClassObj().FormOperations.getViewPerm()))});var baseFormLayoutKey=ZP5Form.getFormClassObj().formLayoutKey;let form=ZP5Form._toForm(params1);var tab=new Tab;tab.id="blueprint_DurFld",tab.cardId="bpdurfld_cards",tab.validate=function(){ZPA_BPOperation.saveDurFldValidation(form)},ZPA_BPOperation.durBpFldModal=new sliderModal("",tab),ZPA_BPOperation.durBpFldModal.mediumSize=!0,ZPA_BPOperation.durBpFldModal.setContainerAsBody(!0),ZPA_BPOperation.durBpFldModal.construct(),ZPA_BPOperation.durBpFldModal.setCloseCallback(function(){form.layoutRevertChanges(form),ZPA_BPOperation.durBpFldModal.remove()}),form.setFormContainer($("#bpdurfld_cards")),form.ISBLUEPRINT=!0,form.setTempFormComponent(formCompObj),form.setTempRecordDetails(ZPA_BPOperation.BLUEPRINT_RECORD_DTL[params1.formId+"_"+params1.recordId]),form.setFormModel(ZP5Form.MODEL.NO_MODEL),form.setBaseFormDOMId(baseFormLayoutKey).setRelatedFormNotNeeded(!0),form.setIsFormForFieldLayout(),form.init();var pageId=$("#blueprint_DurFld");0==form.FIELD_LAYOUT.find("#sectionsparent").find(".zpl_secn:not([name=info]):visible").length&&(pageId.find("#bpdurfld_cards").append(ZPA_BPOperation.getEmptyFieldCard()),tab.validate=function(){ZPA_BPOperation.submitEmptyFields(pageId,form,TransitionRelId)},ZPA_BPOperation.durBpFldModal.setTab(tab),pageId.find("#sliFootDiv #sliderSbt").text(ZPI18N.getString("zp.done"))),pageId.find("#sliHdrDiv h4").html(ZSEC.Encoder.encodeForHTML(transitionName))},getEmptyFieldCard:function(){return'<div id="emptyField" class="zpl_crd wd100_per ">\n\t\t   \t\t\t\t<div class="zpl_crdcnt"><div class="zpl_Emptydata">\n\t\t   \t\t\t\t\t<div class="zpl_crdcnt"><div class="zpl_Emptydata"><div>\n\t\t   \t\t\t\t\t\t<div class="zpl_emptimg zp_nd_nodata"></div><h4>'+ZPI18N.getString("zp.transnoeditable")+"</h4><p></p>\n\t\t   \t\t\t\t\t</div>\n\t\t   \t\t\t\t</div></div>\n\t\t   \t\t\t</div>"},getEmptyTransFldHtml:function(){return'<div class="zpl_crd wd100_per">\n\t\t \t\t\t<div class="zpl_crdcnt"><div class="zpl_Emptydata">\n\t\t \t\t\t\t<div><div class="zpl_emptimg zp_nd_avlblst"></div><h4></h4><p>'+ZPI18N.getString("zp.transnoeditable")+"</p>\n\t\t \t\t\t\t</div>\n\t\t \t\t\t</div>\n\t\t \t\t</div></div>"},getApprovalWarnHtml:function(){let htm='<div class="zpl_crd"><div id="zalertbanner--error" class="zalertbanner zalertbanner--error MT20" style="z-index:20">';return htm+='<i class="zalertbanner__icon"> <svg class="zalertbanner__svg" focusable="false">',htm+='<use xlink:href="#zc__svg--error"></use>',htm+="</svg></i>",htm+='<span class="zalertbanner__text"></span>',htm+="<p>"+ZPI18N.getString("zp.bpapprovalwarning")+"</p>",htm+='<div class="zalertbanner__action" title="Close"><button type="button" class="zalertbanner__close" onclick="ZPA_BPOperation.fadeOutApprWarn()">',htm+='<i class="zalertbanner__icon"> <svg class="zalertbanner__svg" focusable="false">',htm+='<use xlink:href="#zc__svg--close"></use>',htm+="</svg></i>",htm+="</button></div>",htm+="</div></div>"},fadeOutApprWarn:function(){$("#blueprint_DurFld").find(".zalertbanner").fadeOut(300,function(){$(this).remove()})},submitEmptyFields:function(pageId,formIns,TransitionRelId){ZPA_Common.disableSaveBtn(pageId),ZPA_BPOperation.executeTransition(formIns.getParams().formId,formIns.getParams().recordId,TransitionRelId,function(){ZPA_BPOperation.durBpFldModal.close()})},saveDurFldValidation:function(bpFormInstance){bpFormInstance.ISBLUEPRINT=!0,bpFormInstance.submitBtn()},fieldEditCriteria:function(formClassObj,fcData){return!(fcData.blueprintField&&!formClassObj.ISBLUEPRINT)},markFieldError:function(message){var processId=ZPA_BPOperation.BLUEPRINT_RECORD_DTL[ZP5Form.getFormClassObj().getParams().formId+"_"+ZP5Form.getFormClassObj().getParams().recordId].TransitionDetails.ProcessFieldId,processLabel=ZP5Form.FORM_COMPONENTS[processId].labelName;ZP5Form.getFieldLayout().find("#zp_field_outer_"+processId).parents(".zp-label").hasClass("zp-err")&&ZPeople.Message.failure(message[processLabel])}};class ApprovalParam{constructor(formId,recordId,tableName,recordStatus,isRecordAdmin,recordIds){(void 0!=formId&&void 0!=recordId&&void 0!=tableName||void 0!=recordIds)&&(this.formId=formId,void 0!=recordIds?this.recordIds=recordIds:this.recordId=recordId,this.tableName=tableName,this.recordStatus=recordStatus,this.isRecordAdmin=isRecordAdmin||!1)}static setBulkParam(recordIds,isRecordAdmin,formId){return new ApprovalParam(formId,void 0,void 0,void 0,isRecordAdmin,recordIds)}getFormId(){return this.formId}getRecordId(){return this.recordId}getRecordIds(){return this.recordIds}getApprovalStatus(){return this.recordStatus}getTableName(){return this.tableName}getIsRecordAdmin(){return this.isRecordAdmin}getProp(){return this.prop}getApprovalSettings(){return void 0==this.approvalSettings&&(this.approvalSettings=OPApprovals.Common.Settings.getApprovalSettings(this.getFormId())),this.approvalSettings}setApprovalStatus(recordStatus){this.recordStatus=recordStatus}setProp(prop){this.prop=prop}setApprovalSettings(approvalSettings){this.approvalSettings=approvalSettings}isRecordApprover(){return!(!this.prop||!this.prop.isRecordApprover)&&this.prop.isRecordApprover}isPrimaryApprover(){return!(!this.prop||!this.prop.isPrimaryApprover)&&this.prop.isPrimaryApprover}getPreviousStatus(){if(this.prop&&void 0!=this.prop.previousStatus)return this.prop.previousStatus}isAdmin(){return void 0!=this.getIsRecordAdmin()?this.getIsRecordAdmin():ZP5Form.getFormsOperation(this.getApprovalParams().getFormId()).isAdmin()}isCancelApplicable(){return void 0==this.prop.isCancelApplicable||this.prop.isCancelApplicable}isResubmitApplicable(){return void 0==this.prop.isResubmitApplicable||this.prop.isResubmitApplicable}}class LayoutParam{constructor(pageLayout,headerLayout,footerLayout,mode,moreLayout){this.layout=pageLayout||settingsPage.container,this.headerLayout=headerLayout,this.footerLayout=footerLayout,this.mode=mode,this.moreLayout=moreLayout}getLayout(){return this.layout}getHeaderLayout(){return this.headerLayout}getFooterLayout(){return this.footerLayout}getMoreLayout(){return this.moreLayout}getMode(){return this.mode}setActionLayout(actionLayout){this.actionLayout=actionLayout}getActionLayout(){return this.actionLayout}}class ApprovalRecordHeader{constructor(approvalParams,layoutParams,prop){void 0!=approvalParams&&"ApprovalParam"==approvalParams.constructor.name&&(this.approvalParams=approvalParams,void 0==prop&&(prop={}),this.approvalParams.setProp(prop),this.layoutParams=layoutParams)}getApprovalParams(){return this.approvalParams}getLayoutParams(){return this.layoutParams}isRecordBaseUrl(){return-1==Layout.Page.hash.indexOf("myspace")&&-1==Layout.Page.hash.indexOf("approvals/allapproval")&&-1==Layout.Page.hash.indexOf("approvals/myrequest")&&-1==Layout.Page.hash.indexOf("home/dashboard")&&-1==Layout.Page.hash.indexOf("home/feeds/myfeed")&&-1==Layout.Page.hash.indexOf("dashboard/feeds")&&-1==Layout.Page.hash.indexOf("dashboard/approvals")&&-1==Layout.Page.hash.indexOf("admin/dataadministration/activityLog")}isModuleForm(tableName){return!["P_EmployeeLeave","P_Compensatory","P_LeaveGrant","P_Employee","P_Designation","P_Department","P_Goals","P_ReviewApprovalSheet","P_MultiRater","P_MultiRater_Approval","P_ShiftMappingForm","P_AutoShiftAssignForm","P_AttendanceOD","P_PermissionDetails"].includes(tableName)}canViewApproval(){if(OPApprovals.APPROVAL_DETAILS[this.getApprovalParams().getRecordId()]){var apprData=OPApprovals.APPROVAL_DETAILS[this.getApprovalParams().getRecordId()];return apprData.current||apprData.pending||apprData.processed}}static cancelRecord(){let formsObj=ZP5Form.getFormClassObj(),approvalParams=new ApprovalParam(formsObj.FormsProp.getFormId(),formsObj.FormsProp.getRecordId(),formsObj.getTableName(),formsObj.RECORD_DETAILS.record.message.approvalStatus,formsObj.RECORD_DETAILS.record.isRecordAdmin),layoutParams=new LayoutParam(formsObj.LAYOUT,formsObj.LAYOUT.find("#zp_form_header"),formsObj.FOOTER,"Forms",$("body").find("#zp_view_record_"+formsObj.FormsProp.getFormId()+"frmMore"));new ApprovalCancel(approvalParams,layoutParams).cancel()}static isvalidResubmitURL(){return-1==Layout.Page.hash.indexOf("myspace")&&-1==Layout.Page.hash.indexOf("approvals/allapproval")&&-1==Layout.Page.hash.indexOf("team/approvals")&&-1==Layout.Page.hash.indexOf("approvals/myrequest")&&-1==Layout.Page.hash.indexOf("home/dashboard")&&-1==Layout.Page.hash.indexOf("home/feeds/myfeed")&&-1==Layout.Page.hash.indexOf("dashboard/feeds")&&-1==Layout.Page.hash.indexOf("dashboard/approvals")&&-1==Layout.Page.hash.indexOf("admin/dataadministration/activityLog")&&-1==Layout.Page.hash.indexOf("performance/approval")&&-1==Layout.Page.hash.indexOf("okr/approvals")}static isValidUrlToShowTimeline(){return Layout.Page.currentmode.includes("operations/approvals/allapproval")||Layout.Page.currentmode.includes("home/team/approvals")||Layout.Page.currentmode.includes("performance/approval")||Layout.Page.currentmode.includes("okr/approvals")}static getHeaderHTML(){return'<i id="appr_status_icon"></i><span id="appr_status_msg"></span><button id="zp_appproval_comment_btn" class="zlabel zlabel--blue zlabel--small zpl_DNI">'+ZPI18N.getString("zp.view")+'</button><button id="showApprBtn" class="zlabel zlabel--blue zlabel--small zpl_DNI">'+ZPI18N.getString("zp.viewapprovers")+"</button>"}static registerHeaderEvent(approvalParams,layoutParams){ApprovalRecordHeader.registerSendForApprovalEvent(approvalParams,layoutParams),ApprovalRecordHeader.registerApprovalTimelineEvent(approvalParams,layoutParams)}static registerSendForApprovalEvent(approvalParams,layoutParams,isSlider){let outerLayout=isSlider?layoutParams.getActionLayout():layoutParams.getLayout();outerLayout.find("#sendApprBtn").length>0&&outerLayout.find("#sendApprBtn").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),$(this).attr("disabled",!0),$(this).off("click"),new SendForApproval(approvalParams,layoutParams).execute(this)})}static registerApprovalTimelineEvent(approvalParams,layoutParams){layoutParams.getLayout().find("#zp_appproval_comment_btn").length>0&&layoutParams.getLayout().find("#zp_appproval_comment_btn").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),new ApprovalTimeline(approvalParams,layoutParams).open()}),layoutParams.getLayout().find("#showApprBtn").length>0&&layoutParams.getLayout().find("#showApprBtn").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),$(this).off("click"),new ApprovalTimeline(approvalParams,layoutParams).open()})}show(){let recordStatus=this.getApprovalParams().getApprovalStatus();this.reset();let headerBtn=this.getLayoutParams().getLayout().find("#headerApprovalBtn");this.showHidePreview();let headerProp=this.getStatusHeaderProp(recordStatus);""!==headerProp.class&&(this.showHideApprovalTimeline(headerBtn),headerBtn.addClass("zpl_frmstus"),headerBtn.find("#appr_status_icon").addClass(headerProp.class),headerBtn.find("#appr_status_msg").text(headerProp.text),headerBtn.attr("name","appr_status_"+this.getApprovalParams().getRecordId()),headerBtn.removeClass("zpl_DNI"),this.showHideFollowup(),this.showHideCancelBtn(),this.showHideResubmit(),ApprovalRecordHeader.registerHeaderEvent(this.getApprovalParams(),this.getLayoutParams()),ApprovalRecordHeader.isValidUrlToShowTimeline()&&ApprovalList.viewApprTimeline&&!headerBtn.find("#zp_appproval_comment_btn").hasClass("zpl_DNI")&&headerBtn.find("#zp_appproval_comment_btn").trigger("click"))}reset(){let approvalData=OPApprovals.getApprovalData(this.getApprovalParams().getRecordId(),this.getApprovalParams().getFormId());approvalData&&approvalData.refresh&&OPApprovals.refreshApprovalData(this.getApprovalParams().getRecordId()),this.appendHeader();let headerBtn=this.getLayoutParams().getLayout().find("#headerApprovalBtn");headerBtn.addClass("zpl_DNI");let buttonText=ZPI18N.getString("zp.view");if(this.getApprovalParams().isPrimaryApprover()&&(buttonText=this.getApprovalParams().getApprovalStatus()==zpconst.ApprovalStatus.CancellationPending?ZPI18N.getString("zp.extenddecline"):ZPI18N.getString("zp.clicktoapprovereject")),headerBtn.find("#zp_appproval_comment_btn").text(buttonText),headerBtn.addClass("zpl_DNI"),this.getLayoutParams().getLayout().find('[name="apprRelBtn"]').addClass("zpl_DNI"),this.getLayoutParams().getFooterLayout()&&(this.getLayoutParams().getFooterLayout().find("#resubmit_approval").addClass("zpl_DNI"),this.getLayoutParams().getFooterLayout().find("#zp_form_chooseappr_cont").remove()),void 0!=this.getApprovalParams().getPreviousStatus()){let headerProp=this.getStatusHeaderProp(this.getApprovalParams().getPreviousStatus());headerProp.class&&headerBtn.find("#appr_status_icon").removeClass(headerProp.class)}}appendHeader(){let headerBtn=this.getLayoutParams().getLayout().find("#headerApprovalBtn");if(0==headerBtn.length){if(!this.getLayoutParams().getHeaderLayout())return;headerBtn=$('<div class="zpl_DNI" id="headerApprovalBtn">'+ApprovalRecordHeader.getHeaderHTML()+"<div>"),this.getLayoutParams().getHeaderLayout().append(headerBtn)}else headerBtn.empty().append(ApprovalRecordHeader.getHeaderHTML())}showHideApprovalTimeline(headerBtn){this.canShowApprovalTimeline()?(headerBtn.find("#zp_appproval_comment_btn").addClass("zpl_DNI"),headerBtn.find("#zp_appproval_comment_btn").off("click")):headerBtn.find("#zp_appproval_comment_btn").removeClass("zpl_DNI")}canShowApprovalTimeline(){let approvalSettings=this.getApprovalParams().getApprovalSettings();return this.getApprovalParams().getApprovalStatus()==zpconst.ApprovalStatus.Draft||!(this.getApprovalParams().isAdmin()||this.getApprovalParams().isRecordApprover()||this.getApprovalParams().isPrimaryApprover()||this.canViewApproval())&&approvalSettings&&!approvalSettings.isNotifyRecordOwner}showHidePreview(){let recordStatus=this.getApprovalParams().getApprovalStatus(),headerDiv=this.getLayoutParams().getLayout().find("#headerApprovalBtn");recordStatus==zpconst.ApprovalStatus.NotSubmitedd||recordStatus==zpconst.ApprovalStatus.NoStatus?(this.showHideSendForApproval(),this.canShowPreview()?(headerDiv.find("#showApprBtn").removeClass("zpl_DNI"),headerDiv.removeClass("zpl_DNI"),ApprovalRecordHeader.registerHeaderEvent(this.getApprovalParams(),this.getLayoutParams())):(headerDiv.find("#showApprBtn").addClass("zpl_DNI"),headerDiv.addClass("zpl_DNI"))):(headerDiv.find("#showApprBtn").addClass("zpl_DNI"),headerDiv.addClass("zpl_DNI"))}canShowPreview(){let recordStatus=this.getApprovalParams().getApprovalStatus(),approvalSettings=this.getApprovalParams().getApprovalSettings();return!(recordStatus!=zpconst.ApprovalStatus.NotSubmitedd&&recordStatus!=zpconst.ApprovalStatus.NoStatus||!approvalSettings||!approvalSettings.isVerifySend)&&(this.getApprovalParams().isAdmin()||OPApprovals.Common.RecordOwner.isRecordOwner(this.getApprovalParams().getRecordId(),erecno)&&approvalSettings&&approvalSettings.isNotifyRecordOwner)}showHideSendForApproval(){this.canSendForApproval()?this.appendSendForApproval():this.getLayoutParams().getLayout().find("#sendApprBtn").remove()}appendSendForApproval(){let sendForApprovalHtml=SendForApproval.getButton();this.getLayoutParams().getLayout().find("#zp_appproval_container").prepend(sendForApprovalHtml),ApprovalRecordHeader.registerHeaderEvent(this.getApprovalParams(),this.getLayoutParams())}canSendForApproval(){let recordStatus=this.getApprovalParams().getApprovalStatus();return(recordStatus==zpconst.ApprovalStatus.NotSubmitedd||recordStatus==zpconst.ApprovalStatus.NoStatus)&&(this.getApprovalParams().isAdmin()||OPApprovals.Common.RecordOwner.isRecordOwner(this.getApprovalParams().getRecordId(),erecno)||OPApprovals.CustomerBased.sendForApproval(this.getApprovalParams().getFormId(),this.getApprovalParams().getRecordId()))}getStatusHeaderProp(approvalStatus){let headerClass="",headerMsg="";return approvalStatus==zpconst.ApprovalStatus.Approved?(headerClass="PI_ap_approved",headerMsg=ZPI18N.getString("zp.approved")):approvalStatus==zpconst.ApprovalStatus.Pending||approvalStatus==zpconst.ApprovalStatus.Intermediate_Approved?(headerMsg=ZPI18N.getString("zp.pending"),headerClass="PI_ap_pending"):approvalStatus==zpconst.ApprovalStatus.CancellationPending?(headerMsg=ZPI18N.getString("zp.cancellationpending"),headerClass="PI_ap_canclpend"):approvalStatus==zpconst.ApprovalStatus.Draft?(headerClass="PI_ap_draft",headerMsg=ZPI18N.getString("zp.draft")):approvalStatus==zpconst.ApprovalStatus.Cancelled?(headerClass="PI_ap_cancel",headerMsg=ZPI18N.getString("zp.cancelled")):approvalStatus==zpconst.ApprovalStatus.Revoked?(headerClass="PI_fil_revoke PI_oldversion blu",headerMsg=ZPI18N.getString("zp.revoked")):approvalStatus==zpconst.ApprovalStatus.Rejected&&(headerClass="PI_ap_reject",headerMsg=ZPI18N.getString("zp.rejected")),{class:headerClass,text:headerMsg}}showHideResubmit(){if(void 0==this.getLayoutParams().getFooterLayout())return;let recordObj=this;this.getApprovalParams().getApprovalStatus()!=zpconst.ApprovalStatus.Cancelled&&this.getApprovalParams().getApprovalStatus()!=zpconst.ApprovalStatus.Rejected||!this.canShowResubmit()?this.getLayoutParams().getFooterLayout().find("#resubmit_approval").length>0&&(this.getLayoutParams().getFooterLayout().find("#resubmit_approval").off("click"),this.getLayoutParams().getFooterLayout().find("#resubmit_approval").addClass("zpl_DNI")):(0==this.getLayoutParams().getFooterLayout().find("#resubmit_approval").length&&this.getLayoutParams().getFooterLayout().find("#zp_appproval_container").prepend('<button id="resubmit_approval" class="zlabel zlabel--blue zlabel--medium zpl_DNI">'+ZPI18N.getString("zp.resubmit")+"</button>"),this.getLayoutParams().getFooterLayout().find("#resubmit_approval").removeClass("zpl_DNI"),this.getLayoutParams().getFooterLayout().find("#resubmit_approval").off("click").on("click",function(){new ApprovalResubmit(recordObj.getApprovalParams(),recordObj.getLayoutParams()).resubmit()}))}canShowResubmit(){return!!(this.getApprovalParams().isResubmitApplicable()&&this.isModuleForm(this.getApprovalParams().getTableName())&&ApprovalRecordHeader.isvalidResubmitURL()&&ZP5Form.getFormClassObj().isPermitted(ZP5Form.getCurrFormsOperation().getAddPerm()))&&(OPApprovals.Common.RecordOwner.isRecordOwner(this.getApprovalParams().getRecordId(),erecno)||isadmin||this.getApprovalParams().isAdmin())}showHideFollowup(){let recordHeaderObj=this;if(recordHeaderObj.getLayoutParams().getHeaderLayout()&&this.canShowFollowup()){0==this.getLayoutParams().getHeaderLayout().find("#zp_approval_followupbtn").length&&$('<a id="zp_approval_followupbtn" class="zpl_DNI">'+ZPI18N.getString("zp.sendfollowup")+"</a>").insertBefore(this.getLayoutParams().getHeaderLayout().find("#headerApprovalBtn"));let followupBtn=this.getLayoutParams().getHeaderLayout().find("#zp_approval_followupbtn");followupBtn.addClass("zlabel zlabel--outline zlabel--medium FR MR10"),followupBtn.attr("name","apprRelBtn"),followupBtn.attr("recordid",this.getApprovalParams().getRecordId()),followupBtn.removeClass("zpl_DNI"),followupBtn.on("click",function(e){e.stopPropagation(),e.preventDefault(),new ApprovalFollowup(recordHeaderObj.getApprovalParams(),recordHeaderObj.getLayoutParams()).execute()})}else this.getLayoutParams().getHeaderLayout()&&this.getLayoutParams().getHeaderLayout().find("#zp_approval_followupbtn").remove()}canShowFollowup(){return(this.getApprovalParams().getApprovalStatus()==zpconst.ApprovalStatus.Pending||this.getApprovalParams().getApprovalStatus()==zpconst.ApprovalStatus.CancellationPending)&&(!this.getApprovalParams().isPrimaryApprover()&&!isadmin&&OPApprovals.Common.RecordOwner.isRecordOwner(this.getApprovalParams().getRecordId(),erecno))}static cancelButtonHtml(){return'<a id="zp_appr_cancel"><i class="IC-rejected"></i>'+ZPI18N.getString("zp.cancelrecord")+"</a>"}showHideCancelBtn(){if(this.isModuleForm(this.getApprovalParams().getTableName())){let $cancelOption=$("body").find("#zp_view_record_"+this.getApprovalParams().getFormId()+"frmMore #cancel_approval");$cancelOption.addClass("zpl_DNI"),this.canShowCancel()&&$cancelOption.removeClass("zpl_DNI")}}canShowCancel(){if(this.getApprovalParams().getApprovalStatus()==zpconst.ApprovalStatus.Pending||this.getApprovalParams().getApprovalStatus()==zpconst.ApprovalStatus.Approved){if(isadmin||this.getApprovalParams().getIsRecordAdmin())return!0;if(OPApprovals.Common.RecordOwner.isRecordOwner(this.getApprovalParams().getRecordId(),erecno)){if(this.getApprovalParams().getApprovalStatus()==zpconst.ApprovalStatus.Pending)return!0;if(this.getApprovalParams().getApprovalStatus()==zpconst.ApprovalStatus.Approved&&this.getApprovalParams().getApprovalSettings()&&this.getApprovalParams().getApprovalSettings().isCancelApprovedRec)return!0}}return!1}}class ApprovalTimeline{constructor(approvalParams,layoutParams){void 0!=approvalParams&&"ApprovalParam"==approvalParams.constructor.name&&(this.approvalParams=approvalParams,this.layoutParams=layoutParams)}getApprovalParam(){return this.approvalParams}getLayoutParams(){return this.layoutParams}getPostCallback(){return OPApprovals.ModuleCallback.ApprovalTimeline.postCallback(this.getApprovalParam().getTableName())}open(){let timelineObj=this;var tab=new Tab("",function(sliderObj){timelineObj.initiatePage(sliderObj)});tab.id="approvalpopup_"+this.getApprovalParam().getRecordId(),tab.cardId="approval_card";let approvalSlider=new sliderModal(ZPI18N.getString("zp.apprTimeline"),tab);approvalSlider.ftExtraCls="zpl_DNI",approvalSlider.construct(),approvalSlider.setCloseCallback(function(sliderObj){timelineObj.close(sliderObj)})}getTimelineContainer(){return this.getLayoutParams().timelineSlider}close(sliderObj){sliderObj?(this.getLayoutParams().timelineSlider=sliderObj,this.getTimelineContainer().remove()):settingsPage.container.find("#approvalpopup_"+this.getApprovalParam().getRecordId()).remove()}getSliderContainer(){return this.getTimelineContainer().sliderDiv}getCardContainer(){return this.getSliderContainer().find("#"+this.getTimelineContainer().tab.cardId)}getFooterContainer(){return this.getTimelineContainer().footerDiv}initiatePage(sliderObj){if(this.getLayoutParams().timelineSlider=sliderObj,this.getLayoutParams().setActionLayout(sliderObj.sliderDiv.addClass("zpl_apprvltline zpl_ntzindx")),void 0==OPApprovals.getApprovalData(this.getApprovalParam().getRecordId())){OPApprovals.refreshApprovalData(this.getApprovalParam().getRecordId());let timelineObj=this;OPApprovals.fetchApprovalDetails(this.getApprovalParam().getRecordId(),this.getApprovalParam().getFormId(),function(apprData){timelineObj.responseHandler(apprData)},function(apprData){timelineObj.showHideApprDetailsBtn(apprData)})}else this.construct()}responseHandler(apprData){if(apprData)if(apprData.errorMsg){let error_Msg=apprData.errorMsg,popup_body=this.getCardContainer();new EmptyPages("zp_nd_template",error_Msg,"",popup_body).show(),this.showHideApprDetailsBtn(!1)}else OPApprovals.isTatRefresh?(OPApprovals.isTatRefresh=!1,OPApprovals.approveRejectDtlCallBack(data,{approvalJson:apprData})):this.construct()}construct(){let recordId=this.getApprovalParam().getRecordId();var popup_body=this.getCardContainer();if(popup_body.empty(),popup_body.append(this.constructApprovalPopUp()),this.registerTimelineEvent(),this.getLayoutParams().getLayout().find("#headerApprovalBtn").attr("formid",this.getApprovalParam().getFormId()),this.getLayoutParams().getLayout().find("#headerApprovalBtn").attr("recordid",recordId),OPApprovals.APPROVAL_DETAILS[recordId].canSendApproval){var footer=SendForApproval.getButton();this.getFooterContainer().children().addClass("zpl_DNI"),this.getFooterContainer().find("#zp_appproval_container").prepend(footer),ApprovalRecordHeader.registerSendForApprovalEvent(this.getApprovalParam(),this.getLayoutParams(),!0),this.getFooterContainer().removeClass("zpl_DNI")}var currentApprStatus=OPApprovals.APPROVAL_DETAILS[recordId].currentApprovalStatus;currentApprStatus!=zpconst.ApprovalStatus.NoStatus&&currentApprStatus!=zpconst.ApprovalStatus.NotSubmitedd||this.showHideApprDetailsBtn(!1),OPApprovals.APPROVAL_DETAILS[recordId].commentsAllowed&&new ApprovalComment(this.getApprovalParam(),this.getLayoutParams()).construct(OPApprovals.APPROVAL_DETAILS[recordId].comments,!0),this.approverejectClick(),popup_body.find("#sla_time").is(":visible")&&(void 0==ZPApprovals.sla_timer&&(ZPApprovals.sla_timer={}),new ApprovalSLA(this.getApprovalParam(),this.layoutParams).showSLATimer()),ZPUtil.Validation.isFunction(this.getPostCallback())&&this.getPostCallback()(this)}registerEvents(){ApprovalRecordHeader.registerHeaderEvent(this.getApprovalParam(),this.getLayoutParams())}constructApprovalPopUp(){let recordId=this.getApprovalParam().getRecordId(),formId=this.getApprovalParam().getFormId();var apprData=OPApprovals.APPROVAL_DETAILS[recordId],apprHtml="";if(void 0!==apprData){apprHtml+='<div class="zpl_crd"><div class="tlouter tlwid" id="'+recordId+'" formId="'+formId+'">';var apprAct=apprData.approvalAction,isExtraLvlNeed=!1;if(1==apprAct)if(void 0!==apprData.current)isExtraLvlNeed=!0;else if(void 0!==apprData.processed&&apprData.processed.length>0){isExtraLvlNeed=2!=apprData.processed[apprData.processed.length-1].approvalStatus}if(apprHtml+=this.getSingleTimeLineEntryHTML(apprData.recordowner,apprData.approvalSubmissionTime,"recordowner",void 0,void 0,void 0,void 0,void 0,apprData.currentApprovalStatus,apprAct),void 0!==apprData.current||void 0!==apprData.processed&&apprData.processed.length>0||void 0!==apprData.pending){var mode;if(apprHtml+=this.constructApprovalPopupBody(apprData.processed,void 0,void 0,void 0,void 0,apprAct,isExtraLvlNeed),apprData.current)if(apprData.current.forward&&(apprHtml+=this.getSingleTimeLineEntryHTML(apprData.current.forward.initiator,apprData.current.forward.commentedTime,"forward",!0,!1,!1,apprData.current.forward.target,apprData.current.forward.comment)),apprData.current.delegatee)1==apprData.current.delegatee.Sub_Type&&(mode="dualRT"),apprHtml+=this.getSingleTimeLineEntryHTML(apprData.current,void 0,mode,!0,apprData.isPrimaryAppr,apprData.isSecondaryAppr,apprData.current.delegatee);else apprHtml+=this.getSingleTimeLineEntryHTML(apprData.current,void 0,void 0,!0,apprData.isPrimaryAppr,apprData.isSecondaryAppr,void 0,void 0,void 0,apprAct);if(apprHtml+=this.constructApprovalPopupBody(apprData.pending),1==apprAct){var finalTlLvl=apprData.processed[apprData.processed.length-1];1==finalTlLvl.approvalStatus&&(apprHtml+=this.getSingleTimeLineEntryHTML(void 0,finalTlLvl.approvedTime,"extraLevel",void 0,void 0,void 0,void 0,void 0,zpconst.ApprovalStatus.Cancelled,apprAct,!1))}}else if(apprData.systemApproved||void 0!=apprData.previewAutoApprovalType){var status,status_dtl,status_color,img_src=ZPeople.getResourceURL(imageUrl+"auto-app.jpg");if(apprData.currentApprovalStatus===zpconst.ApprovalStatus.Approved||apprData.previewAutoApprovalType===zpconst.ApprovalStatus.Approved?(status=ZPI18N.getString("zp.approved"),status_dtl=ZPI18N.getString("zp.systemapproved"),status_color=void 0!=apprData.previewAutoApprovalType?"":"tl-success"):(status=ZPI18N.getString("zp.rejected"),status_dtl=ZPI18N.getString("zp.systemrejected"),status_color=void 0!=apprData.previewAutoApprovalType?"":"tl-reject"),apprHtml+='<div class="tlentry '+status_color+'"><div class="tlentry-inner"><div class="tlicon"></div><div class="tllabel"><div class="stshead"><span class="sts">'+status+"</span>",apprData.systemApproved){var timeArr=apprData.systemApprovedTime.split(" ");apprHtml+='<div class="dat">'+timeArr[0]+'<span class="time">'+timeArr[1]+(timeArr.length>2?" "+timeArr[2]:"")+"</span></div>"}apprHtml+='</div><div class="profmin"><img src='+img_src+' class="Usrimg FL"><span class="ssp-un">'+status_dtl+"</span></div></div></div></div>"}return apprHtml+="</div>",apprData.commentsAllowed&&(apprHtml+='<div class="ZPFwhiDiv HA PR" id="comment_body" streamid='+recordId+"></div>"),apprHtml+"</div>"}return""}constructApprovalPopupBody(approvers,isCurrentAppr,isPrimaryApprover,isSecondaryApprover,delegatorDtls,apprAct,isExtraLvlNeed){var apprHtml="";let timelineObj=this;return void 0!==approvers&&0!=approvers.length&&$.each(approvers,function(index,data){data.forward&&(apprHtml+=timelineObj.getSingleTimeLineEntryHTML(data.forward.initiator,data.forward.commentedTime,"forward",!0,!1,!1,data.forward.target,data.forward.comment,void 0,apprAct)),apprHtml+=timelineObj.getSingleTimeLineEntryHTML(data,data.approvedTime,void 0,isCurrentAppr,isPrimaryApprover,isSecondaryApprover,delegatorDtls,void 0,void 0,apprAct,isExtraLvlNeed)}),apprHtml}getSingleTimeLineEntryHTML(data,time,mode,isCurrentAppr,isPrimaryApprover,isSecondaryApprover,delegatorDtls,comment,approvalStatus,apprAct,isExtraLvlNeed){var apprHtml="",dateTimeHtml="";if(void 0!==data){var waitingMsg,isRecordOwnerHtml="recordowner"==mode,actionKey="",apprClass="",approver_comment="",secondaryAppr=void 0;if(time)dateTimeHtml='<div class="dat">'+(timeArr=time.split(" "))[0]+'<span class="time">'+timeArr[1]+(timeArr.length>2?" "+timeArr[2]:"")+"</span></div>";if(void 0!==data.approvalStatus){var commentIcon="";data.approvalStatus==zpconst.ApprovalStatus.Cancelled?(commentIcon=void 0!=isExtraLvlNeed&&isExtraLvlNeed?'<i class="IC-rejected MR10"></i>':'<i class="IC-rejected MR10 red"></i>',apprClass=void 0!=isExtraLvlNeed&&isExtraLvlNeed?"":"tl-reject",waitingMsg=void 0!=isExtraLvlNeed&&isExtraLvlNeed?ZPI18N.getString("zp.cancelinitiated"):ZPI18N.getString("zp.cancelled")):data.approvalStatus==zpconst.ApprovalStatus.Revoked?(apprClass="tl-review",waitingMsg=ZPI18N.getString("zp.revoked")):data.approvalStatus==zpconst.ApprovalStatus.Rejected?(apprClass="tl-reject",waitingMsg=1==apprAct?"Declined":ZPI18N.getString("zp.rejected")):(apprClass="tl-success",waitingMsg=1==apprAct?ZPI18N.getString("zp.accepted"):ZPI18N.getString("zp.approved")),approver_comment=ZPUtil.Validation.isEmpty(data.comment)?"":'<div class="tlaccept">'+commentIcon+data.comment+"</div>"}else isRecordOwnerHtml?apprClass+="first MT30":"forward"==mode?(apprClass+="tl-review",waitingMsg=ZPI18N.getString("zp.forwarded"),secondaryAppr=delegatorDtls,actionKey="zp.forwarded",approver_comment=ZPUtil.Validation.isEmpty(comment)?"":'<div class="tlaccept">'+comment+"</div>"):(waitingMsg=ZPI18N.getString("zp.inqueue"),isCurrentAppr&&(waitingMsg=ZPI18N.getString("zp.pending"),apprClass+="tl-wait",(secondaryAppr=delegatorDtls)&&("dualRT"!=mode||isPrimaryApprover&&secondaryAppr.erecno==erecno)&&(secondaryAppr=data,data=delegatorDtls,"dualRT"!=mode&&(actionKey="zp.delegateeof"))));if(data.approverDtls&&data.approverDtls.erecno!==data.erecno&&(secondaryAppr=data.approverDtls,actionKey="zp.onbehalfof"),secondaryAppr&&(apprClass+=" tldelegate"),apprHtml+='<div class="tlentry '+apprClass+'"> <div class="tlentry-inner">',isRecordOwnerHtml?apprHtml+='<div class="tllabel">':(apprHtml+='<div class="tlicon"></div><div class="tllabel"><div class="stshead">',void 0!==data.approvalStatus?apprHtml+='<span class="sts">'+(waitingMsg||data.approvalStatusStr)+"</span>":(apprHtml+="<span class="+("forward"==mode?"sts":"wait")+">"+waitingMsg+"</span>",void 0!=data.nextTATTime&&(apprHtml+='<div class="progs" id ="sla_time">'+data.nextTATTime+"</div>")),secondaryAppr&&actionKey&&(apprHtml+="<em>"+ZPI18N.getString(actionKey)+"</em>"),apprHtml+=dateTimeHtml+"</div>"),apprHtml+=this.getApproverHTML(data,secondaryAppr,actionKey,isRecordOwnerHtml?dateTimeHtml:void 0,mode,approvalStatus,apprAct),isPrimaryApprover)apprHtml+=this.getCommentBoxHTML()+"</div></div></div>";else if(isSecondaryApprover){apprHtml+='<div class="tlmsg"><a id="approval_comment_link">'+(1==apprAct?ZPI18N.getString("zp.usercanaccept"):ZPI18N.getString("zp.usercanapprove"))+"</a></div>",apprHtml+="</div></div></div>"}else apprHtml+=approver_comment+"</div></div></div>"}else{var timeArr;if(time)dateTimeHtml='<div class="dat">'+(timeArr=time.split(" "))[0]+'<span class="time">'+timeArr[1]+(timeArr.length>2?" "+timeArr[2]:"")+"</span></div>";1==apprAct&&(apprHtml+='<div class="tlentry tl-reject"> <div class="tlentry-inner">',apprHtml+='<div class="tlicon"></div><div class="tllabel"><div class="stshead">',apprHtml+='<span class="sts">'+ZPI18N.getString("zp.cancelled")+"</span>"+dateTimeHtml+"</div></div></div></div>")}return apprHtml}getCommentBoxHTML(){var approvalDetails=OPApprovals.APPROVAL_DETAILS[this.getApprovalParam().getRecordId()],apprAct=approvalDetails.approvalAction,approveTxt=1==apprAct?ZPI18N.getString("zp.accept"):ZPI18N.getString("zp.approve"),approveAllTxt=1==apprAct?ZPI18N.getString("zp.acceptall"):ZPI18N.getString("zp.approveall"),rejectTxt=1==apprAct?ZPI18N.getString("zp.workflow.decline"):ZPI18N.getString("zp.reject"),comemntBox='<div class="ssp-postcmt"><textarea id="approver_comment" class="ztextbox MB10" rows="3" style="margin-top: 0px; margin-bottom: 10px; height: 55px;" placeholder="'+ZPI18N.getString("zp.writeacomment")+'"></textarea> </span> <button class="zlabel zlabel--blue zlabel--medium btn-success" name="approvalBtn" approvalType="1">'+approveTxt+"</button>";return comemntBox+=void 0!=approvalDetails.canApprAllLevels&&1==approvalDetails.canApprAllLevels?'<button class="btn-success-l zlabel zlabel--blue zlabel--medium" name="approvalBtn" approvalType="1" isapproveall="true">'+approveAllTxt+"</button>":"",comemntBox+='<button class="zlabel zlabel--outline zlabel--medium btn-danger" name="approvalBtn" approvalType="0">'+rejectTxt+"</button>",approvalDetails&&approvalDetails.canForwardApproval&&(comemntBox+='<button class="zlabel zlabel--medium zlabel--outline zlabel--blue btn-delegate-l" name="approvalBtn" approvalType="2">'+ZPI18N.getString("zp.forward")+"</button>"),comemntBox+="</span></div>"}showCommentBox(getThis){let timelineObj=this;$(getThis).closest(".tllabel").find(".ssp-postcmt").length<=0&&($(getThis).closest(".tllabel").append(timelineObj.getCommentBoxHTML()),timelineObj.approverejectClick($(getThis).closest(".tlouter.tlwid").attr("id")))}registerTimelineEvent(){let timelineObj=this;this.getCardContainer().find("#approval_comment_link").off("click").on("click",function(){timelineObj.showCommentBox(this)})}approverejectClick(){let timelineObj=this;timelineObj.getCardContainer().find("[name='approvalBtn']").on("click",function(){$("#tabProfilePic").remove(),$("#tabChangeCropPhoto").remove();var type=$(this).attr("approvalType");if(2==type){var levelDiv=$(this).closest(".tllabel");levelDiv.find(".ssp-postcmt").addClass("zpl_DNI");var configuration={headerId:"forwardingDiv",selectId:"appr_delegate",primaryBtnText:ZPI18N.getString("zp.forward")};configuration.type=type,levelDiv.find("#"+configuration.headerId).length>0?levelDiv.find("#"+configuration.headerId).removeClass("zpl_DNI"):(levelDiv.append(timelineObj.getForwardingHTML(configuration)),ZPeopleComponents.select("#appr_forward_id",ApprovalForward.getForwardMenuProperty(timelineObj.getApprovalParam().getRecordId()))),timelineObj.registerForwardTimelineEvent()}else{var comment=$(this).siblings("#approver_comment").val(),isAllLevelApprove=!!isadmin&&$(this).attr("isapproveall");$(this).closest(".ssp-postcmt").find("[name='approvalBtn']").attr("disabled",!0),new ApproveReject(timelineObj.getApprovalParam(),timelineObj.getLayoutParams(),type,comment,isAllLevelApprove).execute()}})}getApproverHTML(primaryAppr,secondaryAppr,actionKey,recordOwnerDateHtml,mode,approvalStatus,apprAct){var isValidSecApprover=secondaryAppr&&secondaryAppr.erecno!==primaryAppr.erecno,dualRT=isValidSecApprover&&"dualRT"==mode?secondaryAppr:void 0,apprHtml='<div class="profmin'+("dualRT"==mode?" zp_dUaPr":"")+'">'+this.getApproverInfoHTML(primaryAppr,recordOwnerDateHtml,dualRT,approvalStatus,apprAct);return isValidSecApprover&&void 0==dualRT&&(apprHtml+='<div class="zp-approinfo">'+this.getApproverInfoHTML(secondaryAppr,recordOwnerDateHtml,void 0,void 0,apprAct)+"</div>"),apprHtml+="</div>"}getApproverInfoHTML(primaryAppr,recordOwnerDateHtml,dualRTAppr,approvalStatus,apprAct){var approver_mail="",approver_image="";void 0===primaryAppr.photo||""===primaryAppr.photo?approver_image='<span class="Usrimg FL">'+ZPeople.getShortName(primaryAppr.name)+"</span>":dualRTAppr?(approver_image='<img src="'+ZPeople.applyPortalName(primaryAppr.photo)+'" class="Usrimg FL img1" elem="profilePhoto" empid="'+primaryAppr.erecno+'">',approver_image+='<img src="'+ZPeople.applyPortalName(dualRTAppr.photo)+'" class="Usrimg FL img2" elem="profilePhoto" popup="user" empid="'+dualRTAppr.erecno+'">'):approver_image='<img src="'+ZPeople.applyPortalName(primaryAppr.photo)+'" class="Usrimg FL" elem="profilePhoto" empid="'+primaryAppr.erecno+'" >';var approver_info=approver_image+'<span class="ssp-un">';return void 0==recordOwnerDateHtml&&void 0!==primaryAppr.employeeid&&(approver_info+="<span>"+primaryAppr.employeeid+" - </span>"),void 0!==primaryAppr.email&&""!==primaryAppr.email&&void 0!==primaryAppr.erecno?approver_mail=primaryAppr.email:void 0!==primaryAppr.approvertype&&"APPROVER_CHOOSEN_BY_USER"!=primaryAppr.type&&(approver_mail=primaryAppr.approvertype),void 0==recordOwnerDateHtml?approver_info+=primaryAppr.name+'<span class="ssp-mail">'+approver_mail+"</span>":(!approvalStatus||approvalStatus!=zpconst.ApprovalStatus.NoStatus&&approvalStatus!=zpconst.ApprovalStatus.NotSubmitedd?approvalStatus&&approvalStatus==zpconst.ApprovalStatus.Cancelled&&0==apprAct?primaryAppr.erecno==erecno?approver_info+=ZPI18N.getString("zp.cancelledrecordmytxt"):approver_info+=ZPI18N.getString("zp.cancelledrecordtxt",[primaryAppr.employeeid+" - "+primaryAppr.name]):approvalStatus&&approvalStatus==zpconst.ApprovalStatus.Revoked&&0==apprAct?primaryAppr.erecno==erecno?approver_info+=ZPI18N.getString("zp.revokedrecordmytxt"):approver_info+=ZPI18N.getString("zp.revokedrecordtxt",[primaryAppr.employeeid+" - "+primaryAppr.name]):primaryAppr.erecno==erecno?approver_info+=1==apprAct?ZPI18N.getString("zp.recordownercancelmytxt"):ZPI18N.getString("zp.recordownermytxt"):approver_info+=1==apprAct?ZPI18N.getString("zp.recordownercanceltxt",[primaryAppr.employeeid+" - "+primaryAppr.name]):ZPI18N.getString("zp.recordownertxt",[primaryAppr.employeeid+" - "+primaryAppr.name]):primaryAppr.erecno==erecno?approver_info+=ZPI18N.getString("zp.previewrecordownermytxt"):approver_info+=ZPI18N.getString("zp.previewrecordownertxt",[primaryAppr.employeeid+" - "+primaryAppr.name]),approver_info+=recordOwnerDateHtml),approver_info+="</span>"}showHideApprDetailsBtn(isDisable){this.getLayoutParams().getLayout().find("#showApprBtn").length>0&&(isDisable?(this.getLayoutParams().getLayout().find("#showApprBtn").text(ZPI18N.getString("zp.loadingtxt")),this.getLayoutParams().getLayout().find("#showApprBtn").off("click")):this.registerEvents(),this.getLayoutParams().getLayout().find("[name=apprRelBtn]").attr("disabled",void 0!=isDisable&&isDisable))}registerForwardTimelineEvent(){let timelineObj=this;timelineObj.getCardContainer().find("#frwd_appr").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),$(this).off("click"),new ApprovalForward(timelineObj.getApprovalParam(),timelineObj.getLayoutParams()).execute(this)}),timelineObj.getCardContainer().find("#frwd_cancel").off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),timelineObj.closeForward(this,timelineObj)})}getForwardingHTML(configuration){return'<div class="tlaccept tlapprl zpl_cnd" id="'+configuration.headerId+'" name="apprSelectionDiv"><div id="forwardCmt" class="zpl_secn"><div><label class="">'+ZPI18N.getString("zp.forwardheader")+'</label></div><div class=""><select id="appr_forward_id" label="" style="display: none;"></select></div><div><textarea id="fwdCommentDiv" class="ztextbox" name="appr_comment_text" style=""></textarea></div><div><button id="frwd_appr" class="zlabel zlabel--medium" approvaltype="'+configuration.type+'">'+configuration.primaryBtnText+'</button><button id="frwd_cancel" class="zlabel zlabel--medium zlabel--outline">'+ZPI18N.getString("zp.cancel")+"</button></div></div></div>"}closeForward(getThis,timelineObj){var levelDiv=$(getThis).closest(".tllabel");timelineObj.resetForward(levelDiv.find("#forwardingDiv")),levelDiv.find(".ssp-postcmt").removeClass("zpl_DNI"),levelDiv.find("#forwardingDiv").addClass("zpl_DNI")}resetForward(forwardDiv){ZPeopleComponents.select("#appr_forward_id").deselectAllOptions(),forwardDiv.find("#fwdCommentDiv").val(""),forwardDiv.find(".ztextbox--error__label").remove()}}class ApprovalComment{constructor(approvalParam,layoutParam){this.approvalParam=approvalParam,this.layoutParam=layoutParam}getApprovalParam(){return this.approvalParam}getLayoutParam(){return this.layoutParam}construct(data,isInit){let apprCmtObj=this,recordId=this.getApprovalParam().getRecordId();if(void 0==data&&(data=OPApprovals.APPROVAL_DETAILS[recordId].comments),!data||data.length<1)return;data.actRecId=recordId;let commentObj=this;data.subBtnCallBack=function(editor){commentObj.postApprovalComment(editor)};for(var newJSON={subBtnName:"zp.comment"},comments=data.comments?data.comments:"",commentedZuids=[],cnt=0;cnt<comments.length;cnt++)comments[cnt].content=ZPFeeds.Activity.validateContent(comments[cnt].content,!1,data.departmentDts,data.groupDts),ZPUtil.checkIsExistInArray(commentedZuids,comments[cnt].commby)||commentedZuids.push(comments[cnt].commby);ZPeople.getUserDetailsByIds(commentedZuids,!0);var popup_body_cmt=this.getLayoutParam().getActionLayout().find("#comment_body");popup_body_cmt.attr("streamid",recordId),isInit?(newJSON.calback=function(){var params={method:"showMoreComments",conreqcsr:csrfToken,record_Id:recordId,reqType:"Approval"};ZPeople.Request.send("/showMoreComments.zp",params,function(data,param,apprCmtObj){new ApprovalComment(apprCmtObj.getApprovalParam(),apprCmtObj.getLayoutParam()).construct(data)},apprCmtObj)},ZPA_Common.constructCmtRw(data,popup_body_cmt,newJSON)):(popup_body_cmt.empty(),OPApprovals.APPROVAL_DETAILS[recordId].comments=data,ZPA_Common.constructCmtRw(data,popup_body_cmt,newJSON),popup_body_cmt.find("#view_more_cmts").empty().append("<a totalcmts="+data.totalComments+">"+ZPI18N.getString("zp.viewingallcomments",[data.totalComments])+"</a>"))}postApprovalComment(editor){var pageId=this.getLayoutParam().getActionLayout();let recordId=this.getApprovalParam().getRecordId();var content=ZPFeeds.getSmileysAndMentions(editor.getContent(),ZPeople.isSearchAllowed),messageText=ZPFeeds.getTextContent(content);let timelineObj=this;if(this.validateEditorComment(editor,messageText,content)&&OPApprovals.APPROVAL_DETAILS[recordId]){var btnObj=pageId.find("[streamid="+recordId+"] #postCommentBtn");btnObj.prop("disabled",!0),0===btnObj.find("#loader").length&&btnObj.append(ZPFeeds.MINILOADER);var params={actionType:"INVOKE_ACS",comment:content,conreqcsr:csrfToken,fdk:OPApprovals.APPROVAL_DETAILS[recordId].fdk,messageText:messageText,statusType:People.Approval.type};ZPeople.Request.send("/feedActions.zp",params,function(data){if(200==JSON.parse(data).code){ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.commentaddedsuccessfully"));var tempCmtObj=JSON.parse(data).commentObj[0],comActObj=new People.Comment(new Comment(tempCmtObj),!0);timelineObj.convertPostCommentObj(tempCmtObj);var actJson={};actJson.actRecId=tempCmtObj.actRecId,actJson.type=comActObj.type;var conObj=pageId.find("[streamid='"+tempCmtObj.actRecId+"']"),cmtContObj=$(conObj[0]).find("[actfdk='"+ZPUtil.escapeSelector(params.fdk)+"']");cmtContObj.removeClass("DN");var cmtObj=ZPFeeds.Construction.iterateComments(actJson,[comActObj],cmtContObj);cmtContObj.find("[commentId='"+comActObj.commentId+"']").length>0?cmtContObj.find("[commentId='"+comActObj.commentId+"']").replaceWith(cmtObj):cmtContObj.append(cmtObj),ZPFeeds.Comment.handleCommentCount(!1,params.fdk,comActObj.totalCmtCnt,!1,"comment_body"),editor.setContent(""),ZPFeeds.Comment.removeTextEditor(editor,tempCmtObj.actRecId)}else ZPeople.Message.showFailureMsg(ZPI18N.getString("zp.authorizedfailure"));btnObj.prop("disabled",!1),btnObj.find("#loader").remove()})}}validateEditorComment(editor,messageText,content){return 0===messageText.length&&0===$("<div>").append(content).find("img").length?(ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.pleaseentervalidcomment")),editor.trigger("focus"),!1):!(messageText.length>5e3)||(ZPeople.Message.showWarningMsg(ZPI18N.getString("zp.commentlengthwarning")),editor.trigger("focus"),!1)}convertPostCommentObj(postCmtData){let cmtDataArr=OPApprovals.APPROVAL_DETAILS[postCmtData.actRecId].comments;postCmtData.commby=postCmtData.by,postCmtData.commat=postCmtData.at,postCmtData.content=postCmtData.contents,cmtDataArr.totalComments=postCmtData["ap.totalCmtCnt"],postCmtData.commentId=postCmtData["ap.commentId"],postCmtData.isHTML=postCmtData["ap.isHTML"],cmtDataArr.comments.push(postCmtData)}}class ApprovalOperations{constructor(approvalParams,layoutParams){void 0!=approvalParams&&"ApprovalParam"==approvalParams.constructor.name&&(this.approvalParams=approvalParams,this.layoutParams=layoutParams)}getApprovalParam(){return this.approvalParams}getLayoutParams(){return this.layoutParams}setResponse(response){this.response=response}getResponse(){return this.response}setParams(params){this.params=params}getParams(){return this.params}updateApprovalPages(approvalJson){this.getLayoutParams().getActionLayout()&&this.getLayoutParams().getActionLayout().find("#sliFootDiv").addClass("zpl_DNI"),this.getApprovalDtlCallBack(approvalJson),"MySpace"!==this.layoutParams.mode&&this.updateApprovalHeader(approvalJson),ApprovalList.MySpace.updateApprovalCard(this.getApprovalParam().getRecordId(),approvalJson.currentApprovalStatus)}getApprovalDtlCallBack(approvalJson){let recordId=this.getApprovalParam().getRecordId();if(OPApprovals.APPROVAL_DETAILS[recordId]=approvalJson,ZPApprovals.isTatRefresh){ZPApprovals.isTatRefresh=!1;var data={};data.approvalJson=approvalJson,this.approveRejectDtlCallBack(data,{})}else OPApprovals.Common.Settings.setApprovalSettings(approvalJson.approvalSettingsDetails),this.getLayoutParams().timelineSlider&&new ApprovalTimeline(this.getApprovalParam(),this.getLayoutParams()).initiatePage(this.getLayoutParams().timelineSlider)}bulkApprovalCallBack(apprData,params){let alertDiv=this.getLayoutParams().getLayout(),pageId=Layout.Page.container.find("#"+ApprovalList.getActiveTabName()+"_page_content"),status=JSON.parse(params.approvalStatus),recordIds=JSON.parse(params.recordIds);if(pageId.find("#zp_approval_header").addClass("zpl_DNI"),apprData.error||apprData.errorMsg){let errors=apprData.error;errors&&"string"!=typeof errors&&errors.forEach(function(singleErr){let errCardId=pageId.find("#"+singleErr.recordId);errCardId.find("#error_info").remove(),errCardId.find("div.zcheckbox").addClass("zpl_DNI"),errCardId.addClass("zpl_mspinfo"),errCardId.prepend('<div id="error_info" class="PI_info red tooltip-js M0I" data-title-display-type="box" data-position="top" title="'+singleErr.errorMsg+'"></div>');let posOfEle=ApprovalList.APPROVE_RECIDS.indexOf(singleErr.recordId);-1!==posOfEle&&ApprovalList.APPROVE_RECIDS.splice(posOfEle,1)}),ZPeople.Message.failure(apprData.errorMsg)}else this.getIsCardApproval()&&ApprovalList.MySpace.updateApprovalCards(recordIds,status);!this.getIsCardApproval()&&ApprovalList.APPROVE_RECIDS.length>0&&ApprovalList.MySpace.updateApprovalCards(ApprovalList.APPROVE_RECIDS,status),ApprovalList.APPROVE_RECIDS=[],alertDiv.find("#alrtCls").click()}singleApprovalCallBack(apprData,params){let alertDiv=this.getLayoutParams().getLayout(),pageId=Layout.Page.container.find("#"+ApprovalList.getActiveTabName()+"_page_content");pageId=0!=pageId.length?pageId:Layout.Page.container;let status=JSON.parse(params.approvalStatus),recordIds=JSON.parse(params.recordIds);if(pageId.find("#zp_approval_header").addClass("zpl_DNI"),apprData.error||apprData.errorMsg){let errors=apprData.error;if(errors&&"string"!=typeof errors){let singleErr=errors[0],errCardId=pageId.find("#"+singleErr.recordId);errCardId.find("#error_info").remove(),errCardId.find("div.zcheckbox").addClass("zpl_DNI"),errCardId.addClass("zpl_mspinfo"),errCardId.prepend('<div id="error_info" class="PI_info red tooltip-js M0I" data-title-display-type="box" data-position="top" title="'+singleErr.errorMsg+'"></div>');let posOfEle=ApprovalList.APPROVE_RECIDS.indexOf(singleErr.recordId);if(-1!==posOfEle&&ApprovalList.APPROVE_RECIDS.splice(posOfEle,1),7052==singleErr.code){var isEditAllowed=singleErr.isEditAllowed,errormessage=singleErr.errorMsg;isEditAllowed&&(errormessage+=" "+ZPI18N.getString("zp.clickedit",new Array(errors[0].editLink,'target="_blank"'))),ZPeople.Message.showFailureMsg(errormessage)}else ZPeople.Message.showFailureMsg(singleErr.errorMsg)}}else this.getIsCardApproval()&&ApprovalList.MySpace.updateApprovalCards(recordIds,status);!this.getIsCardApproval()&&ApprovalList.APPROVE_RECIDS.length>0&&ApprovalList.MySpace.updateApprovalCards(ApprovalList.APPROVE_RECIDS,status),ApprovalList.APPROVE_RECIDS=[],alertDiv.find("#alrtCls").click()}bulkApprovalViewCallBack(result){this.getLayoutParams().getLayout().remove(),ApprovalList.APPROVE_RECIDS=[],ZP5Views.refreshview(!0),result.hasOwnProperty("errorMsg")&&ZPeople.Message.failure(result.errorMsg)}dashboardCallback(isPrimaryAppr){if(-1!=Layout.Page.hash.indexOf("#home/dashboard")&&!isPrimaryAppr){let recordId=this.getApprovalParam().getRecordId();var pendingCount=this.getLayoutParams().getLayout().find("#zp_pappr_count b");pendingCount.length>0&&pendingCount.text(pendingCount.text()-1),this.getLayoutParams().getLayout().find("#zp_appr_"+recordId).remove(),19==this.getLayoutParams().getLayout().find("#PENDING_APPROVALS").children("li").length&&ApprovalList.approvalFireScrollAction()}}updateApprovalHeader(approvalJson){let prevStatus=this.getApprovalParam().getApprovalStatus();this.getApprovalParam().setApprovalStatus(approvalJson.currentApprovalStatus),new ApprovalRecordHeader(this.getApprovalParam(),this.getLayoutParams(),{isRecordApprover:approvalJson.isOwner,isPrimaryApprover:approvalJson.isPrimaryAppr,previousStatus:prevStatus,isResubmitApplicable:approvalJson.isResubmitApplicable}).show()}}class ApproveReject extends ApprovalOperations{constructor(approvalParams,layoutParams,status,comment,isApproveAllLevel){super(approvalParams,layoutParams),this.comment=comment,this.isApproveAllLevel=isApproveAllLevel,this.status=status}getComment(){return this.comment}getisApproveAllLevel(){return this.isApproveAllLevel}getStatus(){return this.status}setIsBulkApproval(isBulkApproval){this.isBulkApproval=isBulkApproval}getIsBulkApproval(){return!!this.isBulkApproval&&this.isBulkApproval}setIsCardApproval(isCardApproval){this.isCardApproval=isCardApproval}getIsCardApproval(){return!!this.isCardApproval&&this.isCardApproval}execute(){if(this.validateApprovalComment(this.getStatus(),this.getComment(),this.layoutParams.actionLayout.find("#approver_comment")))if(this.getIsBulkApproval()||this.getIsCardApproval())this.invokeFormAction();else{let initialCallback=OPApprovals.ModuleCallback.ApproveReject.initialCallback(this.getApprovalParam().getTableName());ZPUtil.Validation.isFunction(initialCallback)?initialCallback(this):this.invokeFormAction()}else this.layoutParams.actionLayout.find("[name='approvalBtn']").attr("disabled",!1)}invokeFormAction(){let operationObj=this,recordId=this.getIsBulkApproval()?this.getApprovalParam().getRecordIds():this.getApprovalParam().getRecordId();this.setIsBulkApproval("string"!=typeof recordId);let isBulkApproval=this.getIsBulkApproval(),approvalStatus=this.getStatus(),params={mode:"approveRejectRecord",recordIds:isBulkApproval?JSON.stringify(recordId):JSON.stringify(new Array(recordId)),comment:this.getComment(),approvalStatus:approvalStatus},isSingleRecord=-1==params.recordIds.indexOf(",");isBulkApproval||(params.fetchApproval=!0,params.formId=this.getApprovalParam().getFormId()),"1"==approvalStatus&&(params.isAllLevelApprove=this.getisApproveAllLevel()),ZPeople.Request.send(ZP5Form.URL,params,function(resultData){isBulkApproval?void 0!=Layout.Page.urlparam.viewId&&ZP5Views.getCurrViewObj().isApproverViewType()?operationObj.bulkApprovalViewCallBack(resultData,params):isSingleRecord?operationObj.singleApprovalCallBack(resultData,params):operationObj.bulkApprovalCallBack(resultData,params):operationObj.approveRejectDtlCallBack(resultData,params),-1!==Layout.Page.hash.indexOf("home/myspace")&&ApprovalHome.getPendingCount()})}approveRejectDtlCallBack(apprData,params){let recordId=this.getApprovalParam().getRecordId();if(this.setResponse(apprData),this.setParams(params),!(!apprData.error&&!apprData.errorMsg||params&&"forwardApproval"==params.method))return this.getLayoutParams().getActionLayout().find("#approver_comment").siblings().attr("disabled",!1),void this.constructApproveRejectError(apprData,this.getLayoutParams().getActionLayout().find("#approver_comment"));if(apprData&&apprData.approvalJson){if(apprData.errorMsg){var error_Msg=apprData.errorMsg;this.getLayoutParams().getActionLayout().find("#zp_modal_body").html(CommonTemplates.noDataSVG("",!0,error_Msg,!1))}else{if(apprData.isPhotoTransferApproved){let userDts=ZPeople.getUserDetailsById(apprData.approvalJson.recOwner);if(void 0!==apprData.approvalJson.recordowner.photo&&""!==apprData.approvalJson.recordowner.photo)apprData.approvalJson.recordowner.photo.split("|").length>0&&void 0!==apprData.approvalJson.recOwner&&(userDts.avatarid=apprData.avatarId,ZPeople.setPhotoURL("1",void 0,userDts));$("img[empid="+userDts.usererec+"][elem=profilePhoto], img[empid="+userDts.id+"][elem=profilePhoto]").each(function(){var imgType=$(this).attr("imgtype");this.src="thumb"===imgType?userDts.thumb:"original"===imgType?userDts.originalphoto:"zpimg"===imgType?userDts.zpeoplePhoto:userDts.avatar})}this.updateApprovalPages(apprData.approvalJson)}let callback=OPApprovals.ModuleCallback.ApproveReject.postCallback(this.getApprovalParam().getTableName());ZPUtil.Validation.isFunction(callback)?callback(this):(OPApprovals.Forms.listCallBack(recordId,this.getApprovalParam().getApprovalStatus()),ZP5Views.refreshAllViews(this.getApprovalParam().getFormId()))}}constructApproveRejectError(){let approvalResult=this.getResponse(),isBulkApproval=(this.getApprovalParam().getRecordId(),this.getIsBulkApproval());if(approvalResult&&approvalResult.error){var errors=approvalResult.error;if(isBulkApproval){var singleErr;ZPeople.Message.failure(approvalResult.errorMsg);for(var i=0;i<errors.length;i++){singleErr=errors[i];var recordRow=this.getLayoutParams().getLayout().find("#zp_approval_pagecontent").find("#"+singleErr.recordId);!singleErr.actionStatus&&recordRow&&(recordRow.addClass("zp_err"),7328===singleErr.code&&(singleErr.errorMsg=ZPI18N.getString("zp.commentsrequirederrormsg")),$('<i class="IC-info popHover" data-toggle="popover" data-content="'+singleErr.errorMsg+'" data-popover="true" ></i>').insertAfter(recordRow.find("#zp_approval_approvereject,.zpl_hvr")))}this.getLayoutParams().getLayout().find("#zp_approval_pagecontent").popover({selector:"[data-popover].popHover",trigger:"click hover",placement:"right",delay:{show:50,hide:50}}),setTimeout(function(){this.getLayoutParams().getLayout().find("#zp_approval_pagecontent").find(".zp_err").removeClass("zp_err")},3e3)}else if(!isBulkApproval&&this.getLayoutParams().getActionLayout()&&this.getLayoutParams().getActionLayout().find("#approver_comment").length>0){let siblingDiv=this.getLayoutParams().getActionLayout().find("#approver_comment");if(siblingDiv.removeClass(".ztextbox__error"),siblingDiv.siblings("#cmtErrMsg").remove(),1==errors.length)if(7052==errors[0].code){var editLink=errors[0].editLink,isEditAllowed=errors[0].isEditAllowed,errormessage=errors[0].errorMsg;if(isEditAllowed)void 0!=(editLink=ZP5Form.getFormActionUrl("edit","","",errors[0].recordId))&&""!=editLink&&-1==Layout.Page.hash.indexOf("home/myspace")||(editLink=errors[0].editLink),errormessage+=" "+ZPI18N.getString("zp.clickedit",new Array(editLink));ZPeople.Message.failure(errormessage)}else $(OPApprovals.Common.getMandatoryCommentErrHTML(errors[0].errorMsg),this.getLayoutParams().getMode()).insertAfter(siblingDiv),siblingDiv.addClass(".ztextbox__error")}}else approvalResult&&approvalResult.errorMsg&&ZPeople.Message.failure(approvalResult.errorMsg)}validateApprovalComment(type,comment,commentBoxObj){return!this.isMandatoryApprovalComment(type)||(commentBoxObj.siblings("#cmtErrMsg").remove(),commentBoxObj.removeClass("ztextbox__error"),!ZPUtil.Validation.isEmpty(comment)||($(OPApprovals.Common.getMandatoryCommentErrHTML(ZPI18N.getString("zp.apprCmtMandatoryErr"),this.getLayoutParams().getMode())).insertAfter(commentBoxObj),commentBoxObj.addClass("ztextbox__error"),!1))}isMandatoryApprovalComment(type){let approvalSettings=this.getApprovalParam().getApprovalSettings();return approvalSettings&&(type==zpconst.ApprovalStatus.Approved&&1==approvalSettings.isApprMandatory||type==zpconst.ApprovalStatus.Rejected&&1==approvalSettings.isRejMandatory)}}class ApprovalForward extends ApprovalOperations{constructor(approvalParam,layoutParam){super(approvalParam,layoutParam)}static getForwardMenuProperty(recordId){let frwdProp={};return frwdProp.dataSource={search:function(params){return new Promise(function(search,reject){let getNonValidForwardUsers=ApprovalForward.getNonValidForwardUsers(OPApprovals.APPROVAL_DETAILS[recordId]);search({delay:20,results:ZPA_Common.getDecodedEmpIdWithName(EmployeeSearch.getEmpList(params.query,"emp","DELEGATION_DELEGATOR",getNonValidForwardUsers,void 0,!1,ZPeople.getUserDetailsById(erecno).reportingTo)),more:!1})})},paginated:!0},frwdProp.dataMapping={value:"id",label:"value",image:"image"},frwdProp.serverSearch=!0,frwdProp.cacheData=!0,frwdProp.contentType="image-text",frwdProp.search={by:["value","email"]},frwdProp.placeholder=ZPI18N.getString("zp.selectapprover"),ZPA_Common.ZCompProp.loadSelectListProp(frwdProp),frwdProp}static getNonValidForwardUsers(apprDtl){let notEligibleForwardingUser=[];return notEligibleForwardingUser.push(erecno),apprDtl&&apprDtl.current&&(notEligibleForwardingUser.push(apprDtl.current.erecno),apprDtl.current.delegatee&&apprDtl.current.delegatee.erecno&&notEligibleForwardingUser.push(apprDtl.current.delegatee.erecno)),notEligibleForwardingUser}setForwardErecno(forwardErecno){this.forwardErecno=forwardErecno}getForwardErecno(){return this.forwardErecno}setComment(comment){this.comment=comment}getComment(){return this.comment}execute(getThis){let forwardDiv=$(getThis).closest("#forwardingDiv");this.setForwardErecno(ZPeopleComponents.select(forwardDiv.find("#appr_forward_id")).getValue()),this.setComment(forwardDiv.find("#fwdCommentDiv").val()),this.forwardValidation(forwardDiv),new ApprovalTimeline(this.getApprovalParam(),this.getLayoutParams()).registerForwardTimelineEvent()}forwardApproval(){this.getLayoutParams().getActionLayout().find("#forwardingDiv button.zlabel").prop("disabled",!0);var params={method:"forwardApproval",recordId:this.getApprovalParam().getRecordId(),formId:this.getApprovalParam().getFormId(),comment:this.getComment(),forwardErecno:this.getForwardErecno()};ZPeople.Request.send("/forwardApproval.zp",params,this.forwardApprovalCallBack,this,this.failureCallBack)}forwardValidation(forwardDiv){let forwardObj=this,apprDtl=OPApprovals.APPROVAL_DETAILS[forwardObj.getApprovalParam().getRecordId()],baseTable=apprDtl.tableName,skipRecordValidation="P_Compensatory"==baseTable||"P_LeaveGrant"==baseTable||"P_AttendanceReg"==baseTable||"P_AttendanceOD"==baseTable||"P_ShiftMappingForm"==baseTable||"P_AutoShiftAssignForm"===baseTable||"P_PermissionDetails"==baseTable,errMsg="";if(forwardDiv.find(".ztextbox--error__label").remove(),(skipRecordValidation||apprDtl.currentApprovalStatus==zpconst.ApprovalStatus.Pending||apprDtl.currentApprovalStatus==zpconst.ApprovalStatus.CancellationPending)&&apprDtl&&apprDtl.current)if(apprDtl.canForwardApproval)if(skipRecordValidation||forwardObj.getApprovalParam().getIsRecordAdmin()||apprDtl.isPrimaryAppr){var fwdErecno=forwardObj.getForwardErecno();void 0!=fwdErecno&&""!=fwdErecno?fwdErecno==apprDtl.current.erecno||void 0!=apprDtl.current.delegatee&&fwdErecno==apprDtl.current.delegatee.erecno?errMsg=ZPI18N.getString("zp.apprfrwdcurrapprerr"):forwardObj.validateComment(forwardDiv)&&forwardObj.forwardApproval():errMsg=ZPI18N.getString("zp.selectapprover")}else errMsg=ZPI18N.getString("zp.ttpermdenied");else errMsg=ZPI18N.getString("zp.forwardonceerr");else errMsg=ZPI18N.getString("zp.recnopending");errMsg.length>0&&forwardObj.showErrorMsg(forwardDiv.find("#fwdCommentDiv"),errMsg)}forwardApprovalCallBack(resultData,params,forwardObj){let forwardDiv=forwardObj.getLayoutParams().getActionLayout().find("#forwardingDiv");if(forwardDiv.find("button.zlabel").prop("disabled",!1),7e3==resultData.code)new ApproveReject(forwardObj.getApprovalParam(),forwardObj.getLayoutParams()).approveRejectDtlCallBack(resultData,params),-1!==Layout.Page.hash.indexOf("home/myspace")&&ApprovalHome.getPendingCount();else{let fwdCommentDiv=forwardDiv.find("#fwdCommentDiv");resultData.errorMsg?forwardObj.showErrorMsg(fwdCommentDiv,resultData.errorMsg):resultData.message&&forwardObj.showErrorMsg(fwdCommentDiv,resultData.message)}}failureCallBack(failureData,params,forwardObj){forwardObj.getLayoutParams().getActionLayout().find("#forwardingDiv").find("button.zlabel").prop("disabled",!1),failureData.hasOwnProperty("responseJSON")&&failureData.responseJSON.hasOwnProperty("error")&&failureData.responseJSON.error.trim().length>0&&ZPeople.Message.showFailureMsg(failureData.responseJSON.error)}validateComment(forwardDiv){let comment=this.getComment(),errMsg="";return ZPUtil.Validation.isEmpty(comment)?errMsg=ZPI18N.getString("zp.commentsrequirederrormsg"):comment.trim().length>250&&(errMsg=ZPI18N.getString("zp.commentlenerr")),!(errMsg.length>0)||(this.showErrorMsg(forwardDiv.find("#fwdCommentDiv"),errMsg),!1)}showErrorMsg(divToAppend,errorMsg){divToAppend&&$('<div class="ztextbox--error__label">'+errorMsg+"</div>").insertAfter(divToAppend)}}class ApprovalFollowup extends ApprovalOperations{constructor(approvalParam,layoutParam){super(approvalParam,layoutParam)}execute(){let operationObj=this,confirmPopup=new InfoAlertMessage(ZPI18N.getString("zp.sendfollowuphdr"),ZPI18N.getString("zp.sendfollowupdesc"));confirmPopup.yesButtonText=ZPI18N.getString("zp.confirm"),confirmPopup.setCallback(function(popupModal){operationObj.sendFollowupMail()}),confirmPopup.show()}sendFollowupMail(){let operationObj=this;var params={method:"sendFollowupAction",conreqcsr:csrfToken};operationObj.getApprovalParam().getRecordId()&&(params.recordId=this.getApprovalParam().getRecordId(),$.post("/sendFollowUpMail.zp",params,function(data){"success"===data.result&&(ZPeople.Message.success(ZPI18N.getString("zp.mailsent")),operationObj.getLayoutParams().getLayout().find("#zp_approval_followupbtn").attr("disabled","disabled"))}))}}class ApprovalResubmit extends ApprovalOperations{constructor(approvalParam,layoutParam){super(approvalParam,layoutParam)}resubmit(){ZP5Form.IS_RESUBMIT=!0,ZP5Form.RESUBMIT_RECORDID=this.getApprovalParam().getRecordId(),this.getLayoutParams().getFooterLayout().find("#resubmit_approval").addClass("disabled"),ZP5Form.showForm("add",this.getApprovalParam().getFormId())}}class ApprovalCancel extends ApprovalOperations{constructor(approvalParam,layoutParam){super(approvalParam,layoutParam)}setComment(comment){this.comment=comment}getComment(){return this.comment}setError(errorMsg){this.errorMsg=errorMsg}getError(){return this.errorMsg}cancel(){let cancelPopupObj=new InfoAlertMessage(ZPI18N.getString("zp.requestcancel")+"?",ZPI18N.getString("zp.confirmcancelwithoutreason"));this.isCancelCommentMandatory()&&(cancelPopupObj.despcription=ZPI18N.getString("zp.confirmcancelrecordwithreason"),cancelPopupObj.setCenterHtml('<textarea id="cancel_comment" class="ztextbox" name="remark" rows="5" placeholder="'+ZPI18N.getString("zp.reasonforcancel")+'"></textarea>')),cancelPopupObj.yesButtonText=ZPI18N.getString("zp.confirm"),cancelPopupObj.setCallback(this.cancelRecord),cancelPopupObj.removeAfterYes=!1,cancelPopupObj.show(),cancelPopupObj.cancelObj=this}cancelRecord(popUpObj){let cancelObj=popUpObj.cancelObj;if(cancelObj.setComment(popUpObj.alertDiv.find("#cancel_comment").val()),!cancelObj.isCancelCommentMandatory()||cancelObj.validate()){var params={mode:"cancelRecord",recordId:cancelObj.getApprovalParam().getRecordId(),formId:cancelObj.getApprovalParam().getFormId()};cancelObj.getComment()&&(params.comment=cancelObj.getComment()),cancelObj.getLayoutParams().getMoreLayout().find("#cancel_approval").prop("disabled",!0),popUpObj.close(),ZPeople.Request.send(ZP5Form.URL,params,(result,params)=>{cancelObj.cancelRecordResponse(result,params)},void 0,OPApprovals.Common.failureCallBack)}else cancelObj.getError()&&(popUpObj.alertDiv.find("#cmtErrMsg").remove(),$(OPApprovals.Common.getMandatoryCommentErrHTML(cancelObj.getError())).insertAfter(popUpObj.alertDiv.find("#cancel_comment")))}getEmptyReasonError(){return ZPI18N.getString("zp.leave.cancell.error.providereason")}getReasonLengthExceedError(){return ZPI18N.getString("zp.leave.cancell.error.reasonlength")}validate(){var errorMsg;let comment=this.getComment();return ZPUtil.Validation.isEmpty(comment)?errorMsg=this.getEmptyReasonError():comment.length>250&&(errorMsg=this.getReasonLengthExceedError()),!errorMsg||(this.setError(errorMsg),!1)}isCancelCommentMandatory(){return"1"==this.getApprovalParam().getApprovalSettings().isCancelMandatory}cancelRecordResponse(result,params){let formId=this.getApprovalParam().getFormId(),recordId=this.getApprovalParam().getRecordId();if(this.setParams(params),this.setResponse(result),this.getLayoutParams().getMoreLayout().find("#cancel_approval").prop("disabled",!1),7e3===result.code){let recordDetail=ZP5Form.getSingleRecord();recordDetail&&recordDetail.record&&(recordDetail.record.canCancel=!1),result.message&&ZPeople.Message.success(result.message),result.approvalJson?(ZPeople.Message.success(ZPI18N.getString("zp.sentcancelapprsuccessmsg")),new ApproveReject(this.getApprovalParam(),this.getLayoutParams()).approveRejectDtlCallBack(result,params)):(OPApprovals.refreshApprovalData(recordId),this.updateApprovalPages(OPApprovals.getApprovalData(recordId,formId))),ZP5Views.refreshAllViews(formId),ZP5Form.refreshRecord(formId,recordId)}else 7878===result.code||7328===result.code?ZPeople.Message.failure(result.message):(ZP5Form.refreshRecord(formId,recordId),ZPeople.Message.failure(ZPI18N.getString("zp.cancelfailed")));let callback=OPApprovals.ModuleCallback.CancelApproval.postCallback(this.getApprovalParam().getTableName());ZPUtil.Validation.isFunction(callback)&&callback(this)}}class ApprovalRevoke extends ApprovalCancel{constructor(approvalParam,layoutParam){super(approvalParam,layoutParam)}cancel(){let revokePopupObj=new InfoAlertMessage(ZPI18N.getString("zp.revokeresignreqst"),ZPI18N.getString("zp.revokeresignreqstdesc"));this.isCancelCommentMandatory()&&revokePopupObj.setCenterHtml('<textarea id="cancel_comment" class="ztextbox" name="remark" rows="5" placeholder="'+ZPI18N.getString("zp.enterthereason")+'"></textarea>'),revokePopupObj.yesButtonText=ZPI18N.getString("zp.confirm"),revokePopupObj.setCallback(this.cancelRecord),revokePopupObj.removeAfterYes=!1,revokePopupObj.show(),revokePopupObj.cancelObj=this}isCancelCommentMandatory(){return!0}getEmptyReasonError(){return ZPI18N.getString("zp.reasonismandatory")}}class ApprovalSLA{constructor(approvalParams,loadParams){this.approvalParams=approvalParams,this.loadParams=loadParams}getApprovalParams(){return this.approvalParams}showSLATimer(){let recordId=this.getApprovalParams().getRecordId();if(clearInterval(OPApprovals.sla_timer),void 0==OPApprovals.APPROVAL_DETAILS[recordId].timeRequested)OPApprovals.APPROVAL_DETAILS[recordId].timeRequested=(new Date).getTime(),OPApprovals.sla_timer=setInterval(OPApprovals.setSLATimer,1e3);else{var sla_timer=Layout.Page.container.find("#sla_time"),slaTimeStr=OPApprovals.APPROVAL_DETAILS[recordId].current.nextTATTime,timeDiff=(new Date).getTime()-OPApprovals.APPROVAL_DETAILS[recordId].timeRequested;if(-1!=slaTimeStr.indexOf(":")){var time=slaTimeStr.split(" : "),timeinsec=3600*time[0]+60*time[1]+parseInt(time[2])-Math.floor(timeDiff/1e3);if(timeinsec<0)OPApprovals.APPROVAL_DETAILS[recordId].refresh=!0,OPApprovals.getApprovalDetails();else{var hours=Math.floor(timeinsec/3600);timeinsec%=3600;var minutes=Math.floor(timeinsec/60);timeinsec%=60,sla_timer.html(SLA.getTimeIn2Digit(hours)+" : "+SLA.getTimeIn2Digit(minutes)+" : "+SLA.getTimeIn2Digit(timeinsec)),OPApprovals.sla_timer=setInterval(OPApprovals.setSLATimer,1e3)}}else timeDiff>36e5&&(OPApprovals.APPROVAL_DETAILS[recordId].refresh=!0,OPApprovals.getApprovalDetails())}}setSLATimer(){var sla_timer=Layout.Page.container.find("#sla_time"),slaTimeStr=sla_timer.html();if(void 0==slaTimeStr||"00 : 00 : 00"===slaTimeStr||-1==slaTimeStr.indexOf(":"))clearInterval(OPApprovals.sla_timer);else{var time=slaTimeStr.split(" : "),timeinsec=3600*time[0]+60*time[1]+parseInt(time[2])-1;if(timeinsec>0){var hours=Math.floor(timeinsec/3600);timeinsec%=3600;var minutes=Math.floor(timeinsec/60);timeinsec%=60,sla_timer.html(SLA.getTimeIn2Digit(hours)+" : "+SLA.getTimeIn2Digit(minutes)+" : "+SLA.getTimeIn2Digit(timeinsec))}else sla_timer.prev().html(ZPI18N.getString("zp.escalated")),sla_timer.html("00 : 00 : 00"),clearInterval(SLA.timer),OPApprovals.APPROVAL_DETAILS[recordId].refresh=!0,OPApprovals.isTatRefresh=!0,setTimeout(function(){OPApprovals.getApprovalDetails()},3e3)}}}class SendForApproval extends ApprovalOperations{constructor(approvalParams,layoutParams){super(approvalParams,layoutParams)}static getButton(){return'<button class="zlabel zlabel--blue zlabel--medium" id="sendApprBtn" name="apprRelBtn">'+ZPI18N.getString("zp.sendforapproval")+"</button>"}static getChooseApproverHtml(isFormView){let approverHtml="";return approverHtml=isFormView?'<div class="zpl_frmselappr"><div class="zpl_crd "><div class="zpl_crdhdr"><div><h4>'+ZPI18N.getString("zp.selectapprover")+'</h4></div></div><div class="zpl_crdcnt" id="zp_form_chooseappr_cont" row="1"><div class="zpl_frmclm zpl_frmclmlst"><div><div class="zpl_secn"><div><label class="zpl_mtry">'+ZPI18N.getString("zp.approver")+'</label></div><div><div><select id="zp_form_chooseapprover" name="zp_approverId" style="display:none;"></div></div></div></div></div></div></div></div>':'<div class="zpl_crd"><div id="zp_form_chooseappr_cont" class="zpl_crdcnt"><div class="zpl_secn"><div><label class="w120">'+ZPI18N.getString("zp.selectapprover")+'</label></div><div><select id="zp_form_chooseapprover" name="zp_approverId"></select></div></div><div></div>'}static getChooseApproverProp(){let apprProp={};return apprProp.dataSource={search:function(params){return new Promise(function(search,reject){search({delay:20,results:ZPA_Common.getDecodedEmpIdWithName(EmployeeSearch.getEmpList(params.query,"emp","AUTOMATION")),more:!1})})},paginated:!0},apprProp.dataMapping={value:"id",label:"value",image:"image"},apprProp.serverSearch=!0,apprProp.cacheData=!0,apprProp.contentType="image-text",ZPA_Common.ZCompProp.loadSelectListProp(apprProp),apprProp}getApproverErecno(){return this.approverErecno}setApproverErecno(approverErecno){this.approverErecno=approverErecno}execute(getThis){"APPROVER_CHOOSEN_BY_USER"===OPApprovals.Forms.getApproverType(this.getApprovalParam().getFormId())?this.showChooseApproverPopUp(getThis):this.triggerRecordApproval()}showChooseApproverPopUp(sendForApprBtn){let tabObj=new Tab(ZPI18N.getString("zp.sendforapproval"),()=>this.constructChooseApproverHtml(),()=>this.validateAndTriggerApproverChoosen());this.popupObj=new popupModal(ZPI18N.getString("zp.sendforapproval"),tabObj),this.popupObj.mediumSize=!0,this.popupObj.isAppendToBody=!0,this.popupObj.save=ZPI18N.getString("zp.submit"),this.popupObj.construct(),this.popupObj.setCloseCallback(()=>this.closeChooseApproverPopUp(sendForApprBtn))}closeChooseApproverPopUp(sendForApprBtn){this.popupObj&&this.popupObj.sliderDiv&&(this.popupObj.sliderDiv.remove(),sendForApprBtn&&(ApprovalRecordHeader.registerSendForApprovalEvent(this.getApprovalParam(),this.getLayoutParams()),$(sendForApprBtn).attr("disabled",!1)))}constructChooseApproverHtml(){this.popupObj.sliderDiv.find("#cardSendforApproval").append(SendForApproval.getChooseApproverHtml(!1)),ZPeopleComponents.select("#zp_form_chooseapprover",SendForApproval.getChooseApproverProp())}triggerRecordApproval(){let operationObj=this,params={method:"triggerRecordApproval",recordId:this.getApprovalParam().getRecordId(),formId:this.getApprovalParam().getFormId(),conreqcsr:csrfToken},isApprHeader=!1;this.getLayoutParams().getLayout().find("#headerApprovalBtn").length>0&&(isApprHeader=!this.getLayoutParams().getLayout().find("#headerApprovalBtn").hasClass("zpl_DNI"),this.getLayoutParams().getLayout().find("#headerApprovalBtn").addClass("zpl_DNI")),this.getApproverErecno()&&(params.empChoosenApprErecno=this.getApproverErecno()),$.post("/triggerRecordApproval.zp",params,function(data){if(operationObj.setResponse(data),operationObj.setParams(params),data.errorMsg)ZPeople.Message.failure(data.errorMsg),isApprHeader&&operationObj.getLayoutParams().getLayout().find("#headerApprovalBtn").removeClass("zpl_DNI"),$(getThis).attr("disabled",!1),ApprovalRecordHeader.registerSendForApprovalEvent(operationObj.getApprovalParam(),operationObj.getLayoutParams());else{ZPeople.Message.success(ZPI18N.getString("zp.sentapprsuccessmsg"));let callback=OPApprovals.ModuleCallback.SendForApproval.postCallback(operationObj.getApprovalParam().getTableName());ZPUtil.Validation.isFunction(callback)?callback(operationObj):new ApproveReject(operationObj.getApprovalParam(),operationObj.getLayoutParams()).approveRejectDtlCallBack(data,params)}}),this.closeChooseApproverPopUp()}validateAndTriggerApproverChoosen(getThis){let apprChoosenDiv;(apprChoosenDiv=getThis&&$(getThis).siblings("#zp_form_chooseapprover").length>0?$(getThis).siblings("#zp_form_chooseapprover"):this.popupObj.sliderDiv.length>0?this.popupObj.sliderDiv.find("#zp_form_chooseapprover"):this.getLayoutParams().getLayout().find("#zp_form_chooseapprover")).length>0&&(ZPA_Common.removeErrorDiv(apprChoosenDiv.parent()),apprChoosenDiv.val()?(this.setApproverErecno(apprChoosenDiv.val()),this.triggerRecordApproval()):(ZPA_Common.appendErrorDiv(apprChoosenDiv.next("div"),ZPI18N.getString("zp.chooseapprovererrormsg")),$(getThis).attr("disabled",!1),ApprovalRecordHeader.registerSendForApprovalEvent(this.getApprovalParam(),this.getLayoutParams())))}}RecordTemplate_Download={initPage:function(){RecordTemplate_Download.construct(),RecordTemplate_Download.loadDefault()},construct:function(){var tab=new Tab;tab.id="downloadRT_slider",tab.cardId="ddrcdTemp_cards",tab.validate=RecordTemplate_Download.downloadPDF,RecordTemplate_Download.ddtempModal=new sliderModal(ZPI18N.getString("zp.downloadtemplate"),tab);var footerContent='<button id="sliderSbt" type="button" class="zlabel zlabel--blue zlabel--medium">'+ZPI18N.getString("zp.Download")+'</button> <button id="sliderCancel" type="button" class="zlabel zlabel--outline zlabel--medium">'+ZPI18N.getString("zp.cancel")+"</button>";RecordTemplate_Download.ddtempModal.isAppendToBody=!0,RecordTemplate_Download.ddtempModal.construct(void 0,footerContent),RecordTemplate_Download.ddtempModal.setCloseCallback(function(){RecordTemplate_Download.ddtempModal.remove()});var $temp_cards=$("body #modal_Container").find("#downloadRT_slider").find("#"+tab.cardId);ZPA_Common.setRelativeContainer($temp_cards),$temp_cards.append(RecordTemplate_Download.getContainerBody())},loadDefault:function(){var params={mode:"getPDFTemplateList",formID:ZP5Form.getCurrFormsOperation().FORM_CLASS_OBJ.getFormsProperties().getFormId(),recordID:ZP5Form.getCurrFormsOperation().FORM_CLASS_OBJ.getFormsProperties().getRecordId(),isFromNewUI:!0};ZPeople.Request.send("/templateActions.zp",params,RecordTemplate_Download.constructTemplate,{},(data,params,others)=>{ServiceApplicabilityUtil.Error.showWarningMessage(data,params,others,(data,params,others)=>RecordTemplate_Download.ddtempModal.close())})},constructTemplate:function(data){let tempProps={options:data.templateList,dataMapping:{label:"templateName",value:"templateID"},change:RecordTemplate_Download.onTemplateChange,selectedValue:""};ZPA_Common.ZCompProp.loadSelectListProp(tempProps),tempProps.dropdownList.appendTo="#ddrcdTemp_cards",ZPeopleComponents.select("#rcdTemp_List",tempProps)},onTemplateChange:function(event){event.detail.options.mode;var pageId=$("body #modal_Container").find("#downloadRT_slider");ZPA_Common.removeErrorDiv(pageId);event.detail.optionData.templateID;var templateMsg=event.detail.optionData.template;pageId.find("#msgTemplate").removeClass("DN"),pageId.find("#msgTemplate").html(RecordTemplate_Download.getViewTemplateHtml(templateMsg))},downloadPDF:function(){var pageId=$("body #modal_Container").find("#downloadRT_slider");ZPA_Common.removeErrorDiv(pageId);var templateID=ZPeopleComponents.select("#rcdTemp_List").getValue();if(ZPA_Common.isNotNull(templateID)&&"-1"!==templateID){var formID=ZP5Form.getCurrFormsOperation().FORM_CLASS_OBJ.getFormsProperties().getFormId(),recordID=ZP5Form.getCurrFormsOperation().FORM_CLASS_OBJ.getFormsProperties().getRecordId(),formDispName=ZP5Form.getCurrFormsOperation().getFormDisplayName(),pdfViewType=pageId.find("[name=viewtype]:checked").attr("value"),form=$(pageId.find("#zp_rcdTmp")[0]);form.empty();var params="mode=downloadAsPDF&formID="+formID+"&recordID="+recordID+"&templateID="+templateID+"&formDispName="+formDispName+"&pdfType="+pdfViewType+"&isFromNewUI=true";form.attr("action","templateActions.zp?"+params),form.append('<input type="hidden" value="'+csrfToken+'" name="'+csrfParamName+'"/>'),form.trigger("submit")}else ZPA_Common.appendErrorDiv(pageId.find("#rcdTemp_List").parent(),ZPI18N.getString("zp.selletter"))},getViewTemplateHtml:function(content){return'<div id="viewTempDiv" style="padding:10px; min-height:200px;">'+content+"</div>"},getContainerBody:function(){return'<div class="zpl_crd"><div class="zpl_crdcnt">\n\t\t\t\t\t\t\t<div class="zpl_secn"><div><label>'+ZPI18N.getString("zp.selecttemplate")+'</label></div><div><select type="text" id="rcdTemp_List" class="ztextbox" value=""></select></div></div>\n\t\t\t\t\t\t\t<div class="zpl_secn">\t\n\t\t\t\t\t\t\t\t<div><label>'+ZPI18N.getString("zp.viewtype")+'</label></div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t   \t<div class="zpl_idiv">\n\t\t\t\t\t\t              \t<div class="zradiobutton zradiobutton--horizontal"><input id="portraitType" type="radio" value="portrait" name="viewtype" class="zradiobutton__helper" checked=""><label for="portraitType" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.portraitview")+'</span></label></div>\n\t\t\t\t\t\t              \t<div class="zradiobutton zradiobutton--horizontal"><input id="landscapeType" type="radio" value="landscape" name="viewtype" class="zradiobutton__helper"><label for="landscapeType" class="zradiobutton__label"><span class="zradiobutton__text">'+ZPI18N.getString("zp.landscapeview")+'</span></label></div>\n\t\t\t\t              \t\t</div>\n\t\t\t\t              \t</div>\n\t\t\t              \t</div>\n\t\t\t              \t<div class="zpl_secn"><div id="msgTemplate" class="zpl_msgedtr DN"></div></div>\n\t\t\t              \t<form id="zp_rcdTmp" class="DN" method="Post"></form>\n\t\t\t\t\t\t</div></div>'}};