Compensation.Config={configObj:{},isTempEnabled:!1,getConfiguration:async function(isRef){var params={conreqcsr:csrfToken};let url="onboarding"==settingsUrlProps.currentMode?"/offersetting/getOfferConfig":"/compensation/getSetup";if(!Compensation.Config.configObj||0===Object.keys(Compensation.Config.configObj).length||isRef){const response=await Compensation.Utils.sendReqAsPromise(url,params);Compensation.Config.setConfiguration(response.config)}return Promise.resolve(Compensation.Config.configObj)},getConfiguration_asSync:function(isRef){var params={conreqcsr:csrfToken};let url="onboarding"==settingsUrlProps.currentMode?"/offersetting/getOfferConfig":"/compensation/getSetup";return Compensation.Config.configObj&&0!==Object.keys(Compensation.Config.configObj).length&&!isRef||ZPeople.Request.sendAsyncPost(url,params,function(response){Compensation.Config.setConfiguration(response.config)}),Compensation.Config.configObj},setConfiguration:function(configObj){Compensation.Config.configObj=configObj;var isSalaryStructureEnabled=Compensation.Config.configObj.isTemplateConfigurationEnabled;Compensation.Config.isTempEnabled=isSalaryStructureEnabled},fetchCompModApplRoles:function(){return Compensation.Utils.sendReqAsPromise("/compensation/permissions/moduleapplicability/read",{})},saveCompModApplRoles:function(currentSelVals,isFromNewSettings){isFromNewSettings&&ZPeople.autosave.loading(settingsPage.container.find("#compModAppCrd"),ZPI18N.getString("zp.saving"));var params={conreqcsr:csrfToken,selectedRoleIds:JSON.stringify(currentSelVals)};ZPeople.Request.send("/compensation/permissions/moduleapplicability/upsert",params,function(response,params){Compensation.Utils.commonErrorHandler(response)?isFromNewSettings?(ZPeople.autosave.fail(settingsPage.container.find("#compModAppCrd"),ZPI18N.getString("zp.notsaved")),ModuleComp.Msg.showFailureMsg(response.errMsg)):ZPeople.Message.showFailureMsg(response.errMsg):response.rolesSaved&&(Compensation.Config.savedCompModApplRoles=response.savedRoles,void 0!=Compensation.RoleBasedOperations.DATA&&Compensation.RoleBasedOperations.setRefreshNeeded(!0),isFromNewSettings?(settingsPage.container.find("#saveCompAppDiv").hide(),ZPeople.autosave.success(settingsPage.container.find("#compModAppCrd"),ZPI18N.getString("zp.saved")),Compensation.RoleBasedOperations.DATA.isPermsRefreshNeeded=!0):(ZPeople.Message.showSuccessMsg(ZPI18N.getString("zp.compensation.compModApplRolesUpdateSuccess")),Layout.Page.container.find("#addSaveCancelbtnsDiv").empty()))})},setApplicableRoles:function(resultdata){let rolesList=resultdata.rolesList;Compensation.Config.savedCompModApplRoles=resultdata.compModApplRoles,Compensation.Config.availableRoles=rolesList;resultdata.roleForAdmins;let selectedRoles=Compensation.Config.selectedRoles;if(0===selectedRoles.length&&selectedRoles.push("-1"),void 0!=rolesList&&!_.isEmpty(rolesList)){var optHtml='<option value="-1">'+ZPI18N.getString("zp.allroles")+"</option>";for(roleId in rolesList)roleName=rolesList[roleId],optHtml+='<option value="'+roleId+'" '+(Compensation.Config.checkValueIsPresent(selectedRoles,roleId)?"selected":"")+">"+roleName+"</option>"}Layout.Page.container.find("#roleSelector").html(optHtml),Layout.Page.container.find("#roleSelector").select2().val(Compensation.Config.savedCompModApplRoles).trigger("change");Object.entries(rolesList).reduce((acc,[key,value])=>(acc[value]=key,acc),{});Layout.Page.container.find("#roleSelector").on("change",function(event){Layout.Page.container.find("#addSaveCancelbtnsDiv").children().length||(Layout.Page.container.find("#addSaveCancelbtnsDiv").append('<button type="button" class="btn btn-primary">'+ZPI18N.getString("zp.save")+'</button><button type="button" class="btn btn-default">'+ZPI18N.getString("zp.cancel")+"</button>"),Layout.Page.container.find("#addSaveCancelbtnsDiv button:nth-child(1)").on("click",function(event){let currSelRoles=$("#roleSelector").val();Compensation.Utils.compareTwoArrays(currSelRoles,Compensation.Config.savedCompModApplRoles)&&!currSelRoles.includes("-1")?ZPeople.confirm(void 0,ZPI18N.getString("zp.compensation.popup.removerolesfromapplicability"),ZPI18N.getString("zp.compensation.confirm.removerolepermissions"),function(){Compensation.Config.saveCompModApplRoles(currSelRoles,!1)},!1,!0,void 0,void 0,!0):Compensation.Config.savedCompModApplRoles.includes("-1")?ZPeople.confirm(void 0,ZPI18N.getString("zp.compensation.popup.removerolesfromapplicability"),ZPI18N.getString("zp.compensation.confirm.removerolepermissions"),function(){Compensation.Config.saveCompModApplRoles(currSelRoles)},!1,!0,void 0,void 0,!0):Compensation.Config.saveCompModApplRoles(currSelRoles)}),Layout.Page.container.find("#addSaveCancelbtnsDiv button:nth-child(2)").on("click",function(event){Layout.Page.container.find("#roleSelector").val(Compensation.Config.savedCompModApplRoles).trigger("change"),Layout.Page.container.find("#addSaveCancelbtnsDiv").empty()}));var data=$(this).select2("data"),roleIds=data.map(obj=>obj.id);let latestRoleId=roleIds[roleIds.length-1];1===roleIds.length&&"-1"===roleIds[0]||"-1"===_.last(roleIds)?$(this).select2("data",data.filter(obj=>"-1"===obj.id)):roleIds.includes("-1")&&$(this).select2("data",data.filter(obj=>"-1"!==obj.id)),"-1"!==latestRoleId?roleIds=roleIds.filter(value=>"-1"!==value):"-1"===latestRoleId&&(roleIds=["-1"])})}},Compensation.Page={getSubTabs:function(pgMode){let servName=Compensation.CONSTANTS.SERVICENAME,tabObj=ZPNewTabs.getTabObj(pgMode)[servName];return Layout.HashUtil.MAIN?tabObj.subtabs:tabObj.tabArr},isValid:function(hashDtl,pbean,pgMode,pgId,hasteamperm,hasalldataperm){if("operations"==pgMode){if(!pbean.isConsideredDataAdmin)return!1;if(pgId&&!isEmpty(pgId)&&"hike"==pgId&&!pbean.isConsideredDataAdminForAllLocations)return!1}else{if("settings"!=pgMode){if(pgId&&!isEmpty(pgId)&&"revapprvldata"==pgId)return pbean.isTabAllowed;let url=hashDtl.hash.split("/").slice(0,2).join("/");return 0!=ZPTabs.getSubTabs(Compensation.CONSTANTS.SERVICENAME,!0).filter(obj=>obj.tabURL.includes(url)).length}if(!pbean.isConsideredSettingsAdmin)return!1}return!0},validateUrl:function(hashDtl){if(hashDtl.newURL)return{isValid:!0,redirectToURL:hashDtl.newURL};let pbean=Compensation.PermissionBean.getPermBean();if(!pbean.isTabAllowed)return!1;if("false"==ZPeople.isCompModInitialized&&!hashDtl.hash.endsWith("/gettingStarted"))return!!pbean.isConsideredModuleAdmin&&{isValid:!0,redirectToURL:"settings/service/salarydetails/gettingStarted"};let pgMode=hashDtl.pageMode,pgId=hashDtl.id&&hashDtl.id.toLowerCase();const ROLECONST=Compensation.RoleBasedOperations;let hasteamperm=Compensation.PermissionBean.hasAccessPerm(ROLECONST.CP_CATEGORIES.COMPENSATION_DATA,ROLECONST.CP_ACCESS_TYPE.VIEW_PERM,ROLECONST.CP_TYPE_OF_VIEW.REPORTEES_DATA,!0,!1),accessType=pgId?"revdata"==pgId?ROLECONST.CP_CATEGORIES.SAL_REVISION_DATA:ROLECONST.CP_CATEGORIES.COMPENSATION_DATA:null,hasalldataperm=!(!pgId||!accessType)&&Compensation.PermissionBean.hasAccessPerm(accessType,ROLECONST.CP_ACCESS_TYPE.VIEW_PERM,ROLECONST.CP_TYPE_OF_VIEW.ALL_DATA,!1,!1);return Compensation.Page.isValid(hashDtl,pbean,pgMode,pgId,hasteamperm,hasalldataperm)}},Compensation.FormHandler={SPECIAL_FIELDS:{[Compensation.CONSTANTS.SALARY_REVISION_TABLE_NAME]:{Revision_Status:{1:ZPI18N.getString("zp.pending"),3:ZPI18N.getString("zp.processed"),4:ZPI18N.getString("zp.rejected"),5:ZPI18N.getString("zp.cancelled"),7:ZPI18N.getString("zp.failedtoprocess")},PayrollPushStatus:{0:ZPI18N.getString("zp.notpushed"),1:ZPI18N.getString("zp.inprogress"),2:ZPI18N.getString("zp.pushed"),3:ZPI18N.getString("zp.approved"),4:ZPI18N.getString("zp.rejected"),6:ZPI18N.getString("zp.comp.payroll.errinpayroll"),7:ZPI18N.getString("zp.updated"),8:ZPI18N.getString("zp.deleted")}}},isSpecialField:function(tableName,labelName,refTableName,isSearchParam){return labelName.split(".").length>1&&refTableName&&Compensation.FormHandler.SPECIAL_FIELDS[refTableName]&&(tableName=refTableName,labelName=labelName.substring(labelName.split(".")[0].length+1)),!0===isSearchParam&&-1!==labelName.indexOf("_op")&&(labelName=labelName.slice(0,labelName.length-3)),!(!Compensation.FormHandler.SPECIAL_FIELDS[tableName]||!Compensation.FormHandler.SPECIAL_FIELDS[tableName][labelName])},getValueForField:function(labelName,value){var valueJson={value:value,operator:FormConstants.Criteria.OPERATORS.EQUAL};return"Attachment"===labelName&&(valueJson={value:"",operator:value}),valueJson},getRevStatusValMap:function(){let revStatusMapArr=[],revStatusMapObj=Compensation.FormHandler.SPECIAL_FIELDS[Compensation.CONSTANTS.SALARY_REVISION_TABLE_NAME].Revision_Status;for(var key in revStatusMapObj){let tempObj={};tempObj.revStatId=key,tempObj.revStatVal=revStatusMapObj[key],revStatusMapArr.push(tempObj)}return revStatusMapArr}},Compensation.Currencies={DATA:void 0,DEF_FMT_TYPE:-1,getInitData:async function(fetchBasicInfo=!1){if(!this.DATA){let url="onboarding"==settingsUrlProps.currentMode?"/offersetting/currencies":"/compensation/currencies/list";const params={fetchBasicInfo:fetchBasicInfo},[response]=await Compensation.Utils.sendRequestAsPromise(url,params);if(Compensation.Utils.commonErrorHandler(response))return Promise.reject();this.DATA=response}return Promise.resolve(this.DATA)},setHomeCurrency:function(){this.DATA.homeCurr=this.DATA.confCurrList.find(confCurr=>confCurr.is_home_currency)},getCurrencyCodeFromRecordId:function(currId){return this.DATA.confCurrList.find(currObj=>currObj.currencyid===currId).currencycode},addUpdateCurrency:function(currJson,recordId){const url=recordId?`/compensation/currencies/${recordId}/update`:"/compensation/currencies/create";let customUrl="onboarding"==settingsUrlProps.currentMode?"/offersetting/addUpdateCurrency":url;const params={inputData:JSON.stringify(currJson)};return Compensation.Utils.sendRequestAsPromise(customUrl,params)},updateCurrObjInDATA:function(currInfo,isUpdate){if(isUpdate){for(let idx=0;idx<this.DATA.confCurrList.length;idx++)if(currInfo.currencycode===this.DATA.confCurrList[idx].currencycode){this.DATA.confCurrList.splice(idx,1,currInfo);break}}else this.DATA.confCurrList.push(currInfo)},enableDisableCurr:function(currId,isEnabled){let customUrl="onboarding"==settingsUrlProps.currentMode?"/offersetting/enableDisableCurr":`/compensation/currencies/${currId}/enabledisable`;const params={isEnabled:isEnabled};return Compensation.Utils.sendRequestAsPromise(customUrl,params)},updateIsEnabledInDATA:function(currId,isEnabled){this.DATA.confCurrList.find(currObj=>currObj.currencyid===currId).is_enabled=isEnabled},getOptnsHtml:function(skipAddedCodes){let sortedCurrCodes=Object.keys(Compensation.Currencies.DATA.allCurrList).sort();if(skipAddedCodes){const confCurrCodes=Compensation.Currencies.DATA.confCurrList.map(confCurr=>confCurr.currencycode);sortedCurrCodes=sortedCurrCodes.filter(currCode=>!confCurrCodes.includes(currCode))}return sortedCurrCodes.map(currCode=>`<option value='${currCode}'>${Compensation.Currencies.DATA.allCurrList[currCode].currencystring}</option>`).join("")}},Compensation.getEmpParserVal=function(parserObj){let val=parserObj.value,type=parserObj.type;return val="DATE"==type||"DATE_TIME"==type?ToNumber(val):`"${val}"`},Compensation.computeFormula=function(ctc,compObj,breakupDetails,empParsers){let calcAmt=0,executionFormula=compObj.ExecutionFormula,parser=_.isEmpty(compObj.Parser)?[]:compObj.Parser.split(",");if(parser.some(p=>!Object.keys(breakupDetails).includes(p))&&!empParsers)return 0;let bdy=parser.map(x=>{return`let ${x}=${breakupDetails[x]?breakupDetails[x].calcAmt:empParsers[x]?Compensation.getEmpParserVal(empParsers[x]):0};`}).join("")+"return "+executionFormula;return calcAmt=new Function(bdy)()},Compensation.calcBreakup=function(ctc,compConfiguration){var breakupDetails=compConfiguration.codeVsData,decimalPlace=Compensation.Utils.getDecimalPlaces(),oneTimeObj=compConfiguration.oneTimeObj,empParsers=compConfiguration.empParsers,oneTimeEarning=0,totalEarning=0,totBenefits=0,formula_var=[],formula_fxd=[];for(var data in oneTimeObj){var calcAmt=0;if((obj=oneTimeObj[data]).calcTypeId==Compensation.CONSTANTS.CALCTYPE.FLAT)calcAmt=obj.Amount,obj.payFreqId==Compensation.components.PAYFREQ_MONTHLY?calcAmt*=12:obj.payFreqId==Compensation.components.PAYFREQ_QUARTELY?calcAmt*=4:obj.payFreqId==Compensation.components.PAYFREQ_HALFYEARLY&&(calcAmt*=2);else if(obj.calcTypeId==Compensation.CONSTANTS.CALCTYPE.POC)calcAmt=ctc*(obj.Percentage/100);else if(obj.calcTypeId==Compensation.CONSTANTS.CALCTYPE.FORMULA){formula_var.push(obj);continue}calcAmt=Compensation.Utils.getRoundOffValue(calcAmt,decimalPlace),obj.calcAmt=calcAmt,obj.monthly=Compensation.Utils.getRoundOffValue(calcAmt/12,decimalPlace),obj.annually=calcAmt,obj.Part_Of_CTC?oneTimeEarning+=calcAmt:totBenefits+=calcAmt,breakupDetails[obj.Component_Code]=obj}if(formula_var.length>0)for(var data in formula_var){var obj=formula_var[data];calcAmt=Compensation.computeFormula(ctc,obj,breakupDetails);calcAmt=Compensation.Utils.getRoundOffValue(calcAmt,decimalPlace),obj.calcAmt=calcAmt,obj.monthly=Compensation.Utils.getRoundOffValue(calcAmt/12,decimalPlace),obj.annually=calcAmt,obj.Part_Of_CTC?oneTimeEarning+=calcAmt:totBenefits+=calcAmt,breakupDetails[obj.Component_Code]=obj}let fixedCtc=ctc-oneTimeEarning,basic=0;for(var data in breakupDetails.hasOwnProperty("Basic")&&(breakupDetails.Basic.calcTypeId==Compensation.CONSTANTS.CALCTYPE.FLAT?basic=12*breakupDetails.Basic.Amount:breakupDetails.Basic.calcTypeId==Compensation.CONSTANTS.CALCTYPE.FORMULA?(breakupDetails[Compensation.components.FIXED_CTC]={calcAmt:fixedCtc},breakupDetails[Compensation.components.CTC]={calcAmt:_.isEmpty(ctc+"")?0:ctc},basic=Compensation.computeFormula(ctc,breakupDetails.Basic,breakupDetails)):basic=fixedCtc*(breakupDetails.Basic.Percentage/100)),totalEarning=basic=Compensation.Utils.getRoundOffValue(basic,decimalPlace),breakupDetails){if(!("Fixed_Allowance"==(obj=breakupDetails[data]).Component_Code||obj.Part_Of_CTC&&obj.payTypeId==Compensation.components.PAYTYPE_VARIABLE)){calcAmt=0;if(obj.calcTypeId==Compensation.CONSTANTS.CALCTYPE.FLAT)calcAmt=obj.Amount,obj.payFreqId==Compensation.components.PAYFREQ_MONTHLY?calcAmt*=12:obj.payFreqId==Compensation.components.PAYFREQ_QUARTELY?calcAmt*=4:obj.payFreqId==Compensation.components.PAYFREQ_HALFYEARLY&&(calcAmt*=2);else if(obj.calcTypeId==Compensation.CONSTANTS.CALCTYPE.POB)calcAmt=basic*(obj.Percentage/100);else if(obj.calcTypeId==Compensation.CONSTANTS.CALCTYPE.POC)calcAmt=fixedCtc*(obj.Percentage/100);else if(obj.calcTypeId==Compensation.CONSTANTS.CALCTYPE.FORMULA){formula_fxd.push(obj);continue}calcAmt=Compensation.Utils.getRoundOffValue(calcAmt,decimalPlace),obj.Part_Of_CTC?totalEarning+="Basic"==obj.Component_Code?0:calcAmt:totBenefits+=calcAmt,obj.calcAmt=calcAmt,obj.monthly=Compensation.Utils.getRoundOffValue(calcAmt/12,decimalPlace),obj.annually=Compensation.Utils.getRoundOffValue(calcAmt,decimalPlace)}}if(formula_fxd.length>0)for(var data in breakupDetails[Compensation.components.FIXED_CTC]={calcAmt:fixedCtc},breakupDetails[Compensation.components.CTC]={calcAmt:_.isEmpty(ctc+"")?0:ctc},formula_fxd){if(!(obj=formula_fxd[data]).Part_Of_CTC||obj.payTypeId!=Compensation.components.PAYTYPE_VARIABLE){calcAmt=Number(Compensation.computeFormula(ctc,obj,breakupDetails,empParsers));calcAmt=Compensation.Utils.getRoundOffValue(calcAmt,decimalPlace),obj.Part_Of_CTC?totalEarning+="Basic"==obj.Component_Code?0:calcAmt:totBenefits+=calcAmt,obj.calcAmt=calcAmt,obj.monthly=Compensation.Utils.getRoundOffValue(calcAmt/12,decimalPlace),obj.annually=Compensation.Utils.getRoundOffValue(calcAmt,decimalPlace)}}if(compConfiguration.unbalanced=Compensation.Utils.getRoundOffValue(fixedCtc-totalEarning,decimalPlace),breakupDetails.Fixed_Allowance){let fixedAllowance=compConfiguration.unbalanced;(obj=breakupDetails.Fixed_Allowance).calcAmt=Compensation.Utils.getRoundOffValue(fixedAllowance,decimalPlace),obj.monthly=Compensation.Utils.getRoundOffValue(fixedAllowance/12,decimalPlace),obj.annually=Compensation.Utils.getRoundOffValue(fixedAllowance,decimalPlace)}else compConfiguration.unbalanced=Math.abs(compConfiguration.unbalanced)<12?0:compConfiguration.unbalanced;return delete breakupDetails[Compensation.components.FIXED_CTC],delete breakupDetails[Compensation.components.CTC],compConfiguration.fixedAllowance=Compensation.Utils.getRoundOffValue(compConfiguration.unbalanced,decimalPlace),compConfiguration.unbalanced=breakupDetails.Fixed_Allowance?0:Compensation.Utils.getRoundOffValue(compConfiguration.unbalanced,decimalPlace),compConfiguration.basic=basic,compConfiguration.fixedCtc=Compensation.Utils.getRoundOffValue(fixedCtc,decimalPlace),compConfiguration.totalBenefits=Compensation.Utils.getRoundOffValue(totBenefits,decimalPlace),compConfiguration.oneTimeEarning=Compensation.Utils.getRoundOffValue(oneTimeEarning,decimalPlace),compConfiguration.ctc=ctc,compConfiguration},Compensation.RLT={DATA:void 0,CURR_TMPL:{},mergeFields:void 0,STATUS:{ACTIVE:1,DELETED:0,DISABLED:-1},getInitData:async function(){if(!this.DATA){const[response]=await Compensation.Utils.sendRequestAsPromise("/compensation/rltemplates/list",{});if(Compensation.Utils.commonErrorHandler(response))return Promise.reject();this.DATA=response}return Promise.resolve(this.DATA)},canUpdateReq:async function(id){const URL=`/compensation/rltemplates/${id}/canUpdate`,[response]=await Compensation.Utils.sendRequestAsPromise(URL,{});return Compensation.Utils.commonErrorHandler(response)?Promise.reject():Promise.resolve(response)},addUpdateReq:async function(ztid,name){const id=this.CURR_TMPL.id,URL=id?`/compensation/rltemplates/${id}/update`:"/compensation/rltemplates/create",params={data:JSON.stringify({ztid:ztid,name:name})},[response]=await Compensation.Utils.sendRequestAsPromise(URL,params);return Compensation.Utils.commonErrorHandler(response)?Promise.reject():(this.updateTmplObjInDATA(response,!!id),Promise.resolve(response))},duplicateReq:async function(id){const[response]=await Compensation.Utils.sendRequestAsPromise(`/compensation/rltemplates/${id}/duplicate`,{});return Compensation.Utils.commonErrorHandler(response)?Promise.reject():(this.updateTmplObjInDATA(response,!1),Promise.resolve(response))},updateTmplObjInDATA:function(tmplObj,isUpdate){if(isUpdate){for(let idx=0;idx<this.DATA.length;idx++)if(tmplObj.id===this.DATA[idx].id){this.DATA.splice(idx,1,tmplObj);break}}else this.DATA.push(tmplObj)},disableReq:async function(id,isDisable){const[response]=await Compensation.Utils.sendRequestAsPromise(`/compensation/rltemplates/${id}/disable`,{isDisable:isDisable});return Compensation.Utils.commonErrorHandler(response)?Promise.reject():(this.DATA.filter(obj=>obj.id===id)[0].status=isDisable?this.STATUS.DISABLED:this.STATUS.ACTIVE,Promise.resolve())},deleteReq:async function(id){const[response]=await Compensation.Utils.sendRequestAsPromise(`/compensation/rltemplates/${id}/delete`,{});return Compensation.Utils.commonErrorHandler(response)?Promise.reject():(this.DATA=this.DATA.filter(obj=>obj.id!==id),Promise.resolve())},mergeFieldsReq:async function(){if(!this.mergeFields){const[response]=await Compensation.Utils.sendRequestAsPromise("/compensation/rltemplates/mergeFields",{});if(Compensation.Utils.commonErrorHandler(response))return Promise.reject();this.mergeFields=response}return Promise.resolve(this.mergeFields)},exportReq:function(){Compensation.Utils.sendFormReqForExport("/compensation/rltemplates/export",{})},migrateVersionReq:async function(){const[response]=await Compensation.Utils.sendRequestAsPromise("/compensation/rltemplates/migrateVersion",{});return Compensation.Utils.commonErrorHandler(response)?Promise.reject():Promise.resolve(response)}},Compensation.RLTWrapper={initCallback:async function(){await Compensation.Config.getConfiguration(),Compensation.Config.configObj.isCompMMTemplates?Compensation.LetterTemplatesUtil.getClassObj(Compensation.LetterTemplatesUtil.TYPES.REVISION_LETTER).initCallback():Compensation.RLT.initCallback()},callback:async function(){await Compensation.Config.getConfiguration(),Compensation.Config.configObj.isCompMMTemplates?Compensation.LetterTemplatesUtil.getClassObj(Compensation.LetterTemplatesUtil.TYPES.REVISION_LETTER).callback():Compensation.RLT.callback()},hashChangeCallback:async function(){await Compensation.Config.getConfiguration(),Compensation.Config.configObj.isCompMMTemplates&&Compensation.LetterTemplatesUtil.getClassObj(Compensation.LetterTemplatesUtil.TYPES.REVISION_LETTER).hashChangeCallback()},list:async function(){return await Compensation.Config.getConfiguration(),Compensation.Config.configObj.isCompMMTemplates?Compensation.LetterTemplatesUtil.getClassObj(Compensation.LetterTemplatesUtil.TYPES.REVISION_LETTER).list(Compensation.CONSTANTS.SERVICENAME):Compensation.RLT.getInitData()}},Compensation.Utils={...Compensation.Utils,getZCompTokenObj:function(dataArr,ddvaluetxt,ddnametxt,ddtype,placeholder,searchtxt,selvalues,disabledStatus,appendTo){var _tokenObj={allowDuplicateValues:!1,sort:!1,contentType:"text"};_tokenObj.data=dataArr;var mappingObj={};mappingObj.id=ddvaluetxt,mappingObj.value=ddvaluetxt,mappingObj.informativeText=ddnametxt,mappingObj.text=ddnametxt,mappingObj.titleText=ddnametxt,_tokenObj.dataMapping=mappingObj,_tokenObj.dropdownList={},_tokenObj.dropdownList.itemType=ddtype,_tokenObj.placeholder=placeholder;var searchObj={};return searchObj.by=searchtxt,searchObj.highlightKeyword=!0,_tokenObj.search=searchObj,_tokenObj.disabled=disabledStatus,_tokenObj.randomDropdownListId=!0,_tokenObj.values=void 0!=selvalues?selvalues:[],_tokenObj.dropdownList.appendTo=void 0!=appendTo?appendTo:settingsPage.container,_tokenObj},locOrRoleChangeListenerBeforeTokenChange:function(event){let selToken=event.detail.tokenData.id,tokenEleId=event.target.attr("id");"-1"===selToken?ZPeopleComponents.tokenfield(settingsPage.container.find("#"+tokenEleId)).removeAllTokens():ZPeopleComponents.tokenfield(settingsPage.container.find("#"+tokenEleId)).removeTokens(["-1"])},getReqParamsForExport:function(sParams,stParams){let searchParams,orgStructureFilter,employeeStatus=stParams&&void 0!=stParams.employeeStatus?stParams.employeeStatus:"all";sParams&&sParams.length>0&&(searchParams=sParams),stParams&&Object.keys(stParams.orgStructureFilter).length>0&&(orgStructureFilter=JSON.stringify(stParams.orgStructureFilter));let reqParams={ftype:$("#zp_export_container [name=zp_ftype]:checked").val()||"xlsx",typeOfView:"all",employeeStatus:employeeStatus,includeFiles:!1,includeTabular:!1,includeApproval:!1,isSingleSheetExport:!1};return searchParams&&(reqParams.searchBy=JSON.stringify(searchParams)),orgStructureFilter&&(reqParams.orgStructureFilter=orgStructureFilter),reqParams},getNoteForNewExportDiv:function(ele){let html=`<div class="zpl_secn">\n\t\t\t\t\t\t<div class="zpl_info">${ZPI18N.getString("zp.compensation.reports.password.protected.warning")}</div>\n\t\t\t\t\t</div>`;if(!ele)return html;ele.append(html)},refreshCompensationFormsData:function(myview,salaryform,revisionform,refreshHdr){myview&&void 0!=Compensation.selfView&&(Compensation.selfView.refreshData=!0),salaryform&&Compensation.Salary&&(Compensation.Salary.refreshData=!0,refreshHdr&&$("#page-wrapper").find("[id=salaryDetailsList]").remove()),revisionform&&Compensation.Revision&&(Compensation.Revision.refreshData=!0,refreshHdr&&$("#page-wrapper").find("[id=revisionDetailsList]").remove())},showHideNoData:function(obj){var pageContainer=(obj=obj||{}).div?obj.div:settingsPage.container;if("undefined"!=typeof EmptyPages)if(obj.remove){if(0===(div=pageContainer.find("#zp_empty_data")).find("#emptPage").length)return;pageContainer.find("#emptPage").hide()}else{var div;if(0===pageContainer.find("#zp_empty_data").length&&(obj.divId?pageContainer.find("#"+obj.divId).append("<div id='zp_empty_data'></div>"):pageContainer.find(".zpl_rgtcnt").append("<div id='zp_empty_data'></div>")),(div=pageContainer.find("#zp_empty_data")).show(),0==div.find("#emptPage").length||obj.cls){var cls=obj.cls?obj.cls:"zp_nd_nodata";new EmptyPages(cls,obj.msg?obj.msg:ZPI18N.getString("zp.nodatafound"),obj.desc?obj.desc:"",div).show()}else div.find("#emptPage").show()}},removeLoading:function(){Layout.Page.container.find("[id=zp_page_loading]").length&&Layout.Page.container.find("[id=zp_page_loading]").remove()},urlPermissionCheck:function(permType){return!!permType||(settingsPage.container.html("<div class='zpl_rgtcnt'></div>"),Compensation.Utils.showHideNoData({div:settingsPage.container,msg:ZPI18N.getString("zp.adminerrormsg"),cls:"zp_nd_permission"}),!1)},showInlineMsg:function(elem,msg,cls,isErr=!1,level=0){Compensation.Utils.showNewInlineErrTxt(elem,msg,level,isErr,cls)},showNewInlineErrTxt:function(elem,errMsg,errMsgLevel=0,isErr=!0,cls="",appendErrMsgAfter){if(cls=(isErr?"ztextbox--error__label":"ztextbox--info__label").concat(" ",cls),elem.length>0){if(elem.removeClass("ztextbox__error"),isErr)if(0!==elem.length&&"DIV"===elem[0].tagName){elem.find(".ztextbox").addClass("ztextbox__error");let eleId=elem.find("input").attr("id");elem.find("[id^='"+eleId+"']").addClass("ztextbox__error")}else 0!==elem.length&&"SELECT"===elem[0].tagName?elem.siblings("div.zselectbox").addClass("ztextbox__error"):0!==elem.length&&"TEXTAREA"===elem[0].tagName?elem.siblings("div.ztokenfield").addClass("ztextbox__error"):0!==elem.length&&elem[0].className.includes("datepicker-js")?elem.siblings("div.zdatetimefield").addClass("ztextbox__error"):elem.addClass("ztextbox__error");for(;--errMsgLevel>=0;)elem=elem.parent();elem.siblings("span.ztextbox--error__label,span.ztextbox--info__label").remove(),appendErrMsgAfter?appendErrMsgAfter.after(`<span class="${cls}">${errMsg}</span>`):elem.after(`<span class="${cls}">${errMsg}</span>`),elem[0].scrollIntoView({behavior:"smooth",block:"start"})}},validateInputCommon:function(ele,value,errMsgLevel){let isError=!1;return-1===value.indexOf("<")&&-1===value.indexOf(">")||(isError=!0,Compensation.Utils.showNewInlineErrTxt(ele,ZPI18N.getString("zp.charactorremove",["<,>"]),errMsgLevel)),isError},removeNewInlineErrTxt:function(elem){elem.find(".ztextbox__error").removeClass("ztextbox__error"),elem.find(".ztextbox--error__label").remove()},compareTwoArrays:function(clientArray,serverArray){let isExists=!1;return serverArray.forEach(function(item,index){clientArray.includes(item)||(isExists=!0)}),isExists},checkForArraysEquality:function(clientArray,serverArray){let isExists=!0;return serverArray.forEach(function(item,index){clientArray.includes(item)||(isExists=!1)}),isExists},isArraysNotEqual:function(array1,array2){let isEqual=!1;return array1.length!==array2.length||(array1.forEach(function(item,index){array2.includes(item)||(isEqual=!0)}),isEqual)},autoGenCompCode:function(fromObj,toObj,mode){var flag=!1;$(fromObj).on("keyup",function(){if(mode!=Compensation.CONSTANTS.MODE.UPDATE){var text=$(this).val().replace(/[\W]+$/,"");if(text.match(/[^\W\_]+/)&&(text.length<97||!flag)){/^[a-zA-Z_][A-Za-z0-9_]*$/.test(text)||(text=text.replace(/^\d+/,"")),/^[^\W]+$/.test(text)||(text=text.replace(/[\W]+/g,"_"));var len=(text=text.replace(/_+/g,"_")).length;text.length>97&&(len=97,flag=!0),$(toObj).val(text.slice(0,len))}}})},zcomp_token_selAllOrSelOtherOptn:function(event){"-1"==event.detail.tokenData.id?ZPeopleComponents.tokenfield(event.detail.element).removeAllTokens():ZPeopleComponents.tokenfield(event.detail.element).removeTokens("-1")},constructEmpSearchFld:function(fieldId,ftype,searchMode,changeCallback,appendTo,extraParamCB,initialSel,isDisabled){const searchJson={type:1,limit:10,searchType:"emp",inpFormat:ftype,initDefaultValues:!0,initialSelection:initialSel||null,searchMode:searchMode,placeHolder:ZPI18N.getString("zp.selectuser")};appendTo&&(searchJson.pModal=appendTo),changeCallback&&(searchJson.changeCallback=changeCallback),searchJson.ele=settingsPage.container.find("#"+fieldId),extraParamCB&&(searchJson.extraParamCallback=extraParamCB),searchJson.disabled=isDisabled;let resetJson={...searchJson};resetJson.id=fieldId,ModuleComp.Search.reset(resetJson,!0),ModuleComp.Search.create(searchJson)},constructLookupSearchFld:function(id,container,fieldObj,initOptions=[]){let url=ZP5Form.URL,dataMappingObj={},operType=FormConstants.Criteria.OPERATORS.CONTAINS;dataMappingObj={value:"id",text:"value",id:"id"},ZPeopleComponents.isComponent($(container).find("#"+id))&&ZPeopleComponents.tokenfield($(container).find("#"+id)).destroy();let tok=ZPeopleComponents.tokenfield($(container).find("#"+id),{dataSource:{search:queryParams=>new Promise((search,reject)=>{let respObj={},params={},fieldProps=fieldObj.fcObjCallback(fieldObj.colName),fcid=fieldProps.formComponentId,formId=fieldProps.formId,term=queryParams.query,page=queryParams.pages,results=[],key=fcid;if(void 0==ZP5Views.FILTER_OPTIONS[key]&&(ZP5Views.FILTER_OPTIONS[key]={}),ZP5Views.FILTER_OPTIONS[key][term]&&ZP5Views.FILTER_OPTIONS[key][term].length>0&&ZP5Views.FILTER_OPTIONS[key][term].length>200*(page-1)){for(i=200*(page-1);i<200*page&&i<ZP5Views.FILTER_OPTIONS[key][term].length;i++)-1==$.inArray(ZP5Views.FILTER_OPTIONS[key][term][i],results)&&results.push(ZP5Views.FILTER_OPTIONS[key][term][i]);respObj={results:results,more:results.length>=200},search(respObj)}else if(ZP5Views.FILTER_OPTIONS[key][term]&&0==ZP5Views.FILTER_OPTIONS[key][term].length)search(respObj={results:results,more:!1});else{params.mode="fetchFormLookupOtions",params.searchtxt=queryParams.query,params.startInd=200*(queryParams.pages-1)+1,params.conreqcsr=csrfToken;let fields=[fcid];params.luFcIds=JSON.stringify(fields),params.formId=formId,params.isPermBasedListNotNeeded=!0,params.isfilternotneeded=!0,params.isRelatedLookup=!1,void 0!=fieldProps&&void 0!=fieldProps.refTableName&&void 0!=fieldProps.isRelatedCol&&fieldProps.isRelatedCol&&(params.formId=fieldProps.refFormId,params.isRelatedLookup=!0,params.parentField=fieldProps.parentField),ZPeople.Request.send(url,params,data=>{if(void 0==ZP5Views.FILTER_OPTIONS[key][term]&&(ZP5Views.FILTER_OPTIONS[key][term]=[]),void 0==ZP5Views.ALL_OPTIONS[fcid]&&(ZP5Views.ALL_OPTIONS[fcid]={}),"7000"==data.code)for(let optionsIndex=0;optionsIndex<data.message[fcid].length;optionsIndex++){let currOption=data.message[fcid][optionsIndex];currOption.value=ZPeople.checkHTML(currOption.Value)?currOption.Value:ZPeople.decodeTxt(currOption.Value),currOption.id=currOption.Id,ZP5Views.FILTER_OPTIONS[key][term].push(currOption),ZP5Views.ALL_OPTIONS[fcid][""+currOption.Id]=currOption.value,results.push(currOption)}else ZP5Views.FILTER_OPTIONS[key][term]=[];respObj={results:results,more:results.length>=200},search(respObj)})}}),paginated:!0},dataMapping:dataMappingObj,search:{by:dataMappingObj.text,showNoResultsMessage:!0,highlightKeyword:!0},sort:!1,acceptNewValues:operType==FormConstants.Criteria.OPERATORS.CONTAINS,serverSearch:!0,cacheData:!1,values:initOptions,randomDropdownListId:!0,dropdownList:{fitForElement:!0},viewPerPage:200,messages:{noResults:operType==FormConstants.Criteria.OPERATORS.CONTAINS?"#query#":ZPI18N.getString("zp.noresults")},placeholder:ZPI18N.getString("zp.all"),appendTo:container});operType==FormConstants.Criteria.OPERATORS.CONTAINS&&tok._menu.children()[1].addEventListener("click",e=>{tok._enterKeyHandler(e)})},checkAndAddContextPath:function(url){return contextPath&&"undefined"!==contextPath&&"null"!==contextPath&&!url.startsWith(`/${contextPath}/`)&&(url=`/${contextPath}${url}`),url},sendFormReqForExport:function(url,reqParams){url=this.checkAndAddContextPath(url);let queryParamStr="";for(const[key,value]of Object.entries(reqParams))queryParamStr+=`${""!==queryParamStr?"&":""}${key}=${encodeURIComponent(value)}`;const form=document.createElement("form");form.method="POST",form.target="exportresp",form.action=queryParamStr?`${url}?${queryParamStr}`:url;const hiddenField=document.createElement("input");hiddenField.type="hidden",hiddenField.name=csrfParamName,hiddenField.value=csrfToken,form.appendChild(hiddenField),document.body.appendChild(form),form.submit(),document.body.removeChild(form)},getIntVal:function(value){return value=parseInt(value),Number.isNaN(value)?0:value},getRoundedVal:function(value,decimalPlaces=2){return value=Number(Math.round(value+"e"+decimalPlaces)+"e-"+decimalPlaces),(value=Number.isNaN(value)?Number(0):value).toFixed(decimalPlaces)},getDecimalPlaces:function(){return Compensation.Config.getConfiguration_asSync(!1),Compensation.Config.configObj.decimalPlace},isDecimalSupported:function(){return Compensation.Config.getConfiguration_asSync(!1),Compensation.Config.configObj.isDecimalSupported},getRoundOffValue:function(val,decimalPlace=0){return val=Number.isNaN(val)?Number(0):val,Math.round(val*Math.pow(10,decimalPlace))/Math.pow(10,decimalPlace)},getPayFreqShortForm:function(payFreqId){switch(payFreqId){case Compensation.components.PAYFREQ_MONTHLY:return"M";case Compensation.components.PAYFREQ_QUARTELY:return"Q";case Compensation.components.PAYFREQ_HALFYEARLY:return"H";case Compensation.components.PAYFREQ_ANNUALLY:return"Y"}},getValOrDefaultVal:function(val,defVal){return val||defVal},getNoteForExportDiv:function(parentCls){return`<div class="zpadd-role ${parentCls||""}">\n\t\t<div class="ZPednote">\n\t\t${ZPI18N.getString("zp.compensation.reports.password.protected.warning")}\n\t\t</div>\n\t\t</div>`},getEntityDisplayName:function(entity,isAll){let dispName,osDispNames=ZPeople.orgStructureDispNameMap||{};switch(entity){case Compensation.CONSTANTS.ENTITIES.LOCATION:return ZPI18N.getString(isAll?"zp.alllocaction":`zp.${entity.toLowerCase()}`);case Compensation.CONSTANTS.ENTITIES.EMPLOYEETYPE:return ZPI18N.getString(isAll?"zp.allEmpTypes":"zp.employeeType");case Compensation.CONSTANTS.ENTITIES.EXPERIENCE:return ZPI18N.getString("zp.experience");case Compensation.CONSTANTS.ENTITIES.DEPARTMENT:case Compensation.CONSTANTS.ENTITIES.DESIGNATION:return ZPI18N.getString(isAll?`zp.all${entity.toLowerCase()}`:`zp.${entity.toLowerCase()}`);case Compensation.CONSTANTS.ENTITIES.STREAM:return ZPI18N.getString(isAll?`zp.all${entity.toLowerCase()}`:"zp.streams");case Compensation.CONSTANTS.ENTITIES.LEVEL:return ZPI18N.getString(isAll?`zp.all${entity.toLowerCase()}`:`zp.${entity.toLowerCase()}`);case Compensation.CONSTANTS.ENTITIES.SALARYRANGE:return ZPI18N.getString("zp.compensation.salaryRange");case Compensation.CONSTANTS.ENTITIES.LEGALENTITY:dispName=osDispNames.entity?osDispNames.entity:ZPI18N.getString("zp.employeeentity");break;case Compensation.CONSTANTS.ENTITIES.BUSINESSUNIT:dispName=osDispNames.unit?osDispNames.unit:ZPI18N.getString("zp.employeeunit");break;case Compensation.CONSTANTS.ENTITIES.DIVISION:dispName=osDispNames.division?osDispNames.division:ZPI18N.getString("zp.employeedivision")}return isAll?ZPI18N.getString("zp.AllOrgStructureElements",[dispName]):dispName},validateAndGetFilterValues:function(filterId){var filterDiv=Layout.Page.container.find("#"+filterId),filterResult=[];return 0!=filterDiv.length&&filterDiv.find("select, input[isOSField='true']").each(function(){let filterObj={};if(-1!=$(this).val()&&$(this).val().length>0){let selectedVals,fieldId=$(this).attr("id").split("zpcmpFltr_")[1],selectedTextArray=[];if(filterObj.fieldType=$(this).attr("fieldtype"),filterObj.id=fieldId,$.isArray($(this).val())?$.isArray($(this).val())&&(selectedVals=$(this).val(),selectedTextArray=$(this).select2("data").map(x=>x.text)):(selectedVals=$(this).val().split(","),Compensation.Utils.getEntityDivIds(Compensation.Templates.getOsAppForEntities()).includes($(this).attr("id"))?selectedTextArray=$(this).select2("data").map(x=>x.text):selectedTextArray.push($(this).find(":selected").text())),filterObj.selectedVals=selectedVals,filterObj.selectedTexts=selectedTextArray,filterObj.fieldType==Compensation.CONSTANTS.TEXT_FIELD||filterObj.fieldType==Compensation.CONSTANTS.NUMERICAL_FIELD){let searchVal=filterDiv.find("#"+fieldId+"_"+filterId+"_search").val();if(filterObj.fieldType==Compensation.CONSTANTS.NUMERICAL_FIELD&&""!==searchVal){if(!/^[+-]?\d+(\.\d+)?([eE][+-]?\d+)?$/.test(searchVal))return filterDiv.find("#"+fieldId+"_"+filterId+"_error").removeClass("DNI"),void filterDiv.find("#"+fieldId+"_"+filterId+"_error").text(ZPI18N.getString("zp.entervalidinput"))}if(void 0==searchVal||""==searchVal)return filterDiv.find("#"+fieldId+"_"+filterId+"_error").removeClass("DNI"),void filterDiv.find("#"+fieldId+"_"+filterId+"_error").text(ZPI18N.getString("zp.searchvaluescannotbeempty"));filterDiv.find("#"+fieldId+"_"+filterId+"_error").addClass("DNI"),filterObj.searchVal=searchVal}filterResult.push(filterObj)}}),filterResult},resetFilter:function(filterId){var filterDiv=Layout.Page.container.find("#"+filterId);filterDiv.find("select, input[isOSField='true']").each(function(){$(this).removeAttr("disabled"),$(this).select2("val","-1")}),filterDiv.find('input[id*="'+filterId+'_search"]').parent().addClass("DNI"),filterDiv.find('div[id*="'+filterId+'_error"]').addClass("DNI")},updateOsDropdownsInSalPkgsFilter:function(filterId,obj){let entity=obj.attr("name"),vals=obj.val().split(",");var filterDiv=Layout.Page.container.find("#"+filterId);let childEntity=CustomSelect.Orgstruct.Child[entity];for(;childEntity;){let childElem=filterDiv.find(`[name=${childEntity}]`);childElem&&(childElem.select2("val","-1"),childElem.prop("disabled",vals.length>1)),childEntity=CustomSelect.Orgstruct.Child[childEntity]}},registerFilterEvents:function(filterId,searchCallback){var filterDiv=Layout.Page.container.find("#"+filterId);filterDiv.find("select").on("change",function(){if($(this).attr("fieldType")==Compensation.CONSTANTS.TEXT_FIELD||$(this).attr("fieldType")==Compensation.CONSTANTS.NUMERICAL_FIELD){let fieldId=$(this).attr("id").split("zpcmpFltr_")[1];-1!=$(this).val()?(filterDiv.find("#"+fieldId+"_"+filterId+"_search").val(""),filterDiv.find("#"+fieldId+"_"+filterId+"_search").parent().removeClass("DNI")):(filterDiv.find("#"+fieldId+"_"+filterId+"_search").parent().addClass("DNI"),filterDiv.find("#"+fieldId+"_"+filterId+"_error").addClass("DNI"))}}),filterDiv.find(this.getEntityDivIds(Compensation.Templates.getOsAppForEntities())).on("change",function(event){let obj=$(this),id=`#${this.id}`,values=obj.val().split(",");"-1"===values[values.length-1]?obj.select2("val",["-1"]):values.includes("-1")&&obj.select2("val",values.filter(value=>"-1"!==value));let entity=Object.keys(Compensation.SalPkgFilter.ENTITY_VS_DIV_ID).find(key=>Compensation.SalPkgFilter.ENTITY_VS_DIV_ID[key]===id);this.visibleOsEntities().includes(entity)&&Compensation.Utils.updateOsDropdownsInSalPkgsFilter(filterId,obj)}),filterDiv.find("#"+filterId+"_resetFilter").on("click",function(){Compensation.Utils.resetFilter(filterId)}),filterDiv.find("#"+filterId+"_close").on("click",function(){Layout.Page.container.find(".IC-filter").removeClass("blu ZPFilsel"),Layout.Page.container.find(".IC-filter").addClass("gry"),filterDiv.removeClass("TEbnd")}),filterDiv.find("#"+filterId+"_applyFilter").on("click",function(){Layout.Page.container.find(".IC-filter").removeClass("blu ZPFilsel"),Layout.Page.container.find(".IC-filter").addClass("gry");let filterResult=Compensation.Utils.validateAndGetFilterValues(filterId);0==filterDiv.find('div[id*="'+filterId+'_error"]:visible').length&&(filterResult=0!=filterResult.length?filterResult:[],searchCallback(filterResult))})},filterIconClassToggling:function(obj){Layout.Page.container.find(obj).hasClass("gry")?(Layout.Page.container.find(obj).removeClass("gry"),Layout.Page.container.find(obj).addClass("blu ZPFilsel")):Layout.Page.container.find(obj).hasClass("blu ZPFilsel")&&(Layout.Page.container.find(obj).removeClass("blu ZPFilsel"),Layout.Page.container.find(obj).addClass("gry"))},showAndHideModuleFilter:function(filterId){var filterDiv=Layout.Page.container.find("#"+filterId);filterDiv.hasClass("TEbnd")?filterDiv.removeClass("TEbnd"):filterDiv.addClass("TEbnd")},getModuleFilterDiv:function(ele,filterId,fieldJson,searchCallback){var filterHtml="";if(void 0!=fieldJson&&(filterHtml='<div class="ZPFilMain" id="'+filterId+'">\n\t\t\t<div class="well ZPFil" style="top:125px; height: calc(100% - 175px) !important; overflow-x:hidden">\n\t\t\t<i class="IC-cls-1px S14 red CP" id="'+filterId+'_close"></i>',fieldJson.forEach(function(fieldObj){if(fieldObj.hasOwnProperty("orgstruct")){let orgstructHierarchyArray=Compensation.Templates.getOsAppForEntities();if(isOrgStructureEnabled&&orgstructHierarchyArray.length>0){filterHtml+='<div class="org-grp-filter" name="orgfilter">',fieldObj.orgstruct.forEach(function(osFieldObj){let dispName=osFieldObj.dispName,fieldType=osFieldObj.fieldType,fieldId=osFieldObj.id;orgstructHierarchyArray.includes(fieldId)&&(filterHtml+='<div class="col-md-2" style="position:static; border: 0" name="filterFields">\n\t\t\t\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t\t\t\t<label>'+dispName+'</label>\n\t\t\t\t\t\t\t\t<input id="zpcmpFltr_'+fieldId+'" name="'+osFieldObj.name+'" fieldType="'+fieldType+`" data-placeholder="${ZPI18N.getString("zp.all")}" isOSField="true" >\n\t\t\t\t\t\t\t\t</div></div>`)}),filterHtml+="</div>"}}else{let dispName=fieldObj.dispName,fieldType=fieldObj.fieldType,fieldId=fieldObj.id;if(filterHtml+='<div class="col-md-2" name="filterFields">\n\t\t\t\t\t<div class="form-group">\n\t\t\t\t\t<label>'+dispName+"</label>",fieldType==Compensation.CONSTANTS.TEXT_FIELD||fieldType==Compensation.CONSTANTS.PICKLIST_FIELD||fieldType==Compensation.CONSTANTS.MULTISELECT_PICKLIST_FIELD||fieldType==Compensation.CONSTANTS.SPECIAL_FIELDS||fieldType==Compensation.CONSTANTS.NUMERICAL_FIELD){if(fieldType==Compensation.CONSTANTS.TEXT_FIELD){filterHtml+='<select id="zpcmpFltr_'+fieldId+'" fieldType="'+fieldType+`"><option value="-1">${ZPI18N.getString("zp.all",[""]).trim()}</option>`,fieldObj.options.forEach(function(opts){filterHtml+='<option value="'+opts.id+'">'+opts.val+"</option>"})}else if(fieldType==Compensation.CONSTANTS.NUMERICAL_FIELD||fieldType==Compensation.CONSTANTS.SPECIAL_FIELDS||fieldType==Compensation.CONSTANTS.PICKLIST_FIELD){filterHtml+='<select id="zpcmpFltr_'+fieldId+'" fieldType="'+fieldType+`"><option value="-1">${ZPI18N.getString("zp.all",[""]).trim()}</option>`,fieldObj.options.forEach(function(opts){filterHtml+='<option value="'+opts.id+'">'+opts.val+"</option>"})}else if(fieldType==Compensation.CONSTANTS.MULTISELECT_PICKLIST_FIELD){filterHtml+='<input id="zpcmpFltr_'+fieldId+'" fieldType="'+fieldType+`" multiple data-placeholder="${ZPI18N.getString("zp.all")}" >`,fieldObj.options.forEach(function(opts){filterHtml+='<option value="'+opts.id+'">'+opts.val+"</option>"})}filterHtml+="</input>"}else fieldType==Compensation.CONSTANTS.LOOKUP_FIELD&&(filterHtml+='<input id="zpcmpFltr_'+fieldId+`" placeholder="${ZPI18N.getString("zp.all")}" class="select2-offscreen" tabindex="-1"/>`);filterHtml+="</div>\n\t\t\t\t\t</div>",fieldType!=Compensation.CONSTANTS.TEXT_FIELD&&fieldType!=Compensation.CONSTANTS.NUMERICAL_FIELD||(filterHtml+='<div class="col-md-2 MB20 DNI"><input type="text" class="form-control" id="'+fieldId+"_"+filterId+'_search"><div id="'+fieldId+"_"+filterId+'_error" class="red MT5 S12 DNI"></div></div>')}}),filterHtml+='<div class="col-md-2">\n\t\t\t<button type="button" class="btn btn-primary btn-md MT20 MR10" id="'+filterId+'_applyFilter">'+ZPI18N.getString("zp.search")+"</button> ",filterHtml+='<button class="btn btn-default btn-md MT20" type="button" id="'+filterId+'_resetFilter">'+ZPI18N.getString("zp.reset")+"</button> ",filterHtml+="</div>\n\t\t\t</div>\n\t\t\t</div>"),null!=filterHtml){if(Layout.Page.container.find(ele).html(filterHtml),Layout.Page.container.find(ele).find("select").select2(),isOrgStructureEnabled&&Compensation.Templates.getOsAppForEntities().length>0){Layout.Page.container.find("#"+filterId).find(Compensation.Utils.getEntityDivIds(Compensation.Templates.getOsAppForEntities())).select2(CustomSelect.Orgstruct.getSelect2Properties({multiple:!0,defSelect:"-1",defSelectText:ZPI18N.getString("zp.all")}));for(let key in Compensation.SalPkgFilter.ENTITY_VS_DIV_ID)Layout.Page.container.find("#"+filterId).find(Compensation.SalPkgFilter.ENTITY_VS_DIV_ID[key]).select2("val","-1")}Compensation.Utils.registerFilterEvents(filterId,searchCallback)}},getEntityDivIds:function(entities){return entities.map(entity=>Compensation.SalPkgFilter.ENTITY_VS_DIV_ID[entity]).join(", ")},showInlineErrTxt:function(parentDiv,errMsg){parentDiv.append(`<em class="etxt">${errMsg}</em>`),parentDiv[0].scrollIntoView({behavior:"smooth",block:"start"})},removeInlineErrTxt:function(parentDiv){parentDiv.find("em.etxt").remove()},locationSelInDropDown:function(id){Layout.Page.container.find(id).on("change",function(event){var data=$(this).select2("data"),locIds=data.map(obj=>obj.id);let latestLocId=locIds[locIds.length-1];1===locIds.length&&"-1"===locIds[0]||"-1"===_.last(locIds)?$(this).select2("data",data.filter(obj=>"-1"===obj.id)):locIds.includes("-1")&&$(this).select2("data",data.filter(obj=>"-1"!==obj.id)),"-1"!==latestLocId?locIds=locIds.filter(value=>"-1"!==value):"-1"===latestLocId&&(locIds=["-1"])})},getComponentPicklistOptions:function(optObj,idLabel,valueLabel,valKeyName,defOptId,incAllOpt=!1){let opts=[],optIds=[];if(valKeyName=void 0!=valKeyName?valKeyName:"val",incAllOpt){let keyVal={id:"-1"};keyVal[valKeyName]=ZPI18N.getString("zp.all"),opts.push(keyVal)}for(let key in optObj){let optId=optObj[key][idLabel],optVal=optObj[key][valueLabel];if(-1==optIds.indexOf(optId)){let keyVal={};keyVal.id=optId,keyVal[valKeyName]=optVal,defOptId&&(keyVal.isDef=defOptId==optId),opts.push(keyVal)}optIds.push(optId)}return opts},getOrgStructFilterFieldsJson:function(){let orgstructFieldsJson=[],fieldObj={id:"LEGALENTITY",dispName:Compensation.Utils.getEntityDisplayName(Compensation.CONSTANTS.ENTITIES.LEGALENTITY),fieldType:Compensation.CONSTANTS.MULTISELECT_PICKLIST_FIELD,isOSField:!0,name:"entity"};return orgstructFieldsJson.push(fieldObj),fieldObj={id:"BUSINESSUNIT",dispName:Compensation.Utils.getEntityDisplayName(Compensation.CONSTANTS.ENTITIES.BUSINESSUNIT),fieldType:Compensation.CONSTANTS.MULTISELECT_PICKLIST_FIELD,isOSField:!0,name:"unit"},orgstructFieldsJson.push(fieldObj),fieldObj={id:"DIVISION",dispName:Compensation.Utils.getEntityDisplayName(Compensation.CONSTANTS.ENTITIES.DIVISION),fieldType:Compensation.CONSTANTS.MULTISELECT_PICKLIST_FIELD,isOSField:!0,name:"division"},orgstructFieldsJson.push(fieldObj),orgstructFieldsJson},decode:function(encodedStr){return $("<div>").html(encodedStr).text()},formatCurrValue:function(value,formatType){var locale=void 0;switch(parseInt(formatType)){case 1:locale="en-IN";break;case 2:locale="en-US";break;case 3:locale="de-DE";break;case 4:locale="pl-PL";break;case-1:default:locale=void 0}return locale?new Intl.NumberFormat(locale,{maximumFractionDigits:0}).format(value):value},showAlertMsg:function(alertType,title,desc,okTxt,cancelTxt,okCb,cancelCb){let disPopUp=void 0;switch(alertType){case 1:disPopUp=new SuccessAlertMessage(title,desc);break;case 2:disPopUp=new DeleteAlertMessage(title,desc);break;case 3:disPopUp=new InfoAlertMessage(title,desc)}disPopUp.yesButtonText=okTxt||disPopUp.yesButtonText,disPopUp.cancelButtonText=cancelTxt||disPopUp.cancelButtonText,disPopUp.callback=okCb,disPopUp.cancelCallback=cancelCb,disPopUp.show()},showDoubleDeleteAlert:function(title,description,props){return this.showDeleteAlertMessage(new DeleteAlertMessage(title,description),props,"doubledelete")},showDeleteAlertMessage:function(alertModal,props,mode){return void 0!=(props=FrameworkCommon.getAlertProps(props,mode)).callback&&""!=props.callback&&"function"==typeof props.callback&&alertModal.setCallback(props.callback),void 0!=props.isBtnNotNeeded&&""!=props.isBtnNotNeeded&&(alertModal.needButton=!props.isBtnNotNeeded),void 0!=props.doneBtn&&""!=props.doneBtn&&(alertModal.yesButtonText=props.doneBtn),void 0!=props.isCancelNeeded&&""!=props.isCancelNeeded&&props.isCancelNeeded?void 0!=props.cancelBtn&&""!=props.cancelBtn&&(alertModal.cancelButtonText=props.cancelBtn):alertModal.cancelButtonText="",props&&props.hasOwnProperty("details")&&props.details&&(alertModal.details=props.details),props&&props.hasOwnProperty("centerHtml")&&props.centerHtml&&alertModal.setCenterHtml(props.centerHtml),props&&props.handleESC&&(alertModal.handleESC=props.handleESC),"doubledelete"==mode&&alertModal.setIsDoubleCnf(!0,props.doubleCnfAck),alertModal.show(),void 0!=props.cancelCallback&&""!=props.cancelCallback&&"function"==typeof props.cancelCallback&&alertModal.alertDiv.find("#cnlBtn,#alrtCls").off("click").on("click",function(){alertModal.remove(),props.cancelCallback()}),alertModal},showSingleRecord:function(recordId){let niceUrl=settingsUrlProps.niceUrl,url=settingsUrlProps.url;settingsUrlProps.urlParams;if(-1!=url.indexOf("/salary/viewrevision"))url=url.replace("recordId:"+settingsUrlProps.urlParamsArr.recordId,"recordId:"+recordId),window.location.href="#"+url;else{if(niceUrl.includes("/salary/")||niceUrl.endsWith("/salary")||niceUrl.includes("/employeesalary/"))return recordId=ZP5Views.getRecordDetails(recordId).ownerID[0],Compensation.Salary.Operations.showSingleRecordView(recordId,!1);(niceUrl.includes("/revision/")||niceUrl.endsWith("/revision")||niceUrl.includes("/salaryrevision"))&&Compensation.SalRevision.Operations.showSalRevSingleRecView(recordId)}},getZCompMethods:function(){$.fn.extend({destroyEle:function(){ZPeopleComponents.isComponent(this)&&ZPeopleComponents[jQuery($(this)).data("componentName").replace("z","")]($(this)).destroy()},getZValue:function(){let val="";if(ZPeopleComponents.isComponent(this)){let fType=jQuery($(this)).data("componentName").replace("z",""),key="tokenfield"==fType?ZPeopleComponents[fType]($(this))._dataMapping.id:"id";val="tokenfield"==fType?ZPeopleComponents[fType]($(this)).getAllValues().map(selObj=>selObj[key]):ZPeopleComponents[fType]($(this)).getValue(),_.isEmpty(val)||"datefield"==fType&&(val=val.dateString)}else val=$(this).val();return val||(val=""),val},getZTxt:function(){let txt="";if(ZPeopleComponents.isComponent(this)){"select"==jQuery($(this)).data("componentName").replace("z","")&&(txt=$(this).find(":selected")[0].optData.label)}else txt=$(this).text();return txt||(txt=""),txt}})},getZTokenSelVals:elem=>ZPeopleComponents.tokenfield(elem).getAllValues().map(selObj=>selObj.id),getIdAndNameKeysForEntityData:function(entity){switch(entity){case Compensation.CONSTANTS.ENTITIES.LOCATION:return["location_id","location_name"];case Compensation.CONSTANTS.ENTITIES.DESIGNATION:case Compensation.CONSTANTS.ENTITIES.EXPERIENCE:case Compensation.CONSTANTS.ENTITIES.STREAM:case Compensation.CONSTANTS.ENTITIES.LEVEL:case Compensation.CONSTANTS.ENTITIES.SALARYRANGE:case Compensation.CONSTANTS.ENTITIES.EMPLOYEETYPE:return["id","name"];case Compensation.CONSTANTS.ENTITIES.LEGALENTITY:return["EntityID","Name"];case Compensation.CONSTANTS.ENTITIES.BUSINESSUNIT:return["UnitID","Name"];case Compensation.CONSTANTS.ENTITIES.DIVISION:return["DivisionID","Name"]}},visibleOsEntities:function(){let result=[];for(const{lablename:lablename}of Compensation.Config.configObj.visOsEntities)switch(lablename){case"Entity":result.push(Compensation.CONSTANTS.ENTITIES.LEGALENTITY);break;case"Business_unit":result.push(Compensation.CONSTANTS.ENTITIES.BUSINESSUNIT);break;case"Division":result.push(Compensation.CONSTANTS.ENTITIES.DIVISION)}return result},getEntityIconClass:function(entity){switch(entity){case Compensation.CONSTANTS.ENTITIES.LOCATION:return"PI_location";case Compensation.CONSTANTS.ENTITIES.DESIGNATION:return"PI_designation";case Compensation.CONSTANTS.ENTITIES.EXPERIENCE:return"PI_Exp";case Compensation.CONSTANTS.ENTITIES.STREAM:case Compensation.CONSTANTS.ENTITIES.LEVEL:return"PI_Stream";case Compensation.CONSTANTS.ENTITIES.EMPLOYEETYPE:return"PI_user";case Compensation.CONSTANTS.ENTITIES.LEGALENTITY:return"PI_compname icn cl5";case Compensation.CONSTANTS.ENTITIES.BUSINESSUNIT:return"PI_bnsunit icn cl4";case Compensation.CONSTANTS.ENTITIES.DIVISION:return"PI_division icn cl6"}},reAuthIntermeddiatePage(redirectToUrl){var reauth=`<div class="zpl_crdcnt">\n        <div class="zpl_secn wd80_per MLauto MRauto text-center">\n          <div class="zpl_identityimg">                \n          </div>\n          <h3>${ZPI18N.getString("zp.compensation.reAuthIntermediateHead")}</h3>\n          <p>${ZPI18N.getString("zp.compensation.reAuthIntermediateDesc")}</p>\n          <p>\n            <button type="button" id="verifyBtn" class="zlabel zlabel--blue zlabel--medium">${ZPI18N.getString("zp.compensation.reAuthIntermediateButton")}</button> `+" </p>\n        </div>\n      </div>";const tab=new Tab("reAuthModal",modal=>modal.cardElem().html(reauth)),modal=new popupModal("",tab);settingsPage.container.find(".zpl_btnmnu").addClass("DNI"),settingsPage.container.find(".zpl_crd").addClass("DNI"),modal.construct(),settingsPage.container.find(".zpl_mfoter").remove(),settingsPage.container.find(".zpl_mhder").remove(),modal.tabElem().removeClass("zpl_mcenter zpl_mopen"),modal.cardElem().removeClass("zpl_fm"),modal.tabElem().addClass("zpl_malrtmsg zpl_mopen"),settingsPage.container.find("#zp_page_loading").remove(),settingsPage.container.find("#tabreAuthModal").removeClass("DNI"),modal.tabElem().attr("data-modal-box","comp_identity"),modal.handleESC=!1;let counter=1;settingsPage.container.find("#verifyBtn").on("click",()=>{Layout.isZohoOne?1==counter?(window.open(redirectToUrl,"_blank"),counter++):window.location.reload():window.open(redirectToUrl,"_top")})},setSortMenu:function(menuObj,options,event){menuObj.type||(menuObj.type="list"),$("div#"+menuObj.id).remove();let menuListHtml='<div id="'+menuObj.id+'" data-type="'+menuObj.type+'" data-display-type="'+menuObj.displayType+'" data-content-type="'+menuObj.contentType+'" '+(void 0!=menuObj.fcid?'fcid="'+menuObj.fcid+'"':"")+"><ul>";for(let optionsIndex=0;optionsIndex<options.length;optionsIndex++){let currOption=options[optionsIndex];menuListHtml=menuListHtml+'<li id="'+currOption.id+'" ',void 0!=currOption.type&&(menuListHtml=menuListHtml+'data-item-type="'+currOption.type+'"'),void 0!=currOption.iconClass&&(menuListHtml+=' data-icon-class="'+currOption.iconClass+'" '),void 0!=currOption.checked&&currOption.checked&&(menuListHtml+="checked"),menuListHtml=menuListHtml+">"+currOption.text+"</li>"}menuListHtml+="</ul>",$("body").append(menuListHtml)},refreshCompPage:function(pgList,userId){if(pgList.includes("myview")&&(Compensation.selfView.refreshData=!0),pgList.includes("salary")){let viewObj=Compensation.Salary.Operations.viewObj;for(viewType in viewObj){let subViewProp=viewObj[viewType].viewProp;for(viewId in subViewProp){subViewProp[viewId].refreshData=!0}}ZPeople.Team&&ZPeople.Team.initObj[Compensation.CONSTANTS.SERVICENAME]&&(ZPeople.Team.initObj[Compensation.CONSTANTS.SERVICENAME]=!1)}if(pgList.includes("revision")){let viewObj=Compensation.SalRevision.Operations.viewObj;for(viewType in viewObj){viewObj[viewType].refreshData=!0}}selfSalary.destroy(userId)},refreshPageForAction:function(actiontype,userId){let refreshList=["myView","salary","revision"];switch(actiontype){case Compensation.CONSTANTS.ACTIONTYPE.SALARY:case Compensation.CONSTANTS.ACTIONTYPE.REVISION:userId&&userId!=erecno&&refreshList.splice(refreshList.indexOf("myView"),1),actiontype==Compensation.CONSTANTS.ACTIONTYPE.REVISION&&refreshList.splice(refreshList.indexOf("revision"),1)}Compensation.Utils.refreshCompPage(refreshList,userId)},getFormDetails:function(formType){if(this.formDetails)return this.formDetails;let params={conreqcsr:csrfToken,formType:formType};return ZPeople.Request.sendAsyncPost("/compensation/getFormDetails",params,resp=>{this.formDetails=resp}),this.formDetails},getEmpFormId:function(){return ZPeople.EMP_FORMID},updateEmpRec:function(recordId,isTeamPage){let params={formId:Compensation.Utils.getEmpFormId(),recordId:recordId,formMode:"EDIT",disableUrlTrack:!0,modalCloseCallback:()=>{isTeamPage?(selfSalary.destroy(recordId),selfSalary.updateUsrProf(),Compensation.Salary.Operations.teamViewRecHandler()):Compensation.Salary.Operations.addSalaryForUsr(recordId,!1)}};ZP5Form.load(params,!1)},initOrgStructureAppFields:function(layout,appendTo,props){const divIds=[Compensation.CONSTANTS.ENTITIES.LEGALENTITY,Compensation.CONSTANTS.ENTITIES.BUSINESSUNIT,Compensation.CONSTANTS.ENTITIES.DIVISION,Compensation.CONSTANTS.ENTITIES.DEPARTMENT].map(obj=>"#"+obj).join(","),isdisabled=props.disabled,selVal=props.seldata;if(isOrgStructureEnabled){let OS_Sel_Size=0;layout.find(divIds).each(function(ind,ele){let options={dataMapping:{id:"id",value:"id",text:"text"},dataSource:fwSelect2.getDataSource({customCallback:ZPMultiRoles_Select2.getOptionsForOrgStructureElem},ele),viewPerPage:10,lazyLoading:!0,dropdownList:{appendTo:appendTo},beforetokenadd:Compensation.Utils.zcomp_token_selAllOrSelOtherOptn,tokenadd:ZPMultiRoles_Select2.nodeOptionChangeHandler,tokenremove:ZPMultiRoles_Select2.nodeOptionChangeHandler,placeholder:ZPI18N.getString("zp.all")};if(props.fitForElement&&(options.dropdownList.fitForElement=props.fitForElement),selVal){var selData=[],keyId=void 0,selDataObj=[];let selEle=$(ele).attr("name");if("entity"==selEle){let selIds=selVal.LEGALENTITY.map(o=>o instanceof Object?o.id:o);0==selIds.length||selIds.includes("-1")||(selDataObj=Compensation.Config.configObj.allVals[Compensation.CONSTANTS.ENTITIES.LEGALENTITY].filter(obj=>selIds.includes(obj.EntityID)),keyId="EntityID")}else if("unit"!=selEle||selVal.BUSINESSUNIT.includes("-1"))if("division"!=selEle||selVal.DIVISION.includes("-1")){if("department"==selEle&&selVal.DEPARTMENT&&!selVal.DEPARTMENT.includes("-1")){let selIds=selVal.DEPARTMENT.map(o=>o instanceof Object?o.id:o);0==selIds.length||selIds.includes("-1")||(selDataObj=Compensation.Config.configObj.allVals[Compensation.CONSTANTS.ENTITIES.DEPARTMENT].filter(obj=>selIds.includes(obj.id)),keyId="id")}}else{let selIds=selVal.DIVISION.map(o=>o instanceof Object?o.id:o);0==selIds.length||selIds.includes("-1")||(selDataObj=Compensation.Config.configObj.allVals[Compensation.CONSTANTS.ENTITIES.DIVISION].filter(obj=>selIds.includes(obj.DivisionID)),keyId="DivisionID")}else{let selIds=selVal.BUSINESSUNIT.map(o=>o instanceof Object?o.id:o);0==selIds.length||selIds.includes("-1")||(selDataObj=Compensation.Config.configObj.allVals[Compensation.CONSTANTS.ENTITIES.BUSINESSUNIT].filter(obj=>selIds.includes(obj.UnitID)),keyId="UnitID")}selDataObj.forEach(function(obj){let tempObj={};tempObj.text=obj.Name,tempObj.id=obj[keyId],selData.push(tempObj)}),OS_Sel_Size<=1?(options.values=selData,OS_Sel_Size=selData.length):(options.values=[{text:ZPI18N.getString("zp.all"),id:"-1"}],options.disabled=!0)}options.disabled=isdisabled,ZPeopleComponents.tokenfield(ele,options)})}},getUsrProfHtml:function(userJson,userId,backUrl){let userDtls=userJson||ZPeople.getUserDetailsById(userId),profHtml="";return void 0!=backUrl&&(profHtml+=`<div class="zpl_bcknavi" onclick="window.location.href=${backUrl}"><i class="zpl_ibg zpl_act PI_back"></i></div>`),profHtml+=`<div class="zpl_em">\n\t\t\t\t\t\t<div class="zpl_emimg"><img src="${userDtls.avatar}">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="zpl_emdts zpl_ellipsis">\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<em>${ZSEC.Encoder.encodeForHTML(userDtls.empid)}</em>&nbsp;-&nbsp;<b>${ZSEC.Encoder.encodeForHTML(userDtls.name)}</b>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<em>${ZSEC.Encoder.encodeForHTML(userDtls.designation||"")}</em>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`},handleMultiSelect:function(layout,ele,callback,clear=!1){let selIds;if(layout.find("div#recordActionsContainer").addClass("DNI").removeClass("opn"),clear)layout.find("div#recordActions input[type=checkbox]").prop("checked",!1);else{let isClose="recordActionCompClose"==ele.attr("id"),rId=isClose?"-1":$(ele).attr("recordid"),isEditAllowed=!!isClose||(!$(ele).parent("td").attr("iseditable")||"true"==$(ele).parent("td").attr("iseditable")),isChecked=!isClose&&$(ele).find("input[type=checkbox]").prop("checked",function(_,v){return!!isEditAllowed&&!v}).prop("checked");if(!isEditAllowed)return;if("-1"==rId)layout.find("td[iseditable=true] input[type=checkbox]").prop("checked",isChecked);else{let chkHdr=layout.find("td[iseditable=true] input[type=checkbox]").length==layout.find("td[iseditable=true] input[type=checkbox]:checked").length;layout.find("th div#recordActions").find("input[type=checkbox]").prop("checked",chkHdr)}(selIds=layout.find("div#recordActions input[type=checkbox]:checked").map((i,e)=>{let v=$(e).closest("div#recordActions").attr("recordid");if("-1"!=v)return v}).get())&&selIds.length>0?layout.find("div#recordActionsContainer").removeClass("DNI").addClass("opn"):layout.find("th div#recordActions").find("input[type=checkbox]").prop("checked",!1)}callback(selIds)}};class compensationModuleFilter{constructor(prop){this.filterid=prop.filterid,this.fieldJson=prop.fieldJson,this.appendTo=prop.hasOwnProperty("appendTo")?prop.appendTo:settingsPage.container,this.handleOSFltr=!!prop.hasOwnProperty("handleOSFltr")&&prop.handleOSFltr,this.handleLocFltr=!!prop.hasOwnProperty("handleLocFltr")&&prop.handleLocFltr,this.handleAppStatusFltr=!!prop.hasOwnProperty("handleApprovalStatusFltr")&&prop.handleApprovalStatusFltr,this.handleEmpStatusFltr=!!prop.hasOwnProperty("handleEmpStatusFltr")&&prop.handleEmpStatusFltr,this.handleEmpViewTypeFltr=prop.handleEmpViewTypeFltr||!1,this.filterPosCls=prop.filterPosCls,this.applyCallback=prop.applyCallback,this.dataTblEle=prop.dataTblEle,this.fltrResultFmt=prop.fltrResultFmt,this.isOSInitialized=!1,this.filterResult=[],this.resultContainer=null,this.fltrRsltCls=prop.fltrRsltCls,this.fltrRsltClrBtnCls=prop.fltrRsltClrBtnCls}init(){let handleOSFields=this.handleOSFltr,filterId=this.filterid,filterOpts=this.fieldJson,appendTo=this.appendTo,isFromOnboarding="onboarding"==settingsUrlProps.currentMode;var resultContainer=`<div class="zpl_fltrvw DN" id="sys_filterResultsHeader">\n\t\t\t\t\t\t\t\t    <div id="sys_filterResults" ${this.fltrRsltCls?`class="${this.fltrRsltCls}"`:""}>\n\t\t\t\t\t\t\t\t         <ul id="filterullist" class="zpl_fltrvwlst"></ul>\n\t\t\t\t\t\t\t\t    </div>\n\t\t\t\t\t\t\t\t    <div class="d-flexcap MLauto ${this.fltrRsltClrBtnCls?this.fltrRsltClrBtnCls:""}">\n\t\t\t\t\t\t\t\t        <a class="red" id="clearAll">${ZPI18N.getString("zp.clearAll")}</a>\n\t\t\t\t\t\t\t\t    </div>\n\t\t\t\t\t\t\t\t</div>`;$(this.dataTblEle).before(resultContainer),this.resultContainer=settingsPage.container.find("#sys_filterResultsHeader");var filterDiv='<div class="zpl_fltr" id="'+filterId+'" osFields="'+handleOSFields+'"><div><div class="zpl_fltrhd"><h5>'+ZPI18N.getString("zp.filter")+'</h5><i class="PI_cls" title="'+ZPI18N.getString("zp.close")+'" onclick=""></i></div></div>';filterDiv+='<div class="zpl_fltrcnt"><div><div class="zpl_fltclps fltopn sel_postion" style="position: relative;"><div id="feildsList"class="zpl_fltrlst">';let fldDiv="";this.handleEmpStatusFltr&&(fldDiv+=`<div class="zpl_secn">\n        \t\t\t\t   <div><label>${ZPI18N.getString("zp.employeestatus")}</label></div>\n        \t\t\t\t  \t<div id="filterfields" labelname="empStatus" ftype="2">\n\t\t\t\t\t\t\t\t<select id="empStatus" class="zselectbox select-js" fname="${filterId+"_empStatus"}">\n\t\t\t\t\t\t\t\t\t<option value="all">${ZPI18N.getString("zp.allrequest")}</option>\n\t\t\t\t\t\t\t\t\t<option value="activeemprecord" selected="selected">${ZPI18N.getString("zp.activeemprequest")}</option>\n                    \t\t\t\t<option value="exitemprecord">${ZPI18N.getString("zp.exemprequest")}</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n        \t\t\t\t  </div>`),this.handleEmpViewTypeFltr&&(fldDiv+=`<div class="zpl_secn">\n        \t\t\t\t   <div><label>${ZPI18N.getString("zp.employee")}</label></div>\n        \t\t\t\t  \t<div id="filterfields" labelname="empViewType" ftype="2">\n\t\t\t\t\t\t\t\t<select id="empViewType" class="zselectbox select-js" fname="${filterId+"_empViewType"}">\n\t\t\t\t\t\t\t\t\t<option value="1" selected="selected">${ZPI18N.getString("zp.dirsubdata")}</option>\n                    \t\t\t\t<option value="2">${ZPI18N.getString("zp.subdata")}</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n        \t\t\t\t  </div>`),this.handleAppStatusFltr&&(fldDiv+=`<div class="zpl_secn">\n        \t\t\t\t   <div><label>${ZPI18N.getString("zp.approvalstatus")}</label></div>\n        \t\t\t\t  \t<div id="filterfields" labelname="approvalStatus" ftype="2">\n\t\t\t\t\t\t\t\t<select id="approvalStatus" class="zselectbox select-js" fname="${filterId+"_approvalStatus"}">\n\t\t\t\t\t\t\t\t\t<option value="all" selected="selected">${ZPI18N.getString("zp.allrequest")}</option>\n\t\t\t\t\t\t\t\t\t<option value="approved">${ZPI18N.getString("zp.approved")}</option>\n                    \t\t\t\t<option value="rejected">${ZPI18N.getString("zp.rejected")}</option>\n\t\t\t\t\t\t\t\t\t<option value="pending">${ZPI18N.getString("zp.pending")}</option>\n                    \t\t\t\t<option value="notsubmitted">${ZPI18N.getString("zp.drafts")}</option>\n\t\t\t\t\t\t\t\t\t<option value="cancelled">${ZPI18N.getString("zp.cancelled")}</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n        \t\t\t\t  </div>`),filterOpts&&filterOpts.length>0&&filterOpts.forEach(fieldObj=>{let fSecn=this.getFieldEleToFilter(fieldObj);fldDiv+=fSecn});let osDiv="";handleOSFields&&(null==ZPeople.orgStructureTagMap&&isOrgStructureEnabled||(!0===ZPeople.orgStructureTagMap.entity&&(osDiv+='<div class="zpl_secn DN" id="entityFilter"><div><label>'+ZPeople.orgStructureDispNameMap.entity+'</label></div><div id="filterfields" ftype="2" labelname="LEGALENTITY"><select id="'+filterId+'_Entity" class="zselectbox select-js" data-show-search-field="true" name="entity" fname="'+filterId+'_LEGALENTITY"></select></div></div>'),!0===ZPeople.orgStructureTagMap.unit&&(osDiv+='<div class="zpl_secn DN" id="unitFilter"><div><label>'+ZPeople.orgStructureDispNameMap.unit+'</label></div><div  id="filterfields" ftype="2" labelname="BUSINESSUNIT"><select id="'+filterId+'_Unit" class="zselectbox select-js" data-show-search-field="true" name="unit" fname="'+filterId+'_BUSINESSUNIT"></select></div></div>'),!0!==ZPeople.orgStructureTagMap.division||isFromOnboarding||(osDiv+='<div class="zpl_secn DN" id="divisionFilter"><div><label>'+ZPeople.orgStructureDispNameMap.division+'</label></div><div  id="filterfields" ftype="2" labelname="DIVISION"><select id="'+filterId+'_Division" class="zselectbox select-js" data-show-search-field="true" name="division" fname="'+filterId+'_DIVISION"></select></div></div>'),isOrgStructureEnabled&&!0!==ZPeople.orgStructureTagMap.department||(osDiv+='<div class="zpl_secn DN" id="departmentFilter"><div><label>'+ZPeople.orgStructureDispNameMap.department+'</label></div><div  id="filterfields" ftype="2" labelname="DEPARTMENT"><select id="'+filterId+'_Department" class="zselectbox select-js" data-show-search-field="true" name="department" fname="'+filterId+'_DEPARTMENT"></select></div></div>'))),this.handleLocFltr&&(osDiv+='<div class="zpl_secn DN" id="locationFilter"><div><label>'+ZPI18N.getString("zp.location")+'</label></div><div  id="filterfields" ftype="2" labelname="LOCATION"><select id="'+filterId+'_Location" class="zselectbox select-js" data-show-search-field="true" name="locid" fname="'+filterId+'_LOCATION"></select></div></div>'),filterDiv+=osDiv+fldDiv,filterDiv+="</div></div></div></div>",filterDiv+='<div id="filterFooter"><button id="applyFilter" type="button" class="zlabel zlabel--blue zlabel--medium" ref="applyFilter">'+ZPI18N.getString("zp.apply")+'</button><button id="resetFilter" type="button" class="zlabel zlabel--outline zlabel--medium" ref="resetFilter">'+ZPI18N.getString("zp.reset")+"</button></div>",filterDiv+="</div>",$(filterDiv).appendTo(appendTo),filterDiv=$(appendTo).find("#"+filterId),this.filterContainer=filterDiv,this.reset(),filterDiv.find("#applyFilter").on("click",()=>{this.apply()}),filterDiv.find("#resetFilter").on("click",()=>{this.reset(event)});let fltrClass=this.filterPosCls?this.filterPosCls:"zpl_fltr_flt";filterDiv.find("i.PI_cls").on("click",()=>{this.appendTo.toggleClass(fltrClass)}),this.resultContainer.find("ul").on("click","li a[id=viewFilterResultsClose]",()=>{let id=$(event.target).closest("li").find("label").attr("fieldLabel");this.clearFilterResult(event,id)}),this.resultContainer.find("#clearAll").on("click",()=>{this.clearFilterResult()})}getFieldEleToFilter(fieldDetails){let filterId=this.filterid;var secId=fieldDetails.secId;let fType=fieldDetails.fieldType,fname=fieldDetails.id.replace(".","_"),fieldSecn='<div class="zpl_secn"'+(void 0!=secId?'id="'+secId+'"':"")+">";switch(fieldSecn+="<div><label>"+fieldDetails.dispName+'</label></div><div id="filterfields" labelName="'+fieldDetails.id+'" fType="'+fType+'">',fType){case Compensation.CONSTANTS.TEXT_FIELD:case Compensation.CONSTANTS.NUMERICAL_FIELD:case Compensation.CONSTANTS.DATE_FIELD:case Compensation.CONSTANTS.DATETIME_FIELD:fieldSecn+='<select class="select-js" id="'+fieldDetails.id+'" fname="'+filterId+"_"+fname+'" fType="'+fieldDetails.fieldType+'"></select>';break;case Compensation.CONSTANTS.PICKLIST_FIELD:case Compensation.CONSTANTS.SPECIAL_FIELDS:fieldSecn+='<select class="select-js" id="'+fieldDetails.id+'" fname="'+filterId+"_"+fname+'" fType="'+fieldDetails.fieldType+'"></select>';break;case Compensation.CONSTANTS.MULTISELECT_PICKLIST_FIELD:case Compensation.CONSTANTS.LOOKUP_FIELD:case Compensation.CONSTANTS.PLAIN_TEXT_FIELD:fieldDetails.isTokenField||fType==Compensation.CONSTANTS.LOOKUP_FIELD||fType==Compensation.CONSTANTS.PLAIN_TEXT_FIELD?fieldSecn+='<textarea id="'+fieldDetails.id+'" fname="'+filterId+"_"+fname+'" type="tokenField" fType="'+fieldDetails.fieldType+'"></textarea>':fieldSecn+='<select class="select-js"  id="'+fieldDetails.id+'" fname="'+filterId+"_"+fname+'" multiple fType="'+fieldDetails.fieldType+'"></select>'}if(fieldSecn+="</div></div>",fType==Compensation.CONSTANTS.TEXT_FIELD||fType==Compensation.CONSTANTS.NUMERICAL_FIELD||fType==Compensation.CONSTANTS.DATE_FIELD||fType==Compensation.CONSTANTS.DATETIME_FIELD){fieldSecn+=`<div class="zpl_secn">\n            \t\t\t\t\t<div>\n              \t\t\t\t\t\t<input class="ztextbox DNI" id="${filterId+"_"+fname}_Input">\n\t\t\t\t\t\t\t\t\t<input class="ztextbox DNI" id="${filterId+"_"+fname}_Bw_Input">\n           \t\t\t\t\t\t </div>\n          \t\t\t\t\t</div>`}return fieldSecn}getFilterFieldOptions(fieldType){let opt=[];return fieldType==Compensation.CONSTANTS.TEXT_FIELD?opt=[{id:"18",name:ZPI18N.getString("zp.is")},{id:"19",name:ZPI18N.getString("zp.isnot")},{id:"24",name:ZPI18N.getString("zp.startswith")},{id:"25",name:ZPI18N.getString("zp.endswith")},{id:"26",name:ZPI18N.getString("zp.contains")},{id:"27",name:ZPI18N.getString("zp.notcontains")}]:fieldType==Compensation.CONSTANTS.NUMERICAL_FIELD?opt=[{id:"18",name:ZPI18N.getString("zp.is")},{id:"19",name:ZPI18N.getString("zp.isnot")},{id:"20",name:ZPI18N.getString("zp.lessthan",[""]).trim()},{id:"21",name:ZPI18N.getString("zp.greaterthan",[""]).trim()},{id:"22",name:ZPI18N.getString("zp.lessthanorequalto",[""]).trim()},{id:"23",name:ZPI18N.getString("zp.greaterthanorequalto",[""]).trim()}]:fieldType!=Compensation.CONSTANTS.DATE_FIELD&&fieldType!=Compensation.CONSTANTS.DATETIME_FIELD||(opt=[{id:"18",name:ZPI18N.getString("zp.is")},{id:"19",name:ZPI18N.getString("zp.isnot")},{id:"58",name:ZPI18N.getString("zp.between")},{id:"44",name:ZPI18N.getString("zp.lastmonth")},{id:"45",name:ZPI18N.getString("zp.thismonth")},{id:"51",name:ZPI18N.getString("zp.lastyear")},{id:"51",name:ZPI18N.getString("zp.currentyear")}]),opt}resetOrgStructureFields(id=-1){let filterDiv=this.filterContainer,filterId=this.filterid,isFromOnboarding="onboarding"==settingsUrlProps.currentMode;switch(id){case"LEGALENTITY":case-1:void 0!=ZPeople.orgStructureTagMap&&ZPeople.orgStructureTagMap.entity&&ZPeopleComponents.select(filterDiv.find("#"+filterId+"_Entity")).setAttributes({selectedValue:"-1"});case"BUSINESSUNIT":case-1:void 0!=ZPeople.orgStructureTagMap&&ZPeople.orgStructureTagMap.unit&&ZPeopleComponents.select(filterDiv.find("#"+filterId+"_Unit")).setAttributes({selectedValue:"-1"});case"DIVISION":case-1:!isFromOnboarding&&void 0!=ZPeople.orgStructureTagMap&&ZPeople.orgStructureTagMap.division&&ZPeopleComponents.select(filterDiv.find("#"+filterId+"_Division")).setAttributes({selectedValue:"-1"});case"DEPARTMENT":case-1:(!isOrgStructureEnabled||void 0!=ZPeople.orgStructureTagMap&&ZPeople.orgStructureTagMap.department)&&ZPeopleComponents.select(filterDiv.find("#"+filterId+"_Department")).setAttributes({selectedValue:"-1"});case"LOCATION":case-1:this.handleLocFltr&&ZPeopleComponents.select(filterDiv.find("#"+filterId+"_Location")).setAttributes({selectedValue:"-1"})}}initOrgStructure(){let filterDiv=this.filterContainer,filterProps={container:settingsPage.container,defaultOrgStrucureStatus:"-1",isEmpTree:!0},filterPropsObj=new viewFilter(filterProps),elementDOMObj={};elementDOMObj.entity=filterDiv.find("#entityFilter"),elementDOMObj.unit=filterDiv.find("#unitFilter"),elementDOMObj.division=filterDiv.find("#divisionFilter"),elementDOMObj.department=filterDiv.find("#departmentFilter"),elementDOMObj.location=filterDiv.find("#locationFilter"),filterPropsObj.handleOrgStructureFilters(elementDOMObj,0!=elementDOMObj.location.length,!1,void 0,{}),this.isOSInitialized=!0}reset(event,id){let filterDiv=this.filterContainer,filterId=this.filterid,filterOpts=this.fieldJson,handleOSFields=this.handleOSFltr,fieldSearchParams=this.filterResult,element="";event&&(element=$(event.currentTarget).parent());let filterIndex=$(element).attr("filterno");if(this.clearErrTxt(),id&&(filterOpts=filterOpts.filter(obj=>obj.id==id)),filterOpts&&filterOpts.length>0&&filterOpts.forEach(fieldObj=>{let fieldId=fieldObj.id,fname=fieldId.replace(".","_"),fieldType=fieldObj.fieldType,index=$(element).attr("filterIndex"),delValArr=[];if(index&&0!=index&&(ZPeopleComponents.popover($("body").find("#showSearchPopId")).close(),(delValArr=fieldSearchParams.filter(item=>item.id==filterIndex)[0]).searchTxts.splice(index,1),delValArr.selectedVals.splice(index,1)),fieldObj.isTokenField||fieldType==Compensation.CONSTANTS.LOOKUP_FIELD||fieldType==Compensation.CONSTANTS.PLAIN_TEXT_FIELD){let dataArr=fieldObj.options,initialSel=[],isFormSearch=fieldType==Compensation.CONSTANTS.LOOKUP_FIELD&&(fieldObj.isFormSearch||!1);if(fieldObj.isSearchField&&!dataArr){if(index&&0!=index)if(isFormSearch)initialSel=delValArr.selectedVals.map((id,i)=>{return{value:delValArr.searchTxts[i].trim(),id:id,decodedItemText:delValArr.searchTxts[i].trim()}});else{ZPeople.getUserDetailsByIds(delValArr.selectedVals).map(obj=>{let tempObj={};tempObj.id=obj.usererec,tempObj.decodedItemText=obj.empid+" "+obj.name,tempObj.text=ZPeople.decodeTxt(obj.empid+" "+obj.name),tempObj.html=obj.empid+" "+obj.name,tempObj.photo=obj.zpeoplePhoto,initialSel.push(tempObj)})}if(isFormSearch)return void Compensation.Utils.constructLookupSearchFld(fieldId,this.filterContainer,fieldObj,initialSel);let searchMode=fieldObj.searchMode,extraParamCB=()=>{var extraParams={};return fieldObj.compDataType&&(extraParams.compDataType=fieldObj.compDataType),extraParams};return void Compensation.Utils.constructEmpSearchFld(fieldId,"token",searchMode,void 0,this.filterContainer,extraParamCB,initialSel)}if(initialSel=[],index&&0!=index){let tempDetArr=delValArr.selectedVals;dataArr.map(obj=>{let tempObj={};tempDetArr.includes(obj.id)&&(tempObj.id=obj.id,tempObj.decodedItemText=obj.name,tempObj.name=obj.name,initialSel.push(tempObj))})}ZPeopleComponents.tokenfield(filterDiv.find('[fname="'+filterId+"_"+fname+'"]')).destroy();var _tokenObj=Compensation.Utils.getZCompTokenObj(dataArr,"id","name","checkbox",ZPI18N.getString("zp.all"),"name",initialSel,!1);_tokenObj.acceptNewValues=fieldType==Compensation.CONSTANTS.PLAIN_TEXT_FIELD,_tokenObj.dropdownList={appendTo:this.filterContainer},ZPeopleComponents.tokenfield(filterDiv.find('[fname="'+filterId+"_"+fname+'"]'),_tokenObj)}else{let opts=fieldObj.options?fieldObj.options:this.getFilterFieldOptions(fieldType),hasAllData=opts.filter(data=>"-1"==data.id).length>0,defOpts=opts.filter(data=>data.isDef);const isMultiSelect=fieldType==Compensation.CONSTANTS.MULTISELECT_PICKLIST_FIELD;if(fieldType!=isMultiSelect&&!hasAllData&&0==defOpts.length){let allOpt={id:"-1",name:ZPI18N.getString("zp.all")};0==defOpts.length&&(allOpt.isDef=!0,defOpts=allOpt),opts.splice(0,0,allOpt)}isMultiSelect&&index&&0!=index.length&&(defOpts=delValArr.selectedVals.map((id,i)=>{return{name:delValArr.searchTxts[i].trim(),id:id,decodedItemText:delValArr.searchTxts[i].trim()}}));var propDet={selectedValue:defOpts.length>0?isMultiSelect?defOpts:defOpts[0].id:null,search:{by:"name"},dataMapping:{label:"name",value:"id"},options:opts,dropdownList:{appendTo:this.filterContainer},change:event=>{this.handleFieldEvent(event,filterDiv,fieldType)},placeholder:fieldType==Compensation.CONSTANTS.MULTISELECT_PICKLIST_FIELD?ZPI18N.getString("zp.all"):void 0,randomDropdownListId:!0};if((fieldType==Compensation.CONSTANTS.PICKLIST_FIELD||Compensation.CONSTANTS.MULTISELECT_PICKLIST_FIELD)&&_.isFunction(fieldObj.optionCallback)&&(propDet.dataSource={search:queryParams=>new Promise((search,reject)=>{search({results:fieldObj.optionCallback(),more:!1})})}),ZPeopleComponents.select(filterDiv.find('[fname="'+filterId+"_"+fname+'"]')).destroy(),ZPeopleComponents.select(filterDiv.find('[fname="'+filterId+"_"+fname+'"]'),propDet),filterDiv.find("#"+filterId+"_"+fname+"_Input").val("").addClass("DNI"),filterDiv.find("#"+filterId+"_"+fname+"_Bw_Input").val("").addClass("DNI"),fieldType==Compensation.CONSTANTS.DATE_FIELD||fieldType==Compensation.CONSTANTS.DATETIME_FIELD){let fn=fieldType==Compensation.CONSTANTS.DATE_FIELD?ZPeopleComponents.datefield:ZPeopleComponents.datetimefield;fn(filterDiv.find("#"+filterId+"_"+fname+"_Input")).destroy(),fn(filterDiv.find("#"+filterId+"_"+fname+"_Bw_Input")).destroy()}}}),handleOSFields){this.isOSInitialized?this.resetOrgStructureFields(id):this.initOrgStructure()}if(this.handleAppStatusFltr&&(!id||"approvalStatus"==id)){var propDet={selectedValue:"all",dropdownList:{appendTo:this.filterContainer},randomDropdownListId:!0};ZPeopleComponents.select(filterDiv.find("#approvalStatus")).destroy(),ZPeopleComponents.select(filterDiv.find("#approvalStatus"),propDet)}if(this.handleEmpStatusFltr&&(!id||"empStatus"==id)){propDet={selectedValue:"activeemprecord",dropdownList:{appendTo:"#"+filterId},randomDropdownListId:!0};ZPeopleComponents.select(filterDiv.find("#empStatus")).destroy(),ZPeopleComponents.select(filterDiv.find("#empStatus"),propDet)}if(this.handleEmpViewTypeFltr&&(!id||"empViewType"==id)){propDet={selectedValue:"1",dropdownList:{appendTo:"#"+filterId},randomDropdownListId:!0};ZPeopleComponents.select(filterDiv.find("#empViewType")).destroy(),ZPeopleComponents.select(filterDiv.find("#empViewType"),propDet)}}clearErrTxt(){let filterDiv=this.filterContainer;filterDiv.find("input.ztextbox").removeClass("ztextbox__error"),filterDiv.find("span.ztextbox--error__label").remove()}appendErrTxt(ele){$(ele).parents("div.zpl_secn").find("input.ztextbox").addClass("ztextbox__error"),$(ele).parents("div.zpl_secn").append(`<span class="ztextbox--error__label">${ZPI18N.getString("zp.searchvaluescannotbeempty")}</span>`)}isValidInput(input){return void 0!=input&&!_.isEmpty(input)&&!input.includes("undefined")}apply(){let fltrClass=this.filterPosCls?this.filterPosCls:"zpl_fltr_flt";var{hasError:hasError,searchParams:searchParams}=this.validateAndGetFltrResult();if(hasError)return;this.appendTo.removeClass(fltrClass),this.filterResult=searchParams;let callback=this.applyCallback;if(_.isFunction(callback)){let[searchParams,orgStructureFilter,employeeStatus,approvalStatus,empViewType]=this.fmtFltrResult();this.handleResultSet(),callback(searchParams,orgStructureFilter,employeeStatus,approvalStatus,empViewType)}}validateAndGetFltrResult(){this.clearErrTxt();let filterDiv=this.filterContainer;var searchParams=[];let filterId=filterDiv.attr("id"),fields=filterDiv.find("#feildsList").find(".zpl_secn"),fOpts=this.fieldJson;return fields.each((ind,fEle)=>{var searchObj={};let fieldObj=$(fEle).find("#filterfields");if(0!=fieldObj.length){let fieldLabel=fieldObj.attr("labelName"),fname=fieldLabel.replace(".","_"),fType=fieldObj.attr("fType");if(fType==Compensation.CONSTANTS.TEXT_FIELD||fType==Compensation.CONSTANTS.NUMERICAL_FIELD||fType==Compensation.CONSTANTS.PICKLIST_FIELD||fType==Compensation.CONSTANTS.SPECIAL_FIELDS||fType==Compensation.CONSTANTS.DATE_FIELD||fType==Compensation.CONSTANTS.DATETIME_FIELD){let selVal=ZPeopleComponents.select(fieldObj.find('select[fname="'+filterId+"_"+fname+'"]')).getValue(),selTxt=fieldObj.find('select[fname="'+filterId+"_"+fname+'"] :selected')[0].optData.label,isDefOpt=!1;if("empStatus"==fieldLabel&&(isDefOpt="activeemprecord"==selVal),"empViewType"==fieldLabel&&(isDefOpt="1"==selVal),"approvalStatus"==fieldLabel&&(isDefOpt="all"==selVal),fType==Compensation.CONSTANTS.PICKLIST_FIELD){let selOpt=fOpts.filter(obj=>obj.id==fieldLabel);selOpt.length>0&&selOpt[0].options&&(isDefOpt=0!=selOpt[0].options.filter(obj=>obj.isDef&&obj.id==selVal).length)}var inputData,bwData,searchVal;if("-1"!=selVal&&!isDefOpt){if(this.canShowInputFld(selVal)){let inpEle=filterDiv.find("input#"+filterId+"_"+fname+"_Input"),bwEle=filterDiv.find("input#"+filterId+"_"+fname+"_Bw_Input");if(inputData=inpEle.val(),bwData=bwEle.val(),fType==Compensation.CONSTANTS.DATE_FIELD||fType==Compensation.CONSTANTS.DATETIME_FIELD){let fn=fType==Compensation.CONSTANTS.DATE_FIELD?ZPeopleComponents.datefield:ZPeopleComponents.datetimefield;inputData=fn(inpEle).getValue().dateString,"58"==selVal&&(bwData=fn(bwEle).getValue().dateString)}searchVal=inputData,"58"==selVal&&(searchVal+=";"+bwData),this.isValidInput(inputData)&&("58"!=selVal||this.isValidInput(bwData))||this.appendErrTxt(inpEle)}searchObj.fieldType=fType,searchObj.id=fieldLabel,searchObj.selectedVals=new Array(selVal),searchObj.searchVal=searchVal,searchObj.searchTxts=new Array(selTxt),searchParams.push(searchObj)}}else if(fType==Compensation.CONSTANTS.MULTISELECT_PICKLIST_FIELD||fType==Compensation.CONSTANTS.LOOKUP_FIELD||fType==Compensation.CONSTANTS.PLAIN_TEXT_FIELD){let isTokenField=0!=fieldObj.find('textarea[fname="'+filterId+"_"+fname+'"]').length;var selVals=[],selTxts=[];if(isTokenField)selVals=ZPeopleComponents.tokenfield(fieldObj.find('textarea[fname="'+filterId+"_"+fname+'"]')).getAllValues(),selTxts=selVals.map(obj=>obj.decodedItemText);else{selVals=ZPeopleComponents.select(fieldObj.find('select[fname="'+filterId+"_"+fname+'"]')).getValues(),fieldObj.find('select[fname="'+filterId+"_"+fname+'"] :selected').each(function(i,opt){selTxts.push(opt.optData.label)})}isTokenField&&0!=selVals.length&&(selVals=selVals.map(obj=>obj.id)),selVals.length>0&&!selVals.includes("-1")&&(searchObj.fieldType=fType,searchObj.id=fieldLabel,searchObj.selectedVals=selVals,searchObj.searchTxts=selTxts,searchParams.push(searchObj))}}}),{hasError:0!=filterDiv.find("span.ztextbox--error__label").length,searchParams:searchParams}}handleFieldEvent(event,filterDiv,fieldType){if(fieldType==Compensation.CONSTANTS.TEXT_FIELD||fieldType==Compensation.CONSTANTS.NUMERICAL_FIELD||fieldType==Compensation.CONSTANTS.DATE_FIELD||fieldType==Compensation.CONSTANTS.DATETIME_FIELD){let eleId=event.target.attr("fname"),selVal=ZPeopleComponents.select(event.target).getValue(),inpEle=filterDiv.find("#"+eleId+"_Input"),bwEle=filterDiv.find("#"+eleId+"_Bw_Input"),fn=fieldType==Compensation.CONSTANTS.DATE_FIELD?ZPeopleComponents.datefield:ZPeopleComponents.datetimefield;if(ZPeopleComponents.isComponent(inpEle)&&fn(inpEle).destroy(),ZPeopleComponents.isComponent(bwEle)&&fn(bwEle).destroy(),inpEle.val("").addClass("DNI"),bwEle.val("").addClass("DNI"),"-1"!=selVal&&this.canShowInputFld(selVal))if(inpEle.removeClass("DNI"),"58"==selVal&&bwEle.removeClass("DNI"),fieldType==Compensation.CONSTANTS.DATE_FIELD)ZPeopleComponents.datefield(inpEle,{calendarIcon:!0,picker:!0,format:dateFmt}),"58"==selVal&&ZPeopleComponents.datefield(bwEle,{calendarIcon:!0,picker:!0,format:dateFmt});else if(fieldType==Compensation.CONSTANTS.DATETIME_FIELD){let format=dateFmt,temptimeFormat=timeFormat.replace("a","tt");Calendar.is12HrFormat()||(temptimeFormat=timeFormat+":ss");let prop={calendarIcon:!0,picker:!0,format:format+=" "+temptimeFormat,spinButtons:"none",clearButton:"none"};ZPeopleComponents.datetimefield(inpEle,prop),"58"==selVal&&ZPeopleComponents.datetimefield(bwEle,prop)}}}canShowInputFld(operType){return(operType=Number(operType))==FormConstants.Criteria.OPERATORS.EQUAL||operType==FormConstants.Criteria.OPERATORS.NOT_EQUAL||operType==FormConstants.Criteria.OPERATORS.STARTS_WITH||operType==FormConstants.Criteria.OPERATORS.ENDS_WITH||operType==FormConstants.Criteria.OPERATORS.CONTAINS||operType==FormConstants.Criteria.OPERATORS.NOT_CONTAINS||operType==FormConstants.Criteria.OPERATORS.LIKE||operType==FormConstants.Criteria.OPERATORS.BETWEEN||operType==FormConstants.Criteria.OPERATORS.LESS_THAN||operType==FormConstants.Criteria.OPERATORS.GREATER_THAN||operType==FormConstants.Criteria.OPERATORS.LESS_EQUAL||operType==FormConstants.Criteria.OPERATORS.GREATER_EQUAL}clearFilterResult(event,id){this.reset(event,id),this.apply()}isStaticField(id){return"empStatus"==id||"approvalStatus"==id||"empViewType"==id}isOrgStructureField(id){return"LEGALENTITY"==id||"BUSINESSUNIT"==id||"DIVISION"==id||"DEPARTMENT"==id||"LOCATION"==id}getOrgStructureDispName(id){switch(id){case"LEGALENTITY":return ZPeople.orgStructureDispNameMap.entity;case"BUSINESSUNIT":return ZPeople.orgStructureDispNameMap.unit;case"DIVISION":return ZPeople.orgStructureDispNameMap.division;case"DEPARTMENT":return ZPeople.orgStructureDispNameMap.department;case"LOCATION":return ZPI18N.getString("zp.location")}}getStaticFieldDispName(id){switch(id){case"empStatus":return ZPI18N.getString("zp.employeestatus");case"empViewType":return ZPI18N.getString("zp.employee");case"approvalStatus":return ZPI18N.getString("zp.approvalstatus")}}getOrgStructureLabelName(id){switch(id){case"LEGALENTITY":return"entity";case"BUSINESSUNIT":return"unit";case"DIVISION":return"division";case"DEPARTMENT":return"dept";case"LOCATION":return"loc"}}handleResultSet(){let resultContainer=this.resultContainer,$filterResults=resultContainer.find("#sys_filterResults"),filterResult=this.filterResult;if(0==filterResult.length)return void this.resultContainer.addClass("DN");let fieldJSON=this.fieldJson,$_liHtml="";resultContainer.find("ul").html("");filterResult.map(obj=>{let isStaticField=this.isStaticField(obj.id),isOSField=this.isOrgStructureField(obj.id),fieldDet=isOSField||isStaticField?{}:fieldJSON.filter(fieldObj=>fieldObj.id==obj.id)[0],dispName=isOSField||isStaticField?isOSField?this.getOrgStructureDispName(obj.id):this.getStaticFieldDispName(obj.id):fieldDet.dispName;if(fieldDet.skipFltrResult||"empViewType"==obj.id)return"";let inpVal=obj.searchVal,searchTxt=obj.searchTxts.join(","),op=inpVal?searchTxt:"Employee"==fieldDet.id?":":ZPI18N.getString("zp.is"),val=inpVal||searchTxt,fieldLabelName=(isOSField||isStaticField)&&0==Object.keys(fieldDet)?obj.id:fieldDet.id,$_span=($_liHtml=$('<li filterno="'+obj.id+'" filterIndex="0"><label fieldLabel="'+fieldLabelName+'">'+dispName+"&nbsp;&nbsp;&nbsp;"+op+'</label><span></span><a class="PI_cls" id="viewFilterResultsClose"></a></li>')).find("span"),valueArr=obj.searchTxts;valueArr.length>1?($_span.text(valueArr[0]),$_span.after("<sub id='showSearchElementInPop' class='zpl_drpdwn-js'>+"+(valueArr.length-1)+"</sub>")):($_span.html(ZSEC.Encoder.encodeForHTML(val)),$_span.on("mouseenter",this.showTooltip)),resultContainer.find("ul").append($_liHtml),0}),$_liHtml=$('<li id="filterresultsmore" class="zpl_mre zpl_drpdwn-js DNI"><i id="showsearch"class="PI_more d-flex"></i></li><div id="zplfltrvwmre1" class="zpl_drpdwn zpl_fltrvwlst zmenu zmenu--iconwithtext" data-type="list" data-content-type="icon-text" role="menu" tabindex="0" aria-hidden="true"></div>'),resultContainer.find("ul").append($_liHtml),resultContainer.removeClass("DN"),this.moreIcon($filterResults),$filterResults.find("[id=showSearchElementInPop]").off().on("click",event=>{this.constructShowSearchParamPopOver(event)})}showTooltip(event){let $_span=event.target;event.target.offsetWidth<event.target.scrollWidth&&!$($_span).attr("title")&&($($_span).addClass("tooltip-js"),$($_span).attr("title",$(event.target).text()),$($_span).attr("data-title-position","auto"),$($_span).attr("data-title-display-type","box"))}appendSearchPopover(element1,element2,width){let $popover=$('<ul data-body="true" class="zmenu__body"/>'),elementW=208+5*(element1.length-2);$.each(element1,(index,value)=>{(elementW+=$(value).outerWidth())>=width&&"filterresultsmore"!=$(value).attr("id")&&$popover.append(value)}),element2.append($popover)}moreIcon($filterResults){let resultContainer=this.resultContainer,$totalW=resultContainer.outerWidth(),$leftW=resultContainer.find("#sys_filterResults").outerWidth(),$allowedW=$totalW-(resultContainer.find("#clearAll").parent().outerWidth()+25),$moreIcon=resultContainer.find("#zplfltrvwmre1"),$moreIconClick=$filterResults.find("#filterresultsmore");$allowedW<$leftW?($moreIconClick.removeClass("DNI"),ZPeopleComponents.popover($moreIcon).destroy(),this.appendSearchPopover($filterResults.find('ul[class="zpl_fltrvwlst"]').find("li"),$moreIcon,$allowedW),ZPeopleComponents.popover($moreIcon,{forElement:$moreIconClick,position:"bottom-left"}),$moreIconClick.off(),$moreIconClick.on("click",()=>{ZPeopleComponents.popover($moreIcon).open()})):$moreIconClick.addClass("DNI")}constructShowSearchParamPopOver(event){0==$("body").find("#showSearchPopId").length&&$("body").append($('<div id="showSearchPopId" class="zpl_drpdwn zpl_fltrvwlst zmenu zmenu--iconwithtext" data-type="list" data-content-type="icon-text" role="menu" tabindex="0" aria-hidden="true"></div>'));let filterIndex=$($(event.currentTarget).parent()).attr("filterno"),$popover=$('<ul data-body="true" class="zmenu__body"/>'),searchByVal=this.filterResult.filter(tempobj=>tempobj.id==filterIndex)[0],dispname="",options="";$.each(searchByVal,(currKey,val)=>{"id"==currKey?dispname=val:"searchTxts"==currKey&&(options=val)}),$.each(options,(index,opt)=>{if(0!=index){let $_liHtml=$('<li filterno="'+filterIndex+'" filterIndex='+index+'><label fieldLabel="'+dispname+'">'+dispname+'&nbsp;&nbsp;&nbsp;:</label><span></span><a class="PI_cls" id="viewFilterResultsClose"></a></li>');$_liHtml.find("Span").text(opt),$popover.append($_liHtml)}}),ZPeopleComponents.popover($("body").find("#showSearchPopId")).destroy(),$("body").find("#showSearchPopId").html($popover),ZPeopleComponents.popover($("body").find("#showSearchPopId"),{forElement:$(event.currentTarget),position:"bottom"}),ZPeopleComponents.popover($("body").find("#showSearchPopId")).open(),$("body").find("#showSearchPopId").find("[id=viewFilterResultsClose]").on("click",event=>{let id=$(event.target).closest("li").find("label").attr("fieldLabel");this.clearFilterResult(event,id)})}getFormFltrFmt(fltResult){let empstatus,appStatus,empViewType,fieldArr=[],osObj={};return fltResult.forEach(fObj=>{let id=fObj.id,isOSFld=this.isOrgStructureField(id),fType=fObj.fieldType,selVal=fObj.selectedVals,searchTxt=fObj.searchTxts,inpVal=fObj.searchVal,fmtObj={};fmtObj[id]=inpVal||searchTxt.join(";");let opr=FormConstants.Criteria.OPERATORS.CONTAINS.toString();if(isOSFld){let labelName=this.getOrgStructureLabelName(id);osObj[labelName+"Ids"]=selVal[0],osObj[labelName+"Values"]=searchTxt[0]}else"empStatus"==id?empstatus=selVal[0]:"empViewType"==id?empViewType=selVal[0]:"approvalStatus"==id?appStatus=selVal[0]:(fType!=Compensation.CONSTANTS.TEXT_FIELD&&fType!=Compensation.CONSTANTS.NUMERICAL_FIELD&&fType!=Compensation.CONSTANTS.DATE_FIELD&&fType!=Compensation.CONSTANTS.DATETIME_FIELD||(opr=selVal[0]),fType==Compensation.CONSTANTS.SPECIAL_FIELDS&&(opr=FormConstants.Criteria.OPERATORS.EQUAL,fmtObj[id]=selVal[0]),fType!=Compensation.CONSTANTS.MULTISELECT_PICKLIST_FIELD&&fType!=Compensation.CONSTANTS.LOOKUP_FIELD&&fType!=Compensation.CONSTANTS.PLAIN_TEXT_FIELD&&fType!=Compensation.CONSTANTS.PICKLIST_FIELD||(fmtObj[id+"_ids"]=selVal,fmtObj[id+"_idFlag"]=selVal.map(()=>1)),this.canShowInputFld(opr)||fType!=Compensation.CONSTANTS.DATE_FIELD&&fType!=Compensation.CONSTANTS.DATETIME_FIELD||(fmtObj[id]=""),fmtObj[id+"_op"]=opr,fieldArr.push(fmtObj))}),[fieldArr,osObj,empstatus,appStatus,empViewType]}fmtFltrResult(){let orgStructureFltr,empStatusFltr,empViewTypeFltr,appStatusFltr,fmt=this.fltrResultFmt,fltResult=this.filterResult,fieldFltr=fltResult;return void 0!=fmt&&1==fmt&&([fieldFltr,orgStructureFltr,empStatusFltr,appStatusFltr,empViewTypeFltr]=this.getFormFltrFmt(fltResult)),[fieldFltr,orgStructureFltr,empStatusFltr,appStatusFltr,empViewTypeFltr]}}Compensation.RL={viewRevLtrModal:function(id,empId,revLetters){let modalId=id+"_revModal";const revModal=new sliderModal(ZPI18N.getString("zp.comp.rlg.salrevlet"),new Tab(modalId,()=>{Compensation.RL.showRevLtrsAsList(settingsPage.container.find("#card"+modalId),empId,revLetters)}));revModal.construct(void 0,`<button id="sliderCancel" type="button" class="zlabel zlabel--outline zlabel--medium">${ZPI18N.getString("zp.close")}</button>`),revModal.setCloseCallback(()=>{revModal.remove()})},showRevLtrsAsList:function(page,empId,revLetters){return function(){var revLetter;let dataHtml=`<div class="zpl_crd">\n                    <div class="zpl_crdcnt">\n                        <div class="zpl_emp_transfld">\n                           ${revLetters.map(revLetter=>(revLetter=revLetter,`<div id="${revLetter.revid}">\n                            <span class="icn cl3">\n                                <i class="PI_ft_pdf"></i>\n                            </span>\n                            <div class="flex-dirC d-flexclmcap5">\n                                <span data-toggle="tooltip" data-placement="bottom" title=""`+`data-original-title="${ZSEC.Encoder.encodeForHTMLAttribute(revLetter.rlGenName)}">`+`${ZSEC.Encoder.encodeForHTML(revLetter.rlGenName)}\n\t\t\t\t\t\t\t\t</span>\n                                <em>${revLetter.effDate}</em>\n                            </div>\n                            <span class="zpl_hvr MLauto">\n                                <a name="viewRev" id="${revLetter.revid}">${ZPI18N.getString("zp.view")}</a>\n                            </span>\n                        </div>`)).join("")} \n                        </div>\n                    </div>\n                </div>`;page.html(dataHtml),page.find("a[name=viewRev]").on("click",event=>{const revId=$(event.currentTarget).attr("id"),revObj=revLetters.filter(rev=>rev.revid===revId)[0];Compensation.RL.preview(revId,empId,revObj.rlGenName)})}()},preview:function(revId,empId,rlGenName){const lightBox=new LightBox(ZSEC.Encoder.encodeForHTML(`${empId} - ${rlGenName}.pdf`));lightBox.viewUrl=Compensation.Utils.checkAndAddContextPath(`/pdfViewer.zp?mode=revisionletter&recordId=${revId}`),lightBox.needDownload=!0,lightBox.setDownloadCallback(()=>this.download(revId)),lightBox.show(),$("#lightBoxCont").find("iframe#nonImgLBx").attr("aria-hidden",!0)},download:function(revId){ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.comp.rl.dwnldrevlet")),Compensation.Utils.sendFormReqForExport(`/compensation/revisionletter/${revId}/download`,{})}},Compensation.SalRevision||(Compensation.SalRevision={});class SingleRecordView{constructor(){this.revidVsData={},this.SalComps={},this.approvalSettings=void 0,this.isApprStatusChanged=!1,this.approvalDetails=void 0}resetSalRevDtlObj(){this.revidVsData={},this.SalComps={},this.approvalSettings=void 0,this.isApprStatusChanged=!1,this.approvalDetails=void 0}showRevisionRecord(recordId,formId,closeCallback,disableUrlChng=!1){void 0==formId&&(Compensation.SalRevision.Operations.getFormDetails(),formId=Compensation.SalRevision.Operations.formDetails.formId);formId=formId||Compensation.SalRevision.Operations.formDetails.formId;this.disableUrlChng=disableUrlChng,this.showRevisionDetailedView(recordId,formId,closeCallback)}showCTCBkpDivAsPerPerms(modal,hasBreakupView,hasBenefitsView){hasBreakupView&&!hasBenefitsView&&(modal.find("#salRevBkpDiv #otherCompsDiv").hide(),modal.find("#salRevBkpDiv #ctcCompsDiv").show(),modal.find("#salRevBkpDiv #ctcTab").show().addClass("zpl_act"),modal.find("#salRevBkpDiv #othersTab").hide().removeClass("zpl_act")),hasBenefitsView&&!hasBreakupView&&(modal.find("#salRevBkpDiv #ctcCompsDiv").hide(),modal.find("#salRevBkpDiv #otherCompsDiv").show(),modal.find("#salRevBkpDiv #othersTab").show().addClass("zpl_act"),modal.find("#ctcTab").hide().removeClass("zpl_act")),hasBreakupView&&hasBenefitsView&&(modal.find("#salRevBkpDiv #ctcTab").addClass("zpl_act"),modal.find("#salRevBkpDiv #ctcCompsDiv").show(),modal.find("#salRevBkpDiv #otherCompsDiv").hide()),hasBreakupView||hasBenefitsView||modal.find("#ctcCompsDiv, #otherCompsDiv").hide()}static isEmpSalaryMyView(){return Layout.Page.hashDtl.secondLevelConfKey&&Layout.Page.hashDtl.secondLevelConfKey.includes("salarydetails-selfsalary")}fetchUrlToLoadOnCloseCB(){let urlParams=settingsUrlProps.urlParams,urlParamsArr=settingsUrlProps.urlParamsArr,isEmpMyView=SingleRecordView.isEmpSalaryMyView(),urlToLoad=settingsUrlProps.niceUrl.replace("/viewrevision","").replace("/view","");if(isEmpMyView)return urlToLoad+="-recordId:"+urlParamsArr.recordId,void(window.location.href="#"+urlToLoad);if(urlToLoad.includes("salaryrevision/approval"))window.location.href="#home/myspace/overview-approval";else{if(urlToLoad.includes("employeesalary")||urlToLoad.includes("salaryrevision")){if(!urlParamsArr.hasOwnProperty("viewId"))return urlToLoad+="/listview",void(window.location.href="#"+urlToLoad);urlToLoad+="/listview",urlToLoad+="-"+(urlParams=urlParams.replace(urlParams.substr(urlParams.indexOf("recordId:"),urlParams.indexOf("/")+1),""))}ZPUtil.isV5SettingsUrl()&&(urlParamsArr.hasOwnProperty("viewId")?(urlToLoad+="/listview",urlToLoad+="-"+(urlParams=urlParams.replace(urlParams.substr(urlParams.indexOf("recordId:"),urlParams.indexOf("/")+1),""))):urlToLoad+="/listview"),window.location.href="#"+urlToLoad}}getSalaryViewObj(viewType){let prop={selMode:"All"};return prop.viewType=viewType,Compensation.Salary.Operations.getViewObj(viewType,prop)}async showRevisionDetailedView(recordId,formId,closeCallback){var layout=settingsPage.container;let loader;layout.find("#zp_page_loading").length||(loader=0==layout.find("div.zpl_mcnt.zpl_comp_fm").length?new LoadingClass(layout):new LoadingClass(layout.find("div.zpl_mcnt.zpl_comp_fm"))).add(),Compensation.SalRevision.Operations.getSingleRevRecord(recordId).then(resultdata=>{if(ZP5Form.setSingleRecordDetail(resultdata,formId,recordId),this.approvalDetails=resultdata.approvalDetails,resultdata=resultdata.message.recordDetails[0],this.revidVsData[recordId]=resultdata,0==layout.find("#salaryRev_Dtls_view").length){const hiddenCallback=()=>{let niceUrl=settingsUrlProps.niceUrl;if(this.disableUrlChng||this.fetchUrlToLoadOnCloseCB(niceUrl),ZPUtil.Validation.isFunction(closeCallback)&&closeCallback(recordId),ZPeopleComponents.isComponent(modal.find("#revEffDatesSel"))&&ZPeopleComponents.select(modal.find("#revEffDatesSel")).destroy(),layout.find("#salaryRev_Dtls_view").remove(),this.isApprStatusChanged)if(-1!==niceUrl.indexOf("operations/salarydetails/salary"))Compensation.Utils.refreshPageForAction(Compensation.CONSTANTS.ACTIONTYPE.SALARY,this.revidVsData[recordId].erecno),this.getSalaryViewObj(Compensation.CONSTANTS.VIEWTYPE.OPER).refreshView();else{let salRevViewObj=Compensation.SalRevision.Operations.currViewObj;salRevViewObj&&(salRevViewObj.removeSalRevCountDivClasses(),salRevViewObj.viewType!=Compensation.CONSTANTS.VIEWTYPE.EMPVIEW&&salRevViewObj.loadSalRevData(void 0,void 0,void 0,!0,!1))}this.resetSalRevDtlObj()};var modal=ModuleComp.Modal.setup({id:"salaryRev_Dtls_view",type:1,backdrop:!0,closeOnSubmit:!1,modalClass:"zpl_mfull zpl_ntzindx",whitebtnvalue:ZPI18N.getString("zp.close"),disableSubmitButton:!0,closeonEsc:!0,hiddenCallback:hiddenCallback});this.constructSalRevDetailedViewBody(modal,recordId,formId,closeCallback)}else{let modal=layout.find("#salaryRev_Dtls_view");modal.attr("recordId",recordId);var recordIdDetails=resultdata,empObjDtls=ZPeople.getUserDetailsById(recordIdDetails.erecno);this.constCompsBreakupViewTable(recordIdDetails);let salPkgNameForRev=Compensation.Config.isTempEnabled&&void 0!==recordIdDetails.Template?ZSEC.Encoder.encodeForHTML(recordIdDetails.Template):"";var isPackAssociated=!1;Compensation.Config.isTempEnabled&&(""!=salPkgNameForRev?isPackAssociated=!0:salPkgNameForRev=ZPI18N.getString("zp.notapplicable")),this.constructSalRevApprovalHeader(recordId,formId,recordIdDetails.isRecordApprover,recordIdDetails.isPrimaryAppr,recordIdDetails.isRecordAdmin,modal),modal.find("#salRevBkpDiv").show(),modal.find("#otherCompsDiv #noBefTr").length&&modal.find("#otherBenTotalDisp").addClass("DNI"),modal.find("#emplImg").attr("src",empObjDtls.avatar),modal.find("#emplId").text(empObjDtls.empid),modal.find("#emplName").text(empObjDtls.name),modal.find("#emplDesgn").text(empObjDtls.designation),modal.find("#emplExp").text(recordIdDetails.empExp),modal.find("#curSalFmt").text(recordIdDetails.Current_Salary_fmt),modal.find("#revSalFmt").text(recordIdDetails.Revised_Salary_fmt),modal.find("span#revPec").text(recordIdDetails.Revised_Percentage),modal.find("#revAmtFmt").text(recordIdDetails.Revised_Amount_fmt),modal.find("#revPackage").text(salPkgNameForRev),modal.find("#revEffDate").text(recordIdDetails.Effective_Date),modal.find("#revReason").text(ZSEC.Encoder.encodeForHTML(recordIdDetails.Reason)),modal.find("#revStatus").text(ZSEC.Encoder.encodeForHTML(recordIdDetails.Revision_Status)),recordIdDetails.isApprovalEnabled&&modal.find("#apprStatus").text(ZSEC.Encoder.encodeForHTML(recordIdDetails.approvalStatus)),modal.find("#revRemarks").text(recordIdDetails.Remarks),modal.find("#lastModifiedOn").text(recordIdDetails.modifiedTimeOn),Compensation.Config.isTempEnabled&&(recordIdDetails.showBreakup||recordIdDetails.showBenefits)&&isPackAssociated?(modal.find("#ctcTab").addClass("zpl_act").siblings().removeClass("zpl_act"),this.showCTCBkpDivAsPerPerms(modal,recordIdDetails.showBreakup,recordIdDetails.showBenefits),modal.find("#ctcCompsTbody").html(this.SalComps.ctcCompsListHtml),modal.find("#ctcCompsTotalDisp th:nth-child(2)").text(this.SalComps.ctcCompsTotalRevMonthly),modal.find("#ctcCompsTotalDisp th:nth-child(3)").text(this.SalComps.ctcCompsTotalRevAnnually),modal.find("#otherCompsTbody").html(this.SalComps.otherBenefitsListHtml),modal.find("#otherBenTotalDisp th:nth-child(2)").text(this.SalComps.otherBenTotalRevMonthly),modal.find("#otherBenTotalDisp th:nth-child(3)").text(this.SalComps.otherBenTotalRevAnnually)):modal.find("#salRevBkpDiv").hide(),recordIdDetails.isAllowedToCancel?modal.find("#zp_modal_whitebtn_cancelRev").removeClass("DN"):modal.find("#zp_modal_whitebtn_cancelRev").addClass("DN")}loader&&loader.remove()})}canshowsrc(src){const SRC=Compensation.SalRevision.Operations.SRC;return src==SRC.PAYROLL||src==SRC.RECRUIT||src==SRC.PMS_IMPORT||src==SRC.PMS_HIKE}constructSalRevDetailedViewBody(modal,recordId,formId,closeCallback){modal.attr("recordId",recordId);var recordIdDetails=this.revidVsData[recordId],empObjDtls=ZPeople.getUserDetailsById(recordIdDetails.erecno);this.constCompsBreakupViewTable(recordIdDetails);let salPkgNameForRev=Compensation.Config.isTempEnabled&&void 0!==recordIdDetails.Template?ZSEC.Encoder.encodeForHTML(recordIdDetails.Template):"";var isPackAssociated=!1;let isSampleData=!!recordIdDetails.isSampleData&&recordIdDetails.isSampleData;Compensation.Config.isTempEnabled&&(""!=salPkgNameForRev?isPackAssociated=!0:salPkgNameForRev=ZPI18N.getString("zp.notapplicable"));var salRevPopupBody='<div class="zpl_crd" style="max-width: initial;margin-right:30px;width:auto" aria-hidden="true">\n\t\t\t\t\t\t\t\t\t<div class="zpl_crdcnt">\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="zpl_secn w400">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="zpl_em">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="zpl_emimg"><img id="emplImg" src='+empObjDtls.avatar+'></div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="d-flexclmcap5 flex-dirC"><div><em id="emplId">'+empObjDtls.empid+'</em> - <b id="emplName">'+empObjDtls.name+`</b>${isSampleData?"<span class='zbadges zbadges--green zpl_ml2' id='sample_data_badge'>Sample Data</span>":""}</div><div>${""!==empObjDtls.designation?`<em id="emplDesgn">${empObjDtls.designation}</em><em> - </em>`:""}<em id="emplExp">${recordIdDetails.empExp}</em></div></div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div name="sections_obj" class="zpl_frmclmview zpl_secn">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="zpl_secn zpl_fw" isallowed="true">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label>${ZPI18N.getString("zp.local.currentsalary")}</label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t                        \t\t\t\t\t\t\t\t\t<span id="curSalFmt">${recordIdDetails.Current_Salary_fmt}</span>\n\t                    \t\t\t\t\t\t\t\t\t</div>\n\t                    \t\t\t\t\t\t\t\t</div>\n\t                    \t\t\t\t\t\t\t\t<div class="zpl_secn zpl_fw" isallowed="true">\n\t                    \t\t\t\t\t\t\t\t\t<div>\n\t                    \t\t\t\t\t\t\t\t\t\t<label>${ZPI18N.getString("zp.local.revisedsalary")}</label>\n\t                    \t\t\t\t\t\t\t\t\t</div>\n\t                    \t\t\t\t\t\t\t\t\t<div>\n\t                    \t\t\t\t\t\t\t\t\t\t<span id="revSalFmt">${recordIdDetails.Revised_Salary_fmt}</span>\n\t                    \t\t\t\t\t\t\t\t\t</div>\n\t                    \t\t\t\t\t\t\t\t</div>\n\t                    \t\t\t\t\t\t\t\t<div class="zpl_secn zpl_fw" isallowed="true">\n\t                    \t\t\t\t\t\t\t\t\t<div>\n\t                    \t\t\t\t\t\t\t\t\t\t<label>${ZPI18N.getString("zp.compensation.revSalVariation")}</label>\n\t                    \t\t\t\t\t\t\t\t\t</div>\n\t                    \t\t\t\t\t\t\t\t\t<div>\n\t                        \t\t\t\t\t\t\t\t\t<span><span id="revAmtFmt">${recordIdDetails.Revised_Amount_fmt}</span><em> - </em><span id="revPec">${recordIdDetails.Revised_Percentage}</span><em> %</em></span>\n\t                    \t\t\t\t\t\t\t\t\t</div>\n\t                    \t\t\t\t\t\t\t\t</div>`;Compensation.Config.isTempEnabled&&(salRevPopupBody+=`<div class="zpl_secn zpl_fw" isallowed="true">\n\t                    \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t                        \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label>${ZPI18N.getString("zp.compensation.SalaryPackage")}</label>\n\t                    \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t                    \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t                        \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span id="revPackage">${salPkgNameForRev}</span>\n\t                    \t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t                    \t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>`),salRevPopupBody+=`<div class="zpl_secn zpl_fw" isallowed="true">\n\t                    \t\t\t\t\t\t\t\t\t<div>\n\t                    \t\t\t\t\t\t\t\t\t\t<label>${ZPI18N.getString("zp.leavetype.v2.entitlement.effectivefrom")}</label>\n\t                    \t\t\t\t\t\t\t\t\t</div>\n\t                    \t\t\t\t\t\t\t\t\t<div>\n\t                        \t\t\t\t\t\t\t\t\t<span id="revEffDate">${recordIdDetails.Effective_Date}</span>\n\t                    \t\t\t\t\t\t\t\t\t</div>\n\t                    \t\t\t\t\t\t\t\t</div>`,recordIdDetails.isApprovalEnabled&&(salRevPopupBody+=`<div class="zpl_secn zpl_fw" isallowed="true">\n\t                    \t\t\t<div>\n\t                    \t\t\t\t<label>${ZPI18N.getString("zp.approvalstatus")}</label>\n\t                    \t\t\t</div>\n\t                    \t\t\t<div>\n\t                    \t\t\t\t<span id="apprStatus">${ZSEC.Encoder.encodeForHTML(recordIdDetails.approvalStatus)}</span>\n\t                    \t\t\t</div>`),salRevPopupBody+=`</div>\n\t\t                    <div id="salRevMoreDiv">\n\t\t                    \t<div class="zpl_secn zpl_fw" isallowed="true">\n\t                    \t\t\t<div>\n\t                        \t\t\t<label>${ZPI18N.getString("zp.remarks")}</label>\n\t                    \t\t\t</div>\n\t                    \t\t\t<div>\n\t                        \t\t\t<span id="revRemarks">${recordIdDetails.Remarks}</span>\n\t                    \t\t\t</div>\n\t                    \t\t</div>\n\t                    \t\t<div class="zpl_secn zpl_fw" isallowec="true">\n\t                    \t\t\t<div>\n\t                        \t\t\t<label>${ZPI18N.getString("zp.compensation.LastModifiedOn")}</label>\n\t                    \t\t\t</div>\n\t                    \t\t\t<div>\n\t                        \t\t\t<span id="lastModifiedOn">${recordIdDetails.modifiedTimeOn}</span>\n\t                    \t\t\t</div>\n\t                    \t\t</div>\n\t                    \t\t<div class="zpl_secn zpl_fw" isallowed="true">\n\t                    \t\t\t<div>\n\t                        \t\t\t<label>${ZPI18N.getString("zp.compensation.reasonforRevision")}</label>\n\t                    \t\t\t</div>\n\t                    \t\t\t<div>\n\t                        \t\t\t<span id="revReason">${ZSEC.Encoder.encodeForHTML(recordIdDetails.Reason)}</span>\n\t                    \t\t\t</div>\n\t                \t\t\t</div>\n\t                \t\t\t<div class="zpl_secn zpl_fw" isallowed="true">\n\t                    \t\t\t<div>\n\t                        \t\t\t<label>${ZPI18N.getString("zp.compensation.RevisionStatus")}</label>\n\t                    \t\t\t</div>\n\t                    \t\t\t<div>\n\t                        \t\t\t<span id="revStatus">${ZSEC.Encoder.encodeForHTML(recordIdDetails.Revision_Status)}</span>\n\t                    \t\t\t</div>\n\t                \t\t\t</div>\n\t\t\t\t\t\t\t\t${Compensation.PermissionBean.getPermBean().isConsideredDataAdmin&&Compensation.Config.configObj.isSalarySyncEnabled?`<div class="zpl_secn zpl_fw" isallowed="true"><div><label>${ZPI18N.getString("zp.comp.payroll.payrollpushstatus")}</label></div><div><span id="revStatus">${ZSEC.Encoder.encodeForHTML(recordIdDetails.PayrollPushStatus)}</span></div></div>`:""}\t\t\t\t\t\t\t\n\t                \t\t</div>\n\t                \t\t<div class="MT10">\n\t                       \t\t<span class="d-flex fdCmnt_actn">\n\t                        \t\t<a data-popup-open="" id="lessOptn" style="display: none;">${ZPI18N.getString("zp.compensation.revision.less")}</a>\n\t                        \t\t<a data-popup-open="" id="moreOptn" style="">${ZPI18N.getString("zp.more")}</a>\n\t                     \t\t</span>\n\t                    \t</div>\n\t                \t</div>\n\t          \t\t</div>`,salRevPopupBody+=`<div id="salRevBkpDiv" class="zpl_hdcnt">\n\t                        \t<ul class="zpl_tabpane">\n\t                        \t\t<li id="ctcTab" class="zpl_act">\n\t                        \t\t\t<a>\n\t                        \t\t\t${ZPI18N.getString("zp.componentPage.Title")}\n\t                        \t\t\t</a>\n\t                        \t\t</li>\n\t                        \t\t<li id="othersTab">\n\t                        \t\t\t<a>${ZPI18N.getString("zp.compensation.Benefits")}</a>\n\t                        \t\t</li>\n\t                        \t</ul>\n\t                        \t<div class="zpl_secn zpl_tblres" id="ctcCompsDiv" style="">\n\t                        \t\t<table id ="ctcCompsTbl" class="zpl_tbl wd100_per">\n\t                        \t\t\t<thead>\n\t                        \t\t\t\t<tr>\n\t                        \t\t\t\t\t<th width="32%">\n\t                        \t\t\t\t\t\x3c!--${ZPI18N.getString("zp.componentPage.Title")}--\x3e\n\t                        \t\t\t\t\t${ZPI18N.getString("zp.comp.salary.component")}\n\t                        \t\t\t\t\t</th>\n\t                        \t\t\t\t\t<th width="20%">${ZPI18N.getString("zp.compensation.RevisedMonthly")}</th>\n\t                        \t\t\t\t\t<th width="20%">${ZPI18N.getString("zp.compensation.RevisedAnnual")}</th>\n\t                        \t\t\t\t</tr>\n\t                        \t\t\t</thead>\n\t                        \t\t\t<tbody id="ctcCompsTbody">${this.SalComps.ctcCompsListHtml}</tbody>\n\t                        \t\t\t<tfoot id="ctcCompsTotalDisp">`+`<tr>\n\t                        \t\t\t\t\t<th>${ZPI18N.getString("zp.total")}</th>\n\t                        \t\t\t\t\t<th>${this.SalComps.ctcCompsTotalRevMonthly}</th>\n\t                        \t\t\t\t\t<th>${this.SalComps.ctcCompsTotalRevAnnually}</th>\n\t                        \t\t\t\t</tr>\n\t                        \t\t\t</tfoot>\n\t                        \t\t</table>\n\t                        \t</div>\n\t                        \t<div class="zpl_secn zpl_tblres" id="otherCompsDiv" style="display: none;">\n\t                        \t\t<table id ="otherCompsTbl" class="zpl_tbl wd100_per">\n\t                        \t\t\t<thead>\n\t                        \t\t\t\t<tr>\n\t                        \t\t\t\t\t<th width="32%">\n\t                        \t\t\t\t\t\x3c!--${ZPI18N.getString("zp.componentPage.Title")}--\x3e\n\t                        \t\t\t\t\t${ZPI18N.getString("zp.comp.benefits.component")}\n\t                        \t\t\t\t\t</th>\n\t                        \t\t\t\t\t<th width="20%">${ZPI18N.getString("zp.compensation.RevisedMonthly")}</th>\n\t                        \t\t\t\t\t<th width="20%">${ZPI18N.getString("zp.compensation.RevisedAnnual")}</th>\n\t                        \t\t\t\t</tr>\n\t                        \t\t\t</thead>\n\t                        \t\t\t<tbody id="otherCompsTbody">${this.SalComps.otherBenefitsListHtml}</tbody>\n\t                        \t\t\t<tfoot id="otherBenTotalDisp">`+`<tr>\n\t                        \t\t\t\t\t<th>${ZPI18N.getString("zp.total")}</th>\n\t                        \t\t\t\t\t<th>${this.SalComps.otherBenTotalRevMonthly}</th>\n\t                        \t\t\t\t\t<th>${this.SalComps.otherBenTotalRevAnnually}</th>\n\t                        \t\t\t\t</tr>\n\t                        \t\t\t</tfoot>\n\t                        \t\t</table>\n\t                        \t</div>\n\t                \t\t</div>\n\t                \t</div>`,settingsPage.container.find("#zp_modal_header").text(ZPI18N.getString("zp.compensation.SalaryRevisionView")),settingsPage.container.find(".zpl_mcnt.zpl_fm").removeClass("zpl_fm").addClass("zpl_comp_fm flex-dirC"),modal.find("div.zpl_mcnt.zpl_comp_fm").html(salRevPopupBody),modal.find("#salRevMoreDiv").toggle(),settingsPage.container.find("#zp_modal_header").parent().addClass("zpl_mhicn"),Compensation.Config.isTempEnabled&&(recordIdDetails.showBreakup||recordIdDetails.showBenefits)&&isPackAssociated||modal.find("#salRevBkpDiv").hide(),modal.find("#otherCompsDiv #noBefTr").length&&modal.find("#otherBenTotalDisp").addClass("DNI"),settingsPage.container.find("#zp_modal_whitebtn").before('<button type="button" class="zlabel zlabel--blue zlabel--medium DN" id="zp_modal_whitebtn_editRev">'+ZPI18N.getString("zp.edit")+'</button><button type="button" class="zlabel zlabel--medium zlabel--red DN" id="zp_modal_whitebtn_cancelRev">'+ZPI18N.getString("zp.compensation.CancelRevision")+"</button>");let fEle=$(settingsPage.container.find("#zp_modal_whitebtn").parents("div.zpl_mfoter")),fDivEle=$(`<div class="zpl_frm_mfoter">${fEle.html()}</div>`);fEle.html(fDivEle),Compensation.Utils.isCompensationForm()&&settingsPage.container.find("#zp_modal_header").after('<select id="revEffDatesSel" data-width="250"></select>');const dfOptnsHtml=this.getOtherRevDates(recordId,recordIdDetails.erecno,recordIdDetails.Effective_Date),revEffDatesSel=settingsPage.container.find("#revEffDatesSel").html(dfOptnsHtml);ZPeopleComponents.isComponent(modal.find("#revEffDatesSel"))&&ZPeopleComponents.select(modal.find("#revEffDatesSel")).destroy(),ZPeopleComponents.select(revEffDatesSel,{dropdownList:{appendTo:modal,bodyItemVisibleCount:5},showSearchField:!0,change:(event,data)=>{this.resetSalRevDtlObj(),this.getUpdateRevisionDetails(event.detail.selectedValue,data)}}),recordIdDetails.src&&this.canshowsrc(recordIdDetails.src)&&settingsPage.container.find("#zp_modal_header").parent("div").append(`<div id="compSampleBadge"><span class="zbadges zbadges--green zpl_ml2" id="src_badge">${recordIdDetails.src_txt}</span></div>`);var showCancelBtn=recordIdDetails.isAllowedToCancel;showCancelBtn&&8==recordIdDetails.Revision_StatusInt&&modal.find("#zp_modal_whitebtn_editRev").removeClass("DN"),showCancelBtn&&modal.find("#zp_modal_whitebtn_cancelRev").removeClass("DN");let rDivHtml='<div class="zpl_mhderrgt">';recordIdDetails.isApprovalEnabled&&(rDivHtml+='<div id="headerApprovalBtn"></div>'),rDivHtml+='<a id="revCreateInfo" class="PI_info zpl_btnic " data-menu-id="recordInfo"></a></div>',$(rDivHtml).insertBefore(modal.find(".zpl_mhder .PI_cls")),this.constructRecTimeInfo(modal,recordId),this.constructSalRevApprovalHeader(recordId,formId,recordIdDetails.isRecordApprover,recordIdDetails.isPrimaryAppr,recordIdDetails.isRecordAdmin,modal),modal.find("#lessOptn, #moreOptn").off("click"),modal.find("#lessOptn, #moreOptn").on("click",function(){$(this).hide().siblings().show(),"moreOptn"==$(this).attr("id")?modal.find("#salRevMoreDiv").show():modal.find("#salRevMoreDiv").hide()});const revData=this.revidVsData[recordId],hasBreakupView=revData.showBreakup,hasBenefitsView=revData.showBenefits;this.showCTCBkpDivAsPerPerms(modal,hasBreakupView,hasBenefitsView),modal.find("#salRevBkpDiv #ctcTab").on("click",function(){modal.find(this).addClass("zpl_act").siblings().removeClass("zpl_act"),modal.find("#salRevBkpDiv #ctcCompsDiv").show(),modal.find("#salRevBkpDiv #otherCompsDiv").hide()}),modal.find("#salRevBkpDiv #othersTab").on("click",function(){modal.find(this).addClass("zpl_act").siblings().removeClass("zpl_act"),modal.find("#salRevBkpDiv #ctcCompsDiv").hide(),modal.find("#salRevBkpDiv #otherCompsDiv").show()}),modal.find("#zp_modal_whitebtn_cancelRev").on("click",()=>{ModuleComp.Modal.delete(()=>{settingsUrlProps.niceUrl;let isEmpMyView=SingleRecordView.isEmpSalaryMyView();recordId=modal.attr("recordId"),recordId=isEmpMyView?settingsUrlProps.urlParamsArr.revId?settingsUrlProps.urlParamsArr.revId:recordId:settingsUrlProps.urlParamsArr.recordId?settingsUrlProps.urlParamsArr.recordId:recordId;var params={conreqcsr:csrfToken,revId:recordId};ZPeople.Request.send("/compensation/revisions/cancel",params,resultdata=>{if(resultdata.hasError){let errMsg=resultdata.errMsg;ModuleComp.Msg.showFailureMsg(errMsg)}else{if(recordIdDetails.isApprovalEnabled){OPApprovals.refreshApprovalData(recordId);let formId=Compensation.SalRevision.Operations.formDetails?Compensation.SalRevision.Operations.formDetails.formId:resultdata.formId;this.constructSalRevApprovalHeader(recordId,formId,recordIdDetails.isRecordApprover,!1,recordIdDetails.isRecordAdmin,modal,zpconst.ApprovalStatus.Cancelled)}ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.compensation.successMsg.revCancelled")),this.changeApprStatus(recordId,zpconst.ApprovalStatus.Cancelled,OPApprovals.getStatusText(zpconst.ApprovalStatus.Cancelled,"P_SalaryRevision"))}})},ZPI18N.getString("zp.compensation.cancelWarningTitle"),ZPI18N.getString("zp.compensation.warningMsg.cancelRevision"),void 0,"",void 0,void 0)}),modal.find("#zp_modal_whitebtn_editRev").on("click",function(){Compensation.Salary.Operations.editRev(recordIdDetails.isAddRec?"add":"update",recordIdDetails)})}constructRecTimeInfo(container,recordId){let recordIdDetails=this.revidVsData[recordId];if(0==container.find("#"+recordId+"recordInfo").length){let popover=`<div id="${recordId}recordInfo" class="zpl_popovr zpopover" data-display-type="box" data-type="popover" aria-haspopup="true" aria-expanded="false" tabindex="0" style="display: none; left: 987px; top: -8px;"></div>`;container.append(popover),container.find("#revCreateInfo").off("click").on("click",function(event){let target=$(event.target),infoTypes={cInfo:["Added",ZPI18N.getString("zp.reports.createdby")],mInfo:["Modified",ZPI18N.getString("zp.modifiedby")]},infoObject=recordIdDetails.auditInfo,infoContainer='<div class="zpopover__content"><div class="zpl_recinfo" id = "infoContainer">';$.each(infoTypes,(key,value)=>{let obj={};if(infoObject[value[0]+"Time"]&&(obj.time=infoObject[key].time,obj.hasInfo=!0),infoObject[value[0]+"By"]&&(obj.id=ZSEC.Encoder.encodeForHTML(infoObject[key].user.id),obj.name=ZSEC.Encoder.encodeForHTML(infoObject[key].user.name),obj.image="/viewPhoto?erecno="+infoObject[key].user.ERECNO,void 0===infoObject[key].user.photopath||""==infoObject[key].user.photopath?obj.image=contactUrl+"/file?ID="+infoObject[key].user.zuid+"&fs=thumb":"null"!=contextPath&&(obj.image="/"+contextPath+obj.image),obj.hasInfo=!0,obj.dispName=obj.id+" - "+obj.name),!obj.hasInfo)return;obj.dispName=void 0!==obj.dispName?obj.dispName:"";let div=`\n\t                    <label class="lbldivider"><span><em>${value[1]}</em></span></label>\n\t                    <div class="zpl_em">\n\t                        <div class="zpl_emimg">\n\t                            ${void 0!==obj.image?"<img src='"+obj.image+"'>":"<span class='zpl_pichr'></span>"}\n                            </div>\n\t                        <div class="zpl_emdts zpl_ellipsis w200">\n\t                            <div title = "${obj.dispName}"><em>${void 0!==obj.id?obj.id+" - ":""}</em><b>${void 0!==obj.name?obj.name:""}</b></div>\n\t                            <div class="d-flexclmcap10">`+"<em><date>"+`${void 0!==obj.time?obj.time:""}</date></em>\n\t                            </div>\n\t                        </div>\n\t                    </div>\n\t                `;infoContainer+=div}),infoContainer+="</div></div>",container.find("#"+recordId+"recordInfo").html(infoContainer),ZPeopleComponents.popover("#"+recordId+target.data("menuId"),{open:()=>{target.addClass("zpl_act")},close:()=>{target.removeClass("zpl_act")}}).open({forElement:target})})}container.find("#revCreateInfo").removeClass("zpl_DNI")}setApprovalDtls(recordId,formId,modal){let recordIdDetails=this.revidVsData[recordId];ZPForm.LAYOUT=modal,recordIdDetails.isApprovalEnabled&&(ZPForm.CURRFORM_PARAM={},ZPApprovals.FORMID=formId,ZPApprovals.OPERATIONS=!0,ZPApprovals.RECORDID=recordId,ZPForm.CURRFORM_PARAM.formId=formId,ZPForm.CURRFORM_PARAM.recordId=recordId,ZPForm.CURRFORM_PARAM.tableName=Compensation.CONSTANTS.SALARY_REVISION_TABLE_NAME,ZPForm.FormFieldAllowedRoleIdsForAdd=[],this.approvalSettings||ZPApprovals.fetchApprovalSettings(formId,!1,data=>{this.approvalSettings=data}),this.constructSalRevApprovalHeader(recordId,formId,recordIdDetails.isRecordApprover,recordIdDetails.isPrimaryAppr,recordIdDetails.isRecordAdmin))}constructSalRevApprovalHeader(recordId,formId,isRecordApprover,isPrimaryAppr,isRecordAdmin,modal,apprStatus){this.revidVsData[recordId];let approvalDtls=this.approvalDetails;if(!approvalDtls)return;apprStatus&&(approvalDtls.currentApprovalStatus=apprStatus);let recordOwners=[approvalDtls.recordowner.erecno];OPApprovals.Common.RecordOwner.setOwner(recordId,recordOwners),OPApprovals.Common.RecordOwner.setAddedBy(recordId,approvalDtls.recOwner);let apprParam=new ApprovalParam(formId,recordId,Compensation.CONSTANTS.SALARY_REVISION_TABLE_NAME,approvalDtls.currentApprovalStatus,isRecordAdmin),layoutParam=new LayoutParam(modal,void 0,void 0,"COMPENSATION");new ApprovalRecordHeader(apprParam,layoutParam,{isRecordApprover:isRecordApprover,isPrimaryApprover:isPrimaryAppr}).show()}constCompsBreakupViewTable(recordIdDetails){let revBreakupCompsArray=recordIdDetails.revisionBreakupComps,decimalPlace=Compensation.Utils.getDecimalPlaces();if(!revBreakupCompsArray||0==revBreakupCompsArray.length)return;let ctcCompsListHtml="",otherBenefitsListHtml="",ctcCompsTotalRevMonthly=0,ctcCompsTotalRevAnnually=0,otherBenTotalRevMonthly=0,otherBenTotalRevAnnually=0;revBreakupCompsArray.forEach(revBreakupObj=>{let revMonthly=0;revBreakupObj.payFreqId===Compensation.components.PAYFREQ_MONTHLY&&(revMonthly=Compensation.Utils.getRoundOffValue(revBreakupObj.calcAmt/12,decimalPlace)),revBreakupObj.partOfCTC?(ctcCompsTotalRevMonthly+=revMonthly,ctcCompsTotalRevAnnually+=Compensation.Utils.getRoundOffValue(revBreakupObj.calcAmt,decimalPlace),ctcCompsListHtml+=this.getListHtml(revBreakupObj)):(otherBenTotalRevMonthly+=revMonthly,otherBenTotalRevAnnually+=Compensation.Utils.getRoundOffValue(revBreakupObj.calcAmt,decimalPlace),otherBenefitsListHtml+=this.getListHtml(revBreakupObj))}),""===otherBenefitsListHtml&&(otherBenefitsListHtml='<tr id="noBefTr">\n\t\t\t\t\t\t\t\t\t\t\t<td colspan="5" style="text-align: center;">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="zpl_Emptydata">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="zpl_emptimg zp_nd_nodata1" style="width: 140px;height: 120px;margin: auto;display: block;margin-bottom: 5px;"></div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>'+ZPI18N.getString("zp.compensation.revision.noBenefitsTagged")+"</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t</tr>"),this.SalComps.ctcCompsListHtml=ctcCompsListHtml,this.SalComps.otherBenefitsListHtml=otherBenefitsListHtml,this.SalComps.ctcCompsTotalRevMonthly=Compensation.Utils.getRoundOffValue(ctcCompsTotalRevMonthly,decimalPlace),this.SalComps.otherBenTotalRevMonthly=Compensation.Utils.getRoundOffValue(otherBenTotalRevMonthly,decimalPlace),this.SalComps.ctcCompsTotalRevAnnually=Compensation.Utils.getRoundOffValue(ctcCompsTotalRevAnnually,decimalPlace),this.SalComps.otherBenTotalRevAnnually=Compensation.Utils.getRoundOffValue(otherBenTotalRevAnnually,decimalPlace)}getListHtml(revBreakupObj){let decimalPlace=Compensation.Utils.getDecimalPlaces(),revMonthly=revBreakupObj.payFreqId===Compensation.components.PAYFREQ_MONTHLY?Compensation.Utils.getRoundOffValue(revBreakupObj.calcAmt/12,decimalPlace).toFixed(decimalPlace):"-";return"<tr>\n\t\t\t\t\t\t<td>"+ZSEC.Encoder.encodeForHTML(revBreakupObj.Component_Name)+`${revBreakupObj.Component_Code==Compensation.components.FIXED_ALLOWANCE?`<i class="PI_info tooltip-js" data-title-position="right" data-html="true" title="${ZPI18N.getString("zp.compensation.fixedallowance.toolTipmsg")}"></i>`:""}</td>`+"<td>"+revMonthly+"</td>\n\t\t\t\t\t\t<td>"+Compensation.Utils.getRoundOffValue(revBreakupObj.calcAmt,decimalPlace).toFixed(decimalPlace)+"</td>\n\t\t\t\t\t</tr>"}getUpdateRevisionDetails(recId,data){let url=settingsUrlProps.url,niceUrl=settingsUrlProps.niceUrl;url=SingleRecordView.isEmpSalaryMyView()?niceUrl+"-recordId:"+settingsUrlProps.urlParamsArr.recordId+"/revId:"+recId:url.replace("recordId:"+settingsUrlProps.urlParamsArr.recordId,"recordId:"+recId),window.location.href="#"+url}getOtherRevDates(recordId,erecNum,currRcdEffDate){var optns="",recordIdDetails=this.revidVsData[recordId],processedRevDates=recordIdDetails.allProcessedRevDates;optns=""===recordIdDetails.revId?'<option value=""></option>':"<option value="+recordId+' erecnum="'+erecNum+'">'+currRcdEffDate+"</option>";for(let i=0;i<processedRevDates.length;i++)processedRevDates[i].revId!==recordId&&(optns+=`<option value='${processedRevDates[i].revId}' erecnum='${processedRevDates[i].erecno}'>${processedRevDates[i].revEffDate}</option>`);return optns}changeApprStatus(recId,statusId,approvalStatus){let layout=settingsPage.container,revIdJson=this.revidVsData[recId];if(void 0!=revIdJson&&0!=Object.keys(revIdJson).length&&(revIdJson.approvalStatus=approvalStatus,statusId!=zpconst.ApprovalStatus.Rejected&&statusId!=zpconst.ApprovalStatus.Cancelled||(layout.find("#zp_modal_whitebtn_cancelRev").addClass("DN"),revIdJson.Revision_Status=approvalStatus)),Layout.Page.pageContWrapper.find("#rev-listtbody tr#revTable_"+recId+" td[name=status]").html(OPApprovals.getApprovalIcon(statusId,!0,Compensation.CONSTANTS.SALARY_REVISION_TABLE_NAME)),statusId==zpconst.ApprovalStatus.Approved||statusId==zpconst.ApprovalStatus.Rejected||statusId==zpconst.ApprovalStatus.Cancelled){let revStatus=statusId==zpconst.ApprovalStatus.Approved?ZPI18N.getString("zp.processed"):approvalStatus;Layout.Page.pageContWrapper.find("#rev-listtbody tr#revTable_"+recId+" td[name=revisionStatus]").html("<span>"+revStatus+"</span>")}statusId==zpconst.ApprovalStatus.Approved?layout.find("span#revStatus").text(ZSEC.Encoder.encodeForHTML(ZPI18N.getString("zp.processed"))):statusId!=zpconst.ApprovalStatus.Rejected&&statusId!=zpconst.ApprovalStatus.Cancelled||layout.find("span#revStatus").text(ZSEC.Encoder.encodeForHTML(approvalStatus)),layout.find("span#apprStatus").text(ZSEC.Encoder.encodeForHTML(approvalStatus)),statusId!=zpconst.ApprovalStatus.Approved&&statusId!=zpconst.ApprovalStatus.Cancelled||(Compensation.Utils.refreshPageForAction(Compensation.CONSTANTS.ACTIONTYPE.REVISION,revIdJson.erecno),this.cancelRevCb&&_.isFunction(this.cancelRevCb)&&this.cancelRevCb()),this.isApprStatusChanged=!0}}Compensation.SalRevision.Operations={viewObj:{},currViewObj:void 0,Revision_Status:{1:"zp.pending",3:"zp.processed",4:"zp.rejected",5:"zp.cancelled"},PayrollPushStatus:{0:"zp.notpushed",1:"zp.inprogress",2:"zp.pushed",3:"zp.approved",4:"zp.rejected",6:"zp.comp.payroll.errinpayroll",7:"zp.updated",8:"zp.deleted"},SRC:{PAYROLL:9,RECRUIT:8,PMS_HIKE:4,PMS_IMPORT:6},revidVsData:{},salRevsAccessYears:[],singleRcdViewObj:new SingleRecordView,getSingleRevRecord:function(recordId){if(void 0==Compensation.SalRevision.Operations.revidVsData||!Compensation.SalRevision.Operations.revidVsData.hasOwnProperty(recordId)){var params={conreqcsr:csrfToken,revId:recordId};return Compensation.Utils.sendReqAsPromise("/compensation/revisions/getsinglerecord",params)}},getViewObj:function(viewType,prop){let viewObj=Compensation.SalRevision.Operations.viewObj,salRevViewObj=viewObj[viewType]?viewObj[viewType]:new SalRevisionView(prop);return viewObj[viewType]=salRevViewObj,salRevViewObj},getFormDetails:function(){Compensation.Utils.getFormDetails.call(Compensation.SalRevision.Operations,"RevisionForm")},setModPrefix:function(){return{modulePrefix:Compensation.CONSTANTS.SERVICENAME+"-revision-listview",submode:Compensation.CONSTANTS.SERVICENAME+"-revision-listview"}},getSalRevViewObj:function(niceUrl){let viewType,prop={};return-1!=niceUrl.indexOf("operations/salarydetails/revision")?(prop.isFromOpr=!0,viewType=Compensation.CONSTANTS.VIEWTYPE.OPER,prop.viewType=viewType):-1!=niceUrl.indexOf("salarydetails/salaryrevision")&&(prop.isFromOpr=!1,viewType=Compensation.CONSTANTS.VIEWTYPE.OTHERS,prop.viewType=viewType),Compensation.SalRevision.Operations.getViewObj(viewType,prop)},init:function(){Compensation.Utils.getZCompMethods(),Compensation.Config.getConfiguration_asSync(!1),Compensation.SalRevision.Operations.getFormDetails()},initialListView:function(){Compensation.SalRevision.Operations.init();let prop={selMode:"All",isFromOpr:!0};const viewType=Compensation.CONSTANTS.VIEWTYPE.OPER;prop.viewType=viewType;let salRevOprViewObj=Compensation.SalRevision.Operations.getViewObj(viewType,prop);return Compensation.SalRevision.Operations.currViewObj=salRevOprViewObj,{wrapperClass:"Nbar5",dataCallback:()=>{salRevOprViewObj.constructSalRevView()},onchangeCallback:isSystemView=>{salRevOprViewObj.onViewSwitchCallback(isSystemView)},formId:Compensation.SalRevision.Operations.formDetails.formId,formLoadCallback:()=>{salRevOprViewObj.constructView()},systemViewName:Compensation.SalRevision.Operations.formDetails.formDispName,tableName:Compensation.SalRevision.Operations.formDetails.tableName,importExportConstructionCallback:()=>{salRevOprViewObj.constructImpExp()}}},initEmpRevView:function(userId,onInitLoadCallback,cancelRevCb){$("#page-wrapper").addClass("zpl_btmpgn"),settingsUrlProps.currentMode=Compensation.CONSTANTS.TAB_NAME;let prop={selMode:"Team"};const viewType=Compensation.CONSTANTS.VIEWTYPE.EMPVIEW;prop.viewType=viewType,prop.selUsr=userId,prop.onInitLoadCallback=onInitLoadCallback,prop.cancelRevCb=cancelRevCb;let salRevTeamViewObj=new SalRevisionView(prop);if(Compensation.SalRevision.Operations.currViewObj=salRevTeamViewObj,salRevTeamViewObj.isInit){Compensation.SalRevision.Operations.init();let layouthtml='<div class="zpl_btnmnu" id="viewActionsContainer">\n\t\t\t\t            \t<div class="zpl_lft"></div>\n\t\t\t\t            </div>\n\t\t\t\t\t\t\t<div class="zpl_rgtcnt zpl_mdltmvw"></div>';settingsPage.container.addClass("zpl_tblfxd").html(layouthtml),settingsPage.container.find("#recordActionClose").remove(),settingsPage.container.find("#recordActionsContainer").append('<i class="PI_cls" id="recordActionCompClose"></i>');let props={isrelatedform:!1};props.formId=Compensation.SalRevision.Operations.formDetails.formId,props.viewId=Compensation.SalRevision.Operations.formDetails.viewId,ZP5Views.setFormIdViewId(props),ZP5Views.setCurrViewParams(props),salRevTeamViewObj.constructSalRevView(!0)}},initModuleView:function(){$("#page-wrapper").addClass("zpl_btmpgn"),settingsUrlProps.currentMode=Compensation.CONSTANTS.TAB_NAME;let prop={selMode:"Others"};const viewType=Compensation.CONSTANTS.VIEWTYPE.OTHERS;prop.viewType=viewType;let salRevModuleViewObj=Compensation.SalRevision.Operations.getViewObj(viewType,prop);if(Compensation.SalRevision.Operations.currViewObj=salRevModuleViewObj,salRevModuleViewObj.isInit){Compensation.SalRevision.Operations.init();let layouthtml='<div class="zpl_btnmnu" id="viewActionsContainer">\n\t\t\t\t            \t<div class="zpl_lft"></div>\n\t\t\t\t            </div>\n\t\t\t\t\t\t\t<div class="zpl_rgtcnt zpl_mdltmvw"></div>';settingsPage.container.addClass("zpl_tblfxd").html(layouthtml);let props={isrelatedform:!1};props.formId=Compensation.SalRevision.Operations.formDetails.formId,props.viewId=Compensation.SalRevision.Operations.formDetails.viewId,ZP5Views.setFormIdViewId(props),ZP5Views.setCurrViewParams(props)}},showSalRevSingleRecView:function(recordId){let url=settingsUrlProps.niceUrl,urlParams=settingsUrlProps.urlParams;url="#"+(url=url.includes("/listview")?url.replace("/listview",""):url)+"/view-recordId:"+recordId,urlParams&&(url+="/"+urlParams),window.location.href=url},changeApprovalStatus:function(recordId,recordStatus,statusString){Compensation.SalRevision.Operations.singleRcdViewObj.changeApprStatus(recordId,recordStatus,statusString)},appRejSalRevision:function(apprObj){Compensation.SalRevision.Operations.singleRcdViewObj.changeApprStatus(apprObj.getApprovalParam().getRecordId(),apprObj.getApprovalParam().getApprovalStatus(),OPApprovals.getStatusText(apprObj.approvalParams.recordStatus,"P_SalaryRevision"))},showSalRevisionRecord:function(recordId,formId,closeCallback){Compensation.Config.getConfiguration(!1).then(configData=>{Compensation.SalRevision.Operations.singleRcdViewObj.showRevisionRecord(recordId,formId,closeCallback)})},showSingleRecView:function(recordId,disableUrlChng=!1,closeCallback){settingsUrlProps.niceUrl;Compensation.Config.getConfiguration_asSync(!1);let isEmpMyView=SingleRecordView.isEmpSalaryMyView();recordId||(recordId=isEmpMyView?settingsUrlProps.urlParamsArr.revId:settingsUrlProps.urlParamsArr.recordId),Compensation.SalRevision.Operations.singleRcdViewObj.showRevisionRecord(recordId,void 0,closeCallback,disableUrlChng)},approvalCallback:function(rdata,params){ZPApprovals.approveRejectDtlCallBack(rdata,params)}};class SalRevisionView{constructor(prop){this.refreshData=!0,this.isInit=!0,this.sIndex=1,this.recLimit=10,this.selMode=prop.selMode,this.revReasonOptns=[],this.searchParams=void 0,this.staticParams=void 0,this.hasNext=!1,this.hasPrev=!1,this.salRevSysFltrObj=void 0,this.viewType=prop.viewType,this.isFromOpr=this.viewType==Compensation.CONSTANTS.VIEWTYPE.OPER,this.isModuleView=this.viewType==Compensation.CONSTANTS.VIEWTYPE.OTHERS,this.isEmpView=this.viewType==Compensation.CONSTANTS.VIEWTYPE.EMPVIEW,this.isApprovalAvailable=!1,this.container=settingsPage.container,this.selUsr=prop.selUsr,this.onInitLoadCallback=prop.onInitLoadCallback,this.cancelRevCb=prop.cancelRevCb,this.revCountJson=void 0,this.isNavCbkTriggered=!1,this.sortType={}}constructSalRevView(needRevLetters){this.constructLayout(),0==this.container.find("#salRevListTbl").length&&(this.refreshData=this.isInit=!0),this.refreshData&&(this.sIndex=1,this.isInit&&(this.constructHeader(),this.constructFooter()),this.loadSalRevListView(void 0,void 0,void 0,!0,needRevLetters),this.refreshData=!1),this.handlePageEvents()}constructLayout(){var layout=this.container;this.isModuleView?layout.addClass("zpl_setingopr"):$("#page-wrapper").addClass("zpl_btmpgn"),layout.find("#viewActionsContainer").find(".zpl_rgt:not(#zp_views_formrecactions)").addClass("DNI"),layout.find("#viewActionsContainer").find("#zp_views_formrecactions.zpl_rgt").removeClass("DNI"),layout.find("#viewFooter").hide(),layout.find("#viewActionsContainer").find(".zpl_lft").find("#filterButton").hide(),layout.find("#viewActionsContainer").find(".zpl_lft").find(".zpl_selchklstall").addClass("DNI"),layout.find("#viewActionsContainer").find("#recordActionsContainer").addClass("DNI"),layout.find("#salRevList").removeClass("lodngH100"),layout.find(".zpl_rgtcnt").find("#salRevList").show(),layout.removeClass("lft3 zpl_tbllftfxd")}constructHeader(){var layout=this.container;if(0==layout.find("#viewActionsContainer #zp_views_formrecactions").length){var html='<div class="zpl_rgt" id="zp_views_formrecactions">';this.isFromOpr&&(html+='<i class="zpl_ibg PI_more" title="'+ZPI18N.getString("zp.more")+'" id="salRevMoreOpt" ref="more"></i>'),html+="</div>",layout.find("#viewActionsContainer").append(html),this.constructImpExp("salRevMOpts","salRevMoreOpt")}layout.find(".zpl_rgtcnt").append('<div id="noData"></div>');let filtIconHtml='<i class="zpl_ibg PI_fltr" title="'+ZPI18N.getString("zp.filter")+'" id="salRevMainFltr"></i>';if(this.isFromOpr?layout.find("#salRevMoreOpt").before(filtIconHtml):layout.find("#zp_views_formrecactions").append(filtIconHtml),layout.find("#viewActionsContainer .zpl_lft").after(`<div class="zpl_cntrdv"><div class="zpl_inav ZP-YearPager"><i id="prevYr" class="PI_alft tooltip-js blu CP" title="${ZPI18N.getString("zp.previous")}"></i><i class="PI_monthly"></i><i id="nxtYr" class="PI_argt tooltip-js blu CP" title="${ZPI18N.getString("zp.next")}"></i></div><b id="currYr" selind=""></b></div>`),this.constructRevStatusFilter(),0==layout.find("#recActDiv").length){let actHtml='<div class="actn_ovrly DNI" id="recordActionsContainer">\n                        <div id="recActDiv"></div>\n                    </div>';layout.find("#viewActionsContainer .zpl_lft").html(actHtml)}let actionHtml=`<div><button id="compRecordDelete" class="zlabel zlabel--red zlabel--medium">${ZPI18N.getString("zp.delete")}</button></div>`;layout.find("#recActDiv").html(actionHtml),layout.find("#recordActionClose").remove(),layout.find("#recordActionsContainer").append('<i class="PI_cls" id="recordActionCompClose"></i>'),layout.find("#recActDiv").addClass("d-flexclmcap10"),this.handleSalRevSummaryEvents();var revTblHdr='<div class="zpl_tblres" id="salRevList" scroll="enabled">\n\t\t\t\t\t\t\t<table class="zpl_tbl" id="salRevListTbl">\n\t\t\t\t\t\t\t\t<thead id="salRevSysHeader"><tr>';Compensation.SalRevision.Operations.formDetails.isDeleteAllowed&&(revTblHdr+='<th class="w45"><div class="zcheckbox" id="recordActions" recordid="-1"><input type="checkbox" name="check" class="zcheckbox__helper"><label class="zcheckbox__label"></label></div></th>'),void 0!==Compensation.Config.configObj.revApprovalId&&(revTblHdr+=`<th width="100"><span>${ZPI18N.getString("zp.status")}</span></th>`),revTblHdr+=`<th labelName="Employee" width="350"><div><span>${ZPI18N.getString("zp.name")}</span><div class="zpl_icncnt"><i class="PI_sort" id="salRevSort"></i></div></div></th>\n\t\t\t\t\t  <th labelName="Revised_Salary" width="200"><div><span>\n\t\t\t\t\t  \x3c!--${ZPI18N.getString("zp.local.RevisedCTC")}--\x3e\n\t\t\t\t\t  ${ZPI18N.getString("zp.local.revisedsalary")}\n\t\t\t\t\t  </span><div class="zpl_icncnt"><i class="PI_sort" id="salRevSort"></i></div></div></th>\n\t\t\t\t\t  <th labelName="salRevVar" width="250"><div><span>${ZPI18N.getString("zp.compensation.revSalVariation")}</span><div class="zpl_icncnt"><i class="PI_sort" id="salRevSort"></i></div></div></th>`,Compensation.Config.isTempEnabled&&(revTblHdr+=`<th labelName="Template" width="150"><div><span>${ZPI18N.getString("zp.compensation.SalaryPackage")}</span><div class="zpl_icncnt"><i class="PI_sort" id="salRevSort"></i></div></div></th>`),revTblHdr+=`<th labelName="Reason" width="150"><div><span>${ZPI18N.getString("zp.compensation.reasonforRevision")}</span><div class="zpl_icncnt"><i class="PI_sort" id="salRevSort"></i></div></div></th>\n\t\t\t\t\t  <th labelName="Effective_Date" width="150"><div><span>${ZPI18N.getString("zp.compensation.LastRevision")}</span><div class="zpl_icncnt"><i class="PI_sort" id="salRevSort"></i></div></div></th>\n\t\t\t\t      <th width="150"><div><span>${ZPI18N.getString("zp.compensation.RevisionStatus")}</span><div class="zpl_icncnt"><i class="PI_sort" id="salRevSort"></i></div></div></th>`,Compensation.PermissionBean.getPermBean().isConsideredDataAdmin&&(revTblHdr+=`<th>${ZPI18N.getString("zp.comp.rlg.revisionletterstatus")}</th>`,Compensation.Config.configObj.isSalarySyncEnabled&&(revTblHdr+=`<th>${ZPI18N.getString("zp.comp.payroll.payrollpushstatus")}</th>`)),revTblHdr+='</tr></thead></table></div><div name="salRev_mtDiv"></div>',layout.find(".zpl_rgtcnt").append(revTblHdr),this.container.find("[id=salRevSort]").off(),this.container.find("[id=salRevSort]").on("click",event=>{this.sortViewHandler(event)}),this.isFromOpr&&Compensation.SalRevision.Operations.formDetails.isExportAllowed||layout.find("i[ref=more]").remove()}sortViewHandler(){let labelName=$(event.target).parents("th").attr("labelName"),actionsList=[],revAmtId={sortRevAmtAsc:!0,sortRevAmtDesc:!1},revPerId={sortRevPerAsc:!0,sortRevPerDesc:!1};if("salRevSort"==$(event.target).attr("id")&&"salRevVar"==labelName?(actionsList.push({id:"sortRevAmtHeader",text:"sortRevisedAmt",groupname:"viewsort",type:"itemgroup"}),actionsList.push({id:"sortRevAmtAsc",text:ZPI18N.getString("zp.asc"),groupname:"viewsort",type:"checkbox"}),actionsList.push({id:"sortRevAmtDesc",text:ZPI18N.getString("zp.desc"),groupname:"viewsort",type:"checkbox"}),actionsList.push({id:"sortRevPerHeader",text:"sortRevisedPer",groupname:"viewsort",type:"itemgroup"}),actionsList.push({id:"sortRevPerAsc",text:ZPI18N.getString("zp.asc"),groupname:"viewsort",type:"checkbox"}),actionsList.push({id:"sortRevPerDesc",text:ZPI18N.getString("zp.desc"),groupname:"viewsort",type:"checkbox"})):(actionsList.push({id:"sortHeader",text:ZPI18N.getString("zp.sort"),groupname:"viewsort",type:"itemgroup"}),actionsList.push({id:"sortAsc",text:ZPI18N.getString("zp.asc"),groupname:"viewsort",type:"checkbox"}),actionsList.push({id:"sortDesc",text:ZPI18N.getString("zp.desc"),groupname:"viewsort",type:"checkbox"})),Compensation.Utils.setSortMenu({id:"systemViewRevHisSorting",type:"list",displayType:"callout",contentType:"icon-text"},actionsList,event),ZPeopleComponents.menu("#systemViewRevHisSorting",{forElement:event.target,className:"zpl_drpdwn",itemclick:event=>{let detail=event.detail,value="salRevVar"==labelName?revAmtId.hasOwnProperty(detail.attrs.id)?revAmtId[detail.attrs.id]:revPerId[detail.attrs.id]:"sortAsc"==detail.attrs.id;if("salRevVar"==labelName&&(labelName=revAmtId.hasOwnProperty(detail.attrs.id)?"Revised_Amount":"Revised_Percentage"),this.sortType[labelName]==value){let getClass="Revised_Percentage"==labelName||"Revised_Amount"==labelName?"salRevVar":labelName;this.container.find("[labelName="+getClass+"]").children().children().children().removeClass("desc").removeClass("asc"),delete this.sortType[labelName]}else"Revised_Percentage"!=labelName&&"Revised_Amount"!=labelName||("sortRevAmtAsc"==detail.attrs.id||"sortRevAmtDesc"==detail.attrs.id?(void 0==this.sortType.Revised_Percentage||delete this.sortType.Revised_Percentage,"sortRevAmtAsc"==detail.attrs.id?this.sortType.Revised_Amount=!0:this.sortType.Revised_Amount=!1):(void 0==this.sortType.Revised_Amount||delete this.sortType.Revised_Amount,"sortRevPerAsc"==detail.attrs.id?this.sortType.Revised_Percentage=!0:this.sortType.Revised_Percentage=!1)),this.sortType[labelName]=value;this.loadSalRevData(this.searchParam,this.staticParam,this.updatedCount,this.needSalRevCount,!1,!1,!1)}}),"salRevVar"==labelName){let sortByAmtAsc=0!=this.sortType.length?this.sortType.Revised_Amount:void 0,sortByPerAsc=0!=this.sortType.length?this.sortType.Revised_Percentage:void 0;ZPeopleComponents.menu("#systemViewRevHisSorting").setMenuItemsAttribute(["#sortRevAmtAsc"],"checked",sortByAmtAsc),ZPeopleComponents.menu("#systemViewRevHisSorting").setMenuItemsAttribute(["#sortRevAmtDesc"],"checked",void 0!=sortByAmtAsc?!sortByAmtAsc:sortByAmtAsc),ZPeopleComponents.menu("#systemViewRevHisSorting").setMenuItemsAttribute(["#sortRevPerAsc"],"checked",sortByPerAsc),ZPeopleComponents.menu("#systemViewRevHisSorting").setMenuItemsAttribute(["#sortRevPerDesc"],"checked",void 0!=sortByPerAsc?!sortByPerAsc:sortByPerAsc)}else{let sortByAsc=0!=this.sortType.length?this.sortType[labelName]:void 0;ZPeopleComponents.menu("#systemViewRevHisSorting").setMenuItemsAttribute(["#sortAsc"],"checked",sortByAsc),ZPeopleComponents.menu("#systemViewRevHisSorting").setMenuItemsAttribute(["#sortDesc"],"checked",void 0!=sortByAsc?!sortByAsc:sortByAsc)}ZPeopleComponents.menu("#systemViewRevHisSorting").show()}constructFooter(){let layout=this.container,fHtml=`<div class="zpl_tblpagination" id="salRevSysViewFooter">\n                \t\t\t<div class="zpl_rhtpgn">\n                    \t\t\t<select data-width="70" class="zselectbox select-js" id="salRevSys_recordsPerPage" style="display: none;">\n\t\t\t\t\t\t\t\t\t<optgroup label="${ZPI18N.getString("zp.records")}">\n                        \t\t\t\t<option value="10">10</option>\n                        \t\t\t\t<option value="20">20</option>\n                        \t\t\t\t<option value="30">30</option>\n                        \t\t\t\t<option value="40">40</option>\n                        \t\t\t\t<option value="50">50</option>\n                        \t\t\t\t<option value="75">75</option>\n                        \t\t\t\t<option value="100">100</option>\n                        \t\t\t\t<option value="200">200</option>\n\t\t\t\t\t\t\t\t\t</optgroup>\n                    \t\t\t</select>\n                    \t\t\t<div class="pagecount" id="salRevSysViewPagination">\n                        \t\t\t<a class="zpl_prev gry" id="salRevSysPrevPage"></a>\n                        \t\t\t<span id="viewPageCount"><b>1&nbsp;-&nbsp;10</b></span>\n                        \t\t\t<a class="zpl_nxt blu CP" id="salRevSysNextPage"></a>\n                    \t\t\t</div>\n                \t\t\t</div>\n\t\t\t\t\t\t</div>`;layout.find("div.zpl_rgtcnt").after(fHtml),this.handleFooterEvents()}handleFooterEvents(){let layout=this.container;ZPeopleComponents.select(layout.find("#salRevSysViewFooter #salRevSys_recordsPerPage"),{randomDropdownListId:!0,change:event=>{if(!event.detail.fromUI)return;let updateCount=event.detail.selectedValue;this.sIndex=1,this.recLimit=updateCount,this.loadSalRevData(void 0,void 0,updateCount)}}),layout.find("#salRevSysViewFooter").find("#salRevSysNextPage,#salRevSysPrevPage").on("click",event=>{let itr="salRevSysNextPage"==$(event.target).attr("id")?this.recLimit:-1*this.recLimit;this.handlePagination(itr)})}handlePagination(itr){let layout=this.container;(itr>0?this.hasNext:this.hasPrev)&&(this.sIndex+=itr,layout.find("#salRevSysViewFooter").addClass("DNI"),this.loadSalRevData(void 0,void 0,void 0,!1,!1,!0))}setPaginationTxt(start,recCount,recLimit,isLastRec=!1){let layout=this.container,end=recCount+start-1;layout.find("#salRevSysViewFooter #viewPageCount").html(`<b>${start}&nbsp;-&nbsp;${end}</b>`),this.hasNext=!isLastRec,this.recLimit=recLimit,this.hasPrev=start>this.recLimit,this.hasPrev?layout.find("#salRevSysViewFooter #salRevSysPrevPage").addClass("blu cp"):layout.find("#salRevSysViewFooter #salRevSysPrevPage").removeClass("blu cp"),this.hasNext?layout.find("#salRevSysViewFooter #salRevSysNextPage").addClass("blu cp"):layout.find("#salRevSysViewFooter #salRevSysNextPage").removeClass("blu cp"),0!=layout.find("#salRevSysViewFooter #salRevSys_recordsPerPage").length&&ZPeopleComponents.select(layout.find("#salRevSysViewFooter #salRevSys_recordsPerPage")).setValue(recLimit)}constructImpExp(eleId,forEle){if(!Compensation.SalRevision.Operations.formDetails.isExportAllowed)return;var layout=this.container;let isInit=0==layout.find("#"+eleId).length;if(isInit){let mhtml=`<div id=${eleId} class="zpl_drpdwn zmenu zmenu--iconwithtext" data-type="list" data-content-type="icon-text" role="menu"></div>`;layout.append(mhtml)}ZPeopleComponents.menu("#"+eleId,{forElement:"#"+forEle,appendTo:layout}),this.addMenuItems(eleId,isInit),layout.find("#"+forEle).off().on("click",()=>{ZPeopleComponents.menu("#"+eleId).show()})}addMenuItems(eleId,isInit){isInit&&this.getMoreOpts().forEach(item=>{ZPeopleComponents.menu(settingsPage.container.find("#"+eleId)).addMenuItem({label:item.txt,iconClass:item.iClass,id:item.id,action:(event,selItem)=>{item.callback.bind(this)(event,selItem)},displayType:"callout"})})}moreOptsHtml(eleId){var optshtml='<div id="'+eleId+'" class="zpl_drpdwn zmenu zmenu--iconwithtext" data-type="list" data-content-type="icon-text" role="menu"><ul data-body="true" class="zmenu__body">';return optshtml+=this.getMoreOpts().map(obj=>`<li data-action="${obj.callback}" data-icon-class="${obj.iClass}" id="${obj.id}" class="zmenu__item"><div class="zmenu__iconcontainer"><i class="zmenu__icon ${obj.iClass}"></i></div><span class="zmenu__text">${obj.txt}</span></li>`).join(""),optshtml+="</ul></div>"}getMoreOpts(){var opts=[];return opts.push({iClass:"PI_exprt",callback:this.handleExport,txt:ZPI18N.getString("zp.compensation.exportRev"),id:"salRevExpIcon"}),opts}getRecCount(){let params={mode:"getRecordCount",formId:Compensation.SalRevision.Operations.formDetails.formId,viewId:Compensation.SalRevision.Operations.formDetails.viewId},searchParams=this.searchParams,staticParams=this.staticParams;void 0!=searchParams&&searchParams.length>0&&(params.searchBy=JSON.stringify(searchParams)),void 0!=staticParams&&(staticParams.hasOwnProperty("employeeStatus")&&void 0!=staticParams.employeeStatus&&(params.employeeStatus=staticParams.employeeStatus),staticParams.hasOwnProperty("approvalStatus")&&(params.approvalStatus=staticParams.approvalStatus),staticParams.hasOwnProperty("orgStructureFilter")&&Object.keys(staticParams.orgStructureFilter).length>0&&(params.orgStructureFilter=JSON.stringify(staticParams.orgStructureFilter))),ZPeople.Request.send("/viewAction.zp",params,data=>{if(7e3===data.code){let recCount=data.message.recordCount;settingsPage.container.find("#salRevSysViewFooter #salRev_view_recordcount").text(recCount)}})}setSalRevCount(revCountJson,isFromFilter){let revHistStatsDiv=settingsPage.container.find("#revHistStats"),procRevCount=revCountJson.Processed?revCountJson.Processed:0,pendRevCount=revCountJson.Pending?revCountJson.Pending:0,rejRevCount=revCountJson.Rejected?revCountJson.Rejected:0,cancelRevCount=revCountJson.Cancelled?revCountJson.Cancelled:0,rejCancelRevCount=rejRevCount+cancelRevCount,totalRevCount=procRevCount+pendRevCount+rejRevCount+cancelRevCount;revHistStatsDiv.find("#totalRevStat b").text(totalRevCount),revHistStatsDiv.find("#pendRevStat b").text(pendRevCount),revHistStatsDiv.find("#procRevStat b").text(procRevCount),revHistStatsDiv.find("#rejCancelRevStat b").text(rejCancelRevCount),isFromFilter||this.triggerSalRevStatus(revCountJson)}triggerSalRevStatus(revCountJson){let revHistStatsDiv=settingsPage.container.find("#revHistStats");revCountJson.Pending?(revHistStatsDiv.find("#pendRevStat").addClass("zpl_act"),revHistStatsDiv.find("#procRevStat").removeClass("zpl_act"),revHistStatsDiv.find("#rejCancelRevStat").removeClass("zpl_act"),revHistStatsDiv.find("#totalRevStat").removeClass("zpl_act"),this.revStatusType=revHistStatsDiv.find("#pendRevStat").attr("revstatus")):revCountJson.Processed?(revHistStatsDiv.find("#procRevStat").addClass("zpl_act"),revHistStatsDiv.find("#pendRevStat").removeClass("zpl_act"),revHistStatsDiv.find("#rejCancelRevStat").removeClass("zpl_act"),revHistStatsDiv.find("#totalRevStat").removeClass("zpl_act"),this.revStatusType=revHistStatsDiv.find("#procRevStat").attr("revstatus")):(revHistStatsDiv.find("#totalRevStat").addClass("zpl_act"),revHistStatsDiv.find("#pendRevStat").removeClass("zpl_act"),revHistStatsDiv.find("#procRevStat").removeClass("zpl_act"),revHistStatsDiv.find("#rejCancelRevStat").removeClass("zpl_act"),this.revStatusType=revHistStatsDiv.find("#procRevStat").attr("revstatus"))}loadSalRevListView(searchParam,staticParam,updatedCount,needSalRevCount,needRevLetters){this.searchParams=void 0,this.staticParams=void 0,this.removeSalRevCountDivClasses(),this.loadSalRevData(searchParam,staticParam,updatedCount,needSalRevCount,!1,!1,!0,needRevLetters)}async getSalRevAccessYears(erecNum,isDirectLoad){let layout=settingsPage.container;var params={conreqcsr:csrfToken};if(erecNum&&(params.erecno=erecNum),!Compensation.SalRevision.Operations.salRevsAccessYears||0===Object.keys(Compensation.SalRevision.Operations.salRevsAccessYears).length||isDirectLoad){let salRevsAccessYears=(await Compensation.Utils.sendReqAsPromise("/compensation/revisions/getdefaultAccessyears",params)).salRevsAccessYears;Compensation.SalRevision.Operations.salRevsAccessYears=salRevsAccessYears;var index=0;outerLoop:for(var i=0;i<salRevsAccessYears.length;i++){var currentItem=salRevsAccessYears[i];if(currentItem.containSalRevs){index=currentItem.ind;break outerLoop}}var currYr=salRevsAccessYears.filter(obj=>obj.ind==index)[0];if(currYr){let from=currYr.from,to=currYr.to;layout.find("#currYr").attr("selInd",index),layout.find("#currYr").text(from+" - "+to)}}return Promise.resolve(Compensation.SalRevision.Operations.salRevsAccessYears)}loadSalRevData(searchParam,staticParam,updatedCount,needSalRevCount,isFromCard=!1,isFromFilter=!1,isDirectLoad=!1,needRevLetters=!1){let layout=settingsPage.container;searchParam=searchParam||(this.searchParams&&this.searchParams.length>0?this.searchParams:searchParam),!staticParam&&this.staticParams&&(this.staticParams.approvalStatus||this.staticParams.employeeStatus||Object.keys(this.staticParams.orgStructureFilter).length>0)&&(staticParam=this.staticParams),layout.find("#salRevListTbl > #rev-listtbody").remove(),layout.find("#emptPage").length&&(layout.find("#emptPage").remove(),layout.find("#rev-listtbody").show());let erecNumToProvide,loader=new LoadingClass(this.container.find("#salRevList"));loader.add(),this.isEmpView&&settingsUrlProps.urlParamsArr.hasOwnProperty("recordId")&&(erecNumToProvide=settingsUrlProps.urlParamsArr.recordId),this.getSalRevAccessYears(erecNumToProvide,isDirectLoad).then(response=>{let params=this.getParamsForRevisionDataFetch(searchParam,staticParam,updatedCount,needSalRevCount,needRevLetters);Compensation.Utils.sendReqAsPromise("/compensation/revisions/get",params).then(resultData=>{this.constructSalRevBody.call(this,resultData,isFromCard,isFromFilter),this.isInit&&this.onInitLoadCallback&&this.onInitLoadCallback(resultData),loader.remove(),this.isNavCbkTriggered=!1,this.isInit&&this.constructSysFilter(),this.isInit=!1})})}getParamsForRevisionDataFetch(searchParams,staticParams,updatedCount,needSalRevCount,needRevLetters){let layout=this.container;var params={conreqcsr:csrfToken,version:5};if(this.isModuleView?(params.viewType="Others",params.compDataType=Compensation.CONSTANTS.DATAMODE.NONADMIN_DATA):this.isFromOpr&&(params.viewType="All",params.compDataType=Compensation.CONSTANTS.DATAMODE.ADMIN_DATA),void 0!=this.sIndex?params.startIndex=this.sIndex:(params.startIndex=1,this.sIndex=1),updatedCount&&(params.updateCount=updatedCount),this.isEmpView){searchParams=searchParams||[];let userDtls=ZPeople.getUserDetailsById(this.selUsr);searchParams.push({Employee:ZPeople.decodeTxt(userDtls.name),Employee_ids:[this.selUsr],Employee_idFlag:[1],Employee_op:"26"}),params.compDataType=Compensation.CONSTANTS.DATAMODE.ALL_DATA,params.employeeStatus="all"}void 0!=searchParams&&searchParams.length>0&&(params.searchBy=JSON.stringify(searchParams)),void 0!=staticParams&&(staticParams.hasOwnProperty("employeeStatus")&&void 0!=staticParams.employeeStatus&&(params.employeeStatus=staticParams.employeeStatus),staticParams.hasOwnProperty("approvalStatus")&&(params.approvalStatus=staticParams.approvalStatus),staticParams.hasOwnProperty("orgStructureFilter")&&Object.keys(staticParams.orgStructureFilter).length>0&&(params.orgStructureFilter=JSON.stringify(staticParams.orgStructureFilter)));let selInd=parseInt(layout.find("b#currYr").attr("selInd")),yrToSel=Compensation.SalRevision.Operations.salRevsAccessYears.filter(obj=>obj.ind==selInd);params.from=yrToSel[0].from,params.to=yrToSel[0].to;let value="";for(var keys=void 0!=this.sortType?Object.keys(this.sortType):"",x=0;x<keys.length;x++){var key=keys[x];value+=key+":"+this.sortType[key]+";";let getClass="Revised_Amount"==key||"Revised_Percentage"==key?"salRevVar":key;this.sortType[key]?this.container.find("[labelName="+getClass+"]").children().children().children().removeClass("desc").addClass("asc"):this.container.find("[labelName="+getClass+"]").children().children().children().removeClass("asc").addClass("desc")}params.sortBy=value;let revHistStatsDiv=layout.find("#revHistStats");if(revHistStatsDiv.find("#pendRevStat").hasClass("zpl_act")){let revStatusType=revHistStatsDiv.find("#pendRevStat").attr("revstatus");params.revStatusType=revStatusType,this.revStatusType=revStatusType}else if(revHistStatsDiv.find("#procRevStat").hasClass("zpl_act")){let revStatusType=revHistStatsDiv.find("#procRevStat").attr("revstatus");params.revStatusType=revStatusType,this.revStatusType=revStatusType}else if(revHistStatsDiv.find("#rejCancelRevStat").hasClass("zpl_act")){let revStatusType=revHistStatsDiv.find("#rejCancelRevStat").attr("revstatus");params.revStatusType=revStatusType,this.revStatusType=revStatusType}else if(revHistStatsDiv.find("#totalRevStat").hasClass("zpl_act")){let revStatusType=revHistStatsDiv.find("#totalRevStat").attr("revstatus");params.revStatusType=revStatusType,this.revStatusType=revStatusType}return params.needSalRevCount=!(this.revCountJson&&!needSalRevCount&&!searchParams&&!staticParams),params.needRevLetters=!!needRevLetters,params}getPayrollPushStatusText(status){let statusCls,statusStr;switch(status){case 0:statusCls="org",statusStr=ZPI18N.getString("zp.notpushed");break;case 1:statusCls="blu",statusStr=ZPI18N.getString("zp.inprogress");break;case 2:statusCls="blu",statusStr=ZPI18N.getString("zp.pushed");break;case 3:statusCls="grn",statusStr=ZPI18N.getString("zp.approved");break;case 4:statusCls="red",statusStr=ZPI18N.getString("zp.rejected");break;case 6:statusCls="red",statusStr=ZPI18N.getString("zp.comp.payroll.errinpayroll");break;case 7:statusCls="blu",statusStr=ZPI18N.getString("zp.updated");break;case 8:statusCls="red",statusStr=ZPI18N.getString("zp.deleted")}return[statusCls,statusStr]}getRevLetterStatusText(status){let statusCls,statusStr;switch(status){case 0:statusCls="red",statusStr=ZPI18N.getString("zp.yettobegenerated");break;case 1:statusCls="org",statusStr=ZPI18N.getString("zp.inprogress");break;case 2:statusCls="blu",statusStr=ZPI18N.getString("zp.rdytopub");break;case 3:case 4:statusCls="grn",statusStr=ZPI18N.getString("zp.published");break;case-1:statusCls="red",statusStr=ZPI18N.getString("zp.failtogen");break;case-2:statusCls="red",statusStr=ZPI18N.getString("zp.failtopub")}return[statusCls,statusStr]}constructSalRevBody(resultData,isFromCard,isFromFilter){let revCountJson=resultData.revCountJson;this.revCountJson=revCountJson||this.revCountJson,isFromCard||this.setSalRevCount(this.revCountJson,isFromFilter);const layout=this.container;this.isApprovalAvailable=resultData.isApprovalAvailable,ZP5Form.getForm(Compensation.SalRevision.Operations.formDetails.formId).setFormDetailsMap({approvalSettingsDetails:{isApprovalEnabled:this.isApprovalAvailable}});let revFormObj=resultData.revFormObj;(revFormObj.message.fieldHeaders?revFormObj.message.fieldHeaders:revFormObj.fieldHeaders).forEach(fieldObj=>{"REV_REASON"==fieldObj.columnName&&(this.revReasonOptns=fieldObj.options)});var revDataArr=resultData.revDataArr,dataHtml='<tbody id="rev-listtbody">';if(revDataArr&&revDataArr.length>0){this.DATA=revDataArr,layout.find("#emptPage").length&&(layout.find("#emptPage").remove(),layout.find("#rev-listtbody").show()),layout.find("#salRevList #salRevListTbl #salRevSysHeader").is(":hidden")&&layout.find("#salRevList #salRevListTbl #salRevSysHeader").show();let revListTbl=layout.find("#salRevListTbl");for(let i=0;i<revDataArr.length;i++){let revId=revDataArr[i].recordId,fullname=revDataArr[i].Employee,revPercentage=revDataArr[i].Revised_Percentage,revAmt=revDataArr[i].Revised_Amount,revSalary=revDataArr[i].Revised_Salary,effectiveFrom=revDataArr[i].Effective_Date,template=revDataArr[i].Template,revStatus=(ZSEC.Encoder.encodeForHTML(revDataArr[i].Currency),revDataArr[i].Revision_Type,revDataArr[i].Revision_Status),reason=revDataArr[i].Reason,isDeleteAllowed=(revDataArr[i].Remarks,revDataArr[i].modifiedTimeOn,revDataArr[i].src,Compensation.SalRevision.Operations.formDetails.isDeleteAllowed);revDataArr[i].isLatestRevision;if(dataHtml+='<tr id="revTable_'+revId+'" recordid="'+revId+'">',isDeleteAllowed&&(dataHtml+='<td iseditable="true" isDeleteAllowed="'+isDeleteAllowed+`"><div class="zcheckbox"   id="recordActions" recordid="${revId}"><input type="checkbox" name="check" value="" class="zcheckbox__helper"><label class="zcheckbox__label"></label></div></td>`),this.isApprovalAvailable){let statusId=revDataArr[i].approvalStatusId;dataHtml+='<td name="status">'+OPApprovals.getApprovalIcon(statusId,!0,Compensation.SalRevision.Operations.formDetails.tableName)+"</td>"}if(dataHtml+='<td><div class="zpl_em"><div class="zpl_emdts"><div><span>'+fullname+"</span></div></div></div></td>",dataHtml+="<td><span>"+revSalary+"</span></td>",dataHtml+='<td><span><span class="MR10">'+revAmt+'</span> <em class="MR10">-</em> <em>'+revPercentage+" %</em></span></td>",Compensation.Config.isTempEnabled){dataHtml+='<td><div class="zpl_em"><div class="zpl_emdts"><div><span>'+(""==template?ZPI18N.getString("zp.notapplicable"):template)+"</span></div></div></div></td>"}if(dataHtml+="<td><span>"+ZSEC.Encoder.encodeForHTML(reason)+"</span></td>",dataHtml+="<td><span>"+effectiveFrom+"</span></td>",dataHtml+='<td name="revisionStatus"><span>'+ZSEC.Encoder.encodeForHTML(revStatus)+"</span></td>",revDataArr[i].rlGenStatusForCurRevision){let[statusCls,statusStr]=this.getRevLetterStatusText(parseInt(revDataArr[i].rlGenStatusForCurRevision));dataHtml+='<td class="'+statusCls+'"><span>'+statusStr+"</span></td>"}if(Compensation.PermissionBean.getPermBean().isConsideredDataAdmin&&Compensation.Config.configObj.isSalarySyncEnabled&&revDataArr[i].payrollPushStatus){let[statusCls,statusStr]=this.getPayrollPushStatusText(parseInt(revDataArr[i].payrollPushStatus));dataHtml+='<td class="'+statusCls+'"><span>'+statusStr+"</span></td>"}dataHtml+="</tr>"}dataHtml+="</tbody>",revListTbl.find("#rev-listtbody").children().length>0&&revListTbl.find("#rev-listtbody").remove(),revListTbl.append(dataHtml);let sIndex=this.sIndex,frmMsg=resultData.revFormObj.message;layout.find("#salRevSysViewFooter").removeClass("DNI"),this.setPaginationTxt(sIndex,revDataArr.length,frmMsg.recordsLimit,frmMsg.isLastPage),1==sIndex&&(layout.find("#salRevSysViewFooter").find("#salRev_view_recordcount").text("#"),layout.find("#salRevSysViewFooter").find("#salRev_view_recordcount").off("click"),layout.find("#salRevSysViewFooter").find("#salRev_view_recordcount").one("click",()=>{this.getRecCount()})),layout.find("#salRevSysViewFooter").show(),layout.find("#rev-listtbody tr td:not(:first-child)").off().on("click",event=>{let recordId=$(event.currentTarget).parent("tr").attr("recordid"),niceUrl=settingsUrlProps.niceUrl;-1!=(niceUrl=niceUrl.replace("/view","")).indexOf("salarydetails/revision")||-1!=niceUrl.indexOf("salarydetails/salaryrevision")?(niceUrl=niceUrl.includes("/listview")?niceUrl.replace("/listview",""):niceUrl,window.location.href="#"+niceUrl+"/view-recordId:"+recordId):window.location.href="#"+niceUrl+"/view-recordId:"+settingsUrlProps.urlParamsArr.recordId+"/revId:"+recordId}),layout.find("div#recordActions,#recordActionCompClose").off().on("click",event=>{this.selectRecords()})}else{let listObj={container:settingsPage.container,salRevList_empty:{}},emptyPage=new EmptyPages("zp_nd_nodata",ZPI18N.getString("zp.norec"),"",listObj.container.find('[name="salRev_mtDiv"]'));listObj.salRevList_empty=emptyPage,listObj.salRevList_empty.show(),layout.find("#salRevList #salRevListTbl #salRevSysHeader").hide(),layout.find("#rev-listtbody").hide(),layout.find("#salRevSysViewFooter").hide()}}selectRecords(clear){const layout=this.container;Compensation.Utils.handleMultiSelect(layout,$(event.currentTarget),selIds=>{this.SELECTED_IDS=selIds,this.handleActionBtns()},clear)}handleActionBtns(){const layout=this.container;layout.find("#recActDiv").find("#compRecordDelete").removeClass("DN"),layout.find("#recordActionsContainer").removeClass("DNI")}onViewSwitchCallback(isSystemView){var layout=settingsPage.container;isSystemView?($("#page-wrapper").addClass("zpl_btmpgn"),layout.find("#viewFooter").hide(),layout.find("#viewActionsContainer").find(".zpl_lft").find("#filterButton").hide(),layout.find("#viewActionsContainer").find(".zpl_lft").find("#salRevMainFltr").show(),layout.find("#viewActionsContainer").find(".zpl_cntrdv").show(),layout.find("#revHistStats").removeClass("DNI").addClass("zpl_comptopgrpmnu"),layout.find("#viewActionsContainer").find(".zpl_lft").find(".zpl_selchklstall").addClass("DNI"),layout.find("#viewActionsContainer").find("#recordActionsContainer").addClass("DNI"),layout.find("#viewActionsContainer").find("#zp_views_formrecactions.zpl_rgt").removeClass("DNI"),layout.find(".zpl_tblres:not(#zp_views_list_container)").hide(),layout.find("#zp_views_list_container.zpl_tblres").show(),layout.find("#salRevSysFltr").removeClass("DNI"),layout.find('[name="salRev_mtDiv"]').show(),layout.find("#formsviewmenuicontxt").hide(),layout.find("#emptPage").length||layout.find("#salRevSysViewFooter").removeClass("DNI"),layout.find("#filterResultsHeader").addClass("DN"),layout.removeClass("zpl_fltrvwfxd"),void 0!=this.salRevSysFltrObj&&this.salRevSysFltrObj.filterResult.length>0&&layout.find("#sys_filterResultsHeader").removeClass("DN"),layout.hasClass("zpl_fltr_lft")&&layout.removeClass("zpl_fltr_lft"),layout.hasClass("lft5")&&layout.removeClass("lft5")):(layout.find("#viewFooter").show(),layout.find("#viewActionsContainer").find(".zpl_lft").find("#filterButton").show(),layout.find("#viewActionsContainer").find(".zpl_lft").find("#salRevMainFltr").hide(),layout.find("#viewActionsContainer").find(".zpl_cntrdv").hide(),layout.find("#revHistStats").addClass("DNI").removeClass("zpl_comptopgrpmnu"),layout.find("#viewActionsContainer").find(".zpl_lft").find(".zpl_selchklstall").removeClass("DNI"),layout.find("#viewActionsContainer").find("#recordActionsContainer").removeClass("DNI"),layout.find(".zpl_tblres:not(#zp_views_list_container)").show(),layout.find("#zp_views_list_container.zpl_tblres").hide(),layout.find("#addRecordButton").addClass("DNI"),layout.find("#viewType").hide(),layout.find("#filterContainer").removeClass("DNI"),layout.find("#salRevList").hide(),layout.find('[name="salRev_mtDiv"]').hide(),layout.find("#salRevSysFltr").addClass("DNI"),layout.find("#formsviewmenuicontxt").show(),layout.find("#salRevSysViewFooter").addClass("DNI"),layout.find("#sys_filterResultsHeader").addClass("DN"),this.isFromOpr&&Compensation.SalRevision.Operations.formDetails.isExportAllowed||layout.find("#formsviewmenuicontxt.PI_more").remove()),Compensation.Utils.removeLoading()}handleExport(){let callback;!ZP5Views.isSystemView()||ZP5Views.currViewObj&&ZP5Views.currViewObj.isApproverViewType()||(callback=this.exportData.bind(this)),ZP5Export.init("salaryrevision",{moduleSysViewCallback:callback,additionalHtmlCallback:Compensation.Utils.getNoteForNewExportDiv})}exportData(){if(Layout.UrlConf.isModuleForm()&&!ZP5Views.isSystemView())ExportNew.exportData();else{let viewId=Compensation.SalRevision.Operations.formDetails.viewId,sParams=this.searchParams,stParams=this.staticParams,reqParams=Compensation.Utils.getReqParamsForExport(sParams,stParams);reqParams.approvalStatus=stParams&&void 0!=stParams.approvalStatus?stParams.approvalStatus:"all",reqParams.viewID=viewId||Compensation.SalRevision.Operations.formDetails.viewId;let selInd=parseInt(settingsPage.container.find("b#currYr").attr("selInd")),yrToSel=Compensation.SalRevision.Operations.salRevsAccessYears.filter(obj=>obj.ind==selInd);reqParams.fromDate=yrToSel[0].from,reqParams.toDate=yrToSel[0].to,this.revStatusType&&(reqParams.revStatusType=this.revStatusType),Compensation.Utils.sendFormReqForExport("/ExportData.zp",reqParams)}}async constructSysFilter(){this.isFromOpr;let fltrOpts=await this.getfltrJSON(),prop={filterid:"salRevSysFltr"};prop.fieldJson=fltrOpts,prop.appendTo=settingsPage.container,prop.fltrResultFmt=1,prop.handleOSFltr=!this.isEmpView,prop.handleLocFltr=!this.isEmpView,prop.filterPosCls="zpl_fltr_flt",this.isApprovalAvailable&&(prop.handleApprovalStatusFltr=!0),prop.handleEmpStatusFltr=!this.isEmpView,prop.dataTblEle=settingsPage.container.find("#salRevList").closest("div.zpl_rgtcnt"),prop.applyCallback=((searchParams,osFltrObj,empStatus,approvalStatus)=>{this.applyFilter(searchParams,osFltrObj,empStatus,approvalStatus)});var sysFltr=new compensationModuleFilter(prop);this.salRevSysFltrObj=sysFltr,sysFltr.init()}async getfltrJSON(){let isModuleView=this.isModuleView,isFromOpr=this.isFromOpr,fltrArr=[],opts=[],fieldObj={};if(!this.isEmpView){let searchMode="COMPENSATION_REPORTS",compDataType=Compensation.CONSTANTS.DATAMODE.ALL_DATA;isFromOpr?compDataType=Compensation.CONSTANTS.DATAMODE.ADMIN_DATA:isModuleView&&(compDataType=Compensation.CONSTANTS.DATAMODE.NONADMIN_DATA),fieldObj={id:"Employee",dispName:ZPI18N.getString("zp.employee"),fieldType:Compensation.CONSTANTS.PLAIN_TEXT_FIELD,isTokenField:!0,isSearchField:!0,searchMode:searchMode,compDataType:compDataType},fltrArr.push(fieldObj)}if(!this.isEmpView){if(fieldObj={id:"Revised_Amount",dispName:ZPI18N.getString("zp.compensation.revAmt"),fieldType:Compensation.CONSTANTS.NUMERICAL_FIELD},fltrArr.push(fieldObj),Compensation.Config.isTempEnabled){fieldObj={id:"Template",dispName:ZPI18N.getString("zp.compensation.SalaryPackage"),fieldType:Compensation.CONSTANTS.PICKLIST_FIELD};let dataArr=(await Compensation.Utils.sendReqAsPromise("/compensation/packages/list",{fetchBasicInfo:!0})).allTmpls;opts=Compensation.Utils.getComponentPicklistOptions(dataArr,"tid","name","name"),fieldObj.options=opts,fltrArr.push(fieldObj)}fieldObj={id:"Remarks",dispName:ZPI18N.getString("zp.remarks"),fieldType:Compensation.CONSTANTS.TEXT_FIELD},fltrArr.push(fieldObj),fieldObj={id:"Currency",dispName:ZPI18N.getString("zp.currency"),fieldType:Compensation.CONSTANTS.PICKLIST_FIELD};let dataArr=(await Compensation.Utils.sendReqAsPromise("/compensation/currencies/list",{fetchBasicInfo:!0})).confCurrList;opts=Compensation.Utils.getComponentPicklistOptions(dataArr,"currencyid","currencycode","name"),fieldObj.options=opts,fltrArr.push(fieldObj)}fieldObj={id:"Revised_Percentage",dispName:ZPI18N.getString("zp.local.revisedpercentage"),fieldType:Compensation.CONSTANTS.NUMERICAL_FIELD},fltrArr.push(fieldObj),fieldObj={id:"Revised_Salary",dispName:ZPI18N.getString("zp.local.revisedsalary"),fieldType:Compensation.CONSTANTS.NUMERICAL_FIELD},fltrArr.push(fieldObj),fieldObj={id:"Effective_Date",dispName:ZPI18N.getString("zp.compensation.LastRevision"),fieldType:Compensation.CONSTANTS.DATE_FIELD},fltrArr.push(fieldObj),fieldObj={id:"Reason",dispName:ZPI18N.getString("zp.compensation.reasonforRevision"),fieldType:Compensation.CONSTANTS.PICKLIST_FIELD};let revReasonDataArr=this.constOptValsForSalRevReason(this.revReasonOptns);if(opts=Compensation.Utils.getComponentPicklistOptions(revReasonDataArr,"revisionid","revreason","name"),fieldObj.options=opts,fltrArr.push(fieldObj),Compensation.PermissionBean.getPermBean().isConsideredDataAdmin&&Compensation.Config.configObj.isSalarySyncEnabled){fieldObj={id:"PayrollPushStatus",dispName:ZPI18N.getString("zp.comp.payroll.payrollpushstatus"),fieldType:Compensation.CONSTANTS.SPECIAL_FIELDS};let specialFieldsJson=Compensation.FormHandler.SPECIAL_FIELDS[Compensation.SalRevision.Operations.formDetails.tableName].PayrollPushStatus,specialFieldsDataArr=this.constSpecialFieldsArray(specialFieldsJson,"payrollstatusid","payrollstatusval");opts=Compensation.Utils.getComponentPicklistOptions(specialFieldsDataArr,"payrollstatusid","payrollstatusval","name"),fieldObj.options=opts,fltrArr.push(fieldObj)}return Promise.resolve(fltrArr)}constSpecialFieldsArray(optobj,keyname,keyval){let optArr=[];return Object.keys(optobj).forEach(k=>{let t={};t[keyname]=k,t[keyval]=optobj[k],optArr.push(t)}),optArr}constOptValsForSalRevReason(jsonArr){let revReasonDataArr=[];return jsonArr.forEach(function(jsonObj){let tempDataJson={};tempDataJson.revisionid=jsonObj.ID,tempDataJson.revreason=ZPeople.decodeTxt(jsonObj.VALUE),revReasonDataArr.push(tempDataJson)}),revReasonDataArr}applyFilter(searchParams,osFltrObj,empStatus,approvalStatus){void 0==searchParams&&(searchParams=this.searchParams);var staticParams={};staticParams.orgStructureFilter=osFltrObj,staticParams.employeeStatus=empStatus,staticParams.approvalStatus=approvalStatus,this.searchParams=searchParams,this.staticParams=staticParams,this.loadSalRevData(searchParams,staticParams,void 0,!0,!1,!0)}handlePageEvents(){let layout=this.container,searchParams=this.searchParams?this.searchParams:void 0,staticParams=this.staticParams?this.staticParams:void 0;layout.find("i.PI_fltr").off().on("click",event=>{layout.toggleClass("zpl_fltr_flt")}),layout.find("#prevYr, #nxtYr").off().on("click",event=>{if(this.isNavCbkTriggered)return;let revSummaryDiv=layout.find("#revHistStats"),selInd=parseInt(layout.find("#currYr").attr("selInd")),selId=event.target.id;selInd="prevYr"==selId?selInd-1:selInd+1;let salRevsAccessYears=Compensation.SalRevision.Operations.salRevsAccessYears,yrToSel=salRevsAccessYears.filter(obj=>obj.ind==selInd),hasPrev=salRevsAccessYears.filter(obj=>obj.ind==selInd-1).length>0,hasNxt=salRevsAccessYears.filter(obj=>obj.ind==selInd+1).length>0;if(hasPrev?hasNxt?(layout.find("#prevYr").removeClass("gry").addClass("blu"),layout.find("#nxtYr").removeClass("gry").addClass("blu")):layout.find("#nxtYr").removeClass("blu").addClass("gry"):layout.find("#prevYr").removeClass("blu").addClass("gry"),yrToSel.length>0){revSummaryDiv.find("#totalRevStat").removeClass("zpl_act"),revSummaryDiv.find("#pendRevStat").removeClass("zpl_act"),revSummaryDiv.find("#procRevStat").removeClass("zpl_act"),revSummaryDiv.find("#rejCancelRevStat").removeClass("zpl_act");let from=yrToSel[0].from,to=yrToSel[0].to;layout.find("#currYr").attr("selInd",selInd),layout.find("#currYr").text(from+" - "+to),this.sIndex=1,this.isNavCbkTriggered=!0,this.loadSalRevData(searchParams,staticParams,void 0,!0)}}),layout.find("#compRecordDelete").off().on("click",event=>{let ele=$(event.currentTarget),isDelete="compRecordDelete"==ele.attr("id"),revIds=this.SELECTED_IDS,hasNotLatestRev=revIds&&revIds.length>0&&this.DATA.filter(x=>revIds.includes(x.recordId)&&"false"==x.isLatestRevision&&"Processed"==x.Revision_Status).length>0;hasNotLatestRev&&Compensation.Utils.showDeleteAlertMessage(new DeleteAlertMessage(ZPI18N.getString("zp.compensation.salaryRevRecordDeletionConfirmationHdr"),ZPI18N.getString("zp.compensation.isLatestRecordConfirm")),{callback:()=>{this.showPopUpforDelete(ele,revIds)},isCancelNeeded:!0,doneBtn:ZPI18N.getString("zp.proceed")}),isDelete&&!hasNotLatestRev&&this.showPopUpforDelete(ele,revIds)})}showPopUpforDelete(ele,recordIds){Compensation.Utils.showDoubleDeleteAlert(ZPI18N.getString("zp.compensation.salaryRevRecordDeletionConfirmationHdr"),ZPI18N.getString("zp.compensation.salaryRevRecordDeletionConfirmation")+" "+ZPI18N.getString("zp.deleteconfirmmessage"),{callback:()=>{recordIds.length>0&&(this.deleteSalRev(ele,recordIds,!0,!1),this.selectRecords(!0))}})}constructRevStatusFilter(){let layout=this.container;if(!layout.find("#revHistStats").length){let revStatsHtml=`<div id="revHistStats" class="zpl_topgrpmnu zpl_comptopgrpmnu">\n\t\t\t\t\t\t\t\t\t<ul class="zpl_tpcrdlst">\n\t\t\t\t\t\t\t\t\t\t<li id="totalRevStat" revStatus="-1">\n\t\t\t\t\t\t\t\t\t\t\t<span>${ZPI18N.getString("zp.compensation.total.revisions")}</span><b class="grn"></b>\n\t\t\t\t\t\t\t\t\t\t</li>`;revStatsHtml+=`<li id="pendRevStat" revStatus="1">\n\t\t\t\t\t\t\t\t\t<span>${ZPI18N.getString("zp.compensation.pending.revisions")}</span><b class="ylw"></b>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t<li id="procRevStat" revStatus="3">\n\t\t\t\t\t\t\t\t\t<span>${ZPI18N.getString("zp.compensation.processed.revisions")}</span><b class="grn"></b>\n\t\t\t\t\t\t\t\t</li>`,revStatsHtml+=`<li id="rejCancelRevStat" revStatus="4,5">\n\t\t\t\t\t\t\t\t<span>${ZPI18N.getString("zp.compensation.rejectedorcancelled.revisions")}</span><b class="red"></b>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t</ul>\n\t    \t\t\t</div>`,layout.find("#viewActionsContainer").after(revStatsHtml)}}handleSalRevSummaryEvents(){let revSummaryDiv=settingsPage.container.find("#revHistStats");revSummaryDiv.find("#pendRevStat").off().on("click",()=>{revSummaryDiv.find("#pendRevStat").addClass("zpl_act"),revSummaryDiv.find("#totalRevStat").removeClass("zpl_act"),revSummaryDiv.find("#procRevStat").removeClass("zpl_act"),revSummaryDiv.find("#rejCancelRevStat").removeClass("zpl_act"),this.sIndex=1,this.loadSalRevData(void 0,void 0,void 0,void 0,!0)}),revSummaryDiv.find("#procRevStat").off().on("click",()=>{revSummaryDiv.find("#totalRevStat").removeClass("zpl_act"),revSummaryDiv.find("#pendRevStat").removeClass("zpl_act"),revSummaryDiv.find("#procRevStat").addClass("zpl_act"),revSummaryDiv.find("#rejCancelRevStat").removeClass("zpl_act"),this.sIndex=1,this.loadSalRevData(void 0,void 0,void 0,void 0,!0)}),revSummaryDiv.find("#totalRevStat").off().on("click",()=>{revSummaryDiv.find("#totalRevStat").addClass("zpl_act"),revSummaryDiv.find("#pendRevStat").removeClass("zpl_act"),revSummaryDiv.find("#procRevStat").removeClass("zpl_act"),revSummaryDiv.find("#rejCancelRevStat").removeClass("zpl_act"),this.sIndex=1,this.loadSalRevData(void 0,void 0,void 0,void 0,!0)}),revSummaryDiv.find("#rejCancelRevStat").off().on("click",()=>{revSummaryDiv.find("#totalRevStat").removeClass("zpl_act"),revSummaryDiv.find("#pendRevStat").removeClass("zpl_act"),revSummaryDiv.find("#procRevStat").removeClass("zpl_act"),revSummaryDiv.find("#rejCancelRevStat").addClass("zpl_act"),this.sIndex=1,this.loadSalRevData(void 0,void 0,void 0,void 0,!0)})}removeSalRevCountDivClasses(){let revSummaryDiv=this.container.find("#revHistStats");revSummaryDiv.find("#totalRevStat").removeClass("zpl_act"),revSummaryDiv.find("#pendRevStat").removeClass("zpl_act"),revSummaryDiv.find("#procRevStat").removeClass("zpl_act"),revSummaryDiv.find("#rejCancelRevStat").removeClass("zpl_act")}deleteSalRev(ele,recordIds,isFromMultiSel=!1,isForcedDelete){ele.attr("disabled","disabled");var params={conreqcsr:csrfToken};recordIds&&recordIds.length>0&&(params.recordIds=JSON.stringify(recordIds),params.tableName="P_SalaryRevision",params.mode="DELETE",params.isForcedDelete=isForcedDelete),Compensation.Utils.sendReqAsPromise("/compensation/revisions/delete",params).then(resp=>{if(Compensation.Utils.commonErrorHandler(resp)){const layout=this.container;return ele.addClass("DN"),ele.prop("disabled",!1),void layout.find("#recordActionsContainer").addClass("DNI")}let skippedRecCount=resp.result.skippedRecCount,successRecCount=resp.result.successRecCount;if(0==skippedRecCount&&successRecCount>0?ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.compensation.recordDeletionSuccessMsg",[successRecCount])):skippedRecCount>0&&0==successRecCount?ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.compensation.recordDeletionSkippedMsg",[skippedRecCount])):skippedRecCount>0&&successRecCount>0?ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.compensation.recordDeletionWarningMsg",new Array(successRecCount,skippedRecCount))):0==skippedRecCount&&0==successRecCount&&ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.nomodification")),this.loadSalRevListView(this.searchParams,this.staticParams,void 0,!0),this.isEmpView){let userId=settingsUrlProps.urlParamsArr.recordId;Compensation.Utils.refreshPageForAction(Compensation.CONSTANTS.ACTIONTYPE.SALARY,userId),Compensation.SalRevision.Operations.singleRcdViewObj.getSalaryViewObj(Compensation.CONSTANTS.VIEWTYPE.OPER).refreshView()}const layout=this.container;ele.addClass("DN"),ele.prop("disabled",!1),layout.find("#recordActionsContainer").addClass("DNI")})}}Compensation.Salary||(Compensation.Salary={}),Compensation.Salary.Operations={viewObj:{},getViewObj:function(viewType,prop,refresh=!1){let viewObj=Compensation.Salary.Operations.viewObj;refresh&&viewObj[viewType]&&delete viewObj[viewType];let salViewObj=viewObj[viewType]?viewObj[viewType]:new salaryView(prop);return viewObj[viewType]=salViewObj,salViewObj},getFormDetails:function(){Compensation.Utils.getFormDetails.call(Compensation.Salary.Operations,"SalaryForm")},setModPrefix:function(){return{modulePrefix:Compensation.CONSTANTS.SERVICENAME+"-salary-listview",submode:Compensation.CONSTANTS.SERVICENAME+"-salary-listview"}},hashChangeCallback:function(){Layout.Page.hashDtl.hashArr.length>0&&Layout.Page.hashDtl.hashArr[0]!=Compensation.CONSTANTS.SERVICENAME&&settingsPage.container.find("#showdata").trigger("click")},init:function(){Compensation.Config.getConfiguration_asSync(!1),Compensation.Salary.Operations.getFormDetails(),settingsUrlProps.niceUrl.includes("salarydetails/team/salary")&&(ZPeople.Team.ReporteePageConf[ZPTabs.currMainTab]=Compensation.Salary.Operations.getTeamPgConfig())},initialListView:function(){Compensation.Salary.Operations.init();let prop={selMode:"All"};const viewType=Compensation.CONSTANTS.VIEWTYPE.OPER;prop.viewType=viewType;let salOprViewObj=Compensation.Salary.Operations.getViewObj(viewType,prop);return{wrapperClass:"Nbar5",dataCallback:()=>{salOprViewObj.constructView()},onchangeCallback:isSystemView=>{salOprViewObj.onViewSwitchCallback(isSystemView)},formId:Compensation.Salary.Operations.formDetails.formId,formLoadCallback:()=>{salOprViewObj.constructView()},systemViewName:Compensation.Salary.Operations.formDetails.formDispName,tableName:Compensation.Salary.Operations.formDetails.tableName,importExportConstructionCallback:eleId=>{salOprViewObj.constructImpExp("empSalMOpts",eleId)}}},showTeamMemRecord(recordId){Compensation.Salary.Operations.showSingleRecordView(recordId,!0)},showSingleRecordView(recordId,isTeamView=!1){let url=settingsUrlProps.niceUrl,urlParams=settingsUrlProps.urlParams,recUrl=url;isTeamView?recUrl="salarydetails/team/salary/view":recUrl.includes("/listview")?recUrl=recUrl.replace("/listview","/view"):recUrl+="/view",url="#"+recUrl+"-recordId:"+recordId,urlParams&&(url+="/"+urlParams),window.location.href=url},isTeamView:function(){return settingsPage.tabId.includes("-teamuser")},teamViewRecHandler:function(){Compensation.Salary.Operations.recHandler(!0,!0)},recHandler:function(isPgView,isTeamView){let recId=settingsUrlProps.urlParamsArr.recordId,prop={};prop.isTeamView=isTeamView,prop.isPgView=isPgView,isPgView?prop.container=settingsPage.container:prop.asModal=!0;const myView=new selfSalaryView(prop);void 0!=recId&&myView.constructPage(recId)},getTeamPgConfig:function(){let prop={selMode:"mydep"};const viewType=Compensation.CONSTANTS.VIEWTYPE.TEAM;prop.viewType=viewType,prop.skipTeamCnt=!0,prop.kbnViewDivId="team_kanbanview",prop.kbnViewContainerId="zpl_kban_switch";let teamObj=Compensation.Salary.Operations.getViewObj(viewType,prop),filterDetails={DEPARTMENT:{label:ZPI18N.getString("zp.department"),allLabel:ZPI18N.getString("zp.alldepartment")},DESIGNATION:{label:ZPI18N.getString("zp.designation"),allLabel:ZPI18N.getString("zp.alldesignation")}};return"true"==ZPeople.isStreamEnabled&&(filterDetails.STREAM={label:ZPI18N.getString("zp.streams"),allLabel:ZPI18N.getString("zp.allstream")}),{submode:"salarydetails",multipleView:!0,filterRequired:!0,filterDetails:filterDetails,isSearchNeeded:!0,profileLastRowHeader:()=>teamObj.profileLastHeadHtml,profileLastRowHtml:()=>teamObj.profileLastRowHtml,gridModuleDetailsCallback:()=>teamObj.constructTeamData.bind(teamObj),onclickCallback:()=>Compensation.Salary.Operations.showTeamMemRecord,tableModuleHeader:()=>teamObj.getTeamTblHdr,tableModuleDetailsCallback:()=>teamObj.getTeamTblData.bind(teamObj),kanbanArrayCallback:()=>teamObj.getKbnMenuList,kanbanOnClickCallback:()=>teamObj.kbnViewHandler.bind(teamObj),afterLoadCallback:()=>teamObj.postLoadCallback.bind(teamObj)}},initTeamView:function(){settingsUrlProps.currentMode=Compensation.CONSTANTS.TAB_NAME;let prop={selMode:"mydep"};const viewType=Compensation.CONSTANTS.VIEWTYPE.TEAM;prop.viewType=viewType;let salTeamViewObj=Compensation.Salary.Operations.getViewObj(viewType,prop);if(salTeamViewObj.isInit){Compensation.Salary.Operations.init();let layouthtml='<div id="topSettMenu" class="zpl_btnmnu zpl_DNI"></div>\n\t\t\t\t            <div class="zpl_btnmnu" id="viewActionsContainer"></div>\n\t\t\t\t\t\t\t<div class="zpl_rgtcnt zpl_mdltmvw" id="teamViewDiv"></div>';settingsPage.container.html(layouthtml)}salTeamViewObj.constructView()},initEmpSalOthersView:function(){settingsUrlProps.currentMode=Compensation.CONSTANTS.TAB_NAME;let prop={selMode:"All"};const viewType=Compensation.CONSTANTS.VIEWTYPE.OTHERS;prop.viewType=viewType;let salTeamViewObj=Compensation.Salary.Operations.getViewObj(viewType,prop);if(salTeamViewObj.isInit){Compensation.Salary.Operations.init();let layouthtml='<div id="topSettMenu" class="zpl_btnmnu zpl_DNI"></div>\n\t\t\t\t            <div class="zpl_btnmnu" id="viewActionsContainer"></div>\n\t\t\t\t\t\t\t<div class="zpl_rgtcnt zpl_mdltmvw" id="teamViewDiv"></div>';settingsPage.container.html(layouthtml)}salTeamViewObj.constructView()},addSalaryForUsr:function(userId,disable,callback,mode="add"){let prop={};callback&&(prop.addUpdateCallback=callback);let viewObj=Compensation.Salary.Operations.getViewObj(-1,prop,!0),userDtls=ZPeople.getUserDetailsById(userId),empPhoto=userDtls.avatar,empName=userDtls.empid+" "+userDtls.name,selUsr={id:userId,text:ZPeople.decodeTxt(empName),html:empName,photo:empPhoto,disableSelection:disable};viewObj.addUpdateSalaryModal(mode,selUsr)}};class salaryView{constructor(prop={}){this.isInit=!0,this.selMode=prop.selMode,this.modalInfo={},this.searchParams=void 0,this.staticParams=void 0,this.hasNext=!1,this.hasPrev=!1,this.compFltrObj=void 0,this.viewDataResp={},this.viewType=prop.viewType,this.isFromOpr=this.viewType==Compensation.CONSTANTS.VIEWTYPE.OPER,this.isTeamView=this.viewType==Compensation.CONSTANTS.VIEWTYPE.TEAM,this.isOthersView=this.viewType==Compensation.CONSTANTS.VIEWTYPE.OTHERS,this.container=settingsPage.container,this.viewProp={},this.init(),this.skipTeamCnt=prop.skipTeamCnt||!1,this.addUpdateCallback=prop.addUpdateCallback,this.kbnViewDivId=prop.kbnViewDivId||"empSalkbn",this.kbnViewContainerId=prop.kbnViewContainerId,this.impObj={},this.sortType={}}init(){Compensation.Utils.getZCompMethods()}getViewProp(viewId){return this.viewProp[viewId]}getSelView(){let viewids=this.getViewIds();return Object.keys(viewids).find(k=>viewids[k]==this.viewId)}setViewProp(viewId,prop){return this.viewProp[viewId]=prop,this.viewProp[viewId]}getUpdateModalHTML(){return`<div class="zpl_rgtcnt" aria-hidden="true">\n\t\t<div class="zpl_crd wd100_per">\n        <div class="zpl_crdcnt">\n \t\t\t<div class="DNI">\n            <div>\n              <label class="zpl_mtry">${ZPI18N.getString("zp.employee")}</label>`+`\n            </div>\n            <div>\n             <input id="selUserForRev" placeholder="${ZPI18N.getString("zp.select")}" class="select-js zselectbox" tabindex="-1">\n            </div>\n          </div>\n\t\t <div class="zpl_secn">\n            <div>\n              <label class="zpl_mtry">\n              \x3c!-- ${ZPI18N.getString("zp.local.CurrentCTC")} --\x3e\n              ${ZPI18N.getString("zp.local.currentsalary")}\n               <em>(${ZPI18N.getString("zp.compensation.perAnnum")})</em></label>`+`\n            </div>\n            <div class="ztextbox--group ztextbox--zicon zpl_inpticfild zh-alignleft">\n            \t<div class="w550 d-flex">\n                \t<i class="ztextbox__icon" id="currCode" disabled></i>\n               \t\t <input type="text" id="currentCTC" class="ztextbox is-disabled" disabled="">\n                </div> \n                <span class="ML10 DNI">\n            \t\t<a data-popup-open="" id="hideBrk" style="display: none;">${ZPI18N.getString("zp.compensation.HideBreakup")}</a>\n           \t\t\t <a data-popup-open="" id="viewBrk" style="">${ZPI18N.getString("zp.compensation.ViewBreakup")}</a>\n         \t\t </span>\n            </div>\n          </div>\n\t\t\n          <div class="zpl_secn">\n            <div>\n              <label class="zpl_mtry">\n              ${ZPI18N.getString("zp.local.revisedsalary")}\n               \n              <em>(${ZPI18N.getString("zp.compensation.perAnnum")})</em></label>`+`\n            </div>\n            <div class="ztextbox--group ztextbox--zicon zpl_inpticfild zh-alignleft w550">\n\t\t\t\t<i class="ztextbox__icon DNI" id="rev_currCode" disabled></i> \n\t\t\t\t<select id="rev_currCode" class="select-js w100 MR10" data-show-search-field="true" style="display: none;">\n\t\t\t\t</select>\n                <input type="text" class="ztextbox" id="revisedCTC"> \n            </div>\n            <div class="zpl_info DNI" id="revSalNote">\n               <i class="PI_warning"></i>\n               ${ZPI18N.getString("zp.compensation.SalaryRangeValidationCode")}\n            </div>\n          </div>\n          \n          <div class="zpl_secn">\n            <div>\n              <label class="zpl_mtry">${ZPI18N.getString("zp.compensation.revDifftitle")}</label>`+`\n            </div>\n            <div class="zpl_idiv w550">\n                <div class="ztextbox--group zh-alignleft">\n                    <i class="ztextbox__icon" id="revAmt_currCode" disabled></i>\n                    <input id="revAmt" type="text" placeholder="" class="ztextbox"> \n                </div>\n                <div class="ztextbox--group mw150">\n                    <i class="ztextbox__icon">%</i>\n                    <input id="revPerc" type="text" placeholder="" class="ztextbox w60"> \n                </div>                  \n            </div>\n          </div>\n\n          <div class="zpl_secn zpl_tblres" id="brkupDiv" style="display: none;" aria-hidden="true">\n            <div class="zpl_hdcnt">\n                <ul class="zpl_tabpane">\n                    <li ref="ctcDiv" class="zpl_act">\n                        <a>\n                        ${ZPI18N.getString("zp.componentPage.Title")}\n                        </a>\n                    </li>\n                    <li ref="benDiv" class="">\n                        <a>${ZPI18N.getString("zp.compensation.Benefits")}</a>\n                    </li>\n                </ul>\n            </div>\n            <div id="ctcDiv" name="compDiv">\n                <table class="zpl_tbl wd100_per">\n                    <thead>\n                        <tr>\n                            <th width="32%" class="zpl_posnon">${ZPI18N.getString("zp.comp.salary.component")}</th>\n                            <th width="28%" class="zpl_posnon">${ZPI18N.getString("zp.compensation.AssignedAmount")}</th>\n                            <th width="20%" class="zpl_posnon">${ZPI18N.getString("zp.compensation.perMonth")}</th>\n                            <th width="20%" class="zpl_posnon">${ZPI18N.getString("zp.compensation.perAnnum")}</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                       \n                    </tbody>\n\t\t\t\t\t<tfoot><tr><th width="32%">${ZPI18N.getString("zp.total")}</th><th width="28%"></th><th width="20%" name="monthly">0</th><th width="20%"  name="annually">0</th></tr></tfoot>\n                </table>\n            </div>\n\t\t\t<div id="benDiv" name="compDiv" style="display: none;">\n                <table class="zpl_tbl wd100_per">\n                    <thead>\n                        <tr>\n                            <th width="32%" class="zpl_posnon">${ZPI18N.getString("zp.comp.benefits.component")}</th>\n                            <th width="28%" class="zpl_posnon">${ZPI18N.getString("zp.compensation.AssignedAmount")}</th>\n                            <th width="20%" class="zpl_posnon">${ZPI18N.getString("zp.compensation.perMonth")}</th>\n                            <th width="20%" class="zpl_posnon">${ZPI18N.getString("zp.compensation.perAnnum")}</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                       \n                    </tbody>\n\t\t\t\t\t<tfoot><tr><th width="32%">${ZPI18N.getString("zp.total")}</th><th width="28%"></th><th width="20%" name="monthly">0</th><th width="20%"  name="annually">0</th></tr></tfoot>\n                </table>\n            </div>\n        </div>\n          <div class="zpl_secn">\n            <div>\n              <label class="zpl_mtry">${ZPI18N.getString("zp.leavetype.v2.entitlement.effectivefrom")}</label>`+`\n            </div>\n            <div class="w550">\n              <input id="effectiveDate" class="datepicker-js w550" style="display: none;">\n\t\t\t  \n            </div>\n          </div>\n\t\t\t<div class="zpl_secn">\n\t            <div>\n\t              <label class="zpl_mtry">${ZPI18N.getString("zp.compensation.reasonforRevision")}</label>`+`\n\t            </div>\n\t            <div class="w550">\n\t              <select id="reasonForChng" class="select-js zselectbox" data-show-search-field="true" style="display: none;">\n\t                \n\t              </select>\n\t            </div>\n          </div>\n          <div class="zpl_secn">\n            <div>\n              <label>${ZPI18N.getString("zp.remarks")}</label>\n            </div>\n            <div class="w550">\n              <textarea id="remarks" class="ztextbox mh60"></textarea>\n            </div>\n          </div>\n\t\t  <div class="zpl_secn w550">\n            <div class="zpl_info">\n                ${ZPI18N.getString("zp.compensation.revUpdateHelpNote")}\n            </div>\n          </div>\n        </div>\n      </div>\n      </div>`}getAddModalHTML(){return`<div class="zpl_rgtcnt" aria-hidden="true">\n\t\t<div class="zpl_crd wd100_per">\n        <div class="zpl_crdcnt">\n          <div class="zpl_secn">\n            <div>\n              <label class="zpl_mtry">${ZPI18N.getString("zp.employee")}</label>`+`\n            </div>\n            <div class="w550">\n             <input id="selUserForRev" placeholder="${ZPI18N.getString("zp.select")}" class="zselectbox" tabindex="-1">\n            </div>\n          </div>\n          <div class="zpl_secn">\n            <div>\n              <label class="zpl_mtry">${ZPI18N.getString("zp.compensation.SalaryPackage")}</label>`+`\n            </div>\n            <div class="w550">\n              <select id="salpckg" class="select-js" data-show-search-field="true" style="display: none;">\n              </select>\n            </div>\n          </div>\n          <div class="zpl_secn">\n            <div>\n              <label class="zpl_mtry">\n              \x3c!-- ${ZPI18N.getString("zp.local.CurrentCTC")} --\x3e\n              ${ZPI18N.getString("zp.local.currentsalary")} \n              <em>(${ZPI18N.getString("zp.compensation.perAnnum")})</em></label>`+`\n            </div>\n            <div class="ztextbox--group ztextbox--zicon zpl_inpticfild zh-alignleft">\n            \t<div class="w550 d-flex">\n\t\t\t\t\t<i class="ztextbox__icon DNI" id="rev_currCode" disabled></i>\n\t\t\t\t\t<select id="rev_currCode" class="select-js w100 MR10" data-show-search-field="true" style="display: none;">\n\t\t\t\t\t</select>\n\t                <input type="text" class="ztextbox" id="revisedCTC">\n                </div>\n                <span class="ML10 DNI">\n           \t\t <a data-popup-open="" id="hideBrk" style="display: none;">${ZPI18N.getString("zp.compensation.HideBreakup")}</a>\n            \t <a data-popup-open="" id="viewBrk" style="">${ZPI18N.getString("zp.compensation.ViewBreakup")}</a>\n          \t\t</span> \n            </div>\n              <div class="zpl_info DNI" id="revSalNote">\n               <i class="PI_warning"></i>\n               ${ZPI18N.getString("zp.compensation.SalaryRangeValidationCode")}\n            </div>\n          </div>\n          \n          \n          <div class="zpl_secn zpl_tblres" id="brkupDiv" style="display: none;">\n            <div class="zpl_hdcnt">\n                <ul class="zpl_tabpane">\n                    <li ref="ctcDiv" class="zpl_act">\n                        <a>\n                        ${ZPI18N.getString("zp.componentPage.Title")}\n                        </a>\n                    </li>\n                    <li ref="benDiv" class="">\n                        <a>${ZPI18N.getString("zp.compensation.Benefits")}</a>\n                    </li>\n                </ul>\n            </div>\n            <div id="ctcDiv" name="compDiv">\n                <table class="zpl_tbl wd100_per">\n                    <thead>\n                        <tr>\n                           <th width="32%" class="zpl_posnon">${ZPI18N.getString("zp.comp.salary.component")}</th>\n                            <th width="28%" class="zpl_posnon">${ZPI18N.getString("zp.compensation.AssignedAmount")}</th>\n                            <th width="20%" class="zpl_posnon">${ZPI18N.getString("zp.compensation.perMonth")}</th>\n                            <th width="20%" class="zpl_posnon">${ZPI18N.getString("zp.compensation.perAnnum")}</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                       \n                    </tbody>\n\t\t\t\t\t<tfoot><tr><th width="32%">${ZPI18N.getString("zp.total")}</th><th width="28%"></th><th width="20%" name="monthly">0</th><th width="20%"  name="annually">0</th></tr></tfoot>\n                </table>\n            </div>\n\t\t\t<div id="benDiv" name="compDiv" style="display: none;">\n                <table class="zpl_tbl wd100_per">\n                    <thead>\n                        <tr>\n                            <th width="32%" class="zpl_posnon">${ZPI18N.getString("zp.comp.benefits.component")}</th>\n                            <th width="28%" class="zpl_posnon">${ZPI18N.getString("zp.compensation.AssignedAmount")}</th>\n                            <th width="20%" class="zpl_posnon">${ZPI18N.getString("zp.compensation.perMonth")}</th>\n                            <th width="20%" class="zpl_posnon">${ZPI18N.getString("zp.compensation.perAnnum")}</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                    </tbody>\n\t\t\t\t\t<tfoot><tr style="display: none;"><th width="32%">${ZPI18N.getString("zp.total")}</th><th width="28%"></th><th width="20%" name="monthly">0</th><th width="20%"  name="annually">0</th></tr></tfoot>\n                </table>\n            </div>\n        </div>\n          <div class="zpl_secn">\n            <div>\n              <label class="zpl_mtry">${ZPI18N.getString("zp.leavetype.v2.entitlement.effectivefrom")}</label>`+`\n            </div>\n            <div class="w550">\n              <input id="effectiveDate" class="datepicker-js w550" style="display: none;">\n\t\t\t  \n            </div>\n          </div>\n          <div class="zpl_secn">\n            <div>\n              <label>${ZPI18N.getString("zp.remarks")}</label>\n            </div>\n            <div class="w550">\n              <textarea id="remarks" class="ztextbox"></textarea>\n            </div>\n          </div>\n        </div>\n      </div>\n      </div>`}constructLayout(){var layout=this.container;this.isTeamView?layout.addClass("zpl_setingopr"):$("#page-wrapper").addClass("zpl_btmpgn"),layout.find("#viewFooter").hide(),layout.find("#viewActionsContainer").find(".zpl_lft").find("#filterButton").hide(),layout.find("#viewActionsContainer").find(".zpl_lft").find(".zpl_selchklstall").addClass("DNI"),layout.find("#viewActionsContainer").find("#recordActionsContainer").addClass("DNI"),layout.find("#viewActionsContainer").find(".zpl_rgt:not(#zp_views_formrecactions)").addClass("DNI"),layout.find("#viewActionsContainer").find("#zp_views_formrecactions").removeClass("DNI"),layout.removeClass("lft3 zpl_tbllftfxd"),this.isInit&&(this.constructHeaders(),this.constructFooter(),this.constructImpExp("empSalMOpts_"+this.viewType,"moreOpt_"+this.viewType),this.constructSysFilter(),this.handlePgEvents())}constructHeaders(){let isTeamView=this.isTeamView,initTeamView=this.getInitTeamViewType();var layout=this.container,html="";let viewType=this.viewType;isTeamView&&(html+=`<div class="zpl_lft">\n                    <h5>${ZPI18N.getString("zp.members")} <span class="blu" id="teamCnt"></span></h5>\n                    <a id="showdata">${ZPI18N.getString("zp.show")}</a>\n               </div>`),html+='<div class="zpl_rgt" id="zp_views_formrecactions"><div class="j-cnt-cntr DNI"><ul id="salViewType" class="zpl_grpmnu"><li class="zpl_act" id="Team">'+ZPI18N.getString("zp.team")+'</li><li class="" id="Others">'+ZPI18N.getString("zp.others")+'</li></ul></div><button id="addSalary" class="zlabel zlabel--blue zlabel--medium DB">'+ZPI18N.getString("zp.compensation.addSalary")+'</button><i class="zpl_ibg PI_more" title="'+ZPI18N.getString("zp.more")+'" id="moreOpt_'+viewType+'" ref="more"></i></div>',layout.find("#viewActionsContainer").append(html),layout.find("#recordActionClose").remove(),layout.find("#recActDiv").html(`<button id="compRecordDelete" class="zlabel zlabel--red zlabel--medium">${ZPI18N.getString("zp.delete")}</button>`),layout.find("#recordActionsContainer").append('<i class="PI_cls" id="recordActionCompClose"></i>'),layout.find(".zpl_rgtcnt").append('<div id="noData"></div>');let grpBtns='<div class="grpbtn" id="grpBtn">\n                            <i class="PI_cardview" name="gridview"></i>\n                            <i class="PI_listview" name="listview"></i>\n                            <i class="PI_kanban" name="kbnview"></i>\n                        </div>';grpBtns+=`<div id="kbnMenu" class="zpl_drpdwn M0I"><ul  style="display:none;">\n\t\t\t\t\t\t<li data-item-type="itemgroup" style="display:none;">${ZPI18N.getString("zp.groupbasedon",new Array(""))}</li>\n\t\t\t\t\t\t\t<li id="designation">${ZPI18N.getString("zp.designation")}</li>\n\t\t\t\t\t\t\t<li id="location">${ZPI18N.getString("zp.locations")}</li>`,ZPeople.isStreamEnabled&&(grpBtns+=`<li id="streams">${ZPI18N.getString("zp.streams")}</li>`),grpBtns+=`<li id="experience">${ZPI18N.getString("zp.experience")}</li>\n\t\t\t\t\t\t\t<li id="package" style="display:none;">${ZPI18N.getString("zp.compensation.SalaryPackage")}</li>\n        \t\t\t</ul></div>`,layout.find(".zpl_rgt i[ref=more]").before('<i class="zpl_ibg PI_fltr" title="'+ZPI18N.getString("zp.filter")+'" id="salFltr"></i>'),isTeamView&&(layout.find(".zpl_rgtcnt").append('<div id="empSalgrd" class="zpl_emcrdlst DNI"></div>'),layout.find(".zpl_rgtcnt").append('<div id="empSalkbn" class="zpl_emptkban_view DNI"></div>'),layout.find("#addSalary").before(grpBtns),layout.find("#grpBtn i[name="+initTeamView+"]").addClass("zpl_act"),layout.find("#addSalary").remove(),ZPeopleComponents.menu("#kbnMenu",{forElement:layout.find("i[name=kbnview]"),appendTo:layout,itemclick:event=>{this.loadKbnView(event)},displayType:"callout"})),this.isFromOpr&&(Compensation.Salary.Operations.formDetails.isImportAllowed||Compensation.Salary.Operations.formDetails.isExportAllowed)||layout.find("i[ref=more]").remove();var tblHdr=`<div class="zpl_tblres ${!isTeamView||"listview"==initTeamView?"":"DNI"}" id="empSalLst">\n\t\t\t\t\t<table class="zpl_tbl clm40">\n\t\t\t\t\t\t<thead><tr>`;Compensation.Salary.Operations.formDetails.isDeleteAllowed&&(tblHdr+='<th class="w45"><div class="zcheckbox" id="recordActions" recordid="-1"><input type="checkbox" name="check" class="zcheckbox__helper"><label class="zcheckbox__label"></label></div></th>'),tblHdr+=`<th labelName="Employee"><div><span onmouseover="ZP5Views.mouseEnterFunction()">${ZPI18N.getString("zp.name")}</span><div class="zpl_icncnt"><i class="PI_sort" id="viewDefSorting"></i></div></div></th>\n\t\t\t\t\t\t\t<th><div><span>${ZPI18N.getString("zp.experience")}</span><div class="zpl_icncnt"></div></div></th>\n\t\t\t\t\t\t\t<th labelName="CTC"><div><span onmouseover="ZP5Views.mouseEnterFunction()">\n\t\t\t\t\t\t\t${ZPI18N.getString("zp.salary")}\n\t\t\t\t\t\t\t</span><div class="zpl_icncnt"><i class="PI_sort" id="viewDefSorting"></i></div></div></th>`,Compensation.Config.isTempEnabled&&(tblHdr+=`<th labelName="Template" ref='pckg'><div><span onmouseover="ZP5Views.mouseEnterFunction()">${ZPI18N.getString("zp.compensation.SalaryPackage")}</span><div class="zpl_icncnt"><i class="PI_sort" id="viewDefSorting"></i></div></div></th>`),tblHdr+=`<th labelName="Effective_Date"><div><span onmouseover="ZP5Views.mouseEnterFunction()">${ZPI18N.getString("zp.compensation.LastRevision")}</span><div class="zpl_icncnt"><i class="PI_sort" id="viewDefSorting"></i></div></div></th>\n\t\t\t\t\t\t\t<th></th>\n\t\t\t\t\t\t</tr></thead>\n\t\t\t\t\t\t<tbody></tbody>\n\t\t\t\t\t</table>\n\t\t\t\t</div>`,layout.find(".zpl_rgtcnt").append(tblHdr),this.container.find("[id=viewDefSorting]").off(),this.container.find("[id=viewDefSorting]").on("click",event=>{this.sortViewHandler(event)}),Compensation.PermissionBean.hasAccessPerm(Compensation.RoleBasedOperations.CP_CATEGORIES.COMPENSATION_DATA,Compensation.RoleBasedOperations.CP_ACCESS_TYPE.ADD_PERM)||layout.find("#addSalary").remove()}deleteSalRev(ele,recordIds,isFromMultiSel=!1,isForcedDelete){ele.attr("disabled","disabled");var params={conreqcsr:csrfToken};recordIds&&recordIds.length>0&&(params.recordIds=JSON.stringify(recordIds),params.tableName="P_EmployeeSalaryTemplate",params.mode="DELETE",params.isForcedDelete=isForcedDelete),Compensation.Utils.sendReqAsPromise("/compensation/revisions/delete",params).then(resp=>{if(Compensation.Utils.commonErrorHandler(resp)){const layout=this.container;return ele.addClass("DN"),ele.prop("disabled",!1),this.selectRecords(ele,!0),void layout.find("#recordActionsContainer").addClass("DNI")}var skippedRecCount=resp.result.skippedRecCount,successRecCount=resp.result.successRecCount;0==skippedRecCount&&successRecCount>0?ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.compensation.recordDeletionSuccessMsg",[successRecCount])):skippedRecCount>0&&0==successRecCount?ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.compensation.recordDeletionSkippedMsg",[skippedRecCount])):skippedRecCount>0&&successRecCount>0?ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.compensation.recordDeletionWarningMsg",new Array(successRecCount,skippedRecCount))):0==skippedRecCount&&0==successRecCount&&ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.nomodification")),Compensation.Utils.refreshPageForAction(Compensation.CONSTANTS.ACTIONTYPE.SALARY,recordIds[0]),Compensation.Salary.Operations.getViewObj(this.viewType,{}).refreshView();const layout=this.container;ele.addClass("DN"),ele.prop("disabled",!1),this.selectRecords(ele,!0),layout.find("#recordActionsContainer").addClass("DNI")})}selectRecords(ele,clear){const layout=this.container;Compensation.Utils.handleMultiSelect(layout,ele,selIds=>{this.SELECTED_IDS=selIds,this.handleActionBtns()},clear)}handleActionBtns(){const layout=this.container;layout.find("#recActDiv").find("#compRecordDelete").removeClass("DN"),layout.find("#recordActionsContainer").removeClass("DNI")}sortViewHandler(event){let labelName=$(event.target).parents("th").attr("labelName"),actionsList=[];actionsList.push({id:"sortHeader",text:ZPI18N.getString("zp.sort"),groupname:"viewsort",type:"itemgroup"}),actionsList.push({id:"sortAsc",text:ZPI18N.getString("zp.asc"),groupname:"viewsort",type:"checkbox"}),actionsList.push({id:"sortDesc",text:ZPI18N.getString("zp.desc"),groupname:"viewsort",type:"checkbox"}),Compensation.Utils.setSortMenu({id:"systemViewSorting",type:"list",displayType:"callout",contentType:"icon-text"},actionsList,event),ZPeopleComponents.menu("#systemViewSorting").destroy(),ZPeopleComponents.menu("#systemViewSorting",{randomDropdownListId:!0,forElement:event.target,className:"zpl_drpdwn",itemclick:event=>{let detail=event.detail;this.sortType[labelName]==("sortAsc"==detail.attrs.id)?(this.container.find("[labelName="+labelName+"]").children().children().children().removeClass("desc").removeClass("asc"),delete this.sortType[labelName]):this.sortType[labelName]="sortAsc"==detail.attrs.id,this.getEmpSalList(this.searchParam,this.staticParam,this.updatedCount),this.constructListView()}});let sortByAsc=0!=this.sortType.length?this.sortType[labelName]:void 0;ZPeopleComponents.menu("#systemViewSorting").setMenuItemsAttribute(["#sortAsc"],"checked",sortByAsc),ZPeopleComponents.menu("#systemViewSorting").setMenuItemsAttribute(["#sortDesc"],"checked",void 0!=sortByAsc?!sortByAsc:sortByAsc),ZPeopleComponents.menu("#systemViewSorting").show()}searchInSort(labelName,event){this.container.toggleClass("zpl_fltr_lft");let $fieldFilterContainer=$(this.container).find("#sysFltr"),$fieldelementSParent=$fieldFilterContainer.find("[id=filterfields][labelname="+labelName+"]");$($fieldFilterContainer.find("#fieldList").children()[0]).before($fieldelementSParent);let element=$fieldelementSParent.find("label");$(element).parent().find("input[type=checkbox]").is(":checked")?($(element).parent().find("input[type=checkbox]").removeAttr("checked"),$(element).parent().find("#filterOptions").slideUp()):$(element).parent().find("input[type=checkbox]").attr("checked","")}getMoreOpts(){var opts=[];return this.isTeamView||(opts.push({iClass:"PI_imprt",callback:this.handleImport,txt:ZPI18N.getString("zp.compensation.importInitialSalary"),id:"salaryImpIcon"}),opts.push({iClass:"PI_imprt",callback:this.handleImport,txt:ZPI18N.getString("zp.compensation.importRevision"),id:"revisionImpIcon"}),opts.push({iClass:"PI_imprt",callback:this.handleImport,txt:ZPI18N.getString("zp.compensation.importHistData"),id:"revHistImpIcon"})),opts.push({iClass:"PI_exprt",callback:this.handleExport,txt:ZPI18N.getString("zp.compensation.exportSalary"),id:"salaryExpIcon"}),opts}getRecCount(){if(this.isTeamView)this.getMemCntReq().then(memCntResp=>{let recCount=memCntResp.cnt;this.container.find("#sysviewFooter #view_recordcount").text(recCount)});else{let params={mode:"getRecordCount",formId:Compensation.Salary.Operations.formDetails.formId,viewId:Compensation.Salary.Operations.formDetails.viewId},searchParams=this.searchParams,staticParams=this.staticParams;void 0!=searchParams&&searchParams.length>0&&(params.searchBy=JSON.stringify(searchParams)),void 0!=staticParams&&(staticParams.hasOwnProperty("employeeStatus")&&void 0!=staticParams.employeeStatus&&(params.employeeStatus=staticParams.employeeStatus),staticParams.hasOwnProperty("approvalStatus")&&(params.approvalStatus=staticParams.approvalStatus),staticParams.hasOwnProperty("orgStructureFilter")&&Object.keys(staticParams.orgStructureFilter).length>0&&(params.orgStructureFilter=JSON.stringify(staticParams.orgStructureFilter))),ZPeople.Request.send("/viewAction.zp",params,data=>{if(7e3===data.code){let recCount=data.message.recordCount;this.container.find("#sysviewFooter #view_recordcount").text(recCount)}})}}moreOptsHtml(eleId){var optshtml='<div id="'+eleId+'" class="zpl_drpdwn zmenu zmenu--iconwithtext" data-type="list" data-content-type="icon-text" role="menu" data-display-type="callout"><ul data-body="true" class="zmenu__body">';return optshtml+=this.getMoreOpts().map(obj=>`<li data-action="${obj.callback}" data-icon-class="${obj.iClass}" id="${obj.id}" class="zmenu__item"><div class="zmenu__iconcontainer"><i class="zmenu__icon ${obj.iClass}"></i></div><span class="zmenu__text">${obj.txt}</span></li>`).join(""),optshtml+="</ul></div>"}addMenuItems(eleId,isInit){isInit&&this.getMoreOpts().forEach(item=>{ZPeopleComponents.menu(this.container.find("#"+eleId)).addMenuItem({label:item.txt,iconClass:item.iClass,id:item.id,action:(event,selItem)=>{item.callback.bind(this)(event,selItem)},displayType:"callout"})})}isImportAllowed(){return Compensation.Salary.Operations.formDetails.isImportAllowed}isExportAllowed(){return Compensation.Salary.Operations.formDetails.isExportAllowed}constructImpExp(eleId,forEle){if(!this.isImportAllowed()&&!this.isExportAllowed())return;var layout=this.container;let isInit=0==layout.find("#"+eleId).length;if(isInit){let mhtml=`<div id=${eleId} class="zpl_drpdwn zmenu zmenu--iconwithtext" data-type="list" data-content-type="icon-text" role="menu" data-display-type="callout"></div>`;layout.append(mhtml)}ZPeopleComponents.menu("#"+eleId,{forElement:"#"+forEle,appendTo:layout,displayType:"callout"}),this.addMenuItems(eleId,isInit),layout.find("#"+forEle).off().on("click",()=>{ZPeopleComponents.menu("#"+eleId).show()});let formId=Compensation.Salary.Operations.formDetails.formId,formObj=ZP5Form.getFormsOperation(formId),obj=formObj.getFormsDetailsMap();obj.isExportAllowed=Compensation.Salary.Operations.formDetails.isExportAllowed,obj.isImportAllowed=Compensation.Salary.Operations.formDetails.isImportAllowed,formObj.updateFormConf(obj)}getViewIds(){return{gridview:"empSalgrd",listview:"empSalLst",kbnview:this.kbnViewDivId}}constructListView(){this.isTeamView;let viewProp=this.getViewProp(this.viewId);viewProp||(viewProp=this.setViewProp(this.viewId,{refreshData:!0,sIndex:1,recLimit:10})),(viewProp.refreshData||this.isInit)&&(viewProp.sIndex=1,this.getEmpSalList.bind(this)(),viewProp.refreshData=!1)}canShowData(){return 0!=this.container.find("div.showData").length||!this.isTeamView}profileLastHeadHtml(){return`<th>${ZPI18N.getString("zp.experience")}</th>`}profileLastRowHtml(data){let yr=Math.floor(data.totExp/12),mn=data.totExp%12;return`<span>${yr} <em>${ZPI18N.getString("zp.years")}</em> ${mn} <em>${ZPI18N.getString("zp.months")}</em></span>`}constructTeamData(data){let hasSal=data&&""!=data.etid,val=data.ctc_fmt.replace(data.currCode,"").trim(),salVal=hasSal&&this.canShowData()?val:"",dataHtml=`<div name="salInfo" class="zpl_empTmInfo d-flexclmcap20">\n\t\t\t\t\t\t<div class="d-flexclmcap20">\n\t\t\t\t\t\t<div class="zpl_spltbrdR d-flexclmcap5 flex-dirC">\n\t\t\t\t\t\t\t\t\t\t<em>${hasSal?ZPI18N.getString("zp.compensation.LastRevision"):ZPI18N.getString("zp.dateofjoining")}</em>\n\t\t\t\t\t\t\t\t\t\t<b>${hasSal?data.effectiveFrom:_.isEmpty(data.doj)?"-":data.doj}</b>\n\t\t\t\t\t\t\t\t\t  </div>`;dataHtml+=`</div>                      \n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t  <div class="zpl_tg">\n\t\t\t\t\t\t\t<span class="flex-dirC">\n\t\t\t\t\t\t\t  <b name="info" class=${hasSal?"mask":""}>${hasSal?salVal:ZPI18N.getString("zp.comp.yettoadd")}</b>`+`<em>${ZPI18N.getString("zp.salary")+(hasSal?" ("+data.currCode+")":"")}</em>   \n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;const ele=$(dataHtml);return hasSal&&$(ele).on("unmask",()=>{$(ele).find("b.mask").text(val)}),ele}getTeamTblHdr(){let isTempEnabled=Compensation.Config.isTempEnabled,tblHdr=`<th width="200">${ZPI18N.getString("zp.salary")}</th>`;return isTempEnabled&&(tblHdr+=`<th>${ZPI18N.getString("zp.compensation.SalaryPackage")}</th>`),tblHdr+=`<th>${ZPI18N.getString("zp.compensation.LastRevision")}</th>`}getTeamTblData(data){let isTempEnabled=Compensation.Config.isTempEnabled,hasSal=data&&""!=data.etid,val=data.ctc_fmt.trim(),salVal=hasSal&&this.canShowData()?val:"",tblData=`<td width="200"><span class=${hasSal?"mask":""}>${hasSal?salVal:ZPI18N.getString("zp.comp.yettoadd")}</span></td>`;isTempEnabled&&(tblData+=`<td><span>${data.currentTemplate}</span></td>`),tblData+=`<td><span>${data.effectiveFrom}</span></td>`;const ele=$(tblData);return hasSal&&$(ele).find("span.mask").on("unmask",()=>{$(ele).find("span.mask").text(val)}),ele}getKbnMenuList(){let kbnMenu=[{label:ZPI18N.getString("zp.seniority"),filterType:"experience",index:0},{label:ZPI18N.getString("zp.designation"),filterType:"designation",index:1},{label:ZPI18N.getString("zp.locations"),filterType:"location",index:2}];return ZPeople.isStreamEnabled&&kbnMenu.push({label:ZPI18N.getString("zp.streams"),filterType:"streams",index:3}),kbnMenu}kbnViewHandler(filterType,event){this.currUserId=ZPeople.Team.erecno[ZPTabs.currMainTab],this.loadKbnView(event,filterType)}handleTeamPgEvent(){this.container.find("#showdata").on("click",event=>{this.toggleData()}),this.container.on("click","div[name=empCard]",event=>{let id=$(event.currentTarget).attr("id");Compensation.Salary.Operations.showSingleRecordView(id,this.isTeamView)})}postLoadCallback(){this.isInit&&(this.container.find("#salarydetails-team-btn_wrap").prepend(`<a id=showdata>${ZPI18N.getString("zp.show")}</a>`),this.handleTeamPgEvent(),this.isInit=!1,this.container.addClass("zpl_setingopr"))}getGridViewHtml(data){let hasSal=""!=data.etid,hasSub=data.hasSub&&1!=this.getViewProp(this.viewId).selRepType,hasChat=ZPeople.ISCHAT&&1==data.userType,yr=Math.floor(data.totExp/12),mn=data.totExp%12,salVal=hasSal&&this.canShowData()?data.ctc_fmt.replace(data.currCode,"").trim():"",ghtml=`<div class="zpl_dfcrd zpl_tmusrcrd" name="empCard" id="${data.erecNo}" status=${hasSal}>\n\t\t\t\t\t<div class="zpl_emcrdcnt">\n\t\t\t\t\t\t<div class="zpl_em">\n\t\t\t\t\t\t\t<div class="zpl_emimg">\n\t\t\t\t\t\t\t\t<img src="${data.empPhoto}">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="zpl_emdts zpl_ellipsis " style="">\n\t\t\t\t\t\t\t\t<div name="empName" class="">${ZSEC.Encoder.encodeForHTML(data.empNo)} - <b>${ZSEC.Encoder.encodeForHTML(data.name)}</b></div>\n\t\t\t\t\t\t\t\t<div class="zpl_ellipsis">\n\t\t\t\t\t\t\t\t\t<em>${ZSEC.Encoder.encodeForHTML(data.desgn)}</em>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div><span>${yr} <em>${ZPI18N.getString("zp.years")}</em> ${mn} <em>${ZPI18N.getString("zp.months")}</em></span></div>\n\t\t\t\t\t\t\t</div>`;ghtml+=`<div class="MLauto zpl_hvr zpl_hvrsw">${hasSub?'<i class="PI_subordinates"></i>':""} ${hasChat?`<i title="${ZPI18N.getString("zp.chatandcall")}" tabindex="0" uid="${data.zuid}" chat_comm="true" class="PI_pharw"></i>`:""}</div>`,ghtml+=`</div>\n\t\t\t\t\t\t<div class="zpl_empTmInfo d-flexclmcap20">\n\t\t\t\t\t\t\t<div class="d-flexclmcap20">\n\t\t\t\t\t\t\t  <div class="${hasSal?"zpl_spltbrdR":""} d-flexclmcap5 flex-dirC DNI">\n\t\t\t\t\t\t\t\t<em>${ZPI18N.getString("zp.experience")}</em>\n\t\t\t\t\t\t\t\t<b>${data.exp}</b>\n\t\t\t\t\t\t\t  </div>`,hasSal&&(ghtml+=`<div class="d-flexclmcap5 flex-dirC zpl_spltbrdR">\n\t\t\t\t\t\t\t\t<em>${ZPI18N.getString("zp.compensation.LastRevision")}</em>\n\t\t\t\t\t\t\t\t<b>${data.effectiveFrom}</b>\n\t\t\t\t\t\t\t  </div>`),ghtml+=`</div>                      \n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t  <div class="zpl_tg">\n\t\t\t\t\t\t\t\t<span class="flex-dirC">\n\t\t\t\t\t\t\t\t  <b name="info" class=${hasSal?"mask":""}>${hasSal?salVal:ZPI18N.getString("zp.comp.yettoadd")}</b>`+`<em>${ZPI18N.getString("zp.salary")+(hasSal?" ("+data.currCode+")":"")}</em>    \n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`;let ele=$(ghtml);return $(ele).find("i.PI_subordinates").on("click",function(event){ZPeople.Team.Reportee.getSubordinate(data.erecNo,data.empPhoto,data.name,data.empNo)}),ele}appendGridDataHtml(dataArr,appendTo){appendTo=appendTo||this.container.find("#"+this.viewId),dataArr.forEach(data=>{let dataHtml=this.getGridViewHtml(data);appendTo.append(dataHtml),this.setMaskEvent(data,appendTo)})}setMaskEvent(data,appendTo){if(""!=data.etid){let salData=data.ctc_fmt.replace(data.currCode,"").trim(),id=data.erecNo,ele=appendTo.find("#"+id);ele.on("unmask",function(event){$(ele).find("b[name=info]").text(salData)})}}toggleData(){let isMasked=!this.canShowData(),txt=isMasked?ZPI18N.getString("zp.hide"):ZPI18N.getString("zp.show");isMasked?this.container.find("div[name=empCard],div[name=salInfo],td>span.mask").trigger("unmask"):this.container.find("b.mask,span.mask").text(""),this.container.find("div.zpl_rgtcnt").toggleClass("showData"),this.container.find("#showdata").text(txt)}getParamsForTeamFetch(viewMode,searchParams,staticParams){let sIndex=this.getViewProp(this.viewId).sIndex;var params={conreqcsr:csrfToken,viewMode:viewMode};return params.startIndex=sIndex||1,void 0!=searchParams&&searchParams.length>0&&(params.searchBy=JSON.stringify(searchParams)),void 0!=staticParams&&(staticParams.hasOwnProperty("employeeStatus")&&void 0!=staticParams.employeeStatus&&(params.employeeStatus=staticParams.employeeStatus),staticParams.hasOwnProperty("approvalStatus")&&(params.approvalStatus=staticParams.approvalStatus),staticParams.hasOwnProperty("orgStructureFilter")&&Object.keys(staticParams.orgStructureFilter).length>0&&(params.orgStructureFilter=JSON.stringify(staticParams.orgStructureFilter)),staticParams.empViewType&&(params.empViewType=staticParams.empViewType)),this.currUserId&&(params.erecno=this.currUserId),params}getEmpSalGrid(){let viewProp=this.getViewProp(this.viewId);1==viewProp.sIndex&&this.container.find("#"+this.viewId).html("");let searchParams=this.searchParams,staticParams=this.staticParams,viewMode=Compensation.CONSTANTS.VIEWMODE.GRID,params=this.getParamsForTeamFetch(viewMode,searchParams,staticParams),loader=new LoadingClass(this.container);loader.add();let noDataHtml=this.getNoDataHtml();Compensation.Utils.sendReqAsPromise("/compensation/salary/getTeamView",params).then(dataResp=>{let salDets=dataResp.salDetsArr;salDets.length>0?(ZPLite.Firescroll.setFetchedCount(this.viewId,salDets.length),viewProp.sIndex=ZPLite.Firescroll.getStartIndex(this.viewId),this.appendGridDataHtml(salDets),noDataHtml.remove()):noDataHtml.show(),loader.remove()})}scrollHandler(viewMode,groupBy,grpId){switch(viewMode){case Compensation.CONSTANTS.VIEWMODE.GRID:this.getEmpSalGrid();break;case Compensation.CONSTANTS.VIEWMODE.KANBAN:this.getEmpSalKnb(groupBy,grpId)}}constructGridView(){let griddiv=this.container.find("#teamViewDiv").find("#empSalgrd"),viewProp=this.getViewProp(this.viewId);viewProp||(viewProp=this.setViewProp(this.viewId,{refreshData:!0,sIndex:1})),viewProp.refreshData&&(ZPLite.Firescroll.resetFetchedCount(this.viewId),viewProp.sIndex=1,griddiv.html(""),this.getEmpSalGrid(),viewProp.refreshData=!1,ZPLite.Firescroll.reset(this.container,this.viewId),ZPLite.Firescroll.init(this.container,this.viewId,{maxFetchLimit:200,callback:()=>{this.scrollHandler.bind(this)(Compensation.CONSTANTS.VIEWMODE.GRID)}}))}setDataForGrp(salData,appendTo){this.appendGridDataHtml(salData,appendTo)}getKbnViewHtml(grpObj){let dataHtml="";for(let grp in grpObj){let grpData=grpObj[grp],grpInfo=grpData.groupInfo,title=ZSEC.Encoder.encodeForHTML(grpInfo.dispName),salData=grpData.salDetsArr;dataHtml=`<div id="${grpInfo.id}" class="zpl_emptkban_view">\n\t\t\t\t\t    <div name="scrollDiv" class="zpl_emptkban_lst">\n\t\t\t\t\t        <div>\n\t\t\t\t\t            <div class="zpl_emptkban_hder">\n\t\t\t\t\t                <h5>${title}</h5><span>${grpInfo.grpCnt}</span>\n\t\t\t\t\t            </div>\n\t\t\t\t\t            <div class="zpl_emptkban_bdy" name="empSalgLst">\n\t\t\t\t\t            </div>\n\t\t\t\t\t        </div>\n\t\t\t\t\t    </div> \n\t\t\t\t\t</div>`,this.container.find("#"+this.viewId).append(dataHtml);let appendTo=this.container.find("#"+this.viewId).find("div#"+grpInfo.id+" div[name=empSalgLst]");this.setDataForGrp(salData,appendTo)}}setGroupInfo(grpId,grpData){let groupProp=this.viewProp[this.viewId].groupProp,groupInfo=groupProp[grpId]?groupProp[grpId]:{};groupInfo.isLastPage=grpData.salFormObj.message.isLastPage,ZPLite.Firescroll.setFetchedCount(grpId,grpData.salDetsArr.length),groupInfo.sIndex=ZPLite.Firescroll.getStartIndex(grpId),groupProp[grpId]=groupInfo}initFireScrollForGrp(knbnData){this.container.find("#"+this.viewId+" .zpl_emptkban_view").each((ind,ele)=>{let grpId=$(ele).attr("id");ZPLite.Firescroll.resetFetchedCount(grpId);let scrollDiv=$(ele).find("div[name=scrollDiv]");ZPLite.Firescroll.reset(scrollDiv,grpId),ZPLite.Firescroll.init(scrollDiv,grpId,{maxFetchLimit:25,callback:()=>{this.scrollHandler.bind(this)(Compensation.CONSTANTS.VIEWMODE.KANBAN,knbnData,grpId)}})})}getGroupProp(grpId){return this.viewProp[this.viewId].groupProp[grpId]}getEmpSalKnb(knbnData,groupId){let groupBy=knbnData.filterType,searchTerm=knbnData.searchedTerm,viewProp=this.getViewProp(this.viewId);viewProp.groupBy=groupBy;let isInitLoad=!groupId;isInitLoad&&this.container.find("#"+this.viewId).html(""),knbnData.filterValues&&(this.searchParams=[JSON.parse(knbnData.filterValues)]);let searchParams=this.searchParams,staticParams=this.staticParams,viewMode=Compensation.CONSTANTS.VIEWMODE.KANBAN,params=this.getParamsForTeamFetch(viewMode,searchParams,staticParams);params.groupBy=groupBy,_.isEmpty(searchTerm)||(params.searchTerm=searchTerm);let loader=$(`<div id='loadingWrap'>${ZPeople.LOADING_HTML}</div>`);if(groupId){let groupProp=this.getGroupProp(groupId);params.groupId=groupId,params.startIndex=groupProp.sIndex}else this.container.find("#team_kanbanview").parent("div").append(loader);params.selRepType=knbnData.selectedReportees,viewProp.selRepType=params.selRepType;let noDataHtml=`<div id="nodatadiv" class="zpl_Emptydata"> <div> <div class="zpl_emptimg zp_nd_empprfl"></div> <h4>${ZPI18N.getString("zp.nofilterrecord")}</h4></div> </div>`;Compensation.Utils.sendReqAsPromise("/compensation/salary/getTeamView",params).then(dataResp=>{if(this.container.find("#team_kanbanview").parent("div").find("#nodatadiv").remove(),dataResp[groupBy]&&dataResp[groupBy].length>0){let respCnt=dataResp.COUNT;this.container.find("#dCnt").text(respCnt.DIRECT),this.container.find("#aCnt").text(respCnt.ALL);let dataObj=dataResp[groupBy];if(groupId){if(dataObj.length>0){let salData=dataObj[0][groupId].salDetsArr,appendTo=this.container.find("#"+this.viewId+" div[id="+groupId+"]").find("div[name=empSalgLst]");this.setDataForGrp(salData,appendTo)}}else dataObj.forEach(grpObj=>this.getKbnViewHtml(grpObj));isInitLoad&&this.initFireScrollForGrp(knbnData),dataObj.forEach(obj=>{let grpId=Object.keys(obj)[0],grpData=obj[grpId];this.setGroupInfo(grpId,grpData)})}else this.container.find("#team_kanbanview").parent("div").append(noDataHtml);groupId||loader.remove(),ZPeopleComponents.isComponent(this.container.find("#kbnMenu"))&&ZPeopleComponents.menu("#kbnMenu").hide()})}refreshKbnView(groupBy){let viewProp=this.getViewProp(this.kbnViewDivId);viewProp&&(viewProp.refreshData=!0)}constructKbnView(groupBy){let kbndiv=this.container.find("#teamViewDiv").find("#"+this.viewId),viewProp=this.getViewProp(this.viewId);viewProp||(viewProp=this.setViewProp(this.viewId,{refreshData:!0,sIndex:1,groupBy:groupBy,groupProp:{}})),!groupBy&&viewProp.groupBy&&(groupBy=viewProp.groupBy),viewProp.refreshData&&(kbndiv.html(""),this.getEmpSalKnb(groupBy),viewProp.refreshData=!1)}getInitTeamViewType(){return"gridview"}loadView(selView,groupBy){let viewIds=this.getViewIds(),kbnViewContainer=this.kbnViewContainerId?this.container.find("#"+this.kbnViewContainerId):this.container;kbnViewContainer.removeClass("zpl_emptkban_switch"),this.container.find("#grpBtn .zpl_act").removeClass("zpl_act"),this.container.find("#grpBtn i[name="+selView+"]").addClass("zpl_act"),0==this.container.find("#noData").children().length&&this.container.find("#"+viewIds[selView]).removeClass("DNI");for(let view in viewIds){let viewId=viewIds[view];view!=selView?this.container.find("#"+viewId).addClass("DNI"):this.viewId=viewId}this.isTeamView&&!this.skipTeamCnt&&this.setTeamMemCnt(),this.container.find("#sysviewFooter").addClass("zpl_DNI"),"listview"==selView?(this.container.find("#sysviewFooter").removeClass("zpl_DNI"),this.constructListView()):"gridview"==selView?this.constructGridView():"kbnview"==selView&&(kbnViewContainer.addClass("zpl_emptkban_switch"),this.constructKbnView(groupBy))}constructView(){0==this.container.find("#empSalLst").length&&(this.isInit=!0);let isTeamView=this.isTeamView;this.constructLayout();let selView=isTeamView?this.isInit?this.getInitTeamViewType():this.getSelView(this.viewId):"listview";this.loadView(selView),this.isInit=!1}constructFooter(){let selViewType=this.container.find("#grpBtn .zpl_act").attr("name"),isTeamView=this.isTeamView,fHtml=`<div class="zpl_tblpagination ${"listview"==selViewType||!isTeamView?"":"DNI"}" id="sysviewFooter">\n\t\n                    \t<div class="zpl_lftpgn">\n                            <span>\n                            \t<label>${ZPI18N.getString("zp.totalrecordcount")}&nbsp;:&nbsp;</label>\n                            \t<a id="view_recordcount">#</a>\n                            </span>\n                        </div>\n   \n                        <div class="zpl_rhtpgn">\n   \n                            <select data-width="70" class="zselectbox select-js ${isTeamView?"disabled":""}" id="sys_recordsPerPage" style="display: none;">\n\t\t\t\t\t\t\t\t<optgroup label="${ZPI18N.getString("zp.records")}">\n                                \t<option value="10">10</option>\n                                \t<option value="20">20</option>\n                                \t<option value="30">30</option>\n                                \t<option value="40">40</option>\n                                \t<option value="50">50</option>\n                                \t<option value="75">75</option>\n                                \t<option value="100">100</option>\n                                \t<option value="200">200</option>\n\t\t\t\t\t\t\t\t</optgroup>\n                            </select>\n   \n                            <div class="pagecount" id="viewPagination">\n                                <a class="zpl_prev gry" id="previousPage"></a>\n                                <span id="viewPageCount"><b>1&nbsp;-&nbsp;10</b></span>\n                                <a class="zpl_nxt blu CP" id="nextPage"></a>\n                            </div>\n                        </div>\n                    </div>`;this.container.find("div.zpl_rgtcnt").after(fHtml),this.handleFooterEvents.bind(this)()}handleFooterEvents(){ZPeopleComponents.select(this.container.find("#sysviewFooter #sys_recordsPerPage"),{randomDropdownListId:!0,change:event=>{if(!event.detail.fromUI)return;let updateCount=event.detail.selectedValue,viewProp=this.getViewProp(this.viewId);viewProp.sIndex=1,viewProp.recLimit=updateCount,this.getEmpSalList(void 0,void 0,updateCount)}}),this.container.find("#sysviewFooter").find("#nextPage,#previousPage").on("click",event=>{let selId=$(event.currentTarget).attr("id"),viewProp=this.getViewProp(this.viewId),itr="nextPage"==selId?viewProp.recLimit:-1*viewProp.recLimit;this.handlePagination(itr)})}handlePagination(itr){let viewProp=this.getViewProp(this.viewId);(itr>0?this.hasNext:this.hasPrev)&&(viewProp.sIndex+=itr,this.getEmpSalList())}setPaginationTxt(start,recCount,recLimit,isLastRec=!1){let viewProp=this.getViewProp(this.viewId),end=recCount+start-1;this.container.find("#sysviewFooter #viewPageCount").html(`<b>${start}&nbsp;-&nbsp;${end}</b>`),this.hasNext=!isLastRec,viewProp.recLimit=recLimit,this.hasPrev=start>viewProp.recLimit,this.hasPrev?this.container.find("#sysviewFooter #previousPage").addClass("blu cp"):this.container.find("#sysviewFooter #previousPage").removeClass("blu cp"),this.hasNext?this.container.find("#sysviewFooter #nextPage").addClass("blu cp"):this.container.find("#sysviewFooter #nextPage").removeClass("blu cp"),0!=this.container.find("#sysviewFooter #sys_recordsPerPage").length&&ZPeopleComponents.select(this.container.find("#sysviewFooter #sys_recordsPerPage")).setValue(recLimit)}switchMode(){var layout=this.container;let actTab=layout.find("#salViewType .zpl_act"),tabId=layout.find("#salViewType :not(.zpl_act)").addClass("zpl_act").attr("id");actTab.removeClass("zpl_act"),this.selMode=tabId,this.getEmpSalList.bind(this)()}getParamsForSalFetch(searchParams,staticParams,updatedCount){var mode="mydep"==this.selMode?"Team":this.selMode;let viewProp=this.getViewProp(this.viewId);var params={conreqcsr:csrfToken,mode:mode};void 0!=viewProp.sIndex?params.startIndex=viewProp.sIndex:(params.startIndex=1,viewProp.sIndex=1),this.isFromOpr?params.compDataType=Compensation.CONSTANTS.DATAMODE.ADMIN_DATA:this.isOthersView&&(params.compDataType=Compensation.CONSTANTS.DATAMODE.NONADMIN_DATA);let value="";for(var keys=void 0!=this.sortType?Object.keys(this.sortType):"",x=0;x<keys.length;x++){var key=keys[x];value+=key+":"+this.sortType[key]+";",this.sortType[key]?this.container.find("[labelName="+key+"]").children().children().children().removeClass("desc").addClass("asc"):this.container.find("[labelName="+key+"]").children().children().children().removeClass("asc").addClass("desc")}return params.sortBy=value,params.version=5,updatedCount&&(params.updateCount=updatedCount),void 0!=searchParams&&searchParams.length>0&&(params.searchBy=JSON.stringify(searchParams)),void 0!=staticParams&&(staticParams.hasOwnProperty("employeeStatus")&&void 0!=staticParams.employeeStatus&&(params.employeeStatus=staticParams.employeeStatus),staticParams.hasOwnProperty("approvalStatus")&&(params.approvalStatus=staticParams.approvalStatus),staticParams.hasOwnProperty("orgStructureFilter")&&Object.keys(staticParams.orgStructureFilter).length>0&&(params.orgStructureFilter=JSON.stringify(staticParams.orgStructureFilter))),params}setTeamMemCnt(){this.getMemCntReq().then(memCntResp=>{let memCnt=memCntResp.cnt;this.viewDataResp.teamCnt=memCnt,this.container.find("#teamCnt").text(memCnt)})}getMemCntReq(){if(this.viewDataResp.teamCnt)return Promise.resolve({cnt:this.viewDataResp.teamCnt});let memCntParams={},staticParam=this.staticParams;return this.isTeamView&&staticParam&&(memCntParams.empViewType=staticParam.empViewType),Compensation.Utils.sendReqAsPromise("/compensation/salary/getTeamCount",memCntParams)}getEmpSalList(searchParam,staticParam,updatedCount){searchParam=searchParam||this.searchParams,staticParam=staticParam||this.staticParams;let viewMode=Compensation.CONSTANTS.VIEWMODE.LIST,params=this.isTeamView?this.getParamsForTeamFetch(viewMode,searchParam,staticParam):this.getParamsForSalFetch(searchParam,staticParam,updatedCount),loader=new LoadingClass(this.container.find("#empSalLst"));loader.add(),Compensation.Utils.sendReqAsPromise("/compensation/salary/list",params).then(dataResp=>{this.loadData.call(this,dataResp,loader)})}showRevisions(revId){window.location.href=Layout.Page.hash.replace("/listview","")+"/viewrevision-recordId:"+revId}actionTypeHandler(selItem){switch(selItem.value){case"-1":case"0":let mode="-1"==selItem.value?"add":"update";return void this.addUpdateSalaryModal(mode,selItem);case"1":return void this.showRevisions(selItem.id)}}getNoDataHtml(){var emptyhtml=new EmptyPages("zp_nd_nodata",ZPI18N.getString("zp.norec"),"",this.container.find("#noData"));return Compensation.PermissionBean.hasAccessPerm(Compensation.RoleBasedOperations.CP_CATEGORIES.COMPENSATION_DATA,Compensation.RoleBasedOperations.CP_ACCESS_TYPE.ADD_PERM)&&emptyhtml.setButton(ZPI18N.getString("zp.compensation.addSalary"),()=>this.addUpdateSalaryModal("add")),emptyhtml}loadData(resp,loader){let salDetArr=resp.salDetsArr,emptyhtml=this.getNoDataHtml(),viewProp=this.getViewProp(this.viewId);if(salDetArr.length>0){var dataHtml=this.IterateSalData(salDetArr);this.container.find("#empSalLst").find("tbody").html(dataHtml);let sIndex=viewProp.sIndex;ZPeopleComponents.splitbutton(this.container.find("#empSalLst").find("tbody").find('button[name="revActBtn"]'),{change:event=>{event.stopPropagation();var selItem=event.detail.selectedItem[0].itemData;this.actionTypeHandler(selItem)},buttonclick:event=>{event.stopPropagation()},click:event=>{if(event.stopPropagation(),!event.detail.isMenuButton){var selItem=event.detail.selectedItem[0].itemData;this.actionTypeHandler(selItem)}}}),ZPeopleComponents.button(this.container.find("#empSalLst").find("tbody").find('button[name="viewRev"],button[name="revSal"],button[name="addSal"]'),{click:event=>{let ele=event.detail.element,selItem={value:ele.attr("data-value"),id:ele.attr("id")};if("addSal"==ele.attr("name")){let empPhoto=ele.parents("tr").find("div.zpl_emimg img").attr("src"),empName=ele.parents("tr").find("div[name=empName]").text();selItem={...selItem,text:ZPeople.decodeTxt(empName),html:empName,photo:empPhoto}}this.actionTypeHandler(selItem)}}),this.container.find("#empSalLst").removeClass("DNI");let frmMsg=resp.salFormObj.message;this.setPaginationTxt(sIndex,salDetArr.length,frmMsg.recordsLimit,frmMsg.isLastPage),1==sIndex&&(this.container.find("#sysviewFooter").find("#view_recordcount").text("#"),this.container.find("#sysviewFooter").find("#view_recordcount").off("click"),this.container.find("#sysviewFooter").find("#view_recordcount").one("click",()=>{this.getRecCount()})),this.container.find("#sysviewFooter").removeClass("DNI"),emptyhtml.remove()}else this.container.find("#sysviewFooter").addClass("DNI"),this.container.find("#empSalLst").addClass("DNI"),emptyhtml.show();loader.remove()}getActionsHtml(etid,erecNo,lastRevId,pendingRevId,isAllowedToAdd,isAllowedToEdit,isAllowedToViewRev){let actionHtml="";if(this.isTeamView)return actionHtml;let hasSal=!_.isEmpty(etid),hasPendingRev=void 0!=pendingRevId&&!_.isEmpty(pendingRevId);return!hasSal&&isAllowedToAdd?actionHtml+=`<button name="addSal" id="${erecNo}" data-value='-1' class="zlabel zlabel--blue zlabel--outline zlabel--medium">${ZPI18N.getString("zp.compensation.addSalary")}</button>`:hasPendingRev?actionHtml+=`<button name="viewRev" id="${pendingRevId}" data-value='1' class="zlabel zlabel--blue zlabel--outline zlabel--medium">${ZPI18N.getString("zp.compensation.viewPendingRevision")}</button>`:isAllowedToEdit&&isAllowedToViewRev?(actionHtml+=`<button name="revActBtn" id="revActionBtn_${etid+"_"+this.viewType}" data-menu-id="revActMenuId_${etid+"_"+this.viewType}" data-value='0'>${ZPI18N.getString("zp.compensation.reviseSalary")}</button>`,actionHtml+=`<ul id=revActMenuId_${etid+"_"+this.viewType} class="w100" name="revActBtn" style='display:none;' data-append-to="#${settingsPage.container.attr("id")}">`,actionHtml+=`<li data-item-type='radio' name='revActLi' data-value='0' id="${erecNo}">${ZPI18N.getString("zp.compensation.reviseSalary")}</li>`,actionHtml+=`<li data-item-type='radio' name='revActLi' data-value='1' id="${lastRevId}">${ZPI18N.getString("zp.compensation.viewRevision")}</li>`,actionHtml+="</ul>"):(isAllowedToEdit&&(actionHtml+=`<button name="revSal" id=${erecNo}  data-value='0' class="zlabel zlabel--blue zlabel--outline zlabel--medium">${ZPI18N.getString("zp.compensation.reviseSalary")}</button>`),isAllowedToViewRev&&(actionHtml+=`<button name="viewRev" id="${lastRevId}"  data-value='1' class="zlabel zlabel--blue zlabel--outline zlabel--medium">${ZPI18N.getString("zp.compensation.viewRevision")}</button>`)),actionHtml}IterateSalData(salDataArr){let dataHtml="",canShowData=this.canShowData();for(var i=0;i<salDataArr.length;i++){var salData=salDataArr[i],erecNo=salData.erecNo;let pendingRevId=salData.activeRevId,etid=salData.etid,hasSal=!_.isEmpty(etid),empId=ZSEC.Encoder.encodeForHTML(salData.empNo),fullname=ZSEC.Encoder.encodeForHTML(salData.name),desgn=ZSEC.Encoder.encodeForHTML(salData.desgn),exp=salData.exp,empPhoto=salData.empPhoto,effectiveFrom=salData.effectiveFrom,ctc_fmt=hasSal?canShowData?salData.ctc_fmt:"":ZPI18N.getString("zp.comp.yettoadd"),currentTemplate=ZSEC.Encoder.encodeForHTML(salData.currentTemplate),isAllowedToAdd=salData.isAllowedToAdd,isAllowedToEdit=salData.isAllowedToEdit,isAllowedToViewRev=salData.isAllowedToViewRev,lastRevId=salData.lastRevId,isDeleteAllowed=Compensation.Salary.Operations.formDetails.isDeleteAllowed;dataHtml+=`<tr id=${erecNo}>`,isDeleteAllowed&&(dataHtml+='<td iseditable="true" isDeleteAllowed="'+isDeleteAllowed+`">\n\t\t\t\t    \t\t      <div class="zcheckbox" id="recordActions" recordid="${erecNo}"><input type="checkbox" name="check" value="" class="zcheckbox__helper">\n\t\t\t\t    \t\t       <label class="zcheckbox__label"></label>\n\t\t\t\t    \t\t      </div>\n\t\t\t\t    \t\t</td>`),dataHtml+=`<td>\n\t                                <div class="zpl_em">\n\t                                    <div class="zpl_emimg"><img src="${empPhoto}"></div>\n\t                                    <div class="zpl_emdts">\n\t                                        <div name="empName"><em>${empId} - </em><b>${fullname}</b></div>\n\t                                        <div><em>${desgn}</em></div>\n\t                                    </div>\n\t                                </div>\n\t                            </td>\n\t                            <td><span>${exp}</span></td>\n\t                            <td><span>${ctc_fmt}</span></td>`,Compensation.Config.isTempEnabled&&(dataHtml+=`<td ref="pckg"><span>${currentTemplate}</span></td>`),dataHtml+=`<td><span>${effectiveFrom}</span></td> <td>`,dataHtml+=this.getActionsHtml(etid,erecNo,lastRevId,pendingRevId,isAllowedToAdd,isAllowedToEdit,isAllowedToViewRev),dataHtml+="</td></tr>"}return dataHtml}onViewSwitchCallback(isSystemView){var layout=this.container;if(isSystemView)layout.find("#viewFooter").hide(),layout.find("#viewActionsContainer").find(".zpl_lft").find("#filterButton").hide(),layout.find("#viewActionsContainer").find(".zpl_lft").find(".zpl_selchklstall").addClass("DNI"),layout.find("#viewActionsContainer").find("#recordActionsContainer").addClass("DNI"),layout.find("#viewActionsContainer").find(".zpl_rgt:not(#zp_views_formrecactions)").addClass("DNI"),layout.find("#viewActionsContainer").find("#zp_views_formrecactions.zpl_rgt").removeClass("DNI"),layout.find("#viewActionsContainer").find("#salFltr").removeClass("DNI"),layout.find(".zpl_tblres:not(#empSalLst)").hide(),layout.find("#empSalLst.zpl_tblres").show(),layout.find("#filterContainer").addClass("DN"),layout.find("#formsviewmenuicontxt").hide(),layout.find("#sysFltr").removeClass("DNI"),layout.find("#sysviewFooter").removeClass("DNI"),layout.find("#filterResultsHeader").addClass("DN"),this.container.removeClass("zpl_fltrvwfxd"),void 0!=this.compFltrObj&&this.compFltrObj.filterResult.length>0&&layout.find("#sys_filterResultsHeader").removeClass("DN"),layout.hasClass("lft5")&&layout.removeClass("lft5");else{layout.find("#viewFooter").show(),layout.find("#viewActionsContainer").find(".zpl_lft").find("#filterButton").show(),layout.find("#viewActionsContainer").find(".zpl_lft").find(".zpl_selchklstall").removeClass("DNI"),layout.find("#viewActionsContainer").find("#recordActionsContainer").removeClass("DNI"),layout.find("#viewActionsContainer").find(".zpl_rgt:not(#zp_views_formrecactions)").removeClass("DNI"),layout.find("#viewActionsContainer").find("#zp_views_formrecactions.zpl_rgt").addClass("DNI"),layout.find("#viewActionsContainer").find("#salFltr").addClass("DNI"),layout.find(".zpl_tblres:not(#empSalLst)").show(),layout.find("#empSalLst.zpl_tblres").hide(),layout.find("#viewType").hide(),layout.find("#addRecordButton").addClass("DNI"),layout.find("#filterContainer").removeClass("DN");let addBtn=layout.find("#viewActionsContainer").find(".zpl_rgt:not(#zp_views_formrecactions)").find("#addSalary");0==addBtn.length&&(addBtn=$(`<button id="addSalary" class="zlabel zlabel--blue zlabel--medium DB">${ZPI18N.getString("zp.compensation.addSalary")}</button>`),$(addBtn).on("click",event=>{this.addUpdateSalaryModal("add")}),layout.find("#viewActionsContainer").find(".zpl_rgt:not(#zp_views_formrecactions)").prepend(addBtn)),layout.find("#formsviewmenuicontxt").show(),layout.find("#sysFltr").addClass("DNI"),layout.find("#sysviewFooter").addClass("DNI"),layout.find("#sys_filterResultsHeader").addClass("DN"),this.isFromOpr&&(Compensation.Salary.Operations.formDetails.isImportAllowed||Compensation.Salary.Operations.formDetails.isExportAllowed)||layout.find("#formsviewmenuicontxt.PI_more").remove()}Compensation.Utils.removeLoading()}handlePgEvents(){this.container.find("#empSalgrd,#"+this.viewId).on("click","div[name=empCard]",event=>{let id=$(event.currentTarget).attr("id");Compensation.Salary.Operations.showSingleRecordView(id,this.isTeamView)}),this.container.find("#empSalLst tbody").on("click","tr td:not(:first-child):not(:last-child)",event=>{let recordId=$(event.currentTarget).parent().attr("id");Compensation.Salary.Operations.showSingleRecordView(recordId,this.isTeamView)}),this.container.find("#recordActionCompClose").off().on("click",event=>{this.selectRecords($(event.currentTarget))}),this.container.find("#empSalLst ").off().on("click","div#recordActions",event=>{this.selectRecords($(event.target).parent("div"))}),this.container.find("#compRecordDelete").off().on("click",event=>{let ele=$(event.currentTarget),selectedIds=this.SELECTED_IDS,prop={selMode:"All"};const viewType=Compensation.CONSTANTS.VIEWTYPE.OPER;prop.viewType=this.viewType,Compensation.Utils.showDoubleDeleteAlert(ZPI18N.getString("zp.compensation.salaryRecordDeletionConfirmationHdr"),ZPI18N.getString("zp.compensation.salaryRecordDeletionConfirmation")+" "+ZPI18N.getString("zp.deleteconfirmmessage"),{callback:()=>{if(selectedIds.length>0){let salaryViewObj=Compensation.Salary.Operations.getViewObj(viewType,prop),revIds=selectedIds;salaryViewObj.deleteSalRev(ele,revIds,!0,!1)}}})});this.isTeamView;this.container.find("i.PI_fltr").on("click",event=>{this.container.toggleClass("zpl_fltr_flt")}),this.container.find("[id=addSalary]").on("click",event=>{this.addUpdateSalaryModal("add")}),this.container.find("#grpBtn").on("click","i",event=>{let selView=$(event.currentTarget).attr("name");"kbnview"==selView?ZPeopleComponents.menu("#kbnMenu").show():this.loadView(selView)}),this.container.find("#showdata").on("click",event=>{this.toggleData()})}loadKbnView(event,filterType){var itemid=filterType||event.detail.id;this.refreshKbnView(itemid),this.loadView("kbnview",itemid)}getModalHdrFtr(mode,data){let hdr,ftr;return"update"==mode?hdr=` <div class="d-flexcap flex-dirC flex-grow a-itm-left">\n\t            <div>\n\t                <h4>${ZPI18N.getString("zp.compensation.reviseSalary")}</h4>\n\t            </div>\n\t            <div class="zpl_em j-cnt-btwen wd100_per">\n\t                <div class="zpl_emimg" id="empPhoto"></div>\n\t                <div class="zpl_emdts" id="empDets">\n\t                   \n\t                </div>\n\t                <div id="salPckgDiv" class="MLauto d-flexclmcap5 flex-dirC MR10 VHI ">\n\t                    <div>\n\t                        <label>${ZPI18N.getString("zp.compensation.ApplicableSalaryPackages")}</label>\n\t                    </div>\n\t                    <div>\n\t                       <select id="salpckg" class="select-js" data-show-search-field="true" style="display: none;"></select>\n\t                    </div>\n\t                </div>\n\t            </div>\n\t        </div>\n\t      \t<a id="sliderCls" class="_cls PI_cls"></a>`:"view"==mode&&(hdr=`    <div class="d-flex">\n\t\t\t\t      <div class="zpl_em w550">\n\t\t\t\t          <div class="zpl_emimg"><img src="${data.empPhoto}"></div>\n\t\t\t\t          <div class="zpl_emdts">\n\t\t\t\t              <div><em>${data.empNo} - </em><b>${ZSEC.Encoder.encodeForHTML(data.name)}</b></div><em>${ZSEC.Encoder.encodeForHTML(data.desgn)}</em><div><em>${ZSEC.Encoder.encodeForHTML(data.department)}</em></div>\n\t\t\t\t          </div>\n\t\t\t\t      </div>\n\t\t\t\t      <div class="d-flex flex-grow DNI" style="font-size: 13px;">\n\t\t\t\t          <ul class="d-flexclmcap5 flex-dirC flex-basis50">\n\t\t\t\t              <li class="d-flex">\n\t\t\t\t                  <em class="w150">${ZPI18N.getString("zp.dateofjoining")}:</em>\n\t\t\t\t                  <span>${data.doj}</span>\n\t\t\t\t              </li>\n\t\t\t\t              <li class="d-flex">\n\t\t\t\t                  <em class="w150">${ZPI18N.getString("zp.local.CurrentCTC")}:</em>\n\t\t\t\t                  <span>${data.ctc_fmt}</span>\n\t\t\t\t              </li>            \n\t\t\t\t          </ul>\n\t\t\t\t          <ul class="d-flexclmcap5 flex-dirC flex-basis50">\n\t\t\t\t              <li class="d-flex">\n\t\t\t\t                  <em class="w150">${ZPI18N.getString("zp.experience")}:</em>\n\t\t\t\t                  <span>${data.exp}</span>\n\t\t\t\t              </li>\n\t\t\t\t              <li class="d-flex">\n\t\t\t\t                  <em class="w150">${ZPI18N.getString("zp.department")}:</em>\n\t\t\t\t                  <span>${data.department}</span>\n\t\t\t\t              </li>\n\t\t\t\t          </ul>\n\t\t\t\t      </div>\n\t\t\t\t    </div>\n\t\t\t\t    <a id="sliderCls" class="_cls PI_cls"></a>`,ftr=`<button id="sliderCancel" type="button" class="zlabel zlabel--outline zlabel--medium">${ZPI18N.getString("zp.close")}</button>`),"view"!=mode&&(ftr=`<div class="zpl_frm_mfoter"> <button id="sliderSbt" type="button" class="zlabel zlabel--blue zlabel--medium">${ZPI18N.getString("zp.save")}</button><button id="sliderDraft" type="button" class="zlabel zlabel--outline zlabel--medium DNI">${ZPI18N.getString("zp.saveasdraft")}</button><button id="sliderCancel" type="button" class="zlabel zlabel--outline zlabel--medium">${ZPI18N.getString("zp.cancel")}</button></div>`),[hdr,ftr]}setEmpDetHdr(salDiv,empDet){let isSampleData=!!empDet.isSampleData&&empDet.isSampleData,modalHdr=salDiv.find("#sliHdrDiv");modalHdr.find("#empPhoto").html(`<img src="${empDet.empPhoto}">`),modalHdr.find("#empDets").html(`<div><em>${ZSEC.Encoder.encodeForHTML(empDet.empNo)} - </em><b>${ZSEC.Encoder.encodeForHTML(empDet.empName)}</b>${isSampleData?"<span class='zbadges zbadges--green zpl_ml2' id='sample_data_badge'>Sample Data</span>":""}</div>\n\t\t\t<div><em>${empDet.empDesgn}</em></div>\n\t\t\t<span><em>${empDet.empExp} - </em><em>${ZPI18N.getString("zp.compensation.LastRevisionOn",new Array(""))}</em><span>${empDet.empLastRevDate}</span></span>`)}editRev(mode,revDtls){let initSel={id:revDtls.erecno,text:ZPeople.decodeTxt(revDtls.Employee),html:revDtls.Employee,photo:revDtls.empPhoto};this.addUpdateSalaryModal(mode,initSel,revDtls)}addUpdateSalaryModal(mode,selUsr,revDtls){let ttl="add"==mode?ZPI18N.getString("zp.compensation.addSalary"):ZPI18N.getString("zp.compensation.reviseSalary");const sModObj=new sliderModal(ttl,new Tab("salModal",()=>{let addSalhtml="add"==mode?this.getAddModalHTML():this.getUpdateModalHTML();this.container.find("#cardsalModal").html(addSalhtml)},()=>{this.addUpdateSalary(mode)}));sModObj.fullPageSize=!0,sModObj.hdrExtraCls="zpl_htat scrlshdw",sModObj.cntExtraCls="flex-dirC";let[hdr,ftr]=this.getModalHdrFtr(mode);sModObj.construct(hdr,ftr),sModObj.construct(hdr),sModObj.setCloseCallback(()=>{this.onModalClose.bind(this)(mode)}),this.modalInfo[mode]=sModObj;let salDiv=sModObj.sliderDiv;ZPeopleComponents.datefield(salDiv.find("#effectiveDate"),{calendarIcon:!0,picker:!0,format:dateFmt,spinButtons:"none",clearButton:"none"});let searchMode=this.isTeamView?"COMPENSATION_SALARYADDITION_TEAMSEARCH":"COMPENSATION_SALARYADDITION_USERSEARCH";if(Compensation.Utils.constructEmpSearchFld("selUserForRev","select",searchMode,(resp,event)=>{let selErecno=ZPeopleComponents.select("#selUserForRev").getValue();this.getSalDetForModal.bind(this)(selErecno,mode,revDtls)},salDiv,()=>{var extraParams={};return this.isFromOpr?extraParams.compDataType=Compensation.CONSTANTS.DATAMODE.ADMIN_DATA:this.isOthersView&&(extraParams.compDataType=Compensation.CONSTANTS.DATAMODE.NONADMIN_DATA),extraParams}),"add"==mode&&(Compensation.Config.configObj.isTemplateConfigurationEnabled?ZPeopleComponents.select(salDiv.find("#salpckg"),{dropdownList:{appendTo:salDiv},randomDropdownListId:!0}):salDiv.find("#salpckg").parents(".zpl_secn").addClass("DNI")),selUsr){selUsr.hidden=!1;const disableSel=void 0==selUsr.disableSelection||selUsr.disableSelection;ZPeopleComponents.select(salDiv.find("#selUserForRev")).setValue(selUsr),disableSel&&ZPeopleComponents.select(salDiv.find("#selUserForRev")).setAttribute("disabled",!0)}let revId=revDtls&&revDtls.recordId?revDtls.recordId:void 0;this.handleModalEvents(mode,revId)}getSalDetForModal(selErecno,mode,revDtls){var params={conreqcsr:csrfToken,erecno:selErecno};ZPeople.Request.send("/compensation/salary/getUpdatePage",params,resultData=>{this.handleSalDiv.bind(this)(resultData,mode,revDtls),resultData.configObj.isTemplateConfigurationEnabled&&(Compensation.otherPackagesList=resultData.availableTemplate.tempDetails,Compensation.salRangeList=resultData.availableTemplate.salRangeData,Compensation.currTempId=resultData.tid),Compensation.confCurrList=resultData.confCurrList,Compensation.empCurrId=resultData.empSalaryInfo.currencyId})}checkAndChangePackage(value,mode,isOnchangeRevCtc){if(!Compensation.Config.isTempEnabled)return;let salDiv=this.modalInfo[mode].sliderDiv,selPckg=ZPeopleComponents.select(salDiv.find("#salpckg")).getValue(),comparedPckg=[];var isAnyMatchFound=!1,canShowNote=!1;if(Compensation.Config.isTempEnabled){if(!Compensation.otherPackagesList||0==Compensation.otherPackagesList.length)return void ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.compensation.revisionErrMsg.failedToFetchPackageInfo",[ZPeople.peopleSupportEmail]));for(i=0;i<Compensation.otherPackagesList.length;i++){let salPackageData=Compensation.otherPackagesList[i],pckgId=salPackageData.tid;isAnyMatchFound=this.checkSalRangeValid(salPackageData,parseInt(value)).isValid,salDiv.find("#revSalNote").addClass("DNI"),isAnyMatchFound||pckgId!=selPckg||(canShowNote=!0),!isAnyMatchFound&&(pckgId!=Compensation.currTempId&&pckgId!=selPckg||comparedPckg.hasOwnProperty(pckgId))&&0!=salPackageData.appFor.SALARYRANGE.operator||comparedPckg.push(Compensation.otherPackagesList[i])}canShowNote&&salDiv.find("#revSalNote").removeClass("DNI"),salDiv.find("#salpckg").parents(".zpl_secn").removeClass("DNI"),salDiv.find("#salPckgDiv").removeClass("VHI"),salDiv.find("#viewBrk").parents("span").removeClass("DNI"),this.setSalPckg(salDiv,comparedPckg,selPckg,void 0,isOnchangeRevCtc)}else{salDiv.find("#viewBrk").parents("span").addClass("DNI"),salDiv.find("#salpckg").parents(".zpl_secn").addClass("DNI"),salDiv.find("#salPckgDiv").addClass("VHI");let currOpts=this.getCurrOptHtml(Compensation.confCurrList,Compensation.empCurrId);this.setCurrOpts(salDiv,currOpts)}}handleModalEvents(mode,revId){let salDiv=this.modalInfo[mode].sliderDiv;salDiv.find("#sliderDraft").on("click",()=>{this.addUpdateSalary.call(this,mode,!0,revId)}),salDiv.find("#hideBrk,#viewBrk").off("click"),salDiv.find("#hideBrk,#viewBrk").on("click",event=>{let ele=$(event.currentTarget);ele.hide().siblings().show(),"viewBrk"==ele.attr("id")?salDiv.find("#brkupDiv").show():salDiv.find("#brkupDiv").hide()}),salDiv.find("#brkupDiv").off("click"),salDiv.find("#brkupDiv").on("click","li",event=>{let ele=$(event.currentTarget);salDiv.find("#brkupDiv li.zpl_act").removeClass("zpl_act"),ele.addClass("zpl_act");let tabid=ele.attr("ref");this.showBreakup(salDiv,tabid)}),salDiv.find("#revisedCTC,#revAmt,#revPerc").on("change",event=>{let ele=$(event.currentTarget);var salinp=salDiv.find("#revisedCTC");const id=ele.attr("id");new Promise(resolve=>{if("update"==mode){let revCTC,revAmt,revPerc;revCTC=salDiv.find("#revisedCTC").getZValue(),revAmt=salDiv.find("#revAmt").getZValue(),revPerc=salDiv.find("#revPerc").getZValue(),this.recalculateRevDetails(salDiv,revCTC,revAmt,revPerc,id).then(()=>{resolve()})}else resolve()}).then(()=>{this.onCTCChange(salDiv,salinp),this.checkAndChangePackage(salDiv.find("#revisedCTC").getZValue(),mode,!0)})}),salDiv.find("#revisedCTC,#revAmt,#revPerc").off("keyup"),salDiv.find("#revisedCTC,#revAmt,#revPerc").on("keyup",event=>{let ele=$(event.currentTarget);var salinp=salDiv.find("#revisedCTC");const id=ele.attr("id");new Promise(resolve=>{if("update"==mode){let revCTC,revAmt,revPerc;"revisedCTC"==id?revCTC=salDiv.find("#revisedCTC").getZValue():"revAmt"==id?revAmt=salDiv.find("#revAmt").getZValue():"revPerc"==id&&(revPerc=salDiv.find("#revPerc").getZValue()),this.recalculateRevDetails(salDiv,revCTC,revAmt,revPerc,id).then(()=>{resolve()})}else resolve()}).then(()=>{this.onCTCChange(salDiv,salinp)})})}parseSalResp(mode,resultData,revDtls){var retObj={},empSalaryInfo=resultData.empSalaryInfo;return retObj.mode=mode,retObj.etid=empSalaryInfo.etid,retObj.empNo=ZSEC.Encoder.encodeForHTML(empSalaryInfo.empNo),retObj.empPhoto=empSalaryInfo.empPhoto,retObj.isSampleData=empSalaryInfo.isSampleData,retObj.empName=empSalaryInfo.name,retObj.empExp=empSalaryInfo.exp,retObj.empDesgn=ZSEC.Encoder.encodeForHTML(empSalaryInfo.desgn),retObj.empCtc=revDtls&&revDtls.Current_Salary?revDtls.Current_Salary:empSalaryInfo.ctc,retObj.doj=empSalaryInfo.doj,retObj.empLastRevDate=empSalaryInfo.effectiveFrom,retObj.empCurrId=revDtls&&revDtls.oldCurrencyId?revDtls.oldCurrencyId:empSalaryInfo.currencyId,retObj.hasBreakupView=resultData.hasBreakupPerm,retObj.hasBenefitsView=resultData.hasBenefitsPerm,retObj.appPckgs=resultData.availableTemplate?resultData.availableTemplate.tempDetails:[],retObj.homeCurrObj=resultData.confCurrList.filter(obj=>obj.is_home_currency),retObj.currPckg=empSalaryInfo.currentTemplate,retObj.tid=revDtls&&revDtls.tid?revDtls.tid:empSalaryInfo.tid,retObj.erecNo=empSalaryInfo.erecNo,retObj.activeRevId=empSalaryInfo.activeRevId,retObj.currCode=revDtls&&revDtls.oldCurrency?revDtls.oldCurrency:empSalaryInfo.currCode,retObj.effDate=revDtls&&revDtls.Effective_Date?revDtls.Effective_Date:"add"==mode?retObj.doj:void 0,retObj}validateSelPckg(salDiv,appPckgs,seltid,revCTC,fromOnSalPck){let[isValid,errMsg,isFromSalRng]=this.isValidPckg(appPckgs,seltid,revCTC,fromOnSalPck);return isValid?(salDiv.find("#revSalNote").addClass("DNI"),ZPeopleComponents.select(salDiv.find("#salpckg")).getElement().removeClass("ztextbox__error"),salDiv.find("#salpckg").parent("div").find("span.ztextbox--error__label").remove()):isFromSalRng?salDiv.find("#revSalNote").removeClass("DNI"):(ZPeopleComponents.select(salDiv.find("#salpckg")).getElement().removeClass("ztextbox__error"),salDiv.find("#salpckg").parent("div").find("span.ztextbox--error__label").remove(),ZPeopleComponents.select(salDiv.find("#salpckg")).getElement().addClass("ztextbox__error"),salDiv.find("#salpckg").parent("div").append('<span class="ztextbox--error__label">'+ZPI18N.getString("zp.compensation.package.isNotApplicableForEmp")+"</span>")),[isValid,errMsg,isFromSalRng]}getCurrOptHtml(currList,selCurr){return currList.map(obj=>`<option id="${obj.currencyid}" ${void 0!=selCurr&&selCurr==obj.currencyid?"selected":""}>${obj.currencycode}</option>`).join("")}setCurrOpts(salDiv,optHtml){let prop={dropdownList:{appendTo:salDiv},randomDropdownListId:!0,change:()=>{let selCode=salDiv.find("select#rev_currCode").getZTxt();salDiv.find("#rev_currCode").text(selCode),salDiv.find("#revAmt_currCode").text(selCode);let revCTC=salDiv.find("#revisedCTC").getZValue();this.recalculateRevDetails(salDiv,revCTC)}};salDiv.find("select#rev_currCode").html(optHtml),salDiv.find("select#rev_currCode").destroyEle(),ZPeopleComponents.select(salDiv.find("select#rev_currCode"),prop);let selCode=salDiv.find("select#rev_currCode").getZTxt();salDiv.find("#revAmt_currCode").text(selCode),salDiv.find("#rev_currCode").text(selCode),salDiv.find("select#rev_currCode").parents("div.ztextbox--group").removeClass("zh-alignleft")}handleSalDiv(resultData,mode,revDtls){if(Compensation.Utils.commonErrorHandler(resultData))return;var isTempEnabled=resultData.configObj.isTemplateConfigurationEnabled;Compensation.Config.isTempEnabled=isTempEnabled;let salDiv=this.modalInfo[mode].sliderDiv;this.setReason(salDiv,resultData.reasonList);let confCurrList=resultData.confCurrList,respObj=this.parseSalResp(mode,resultData,revDtls);salDiv.data("empSalInfo",respObj),this.setEmpDetHdr(salDiv,respObj),Compensation.Utils.removeNewInlineErrTxt(salDiv);var erecNo=respObj.erecNo;if("add"==mode&&_.isEmpty(respObj.doj)){let dojErrMsg=ZPI18N.getString("zp.compensation.revisionErrMsg.dojNotUpdated");if(isadmin){let paramArr=[`<a onclick="Compensation.Utils.updateEmpRec('${erecNo}',false)">${ZPI18N.getString("zp.dateofjoining")}</a>`];dojErrMsg=ZPI18N.getString("zp.compensation.revisionErrMsg.dojAdminErr",paramArr)}return void this.showErr(salDiv.find("#selUserForRev"),dojErrMsg)}let appPckgs=respObj.appPckgs;respObj.etid,respObj.empPhoto,respObj.empName,respObj.empExp,respObj.empDesgn;var empCurr=respObj.currCode,empCtc=respObj.empCtc,empCurrId=(respObj.doj,respObj.empLastRevDate,respObj.empCurrId),hasBreakupView=respObj.hasBreakupView,hasBenefitsView=respObj.hasBenefitsView;respObj.homeCurrObj,respObj.currPckg,respObj.tid;if(salDiv.find("#currCode").text(empCurr),salDiv.find("#currentCTC").val(empCtc),isTempEnabled){if(!appPckgs||0==appPckgs.length)return void ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.compensation.revisionErrMsg.failedToFetchPackageInfo",[ZPeople.peopleSupportEmail]));salDiv.find("#salpckg").parents(".zpl_secn").removeClass("DNI"),salDiv.find("#salPckgDiv").removeClass("VHI"),salDiv.find("#viewBrk").parents("span").removeClass("DNI");let currPckg=respObj.tid;this.setSalPckg(salDiv,appPckgs,currPckg,revDtls,!1)}else{salDiv.find("#viewBrk").parents("span").addClass("DNI"),salDiv.find("#salpckg").parents(".zpl_secn").addClass("DNI"),salDiv.find("#salPckgDiv").addClass("VHI");let currOpts=this.getCurrOptHtml(confCurrList,empCurrId);this.setCurrOpts(salDiv,currOpts)}if(void 0!=resultData.empSalaryInfo){if(hasBreakupView||hasBenefitsView){0!=salDiv.find("#viewBrk:visible").length&&salDiv.find("#viewBrk").show();let btabId=hasBreakupView?hasBenefitsView?void 0:"benDiv":"ctcDiv";btabId&&(salDiv.find("li[ref="+btabId+"]").remove(),salDiv.find("#"+btabId).remove()),salDiv.find("#brkupDiv li:first").addClass("zpl_act"),btabId=salDiv.find("#brkupDiv li.zpl_act").attr("ref"),salDiv.find("#"+btabId).show()}else salDiv.find("#viewBrk").parents("span").addClass("DNI");respObj.effDate&&ZPeopleComponents.datefield(salDiv.find("#effectiveDate")).setValue(respObj.effDate),revDtls&&this.setRevDet(salDiv,mode,revDtls)}else ModuleComp.Msg.showFailureMsg(ZPI18N.getString("zp.compensation.revisionErrMsg.failedToFetchEmployeeSalary",[ZPeople.peopleSupportEmail]))}setRevDet(salDiv,mode,revDtls){salDiv.find("#remarks").val(revDtls.Remarks),"update"==mode&&(salDiv.find("#revisedCTC").val(revDtls.Revised_Salary),salDiv.find("#revAmt").val(revDtls.Revised_Amount),salDiv.find("#revPerc").val(revDtls.Revised_Percentage))}isValidPckg(pckgList,pckgId,revCtc,fromOnSalPck){let isValid=!0,isFromSalRng=!1,errCode=ZPI18N.getString("zp.compensation.package.isNotApplicableForEmp");if(""!=pckgId){if(!pckgList||0==pckgList.length||0==pckgList.filter(pobj=>pobj.tid==pckgId&&pobj.isValid).length)return[!1,errCode];if(!fromOnSalPck){let packData=pckgList.filter(pobj=>pobj.tid==pckgId),isValidJson=this.checkSalRangeValid(packData.length>0?packData[0]:{},revCtc);isValid=isValidJson.isValid,errCode=isValidJson.errCode,isFromSalRng=isValidJson.isFromSalRng}}return[isValid,errCode,isFromSalRng]}checkSalRangeValid(packData,revCtc){let isValid=!1,errCode=ZPI18N.getString("zp.compensation.SalaryRangeValidationCode");if(isNaN(revCtc)&&_.isEmpty(revCtc)){if(isNaN(revCtc)||_.isEmpty(revCtc))return{isValid:!0,errCode:errCode,isFromSalRng:!0}}else if(packData){let operator=packData.appFor.SALARYRANGE.operator;if(isValid=0==operator,0!=operator){let from=parseInt(packData.appFor.SALARYRANGE.from),to=parseInt(packData.appFor.SALARYRANGE.to);switch(operator){case Compensation.CONSTANTS.COMPARISON.EQUAL:return{isValid:isValid=from==revCtc,errCode:errCode,isFromSalRng:!0};case Compensation.CONSTANTS.COMPARISON.LESS_THAN:return{isValid:isValid=revCtc<from,errCode:errCode,isFromSalRng:!0};case Compensation.CONSTANTS.COMPARISON.GREATER_THAN:return{isValid:isValid=revCtc>from,errCode:errCode,isFromSalRng:!0};case Compensation.CONSTANTS.COMPARISON.BETWEEN:return{isValid:isValid=revCtc>=from&&revCtc<=to,errCode:errCode,isFromSalRng:!0};case Compensation.CONSTANTS.COMPARISON.LESS_EQUAL:return{isValid:isValid=revCtc<=from,errCode:errCode,isFromSalRng:!0};case Compensation.CONSTANTS.COMPARISON.GREATER_EQUAL:return{isValid:isValid=revCtc>=from,errCode:errCode,isFromSalRng:!0}}}}return{isValid:isValid,errCode:errCode,isFromSalRng:!0}}setSalPckg(salDiv,tempObj,selPckg,revDtls,onCtcChnge){let tempOpts="",prop={dropdownList:{appendTo:salDiv},randomDropdownListId:!0,change:()=>{this.onSalPckgChange.bind(this)(salDiv,revDtls)}};tempObj.forEach(function(temp,i){tempOpts+=`<option value="${temp.tid}">${ZSEC.Encoder.encodeForHTML(temp.name)}</option>`,!selPckg||_.isEmpty(selPckg)?0==i&&(prop.selectedValue=temp.tid):selPckg==temp.tid&&(prop.selectedValue=temp.tid)}),salDiv.find("#salpckg").html(tempOpts),salDiv.find("#salpckg").destroyEle(),ZPeopleComponents.select(salDiv.find("#salpckg"),prop),onCtcChnge||this.onSalPckgChange(salDiv,revDtls)}setReason(salDiv,reasonList){let opts="",prop={dropdownList:{appendTo:salDiv},randomDropdownListId:!0};reasonList.forEach(function(obj,i){for(let key in obj){let rObj=obj[key];opts+=`<option value="${rObj.optionId}">${ZSEC.Encoder.encodeForHTML(rObj.optionValue)}</option>`,0==i&&(prop.selectedValue=rObj.optionId)}}),salDiv.find("#reasonForChng").html(opts),salDiv.find("#reasonForChng").destroyEle(),ZPeopleComponents.select(salDiv.find("#reasonForChng"),prop)}onSalPckgChange(salDiv,revDtls,ctcChange){let empSalInfo=salDiv.data("empSalInfo"),selPckg=ZPeopleComponents.select(salDiv.find("#salpckg")).getValue(),revCTC=0==salDiv.find("#revisedCTC").getZValue().length?salDiv.find("#currentCTC").getZValue():salDiv.find("#revisedCTC").getZValue();this.validateSelPckg(salDiv,empSalInfo.appPckgs,selPckg,revCTC,!0),this.autoFillCTCInfo(salDiv,empSalInfo,selPckg),(empSalInfo.hasBreakupView||empSalInfo.hasBenefitsView)&&this.constructBreakup(salDiv,selPckg,revDtls)}constructBreakup(salDiv,selPckg,revDtls){let empSalInfo=salDiv.data("empSalInfo");var params={conreqcsr:csrfToken,tid:selPckg,erecno:empSalInfo.erecNo};void 0!=empSalInfo.etid&&""!=empSalInfo.etid&&(params.etid=empSalInfo.etid),revDtls=revDtls&&selPckg==revDtls.tid?revDtls:void 0,ZPeople.Request.send("/compensation/salary/getBreakupComponents",params,resultData=>{this.breakupHandler.bind(this)(salDiv,resultData,revDtls)})}async getRevCTC(currCTC,convRate=1,revAmt,revPerc){var decimalPlace=Compensation.Utils.getDecimalPlaces(),revCTC=null;return currCTC=void 0!=currCTC&&0!=currCTC?currCTC*convRate:0,revCTC=void 0!=revAmt?currCTC+revAmt:currCTC+currCTC*(revPerc/100),Compensation.Utils.getRoundOffValue(revCTC,decimalPlace).toFixed(decimalPlace)}getRevAmt(currCTC,revCTC){var decimalPlace=Compensation.Utils.getDecimalPlaces();return currCTC=void 0!=currCTC&&0!=currCTC?currCTC:0,Compensation.Utils.getRoundOffValue(revCTC-currCTC,decimalPlace).toFixed(decimalPlace)}getRevPerc(currCTC,revCTC){return(0!=(currCTC=void 0!=currCTC&&0!=currCTC?currCTC:0)?revCTC/currCTC*100-100:100).toFixed(2)}async getConvRate(currCode,revCurrCode){let currList=(await Compensation.Currencies.getInitData(!0)).confCurrList,oldCurrDet=this.getCurrencyDetails(currList,currCode),newCurrDet=this.getCurrencyDetails(currList,revCurrCode),oldExRate=Number(oldCurrDet.exchange_rate),newExRate=Number(newCurrDet.exchange_rate),convRate=1;return oldExRate!=newExRate&&(convRate=oldExRate/newExRate),convRate}async getRevDiff(currCTC,revCTC,convRate){var returnObj={},oldCTC=currCTC*convRate,newCTC=revCTC;return returnObj.revisedCTC=revCTC,returnObj.revisedAmt=this.getRevAmt(oldCTC,newCTC),returnObj.revisedPercentage=this.getRevPerc(oldCTC,newCTC),returnObj}async recalculateRevDetails(salDiv,revCTC,revAmt,revPerc,triggerId){let decimalPlace=Compensation.Utils.getDecimalPlaces(),currCTC=Compensation.Utils.getRoundOffValue(salDiv.find("#currentCTC").getZValue(),decimalPlace),currCode=salDiv.find("#currCode").getZTxt(),revCode=salDiv.find("#rev_currCode").getZTxt();revCTC=Compensation.Utils.getRoundOffValue(revCTC,decimalPlace),revAmt=Compensation.Utils.getRoundOffValue(revAmt,decimalPlace),revPerc=Compensation.Utils.getRoundedVal(revPerc);let convRate=await this.getConvRate(currCode,revCode);isNaN(revCTC)&&(isNaN(revAmt)?isNaN(revPerc)||(revCTC=await this.getRevCTC(currCTC,convRate,void 0,revPerc)):revCTC=await this.getRevCTC(currCTC,convRate,revAmt));var returnObj=await this.getRevDiff.bind(this)(currCTC,revCTC,convRate);revAmt=returnObj.revisedAmt,revPerc=returnObj.revisedPercentage,"revisedCTC"!=triggerId&&salDiv.find("#revisedCTC").val(revCTC),"revPerc"!=triggerId&&salDiv.find("#revPerc").val(revPerc),"revAmt"!=triggerId&&salDiv.find("#revAmt").val(revAmt)}async autoFillCTCInfo(salDiv,empSalInfo,selPckg){let appPckgs=empSalInfo.appPckgs,decimalPlace=Compensation.Utils.getDecimalPlaces(),selPckgDet=(empSalInfo.mode,appPckgs.filter(pckg=>pckg.tid==selPckg)[0]),newcurrCode=selPckgDet.currCode,oldcurrCode=salDiv.find("#currCode").getZTxt(),currCTC=salDiv.find("#currentCTC").getZValue(),revCTC=selPckgDet.ctc;if(revCTC=!_.isEmpty(currCTC)&&(oldcurrCode!=newcurrCode||Number(currCTC)>Number(revCTC))?0:revCTC,salDiv.find("#rev_currCode").removeClass("DNI").text(newcurrCode),salDiv.find("#revAmt_currCode").text(newcurrCode),revCTC>=currCTC&&(salDiv.find("#revisedCTC").val(revCTC),this.recalculateRevDetails(salDiv,revCTC)),salDiv.find("div[ref=exRateInfo]").remove(),oldcurrCode!=newcurrCode){let convRate=await this.getConvRate(oldcurrCode,newcurrCode);if(oldcurrCode!=newcurrCode){let exchangeRatesTxt=" (1 "+oldcurrCode+"="+Compensation.Utils.getRoundOffValue(convRate,decimalPlace).toFixed(decimalPlace)+" "+newcurrCode+")",convRateInfo=`<div ref="exRateInfo"class="zpl_info" style="margin-top: 8px; padding:6px">\n\t               ${ZPI18N.getString("zp.compensation.infoRevisionCalFromExRate",new Array(newcurrCode))+exchangeRatesTxt}\n\t            </div>`;salDiv.find("#revAmt_currCode").parents("div.zpl_secn").append(convRateInfo)}}}breakupHandler(salDiv,resultData,revDtls){if(Compensation.Utils.commonErrorHandler(resultData))return;var compDetails=resultData.allComps;let selPckg=ZPeopleComponents.select(salDiv.find("#salpckg")).getValue();salDiv.data("empSalInfo").appPckgs.filter(pckg=>pckg.tid==selPckg)[0];var ctcRows="",benRows="",compConfig={},compCodeVsData={},selBrkup=revDtls&&revDtls.revisionBreakupComps?revDtls.revisionBreakupComps:[];compDetails.length>0&&(compDetails.forEach(function(comp){let compName=ZSEC.Encoder.encodeForHTML(comp.Component_Name),isBen=!comp.Part_Of_CTC,calcType=comp.calcTypeId,calVal=0,calcFrom="",isStatic=comp.isStatic,isFormula=calcType==Compensation.CONSTANTS.CALCTYPE.FORMULA,code=comp.Component_Code,payFreqId=comp.payFreqId,cid=comp.cid;compCodeVsData[code]=comp;let selCmp=selBrkup.filter(obj=>obj.cid==cid),tooltiptxt="";calcType==Compensation.CONSTANTS.CALCTYPE.FLAT?(calVal=selCmp.length>0?selCmp[0].Amount:comp.Amount,comp.Amount=calVal):calcType==Compensation.CONSTANTS.CALCTYPE.POB||calcType==Compensation.CONSTANTS.CALCTYPE.POC?(calcFrom=calcType==Compensation.CONSTANTS.CALCTYPE.POC?ZPI18N.getString("zp.compensation.calcFromPerc",new Array(ZPI18N.getString("zp.salary"))):ZPI18N.getString("zp.compensation.calcFromPerc",new Array(ZPI18N.getString("zp.basicSearch"))),calVal=selCmp.length>0?selCmp[0].Percentage:comp.Percentage,comp.Percentage=calVal):isFormula&&(tooltiptxt=calVal=comp.Formula);let rowHtml=`<tr name="${code}" type="${calcType}"><td>${compName}${"Fixed_Allowance"==code?`<i class="PI_info tooltip-js" data-title-position="right" data-html="true" title="${ZPI18N.getString("zp.compensation.fixedallowance.toolTipmsg")}"></i>`:""}</td><td>`;isStatic?rowHtml+=`<span>${ZPI18N.getString("zp.compensation.SystemCalculated")}</span>`:isFormula?(rowHtml+=`<span>${ZPI18N.getString("zp.compensation.FormulaCalculated")}</span>`,rowHtml+=`<i class="PI_info tooltip-js" data-title-position="right" data-html="true" title="${calVal}"></i>`):(rowHtml+=`<input type="text" name="calcValue" class="ztextbox w100" value="${calVal}">`,""!=calcFrom&&(rowHtml+=`<span>${calcFrom}</span>`)),rowHtml+="</td>",rowHtml+='<td name="monthly">',payFreqId!=Compensation.components.PAYFREQ_MONTHLY&&(rowHtml+="---"),rowHtml+='</td><td name="annually"></td>',rowHtml+="</tr>",isBen?benRows+=rowHtml:ctcRows+=rowHtml}),salDiv.find("#ctcDiv tbody").html(ctcRows),salDiv.find("textarea[name=calcValue]").parent("div").ztooltip()),""==benRows&&(benRows=`<tr id="noBefTr">\n\t\t\t\t\t\t\t<td colspan="5" style="text-align: center;">\n\t\t\t\t\t\t\t\t<div class="zpl_Emptydata">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<div class="zpl_emptimg zp_nd_nodata1" style="width: 140px;height: 120px;margin: auto;display: block;margin-bottom: 5px;">\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<p>${ZPI18N.getString("zp.compensation.revision.noBenefitsTagged")}</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>`),salDiv.find("#benDiv tbody").html(benRows),compConfig.codeVsData=compCodeVsData,compConfig.oneTimeObj=resultData.oneTimeObj,compConfig.empParsers=resultData.empParserObj,compConfig=Compensation.calcBreakup(salDiv.find("#revisedCTC").val().replace(/[,]/g,""),compConfig),salDiv.find("div#brkupDiv").data("compConfiguration",compConfig),this.reconstructBreakupDiv(salDiv.find("div#brkupDiv")),salDiv.find("div[name=compDiv] input[name=calcValue]").on("keyup",event=>{this.onCompValChange(salDiv,$(event.currentTarget))})}onCompValChange(salDiv,ele){var compConfig=salDiv.find("div#brkupDiv").data("compConfiguration"),compcode=$(ele).parents("tr").attr("name");let selPckg=ZPeopleComponents.select(salDiv.find("#salpckg")).getValue(),calcVal=(salDiv.data("empSalInfo").appPckgs.filter(pckg=>pckg.tid==selPckg)[0],$(ele).val());var compObj=compConfig.codeVsData[compcode];compObj.calcTypeId==Compensation.CONSTANTS.CALCTYPE.FLAT?compObj.Amount=calcVal:compObj.Percentage=Compensation.Utils.getRoundedVal(calcVal),compConfig=Compensation.calcBreakup(salDiv.find("#revisedCTC").val().replace(/[,]/g,""),compConfig),salDiv.find("div#brkupDiv").data("compConfiguration",compConfig),this.reconstructBreakupDiv(salDiv.find("div#brkupDiv"))}onCTCChange(salDiv,ctcInp){let selPckg=ZPeopleComponents.select(salDiv.find("#salpckg")).getValue();salDiv.data("empSalInfo").appPckgs.filter(pckg=>pckg.tid==selPckg)[0];if(salDiv.find("div[name=compDiv] tbody tr").length>0){let compConfiguration=Compensation.calcBreakup($(ctcInp).val(),salDiv.find("div#brkupDiv").data("compConfiguration"));salDiv.find("div#viewBreakupDiv").data("compConfiguration",compConfiguration),this.reconstructBreakupDiv(salDiv.find("div#brkupDiv"))}}reconstructBreakupDiv(divEle){if(void 0!=$(divEle).data("compConfiguration")){var compConfiguration=$(divEle).data("compConfiguration");let decimalPlace=Compensation.Utils.getDecimalPlaces();var breakupData=compConfiguration.codeVsData;$(divEle).data("breakupData",breakupData);var totCtc_M=0,totBen_M=0,totCtc_A=0,totBen_A=0,hasBnft=!1;for(let comp in breakupData){var compObj=breakupData[comp];let totMonthly=compObj.Part_Of_CTC?totCtc_M:totBen_M,totAnnually=compObj.Part_Of_CTC?totCtc_A:totBen_A,cmpRow=$(divEle).find("tr[name="+compObj.Component_Code+"]");compObj.calcTypeId!=Compensation.CONSTANTS.CALCTYPE.FLAT?cmpRow.find("input[name=calcValue]").val(compObj.Percentage):cmpRow.find("input[name=calcValue]").val(compObj.Amount),cmpRow.find("td[name=annually]").text(compObj.annually.toFixed(decimalPlace)),totAnnually+=compObj.annually,compObj.payFreqId==Compensation.components.PAYFREQ_MONTHLY&&(totMonthly+=compObj.monthly,cmpRow.find("td[name=monthly]").text(compObj.monthly.toFixed(decimalPlace))),compObj.Part_Of_CTC?(totCtc_M=totMonthly,totCtc_A=totAnnually):(hasBnft=!0,totBen_M=totMonthly,totBen_A=totAnnually)}let totalRow_ctc=$(divEle).find("#ctcDiv tfoot tr");totalRow_ctc.find("th[name=monthly]").text(Compensation.Utils.getRoundOffValue(totCtc_M,decimalPlace).toFixed(decimalPlace)),totalRow_ctc.find("th[name=annually]").text(Compensation.Utils.getRoundOffValue(totCtc_A,decimalPlace).toFixed(decimalPlace));let totalRow_ben=$(divEle).find("#benDiv tfoot tr");hasBnft?(totalRow_ben.find("th[name=monthly]").text(Compensation.Utils.getRoundOffValue(totBen_M,decimalPlace).toFixed(decimalPlace)),totalRow_ben.find("th[name=annually]").text(Compensation.Utils.getRoundOffValue(totBen_A,decimalPlace).toFixed(decimalPlace)),totalRow_ben.show()):totalRow_ben.hide()}}showBreakup(salDiv,tabid){salDiv.find("#"+tabid).show(),salDiv.find("div[name=compDiv]:not(#"+tabid+")").hide()}onModalClose(mode){let salModal=this.modalInfo[mode];this.destroyModalEle(salModal),salModal.remove(),delete this.modalInfo[mode],"view"==mode&&(window.location.hash="#"+settingsUrlProps.niceUrl)}destroyModalEle(salModal){let salDiv=salModal.sliderDiv;salDiv.find("#selUserForRev").destroyEle(),salDiv.find("#salpckg").destroyEle(),salDiv.find("#effectiveDate").destroyEle(),salDiv.find("#reasonForChng").destroyEle(),salDiv.removeData("empSalInfo")}showErr(ele,errMsg){ele=ele.parents("div.zpl_secn div:last"),Compensation.Utils.showNewInlineErrTxt(ele,errMsg)}validateSalData(mode,salDiv,empSalInfo,revisionDetails){var hasError=!1;Compensation.Utils.removeNewInlineErrTxt(salDiv);var isDecimalSupported=Compensation.Utils.isDecimalSupported();const showErr=this.showErr;var errMsg="";if(void 0==revisionDetails.Employee||_.isEmpty(revisionDetails.Employee))return hasError=!0,errMsg="add"==mode?ZPI18N.getString("zp.compensation.revisionErrMsg.noEmpSelectedForSalary"):ZPI18N.getString("zp.compensation.revisionErrMsg.noEmpSelectedForRevision"),showErr(salDiv.find("#selUserForRev"),errMsg),hasError;if(void 0!=empSalInfo.activeRevId&&!_.isEmpty(empSalInfo.activeRevId))return hasError=!0,errMsg=ZPI18N.getString("zp.compensation.revisionErrMsg.empHasActiveRevision"),ModuleComp.Msg.showFailureMsg(errMsg),hasError;let paramArr=['<a href="#operations/organization/employee/edit-formLinkName:employee/recordId:'+empSalInfo.erecNo+'" >'+ZPI18N.getString("zp.dateofjoining")+"</a>"],dojErrMsg=isadmin?ZPI18N.getString("zp.compensation.revisionErrMsg.dojAdminErr",paramArr):ZPI18N.getString("zp.compensation.revisionErrMsg.dojNotUpdated");if("add"==mode&&_.isEmpty(empSalInfo.doj))this.showErr(salDiv.find("#selUserForRev"),dojErrMsg);else if(""==revisionDetails.Effective_Date)showErr(salDiv.find("#effectiveDate"),ZPI18N.getString("zp.compensation.emptyEffFromDate"));else if("add"==mode&&""!=empSalInfo.doj){let empDoj=empSalInfo.doj,effDate=revisionDetails.Effective_Date;var fdate=Calendar.parseDate(empDoj,uidateFormat);Calendar.parseDate(effDate,uidateFormat)<fdate&&showErr(salDiv.find("#effectiveDate"),ZPI18N.getString("zp.compensation.revisionErrMsg.effDateGreaterThanDoj"))}"add"!=mode&&void 0!=revisionDetails.Revised_Amount&&void 0!=revisionDetails.Revised_Percentage&&(""==revisionDetails.Revised_Amount?showErr(salDiv.find("#revAmt"),ZPI18N.getString("zp.workitemplaceholder",new Array(ZPI18N.getString("zp.compensation.revAmt").toLocaleLowerCase()))):isDecimalSupported||Number(revisionDetails.Revised_Amount)%1==0?""==revisionDetails.Revised_Percentage&&showErr(salDiv.find("#revPerc"),ZPI18N.getString("zp.workitemplaceholder",new Array(ZPI18N.getString("zp.compensation.revPerc").toLocaleLowerCase()))):showErr(salDiv.find("#revAmt"),ZPI18N.getString("zp.componentErrMsg.Invalid_invalidVal_decimal",new Array(ZPI18N.getString("zp.compensation.revAmt").toLocaleLowerCase()))));let ctcfieldLwrTxt="add"==mode?ZPI18N.getString("zp.local.currentsalary"):ZPI18N.getString("zp.local.revisedsalary"),ctcfieldUprTxt="add"==mode?ZPI18N.getString("zp.local.currentsalary"):ZPI18N.getString("zp.local.revisedsalary");return""==revisionDetails.Revised_Salary||""==salDiv.find("#revisedCTC").val()?showErr(salDiv.find("#revisedCTC"),ZPI18N.getString("zp.componentErrMsg.Invalid_empty3",new Array(ctcfieldLwrTxt))):isNaN(revisionDetails.Revised_Salary)||Number(revisionDetails.Revised_Salary)<=0?showErr(salDiv.find("#revisedCTC"),ZPI18N.getString("zp.componentErrMsg.Invalid_invalidVal",new Array(ctcfieldLwrTxt))):isDecimalSupported||Number(revisionDetails.Revised_Salary)%1==0?String(Number(revisionDetails.Revised_Salary)).split(".")[0].length>10&&(errMsg="add"==mode?ZPI18N.getString("zp.compensation.revisionErrMsg.currCTCLimitExceeds"):ZPI18N.getString("zp.compensation.revisionErrMsg.revCTCLimitExceeds"),showErr(salDiv.find("#revisedCTC"),errMsg)):showErr(salDiv.find("#revisedCTC"),ZPI18N.getString("zp.componentErrMsg.Invalid_invalidVal_decimal",new Array(ctcfieldUprTxt))),"add"!=mode&&""==revisionDetails.Reason&&showErr(salDiv.find("#reasonForChng"),ZPI18N.getString("zp.workitemplaceholder",new Array(ZPI18N.getString("zp.reason").toLocaleLowerCase()))),(hasError=salDiv.find("span.ztextbox--error__label").length>0)&&salDiv.find("span.ztextbox--error__label:first").parent("Div").trigger("focus"),hasError}getRevDetailsFromModal(mode,salDiv){let revDetails={},decimalPlace=Compensation.Utils.getDecimalPlaces();return revDetails.Employee=salDiv.find("#selUserForRev").getZValue(),revDetails.Template=salDiv.find("#salpckg").getZValue(),revDetails.currentCTC="add"==mode?"0":Compensation.Utils.getRoundOffValue(salDiv.find("#currentCTC").getZValue(),decimalPlace).toFixed(decimalPlace),revDetails.Revised_Salary=Compensation.Utils.getRoundOffValue(salDiv.find("#revisedCTC").getZValue(),decimalPlace).toFixed(decimalPlace),revDetails.Revised_Amount=Compensation.Utils.getRoundOffValue("add"==mode?"0":salDiv.find("#revAmt").getZValue(),decimalPlace).toFixed(decimalPlace),revDetails.Revised_Percentage="add"==mode?"0":salDiv.find("#revPerc").getZValue(),revDetails.Currency=salDiv.find("#rev_currCode").getZTxt(),revDetails.Effective_Date=salDiv.find("#effectiveDate").getZValue(),revDetails.Revision_Type="1",revDetails.Reason=salDiv.find("#reasonForChng").getZTxt(),revDetails.Remarks=salDiv.find("#remarks").getZValue(),revDetails}getCurrencyDetails(currList,currCode){let currArr=currList.filter(obj=>obj.currencycode==currCode);return currArr.length>0?currArr[0]:{}}parseBreakupJsn(breakupData){let retObj={};for(let code in breakupData){let bObj=breakupData[code],obj={};obj.cid=bObj.cid,obj.Component_Code=bObj.Component_Code,obj.Component_Name=bObj.Component_Name,obj.isStatic=bObj.isStatic,obj.Part_Of_CTC=bObj.Part_Of_CTC,obj.payTypeId=bObj.payTypeId,obj.Pay_Type=bObj.Pay_Type,obj.payFreqId=bObj.payFreqId,obj.Payment_Frequency=bObj.Payment_Frequency,bObj.Part_Of_CTC&&(obj.Component_Category=bObj.Component_Category,obj.compCategoryId=bObj.compCategoryId),obj.calcTypeId=bObj.calcTypeId,obj.Amount=bObj.Amount,obj.Percentage=bObj.Percentage,obj.calcAmt=bObj.calcAmt,obj.monthly=bObj.monthly,obj.annually=bObj.annually,retObj[code]=obj}return retObj}async addUpdateSalary(mode,isDraft=!1,revId){let salModal=this.modalInfo[mode],salDiv=salModal.sliderDiv,revisionDetails=this.getRevDetailsFromModal(mode,salDiv),errMsg="",dataArr=(await Compensation.Currencies.getInitData()).confCurrList,currObj=this.getCurrencyDetails(dataArr,revisionDetails.Currency);revisionDetails.Currency=currObj.currencyid;let empSalInfo=salDiv.data("empSalInfo")?salDiv.data("empSalInfo"):{};if(this.validateSalData(mode,salDiv,empSalInfo,revisionDetails))return;var params={conreqcsr:csrfToken,erecno:revisionDetails.Employee};if(params.isDraft=isDraft,revId&&(params.revId=revId),Compensation.Config.isTempEnabled){var tid=revisionDetails.Template;if(void 0!=tid&&-1!=tid){var hasBreakupView=empSalInfo.hasBreakupView,hasBenefitsView=empSalInfo.hasBenefitsView,breakupData=salDiv.find("div#brkupDiv").data("breakupData");let compconfig=Compensation.calcBreakup(revisionDetails.Revised_Salary,salDiv.find("div#brkupDiv").data("compConfiguration"));if(void 0!=breakupData&&Object.keys(breakupData).length>0&&(hasBreakupView||hasBenefitsView))if(params.breakupDetails=JSON.stringify(this.parseBreakupJsn(breakupData)),breakupData.Fixed_Allowance){if(Number(breakupData.Fixed_Allowance.calcAmt)<0)return errMsg=ZPI18N.getString("zp.compensation.revisionErrMsg.negativeFixedAllowance"),void ModuleComp.Msg.showFailureMsg(errMsg)}else if(0!=compconfig.unbalanced)return void ModuleComp.Msg.showWarningMsg(ZPI18N.getString("zp.compensation.adjustbreakupamt",new Array(compconfig.unbalanced+"")));let[isValidTemp,errCode,isFromSalRng]=this.validateSelPckg(salDiv,empSalInfo.appPckgs,tid,salDiv.find("#revisedCTC").getZValue(),!1);if(!isValidTemp&&!isFromSalRng)return errMsg=errCode,void ModuleComp.Msg.showFailureMsg(errMsg)}}params.revisionDetails=JSON.stringify(revisionDetails),salDiv.find("#sliderSbt").attr("disabled","disabled");let URL="add"==mode?"/compensation/revisions/add":"/compensation/revisions/update";ZPeople.Request.send(URL,params,resultdata=>{if(resultdata.hasError){let errMsg=ZSEC.Encoder.encodeForHTML(resultdata.errMsg);ModuleComp.Msg.showFailureMsg(errMsg),salDiv.find("#sliderSbt").removeAttr("disabled","disabled")}else isDraft?ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.successfullysavedasdraft")):"add"==mode?ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.compensation.successMsg.IntialRecordAdd")):ModuleComp.Msg.showSuccessMsg(ZPI18N.getString("zp.compensation.successMsg.RevRecordUpdate")),salModal.close(),Compensation.Utils.refreshPageForAction(Compensation.CONSTANTS.ACTIONTYPE.SALARY,revisionDetails.Employee),this.addUpdateCallback&&_.isFunction(this.addUpdateCallback)?this.addUpdateCallback(resultdata.revId):(this.loadView(this.getSelView(this.viewId)),resultdata.revId&&Compensation.SalRevision.Operations.showSingleRecView(resultdata.revId,!0))},null,resp=>{salDiv.find("#sliderSbt").removeAttr("disabled","disabled"),Compensation.Utils.commonErrorHandler(resp)})}refreshView(){this.loadView(this.getSelView(this.viewId))}getCompHtml(compList){return compList.map(obj=>`<div><em class="w300">${obj.name}</em><em class="w20">:</em><span>${obj.annually_fmt}</span></div>`).join("")}getRevHistHtml(revHist){return revHist.map(obj=>`<tr><td><span>${obj.effectiveFrom}</span></td><td><span>${obj.revSalary_fmt}</span></td><td><div class="txtbrk w200"><span>${obj.revAmount_fmt} - ${obj.revPercentage}%</span></div></td><td><span>${obj.reason}</span></td></tr>`).join("")}constructEmpSalMyDataView(resp,myView){let modalHtml=myView.getHtml();const sModObj=new sliderModal("",new Tab("viewSalModal",function(){this.container.find("#cardviewSalModal").html(modalHtml)},()=>{}));sModObj.largeSize=!0;let[hdr,ftr]=this.getModalHdrFtr("view",resp.salaryInfo);sModObj.construct(hdr,ftr),sModObj.setCloseCallback(()=>{this.onModalClose.bind(this)("view")}),this.modalInfo.view=sModObj}async getfltrJSON(){let isTeamView=this.isTeamView,isFromOpr=this.isFromOpr,isOthersView=this.isOthersView,fltrArr=[],fieldObj={};if(!isTeamView){let searchMode="COMPENSATION_REPORTS",compDataType=Compensation.CONSTANTS.DATAMODE.ALL_DATA;if(isFromOpr?compDataType=Compensation.CONSTANTS.DATAMODE.ADMIN_DATA:isOthersView&&(compDataType=Compensation.CONSTANTS.DATAMODE.NONADMIN_DATA),fltrArr.push({id:"Employee",dispName:ZPI18N.getString("zp.employee"),fieldType:Compensation.CONSTANTS.PLAIN_TEXT_FIELD,isTokenField:!0,isSearchField:!0,searchMode:searchMode,compDataType:compDataType}),fieldObj={id:"CTC",dispName:ZPI18N.getString("zp.salary"),fieldType:Compensation.CONSTANTS.NUMERICAL_FIELD},fltrArr.push(fieldObj),Compensation.Config.isTempEnabled){fieldObj={id:"Template",dispName:ZPI18N.getString("zp.compensation.SalaryPackage"),fieldType:Compensation.CONSTANTS.PICKLIST_FIELD};let dataArr=(await Compensation.Utils.sendReqAsPromise("/compensation/packages/list",{fetchBasicInfo:!0})).allTmpls,opts=Compensation.Utils.getComponentPicklistOptions(dataArr,"tid","name","name");fieldObj.options=opts,fltrArr.push(fieldObj)}fieldObj={id:"Currency",dispName:ZPI18N.getString("zp.currency"),fieldType:Compensation.CONSTANTS.PICKLIST_FIELD};let dataArr=(await Compensation.Utils.sendReqAsPromise("/compensation/currencies/list",{fetchBasicInfo:!0})).confCurrList,opts=Compensation.Utils.getComponentPicklistOptions(dataArr,"currencyid","currencycode","name");fieldObj.options=opts,fltrArr.push(fieldObj),fieldObj={id:"Effective_Date",dispName:ZPI18N.getString("zp.compensation.LastRevision"),fieldType:Compensation.CONSTANTS.DATE_FIELD},fltrArr.push(fieldObj)}return Promise.resolve(fltrArr)}async constructSysFilter(){this.isTeamView;let fltrOpts=await this.getfltrJSON(),prop={filterid:"sysFltr"};prop.fieldJson=fltrOpts,prop.appendTo=this.container,prop.handleOSFltr=!this.isTeamView,prop.handleLocFltr=!this.isTeamView,prop.handleEmpStatusFltr=!this.isTeamView,prop.handleEmpViewTypeFltr=this.isTeamView,prop.filterPosCls="zpl_fltr_flt",prop.dataTblEle=this.container.find("#empSalLst").closest("div.zpl_rgtcnt"),prop.applyCallback=((searchParams,osFltrObj,empStatus,appStatus,empViewType)=>{this.applyFilter(searchParams,osFltrObj,empStatus,empViewType)}),prop.fltrResultFmt=1;var sysFltr=new compensationModuleFilter(prop);this.compFltrObj=sysFltr,sysFltr.init()}applyFilter(searchParams,osFltrObj,empStatus,empViewType){var staticParams={};staticParams.orgStructureFilter=osFltrObj,staticParams.employeeStatus=empStatus,staticParams.empViewType=empViewType,this.searchParams=searchParams,this.staticParams=staticParams;let viewId=this.viewId;ZPLite.Firescroll.resetFetchedCount(viewId);let viewProp=this.getViewProp(viewId);if(viewProp.sIndex=1,"empSalgrd"==viewId)this.getEmpSalGrid.bind(this)();else if(viewId==this.kbnViewDivId){let groupBy=viewProp.groupBy;this.getEmpSalKnb.bind(this)(groupBy)}else this.getEmpSalList.bind(this)()}handleExport(){ZP5Export.init("empsalary",{moduleSysViewCallback:this.doExport.bind(this),additionalHtmlCallback:Compensation.Utils.getNoteForNewExportDiv})}doExport(container,params,ftype){if(Layout.UrlConf.isModuleForm()&&!ZP5Views.isSystemView())ExportNew.exportData();else{let viewId=Compensation.Salary.Operations.formDetails.viewId,reqParams=Compensation.Utils.getReqParamsForExport(this.searchParams,this.staticParams);reqParams.viewID=viewId||Compensation.Salary.Operations.formDetails.viewId,Compensation.Utils.sendFormReqForExport("/ExportData.zp",reqParams)}}getRevImpMode(id){switch(id){case"salaryImpIcon":return"add";case"revisionImpIcon":return"update";case"revHistImpIcon":return"updateHist"}}getImportHeader(){let mode=this.impObj.impMode;return"add"==mode?ZPI18N.getString("zp.compensation.importInitialSalary"):"update"==mode?ZPI18N.getString("zp.compensation.importRevision"):ZPI18N.getString("zp.compensation.importHistData")}handleImport(event,selItem){let id=selItem.options.id,mode=this.getRevImpMode(id);this.impParam={},this.impObj={impId:id,impMode:mode},ZP5Import.init("empsalary")}appendCompImpFields(layout,appendToEle){let impParams=this.getImportableParams(layout);appendToEle.append("<input type='hidden' name='importRevType' value='"+impParams.importRevType+"'/>"),impParams.revBasedOn&&"plainImp"!=impParams.revBasedOn&&(appendToEle.append("<input type='hidden' name='revBasedOn' value='"+impParams.revBasedOn+"'/>"),appendToEle.append("<input type='hidden' name='revBaseId' value='"+impParams.revBaseId+"'/>"))}constructImpDepFields(layout){let mode=this.impObj.impMode;const isTempEnabled=Compensation.Config.isTempEnabled;layout.attr("revMode",mode);let isAdd="add"==mode,isHist="updateHist"==mode,depHtml=`<div class="flex-dirC d-flexclmcap5">\n\t            <h4>${ZPI18N.getString("zp.compensation.impPgTitle")}</h4>\n\t            <em>${ZPI18N.getString("zp.compensation.impPgDesc")}</em>\n\t        </div>`;depHtml+='<div class="zpl_uplType">\n                                <div class="zpl_gbox sel" name="importType">\n                                    <div class="zpl_idiv">\n                                        <div class="chkdectxt">\n                                            <div class="zcheckbox">\n                                                <input id="plainImp" type="checkbox" name="importTypeChkB" class="zcheckbox__helper" checked="">\n                                                <label for="plainImp" class="zcheckbox__label">'+`<span class="zradiobutton__text">${isAdd||isHist?ZPI18N.getString("zp.salary"):ZPI18N.getString("zp.compensation.SalaryRevision")}</span>\n                                                </label>\n                                            </div>\n                                            <span class="dectxt">${isHist?ZPI18N.getString("zp.compensation.importPastCTCPgMsg"):isAdd?ZPI18N.getString("zp.compensation.importInitCTCPgMsg"):ZPI18N.getString("zp.compensation.importRevCTCPgMsg")}</span>\n                                        </div>\n                                    </div>\n                                </div>`,isTempEnabled&&(depHtml+='\t\t<div class="zpl_gbox" name="importType">\n\t\t\t                                    <div class="zpl_idiv">\n\t\t\t                                        <div class="chkdectxt">\n\t\t\t                                            <div class="zcheckbox">\n\t\t\t                                                <input id="salaryTemp" type="checkbox" name="importTypeChkB" class="zcheckbox__helper">\n\t\t\t                                                <label for="salaryTemp" class="zcheckbox__label">'+`<span class="zradiobutton__text">${isAdd||isHist?ZPI18N.getString("zp.compensation.impInitSalaryWithPckgTitle"):ZPI18N.getString("zp.compensation.impRevSalaryWithPckgTitle")}</span>\n\t\t\t                                                </label>\n\t\t\t                                            </div>\n\t\t\t                                            <span class="dectxt">${isHist?ZPI18N.getString("zp.compensation.impPastSalaryWithPckgTitle"):isAdd?ZPI18N.getString("zp.compensation.impInitSalaryWithPckgDesc"):ZPI18N.getString("zp.compensation.impRevSalaryWithPckgDesc")}</span>\n\t\t\t                                        </div>\n\t\t\t                                    </div>\n\t\t\t                                </div>\n\t\t\t                            <div class="zpl_gbox DNI" name="importType">\n\t\t\t                                    <div class="zpl_idiv">\n\t\t\t                                        <div class="chkdectxt">\n\t\t\t                                            <div class="zcheckbox">\n\t\t\t                                                <input id="salaryComp" type="checkbox" name="importTypeChkB" class="zcheckbox__helper">\n\t\t\t                                                <label for="salaryComp" class="zcheckbox__label">`+`<span class="zradiobutton__text">${ZPI18N.getString("zp.componentPage.Title")}</span>\n\t\t\t                                                </label>\n\t\t\t                                            </div>\n\t\t\t                                            <span class="dectxt">${ZPI18N.getString("zp.compensation.impSalaryWithCmpDesc")}</span>\n\t\t\t                                        </div>\n\t\t\t                                    </div>\n\t\t\t                                </div>`),depHtml+="</div>",isTempEnabled&&(depHtml+=`<div class="zpl_secn ML40 w600 DNI">\n\t\t\t\t\t\t\t\t  <div>\n\t\t\t\t\t\t\t\t    <div>\n\t\t\t\t\t\t\t\t      <label id="dataForLbl" elem="importDataForCont">${ZPI18N.getString("zp.compensation.SalaryPackageToImport")}:</label>`+'</div>\n\t\t\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t\t\t  <div>\n\t\t\t\t\t\t\t\t    <div>\n\t\t\t\t\t\t\t\t      <select id="revImportFor" name="revImportFor" style="display: none;">\n\t\t\t\t\t\t\t\t      </select>\n\t\t\t\t\t\t\t\t    </div>\n\t\t\t\t\t\t\t\t  </div>\n\t\t\t\t\t\t\t\t</div>'),layout.find("[elem=uploadFileContainer]").prepend(depHtml),layout.find("[elem=uploadFileContainer]").addClass("d-flexclmcap"),"update"==mode&&layout.find("#salaryComp").parents("div[name=importType]").removeClass("DNI"),layout.find("div[name=importType]").on("click",event=>{if("checkbox"==event.target.type)return void(event.target.checked||$(event.target).prop("checked",!0));layout.find("div[name=importType].sel").removeClass("sel"),layout.find("input[name=importTypeChkB]").prop("checked",!1),$(event.currentTarget).addClass("sel");let selItem=$(event.currentTarget).find("input[name=importTypeChkB]");selItem.prop("checked",!0),this.appendImpRevForOpts(layout,selItem.attr("id"))})}appendImpRevForOpts(layout,id){if("plainImp"==id)layout.find("#revImportFor").parents(".zpl_secn").addClass("DNI");else{let dataFor=id;"salaryComp"==dataFor?layout.find("#dataForLbl").text(ZPI18N.getString("zp.compensation.impSalaryDataForCmpDesc")):"salaryTemp"==dataFor&&layout.find("#dataForLbl").text(ZPI18N.getString("zp.compensation.SalaryPackageToImport"));var params={conreqcsr:csrfToken,dataFor:dataFor};ZPeople.Request.send("/compensation/getSelectableOptions",params,resultData=>{let optHtml="";var availableData=resultData.availableData;for(let group in availableData){var groupData=availableData[group];optHtml+='<optgroup label="'+group+'">';for(let data in groupData)optHtml+='<option value="'+data+'">'+ZSEC.Encoder.encodeForHTML(groupData[data])+"</option>";optHtml+="</optgroup>"}layout.find("#revImportFor").html(optHtml),layout.find("#revImportFor").destroyEle();let prop={dropdownList:{appendTo:layout}};ZPeopleComponents.select(layout.find("#revImportFor"),prop),layout.find("#revImportFor").parents(".zpl_secn").removeClass("DNI")})}}getImportableParams(layout){if(this.impParam&&!_.isEmpty(this.impParam))return this.impParam;var revBasedOn=layout.find("input[name=importTypeChkB]:checked").attr("id"),retObj={};let mode=this.impObj.impMode;if(retObj.importRevType=mode,"plainImp"!=revBasedOn){retObj.revBasedOn=revBasedOn;var revBaseId=layout.find("#revImportFor").getZValue();retObj.revBaseId=revBaseId}return this.impParam=retObj,retObj}setImportExtraParam(layout,params){Object.assign(params,this.getImportableParams(layout))}}Compensation.selfView={refreshData:!0,init:async function(){0==Layout.Page.container.find("#myViewDiv").length&&Layout.Page.container.append('<div class="Scrcont zp-comp-view" id="myViewDiv" scroll="enabled"></div>'),new selfSalaryView({container:Layout.Page.container.find("#myViewDiv"),showChart:!0,isPgView:!0}).constructPage(erecno),Compensation.selfView.refreshData=!1}},selfSalary={tabObj:{},currViewObj:void 0,permObj:{},isPgInit:function(){return 0==Object.keys(selfSalary.tabObj).length},destroyAll:function(){selfSalary.tabObj={},selfSalary.permObj={}},destroy:function(recId){delete selfSalary.tabObj[recId],delete selfSalary.permObj[recId]},autoDestroy(){let keys=Object.keys(selfSalary.tabObj),recId=Layout.Page.urlparam.recordId;keys.length>0&&keys.filter(tabid=>!tabid.endsWith(recId)).length>0&&selfSalary.destroyAll()},getUsrPerm:function(){let recId=Layout.Page.urlparam.recordId;if(selfSalary.permObj[recId]&&Object.keys(selfSalary.permObj[recId]).length>0)return selfSalary.permObj[recId];var params={conreqcsr:csrfToken,userId:recId};return ZPeople.Request.sendAsyncPost("/compensation/getRecordPermission",params,response=>{selfSalary.permObj[recId]=response}),selfSalary.permObj[recId]},actionTypeHandler(selItem){switch(selItem.value){case"0":let mode="update";return void this.addUpdateSalary(mode);case"1":return void this.showRevLtrs()}},handlePgEvent(ele){let pgWrap=$(ele);pgWrap.find("a[name=viewRevLtr]").off("click"),pgWrap.find("a[name=viewRevLtr]").on("click",()=>{selfSalary.currViewObj.showRevLtrs()}),pgWrap.find("button[id=addSalary],button[id=revSalary]").off("click"),pgWrap.find("button[id=addSalary],button[id=revSalary]").on("click",event=>{let selId=$(event.currentTarget).attr("id");selfSalary.currViewObj.addUpdateSalary.call(selfSalary.currViewObj,"addSalary"==selId?"add":"update")}),ZPeopleComponents.splitbutton(pgWrap.find('button[name="revSalBtns"]'),{change:event=>{event.stopPropagation();var selItem=event.detail.selectedItem[0].itemData;this.actionTypeHandler.call(selfSalary.currViewObj,selItem)},buttonclick:event=>{event.stopPropagation()},click:event=>{if(event.stopPropagation(),!event.detail.isMenuButton){var selItem=event.detail.selectedItem[0].itemData;this.actionTypeHandler.call(selfSalary.currViewObj,selItem)}}})},getActionBtns(permObj,isMyDataView){let actionHtml="",hasSalary=permObj.hasSalary,hasAddPerm=permObj.addPerm,hasEditPerm=!isMyDataView&&permObj.editPerm,hasRevLtrs=permObj.hasRevLtrs,recId=Layout.Page.urlparam.recordId,containerId=Layout.Page.pageContWrapper.attr("id");return hasSalary?hasEditPerm&&hasRevLtrs?(actionHtml+=`<button name="revSalBtns" id="revsal_grp_${recId}" data-menu-id="revsal_mnu_${recId}" data-value='0'>${ZPI18N.getString("zp.compensation.reviseSalary")}</button>`,actionHtml+=`<ul id="revsal_mnu_${recId}" class="w100" name="revSalBtns" style='display:none;' data-append-to="#${containerId}">`,actionHtml+=`<li data-item-type='radio' name='revSal' data-value='0'>${ZPI18N.getString("zp.compensation.reviseSalary")}</li>`,actionHtml+=`<li data-item-type='radio' name='viewRevLtr' data-value='1'>${ZPI18N.getString("zp.viewComp",new Array(ZPI18N.getString("zp.comp.rlg.salrevlet")))}</li>`,actionHtml+="</ul>"):hasEditPerm?actionHtml=`<button id="revSalary" class="zlabel zlabel--blue zlabel--medium DB">${ZPI18N.getString("zp.compensation.reviseSalary")}</button>`:hasRevLtrs&&(actionHtml=`<a data-popup-open="RevisionLetter" name="viewRevLtr">${ZPI18N.getString("zp.viewComp",new Array(ZPI18N.getString("zp.comp.rlg.salrevlet")))}</a>`):(hasAddPerm&&(actionHtml=`<button id="addSalary" class="zlabel zlabel--blue zlabel--medium DB">${ZPI18N.getString("zp.compensation.addSalary")}</button>`),hasRevLtrs&&(actionHtml=`<a data-popup-open="RevisionLetter" name="viewRevLtr">${ZPI18N.getString("zp.viewComp",new Array(ZPI18N.getString("zp.comp.rlg.salrevlet")))}</a>`)),actionHtml},getBackUrlParam:function(){let urlParams=Layout.Page.hash.split("-")[1];return Layout.Page.urlparam.recordId&&(urlParams=urlParams.replace("recordId:"+Layout.Page.urlparam.recordId,""))&&urlParams.length>0&&(urlParams="-"+(urlParams.startsWith("/")?urlParams.substr(1,urlParams.length):urlParams)),urlParams},updateUsrProf:function(){let isTeamView=settingsUrlProps.niceUrl.includes("salarydetails/team/salary/"),isFromSearch=settingsUrlProps.niceUrl.includes("salarydetails/searchuser/"),backurl=isTeamView?"#salarydetails/team/salary":void 0,isMyDataView=settingsUrlProps.niceUrl.includes("salarydetails/mysalary/view"),recId=isMyDataView?erecno:Layout.Page.urlparam.recordId,hdrEle=Layout.Page.pageContWrapper.find("div[name=page-header]");if(hdrEle.find("#userProfId").remove(),isMyDataView)Layout.Page.urlparam.recordId=recId;else if(!isTeamView){let urlParams=selfSalary.getBackUrlParam();backurl=Layout.Page.hash.includes("salarydetails/employeesalary")?"#salarydetails/employeesalary/listview"+urlParams:"#"+settingsUrlProps.niceUrl.replace("/view","").replace("/revision","")+(isFromSearch?"":"/listview")+urlParams}let permObj=selfSalary.getUsrPerm();var actBtnHtml=selfSalary.getActionBtns.call(selfSalary,permObj,isMyDataView),userDtls=ZPeople.getUserDetailsById(recId);let empProfHtml="";return userDtls&&userDtls.usererec&&(empProfHtml=$(`<div class="MLauto zpl_myprofhd-acts" id="actBtns">${actBtnHtml}</div>`)),hdrEle.prepend(empProfHtml),selfSalary.handlePgEvent.call(selfSalary,empProfHtml),empProfHtml},getPreviousPageUrl:()=>{let isTeamView=settingsUrlProps.niceUrl.includes("salarydetails/team/salary/"),isFromSearch=settingsUrlProps.niceUrl.includes("salarydetails/searchuser/");if(isTeamView)return"#salarydetails/team/salary";let urlParams=selfSalary.getBackUrlParam();return Layout.Page.hash.includes("salarydetails/employeesalary")?"#salarydetails/employeesalary/listview"+urlParams:"#"+settingsUrlProps.niceUrl.replace("/view","").replace("/revision","")+(isFromSearch?"":"/listview")+urlParams},setTLTabParams:function(tlParams){tlParams.userErecno=Layout.Page.urlparam.recordId,tlParams.userLocId=ZPeople.getUserDetailsById(tlParams.userErecno).locId;let pgUrl=settingsUrlProps.niceUrl.substr(0,settingsUrlProps.niceUrl.lastIndexOf("/"));tlParams.pgurl=pgUrl},setModulePrefix:function(){return{modulePrefix:"salarydetails-myview",submode:"salarydetails-myview",erecno:Layout.Page.urlparam.recordId}},getProfileParams:()=>{if("searchUser"==Layout.Page.hashDtl.page)return{mode:"operations"};return{mode:"reportees",employee:ZPeople.Team&&ZPeople.Team.erecno[ZPeople.Team.reporteePageMode]?ZPeople.Team.erecno[ZPeople.Team.reporteePageMode]:erecno}}};class selfSalaryView{constructor(prop={}){this.container=prop.container?prop.container:settingsPage.container,this.showChart=!!prop.showChart&&prop.showChart,this.asModal=!!prop.asModal&&prop.asModal,this.isTeamView=prop.isTeamView||!1,this.isPgView=prop.isPgView,this.modalCloseUrl=prop.modalCloseUrl,this.modal=void 0,this.modalId="viewSalModal",this.tabId=settingsPage.tabId,this.isCustomView=prop.isCustomView||!1,this.divId="myDataView",this.setPgId()}async getEmpSalDet(){var params={conreqcsr:csrfToken,method:"loadMyView"};this.recordId&&(this.isCustomView?params.recordId=this.recordId:params.erecno=this.recordId);const response=await Compensation.Utils.sendReqAsPromise("/compensation/salary/myView",params);return Promise.resolve(response)}appendCompRow(compRows){return compRows.map(obj=>`<div><em class="w300">${ZSEC.Encoder.encodeForHTML(obj.name)}</em><em class="w20">:</em><span class="text-right mask">${obj.annually_fmt}</span></div>`).join("")}appendEarningsHtml(compRows,summaryObj,currCode){let earningsHtml="",totalSalTxt=summaryObj.hasDeductionsComp?`${ZPI18N.getString("zp.compensation.grossEarnings")} (A)`:ZPI18N.getString("zp.compensation.grossEarnings");for(const obj of compRows)obj.comp_Category!=Compensation.components.COMPCATEGORY_EARNINGS&&summaryObj.hasDeductionsComp||(earningsHtml+=`<div aria-hidden="true"><em class="w200">${ZSEC.Encoder.encodeForHTML(obj.name)}</em><em class="w20">:</em><span class="text-right mask">${obj.annually_fmt}</span></div>`);return""!=earningsHtml&&(earningsHtml+=`<div class="wd100_per tot_bdr">\n \t\t\t\t\t\t\t\t<div class="zpl_frmcust">\n \t\t\t\t\t\t\t\t\t<div aria-hidden="true">\n \t\t\t\t\t\t\t\t\t\t<b class="w200">${totalSalTxt}</b>\n \t\t\t\t\t\t\t\t\t\t<em class="w20">:</em>\n \t\t\t\t\t\t\t\t\t\t<span class="text-right mask"><b>${summaryObj.annualGrossEarningInNo_fmt.replace(currCode,"").trim()}</b></span>\n \t\t\t\t\t\t\t\t\t</div>\n \t\t\t\t\t\t\t\t</div>\n \t\t\t\t\t\t\t</div>`),earningsHtml}appendDeductionsHtml(compRows,summaryObj,currCode){let deductionsHtml="";for(const obj of compRows)obj.comp_Category==Compensation.components.COMPCATEGORY_DEDUCTIONS&&(deductionsHtml+=`<div aria-hidden="true"><em class="w200">${ZSEC.Encoder.encodeForHTML(obj.name)}</em><em class="w20">:</em><span class="text-right mask">${obj.annually_fmt}</span></div>`);return""!=deductionsHtml&&(deductionsHtml+=`<div class="wd100_per tot_bdr">\n \t\t\t\t\t\t\t\t<div class="zpl_frmcust">\n \t\t\t\t\t\t\t\t\t<div aria-hidden="true">\n \t\t\t\t\t\t\t\t\t\t<b class="w200">${ZPI18N.getString("zp.compensation.totalDeductions")} (B)</b>\n \t\t\t\t\t\t\t\t\t\t<em class="w20">:</em>\n \t\t\t\t\t\t\t\t\t\t<span class="text-right mask"><b>${summaryObj.totalDeductionsInNo_fmt.replace(currCode,"").trim()}</b></span>\n \t\t\t\t\t\t\t\t\t</div>\n \t\t\t\t\t\t\t\t</div>\n \t\t\t\t\t\t\t</div>`),deductionsHtml}appendBenefitsHtml(compRows,summaryObj,currCode){let benefitsHtml="";return 0==compRows.length?benefitsHtml:(benefitsHtml=compRows.map(obj=>`<div aria-hidden="true"><em class="w200">${ZSEC.Encoder.encodeForHTML(obj.name)}</em><em class="w20">:</em><span class="text-right mask">${obj.annually_fmt}</span></div>`).join(""),benefitsHtml+=`<div class="wd100_per tot_bdr">\n \t\t\t\t\t\t\t<div class="zpl_frmcust">\n \t\t\t\t\t\t\t\t<div aria-hidden="true">\n \t\t\t\t\t\t\t\t\t<b class="w200">${ZPI18N.getString("zp.compensation.totalBenefits")}</b>\n \t\t\t\t\t\t\t\t\t<em class="w20">:</em>\n \t\t\t\t\t\t\t\t\t<span class="text-right mask"><b>${summaryObj.totalBenefitsInNo_fmt.replace(currCode,"").trim()}</b></span>\n \t\t\t\t\t\t\t\t</div>\n \t\t\t\t\t\t\t</div>\n \t\t\t\t\t\t</div>`)}appendSalRevs(revHist,hideRevDet){return revHist.map(obj=>`<tr><td><span>${obj.effectiveFrom}</span></td><td aria-hidden="true"><span class="mask">${obj.revSalary_fmt}</span></td><td class="${hideRevDet?"DNI":""}" aria-hidden="true"><div class="txtbrk1 w200"><span class="mask">${obj.revAmount_fmt} - ${obj.revPercentage}%</span></div></td><td><span>${obj.reason}</span></td></tr>`).join("")}showRevLtrs(){let recId=Layout.Page.urlparam.recordId;let empId=ZPeople.getUserDetailsById(recId).empid;Compensation.RL.viewRevLtrModal(this.recordId,ZPeople.decodeTxt(empId),this.revLetters)}loadRevisionChart(effDates,salaryArr,salaryArrFmt){Highcharts.chart("salRevChartView",{chart:{zoomType:"x",height:350,spacingTop:30,spacingLeft:20,spacingRight:5,spacingBottom:30,plotBorderWidth:1,plotBorderColor:"#f3f3f3"},title:{text:""},credits:{enabled:!1},exporting:{enabled:!1},xAxis:{categories:effDates,labels:{style:{fontWeight:"bold"}},title:{text:ZPI18N.getString("zp.local.Effectivedate"),style:{color:Highcharts.getOptions().colors[1],fontWeight:"bold"}}},yAxis:{labels:{style:{color:Highcharts.getOptions().colors[1],fontWeight:"bold"}},title:{text:ZPI18N.getString("zp.salary"),style:{color:Highcharts.getOptions().colors[1],fontWeight:"bold"}}},tooltip:{enabled:!1},legend:{enabled:!1},series:[{type:"column",colorByPoint:!1,data:salaryArr.slice(salaryArr.length>5?salaryArr.length-5:0,salaryArr.length),dataLabels:{enabled:!0,formatter:function(){let fmtVal=salaryArrFmt[salaryArr.indexOf(this.y)];return fmtVal||this.y}},maxPointWidth:50}]})}renderRevChart(chartDetails){if(!this.showChart)return;let effDatesArr=[],revSalaryArr=[],revSalaryFmtArr=[];chartDetails.forEach(obj=>{effDatesArr.splice(0,0,obj.effDate),revSalaryArr.splice(0,0,1*obj.revisionSal),revSalaryFmtArr.splice(0,0,obj.formatCTC)}),this.loadRevisionChart(effDatesArr,revSalaryArr,revSalaryFmtArr)}appendRevChart(chartDetails){return this.showChart&&chartDetails.length>0?'<div class="zpl_comp_chart" id="salRevChartView"></div>':""}loadSalaryTab(){let loader=new LoadingClass(this.container);loader.add(),this.getEmpSalDet().then(resp=>{loader.remove(),this.setHtml(resp),this.show(resp)})}loadRevisionTab(){let loader=new LoadingClass(this.container);loader.add(),Compensation.SalRevision.Operations.initEmpRevView(this.recordId,resp=>{this.revViewLoadCallback(resp,loader)},()=>{this.cancelRevCb()})}cancelRevCb(){this.refreshUserProfHdr()}revViewLoadCallback(resp,loader){let revArr=resp.revDataArr;this.revHist=revArr,this.revLetters=resp.revLetters,loader.remove()}updatePgHeader(actionHtml){if(!this.asModal){let empProf=Layout.Page.pageContWrapper.find("div.zpl_cstmProfNav").find("div.ZPrevwHD");0!=actionHtml.length?empProf.addClass("d-flex j-cnt-btwen a-itm-cntr").append(actionHtml):empProf.removeClass("d-flex j-cnt-btwen a-itm-cntr")}}getTabObj(){let tabObj=selfSalary.tabObj[this.recordId];return tabObj=tabObj||{isRefresh:!0},selfSalary.tabObj[this.recordId]=tabObj,tabObj}setPgId(){this.tabId&&this.tabId.includes("-revision")?this.pgId="salRev":this.pgId="empSal"}async constructPage(recordId){this.recordId=recordId,selfSalary.currViewObj=this;let tabObj=this.getTabObj();this.isPgView&&this.container.html(""),this.tabId&&this.tabId.includes("-revision")?this.loadRevisionTab():this.loadSalaryTab(),tabObj.isRefresh=!1}getNoDataHtml(hasDoj){if(!this.container)return"";0==this.container.find("#noData").length&&this.container.append('<div id="noData"></div>');var isMyDataPg=settingsUrlProps.niceUrl.includes("salarydetails/mysalary/view"),emptyhtml=new EmptyPages("zp_nd_salary",ZPI18N.getString("zp.noSalaryRecord"),"",this.container.find("#noData"));if(!hasDoj&&!isMyDataPg){let eMsg=ZPI18N.getString("zp.compensation.revisionErrMsg.dojNotUpdated");if(isadmin){let paramArr=[`<a onclick="Compensation.Utils.updateEmpRec('${this.recordId}',true)">${ZPI18N.getString("zp.dateofjoining")}</a>`];eMsg=ZPI18N.getString("zp.compensation.revisionErrMsg.dojAdminErr",paramArr)}emptyhtml=new EmptyPages("zp_nd_salary","",eMsg,this.container.find("#noData"))}return emptyhtml}setHtml(resp){let salInfo=resp.salaryInfo,revhist=resp.revisionHistory;this.revHist=revhist,this.revLetters=resp.revLetters;let chartDetails=resp.chartDetails;if(!(salInfo&&0!=salInfo.ctc)){let hasDoj=salInfo&&!_.isEmpty(salInfo.doj);return void(this.datahtml=this.getNoDataHtml(hasDoj))}let ctcComps=resp.breakupObj.compList?resp.breakupObj.compList.ctcComps:[],benComps=resp.breakupObj.compList?resp.breakupObj.compList.benefits:[],hasPckg=void 0!=resp.salaryInfo.tid&&!_.isEmpty(resp.salaryInfo.tid),hasrev=0!=revhist.length,lastRev=hasrev?revhist[0]:"",hideRevDet=!!_.isEmpty(lastRev)||!lastRev.revPercentage,summary=resp.breakupObj.summary?resp.breakupObj.summary:{},isSampleData=resp.salaryInfo.isSampleData,deductionsHtml=this.appendDeductionsHtml(ctcComps,summary,salInfo.currCode),showDeductionsCls=""==deductionsHtml?"zpl_DNI":"";Layout.Page.pageContWrapper.find("#compSampleBadge")&&Layout.Page.pageContWrapper.find("#compSampleBadge").remove(),isSampleData&&(Layout.Page.pageContWrapper.find(".zpl_usrprfdv").append('<div id="compSampleBadge"><span class="zbadges zbadges--green zpl_ml2" id="sample_data_badge">Sample Data</span></div>'),Layout.Page.pageContWrapper.find(".zpl_usrprfdv").addClass("a-itm-cntr"));let grossSalTxt=summary.hasDeductionsComp?`${ZPI18N.getString("zp.totalSalary")} ${ZPI18N.getString("zp.in")} ${salInfo.currCode} (A + B)`:`${ZPI18N.getString("zp.totalSalary")} ${ZPI18N.getString("zp.in")} ${salInfo.currCode}`;this.datahtml=`<div class="zpl_crd zpl_crdsalbrk wd100_per">\n\t\t\t            <div class="zpl_crdlstbx">\n\t\t\t                <ul>          \n\t\t\t                    <li class="lft">\n\t\t\t                        <div class="zpl_crdlstbxcnt flex-dirR" id="${this.divId}">\n\t\t\t                            <div class="w550 a-itm-left">\n\t\t\t                                <div class="zpl_panlhdr d-flex j-cnt-btwen a-itm-cntr">\n\t\t\t                                    <h5>${ZPI18N.getString("zp.compensation.employeeSummary")}</h5>\n\t\t\t                                    ${this.isPgView||!this.asModal?`<a name="showdata">${ZPI18N.getString("zp.show")}</a>`:""}\n\t\t\t                               </div>\n\t\t\t                                <div class="wd100_per">\n\t\t\t                                    <div class="zpl_frmcust">\n\t\t\t                                        <div>\n\t\t\t                                            <em class="w200">${ZPI18N.getString("zp.employeename")}</em>\n\t\t\t                                            <em class="w20">:</em>\n\t\t\t                                            <span>${ZSEC.Encoder.encodeForHTML(salInfo.name)}</span>\n\t\t\t                                        </div>\n\t\t\t                                        <div>\n\t\t\t                                            <em class="w200">${ZPI18N.getString("zp.local.Dateofjoining")}</em>\n\t\t\t                                            <em class="w20">:</em>\n\t\t\t                                            <span>${salInfo.doj}</span>\n\t\t\t                                        </div>\n\t\t\t                                        <div>\n\t\t\t                                            <em class="w200">${ZPI18N.getString("zp.compensation.LastRevision")}</em>\n\t\t\t                                            <em class="w20">:</em>\n\t\t\t                                            <span>${salInfo.effectiveFrom}</span>\n\t\t\t                                        </div>`,this.datahtml+=hasrev?`<div class="${lastRev.prevSalary_fmt?"":"DNI"}" aria-hidden="true">\n\t\t\t                                            <em class="w200">${ZPI18N.getString("zp.compensation.PreviousCTC")}</em>\n\t\t\t                                            <em class="w20">:</em>\n\t\t\t                                            <span class="mask">${lastRev.prevSalary_fmt}</span>\n\t\t\t                                        </div>`:"",this.datahtml+=` <div aria-hidden="true">\n\t\t\t                                            <em class="w200">\n\t\t\t                                            \x3c!-- ${ZPI18N.getString("zp.local.CurrentCTC")} --\x3e\n\t\t\t                                            ${ZPI18N.getString("zp.local.currentsalary")}\n\t\t\t                                            </em>\n\t\t\t                                            <em class="w20">:</em>\n\t\t\t                                            <span class="mask">${salInfo.ctc_fmt}</span>\n\t\t\t                                        </div>\n\t\t\t                                        <div class="tot_box" aria-hidden="true">\n\t\t\t                                           \x3c!-- <em>${ZPI18N.getString("zp.compensation.CostToTheCompany")}</em> --\x3e\n\t\t\t                                           <em>${ZPI18N.getString("zp.totalSalary")} (${ZPI18N.getString("zp.compensation.perAnnum")})</em>\n\t\t\t                                            <div class="d-flex flex-dirC a-itm-cntr mw300">\n\t\t\t                                            \t<strong class="mask">${salInfo.ctc_fmt}</strong>\n\t\t\t                                            \t${void 0!=resp.ctcInWords?`<em class="mask">${resp.ctcInWords}</em>`:""}\n\t\t\t                                            </div>\n\t\t\t                                            \n\t\t\t                                        </div>\n\t\t\t                                    </div>\n\t\t\t                                </div>\n\t\t\t                            </div>`,this.datahtml+=hasPckg&&0!=Object.keys(resp.breakupObj).length?`<div class="flex-dirC a-itm-left flex-grow j-cnt-fs">\n\t\t\t                                <div class="zpl_panlhdr">\n\t\t\t                                    <h5>${ZPI18N.getString("zp.compensation.salaryBreakupLbl")}</h5>\n\t\t\t                                </div>\n\t\t\t                                <div class="wd100_per zpl_crdlstbxcnt d-flex flex-grow">\n\t\t\t                                    <div class="wd100_per">\n\t\t\t                                        <div class="zpl_frmcust ${0==ctcComps.length?"zpl_DNI":""}">\n\t\t\t                                            <h5>${ZPI18N.getString("zp.compensation.componentType.Earnings")}</h5>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t${this.appendEarningsHtml(ctcComps,summary,salInfo.currCode)}\n\t\t\t                                        </div>\n\t\t\t                                        <div class="zpl_frmcust ${showDeductionsCls}">\n\t\t\t                                            <h5>${ZPI18N.getString("zp.compensation.componentType.Deductions")}</h5>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t${deductionsHtml}\n\t\t\t                                        </div>\n\t\t\t                                        <div class="zpl_frmcust ${0==benComps.length?"zpl_DNI":""}">\n\t\t\t                                            <h5>${ZPI18N.getString("zp.compensation.Benefits")}</h5>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t${this.appendBenefitsHtml(benComps,summary,salInfo.currCode)}\n\t\t\t                                        </div>\n\t\t\t                                    </div>\n\t\t\t                                    <div class="wd100_per tot">\n\t\t\t                                        <div class="zpl_frmcust">\n\t\t\t                                            <div aria-hidden="true">\n\t\t\t                                                <b class="w200">${grossSalTxt}</b>\n\t\t\t                                                <em class="w20">:</em>\n\t\t\t                                                <span class="text-right mask">\n\t\t\t                                                    <b>${salInfo.ctc_fmt.replace(salInfo.currCode,"").trim()}</b>\n\t\t\t                                                </span>\n\t\t\t                                            </div>\n\t\t\t                                        </div>\n\t\t\t                                    </div>\n\t\t\t                                </div>\n\t\t\t                            </div>`:"",this.datahtml+=hasrev?`<div class="zpl_salhist flex-grow">\n\t\t\t                                <div class="zpl_panlhdr wd100_per">\n\t\t\t                                    <h5>${ZPI18N.getString("zp.compensation.salaryHistoryLbl")}</h5>\n\t\t\t                                </div>\n\t\t\t                                <div class="zpl_crdlstbxcnt wd100_per">\n\t\t\t\t\t\t\t\t\t\t\t\t${this.appendRevChart(chartDetails)}\n\t\t\t                                    <div class="zpl_tblres M0I">\n\t\t\t                                        <table class="zpl_tbl">\n\t\t\t                                            <thead>\n\t\t\t                                                <tr>\n\t\t\t                                                    <th>\n\t\t\t                                                        ${ZPI18N.getString("zp.local.Effectivedate")}\n\t\t\t                                                    </th>\n\t\t\t                                                    <th class="mw180">\n\t\t\t                                                        \x3c!-- csutom_term ${ZPI18N.getString("zp.compensation.ctc")} --\x3e\n\t\t\t                                                        ${ZPI18N.getString("zp.salary")} \n\t\t\t                                                    </th>\n\t\t\t                                                    <th class="mw220 ${hideRevDet?"DNI":""}">\n\t\t\t                                                        ${ZPI18N.getString("zp.compensation.revAmt")} / ${ZPI18N.getString("zp.percentage")}\n\t\t\t                                                    </th>\n\t\t\t                                                    <th>\n\t\t\t                                                        ${ZPI18N.getString("zp.reason")}\n\t\t\t                                                    </th>\n\t\t\t                                                </tr>\n\t\t\t                                            </thead>\n\t\t\t                                            <tbody>                                \n\t\t\t                                               ${this.appendSalRevs(revhist,hideRevDet)}\n\t\t\t                                            </tbody>\n\t\t\t                                        </table>\n\t\t\t                                    </div>\n\t\t\t                                  </div>`:"",this.datahtml+="</div>\n\t\t\t                        </div>\n\t\t\t                    </li>          \n\t\t\t                </ul>\n\t\t\t            </div>\n\t\t\t        </div>"}getHtml(){return this.datahtml}getModalHdrFtr(data,revLtrHtml){return[`   <div class="d-flex j-cnt-btwen a-itm-cntr wd100_per">\n\t\t\t\t      <div class="zpl_em w550">\n\t\t\t\t          <div class="zpl_emimg"><img src="${data.empPhoto}"></div>\n\t\t\t\t          <div class="zpl_emdts">\n\t\t\t\t              <div><em>${ZSEC.Encoder.encodeForHTML(data.empNo)} - </em><b>${ZSEC.Encoder.encodeForHTML(data.name)}</b></div><em>${ZSEC.Encoder.encodeForHTML(data.desgn)}</em><div><em>${ZSEC.Encoder.encodeForHTML(data.department)}</em></div>\n\t\t\t\t          </div>\n\t\t\t\t      </div>\n\t\t\t\t\t  ${revLtrHtml}\n\t\t\t\t      <div class="d-flex flex-grow DNI" style="font-size: 13px;">\n\t\t\t\t          <ul class="d-flexclmcap5 flex-dirC flex-basis50">\n\t\t\t\t              <li class="d-flex">\n\t\t\t\t                  <em class="w150">${ZPI18N.getString("zp.dateofjoining")}:</em>\n\t\t\t\t                  <span>${data.doj}</span>\n\t\t\t\t              </li>\n\t\t\t\t              <li class="d-flex">\n\t\t\t\t                  <em class="w150">\n\t\t\t\t                  \x3c!-- ${ZPI18N.getString("zp.local.CurrentCTC")}: --\x3e\n\t\t\t\t                   ${ZPI18N.getString("zp.local.currentsalary")}:\n\t\t\t\t                  </em>\n\t\t\t\t                  <span>${data.ctc_fmt}</span>\n\t\t\t\t              </li>            \n\t\t\t\t          </ul>\n\t\t\t\t          <ul class="d-flexclmcap5 flex-dirC flex-basis50">\n\t\t\t\t              <li class="d-flex">\n\t\t\t\t                  <em class="w150">${ZPI18N.getString("zp.experience")}:</em>\n\t\t\t\t                  <span>${data.exp}</span>\n\t\t\t\t              </li>\n\t\t\t\t              <li class="d-flex">\n\t\t\t\t                  <em class="w150">${ZPI18N.getString("zp.department")}:</em>\n\t\t\t\t                  <span>${ZSEC.Encoder.encodeForHTML(data.department)}</span>\n\t\t\t\t              </li>\n\t\t\t\t          </ul>\n\t\t\t\t      </div>\n\t\t\t\t    </div>\n\t\t\t\t    <a id="sliderCls" class="_cls PI_cls"></a>`,`<button id="sliderCancel" type="button" class="zlabel zlabel--outline zlabel--medium">${ZPI18N.getString("zp.close")}</button>`]}refreshUserProfActs(){selfSalary.destroy(this.recordId),selfSalary.updateUsrProf()}refreshView(){this.getTabObj().isRefresh=!0,this.refreshUserProfActs(),this.constructPage(this.recordId)}addUpdateCallback(revId){revId?Compensation.SalRevision.Operations.showSingleRecView(revId,!0,()=>{this.refreshView()}):this.refreshView()}addUpdateSalary(mode){Compensation.Salary.Operations.addSalaryForUsr(this.recordId,!0,revId=>{this.addUpdateCallback(revId)},mode)}getActionBtns(hasSalary,salInfo,hasRevLtrs){let actionHtml="";return this.isPgView?actionHtml:actionHtml=hasRevLtrs?`<a data-popup-open="RevisionLetter" name="viewRevLtr">${ZPI18N.getString("zp.viewComp",new Array(ZPI18N.getString("zp.comp.rlg.salrevlet")))}</a>`:""}show(resp){let dataHtml=this.getHtml(),hasRevLtrs=(resp.revisionHistory,resp.revLetters&&resp.revLetters.length>0),salInfo=resp.salaryInfo,hasSalary=salInfo&&!_.isEmpty(salInfo.etid),actionBtnHtml=this.getActionBtns(hasSalary,salInfo,hasRevLtrs);this.isPgView||this.updatePgHeader(actionBtnHtml);let canShowData=this.canShowData();if(hasSalary){if(this.asModal){const sModObj=new sliderModal("",new Tab(this.modalId,()=>{settingsPage.container.find("#card"+this.modalId).html(dataHtml)},()=>{}));sModObj.largeSize=!0;let[mHdr,mFtr]=this.getModalHdrFtr(resp.salaryInfo,actionBtnHtml);sModObj.construct(mHdr,mFtr),this.container=settingsPage.container.find("#card"+this.modalId),sModObj.setCloseCallback(()=>{if(sModObj.remove(),this.modalCloseUrl)return void(window.location.hash="#"+this.modalCloseUrl);let url=settingsUrlProps.niceUrl.replace("/view","");if(ZPUtil.isV5SettingsUrl()){let urlParams=Layout.Page.hash.split("-")[1];(urlParams=urlParams.replace("recordId:"+this.recordId,""))&&urlParams.length>0&&(url+="-"+(urlParams.startsWith("/")?urlParams.substr(1,urlParams.length):urlParams))}window.location.hash="#"+url}),this.isPgView||this.container.find("#"+this.divId).toggleClass("showData")}else this.container.html(dataHtml);if(this.datahtml=this.container.find("#"+this.divId).html(),canShowData){let chartDetails=resp.chartDetails;this.renderRevChart(chartDetails)}else this.removeData()}else dataHtml.show();this.handlePgEvent(resp)}canShowData(){return!this.isPgView&&this.asModal||this.container.find("div#"+this.divId).hasClass("showData")}removeData(){this.container.find(".mask b").html("&nbsp;"),this.container.find(".mask:not(:has(b))").html("&nbsp;"),this.container.find("#salRevChartView").html(""),this.container.find("div.zpl_ratio_track").parents("div.zpl_ratio").addClass("zpl_ratio_dum")}toggleData(resp){let isMasked=!this.canShowData(),txt=isMasked?ZPI18N.getString("zp.hide"):ZPI18N.getString("zp.show");if(isMasked){let dataHtml=this.getHtml();this.container.find("#"+this.divId).html(dataHtml);let chartDetails=resp.chartDetails;this.renderRevChart(chartDetails),this.container.find("div.zpl_ratio_track").parents("div.zpl_ratio").removeClass("zpl_ratio_dum")}else this.removeData();this.container.find("#"+this.divId).toggleClass("showData"),this.container.find("a[name=showdata]").text(txt)}actionTypeHandler(selItem){switch(selItem.value){case"0":let mode="update";return void this.addUpdateSalary(mode);case"1":return void this.showRevLtrs()}}handlePgEvent(resp){let pgWrap=this.asModal?this.container.parents("div#tab"+this.modalId):Layout.Page.pageContWrapper;this.asModal&&(pgWrap.find("a[name=viewRevLtr]").off("click"),pgWrap.find("a[name=viewRevLtr]").on("click",()=>{selfSalary.currViewObj.showRevLtrs()})),"empSal"==this.pgId&&(pgWrap.off("click","a[name=showdata]"),pgWrap.on("click","a[name=showdata]",()=>{this.toggleData(resp)}))}}Compensation.SalaryHikes={BODY:`\n\t<div id="comp_hikeDiv" class="zpl_rgtcnt zpl_crdwthful DNI">\n            <div class="zpl_crd">\n              <div class="zpl_crdhdr">\n                <div>\n                  <h4>${ZPI18N.getString("zp.compensation.salaryhikepush.tbhdr")}</h4>\n                  <p>${ZPI18N.getString("zp.compensation.hikepageDesc_b")}</p>                \n                </div>\n              </div> \n            </div>\n            <div class="zpl_tblres">\n                <table class="zpl_tbl">\n                    <thead>\n                        <tr>\n                            <th>${ZPI18N.getString("zp.message")}\n                            </th>\n                            <th width="15%">${ZPI18N.getString("zp.appraisalcycle")}\n                            </th>\n                            <th width="25%">${ZPI18N.getString("zp.requestedon")}</th>\n                            <th>${ZPI18N.getString("zp.status")}</th>\n                        </tr>\n                    </thead>\n                    <tbody id="comp_hikeReqListing">\n                        \n                    </tbody>\n                </table>\n\t\t\t\t<div id="emptyDiv"></div>\n            </div>\n        </div>`,MODAL_BDY:` <div class="zpl_crd" id="hikeApprDtlView">\n\t\t\t\t        <div class="zpl_crdcnt">\n\t\t\t\t          <div class="zpl_secn">\n\t\t\t\t            <div>\n\t\t\t\t              <div class="zpl_tblres">\n\t\t\t\t                <table class="zpl_tbl wd100_per">\n\t\t\t\t                  <thead>\n\t\t\t\t                    <tr>\n\t\t\t\t                      <th width="35%">${ZPI18N.getString("zp.name")}</th>\n\t\t\t\t                      <th width="250">${ZPI18N.getString("zp.local.revisedsalary")}</th>\n\t\t\t\t                      \n\t\t\t\t                      <th width="250">${ZPI18N.getString("zp.pa.sh.hikepercentage")}</th>\n\t\t\t\t                      <th width="250">${ZPI18N.getString("zp.pa.sh.hikeamount")}</th>\n\t\t\t\t                      <th width="100">${ZPI18N.getString("zp.status")}</th>\n\t\t\t\t                    </tr>\n\t\t\t\t                  </thead>\n\t\t\t\t                  <tbody id="hikeDtlViewBdy">\n\t\t\t\t                    \n\t\t\t\t                  </tbody>\n\t\t\t\t                </table>\n\t\t\t\t              </div>\n\t\t\t\t            </div>\n\t\t\t\t          </div>\n\t\t\t\t\n\t\t\t\t        </div>\n\t\t\t\t      </div>`,rootSIndex:1,dataSIndex:1,rootDetails:{},HIKEPUSH_MODAL:void 0,init:function(){settingsPage.container.html(ZPeople.LOADING_HTML+Compensation.SalaryHikes.BODY),settingsPage.container.addClass("zpl_compensation"),Compensation.SalaryHikes.rootSIndex=1,Compensation.SalaryHikes.loadHikePushReqs(!1),ZPeople.FireScroll.init(Compensation.SalaryHikes.fireScrollHandlerForHikePush)},fireScrollHandlerForHikePush:function(){Compensation.SalaryHikes.loadHikePushReqs(!0)},loadHikePushReqs:async function(isScrollAction){await Compensation.Config.getConfiguration(!1);var params={conreqcsr:csrfToken},sIndex=1;isScrollAction&&(sIndex=Compensation.SalaryHikes.rootSIndex),params.sIndex=sIndex,ZPeople.Request.send("/compensation/hike/list",params,Compensation.SalaryHikes.constructHikeReqPageBody)},constructHikeReqPageBody:function(resultdata){let pageHtml="";if(1!=Compensation.SalaryHikes.rootSIndex&&0==resultdata.length)return;let isRefresh=1==Compensation.SalaryHikes.rootSIndex,msg=ZPI18N.getString("zp.compensation.noSalaryHikeRecord");var emptyhtml=new EmptyPages("zp_nd_nodata",msg,"",settingsPage.container.find("#emptyDiv"));resultdata.length>0?(emptyhtml.remove(),settingsPage.container.find("#emptyDiv").addClass("DNI"),Compensation.SalaryHikes.rootSIndex+=resultdata.length,resultdata.forEach(hikeReq=>{let reqBy=ZSEC.Encoder.encodeForHTML(hikeReq.createdBy),cycleName=ZSEC.Encoder.encodeForHTML(hikeReq.cycleName),rootId=hikeReq.cpid,cycleId=hikeReq.cycleId,createdDate=hikeReq.createdOn.split(" ")[0],createdTime=hikeReq.createdOn.split(" ")[1]+(3==hikeReq.createdOn.split(" ").length?" "+hikeReq.createdOn.split(" ")[2]:""),status=0==hikeReq.status?ZPI18N.getString("zp.completed"):ZPI18N.getString("zp.pending");hikeReq.statusStr=status;let statusClr=0==hikeReq.status?"grn":"org",userCount=hikeReq.userCount,empPhoto=hikeReq.empPhoto;pageHtml+='<tr  name="hikeReqs" id="'+rootId+'" cycleName="'+cycleName+'" userCnt="'+userCount+'">',pageHtml+='<td  name="reqDetLi" reqBy="'+reqBy+'"><div class="zpl_em"><div class="zpl_emimg"><img src="'+empPhoto+'"></div><div class="txtbrk">'+ZPI18N.getString("zp.compensation.hikeApprNote",["<b>"+reqBy+"</b>","<b>"+cycleName+"</b>"])+"</div></div></td>",pageHtml+='<td  id="'+cycleId+'"  name="cycleName">'+cycleName+"</td>",pageHtml+='<td  name="reqOn" createdOn="'+hikeReq.createdOn+'"><span name="createdDate">'+createdDate+'<em class="gry PL10 PR10">-</em><em class="dgry S12" name="createTime">'+createdTime+"</em></span></td>",pageHtml+='<td name="rootStatus" status="'+hikeReq.status+'"><span class= "'+statusClr+'">'+status+"</span></td></tr>",Compensation.SalaryHikes.rootDetails[rootId]=hikeReq}),settingsPage.container.find("#comp_hikeReqListing").parents("table").removeClass("DNI"),isRefresh?settingsPage.container.find("#comp_hikeReqListing").html(pageHtml):settingsPage.container.find("#comp_hikeReqListing").append(pageHtml),settingsPage.container.find("tr[name=hikeReqs]").on("click",function(){Compensation.SalaryHikes.dataSIndex=1,Compensation.SalaryHikes.getHikeDetailsForRootId($(this).find("td[name=reqDetLi]").attr("reqBy"),$(this).attr("id"),$(this).find("td[name=cycleName]").attr("id"),$(this),!1),ZPeople.FireScroll.init(function(){Compensation.SalaryHikes.fireScrollHandlerToHikeDetView($(this).find("td[name=reqDetLi]").attr("reqBy"),$(this).attr("id"),$(this).find("td[name=cycleName]").attr("id"),$(this))})})):(settingsPage.container.find("#emptyDiv").removeClass("DNI"),settingsPage.container.find("#emptyDiv").siblings("table").addClass("DNI"),emptyhtml.show()),settingsPage.container.find("#zp_page_loading").remove(),settingsPage.container.find("#comp_hikeDiv").removeClass("DNI")},fireScrollHandlerToHikeDetView:function(reqBy,rootId,cycleId,obj){Compensation.SalaryHikes.getHikeDetailsForRootId(reqBy,rootId,cycleId,obj,!0)},showHikeModal:function(rootId,isScrollAction,mySpace){let hikeReq=void 0!=mySpace?mySpace:Compensation.SalaryHikes.rootDetails[rootId],reqBy=ZSEC.Encoder.encodeForHTML(hikeReq.createdBy),cycleName=ZSEC.Encoder.encodeForHTML(hikeReq.cycleName),cycleFrom=hikeReq.cycleFrom,cycleTo=hikeReq.cycleTo,status=hikeReq.status,statusStr=hikeReq.statusStr,statusClr="0"==status?"green":"yellow",actionNote=ZPI18N.getString("zp.compensation.hikeApprNote",[reqBy,cycleName]),cycleId=hikeReq.cycleId;const sModObj=new sliderModal("",new Tab("salHkModal",function(){settingsPage.container.find("#cardsalHkModal").html(Compensation.SalaryHikes.MODAL_BDY)},Compensation.SalaryHikes.pushHikesToRevTbl));sModObj.largeSize=!0;let hdrCnt=`<div class="zpl_mhder_mul">\n\t\t\t\t\t\t\t<div class="d-flexclmcap10"><h4>${cycleName}</h4>\n\t\t\t\t                <div class="d-flex">\n\t\t\t\t                    <em>${cycleFrom} - ${cycleTo}</em>\n\t\t\t\t                    <span class="zlabel zlabel--${statusClr} zlabel--small">${statusStr}</span>\n\t\t\t\t                </div>\n           \t\t\t\t    </div>\n           \t\t\t\t\t <p>${actionNote}</p>\n       \t\t\t\t\t </div>\n\t\t\t\t\t\t<a id="sliderCls" class="_cls PI_cls "></a>`,ftrCnt=`<button id="zp_pushHikes" type="button" class="zlabel zlabel--blue zlabel--medium">${ZPI18N.getString("zp.compensation.hikePushBtn")}</button> <button id="sliderCancel" type="button" class="zlabel zlabel--outline zlabel--medium">${ZPI18N.getString("zp.close")}</button>`;sModObj.construct(hdrCnt,ftrCnt),sModObj.setCloseCallback(()=>{sModObj.remove()}),Compensation.SalaryHikes.HIKEPUSH_MODAL=sModObj.sliderDiv;var addInfo={rootStatus:status,isHikeApprEnabled:hikeReq.isHikeApprEnabled},params={conreqcsr:csrfToken,cycleId:cycleId,rootId:rootId},sIndex=1;isScrollAction&&(sIndex=Compensation.SalaryHikes.dataSIndex),params.sIndex=sIndex,ZPeople.Request.sendAsyncPost("/compensation/hike/getrootdata",params,Compensation.SalaryHikes.showHikeDetails,addInfo)},getHikeDetailsForRootId:function(reqBy,rootId,cycleId,obj,isScrollAction){Compensation.SalaryHikes.showHikeModal(rootId,isScrollAction)},showHikeDetails:function(resultData,params,moreInfo){let modalDiv=Compensation.SalaryHikes.HIKEPUSH_MODAL;var isHikeApprEnabled=void 0!=moreInfo.isHikeApprEnabled?moreInfo.isHikeApprEnabled:Compensation.Config.configObj.isHikeApprovalEnabled;let hikeRowHtml="";var rootId=params.rootId;let rootStatus=moreInfo.rootStatus,isRefresh=1==Compensation.SalaryHikes.dataSIndex;Compensation.SalaryHikes.dataSIndex+=resultData.length,resultData.forEach(hikedata=>{let hikePushId=hikedata.cpid,empName=hikedata.empDet.dispName,revCTC=(hikedata.currCTC,hikedata.revCTC),hikePerc=hikedata.hikePerc,hikeAmt=hikedata.hikeAmount,hikeStatus=hikedata.hikeStatus;var hasValErr=!1;if(2==hikeStatus){hasValErr=!0;hikedata.validationErr[0]}hikeRowHtml+=`<tr id="${hikePushId}" class=${hasValErr?"errLst":""}>\n\t\t                             <td><div class="zpl_em">\n\t\t\t\t                            <div class="zpl_emdts">\n\t\t\t\t                                <div><b>${empName}</b></div>\n\t\t\t\t                            </div>\n\t\t\t\t                        </div>`,hasValErr&&(hikeRowHtml+=`<div class="errLstDiv">${hikedata.validationErr[0].errMsg}</div>`);let apprCls="PI_tick2",rejCls="PI_cls2";hikeRowHtml+=`</td>\n\t\t                             <td><div>${revCTC}</div></td>\n\t\t                             <td><div>${hikePerc}%</div></td>\n\t\t                             <td><div>${hikeAmt}</div></td>\n\t\t                             <td><div class="d-flexclmcap10">`;let isCompleted=6==hikeStatus||4==hikeStatus||5==hikeStatus;hasValErr?(apprCls+=" gry",rejCls+=" gry"):6==hikeStatus?(apprCls+=" DNI",rejCls+=" red"):4==hikeStatus||5==hikeStatus?(apprCls+=" grn",rejCls+=" DNI"):apprCls+=" grn sel",hikeRowHtml+=`<i name="apprHike" class="${apprCls}" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="${isCompleted?ZPI18N.getString("zp.processed"):ZPI18N.getString("zp.process")}" status=${hikeStatus}></i>\n\t\t\t\t\t\t\t\t <i name="rejectHike" class="${rejCls}" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="${isCompleted?ZPI18N.getString("zp.rejected"):ZPI18N.getString("zp.reject")}" status=${hikeStatus}></i>\n\t\t\t\t\t\t\t\t </div></td>\n\t                             </tr>`}),isHikeApprEnabled&&0!=rootStatus?modalDiv.find("#zp_pushHikes").show():modalDiv.find("#zp_pushHikes").hide(),modalDiv.attr("rootid",rootId),isRefresh?settingsPage.container.find("#hikeDtlViewBdy").html(hikeRowHtml):settingsPage.container.find("#hikeDtlViewBdy").append(hikeRowHtml),Compensation.SalaryHikes.handleEventsForHikeDtlView()},handleEventsForHikeDtlView:function(){let modalDiv=Compensation.SalaryHikes.HIKEPUSH_MODAL,modalBdy=modalDiv.find("#hikeDtlViewBdy");modalBdy.find("i[name=apprHike]").not(".gry").on("click",function(){6!=$(this).attr("status")&&($(this).siblings("i[name=rejectHike]").removeClass("sel").removeClass("red"),$(this).addClass("sel").addClass("grn"))}),modalBdy.find("i[name=rejectHike]").not(".gry").on("click",function(){let hikeStatus=$(this).attr("status");4!=hikeStatus&&5!=hikeStatus&&($(this).siblings("i[name=apprHike]").removeClass("sel").removeClass("grn"),$(this).addClass("sel").addClass("red"))}),modalDiv.find("#zp_pushHikes").on("click",Compensation.SalaryHikes.pushHikesToRevTbl)},pushHikesToRevTbl:function(){var rejectedCpIds=new Array,errRecs=new Array;let modalDiv=Compensation.SalaryHikes.HIKEPUSH_MODAL;modalDiv.find("#zp_pushHikes").attr("disabled","disabled");let modalBdy=modalDiv.find("#hikeDtlViewBdy");modalBdy.find("tr i[name=rejectHike].sel").each(function(ind,ele){rejectedCpIds[ind]=$(ele).parents("tr").attr("id")}),modalBdy.find("tr.zp_err").each(function(ind,ele){errRecs[ind]=$(ele).attr("id")});let rootId=modalDiv.attr("rootid");var params={conreqcsr:csrfToken,rootId:rootId};rejectedCpIds.length>0&&(params.rejectedHikes=rejectedCpIds.join()),errRecs.length>0&&(params.errRecs=errRecs.join()),ZPeople.Request.send("/compensation/hike/push",params,Compensation.SalaryHikes.handleHikeResp)},handleHikeResp:function(resultData){let modalDiv=Compensation.SalaryHikes.HIKEPUSH_MODAL;if(resultData.hasError)ZPeople.Message.showFailureMsg(resultData.errMsg),modalDiv.find("#zp_pushHikes").removeAttr("disabled");else{let successMsg=ZPI18N.getString("zp.compensation.hikeDetSuccessful");ZPeople.Message.showSuccessMsg(successMsg),window.location.reload()}}};