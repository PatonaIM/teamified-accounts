function ZE(initobj){"use strict";if(this.state="loading",this.mode="richtext",this.afterload=[],initobj&&"plaintext"===initobj.mode&&(this.mode="plaintext"),this.initobj=initobj||{},this.outerdiv=void 0!==initobj.currentContainer?initobj.currentContainer.find("#"+ZPUtil.escapeSelector(initobj.id)):document.getElementById(initobj.id),this.editordiv=void 0,this.toolbardiv=void 0,this.toolbarobject=void 0,this.createToolbar(),this.createEditor(),ZE_Init.needEditorStats&&(this.clickCount={}),ZE_Init.needplaintext&&!this.initobj.avoidPlainText){var avoidFocus=!ZE_Init.needEditorFocus;"plaintext"===this.mode&&this.plainText(initobj.content,{avoidFocus:avoidFocus,plainTextData:ZE_Init.plainTextDataDef})}ZE.sendInitRequest()}ZE.create=function(initobj){"use strict";if(ZE_Init.loading){var load=function(){ZE_Init.loadURL(ZE_Init.jsPath+"/js/zep1.min.js","js")};setTimeout(load,0),delete ZE_Init.loading}return new ZE(initobj)},ZE.prototype.afterEditorLoad=function(tempfunction){"use strict";var editor=this;editor.state?editor.afterload.push(tempfunction):tempfunction()},ZE.prototype.setContent=function(html,avoidNewState){"use strict";var tempfunction,editor=this,_mode=editor.mode,optionsObj={};if("undefined"!=typeof html){if(editor.state)tempfunction=function(htmlToSet){return function(){editor.setContent(htmlToSet)}}(html),editor.afterload.push(tempfunction);else if(_mode&&"plaintext"===_mode)editor._textarea.value=html;else{editor.initobj.handlePasteImages&&(optionsObj.oldState=avoidNewState);var tempDiv=$("<div></div>");tempDiv=tempDiv.html(html);var matchContent=$(tempDiv).find("img");if(void 0!==matchContent[0]){for(i=0;i<matchContent.length;i++){var searchStr=matchContent[i],replaceStr=(searchStr.outerHTML,$(searchStr).attr("src"));if(void 0!==replaceStr&&-1!=replaceStr.indexOf("inlineimgpreview?"))if(0==replaceStr.indexOf("inlineimgpreview?"))$(searchStr).attr("src",urlvalue+"/"+replaceStr+"&conreqcsr="+csrfToken);else{var urlarr=replaceStr.split("inlineimgpreview?");$(searchStr).attr("src",urlvalue+"/inlineimgpreview?"+urlarr[1]+"&conreqcsr="+csrfToken)}}html=tempDiv[0].innerHTML}editor.squireInstance.setHTML(html,optionsObj),editor.win.focus(),avoidNewState||editor.saveCurrentState();try{editor.updateToolbar()}catch(e){}}ZPFeeds.Editor.addRemovePlaceholder(editor,!1)}},ZE.setProcessedContent=function(html){"use strict";var editor=this,_mode=editor.mode;html=_mode&&"plaintext"===_mode?html.replace(/\n/gi,"<br/>"):html.replace(/<br.*?>/gi,"\n")},ZE.i18n=function(key){"use strict";var lang=ZE_Init.language;return lang&&"en"!==lang?ZE.i18nObj[key]||key:key},ZE.prototype.focusAtStart=function(avoidTimeOut){"use strict";var editor=this,win=editor.win,doc=editor.doc,selection=win.getSelection()||doc.selection;if(selection){var range=editor._createRange(selection);doc.body.firstChild?(range.setStart(doc.body.firstChild,0),range.setEnd(doc.body.firstChild,0),selection.removeAllRanges(),selection.addRange(range)):selection.collapse(doc.body,0)}avoidTimeOut?win.focus():setTimeout(function(){win.focus()},300)},ZE.prototype.getRawContent=function(){"use strict";var editor=this;return editor.scspan&&"none"!==editor.scspan.style.display&&(editor.removeSpellcheckspans(),editor.scspan.style.display="none"),editor.getContent()},ZE.prototype.getContent=function(){"use strict";var _textarea,textAreaValue,_doc,docValue,editor=this,_mode=editor.mode;if(_mode&&"plaintext"===_mode){if(_textarea=editor._textarea,_textarea&&(textAreaValue=_textarea.value,editor.scspan&&"none"!==editor.scspan.style.display&&(textAreaValue=editor.getSpellcheckRemovedContent("plaintext"),textAreaValue=ZE.getText(textAreaValue)),textAreaValue))return ZE_Init.setContentProcessed&&(textAreaValue=textAreaValue.replace(/\r+/gi,""),textAreaValue=textAreaValue.replace(/\n/gi,"<br />")),textAreaValue}else if(_doc=editor.doc){if(editor.scspan&&"none"!==editor.scspan.style.display)docValue=editor.getSpellcheckRemovedContent("richtext");else{docValue=_doc.body.innerHTML;var statuscontent=_doc.body.innerHTML,tempDiv=$("<div></div>");tempDiv=tempDiv.html(statuscontent);var matchContent=$(tempDiv).find("img");if(void 0!==matchContent[0]){for(i=0;i<matchContent.length;i++){var searchStr=matchContent[i],outerhtml=searchStr.outerHTML,replaceStr=$(searchStr).attr("src");if(void 0!==replaceStr&&-1!=replaceStr.indexOf("inlineimgpreview")){var src=replaceStr.split("inlineimgpreview")[1];$(searchStr).attr("src","inlineimgpreview"+src.split("&conreqcsr")[0]),statuscontent=statuscontent.replace(outerhtml,searchStr.outerHTML)}}docValue=statuscontent}}return docValue}return""},ZE.prototype.confirmPlainText=function(content){"use strict";var editor=this,I18N=ZE.i18n;confirm(I18N("When you switch to plain text mode, you will lose the formatting and images. Continue ?"))&&(editor.plainText(content),ZE_Init.modeChange&&ZE_Init.modeChange(editor.mode))},ZE.prototype.plainText=function(content,options){"use strict";var editor=this,uls=editor.toolbardiv.getElementsByTagName("ul"),fontArr=editor.toolbardiv.getElementsByTagName("font"),_textarea=editor._textarea,ulsLen=uls.length;options=options||{},editor.mode="plaintext";for(var i=0;ulsLen>i;i++)uls[i].style.display="none",fontArr[i]&&(fontArr[i].style.display="none");var _spellcheck=editor.toolbarobject.otheroptions,_multiSpell=editor.toolbarobject.spellcheck,_att=editor.toolbarobject.attach;_spellcheck&&(_spellcheck.parentNode.parentNode.style.display=""),_att&&(_att.parentNode.parentNode.style.display=""),_multiSpell&&(_multiSpell.parentNode.parentNode.style.display=""),_textarea||(_textarea=document.createElement("textarea"),_textarea.className="ze_area",editor._textarea=_textarea,editor.editordiv.appendChild(_textarea),_textarea.onbeforedeactivate=function(){var sel=document.selection;sel&&(editor.textrange=sel.createRange())},ZE._addEvent(_textarea,"keyup",function(){var currentVal=this.value;editor.initobj.contentChanged&&"function"==typeof editor.initobj.contentChanged&&currentVal!==editor._textareaValue&&(editor._textareaValue=currentVal,editor.initobj.contentChanged())}),ZE_Init.avoidDropHandle||editor.initobj.avoidDropHandle||ZE._addEvent(_textarea,"dragover",function(evt){var effectAllowed,dt=evt.dataTransfer,I18N=ZE.i18n;if((null!==dt.types||dt.files&&dt.files.length>0)&&(dt.files&&dt.files.length>0||(dt.types.indexOf?dt.types.indexOf("Files")>-1:dt.types.contains("application/x-moz-file"))||"Files"===dt.types[0])){var mask,innerMask;if(effectAllowed=dt.effectAllowed,dt.dropEffect="move"===effectAllowed||"linkMove"===effectAllowed?"move":"copy",mask=document.getElementById("mask_editor"),!mask){mask=document.createElement("div"),mask.contentEditable="false",mask.id="mask_editor",document.body.appendChild(mask),ZE._addEvent(mask,"dragover",function(ev){clearTimeout(editor.dragTimer);var _effectAllowed=ev.dataTransfer.effectAllowed;ev.dataTransfer.dropEffect="move"===_effectAllowed||"linkMove"===_effectAllowed?"move":"copy",editor._stopEvent(ev)}),ZE._addEvent(mask,"dragleave",function(ev){editor.dragTimer=setTimeout(function(){var newMask=document.getElementById("mask_editor");newMask&&newMask.parentElement.removeChild(newMask)},250),editor._stopEvent(ev)}),ZE._addEvent(mask,"drop",function(ev){editor._stopEvent(ev),mask&&mask.parentElement.removeChild(mask);var files=ev.dataTransfer.files;files&&0!==files.length&&ZE_Init.fileUpload(editor,files,ev)});var _textareaValues=editor._textarea.getBoundingClientRect();mask.style.left=_textareaValues.left+"px",mask.style.width=_textareaValues.right+"px",mask.style.height=_textareaValues.height+"px",mask.style.width=_textareaValues.width+"px",mask.style.top=_textareaValues.top+"px",mask.style.position="absolute",innerMask=document.createElement("div"),innerMask.className="ze_drag",innerMask.contentEditable="false";var _span=document.createElement("span");innerMask.appendChild(_span),_span.innerHTML=I18N("Drop Files to Attach"),mask.appendChild(innerMask)}editor._stopEvent(evt)}})),content&&(_textarea.value=options.plainTextData?content:ZE.getText(content)),editor._textareaValue=_textarea.value,editor.iframe.style.display="none",_textarea.style.height=editor.iframe.style.height,_textarea.style.display="";try{options.avoidFocus||(_textarea.focus(),_textarea.setSelectionRange&&_textarea.setSelectionRange(0,0))}catch(e){}},ZE.prototype.richText=function(content){"use strict";for(var editor=this,uls=editor.toolbardiv.getElementsByTagName("ul"),_textarea=editor._textarea,ulsLen=uls.length,fontArr=editor.toolbardiv.getElementsByTagName("font"),i=0;ulsLen>i;i++)uls[i].style.display="",fontArr[i]&&(fontArr[i].style.display="");editor.mode="richtext",_textarea.style.display="none",editor.squireInstance.setHTML(content?ZE.getFormattedContent(content):""),ZE_Init.modeChange&&ZE_Init.modeChange(editor.mode),editor.stack&&editor.stack.commands.length>0&&(editor.stack.clearStack(),editor.saveCurrentState({cursorPosition:{start:0,end:0}})),editor.iframe.style.height=_textarea.style.height,editor.iframe.style.display="",setTimeout(function(){editor.focusAtStart(!0),editor.squireInstance.focus(),editor.updateToolbar()},0)},ZE.getFormattedContent=function(html){"use strict";return html.replace(/ /gi," ").replace(/</gi,"&lt;").replace(/>/gi,"&gt;").replace(/\n/gi,"<br>")},ZE._setAttribute=function(node,propName,value){"use strict";node.setAttribute(propName,value)},ZE._appendChildren=function(node,childNodes){"use strict";for(var len=childNodes.length,i=0;len>i;i++)node.appendChild(childNodes[i])},ZE._setStyle=function(node,properties,value){"use strict";if("object"==typeof properties)for(var _prop=Object.keys(properties),len=_prop.length,i=0;len>i;i++)node.style[_prop[i]]=properties[_prop[i]];else"string"==typeof properties&&(node.style[properties]=value)},ZE.setCss=function(node,propName,value){"use strict";node.style[propName]=value},ZE.getText=function(html){"use strict";if(html){var htmlToText=function(resultHTML){var divElem,i,aElemLength,aElem=[],regExArr=[],aTagList=[];if(divElem=document.createElement("div"),divElem.innerHTML="",resultHTML=resultHTML.replace(/\n+/gi,""),resultHTML=resultHTML.replace(/\r+/gi,""),resultHTML=resultHTML.replace(/<!--.*?-->/gi,""),resultHTML=resultHTML.replace(/<head>.*?<\/head>/gi,""),aElem=resultHTML.match(/<a .*? data-hugatt="hugatt".*?<\/a>/g),aElem||(aElem=resultHTML.match(/<a .*? data-hugatt="hugatt".*?<\/a>/g)),aElem){for(aElemLength=aElem.length,i=0;aElemLength>i;i++)divElem.innerHTML+=aElem[i],aElem[i]=aElem[i].replace(/[\(]/g,"\\("),aElem[i]=aElem[i].replace(/[\)]/g,"\\)"),regExArr.push(new RegExp(aElem[i]));for(aTagList=divElem.getElementsByTagName("a"),i=0;i<aElem.length;i++){var _list=aTagList[i].innerHTML+"\n"+aTagList[i].getAttribute("href");resultHTML=resultHTML.replace(regExArr[i],_list)}}return resultHTML=resultHTML.replace(/<div .*? data-hugatt="hugatt".*?><\/div>/g,""),resultHTML=resultHTML.replace(/<br.*?>/gi,"\n"),resultHTML=resultHTML.replace(/<hr.*?>/gi,"\n"),resultHTML=resultHTML.replace(/<\/p>/gi,"\n"),resultHTML=resultHTML.replace(/<\/h[1-6]>/gi,"\n"),resultHTML=resultHTML.replace(/<\/tr>/gi,"\n"),resultHTML=resultHTML.replace(/<\/li>/gi,"\n"),resultHTML=resultHTML.replace(/<\/td>/gi," "),resultHTML=resultHTML.replace(/<\/th>/gi," "),resultHTML=resultHTML.replace(/<.*?>/gi,""),resultHTML=resultHTML.replace(/&nbsp;/gi," "),resultHTML=resultHTML.replace(/&lt;/gi,"<"),resultHTML=resultHTML.replace(/&gt;/gi,">"),resultHTML=resultHTML.replace(/&quot;/gi,'"'),resultHTML=resultHTML.replace(/&amp;/gi,"&")},isBlockQuote=html.search(/<blockquote/gi);if(-1!==isBlockQuote){var firstIndex=html.search(/<blockquote/gi),lastIndex=html.toLowerCase().lastIndexOf("</blockquote>"),blockquotehtml=html.substring(firstIndex,lastIndex+13);return html=html.replace(blockquotehtml,"##===###===##"),blockquotehtml=htmlToText(blockquotehtml),blockquotehtml=blockquotehtml.replace(/\n/gi,"\n > "),blockquotehtml=" > "+blockquotehtml,html=htmlToText(html),-1!==html.search(/##===###===##/gi)&&(html=html.replace("##===###===##",blockquotehtml)),html}return htmlToText(html)}return""},ZE.prototype.setMode=function(mode){"use strict";var editor=this,_mode=editor.mode;"plaintext"===mode?_mode!==mode&&editor.confirmPlainText(""):"richtext"!==_mode&&editor.richText("")},ZE.getCSRFCookie=function(editor){"use strict";var name="ZE_CSRF_TOKEN",init=document.cookie.indexOf(name);if(init>-1){var userlen=name.length,beginIndex=editor.doc.cookie.indexOf(name)+userlen,endIndex=editor.doc.cookie.indexOf(";",beginIndex);endIndex>-1&&(endIndex=editor.doc.cookie.length);var cVal=editor.doc.cookie.substring(beginIndex+1,endIndex);return cVal}return null},ZE.getContextValue=function(){"use strict";return ZE_Init.contextVal?"/"+ZE_Init.contextVal:""},ZE.sendInitRequest=function(resend){"use strict";var reqImgFrame=document.getElementById("ze_img_request"),contextVal=ZE.getContextValue();reqImgFrame||(reqImgFrame=document.createElement("iframe"),reqImgFrame.name="ze_img_request",reqImgFrame.id="ze_img_request",reqImgFrame.style.width="0px",reqImgFrame.style.height="0px",reqImgFrame.style.border="0px",reqImgFrame.src=contextVal+"/ze/blank?t="+(new Date).getTime(),document.body.appendChild(reqImgFrame)),"true"===resend&&(reqImgFrame.src=contextVal+"/ze/blank?t="+(new Date).getTime())},ZE.getCSRFParamName=function(){"use strict";return ZE_Init.csrfParamVal||"zereqid"},ZE.getCSRFCookie=function(editor){"use strict";if(ZE_Init.csrfCookieVal&&ZE_Init.csrfParamVal)return ZE_Init.csrfCookieVal;var name=ZE_Init.csrfCookieName||"ZE_CSRF_TOKEN",init=document.cookie.indexOf(name);if(init>-1){var userlen=name.length,beginIndex=editor.doc.cookie.indexOf(name)+userlen,endIndex=editor.doc.cookie.indexOf(";",beginIndex);endIndex>-1&&(endIndex=editor.doc.cookie.length);var cVal=editor.doc.cookie.substring(beginIndex+1,endIndex);return cVal}return null},ZE.addClass=function(element,newClass){"use strict";-1==element.className.indexOf(newClass)&&(element.className?element.className+=" "+newClass:element.className=newClass)},ZE.removeClass=function(element,remClass){"use strict";element.className=element.className.replace(remClass,""),element.className=ZE.trim(element.className)},ZE._addEvent=function(el,evname,func){"use strict";el&&(document.addEventListener?el.addEventListener(evname,func,!0):el.attachEvent("on"+evname,func))},ZE._removeEvent=function(el,evname,func){"use strict";el&&(document.removeEventListener?el.removeEventListener(evname,func,!0):el.detachEvent("on"+evname,func))},ZE.hasClass=function(element,className){"use strict";return element.className.indexOf(className)>-1?!0:!1},ZE.showOverlay=function(){"use strict";var overlayDiv;document.getElementById("ze_orly")||(overlayDiv=document.createElement("div"),overlayDiv.id="ze_overlay",overlayDiv.className="ze_orly",document.body.appendChild(overlayDiv))},ZE.hideOverlay=function(){"use strict";var overlayDiv=document.getElementById("ze_overlay");overlayDiv.parentNode.removeChild(overlayDiv)},ZE.trim=function(val){"use strict";return val=val.replace(/^\s*(.*)/,"$1"),val=val.replace(/(.*?)\s*$/,"$1")},ZE.getUserListResponse=function(result,json){ZE.mentionedjson=json;var i,liArea,imgdivArea,divArea,h4Area,imgArea,editor=(ZPFeeds.Editor.getUserlistResponse(result,json.initObj),ZE.mentionedjson.editor),_document=document,ulArea=(_document.body,_document.createElement("ul"));for($("#ze_autofill").length&&$("#ze_autofill").remove(),ulArea.id="ze_autofill",ulArea.className="zp-at-dropdown",result=ZPFeeds.MENTION_DATA,i=0;i<result.length;i++){if(liArea=_document.createElement("li"),imgdivArea=_document.createElement("div"),imgdivArea.className="zp-ddicon",void 0!==result[i].photo){if(imgArea=_document.createElement("img"),imgArea.className="zp-usimg",imgArea.src=result[i].photo,void 0!==result[i].id){var att=document.createAttribute("userid");att.value=result[i].id,imgArea.setAttributeNode(att)}}else imgArea=_document.createElement("div"),"dept"===result[i].searchType?(imgArea.className="zp-dpname",imgArea.innerHTML=ZPeople.getShortName(result[i].name)):imgArea.className="zp-dpname IC-usr-grp S24";imgdivArea.appendChild(imgArea),liArea.appendChild(imgdivArea),divArea=_document.createElement("div"),divArea.className="zp-ddcont",h4Area=_document.createElement("h4"),h4Area.className="zp-dduname",h4Area.appendChild(_document.createTextNode(ZPeople.decodeTxt(result[i].name))),divArea.appendChild(h4Area),liArea.appendChild(divArea),$(liArea).data("mention",result[i]),ulArea.appendChild(liArea)}result.length>0&&editor.outerdiv.after(ulArea),ZE.mentionsetPositions(ulArea,json.anchorNode,json.pos,json),ZE._addEvent(ulArea,"click",function(ev){var mentionData,curElem=json.anchorNode,tempPos=json.pos,$targetElem=ev.target||ev.srcTarget;$targetElem=$($targetElem).closest("li"),$targetElem.length&&(mentionData=$($targetElem).data("mention"),ZE.mentionsetContent(mentionData,curElem,tempPos,json),ZE.mentionhideContextMenu(json))}),ZE._addEvent(_document,"mousedown",ZE.mentionmouseDown),ZE._addEvent(editor.doc,"mousedown",ZE.mentionmouseDown)},ZE.mentionhideContextMenu=function(){var editor=ZE.mentionedjson.editor,_document=document,zeAutofillDiv=(_document.body,_document.getElementById("ze_autofill")),_doc=editor.doc;zeAutofillDiv&&($("#ze_autofill").remove(),ZE._removeEvent(_document,"mousedown",ZE.mentionmouseDown),ZE._removeEvent(_doc,"mousedown",ZE.mentionmouseDown))},ZE.mentionmouseDown=function(ev){var _target,_document=document,zeAutofillDiv=(_document.body,_document.getElementById("ze_autofill"));if(ev)for(_target=ev.target;null!==_target&&_target!==zeAutofillDiv;_target=_target.parentNode);_target||ZE.mentionhideContextMenu()},ZE.mentionsetContent=function(data,curElem,pos,json){if(pos>-1&&$(curElem).length){var tempPos=pos,editor=ZE.mentionedjson.editor,_document=document,_selection=(_document.body,editor.win.getSelection()),_range=_selection.getRangeAt(0);_range.setStart(curElem,tempPos),_selection.removeAllRanges(),_selection.addRange(_range),editor.insertHTML(void 0!==data.photo?'<a class="ze_mention" href="zp[peopleuser:'+data.zuid+']zp" name="mentions">'+data.name+"</a>&nbsp;":"dept"===data.searchType&&"grp"!==data.searchType?'<a class="ze_mention" href="zp[department:'+data.id+']zp" name="mentions">'+data.name+"</a>&nbsp;":'<a class="ze_mention" href="zp[group:'+data.id+']zp" name="mentions">'+data.name+"</a>&nbsp;"),editor.initobj.triggerOnMention&&editor.initobj.triggerOnMention(data)}ZE.mentionhideContextMenu(json)},ZE.mentionsetPositions=function(elem,anchorNode,pos){var value2,posy,editor=ZE.mentionedjson.editor,style=(editor.iframe.getBoundingClientRect(),elem.style),editorPos=ZE.getPos(editor.editordiv);if(editor.doc.createRange&&3===anchorNode.nodeType){var range=editor.doc.createRange();range.setStart(anchorNode,pos),range.setEnd(anchorNode,pos+1),range.getBoundingClientRect&&(value2=range.getBoundingClientRect())}value2||(value2=anchorNode.parentNode.getBoundingClientRect()),posy=value2.top+value2.height+15;var overallheight=window.innerHeight-(posy+editorPos.offsetTop+elem.offsetHeight);overallheight=overallheight>0?overallheight+50:overallheight;var top=parseInt(posy);overallheight<elem.offsetHeight&&(top=posy-(elem.offsetHeight+posy)),style.top=top+"px",style.left="0px"},ZE.prototype.getFormattingValues=function(_className){"use strict";var selection,editor=this;editor.win.getSelection?selection=editor.win.getSelection():editor.doc.selection&&"Control"!==editor.doc.selection.type&&(selection=editor.doc.selection);for(var value,_anchorElement=selection.anchorNode;null!=_anchorElement;){if(_anchorElement.className&&_anchorElement.className===_className){switch(_className){case"size":value=_anchorElement.style.fontSize;break;case"highlight":value=_anchorElement.style.backgroundColor}break}_anchorElement=_anchorElement.parentNode}return value},ZE.prototype.extend=function(target,ref){"use strict";var name,value;for(name in ref)value=ref[name],void 0!==value&&(target[name]=value);return target},ZE.prototype.saveCursorPosition=function(containerEl){"use strict";var start,editor=this,win=editor.win,_doc=editor.doc;if(win.getSelection&&_doc.createRange){var selection=editor.win.getSelection();if(null!=selection&&selection.rangeCount>0){var range=editor.win.getSelection().getRangeAt(0),preSelectionRange=range.cloneRange();return preSelectionRange.selectNodeContents(containerEl),preSelectionRange.setEnd(range.startContainer,range.startOffset),start=preSelectionRange.toString().length,{start:start,end:start+range.toString().length}}return{start:0,end:0}}if(_doc.selection){var selectedTextRange=_doc.selection.createRange(),preSelectionTextRange=_doc.body.createTextRange();return preSelectionTextRange.moveToElementText(containerEl),preSelectionTextRange.setEndPoint("EndToStart",selectedTextRange),start=preSelectionTextRange.text.length,{start:start,end:start+selectedTextRange.text.length}}},ZE.prototype.restoreCursorPosition=function(containerEl,savedSel){"use strict";var editor=this,win=editor.win,_doc=editor.doc,focusAtStart=!1;if(win.getSelection&&_doc.createRange){var charIndex=0,range=editor.doc.createRange();range.setStart(containerEl,0),range.collapse(!0),0==savedSel.start&&0==savedSel.end&&(focusAtStart=!0);var node,nodeStack=[containerEl],foundStart=!1,stop=!1;if(!focusAtStart)for(;!stop&&(node=nodeStack.pop());)if(3===node.nodeType){var nextCharIndex=charIndex+node.length;!foundStart&&savedSel.start>=charIndex&&savedSel.start<=nextCharIndex&&(range.setStart(node,savedSel.start-charIndex),foundStart=!0),foundStart&&savedSel.end>=charIndex&&savedSel.end<=nextCharIndex&&(range.setEnd(node,savedSel.end-charIndex),stop=!0),charIndex=nextCharIndex}else for(var i=node.childNodes.length;i--;)nodeStack.push(node.childNodes[i]);var sel=editor.win.getSelection();sel.removeAllRanges(),sel.addRange(range)}else if(_doc.selection){var textRange=_doc.body.createTextRange();textRange.moveToElementText(containerEl),textRange.collapse(!0),textRange.moveEnd("character",savedSel.end),textRange.moveStart("character",savedSel.start),textRange.select()}},ZE.prototype.saveCurrentState=function(data){"use strict";var cursorPosition,editor=this,doc=editor.doc;data=data||{},cursorPosition=data.cursorPosition,editor.stack&&(editor.stack.execute(cursorPosition?new editor.EditorState(doc.body,editor.getContent(),cursorPosition):new editor.EditorState(doc.body,editor.getContent(),editor.saveCursorPosition(doc.body))),editor.initobj.contentChanged&&"function"==typeof editor.initobj.contentChanged&&!data.suppressContentChange&&editor.initobj.contentChanged())},ZE.prototype.getPosFromCursor=function(nodename,skipcount){"use strict";var editor=this,path=editor.squireInstance.getPath(),pathArr=[],tempcount=skipcount?skipcount:0;path.length>0&&(pathArr=path.split(">"));var i,temp=-1;for(i=pathArr.length-1;i>=0;i--)if(pathArr[i]===nodename){if(0===tempcount){temp=i;break}tempcount-=1}return temp},ZE.prototype.fontsizeConversion=function(conversion,val){"use strict";var ptToPx={8:"10",10:"13",12:"16",14:"18",18:"24",24:"32",36:"48"},pxToPt={10:"8",13:"10",16:"12",18:"14",24:"18",32:"24",48:"36"},fontvalToPt={1:"8",2:"10",3:"12",4:"14",5:"18",6:"24",7:"36"},fontvalToPx={1:"10",2:"13",3:"16",4:"18",5:"24",6:"32",7:"48"};return"pttopx"===conversion?ptToPx[val]||"13":"pxtopt"===conversion?pxToPt[val]||"10":"fontvaltopt"===conversion?fontvalToPt[val]:"fontvaltopx"===conversion?fontvalToPx[val]:void 0},ZE.tabHandler=function(event,_window,_document){"use strict";ZE_Init.tabKeyHandling&&(event.preventDefault(),_document.queryCommandState("insertOrderedList")||_document.queryCommandState("insertUnOrderedList")||(_window.getSelection().collapseToStart(),_document.execCommand("insertHTML",!1,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;")))},ZE.fsDisp={1:"8",2:"10",3:"12",4:"14",5:"18",6:"24",7:"36"},ZE.ffDisp={arial:"Arial","comic sans ms":"Comic Sans MS",verdana:"Verdana",georgia:"Georgia",tahoma:"Tahoma",calibri:"Calibri","courier new":"Courier New",serif:"Serif","arial narrow":"Narrow","arial black":"Wide","times new roman":"Times New Roman",garamond:"Garamond",batang:"Serif","trebuchet ms":"Trebuchet"},ZE.getHookMethod=function(originator,fn){"use strict";return"function"==typeof fn?function(currentNode,data,config){config.originator&&config.originator===originator&&fn(currentNode,data)}:void 0},ZE.addHook=function(hookName,fn){"use strict";"function"==typeof fn&&DOMPurify.addHook(hookName,fn)},ZE.removeHook=function(hookName,fn){"use strict";"function"==typeof fn&&DOMPurify.removeHook(hookName,fn)},ZE.createDraftToolbar=function(toolbarlist){"use strict";var toolbararray,toolbardiv,toolbarArrayLength,_ul,_li,_div,toolbarinnerarray,j,toolbarInnerArrayLength,commandArray,commandName,_class,_b,toolbarobject={},_document=document,I18N=(_document.body,ZE.i18n),i=0,toolbararray=toolbarlist;for(toolbardiv=_document.createElement("div"),toolbardiv.className="ze_SCmb",toolbarArrayLength=toolbararray.length,i=0;toolbarArrayLength>i;i++){for(_ul=_document.createElement("ul"),toolbarinnerarray=toolbararray[i],j=0,toolbarInnerArrayLength=toolbarinnerarray.length;toolbarInnerArrayLength>j;j++){if(commandArray=toolbarinnerarray[j],commandName=commandArray[0],_class=commandArray[2],_li=_document.createElement("li"),_ul.appendChild(_li),"otheroptions"===commandName&&(_ul.className="ze_frt",_ul.style.display=""),_b=_document.createElement("b"),"attach"===commandName&&(_b.className="ze_Sel ze_bg"),"fontsize"===commandName){var s=_document.createElement("span");_b.style.minWidth="36px",_b.appendChild(s),s.className="ze_pdl"}var span2,_span=_document.createElement("span");_span.className=_class,"fontsize"===commandName&&(_span.style.cssFloat="right"),_b.appendChild(_span),("attach"===commandName||"alignoptions"===commandName||"listoptions"===commandName||"spellcheck"===commandName)&&(span2=document.createElement("span"),span2.className="zei-arrow",_b.appendChild(span2)),_li.appendChild(_b),_b.title=I18N(commandArray[1]),toolbarobject[commandName]=_b,0!==j&&(_div=document.createElement("div"),_b.appendChild(_div))}toolbardiv.appendChild(_ul)}return toolbardiv};(function(){var ze_Undo;ze_Undo=this.ze_Undo={},ze_Undo.Stack=function(){this.commands=[],this.stackPosition=-1,this.lastSavedState="",this.execute=function(command){this.lastSavedState!=command.newValue&&(this.lastSavedState=command.newValue,this.clearRedo(),this.stackPosition+1>100&&(this.commands.splice(0,1),this.stackPosition-=1),this.commands.push(command),this.stackPosition++)},this.clearStack=function(){this.stackPosition=-1,this.commands.splice(0,this.commands.length),this.lastSavedState=""},this.undo=function(){this.stackPosition>0&&(this.stackPosition--,this.commands[this.stackPosition].undo(),this.commands[this.stackPosition].setFocus(),this.lastSavedState=this.commands[this.stackPosition].newValue)},this.canUndo=function(){return this.stackPosition>0},this.redo=function(){this.stackPosition++,this.commands[this.stackPosition].redo(),this.lastSavedState=this.commands[this.stackPosition].newValue,this.commands[this.stackPosition].setFocus()},this.canRedo=function(){return this.stackPosition<this.commands.length-1},this.clearRedo=function(){this.commands=this.commands.slice(0,this.stackPosition+1)}}}).call(this);ZE.prototype.updateToolbar=function(){"use strict";var j,color,value,editor=this,toolbarobject=editor.toolbarobject,doc=editor.doc;for(j in toolbarobject)switch(j){case"bold":case"italic":case"underline":case"strikethrough":case"superscript":case"subscript":case"insertorderedlist":case"insertunorderedlist":doc.queryCommandState(j)?toolbarobject[j].className.search("ze_esel")<0&&ZE.addClass(toolbarobject[j],"ze_esel"):ZE.removeClass(toolbarobject[j],"ze_esel");break;case"alignoptions":doc.queryCommandState("justifyright")?toolbarobject[j].firstChild.setAttribute("class","zei-textright"):doc.queryCommandState("justifycenter")?toolbarobject[j].firstChild.setAttribute("class","zei-textcenter"):doc.queryCommandState("justifyfull")?toolbarobject[j].firstChild.setAttribute("class","zei-textjustify"):toolbarobject[j].firstChild.setAttribute("class","zei-textleft");break;case"listoptions":break;case"forecolor":var fontcolor=doc.queryCommandValue("forecolor")||"black";value=fontcolor,toolbarobject[j].firstChild.style.color="number"==typeof value?"rgb("+(255&value)+","+(value>>8&255)+","+(value>>16&255)+")":fontcolor;break;case"backcolor":try{color=doc.queryCommandValue("backcolor")||doc.queryCommandValue("hilitecolor"),/transparent/i.test(color)?color=editor.getFormattingValues("highlight")||"white":"rgba(0, 0, 0, 0)"===color&&(color="white"),value=color,"number"==typeof value?(parseInt(value+""),toolbarobject[j].firstChild.style.borderBottom="3px rgb("+(255&value)+","+(value>>8&255)+","+(value>>16&255)+") solid"):toolbarobject[j].firstChild.style.borderBottom="2px "+color+" solid"}catch(e){}break;case"fontfamily":try{}catch(e){}break;case"fontsize":try{var fsize=doc.queryCommandValue("fontsize");if(fsize)fsize=parseInt(fsize),toolbarobject[j].firstChild.innerHTML=ZE.fsDisp[fsize];else{var fontsize=editor.getFormattingValues("size");if(fontsize){var size=editor.fontsizeConversion("pxtopt",parseInt(fontsize));void 0===size&&(size=parseInt(fontsize)),toolbarobject[j].firstChild.innerHTML=size}else toolbarobject[j].firstChild.innerHTML=0===fsize?ZE.fsDisp[2]:parseInt(ZE_Init.defaultFontSize)}}catch(e){}}},ZE.prototype.createEditor=function(){"use strict";var _iframe,placehlderdiv,constructIframe,handleDragOver,handleDragLeave,editor=this,_document=document,_initobj=editor.initobj,parentDiv=_document.getElementById(_initobj.id),_editorheight=_initobj.editorheight;ZE.is_chrome=navigator.userAgent.toLowerCase().indexOf("chrome")>-1,_iframe=_document.createElement("iframe"),editor.iframe=_iframe,_iframe.className="ze_area DNI",placehlderdiv=_document.createElement("div"),_editorheight?editor.editordiv.style.height="100%":(_iframe.style.height=parentDiv.getBoundingClientRect().height-editor.toolbardiv.getBoundingClientRect().height+"px",editor.editordiv.style.height="100%"),placehlderdiv.className="Zp-fd-plchldr",placehlderdiv.contentEditable=!0,void 0!==_initobj.placeholder&&placehlderdiv.setAttribute("data-text",_initobj.placeholder),editor.editordiv.appendChild(placehlderdiv),constructIframe=function(){var afterLoadArray,afterLoadArrayLength,setClassOnBody,fontFamily,fontSize,loadEditorCss,win=_iframe.contentWindow,doc=win.document||_iframe.contentDocument,docBody=doc.body,_initobjContent=_initobj.content;editor.win=win,editor.doc=doc,_iframe.onload=null,doc.write&&(doc.open(),doc.write("<!DOCTYPE html><html><body><div><br/></div></body></html>"),doc.close()),loadEditorCss=function(cssFile){var _head=doc.getElementsByTagName("head")[0],css=doc.createElement("link");css.type="text/css",css.rel="stylesheet",css.href=ZE_Init.getCDNURL(cssFile,"css"),_head||(docBody.parentNode.insertBefore(doc.createElement("head"),docBody),_head=doc.getElementsByTagName("head")[0]),_head&&_head.appendChild(css)},editor.doc.body.contentEditable=!0,editor.doc.body.setAttribute("data-gramm","false"),ZE._addEvent(doc,"mousedown",function(ev){for(var _anchorElement=ev.target,imgBlock=editor.doc.getElementById("ze_imgBlock");null!==_anchorElement;){if("IMG"===_anchorElement.nodeName&&_anchorElement.hasAttribute("orig_width"))return editor._stopEvent(ev),!1;if(_anchorElement===imgBlock)return ev.preventDefault(),!1;_anchorElement=_anchorElement.parentNode}}),ZE._addEvent(doc,"mouseup",function(ev){editor.updateToolbar();for(var _anchorElement=ev.target;null!==_anchorElement;){if("A"===_anchorElement.nodeName&&!_anchorElement.hasAttribute("data-hugatt"))return editor._stopEvent(ev),editor.showAnchorTag(_anchorElement,ev),!1;if("IMG"===_anchorElement.nodeName&&_anchorElement.hasAttribute("orig_width")){if("A"===_anchorElement.parentNode.nodeName)editor._stopEvent(ev),editor.showAnchorTag(_anchorElement.parentNode,ev);else{var zeLinkBlock=doc.getElementById("ze_imgBlock");zeLinkBlock||(editor._stopEvent(ev),editor.resizeElement(_anchorElement,ev))}return!1}_anchorElement=_anchorElement.parentNode}}),handleDragOver=function(evt){var effectAllowed,dt=evt.dataTransfer,I18N=ZE.i18n;if(editor.win.focus(),(null!==dt.types||dt.files&&dt.files.length>0)&&!evt.fromPaste&&(dt.files&&dt.files.length>0||(dt.types.indexOf?-1!==dt.types.indexOf("Files"):dt.types.contains("application/x-moz-file"))||"Files"===dt.types[0])){clearTimeout(editor.dragTimer);try{effectAllowed=dt.effectAllowed,dt.dropEffect="move"===effectAllowed||"linkMove"===effectAllowed?"move":"copy"}catch(ex){dt.dropEffect="move"}var _selection;_selection=editor.saveSelection();var _iframeValues,scrollYval,$mask,$innerMask,maskStyle;if($mask=doc.getElementById("mask_editor"),!$mask){$mask=doc.createElement("div"),$mask.contentEditable="false",$mask.id="mask_editor",doc.body.appendChild($mask),maskStyle=$mask.style,_iframeValues=editor.iframe.getBoundingClientRect(),scrollYval=editor.win.scrollY?editor.win.scrollY:editor.win.pageYOffset,maskStyle.height=_iframeValues.height+"px",maskStyle.width=_iframeValues.width+"px",maskStyle.left="0px",scrollYval=editor.win.scrollY?editor.win.scrollY:editor.win.pageYOffset,maskStyle.top=0+scrollYval+"px",maskStyle.position="absolute",$innerMask=doc.createElement("div"),$innerMask.className="ze_drag",$innerMask.contentEditable="false";var $span=doc.createElement("span");$innerMask.appendChild($span),$span.innerHTML=I18N("Drop Files to Attach"),$mask.appendChild($innerMask),$innerMask.style.height=.7*editor.iframe.offsetHeight+"px",$innerMask.style.marginTop="-"+.7*editor.iframe.offsetHeight/2+"px",_selection&&editor.restoreSelection(_selection),editor.win.focus()}}editor._stopEvent(evt)},handleDragLeave=function(evt){editor.dragTimer=setTimeout(function(){var mask=doc.getElementById("mask_editor");mask&&mask.parentElement.removeChild(mask)},250),editor._stopEvent(evt)};var removeElementFromMain=function(editor1,file){var i;for(i=0;i<editor1.inlineImagesToBe.length;i++)if(editor1.inlineImagesToBe[i]===file){editor1.inlineImagesToBe.splice(i,1);break}},removeElementFromWait=function(editor1,file){var i;for(i=0;i<editor1.waitForResponse.length;i++)if(editor1.waitForResponse[i]===file){editor1.waitForResponse.splice(i,1);break}},inlineImageUpload=function(file,editorRef){var _formAction,contextParam,imgAction,activeeditor=editorRef,xhr=new XMLHttpRequest,form=new FormData,csrf=ZE.getCSRFCookie(editorRef);form.append(ZE.getCSRFParamName(),csrf),file&&form.append("img_file",file,"test.png"),imgAction=ZE_Init.imgAction,ZE_Init.imgParameters&&(imgAction+=ZE_Init.imgParameters),ZE_Init.context&&(_formAction=ZE_Init.imgParameters?imgAction+"&context="+ZE_Init.context:imgAction+"?context="+ZE_Init.context,contextParam="&context="+ZE_Init.context),ZE.captchaParam&&(_formAction=ZE_Init.imgParameters||ZE_Init.context?imgAction+"&"+ZE.captchaParam+contextParam:imgAction+"?"+ZE.captchaParam+contextParam,delete ZE.captchaParam),_formAction+="&uploadMode=drop";var newsel,newrange,img=activeeditor.doc.createElement("img");try{activeeditor.win.focus(),img.src=ZE_Init.getCDNURL("process.gif","image"),newsel=activeeditor._getSelection(),newrange=activeeditor._createRange(newsel),newrange.insertNode(img),newrange.selectNode(img),newrange.collapse(!1),newsel.removeAllRanges(),newsel.addRange(newrange),removeElementFromMain(activeeditor,file),activeeditor.waitForResponse.push(file)}catch(e){return null}return xhr.onreadystatechange=function(){var insertImageInline,_file=file,_img=img;if(4==xhr.readyState)if(removeElementFromWait(activeeditor,_file),200==xhr.status){var resp=$.parseJSON(xhr.responseText);resp.fileName?(0==activeeditor.inlineImagesToBe.length&&delete ZE_Init.captchaProcessing,insertImageInline=function(_img){return function(_imgUrl){_img.onload=function(){_img.setAttribute("orig_width",this.width),_img.setAttribute("orig_height",this.height),_img.setAttribute("size_option","original"),ZE.setImageSizeOptions(this,"bestfit",editorInstance.editordiv.offsetWidth),_img.removeAttribute("data-zeload")},_img.setAttribute("data-zeload",!0),_img.src=_imgUrl,editorRef.saveCurrentState()}},ZE_Init.inlineImage(insertImageInline(_img),resp)):(activeeditor.inlineImagesToBe.push(_file),_img.parentNode.removeChild(_img),"HIP_REQUIRED"==resp.errorMsg&&(ZE_Init.latesthip=resp.hipUrl,ZE.captchaProcessing=function(){uploadInlineImages(activeeditor)},ZE_Init.captchaInline=!0))}else 500==xhr.status&&_img.parentNode.removeChild(_img)},xhr.open("POST",_formAction,!0),xhr.send(form),xhr},uploadInlineImages=function(editorRef){var i,filesArray,filesArrayLength,xhrObj;for(editorRef.win.focus(),ZE_Init.captchaInline=!1,editorRef.waitForResponse||(editorRef.waitForResponse=[]),filesArray=editorRef.inlineImagesToBe.slice(0),filesArrayLength=filesArray.length,i=0;filesArrayLength>i;i++)if(xhrObj=inlineImageUpload(filesArray[i],editorRef),!xhrObj){editorRef.inlineImagesToBe.splice(0);break}setTimeout(function(){ZE_Init.captchaInline&&ZE.show_CaptchaImage(ZE_Init.latesthip,editorRef)},1e3)},handleEditorPasteImages=function(evt){for(var items=evt.dataTransfer.items,itemsLength=items.length,i=0;itemsLength>i;i++)if("file"===items[i].kind&&"image/png"===items[i].type){var imageFile=items[i].getAsFile();imageFile.name||(imageFile.name="Inline_image"+(new Date).getTime()+Math.floor(1e3*Math.random()+1)),editor._uploadInlineImages({file:imageFile})}},handleEditorDrop=function(evt){editor._stopEvent(evt);var mask=doc.getElementById("mask_editor");if(mask&&mask.parentElement.removeChild(mask),editor.win.focus(),evt.editorCustomPaste)return void(editor.initobj.handlePasteImages&&handleEditorPasteImages(evt));var files=evt.dataTransfer.files;if(files&&0!==files.length){var i,I18N=ZE.i18n,uploadType="inline",errorFiles="";for(i=0;i<files.length;i++)if(!files[i].type||files[i].type.indexOf("image")<0){uploadType="attachments";break}if("inline"===uploadType&&ZE_Init.dropInlineImage){for(editor.inlineImagesToBe||(editor.inlineImagesToBe=[]),i=0;i<files.length;i++)files[i].size>0&&files[i].size/1048576<3?editor.inlineImagesToBe.push(files[i]):errorFiles+=files[i].name+",";""!==errorFiles&&alert(I18N("Files "+errorFiles+" cant be uploaded as they violate size restriction")),uploadInlineImages(editor)}else ZE_Init.fileUpload(editor,files,evt)}};ZE_Init.avoidDropHandle||editor.initobj.avoidDropHandle||(ZE._addEvent(doc,"drop",handleEditorDrop),ZE._addEvent(doc,"dragover",handleDragOver),ZE._addEvent(doc,"dragleave",handleDragLeave)),editor._unusedImagesList={},editor._pendingImagesList={};var stack,initializeUndo=function(){editor.stack=new ze_Undo.Stack,stack=editor.stack,editor.EditorState={},editor.EditorState=function(textarea,newValue,_currentselection){this.textarea=textarea,this.newValue=newValue,this._currentselection=_currentselection,this.undo=function(){editor.setContent(this.newValue,!0)},this.redo=function(){editor.setContent(this.newValue,!0)},this.setFocus=function(){var _object=this._currentselection;editor.restoreCursorPosition(editor.doc.body,_object),editor.win.focus()}};var timer,startValue=editor.getContent();editor.initobj.handleAutoFill&&editor.mentionsHandler(),ZE._addEvent(doc,"keyup",function(ev){var kcode=ev.keyCode;return(33===kcode||34===kcode)&&ev.stopPropagation(),editor.undo||editor.redo?void(startValue=editor.getContent()):(clearTimeout(timer),void(timer=setTimeout(function(){var newValue=editor.getContent();newValue!==startValue&&(editor.saveCurrentState(),startValue=newValue)},250)))})};initializeUndo(),ZE._addEvent(doc,"keydown",function(ev){var key,kcode=ev.keyCode,shift=ev.shiftKey,meta=ev.metaKey,alt=ev.altKey,ctrl=ev.ctrlKey,editorStack=editor.stack;if(editor.undo=editor.redo=!1,(ctrl||meta)&&!alt&&!shift)switch(key=String.fromCharCode(kcode).toLowerCase()){case"b":editor.execCommand(ev,"bold");break;case"u":editor.execCommand(ev,"underline");break;case"i":editor.execCommand(ev,"italic");break;case"l"&&editor.initobj.isMiniEditor:editor.execCommand(ev,"j-left");break;case"e"&&editor.initobj.isMiniEditor:editor.execCommand(ev,"j-center");break;case"r"&&editor.initobj.isMiniEditor:editor.execCommand(ev,"j-right");break;case"j"&&editor.initobj.isMiniEditor:editor.execCommand(ev,"j-full");break;case"k"&&editor.initobj.isMiniEditor:editor.execCommand(ev,"link");break;case"z":editor._stopEvent(ev),editorStack.canUndo()&&editorStack.undo(),editor.undo=!0;break;case"y":editor._stopEvent(ev),editorStack.canRedo()&&editorStack.redo(),editor.redo=!0}editor.updateToolbar()}),setClassOnBody=function(_fontFamily,_fontSize){var _style,FontSize,PtToPx={8:10,10:13,12:16,14:18,18:24,24:32,36:48};FontSize=-1!==_fontSize.indexOf("px")?_fontSize:PtToPx[parseInt(_fontSize)]+"px",_style=editor.doc.createElement("style"),_style.type="text/css",_style.innerHTML=".ze_body{font-family:"+_fontFamily+";font-size:"+FontSize+";margin:15px;line-height:20px;}";var _head=editor.doc.getElementsByTagName("head")[0];_head&&(_head.appendChild(_style),editor.doc.body.className="ze_body")},fontFamily=_initobj.defaultfontfamily||ZE_Init.defaultFontFamily||"",fontSize=_initobj.defaultfontsize||ZE_Init.defaultFontSize||"",setClassOnBody(fontFamily,fontSize),delete editor.state,ZE_Init.needResizeImage&&loadEditorCss("IFeditor.min.css"),loadEditorCss("IFeditor.css");var forceRepaint=function(containerEl){var temp=containerEl.createElement("span");containerEl.body.appendChild(temp),setTimeout(function(){temp.parentNode.removeChild(temp)},100)};if(ZE_Init.is_safari&&window.onblur&&(ZE._addEvent(editor.doc.body,"focus",function(){forceRepaint(document)}),ZE._addEvent(editor.doc.body,"blur",function(){var _selection=editor.win.getSelection();if(_selection.isCollapsed){editor.pasteHTML&&editor.pasteHTML("<span id='temp_123paint'></span>");var temp1=editor.doc.getElementById("temp_123paint");temp1&&temp1.parentNode.removeChild(temp1)}})),$(editor.editordiv).find(".Zp-fd-plchldr").on("focus",function(){ZPFeeds.Editor.addRemovePlaceholder(editor,!1)}),$(editor.iframe.contentDocument.body).on("blur",function(event){0==$(event.target).parents(".ze_dropdown").length&&ZPFeeds.Editor.addRemovePlaceholder(editor,!0)}),$(editor.iframe.contentDocument.body).on("keyup",function(){ZPFeeds.Editor.addRemovePlaceholder(editor,!1)}),ZE._addEvent(editor.win,"scroll",function(){var zeLinkBlock=document.getElementById("ze_linkBlock");zeLinkBlock&&document.body.removeChild(zeLinkBlock)}),ZE._addEvent(editor.doc.body,"contextmenu",function(ev){var _anchorElement=ev.target,shiftKey=ev.shiftKey;if(shiftKey)return!0;for(;null!==_anchorElement;){if("TABLE"===_anchorElement.nodeName&&"true"!==ZE.getAttribute(_anchorElement,"data-avoidContext"))return editor._stopEvent(ev),editor.showContextMenu(ev,"table",_anchorElement),!1;_anchorElement=_anchorElement.offsetParent}}),editor.squireInstance=new Squire(editor.doc,{getEditorInstance:function(){return editor}}),editor.squireInstance.addEventListener("dragover",function(ev){editor._stopEvent(ev)}),editor.squireInstance.addEventListener("drop",handleEditorDrop),"plaintext"!==_initobj.mode&&(_initobjContent?ZPFeeds.Editor.addRemovePlaceholder(editor,!1,!1,!0):_initobjContent="",editor.squireInstance.setHTML(_initobjContent),editor.initobj.contentdirection&&editor.squireInstance.setTextDirection("rtl")),editor.afterload)for(afterLoadArray=editor.afterload,afterLoadArrayLength=afterLoadArray.length;afterLoadArrayLength--;)afterLoadArray.shift()();if(delete editor.afterload,"richtext"===editor.mode&&((ZE_Init.needEditorFocus||editor.initobj.needEditorFocus)&&(win.focus(),editor.squireInstance.focus()),editor.updateToolbar()),editor.saveCurrentState({cursorPosition:{start:0,end:0},suppressContentChange:!0}),!ZE_Init.needEditorFocus&&!editor.initobj.needEditorFocus&&"richtext"===editor.mode){var selection=win.getSelection()||editor.doc.selection;selection.removeAllRanges()}},_iframe.onload=constructIframe,_iframe.srcdoc="<!DOCTYPE html>",editor.editordiv.appendChild(_iframe),ZPFeeds.Editor.addRemovePlaceholder(editor,!1)},ZE.prototype._stopEvent=function(ev){"use strict";try{ev.preventDefault(),ev.stopPropagation()}catch(e1){ev.cancelBubble=!0,ev.returnValue=!0}},ZE.getAttribute=function(element,attrName){"use strict";return element.hasAttribute(attrName)?element.getAttribute(attrName):void 0},ZE.prototype.updateStateHTML=function(stackPosition,html){"use strict";var editor=this;editor.stack.commands[stackPosition].newValue=html},ZE.setImageSizeOptions=function(img,option,editorWidth){"use strict";var reduceRatio,MAX_BESTFIT_WIDTH=400,returnObj={},imgWidth=img.width||img.naturalWidth,imgHeight=img.height|img.naturalHeight,bestFitWidth=parseInt(.75*editorWidth);bestFitWidth>MAX_BESTFIT_WIDTH&&(bestFitWidth=MAX_BESTFIT_WIDTH),"small"===option?(reduceRatio=2.5,imgWidth>bestFitWidth&&(reduceRatio=imgWidth/150),returnObj.width=imgWidth/reduceRatio,returnObj.height=imgHeight/reduceRatio,returnObj.sizeOption="small"):"bestfit"===option?(reduceRatio=1,imgWidth>bestFitWidth&&(reduceRatio=imgWidth/bestFitWidth),returnObj.width=imgWidth/reduceRatio,returnObj.height=imgHeight/reduceRatio,returnObj.sizeOption="bestfit"):(returnObj.width=imgWidth,returnObj.height=imgHeight,returnObj.sizeOption="original"),img.width=returnObj.width,img.height=returnObj.height,img.setAttribute("size_option",returnObj.sizeOption)},ZE.prototype.checkForPendingImages=function(){"use strict";var pendingTags,editor=this,list=Object.keys(editor._pendingImagesList),status=!1;return list.length&&(pendingTags=editor.doc.body.getElementsByClassName("ze_img_upload"),pendingTags.length&&(status=!0)),status},ZE.prototype.clearPendingImages=function(){"use strict";var i,node,editor=this,pendingTags=editor.doc.body.getElementsByClassName("ze_img_upload"),length=pendingTags.length;for(editor._pendingImagesList={},i=0;length>i;i++)node=pendingTags[i],"IMG"===node.nodeName&&node.parentNode.removeChild(node)},ZE.prototype._uploadInlineImages=function(dataObject){"use strict";var editor=this,img=editor.doc.createElement("img"),insertImageInline=function(){return function(_imgUrl,uniqId){uniqId="ze_"+uniqId+"_refresh";var _img=editor.doc.getElementById(uniqId);return delete editor._pendingImagesList[uniqId],_img?(_img.onload=function(){_img.setAttribute("orig_width",this.width),_img.setAttribute("orig_height",this.height),ZE.setImageSizeOptions(_img,"bestfit",editor.editordiv.offsetWidth),_img.removeAttribute("data-zeload")},_img.setAttribute("data-zeload",!0),_img.src=_imgUrl,_img.removeAttribute("id"),_img.removeAttribute("class"),void editor.saveCurrentState()):void(editor._unusedImagesList[uniqId]=_imgUrl)}},initiate=function(){return function(uniqId){img.src=ZE_Init.getCDNURL("process.gif","image"),img.id="ze_"+uniqId+"_refresh",editor._pendingImagesList[img.id]=!0,img.className="ze_img_upload";var newsel=editor._getSelection(),newrange=editor._createRange(newsel);newrange.insertNode(img),newrange.selectNode(img),newrange.collapse(!1),newsel.removeAllRanges(),newsel.addRange(newrange)}},onFailure=function(){return function(uniqId){uniqId="ze_"+uniqId+"_refresh";var _img=editor.doc.getElementById(uniqId);delete editor._pendingImagesList[uniqId],_img&&_img.parentNode.removeChild(_img)}};"function"==typeof editor.initobj.processPastedFile&&editor.initobj.processPastedFile(dataObject,editor,initiate(),insertImageInline(),onFailure())};ZE.prototype.createToolbar=function(){"use strict";var toolbararray,zeEditor,toolbardiv,btnonclick,toolbarArrayLength,_ul,_li,_div,toolbarinnerarray,j,toolbarInnerArrayLength,commandArray,commandName,_class,executeAction,editor=this,toolbarobject={},initObjToolbar=editor.initobj.toolbar,_document=document,fragment=(_document.body,_document.createDocumentFragment()),I18N=ZE.i18n,i=(ZE_Init.imgPath,0);toolbararray=editor.initobj.toolbarOrder?editor.initobj.toolbarOrder:initObjToolbar?ZE_Init.toolbarOrderGenerate(initObjToolbar):ZE_Init.toolbarOrder,btnonclick=function(command){return function(ev){editor._stopEvent(ev);var sel=editor._getSelection();try{{editor._createRange(sel)}}catch(e){editor.range?(editor.range.select(),delete editor.range):editor.win.focus()}return editor.execCommand(ev,command),!1}},zeEditor=_document.createElement("div"),zeEditor.className="ze",ZE_Init.needEditorBorder||(zeEditor.style.borderWidth="0px"),editor.editordiv=zeEditor,fragment.appendChild(zeEditor),editor.toolbarobject=toolbarobject,toolbardiv=_document.createElement("div"),toolbardiv.className=editor.initobj.toolbardirection?"ze_SCmb ze_SCmbfrt":"ze_SCmb",zeEditor.appendChild(toolbardiv),editor.toolbardiv=toolbardiv;var stopEv=function(ev){return editor._stopEvent(ev),!1};executeAction=function(){return function(ev){editor._stopEvent(ev);var _command,_className=ev.target.className,sel=editor._getSelection();try{{editor._createRange(sel)}}catch(e){editor.range?(editor.range.select(),delete editor.range):editor.win.focus()}switch(_className){case"zei-order":_command="insertorderedlist";break;case"zei-unorder":_command="insertunorderedlist";break;case"zei-textleft":_command="j-left";break;case"zei-textright":_command="j-right";break;case"zei-textfull":_command="j-full";break;case"zei-textcenter":_command="j-center"}return editor.execCommand(ev,_command),editor.saveCurrentState(),!1}};var _alternateToolbar,editorWidth,_b,altToolCheck=0,soFarWidth=0;editorWidth=editor.outerdiv.offsetWidth,void 0!==editor.initobj.currentContainer?editor.outerdiv.append(fragment):editor.outerdiv.appendChild(fragment);var createAlternateToolbar=function(){_alternateToolbar=_document.createElement("div"),_alternateToolbar.id="alter_toolbar",_alternateToolbar.className="ze_SCmb ze_alttool",editor.editordiv.appendChild(_alternateToolbar),_alternateToolbar.style.display="none",editor.alterTool=_alternateToolbar};for(toolbarArrayLength=toolbararray.length,i=0;toolbarArrayLength>i;i++){for(_ul=_document.createElement("ul"),soFarWidth>toolbardiv.offsetWidth-150&&0===altToolCheck&&i!==toolbarArrayLength-1&&!editor.initobj.avoidMoreOption?(createAlternateToolbar(),toolbarinnerarray=[["more","More","zei-more"]],i--,altToolCheck=1):toolbarinnerarray=toolbararray[i],j=0,toolbarInnerArrayLength=toolbarinnerarray.length;toolbarInnerArrayLength>j;j++)if(commandArray=toolbarinnerarray[j],commandName=commandArray[0],_class=commandArray[2],_li=_document.createElement("li"),_ul.appendChild(_li),_class instanceof Node&&-1!==commandName.indexOf("custom_opt"))_li.appendChild(_class),ZE._addEvent(_li,"click",commandArray[3]),ZE._addEvent(_li,"mousedown",stopEv),toolbarobject[commandName]=_class;else{if("otheroptions"===commandName&&(_ul.className="ze_frt",_ul.style.display=""),_b=_document.createElement("b"),"attach"===commandName&&(_b.className="ze_Sel ze_bg"),"fontsize"===commandName){var s=_document.createElement("span");_b.style.minWidth="36px",_b.appendChild(s),s.className="ze_pdl"}var span2,_span=_document.createElement("span");_span.className=_class,"fontsize"===commandName&&(_span.style.cssFloat="right"),_b.appendChild(_span),("attach"===commandName||"alignoptions"===commandName||"listoptions"===commandName||"spellcheck"===commandName||"lineHeight"===commandName)&&(span2=document.createElement("span"),span2.className="zei-arrow",_b.appendChild(span2)),_li.appendChild(_b),_b.title=I18N(commandArray[1]),"alignoptions"===commandName||"listoptions"===commandName?(ZE._addEvent(span2,"click",btnonclick(commandName)),ZE._addEvent(span2,"mousedown",stopEv),ZE._addEvent(_span,"click",executeAction()),ZE._addEvent(_span,"mousedown",stopEv)):"custom"===commandName?(ZE._addEvent(_b,"click",commandArray[3]),ZE._addEvent(_b,"mousedown",stopEv)):-1!==commandName.indexOf("custom_opt")?(ZE._addEvent(_b,"click",commandArray[3]),ZE._addEvent(_b,"mousedown",stopEv)):"lineHeight"===commandName?(ZE._addEvent(span2,"click",btnonclick(commandName)),ZE._addEvent(span2,"mousedown",stopEv),ZE._addEvent(_span,"click",btnonclick(commandName)),ZE._addEvent(_span,"mousedown",stopEv)):(ZE._addEvent(_b,"click",btnonclick(commandName)),ZE._addEvent(_b,"mousedown",stopEv)),toolbarobject[commandName]=_b,0!==j&&(_div=document.createElement("div"),_b.appendChild(_div))}var currentToolbar;if(currentToolbar="more"!==commandName&&"otheroptions"!==commandName&&1===altToolCheck?_alternateToolbar:toolbardiv,currentToolbar.appendChild(_ul),soFarWidth+=_ul.offsetWidth,i!==toolbarArrayLength-1&&"more"!==commandName){var fontElem=document.createElement("font");currentToolbar.appendChild(fontElem)}}toolbarobject.heading&&!function(){var _span1=toolbarobject.heading.appendChild(_document.createElement("span"));_span1.className="ze_heading_menu",_span1.appendChild(_document.createTextNode("Nr"))}(),"function"==typeof ZE_Init.afterToolbarGenerate&&ZE_Init.afterToolbarGenerate(toolbarobject),void 0!==editor.initobj.currentContainer?editor.outerdiv.append(fragment):editor.outerdiv.appendChild(fragment)},ZE.prototype.expandToolbar=function(ev){"use strict";{var _anchorelement,_alternateToolbar,_altToolbarStyle,removeEventListeners,editor=this,_document=document;_document.body}if(_anchorelement=ev.currentTarget,_alternateToolbar=editor.alterTool,_altToolbarStyle=_alternateToolbar.style,"none"!==_altToolbarStyle.display)return _altToolbarStyle.display="none",void(_anchorelement.parentNode.style.backgroundColor="");var setPositions=function(){var _alterToolbarStyle=editor.alterTool.style;_alterToolbarStyle.left=_anchorelement.offsetParent.offsetLeft+_anchorelement.offsetLeft+_anchorelement.offsetWidth-editor.alterTool.offsetWidth+"px"},mouseDown=function(event){var _target,alterToolbar=editor.alterTool;if(ev)for(_target=event.target;null!==_target&&(_target!==alterToolbar&&_target!==_anchorelement);_target=_target.parentNode);_target||removeEventListeners()};removeEventListeners=function(){var alterToolbar=editor.alterTool;alterToolbar&&(alterToolbar.style.display="none",_anchorelement.parentNode.style.backgroundColor="",ZE._removeEvent(document,"mousedown",mouseDown),ZE._removeEvent(editor.doc,"mousedown",mouseDown))},_altToolbarStyle.display="",_anchorelement.parentNode.style.backgroundColor="#f1f1f1",setPositions(),editor.removeAlterToolbar=function(){"none"!==editor.alterTool.style.display&&removeEventListeners()},ZE._addEvent(document,"mousedown",mouseDown),ZE._addEvent(editor.doc,"mousedown",mouseDown)},ZE.prototype.resizeToolbar=function(_pos){"use strict";var oldPos,i,editor=this;oldPos=editor.initToolbarBlock?editor.initToolbarBlock:ZE_Init.initToolbarBlock,editor.initToolbarBlock=_pos;var ulList=editor.toolbardiv.getElementsByTagName("ul"),fontList=editor.toolbardiv.getElementsByTagName("font"),toolbararrayLength=ulList.length;if(_pos!==oldPos){var element=ulList[oldPos-1];if(element.style.display="",element.parentNode.removeChild(element),_pos>oldPos)for(i=oldPos-1;_pos-1>i;i++)ulList[i].style.display="",fontList[i-1].style.display="";else for(fontList[_pos-1].style.display="none",i=_pos-1;toolbararrayLength-2>i;i++)ulList[i].style.display="none",fontList[i-1].style.display="none";ulList[_pos-1].parentNode.insertBefore(element,ulList[_pos-1]),element.previousSibling.style.display=""}};!function(doc,undefined){"use strict";function TreeWalker(root,nodeType,filter){this.root=this.currentNode=root,this.nodeType=nodeType,this.filter=filter}function every(nodeList,fn){for(var l=nodeList.length;l--;)if(!fn(nodeList[l]))return!1;return!0}function isLeaf(node){return node.nodeType===ELEMENT_NODE&&!!leafNodeNames[node.nodeName]}function getNodeCategory(node){if(canWeakMap&&nodeCategoryCache.has(node))return nodeCategoryCache.get(node);var nodeCategory,type=node.nodeType;return nodeCategory=type===TEXT_NODE?INLINE:type!==ELEMENT_NODE&&type!==DOCUMENT_FRAGMENT_NODE?UNKNOWN:every(node.childNodes,isInline)?inlineNodeNames.test(node.nodeName)?INLINE:BLOCK:CONTAINER,canWeakMap&&nodeCategoryCache.set(node,nodeCategory),nodeCategory}function isInline(node){return getNodeCategory(node)===INLINE}function isBlock(node){return getNodeCategory(node)===BLOCK}function isContainer(node){return getNodeCategory(node)===CONTAINER}function getBlockWalker(node,root){var walker=new TreeWalker(root,SHOW_ELEMENT,isBlock);return walker.currentNode=node,walker}function getPreviousBlock(node,root){return node=getBlockWalker(node,root).previousNode(),node!==root?node:null}function getNextBlock(node,root){return node=getBlockWalker(node,root).nextNode(),node!==root?node:null}function areAlike(node,node2){return!isLeaf(node)&&node.nodeType===node2.nodeType&&node.nodeName===node2.nodeName&&"A"!==node.nodeName&&node.className===node2.className&&(!node.style&&!node2.style||node.style.cssText===node2.style.cssText)}function hasTagAttributes(node,tag,attributes){if(node.nodeName!==tag)return!1;for(var attr in attributes)if(node.getAttribute(attr)!==attributes[attr])return!1;return!0}function getNearest(node,root,tag,attributes){for(;node&&node!==root;){if(hasTagAttributes(node,tag,attributes))return node;node=node.parentNode}return null}function isOrContains(parent,node){for(;node;){if(node===parent)return!0;node=node.parentNode}return!1}function getPath(node,root){var id,className,classNames,dir,path="";return node&&node!==root&&(path=getPath(node.parentNode,root),node.nodeType===ELEMENT_NODE&&(path+=(path?">":"")+node.nodeName,(id=node.id)&&(path+="#"+id),(className=node.className.trim())&&(classNames=className.split(/\s\s*/),classNames.sort(),path+=".",path+=classNames.join(".")),(dir=node.dir)&&(path+="[dir="+dir+"]"),classNames&&(indexOf.call(classNames,HIGHLIGHT_CLASS)>-1&&(path+="[backgroundColor="+node.style.backgroundColor.replace(/ /g,"")+"]"),indexOf.call(classNames,COLOUR_CLASS)>-1&&(path+="[color="+node.style.color.replace(/ /g,"")+"]"),indexOf.call(classNames,FONT_FAMILY_CLASS)>-1&&(path+="[fontFamily="+node.style.fontFamily.replace(/ /g,"")+"]"),indexOf.call(classNames,FONT_SIZE_CLASS)>-1&&(path+="[fontSize="+node.style.fontSize+"]")))),path}function getLength(node){var nodeType=node.nodeType;return nodeType===ELEMENT_NODE?node.childNodes.length:node.length||0}function detach(node){var parent=node.parentNode;return parent&&parent.removeChild(node),node}function replaceWith(node,node2){var parent=node.parentNode;parent&&parent.replaceChild(node2,node)}function empty(node){for(var frag=node.ownerDocument.createDocumentFragment(),childNodes=node.childNodes,l=childNodes?childNodes.length:0;l--;)frag.appendChild(node.firstChild);return frag}function createElement(doc,tag,props,children){var attr,value,i,l,el=doc.createElement(tag);if(props instanceof Array&&(children=props,props=null),props)for(attr in props)value=props[attr],value!==undefined&&el.setAttribute(attr,props[attr]);if(children)for(i=0,l=children.length;l>i;i+=1)el.appendChild(children[i]);return el}function fixCursor(node,root){var fixer,child,doc=node.ownerDocument,originalNode=node;if(node===root&&((child=node.firstChild)&&"BR"!==child.nodeName||(fixer=getSquireInstance(doc).createDefaultBlock(),child?node.replaceChild(fixer,child):node.appendChild(fixer),node=fixer,fixer=null)),node.nodeType===TEXT_NODE)return originalNode;if(isInline(node)){for(child=node.firstChild;cantFocusEmptyTextNodes&&child&&child.nodeType===TEXT_NODE&&!child.data;)node.removeChild(child),child=node.firstChild;child||(cantFocusEmptyTextNodes?(fixer=doc.createTextNode(ZWS),getSquireInstance(doc)._didAddZWS()):fixer=doc.createTextNode(""))}else if(useTextFixer){for(;node.nodeType!==TEXT_NODE&&!isLeaf(node);){if(child=node.firstChild,!child){fixer=doc.createTextNode("");break}node=child}node.nodeType===TEXT_NODE?/^ +$/.test(node.data)&&(node.data=""):isLeaf(node)&&node.parentNode.insertBefore(doc.createTextNode(""),node)}else if(!node.querySelector("BR"))for(fixer=createElement(doc,"BR");(child=node.lastElementChild)&&!isInline(child);)node=child;if(fixer)try{node.appendChild(fixer)}catch(error){getSquireInstance(doc).didError({name:"Squire: fixCursor  "+error,message:"Parent: "+node.nodeName+"/"+node.innerHTML+" appendChild: "+fixer.nodeName})}return originalNode}function fixContainer(container,root){var i,l,child,isBR,children=container.childNodes,doc=container.ownerDocument,wrapper=null,config=getSquireInstance(doc)._config;for(i=0,l=children.length;l>i;i+=1)child=children[i],isBR="BR"===child.nodeName,!isBR&&isInline(child)?(wrapper||(wrapper=createElement(doc,config.blockTag,config.blockAttributes)),wrapper.appendChild(child),i-=1,l-=1):(isBR||wrapper)&&(wrapper||(wrapper=createElement(doc,config.blockTag,config.blockAttributes)),fixCursor(wrapper,root),isBR?container.replaceChild(wrapper,child):(container.insertBefore(wrapper,child),i+=1,l+=1),wrapper=null),isContainer(child)&&fixContainer(child,root);return wrapper&&container.appendChild(fixCursor(wrapper,root)),container}function split(node,offset,stopNode,root){var parent,clone,next,nodeType=node.nodeType;if(nodeType===TEXT_NODE&&node!==stopNode)return split(node.parentNode,node.splitText(offset),stopNode,root);if(nodeType===ELEMENT_NODE){if("number"==typeof offset&&(offset=offset<node.childNodes.length?node.childNodes[offset]:null),node===stopNode)return offset;for(parent=node.parentNode,clone=node.cloneNode(!1);offset;)next=offset.nextSibling,clone.appendChild(offset),offset=next;return"OL"===node.nodeName&&getNearest(node,root,"BLOCKQUOTE")&&(clone.start=(+node.start||1)+node.childNodes.length-1),fixCursor(node,root),fixCursor(clone,root),(next=node.nextSibling)?parent.insertBefore(clone,next):parent.appendChild(clone),split(parent,clone,stopNode,root)}return offset}function _mergeInlines(node,fakeRange){for(var child,prev,len,children=node.childNodes,l=children.length,frags=[];l--;)if(child=children[l],prev=l&&children[l-1],l&&isInline(child)&&areAlike(child,prev)&&!leafNodeNames[child.nodeName])fakeRange.startContainer===child&&(fakeRange.startContainer=prev,fakeRange.startOffset+=getLength(prev)),fakeRange.endContainer===child&&(fakeRange.endContainer=prev,fakeRange.endOffset+=getLength(prev)),fakeRange.startContainer===node&&(fakeRange.startOffset>l?fakeRange.startOffset-=1:fakeRange.startOffset===l&&(fakeRange.startContainer=prev,fakeRange.startOffset=getLength(prev))),fakeRange.endContainer===node&&(fakeRange.endOffset>l?fakeRange.endOffset-=1:fakeRange.endOffset===l&&(fakeRange.endContainer=prev,fakeRange.endOffset=getLength(prev))),detach(child),child.nodeType===TEXT_NODE?prev.appendData(child.data):frags.push(empty(child));else if(child.nodeType===ELEMENT_NODE){for(len=frags.length;len--;)child.appendChild(frags.pop());_mergeInlines(child,fakeRange)}}function mergeInlines(node,range){if(node.nodeType===TEXT_NODE&&(node=node.parentNode),node.nodeType===ELEMENT_NODE){var fakeRange={startContainer:range.startContainer,startOffset:range.startOffset,endContainer:range.endContainer,endOffset:range.endOffset};_mergeInlines(node,fakeRange),range.setStart(fakeRange.startContainer,fakeRange.startOffset),range.setEnd(fakeRange.endContainer,fakeRange.endOffset)}}function mergeWithBlock(block,next,range){for(var last,offset,container=next;1===container.parentNode.childNodes.length;)container=container.parentNode;"TD"!=container.nodeName&&(detach(container),offset=block.childNodes.length,last=block.lastChild,last&&"BR"===last.nodeName&&(block.removeChild(last),offset-=1),block.appendChild(empty(next)),range.setStart(block,offset),range.collapse(!0),mergeInlines(block,range),isPresto&&(last=block.lastChild)&&"BR"===last.nodeName&&block.removeChild(last))}function mergeContainers(node,root){var needsFix,block,prev=node.previousSibling,first=node.firstChild,doc=node.ownerDocument,isListItem="LI"===node.nodeName;if(!isListItem||first&&/^[OU]L$/.test(first.nodeName))if(prev&&areAlike(prev,node)){if(!isContainer(prev)){if(!isListItem)return;block=createElement(doc,"DIV"),block.appendChild(empty(prev)),prev.appendChild(block)}detach(node),needsFix=!isContainer(node),prev.appendChild(empty(node)),needsFix&&fixContainer(prev,root),first&&mergeContainers(first,root)}else isListItem&&(prev=createElement(doc,"DIV"),node.insertBefore(prev,first),fixCursor(prev,root))}function monitorShiftKey(event){this.isShiftDown=event.shiftKey}function getSquireInstance(doc){for(var instance,l=instances.length;l--;)if(instance=instances[l],instance._doc===doc)return instance;return null}function mergeObjects(base,extras,mayOverride){var prop,value;if(base||(base={}),extras)for(prop in extras)!mayOverride&&prop in base||(value=extras[prop],base[prop]=value&&value.constructor===Object?mergeObjects(base[prop],value,mayOverride):value);return base}function Squire(root,options){root.nodeType===DOCUMENT_NODE&&(root=root.body);var mutation,doc=root.ownerDocument,win=doc.defaultView;this._win=win,this._doc=doc,this._root=root,this._events={},options&&options.getEditorInstance&&(this._editorRef=options.getEditorInstance),this._isFocused=!1,this._lastSelection=null,losesSelectionOnBlur&&this.addEventListener("beforedeactivate",this.getSelection),this._hasZWS=!1,this._lastAnchorNode=null,this._lastFocusNode=null,this._path="",this._willUpdatePath=!1,"onselectionchange"in doc?this.addEventListener("selectionchange",this._updatePathOnEvent):(this.addEventListener("keyup",this._updatePathOnEvent),this.addEventListener("mouseup",this._updatePathOnEvent)),this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0,this._isInUndoState=!1,this._ignoreChange=!1,this._ignoreAllChanges=!1,canObserveMutations?(mutation=new MutationObserver(this._docWasChanged.bind(this)),mutation.observe(root,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._mutation=mutation):this.addEventListener("keyup",this._keyUpDetectChange),this._restoreSelection=!1,this.addEventListener("blur",enableRestoreSelection),this.addEventListener("mousedown",disableRestoreSelection),this.addEventListener("touchstart",disableRestoreSelection),this.addEventListener("focus",restoreSelection),this._awaitingPaste=!1,this.addEventListener(isIElt11?"beforecut":"cut",onCut),this.addEventListener("copy",onCopy),this.addEventListener("keydown",monitorShiftKey),this.addEventListener("keyup",monitorShiftKey),this.addEventListener(isIElt11?"beforepaste":"paste",onPaste),this.addEventListener("drop",onDrop),this.addEventListener(isPresto?"keypress":"keydown",onKey),this._keyHandlers=Object.create(keyHandlers),this.setConfig(options&&options.config),isIElt11&&(win.Text.prototype.splitText=function(offset){var afterSplit=this.ownerDocument.createTextNode(this.data.slice(offset)),next=this.nextSibling,parent=this.parentNode,toDelete=this.length-offset;return next?parent.insertBefore(afterSplit,next):parent.appendChild(afterSplit),toDelete&&this.deleteData(offset,toDelete),afterSplit}),root.setAttribute("contenteditable","true");try{doc.execCommand("enableObjectResizing",!1,"false"),doc.execCommand("enableInlineTableEditing",!1,"false")}catch(error){}instances.push(this)}function enableRestoreSelection(){this._restoreSelection=!0}function disableRestoreSelection(){this._restoreSelection=!1}function restoreSelection(){this._restoreSelection&&this.setSelection(this._lastSelection)}function removeFormatting(self,root,clean){var node,next;for(node=root.firstChild;node;node=next){if(next=node.nextSibling,isInline(node)){if(node.nodeType===TEXT_NODE||"BR"===node.nodeName||"IMG"===node.nodeName){clean.appendChild(node);continue}}else if(isBlock(node)){clean.appendChild(self.createDefaultBlock([removeFormatting(self,node,self._doc.createDocumentFragment())]));continue}removeFormatting(self,node,clean)}return clean}var DOCUMENT_POSITION_PRECEDING=2,ELEMENT_NODE=1,TEXT_NODE=3,DOCUMENT_NODE=9,DOCUMENT_FRAGMENT_NODE=11,SHOW_ELEMENT=1,SHOW_TEXT=4,START_TO_START=0,START_TO_END=1,END_TO_END=2,END_TO_START=3,HIGHLIGHT_CLASS="highlight",COLOUR_CLASS="colour",FONT_FAMILY_CLASS="font",FONT_SIZE_CLASS="size",ZWS="",win=doc.defaultView,ua=navigator.userAgent,isIOS=/iP(?:ad|hone|od)/.test(ua),isMac=/Mac OS X/.test(ua),isAndroid=/Android/.test(ua),isGecko=/Gecko\//.test(ua),isIElt11=/Trident\/[456]\./.test(ua),isPresto=!!win.opera,isEdge=/Edge\//.test(ua),isWebKit=!isEdge&&/WebKit\//.test(ua),isIE=/Trident\/[4567]\./.test(ua),useTextFixer=isIElt11||isPresto,cantFocusEmptyTextNodes=isIElt11||isWebKit,losesSelectionOnBlur=isIElt11,canObserveMutations="undefined"!=typeof MutationObserver,canWeakMap="undefined"!=typeof WeakMap,notWS=/[^ \t\r\n]/,indexOf=Array.prototype.indexOf;Object.create||(Object.create=function(proto){var F=function(){};return F.prototype=proto,new F});var typeToBitArray={1:1,2:2,3:4,8:128,9:256,11:1024};TreeWalker.prototype.nextNode=function(){for(var node,current=this.currentNode,root=this.root,nodeType=this.nodeType,filter=this.filter;;){for(node=current.firstChild;!node&&current&&current!==root;)node=current.nextSibling,node||(current=current.parentNode);if(!node)return null;if(typeToBitArray[node.nodeType]&nodeType&&filter(node))return this.currentNode=node,node;current=node}},TreeWalker.prototype.previousNode=function(){for(var node,current=this.currentNode,root=this.root,nodeType=this.nodeType,filter=this.filter;;){if(current===root)return null;if(node=current.previousSibling)for(;current=node.lastChild;)node=current;else node=current.parentNode;if(!node)return null;if(typeToBitArray[node.nodeType]&nodeType&&filter(node))return this.currentNode=node,node;current=node}},TreeWalker.prototype.previousPONode=function(){for(var node,current=this.currentNode,root=this.root,nodeType=this.nodeType,filter=this.filter;;){for(node=current.lastChild;!node&&current&&current!==root;)node=current.previousSibling,node||(current=current.parentNode);if(!node)return null;if(typeToBitArray[node.nodeType]&nodeType&&filter(node))return this.currentNode=node,node;current=node}};var inlineNodeNames=/^(?:#text|A(?:BBR|CRONYM)?|B(?:R|D[IO])?|C(?:ITE|ODE)|D(?:ATA|EL|FN)|EM|FONT|HR|I(?:FRAME|MG|NPUT|NS)?|KBD|Q|R(?:P|T|UBY)|S(?:AMP|MALL|PAN|TR(?:IKE|ONG)|U[BP])?|TIME|U|VAR|VIDEO|WBR)$/,leafNodeNames={BR:1,HR:1,IFRAME:1,IMG:1,INPUT:1,VIDEO:1},UNKNOWN=0,INLINE=1,BLOCK=2,CONTAINER=3,nodeCategoryCache=canWeakMap?new WeakMap:null,getNodeBefore=function(node,offset){for(var children=node.childNodes;offset&&node.nodeType===ELEMENT_NODE;)node=children[offset-1],children=node.childNodes,offset=children.length;return node},getNodeAfter=function(node,offset){if(node.nodeType===ELEMENT_NODE){var children=node.childNodes;if(offset<children.length)node=children[offset];else{for(;node&&!node.nextSibling;)node=node.parentNode;node&&(node=node.nextSibling)}}return node},insertNodeInRange=function(range,node){var parent,children,childCount,afterSplit,startContainer=range.startContainer,startOffset=range.startOffset,endContainer=range.endContainer,endOffset=range.endOffset;startContainer.nodeType===TEXT_NODE?(parent=startContainer.parentNode,children=parent.childNodes,startOffset===startContainer.length?(startOffset=indexOf.call(children,startContainer)+1,range.collapsed&&(endContainer=parent,endOffset=startOffset)):(startOffset&&(afterSplit=startContainer.splitText(startOffset),endContainer===startContainer?(endOffset-=startOffset,endContainer=afterSplit):endContainer===parent&&(endOffset+=1),startContainer=afterSplit),startOffset=indexOf.call(children,startContainer)),startContainer=parent):children=startContainer.childNodes,childCount=children.length,startOffset===childCount?startContainer.appendChild(node):startContainer.insertBefore(node,children[startOffset]),startContainer===endContainer&&(endOffset+=children.length-childCount),range.setStart(startContainer,startOffset),range.setEnd(endContainer,endOffset)},extractContentsOfRange=function(range,common,root){var startContainer=range.startContainer,startOffset=range.startOffset,endContainer=range.endContainer,endOffset=range.endOffset;common||(common=range.commonAncestorContainer),common.nodeType===TEXT_NODE&&(common=common.parentNode);for(var next,before,after,endNode=split(endContainer,endOffset,common,root),startNode=split(startContainer,startOffset,common,root),frag=common.ownerDocument.createDocumentFragment();startNode!==endNode;)next=startNode.nextSibling,frag.appendChild(startNode),startNode=next;return startContainer=common,startOffset=endNode?indexOf.call(common.childNodes,endNode):common.childNodes.length,after=common.childNodes[startOffset],before=after&&after.previousSibling,before&&before.nodeType===TEXT_NODE&&after.nodeType===TEXT_NODE&&(startContainer=before,startOffset=before.length,before.appendData(after.data),detach(after)),range.setStart(startContainer,startOffset),range.collapse(!0),fixCursor(common,root),frag},deleteContentsOfRange=function(range,root){moveRangeBoundariesUpTree(range);var startBlock=range.startContainer,endBlock=range.endContainer,needsMerge=(isInline(startBlock)||isBlock(startBlock))&&(isInline(endBlock)||isBlock(endBlock)),frag=extractContentsOfRange(range,null,root);moveRangeBoundariesDownTree(range),startBlock=getStartBlockOfRange(range,root),needsMerge&&(endBlock=getEndBlockOfRange(range,root),startBlock&&endBlock&&startBlock!==endBlock&&mergeWithBlock(startBlock,endBlock,range)),startBlock&&fixCursor(startBlock,root);var child=root.firstChild;return child&&"BR"!==child.nodeName?range.collapse(!1):(fixCursor(root,root),range.selectNodeContents(root.firstChild)),frag},insertTreeFragmentIntoRange=function(range,frag,root){for(var allInline=!0,children=frag.childNodes,l=children.length;l--;)if(!isInline(children[l])){allInline=!1;break}if(range.collapsed||deleteContentsOfRange(range,root),moveRangeBoundariesDownTree(range),allInline)insertNodeInRange(range,frag),range.startContainer!==range.endContainer&&mergeInlines(range.endContainer,range),mergeInlines(range.startContainer,range),range.collapse(!1);else{for(var child,node,prev,next,startAnchor,splitPoint=range.startContainer,nodeAfterSplit=split(splitPoint,range.startOffset,getNearest(splitPoint.parentNode,root,"BLOCKQUOTE")||getNearest(splitPoint.parentNode,root,"TD")||root,root),nodeBeforeSplit=nodeAfterSplit.previousSibling,startContainer=nodeBeforeSplit,startOffset=startContainer.childNodes.length,endContainer=nodeAfterSplit,endOffset=0,parent=nodeAfterSplit.parentNode;(child=startContainer.lastChild)&&child.nodeType===ELEMENT_NODE;){if("BR"===child.nodeName){startOffset-=1;break}startContainer=child,startOffset=startContainer.childNodes.length}for(;(child=endContainer.firstChild)&&child.nodeType===ELEMENT_NODE&&"BR"!==child.nodeName;)endContainer=child;for(startAnchor=startContainer.childNodes[startOffset]||null;(child=frag.firstChild)&&isInline(child);)startContainer.insertBefore(child,startAnchor);for(;(child=frag.lastChild)&&isInline(child);)endContainer.insertBefore(child,endContainer.firstChild),endOffset+=1;for(node=frag;node=getNextBlock(node,root);)fixCursor(node,root);if(parent.insertBefore(frag,nodeAfterSplit),next=nodeBeforeSplit.nextSibling,node=getPreviousBlock(next,root),node&&!/\S/.test(node.textContent))do parent=node.parentNode,parent.removeChild(node),node=parent;while(node&&!node.lastChild&&node!==root);if(nodeBeforeSplit.parentNode||(nodeBeforeSplit=next.previousSibling),startContainer.parentNode||(startContainer=nodeBeforeSplit||next.parentNode,startOffset=nodeBeforeSplit?nodeBeforeSplit.childNodes.length:0),isContainer(next)&&mergeContainers(next,root),prev=nodeAfterSplit.previousSibling,node=isBlock(nodeAfterSplit)?nodeAfterSplit:getNextBlock(nodeAfterSplit,root),node&&!/\S/.test(node.textContent))do parent=node.parentNode,parent.removeChild(node),node=parent;while(node&&!node.lastChild&&node!==root);nodeAfterSplit.parentNode||(nodeAfterSplit=prev.nextSibling),endOffset||(endContainer=prev,endOffset=prev.childNodes.length),nodeAfterSplit&&isContainer(nodeAfterSplit)&&mergeContainers(nodeAfterSplit,root),range.setStart(startContainer,startOffset),range.setEnd(endContainer,endOffset),moveRangeBoundariesDownTree(range)}},isNodeContainedInRange=function(range,node,partial){var nodeRange=node.ownerDocument.createRange();if(nodeRange.selectNode(node),partial){var nodeEndBeforeStart=range.compareBoundaryPoints(END_TO_START,nodeRange)>-1,nodeStartAfterEnd=range.compareBoundaryPoints(START_TO_END,nodeRange)<1;return!nodeEndBeforeStart&&!nodeStartAfterEnd}var nodeStartAfterStart=range.compareBoundaryPoints(START_TO_START,nodeRange)<1,nodeEndBeforeEnd=range.compareBoundaryPoints(END_TO_END,nodeRange)>-1;return nodeStartAfterStart&&nodeEndBeforeEnd},moveRangeBoundariesDownTree=function(range){for(var child,startContainer=range.startContainer,startOffset=range.startOffset,endContainer=range.endContainer,endOffset=range.endOffset,maySkipBR=!0;startContainer.nodeType!==TEXT_NODE&&(child=startContainer.childNodes[startOffset],child&&!isLeaf(child));)startContainer=child,startOffset=0;if(endOffset)for(;endContainer.nodeType!==TEXT_NODE;){if(child=endContainer.childNodes[endOffset-1],!child||isLeaf(child)){if(maySkipBR&&child&&"BR"===child.nodeName){endOffset-=1,maySkipBR=!1;continue}break}endContainer=child,endOffset=getLength(endContainer)}else for(;endContainer.nodeType!==TEXT_NODE&&(child=endContainer.firstChild,child&&!isLeaf(child));)endContainer=child;range.collapsed?(range.setStart(endContainer,endOffset),range.setEnd(startContainer,startOffset)):(range.setStart(startContainer,startOffset),range.setEnd(endContainer,endOffset))},moveRangeBoundariesUpTree=function(range,common){var parent,startContainer=range.startContainer,startOffset=range.startOffset,endContainer=range.endContainer,endOffset=range.endOffset,maySkipBR=!0;for(common||(common=range.commonAncestorContainer);startContainer!==common&&!startOffset;)parent=startContainer.parentNode,startOffset=indexOf.call(parent.childNodes,startContainer),startContainer=parent;for(;;){if(maySkipBR&&endContainer.nodeType!==TEXT_NODE&&endContainer.childNodes[endOffset]&&"BR"===endContainer.childNodes[endOffset].nodeName&&(endOffset+=1,maySkipBR=!1),endContainer===common||endOffset!==getLength(endContainer))break;parent=endContainer.parentNode,endOffset=indexOf.call(parent.childNodes,endContainer)+1,endContainer=parent}range.setStart(startContainer,startOffset),range.setEnd(endContainer,endOffset)},getStartBlockOfRange=function(range,root){var block,container=range.startContainer;return isInline(container)?block=getPreviousBlock(container,root):container!==root&&isBlock(container)?block=container:(block=getNodeBefore(container,range.startOffset),block=getNextBlock(block,root)),block&&isNodeContainedInRange(range,block,!0)?block:null},getEndBlockOfRange=function(range,root){var block,child,container=range.endContainer;if(isInline(container))block=getPreviousBlock(container,root);else if(container!==root&&isBlock(container))block=container;else{if(block=getNodeAfter(container,range.endOffset),!block||!isOrContains(root,block))for(block=root;child=block.lastChild;)block=child;block=getPreviousBlock(block,root)}return block&&isNodeContainedInRange(range,block,!0)?block:null},contentWalker=new TreeWalker(null,SHOW_TEXT|SHOW_ELEMENT,function(node){return node.nodeType===TEXT_NODE?notWS.test(node.data):"IMG"===node.nodeName||"INPUT"===node.nodeName||"VIDEO"===node.nodeName||"IFRAME"===node.nodeName}),rangeDoesStartAtBlockBoundary=function(range,root){var nodeAfterCursor,startContainer=range.startContainer,startOffset=range.startOffset;if(contentWalker.root=null,startContainer.nodeType===TEXT_NODE){if(startOffset)return!1;nodeAfterCursor=startContainer}else if(nodeAfterCursor=getNodeAfter(startContainer,startOffset),nodeAfterCursor&&!isOrContains(root,nodeAfterCursor)&&(nodeAfterCursor=null),!nodeAfterCursor&&(nodeAfterCursor=getNodeBefore(startContainer,startOffset),nodeAfterCursor.nodeType===TEXT_NODE&&nodeAfterCursor.length))return!1;return contentWalker.currentNode=nodeAfterCursor,contentWalker.root=getStartBlockOfRange(range,root),!contentWalker.previousNode()},rangeDoesEndAtBlockBoundary=function(range,root){var length,endContainer=range.endContainer,endOffset=range.endOffset;if(contentWalker.root=null,endContainer.nodeType===TEXT_NODE){if(length=endContainer.data.length,length&&length>endOffset)return!1;contentWalker.currentNode=endContainer}else contentWalker.currentNode=getNodeBefore(endContainer,endOffset);return contentWalker.root=getEndBlockOfRange(range,root),!contentWalker.nextNode()},expandRangeToBlockBoundaries=function(range,root){var parent,start=getStartBlockOfRange(range,root),end=getEndBlockOfRange(range,root);start&&end&&(parent=start.parentNode,range.setStart(parent,indexOf.call(parent.childNodes,start)),parent=end.parentNode,range.setEnd(parent,indexOf.call(parent.childNodes,end)+1))},keys={8:"backspace",9:"tab",13:"enter",32:"space",33:"pageup",34:"pagedown",37:"left",39:"right",46:"delete",219:"[",221:"]"},onKey=function(event){var code=event.keyCode,key=keys[code],modifiers="",range=this.getSelection();event.defaultPrevented||(key||(key=String.fromCharCode(code).toLowerCase(),/^[A-Za-z0-9]$/.test(key)||(key="")),isPresto&&46===event.which&&(key="."),code>111&&124>code&&(key="f"+(code-111)),"backspace"!==key&&"delete"!==key&&(event.altKey&&(modifiers+="alt-"),event.ctrlKey&&(modifiers+="ctrl-"),event.metaKey&&(modifiers+="meta-")),event.shiftKey&&(modifiers+="shift-"),key=modifiers+key,this._keyHandlers[key]?this._keyHandlers[key](this,event,range):1!==key.length||range.collapsed||(this.saveUndoState(range),deleteContentsOfRange(range,this._root),this._ensureBottomLine(),this.setSelection(range),this._updatePath(range,!0)))},afterDelete=function(self,range){try{range||(range=self.getSelection());var parent,node=range.startContainer;for(node.nodeType===TEXT_NODE&&(node=node.parentNode),parent=node;isInline(parent)&&(!parent.textContent||parent.textContent===ZWS)&&0==parent.getElementsByTagName("img").length&&0==parent.getElementsByTagName("video").length;)node=parent,parent=node.parentNode;node!==parent&&(range.setStart(parent,indexOf.call(parent.childNodes,node)),range.collapse(!0),parent.removeChild(node),isBlock(parent)||(parent=getPreviousBlock(parent,self._root)),fixCursor(parent,self._root),moveRangeBoundariesDownTree(range)),node===self._root&&(node=node.firstChild)&&"BR"===node.nodeName&&detach(node),self._ensureBottomLine(),self.setSelection(range),self._updatePath(range,!0)}catch(error){self.didError(error)}},keyHandlers={enter:function(self,event,range){var block,parent,nodeAfterSplit,tempElem,root=self._root;event.preventDefault();var _editorReference=self._editorRef().initobj;if("function"==typeof _editorReference.isEnterKeyHandler){var _value=_editorReference.isEnterKeyHandler();if(_value===!0)return!0}if(tempElem=document.getElementById("ze_autofill"),tempElem&&tempElem.getElementsByClassName("sel").length)return!0;if(self._recordUndoState(range),addLinks(range.startContainer,root,self),self._removeZWS(),self._getRangeAndRemoveBookmark(range),range.collapsed||deleteContentsOfRange(range,root),block=getStartBlockOfRange(range,root),!block||/^T[HD]$/.test(block.nodeName))return insertNodeInRange(range,self.createElement("BR")),range.collapse(!1),self.setSelection(range),void self._updatePath(range,!0);if((parent=getNearest(block,root,"LI"))&&(block=parent),!(block.textContent||block.getElementsByTagName("img").length>0)){if(getNearest(block,root,"UL")||getNearest(block,root,"OL"))return self.modifyBlocks(decreaseListLevel,range);if(getNearest(block,root,"BLOCKQUOTE"))return self.modifyBlocks(removeBlockQuote,range)}for(nodeAfterSplit=splitBlock(self,block,range.startContainer,range.startOffset),removeZWS(block),removeEmptyInlines(block),fixCursor(block,root);nodeAfterSplit.nodeType===ELEMENT_NODE;){var next,child=nodeAfterSplit.firstChild;if("A"===nodeAfterSplit.nodeName&&(!nodeAfterSplit.textContent||nodeAfterSplit.textContent===ZWS)&&0==nodeAfterSplit.getElementsByTagName("img").length){child=self._doc.createTextNode(""),replaceWith(nodeAfterSplit,child),nodeAfterSplit=child;break}for(;child&&child.nodeType===TEXT_NODE&&!child.data&&(next=child.nextSibling,next&&"BR"!==next.nodeName);)detach(child),child=next;if(!child||"BR"===child.nodeName||child.nodeType===TEXT_NODE&&!isPresto)break;nodeAfterSplit=child}range=self._createRange(nodeAfterSplit,0),self.setSelection(range),self._updatePath(range,!0),nodeAfterSplit.nodeType===TEXT_NODE&&(nodeAfterSplit=nodeAfterSplit.parentNode),nodeAfterSplit.getBoundingClientRect().top+16>self._doc.documentElement.clientHeight&&(nodeAfterSplit.scrollIntoViewIfNeeded?nodeAfterSplit.scrollIntoViewIfNeeded(!1):nodeAfterSplit.scrollIntoView(!1))},backspace:function(self,event,range){var root=self._root;if(self._removeZWS(),self.saveUndoState(range),range.collapsed)if(rangeDoesStartAtBlockBoundary(range,root)){event.preventDefault();var previous,current=getStartBlockOfRange(range,root);if(!current)return;fixContainer(current.parentNode,root),previous=getPreviousBlock(current,root);var tableNode=previous&&getNearest(previous,root,"TABLE",{contenteditable:"false"});if(tableNode&&(previous=tableNode),previous){if(!previous.isContentEditable)return void detach(previous);for(mergeWithBlock(previous,current,range),current=previous.parentNode;current!==root&&!current.nextSibling;)current=current.parentNode;current!==root&&"TD"!=current.nodeName&&"TR"!=current.nodeName&&(current=current.nextSibling)&&mergeContainers(current,root),self.setSelection(range)}else if(current){if(getNearest(current,root,"UL")||getNearest(current,root,"OL"))return self.modifyBlocks(decreaseListLevel,range);if(getNearest(current,root,"BLOCKQUOTE"))return self.modifyBlocks(decreaseBlockQuoteLevel,range);self.setSelection(range),self._updatePath(range,!0)}}else self.setSelection(range),setTimeout(function(){afterDelete(self)},0);else event.preventDefault(),deleteContentsOfRange(range,root),afterDelete(self,range)},"delete":function(self,event,range){var current,next,originalRange,cursorContainer,cursorOffset,nodeAfterCursor,root=self._root;if(self._removeZWS(),self.saveUndoState(range),range.collapsed)if(rangeDoesEndAtBlockBoundary(range,root)){if(event.preventDefault(),current=getStartBlockOfRange(range,root),!current)return;if(fixContainer(current.parentNode,root),next=getNextBlock(current,root)){if(!next.isContentEditable)return void detach(next);for(mergeWithBlock(current,next,range),next=current.parentNode;next!==root&&!next.nextSibling;)next=next.parentNode;next!==root&&(next=next.nextSibling)&&mergeContainers(next,root),self.setSelection(range),self._updatePath(range,!0)}}else{if(originalRange=range.cloneRange(),moveRangeBoundariesUpTree(range,self._root),cursorContainer=range.endContainer,cursorOffset=range.endOffset,cursorContainer.nodeType===ELEMENT_NODE&&(nodeAfterCursor=cursorContainer.childNodes[cursorOffset],nodeAfterCursor&&"IMG"===nodeAfterCursor.nodeName))return event.preventDefault(),detach(nodeAfterCursor),moveRangeBoundariesDownTree(range),void afterDelete(self,range);self.setSelection(originalRange),setTimeout(function(){afterDelete(self)},0)}else event.preventDefault(),deleteContentsOfRange(range,root),afterDelete(self,range)},tab:function(self,event,range){var node,parent,root=self._root;if(self._removeZWS(),range.collapsed&&rangeDoesStartAtBlockBoundary(range,root))for(node=getStartBlockOfRange(range,root);parent=node.parentNode;){if("UL"===parent.nodeName||"OL"===parent.nodeName){event.preventDefault(),self.modifyBlocks(increaseListLevel,range);break}node=parent}window.ZE&&ZE.tabHandler&&ZE.tabHandler(event,self._win,self._doc)},"shift-tab":function(self,event,range){var node,root=self._root;self._removeZWS(),range.collapsed&&rangeDoesStartAtBlockBoundary(range,root)&&(node=range.startContainer,(getNearest(node,root,"UL")||getNearest(node,root,"OL"))&&(event.preventDefault(),self.modifyBlocks(decreaseListLevel,range)))},space:function(self,_,range){var node,parent;self._recordUndoState(range),addLinks(range.startContainer,self._root,self),self._getRangeAndRemoveBookmark(range),node=range.endContainer,parent=node.parentNode,range.collapsed&&"A"===parent.nodeName&&!node.nextSibling&&range.endOffset===getLength(node)?range.setStartAfter(parent):range.collapsed||(deleteContentsOfRange(range,self._root),self._ensureBottomLine(),self.setSelection(range),self._updatePath(range,!0)),self.setSelection(range)},left:function(self){self._removeZWS()},right:function(self){self._removeZWS()}};isMac&&isGecko&&(keyHandlers["meta-left"]=function(self,event){event.preventDefault();var sel=getWindowSelection(self);sel&&sel.modify&&sel.modify("move","backward","lineboundary")},keyHandlers["meta-right"]=function(self,event){event.preventDefault();var sel=getWindowSelection(self);sel&&sel.modify&&sel.modify("move","forward","lineboundary")}),isMac||(keyHandlers.pageup=function(self){self.moveCursorToStart()},keyHandlers.pagedown=function(self){self.moveCursorToEnd()});var fontSizes={1:10,2:13,3:16,4:18,5:24,6:32,7:48},styleToSemantic={backgroundColor:{regexp:notWS,replace:function(doc,colour){return createElement(doc,"SPAN",{"class":HIGHLIGHT_CLASS,style:"background-color:"+colour})}},color:{regexp:notWS,replace:function(doc,colour){return createElement(doc,"SPAN",{"class":COLOUR_CLASS,style:"color:"+colour})}},fontWeight:{regexp:/^bold|^700/i,replace:function(doc){return createElement(doc,"B")}},fontStyle:{regexp:/^italic/i,replace:function(doc){return createElement(doc,"I")}},fontFamily:{regexp:notWS,replace:function(doc,family){return createElement(doc,"SPAN",{"class":FONT_FAMILY_CLASS,style:"font-family:"+family})}},fontSize:{regexp:notWS,replace:function(doc,size){return createElement(doc,"SPAN",{"class":FONT_SIZE_CLASS,style:"font-size:"+size})}},textDecoration:{regexp:/^underline/i,replace:function(doc){return createElement(doc,"U")}}},replaceWithTag=function(tag){return function(node,parent){var el=createElement(node.ownerDocument,tag);return parent.replaceChild(el,node),el.appendChild(empty(node)),el}},replaceStyles=function(node,parent,options){var attr,converter,css,newTreeBottom,newTreeTop,el,style=node.style,doc=node.ownerDocument,_options=options||{};if("function"==typeof _options._editorRef&&_options._editorRef().initobj.hasOwnProperty("removeStyleProps"))for(var opts=options._editorRef().initobj.removeStyleProps,optsLens=opts.length,i=(style.length,0);optsLens>i;i++)style[opts[i]]="";for(attr in styleToSemantic)converter=styleToSemantic[attr],css=style[attr],css&&converter.regexp.test(css)&&(el=converter.replace(doc,css),newTreeTop||(newTreeTop=el),newTreeBottom&&newTreeBottom.appendChild(el),newTreeBottom=el,node.style[attr]="");return newTreeTop&&(newTreeBottom.appendChild(empty(node)),"SPAN"===node.nodeName?parent.replaceChild(newTreeTop,node):node.appendChild(newTreeTop)),newTreeBottom||node},stylesRewriters={P:replaceStyles,SPAN:replaceStyles,STRONG:replaceWithTag("B"),EM:replaceWithTag("I"),INS:replaceWithTag("U"),STRIKE:replaceWithTag("S"),IMG:function(node){if(node.getAttribute("style")){if(node.style.width){var width=node.style.width;width=width.replace("px",""),node.setAttribute("width",width)}if(node.style.height){var height=node.style.height;height=height.replace("px",""),node.setAttribute("height",height)}}return node},VIDEO:function(node){if(node.getAttribute("style")){if(node.style.width){var width=node.style.width;width=width.replace("px",""),node.setAttribute("width",width)}if(node.style.height){var height=node.style.height;height=height.replace("px",""),node.setAttribute("height",height)}}return node},FONT:function(node,parent){var fontSpan,sizeSpan,colourSpan,newTreeBottom,newTreeTop,face=node.face||node.style.fontFamily,size=node.size,colour=node.color||node.style.color,doc=node.ownerDocument;if(face&&(fontSpan=createElement(doc,"SPAN",{"class":"font",style:"font-family:"+face}),newTreeTop=fontSpan,newTreeBottom=fontSpan),size&&(sizeSpan=createElement(doc,"SPAN",{"class":"size",style:"font-size:"+fontSizes[size]+"px"}),newTreeTop||(newTreeTop=sizeSpan),newTreeBottom&&newTreeBottom.appendChild(sizeSpan),newTreeBottom=sizeSpan),colour)if(/^#?([\dA-F]{3}){1,2}$/i.test(colour))"#"!==colour.charAt(0)&&(colour="#"+colour),colourSpan=createElement(doc,"SPAN",{"class":"colour",style:"color:"+colour}),newTreeTop||(newTreeTop=colourSpan),newTreeBottom&&newTreeBottom.appendChild(colourSpan),newTreeBottom=colourSpan;else if(colour.indexOf("rgb")>-1){colour=colour.replace(/rgb\(|\)/g,"").split(",");for(var collen=colour.length,i=0;collen>i;i++)colour[i]=parseInt(colour[i],10).toString(16),colour[i]=1==colour[i].length?"0"+colour[i]:colour[i];colour="#"+colour.join(""),colourSpan=createElement(doc,"SPAN",{"class":"colour",style:"color:"+colour}),newTreeTop||(newTreeTop=colourSpan),newTreeBottom&&newTreeBottom.appendChild(colourSpan),newTreeBottom=colourSpan}return newTreeTop||(newTreeTop=newTreeBottom=createElement(doc,"SPAN")),parent.replaceChild(newTreeTop,node),newTreeBottom.appendChild(empty(node)),newTreeBottom},TT:function(node,parent){var el=createElement(node.ownerDocument,"SPAN",{"class":"font",style:'font-family:menlo,consolas,"courier new",monospace'});return parent.replaceChild(el,node),el.appendChild(empty(node)),el}},allowedBlock=/^(?:A(?:DDRESS|RTICLE|SIDE|UDIO)|A|BLOCKQUOTE|CAPTION|D(?:[DLT]|IV)|F(?:IGURE|IGCAPTION|OOTER)|H[1-6]|HEADER|L(?:ABEL|EGEND|I)|O(?:L|UTPUT)|P(?:RE)?|SECTION|STYLE|T(?:ABLE|BODY|D|FOOT|H|HEAD|R)|COL(?:GROUP)?|UL)$/,blacklist=/^(?:HEAD$|META)/,walker=new TreeWalker(null,SHOW_TEXT|SHOW_ELEMENT,function(){return!0}),cleanTree=function cleanTree(node,preserveWS,options){var nonInlineParent,i,l,child,nodeName,nodeType,rewriter,childLength,startsWithWS,endsWithWS,data,sibling,editorInstance,setZEEditorImageStyle,children=node.childNodes;for(options=options||{},setZEEditorImageStyle=function(){var img=this;img.setAttribute("orig_width",img.width),img.setAttribute("orig_height",img.height),"undefined"!=typeof ZE&&ZE.setImageSizeOptions(img,"bestfit",editorInstance.editordiv.offsetWidth),img.removeAttribute("data-zeLoad")},nonInlineParent=node;isInline(nonInlineParent);)nonInlineParent=nonInlineParent.parentNode;walker.root=nonInlineParent;var editorReference;if(options._editorRef?editorReference=options._editorRef():options.editorRef&&(editorReference=options.editorRef()),editorReference&&editorReference.initobj.hasOwnProperty("styRewriter")){var nodeList=editorReference.initobj.styRewriter;nodeList.forEach(function(nodes){stylesRewriters[nodes]=stylesRewriters.A})}for(i=0,l=children.length;l>i;i+=1)if(child=children[i],nodeName=child.nodeName,nodeType=child.nodeType,rewriter=stylesRewriters[nodeName],nodeType===ELEMENT_NODE){if(childLength=child.childNodes.length,rewriter)child=rewriter(child,node,options);else{if(blacklist.test(nodeName)){node.removeChild(child),i-=1,l-=1;continue}if(!allowedBlock.test(nodeName)&&!isInline(child)){i-=1,l+=childLength-1,node.replaceChild(empty(child),child);continue}}if("IMG"===nodeName&&options.handleWaitingImages)if(child.className.indexOf("ze_img_upload")>-1){var nodeId=child.getAttribute("id");if(editorInstance=options.editorRef(),nodeId&&editorInstance._unusedImagesList[nodeId])child.setAttribute("data-zeload",!0),child.onload=setZEEditorImageStyle,child.src=editorInstance._unusedImagesList[nodeId],child.removeAttribute("id"),child.removeAttribute("class"),delete editorInstance._unusedImagesList[nodeId];else if(nodeId&&!editorInstance._pendingImagesList[nodeId]){node.removeChild(child),i-=1,l-=1;continue}}else child.hasAttribute("data-zeload")&&(editorInstance=options.editorRef(),child.onload=setZEEditorImageStyle);childLength&&cleanTree(child,preserveWS||"PRE"===nodeName,options)}else{if(nodeType===TEXT_NODE){if(data=child.data,startsWithWS=!notWS.test(data.charAt(0)),endsWithWS=!notWS.test(data.charAt(data.length-1)),preserveWS||!startsWithWS&&!endsWithWS)continue;if(startsWithWS){for(walker.currentNode=child;(sibling=walker.previousPONode())&&(nodeName=sibling.nodeName,!("IMG"===nodeName||"#text"===nodeName&&notWS.test(sibling.data)));)if(!isInline(sibling)){sibling=null;break}data=data.replace(/^[ \t\r\n]+/g,sibling?" ":"")}if(endsWithWS){for(walker.currentNode=child;(sibling=walker.nextNode())&&!("IMG"===nodeName||"#text"===nodeName&&notWS.test(sibling.data));)if(!isInline(sibling)){sibling=null;break}data=data.replace(/[ \t\r\n]+$/g,sibling?" ":"")}if(data){child.data=data;continue}}node.removeChild(child),i-=1,l-=1}return node},removeEmptyInlines=function removeEmptyInlines(node){for(var child,children=node.childNodes,l=children.length;l--;)child=children[l],child.nodeType!==ELEMENT_NODE||isLeaf(child)?child.nodeType!==TEXT_NODE||child.data||node.removeChild(child):(removeEmptyInlines(child),isInline(child)&&!child.firstChild&&node.removeChild(child))},notWSTextNode=function(node){return node.nodeType===ELEMENT_NODE?"BR"===node.nodeName:notWS.test(node.data)},isLineBreak=function(br){for(var walker,block=br.parentNode;isInline(block);)block=block.parentNode;return walker=new TreeWalker(block,SHOW_ELEMENT|SHOW_TEXT,notWSTextNode),walker.currentNode=br,!!walker.nextNode()},cleanupBRs=function(node,root){var i,br,parent,brs=node.querySelectorAll("BR"),brBreaksLine=[],l=brs.length;for(i=0;l>i;i+=1)brBreaksLine[i]=isLineBreak(brs[i]);for(;l--;)br=brs[l],parent=br.parentNode,parent&&(brBreaksLine[l]?isInline(parent)||fixContainer(parent,root):detach(br))},setClipboardData=function(clipboardData,node){var body=node.ownerDocument.body;node.setAttribute("style","position:fixed;overflow:hidden;bottom:100%;right:100%;"),body.appendChild(node),clipboardData.setData("text/html",node.innerHTML),clipboardData.setData("text/plain",node.innerText||node.textContent),body.removeChild(node)},onCut=function(event){var startBlock,endBlock,copyRoot,contents,parent,newContents,node,clipboardData=event.clipboardData,range=this.getSelection(),root=this._root,self=this;if(range.collapsed)return void event.preventDefault();if(this.saveUndoState(range),isEdge||isIOS||!clipboardData)setTimeout(function(){try{self._ensureBottomLine()}catch(error){self.didError(error)}},0);else{for(startBlock=getStartBlockOfRange(range,root),endBlock=getEndBlockOfRange(range,root),copyRoot=startBlock===endBlock&&startBlock||root,contents=deleteContentsOfRange(range,root),parent=range.commonAncestorContainer,parent.nodeType===TEXT_NODE&&(parent=parent.parentNode);parent&&parent!==copyRoot;)newContents=parent.cloneNode(!1),newContents.appendChild(contents),contents=newContents,parent=parent.parentNode;node=this.createElement("div"),node.appendChild(contents),setClipboardData(clipboardData,node,root,this._config),event.preventDefault()}this.setSelection(range)},onCopy=function(event){if(!isGecko){var startBlock,endBlock,copyRoot,contents,parent,newContents,clipboardData=event.clipboardData,range=this.getSelection(),node=this.createElement("div"),root=this._root;if(!isEdge&&!isIOS&&clipboardData){for(range=range.cloneRange(),startBlock=getStartBlockOfRange(range,root),endBlock=getEndBlockOfRange(range,root),copyRoot=startBlock===endBlock?startBlock:root,moveRangeBoundariesDownTree(range),moveRangeBoundariesUpTree(range,copyRoot),contents=range.cloneContents(),parent=range.commonAncestorContainer,parent.nodeType===TEXT_NODE&&(parent=parent.parentNode);parent&&parent!==copyRoot;)newContents=parent.cloneNode(!1),newContents.appendChild(contents),contents=newContents,parent=parent.parentNode;node.appendChild(contents),setClipboardData(clipboardData,node),event.preventDefault()}}},onPaste=function(event){var l,item,type,types,data,clipboardData=event.clipboardData,items=clipboardData&&clipboardData.items,choosePlain=this.isShiftDown,fireDrop=!1,hasImage=!1,plainItem=null,self=this;if(!isEdge&&items&&!isGecko){for(event.preventDefault(),l=items.length;l--;){if(item=items[l],type=item.type,!choosePlain&&"text/html"===type)return void item.getAsString(function(html){self.insertHTML(html,!0)});"text/plain"===type&&(plainItem=item),!choosePlain&&/^image\/.*/.test(type)&&(hasImage=!0)}return void(hasImage?(this.fireEvent("dragover",{dataTransfer:clipboardData,preventDefault:function(){fireDrop=!0}}),fireDrop&&this.fireEvent("drop",{dataTransfer:clipboardData,editorCustomPaste:!0})):plainItem&&item.getAsString(function(text){self.insertPlainText(text,!0)}))}if(types=clipboardData&&clipboardData.types,!isEdge&&types&&(indexOf.call(types,"text/html")>-1||!isGecko&&indexOf.call(types,"text/plain")>-1&&indexOf.call(types,"text/rtf")<0))return event.preventDefault(),void(!choosePlain&&(data=clipboardData.getData("text/html"))?this.insertHTML(data,!0):((data=clipboardData.getData("text/plain"))||(data=clipboardData.getData("text/uri-list")))&&this.insertPlainText(data,!0));this._awaitingPaste=!0;var body=this._doc.body,range=this.getSelection(),startContainer=range.startContainer,startOffset=range.startOffset,endContainer=range.endContainer,endOffset=range.endOffset,pasteArea=this.createElement("DIV",{contenteditable:"true",style:"position:fixed; overflow:hidden; top:0; right:100%; width:1px; height:1px;"});body.appendChild(pasteArea),range.selectNodeContents(pasteArea),this.setSelection(range),setTimeout(function(){try{self._awaitingPaste=!1;for(var first,range,html="",next=pasteArea;pasteArea=next;)next=pasteArea.nextSibling,detach(pasteArea),first=pasteArea.firstChild,first&&first===pasteArea.lastChild&&"DIV"===first.nodeName&&(pasteArea=first),html+=pasteArea.innerHTML;range=self._createRange(startContainer,startOffset,endContainer,endOffset),self.setSelection(range),html&&self.insertHTML(html,!0)}catch(error){self.didError(error)}},0)},onDrop=function(event){for(var types=event.dataTransfer.types,l=types.length,hasPlain=!1,hasHTML=!1;l--;)switch(types[l]){case"text/plain":hasPlain=!0;break;case"text/html":hasHTML=!0;break;default:return}(hasHTML||hasPlain)&&this.saveUndoState()},instances=[],proto=Squire.prototype,sanitizeToDOMFragment=function(html,isPaste,self){var doc=self._doc,frag=html?DOMPurify.sanitize(html,{WHOLE_DOCUMENT:!1,RETURN_DOM:!0,RETURN_DOM_FRAGMENT:!0,ADD_TAGS:self._editorRef().initobj.allowTagsInsertHTML||[],ADD_ATTR:self._editorRef().initobj.allowAttrsInsertHTML||[]}):null;return frag?doc.importNode(frag,!0):doc.createDocumentFragment()};proto.testPresenceinSelection=function(name,action,format,validation){var path=this.getPath(),test=validation.test(path)|this.hasFormat(format);return name==action&&test?!0:!1},proto.setConfig=function(config){return config=mergeObjects({blockTag:"DIV",blockAttributes:null,tagAttributes:{blockquote:null,ul:null,ol:null,li:null,a:null},leafNodeNames:leafNodeNames,undo:{documentSizeThreshold:-1,undoLimit:-1},isSetHTMLSanitized:!0,sanitizeToDOMFragment:"undefined"!=typeof DOMPurify&&DOMPurify.isSupported?sanitizeToDOMFragment:null},config,!0),config.blockTag=config.blockTag.toUpperCase(),this._config=config,this},proto.createElement=function(tag,props,children){return createElement(this._doc,tag,props,children)},proto.createDefaultBlock=function(children){var config=this._config;return fixCursor(this.createElement(config.blockTag,config.blockAttributes,children),this._root)},proto.didError=function(error){console.log(error)},proto.getDocument=function(){return this._doc},proto.getRoot=function(){return this._root},proto.modifyDocument=function(modificationCallback){this._ignoreAllChanges=!0,this._mutation&&this._mutation.disconnect(),modificationCallback(),this._ignoreAllChanges=!1,this._mutation&&(this._mutation.observe(this._root,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._ignoreChange=!1)};var customEvents={pathChange:1,select:1,input:1,undoStateChange:1};proto.fireEvent=function(type,event){var isFocused,l,obj,handlers=this._events[type];if(/^(?:focus|blur)/.test(type))if(isFocused=isOrContains(this._root,this._doc.activeElement),"focus"===type){if(!isFocused||this._isFocused)return this;this._isFocused=!0}else{if(isFocused||!this._isFocused)return this;this._isFocused=!1}if(handlers)for(event||(event={}),event.type!==type&&(event.type=type),handlers=handlers.slice(),l=handlers.length;l--;){obj=handlers[l];try{obj.handleEvent?obj.handleEvent(event):obj.call(this,event)}catch(error){error.details="Squire: fireEvent error. Event type: "+type,this.didError(error)}}return this},proto.destroy=function(){var type,l=instances.length,events=this._events;for(type in events)this.removeEventListener(type);for(this._mutation&&this._mutation.disconnect();l--;)instances[l]===this&&instances.splice(l,1);this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0},proto.handleEvent=function(event){this.fireEvent(event.type,event)},proto.addEventListener=function(type,fn){var handlers=this._events[type],target=this._root;return fn?(handlers||(handlers=this._events[type]=[],customEvents[type]||("selectionchange"===type&&(target=this._doc),target.addEventListener(type,this,!0))),handlers.push(fn),this):(this.didError({name:"Squire: addEventListener with null or undefined fn",message:"Event type: "+type}),this)},proto.removeEventListener=function(type,fn){var l,handlers=this._events[type],target=this._root;if(handlers){if(fn)for(l=handlers.length;l--;)handlers[l]===fn&&handlers.splice(l,1);else handlers.length=0;handlers.length||(delete this._events[type],customEvents[type]||("selectionchange"===type&&(target=this._doc),target.removeEventListener(type,this,!0)))}return this},proto._createRange=function(range,startOffset,endContainer,endOffset){if(range instanceof this._win.Range)return range.cloneRange();var domRange=this._doc.createRange();return domRange.setStart(range,startOffset),endContainer?domRange.setEnd(endContainer,endOffset):domRange.setEnd(range,startOffset),domRange},proto.getCursorPosition=function(range){if(!range&&!(range=this.getSelection())||!range.getBoundingClientRect)return null;var node,parent,rect=range.getBoundingClientRect();return rect&&!rect.top&&(this._ignoreChange=!0,node=this._doc.createElement("SPAN"),node.textContent=ZWS,insertNodeInRange(range,node),rect=node.getBoundingClientRect(),parent=node.parentNode,parent.removeChild(node),mergeInlines(parent,range)),rect},proto._moveCursorTo=function(toStart){var root=this._root,range=this._createRange(root,toStart?0:root.childNodes.length);return moveRangeBoundariesDownTree(range),this.setSelection(range),this},proto.moveCursorToStart=function(){return this._moveCursorTo(!0)},proto.moveCursorToEnd=function(){return this._moveCursorTo(!1)};var getWindowSelection=function(self){return self._win.getSelection()||null};proto.setSelection=function(range){if(range)if(this._lastSelection=range,this._isFocused)if(isAndroid&&!this._restoreSelection)enableRestoreSelection.call(this),this.blur(),this.focus();else{isIOS&&this._win.focus();var sel=getWindowSelection(this);sel&&(sel.removeAllRanges(),sel.addRange(range))}else enableRestoreSelection.call(this);return this},proto.getSelection=function(){var selection,startContainer,endContainer,sel=getWindowSelection(this),root=this._root;return sel&&sel.rangeCount&&(selection=sel.getRangeAt(0).cloneRange(),startContainer=selection.startContainer,endContainer=selection.endContainer,startContainer&&isLeaf(startContainer)&&selection.setStartBefore(startContainer),endContainer&&isLeaf(endContainer)&&selection.setEndBefore(endContainer)),selection&&isOrContains(root,selection.commonAncestorContainer)?this._lastSelection=selection:selection=this._lastSelection,selection||(selection=this._createRange(root.firstChild,0)),selection},proto.getSelectedText=function(){var value,range=this.getSelection(),walker=new TreeWalker(range.commonAncestorContainer,SHOW_TEXT|SHOW_ELEMENT,function(node){return isNodeContainedInRange(range,node,!0)}),startContainer=range.startContainer,endContainer=range.endContainer,node=walker.currentNode=startContainer,textContent="",addedTextInBlock=!1;for(walker.filter(node)||(node=walker.nextNode());node;)node.nodeType===TEXT_NODE?(value=node.data,value&&/\S/.test(value)&&(node===endContainer&&(value=value.slice(0,range.endOffset)),node===startContainer&&(value=value.slice(range.startOffset)),textContent+=value,addedTextInBlock=!0)):("BR"===node.nodeName||addedTextInBlock&&!isInline(node))&&(textContent+="\n",addedTextInBlock=!1),node=walker.nextNode();return textContent},proto.getPath=function(){return this._path};var removeZWS=function(root,keepNode){for(var parent,node,index,walker=new TreeWalker(root,SHOW_TEXT,function(){return!0},!1);node=walker.nextNode();)for(;(index=node.data.indexOf(ZWS))>-1&&(!keepNode||node.parentNode!==keepNode);){if(1===node.length){do parent=node.parentNode,parent.removeChild(node),node=parent,walker.currentNode=parent;while(isInline(node)&&!getLength(node));break}node.deleteData(index,1)}};proto._didAddZWS=function(){this._hasZWS=!0},proto._removeZWS=function(){this._hasZWS&&(removeZWS(this._root),this._hasZWS=!1)},proto._updatePath=function(range,force){var newPath,anchor=range.startContainer,focus=range.endContainer;(force||anchor!==this._lastAnchorNode||focus!==this._lastFocusNode)&&(this._lastAnchorNode=anchor,this._lastFocusNode=focus,newPath=anchor&&focus?anchor===focus?getPath(focus,this._root):"(selection)":"",this._path!==newPath&&(this._path=newPath,this.fireEvent("pathChange",{path:newPath}))),range.collapsed||this.fireEvent("select")},proto._updatePathOnEvent=function(){var self=this;self._willUpdatePath||(self._willUpdatePath=!0,setTimeout(function(){self._willUpdatePath=!1,self._updatePath(self.getSelection())},0))},proto.focus=function(){return this._root.focus(),isIE&&this.fireEvent("focus"),this},proto.blur=function(){return this._root.blur(),isIE&&this.fireEvent("blur"),this};var startSelectionId="squire-selection-start",endSelectionId="squire-selection-end";proto._saveRangeToBookmark=function(range){var temp,startNode=this.createElement("INPUT",{id:startSelectionId,type:"hidden"}),endNode=this.createElement("INPUT",{id:endSelectionId,type:"hidden"});insertNodeInRange(range,startNode),range.collapse(!1),insertNodeInRange(range,endNode),startNode.compareDocumentPosition(endNode)&DOCUMENT_POSITION_PRECEDING&&(startNode.id=endSelectionId,endNode.id=startSelectionId,temp=startNode,startNode=endNode,endNode=temp),range.setStartAfter(startNode),range.setEndBefore(endNode)},proto._getRangeAndRemoveBookmark=function(range){var root=this._root,start=root.querySelector("#"+startSelectionId),end=root.querySelector("#"+endSelectionId);if(start&&end){var startContainer=start.parentNode,endContainer=end.parentNode,startOffset=indexOf.call(startContainer.childNodes,start),endOffset=indexOf.call(endContainer.childNodes,end);startContainer===endContainer&&(endOffset-=1),detach(start),detach(end),range||(range=this._doc.createRange()),range.setStart(startContainer,startOffset),range.setEnd(endContainer,endOffset),mergeInlines(startContainer,range),startContainer!==endContainer&&mergeInlines(endContainer,range),range.collapsed&&(startContainer=range.startContainer,startContainer.nodeType===TEXT_NODE&&(endContainer=startContainer.childNodes[range.startOffset],endContainer&&endContainer.nodeType===TEXT_NODE||(endContainer=startContainer.childNodes[range.startOffset-1]),endContainer&&endContainer.nodeType===TEXT_NODE&&(range.setStart(endContainer,0),range.collapse(!0))))}return range||null},proto._keyUpDetectChange=function(event){var code=event.keyCode;event.ctrlKey||event.metaKey||event.altKey||!(16>code||code>20)||!(33>code||code>45)||this._docWasChanged()},proto._docWasChanged=function(){if(canWeakMap&&(nodeCategoryCache=new WeakMap),!this._ignoreAllChanges){if(canObserveMutations&&this._ignoreChange)return void(this._ignoreChange=!1);this._isInUndoState&&(this._isInUndoState=!1,this.fireEvent("undoStateChange",{canUndo:!0,canRedo:!1})),this.fireEvent("input")}},proto._recordUndoState=function(range){if(!this._isInUndoState){var html,undoIndex=this._undoIndex+=1,undoStack=this._undoStack,undoConfig=this._config.undo,undoThreshold=undoConfig.documentSizeThreshold,undoLimit=undoConfig.undoLimit;undoIndex<this._undoStackLength&&(undoStack.length=this._undoStackLength=undoIndex),range&&this._saveRangeToBookmark(range),html=this._getHTML(),undoThreshold>-1&&2*html.length>undoThreshold&&undoLimit>-1&&undoIndex>undoLimit&&(undoStack.splice(0,undoIndex-undoLimit),undoIndex=this._undoIndex=undoLimit,this._undoStackLength=undoLimit),undoStack[undoIndex]=html,this._undoStackLength+=1,this._isInUndoState=!0}},proto.saveUndoState=function(range){return range===undefined&&(range=this.getSelection()),this._isInUndoState||(this._recordUndoState(range),this._getRangeAndRemoveBookmark(range)),this},proto.undo=function(){if(0!==this._undoIndex||!this._isInUndoState){this._recordUndoState(this.getSelection()),this._undoIndex-=1,this._setHTML(this._undoStack[this._undoIndex]);var range=this._getRangeAndRemoveBookmark();range&&this.setSelection(range),this._isInUndoState=!0,this.fireEvent("undoStateChange",{canUndo:0!==this._undoIndex,canRedo:!0}),this.fireEvent("input")}return this},proto.redo=function(){var undoIndex=this._undoIndex,undoStackLength=this._undoStackLength;if(undoStackLength>undoIndex+1&&this._isInUndoState){this._undoIndex+=1,this._setHTML(this._undoStack[this._undoIndex]);var range=this._getRangeAndRemoveBookmark();range&&this.setSelection(range),this.fireEvent("undoStateChange",{canUndo:!0,canRedo:undoStackLength>undoIndex+2}),this.fireEvent("input")}return this},proto.hasFormat=function(tag,attributes,range){if(tag=tag.toUpperCase(),attributes||(attributes={}),!range&&!(range=this.getSelection()))return!1;!range.collapsed&&range.startContainer.nodeType===TEXT_NODE&&range.startOffset===range.startContainer.length&&range.startContainer.nextSibling&&range.setStartBefore(range.startContainer.nextSibling),!range.collapsed&&range.endContainer.nodeType===TEXT_NODE&&0===range.endOffset&&range.endContainer.previousSibling&&range.setEndAfter(range.endContainer.previousSibling);var walker,node,root=this._root,common=range.commonAncestorContainer;if(getNearest(common,root,tag,attributes))return!0;if(common.nodeType===TEXT_NODE)return!1;walker=new TreeWalker(common,SHOW_TEXT,function(node){return isNodeContainedInRange(range,node,!0)},!1);for(var seenNode=!1;node=walker.nextNode();){if(!getNearest(node,root,tag,attributes))return!1;seenNode=!0}return seenNode},proto.getFontInfo=function(range){var element,style,attr,fontInfo={color:undefined,backgroundColor:undefined,family:undefined,size:undefined},seenAttributes=0;if(!range&&!(range=this.getSelection()))return fontInfo;if(element=range.commonAncestorContainer,range.collapsed||element.nodeType===TEXT_NODE)for(element.nodeType===TEXT_NODE&&(element=element.parentNode);4>seenAttributes&&element;)(style=element.style)&&(!fontInfo.color&&(attr=style.color)&&(fontInfo.color=attr,seenAttributes+=1),!fontInfo.backgroundColor&&(attr=style.backgroundColor)&&(fontInfo.backgroundColor=attr,seenAttributes+=1),!fontInfo.family&&(attr=style.fontFamily)&&(fontInfo.family=attr,seenAttributes+=1),!fontInfo.size&&(attr=style.fontSize)&&(fontInfo.size=attr,seenAttributes+=1)),element=element.parentNode;return fontInfo},proto._addFormat=function(tag,attributes,range){var el,walker,startContainer,endContainer,startOffset,endOffset,node,needsFormat,block,root=this._root;if(range.collapsed){for(el=fixCursor(this.createElement(tag,attributes),root),insertNodeInRange(range,el),range.setStart(el.firstChild,el.firstChild.length),range.collapse(!0),block=el;isInline(block);)block=block.parentNode;removeZWS(block,el)}else{if(walker=new TreeWalker(range.commonAncestorContainer,SHOW_TEXT|SHOW_ELEMENT,function(node){return(node.nodeType===TEXT_NODE||"BR"===node.nodeName||"IMG"===node.nodeName)&&isNodeContainedInRange(range,node,!0)},!1),startContainer=range.startContainer,startOffset=range.startOffset,endContainer=range.endContainer,endOffset=range.endOffset,walker.currentNode=startContainer,walker.filter(startContainer)||(startContainer=walker.nextNode(),startOffset=0),!startContainer)return range;do node=walker.currentNode,needsFormat=!getNearest(node,root,tag,attributes),needsFormat&&(node===endContainer&&node.length>endOffset&&node.splitText(endOffset),node===startContainer&&startOffset&&(node=node.splitText(startOffset),endContainer===startContainer&&(endContainer=node,endOffset-=startOffset),startContainer=node,startOffset=0),el=this.createElement(tag,attributes),replaceWith(node,el),el.appendChild(node));while(walker.nextNode());endContainer.nodeType!==TEXT_NODE&&(node.nodeType===TEXT_NODE?(endContainer=node,endOffset=node.length):(endContainer=node.parentNode,endOffset=1)),range=this._createRange(startContainer,startOffset,endContainer,endOffset)}return range},proto._removeFormat=function(tag,attributes,range,partial){this._saveRangeToBookmark(range);var fixer,doc=this._doc;range.collapsed&&(cantFocusEmptyTextNodes?(fixer=doc.createTextNode(ZWS),this._didAddZWS()):fixer=doc.createTextNode(""),insertNodeInRange(range,fixer));for(var root=range.commonAncestorContainer;isInline(root);)root=root.parentNode;var startContainer=range.startContainer,startOffset=range.startOffset,endContainer=range.endContainer,endOffset=range.endOffset,toWrap=[],examineNode=function(node,exemplar){if(!isNodeContainedInRange(range,node,!1)){var child,next,isText=node.nodeType===TEXT_NODE;if(!isNodeContainedInRange(range,node,!0))return void("INPUT"===node.nodeName||isText&&!node.data||toWrap.push([exemplar,node]));if(isText)node===endContainer&&endOffset!==node.length&&toWrap.push([exemplar,node.splitText(endOffset)]),node===startContainer&&startOffset&&(node.splitText(startOffset),toWrap.push([exemplar,node]));else for(child=node.firstChild;child;child=next)next=child.nextSibling,examineNode(child,exemplar)}},formatTags=Array.prototype.filter.call(root.getElementsByTagName(tag),function(el){return isNodeContainedInRange(range,el,!0)&&hasTagAttributes(el,tag,attributes)});return partial||formatTags.forEach(function(node){examineNode(node,node)}),toWrap.forEach(function(item){var el=item[0].cloneNode(!1),node=item[1];replaceWith(node,el),el.appendChild(node)}),formatTags.forEach(function(el){replaceWith(el,empty(el))}),this._getRangeAndRemoveBookmark(range),fixer&&range.collapse(!1),mergeInlines(root,range),range},proto.changeFormat=function(add,remove,range,partial){return range||(range=this.getSelection())?(this.saveUndoState(range),remove&&(range=this._removeFormat(remove.tag.toUpperCase(),remove.attributes||{},range,partial)),add&&(range=this._addFormat(add.tag.toUpperCase(),add.attributes||{},range)),this.setSelection(range),this._updatePath(range,!0),canObserveMutations||this._docWasChanged(),this):this};var tagAfterSplit={DT:"DD",DD:"DT",LI:"LI"},splitBlock=function(self,block,node,offset){var splitTag=tagAfterSplit[block.nodeName],splitProperties=null,nodeAfterSplit=split(node,offset,block.parentNode,self._root),config=self._config;return splitTag||(splitTag=config.blockTag,splitProperties=config.blockAttributes),hasTagAttributes(nodeAfterSplit,splitTag,splitProperties)||(block=createElement(nodeAfterSplit.ownerDocument,splitTag,splitProperties),nodeAfterSplit.dir&&(block.dir=nodeAfterSplit.dir),replaceWith(nodeAfterSplit,block),block.appendChild(empty(nodeAfterSplit)),nodeAfterSplit=block),nodeAfterSplit};proto.forEachBlock=function(fn,mutates,range){if(!range&&!(range=this.getSelection()))return this;mutates&&this.saveUndoState(range);var root=this._root,start=getStartBlockOfRange(range,root),end=getEndBlockOfRange(range,root);if(start&&end)do if(fn(start)||start===end)break;while(start=getNextBlock(start,root));return mutates&&(this.setSelection(range),this._updatePath(range,!0),canObserveMutations||this._docWasChanged()),this},proto.modifyBlocks=function(modify,range){if(!range&&!(range=this.getSelection()))return this;this._isInUndoState?this._saveRangeToBookmark(range):this._recordUndoState(range);var frag,root=this._root;return expandRangeToBlockBoundaries(range,root),moveRangeBoundariesUpTree(range,root),frag=extractContentsOfRange(range,root,root),insertNodeInRange(range,modify.call(this,frag)),range.endOffset<range.endContainer.childNodes.length&&mergeContainers(range.endContainer.childNodes[range.endOffset],root),mergeContainers(range.startContainer.childNodes[range.startOffset],root),this._getRangeAndRemoveBookmark(range),this.setSelection(range),this._updatePath(range,!0),canObserveMutations||this._docWasChanged(),this};var increaseBlockQuoteLevel=function(frag){return this.createElement("BLOCKQUOTE",this._config.tagAttributes.blockquote,[frag])},decreaseBlockQuoteLevel=function(frag){var root=this._root,blockquotes=frag.querySelectorAll("blockquote");return Array.prototype.filter.call(blockquotes,function(el){return!getNearest(el.parentNode,root,"BLOCKQUOTE")}).forEach(function(el){replaceWith(el,empty(el))}),frag},removeBlockQuote=function(){return this.createDefaultBlock([this.createElement("INPUT",{id:startSelectionId,type:"hidden"}),this.createElement("INPUT",{id:endSelectionId,type:"hidden"})])},makeList=function(self,frag,type){for(var node,tag,prev,newLi,walker=getBlockWalker(frag,self._root),tagAttributes=self._config.tagAttributes,listAttrs=tagAttributes[type.toLowerCase()],listItemAttrs=tagAttributes.li;node=walker.nextNode();)"LI"===node.parentNode.nodeName&&(node=node.parentNode,walker.currentNode=node.lastChild),"LI"!==node.nodeName?(newLi=self.createElement("LI",listItemAttrs),node.dir&&(newLi.dir=node.dir),(prev=node.previousSibling)&&prev.nodeName===type?(prev.appendChild(newLi),detach(node)):replaceWith(node,self.createElement(type,listAttrs,[newLi])),newLi.appendChild("STYLE"===node.nodeName?node:empty(node)),walker.currentNode=newLi):(node=node.parentNode,tag=node.nodeName,tag!==type&&/^[OU]L$/.test(tag)&&replaceWith(node,self.createElement(type,listAttrs,[empty(node)])))},makeUnorderedList=function(frag){return makeList(this,frag,"UL"),frag},makeOrderedList=function(frag){return makeList(this,frag,"OL"),frag},removeList=function(frag){var i,l,list,listFrag,item,lists=frag.querySelectorAll("UL, OL"),items=frag.querySelectorAll("LI"),root=this._root;for(i=0,l=lists.length;l>i;i+=1)list=lists[i],listFrag=empty(list),fixContainer(listFrag,root),replaceWith(list,listFrag);for(i=0,l=items.length;l>i;i+=1)item=items[i],isBlock(item)?replaceWith(item,this.createDefaultBlock([empty(item)])):(fixContainer(item,root),replaceWith(item,empty(item)));return frag},increaseListLevel=function(frag){var i,l,item,type,newParent,listAttrs,items=frag.querySelectorAll("LI"),tagAttributes=this._config.tagAttributes;for(i=0,l=items.length;l>i;i+=1)item=items[i],isContainer(item.firstChild)||(type=item.parentNode.nodeName,newParent=item.previousSibling,newParent&&(newParent=newParent.lastChild)&&newParent.nodeName===type||(listAttrs=tagAttributes[type.toLowerCase()],newParent=this.createElement(type,listAttrs),replaceWith(item,newParent)),newParent.appendChild(item));return frag},decreaseListLevel=function(frag){var root=this._root,items=frag.querySelectorAll("LI");return Array.prototype.filter.call(items,function(el){return!isContainer(el.firstChild)}).forEach(function(item){var next,parent=item.parentNode,newParent=parent.parentNode,first=item.firstChild,node=first;if(item.previousSibling&&(parent=split(parent,item,newParent,root)),/^[OU]L$/.test(newParent.nodeName))newParent.insertBefore(item,parent),parent.firstChild||newParent.removeChild(parent);else for(;node&&(next=node.nextSibling,!isContainer(node));)newParent.insertBefore(node,parent),node=next;for("LI"===newParent.nodeName&&first.previousSibling&&split(newParent,first,newParent.parentNode,root);item!==frag&&!item.childNodes.length;)parent=item.parentNode,parent.removeChild(item),item=parent},this),fixContainer(frag,root),frag};proto._ensureBottomLine=function(){var root=this._root,last=root.lastElementChild;last&&last.nodeName===this._config.blockTag&&isBlock(last)||(last&&"BR"==last.nodeName&&root.removeChild(last),root.appendChild(this.createDefaultBlock()))},proto.setKeyHandler=function(key,fn){return this._keyHandlers[key]=fn,this},proto._getHTML=function(){return this._root.innerHTML},proto._setHTML=function(html){var root=this._root,node=root;node.innerHTML=html;do fixCursor(node,root);while(node=getNextBlock(node,root));this._ignoreChange=!0},proto.getHTML=function(withBookMark){var root,node,fixer,html,l,range,brs=[];if(withBookMark&&(range=this.getSelection())&&this._saveRangeToBookmark(range),useTextFixer)for(root=this._root,node=root;node=getNextBlock(node,root);)node.textContent||node.querySelector("BR")||(fixer=this.createElement("BR"),node.appendChild(fixer),brs.push(fixer));if(html=this._getHTML().replace(/\u200B/g,""),useTextFixer)for(l=brs.length;l--;)detach(brs[l]);return range&&this._getRangeAndRemoveBookmark(range),html},proto.setHTML=function(html,options){var child,div,frag,config=this._config,sanitizeToDOMFragment=config.isSetHTMLSanitized?config.sanitizeToDOMFragment:null,root=this._root;options=options||{};var editorInstance;if("function"==typeof sanitizeToDOMFragment)frag=sanitizeToDOMFragment(html,!1,this);else{div=this.createElement("DIV"),div.innerHTML=html;var i,imgTags=div.getElementsByTagName("img");for(i=0;i<imgTags.length;i++){var src=imgTags[i].src,Index=src.lastIndexOf("."),length=src.length,filetype=src.slice(Index+1,length);if("svg"===filetype.toLowerCase()){var svgImg=div.getElementsByTagName("img")[i];svgImg.parentNode.removeChild(svgImg)}}frag=this._doc.createDocumentFragment(),frag.appendChild(empty(div))}cleanTree(frag,!1,{editorRef:this._editorRef,handleWaitingImages:options.oldState}),cleanupBRs(frag,root),fixContainer(frag,root);for(var node=frag;node=getNextBlock(node,root);)fixCursor(node,root);for(this._ignoreChange=!0;child=root.lastChild;)root.removeChild(child);root.appendChild(frag),fixCursor(root,root),options.oldState&&(editorInstance=this._editorRef(),editorInstance.updateStateHTML(editorInstance.stack.stackPosition,root.innerHTML)),this._undoIndex=-1,this._undoStack.length=0,this._undoStackLength=0,this._isInUndoState=!1;var range=this._getRangeAndRemoveBookmark()||this._createRange(root.firstChild,0);return this.saveUndoState(range),this._lastSelection=range,enableRestoreSelection.call(this),this._updatePath(range,!0),this},proto.insertElement=function(el,range){if(range||(range=this.getSelection()),range.collapse(!0),isInline(el))insertNodeInRange(range,el),range.setStartAfter(el);else{for(var parent,nodeAfterSplit,root=this._root,splitNode=getStartBlockOfRange(range,root)||root;splitNode!==root&&!splitNode.nextSibling;)splitNode=splitNode.parentNode;splitNode!==root&&(parent=splitNode.parentNode,nodeAfterSplit=split(parent,splitNode.nextSibling,root,root)),nodeAfterSplit?root.insertBefore(el,nodeAfterSplit):(root.appendChild(el),nodeAfterSplit=this.createDefaultBlock(),root.appendChild(nodeAfterSplit)),range.setStart(nodeAfterSplit,0),range.setEnd(nodeAfterSplit,0),moveRangeBoundariesDownTree(range)}return this.focus(),this.setSelection(range),this._updatePath(range),canObserveMutations||this._docWasChanged(),this},proto.insertImage=function(src,attributes){var img=this.createElement("IMG",mergeObjects({src:src},attributes,!0));return this.insertElement(img),img};var linkRegExp=/\b((?:(?:ht|f)tps?:\/\/|www\d{0,3}[.])(?:[^\s()<>]+|\([^\s()<>]+\))+(?:\((?:[^\s()<>]+|(?:\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?]))|([\w\-.%+]+@(?:[\w\-]+\.)+[A-Z]{2,}\b)/i,addLinks=function(frag,root,self){for(var node,data,parent,match,index,endIndex,child,doc=frag.ownerDocument,walker=new TreeWalker(frag,SHOW_TEXT,function(node){return!getNearest(node,root,"A")},!1),defaultAttributes=self._config.tagAttributes.a;node=walker.nextNode();){data=node.data,parent=node.parentNode;for(var i=0;match=linkRegExp.exec(data);)index=match.index,endIndex=index+match[0].length,index&&(child=doc.createTextNode(data.slice(0,index)),parent.insertBefore(child,node)),child=self.createElement("A",mergeObjects({target:"_blank",href:match[1]?/^(?:ht|f)tps?:/.test(match[1])?match[1]:"http://"+match[1]:"mailto:"+match[2]},defaultAttributes,!1)),child.textContent=data.slice(index,endIndex),parent.insertBefore(child,node),node.data=data=data.slice(endIndex),0===i&&/^(?:ht|f)tps?:/.test(match[1])&&ZPFeeds.URLinfo.checkURLStatus(match[0],self._editorRef()),i++}},parseExcelContent=function(html,_doc){html=html.replace("border=0","border=1");var endFragmentIndex=html.lastIndexOf("<!--EndFragment-->");html=html.slice(0,endFragmentIndex);var limit,classNamesLength,i,j,k,styleText=/<style([.\s\S])*>([.\s\S])*<\/style>/i.exec(html)[0],bodyContent=html.slice(html.search("<body")),classRegx=/\.x([a-z][0-9]+)[\n]?(\s)*{([""#a-zA-Z0-9\n\s.:,;-]*)/g,styleContent=styleText?styleText.match(classRegx):[],styleContentLength=styleContent?styleContent.length:0,classNames=[],_style=[],fragment=_doc.createDocumentFragment(),_div=_doc.createElement("div");if(_div.innerHTML=bodyContent,fragment.appendChild(_div),styleContentLength){for(var m=0;styleContentLength>m;m++)limit=styleContent[m].search("{"),classNames[m]=styleContent[m].slice(0,limit).trim(),_style[m]=styleContent[m].slice(limit+1,styleContent[m].length);classNamesLength=classNames.length;var regs=/([""\.a-zA-Z0-9-\n\s#:,])*/g;for(i=0;classNamesLength>i;i++){var propName,propArr,propArrLength,p,styleMapObj={},_tr=_div.firstElementChild.querySelectorAll(classNames[i]),_trLength=_tr.length,inline=_style[i].match(regs),_inlineLength=inline.length;for(k=0;_inlineLength>k;k++)inline[k]=inline[k].trim(),inline[k].length>0&&(propName=inline[k].slice(0,inline[k].search(":")),styleMapObj[propName]=inline[k].slice(inline[k].search(":")+1,inline[k].length));for(propArr=Object.keys(styleMapObj),propArrLength=propArr.length,j=0;_trLength>j;j++)for(p=0;propArrLength>p;p++)_tr[j].style[propArr[p]]=styleMapObj[propArr[p]]}}return _div.innerHTML};proto.insertHTML=function(html,isPaste,opts){var config=this._config,editorRef=this._editorRef();if(opts=opts||{},"function"==typeof editorRef.initobj.parseUrls){var urls=editorRef.parseURL(html);editorRef.initobj.parseUrls(urls)}var startFragmentIndex,endFragmentIndex,div,frag,root,node,event,isExcelContent,sanitizeToDOMFragment=config.isInsertedHTMLSanitized&&!opts.avoidSanitize?config.sanitizeToDOMFragment:null,range=this.getSelection(),doc=this._doc;if("function"==typeof sanitizeToDOMFragment)frag=sanitizeToDOMFragment(html,isPaste,this);else{isPaste&&(isExcelContent=html.search(/<meta .* content=Excel\.Sheet>/g),isExcelContent>0?html=parseExcelContent(html,doc):(startFragmentIndex=html.indexOf("<!--StartFragment-->"),endFragmentIndex=html.lastIndexOf("<!--EndFragment-->"),startFragmentIndex>-1&&endFragmentIndex>-1&&(html=html.slice(startFragmentIndex+20,endFragmentIndex)))),div=this.createElement("DIV"),html=DOMPurify.sanitize(html,{ADD_TAGS:editorRef.initobj.allowTagsInsertHTML||[],ADD_ATTR:editorRef.initobj.allowAttrsInsertHTML||[]}),div.innerHTML=html;var i,imgTags=div.getElementsByTagName("img");for(i=0;i<imgTags.length;i++){var src=imgTags[i].src,Index=src.lastIndexOf("."),length=src.length,filetype=src.slice(Index+1,length);if("svg"===filetype.toLowerCase()){var svgImg=div.getElementsByTagName("img")[i];svgImg.parentNode.removeChild(svgImg)}}frag=doc.createDocumentFragment(),frag.appendChild(empty(div))}if(isPaste&&this._editorRef().initobj.handlePasteImages&&"IMG"===frag.firstChild.nodeName){if("data:"===frag.firstChild.src.substr(0,5))return this._editorRef()._uploadInlineImages({dataURI:frag.firstChild.src}),void this.focus();if("webkit-fake"===frag.firstChild.src.substr(0,11))return void this.focus()}this.saveUndoState(range);try{for(root=this._root,node=frag,event={fragment:frag,preventDefault:function(){this.defaultPrevented=!0},defaultPrevented:!1},addLinks(frag,frag,this),cleanTree(frag,"",this),cleanupBRs(frag,null),removeEmptyInlines(frag),frag.normalize();node=getNextBlock(node,frag);)fixCursor(node,null);isPaste&&this.fireEvent("willPaste",event),event.defaultPrevented||(insertTreeFragmentIntoRange(range,event.fragment,root),canObserveMutations||this._docWasChanged(),range.collapse(!1),this._ensureBottomLine()),this.setSelection(range),this._updatePath(range,!0),isPaste&&this.focus()}catch(error){this.didError(error)}return this};var escapeHTMLFragement=function(text){return text.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;")};proto.insertPlainText=function(plainText,isPaste){var attr,i,l,line,lines=plainText.split("\n"),config=this._config,tag=config.blockTag,attributes=config.blockAttributes,closeBlock="</"+tag+">",openBlock="<"+tag;for(attr in attributes)openBlock+=" "+attr+'="'+escapeHTMLFragement(attributes[attr])+'"';for(openBlock+=">",i=0,l=lines.length;l>i;i+=1)line=lines[i],line=escapeHTMLFragement(line).replace(/ (?= )/g,"&nbsp;"),i&&l>i+1&&(line=openBlock+(line||"<BR>")+closeBlock),lines[i]=line;return this.insertHTML(lines.join(""),isPaste)};var command=function(method,arg,arg2){return function(){return this[method](arg,arg2),this.focus()}};proto.addStyles=function(styles){if(styles){var head=this._doc.documentElement.firstChild,style=this.createElement("STYLE",{type:"text/css"});style.appendChild(this._doc.createTextNode(styles)),head.appendChild(style)}return this},proto.bold=command("changeFormat",{tag:"B"}),proto.italic=command("changeFormat",{tag:"I"}),proto.underline=command("changeFormat",{tag:"U"}),proto.strikethrough=command("changeFormat",{tag:"S"}),proto.subscript=command("changeFormat",{tag:"SUB"},{tag:"SUP"}),proto.superscript=command("changeFormat",{tag:"SUP"},{tag:"SUB"}),proto.removeBold=command("changeFormat",null,{tag:"B"}),proto.removeItalic=command("changeFormat",null,{tag:"I"}),proto.removeUnderline=command("changeFormat",null,{tag:"U"}),proto.removeStrikethrough=command("changeFormat",null,{tag:"S"}),proto.removeSubscript=command("changeFormat",null,{tag:"SUB"}),proto.removeSuperscript=command("changeFormat",null,{tag:"SUP"}),proto.makeLink=function(url,attributes){var range=this.getSelection();if(range.collapsed){var protocolEnd=url.indexOf(":")+1;if(protocolEnd)for(;"/"===url[protocolEnd];)protocolEnd+=1;insertNodeInRange(range,this._doc.createTextNode(url.slice(protocolEnd)))}return attributes=mergeObjects(mergeObjects({href:url},attributes,!0),this._config.tagAttributes.a,!1),this.changeFormat({tag:"A",attributes:attributes},{tag:"A"},range),this.focus()},proto.removeLink=function(){return this.changeFormat(null,{tag:"A"},this.getSelection(),!0),this.focus()},proto.setFontFace=function(name){return this.changeFormat(name?{tag:"SPAN",attributes:{"class":"font",style:"font-family: "+name+", sans-serif;"}}:null,{tag:"SPAN",attributes:{"class":"font"}}),this.focus()},proto.setFontSize=function(size){return this.changeFormat(size?{tag:"SPAN",attributes:{"class":"size",style:"font-size: "+("number"==typeof size?size+"px":size)}}:null,{tag:"SPAN",attributes:{"class":"size"}}),this.focus()},proto.setTextColour=function(colour){return this.changeFormat(colour?{tag:"SPAN",attributes:{"class":"colour",style:"color:"+colour}}:null,{tag:"SPAN",attributes:{"class":"colour"}}),this.focus()},proto.setHighlightColour=function(colour){return this.changeFormat(colour?{tag:"SPAN",attributes:{"class":"highlight",style:"background-color:"+colour}}:colour,{tag:"SPAN",attributes:{"class":"highlight"}}),this.focus()},proto.setTextAlignment=function(alignment){return this.forEachBlock(function(block){block.className=(block.className.split(/\s+/).filter(function(klass){return!/align/.test(klass)}).join(" ")+" align-"+alignment).trim(),block.style.textAlign=alignment},!0),this.focus()},proto.setTextDirection=function(direction){return this.forEachBlock(function(block){block.dir=direction},!0),this.focus()},proto.setLineHeight=function(lineheight){return this.forEachBlock(function(block){block.style.lineHeight=lineheight},!0),this.focus()},proto.removeAllFormatting=function(range){if(!range&&!(range=this.getSelection())||range.collapsed)return this;for(var root=this._root,stopNode=range.commonAncestorContainer;stopNode&&!isBlock(stopNode);)stopNode=stopNode.parentNode;if(stopNode||(expandRangeToBlockBoundaries(range,root),stopNode=root),stopNode.nodeType===TEXT_NODE)return this;this.saveUndoState(range),moveRangeBoundariesUpTree(range,stopNode);for(var nextNode,childNodes,doc=stopNode.ownerDocument,startContainer=range.startContainer,startOffset=range.startOffset,endContainer=range.endContainer,endOffset=range.endOffset,formattedNodes=doc.createDocumentFragment(),cleanNodes=doc.createDocumentFragment(),nodeAfterSplit=split(endContainer,endOffset,stopNode,root),nodeInSplit=split(startContainer,startOffset,stopNode,root);nodeInSplit!==nodeAfterSplit;)nextNode=nodeInSplit.nextSibling,formattedNodes.appendChild(nodeInSplit),nodeInSplit=nextNode;return removeFormatting(this,formattedNodes,cleanNodes),cleanNodes.normalize(),nodeInSplit=cleanNodes.firstChild,nextNode=cleanNodes.lastChild,childNodes=stopNode.childNodes,nodeInSplit?(stopNode.insertBefore(cleanNodes,nodeAfterSplit),startOffset=indexOf.call(childNodes,nodeInSplit),endOffset=indexOf.call(childNodes,nextNode)+1):(startOffset=indexOf.call(childNodes,nodeAfterSplit),endOffset=startOffset),range.setStart(stopNode,startOffset),range.setEnd(stopNode,endOffset),mergeInlines(stopNode,range),moveRangeBoundariesDownTree(range),this.setSelection(range),this._updatePath(range,!0),this.focus()},proto.increaseQuoteLevel=command("modifyBlocks",increaseBlockQuoteLevel),proto.decreaseQuoteLevel=command("modifyBlocks",decreaseBlockQuoteLevel),proto.makeUnorderedList=command("modifyBlocks",makeUnorderedList),proto.makeOrderedList=command("modifyBlocks",makeOrderedList),proto.removeList=command("modifyBlocks",removeList),proto.increaseListLevel=command("modifyBlocks",increaseListLevel),proto.decreaseListLevel=command("modifyBlocks",decreaseListLevel),top!==win&&"true"===doc.documentElement.getAttribute("data-squireinit")&&(win.editor=new Squire(doc),win.onEditorLoad&&(win.onEditorLoad(win.editor),win.onEditorLoad=null)),win.Squire=Squire}(document);!function(factory){"use strict";var root="undefined"==typeof window?null:window;root.DOMPurify=factory(root)}(function factory(window){"use strict";var DOMPurify=function(window){return factory(window)};if(DOMPurify.version="0.7.4",!window||!window.document||9!==window.document.nodeType)return DOMPurify.isSupported=!1,DOMPurify;var document=window.document,originalDocument=document,DocumentFragment=window.DocumentFragment,HTMLTemplateElement=window.HTMLTemplateElement,NodeFilter=window.NodeFilter,NamedNodeMap=window.NamedNodeMap||window.MozNamedAttrMap,Text=window.Text,Comment=window.Comment,DOMParser=window.DOMParser;"function"==typeof HTMLTemplateElement&&(document=document.createElement("template").content.ownerDocument);var implementation=document.implementation,createNodeIterator=document.createNodeIterator,getElementsByTagName=document.getElementsByTagName,createDocumentFragment=document.createDocumentFragment,importNode=originalDocument.importNode,hooks={};DOMPurify.isSupported="undefined"!=typeof implementation.createHTMLDocument&&9!==document.documentMode;var _addToSet=function(set,array){for(var l=array.length;l--;)set[array[l]]=!0;return set},_cloneObj=function(object){var property,newObject={};for(property in object)object.hasOwnProperty(property)&&(newObject[property]=object[property]);return newObject},ALLOWED_TAGS=null,DEFAULT_ALLOWED_TAGS=_addToSet({},["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr","iframe","svg","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","switch","symbol","text","textpath","title","tref","tspan","view","vkern","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","feSpecularLighting","feTile","feTurbulence","math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmuliscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mpspace","msqrt","mystyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","#text"]),ALLOWED_ATTR=null,DEFAULT_ALLOWED_ATTR=_addToSet({},["accept","action","align","alt","autocomplete","background","bgcolor","border","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","coords","datetime","default","dir","disabled","download","enctype","face","for","headers","height","hidden","high","href","hreflang","id","ismap","label","lang","list","loop","low","max","maxlength","media","method","min","multiple","name","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","rows","rowspan","spellcheck","scope","selected","shape","size","span","srclang","start","src","step","style","summary","tabindex","title","type","usemap","valign","value","width","xmlns","target","accent-height","accumulate","additivive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mode","min","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","surfacescale","targetx","targety","transform","text-anchor","text-decoration","text-rendering","textlength","u1","u2","unicode","values","viewbox","visibility","vert-adv-y","vert-origin-x","vert-origin-y","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","y","y1","y2","z","zoomandpan","accent","accentunder","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","display","displaystyle","fence","frame","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink","contentid","embedurlid","controls","filetype","contenteditable","embedvideo","mode","accesskey"]),FORBID_TAGS=null,FORBID_ATTR=null,ALLOW_DATA_ATTR=!0,SAFE_FOR_JQUERY=!1,SAFE_FOR_TEMPLATES=!1,MUSTACHE_EXPR=/\{\{[\s\S]*|[\s\S]*\}\}/gm,ERB_EXPR=/<%[\s\S]*|[\s\S]*%>/gm,WHOLE_DOCUMENT=!1,RETURN_DOM=!1,RETURN_DOM_FRAGMENT=!1,RETURN_DOM_IMPORT=!1,SANITIZE_DOM=!0,KEEP_CONTENT=!0,FORBID_CONTENTS=_addToSet({},["audio","head","math","script","svg","video"]),DATA_URI_TAGS=_addToSet({},["audio","video","img","source"]),URI_SAFE_ATTRIBUTES=_addToSet({},["alt","class","for","id","label","name","style","pattern","placeholder","summary","title","value","xmlns"]),CONFIG=null,formElement=document.createElement("form"),_parseConfig=function(cfg){"object"!=typeof cfg&&(cfg={}),ALLOWED_TAGS="ALLOWED_TAGS"in cfg?_addToSet({},cfg.ALLOWED_TAGS):DEFAULT_ALLOWED_TAGS,ALLOWED_ATTR="ALLOWED_ATTR"in cfg?_addToSet({},cfg.ALLOWED_ATTR):DEFAULT_ALLOWED_ATTR,FORBID_TAGS="FORBID_TAGS"in cfg?_addToSet({},cfg.FORBID_TAGS):{},FORBID_ATTR="FORBID_ATTR"in cfg?_addToSet({},cfg.FORBID_ATTR):{},ALLOW_DATA_ATTR=cfg.ALLOW_DATA_ATTR!==!1,SAFE_FOR_JQUERY=cfg.SAFE_FOR_JQUERY||!1,SAFE_FOR_TEMPLATES=cfg.SAFE_FOR_TEMPLATES||!1,WHOLE_DOCUMENT=cfg.WHOLE_DOCUMENT||!1,RETURN_DOM=cfg.RETURN_DOM||!1,RETURN_DOM_FRAGMENT=cfg.RETURN_DOM_FRAGMENT||!1,RETURN_DOM_IMPORT=cfg.RETURN_DOM_IMPORT||!1,SANITIZE_DOM=cfg.SANITIZE_DOM!==!1,KEEP_CONTENT=cfg.KEEP_CONTENT!==!1,SAFE_FOR_TEMPLATES&&(ALLOW_DATA_ATTR=!1),RETURN_DOM_FRAGMENT&&(RETURN_DOM=!0),cfg.ADD_TAGS&&(ALLOWED_TAGS===DEFAULT_ALLOWED_TAGS&&(ALLOWED_TAGS=_cloneObj(ALLOWED_TAGS)),_addToSet(ALLOWED_TAGS,cfg.ADD_TAGS)),cfg.ADD_ATTR&&(ALLOWED_ATTR===DEFAULT_ALLOWED_ATTR&&(ALLOWED_ATTR=_cloneObj(ALLOWED_ATTR)),_addToSet(ALLOWED_ATTR,cfg.ADD_ATTR)),KEEP_CONTENT&&(ALLOWED_TAGS["#text"]=!0),Object&&"freeze"in Object&&Object.freeze(cfg),CONFIG=cfg},_forceRemove=function(node){try{node.parentNode.removeChild(node)}catch(e){node.outerHTML=""}},_initDocument=function(dirty){var doc,body;try{if(doc=(new DOMParser).parseFromString(dirty,"text/html"),doc.getElementsByTagName("style")[0]){var sanitizeNode=doc.getElementsByTagName("style")[0].innerText;sanitizeNode=sanitizeNode.replace(/>/g,"&gt"),sanitizeNode=sanitizeNode.replace(/</g,"&lt"),doc.getElementsByTagName("style")[0].innerHTML=sanitizeNode,doc.getElementsByTagName("body")[0].appendChild(doc.getElementsByTagName("style")[0])}var i,imgTags=doc.body.getElementsByTagName("img");for(i=0;i<imgTags.length;i++){var src=imgTags[i].src,Index=src.lastIndexOf("."),length=src.length,filetype=src.slice(Index+1,length);if("svg"===filetype.toLowerCase()){var svgImg=doc.body.getElementsByTagName("img")[i];svgImg.parentNode.removeChild(svgImg)}}}catch(e){}return doc||(doc=implementation.createHTMLDocument(""),body=doc.body,body.parentNode.removeChild(body.parentNode.firstElementChild),body.outerHTML=dirty),"function"==typeof doc.getElementsByTagName?doc.getElementsByTagName(WHOLE_DOCUMENT?"html":"body")[0]:getElementsByTagName.call(doc,WHOLE_DOCUMENT?"html":"body")[0]},_createIterator=function(root){return createNodeIterator.call(root.ownerDocument||root,root,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_TEXT,function(){return NodeFilter.FILTER_ACCEPT},!1)},_isClobbered=function(elm){return elm instanceof Text||elm instanceof Comment?!1:"string"==typeof elm.nodeName&&"string"==typeof elm.textContent&&"function"==typeof elm.removeChild&&elm.attributes instanceof NamedNodeMap&&"function"==typeof elm.removeAttribute&&"function"==typeof elm.setAttribute?!1:!0},_sanitizeElements=function(currentNode){var tagName,content;if(_executeHook("beforeSanitizeElements",currentNode,null),_isClobbered(currentNode))return _forceRemove(currentNode),!0;if(tagName=currentNode.nodeName.toLowerCase(),_executeHook("uponSanitizeElement",currentNode,{tagName:tagName}),!ALLOWED_TAGS[tagName]||FORBID_TAGS[tagName]){if(KEEP_CONTENT&&!FORBID_CONTENTS[tagName]&&"function"==typeof currentNode.insertAdjacentHTML)try{currentNode.insertAdjacentHTML("AfterEnd",currentNode.innerHTML)}catch(e){}return _forceRemove(currentNode),!0}return!SAFE_FOR_JQUERY||currentNode.firstElementChild||currentNode.content&&currentNode.content.firstElementChild||(currentNode.innerHTML=currentNode.textContent.replace(/</g,"&lt;")),SAFE_FOR_TEMPLATES&&3===currentNode.nodeType&&(content=currentNode.textContent,content=content.replace(MUSTACHE_EXPR," "),content=content.replace(ERB_EXPR," "),currentNode.textContent=content),_executeHook("afterSanitizeElements",currentNode,null),!1},DATA_ATTR=/^data-[\w.\u00B7-\uFFFF-]/,IS_ALLOWED_URI=/^(?:(?:(?:f|ht)tps?|mailto|tel):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,ATTR_WHITESPACE=/[\x00-\x20\xA0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,_sanitizeAttributes=function(currentNode){var attr,name,value,lcName,idAttr,attributes,hookEvent,l;if(_executeHook("beforeSanitizeAttributes",currentNode,null),attributes=currentNode.attributes){for(hookEvent={attrName:"",attrValue:"",keepAttr:!0},l=attributes.length;l--;)if(attr=attributes[l],name=attr.name,value=attr.value,lcName=name.toLowerCase(),hookEvent.attrName=lcName,hookEvent.attrValue=value,hookEvent.keepAttr=!0,_executeHook("uponSanitizeAttribute",currentNode,hookEvent),value=hookEvent.attrValue,"name"===lcName&&"IMG"===currentNode.nodeName&&attributes.id?(idAttr=attributes.id,attributes=Array.prototype.slice.apply(attributes),currentNode.removeAttribute("id"),currentNode.removeAttribute(name),attributes.indexOf(idAttr)>l&&currentNode.setAttribute("id",idAttr.value)):("id"===name&&currentNode.setAttribute(name,""),currentNode.removeAttribute(name)),hookEvent.keepAttr&&(!SANITIZE_DOM||"id"!==lcName&&"name"!==lcName||!(value in window||value in document||value in formElement))&&(SAFE_FOR_TEMPLATES&&(value=value.replace(MUSTACHE_EXPR," "),value=value.replace(ERB_EXPR," ")),ALLOWED_ATTR[lcName]&&!FORBID_ATTR[lcName]&&(URI_SAFE_ATTRIBUTES[lcName]||IS_ALLOWED_URI.test(value.replace(ATTR_WHITESPACE,""))||"src"===lcName&&0===value.indexOf("data:")&&DATA_URI_TAGS[currentNode.nodeName.toLowerCase()])||ALLOW_DATA_ATTR&&DATA_ATTR.test(lcName)))try{currentNode.setAttribute(name,value)}catch(e){}_executeHook("afterSanitizeAttributes",currentNode,null)}},_sanitizeShadowDOM=function(fragment){var shadowNode,shadowIterator=_createIterator(fragment);for(_executeHook("beforeSanitizeShadowDOM",fragment,null);shadowNode=shadowIterator.nextNode();)_executeHook("uponSanitizeShadowNode",shadowNode,null),_sanitizeElements(shadowNode)||(shadowNode.content instanceof DocumentFragment&&_sanitizeShadowDOM(shadowNode.content),_sanitizeAttributes(shadowNode));_executeHook("afterSanitizeShadowDOM",fragment,null)},_executeHook=function(entryPoint,currentNode,data){hooks[entryPoint]&&hooks[entryPoint].forEach(function(hook){hook.call(DOMPurify,currentNode,data,CONFIG)})};return DOMPurify.sanitize=function(dirty,cfg){var body,currentNode,oldNode,nodeIterator,returnNode;if(dirty||(dirty=""),"string"!=typeof dirty){if("function"!=typeof dirty.toString)throw new TypeError("toString is not a function");dirty=dirty.toString()}if(!DOMPurify.isSupported)return"object"==typeof window.toStaticHTML||"function"==typeof window.toStaticHTML?window.toStaticHTML(dirty):dirty;if(_parseConfig(cfg),!RETURN_DOM&&!WHOLE_DOCUMENT&&-1===dirty.indexOf("<"))return dirty;if(body=_initDocument(dirty),!body)return RETURN_DOM?null:"";for(nodeIterator=_createIterator(body);currentNode=nodeIterator.nextNode();)(3!==currentNode.nodeType||currentNode!==oldNode)&&(_sanitizeElements(currentNode)||(currentNode.content instanceof DocumentFragment&&_sanitizeShadowDOM(currentNode.content),_sanitizeAttributes(currentNode),oldNode=currentNode));if(RETURN_DOM){if(RETURN_DOM_FRAGMENT)for(returnNode=createDocumentFragment.call(body.ownerDocument);body.firstChild;)returnNode.appendChild(body.firstChild);else returnNode=body;return RETURN_DOM_IMPORT&&(returnNode=importNode.call(originalDocument,returnNode,!0)),returnNode}return WHOLE_DOCUMENT?body.outerHTML:body.innerHTML},DOMPurify.addHook=function(entryPoint,hookFunction){"function"==typeof hookFunction&&(hooks[entryPoint]=hooks[entryPoint]||[],hooks[entryPoint].push(hookFunction))},DOMPurify.removeHook=function(entryPoint){hooks[entryPoint]&&hooks[entryPoint].pop()},DOMPurify.removeHooks=function(entryPoint){hooks[entryPoint]&&(hooks[entryPoint]=[])},DOMPurify.removeAllHooks=function(){hooks=[]},DOMPurify});ZE.prototype.mentionsHandler=function(){"use strict";var setContent,handleNavigationAndCommandKeys,hideContextMenu,mouseDown,constructAndShow,setPositions,editor=this,_document=document,_body=_document.body;$(editor.doc).on("keydown",function(ev){var keyCode=ev.keyCode;38===keyCode||40===keyCode?$("#ze_autofill").length&&ev.preventDefault():13===keyCode&&$("#ze_autofill li.sel").length&&(ev.preventDefault(),ev.stopPropagation(),ev.stopImmediatePropagation())}),setContent=function(data,curElem,pos){if(pos>-1&&$(curElem).length){var tempPos=pos,_selection=editor.win.getSelection(),_range=_selection.getRangeAt(0);_range.setStart(curElem,tempPos),_selection.removeAllRanges(),_selection.addRange(_range),editor.insertHTML(void 0!==data.photo?'<a class="ze_mention" href="zp[peopleuser:'+data.zuid+']zp" name="mentions">'+data.name+"</a>&nbsp;":'<a class="ze_mention" href="zp[department:'+data.id+']zp" name="mentions">'+data.name+"</a>&nbsp;"),editor.initobj.triggerOnMention&&editor.initobj.triggerOnMention(data)}hideContextMenu()},handleNavigationAndCommandKeys=function(ev,curElem,pos){var $curSelectedElem,dataToSet,keyCode=ev.keyCode;return 40===keyCode?($curSelectedElem=$("#ze_autofill li.sel"),$curSelectedElem.removeClass("sel"),$curSelectedElem.next().length?$curSelectedElem.next().addClass("sel"):$("#ze_autofill li").first().addClass("sel"),!0):38===keyCode?($curSelectedElem=$("#ze_autofill li.sel"),$curSelectedElem.removeClass("sel"),$curSelectedElem.prev().length?$curSelectedElem.prev().addClass("sel"):$("#ze_autofill li").last().addClass("sel"),!0):13===keyCode?($("#ze_autofill").length&&$("#ze_autofill").is(":visible")&&(ev.preventDefault(),ev.stopPropagation(),ev.stopImmediatePropagation(),$curSelectedElem=$("#ze_autofill li.sel"),dataToSet=$curSelectedElem.data("mention"),ZE.mentionsetContent(dataToSet,curElem,pos)),!0):void 0};var handleAutoFill=function(ev){var contents,res,currText,textContent,pos,handleKeys,_selection=editor.win.getSelection(),_anchorNode=_selection.anchorNode,range=_selection.getRangeAt(0),newRange=range.cloneRange();if(newRange.setStart(_anchorNode,0),contents=newRange.cloneContents(),textContent=contents.textContent,pos=textContent.lastIndexOf("@"),handleKeys=handleNavigationAndCommandKeys(ev,_anchorNode,pos),!handleKeys)if(0===pos||pos>0&&(" "===textContent.charAt(pos-1)||160===textContent.charCodeAt(pos-1)||32===textContent.charCodeAt(pos))){if("true"===ZPeople.isSearchAllowed&&(currText=textContent.substr(pos+1),res=currText&&editor.initobj.getAutofillElements&&editor.initobj.getAutofillElements(currText,void 0)||{}),void 0!==res&&res.result&&res.result.length)constructAndShow(res.result,_anchorNode,pos);else if(""!=currText&&"true"===ZPeople.isSearchAllowed)if(ZPFeeds.SEARCH_KEY=currText,ZPFeeds.ISPROCESS_FINISH===!0){ZPFeeds.ISPROCESS_FINISH=!1;var currSrchType="emp";void 0!==editor.initobj.searchEntity&&editor.initobj.searchEntity.length>0&&(currSrchType=editor.initobj.searchEntity[0]),ZPFeeds.Editor.Last_SearchType=currSrchType,editor.initobj.currText=ZPFeeds.SEARCH_KEY,editor.initobj.searchType=currSrchType,ZE.mentionedjson={currText:ZPFeeds.SEARCH_KEY,type:0,limit:10,respfun:ZE.getUserListResponse,searchType:currSrchType,searchMode:"FEEDS",anchorNode:_anchorNode,pos:pos,editor:editor,extraParamCallback:editor.initobj.extraParamCallback,initObj:editor.initobj},res=currText&&editor.initobj.handleAutoFill&&ZPComponents.Search.get(ZPFeeds.SEARCH_KEY,ZE.mentionedjson)||{}}else $("#ze_autofill").remove()}else $("#ze_autofill").remove()};$(editor.doc).on("keyup",handleAutoFill),hideContextMenu=function(){var zeAutofillDiv=_document.getElementById("ze_autofill"),_doc=editor.doc;zeAutofillDiv&&(_body.removeChild(zeAutofillDiv),ZE._removeEvent(_document,"mousedown",mouseDown),ZE._removeEvent(_doc,"mousedown",mouseDown))},mouseDown=function(ev){var _target,zeAutofillDiv=_document.getElementById("ze_autofill");if(ev)for(_target=ev.target;null!==_target&&_target!==zeAutofillDiv;_target=_target.parentNode);_target||hideContextMenu()},setPositions=function(elem,anchorNode,pos){{var value2,posy,posx,value1=editor.iframe.getBoundingClientRect(),style=elem.style;ZE.getPos(editor.editordiv)}if(editor.doc.createRange&&3===anchorNode.nodeType){var range=editor.doc.createRange();range.setStart(anchorNode,pos),range.setEnd(anchorNode,pos+1),range.getBoundingClientRect&&(value2=range.getBoundingClientRect())}value2||(value2=anchorNode.parentNode.getBoundingClientRect()),posy=value1.top+value2.top+value2.height,posx=value1.left+value2.left,style.top=parseInt(posy)+"px",style.left=parseInt(posx)+"px"},constructAndShow=function(result,elem,pos){var i,liArea,imgdivArea,divArea,h4Area,imgArea,ulArea=_document.createElement("ul");for($("#ze_autofill").length&&$("#ze_autofill").remove(),ulArea.id="ze_autofill",ulArea.className="zp-at-dropdown",i=0;i<result.length;i++){if(liArea=_document.createElement("li"),imgdivArea=_document.createElement("div"),imgdivArea.className="zp-ddicon",void 0!==result[i].photo){if(imgArea=_document.createElement("img"),imgArea.className="zp-usimg",imgArea.src=result[i].photo,void 0!==result[i].id){var att=document.createAttribute("userid");att.value=result[i].id,imgArea.setAttributeNode(att)}}else imgArea=_document.createElement("div"),imgArea.className="zp-dpname",imgArea.innerHTML=ZPeople.getShortName(result[i].name);imgdivArea.appendChild(imgArea),liArea.appendChild(imgdivArea),divArea=_document.createElement("div"),divArea.className="zp-ddcont",h4Area=_document.createElement("h4"),h4Area.className="zp-dduname",h4Area.appendChild(_document.createTextNode(ZPeople.decodeTxt(result[i].name))),divArea.appendChild(h4Area),liArea.appendChild(divArea),$(liArea).data("mention",result[i]),ulArea.appendChild(liArea)}editor.outerdiv.after(ulArea),ZE._addEvent(ulArea,"click",function(ev){var mentionData,curElem=elem,tempPos=pos,$targetElem=ev.target||ev.srcTarget;$targetElem=$($targetElem).closest("li"),$targetElem.length&&(mentionData=$($targetElem).data("mention"),setContent(mentionData,curElem,tempPos),hideContextMenu())}),ZE._addEvent(_document,"mousedown",mouseDown),ZE._addEvent(editor.doc,"mousedown",mouseDown)}};ZE.create=function(initobj){return new ZE(initobj)},ZE.prototype.execCommand=function(ev,command){var elem,editor=this,hideAlterToolbar=!1;switch(editor._stopEvent(ev),ZPFeeds.Editor.addRemovePlaceholder(editor,!1),command){case"forecolor":case"backcolor":case"fontfamily":case"fontsize":editor.showDropDown(ev,command);break;case"alignoptions":editor.showDropDown(ev,command,"align");break;case"listoptions":editor.showDropDown(ev,command,"list");break;case"directionoptions":editor.showDropDown(ev,command,"textDir");break;case"indentoptions":editor.showDropDown(ev,command,"indent");break;case"otheroptions":editor.showDropDown(ev,command,"others");break;case"heading":editor.createHeadingDiv(ev);break;case"smiley":editor.showDropDown(ev,command);break;case"link":editor.createLink(),ZE_Init.needEditorStats&&editor.updateCount(command),hideAlterToolbar=!0;break;case"tableGrid":editor._createTableGrid(ev,command),ZE_Init.needEditorStats&&editor.updateCount(command);break;case"image":editor.createImage(),ZE_Init.needEditorStats&&editor.updateCount(command),hideAlterToolbar=!0;break;case"video":editor.createVideo(),ZE_Init.needEditorStats&&editor.updateCount(command),hideAlterToolbar=!0;break;case"table":editor.createTable(),ZE_Init.needEditorStats&&editor.updateCount(command),hideAlterToolbar=!0;break;case"save":if(editor.initobj.saveContent){var _doc=editor.doc,editor_content="<html><head>"+_doc.getElementsByTagName("head")[0].innerHTML+"</head><body>"+_doc.body.innerHTML+"</body></html>";editor.initobj.saveContent(editor_content)}break;case"spellcheck":elem=ev.target||ev.srcElement,ZE.hasClass(elem,"zei-arrow")?editor.spellcheckOptions(ev,command):(editor.removeSpellcheckspans(),editor.spellcheck(ev),hideAlterToolbar=!0);break;case"insertoptions":editor.insertOptions(ev);break;case"quote":editor.insertQuote(),ZE_Init.needEditorStats&&editor.updateCount(command),hideAlterToolbar=!0;break;case"object":editor.insertObj(),ZE_Init.needEditorStats&&editor.updateCount(command);break;case"code":editor.insertCode(),ZE_Init.needEditorStats&&editor.updateCount(command);break;case"edithtml":editor.htmlView(),ZE_Init.needEditorStats&&editor.updateCount(command);break;case"more":editor.expandToolbar(ev);break;case"attach":elem=ev.target||ev.srcElement,ZE.hasClass(elem,"zei-arrow")?editor.showDropDown(ev,"attach"):editor.initobj.id?ZE_Init.attach(editor.initobj.id):ZE_Init.attach();break;case"bold":var currentState=editor.doc.queryCommandState("bold");currentState?editor.squireInstance.removeBold():editor.squireInstance.bold(),editor.saveCurrentState(),editor.updateToolbar();break;case"italic":var currentState=editor.doc.queryCommandState("italic");currentState?editor.squireInstance.removeItalic():editor.squireInstance.italic(),editor.saveCurrentState(),editor.updateToolbar();break;case"underline":var currentState=editor.doc.queryCommandState("underline");currentState?editor.squireInstance.removeUnderline():editor.squireInstance.underline(),editor.saveCurrentState(),editor.updateToolbar();break;case"j-left":case"j-right":case"j-center":case"j-justify":editor.squireInstance.setTextAlignment(command.split("-")[1]),editor.saveCurrentState(),editor.updateToolbar();break;case"insertorderedlist":editor.insertListOperation("OL"),editor.saveCurrentState();break;case"insertunorderedlist":editor.insertListOperation("UL"),editor.saveCurrentState();break;case"insertHTML":editor.showInsertHTMLDialog(),hideAlterToolbar=!0;break;case"lineHeight":editor.showDropDown(ev,command,"lineHeight");break;case"removeformat":var newContent,oldContent=editor.getContent();editor.win.focus(),ZE_Init.is_ie?editor.squireInstance.removeAllFormatting(null):editor.doc.execCommand(command,!1,void 0),newContent=editor.getContent(),newContent!=oldContent&&editor.saveCurrentState();break;default:editor.win.focus(),editor.doc.execCommand(command,!1,null),editor.saveCurrentState(),editor.updateToolbar(),hideAlterToolbar=!0,ZE_Init.needEditorStats&&editor.updateCount(command)}hideAlterToolbar&&editor.removeAlterToolbar&&editor.removeAlterToolbar()},ZE.prototype.insertListOperation=function(command){var editor=this;switch(command){case"UL":var _result=editor.squireInstance.testPresenceinSelection("makeUnorderedList","makeUnorderedList",command,/>UL\b/);_result?editor.squireInstance.removeList():editor.squireInstance.makeUnorderedList(),editor.updateToolbar();break;case"OL":var _result=editor.squireInstance.testPresenceinSelection("makeOrderedList","makeOrderedList",command,/>OL\b/);_result?editor.squireInstance.removeList():editor.squireInstance.makeOrderedList(),editor.updateToolbar()}},ZE.drag=function(ev,divid){var _document=document,_body=_document.body,div=_document.getElementById(divid),_div_style=div.style,dialogposition=ZE.getPos(div),xpos=ev.clientX-dialogposition.offsetLeft,ypos=ev.clientY-dialogposition.offsetTop,maxleft=_body.clientWidth-div.offsetWidth,maxtop=Math.max(_body.scrollHeight,_document.documentElement.scrollHeight)-div.offsetHeight;return _div_style.cursor="move",_div_style.filter='alpha(opacity="90")',_div_style.opacity="0.9",_document.onmousemove=function(ev){ev=ev||window.event;var _left=ev.clientX-xpos,_top=ev.clientY-ypos;return _left>=0&&maxleft>=_left?_div_style.left=_left+"px":0>_left?_div_style.left="0px":_left>maxleft&&(_div_style.left=maxleft+"px"),_top>=0&&maxtop>=_top?_div_style.top=_top+"px":0>_top?_div_style.top="0px":_top>maxtop&&(_div_style.top=maxtop+"px"),!1},_document.onmouseup=function(){return _div_style.cursor="",_div_style.filter='alpha(opacity="100")',_div_style.opacity="1",_document.onmousemove=null,_document.onmouseup=null,!1},!1},ZE.setPosition=function(div,editordiv){var temp,_document=document,_body=_document.body,_documentElement=_document.documentElement,_style=div.style;temp=ZE_Init.is_ie?(_body.clientHeight-div.offsetHeight)/3+Math.max(_body.scrollTop,_document.documentElement.scrollTop):(Math.min(_body.clientHeight,_documentElement.clientHeight)-div.offsetHeight)/3+Math.max(_body.scrollTop,_documentElement.scrollTop),0>temp&&(temp=10),_style.top=temp+"px",temp=(_body.clientWidth-div.offsetWidth)/3+ZE.getPos(editordiv).offsetLeft/2,50>temp&&(temp=100),_style.left=temp+"px"},ZE.prototype.focus=function(curreditor){var editor=void 0!==curreditor?curreditor:this;"plaintext"===editor.mode?editor._textarea.focus():editor.win.focus()},ZE.getPos=function(){var docElementRect={};return docElementRect.left=0,docElementRect.top=0,ZE_Init.is_ie&&(docElementRect=document.documentElement.getBoundingClientRect()),function(e1){var clientRect=e1.getBoundingClientRect(),scrollY=window.scrollY||window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,scrollX=window.scrollX||window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft;return{offsetLeft:clientRect.left+scrollX-docElementRect.left,offsetTop:clientRect.top+scrollY-docElementRect.top}}}(),ZE.prototype.updateCount=function(command){var editor=this;switch(command){case"bold":command="b";break;case"italic":command="i";break;case"underline":command="u";break;case"strikethrough":command="st";break;case"justifyleft":command="jl";break;case"justifyright":command="jr";break;case"justifyfull":command="jf";break;case"justifycenter":command="jc";break;case"insertunorderedlist":command="ul";break;case"insertorderedlist":command="ol";break;case"outdent":command="od";break;case"indent":command="id";break;case"removeformat":command="rf";break;case"link":command="li";break;case"unlink":command="uli";break;case"table":command="ta";break;case"inserthorizontalrule":command="hr";break;case"quote":command="qu";break;case"image":command="img";break;case"spellcheck":command="sp";break;case"subscript":command="ss";break;case"superscript":command="sps";break;case"forecolor":command="fc";break;case"hilitecolor":command="bc";break;case"object":command="ihtm";break;case"edithtml":command="ehtm";break;case"code":command="cod"}editor.clickCount[command]?editor.clickCount[command]++:editor.clickCount[command]=1},ZE.prototype.resize=function(obj){var editor=this,_iframe=editor.iframe,_editordiv=editor.editordiv;obj.height&&(_editordiv.style.height=obj.height+"px",_iframe.style.height=obj.height+"px"),obj.width&&(_editordiv.style.height=obj.height+"px",_iframe.style.height=obj.height+"px")},ZE.isContainsXSS=function(content){const xssPattern=/(<\s*script[^>]*>[\s\S]*?<\s*\/\s*script\s*>|<\s*[^>]*on\w+\s*=\s*".*?"\s*>|javascript:|<\s*iframe[^>]*>|<\s*img[^>]*on\w+\s*=\s*".*?"\s*>|<\s*object[^>]*>|<\s*embed[^>]*>|<\s*style[^>]*>[\s\S]*?<\s*\/\s*style\s*>|<\s*svg[^>]*>|<\s*video[^>]*>|<\s*audio[^>]*>|<\s*link[^>]*rel=["\']stylesheet["\'][^>]*>|<\s*form[^>]*>|<\s*input[^>]*type=["\']hidden["\'][^>]*>|<\s*meta[^>]*>|document\.cookie|window\.location|document\.write|<\s*base[^>]*>|<\s*body[^>]*>)/gi;return xssPattern.test(content)};ZE.conDrop=function(options,_editor){var divElem,ulElem,liElem,i,optlen=options.list.length;for(divElem=document.createElement("div"),divElem.id="ze_dropdown",divElem.className="ze_dd shw",ulElem=document.createElement("ul"),options.ulClass&&(ulElem.className=options.ulClass),attachOnClick=function(_list){return function(){_list.clk(_editor.initobj.id)}},i=0;optlen>i;i++){if(liElem=document.createElement("li"),"fontsize"==options.type?liElem.setAttribute("data-size",options.list[i].datAttr):"fontfamily"==options.type?liElem.style.fontFamily=options.list[i].ff:"colorpicker"==options.type?liElem.style.backgroundColor=options.list[i]:("align"==options.type||"list"==options.type||"indent"==options.type||"textDir"==options.type||"others"==options.type||"lineHeight"==options.type)&&liElem.setAttribute("data-"+options.type,options.list[i].datAttr),options.list[i].htm)if(options.list[i].datAttr&&"switchmode"==options.list[i].datAttr){if(_editor.initobj.avoidPlainText||!ZE_Init.needplaintext)continue;"richtext"==options.editr.mode?liElem.innerHTML="Plain Text mode":"plaintext"==options.editr.mode&&(liElem.innerHTML="Rich Text mode")}else liElem.innerHTML=options.list[i].htm;if(options.list[i].liClass&&(liElem.className=options.list[i].liClass),ulElem.appendChild(liElem),options.list[i].clk){var _list=options.list[i];ZE._addEvent(liElem,"click",attachOnClick(_list))}}divElem.appendChild(ulElem),document.body.appendChild(divElem)},ZE.prototype.showDropDown=function(ev,command,action){var curtoolbarobject,ze_dropdowndiv,ul_click,mouse_down,ddoptions,hideDropDown,_target,colors,smileys,selectedRange,editor=this,_anchorelement=ev.currentTarget,_document=document,_doc=editor.doc;switch(colors=["#ffffff","#cceeff","#ccccff","#e5ccff","#ffccff","#ffccee","#ffcccc","#ffe5cc","#ffffcc","#ccffcc","#ccffff","#cccccc","#99ccff","#9999ff","#cc99ff","#ff99ff","#ff99cc","#ff9999","#ffcc99","#ffff99","#99ff99","#99ffff","#c0c0c0","#66ccff","#6666ff","#b266ff","#ff66fe","#ff66b2","#ff6666","#ffb266","#feff66","#66ff66","#66feff","#999999","#399cfd","#3333ff","#9933ff","#ff33fe","#ff3398","#ff3333","#ff9933","#feff33","#33ff33","#33feff","#666666","#3399ff","#0000ff","#7700ff","#ff00ee","#ff0077","#ff0000","#ff7f00","#feff00","#00ff00","#00feff","#444444","#0065cc","#0000cc","#6600cc","#cc00cb","#cc00cb","#cc0000","#cc6600","#cbcc00","#00cc00","#00cbcc","#333333","#004c99","#000099","#4B0099","#990098","#99004c","#990000","#994c00","#989900","#009900","#009899","#000000","#003366","#000066","#330066","#660066","#660032","#660000","#663300","#666600","#006600","#006666"],smileys=[{liClass:"zcoemoji-smilenew"},{liClass:"zcoemoji-lol"},{liClass:"zcoemoji-tearofjoy"},{liClass:"zcoemoji-grin"},{liClass:"zcoemoji-coolnew"},{liClass:"zcoemoji-loveit"},{liClass:"zcoemoji-curious"},{liClass:"zcoemoji-shocked"},{liClass:"zcoemoji-thinking"},{liClass:"zcoemoji-searching"},{liClass:"zcoemoji-idea"},{liClass:"zcoemoji-winknew"},{liClass:"zcoemoji-tongueout"},{liClass:"zcoemoji-relaxed"},{liClass:"zcoemoji-halo"},{liClass:"zcoemoji-yummy"},{liClass:"zcoemoji-yuck"},{liClass:"zcoemoji-sad"},{liClass:"zcoemoji-blush"},{liClass:"zcoemoji-upset"},{liClass:"zcoemoji-anxious"},{liClass:"zcoemoji-worried"},{liClass:"zcoemoji-stressed"},{liClass:"zcoemoji-angry"},{liClass:"zcoemoji-tensed"},{liClass:"zcoemoji-tired"},{liClass:"zcoemoji-bored"},{liClass:"zcoemoji-sleepy"},{liClass:"zcoemoji-jealous"},{liClass:"zcoemoji-evil"},{liClass:"zcoemoji-facepalm"},{liClass:"zcoemoji-doubtful"},{liClass:"zcoemoji-surprise"},{liClass:"zcoemoji-dizzy"},{liClass:"zcoemoji-headache"},{liClass:"zcoemoji-sick"},{liClass:"zcoemoji-injured"},{liClass:"zcoemoji-neutral"},{liClass:"zcoemoji-meh"},{liClass:"zcoemoji-lipssealed"},{liClass:"zcoemoji-feelingwarm"},{liClass:"zcoemoji-feelingcold"},{liClass:"zcoemoji-like"},{liClass:"zcoemoji-dislike"},{liClass:"zcoemoji-namaste"},{liClass:"zcoemoji-super"},{liClass:"zcoemoji-claps"},{liClass:"zcoemoji-ontarget"},{liClass:"zcoemoji-birthday"}],curtoolbarobject=editor.toolbarobject[command],hideDropDown=function(){ze_dropdowndiv&&(document.body.removeChild(ze_dropdowndiv),ZE.removeClass(curtoolbarobject,"ze_dn"),"attach"!=command&&ZE.removeClass(curtoolbarobject,"ze_Sel"),ZE._removeEvent(_document,"mousedown",mouse_down),ZE._removeEvent(_doc,"mousedown",mouse_down),ZE._removeEvent(_doc,"keydown",mouse_down),ZPFeeds.Editor.addRemovePlaceholder(editor,!1))},mouse_down=function(ev){if(ze_dropdowndiv=document.getElementById("ze_dropdown"),ev)for(_target=ev.target;null!==_target&&_target!==ze_dropdowndiv;_target=_target.parentNode);_target||hideDropDown()},ul_click=function(ev){ZPFeeds.Editor.addRemovePlaceholder(editor,!1,!0);var _target=ev.target;switch("richtext"==editor.mode&&selectedRange&&(editor.win.focus(),editor.restoreSelection(selectedRange)),command){case"fontfamily":editor.win.focus(),editor.updateFontfamily(_target,curtoolbarobject);break;case"fontsize":editor.win.focus(),editor.updateFontsize(_target,curtoolbarobject);break;case"forecolor":case"backcolor":editor.win.focus(),editor.updateColor(_target,_anchorelement,command);break;case"alignoptions":case"listoptions":case"indentoptions":editor.updateFormatoptions(_target,curtoolbarobject,action);break;case"directionoptions":editor.updateDirectionOptions(_target,curtoolbarobject,action);break;case"otheroptions":editor.updateOtheroptions(_target,action);break;case"lineHeight":editor.updateFormatoptions(_target,curtoolbarobject,action);break;case"smiley":editor.insertSmiley(_target)}hideDropDown()},command){case"fontfamily":ddoptions={type:command,list:ZE_Init[command]};var _firstFontFamilyValue,count,_queryCommandFontFamilyValue=editor.doc.queryCommandValue("fontname"),fontFamilyLiArrayLength=ZE_Init[command].length;if(_queryCommandFontFamilyValue)for(_firstFontFamilyValue=_queryCommandFontFamilyValue.split(",")[0].toLowerCase(),count=0;fontFamilyLiArrayLength>count;count++)fontFamilyLiObj=ZE_Init[command][count],fontFamilyLiObj.liClass=fontFamilyLiObj.ff.split(",")[0].toLowerCase()===_firstFontFamilyValue?"sel":"";break;case"fontsize":ddoptions={type:command,list:ZE_Init[command]};var i,data_size,_fontSizeValue=editor.doc.queryCommandValue("fontSize");if(fontSizeAnchorArray=ZE_Init[command],fontSizeAnchorArrayLength=fontSizeAnchorArray.length,_fontSizeValue||(_fontSizeValue=editor.getFormattingValues("size")),_fontSizeValue){switch(_fontSizeValue){case"1":case 1:case"10px":data_size="1";break;case"2":case 2:case"13px":data_size="2";break;case"3":case 3:case"16px":data_size="3";break;case"4":case 4:case"18px":data_size="4";break;case"5":case 5:case"24px":data_size="5";break;case"6":case 6:case"32px":data_size="6";break;case"7":case 7:case"48px":data_size="7"}for(i=0;fontSizeAnchorArrayLength>i;i++)fontSizeAnchorArray[i].liClass=fontSizeAnchorArray[i].datAttr===data_size?"sel":""}else for(i=0;fontSizeAnchorArrayLength>i;i++)fontSizeAnchorArray[i].liClass="";break;case"forecolor":case"backcolor":ddoptions={type:"colorpicker",ulClass:"ze_cb",list:colors};break;case"smiley":ddoptions={type:command,ulClass:"ze_sb smileys clearfix",list:smileys};break;case"otheroptions":ddoptions={type:action,list:ZE_Init[action],editr:editor},ddoptions.ulClass="ze_ddr";break;case"alignoptions":case"listoptions":case"indentoptions":ddoptions={type:action,list:ZE_Init[action]};break;case"directionoptions":ddoptions={type:action,list:ZE_Init[action]};break;case"attach":ddoptions={type:command,list:ZE_Init.attachDrop};break;case"lineHeight":ddoptions={type:action,list:ZE_Init[action]}}for(editor.win.focus(),"richtext"==editor.mode&&(selectedRange=editor.saveSelection()),ZE.conDrop(ddoptions,editor),ze_dropdowndiv=_document.getElementById("ze_dropdown"),"fontfamily"==command?ze_dropdowndiv.style.width="175px":"fontsize"==command&&(ze_dropdowndiv.style.width="60px"),ZE.addClass(curtoolbarobject,"ze_dn"),ZE.addClass(curtoolbarobject,"ze_Sel"),ZE._addEvent(ze_dropdowndiv,"click",ul_click),ZE._addEvent(_document,"mousedown",mouse_down),ZE._addEvent(_doc,"mousedown",mouse_down),ZE._addEvent(_doc,"keydown",mouse_down);"B"!==_anchorelement.nodeName;)_anchorelement=_anchorelement.parentNode;var targetRect=_anchorelement.getBoundingClientRect(),viewportHeight=window.innerHeight||document.documentElement.clientHeight,viewportWidth=window.innerWidth||document.documentElement.clientWidth,divHeight=ze_dropdowndiv.offsetHeight,divWidth=ze_dropdowndiv.offsetWidth,top=targetRect.bottom+window.scrollY,left=targetRect.left+window.scrollX;top+divHeight>viewportHeight+window.scrollY&&(top=targetRect.top-divHeight+window.scrollY,top<window.scrollY&&(top=window.scrollY+10,ze_dropdowndiv.style.height=viewportHeight-20+"px",ze_dropdowndiv.style.overflowY="auto")),left+divWidth>viewportWidth+window.scrollX&&(left=viewportWidth-divWidth+window.scrollX-10),left=Math.max(left,window.scrollX+10),ze_dropdowndiv.style.top=top+"px",ze_dropdowndiv.style.left=left+"px",ze_dropdowndiv.style.display="block"},ZE.prototype.updateFontfamily=function(_target){{var selaction,editor=this;editor.doc}selaction=_target.style.fontFamily,editor.win.focus(),editor.squireInstance.setFontFace(selaction),editor.saveCurrentState()},ZE.prototype.updateFontsize=function(_target,curtoolbarobject){{var editor=this;editor.doc}curtoolbarobject.firstChild.innerHTML=_target.innerHTML,editor.win.focus();var dataAtt=_target.getAttribute("data-size");editor.squireInstance.setFontSize(editor.fontsizeConversion("fontvaltopx",dataAtt)+"px"),editor.saveCurrentState()},ZE.prototype.updateColor=function(_target,_anchorelement,command){var col,i,collen,editor=this,_doc=editor.doc;for(col=_target.style.backgroundColor,col=col.replace(/rgb\(|\)/g,"").split(","),collen=col.length,i=0;collen>i;i++)col[i]=parseInt(col[i],10).toString(16),col[i]=1==col[i].length?"0"+col[i]:col[i];if(col="#"+col.join(""),editor.win.focus(),"backcolor"==command?editor.squireInstance.setHighlightColour(col):"forecolor"==command&&editor.squireInstance.setTextColour(col),"backcolor"==command){var value=_doc.queryCommandValue("backcolor");"number"==typeof value?_anchorelement.firstChild.style.borderBottom="2px rgb("+(255&value)+","+(value>>8&255)+","+(value>>16&255)+") solid":("transparent"==value&&(value=editor.getFormattingValues("highlight")||"white"),_anchorelement.firstChild.style.borderBottom="2px "+value+" solid")}else{var value=_doc.queryCommandValue("forecolor");_anchorelement.firstChild.style.color="number"==typeof value?"rgb("+(255&value)+","+(value>>8&255)+","+(value>>16&255)+")":_doc.queryCommandValue("forecolor")}editor.saveCurrentState()},ZE.prototype.updateDirectionOptions=function(_target,curtoolbarObject,action){var editor=this,selection=_target.getAttribute("data-"+action);switch(editor.win.focus(),selection){case"rtl":editor.squireInstance.setTextDirection("rtl"),curtoolbarObject.firstChild.className="zei-ltr";break;case"ltr":editor.squireInstance.setTextDirection("ltr"),curtoolbarObject.firstChild.className="zei-rtl"}editor.saveCurrentState()},ZE.prototype.updateFormatoptions=function(_target,curtoolbarobject,action){{var selaction,editor=this;editor.doc}switch(selaction=_target.getAttribute("data-"+action),editor.win.focus(),selaction){case"justifyleft":editor.squireInstance.setTextAlignment("left"),curtoolbarobject.firstChild.className="zei-textleft";break;case"justifyright":editor.squireInstance.setTextAlignment("right"),curtoolbarobject.firstChild.className="zei-textright";break;case"justifyfull":editor.squireInstance.setTextAlignment("justify"),curtoolbarobject.firstChild.className="zei-textjustify";break;case"justifycenter":editor.squireInstance.setTextAlignment("center"),curtoolbarobject.firstChild.className="zei-textcenter";break;case"insertunorderedlist":editor.insertListOperation("UL"),curtoolbarobject.firstChild.className="zei-unorder";break;case"insertorderedlist":editor.insertListOperation("OL"),curtoolbarobject.firstChild.className="zei-order";break;case"indent":editor.getPosFromCursor("UL")>0||editor.getPosFromCursor("OL")>0?editor.squireInstance.increaseListLevel():editor.squireInstance.increaseQuoteLevel(),curtoolbarobject.firstChild.className="zei-outdent";break;case"outdent":var olparent=editor.getPosFromCursor("OL"),ulparent=editor.getPosFromCursor("UL");-1==olparent&&-1==ulparent?editor.squireInstance.decreaseQuoteLevel():ulparent>olparent?editor.getPosFromCursor("UL",1)>0||editor.getPosFromCursor("OL")>0?editor.squireInstance.decreaseListLevel():editor.squireInstance.removeList():olparent>ulparent&&(editor.getPosFromCursor("OL",1)>0||editor.getPosFromCursor("UL")>0?editor.squireInstance.decreaseListLevel():editor.squireInstance.removeList()),curtoolbarobject.firstChild.className="zei-indent";break;case"singleInd":editor.squireInstance.setLineHeight("1.0");break;case"normalInd":editor.squireInstance.setLineHeight("1.2");break;case"mediumInd":editor.squireInstance.setLineHeight("1.5");break;case"doubleInd":editor.squireInstance.setLineHeight("2.0")}editor.saveCurrentState()},ZE.prototype.updateOtheroptions=function(_target,action){var editor=this,selaction=_target.getAttribute("data-"+action);editor.win.focus(),"switchmode"==selaction?"richtext"==editor.mode?editor.confirmPlainText(editor.getContent()):"plaintext"==editor.mode&&editor.richText(editor.getContent()):"spellcheck"==selaction&&editor.spellcheck()},ZE.prototype.insertSmiley=function(_target){{var value,editor=this,contextVal=ZE.getContextValue();ZE_Init.smileyPath||contextVal+"/ze/images/"}editor.win.focus(),0==_target.className.indexOf("zcoemoji-")&&"LI"==_target.nodeName&&(value=":"+_target.className.replace("zcoemoji-","")+":",editor.pasteHTML(ZPFeeds.Editor.getSmileyHTML(_target.className,value)),editor.saveCurrentState())};ZE.prototype.showContextMenu=function(ev,type,object){var cmoptions,fragment,ze_dropdowndiv,mouse_down,_target,current_row,i,editor=this,_document=document,_doc=editor.doc,_target1=ev.target;delete_table=function(){editor.win.focus(),object.parentNode.removeChild(object),hideContextMenu(),editor.win.focus(),editor.saveCurrentState()},delete_current_row=function(){if(editor.win.focus(),current_row=get_current_row()){if(current_row.parentNode.removeChild(current_row),0==object.rows.length)return void delete_table();hideContextMenu(),editor.saveCurrentState()}},delete_current_column=function(){if(editor.win.focus(),current_row=get_current_row()){var current_column=get_current_column(),currentPos=getPosition(current_row,current_column),tbody=current_row.parentNode,tr_list=tbody.getElementsByTagName("TR");for(i=0;i<tr_list.length;i++){var td_list=tr_list[i].children;tr_list[i].removeChild(td_list[currentPos])}if(0===tr_list[0].children.length)return void delete_table();hideContextMenu(),editor.saveCurrentState()}},get_current_row=function(){if(_target=_target1,"TR"!=_target.nodeName)for(;null!==_target&&"TR"!=_target.nodeName;_target=_target.parentNode);return _target},getColumnsNo=function(_current_row){var td_list=_current_row.children;return td_list.length},constructRow=function(_col_no){var temp_fragment=_doc.createDocumentFragment(),trEle=_doc.createElement("tr");for(temp_fragment.appendChild(trEle),i=0;_col_no>i;i++){var tdElem=_doc.createElement("td"),divElem=_doc.createElement("div");divElem.appendChild(_doc.createElement("br")),tdElem.appendChild(divElem),trEle.appendChild(tdElem)}return temp_fragment},insert_row_above=function(){if(editor.win.focus(),current_row=get_current_row()){var col_no=getColumnsNo(current_row);fragment=constructRow(col_no),current_row.parentNode.insertBefore(fragment,current_row),hideContextMenu(),selectedRange&&editor.restoreSelection(selectedRange),editor.win.focus(),editor.saveCurrentState()}},insert_row_below=function(){if(editor.win.focus(),current_row=get_current_row()){var col_no=getColumnsNo(current_row);fragment=constructRow(col_no),current_row.parentNode.insertBefore(fragment,current_row.nextSibling),hideContextMenu(),selectedRange&&editor.restoreSelection(selectedRange),editor.win.focus(),editor.saveCurrentState()}},insert_column_left=function(){if(editor.win.focus(),current_row=get_current_row()){var current_column=get_current_column(),currentPos=getPosition(current_row,current_column),tbody=current_row.parentNode,tr_list=tbody.getElementsByTagName("TR");for(i=0;i<tr_list.length;i++){var td_list=tr_list[i].children,tdElem=_doc.createElement("td"),divElem=_doc.createElement("div");divElem.appendChild(_doc.createElement("br")),tdElem.appendChild(divElem),tr_list[i].insertBefore(tdElem,td_list[currentPos])}hideContextMenu(),editor.saveCurrentState()}},getPosition=function(_current_row,_current_column){var td_list=_current_row.children;for(i=0;i<td_list.length;i++)if(_current_column===td_list[i])return i},get_current_column=function(){if(_target=_target1,"TD"!=_target.nodeName)for(;null!==_target&&("TD"!=_target.nodeName&&"TH"!=_target.nodeName);_target=_target.parentNode);return _target},insert_column_right=function(){if(editor.win.focus(),current_row=get_current_row()){var current_column=get_current_column(),currentPos=getPosition(current_row,current_column),tbody=current_row.parentNode,tr_list=tbody.getElementsByTagName("TR");for(i=0;i<tr_list.length;i++){var td_list=tr_list[i].children,tdElem=_doc.createElement("td"),divElem=_doc.createElement("div");divElem.appendChild(_doc.createElement("br")),tdElem.appendChild(divElem),tr_list[i].insertBefore(tdElem,td_list[currentPos].nextSibling)}hideContextMenu(),editor.saveCurrentState()}},edit_table=function(){var _table=object;editor.createTable(_table),hideContextMenu(1)};var ContextMenu={table:[[{cmd:"Insert Rows Above",id:"insert_row","class":"li_class",method:insert_row_above},{cmd:"Insert Rows Below","class":"li_class",method:insert_row_below},{cmd:"Insert Column left","class":"li_class",method:insert_column_left},{cmd:"Insert Column right","class":"li_class",method:insert_column_right}],[{cmd:"Delete Row",id:"delete_row",method:delete_current_row},{cmd:"Delete Column","class":"li_class",method:delete_current_column},{cmd:"Delete Table",method:delete_table}],[{cmd:"Edit Table",method:edit_table}]]};switch(executeFunction=function(temp_val,temp_list){temp_list[temp_val].method()},type){case"table":if(!get_current_row())return;cmoptions=ContextMenu.table}hideContextMenu=function(editorFocus){editorFocus||(selectedRange&&editor.restoreSelection(selectedRange),editor.win.focus()),ze_dropdowndiv=document.getElementById("ze_contextMenudd"),ze_dropdowndiv&&(document.body.removeChild(ze_dropdowndiv),ZE._removeEvent(_document,"mousedown",mouse_down),ZE._removeEvent(_doc,"mousedown",mouse_down),ZE._removeEvent(_doc,"keydown",mouse_down))},mouse_down=function(ev){if(ze_dropdowndiv=document.getElementById("ze_contextMenudd"),ev)for(_target=ev.target;null!==_target&&_target!==ze_dropdowndiv;_target=_target.parentNode);_target||hideContextMenu()},setPositions=function(ev){var posx=0,posy=0,$document=document,$body=document.body,$documentElement=$document.documentElement,scrollTopValue=Math.max($body.scrollTop,$documentElement.scrollTop),value1=editor.iframe.getBoundingClientRect(),value2=_target1.getBoundingClientRect();ev.pageX||ev.pageY?(posx=value1.left+value2.left+(ev.pageX-value2.left),posy=editor.win.scrollY?value1.top+value2.top+(ev.pageY-value2.top)-editor.win.scrollY:value1.top+value2.top+(ev.pageY-value2.top)-editor.win.pageYOffset):(posx=value1.left+value2.left+(ev.clientX-value2.left),posy=editor.win.scrollY?value1.top+value2.top+(ev.clientY-value2.top)-editor.win.scrollY:value1.top+value2.top+(ev.clientY-value2.top)-editor.win.pageYOffset),posy+=scrollTopValue||0,ze_dropdowndiv.style.left=parseInt(posx)+"px",ze_dropdowndiv.style.top=parseInt(posy)+"px";var _style=(ZE.getPos(editor.editordiv),ze_dropdowndiv.style),ze_dropdowndiv_offsetheight=ze_dropdowndiv.offsetHeight,_docWidth=document.body.getBoundingClientRect().width;if(posx+ze_dropdowndiv.offsetWidth+10>_docWidth&&(_style.left="auto",posx=window.innerWidth-posx,_style.right=parseInt(posx)+"px"),posy+ze_dropdowndiv_offsetheight>window.innerHeight-20){var tempTop=posy-ze_dropdowndiv_offsetheight;_style.top=10>tempTop?"40px":parseInt(tempTop)+"px"}},editor.constructContextMenu(cmoptions,"ze_contextMenudd"),editor.win.focus(),selectedRange=editor.saveSelection(),ze_dropdowndiv=document.getElementById("ze_contextMenudd"),setPositions(ev),ZE._addEvent(_document,"mousedown",mouse_down),ZE._addEvent(_doc,"mousedown",mouse_down),ZE._addEvent(_doc,"keydown",mouse_down)},ZE.prototype.constructContextMenu=function(options,id,ul_click){var mainDivElem,divElem,ulElem,liElem,i,j,editor=this,optlen=options.length;for(mainDivElem=document.createElement("div"),mainDivElem.className="ze_dd shw notrans ze_tbdr",mainDivElem.id=id,divElem=document.createElement("div"),ulElem=document.createElement("ul"),i=0;optlen>i;i++){var menu_block=options[i];for(j=0;j<menu_block.length;j++)liElem=document.createElement("li"),liElem.innerHTML=menu_block[j].cmd,menu_block[j].id&&(liElem.id=menu_block[j].id),menu_block[j]["class"]&&(liElem.className=menu_block[j]["class"]),ulElem.appendChild(liElem),liElem.setAttribute("data-value",j),menu_block[j]["data-i"]&&liElem.setAttribute("data-i",menu_block[j]["data-i"]),menu_block[j].color&&(liElem.style.color=menu_block[j].color),menu_block[j].fontWeight&&(liElem.style.fontWeight=menu_block[j].fontWeight),menu_block[j].method&&(liElem.onclick=menu_block[j].method);liElem=document.createElement("li"),liElem.className="ze_lne",ulElem.appendChild(liElem)}divElem.appendChild(ulElem),mainDivElem.appendChild(divElem),document.body.appendChild(mainDivElem),ul_click&&ZE._addEvent(ulElem,"click",ul_click),mainDivElem.addEventListener("contextmenu",function(ev){return editor._stopEvent(ev),!1},!1)};ZE.prototype.saveSelection=function(){var range,editor=this,_doc=editor.doc,sel=editor.win.getSelection?editor.win.getSelection():_doc.selection;try{sel&&(sel.createRange?range=sel.createRange():sel.getRangeAt?0==sel.rangeCount?editor.focusAtStart(!0):range=sel.getRangeAt(0):sel.anchorNode&&sel.focusNode&&_doc.createRange&&(range=_doc.createRange(),range.setStart(sel.anchorNode,sel.anchorOffset),range.setEnd(sel.focusNode,sel.focusOffset),range.collapsed!==sel.isCollapsed&&(range.setStart(sel.focusNode,sel.focusOffset),range.setEnd(sel.anchorNode,sel.anchorOffset))))}catch(e){}return range},ZE.prototype.restoreSelection=function(range){var editor=this,_doc=editor.doc,sel=editor.win.getSelection?editor.win.getSelection():_doc.selection;sel&&range&&(range.select?range.select():sel.removeAllRanges&&sel.addRange&&(sel.removeAllRanges(),sel.addRange(range)))},ZE.prototype._getSelection=function(){return this.win.getSelection()},ZE.prototype._createRange=function(sel){try{return sel.getRangeAt(0)}catch(e){return this.doc.createRange()}},ZE.prototype._getSelectedText=function(){try{var s=this._getSelection();if(s)return s.toString()}catch(e){return void 0}},ZE.prototype.getParentElement=function(){var editor=this,sel=editor._getSelection(),range=editor._createRange(sel),p=range.commonAncestorContainer;try{for(!range.collapsed&&range.startContainer==range.endContainer&&range.startOffset-range.endOffset<=1&&range.startContainer.hasChildNodes()&&(p=range.startContainer.childNodes[range.startOffset]);3==p.nodeType;)p=p.parentNode;return p}catch(e){return void 0}},ZE.prototype.pasteHTML=function(html){var sel,range,editor=this,_win=editor.win;if(_win.getSelection){if(sel=_win.getSelection(),null!=sel&&sel.getRangeAt&&sel.rangeCount){range=sel.getRangeAt(0),range.deleteContents();var el=editor.doc.createElement("div");el.innerHTML=html;for(var node,lastNode,frag=editor.doc.createDocumentFragment();node=el.firstChild;)lastNode=frag.appendChild(node);range.insertNode(frag),lastNode&&(range=range.cloneRange(),range.setStartAfter(lastNode),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range))}}else editor.doc.selection&&"Control"!=editor.doc.selection.type&&editor.doc.selection.createRange().pasteHTML(html)},ZE.prototype.insertHTML=function(html,saveState){var editor=this,_mode=editor.mode;if(_mode&&"plaintext"===_mode)editor.insertText(html);else{if(editor.squireInstance.focus(),editor.squireInstance){var opts={};opts.avoidSanitize=!0;var tempDiv=$("<div></div>");tempDiv=tempDiv.html(html);var matchContent=$(tempDiv).find("img");if(void 0!==matchContent[0]){for(i=0;i<matchContent.length;i++){var searchStr=matchContent[i],replaceStr=(searchStr.outerHTML,$(searchStr).attr("src"));if(void 0!==replaceStr&&-1!=replaceStr.indexOf("TemplateImageRenderer?"))if(0==replaceStr.indexOf("TemplateImageRenderer?"))$(searchStr).attr("src",urlvalue+"/"+replaceStr+"&conreqcsr="+csrfToken);else{var urlarr=replaceStr.split("TemplateImageRenderer?");$(searchStr).attr("src",urlvalue+"/TemplateImageRenderer?"+urlarr[1]+"&conreqcsr="+csrfToken)}}html=tempDiv[0].innerHTML}editor.squireInstance.insertHTML(html,null,opts)}else editor.pasteHtml(html);saveState||editor.saveCurrentState(),ZPFeeds.Editor.addRemovePlaceholder(editor,!1)}},ZE.prototype.insertText=function(text){var editor=this,_textarea=editor._textarea,_textarea_value=_textarea.value,_selectionStart=_textarea.selectionStart,_selectionEnd=_textarea.selectionEnd;_textarea&&(text=ZE.getText(text),_selectionStart||0===_selectionStart?_textarea.value=_textarea_value.substring(0,_selectionStart)+text+_textarea_value.substring(_selectionEnd,_textarea_value.length):_textarea.value+=text,_textarea.focus())},ZE.prototype.getAllAncestors=function(){for(var editor=this,p=editor.getParentElement(),a=[];p&&1==p.nodeType&&"body"!=p.tagName.toLowerCase();)a.push(p),p=p.parentNode;return a.push(editor.doc.body),a};ZE.prototype.createImage=function(){var _form,imgAction,computer_radio,url_radio,file_input,url_input,insert_btn,cancel_btn,comp_imglink,url_imglink,errorspan,infospan,choose_image,fileinfospan,uploadstate,_img,minus_plus_image,radio_options_div,from_computer_div,from_url_div,_small_img_radio,_bestfit_img_radio,_original_img_radio,_imgpreview,_imgoriginal_width,_imgoriginal_height,url_radio_option,computer_radio_option,_small_img_radio_option,_bestfit_img_radio_option,_original_img_radio_option,insert_img_btn,selectedRange,editor=this,ze_ins_image_div=document.getElementById("ze_ins_image"),I18N=ZE.i18n,DEFAULTIMAGEOPTION="bestfit",existing_image=editor.getParentElement(),maxUploadSize=editor.initobj.imgMaxUploadSize||ZE_Init.maxImageUploadSize||3,sizeToDisplay=maxUploadSize+" MB";1>maxUploadSize&&(sizeToDisplay=1024*maxUploadSize+" KB"),imgAction="function"==typeof editor.initobj.getImgUploadAction?editor.initobj.getImgUploadAction():editor.initobj.imgAction||ZE_Init.imgAction;existing_image&&"IMG"!==existing_image.nodeName&&(existing_image=void 0),"function"==typeof editor.initobj.getImgUploadParameters?imgAction+=editor.initobj.getImgUploadParameters():("function"==typeof ZE_Init.imgParametersFunction&&ZE_Init.imgParametersFunction(),ZE_Init.imgParameters&&(imgAction+=ZE_Init.imgParameters));var hideImagediv=function(){ze_ins_image_div.parentNode.removeChild(ze_ins_image_div),ZE.hideOverlay(),file_input.disabled=computer_radio.disabled=url_radio.disabled=insert_btn.disabled=!1,_form&&_form.reset(),editor.win.focus(),ZE._removeEvent(document,"keydown",esckey),ZE._removeEvent(editor.doc,"keydown",esckey),comp_imglink.removeAttribute("src"),url_imglink.removeAttribute("src"),comp_imglink.style.display="none",url_imglink.style.display="none",ZE.activeEditor&&delete ZE.activeEditor,ZE.captchaProcessing&&delete ZE.captchaProcessing,ZPFeeds.Editor.addRemovePlaceholder(editor,!1)},esckey=function(ev){var captcha_Div=document.getElementById("ze_captcha");if(27==ev.keyCode){if(captcha_Div&&"none"!==captcha_Div.style.display)return void(captcha_Div.style.display="none");editor._stopEvent(ev),hideImagediv()}},computerMode=function(){var imageOption=editor.initobj.defaultImageOption||DEFAULTIMAGEOPTION;ZE.removeClass(computer_radio_option,"zei-unoption"),ZE.addClass(computer_radio_option,"zei-option"),ZE.removeClass(url_radio_option,"zei-option"),ZE.addClass(url_radio_option,"zei-unoption"),"bestfit"===imageOption?(ZE.removeClass(_small_img_radio_option,"zei-option"),ZE.addClass(_small_img_radio_option,"zei-unoption"),ZE.removeClass(_bestfit_img_radio_option,"zei-unoption"),ZE.addClass(_bestfit_img_radio_option,"zei-option"),ZE.removeClass(_original_img_radio_option,"zei-option"),ZE.addClass(_original_img_radio_option,"zei-unoption")):"smallfit"===imageOption?(ZE.removeClass(_small_img_radio_option,"zei-unoption"),ZE.addClass(_small_img_radio_option,"zei-option"),ZE.removeClass(_bestfit_img_radio_option,"zei-option"),ZE.addClass(_bestfit_img_radio_option,"zei-unoption"),ZE.removeClass(_original_img_radio_option,"zei-option"),ZE.addClass(_original_img_radio_option,"zei-unoption")):(ZE.removeClass(_small_img_radio_option,"zei-option"),ZE.addClass(_small_img_radio_option,"zei-unoption"),ZE.removeClass(_bestfit_img_radio_option,"zei-option"),ZE.addClass(_bestfit_img_radio_option,"zei-unoption"),ZE.removeClass(_original_img_radio_option,"zei-unoption"),ZE.addClass(_original_img_radio_option,"zei-option")),from_computer_div.style.display="",from_url_div.style.display="none",comp_imglink.src?(comp_imglink.style.display="",_imgpreview.style.display="none",fileinfospan.style.display="",errorspan.style.display="none",infospan.style.display="none"):(_imgpreview.style.display="block",comp_imglink.style.display="none",uploadstate&&"finished"!=uploadstate?uploadstate&&"loading"==uploadstate&&(infospan.style.display="",errorspan.style.display="none"):(ZE.insertImageMsg(I18N("Maximum file size supported: "+sizeToDisplay),"imginfo"),ZE.removeClass(errorspan,"ze_popuperrmsg"),infospan.style.display="none")),url_imglink.style.display="none"},urlMode=function(){var imageOption=editor.initobj.defaultImageOption||DEFAULTIMAGEOPTION;ZE.removeClass(computer_radio_option,"zei-option"),ZE.addClass(computer_radio_option,"zei-unoption"),ZE.removeClass(url_radio_option,"zei-unoption"),ZE.addClass(url_radio_option,"zei-option"),"bestfit"===imageOption?(ZE.removeClass(_small_img_radio_option,"zei-option"),ZE.addClass(_small_img_radio_option,"zei-unoption"),ZE.removeClass(_bestfit_img_radio_option,"zei-unoption"),ZE.addClass(_bestfit_img_radio_option,"zei-option"),ZE.removeClass(_original_img_radio_option,"zei-option"),ZE.addClass(_original_img_radio_option,"zei-unoption")):"smallfit"===imageOption?(ZE.removeClass(_small_img_radio_option,"zei-unoption"),ZE.addClass(_small_img_radio_option,"zei-option"),ZE.removeClass(_bestfit_img_radio_option,"zei-option"),ZE.addClass(_bestfit_img_radio_option,"zei-unoption"),ZE.removeClass(_original_img_radio_option,"zei-option"),ZE.addClass(_original_img_radio_option,"zei-unoption")):(ZE.removeClass(_small_img_radio_option,"zei-option"),ZE.addClass(_small_img_radio_option,"zei-unoption"),ZE.removeClass(_bestfit_img_radio_option,"zei-option"),ZE.addClass(_bestfit_img_radio_option,"zei-unoption"),ZE.removeClass(_original_img_radio_option,"zei-unoption"),ZE.addClass(_original_img_radio_option,"zei-option")),from_computer_div.style.display="none",from_url_div.style.display="",comp_imglink.style.display="none",url_imglink.src?(url_imglink.style.display="",_imgpreview.style.display="none"):(url_imglink.style.display="none",_imgpreview.style.display="block"),url_input.focus(),fileinfospan.style.display="none",errorspan.style.display="none",infospan.style.display="none"},setFocus=function(){existing_image?insert_btn.focus():url_radio.checked&&url_input.focus()},initialise=function(){var _input=ze_ins_image_div.getElementsByTagName("input");file_input=_input[0],url_input=_input[1];var _span=ze_ins_image_div.getElementsByTagName("span"),_label=ze_ins_image_div.getElementsByTagName("label");computer_radio=_span[0],url_radio=_span[1],choose_image=_label[2],errorspan=_span[2],infospan=_span[3],fileinfospan=_span[4],_small_img_radio=_span[5],_bestfit_img_radio=_span[6],_original_img_radio=_span[7],_imgpreview=_span[8],insert_btn=_span[9],cancel_btn=_span[10],_form=document.ze_img_form,_form.action=imgAction;var _div=ze_ins_image_div.getElementsByTagName("div");from_computer_div=_div[3],from_url_div=_div[5],insert_img_btn=from_computer_div=_div[4];var _td=ze_ins_image_div.getElementsByTagName("td");radio_options_div=_td[0],_img=ze_ins_image_div.getElementsByTagName("i"),minus_plus_image=_img[1],comp_imglink=document.getElementById("ze_comp_img"),url_imglink=document.getElementById("ze_url_img"),comp_imglink.removeAttribute("src"),url_imglink.removeAttribute("src"),computer_radio_option=computer_radio.getElementsByTagName("i")[0],url_radio_option=url_radio.getElementsByTagName("i")[0],_small_img_radio_option=_small_img_radio.getElementsByTagName("i")[0],_bestfit_img_radio_option=_bestfit_img_radio.getElementsByTagName("i")[0],_original_img_radio_option=_original_img_radio.getElementsByTagName("i")[0],existing_image?(urlMode(),radio_options_div.style.display="none",url_imglink.src=existing_image.src,url_imglink.style.display="",url_input.disabled=!0,url_input.value=existing_image.src):(computerMode(),radio_options_div.style.display="",url_input.disabled=!1)};ZE.showOverlay(),editor.win.focus(),selectedRange=editor.saveSelection();var tmp='<div class="zep_PUtt">'+I18N("Insert Image")+'<i class="zei-close"></i></div>';tmp+='<div class="zep_PUcen"><form name="ze_img_form" method="post" enctype="multipart/form-data" action="'+imgAction+'" target="ze_img_request">',tmp+='<table class="ze_ptble">',tmp+="<tbody>",tmp+="<tr>",tmp+='<td colspan="2" style="padding-bottom:10px;"><span><i class="zei-option"></i>',tmp+='<label for="ze_img_comp">'+I18N("Upload from Disk")+"</label>",tmp+='</span><span><i class="zei-unoption"></i>',tmp+='<label for="ze_img_url">'+I18N("Link from Web (Url)")+"</label>",tmp+="</span></td>",tmp+="</tr>",tmp+="<tr>",tmp+='<td colspan="2" style="padding-bottom:10px;">',tmp+="<div>",tmp+='<div style="height:0px;width:0px;visibility:hidden;">',tmp+='<input id="uploadfile" type="file" name="img_file">',tmp+="</div>",tmp+="<div>",tmp+='<label for="uploadfile" id="ze_choose_image" class="ze_input_text">'+I18N("Click to choose an image")+"</label>",tmp+="</div>",tmp+='<div style="display: none;"><input  class="ze_input_text"  type="text" placeholder = "'+I18N("Provide an image URL")+'"></div>',tmp+="</div>",tmp+='<p class="ze_iiSnF"><span>'+I18N("Maximum file size supported: "+sizeToDisplay)+'</span></p><span style="display: none;"><img src="'+ZE_Init.getCDNURL("process.gif","image")+'" align="absmiddle" style="margin-right:3px;"><b style="color:#1daf15;">'+I18N("Uploading image...")+'</b></span><span class="ze_iiSnF" style="display:none;"></span>',tmp+="</td>",tmp+="</tr>",tmp+="<tr>",tmp+='<td valign="middle">',tmp+='<div class="ze_iiS"><span><i class="zei-unoption"></i>',tmp+='<label for="ze_img_comp">'+I18N("Small")+"</label>",tmp+="</span></div>",tmp+='<div class="ze_iiS"><span><i class="zei-unoption"></i>',tmp+='<label for="ze_img_comp">'+I18N("Best Fit")+"</label>",tmp+="</span></div>",tmp+='<div class="ze_iiS"><span><i class="zei-option"></i>',tmp+='<label for="ze_img_comp">'+I18N("Original")+"</label>",tmp+="</span></div></td>",tmp+='<td  width="122"><div class="ze_iiI"><span class="ze_iiIP" style="display: block;">Image Preview</span><img id="ze_comp_img" display:="" none;"="" style="display: none;"><img id="ze_url_img" style="width: 100%; height: 100%; display: none;"></div></td>',tmp+="</tr>",tmp+='</tbody></table><input type="hidden" name="'+ZE.getCSRFParamName()+'" value="'+ZE.getCSRFCookie(editor)+'"/></form>',tmp+="</div>",tmp+='<div class="zep_PUbtm"><span class="sel">Insert</span><span data-val="Cancel">Cancel</span></div>';var div1=document.createElement("div");div1.className="zep_PU",div1.id="ze_ins_image",div1.name="ze_ins_image",div1.innerHTML=tmp,document.body.appendChild(div1),ze_ins_image_div=div1,initialise(),ZE.setPosition(ze_ins_image_div,editor.editordiv),setFocus(),ZE._addEvent(editor.doc,"keydown",esckey),ZE._addEvent(document,"keydown",esckey),computer_radio.onclick=function(){document.getElementById("ze_comp_img")&&(document.getElementById("ze_comp_img").style.display=""),document.getElementById("ze_url_img")&&(document.getElementById("ze_url_img").style.display="none"),computerMode(),setFocus()},url_radio.onclick=function(){document.getElementById("ze_comp_img")&&(document.getElementById("ze_comp_img").style.display="none"),document.getElementById("ze_url_img")&&(document.getElementById("ze_url_img").style.display=""),urlMode(),setFocus()},_small_img_radio.onclick=function(){ZE.removeClass(_small_img_radio_option,"zei-unoption"),ZE.addClass(_small_img_radio_option,"zei-option"),ZE.removeClass(_bestfit_img_radio_option,"zei-option"),ZE.addClass(_bestfit_img_radio_option,"zei-unoption"),ZE.removeClass(_original_img_radio_option,"zei-option"),ZE.addClass(_original_img_radio_option,"zei-unoption")},_bestfit_img_radio.onclick=function(){ZE.removeClass(_small_img_radio_option,"zei-option"),ZE.addClass(_small_img_radio_option,"zei-unoption"),ZE.removeClass(_bestfit_img_radio_option,"zei-unoption"),ZE.addClass(_bestfit_img_radio_option,"zei-option"),ZE.removeClass(_original_img_radio_option,"zei-option"),ZE.addClass(_original_img_radio_option,"zei-unoption")},_original_img_radio.onclick=function(){ZE.removeClass(_small_img_radio_option,"zei-option"),ZE.addClass(_small_img_radio_option,"zei-unoption"),ZE.removeClass(_bestfit_img_radio_option,"zei-option"),ZE.addClass(_bestfit_img_radio_option,"zei-unoption"),ZE.removeClass(_original_img_radio_option,"zei-unoption"),ZE.addClass(_original_img_radio_option,"zei-option")},url_img_upload=function(){var tempimgurl=url_input.value;if(0!=tempimgurl.length){var http="http://",https="https://";if(0!==url_input.value.indexOf(http)&&0!==url_input.value.indexOf(https)){var i18n_msg=I18N("Invalid URL. Make sure it starts with "+http+" or "+https+". ");return ZE.insertImageMsg(i18n_msg,"error"),_imgpreview.style.display="block",url_imglink.style.display="none",void url_imglink.removeAttribute("src")}tempimgurl&&url_imglink.src!==tempimgurl&&(_imgpreview.style.display="none",url_imglink.src=tempimgurl,url_imglink.style.display="",url_imglink.onerror=function(){url_imglink.removeAttribute("src"),url_imglink.style.display="none";var i18n_msg=I18N("There are no images found in the specified URL");ZE.insertImageMsg(i18n_msg,"error"),_imgpreview.style.display="block"}),errorspan.style.display="none"}},url_input.onkeyup=url_input.onblur=url_img_upload,url_input.onpaste=url_input.oncut=function(){setTimeout(url_img_upload,50)},fileInputChange=function(ev){var contextParam="",fname=file_input.files?file_input.files[0].name:file_input.value,message="",isInvalid=!1;if(ZE.isContainsXSS(fname)?(message=I18N("Invalid File Name"),isInvalid=!0):fname.length>100?(message=I18N("File Name Too Long"),isInvalid=!0):file_input.files&&file_input.files[0]&&file_input.files[0].size/1048576>maxUploadSize&&(message=I18N("Maximum file size supported: "+sizeToDisplay),isInvalid=!0),isInvalid){if(ZE.insertImageMsg(message,"error"),file_input.value="",""!=file_input.value){var temp_file_input=file_input.cloneNode(!0);temp_file_input.onchange=file_input.onchange,file_input.parentNode.replaceChild(temp_file_input,file_input)}}else{ZE_Init.context&&(_form.action=ZE_Init.imgParameters?imgAction+"&context="+ZE_Init.context:imgAction+"?context="+ZE_Init.context,contextParam="&context="+ZE_Init.context),ZE.captchaParam?(_form.action=ZE_Init.imgParameters||ZE_Init.context?imgAction+"&"+ZE.captchaParam+contextParam:imgAction+"?"+ZE.captchaParam+contextParam,delete ZE.captchaParam):editor._stopEvent(ev),ZE.captchaProcessing=file_input.onchange;var file_input_value=file_input.value;if(""!=file_input.value){if(!/(\.(gif|jpg|jpeg|bmp|png))$/i.test(file_input_value)){var temp_i18n=I18N("Formats: ");return _form.reset(),ZE.insertImageMsg(temp_i18n+" GIF/JPG/PNG","error"),_imgpreview.style.display="block",comp_imglink.style.display="none",comp_imglink.removeAttribute("src"),file_input.focus(),!1}ZE.activeEditor=editor,comp_imglink.style.visibility="hidden",fileinfospan.style.display="none",comp_imglink.style.width="",comp_imglink.style.height="";var file_name;uploadstate="loading",file_name=file_input.files?file_input.files[0].name:file_input.value,comp_imglink.onload=function(){if(uploadstate="finished",comp_imglink.onload=void 0,file_input.disabled=computer_radio.disabled=url_radio.disabled=insert_btn.disabled=!1,infospan.style.display="none",file_name.length>45){var type=file_name.substring(file_name.lastIndexOf("."),file_name.length),name=file_name.substring(0,40)+"..";file_name=name+type}fileinfospan.textContent=I18N(file_name),_imgoriginal_width=this.width,_imgoriginal_height=this.height,comp_imglink.style.width="100%",comp_imglink.style.height="100%",ZE.hasClass(url_radio_option,"zei-option")?(comp_imglink.style.display="none",fileinfospan.style.display="none"):(_imgpreview.style.display="none",fileinfospan.style.display="",errorspan.style.display="none"),comp_imglink.style.visibility="",choose_image.innerHTML=I18N("Replace Image")},file_input.disabled=!1,_form.submit(),file_input.disabled=computer_radio.disabled=url_radio.disabled=insert_btn.disabled=!0,ZE.insertImageMsg(I18N("Uploading Image"),"info")}}},file_input.onchange=fileInputChange,insert_img_btn.onclick=function(ev){ZE_Init.is_ie||(editor._stopEvent(ev),file_input.click())},ze_ins_image_div.getElementsByClassName("zei-close")[0].onclick=cancel_btn.onclick=function(ev){editor._stopEvent(ev),hideImagediv()},insert_btn.onclick=function(ev){ZPFeeds.Editor.addRemovePlaceholder(editor,!1,!0);var updateStyles=function(img){var max_bestfit_width=400,bestfit_width=parseInt(.75*editor.editordiv.offsetWidth);if(bestfit_width>max_bestfit_width&&(bestfit_width=max_bestfit_width),ZE.hasClass(url_radio_option,"zei-option")&&(img.width?(_imgoriginal_width=img.width,_imgoriginal_height=img.height):(_imgoriginal_width=img.naturalWidth,_imgoriginal_height=img.naturalHeight)),img.setAttribute("orig_width",_imgoriginal_width),img.setAttribute("orig_height",_imgoriginal_height),img.setAttribute("size_option","original"),ZE.hasClass(_small_img_radio_option,"zei-option")){var reduce_ratio=2.5;_imgoriginal_width>bestfit_width&&(reduce_ratio=_imgoriginal_width/150),img.width=_imgoriginal_width/reduce_ratio,img.height=_imgoriginal_height/reduce_ratio,img.setAttribute("size_option","small")}else if(ZE.hasClass(_bestfit_img_radio_option,"zei-option")){var reduce_ratio=1;_imgoriginal_width>bestfit_width&&(reduce_ratio=_imgoriginal_width/bestfit_width),img.width=_imgoriginal_width/reduce_ratio,img.height=_imgoriginal_height/reduce_ratio,img.setAttribute("size_option","bestfit")}img.style.display=""};if(existing_image)updateStyles(existing_image);else{var imgurl;if(ZE.hasClass(computer_radio_option,"zei-option")){if(imgurl=editor.imgURL,-1!=imgurl.indexOf("inlineimgpreview?")){var imgarr=imgurl.split("inlineimgpreview");imgurl=urlvalue+"/inlineimgpreview"+imgarr[1]+"&conreqcsr="+csrfToken}if(!file_input.value||!imgurl){var i18n_msg=I18N("Please browse and choose an image");return ZE.insertImageMsg(i18n_msg,"error"),file_input.focus(),!1}}else if(ZE.hasClass(url_radio_option,"zei-option")){if(imgurl=url_input.value,!imgurl){var i18n_msg=I18N("Provide a valid image URL");return ZE.insertImageMsg(i18n_msg,"error"),url_input.focus(),!1}if(!url_imglink.src)return!1}selectedRange&&editor.restoreSelection(selectedRange),editor.win.focus();var newrange,newsel=editor._getSelection();try{newsel.isCollapsed||sel.deleteFromDocument(),newrange=newsel.getRangeAt(0)}catch(e){newrange=editor._createRange(newsel)}var new_img=editor.doc.createElement("img");new_img.src=imgurl,new_img.style.display="none",setTimeout(function(){updateStyles(new_img),editor.saveCurrentState()},500),newrange.insertNode(new_img),newrange.selectNode(new_img),newrange.collapse(!1),newsel.removeAllRanges(),newsel.addRange(newrange)}editor._stopEvent(ev),hideImagediv(),delete editor.imgURL},ZE.prototype.previewImage=function(imgurl){var img,newsel,newrange,editor=this,imgpopup=document.getElementById("ze_ins_image");imgpopup&&"none"!=imgpopup.style.display?(img=document.getElementById("ze_comp_img"),img.src=imgurl,editor.imgURL=imgurl,img.style.display=""):(img=document.createElement("img"),img.src=imgurl,newsel=editor._getSelection(),newrange=editor._createRange(newsel),newrange.insertNode(img),newrange.selectNode(img),newrange.collapse(!1),newsel.removeAllRanges(),newsel.addRange(newrange))}},ZE.insertImageMsg=function(msg,msgtype){"use strict";var _input,_span,_label,choose_image,errorspan,infospan,fileinfospan,_imgpreview,computer_radio,computer_radio_option,file_input,comp_imglink,ze_ins_image_div=document.getElementById("ze_ins_image"),I18N=ZE.i18n;if(ze_ins_image_div)if(_input=ze_ins_image_div.getElementsByTagName("input"),_span=ze_ins_image_div.getElementsByTagName("span"),_label=ze_ins_image_div.getElementsByTagName("label"),choose_image=_label[2],errorspan=_span[2],infospan=_span[3],fileinfospan=_span[4],_imgpreview=_span[8],computer_radio=_span[0],computer_radio_option=computer_radio.getElementsByTagName("i")[0],comp_imglink=document.getElementById("ze_comp_img"),"info"==msgtype)errorspan.innerHTML="",errorspan.style.display="none",infospan.style.display="";else if("error"==msgtype){if(infospan.style.display="none",errorspan.innerHTML=msg,errorspan.style.display="block",ZE.addClass(errorspan,"ze_popuperrmsg"),file_input=_input[0],comp_imglink&&ZE.hasClass(computer_radio_option,"zei-option")){if(comp_imglink.removeAttribute("src"),_imgpreview.style.display="block",comp_imglink.style.display="none",file_input.disabled=!1,file_input.value="",""!=file_input.value){var temp_file_input=file_input.cloneNode(!0);temp_file_input.onchange=file_input.onchange,file_input.parentNode.replaceChild(temp_file_input,file_input)}choose_image.innerHTML=I18N("Click to choose an image"),fileinfospan.style.display="none"}}else"imginfo"==msgtype&&(infospan.style.display="none",errorspan.innerHTML=msg,errorspan.style.display="block")},ZE.insertErrorMsg=function(msg){"use strict";var comp_imglink=document.getElementById("ze_comp_img"),I18N=ZE.i18n;if(comp_imglink){var choose_image,_imgpreview,fileinfospan,errorspan,infospan,ze_ins_image_div=document.getElementById("ze_ins_image"),_span=ze_ins_image_div.getElementsByTagName("span"),computer_radio=_span[0],_input=(_span[1],ze_ins_image_div.getElementsByTagName("input")),_label=ze_ins_image_div.getElementsByTagName("label"),file_input=_input[0];if(choose_image=_label[2],errorspan=_span[2],infospan=_span[3],fileinfospan=_span[4],_imgpreview=_span[8],_input=ze_ins_image_div.getElementsByTagName("input"),_span=ze_ins_image_div.getElementsByTagName("span"),file_input.disabled=computer_radio.disabled=!1,infospan.style.display="none",errorspan.innerHTML=msg,ZE.addClass(errorspan,"ze_popuperrmsg"),errorspan.style.display="",choose_image.innerHTML=I18N("Click to choose an image"),fileinfospan.style.display="none",_imgpreview.style.display="block",comp_imglink.removeAttribute("src"),file_input.value="",""!=file_input.value){var temp_file_input=file_input.cloneNode(!0);temp_file_input.onchange=file_input.onchange,file_input.parentNode.replaceChild(temp_file_input,file_input)}}else alert(msg)},ZE.prototype.resizeElement=function(_target){"use strict";var enclosingDiv,bestFitValue,smallValue,origWidth,origHeight,mainSpan,_small,_bestfit,_original,_remove,smallDiv,value2,currentValX,currentValY,removeDivs,removeEventListenerUp,editor=this,_document=document,I18N=ZE.i18n,imageClicked=!1,doc=editor.doc,image=_target,MIN_WIDTH_THRESHOLD=18,setValues=function(){var maxBestFitWidth=400,bestFitWidth=parseInt(.75*editor.editordiv.offsetWidth),bestFitReduceRatio=1,smallReduceRatio=2.5;if(bestFitWidth>maxBestFitWidth&&(bestFitWidth=maxBestFitWidth),origWidth=image.getAttribute("orig_width"),origHeight=image.getAttribute("orig_height"),origWidth>bestFitWidth&&(bestFitReduceRatio=origWidth/bestFitWidth,smallReduceRatio=origWidth/150),bestFitValue=bestFitReduceRatio,smallValue=smallReduceRatio,image.hasAttribute("size_option")){var selectedValue=image.getAttribute("size_option");"small"===selectedValue?_small.className="ze_sltd":"original"===selectedValue?_original.className="ze_sltd":"bestfit"===selectedValue&&(_bestfit.className="ze_sltd")}},getHeight=function(_element){return parseFloat(_element.style.height)},getWidth=function(_element){return parseFloat(_element.style.width)},getTop=function(_element){return parseFloat(_element.style.top)},getLeft=function(_element){return parseFloat(_element.style.left)},getImageWidth=function(_element){return _element.width||parseFloat(_element.style.width)},setImageHeight=function(_element,value){_element.height=value},setImageWidth=function(_element,value){_element.width=value},setTop=function(_element,value){_element.style.top=value+"px"},setLeft=function(_element,value){_element.style.left=value+"px"},minimumWidth=function(){return getWidth(enclosingDiv)>MIN_WIDTH_THRESHOLD?!0:!1},smallImage=function(){setImageWidth(image,origWidth/smallValue),setImageHeight(image,origHeight/smallValue),image.setAttribute("size_option","small"),editor.win.focus(),removeDivs(),editor.saveCurrentState()},bestfitImage=function(){setImageWidth(image,origWidth/bestFitValue),setImageHeight(image,origHeight/bestFitValue),image.setAttribute("size_option","bestfit"),editor.win.focus(),removeDivs(),editor.saveCurrentState()},removeImage=function(){image.parentElement.removeChild(image),editor.win.focus(),removeDivs(),editor.saveCurrentState()},originalImage=function(){setImageHeight(image,origHeight),setImageWidth(image,origWidth),image.setAttribute("size_option","original"),removeDivs(),editor.win.focus(),editor.saveCurrentState()};mainSpan=doc.createElement("span"),mainSpan.id="ze_imgBlock",mainSpan.className="ze_spell",_small=doc.createElement("span"),_small.innerHTML=I18N("Small"),_bestfit=doc.createElement("span"),_bestfit.innerHTML=I18N("Best Fit"),_original=doc.createElement("span"),_original.innerHTML=I18N("Original"),_remove=doc.createElement("span"),_remove.innerHTML=I18N("Remove"),mainSpan.appendChild(_small),mainSpan.appendChild(_bestfit),mainSpan.appendChild(_original),mainSpan.appendChild(_remove),doc.body.appendChild(mainSpan),ZE._addEvent(_remove,"click",removeImage),ZE._addEvent(_original,"click",originalImage),ZE._addEvent(_small,"click",smallImage),ZE._addEvent(_bestfit,"click",bestfitImage),enclosingDiv=doc.createElement("div"),doc.body.appendChild(enclosingDiv),enclosingDiv.className="enc",value2=image.getBoundingClientRect();var posx=value2.left,posy=value2.top;enclosingDiv.style.left=editor.win.scrollX?posx+editor.win.scrollX+"px":posx+editor.win.pageXOffset+"px",enclosingDiv.style.top=editor.win.scrollY?value2.top+editor.win.scrollY+"px":value2.top+editor.win.pageYOffset+"px",enclosingDiv.style.height=value2.height+"px",enclosingDiv.style.width=value2.width+"px",mainSpan.contentEditable="false",mainSpan.style.left=enclosingDiv.style.left,setTop(mainSpan,getTop(enclosingDiv)+getHeight(enclosingDiv)),setValues(),posy+=editor.win.scrollY?editor.win.scrollY:editor.win.pageYOffset,posx+=editor.win.scrollX?editor.win.scrollX:editor.win.pageXOffset;var smallDiv1=doc.createElement("div");smallDiv1.className="smallDiv",doc.body.appendChild(smallDiv1),smallDiv1.style.top=posy+"px",smallDiv1.style.left=posx+"px",smallDiv1.style.cursor="nw-resize";var smallDiv2=doc.createElement("div");smallDiv2.className="smallDiv",doc.body.appendChild(smallDiv2),smallDiv2.style.top=posy+"px",smallDiv2.style.left=posx+value2.width-9+"px",smallDiv2.style.cursor="ne-resize";var smallDiv3=doc.createElement("div");smallDiv3.className="smallDiv",doc.body.appendChild(smallDiv3),smallDiv3.style.top=posy+value2.height-9+"px",smallDiv3.style.left=posx+value2.width-9+"px",smallDiv3.style.cursor="se-resize";var smallDiv4=doc.createElement("div");smallDiv4.className="smallDiv",doc.body.appendChild(smallDiv4),smallDiv4.style.top=posy+value2.height-9+"px",smallDiv4.style.left=posx+"px",smallDiv4.style.cursor="sw-resize";var mouseDown=function(ev){var _target1,$zeLink=doc.getElementById("ze_imgBlock");if(ev)for(_target1=ev.target;null!==_target1&&(_target1!==$zeLink&&_target1!==smallDiv1&&_target1!==smallDiv2&&_target1!==smallDiv3&&_target1!==smallDiv4&&_target1!==image);_target1=_target1.parentNode);_target1||removeDivs()},keyDown=function(ev){var kCode=ev.keyCode;46===kCode?removeImage():removeDivs()},setPosDivs=function(){smallDiv1.style.left=enclosingDiv.style.left,smallDiv1.style.top=enclosingDiv.style.top,setLeft(smallDiv2,getWidth(enclosingDiv)+getLeft(enclosingDiv)-9),smallDiv2.style.top=enclosingDiv.style.top,smallDiv3.style.left=enclosingDiv.style.left,setTop(smallDiv3,getHeight(enclosingDiv)+getTop(enclosingDiv)-9),setLeft(smallDiv4,getWidth(enclosingDiv)+getLeft(enclosingDiv)-9),setTop(smallDiv4,getHeight(enclosingDiv)+getTop(enclosingDiv)-9)};removeDivs=function(){var $zeLink=doc.getElementById("ze_imgBlock");$zeLink&&doc.body.removeChild($zeLink),ZE._removeEvent(doc,"mousedown",mouseDown),ZE._removeEvent(_document,"mousedown",mouseDown),ZE._removeEvent(doc,"keydown",keyDown),smallDiv1&&(smallDiv1.parentElement.removeChild(smallDiv1),smallDiv2.parentElement.removeChild(smallDiv2),smallDiv3.parentElement.removeChild(smallDiv3),smallDiv4.parentElement.removeChild(smallDiv4),enclosingDiv.parentElement.removeChild(enclosingDiv))};var startResize=function(ev){smallDiv=this,imageClicked=!0,editor._stopEvent(ev),currentValX=ev.clientX,currentValY=ev.clientY,ZE._removeEvent(doc,"mousedown",mouseDown),ZE._removeEvent(_document,"mousedown",mouseDown),ZE._removeEvent(doc,"keydown",keyDown),ZE._addEvent(doc,"mousemove",doMouseMove),ZE._addEvent(doc,"mouseup",doMouseUp)},alterImage=function(){image.height=parseFloat(enclosingDiv.style.height),image.width=parseFloat(enclosingDiv.style.width),image.style.width&&(image.style.width=""),image.style.height&&(image.style.height="")},mouseUp=function(){imageClicked=!1,removeEventListenerUp(),alterImage(),ZE._removeEvent(smallDiv1,"mousedown",startResize),ZE._removeEvent(smallDiv2,"mousedown",startResize),ZE._removeEvent(smallDiv3,"mousedown",startResize),ZE._removeEvent(smallDiv4,"mousedown",startResize),smallDiv1.parentElement.removeChild(smallDiv1),smallDiv2.parentElement.removeChild(smallDiv2),smallDiv3.parentElement.removeChild(smallDiv3),smallDiv4.parentElement.removeChild(smallDiv4),enclosingDiv.parentElement.removeChild(enclosingDiv);var zeLink=doc.getElementById("ze_imgBlock");zeLink&&doc.body.removeChild(zeLink),getImageWidth(image)===origWidth/bestFitValue?image.setAttribute("size_option","bestfit"):getImageWidth(image)===origWidth/smallValue?image.setAttribute("size_option","small"):getImageWidth(image)===origWidth&&image.setAttribute("size_option","original"),editor.saveCurrentState()},mouseMove=function(_div,e){if(imageClicked){if(e.clientX<=0||e.clientY<=0||e.clientX>editor.editordiv.offsetWidth)return void mouseUp(_div);var rightSide,topHandler,diff,ratio,valueToadd,tempValue,valueTosub,divX,divY,enHeight=(getLeft(enclosingDiv),getTop(enclosingDiv),getHeight(enclosingDiv)),enWidth=getWidth(enclosingDiv);_div===smallDiv2?(rightSide=0,topHandler=0):_div===smallDiv3?(rightSide=0,topHandler=1):_div===smallDiv4?(rightSide=1,topHandler=0):(rightSide=1,topHandler=1),e.clientX<currentValX?(diff=currentValX-e.clientX,0===rightSide?minimumWidth()&&(ratio=enWidth/(enWidth-diff),enWidth/=ratio,valueToadd=enHeight-enHeight/ratio,enHeight/=ratio,ZE.setCss(enclosingDiv,"height",enHeight+"px"),ZE.setCss(enclosingDiv,"width",enWidth+"px"),0===topHandler&&setTop(enclosingDiv,getTop(enclosingDiv)+valueToadd)):(ratio=(enWidth+diff)/enWidth,tempValue=enWidth-enWidth/ratio,enWidth+=enWidth-enWidth/ratio,valueTosub=enHeight-enHeight/ratio,enHeight+=enHeight-enHeight/ratio,ZE.setCss(enclosingDiv,"height",enHeight+"px"),ZE.setCss(enclosingDiv,"width",enWidth+"px"),divX=getLeft(enclosingDiv),divY=getTop(enclosingDiv),setLeft(enclosingDiv,divX-tempValue),1===topHandler&&setTop(enclosingDiv,getTop(enclosingDiv)-valueTosub))):(diff=e.clientX-currentValX,0===rightSide?(ratio=(enWidth+diff)/enWidth,enWidth+=enWidth-enWidth/ratio,valueToadd=enHeight-enHeight/ratio,enHeight+=valueToadd,ZE.setCss(enclosingDiv,"height",enHeight+"px"),ZE.setCss(enclosingDiv,"width",enWidth+"px"),0===topHandler&&setTop(enclosingDiv,getTop(enclosingDiv)-valueToadd)):minimumWidth()&&(ratio=enWidth/(enWidth-diff),tempValue=enWidth-enWidth/ratio,enWidth/=ratio,valueTosub=enHeight-enHeight/ratio,enHeight/=ratio,ZE.setCss(enclosingDiv,"height",enHeight+"px"),ZE.setCss(enclosingDiv,"width",enWidth+"px"),divX=getLeft(enclosingDiv),setLeft(enclosingDiv,divX+tempValue),1===topHandler&&setTop(enclosingDiv,getTop(enclosingDiv)+valueTosub))),setPosDivs(),currentValX=e.clientX,currentValY=e.clientY,image.hasAttribute("size_option")&&image.removeAttribute("size_option")}},doMouseMove=function(event){mouseMove(smallDiv,event)},doMouseUp=function(event){editor._stopEvent(event),mouseUp(smallDiv,event)};removeEventListenerUp=function(){ZE._removeEvent(doc,"mousemove",doMouseMove),ZE._removeEvent(doc,"mouseup",doMouseUp)},ZE._addEvent(doc,"mousedown",mouseDown),ZE._addEvent(_document,"mousedown",mouseDown),ZE._addEvent(doc,"keydown",keyDown),ZE._addEvent(smallDiv1,"mousedown",startResize),ZE._addEvent(smallDiv2,"mousedown",startResize),ZE._addEvent(smallDiv3,"mousedown",startResize),ZE._addEvent(smallDiv4,"mousedown",startResize)},ZE.prototype.insertImage=function(imgUrl,options,attributes){"use strict";var image,origWidth,origHeight,modifiedDimensions,attrObj,sizeOption,editor=this;if(options=options||{},sizeOption=options.size||"original",imgUrl){var getDimensionValues=function(width,height,option){var modifiedWidth,modifiedHeight,reduceRatio,MAX_BESTFIT_WIDTH=400,bestFitWidth=parseInt(.75*editor.editordiv.offsetWidth);return option=option||"original",bestFitWidth>MAX_BESTFIT_WIDTH&&(bestFitWidth=MAX_BESTFIT_WIDTH),"small"===option?(reduceRatio=2.5,width>bestFitWidth&&(reduceRatio=width/150),modifiedWidth=width/reduceRatio,modifiedHeight=height/reduceRatio):""===option?(reduceRatio=1,width>bestFitWidth&&(reduceRatio=width/bestFitWidth),modifiedWidth=width/reduceRatio,modifiedHeight=height/reduceRatio):(modifiedWidth=width,modifiedHeight=height),{width:modifiedWidth,height:modifiedHeight}};image="function"==typeof Image?new Image:document.createElement("img"),image.onload=function(){attrObj=attributes||{},origWidth=this.width,origHeight=this.height,attrObj.orig_width=origWidth,attrObj.orig_height=origHeight,modifiedDimensions=getDimensionValues(origWidth,origHeight,sizeOption),attrObj.style=attrObj.style||"",this.width=modifiedDimensions.width,this.height=modifiedDimensions.height,attrObj.size_option=sizeOption,editor.squireInstance.insertImage(imgUrl,attrObj)},image.onerror=function(){},image.src=imgUrl}},ZE.prototype.createVideo=function(){var imgAction,computer_radio,url_radio,file_input,url_input,last_fectedUrl,insert_btn,cancel_btn,comp_imglink,url_imglink,errorspan,infospan,choose_image,fileinfospan,uploadstate,_img,minus_plus_image,radio_options_div,from_computer_div,from_url_div,_small_img_radio,_bestfit_img_radio,_original_img_radio,_imgpreview,_imgoriginal_width,_imgoriginal_height,url_radio_option,computer_radio_option,_small_img_radio_option,_bestfit_img_radio_option,_original_img_radio_option,insert_img_btn,selectedRange,editor=this,ze_ins_image_div=document.getElementById("ze_ins_video"),I18N=ZE.i18n,DEFAULTIMAGEOPTION="bestfit",existing_image=editor.getParentElement(),maxUploadSize=editor.initobj.imgMaxUploadSize||ZE_Init.maxImageUploadSize||5,sizeToDisplay=maxUploadSize+" MB";1>maxUploadSize&&(sizeToDisplay=1024*maxUploadSize+" KB"),imgAction="function"==typeof editor.initobj.getImgUploadAction?editor.initobj.getImgUploadAction():editor.initobj.imgAction||ZE_Init.imgAction;existing_image&&"VIDEO"!==existing_image.nodeName&&(existing_image=void 0),"function"==typeof editor.initobj.getImgUploadParameters?imgAction+=editor.initobj.getImgUploadParameters():("function"==typeof ZE_Init.imgParametersFunction&&ZE_Init.imgParametersFunction(),ZE_Init.imgParameters&&(imgAction+=ZE_Init.imgParameters));var hideVideodiv=function(){ze_ins_image_div.parentNode.removeChild(ze_ins_image_div),ZE.hideOverlay(),file_input.disabled=computer_radio.disabled=url_radio.disabled=insert_btn.disabled=!1,editor.win.focus(),ZE._removeEvent(document,"keydown",esckey),ZE._removeEvent(editor.doc,"keydown",esckey),comp_imglink.removeAttribute("src"),url_imglink.removeAttribute("src"),comp_imglink.style.display="none",url_imglink.style.display="none",ZE.activeEditor&&delete ZE.activeEditor,ZE.captchaProcessing&&delete ZE.captchaProcessing,ZPFeeds.Editor.addRemovePlaceholder(editor,!1)},esckey=function(ev){var captcha_Div=document.getElementById("ze_captcha");if(27==ev.keyCode){if(captcha_Div&&"none"!==captcha_Div.style.display)return void(captcha_Div.style.display="none");editor._stopEvent(ev),hideVideodiv()}},computerMode=function(){var imageOption=editor.initobj.defaultImageOption||DEFAULTIMAGEOPTION;ZE.removeClass(computer_radio_option,"zei-unoption"),ZE.addClass(computer_radio_option,"zei-option"),ZE.removeClass(url_radio_option,"zei-option"),ZE.addClass(url_radio_option,"zei-unoption"),"bestfit"===imageOption?(ZE.removeClass(_small_img_radio_option,"zei-option"),ZE.addClass(_small_img_radio_option,"zei-unoption"),ZE.removeClass(_bestfit_img_radio_option,"zei-unoption"),ZE.addClass(_bestfit_img_radio_option,"zei-option"),ZE.removeClass(_original_img_radio_option,"zei-option"),ZE.addClass(_original_img_radio_option,"zei-unoption")):"smallfit"===imageOption?(ZE.removeClass(_small_img_radio_option,"zei-unoption"),ZE.addClass(_small_img_radio_option,"zei-option"),ZE.removeClass(_bestfit_img_radio_option,"zei-option"),ZE.addClass(_bestfit_img_radio_option,"zei-unoption"),ZE.removeClass(_original_img_radio_option,"zei-option"),ZE.addClass(_original_img_radio_option,"zei-unoption")):(ZE.removeClass(_small_img_radio_option,"zei-option"),ZE.addClass(_small_img_radio_option,"zei-unoption"),ZE.removeClass(_bestfit_img_radio_option,"zei-option"),ZE.addClass(_bestfit_img_radio_option,"zei-unoption"),ZE.removeClass(_original_img_radio_option,"zei-unoption"),ZE.addClass(_original_img_radio_option,"zei-option")),from_computer_div.style.display="",from_url_div.style.display="none",comp_imglink.src?(comp_imglink.style.display="",_imgpreview.style.display="none",fileinfospan.style.display="",errorspan.style.display="none",infospan.style.display="none"):(_imgpreview.style.display="block",comp_imglink.style.display="none",uploadstate&&"finished"!=uploadstate?uploadstate&&"loading"==uploadstate&&(infospan.style.display="",errorspan.style.display="none"):(ZE.insertVideoMsg(I18N("Maximum file size supported: "+sizeToDisplay),"imginfo"),ZE.removeClass(errorspan,"ze_popuperrmsg"),infospan.style.display="none")),url_imglink.style.display="none"},urlMode=function(){var imageOption=editor.initobj.defaultImageOption||DEFAULTIMAGEOPTION;ZE.removeClass(computer_radio_option,"zei-option"),ZE.addClass(computer_radio_option,"zei-unoption"),ZE.removeClass(url_radio_option,"zei-unoption"),ZE.addClass(url_radio_option,"zei-option"),"bestfit"===imageOption?(ZE.removeClass(_small_img_radio_option,"zei-option"),ZE.addClass(_small_img_radio_option,"zei-unoption"),ZE.removeClass(_bestfit_img_radio_option,"zei-unoption"),ZE.addClass(_bestfit_img_radio_option,"zei-option"),ZE.removeClass(_original_img_radio_option,"zei-option"),ZE.addClass(_original_img_radio_option,"zei-unoption")):"smallfit"===imageOption?(ZE.removeClass(_small_img_radio_option,"zei-unoption"),ZE.addClass(_small_img_radio_option,"zei-option"),ZE.removeClass(_bestfit_img_radio_option,"zei-option"),ZE.addClass(_bestfit_img_radio_option,"zei-unoption"),ZE.removeClass(_original_img_radio_option,"zei-option"),ZE.addClass(_original_img_radio_option,"zei-unoption")):(ZE.removeClass(_small_img_radio_option,"zei-option"),ZE.addClass(_small_img_radio_option,"zei-unoption"),ZE.removeClass(_bestfit_img_radio_option,"zei-option"),ZE.addClass(_bestfit_img_radio_option,"zei-unoption"),ZE.removeClass(_original_img_radio_option,"zei-unoption"),ZE.addClass(_original_img_radio_option,"zei-option")),from_computer_div.style.display="none",from_url_div.style.display="",ZE.insertVideoMsg(ZPI18N.getString("zp.feedurlinfosupportlink"),"imginfo"),comp_imglink.style.display="none",url_imglink.src?(url_imglink.style.display="",_imgpreview.style.display="none"):(url_imglink.style.display="none",_imgpreview.style.display="block"),url_input.focus(),fileinfospan.style.display="none",infospan.style.display="none"},setFocus=function(){existing_image?insert_btn.focus():url_radio.checked&&url_input.focus()},initialise=function(){var _input=ze_ins_image_div.getElementsByTagName("input");file_input=_input[0],url_input=_input[1];var _span=ze_ins_image_div.getElementsByTagName("span"),_label=ze_ins_image_div.getElementsByTagName("label");computer_radio=_span[0],url_radio=_span[1],choose_image=_label[2],errorspan=_span[2],infospan=_span[3],fileinfospan=_span[4],_small_img_radio=_span[5],_bestfit_img_radio=_span[6],_original_img_radio=_span[7],_imgpreview=_span[8],insert_btn=_span[9],cancel_btn=_span[10];var _div=ze_ins_image_div.getElementsByTagName("div");from_computer_div=_div[3],from_url_div=_div[5],insert_img_btn=from_computer_div=_div[4];var _td=ze_ins_image_div.getElementsByTagName("td");radio_options_div=_td[0],_img=ze_ins_image_div.getElementsByTagName("i"),minus_plus_image=_img[1],comp_imglink=document.getElementById("ze_comp_img"),url_imglink=document.getElementById("ze_url_img"),comp_imglink.removeAttribute("src"),url_imglink.removeAttribute("src"),computer_radio_option=computer_radio.getElementsByTagName("i")[0],url_radio_option=url_radio.getElementsByTagName("i")[0],_small_img_radio_option=_small_img_radio.getElementsByTagName("i")[0],_bestfit_img_radio_option=_bestfit_img_radio.getElementsByTagName("i")[0],_original_img_radio_option=_original_img_radio.getElementsByTagName("i")[0],existing_image?(urlMode(),radio_options_div.style.display="none",url_imglink.src=existing_image.src,url_imglink.style.display="",url_input.disabled=!0,url_input.value=existing_image.src):(computerMode(),radio_options_div.style.display="",url_input.disabled=!1)};ZE.showOverlay(),editor.win.focus(),selectedRange=editor.saveSelection();var tmp='<div class="zep_PUtt">'+I18N("Insert Video")+'<i class="zei-close"></i></div>';tmp+='<div class="zep_PUcen"><form>',tmp+='<table class="ze_ptble">',tmp+="<tbody>",tmp+="<tr>",tmp+='<td colspan="2" style="padding-bottom:10px;"><span><i class="zei-option"></i>',tmp+='<label for="ze_img_comp">'+I18N("Upload from Disk")+"</label>",tmp+='</span><span><i class="zei-unoption"></i>',tmp+='<label for="ze_img_url">'+I18N("Link from Web (Url)")+"</label>",tmp+="</span></td>",tmp+="</tr>",tmp+="<tr>",tmp+='<td colspan="2" style="padding-bottom:10px;">',tmp+="<div>",tmp+='<div style="height:0px;width:0px;visibility:hidden;">',tmp+='<input id="uploadfile" type="file" name="img_file">',tmp+="</div>",tmp+="<div>",tmp+='<label for="uploadfile" id="ze_choose_image" class="ze_input_text">'+I18N("Click to choose")+"</label>",tmp+="</div>",tmp+='<div style="display: none;"><input  class="ze_input_text"  type="text" placeholder = "'+I18N("Provide an URL")+'"></div>',tmp+="</div>",tmp+='<p class="ze_iiSnF"><span>'+I18N("Maximum file size supported: "+sizeToDisplay)+'</span></p><span style="display: none;"><img src="'+ZE_Init.getCDNURL("process.gif","image")+'" align="absmiddle" style="margin-right:3px;"><b style="color:#1daf15;">'+I18N("Uploading ...")+'</b></span><span class="ze_iiSnF" style="display:none;"></span>',tmp+="</td>",tmp+="</tr>",tmp+="<tr>",tmp+='<td valign="middle">',tmp+='<div class="ze_iiS"><span><i class="zei-unoption"></i>',tmp+='<label for="ze_img_comp">'+I18N("Small")+"</label>",tmp+="</span></div>",tmp+='<div class="ze_iiS"><span><i class="zei-unoption"></i>',tmp+='<label for="ze_img_comp">'+I18N("Best Fit")+"</label>",tmp+="</span></div>",tmp+='<div class="ze_iiS"><span><i class="zei-option"></i>',tmp+='<label for="ze_img_comp">'+I18N("Original")+"</label>",tmp+="</span></div></td>",tmp+='<td  width="122"><div class="ze_iiI"><span class="ze_iiIP" style="display: block;">Preview</span><video id="ze_comp_img" display:="" none;"="" style="display: none;"></video><iframe id="ze_url_img" style="width: 100%; height: 100%; display: none;" frameborder="0" allowfullscreen=""></iframe></div></td>',tmp+="</tr>",tmp+='</tbody></table><input type="hidden" name="'+ZE.getCSRFParamName()+'" value="'+ZE.getCSRFCookie(editor)+'"/></form>',tmp+="</div>",tmp+='<div class="zep_PUbtm"><span class="sel">Insert</span><span data-val="Cancel">Cancel</span></div>';var div1=document.createElement("div");div1.className="zep_PU",div1.id="ze_ins_video",div1.name="ze_ins_video",div1.innerHTML=tmp,document.body.appendChild(div1),ze_ins_image_div=div1,initialise(),ZE.setPosition(ze_ins_image_div,editor.editordiv),setFocus(),ZE._addEvent(editor.doc,"keydown",esckey),ZE._addEvent(document,"keydown",esckey),computer_radio.onclick=function(){document.getElementById("ze_comp_img")&&(document.getElementById("ze_comp_img").style.display=""),document.getElementById("ze_url_img")&&(document.getElementById("ze_url_img").style.display="none"),computerMode(),setFocus()},url_radio.onclick=function(){document.getElementById("ze_comp_img")&&(document.getElementById("ze_comp_img").style.display="none"),document.getElementById("ze_url_img")&&(document.getElementById("ze_url_img").style.display=""),urlMode(),setFocus()},_small_img_radio.onclick=function(){ZE.removeClass(_small_img_radio_option,"zei-unoption"),ZE.addClass(_small_img_radio_option,"zei-option"),ZE.removeClass(_bestfit_img_radio_option,"zei-option"),ZE.addClass(_bestfit_img_radio_option,"zei-unoption"),ZE.removeClass(_original_img_radio_option,"zei-option"),ZE.addClass(_original_img_radio_option,"zei-unoption")},_bestfit_img_radio.onclick=function(){ZE.removeClass(_small_img_radio_option,"zei-option"),ZE.addClass(_small_img_radio_option,"zei-unoption"),ZE.removeClass(_bestfit_img_radio_option,"zei-unoption"),ZE.addClass(_bestfit_img_radio_option,"zei-option"),ZE.removeClass(_original_img_radio_option,"zei-option"),ZE.addClass(_original_img_radio_option,"zei-unoption")},_original_img_radio.onclick=function(){ZE.removeClass(_small_img_radio_option,"zei-option"),ZE.addClass(_small_img_radio_option,"zei-unoption"),ZE.removeClass(_bestfit_img_radio_option,"zei-option"),ZE.addClass(_bestfit_img_radio_option,"zei-unoption"),ZE.removeClass(_original_img_radio_option,"zei-unoption"),ZE.addClass(_original_img_radio_option,"zei-option")},url_img_upload=function(){var tempimgurl=url_input.value;if(0!=tempimgurl.length){var http="http://",https="https://";if(0!==url_input.value.indexOf(http)&&0!==url_input.value.indexOf(https)){var i18n_msg=I18N("Invalid URL. Make sure it starts with "+http+" or "+https+". ");return ZE.insertVideoMsg(i18n_msg,"error"),_imgpreview.style.display="block",url_imglink.style.display="none",void url_imglink.removeAttribute("src")}tempimgurl&&last_fectedUrl!==tempimgurl&&(_imgpreview.style.display="none",url_imglink.style.display="",last_fectedUrl=tempimgurl,ZE.insertVideoMsg("Fetching...","info"),"function"==typeof editor.initobj.getImgUploadAction?imgAction=editor.initobj.getImgUploadAction(void 0,!0,tempimgurl):ZPFeeds.Editor.editorInlineImgUpload(void 0,!0,tempimgurl)),errorspan.style.display="none"}},url_input.onblur=url_img_upload,fileInputChange=function(ev){if(file_input.files&&file_input.files[0]&&file_input.files[0].size/1048576>maxUploadSize){if(ZE.insertVideoMsg(I18N("Maximum file size supported: "+sizeToDisplay),"error"),file_input.value="",""!=file_input.value){var temp_file_input=file_input.cloneNode(!0);temp_file_input.onchange=file_input.onchange,file_input.parentNode.replaceChild(temp_file_input,file_input)}}else{editor._stopEvent(ev);var file_input_value=file_input.value;if(""!=file_input.value){if(!/(\.(mp4|mkv|mov))$/i.test(file_input_value)){var temp_i18n=I18N("Formats: ");return ZE.insertVideoMsg(temp_i18n+" mp4/mkv/mov","error"),_imgpreview.style.display="block",comp_imglink.style.display="none",comp_imglink.removeAttribute("src"),file_input.focus(),!1}ZE.activeEditor=editor,comp_imglink.style.visibility="hidden",fileinfospan.style.display="none",comp_imglink.style.width="",comp_imglink.style.height="";var file_name;uploadstate="loading",file_name=file_input.files?file_input.files[0].name:file_input.value,file_input.disabled=!1,file_input.disabled=computer_radio.disabled=url_radio.disabled=insert_btn.disabled=!0,ZE.insertVideoMsg(I18N("Uploading..."),"info"),"function"==typeof editor.initobj.getImgUploadAction?imgAction=editor.initobj.getImgUploadAction(file_input):ZPFeeds.Editor.editorInlineImgUpload(file_input)}}},file_input.onchange=fileInputChange,insert_img_btn.onclick=function(ev){ZE_Init.is_ie||(editor._stopEvent(ev),file_input.click())},ze_ins_image_div.getElementsByClassName("zei-close")[0].onclick=cancel_btn.onclick=function(ev){editor._stopEvent(ev),hideVideodiv()},insert_btn.onclick=function(ev){ZPFeeds.Editor.addRemovePlaceholder(editor,!1,!0);var updateStyles=function(img){var max_bestfit_width=400,bestfit_width=parseInt(.75*editor.editordiv.offsetWidth);if(bestfit_width>max_bestfit_width&&(bestfit_width=max_bestfit_width),img.setAttribute("size_option","original"),img.setAttribute("orig_width",_imgoriginal_width),img.setAttribute("orig_height",_imgoriginal_height),ZE.hasClass(_small_img_radio_option,"zei-option")){var reduce_ratio=2.5;_imgoriginal_width>bestfit_width&&(reduce_ratio=_imgoriginal_width/150),img.width=_imgoriginal_width/reduce_ratio,img.height=_imgoriginal_height/reduce_ratio,img.setAttribute("size_option","small")}else if(ZE.hasClass(_bestfit_img_radio_option,"zei-option")){var reduce_ratio=1;_imgoriginal_width>bestfit_width&&(reduce_ratio=_imgoriginal_width/bestfit_width),img.width=_imgoriginal_width/reduce_ratio,img.height=_imgoriginal_height/reduce_ratio,img.setAttribute("size_option","bestfit")}img.style.display=""};if(existing_image)updateStyles(existing_image);else{var imgurl=editor.imgURL;if(ZE.hasClass(computer_radio_option,"zei-option")){if(!file_input.value||!imgurl){var i18n_msg=I18N("Please browse and choose");return ZE.insertVideoMsg(i18n_msg,"error"),file_input.focus(),!1}}else if(ZE.hasClass(url_radio_option,"zei-option")){if(!imgurl){var i18n_msg=I18N("Provide a valid URL");return ZE.insertVideoMsg(i18n_msg,"error"),url_input.focus(),!1}if(!url_imglink.src)return!1}selectedRange&&editor.restoreSelection(selectedRange),editor.win.focus();var newrange,newsel=editor._getSelection();try{newsel.isCollapsed||sel.deleteFromDocument(),newrange=newsel.getRangeAt(0)}catch(e){newrange=editor._createRange(newsel)}var new_img=editor.doc.createElement("video");ZE.hasClass(url_radio_option,"zei-option")&&(new_img=editor.doc.createElement("iframe"),new_img.setAttribute("mode","urlmode")),void 0!==editor.thumburl&&(new_img.setAttribute("accesskey",editor.thumburl),delete editor.thumburl),new_img.setAttribute("embedvideo",!0),new_img.src=imgurl,new_img.style.display="none",setTimeout(function(){updateStyles(new_img),editor.saveCurrentState()},500),newrange.insertNode(new_img),newrange.selectNode(new_img),newrange.collapse(!1),newsel.removeAllRanges(),newsel.addRange(newrange)}editor._stopEvent(ev),hideVideodiv(),delete editor.imgURL},ZE.prototype.previewVideo=function(imgurl,isurlmode,thumburl){var img,newsel,newrange,editor=this,imgpopup=document.getElementById("ze_ins_video");if(void 0===imgurl){var i18n_msg="Error Occured";return isurlmode&&(i18n_msg=I18N("There are no video found in the specified URL")),ZE.insertVideoMsg(i18n_msg,"error"),url_input.focus(),!1}uploadstate="finished",infospan.style.display="none",file_input.disabled=computer_radio.disabled=url_radio.disabled=insert_btn.disabled=!1,infospan.style.display="none",imgpopup&&"none"!=imgpopup.style.display?(isurlmode?(img=document.getElementById("ze_url_img"),url_imglink.style.width="100%",url_imglink.style.height="100%"):(comp_imglink.style.width="100%",comp_imglink.style.height="100%",ZE.hasClass(url_radio_option,"zei-option")?(comp_imglink.style.display="none",fileinfospan.style.display="none"):(_imgpreview.style.display="none",fileinfospan.style.display="",errorspan.style.display="none"),comp_imglink.style.visibility="",choose_image.innerHTML=I18N("Replace.."),img=document.getElementById("ze_comp_img")),editor.thumburl=thumburl,_imgoriginal_width=400,_imgoriginal_height=300,img.src=imgurl,editor.imgURL=imgurl,img.style.display=""):(img=document.createElement(isurlmode?"iframe":"video"),editor.thumburl=thumburl,img.src=imgurl,newsel=editor._getSelection(),newrange=editor._createRange(newsel),newrange.insertNode(img),newrange.selectNode(img),newrange.collapse(!1),newsel.removeAllRanges(),newsel.addRange(newrange))}},ZE.insertVideoMsg=function(msg,msgtype){"use strict";var _input,_span,_label,choose_image,errorspan,infospan,fileinfospan,_imgpreview,computer_radio,computer_radio_option,file_input,comp_imglink,ze_ins_image_div=document.getElementById("ze_ins_video"),I18N=ZE.i18n;if(ze_ins_image_div)if(_input=ze_ins_image_div.getElementsByTagName("input"),_span=ze_ins_image_div.getElementsByTagName("span"),_label=ze_ins_image_div.getElementsByTagName("label"),choose_image=_label[2],errorspan=_span[2],infospan=_span[3],fileinfospan=_span[4],_imgpreview=_span[8],computer_radio=_span[0],computer_radio_option=computer_radio.getElementsByTagName("i")[0],comp_imglink=document.getElementById("ze_comp_img"),"info"==msgtype)errorspan.innerHTML="",errorspan.style.display="none",$(infospan).find("b")[0].innerHTML=msg,infospan.style.display="";else if("error"==msgtype){if(infospan.style.display="none",errorspan.innerHTML=msg,errorspan.style.display="block",ZE.addClass(errorspan,"ze_popuperrmsg"),file_input=_input[0],comp_imglink&&ZE.hasClass(computer_radio_option,"zei-option")){if(comp_imglink.removeAttribute("src"),_imgpreview.style.display="block",comp_imglink.style.display="none",file_input.disabled=!1,file_input.value="",""!=file_input.value){var temp_file_input=file_input.cloneNode(!0);temp_file_input.onchange=file_input.onchange,file_input.parentNode.replaceChild(temp_file_input,file_input)}choose_image.innerHTML=I18N("Click to choose"),fileinfospan.style.display="none"}}else"imginfo"==msgtype&&(infospan.style.display="none",errorspan.innerHTML=msg,errorspan.style.display="block")},ZE.insertVideoErrorMsg=function(msg){"use strict";var comp_imglink=document.getElementById("ze_comp_img"),I18N=ZE.i18n;if(comp_imglink){var choose_image,_imgpreview,fileinfospan,errorspan,infospan,ze_ins_image_div=document.getElementById("ze_ins_video"),_span=ze_ins_image_div.getElementsByTagName("span"),computer_radio=_span[0],_input=(_span[1],ze_ins_image_div.getElementsByTagName("input")),_label=ze_ins_image_div.getElementsByTagName("label"),file_input=_input[0];if(choose_image=_label[2],errorspan=_span[2],infospan=_span[3],fileinfospan=_span[4],_imgpreview=_span[8],_input=ze_ins_image_div.getElementsByTagName("input"),_span=ze_ins_image_div.getElementsByTagName("span"),file_input.disabled=computer_radio.disabled=!1,infospan.style.display="none",errorspan.innerHTML=msg,ZE.addClass(errorspan,"ze_popuperrmsg"),errorspan.style.display="",choose_image.innerHTML=I18N("Click to choose"),fileinfospan.style.display="none",_imgpreview.style.display="block",comp_imglink.removeAttribute("src"),file_input.value="",""!=file_input.value){var temp_file_input=file_input.cloneNode(!0);temp_file_input.onchange=file_input.onchange,file_input.parentNode.replaceChild(temp_file_input,file_input)}}else alert(msg)},ZE.prototype.resizeElement=function(_target){"use strict";var enclosingDiv,bestFitValue,smallValue,origWidth,origHeight,mainSpan,_small,_bestfit,_original,_remove,smallDiv,value2,currentValX,currentValY,removeDivs,removeEventListenerUp,editor=this,_document=document,I18N=ZE.i18n,imageClicked=!1,doc=editor.doc,image=_target,MIN_WIDTH_THRESHOLD=18,setValues=function(){var maxBestFitWidth=400,bestFitWidth=parseInt(.75*editor.editordiv.offsetWidth),bestFitReduceRatio=1,smallReduceRatio=2.5;if(bestFitWidth>maxBestFitWidth&&(bestFitWidth=maxBestFitWidth),origWidth=image.getAttribute("orig_width"),origHeight=image.getAttribute("orig_height"),origWidth>bestFitWidth&&(bestFitReduceRatio=origWidth/bestFitWidth,smallReduceRatio=origWidth/150),bestFitValue=bestFitReduceRatio,smallValue=smallReduceRatio,image.hasAttribute("size_option")){var selectedValue=image.getAttribute("size_option");"small"===selectedValue?_small.className="ze_sltd":"original"===selectedValue?_original.className="ze_sltd":"bestfit"===selectedValue&&(_bestfit.className="ze_sltd")}},getHeight=function(_element){return parseFloat(_element.style.height)},getWidth=function(_element){return parseFloat(_element.style.width)},getTop=function(_element){return parseFloat(_element.style.top)},getLeft=function(_element){return parseFloat(_element.style.left)},getImageWidth=function(_element){return _element.width||parseFloat(_element.style.width)},setImageHeight=function(_element,value){_element.height=value},setImageWidth=function(_element,value){_element.width=value},setTop=function(_element,value){_element.style.top=value+"px"},setLeft=function(_element,value){_element.style.left=value+"px"},minimumWidth=function(){return getWidth(enclosingDiv)>MIN_WIDTH_THRESHOLD?!0:!1},smallImage=function(){setImageWidth(image,origWidth/smallValue),setImageHeight(image,origHeight/smallValue),image.setAttribute("size_option","small"),editor.win.focus(),removeDivs(),editor.saveCurrentState()},bestfitImage=function(){setImageWidth(image,origWidth/bestFitValue),setImageHeight(image,origHeight/bestFitValue),image.setAttribute("size_option","bestfit"),editor.win.focus(),removeDivs(),editor.saveCurrentState()},removeImage=function(){image.parentElement.removeChild(image),editor.win.focus(),removeDivs(),editor.saveCurrentState()},originalImage=function(){setImageHeight(image,origHeight),setImageWidth(image,origWidth),image.setAttribute("size_option","original"),removeDivs(),editor.win.focus(),editor.saveCurrentState()};mainSpan=doc.createElement("span"),mainSpan.id="ze_imgBlock",mainSpan.className="ze_spell",_small=doc.createElement("span"),_small.innerHTML=I18N("Small"),_bestfit=doc.createElement("span"),_bestfit.innerHTML=I18N("Best Fit"),_original=doc.createElement("span"),_original.innerHTML=I18N("Original"),_remove=doc.createElement("span"),_remove.innerHTML=I18N("Remove"),mainSpan.appendChild(_small),mainSpan.appendChild(_bestfit),mainSpan.appendChild(_original),mainSpan.appendChild(_remove),doc.body.appendChild(mainSpan),ZE._addEvent(_remove,"click",removeImage),ZE._addEvent(_original,"click",originalImage),ZE._addEvent(_small,"click",smallImage),ZE._addEvent(_bestfit,"click",bestfitImage),enclosingDiv=doc.createElement("div"),doc.body.appendChild(enclosingDiv),enclosingDiv.className="enc",value2=image.getBoundingClientRect();var posx=value2.left,posy=value2.top;enclosingDiv.style.left=editor.win.scrollX?posx+editor.win.scrollX+"px":posx+editor.win.pageXOffset+"px",enclosingDiv.style.top=editor.win.scrollY?value2.top+editor.win.scrollY+"px":value2.top+editor.win.pageYOffset+"px",enclosingDiv.style.height=value2.height+"px",enclosingDiv.style.width=value2.width+"px",mainSpan.contentEditable="false",mainSpan.style.left=enclosingDiv.style.left,setTop(mainSpan,getTop(enclosingDiv)+getHeight(enclosingDiv)),setValues(),posy+=editor.win.scrollY?editor.win.scrollY:editor.win.pageYOffset,posx+=editor.win.scrollX?editor.win.scrollX:editor.win.pageXOffset;var smallDiv1=doc.createElement("div");smallDiv1.className="smallDiv",doc.body.appendChild(smallDiv1),smallDiv1.style.top=posy+"px",smallDiv1.style.left=posx+"px",smallDiv1.style.cursor="nw-resize";var smallDiv2=doc.createElement("div");smallDiv2.className="smallDiv",doc.body.appendChild(smallDiv2),smallDiv2.style.top=posy+"px",smallDiv2.style.left=posx+value2.width-9+"px",smallDiv2.style.cursor="ne-resize";var smallDiv3=doc.createElement("div");smallDiv3.className="smallDiv",doc.body.appendChild(smallDiv3),smallDiv3.style.top=posy+value2.height-9+"px",smallDiv3.style.left=posx+value2.width-9+"px",smallDiv3.style.cursor="se-resize";var smallDiv4=doc.createElement("div");smallDiv4.className="smallDiv",doc.body.appendChild(smallDiv4),smallDiv4.style.top=posy+value2.height-9+"px",smallDiv4.style.left=posx+"px",smallDiv4.style.cursor="sw-resize";var mouseDown=function(ev){var _target1,$zeLink=doc.getElementById("ze_imgBlock");if(ev)for(_target1=ev.target;null!==_target1&&(_target1!==$zeLink&&_target1!==smallDiv1&&_target1!==smallDiv2&&_target1!==smallDiv3&&_target1!==smallDiv4&&_target1!==image);_target1=_target1.parentNode);_target1||removeDivs()},keyDown=function(ev){var kCode=ev.keyCode;46===kCode?removeImage():removeDivs()},setPosDivs=function(){smallDiv1.style.left=enclosingDiv.style.left,smallDiv1.style.top=enclosingDiv.style.top,setLeft(smallDiv2,getWidth(enclosingDiv)+getLeft(enclosingDiv)-9),smallDiv2.style.top=enclosingDiv.style.top,smallDiv3.style.left=enclosingDiv.style.left,setTop(smallDiv3,getHeight(enclosingDiv)+getTop(enclosingDiv)-9),setLeft(smallDiv4,getWidth(enclosingDiv)+getLeft(enclosingDiv)-9),setTop(smallDiv4,getHeight(enclosingDiv)+getTop(enclosingDiv)-9)};removeDivs=function(){var $zeLink=doc.getElementById("ze_imgBlock");$zeLink&&doc.body.removeChild($zeLink),ZE._removeEvent(doc,"mousedown",mouseDown),ZE._removeEvent(_document,"mousedown",mouseDown),ZE._removeEvent(doc,"keydown",keyDown),smallDiv1&&(smallDiv1.parentElement.removeChild(smallDiv1),smallDiv2.parentElement.removeChild(smallDiv2),smallDiv3.parentElement.removeChild(smallDiv3),smallDiv4.parentElement.removeChild(smallDiv4),enclosingDiv.parentElement.removeChild(enclosingDiv))};var startResize=function(ev){smallDiv=this,imageClicked=!0,editor._stopEvent(ev),currentValX=ev.clientX,currentValY=ev.clientY,ZE._removeEvent(doc,"mousedown",mouseDown),ZE._removeEvent(_document,"mousedown",mouseDown),ZE._removeEvent(doc,"keydown",keyDown),ZE._addEvent(doc,"mousemove",doMouseMove),ZE._addEvent(doc,"mouseup",doMouseUp)},alterImage=function(){image.height=parseFloat(enclosingDiv.style.height),image.width=parseFloat(enclosingDiv.style.width),image.style.width&&(image.style.width=""),image.style.height&&(image.style.height="")},mouseUp=function(){imageClicked=!1,removeEventListenerUp(),alterImage(),ZE._removeEvent(smallDiv1,"mousedown",startResize),ZE._removeEvent(smallDiv2,"mousedown",startResize),ZE._removeEvent(smallDiv3,"mousedown",startResize),ZE._removeEvent(smallDiv4,"mousedown",startResize),smallDiv1.parentElement.removeChild(smallDiv1),smallDiv2.parentElement.removeChild(smallDiv2),smallDiv3.parentElement.removeChild(smallDiv3),smallDiv4.parentElement.removeChild(smallDiv4),enclosingDiv.parentElement.removeChild(enclosingDiv);var zeLink=doc.getElementById("ze_imgBlock");zeLink&&doc.body.removeChild(zeLink),getImageWidth(image)===origWidth/bestFitValue?image.setAttribute("size_option","bestfit"):getImageWidth(image)===origWidth/smallValue?image.setAttribute("size_option","small"):getImageWidth(image)===origWidth&&image.setAttribute("size_option","original"),editor.saveCurrentState()},mouseMove=function(_div,e){if(imageClicked){if(e.clientX<=0||e.clientY<=0||e.clientX>editor.editordiv.offsetWidth)return void mouseUp(_div);var rightSide,topHandler,diff,ratio,valueToadd,tempValue,valueTosub,divX,divY,enHeight=(getLeft(enclosingDiv),getTop(enclosingDiv),getHeight(enclosingDiv)),enWidth=getWidth(enclosingDiv);_div===smallDiv2?(rightSide=0,topHandler=0):_div===smallDiv3?(rightSide=0,topHandler=1):_div===smallDiv4?(rightSide=1,topHandler=0):(rightSide=1,topHandler=1),e.clientX<currentValX?(diff=currentValX-e.clientX,0===rightSide?minimumWidth()&&(ratio=enWidth/(enWidth-diff),enWidth/=ratio,valueToadd=enHeight-enHeight/ratio,enHeight/=ratio,ZE.setCss(enclosingDiv,"height",enHeight+"px"),ZE.setCss(enclosingDiv,"width",enWidth+"px"),0===topHandler&&setTop(enclosingDiv,getTop(enclosingDiv)+valueToadd)):(ratio=(enWidth+diff)/enWidth,tempValue=enWidth-enWidth/ratio,enWidth+=enWidth-enWidth/ratio,valueTosub=enHeight-enHeight/ratio,enHeight+=enHeight-enHeight/ratio,ZE.setCss(enclosingDiv,"height",enHeight+"px"),ZE.setCss(enclosingDiv,"width",enWidth+"px"),divX=getLeft(enclosingDiv),divY=getTop(enclosingDiv),setLeft(enclosingDiv,divX-tempValue),1===topHandler&&setTop(enclosingDiv,getTop(enclosingDiv)-valueTosub))):(diff=e.clientX-currentValX,0===rightSide?(ratio=(enWidth+diff)/enWidth,enWidth+=enWidth-enWidth/ratio,valueToadd=enHeight-enHeight/ratio,enHeight+=valueToadd,ZE.setCss(enclosingDiv,"height",enHeight+"px"),ZE.setCss(enclosingDiv,"width",enWidth+"px"),0===topHandler&&setTop(enclosingDiv,getTop(enclosingDiv)-valueToadd)):minimumWidth()&&(ratio=enWidth/(enWidth-diff),tempValue=enWidth-enWidth/ratio,enWidth/=ratio,valueTosub=enHeight-enHeight/ratio,enHeight/=ratio,ZE.setCss(enclosingDiv,"height",enHeight+"px"),ZE.setCss(enclosingDiv,"width",enWidth+"px"),divX=getLeft(enclosingDiv),setLeft(enclosingDiv,divX+tempValue),1===topHandler&&setTop(enclosingDiv,getTop(enclosingDiv)+valueTosub))),setPosDivs(),currentValX=e.clientX,currentValY=e.clientY,image.hasAttribute("size_option")&&image.removeAttribute("size_option")}},doMouseMove=function(event){mouseMove(smallDiv,event)},doMouseUp=function(event){editor._stopEvent(event),mouseUp(smallDiv,event)};removeEventListenerUp=function(){ZE._removeEvent(doc,"mousemove",doMouseMove),ZE._removeEvent(doc,"mouseup",doMouseUp)},ZE._addEvent(doc,"mousedown",mouseDown),ZE._addEvent(_document,"mousedown",mouseDown),ZE._addEvent(doc,"keydown",keyDown),ZE._addEvent(smallDiv1,"mousedown",startResize),ZE._addEvent(smallDiv2,"mousedown",startResize),ZE._addEvent(smallDiv3,"mousedown",startResize),ZE._addEvent(smallDiv4,"mousedown",startResize)},ZE.prototype.insertImage=function(imgUrl,options,attributes){"use strict";var image,origWidth,origHeight,modifiedDimensions,attrObj,sizeOption,editor=this;if(options=options||{},sizeOption=options.size||"original",imgUrl){var getDimensionValues=function(width,height,option){var modifiedWidth,modifiedHeight,reduceRatio,MAX_BESTFIT_WIDTH=400,bestFitWidth=parseInt(.75*editor.editordiv.offsetWidth);return option=option||"original",bestFitWidth>MAX_BESTFIT_WIDTH&&(bestFitWidth=MAX_BESTFIT_WIDTH),"small"===option?(reduceRatio=2.5,width>bestFitWidth&&(reduceRatio=width/150),modifiedWidth=width/reduceRatio,modifiedHeight=height/reduceRatio):""===option?(reduceRatio=1,width>bestFitWidth&&(reduceRatio=width/bestFitWidth),modifiedWidth=width/reduceRatio,modifiedHeight=height/reduceRatio):(modifiedWidth=width,modifiedHeight=height),{width:modifiedWidth,height:modifiedHeight}};image=document.createElement("video"),image.onload=function(){attrObj=attributes||{},origWidth=this.width,origHeight=this.height,attrObj.orig_width=origWidth,attrObj.orig_height=origHeight,modifiedDimensions=getDimensionValues(origWidth,origHeight,sizeOption),attrObj.style=attrObj.style||"",this.width=modifiedDimensions.width,this.height=modifiedDimensions.height,attrObj.size_option=sizeOption,editor.squireInstance.insertVideo(imgUrl,attrObj)},image.onerror=function(){},image.src=imgUrl}};ZE.prototype.showInsertHTMLDialog=function(){"use strict";var closeButton,buttons,textArea,_okButton,_cancelButton,escKeyHandler,editor=this,_document=document,wrapperDOM=editor.doc.getElementById("ze_ins_insertHtml"),I18N=ZE.i18n,getDOM=function(){return['<div class="zep_PUtt">'+I18N("Insert HTML")+'<i class="zei-close"></i></div>','<div class="zep_PUcen PL20 PR20">','<table class="ze_ptble">',"<tbody>","<tr>","<td>",'<textarea style="width: 100%; height: 300px; resize: none; border: 1px solid #ddd; padding: 20px;">',"</textarea>","</td>","</tr>","</tbody>","</table>","</div>",'<div class="zep_PUbtm PT0I">','<span class="sel">'+I18N("OK")+"</span>",'<span data-val="Cancel">'+I18N("Cancel")+"</span>","</div>"].join("")},hideDialog=function(){_document.removeEventListener("keydown",escKeyHandler,!0),wrapperDOM.parentNode.removeChild(wrapperDOM),ZE.hideOverlay()};escKeyHandler=function(event){27===event.keyCode&&(editor._stopEvent(event),hideDialog())};var onOk=function(){var hookMethod,value=textArea.value;hideDialog(),DOMPurify&&(hookMethod=ZE.getHookMethod("ze_insert_html",editor.initobj.hookOnInsertHTML),ZE.addHook("afterSanitizeElements",hookMethod),value=DOMPurify.sanitize(value,{originator:"ze_insert_html",ADD_TAGS:editor.initobj.allowTagsInsertHTML||[],ADD_ATTR:editor.initobj.allowAttrsInsertHTML||[]}),ZE.removeHook("afterSanitizeElements",hookMethod)),editor.insertHTML(value)};wrapperDOM||(ZE.showOverlay(),wrapperDOM=_document.createElement("div"),wrapperDOM.id="ze_ins_insertHtml",wrapperDOM.className="zep_PU zep_arrb",wrapperDOM.style.width="100%",wrapperDOM.innerHTML=getDOM(),_document.body.appendChild(wrapperDOM),textArea=wrapperDOM.getElementsByTagName("textarea")[0],closeButton=wrapperDOM.getElementsByClassName("zei-close")[0],buttons=wrapperDOM.getElementsByTagName("span"),_okButton=buttons[0],_cancelButton=buttons[1],textArea.focus(),_cancelButton.onclick=closeButton.onclick=function(event){editor._stopEvent(event),hideDialog()},_okButton.onclick=function(event){editor._stopEvent(event),onOk()},ZE._addEvent(_document,"keydown",escKeyHandler))};ZE.prototype.createLink=function(){"use strict";var _input,urlRadio,emailRadio,textInput,urlInput,emailInput,subjectInput,textSpan,urlSpan,emailSpan,subjectSpan,isLink,existingLink,isImage,linkhtml,buttons,closeButton,selectedRange,keyEventHandler,okButton,editor=this,_document=document,$zeLinkDiv=_document.getElementById("ze_link"),I18N=ZE.i18n,selectedText=editor._getSelectedText();for(existingLink=editor.getParentElement();null!==existingLink&&"BODY"!==existingLink.nodeName;existingLink=existingLink.parentNode){if("A"===existingLink.nodeName){isLink=!0;break}if("IMG"===existingLink.nodeName){isImage=!0,"A"===existingLink.parentNode.nodeName&&(isLink=!0,existingLink=existingLink.parentNode);break}}var hideLinkDiv=function(){var _form=$zeLinkDiv.getElementsByTagName("form")[0];ZE._removeEvent(_document,"keydown",keyEventHandler),$zeLinkDiv.parentNode.removeChild($zeLinkDiv),ZE.hideOverlay(),_form&&_form.reset(),ZPFeeds.Editor.addRemovePlaceholder(editor,!1)};keyEventHandler=function(ev){27===ev.keyCode&&(editor._stopEvent(ev),hideLinkDiv()),13===ev.keyCode&&(editor._stopEvent(ev),okButton(ev))};var urlMode=function(){urlRadio.checked=!0,emailRadio.checked=!1,emailSpan.style.display=subjectSpan.style.display="none",urlSpan.style.display=""},emailMode=function(){urlRadio.checked=!1,emailRadio.checked=!0,urlSpan.style.display="none",emailSpan.style.display=subjectSpan.style.display=""},setFocus=function(){urlRadio.checked&&(isImage||selectedText)?urlInput.focus():emailRadio.checked&&(isImage||selectedText)?emailInput.focus():textInput.focus()},createLinkSelection=function(_urlValue,textValue){var sel,range,atag;editor.doc.execCommand("createlink",!1,_urlValue);try{sel=editor._getSelection(),sel.collapseToEnd(),atag=editor.getParentElement(),"A"===atag.tagName&&(ZE_Init.preventTargetBlank||(atag.target="_blank",editor.initobj.anchorReferer&&(atag.rel="noreferer")),atag.textContent===textValue||atag.getElementsByTagName("img")||(atag.textContent=textValue),range=editor._createRange(sel),range.selectNode(atag),sel.removeAllRanges(),sel.addRange(range),sel.collapseToEnd())}catch(e){editor.range&&(editor.range.select(),delete editor.range),editor.doc.execCommand("createlink",!1,_urlValue),atag=editor.getParentElement(),"A"===atag.tagName&&(ZE_Init.preventTargetBlank||(atag.target="_blank",editor.initobj.anchorReferer&&(atag.rel="noreferer")),atag.innerText===textValue||atag.getElementsByTagName("img")||(atag.innerText=textValue),sel=editor._getSelection(),range=editor._createRange(sel),range.moveToElementText(atag),range.collapse(!1),range.select())}var range1=editor.doc.createRange();range1.setStart(atag,0),range1.setEndAfter(atag),range1.selectNode(atag);var selection=editor.iframe.contentWindow.getSelection();selection.removeAllRanges(),selection.addRange(range1),editor.win.focus(),editor.iframe.contentWindow.getSelection().collapseToEnd(),editor.saveCurrentState()},initialise=function(){var _tr,href,split1,split2;_input=$zeLinkDiv.getElementsByTagName("input"),urlRadio=_input[0],emailRadio=_input[1],textInput=_input[2],urlInput=_input[3],emailInput=_input[4],subjectInput=_input[5],buttons=$zeLinkDiv.getElementsByTagName("span"),closeButton=$zeLinkDiv.getElementsByClassName("zei-close")[0],_tr=$zeLinkDiv.getElementsByTagName("tr"),textSpan=_tr[1],urlSpan=_tr[2],emailSpan=_tr[3],subjectSpan=_tr[4],textSpan.style.display=isImage?"none":"",isLink?(isImage||(textInput.value=existingLink.textContent),"mailto:"===existingLink.protocol?(emailMode(),href=existingLink.getAttribute("href"),split1=href.split("mailto:"),split2=split1[1].split("?subject="),emailInput.value=split2[0]||"",subjectInput.value=split2[1]||""):(urlMode(),urlInput.value=existingLink.getAttribute("href"))):(urlMode(),isImage||(textInput.value=selectedText||""))},regexEmail=new RegExp("^[\\w]([\\w-\\.\\+\\']*)@([\\w\\-\\.]*)(\\.[a-zA-Z]{2,22}(\\.[a-zA-Z]{2}){0,2})$"),regexUrl=new RegExp("^(ht|f)tp(s?)\\:\\/\\/[-.\\w]*(\\/?)([a-zA-Z0-9\\-\\.\\?\\,\\:\\'\\/\\\\\\+=&amp;%\\$#_@]*)?$"),_selectedText=ZE.trim(selectedText);if(regexEmail.test(_selectedText)&&!isLink)return void createLinkSelection("mailto:"+_selectedText,_selectedText);if(regexUrl.test(_selectedText)&&!isLink)return void createLinkSelection(_selectedText,_selectedText);ZE.showOverlay(),editor.win.focus(),selectedRange=editor.saveSelection(),linkhtml='<div class="zep_PUtt zp_traPU">'+I18N("Insert Link")+'<i class="zei-close"></i></div>',linkhtml+='<div class="zep_PUcen">',linkhtml+='<form><table class="ze_ptble">',linkhtml+="<tr><td>"+I18N("Link")+'</td><td><input type="radio" id="ze_link_url" checked="true"/><label for="ze_link_url">'+I18N("URL")+'</label><input id="ze_link_email" type="radio"/><label for="ze_link_email">'+I18N("Email")+"</label></td>",linkhtml+="<tr><td>"+I18N("Selected Text")+'&nbsp;</td><td><input type="text"></td></tr>',linkhtml+="<tr><td>"+I18N("Web address")+'</td><td><input type="text"></td></tr>',linkhtml+='<tr style="display:none;"><td>'+I18N("Email address")+'</td><td><input type="text"></td></tr>',linkhtml+='<tr style="display:none;"><td>'+I18N("Subject")+'</td><td><input type="text"></td></tr>',linkhtml+="</table></form></div>",linkhtml+='<div class="zep_PUbtm"><span class="sel">'+I18N("OK")+'</span><span data-val="Cancel">'+I18N("Cancel")+"</span></div></div>";var div1=_document.createElement("div");div1.className="zep_PU",div1.innerHTML=linkhtml,div1.id="ze_link",document.body.appendChild(div1),$zeLinkDiv=div1,initialise(),ZE.setPosition($zeLinkDiv,editor.editordiv),setFocus(),urlRadio.onclick=function(){urlMode(),setFocus()},emailRadio.onclick=function(){emailMode(),setFocus()},closeButton.onclick=buttons[1].onclick=function(ev){editor._stopEvent(ev),hideLinkDiv()},okButton=function(ev){var http="http://",https="https://";editor._stopEvent(ev);var urlValue,subjectValue,sel,range,imglnk,anchorElement,textValue=textInput.value;if(selectedRange&&editor.restoreSelection(selectedRange),urlRadio.checked?(urlValue=urlInput.value,urlValue=ZE.trim(urlValue)):emailRadio.checked&&(urlValue=emailInput.value,urlValue=ZE.trim(urlValue)),subjectValue=subjectInput.value,isLink)if(urlValue){urlRadio.checked?0!==urlValue.indexOf(http)&&0!==urlValue.indexOf(https)&&0!==urlValue.indexOf("ftp://")&&0!==urlValue.indexOf("ssh://")&&(urlValue=http+urlValue):emailRadio.checked&&(urlValue="mailto:"+urlValue,subjectValue&&(urlValue+="?subject="+subjectValue)),existingLink.href=urlValue,ZE_Init.preventTargetBlank||(existingLink.target="_blank",editor.initobj.anchorReferer&&(existingLink.rel="noreferer")),isImage||existingLink.textContent===textValue||(existingLink.textContent=textValue),range=editor.doc.createRange(),range.setStart(existingLink,0),range.setEndAfter(existingLink),range.selectNode(existingLink);var selection=editor.iframe.contentWindow.getSelection();selection.removeAllRanges(),selection.addRange(range),editor.win.focus(),selectedRange&&editor.restoreSelection(selectedRange),editor.saveCurrentState()}else confirm("Please confirm that you want to unlink this element.\n\nLink points to: "+existingLink.getAttribute("href"))&&(sel=editor._getSelection(),range=editor._createRange(sel),range.selectNode(existingLink),editor.doc.execCommand("unlink",!1,null),hideLinkDiv());else{if(textValue=ZE.trim(textValue),!textValue&&!isImage)return alert(I18N("You must Select or ENTER Some text to create link")),textInput.focus(),!1;if(urlRadio.checked){if(!urlValue)return alert(I18N("Please enter URL to make a link")),urlInput.focus(),!1;0!==urlValue.indexOf(http)&&0!==urlValue.indexOf(https)&&0!==urlValue.indexOf("ftp://")&&0!==urlValue.indexOf("ssh://")&&(urlValue=http+urlValue)}else if(emailRadio.checked){if(!urlValue)return alert(I18N("Please enter Email to make a link")),emailInput.focus(),!1;urlValue="mailto:"+urlValue,subjectValue&&(urlValue+="?subject="+subjectValue)}if(isImage)editor.doc.execCommand("createlink",!1,urlValue),imglnk=editor.getParentElement(),imglnk&&"a"===imglnk.tagName.toLowerCase()&&(ZE_Init.preventTargetBlank||(imglnk.target="_blank",editor.initobj.anchorReferer&&(imglnk.rel="noreferer")));else if(selectedText&&0!==selectedText.length)createLinkSelection(urlValue,textValue);else{var tmp="<a id='an_link'";ZE_Init.preventTargetBlank||(tmp+="target='_blank'",editor.initobj.anchorReferer&&(tmp+="rel='noreferer'")),tmp+="></a>",editor.win.focus(),editor.pasteHTML(tmp),anchorElement=editor.doc.getElementById("an_link"),anchorElement&&(anchorElement.appendChild(editor.doc.createTextNode(textValue)),anchorElement.setAttribute("href",urlValue),anchorElement.removeAttribute("id")),editor.saveCurrentState()}}return hideLinkDiv(),!1},buttons[0].onclick=okButton,ZE._addEvent(_document,"keydown",keyEventHandler)},ZE.prototype.showAnchorTag=function(_target){"use strict";var mouseDownHandler,$zeLink,removeEventListeners,keyDownHandler,saveAndRestoreFocus,removeAnchor,setPositions,anchorEle,mainSpan,_anchorTarget=_target,editor=this,_document=document,I18N=ZE.i18n,selectedRange=editor.saveSelection();mouseDownHandler=function(ev){if($zeLink=document.getElementById("ze_linkBlock"),ev)for(_target=ev.target;null!==_target&&_target!==$zeLink;_target=_target.parentNode);_target||removeEventListeners()},keyDownHandler=function(){removeEventListeners()},removeEventListeners=function(){$zeLink=document.getElementById("ze_linkBlock"),$zeLink&&(document.body.removeChild($zeLink),ZE._removeEvent(_document,"mousedown",mouseDownHandler),ZE._removeEvent(editor.doc,"mousedown",mouseDownHandler),ZE._removeEvent(editor.doc,"keydown",keyDownHandler))},saveAndRestoreFocus=function(){var range=editor.doc.createRange();range.setStart(_anchorTarget,0),range.setEndAfter(_anchorTarget),range.selectNode(_anchorTarget);var selection=editor.iframe.contentWindow.getSelection();selection.removeAllRanges(),selection.addRange(range),editor.win.focus(),selectedRange&&editor.restoreSelection(selectedRange)},removeAnchor=function(){var range=editor.doc.createRange();range.setStart(_anchorTarget,0),range.setEndAfter(_anchorTarget),range.selectNode(_anchorTarget);var selection=editor.iframe.contentWindow.getSelection();selection.removeAllRanges(),selection.addRange(range),editor.win.focus(),editor.doc.execCommand("unlink",!1,null),editor.iframe.contentWindow.getSelection().collapseToStart(),removeEventListeners(),editor.saveCurrentState()},setPositions=function(){var blockWidth,$zeLinkDom=document.getElementById("ze_linkBlock"),editorPos=ZE.getPos(editor.editordiv),_style=$zeLinkDom.style,$document=document,$body=document.body,$documentElement=$document.documentElement,posx=0,posy=0,value1=editor.iframe.getBoundingClientRect(),value2=_anchorTarget.getBoundingClientRect(),_docWidth=document.body.getBoundingClientRect().width;if(posx=value1.left+value2.left,posy=value1.top+value2.top+_anchorTarget.offsetHeight+(Math.max($body.scrollTop,$documentElement.scrollTop)||0),_docWidth/2>posx?(_style.left=parseInt(posx)+"px",_style.top=parseInt(posy)+"px",_style.right="auto",blockWidth=posx+$zeLinkDom.offsetWidth):(_style.left="auto",_style.top=parseInt(posy)+"px",posx=window.innerWidth-posx-_anchorTarget.offsetWidth,_style.right=parseInt(posx)+"px",blockWidth=posx+$zeLinkDom.offsetWidth),blockWidth>=_docWidth){var tempRef=anchorEle.innerHTML;tempRef.length>55&&(tempRef=tempRef.substring(0,54)+"..."),anchorEle.innerHTML=tempRef}posy+$zeLinkDom.offsetHeight>editor.editordiv.offsetHeight+editorPos.offsetTop&&(_style.top="auto",posy=window.innerHeight-posy+_anchorTarget.offsetHeight,_style.bottom=parseInt(posy)+"px")};var ismention=!1,attrDetails=_anchorTarget.attributes;if(void 0!==attrDetails)for(var i=0;i<attrDetails.length;i++)if("name"===attrDetails[i].localName&&"ze_mention"===_anchorTarget.className){ismention="mentions"===attrDetails[i].nodeValue?!0:!1;break}if(editor.initobj.isLinkMenuDisabled!==!0&&!ismention){$zeLink=document.getElementById("ze_linkBlock"),$zeLink&&removeEventListeners(),mainSpan=document.createElement("span"),mainSpan.id="ze_linkBlock",mainSpan.className="ze_spell",anchorEle=document.createElement("a"),0===_anchorTarget.href.indexOf("mailto")?anchorEle.appendChild(editor.doc.createTextNode(_anchorTarget.href)):(anchorEle.setAttribute("href",_anchorTarget.href),mainSpan.appendChild(editor.doc.createTextNode(I18N("Go to:"))),anchorEle.appendChild(editor.doc.createTextNode(_anchorTarget.href)),anchorEle.target="_blank",editor.initobj.anchorReferer&&(anchorEle.rel="noreferrer"),anchorEle.style.marginLeft="-5px"),mainSpan.appendChild(anchorEle);var changeAnchor=document.createElement("span");changeAnchor.innerHTML=I18N("Change");var _removeAnchor=document.createElement("span");_removeAnchor.innerHTML=I18N("Remove");var close=document.createElement("i");close.className="zei-close",mainSpan.appendChild(anchorEle),mainSpan.appendChild(changeAnchor),mainSpan.appendChild(_removeAnchor),mainSpan.appendChild(close),document.body.appendChild(mainSpan),setPositions()}ZE._addEvent(close,"click",function(){removeEventListeners(),saveAndRestoreFocus()}),ZE._addEvent(_removeAnchor,"click",removeAnchor),ZE._addEvent(changeAnchor,"click",function(){selectedRange&&editor.restoreSelection(selectedRange),editor.win.focus(),editor.createLink(_anchorTarget),removeEventListeners()}),editor.updateToolbar(),ZE._addEvent(_document,"mousedown",mouseDownHandler),ZE._addEvent(editor.doc,"mousedown",mouseDownHandler),ZE._addEvent(editor.doc,"keydown",keyDownHandler)};ZE.prototype.spellcheck=function(){var editor=this,_toolbar=editor.toolbarobject,spellchecklang=(_toolbar.spellcheck,_toolbar.spellcheckoptions,"locale"),_document=document,I18N=ZE.i18n,contextValue=ZE.getContextValue();ZE.activeEditor=editor,spellchecklang="undefined"!=typeof editor.defaultSpellcheckLanguage?editor.defaultSpellcheckLanguage:ZE_Init.useProxy?navigator.language:"locale";var ze_spellcheck_iframe=_document.getElementById("ze_spellcheck"),srcValue=contextValue+"/ze/spellcheck?spellchecklang="+spellchecklang+"&domainname="+ZE_Init.domain;if(srcValue+=ZE_Init.useProxy&&ZE_Init.spellcheckProxyUrl?"&spellcheckurl="+ZE_Init.spellcheckProxyUrl+"&useProxy="+ZE_Init.useProxy:"&spellcheckurl="+ZE_Init.spellcheckURL,ZE_Init.useSameDomain&&(srcValue+="&useSameDomain=true"),ze_spellcheck_iframe)ze_spellcheck_iframe.src=srcValue;else{var _iframe=_document.createElement("iframe");_iframe.name=_iframe.id="ze_spellcheck",_iframe.src=srcValue;var _style=_iframe.style,_editorIframe=editor.iframe;_style.width="500px",_style.left="-1000px",_style.height="50px",_style.top=ZE.getPos(_editorIframe).offsetTop+"px",_style.position="absolute",_document.body.appendChild(_iframe)}if(editor.scspan){var spellcheck_log=editor.sclog;spellcheck_log.style.display="",spellcheck_log.innerHTML=I18N("Checking..."),editor.screcheck.style.display="none",editor.sccancel.style.display="",editor.scclose.style.display="none",editor.scspan.style.display=""}else{var fragment=_document.createDocumentFragment(),outer_span=_document.createElement("span");outer_span.className="ze_spell";{editor.toolbardiv.getBoundingClientRect()}fragment.appendChild(outer_span),editor.scspan=outer_span;var inner_span=_document.createElement("span");inner_span.appendChild(_document.createTextNode(I18N("Checking")+"...")),outer_span.appendChild(inner_span),editor.sclog=inner_span;var recheck_a=_document.createElement("a"),recheck_i18n=I18N("Recheck");recheck_a.style.display="none",recheck_a.title=recheck_a.href=recheck_i18n,recheck_a.appendChild(_document.createTextNode(recheck_i18n)),recheck_a.onclick=function(){return editor.removeSpellcheckspans(),editor.spellcheck(),!1},outer_span.appendChild(recheck_a),editor.screcheck=recheck_a;var cancel_a=_document.createElement("a"),cancel_i18n=I18N("Cancel");cancel_a.title=cancel_a.href=cancel_i18n,cancel_a.appendChild(_document.createTextNode(cancel_i18n)),cancel_a.onclick=function(){return editor.cancelSpellcheck(),editor.scspan.style.display="none",!1},outer_span.appendChild(cancel_a),editor.sccancel=cancel_a;var close_a=_document.createElement("a"),close_i18n=I18N("Close");close_a.title=close_a.href=close_i18n,close_a.style.display="none",close_a.appendChild(_document.createTextNode(close_i18n)),close_a.onclick=function(){return editor.removeSpellcheckspans(),editor.scspan.style.display="none",!1},outer_span.appendChild(close_a),editor.scclose=close_a,editor.toolbardiv.appendChild(fragment)}},ZE.prototype.cancelSpellcheck=function(){var editor=this;return document.getElementById("ze_spellcheck").src=ZE_Init.jsPath+"/html/blank.html",editor.spellcheckContentSet&&(editor.removeSpellcheckspans(),delete editor.spellcheckContentSet),!1},ZE.prototype.getSpellcheckRemovedContent=function(mode){"use strict";var cloneNode,docFrag,spans,spanEle,i,editor=this,spellcheckdiv=editor.spellcheckdiv;if("plaintext"===mode?(cloneNode=spellcheckdiv.cloneNode(!0),docFrag=cloneNode,spans=docFrag.getElementsByTagName("span")):"richtext"===mode&&(cloneNode=editor.doc.body.cloneNode(!0),docFrag=cloneNode,spans=docFrag.getElementsByTagName("span")),spans){for(i=spans.length-1;i>=0;i--)if(spanEle=spans[i],spanEle.hasAttribute("data-s")||spanEle.getAttribute("data-s"))if(spanEle.style.backgroundColor="",spanEle.style.length>0)spanEle.removeAttribute("data-s");else if(spanEle.hasChildNodes()){for(var children=spanEle.childNodes,parentNode=spanEle.parentNode,k=0;k<children.length;k++)parentNode.insertBefore(children[k].cloneNode(!0),spanEle);parentNode.removeChild(spanEle)}return docFrag.innerHTML}},ZE.prototype.removeSpellcheckspans=function(){var spans,editor=this,_mode=editor.mode,spellcheckdiv=editor.spellcheckdiv;if(ZE.activeEditor&&delete ZE.activeEditor,"plaintext"===_mode?spellcheckdiv&&(spans=spellcheckdiv.getElementsByTagName("span"),editor.spellCheckDivEvent&&ZE._removeEvent(spellcheckdiv,"mouseup",editor.spellCheckDivEvent)):(spans=editor.doc.getElementsByTagName("span"),editor.spellCheckEvent&&ZE._removeEvent(editor.doc,"mouseup",editor.spellCheckEvent)),spans){for(var i=spans.length-1;i>=0;i--){var spanEle=spans[i];if(spanEle.hasAttribute("data-s")||spanEle.getAttribute("data-s"))if(spanEle.style.backgroundColor="",spanEle.style.length>0)spanEle.removeAttribute("data-s");else if(spanEle.hasChildNodes()){for(var children=spanEle.childNodes,parentNode=spanEle.parentNode,k=0;k<children.length;k++)parentNode.insertBefore(children[k].cloneNode(!0),spanEle);parentNode.removeChild(spanEle)}}if("plaintext"===_mode&&spellcheckdiv){var _textarea=editor._textarea;_textarea.value=ZE.getText(spellcheckdiv.innerHTML),_textarea.style.display="",spellcheckdiv.parentNode.removeChild(spellcheckdiv),delete editor.spellcheckdiv}}},ZE.prototype.setSpellcheckContent=function(html){var editor=this;if(editor.spellcheckContentSet=!0,"plaintext"===editor.mode){var _div=document.createElement("div"),_textarea=editor._textarea;_div.className=_textarea.className,_div.style.cssText=_textarea.style.cssText,_div.style.overflow="auto",_div.style.clear="both",_div.innerHTML=html,editor.spellCheckDivEvent=function(ev){return editor.spellCheckEventDiv(ev)},ZE._addEvent(_div,"mouseup",editor.spellCheckDivEvent),editor.editordiv.appendChild(_div),_textarea.style.display="none",editor.spellcheckdiv=_div}else{var doc=editor.doc;doc.body.innerHTML=html,editor.spellCheckEvent||(editor.spellCheckEvent=function(ev){return editor.spellCheckMenu(ev)}),ZE._addEvent(doc,"mouseup",editor.spellCheckEvent),editor.win.focus()}editor.sclog.style.display="none",editor.screcheck.style.display="",editor.sccancel.style.display="none",editor.scclose.style.display=""},ZE.prototype.spellCheckEventDiv=function(ev){if(0!==ev.button)return!1;for(var editor=this,_target=ev.target,temptarget=_target;temptarget&&"BODY"!==temptarget.nodeName&&"HTML"!==temptarget.nodeName;temptarget=temptarget.parentNode)if(temptarget.hasAttribute("data-s")){_target=temptarget;break}if(!_target.hasAttribute("data-s"))return!1;editor._stopEvent(ev);var ze_spellcheckmenu_div,_document=document,hideSpellcheckMenuDiv=function(ev){ev&&editor._stopEvent(ev),ZE._removeEvent(_document,"keydown",hideSpellcheckMenuDiv),ZE._removeEvent(_document,"mousedown",_mousedown),ze_spellcheckmenu_div.parentNode.removeChild(ze_spellcheckmenu_div)},_mousedown=function(ev){editor._stopEvent(ev);var _target=ev.target;null===_target&&hideSpellcheckMenuDiv()},ul_click=function(ev){editor._stopEvent(ev);var target=ev.target;if("UL"===target.nodeName)return!1;if("LI"===target.nodeName){if(value=target.getAttribute("data-i"),"No Suggestions"===value)return;if("Ignore All"===value)editor.leaveSimilarErrorWords(_target.getAttribute("replaceword"));else if("Dictionary"===value)editor.addToDictionary(_target.getAttribute("replaceword"));else if("Custom Dictionary"===value)editor.customDictionary();else{var replaceword,span_element=_target,span_element_parent=span_element.parentNode,span_element_style=span_element.style;if(replaceword="Ignore"===value?span_element.textContent:target.textContent,span_element_style&&span_element_style.length>1)span_element_style.backgroundColor="",span_element.removeAttribute("data-s"),span_element.textContent=span_element.textContent.replace(span_element.getAttribute("replaceword"),replaceword),span_element.removeAttribute("replaceword");else{if(span_element.textContent===span_element.getAttribute("replaceword"))span_element_parent.insertBefore(_document.createTextNode(replaceword),span_element);else{span_element.textContent=span_element.textContent.replace(span_element.getAttribute("replaceword"),replaceword);for(var childNode=span_element.firstChild;childNode;){var nodeCopy=childNode.cloneNode(!0);span_element_parent.insertBefore(nodeCopy,span_element),childNode=childNode.nextSibling}}span_element_parent.removeChild(span_element)}}}return hideSpellcheckMenuDiv(),!1},contextMenu=(_document.createDocumentFragment(),{spellcheck:[]}),suggestions=_target.getAttribute("data-s");suggestions=suggestions.split(","),contextMenu.spellcheck[0]=[];for(var temp,i=0;(temp=suggestions[i])&&5>i;i++){var _li=_document.createElement("li");_li.innerHTML=temp,contextMenu.spellcheck[0][i]={},contextMenu.spellcheck[0][i].cmd=temp,0===i&&"No Suggestions"===temp&&(contextMenu.spellcheck[0][i]["data-i"]="No Suggestions",contextMenu.spellcheck[0][i].color="#bcb9af",contextMenu.spellcheck[0][i].fontWeight="Normal")}contextMenu.spellcheck[1]=[],contextMenu.spellcheck[1][0]={},contextMenu.spellcheck[1][0].cmd="Add to Dictionary",contextMenu.spellcheck[1][0]["data-i"]="Dictionary",contextMenu.spellcheck[1][1]={},contextMenu.spellcheck[1][1].cmd="Ignore",contextMenu.spellcheck[1][1]["data-i"]="Ignore",contextMenu.spellcheck[1][2]={},contextMenu.spellcheck[1][2].cmd="Ignore All",contextMenu.spellcheck[1][2]["data-i"]="Ignore All",contextMenu.spellcheck[2]=[],contextMenu.spellcheck[2][0]={},contextMenu.spellcheck[2][0].cmd="Custom Dictionary",contextMenu.spellcheck[2][0]["data-i"]="Custom Dictionary",editor.constructContextMenu(contextMenu.spellcheck,"ze_spellcheckmenu_div",ul_click),ze_spellcheckmenu_div=document.getElementById("ze_spellcheckmenu_div"),ZE._addEvent(_document,"mousedown",_mousedown),ZE._addEvent(_document,"mousedown",_mousedown),ZE._addEvent(_document,"keydown",hideSpellcheckMenuDiv);var _style=(ZE.getPos(editor.editordiv),ze_spellcheckmenu_div.style);posx=0,posy=0;var value1=editor.iframe.getBoundingClientRect(),value2=_target.getBoundingClientRect();ev.pageX||ev.pageY?(posx=value1.left+value2.left+(ev.pageX-value2.left),posy=editor.win.scrollY?value1.top+value2.top+(ev.pageY-value2.top)-editor.win.scrollY:value1.top+value2.top+(ev.pageY-value2.top)-editor.win.pageYOffset):(posx=value1.left+value2.left+(ev.clientX-value2.left),posy=editor.win.scrollY?value1.top+value2.top+(ev.clientY-value2.top)-editor.win.scrollY:value1.top+value2.top+(ev.clientY-value2.top)-editor.win.pageYOffset),_style.left=parseInt(posx)+"px",_style.top=parseInt(posy)+"px";var spellcheck_offsetheight=ze_spellcheckmenu_div.offsetHeight;if(posy+spellcheck_offsetheight>window.innerHeight-20){var tempTop=posy-spellcheck_offsetheight;_style.top=41>tempTop?"40px":parseInt(tempTop)+"px"}},ZE.prototype.spellCheckMenu=function(ev){if(0!==ev.button)return!1;for(var editor=this,_target=ev.target,temptarget=_target;temptarget&&"BODY"!==temptarget.nodeName&&"HTML"!==temptarget.nodeName;temptarget=temptarget.parentNode)if(temptarget.hasAttribute("data-s")){_target=temptarget;break}if(!_target.hasAttribute("data-s"))return!1;editor._stopEvent(ev);var ze_spellcheckmenu_div,_doc=editor.doc,_document=document,hideSpellcheckMenuDiv=function(ev){ev&&"keydown"!==ev.type&&editor._stopEvent(ev),ZE._removeEvent(_document,"mousedown",_mousedown),ZE._removeEvent(_doc,"mousedown",hideSpellcheckMenuDiv),ZE._removeEvent(_doc,"keydown",hideSpellcheckMenuDiv),ze_spellcheckmenu_div.parentNode.removeChild(ze_spellcheckmenu_div)},_mousedown=function(ev){editor._stopEvent(ev);for(var _target=ev.target;null!==_target&&_target!==ze_spellcheckmenu_div;_target=_target.parentNode);null===_target&&hideSpellcheckMenuDiv()},ul_click=function(ev){editor._stopEvent(ev);var value,target=ev.target;if("UL"===target.nodeName)return!1;if("LI"===target.nodeName){if(value=target.getAttribute("data-i"),"No Suggestions"===value)return;if("Ignore All"===value)editor.leaveSimilarErrorWords(_target.getAttribute("replaceword"));else if("Dictionary"===value)editor.addToDictionary(_target.getAttribute("replaceword"));else if("Custom Dictionary"===value)editor.customDictionary();else{var replaceword,span_element=_target,span_element_parent=span_element.parentNode,span_element_style=span_element.style;if(replaceword="Ignore"===value?span_element.textContent:target.textContent,span_element_style&&span_element_style.length>1)span_element_style.backgroundColor="",span_element.removeAttribute("data-s"),span_element.textContent=span_element.textContent.replace(span_element.getAttribute("replaceword"),replaceword),span_element.removeAttribute("replaceword");else{if(span_element.textContent===span_element.getAttribute("replaceword"))span_element_parent.insertBefore(_doc.createTextNode(replaceword),span_element);else{span_element.textContent=span_element.textContent.replace(span_element.getAttribute("replaceword"),replaceword);for(var childNode=span_element.firstChild;childNode;){var nodeCopy=childNode.cloneNode(!0);span_element_parent.insertBefore(nodeCopy,span_element),childNode=childNode.nextSibling}}span_element_parent.removeChild(span_element)}}}return hideSpellcheckMenuDiv(),!1},contextMenu=(_document.createDocumentFragment(),{spellcheck:[]}),suggestions=_target.getAttribute("data-s");suggestions=suggestions.split(","),contextMenu.spellcheck[0]=[];for(var temp,i=0;(temp=suggestions[i])&&5>i;i++){var _li=_document.createElement("li");_li.innerHTML=temp,contextMenu.spellcheck[0][i]={},contextMenu.spellcheck[0][i].cmd=temp,0===i&&"No Suggestions"===temp&&(contextMenu.spellcheck[0][i]["data-i"]="No Suggestions",contextMenu.spellcheck[0][i].color="#bcb9af",contextMenu.spellcheck[0][i].fontWeight="Normal")}contextMenu.spellcheck[1]=[],contextMenu.spellcheck[1][0]={},contextMenu.spellcheck[1][0].cmd="Add to Dictionary",contextMenu.spellcheck[1][0]["data-i"]="Dictionary",contextMenu.spellcheck[1][1]={},contextMenu.spellcheck[1][1].cmd="Ignore",contextMenu.spellcheck[1][1]["data-i"]="Ignore",contextMenu.spellcheck[1][2]={},contextMenu.spellcheck[1][2].cmd="Ignore All",contextMenu.spellcheck[1][2]["data-i"]="Ignore All",contextMenu.spellcheck[2]=[],contextMenu.spellcheck[2][0]={},contextMenu.spellcheck[2][0].cmd="Custom Dictionary",contextMenu.spellcheck[2][0]["data-i"]="Custom Dictionary",editor.constructContextMenu(contextMenu.spellcheck,"ze_spellcheckmenu_div",ul_click),ze_spellcheckmenu_div=document.getElementById("ze_spellcheckmenu_div"),ZE._addEvent(_document,"mousedown",_mousedown),ZE._addEvent(_doc,"mousedown",hideSpellcheckMenuDiv),ZE._addEvent(_doc,"keydown",hideSpellcheckMenuDiv);{var editor_pos=ZE.getPos(editor.editordiv),_style=ze_spellcheckmenu_div.style;ev.clientY+editor_pos.offsetTop+editor.toolbardiv.offsetHeight,ev.clientX+editor_pos.offsetLeft}posx=0,posy=0;var value1=editor.iframe.getBoundingClientRect(),value2=_target.getBoundingClientRect();ev.pageX||ev.pageY?(posx=value1.left+value2.left+(ev.pageX-value2.left),posy=editor.win.scrollY?value1.top+value2.top+(ev.pageY-value2.top)-editor.win.scrollY:value1.top+value2.top+(ev.pageY-value2.top)-editor.win.pageYOffset):(posx=value1.left+value2.left+(ev.clientX-value2.left),posy=editor.win.scrollY?value1.top+value2.top+(ev.clientY-value2.top)-editor.win.scrollY:value1.top+value2.top+(ev.clientY-value2.top)-editor.win.pageYOffset),_style.left=parseInt(posx)+"px",_style.top=parseInt(posy)+"px";var spellcheck_offsetheight=ze_spellcheckmenu_div.offsetHeight;if(posy+spellcheck_offsetheight>window.innerHeight-20){var tempTop=posy-spellcheck_offsetheight;_style.top=41>tempTop?"40px":parseInt(tempTop)+"px"}},ZE.prototype.removeSpellcheckEvent=function(res){var editor=this;editor.spellCheckEvent&&ZE._removeEvent(editor.doc,"mouseup",editor.spellCheckEvent),ZE.activeEditor&&delete ZE.activeEditor;var spellcheck_log=editor.sclog;spellcheck_log.style.display="",spellcheck_log.innerHTML=ZE.i18n("success"===res?"No errors":"Try Again"),setTimeout(function(){editor.sclog.style.display="none",editor.screcheck.style.display=""},2500),editor.screcheck.style.display="none",editor.sccancel.style.display="none",editor.scclose.style.display="",editor.scspan.style.display=""},ZE.prototype.leaveSimilarErrorWords=function(wordToBeIgnored){var spans,editor=this,_mode=editor.mode,spellcheckdiv=editor.spellcheckdiv;if(wordToBeIgnored=wordToBeIgnored.toLowerCase(),"plaintext"===_mode?spellcheckdiv&&(spans=spellcheckdiv.getElementsByTagName("span")):spans=editor.doc.getElementsByTagName("span"),spans)for(var i=spans.length-1;i>=0;i--){var spanEle=spans[i];if(spanEle.hasAttribute("replaceword")&&wordToBeIgnored===spanEle.getAttribute("replaceword").toLowerCase())if(spanEle.style.backgroundColor="",spanEle.style.length>0)spanEle.removeAttribute("data-s"),spanEle.removeAttribute("replaceword");else if(spanEle.hasChildNodes()){for(var children=spanEle.childNodes,parentNode=spanEle.parentNode,k=0;k<children.length;k++)parentNode.insertBefore(children[k].cloneNode(!0),spanEle);parentNode.removeChild(spanEle)}}},ZE.prototype.spellcheckOptions=function(ev,command){var editor=this,_anchorelement=ev.currentTarget,_document=document,ze_spellcheck_options=_document.getElementById("ze_spellcheck_options"),_doc=editor.doc,curtoolbarobject=editor.toolbarobject[command];ZE.addClass(curtoolbarobject,"ze_dn ze_Sel");var hidespellcheck_options=function(ev){ev&&"keydown"!==ev.type&&editor._stopEvent(ev),ze_spellcheck_options.style.display="none",ZE.removeClass(curtoolbarobject,"ze_dn ze_Sel"),ZE._removeEvent(ze_spellcheck_options,"click",ul_click),ZE._removeEvent(_document,"mousedown",_mousedown),ZE._removeEvent(_doc,"mousedown",_mousedown),ZE._removeEvent(_doc,"keydown",_mousedown),ze_spellcheck_options.parentElement.removeChild(ze_spellcheck_options),fragment.appendChild(_ul)},ul_click=function(ev){editor._stopEvent(ev);var _target=ev.target,_nodeName=_target.nodeName;if("LI"===_nodeName);else"IMG"===_target.nodeName&&(_target=_target.parentNode),"SPAN"===_target.nodeName&&(_target=_target.parentNode);if(_target.hasAttribute("data-cd")&&"customdictionary"===_target.getAttribute("data-cd"))editor.customDictionary();else{var _tickElement=document.createElement("i");_tickElement.className="zei-tick",_target.insertBefore(_tickElement,_target.firstChild),ze_spellcheck_options.setAttribute("data-index",_target.getAttribute("data-index")),_anchorelement.setAttribute("data-lang",_target.getAttribute("data-lang")),editor.defaultSpellcheckLanguage=_target.getAttribute("data-lang"),"function"===editor.initobj.changeSpellcheckLanguage&&editor.initobj.changeSpellcheckLanguage(editor.defaultSpellcheckLanguage)}hidespellcheck_options()},getSpellCheckDivHeight=function(){var _ulheight=.6*(window.innerHeight-editor.iframe.getBoundingClientRect().top);return 150>_ulheight?_ulheight=150:_ulheight>300&&(_ulheight=300),_ulheight},_mousedown=function(event){if(event)for(_target=event.target;null!==_target&&_target!==ze_spellcheck_options;)_target=_target.parentNode;_target||hidespellcheck_options()},_className=_anchorelement.className;if(_className&&_className.search("ze_dn")>0)return hidespellcheck_options(),!1;if(ze_spellcheck_options)ze_spellcheck_options.style.display="",ze_spellcheck_options.firstChild.style.height=getSpellCheckDivHeight()+"px",ZE.addClass(curtoolbarobject,"ze_dn"),ZE_Init.needEditorStats&&editor.updateCount("spo");else{var fragment=_document.createDocumentFragment(),I18N=(ZE_Init.imgPath,ZE.i18n),_div=_document.createElement("div");_div.className="ze_dd shw",_div.id="ze_spellcheck_options",ze_spellcheck_options=_div;var _ul=_document.createElement("ul");_ul.className="ze_spellCheck",_ul.style.height=getSpellCheckDivHeight()+"px",_ul.style.overflow="hidden",_ul.style.overflowY="scroll",fragment.appendChild(_ul);var spellcheckarray=ZE_Init.spellCheckOptions;spellcheckarray||(spellcheckarray=[["locale","Auto"],["af-ZA","Afrikaans"],["am","Amharic"],["ar",""],["hy_AM",""],["az","Azeri"],["bg_BG",""],["bn_BN","Bengali"],["ca","Catal"],["cs_CZ","esk"],["da","Danske"],["nl_NL","Nederlands"],["en-AU","English(AU)"],["en-CA","English(CA)"],["en-NZ","English(NZ)"],["en-GB","English(UK)"],["en-US","English(US)"],["en_ZA","English(ZA)"],["eo_l3","Esperanto"],["et_EE","Eesti"],["fo_FO","Faroese"],["fa","Farsi"],["fj_FJ","Fijian"],["fr-FR","Franais"],["fy_NL","Frisian"],["gl","Galego"],["de-AT","Deutsch(AT)"],["de-CH","Deutsch(CH)"],["de-DE","Deutsch(DE)"],["el_GR",""],["he-IL",""],["hi_IN",""],["hu","Magyar"],["id_ID","Indonesia"],["ia","Interlingua"],["ga_IE","Gaeilge"],["is","slenska"],["it","Italiano"],["ko","Korean"],["la","Latin"],["lv-LV","Latvijas"],["lt","Lietuvos"],["mi","Maori"],["ms_MY","Melayu"],["mr_IN","Marathi"],["mn_MN","Mongolian(MN)"],["ne_NP","Nepali"],["nb_NO","Norsk bokml"],["nn","Norsk Nynorsk"],["ns_ZA","Northern Sotho"],["oc_FR","Occitan"],["or_OR","Oriya"],["PL","Polski"],["pt_PT","Portugus(PT)"],["pt-BR","Portugus(BR)"],["qu_BO","Quechua"],["rw_RW","Rheato-Romanic"],["ro","Romn"],["ru",""],["gd_GB","Scots gaelic"],["sr",""],["sk","Slovensk"],["sl","Slovenski"],["es_CL","Espaol(CL)"],["es_CO","Espaol(CO)"],["es_EC","Espaol(EC)"],["es-ES","Espaol(ES)"],["es-MX","Espaol(MX)"],["es_NI","Espaol(NI)"],["es_PE","Espaol(PE)"],["es_PR","Espaol(PR)"],["es_UY","Espaol(UY)"],["sv_SE","Svenska"],["sw_KE","Swahili"],["ta_TA",""],["tn_ZA","Tswana"],["ts_ZA","Tsonga"],["uz_UZ","Uzbek"],["ve_ZA","Venda"],["vi_VI","Vietnamese"],["xh_ZA","Xhosa"],["zu-ZA","Zulu"]]),editor.defaultSpellcheckLanguage||(editor.defaultSpellcheckLanguage=ZE_Init.spellcheckLanguage||editor.initobj.spellcheckLanguage||"locale");for(var lang,i=0;lang=spellcheckarray[i];i++){var key=lang[0],value=lang[1],_li=_document.createElement("li");_li.title=_li.href=value,_li.setAttribute("data-index",i),_li.setAttribute("data-lang",key);var _img=_document.createElement("i");editor.defaultSpellcheckLanguage===key&&(_img.className="zei-tick"),_li.appendChild(_img);{_document.createElement("span")}_li.appendChild(_document.createTextNode(value)),_ul.appendChild(_li)}var _second_ul=_document.createElement("ul");_second_ul.className="custom";var _second_li=_document.createElement("li");_second_ul.appendChild(_second_li),_second_li.setAttribute("data-cd","customdictionary"),_second_li.title=_second_li.href="Custom Dictionary";var _second_img=(_document.createElement("span"),document.createElement("i"));_second_img.className="zei-custDict",_second_li.appendChild(_second_img),_second_li.appendChild(_document.createTextNode(I18N("Custom Dictionary"))),ZE.addClass(curtoolbarobject,"ze_dn"),_div.appendChild(fragment),_div.appendChild(_second_ul),_document.body.appendChild(_div),ZE_Init.needEditorStats&&editor.updateCount("spo")}ZE._addEvent(ze_spellcheck_options,"click",ul_click),ZE._addEvent(_document,"mousedown",_mousedown),ZE._addEvent(_doc,"mousedown",_mousedown),ZE._addEvent(_doc,"keydown",_mousedown);var offsets=ZE.getPos(_anchorelement),_style=ze_spellcheck_options.style,tempOffLeft=offsets.offsetLeft,tempLeft=tempOffLeft-ze_spellcheck_options.offsetWidth+_anchorelement.offsetWidth;_style.left=tempLeft<editor.editordiv.getBoundingClientRect().left?tempOffLeft+"px":tempLeft+5+"px",_style.top=offsets.offsetTop+_anchorelement.offsetHeight+"px"},ZE.prototype.addToDictionary=function(wordtobeadded){var _form,editor=this,_location=location,spellchecklang="locale",_document=(editor.popupdiv,document);editor.leaveSimilarErrorWords(wordtobeadded),_form=document.createElement("form"),_form.method="POST",_form.action=ZE_Init.useProxy?ZE_Init.spellcheckProxyUrl+"/lt/customdictionary.lt?operation=add&word="+wordtobeadded+"&servicename="+_location.hostname.split(".")[0]+"&language="+spellchecklang:_location.protocol+"//"+ZE_Init.spellcheckURL+"/lt/customdictionary.lt?operation=add&word="+wordtobeadded+"&servicename="+_location.hostname.split(".")[0]+"&language="+spellchecklang,_form.target="ze_spellcheck",_document.body.appendChild(_form),_form.submit(),_document.body.removeChild(_form)},ZE.prototype.customDictionary=function(){var editor=this,_document=document,ze_custom_dictionary_div=_document.getElementById("ze_cstm_dict"),I18N=ZE.i18n,spellchecklang="locale";spellchecklang=editor.defaultSpellcheckLanguage||"locale";var hideCustomDictionaryDiv=function(){ZE._removeEvent(_document,"keydown",esckey),ze_custom_dictionary_div.parentNode.removeChild(ze_custom_dictionary_div),ZE.hideOverlay(),editor.win.focus()},esckey=function(ev){27==ev.keyCode&&(editor._stopEvent(ev),hideCustomDictionaryDiv())};if(ZE.showOverlay(),ze_custom_dictionary_div)ze_custom_dictionary_div.style.display="",ze_custom_dictionary_div.getElementsByTagName("iframe")[0].src=location.protocol+"//"+ZE_Init.spellcheckURL+"/lt/customdictionary2g.lt?CD_LANGUAGE="+spellchecklang;else{var tmp="<div class='zep_PUtt' onmousedown='ZE.drag(event,\"ze_cstm_dict\");return false;'>";tmp+=I18N("Custom Dictionary"),tmp+="<i class='zei-close'></i></div>",tmp+="<div class='zep_PUcen' style='margin:10px 0px 10px 0px;'>",tmp+="<iframe frameborder='0' style='border: medium none; width: 420px; height: 260px;' src="+location.protocol+"//"+ZE_Init.spellcheckURL+"/lt/customdictionary2g.lt?CD_LANGUAGE="+spellchecklang+"></iframe>",tmp+="</div>";var div1=_document.createElement("div");div1.className="zep_PU",div1.innerHTML=tmp,div1.id="ze_cstm_dict",document.body.appendChild(div1),ze_custom_dictionary_div=div1}ZE.setPosition(ze_custom_dictionary_div,editor.editordiv),ze_custom_dictionary_div.getElementsByClassName("zei-close")[0].onclick=function(ev){editor._stopEvent(ev),hideCustomDictionaryDiv()},ze_custom_dictionary_div.focus(),ZE._addEvent(_document,"keydown",esckey)};ZE.prototype.createTable=function(_object){function okButton(ev){editor._stopEvent(ev);{var row_value,column_input,column_value,width_input,width_value,border_input,border_value,_doc,element,fragment,_table,_tbody,i,j,row,cell,sel,range,tableStyle,cellPadding_input,cellSpacing_input,cellPadding_value,cellSpacing_value,_initobj=editor.initobj;ZE_Init.outGoingFontFamily}if(selectedRange&&editor.restoreSelection(selectedRange),row_value=row_input.value,!(row_value>0&&100>row_value))return insertTableErrorMsg(I18N("Specify valid number for Rows")),row_input.focus(),row_input.select(),!1;if(column_input=_input[1],column_value=column_input.value,!(column_value>0&&100>column_value))return insertTableErrorMsg(I18N("Specify valid number for Columns")),column_input.focus(),column_input.select(),!1;if(width_input=_input[2],width_value=width_input.value,!(width_value>1&&1e4>width_value))return insertTableErrorMsg(I18N("Specify valid number for Width")),width_input.focus(),width_input.select(),!1;if(border_input=_input[3],_object){if(cellPadding_input=_input[3],cellPadding_value=cellPadding_input.value,""==cellPadding_value||!(cellPadding_value>=0&&100>cellPadding_value))return insertTableErrorMsg(I18N("Specify valid number for Cell Padding")),cellPadding_input.focus(),cellPadding_input.select(),!1;if(cellSpacing_input=_input[4],cellSpacing_value=cellSpacing_input.value,""==cellSpacing_value||!(cellSpacing_value>=0&&100>cellSpacing_value))return insertTableErrorMsg(I18N("Specify valid number for Cell Spacing")),cellSpacing_input.focus(),cellSpacing_input.select(),!1;border_input=_input[5]}if(border_value=border_input.value,""==border_value||!(border_value>=0&&100>border_value))return insertTableErrorMsg(I18N("Specify valid number for Border")),border_input.focus(),border_input.select(),!1;if(_doc=editor.doc,element=ze_ins_table_div.getElementsByTagName("select")[0],_object)tableStyle=_object.style,_object.width&&(_object.width=""),tableStyle.width=width_value+element.options[element.selectedIndex].value,_object.style.border&&(_object.style.border=""),_object.border=border_value,_object.cellPadding=cellPadding_value,_object.cellSpacing=cellSpacing_value,tableStyle.color="black",editor.win.focus();else{for(fragment=_doc.createDocumentFragment(),fragment.appendChild(_doc.createElement("br")),_table=_doc.createElement("table"),tableStyle=_table.style,tableStyle.width=width_value+element.options[element.selectedIndex].value,tableStyle.fontSize=_initobj.defaultfontsize||ZE_Init.defaultFontSize||"",tableStyle.fontFamily=_initobj.defaultfontfamily||ZE_Init.defaultFontFamily||"",_table.cellPadding="2",_table.cellSpacing="2",_table.border=border_value,tableStyle.color="black",_tbody=_doc.createElement("tbody"),i=0;row_value>i;i++){for(row=_doc.createElement("tr"),j=0;column_value>j;j++){cell=_doc.createElement("td");var newDiv=_doc.createElement("div");newDiv.appendChild(_doc.createElement("br")),cell.appendChild(newDiv),row.appendChild(cell)}_tbody.appendChild(row)}_table.appendChild(_tbody),fragment.appendChild(_table),fragment.appendChild(_doc.createElement("br")),editor.win.focus(),sel=editor._getSelection();try{sel.isCollapsed||sel.deleteFromDocument(),range=sel.getRangeAt(0)}catch(e){range=editor._createRange(sel)}try{range.insertNode(fragment)}catch(e1){insertTableErrorMsg(I18N("Exception in inserting table"))}}return hideTableDiv(),editor.saveCurrentState(),!1}var hideTableDiv,esckey,tblhtml,div1,_input,row_input,buttons,close_button,selectedRange,title,_errorspan,editor=this,_document=document,ze_ins_table_div=_document.getElementById("ze_ins_table"),I18N=ZE.i18n;hideTableDiv=function(){var _form=ze_ins_table_div.getElementsByTagName("form")[0];_document.removeEventListener("keydown",esckey,!0),ze_ins_table_div.parentNode.removeChild(ze_ins_table_div),ZE.hideOverlay(),_form&&_form.reset(),editor.win.focus(),editor.range&&(editor.range.select(),delete editor.range)},initialize=function(){var column_input,width_input,border_input,border_value,table_width,element,cellPadding_input,cellSpacing_input;row_input.value=_object.rows.length,row_input.disabled=!0,column_input=_input[1],column_input.value=_object.rows[0].cells.length,column_input.disabled=!0,width_input=_input[2],table_width=_object.style.width||_object.width,element=ze_ins_table_div.getElementsByTagName("select")[0],element.selectedIndex=-1!=table_width.indexOf("%")?"0":"1",table_width&&(width_input.value=parseInt(table_width)),width_input.focus(),cellPadding_input=_input[3],cellPadding_input.value=_object.cellPadding?_object.cellPadding:"0",cellSpacing_input=_input[4],cellSpacing_input.value=_object.cellSpacing?_object.cellSpacing:"0",border_input=_input[5],border_value=_object.style.border||_object.border,border_input.value=border_value?parseInt(border_value):"0"},esckey=function(ev){27===ev.keyCode&&(editor._stopEvent(ev),hideTableDiv()),13===ev.keyCode&&(editor._stopEvent(ev),okButton(ev))},title=_object?"Edit Table":"Insert Table",tblhtml='<div class="zep_PUtt">'+I18N(title)+'<i class="zei-close"></i></div>',tblhtml+='<div class="zep_PUcen">',tblhtml+='<form><table class="ze_ptble"><tr><td>'+I18N("Rows")+'</td><td><input type="text" class="ze_m20" value="2" maxlength="2" size="2"></td><td>'+I18N("Columns")+'</td><td><input type="text" value="2" maxlength="2" size="2"></td></tr>',tblhtml+="<tr><td>"+I18N("Width")+'</td><td><input type="text" value="100" maxlength="4" size="2"/></td><td colspan="2"><div class="ze_select"><select class="select"><option value="%">%</option><option value="px">'+I18N("px")+"</option></select></div></td></tr>",_object&&(tblhtml+="<tr><td>"+I18N("Cell Padding")+'</td><td><input type="text" maxlength="2" size="2"/></td><td>'+I18N("Cell Spacing")+'</td><td><input type="text" maxlength="2" size="2"/></td></tr>'),tblhtml+="<tr><td>"+I18N("Border")+'</td><td><input type="text" value="1" maxlength="2" size="2"/></td></tr>',tblhtml+='<tr><td></td></tr><tr><td colspan="4"><p class="ze_iiSnF"><span class="ze_popuperrmsg"style="display:none;">this is temp text</span></p></td></tr></table></form></div>',tblhtml+='<div class="zep_PUbtm"><span class="sel">'+I18N("OK")+'</span><span data-val="Cancel">'+I18N("Cancel")+"</span></div>",ZE.showOverlay(),editor.win.focus(),selectedRange=editor.saveSelection(),div1=_document.createElement("div"),div1.setAttribute("class","zep_PU zep_arrb"),div1.innerHTML=tblhtml,div1.id="ze_ins_table",ze_ins_table_div=div1,document.body.appendChild(div1),ZE.setPosition(ze_ins_table_div,editor.editordiv),_input=ze_ins_table_div.getElementsByTagName("input"),row_input=_input[0],buttons=ze_ins_table_div.getElementsByTagName("span"),_errorspan=buttons[0],close_button=ze_ins_table_div.getElementsByClassName("zei-close")[0],_object?initialize():row_input.focus(),close_button.onclick=buttons[2].onclick=function(ev){editor._stopEvent(ev),hideTableDiv()};var insertTableErrorMsg=function(msg){_errorspan=ze_ins_table_div.getElementsByTagName("span"),_errorspan[0].style.display="",_errorspan[0].innerHTML=msg};buttons[1].onclick=okButton,ZE._addEvent(_document,"keydown",esckey)};ZE.prototype._createTableGrid=function(ev,command){"use strict";var _target,rowCount,tablegenDiv,tr,td,colCount,tableGrid,selectedRange,_offset,tableGridid,sel,range,clickAction,mouseMove,removeEvents,curtoolbarobject,editor=this,_document=document,_doc=editor.doc,_anchorElement=ev.currentTarget,_initobj=editor.initobj,maxRow=5,maxCol=5,gridRows=[],deleteRow=0,deleteCol=0;curtoolbarobject=editor.toolbarobject[command],ZE.addClass(curtoolbarobject,"ze_dn ze_Sel");var CONSTANTS={TABLEID:"tablegen_div",DROPDOWNID:"ze_dropdown",ROWATTR:"data-row_num",COLATTR:"data-col_num"};selectedRange=editor.saveSelection();var setProperty=function(node,propName,value){node.setAttribute(propName,value)},fillGrid=function(_rowCount,_colCount){var i,j;for(i=0;maxRow>i;i++)for(j=0;maxCol>j;j++)if(_rowCount>i&&_colCount>j){var displayDiv=_document.getElementById("displayDiv");displayDiv.innerHTML=_rowCount+"x"+_colCount,gridRows[i].childNodes[j].style.backgroundColor="#F4F4F4"}else gridRows[i].childNodes[j].style.backgroundColor="#fff"},insertTable=function(){var gridTable=_document.createElement("div");gridTable.id=CONSTANTS.DROPDOWNID,gridTable.className="ze_dd shw ze_dropDown";var displayDiv=_document.createElement("div");displayDiv.innerHTML="1 x 1",displayDiv.align="center",displayDiv.id="displayDiv",displayDiv.className="ze_tableDtl",tablegenDiv=document.createElement("table"),setProperty(tablegenDiv,"id",CONSTANTS.TABLEID),tablegenDiv.className="ze_mainTable";for(var row=1;maxRow>=row;row++){tr=_document.createElement("tr");for(var col=1;maxCol>=col;col++)td=_document.createElement("td"),td.className="ze_tableGridCol",ZE._setAttribute(td,CONSTANTS.ROWATTR,row),ZE._setAttribute(td,CONSTANTS.COLATTR,col),ZE._appendChildren(tr,[td]);gridRows.push(tr),ZE._appendChildren(tablegenDiv,[tr])}var ulLists=_document.createElement("ul"),ul1=_document.createElement("li");return ul1.className="iTable",ZE._appendChildren(ul1,[displayDiv,tablegenDiv]),ZE._appendChildren(ulLists,[ul1]),ZE._appendChildren(gridTable,[ulLists]),gridTable};tableGrid=insertTable(),_offset=ZE.getPos(_anchorElement),tableGrid.style.left=_offset.offsetLeft+"px",tableGrid.style.top=_offset.offsetTop+_anchorElement.offsetHeight+"px",_document.body.appendChild(tableGrid);var tablegenDivId=_document.getElementById(CONSTANTS.TABLEID),mouseDown=function(event){if(tableGrid=document.getElementById(CONSTANTS.DROPDOWNID),event)for(_target=event.target;null!==_target&&_target!==tableGrid;)_target=_target.parentNode;_target||(removeEvents(),tableGrid.parentElement.removeChild(tableGrid))};mouseMove=function(event){var tableRows,tableRow;if(rowCount&&(deleteRow=rowCount),colCount&&(deleteCol=colCount),rowCount=event.target.dataset.row_num,colCount=event.target.dataset.col_num,Number(deleteRow)>Number(rowCount))Number(deleteRow)>=5&&(tableGridid=_document.getElementById(CONSTANTS.TABLEID),maxRow--,tableGridid.deleteRow(maxRow),gridRows.pop());else if(Number(rowCount)===maxRow&&10!==maxRow){tableGridid=_document.getElementById(CONSTANTS.TABLEID),tr=_document.createElement("tr"),tr.style.border="2",maxRow++;for(var rows=0;maxCol>rows;rows++)td=_document.createElement("td"),td.className="ze_tableGridCol",ZE._setAttribute(td,CONSTANTS.ROWATTR,maxRow),ZE._setAttribute(td,CONSTANTS.COLATTR,rows+1),tr.appendChild(td);gridRows.push(tr),tableGridid.insertBefore(tr,tableGridid.lastChild.nextSibling)}if(Number(deleteCol)>Number(colCount)){if(Number(deleteCol)>=5){tableRows=tablegenDiv.getElementsByTagName("TR");for(var maxcols,_rows=0;_rows<tableRows.length;_rows++){maxcols=maxCol;for(var tabCols=tableRows[_rows].getElementsByTagName("TD"),_cols=0;1>_cols;_cols++)tableRows[_rows].removeChild(tabCols[maxcols-1]),maxcols--}maxCol--}}else if(Number(colCount)===Number(maxCol)&&10!==maxCol){gridRows=[],maxCol+=1;var cols=maxCol;tableRow=tablegenDiv.getElementsByTagName("TR"),tableGridid=_document.getElementById(CONSTANTS.TABLEID);for(var k=0;k<tableRow.length;k++){td=_document.createElement("td");var tableCol=tableRow[k].getElementsByTagName("TD");td.className="ze_tableGridCol",ZE._setAttribute(td,CONSTANTS.ROWATTR,k+1),ZE._setAttribute(td,CONSTANTS.COLATTR,cols),tableRow[k].insertBefore(td,tableCol[tableCol.length-1].nextSibling),gridRows.push(tableRow[k])}}rowCount||colCount?rowCount?colCount?fillGrid(rowCount,colCount):fillGrid(rowCount,deleteCol):fillGrid(deleteRow,colCount):fillGrid(deleteRow,deleteCol)};var drawTable=function(_rowCount,_colCount){var i,j;editor.win.focus(),ZPFeeds.Editor.addRemovePlaceholder(editor,!1,!0),selectedRange&&editor.restoreSelection(selectedRange);var fragment=_doc.body.ownerDocument.createDocumentFragment();fragment.appendChild(_document.createElement("br"));var _table=_document.createElement("table"),tableStyle=_table.style;tableStyle.fontSize=_initobj.defaultfontsize||ZE_Init.defaultFontSize||"",tableStyle.fontFamily=_initobj.defaultfontfamily||ZE_Init.defaultFontFamily||"",tableStyle.width="100%",tableStyle.borderCollapse="collapse",tableStyle.border="1px solid black",_table.className="ze_tableView",_table.cellPadding="2",_table.cellSpacing="2",_table.border="1";var row,cell,_tbody=_document.createElement("tbody");for(i=0;_rowCount>i;i++){for(row=_document.createElement("tr"),j=0;_colCount>j;j++){cell=_document.createElement("td");var newDiv=_document.createElement("div");newDiv.appendChild(_document.createElement("br")),cell.appendChild(newDiv),row.appendChild(cell)}_tbody.appendChild(row)}_table.appendChild(_tbody),fragment.appendChild(_table),fragment.appendChild(_document.createElement("br")),editor.win.focus(),sel=editor._getSelection();try{sel.isCollapsed||sel.deleteFromDocument(),range=sel.getRangeAt(0)}catch(e){range=editor._createRange(sel)}try{editor.win.focus(),range.insertNode(fragment)}catch(e1){}range.collapse(!1),sel.removeAllRanges(),sel.addRange(range),editor.saveCurrentState(),ZPFeeds.Editor.addRemovePlaceholder(editor,!1)};removeEvents=function(){ZE.removeClass(curtoolbarobject,"ze_dn ze_Sel"),ZE._removeEvent(tablegenDivId,"click",clickAction),ZE._removeEvent(tablegenDivId,"mousemove",mouseMove),ZE._removeEvent(_document,"mousedown",mouseDown),ZE._removeEvent(_doc,"mousedown",mouseDown),ZE._removeEvent(_doc,"keydown",mouseDown)},clickAction=function(event){editor._stopEvent(ev),event.target.hasAttribute(CONSTANTS.ROWATTR)&&event.target.hasAttribute(CONSTANTS.COLATTR)?drawTable(rowCount,colCount):drawTable(deleteRow,deleteCol),tableGrid=_document.getElementById(CONSTANTS.DROPDOWNID),removeEvents(),tableGrid.parentElement.removeChild(tableGrid)},ZE._addEvent(_document,"mousedown",mouseDown),ZE._addEvent(_doc,"mousedown",mouseDown),ZE._addEvent(_doc,"keydown",mouseDown),ZE._addEvent(tablegenDivId,"click",clickAction),ZE._addEvent(tablegenDivId,"mousemove",mouseMove)};ZE.prototype.insertObj=function(){var _textArea,hideObjdiv,esckey,tmp,div1,_input1,editor=this,_document=document,ze_ins_obj_div=_document.getElementById("ze_ins_obj"),I18N=ZE.i18n;editor.freeze(),hideObjdiv=function(){ze_ins_obj_div.style.display="none",_textArea.value="",editor.hideFreeze(),editor.win.focus(),_document.removeEventListener("keydown",esckey,!0)},esckey=function(ev){27===ev.keyCode&&(editor._stopEvent(ev),hideObjdiv())},ze_ins_obj_div?ze_ins_obj_div.style.display="":(tmp="<div class='ze_pop_header' onmousedown='ZE.drag(event,\"ze_ins_obj\");return false;'><img class='ze_closeimg' src='"+ZE_Init.getCDNURL("spacer.gif","image")+"'/>",tmp+="<h4>"+I18N("Insert HTML")+"</h4></div>",tmp+='<div class="ze_subpart ze_objsub"><span class="ze_clr"><textarea class="ze_objecttxt"></textarea></span></div>',tmp+='<div class="ze_botpart"><input type="submit" class="ze_btn" value='+I18N("Insert")+' /><input type="submit" class="ze_btn" value='+I18N("Cancel")+" /></div>",div1=_document.createElement("div"),div1.className="ze_objpop",div1.innerHTML=tmp,div1.id="ze_ins_obj",document.body.appendChild(div1),ze_ins_obj_div=div1),ZE.setPosition(ze_ins_obj_div,editor.editordiv),_textArea=ze_ins_obj_div.getElementsByTagName("textarea")[0],_textArea.focus(),_input1=ze_ins_obj_div.getElementsByTagName("input"),ze_ins_obj_div.getElementsByTagName("img")[0].onclick=_input1[1].onclick=function(ev){editor._stopEvent(ev),hideObjdiv()},_input1[0].onclick=function(ev){editor._stopEvent(ev);var val=_textArea.value;return val=ZE.trim(val),0===val.length?(alert(I18N("Please Enter some HTML")),_textArea.focus(),!1):(editor.win.focus(),editor.doc.execCommand("inserthtml",!1,val),void hideObjdiv())},_document.addEventListener("keydown",esckey,!0)};ZE.prototype.insertCode=function(){var sel,startnode,class_set,range,_parent,ols,ols_length,i,editor=this;if(editor.doc.execCommand("insertorderedlist",!1," "),sel=editor.win.getSelection(),startnode=sel.anchorNode,"OL"===startnode.nodeName)return void(startnode.className="code");for(class_set=!1;null!==startnode&&"BODY"!==startnode.nodeName;startnode=startnode.parentNode)if("OL"===startnode.nodeName){startnode.className="code",class_set=!0;break}if(!class_set){if(range=sel.getRangeAt(0),_parent=range.commonAncestorContainer,1!==_parent.nodeType)for(;null!==_parent&&"BODY"!==_parent.nodeName&&1!==_parent.nodeType;_parent=_parent.parentNode);if(1===_parent.nodeType)for(ols=_parent.getElementsByTagName("ol"),ols_length=ols.length,i=0;ols_length>i;i++)if(sel.containsNode(ols[i],!0)){ols[i].className="code";break}}};ZE.prototype.insertQuote=function(){var sel,range,fragment,_block,_div,_anchorElement,editor=this,doc=editor.doc;for(editor.squireInstance.focus(),_anchorElement=editor.win.getSelection().anchorNode.parentNode;null!==_anchorElement;){if("BLOCKQUOTE"===_anchorElement.nodeName)return!0;_anchorElement=_anchorElement.parentNode}sel=editor._getSelection(),range=editor._createRange(sel),fragment=doc.createDocumentFragment();var _tempDiv=doc.createElement("div");if(_tempDiv.appendChild(doc.createElement("br")),fragment.appendChild(_tempDiv),_block=doc.createElement("blockquote"),fragment.appendChild(_block),_div=doc.createElement("div"),_block.appendChild(_div),fragment.appendChild(doc.createElement("br")),ZE_Init.inlineQuotes?(_block.style.borderLeft="1px solid #17b393",_block.style.padding="10px 20px",_block.style.backgroundColor=" #f3fbfa",_block.style.margin="5px auto"):_block.className="block_quote",sel.isCollapsed)_div.appendChild(doc.createElement("br")),range.insertNode(fragment),range.selectNodeContents(_div),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range);else{_div.appendChild(range.cloneContents());var wrapperDiv=doc.createElement("div");wrapperDiv.appendChild(fragment),fragment.appendChild(doc.createElement("br")),editor.insertHTML(wrapperDiv.innerHTML,!0)}editor.saveCurrentState()};ZE.prototype.htmlView=function(){"use strict";var _textarea,_iframe,parentDom,editorArea,buttons,preview,htmlView,save,cancel,close,hideDom,editorContent,getIndent,styleHtml,editHTMLDom,editor=this,_document=document;editorContent=editor.getContent();var CONSTANTS={TITLE:"EDIT HTML",HTAB:"HTML",PTAB:"Preview",SAVE:"Save",CANCEL:"Cancel"};htmlView=function(content){_textarea.style.display="block",_iframe.style.display="block",_textarea.value=styleHtml(content)},preview=function(){_textarea.style.display="block",_iframe.style.display="block";var content=DOMPurify.sanitize(_textarea.value),conwin=_iframe.contentWindow.document.body;conwin.innerHTML=content},hideDom=function(){ZE.hideOverlay(),parentDom.parentNode.removeChild(parentDom)},getIndent=function(level){for(var _result="",i=4*level;i--;)_result+=" ";return _result},styleHtml=function(html){html=html.trim();for(var result="",indentLevel=0,tokens=html.split(/</),length=tokens.length,i=0,l=length;l>i;i++){var parts=tokens[i].split(/>/);2===parts.length?("/"===tokens[i][0]&&indentLevel--,result+=getIndent(indentLevel),"/"!==tokens[i][0]&&indentLevel++,i>0&&(result+="<"),result+=parts[0].trim()+">\n",""!==parts[1].trim()&&(result+=getIndent(indentLevel)+parts[1].trim().replace(/\s+/g," ")+"\n"),parts[0].match(/^(img|hr|br)/)&&indentLevel--):result+=getIndent(indentLevel)+parts[0]+"\n"}return result},editHTMLDom=[String('<div class = "ze_popupTitle">'+CONSTANTS.TITLE),'<span class = "zei-close"> </span>',"</span>","</div>",'<div class = "ze_popupEditor">',"<textarea></textarea>","<iframe></iframe>","</div>",'<div class = "ze_popupButton">','<span class = "sel">'+CONSTANTS.SAVE+"</span>",'<span data-val = "Cancel">'+CONSTANTS.CANCEL+"</span>","</div>"].join(""),ZE.showOverlay(),parentDom=_document.createElement("div"),parentDom.className="ze_popup",parentDom.innerHTML=editHTMLDom,_document.body.appendChild(parentDom),editorArea=parentDom.getElementsByClassName("ze_popupEditor")[0],_textarea=editorArea.childNodes[0],_iframe=editorArea.childNodes[1],buttons=parentDom.getElementsByClassName("ze_popupButton")[0],save=buttons.childNodes[0],cancel=buttons.childNodes[1],close=parentDom.getElementsByClassName("zei-close")[0],ZE._addEvent(save,"mousedown",function(){var content=DOMPurify.sanitize(_textarea.value);editor.setContent(content),hideDom()}),ZE._addEvent(cancel,"mousedown",hideDom),ZE._addEvent(close,"mousedown",hideDom),ZE._addEvent(_textarea,"keyup",function(){var content=DOMPurify.sanitize(_textarea.value),conwin=_iframe.contentWindow.document.body;conwin.innerHTML=content}),htmlView(editorContent),preview()};ZE.prototype.freeze=function(){var _document=document,_body=_document.body,_freeze_div=_document.getElementById("ze_freeze");if(_freeze_div){var _style=_freeze_div.style;_style.height=Math.max(_body.scrollHeight,_document.documentElement.scrollHeight)+"px",_style.width=_body.clientWidth+"px",_style.display=""}else{var _div=_document.createElement("div"),_style=_div.style;_div.id=_div.className="ze_freeze",_style.height=Math.max(_body.scrollHeight,_document.documentElement.scrollHeight)+"px",_style.width=_body.clientWidth+"px",document.body.appendChild(_div),window.addEventListener("resize",function(){var _document=document,freezeDiv=_document.getElementById("ze_freeze"),freezeDiv_style=freezeDiv.style;if(freezeDiv&&freezeDiv_style&&"none"!==freezeDiv_style.display){var _body=_document.body;freezeDiv_style.height=Math.max(_body.scrollHeight,_document.documentElement.scrollHeight)+"px",freezeDiv_style.width=_body.clientWidth+"px"}},!0)}},ZE.prototype.hideFreeze=function(){var _freeze_div=document.getElementById("ze_freeze");_freeze_div&&(_freeze_div.style.display="none")};ZE.prototype.createHeadingDiv=function(ev){var hideHeadingDiv,ul_click,_colorHeading,_mousedown,fragment,ulElement,liElement,_a,offsets,_previousSibling,temp,boldElement,headingElement,headingTagElement,headingTag,headingName,_style,i,editor=this,_anchorElement=ev.currentTarget,_document=document,ze_heading_div=_document.getElementById("ze_heading"),_doc=editor.doc,is_ie=ZE_Init.is_ie,headingArray=[["H1","Heading 1"],["H2","Heading 2"],["H3","Heading 3"],["H4","Heading 4"],["H5","Heading 5"],["H6","Heading 6"],["NR","Normal"]];if(hideHeadingDiv=function(ev){ev&&"keydown"!==ev.type&&editor._stopEvent(ev),ze_heading_div.style.display="none",ZE._removeEvent(ze_heading_div,"click",ul_click),ZE._removeEvent(_document,"mousedown",_mousedown),ZE._removeEvent(_doc,"mousedown",hideHeadingDiv),ZE._removeEvent(_doc,"keydown",hideHeadingDiv);var _boldElementsArray=ze_heading_div.getElementsByTagName("b"),_boldElementsArrayLength=_boldElementsArray.length;for(i=0;_boldElementsArrayLength>i;i++)_boldElementsArray[i].className=_boldElementsArray[i].className.replace("ze_sel","")},ul_click=function(ev){editor._stopEvent(ev);var _target,startNode;if(_target=is_ie?ev.srcElement:ev.target,"LI"===_target.nodeName&&(_target=_target.firstChild),_target=_target.parentNode,editor.win.focus(),_doc.execCommand("formatblock",!1,_target.getAttribute("data-h"))||_doc.execCommand("formatblock",!1,"<"+_target.getAttribute("data-h")+">"),"p"===_target.getAttribute("data-h"))for(startNode=editor.getParentElement();null!==startNode&&"BODY"!==startNode.nodeName;startNode=startNode.parentNode)if("P"===startNode.nodeName){startNode.style.margin="0px";break}hideHeadingDiv()},_mousedown=function(ev){editor._stopEvent(ev);var _target=is_ie?ev.srcElement:ev.target;if(_target===_anchorElement||_target===_anchorElement.lastChild)return!1;for(;null!==_target&&_target!==ze_heading_div;_target=_target.parentNode);null===_target&&hideHeadingDiv()},_colorHeading=function(){if(ZE_Init.is_safari){var ancestors,i,length;if(editor.getAllAncestors)for(ancestors=editor.getAllAncestors(),length=ancestors.length,i=0;length>i;i++){if(heading_TagName=ancestors[i].nodeName,"H1"===heading_TagName||"H2"===heading_TagName||"H3"===heading_TagName||"H4"===heading_TagName||"H5"===heading_TagName||"H6"===heading_TagName){headingTagElement=ze_heading_div.getElementsByTagName(heading_TagName)[0];break}headingTagElement=ze_heading_div.getElementsByTagName("div")[0]}}else{if(is_ie)heading_TagName=editor.doc.queryCommandValue("formatblock"),heading_TagName="H"+heading_TagName.substring("8");else try{heading_TagName=editor.doc.queryCommandValue("heading").toUpperCase()}catch(e){heading_TagName=editor.doc.queryCommandValue("formatblock"),heading_TagName="H"+heading_TagName.substring("8")}headingTagElement="H1"===heading_TagName||"H2"===heading_TagName||"H3"===heading_TagName||"H4"===heading_TagName||"H5"===heading_TagName||"H6"===heading_TagName?ze_heading_div.getElementsByTagName(heading_TagName)[0]:ze_heading_div.getElementsByTagName("div")[0]}_previousSibling=headingTagElement.previousSibling,_previousSibling.className=_previousSibling.className+" ze_sel"},is_ie&&(_anchorElement=ev.srcElement,"IMG"===_anchorElement.tagName&&(_anchorElement=_anchorElement.parentNode)),ze_heading_div&&"none"!==ze_heading_div.style.display)return hideHeadingDiv(),!1;if(ze_heading_div)ze_heading_div.style.display="",_colorHeading(),ZE_Init.needEditorStats&&editor.updateCount("he");else{for(fragment=_document.createDocumentFragment(),ulElement=_document.createElement("ul"),ulElement.className="ze_heading",ulElement.id="ze_heading",ze_heading_div=ulElement,fragment.appendChild(ulElement),i=0;temp=headingArray[i];i++)headingTag=temp[0],headingName=temp[1],liElement=_document.createElement("li"),_a=_document.createElement("a"),_a.title=_a.href=headingName,i+1!==7?is_ie?_a.setAttribute("data-h","<h"+(i+1)+">"):_a.setAttribute("data-h","h"+(i+1)):is_ie?_a.setAttribute("data-h","<p>"):_a.setAttribute("data-h","p"),boldElement=_document.createElement("b"),boldElement.className="ze_h_mrgn"+(i+1),headingElement=_document.createElement("NR"!==headingTag?headingTag:"div"),liElement.appendChild(_a),_a.appendChild(boldElement),_a.appendChild(headingElement),headingElement.appendChild(_document.createTextNode(headingName)),boldElement.appendChild(_document.createTextNode(headingTag)),ulElement.appendChild(liElement);editor.popupdiv.appendChild(fragment),_colorHeading(),ZE_Init.needEditorStats&&editor.updateCount("he")}ZE._addEvent(ze_heading_div,"click",ul_click),ZE._addEvent(_document,"mousedown",_mousedown),ZE._addEvent(_doc,"mousedown",hideHeadingDiv),ZE._addEvent(_doc,"keydown",hideHeadingDiv),offsets=ZE.getPos(_anchorElement),_style=ze_heading_div.style,_style.left=offsets.offsetLeft+"px",_style.top=offsets.offsetTop+_anchorElement.offsetHeight+"px"};ZE.prototype.resize=function(ev){var _targetedSpanId,_span,offsets,crtlgridH,crtlgridW,_spanE_Style,_spanW_Style,_spanN_Style,_spanS_Style,ctrlgridLeftDistance,ctrlgridTopDistance,_style,removeResizeImage,updateSpanGridPosition,resizeDiv,editor=this,_target=ev.target,_targetNodeName=_target.nodeName,_doc=editor.doc,_body=_doc.body,ctrlgrid=_doc.getElementById("ctrlgrid"),_spanE=_doc.getElementById("east"),_spanW=_doc.getElementById("west"),_spanN=_doc.getElementById("north"),_spanS=_doc.getElementById("south"),dx=2;if("IMG"===_targetNodeName||"ze_resize-ctrl-grid"===_target.className){switch("IMG"===_targetNodeName&&_target.setAttribute("id","resize"),removeResizeImage=function(ev){var Target_Id=ev.target.id;("ctrlgrid"!==Target_Id||_target.clientWidth!=parseFloat(ctrlgrid.style.width)||_target.clientHeight!=parseFloat(ctrlgrid.style.height))&&(("ctrlgrid"===Target_Id||"east"===Target_Id||"resize"===Target_Id||"west"===Target_Id||"south"===Target_Id||"north"===Target_Id)&&(_target.style.height=ctrlgrid.style.height,_target.style.width=ctrlgrid.style.width),ctrlgrid&&_spanE&&(_body.removeChild(_spanE),_body.removeChild(_spanW),_body.removeChild(_spanS),_body.removeChild(_spanN),_body.removeChild(ctrlgrid)),_doc.removeEventListener("mouseup",removeResizeImage,!0),_doc.removeEventListener("mousemove",resizeDiv,!0),_target.hasAttribute("id")&&_target.removeAttribute("id"))},updateSpanGridPosition=function(){crtlgridH=parseFloat(ctrlgrid.style.height),crtlgridW=parseFloat(ctrlgrid.style.width),ctrlgrid_OffsetTop=ctrlgrid.offsetTop,ctrlgrid_OffsetLeft=ctrlgrid.offsetLeft,ctrlgrid&&(_spanE_Style.top=ctrlgrid_OffsetTop+crtlgridH/2,_spanE_Style.left=ctrlgrid_OffsetLeft+crtlgridW-dx,_spanW_Style.top=ctrlgrid_OffsetTop+crtlgridH/2,_spanW_Style.left=ctrlgrid_OffsetLeft-dx,_spanS_Style.top=ctrlgrid_OffsetTop+crtlgridH-dx,_spanS_Style.left=ctrlgrid_OffsetLeft+crtlgridW/2,_spanN_Style.top=ctrlgrid_OffsetTop-dx,_spanN_Style.left=ctrlgrid_OffsetLeft+crtlgridW/2)},resizeDiv=function(ev){var bodyScrollTop_EventClientY,eventClientX=ev.clientX,eventClientY=ev.clientY;"undefined"!=typeof ctrlgrid&&_spanE&&(_spanE.getAttribute("move_span")&&(_style.width=eventClientX-ctrlgrid.offsetLeft),_spanW.getAttribute("move_span")&&(_style.left=eventClientX,_style.width=ctrlgridLeftDistance-eventClientX),_spanS.getAttribute("move_span")&&(_style.height=_body.scrollTop+eventClientY-ctrlgrid.offsetTop),_spanN.getAttribute("move_span")&&(bodyScrollTop_EventClientY=_body.scrollTop+eventClientY,_style.top=bodyScrollTop_EventClientY,_style.height=ctrlgridTopDistance-bodyScrollTop_EventClientY),updateSpanGridPosition())},_targetedSpanId=_target.id){case"east":_spanE.setAttribute("move_span","movespan");break;case"west":_spanW.setAttribute("move_span","movespan");break;case"north":_spanN.setAttribute("move_span","movespan");break;case"south":_spanS.setAttribute("move_span","movespan")}ctrlgrid||(ctrlgrid=_doc.createElement("div"),ctrlgrid.setAttribute("id","ctrlgrid"),offsets=ZE.getPos(_target),_style=ctrlgrid.style,_style.left=offsets.offsetLeft+"px",_style.top=offsets.offsetTop+"px",_style.height=_target.offsetHeight,_style.width=_target.offsetWidth,ctrlgrid.className="ze_ctrlgrid",_body.appendChild(ctrlgrid),crtlgridH=parseFloat(_style.height),crtlgridW=parseFloat(_style.width),ctrlgrid_OffsetTop=ctrlgrid.offsetTop,ctrlgrid_OffsetLeft=ctrlgrid.offsetLeft,_span=_doc.createElement("span"),_span.className="ze_resize-ctrl-grid",_spanE=_span.cloneNode(!0),_spanE.setAttribute("id","east"),_spanE_Style=_spanE.style,_spanE_Style.top=ctrlgrid_OffsetTop+(crtlgridH/2-dx),_spanE_Style.left=ctrlgrid_OffsetLeft+(crtlgridW-dx),_spanE_Style.cursor="e-resize",_body.appendChild(_spanE),_spanW=_span.cloneNode(!0),_spanW.setAttribute("id","west"),_spanW_Style=_spanW.style,_spanW_Style.top=ctrlgrid_OffsetTop+(crtlgridH/2-dx),_spanW_Style.left=ctrlgrid_OffsetLeft-dx,_spanW_Style.cursor="w-resize",_body.appendChild(_spanW),_spanN=_span.cloneNode(!0),_spanN.setAttribute("id","north"),_spanN_Style=_spanN.style,_spanN_Style.top=ctrlgrid_OffsetTop-dx,_spanN_Style.left=ctrlgrid_OffsetLeft+crtlgridW/2,_spanN_Style.cursor="n-resize",_body.appendChild(_spanN),_spanS=_span.cloneNode(!0),_spanS.setAttribute("id","south"),_spanS_Style=_spanS.style,_spanS_Style.top=ctrlgrid_OffsetTop+crtlgridH,_spanS_Style.left=ctrlgrid_OffsetLeft+crtlgridW/2,_spanS_Style.cursor="s-resize",_body.appendChild(_spanS),ctrlgridLeftDistance=ctrlgrid_OffsetLeft+crtlgridW,ctrlgridTopDistance=ctrlgrid_OffsetTop+crtlgridH,_doc.addEventListener("mousemove",resizeDiv,!0),_doc.addEventListener("mouseup",removeResizeImage,!0))}};ZE.show_CaptchaImage=function(hipurl,editor1){var _img,tmp,captcha_text,go_btn,cancel_btn,refresh_btn,editor,_doc=document,captcha_Div=_doc.getElementById("ze_captcha"),I18N=ZE.i18n;editor=editor1?editor1:ZE.activeEditor;var initialise=function(){var _span=captcha_Div.getElementsByTagName("span");refresh_btn=_span[0],go_btn=_span[1],cancel_btn=_span[2]};captcha_Div?captcha_Div.style.display="":(tmp="<div class='zep_PUtt' onmousedown='ZE.drag(event,\"ze_captcha\");return false;'>"+I18N("Word Verification")+"<i class='zei-close'></i></div>",tmp+="<div class='zep_PUcen'>",tmp+="<div ><table width='100%' cellspacing='0' cellpadding='5' border='0' align='center' class='ze_bordersizemain'> <tbody><tr><th align='right'>"+I18N("Image Text")+"</th><td>"+I18N("Enter the text you see in below image")+"</td></tr>",tmp+="<tr><td>&nbsp;</td><td>"+I18N("Letters are not case sensitive")+"</td></tr>",tmp+="<tr><td>&nbsp;</td><td><input type='text' id ='ze_captcha_text' class='.ze_textbox' style='width: 202px;'></td></tr>",tmp+="<tr><td>&nbsp;</td><td><div  class='ze_captcha'><img align='absmiddle' height ='72px' class='ze_hip' alt="+I18N("HIPImage")+" title="+I18N("Image Verification")+" name='ze_hipImg'></div><span id ='ze_refresh_hip' title ="+I18N("Refresh image")+" class='ze_change-captcha-icon'></span></td></tr>",tmp+="</tbody></table></div></div>",tmp+="<div class='zep_PUbtm'><span>"+I18N("Go")+"</span><span>"+I18N("Cancel")+"</span></div>",captcha_Div=_doc.createElement("div"),captcha_Div.className="zep_PU",captcha_Div.innerHTML=tmp,captcha_Div.id="ze_captcha",document.body.appendChild(captcha_Div)),initialise(),captcha_text=_doc.getElementById("ze_captcha_text"),captcha_text.value="",captcha_text.focus(),ZE.setPosition(captcha_Div,editor.editordiv),_img=captcha_Div.getElementsByTagName("img"),_img[0].src="/showcaptcha?digest="+hipurl,go_btn.onclick=refresh_btn.onclick=function(ev){var captcha_text_value=captcha_text.value,target=ev?ev.target:window.event.srcElement;return ZE.captchaParam=hipurl+"="+captcha_text_value,"ze_refresh_hip"===target.id&&(ZE.captchaParam=" "),ZE.captchaProcessing&&ZE.captchaProcessing(),"ze_refresh_hip"===target.id?!1:(captcha_Div.parentNode.removeChild(captcha_Div),!1)},captcha_Div.getElementsByClassName("zei-close")[0].onclick=cancel_btn.onclick=function(){captcha_Div.parentNode.removeChild(captcha_Div);var i18n_msg=I18N("Unable to insert image. Retry after sometime");return ZE.insertImageMsg(i18n_msg,"error"),editor.inlineImagesToBe&&editor.inlineImagesToBe.length>0&&editor.inlineImagesToBe.splice(0,editor.inlineImagesToBe.length),!1}};