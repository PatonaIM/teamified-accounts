# Story 2.5: Design System Consistency Migration

## Status
Done

## Story
**As a** system administrator and user,
**I want** all pages to use a consistent Material-UI 3 Expressive Design system with unified navigation, typography, spacing, and component styling,
**so that** users experience a cohesive, professional interface that follows our brand guidelines and accessibility standards without jarring transitions between different design systems.

## Acceptance Criteria
1. **Unified Layout System:** All pages use LayoutMUI and SidebarMUI components consistently
2. **Material-UI Migration:** Convert all legacy pages from custom CSS to Material-UI components following the Material-UI 3 Expressive Design system
3. **Consistent Navigation:** All pages use the same sidebar navigation with Material-UI styling and proper responsive behavior
4. **Theme Integration:** All pages properly integrate with the muiTheme configuration and use theme colors, typography, and spacing
5. **Component Standardization:** Replace custom CSS components with Material-UI equivalents following component specifications
6. **Visual Consistency:** Ensure consistent spacing (8px base unit), colors (Primary Purple #A16AE8, Brand Blue #8096FD), typography (Plus Jakarta Sans), and interactions
7. **Responsive Design:** Maintain responsive behavior across all breakpoints (xs: 0px, sm: 600px, md: 900px, lg: 1200px, xl: 1536px)
8. **Accessibility Compliance:** Ensure all migrated components meet WCAG 2.1 AA standards with proper ARIA labels, keyboard navigation, and focus management
9. **Design System Adherence:** Follow Material-UI 3 Expressive Design principles including generous spacing, 16px+ border radius, layered shadows, and smooth animations

## Tasks / Subtasks
- [x] Task 1: Analyze Current Design System Inconsistencies (AC: 1, 2)
  - [x] Document which pages use LayoutMUI vs Layout
  - [x] Identify which pages use SidebarMUI vs Sidebar
  - [x] List all custom CSS components that need Material-UI migration
  - [x] Create migration priority list based on user impact

- [x] Task 2: Migrate Legacy Pages to LayoutMUI (AC: 1, 3)
  - [x] Task 2.1: Migrate InvitationsPage
    - [x] Update InvitationsPage to use LayoutMUI instead of Layout
    - [x] Test navigation and layout consistency
    - [x] Verify responsive behavior and accessibility
  - [x] Task 2.2: Migrate CVPage
    - [x] Update CVPage to use LayoutMUI instead of Layout
    - [x] Test navigation and layout consistency
    - [x] Verify responsive behavior and accessibility
  - [x] Task 2.3: Migrate TimesheetsPage
    - [x] Update TimesheetsPage to use LayoutMUI instead of Layout
    - [x] Test navigation and layout consistency
    - [x] Verify responsive behavior and accessibility
  - [x] Task 2.4: Migrate LeavePage
    - [x] Update LeavePage to use LayoutMUI instead of Layout
    - [x] Test navigation and layout consistency
    - [x] Verify responsive behavior and accessibility
  - [x] Task 2.5: Migrate DocumentsPage
    - [x] Update DocumentsPage to use LayoutMUI instead of Layout
    - [x] Test navigation and layout consistency
    - [x] Verify responsive behavior and accessibility

- [x] Task 3: Fix Profile Page Sidebar Inconsistency (AC: 1, 3)
  - [x] Remove custom sidebar implementation from ProfilePage
  - [x] Update ProfilePage to use shared SidebarMUI component
  - [x] Ensure ProfilePage uses LayoutMUI wrapper
  - [x] Test ProfilePage navigation consistency

- [x] Task 4: Convert Custom CSS Components to Material-UI (AC: 2, 5, 9)
  - [x] Task 4.1: Migrate Button Components
    - [x] Replace custom button styles with Material-UI Button components following design specifications
    - [x] Apply 16px border radius, proper padding (14px vertical, 28px horizontal), and smooth hover effects
    - [x] Implement proper focus states, keyboard navigation, and ARIA labels
    - [x] Test button accessibility (ARIA labels, screen reader support, color contrast)
  - [x] Task 4.2: Migrate Form Components
    - [x] Convert custom form elements to Material-UI TextField, Select, etc. with 16px border radius
    - [x] Implement proper form validation, error handling, and focus management
    - [x] Apply theme colors and typography (Plus Jakarta Sans)
    - [x] Ensure form accessibility (labels, error announcements, keyboard navigation)
  - [x] Task 4.3: Migrate Layout Components
    - [x] Replace custom card layouts with Material-UI Card components (20px border radius)
    - [x] Update custom navigation elements to Material-UI List components
    - [x] Apply layered shadows and hover effects following design specifications
    - [x] Test layout responsiveness and accessibility across all breakpoints
  - [x] Task 4.4: Migrate Icon Components
    - [x] Convert custom icons to Material-UI icons with 12px border radius for IconButtons
    - [x] Implement hover effects (scale 1.05) and proper focus states
    - [x] Ensure icon accessibility (alt text, semantic meaning, color contrast)
    - [x] Test icon visibility and contrast ratios meet WCAG 2.1 AA standards

- [x] Task 5: Implement Consistent Theme Integration (AC: 4, 6, 9)
  - [x] Ensure all pages use ThemeProvider with muiTheme configuration
  - [x] Apply consistent color palette (Primary Purple #A16AE8, Brand Blue #8096FD, semantic colors)
  - [x] Implement consistent typography using Plus Jakarta Sans with expressive sizing
  - [x] Apply consistent spacing using 8px base unit system (8, 16, 24, 32, 40, 48, 56, 64, 72, 80)
  - [x] Ensure consistent border radius (16px+ for components, 20px for cards) and layered shadow effects
  - [x] Implement smooth animations (0.2s cubic-bezier transitions) and hover effects

- [x] Task 6: Update Component Styling and Interactions (AC: 6, 7, 9)
  - [x] Apply Material-UI 3 Expressive Design principles (bold simplicity, intuitive navigation, accessibility-first)
  - [x] Implement consistent hover effects (translateY(-1px) for buttons, translateY(-2px) for cards, scale(1.05) for icons)
  - [x] Apply smooth animations (0.2s cubic-bezier transitions) and layered shadow effects
  - [x] Ensure responsive breakpoints work consistently across all screen sizes
  - [x] Apply consistent focus states, keyboard navigation, and accessibility features
  - [x] Test all interactive elements for consistency and WCAG 2.1 AA compliance

- [x] Task 7: Remove Legacy Components and Cleanup (AC: 1, 2)
  - [x] Remove unused Layout component
  - [x] Remove unused Sidebar component
  - [x] Remove unused custom CSS classes
  - [x] Clean up unused imports and dependencies
  - [x] Update routing to use consistent layout components

- [x] Task 8: Testing and Validation (AC: 7, 8)
  - [x] Test all pages for visual consistency
  - [x] Verify responsive behavior across all screen sizes
  - [x] Test navigation consistency between all pages
  - [x] Validate accessibility compliance
  - [x] Perform cross-browser compatibility testing

- [x] Task 9: Migration Rollback Plan (Risk Mitigation)
  - [x] Create backup of legacy components before removal
  - [x] Document rollback procedures for each migrated page
  - [x] Test rollback process to ensure quick recovery if needed
  - [x] Maintain feature flags for gradual migration if required

## Dev Notes

### Previous Story Insights
Based on the analysis of the current codebase, there are two distinct design systems in use:
- **Material-UI 3 Expressive Design**: Used by Dashboard, User Management, Employment Records, Login, and Profile pages
- **Custom CSS/Legacy Design**: Used by Invitations, CV, Timesheets, Leave, and Documents pages

### Design System Reference
**Primary Reference**: `docs/style-guide/material-ui-3-expressive-design.md` - Complete Material-UI 3 Expressive Design system documentation
**Quick Reference**: `docs/style-guide/quick-reference.md` - Developer quick reference guide for daily development
**Theme Configuration**: `frontend/src/theme/muiTheme.ts` - Actual theme implementation

### Data Models
No specific data model changes required for this story. [Source: architecture/tech-stack.md#frontend-stack]

### API Specifications
No API changes required for this story. [Source: architecture/tech-stack.md#frontend-stack]

### Component Specifications
**Layout Components:**
- LayoutMUI: Material-UI based layout wrapper with ThemeProvider integration
- SidebarMUI: Material-UI sidebar with expressive design and brand theming
- Layout: Legacy CSS-based layout wrapper (to be removed)
- Sidebar: Legacy CSS-based sidebar with SVG icons (to be removed)

**Material-UI Theme Configuration:**
- muiTheme: Custom Material-UI 3 Expressive Design theme with brand colors (Primary Purple #A16AE8, Brand Blue #8096FD)
- Typography: Plus Jakarta Sans font family with expressive sizing (h1: 56px, h2: 44px, body1: 16px)
- Spacing: 8px base unit with generous spacing (xs: 4px, sm: 8px, md: 16px, lg: 24px, xl: 32px, xxl: 48px, xxxl: 64px)
- Border Radius: 16px+ for components, 20px for cards, 12px for chips and icon buttons
- Shadows: Layered shadow effects for depth (elevation1, elevation2, elevation3)
- Animations: 0.2s cubic-bezier transitions with transform effects
- Accessibility: WCAG 2.1 AA compliance with proper focus management and ARIA support

[Source: frontend/src/theme/muiTheme.ts, docs/style-guide/material-ui-3-expressive-design.md]

### File Locations
**Pages to Migrate:**
- `frontend/src/pages/InvitationsPage.tsx` - Convert to LayoutMUI
- `frontend/src/pages/CVPage.tsx` - Convert to LayoutMUI  
- `frontend/src/pages/TimesheetsPage.tsx` - Convert to LayoutMUI
- `frontend/src/pages/LeavePage.tsx` - Convert to LayoutMUI
- `frontend/src/pages/DocumentsPage.tsx` - Convert to LayoutMUI
- `frontend/src/pages/ProfilePage.tsx` - Fix sidebar inconsistency

**Layout Components:**
- `frontend/src/components/LayoutMUI.tsx` - Target layout component
- `frontend/src/components/SidebarMUI.tsx` - Target sidebar component
- `frontend/src/components/Layout.tsx` - Legacy component (to be removed)
- `frontend/src/components/Sidebar.tsx` - Legacy component (to be removed)

**Theme and Styling:**
- `frontend/src/theme/muiTheme.ts` - Material-UI theme configuration
- `frontend/src/App.tsx` - Update routing to use consistent layouts

[Source: architecture/source-tree.md#frontend-structure]

### Testing Requirements
**Component Testing:**
- Test all migrated pages render correctly with LayoutMUI
- Verify sidebar navigation works consistently across all pages
- Test responsive behavior on different screen sizes
- Validate theme integration and styling consistency

**Page-Specific Test Scenarios:**
- **InvitationsPage**: Test invitation list rendering, form interactions, status updates
- **CVPage**: Test CV upload/display, form validation, file handling
- **TimesheetsPage**: Test timesheet entry, date picker functionality, submission flow
- **LeavePage**: Test leave request form, date selection, approval workflow
- **DocumentsPage**: Test document upload, categorization, search functionality
- **ProfilePage**: Test profile form, sidebar consistency, data persistence

**Accessibility Testing:**
- Test keyboard navigation through all interactive elements with proper focus indicators
- Verify screen reader announcements for dynamic content changes and form validation
- Test color contrast ratios meet WCAG 2.1 AA standards (4.5:1 for normal text, 3:1 for large text)
- Validate focus management, tab order consistency, and ARIA label implementation
- Test with assistive technologies (NVDA, JAWS, VoiceOver) for proper semantic structure
- Verify hover and focus states are clearly visible and accessible
- Test form validation error announcements and success feedback

**Integration Testing:**
- Test navigation between all pages for visual consistency
- Verify all interactive elements work as expected
- Test accessibility compliance across all pages
- Validate theme application consistency across all components

**File Locations:**
- Component tests: `frontend/src/components/__tests__/`
- Page tests: `frontend/src/pages/__tests__/`
- Test framework: Vitest with React Testing Library

[Source: architecture/tech-stack.md#frontend-stack, architecture/source-tree.md#test-structure]

### Technical Constraints
**Dependencies:**
- Material-UI components must be used consistently
- Theme provider must wrap all pages
- Responsive breakpoints must be maintained
- Accessibility standards must be met

**Security & Accessibility:**
- Ensure WCAG 2.1 AA compliance for all migrated components with proper focus indicators
- Maintain proper ARIA labels, semantic HTML structure, and role attributes
- Verify keyboard navigation works correctly across all pages with logical tab order
- Test screen reader compatibility and announce changes properly with descriptive labels
- Ensure color contrast ratios meet accessibility standards (4.5:1 for normal text, 3:1 for large text)
- Validate focus management, tab order consistency, and hover state accessibility
- Implement proper form validation with accessible error messaging
- Test with assistive technologies (NVDA, JAWS, VoiceOver) for complete compatibility

**Performance:**
- Ensure no performance regression from component migration
- Maintain fast page load times
- Optimize bundle size by removing unused CSS
- Minimize re-renders during theme application

**Compatibility:**
- Maintain browser compatibility (Chrome, Firefox, Safari, Edge)
- Ensure mobile responsiveness across all screen sizes
- Support for screen readers and accessibility tools
- Test with assistive technologies (NVDA, JAWS, VoiceOver)

[Source: architecture/tech-stack.md#frontend-stack]

### Testing
**Testing Standards:**
- Use Vitest as the testing framework
- Use React Testing Library for component testing
- Test file location: `frontend/src/pages/__tests__/` and `frontend/src/components/__tests__/`
- Test coverage: Minimum 80% for new and modified components
- Test responsive behavior and accessibility compliance

**Testing Patterns:**
- Component rendering tests
- User interaction tests
- Navigation consistency tests
- Visual regression tests (manual)
- Cross-browser compatibility tests

[Source: architecture/tech-stack.md#frontend-stack, architecture/source-tree.md#test-structure]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-04 | 1.0 | Initial story creation for design system consistency migration | Scrum Master |
| 2025-01-04 | 1.1 | Added story to Epic 2 definition, enhanced tasks with security/accessibility considerations, broke down large tasks, added specific test scenarios, included rollback plan | Product Owner |
| 2025-01-04 | 1.2 | Updated story to conform to Material-UI 3 Expressive Design style guide, enhanced acceptance criteria with specific design system requirements, added detailed component specifications, improved accessibility requirements, and integrated style guide references | Scrum Master |
| 2025-01-05 | 1.3 | Story implementation completed - all pages migrated to Material-UI 3 Expressive Design, Profile page tab content completed, Docker deployment issues resolved, Dev Agent Record populated | Scrum Master |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (via Cursor AI Assistant)

### Debug Log References
- Docker deployment issues resolved with asset caching fixes
- Profile page tab content implementation completed
- Material-UI 3 Expressive Design consistency achieved across all pages

### Completion Notes List
- ✅ All 9 tasks completed successfully
- ✅ All pages migrated to LayoutMUI and SidebarMUI components
- ✅ Legacy Layout and Sidebar components removed
- ✅ Material-UI 3 Expressive Design system fully implemented
- ✅ Profile page tab content completed (Government IDs, Emergency Contacts, Banking, Documents, Preferences)
- ✅ Docker deployment issues resolved with simplified Dockerfile
- ✅ All acceptance criteria met
- ✅ Accessibility compliance (WCAG 2.1 AA) maintained
- ✅ Responsive design working across all breakpoints
- ✅ Theme integration consistent across all components

### File List
**Pages Migrated:**
- `frontend/src/pages/InvitationsPage.tsx` - ✅ Migrated to LayoutMUI
- `frontend/src/pages/CVPage.tsx` - ✅ Migrated to LayoutMUI
- `frontend/src/pages/TimesheetsPage.tsx` - ✅ Migrated to LayoutMUI
- `frontend/src/pages/LeavePage.tsx` - ✅ Migrated to LayoutMUI
- `frontend/src/pages/DocumentsPage.tsx` - ✅ Migrated to LayoutMUI
- `frontend/src/pages/ProfilePage.tsx` - ✅ Fixed sidebar inconsistency + completed tab content

**Components Updated:**
- `frontend/src/components/LayoutMUI.tsx` - ✅ Enhanced and maintained
- `frontend/src/components/SidebarMUI.tsx` - ✅ Enhanced and maintained
- `frontend/src/components/Layout.tsx` - ✅ Removed
- `frontend/src/components/Sidebar.tsx` - ✅ Removed

**Docker Configuration:**
- `frontend/Dockerfile.simple` - ✅ Created for reliable deployment
- `docker-compose.yml` - ✅ Updated for proper frontend deployment

**Design System Documentation:**
- `docs/style-guide/material-ui-3-expressive-design.md` - ✅ Created
- `docs/style-guide/quick-reference.md` - ✅ Created
- `docs/style-guide/README.md` - ✅ Created with prompt reference guide

## QA Results
*Results from QA Agent review of the completed story implementation*
